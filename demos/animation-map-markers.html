<!doctype html>
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title></title>
  <meta name="description" content="">
  <meta name="author" content="Damon Oehlman">

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <script src="_demogen/js/modernizr-2.0.6.min.js"></script>
</head>

<body>
  
  <style type="text/css">html, body, #mapContainer {
    margin: 0;
    height: 100%;
    width: 100%;
}

body {
    font: 1em Helvetica, Arial;
}

.t5-copyright {
    background: #e8e8e8;
    opacity: 0.4;
    font-size: 0.8em;
    padding: 5px;
}</style>
  
  <div id="mapContainer"></div>


  <!--[if lt IE 7 ]>
    <script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script>
    <script>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})</script>
  <![endif]-->

  <script src="_demogen/js/keymaster.min.js"></script>
  <script src="_demogen/js/jquery-1.6.2.min.js"></script>
  <script src="_demogen/js/ace/ace.js"></script>
  <script src="_demogen/js/ace/theme-twilight.js"></script>
  <script src="_demogen/js/ace/mode-javascript.js"></script>
  <script src="_demogen/js/runner.js"></script>
  <script src="../dist/tile5.cloudmade.js"></script>
  
  <script>
  var settings = {"theme":"twilight","mode":"javascript","body":"<div id=\"mapContainer\"></div>"};
  </script>
  <script defer="defer">// create the map
var map = new T5.Map('mapContainer', {
    renderer: settings.renderer || 'canvas',
    drawOnMove: settings.drawOnMove,
    drawOnTween: settings.drawOnTween
});

map.layer('tiles', 'tile', {
    generator: 'osm.cloudmade',
    // demo api key, register for an API key at http://dev.cloudmade.com/
    apikey: '7960daaf55f84bfdb166014d0b9f8d41',
    styleid: settings.mapstyle
});

map.zoom(8).center('-27.469 153.020');

var arcRadius = 500, // distance in km
    angle = 0,
    sample = {
        speed: 2
    },
    startPosition = map.center(),
    planeStart = map.center().offset(0, -arcRadius),
    lastTickCount = 0,
    TWO_PI = Math.PI * 2,
    plane;

function getPlaneScale() {
    return (map.zoom() / 16) * 0.7;
} // getPlaneScale

function movePlane(evt, viewport, tickCount) {
    // if we have a last tick count we can perform some animation
    if (lastTickCount) {
        var deltaChange = (tickCount - lastTickCount) / (10000 / sample.speed),
            newPosition;

        // calculate the angle
        angle = (angle + (TWO_PI * deltaChange)) % TWO_PI;
        newPosition = startPosition.offset(
            arcRadius * Math.sin(angle),
            arcRadius * Math.cos(angle)
        );
        
        // update the plane's position
        plane.xy = new T5.GeoXY(newPosition).sync(map);

        // rotate the plane
        plane.rotate(deltaChange * -360);
        map.invalidate();
    }

    lastTickCount = tickCount;
    // map.invalidate();
} // movePlane

plane = map.layer('markers').create('marker', {
    xy: new T5.GeoXY(planeStart),
    markerType: 'image',
    size: 100,
    imageUrl: 'img/plane.png'
});

// make the plane transformable
plane.scale(getPlaneScale());

// handle the draw complete
map.bind('drawComplete', movePlane);

// handle zoom level changes
map.bind('zoomLevelChange', function(evt, zoomLevel) {
    plane.scale = getPlaneScale();
});

// handle tapping markers
map.bind('tapHit', function(evt, elements, absXY, relXY, offsetXY) {
    // DEMORUNNER.status('tapped the plane', 1200);
});

/*
var ui = DEMO.makeSampleUI();
ui.gui.add(sample, 'speed', 1, 10);
ui.done();
*/

</script>
</body>
</html>
