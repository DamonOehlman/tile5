<!doctype html>
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title></title>
  <meta name="description" content="">
  <meta name="author" content="Damon Oehlman">

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <script src="_demogen/js/modernizr-2.0.6.min.js"></script>
</head>

<body>
  
  <style type="text/css">html, body, #mapContainer {
    margin: 0;
    height: 100%;
    width: 100%;
}

body {
    font: 1em Helvetica, Arial;
}

.t5-copyright {
    background: #e8e8e8;
    opacity: 0.4;
    font-size: 0.8em;
    padding: 5px;
}</style>
  
  <div id="mapContainer"></div>


  <!--[if lt IE 7 ]>
    <script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script>
    <script>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})</script>
  <![endif]-->

  <script src="_demogen/js/keymaster.min.js"></script>
  <script src="_demogen/js/jquery-1.6.2.min.js"></script>
  <script src="_demogen/js/ace/ace.js"></script>
  <script src="_demogen/js/ace/theme-twilight.js"></script>
  <script src="_demogen/js/ace/mode-javascript.js"></script>
  <script src="_demogen/js/runner.js"></script>
  <script src="../dist/tile5.cloudmade.js"></script>
  
  <script>
  var settings = {"theme":"twilight","mode":"javascript","body":"<div id=\"mapContainer\"></div>"};
  </script>
  <script defer="defer">// create the map
var map = new T5.Map('mapContainer', {
    renderer: settings.renderer || 'canvas',
    drawOnMove: settings.drawOnMove,
    drawOnTween: settings.drawOnTween
});

map.layer('tiles', 'tile', {
    generator: 'osm.cloudmade',
    // demo api key, register for an API key at http://dev.cloudmade.com/
    apikey: '7960daaf55f84bfdb166014d0b9f8d41',
    styleid: settings.mapstyle
});

map.zoom(8).center('-27.469 153.020');

(function() {
    // internals
    var ui,
        drawLayer,
        sample = {
            type: 'marker',
            rotation: 0,
            scale: 1,
            selection: null,
            
            selectAll: selectAll
        };
        
    function handleTap(evt, absXY, relXY, projectedXY, hits) {
        var drawable = drawLayer.create(sample.type, {
            draggable: true,
            xy: projectedXY
        });

        // set scale and rotation
        drawable.scale(sample.scale, false, true);
        drawable.rotate(sample.rotation, false, true);

        // update the selection
        sample.selection = [drawable];

        // invalidate the map
        map.invalidate();
    } // handleTap
    
    function rotateSelection(value) {
        for (var ii = sample.selection.length; ii--; ) {
            sample.selection[ii].rotate(value, false, true);
        } // for
        
        map.invalidate();
    } // rotateSelection
    
    function scaleSelection(value) {
        for (var ii = sample.selection.length; ii--; ) {
            sample.selection[ii].scale(value, false, true);
        } // for
        
        map.invalidate();
    } // scaleSelection
    
    function selectAll() {
        sample.selection = drawLayer.find();
    } // selectAll
        
    // make a simple map
    DEMO.makeMap();

    // create the draw layer
    drawLayer = map.layer('shapes', 'draw');
    
    // bind the tap event to create objects
    map.bind('tap', handleTap);
    
    ui = DEMO.makeSampleUI();
    ui.gui.add(sample, 'type').options('marker');
    ui.gui.add(sample, 'rotation', 0, 360, 1).onChange(rotateSelection);
    ui.gui.add(sample, 'scale', 0.25, 4).onChange(scaleSelection);
    ui.gui.add(sample, 'selectAll').name('Select All');
    ui.done();
})();

</script>
</body>
</html>
