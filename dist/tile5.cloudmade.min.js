(function(rb){function D(){var a=arguments[0]||{},c=Array.prototype.slice.call(arguments,1),b=c.length,f,g;for(g=0;g<b;g++)if((f=c[g])!==null)for(var i in f){var h=f[i];if(a!==h)if(h!==undefined)a[i]=h}return a}function ta(a,c){if(typeof console!=="undefined")console[c||"debug"](a)}function za(a){var c=a.match(Lb),b=[],f=0,g;for(g=c?c.length:0;g--;){var i=c[g].slice(1);b[i]||(b[i]=RegExp("\\{"+i+"\\}","g"))}f=b.length;return function(){var h=a;for(g=0;g<f;g++){var j=arguments[g];if(typeof j=="undefined")j=
"";h=h.replace(b[g],j)}return h}}function sb(a,c,b){fa.trigger("userMessage",a,c,b)}function tb(a,c){var b=Ta*ka(a);return Ua-2*ub(c*Aa((1-b)/(1+b),Ta/2))}function T(a,c){if(N(a,oa)){var b=a.split(fb);this.x=parseFloat(b[0]);this.y=parseFloat(b[1])}else if(a&&a.x){this.x=a.x;this.y=a.y}else{this.x=a||0;this.y=c||0}}function Ja(a){this.allowCull=a}function ia(a,c,b,f){this.mercX=b;this.mercY=f;if(N(a,oa))D(this,Mb.parseXY(a));else a&&a.toPixels?D(this,a.toPixels()):T.call(this,a,c)}function ua(a,c,
b,f){this.x=a||0;this.y=c||0;this.w=b||0;this.h=f||0;this.x2=this.x+this.w;this.y2=this.y+this.h}function vb(a,c){var b=new wb(Math.sqrt(256<<a)|0);c&&c.zoomLevel===a&&c.copyInto(b);b.zoomLevel=a;return b}function Va(a,c,b,f,g,i){this.x=a;this.y=c;this.w=f||256;this.h=f||256;this.x2=this.x+this.w;this.y2=this.y+this.h;this.url=b;this.id=i||a+"_"+c;this.loaded=false;this.image=null}function Wa(a,c){c=D({id:"layer_"+Nb++,zindex:0,animated:false,style:null,minXY:null,maxXY:null,visible:true},c);this.visible=
c.visible;this.view=a;va(D(this,c))}function Xa(){va(this)}function ja(a,c){if(a&&a.split){var b=a.split(fb);if(b.length>1){a=b[0];c=b[1]}}else if(a&&a.lat){c=a.lon;a=a.lat}this.lat=parseFloat(a||0);this.lon=parseFloat(c||0)}function Ka(a,c){if(N(a,xb)){for(var b=c,f=new ja(gb,Ya),g=new ja(Ob,yb),i=a.length;i--;){var h=a[i];if(h.lat<f.lat)f.lat=h.lat;if(h.lat>g.lat)g.lat=h.lat;if(h.lon<f.lon)f.lon=h.lon;if(h.lon>g.lon)g.lon=h.lon}this.min=f;this.max=g;if(N(b,wa)){b=this.size();b=Da(b.x,b.y)*0.3}this.expand(b)}else{this.min=
a;this.max=c}}function hb(a){if(!N(a,oa))this.meters=a}var Lb=/\{(\d+)(?=\})/g,Pb=function(){var a=1.70158,c=Math.PI/2,b=Math.abs,f=Math.pow,g=Math.sin,i=Math.asin,h=Math.cos,j={linear:function(e,k,d,m){return d*e/m+k},backin:function(e,k,d,m){return d*(e/=m)*e*((a+1)*e-a)+k},backout:function(e,k,d,m){return d*((e=e/m-1)*e*((a+1)*e+a)+1)+k},backinout:function(e,k,d,m){return(e/=m/2)<1?d/2*e*e*(((a*=1.525)+1)*e-a)+k:d/2*((e-=2)*e*(((a*=1.525)+1)*e+a)+2)+k},bouncein:function(e,k,d,m){return d-j.bounceout(m-
e,0,d,m)+k},bounceout:function(e,k,d,m){return(e/=m)<1/2.75?d*7.5625*e*e+k:e<2/2.75?d*(7.5625*(e-=1.5/2.75)*e+0.75)+k:e<2.5/2.75?d*(7.5625*(e-=2.25/2.75)*e+0.9375)+k:d*(7.5625*(e-=2.625/2.75)*e+0.984375)+k},bounceinout:function(e,k,d,m){return e<m/2?j.bouncein(e*2,0,d,m)/2+k:j.bounceout(e*2-m,0,d,m)/2+d/2+k},cubicin:function(e,k,d,m){return d*(e/=m)*e*e+k},cubicout:function(e,k,d,m){return d*((e=e/m-1)*e*e+1)+k},cubicinout:function(e,k,d,m){if((e/=m/2)<1)return d/2*e*e*e+k;return d/2*((e-=2)*e*e+
2)+k},elasticin:function(e,k,d,m,l,n){if(e==0)return k;if((e/=m)==1)return k+d;n||(n=m*0.3);if(!l||l<b(d)){l=d;d=n/4}else d=n/Z*i(d/l);return-(l*f(2,10*(e-=1))*g((e*m-d)*Z/n))+k},elasticout:function(e,k,d,m,l,n){var o;if(e==0)return k;if((e/=m)==1)return k+d;n||(n=m*0.3);if(!l||l<b(d)){l=d;o=n/4}else o=n/Z*i(d/l);return l*f(2,-10*e)*g((e*m-o)*Z/n)+d+k},elasticinout:function(e,k,d,m,l,n){var o;if(e==0)return k;if((e/=m/2)==2)return k+d;n||(n=m*0.3*1.5);if(!l||l<b(d)){l=d;o=n/4}else o=n/Z*i(d/l);if(e<
1)return-0.5*l*f(2,10*(e-=1))*g((e*m-o)*Z/n)+k;return l*f(2,-10*(e-=1))*g((e*m-o)*Z/n)*0.5+d+k},quadin:function(e,k,d,m){return d*(e/=m)*e+k},quadout:function(e,k,d,m){return-d*(e/=m)*(e-2)+k},quadinout:function(e,k,d,m){if((e/=m/2)<1)return d/2*e*e+k;return-d/2*(--e*(e-2)-1)+k},sinein:function(e,k,d,m){return-d*h(e/m*c)+d+k},sineout:function(e,k,d,m){return d*g(e/m*c)+k},sineinout:function(e,k,d,m){return-d/2*(h(Math.PI*e/m)-1)+k}};return function(e){e=e.replace(/[\-\_\s\.]/g,"").toLowerCase();return j[e]||
j.linear}}(),va=function(){function a(b,f){var g=b.hasOwnProperty("obsHandlers")?b.obsHandlers:null;g[f]||(g[f]=[]);return g[f]}var c=0;return function(b){if(!b)return null;if(!(b.hasOwnProperty("obsHandlers")?b.obsHandlers:null))b.obsHandlers={};if(!b.hasOwnProperty("bind")){b.bind=function(f,g){var i="callback"+c++;a(b,f).unshift({fn:g,id:i});return i};b.triggerCustom=function(f,g){var i=a(b,f),h={cancel:false,name:f,source:this},j;for(j in g)h[j]=g[j];if(!i)return null;j=Array.prototype.slice.call(arguments,
2);b.eventInterceptor&&b.eventInterceptor(f,h,j);j.unshift(h);for(var e=i.length;e--&&!h.cancel;)i[e].fn.apply(this,j);return h};b.trigger=function(f){var g=Array.prototype.slice.call(arguments,1);g.splice(0,0,f,null);return b.triggerCustom.apply(this,g)};b.unbind=function(f,g){if(typeof f==="undefined")b.obsHandlers={};else for(var i=a(b,f),h=0;i&&h<i.length;h++)if(i[h].id===g){i.splice(h,1);break}return b}}return b}}(),zb=function(){function a(c,b,f,g){if(typeof c[g]=="undefined")c[g]=function(i){if(typeof i!=
"undefined"){b[g]=i;f[g]&&f[g](i);return c}else return b[g]}}return function(c,b,f){b=b||c;for(var g in b)typeof b[g]!="function"&&a(c,b,f,g);return c}}(),ib=Array.prototype.indexOf||function(a){for(var c=0;c<this.length;c++)if(this[c]===a)return c;return-1},N=function(){var a={NaN:1,Infinity:1,"-Infinity":1},c=String.prototype.toLowerCase,b=Object.prototype.toString;return function(f,g){g=c.call(g);if(g=="finite")return!a.hasOwnProperty(+f);return g=="null"&&f===null||g==typeof f||g=="object"&&f===
Object(f)||g=="array"&&Array.isArray&&Array.isArray(f)||b.call(f).slice(8,-1).toLowerCase()==g}}();(function(){function a(g){var i=document.createElement("script"),h=false;i.src=g;i.async=true;i.onload=i.onreadystatechange=function(){if(!h&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){h=true;i.onload=i.onreadystatechange=null;i&&i.parentNode&&i.parentNode.removeChild(i)}};b||(b=document.getElementsByTagName("head")[0]);b.appendChild(i)}var c=0,b,f=this;return function(g,
i,h){g+=g.indexOf("?")>=0?"&":"?";var j="json"+ ++c;f[j]=function(e){i(e);f[j]=null;try{delete f[j]}catch(k){}};a(g+(h?h:"callback")+"="+j);return j}})();INTERACT=function(){function a(l){return function(n,o){l.addEventListener(n,o,false)}}function c(l){return function(n,o){l.removeEventListener(n,o,false)}}function b(l){return function(n,o){l.attachEvent("on"+n,o)}}function f(l,n){return{x:l?l:0,y:n?n:0,count:1}}function g(l,n){d.push(D({handler:null,checks:{},type:l},n))}function i(l){var n=0,o=
0;if(l.offsetParent){do{n+=l.offsetLeft;o+=l.offsetTop;l=l.offsetParent}while(l)}return{left:n,top:o}}function h(l,n){return{source:l,target:n.target?n.target:n.srcElement}}function j(l,n){for(var o=l.target?l.target:l.srcElement;o&&o!==n;)o=o.parentNode;return o&&o===n}function e(l,n){return{x:l.x-(n?n.left:0),y:l.y-(n?n.top:0)}}function k(l,n){if(l.preventDefault){l.preventDefault();l.stopPropagation()}else if(typeof l.cancelBubble!="undefined")l.cancelBubble=true;n&&l.stopImmediatePropagation&&
l.stopImmediatePropagation()}var d=[],m=function(l,n,o){o=D({binder:null,unbinder:null,observable:null},o);for(var v=o.observable,w=[],A,E,K={bind:function(){return v.bind.apply(null,arguments)},unbind:function(){v.unbind();for(p=0;p<w.length;p++)w[p].unbind();return K}},p=0;p<n.length;p++)w.push(n[p](l,v,o));v.bind("pointerDown",function(){E=A=0});v.bind("pointerMove",function(y,B,u,C){A+=C.x||0;E+=C.y||0});v.bind("pointerUp",function(y,B,u){Math.abs(A)>20||Math.abs(E)>20||v.triggerCustom("tap",
y,B,u)});return K};g("pointer",{handler:function(l,n,o){function v(s){if(s.pageX&&s.pageY)return f(s.pageX,s.pageY);else{var L=document.documentElement,P=document.body;return f(s.clientX+(L&&L.scrollLeft||P&&P.scrollLeft||0)-(L&&L.clientLeft||P&&P.clientLeft||0),s.clientY+(L&&L.scrollTop||P&&P.scrollTop||0)-(L&&L.clientTop||P&&P.clientTop||0))}}function w(s){if(j(s,l))if(C=p(s)){var L=v(s);l.style.cursor="move";k(s,true);S=L.x;M=L.y;x=f(S,M);n.triggerCustom("pointerDown",h("mouse",s),x,e(x,i(l)))}}
function A(s){var L=v(s);G=L.x;R=L.y;if(j(s,l))y(s,C?"pointerMove":"pointerHover")}function E(s){if(C&&p(s)){C=false;if(j(s,l)){l.style.cursor="default";y(s,"pointerUp")}}}function K(s){if(j(s,l)){var L;s=s||window.event;if(s.detail){if(typeof s.axis=="undefined"||s.axis===2)L=-s.detail*B}else{L=s.wheelDeltaY?s.wheelDeltaY:s.wheelDelta;if(window.opera)L=-L}if(L){var P=f(G,R);n.triggerCustom("zoom",h("mouse",s),P,e(P,i(l)),L/u,"wheel");k(s);s.returnValue=false}}}function p(s){s=s||window.event;return(s.which||
s.button)==1}function y(s,L,P,da,la){P=typeof P!="undefined"?P:G;da=typeof da!="undefined"?da:R;var z=P-S,F=da-M,I=f(P,da);n.triggerCustom(L,h("mouse",s),I,e(I,i(l)),f(z,F));if(typeof la=="undefined"||la){S=P;M=da}}o=D({},o);var B=120,u=B*8,C=false,x,G,R,S,M;o.binder("mousedown",w);o.binder("mousemove",A);o.binder("mouseup",E);o.binder("dblclick",function(s){ta("captured double click");if(j(s,l)){var L=v(s);n.triggerCustom("doubleTap",h("mouse",s),L,e(L,i(l)))}});o.binder("mousewheel",K);o.binder("DOMMouseScroll",
K);return{unbind:function(){o.unbinder("mousedown",w);o.unbinder("mousemove",A);o.unbinder("mouseup",E);o.unbinder("mousewheel",K);o.unbinder("DOMMouseScroll",K)}}},checks:{touch:false}});g("pointer",{handler:function(l,n,o){function v(z){if(z.count<2)return 0;var F=z.x-z.next.x;z=z.y-z.next.y;return~~Math.sqrt(F*F+z*z)}function w(z,F,I){F=F?F:0;I=I?I:0;for(var O={x:z.x-F,y:z.y-I,id:z.id,count:z.count},Q=O;z.next;){z=z.next;Q=Q.next={x:z.x-F,y:z.y-I,id:z.id}}return O}function A(z,F){var I=z[F?F:"touches"],
O,Q;if(I.length===0)return null;Q=O={x:I[0].pageX,y:I[0].pageY,id:I[0].identifier,count:I.length};for(var $=1,Ea=I.length;$<Ea;$++)Q=Q.next={x:I[$].pageX,y:I[$].pageY,id:I[$].identifier};return O}function E(z){if(j(z,l)){R=i(l);var F=A(z,"changedTouches"),I=w(F,R.left,R.top);if(!M){S=C;n.triggerCustom("pointerDown",h("touch",z),F,I)}da&&n.triggerCustom("pointerDownMulti",h("touch",z),F,I);M=A(z);if(M.count>1)L=v(M);la=1;P=w(M)}}function K(z){if(j(z,l)){k(z);s=A(z);if(S==C)S=Math.abs(M.x-s.x)>B||Math.abs(M.y-
s.y)>B?u:C;if(S!=C){S=s.count>1?G:x;if(S==G)if(M.count===1){M=w(s);L=v(M)}else{var F=v(s);if(Math.abs(L-F)<y)S=x;else{var I;I=s.x;var O=s.next.x,Q=s.y,$=s.next.y;I={x:(I<O?I:O)+(Math.abs(I-O)>>1),y:(Q<$?Q:$)+(Math.abs(Q-$)>>1)};F=F/L;O=F-la;n.triggerCustom("zoom",h("touch",z),I,e(I,R),O,"pinch");la=F}}S==x&&n.triggerCustom("pointerMove",h("touch",z),s,w(s,R.left,R.top),f(s.x-P.x,s.y-P.y));da&&n.triggerCustom("pointerMoveMulti",h("touch",z),s,w(s,R.left,R.top))}P=w(s)}}function p(z){if(j(z,l)){var F=
A(z,"changedTouches"),I=w(F,R.left,R.top);s=A(z);if(!s){n.triggerCustom("pointerUp",h("touch",z),F,I);M=null}da&&n.triggerCustom("pointerUpMulti",h("touch",z),F,I)}}o=D({detailed:false,inertia:false},o);var y=20,B=7,u=0,C=1,x=2,G=3,R,S,M,s,L,P,da=o.detailed,la=1;o.binder("touchstart",E);o.binder("touchmove",K);o.binder("touchend",p);ta("initialized touch handler");return{unbind:function(){o.unbinder("touchstart",E);o.unbinder("touchmove",K);o.unbinder("touchend",p)}}},checks:{touch:true}});return{register:g,
watch:function(l,n,o){n=D({bindTarget:null,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},n);capabilities=D({touch:"ontouchstart"in window},o);if(!n.observable){ta("creating observable");n.observable=va({});globalOpts=n}n.binder=(n.isIE?b:a)(n.bindTarget||document);n.unbinder=(n.isIE?b:c)(n.bindTarget||document);o=n.types;for(var v=capabilities,w=[],A=d.length;A--;){var E=d[A],K=!o||o.indexOf(E.type)>=0,p=true,y;for(y in E.checks){var B=E.checks[y];ta("checking "+y+" capability. require: "+
B+", capability = "+v[y]);p=p&&B===v[y]}if(K&&p)w[w.length]=E.handler}return new m(l,w,n)}}}();var fa=va({}),Za=function(){var a={};return{create:function(c,b){if(a[c][b])return a[c][b].apply(null,Array.prototype.slice.call(arguments,2));throw Qb(c,b);},get:function(c,b){return a[c]?a[c][b]:null},register:function(c,b,f){a[c]||(a[c]={});a[c][b]&&ta(Rb(c,b),"warn");a[c][b]=f}}}(),Rb=za("Registration of {0}: {1} will override existing definition"),Qb=za("Could not create {0} of type: {1}");za("Could not create drawable of type: {0}");
var jb=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],Z=Math.PI*2,Ua=Math.PI/2,aa=Math.PI/180,ma=180/Math.PI,gb=90,Ob=-gb,Ya=180,yb=-Ya,kb=gb*aa,Ab=-kb,Bb=Ya*aa,Sb=-Bb,Ta=0.08181919084262157,na=Math.abs,Cb=Math.ceil,La=Math.round,Ma=Math.min,Da=Math.max,Aa=Math.pow,lb=Math.sqrt,Ba=Math.log,ka=Math.sin,Db=Math.asin,Fa=Math.cos,ub=Math.atan,Tb=Math.atan2,wa="undefined",oa="string",Ub="object",pa="number",xb="array",ba=Za.register,xa=Za.create,Vb=Za.get,Wb=
0,Nb=0,fb=/[\,\s]+/,Ga=function(){function a(h){g++;h=h||(new Date).getTime();for(var j=f.length;j--;){var e=f[j];g%e.every===0&&e.cb(h)}i&&animFrame(a)}var c=1E3/60,b=["r","webkitR","mozR","oR","msR"],f=[],g=0,i=function(){for(var h=0;h<b.length;h++)window.animFrame=window.animFrame||window[b[h]+"equestAnimationFrame"];return animFrame}();i?animFrame(a):setInterval(a,1E3/60);return{attach:function(h,j){f[f.length]={cb:h,every:j?La(j/c):1}},detach:function(h){for(var j=f.length;j--;)if(f[j].cb===
h){f.splice(j,1);break}}}}(),Mb=function(){var a=/^xy\((.*)\).*$/i;return{parseXY:function(c){if(!a.test(c)){c=c.split(fb);return $a(c[1],c[0])}}}}(),X=function(){function a(g){for(var i=0;i<g.length;i++){var h=g[i];if(typeof document.body.style[h]!="undefined")return h}}var c={"-webkit-user-select":"none",position:"absolute"},b,f;b=a(["-webkit-transform","MozTransform"]);css3DTransformProp=a(["WebkitPerspective","MozPerspective"]);f=a(["-webkit-transform-origin","MozTransformOrigin"]);return{transforms:N(b,
oa),create:function(g,i,h){g=document.createElement(g);var j=[];h=h||{};g.className=i||"";for(var e in h)j[j.length]=e+": "+h[e];g.style.cssText=j.join(";");return g},move:function(g,i,h,j,e){if(b){g.style[b]="translate("+i+"px, "+h+"px) "+(j||[]).join(" ");if(e&&f)g.style[f]=e.x+"px "+e.y+"px"}else{g.style.left=i+"px";g.style.top=h+"px"}},styles:function(g){return D({},c,g)}}}(),Eb=function(){function a(){for(var g=f.length,i=g;i--;)try{f[i](g)}catch(h){ta(h.toString(),"error")}}var c=20,b=50,f=
[];return{process:function(g,i,h,j){function e(m){m=(k||b)/m;if(d<g.length){var l=g.slice(d,d+m);m=l.length;var n=k?0:(new Date).getTime();i(l,m);if(!k){k=(l=((new Date).getTime()-n)/m)?c/l|0:g.length;ta("calculated that we can process "+k+" items per cycle")}d+=m}else{for(m=f.length;m--;)if(f[m]===e){f.splice(m,1);break}f.length===0&&Ga.detach(a);h&&h()}}var k,d=0;if(g.length>(j||0))f.push(e)===1&&Ga.attach(a);else{i(g,g.length);h&&h()}}}}(),$a=$a||function(a,c){var b=parseFloat(c)*aa;b=ka(b);var f=
Ta*b;b=Ba((1+b)/(1-b)*Aa((1-f)/(1+f),Ta))/2;return new ia(0,0,parseFloat(a)*aa,b)},mb=mb||function(a,c){for(var b=Aa(Math.E,-c),f=Ua-2*ub(b),g=tb(f,b),i=0;i<12&&na(f-g)>1.0E-7;){f=g;g=tb(f,b);i++}return new ja(g*ma,a%360*ma)};T.prototype={constructor:T,add:function(){for(var a=this.x,c=this.y,b=arguments.length;b--;){a+=arguments[b].x;c+=arguments[b].y}return this.copy(a,c)},copy:function(a,c){var b=D({},this);b.x=a||b.x;b.y=c||b.y;return b},equals:function(a){return this.x===a.x&&this.y===a.y},offset:function(a,
c){return this.copy(this.x+a,this.y+c)},relative:function(a){a=a.viewport();return this.copy(this.x-a.x-a.padding.x,this.y-a.y-a.padding.y)},rotate:function(a,c){c=c||new T(0,0);var b=this.x-c.x,f=this.y-c.y;return new T(c.x+Fa(a)*b+-ka(a)*f,c.y+ka(a)*b+Fa(a)*f)},scale:function(a,c){c=c||new T(0,0);return new T(c.x+(this.x-c.x)*a,c.y+(this.y-c.y)*a)},sync:function(){return this},toString:function(){return this.x+", "+this.y}};Ja.prototype=D([],{cull:function(a){if(this.allowCull){var c=a.x,b=a.y,
f=a.x+a.w;a=a.y+a.h;for(var g=Infinity,i=0,h,j=this.length;j--;)if(h=this[j].x>=c&&this[j].x<=f&&this[j].y>=b&&this[j].y<=a){g=j<g?j:g;i=j>i?j:i}return this.slice(Da(g-1,0),Ma(i+1,this.length))}return this},simplify:function(a){a=a||3;for(var c=new Ja,b=null,f=this.length;f--;){var g=this[f];if(include=!b||f===0||na(g.x-b.x)+na(g.y-b.y)>a){c.unshift(g);b=g}}return c}});ia.prototype=D(new T,{constructor:ia,pos:function(){return mb(this.mercX,this.mercY)},sync:function(a,c){var b;if(!(b=a.rpp)){b=a.zoom();
b=Z/(256<<b)}b=b;if(c){this.mercX=this.x*b-Math.PI;this.mercY=Math.PI-this.y*b}else{this.x=La(((this.mercX||0)+Math.PI)/b);this.y=La((Math.PI-(this.mercY||0))/b)}return this}});ua.prototype={constructor:ua,buffer:function(a,c){return new ua(this.x-a,this.y-(c||a),this.w+a*2,this.h+(c||a)*2)},center:function(){return new T(this.x+(this.w>>1),this.y+(this.h>>1))}};Hits=function(){return{diffHits:function(a,c){var b=[],f={},g;for(g=c.length;g--;)f[c[g].target.id]=true;for(g=a.length;g--;)f[a[g].target.id]||
(b[b.length]=a[g]);return b},init:function(a,c,b,f,g){return{type:a,x:g.x,y:g.y,gridX:f.x|0,gridY:f.y|0,elements:[],absXY:c,relXY:b}},initHit:function(a,c,b){return{type:a,target:c,drag:b}},triggerEvent:function(a,c,b,f){c.triggerCustom(a.type+(b?b:"Hit"),{hitType:a.type},f?f:a.elements,a.absXY,a.relXY,new ia(a.gridX,a.gridY))}}}();var wb=function(a){function c(i,h){var j=b[i],e;j||(j=b[i]=[]);(e=j[h])||(e=j[h]=[]);return e}a=a||128;var b=[],f={},g=0;return{copyInto:function(i){for(var h in f){var j=
f[h];i.insert(j.bounds||j,j,h)}},insert:function(i,h,j){var e=i.x/a|0,k=i.y/a|0,d=(i.x+i.w)/a|0;i=(i.y+i.h)/a|0;j=j||h.id||"obj_"+g++;f[j]=h;for(h=e;h<=d;h++)for(e=k;e<=i;e++)c(h,e).push(j)},remove:function(i,h,j){j=j||h.id;if(f[j]){var e=i.x/a|0;h=i.y/a|0;var k=(i.x+i.w)/a|0;i=(i.y+i.h)/a|0;delete f[j];for(e=e;e<=k;e++)for(var d=h;d<=i;d++){var m=c(e,d),l=ib.call(m,j);l>=0&&m.splice(l,1)}}},search:function(i,h){for(var j=i.y/a|0,e=(i.x+i.w)/a|0,k=(i.y+i.h)/a|0,d=[],m=[],l=i.x/a|0;l<=e;l++)for(var n=
j;n<=k;n++)d=d.concat(c(l,n));d.sort();for(j=d.length;j--;){e=d[j];if(k=f[e])m[m.length]=k;for(;j>0&&d[j-1]==e;)j--}h&&m.sort(function(o,v){return v[h]-o[h]});return m}}},ab=function(){var a={},c=0;(new Date).getTime();var b={},f=[];Ga.attach(function(g){g=g||(new Date).getTime();for(var i=0;i<f.length;){var h=f[i],j=b[h],e=b[h].image&&b[h].image.complete&&b[h].image.width>0,k=g-j.start;k=e||k>=3E4;if(e){e=j.callbacks;a[h]=j.image;for(var d=0;d<e.length;d++)e[d](j.image,true)}if(k){f.splice(i,1);
delete b[h]}else i++}},250);return function(g,i){var h=g&&i?a[g]:null;if(h&&h&&h.complete&&h.width>0)i(h);else if(h=b[g])h.callbacks.push(i);else{h=new Image;h.id="_ldimg"+ ++c;b[g]={start:(new Date).getTime(),image:h,callbacks:[i]};h.src=g;f[f.length]=g}}}();Va.prototype={constructor:Va,load:function(a){var c=this;ab(this.url,function(b){c.loaded=true;c.image=b;a&&a()})}};var Xb=function(){return va({fastpan:true,applyStyle:function(){},applyTransform:function(a,c,b){return{restore:null,x:c,y:b}},
getDimensions:function(){return{width:0,height:0}},getViewport:function(){},hitTest:function(){return false},prepare:function(){},projectXY:null,reset:function(){}})};ba("renderer","canvas",function(a,c,b,f,g){function i(p,y,B){var u,C;n[y]=function(x){for(u=E.length;u--;)if(C=B[E[u]])x[K[u]]=C}}function h(p,y,B){return{draw:B||A,viewport:p,hit:y&&d.isPointInPath(y.x,y.y),vpX:m,vpY:l,context:d}}f=D({},f);var j,e,k,d,m=0,l=0,n={},o=null,v={},w=function(){},A=function(){this.fill&&d.fill();this.stroke&&
d.stroke()},E=["fill","stroke","lineWidth","opacity"],K=["fillStyle","strokeStyle","lineWidth","globalAlpha"];(function(){function p(u,C){this.save();this.setTransform(1,0,0,1,0,0);var x=this.isPointInPath_old(u,C);this.restore();return x}var y=CanvasRenderingContext2D.prototype,B=document.createElement("canvas").getContext("2d");B.translate(50,0);B.moveTo(125,50);B.arc(100,50,25,0,360,false);if(!B.isPointInPath(150,50)){y.isPointInPath_old=y.isPointInPath;y.isPointInPath=p}})();if(c){j=c.offsetWidth;
e=c.offsetHeight;k=X.create("canvas",null,{position:"absolute","z-index":1});k.width=j;k.height=e;a.attachFrame(k,true);d=null}b=D(g,{applyStyle:function(p){var y=n[p],B=d&&d.canvas?d.canvas.id:"default",u;v[B]||(v[B]=[]);u=v[B].pop()||"reset";if(y){v[B].push(p);y(d);return u}},applyTransform:function(p){if(p.translateX!==0||p.translateY!==0||p.scaling!==1||p.rotation!==0){d.save();o={undo:function(){d.restore();o=null},x:p.xy.x,y:p.xy.y};d.translate(p.xy.x-m+p.translateX,p.xy.y-l+p.translateY);p.rotation!==
0&&d.rotate(p.rotation);p.scaling!==1&&d.scale(p.scaling,p.scaling)}return o},drawTiles:function(p,y,B){for(var u=y.length;u--;){p=y[u];if(!p.loaded&&B)p.load(a.invalidate);else p.image&&d.drawImage(p.image,p.x-m,p.y-l)}},prepare:function(p,y){var B,u=false;if(d)d.restore();else d=k.getContext("2d");for(B=p.length;B--;)u=u||p[B].clip;m=y.x;l=y.y;if(d){u||d.clearRect(0,0,j,e);d.save()}d.globalCompositeOperation="source-over";return d},prepArc:function(p,y,B){d.beginPath();d.arc(p.xy.x-(o?o.x:m),p.xy.y-
(o?o.y:l),p.size>>1,p.startAngle,p.endAngle,false);return h(y,B)},prepImage:function(p,y,B,u){var C=(u.x||p.xy.x)-(o?o.x:m),x=(u.y||p.xy.y)-(o?o.y:l),G=u.image||p.image;if(G){d.beginPath();d.rect(C,x,u.width||G.width,u.height||G.height);return h(y,B,function(){d.drawImage(G,C,x,u.width||G.width,u.height||G.height)})}},prepMarker:function(p,y,B){var u=p.xy.x-(o?o.x:m),C=p.xy.y-(o?o.y:l),x=p.size,G=undefined;d.beginPath();switch(p.markerType.toLowerCase()){case "image":G=w;d.rect(u-(x>>1),C-(x>>1),
x,x);if(p.reset&&p.image){p.image=null;p.reset=false}p.image?d.drawImage(p.image,u-(x>>1),C-(x>>1),x,x):ab(p.imageUrl,function(R){p.image=R;d.drawImage(p.image,u-(x>>1),C-(x>>1),x,x)});break;default:d.moveTo(u,C);d.lineTo(u-(x>>1),C-x);d.lineTo(u+(x>>1),C-x);d.lineTo(u,C)}return h(y,B,G)},prepPoly:function(p,y,B,u){var C=true;p=u.points||p.points().cull(y);u=o?o.x:m;var x=o?o.y:l;d.beginPath();for(var G=p.length;G--;){var R=p[G].x-u,S=p[G].y-x;if(C){d.moveTo(R,S);C=false}else d.lineTo(R,S)}return h(y,
B)},getContext:function(){return d}});(function(){Fb.each(function(p,y){i(null,p,y)});fa.bind("styleDefined",i)})();b.bind("detach",function(){c.removeChild(k)});b.bind("resize",function(){});return b});ba("renderer","dom",function(a,c,b,f,g){function i(d){var m=d.image=new Image;e[d.id]=d;m.src=d.url;m.onload=function(){if(k[d.id])j.appendChild(this);else d.image=null};m.style.cssText="-webkit-user-select: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute;";
return m}function h(d,m,l){var n=[],o;for(o in d){var v=d[o];if(l?v[l]:!m[o]){if(v.image&&v.image.parentNode){j.removeChild(v.image);v.image=null}n[n.length]=o}}for(m=n.length;m--;)delete d[n[m]]}var j=null,e={},k={};j=X.create("div","",X.styles({width:c.offsetWidth+"px",height:c.offsetHeight+"px"}));c.childNodes.length>0?c.insertBefore(j,c.childNodes[0]):c.appendChild(j);a.attachFrame(j);b=D(g,{drawTiles:function(d,m,l){for(var n,o=d.x,v=d.y,w=m.length;w--;){d=m[w];if(d.url){(n=d.image||(l?i(d):
null))&&X.move(n,d.x-o,d.y-v);k[d.id]=d}}}});b.bind("predraw",function(){h(e,k);k={}});b.bind("detach",function(){c.removeChild(j)});a.bind("reset",function(){for(h(e,k={});j.childNodes.length>0;)j.removeChild(j.childNodes[0])});return b});var Fb=function(){function a(b,f){if(N(b,oa)){fa.trigger("styleDefined",b,c[b]=f);return b}else{var g=[],i;for(i in b)g[g.length]=a(i,b[i]);return g}}var c={};a({reset:{fill:"#ffffff",opacity:1},highlight:{fill:"#ff0000"},waypoints:{lineWidth:4,stroke:"#003377",
fill:"#ffffff"},waypointsHover:{lineWidth:4,stroke:"#ff0000",fill:"#ffffff"}});return{resetStyle:"reset",each:function(b){for(var f in c)b(f,c[f])},get:function(b){return c[b]},define:a}}();ba("view","view",function(a){function c(q,r,t,H){p(Da(U+Aa(2,H)-1,0.125),false,true)}function b(q,r){var t=V&&V.projectXY?V.projectXY(q,r):null;if(!t){t=A();var H=1/U;t=new J.XY(t?t.x+q*H:q,t?t.y+r*H:r)}return t.sync(J,true)}function f(q,r,t){y("doubleTap",r,t,b(t.x,t.y));a.scalable&&p(2,{easing:"quad.out",duration:300},
true)}function g(q,r,t){s=null;la=true;v("down",r,t)}function i(q,r,t){v("hover",r,t)}function h(q,r,t,H){l(r,t,false);if(!s){z=H.x;F=H.y}}function j(q,r,t){l(r,t,true);la=false}function e(){clearTimeout(Gb);Gb=setTimeout(function(){if(M)if(M.offsetWidth!==Na*2||M.offsetHeight!==Oa*2){var q=w();o(a.container);w(q.x,q.y)}},250)}function k(q,r,t){v("tap",r,t);J.trigger("tap",r,t,b(t.x,t.y,true))}function d(){ga&&ga.unbind();if(V){ga=INTERACT.watch(V.interactTarget||M);if(a.scalable){ga.bind("zoom",
c);ga.bind("doubleTap",f)}ga.bind("pointerDown",g);ga.bind("pointerMove",h);ga.bind("pointerUp",j);a.captureHover&&ga.bind("pointerHover",i);ga.bind("tap",k)}}function m(q){if(V){V.trigger("detach");V=null}var r=J,t=R,H=M,W=a;q=q.split("/");for(var Y=new Xb(r,t,H,W),qa=0;qa<q.length;qa++)Y=xa("renderer",q[qa],r,t,H,W,Y);V=Y;da=V.fastpan&&X.transforms;d();J.trigger("reset");K()}function l(q,r,t){if(s){q=b(r.x,r.y);s.drag.call(s.target,s,q.x,q.y,t)&&ca++;if(t)s=null}}function n(q){for(var r=G;r--;)if(x[r].id===
q)return r;return G}function o(q){M=document.getElementById(q);M.appendChild(S=X.create("div","",X.styles({overflow:"hidden",width:M.offsetWidth+"px",height:M.offsetHeight+"px"})));q=a.padding;if(q===u){q=M.offsetWidth;var r=M.offsetHeight,t=lb(q*q+r*r);ha=new T(t-q>>1,t-r>>1)}else ha=new T(q,q);bb=S.offsetWidth+ha.x*2;cb=S.offsetHeight+ha.y*2;nb=bb/2;ob=cb/2;Na=M.offsetWidth/2;Oa=M.offsetHeight/2;Pa=new T(nb,ob);S.appendChild(R=X.create("div","",X.styles({width:bb+"px",height:cb+"px","z-index":2,
margin:-ha.y+"px 0 0 "+-ha.x+"px"})));m(a.renderer);q=a.controls;for(r=0;r<C.length;r++)C[r].trigger("detach");C=[];for(r=0;r<q.length;r++)C[C.length]=xa("control",q[r],J,S,M,a[q[r]])}function v(q,r,t){var H=(new T(t.x-Na+nb,t.y-Oa+ob)).rotate(-ra*aa,Pa).scale(1/U,Pa);ea=Hits.init(q,r,t,b(t.x,t.y,true),H);for(q=G;q--;)if(x[q].visible)P=P||(x[q].hitGuess?x[q].hitGuess(ea.gridX,ea.gridY,J):false);P&&ca++}function w(q,r,t){if(N(q,oa)||N(q,Ub)){r=new J.XY(q);r.sync(J);q=r.x;r=r.y}if(N(q,pa)){B(q-Na-ha.x,
r-Oa-ha.y,t);return J}else return B().offset(Na+ha.x|0,Oa+ha.y|0).sync(J,true)}function A(){var q=new ua(O,Q,bb,cb);q.scaleFactor=U;q.padding=ha?ha.copy():new T;return q}function E(q,r,t){if(N(q,oa)&&N(r,wa))for(r=0;r<G;r++){if(x[r].id===q)return x[r]}else if(N(q,oa)){r=xa("layer",r,J,t);r.added=(new Date).getTime();r.id=q;x[n(q)]=r;x.sort(function(H,W){return W.zindex-H.zindex||W.added-H.added});G=x.length;J.trigger("resync");K();J.trigger("layerChange",J,r);ca++;return r}else return[].concat(x)}
function K(){var q=A();if(q){if(Ha||Ia)if(q){var r=db?O+(q.w>>1):O,t=eb?Q+(q.h>>1):Q,H=q.w,W=q.h;if(Ha&&Ha>H)if(r+H>Ha)O=db?O:Ha-H;else if(r<0)O=db?O:0;if(Ia&&Ia>W)if(t+W>Ia)Q=eb?Q:Ia-W;else if(t<0)Q=eb?Q:0}Hb=O;Ib=Q;J.trigger("refresh",J,q);ca++}}function p(q,r,t){if(N(q,pa)){var H=t?q:U*q;if(!Yb){r=null;q=La(Ba(H)/Math.LN2);H=Aa(2,q)}if(r)Qa=sa.tween([U],[H],r,function(){U=H;Qa=null;ca++});else{U=H;ca++}return J}else return U}function y(){for(var q=J.trigger.apply(null,arguments).cancel,r=x.length;r--;)q=
x[r].trigger.apply(null,arguments).cancel||q;return!q}function B(q,r,t){if(N(q,pa)){if(t)ya=sa.tween([O,Q],[q,r],t,function(){ya=null});else{O=q|0;Q=r|0;ca++}return J}else return(new J.XY(O,Q)).sync(J,true)}a=D({container:"",captureHover:true,controls:[],drawOnScale:true,padding:128,inertia:true,refreshDistance:256,pannable:true,scalable:true,renderer:"canvas"},a);var u="auto",C=[],x=[],G=0,R=null,S=null,M,s=null,L=!N(window.attachEvent,wa),P=false,da,la=false,z=0,F=0,I=a.refreshDistance,O=0,Q=0,
$=0,Ea=0,Hb=0,Ib=0,Ha=null,Ia=null,db=false,eb=false,ya=null,ha,ea=null,Ra=null,V,Gb=0,Pa=new T,ra=0,Sa=null,U=1,Qa=null,pb=1,ga=null,qb={index:0,draw:false},Yb=true,ca=0,bb,cb,nb,ob,Na,Oa,J={XY:T,id:a.id,panSpeed:0,attachFrame:function(q,r){r&&R.appendChild(q)},center:w,detach:function(){V&&V.trigger("detach");ga&&ga.unbind();if(S){M.removeChild(S);R=S=null}},layer:E,invalidate:function(){ca++},pan:function(q,r,t){B(O+q,Q+r,t)},refresh:K,rotate:function(q,r,t){if(N(q,pa)){var H=t?q:ra+q;if(r)Sa=
sa.tween([ra],[H],r,function(){ra=H%360;Sa=null;ca++});else{ra=H%360;ca++}return J}else return ra},scale:p,triggerAll:y,setMaxOffset:function(q,r,t,H){Ha=q;Ia=r;db=t;eb=H},offset:B,viewport:A};va(J);J.bind("resize",e);J.bind("layerRemove",function(q,r){var t=ib(x,r.id);if(t>=0&&t<G){x.splice(t,1);ca++}G=x.length});zb(J,a,{container:o,captureHover:d,scalable:d,pannable:d,renderer:m});E("markers","draw",{zindex:20});o(a.container);L?window.attachEvent("onresize",e):window.addEventListener("resize",
e,false);Ga.attach(function(q){var r=[],t,H,W;self.panSpeed=panSpeed=na(z)+na(F);t=U!==pb;if(panSpeed>0||t||ya||Qa||Sa){ca++;if(ya&&panSpeed>0){ya(true);ya=null}}if(panSpeed<2&&(na(O-Hb)>=I||na(Q-Ib)>=I))K();qb.index++;qb.draw=ca||panSpeed||0;if(V&&qb.draw){if(Qa)U=Qa()[0];if(Sa)ra=Sa()[0];$+=z;Ea+=F;if(z||F)J.trigger("pan");if(X.transforms){if(U!==1)r[r.length]="scale("+U+")";if(ra!==0)r[r.length]="rotate("+ra+"deg)"}if(t=!da||(a.drawOnScale||U===1)&&panSpeed<5){if(ya){t=ya();O=t[0]|0;Q=t[1]|0}else{O=
O-$/U|0;Q=Q-Ea/U|0}W=A();V.trigger("predraw",W);if(V.prepare(x,W,q,ea)){H=Ea=t=$=ca=0;for(ii=G;ii--;){var Y=x[ii];if(Y.visible){var qa=Y.style?V.applyStyle(Y.style,true):null;Y.draw(V,W,J,q,ea);qa&&V.applyStyle(qa)}}V.trigger("render",W);J.trigger("drawComplete",W,q);X.move(R,t,H,r,Pa)}}else X.move(R,$,Ea,r,Pa);if(la||!a.inertia)F=z=0;else if(z!=0||F!=0){z*=0.8;F*=0.8;if(na(z)<0.5)z=0;if(na(F)<0.5)F=0}if(ea){q=true;r=ea?ea.elements:[];if(Ra&&Ra.type==="hover"){diffElements=Hits.diffHits(Ra.elements,
r);if(diffElements.length>0)Hits.triggerEvent(Ra,J,"Out",diffElements);else q=false}if(r.length>0){H=ea.gridX;W=ea.gridY;for(t=r.length;t--;){Y=r[t];qa=H;var Jb=W,Kb=Y&&Y.drag&&(!Y.canDrag||Y.canDrag(Y,qa,Jb));if(Kb){s=Y;s.startX=qa;s.startY=Jb}if(Kb)break}q&&Hits.triggerEvent(ea,J)}Ra=r.length>0?D({},ea):null;ea=null}if(pb!==U){J.trigger("scaleChanged",U);pb=U}}});return J});ba("view","map",function(a){function c(e,k){var d=j.viewport();if(e){d=Da(e.bestZoomLevel(d),k||0);return b(d).center(e.center())}else return new Ka((new ia(d.x,
d.y2)).sync(j,true).pos(),(new ia(d.x2,d.y)).sync(j,true).pos())}function b(e,k,d){if(N(e,pa)){e=Da(a.minZoom,Ma(a.maxZoom,e|0));if(e!==i){var m=j.viewport(),l=j.offset(),n=m.w/2;m=m.h/2;var o=Aa(2,e-i),v=n/o|0,w=m/o|0;i=e;j.offset(((k||l.x+n)-v)*o,((d||l.y+m)-w)*o);refreshY=refreshX=0;j.trigger("zoom",e);j.trigger("reset");g=j.rpp=Z/(256<<i);j.setMaxOffset(Z/g|0,Z/g|0,true,false);j.scale(1,false,true);j.trigger("resync");j.refresh()}return j}else return i}a=D({controls:["zoombar"],minZoom:1,maxZoom:18,
renderer:"canvas/dom",zoom:1,zoombar:{}},a);var f=new ia,g,i=a.zoom||a.zoomLevel,h=0,j=D(xa("view","view",a),{XY:ia,bounds:c,zoom:b});j.bind("refresh",function(){var e=j.viewport();if(f.x!=e.x||f.y!=e.y){j.trigger("boundsChange",c());f.x=e.x;f.y=e.y}});j.bind("scaleChanged",function(e,k){var d=Ba(k)/Math.LN2|0;if(d!==0){k=Aa(2,d);clearTimeout(h);h=setTimeout(function(){b(i+d)},500)}});return j});var sa=function(){return{tween:function(a,c,b,f,g){function i(o){var v=o-n;o=n+l<=o;for(var w=h;w--;){j[w]=
k(v,a[w],d[w],l);g&&g.invalidate()}if(o||m){Ga.detach(i);for(w=0;w<e.length;w++)e[w]&&e[w](j,v,m)}}b=D({easing:"sine.out",duration:1E3,complete:null},b);var h=a.length,j=[].concat(a),e=[f,b.complete],k=Pb(b.easing),d=[],m=false,l=b.duration,n=(new Date).getTime();for(b=h;b--;)d[b]=c[b]-a[b];Ga.attach(i);return function(o){m=o;return j}},tweenDrawable:function(a,c,b,f,g){var i=sa.tween([b],[f],g,function(){a[c]=f;for(var j=a.tweens.length;j--;)if(a.tweens[j]===h){a.tweens.splice(j,1);break}},a.view),
h=function(){a[c]=i()[0]};return h}}}(),Ca=function(a,c,b){b=D({style:null,xy:null,size:20,fill:false,stroke:true,draggable:false,observable:true,properties:{},typeName:"Shape",zindex:0},b);D(this,b);if(N(this.xy,oa))this.xy=new a.XY(this.xy);this.id="drawable_"+Wb++;this.bounds=null;this.view=a;this.layer=c;this.tweens=[];this.rotation=this.animations=0;this.scaling=1;this.translateY=this.translateX=0;this.observable&&va(this)};Ca.prototype={constructor:Ca,applyTweens:function(){for(var a=this.tweens.length;a--;)this.tweens[a]()},
drag:null,draw:null,getProps:null,resync:function(){if(this.xy){this.xy.sync(this.view);if(this.size){var a=this.size>>1;this.updateBounds(new ua(this.xy.x-a,this.xy.y-a,this.size,this.size))}}},rotate:function(a,c,b){if(N(a,pa)){a=(b?a:this.rotation*ma+a)*aa;if(c)this.tweens.push(sa.tweenDrawable(this,"rotation",this.rotation,a,c));else{this.rotation=a;this.view.invalidate()}return this}else return this.rotation*ma},scale:function(a,c,b){if(N(a,pa)){a=b?a:this.scaling*a;if(c)this.tweens.push(sa.tweenDrawable(this,
"scaling",this.scaling,a,c));else{this.scaling=a;this.view.invalidate()}return this}else return this.scaling},translate:function(a,c,b,f){if(N(a,pa)){a=f?a:this.translateX+a;c=f?c:this.translateY+c;if(b){this.tweens.push(sa.tweenDrawable(this,"translateX",this.translateX,a,b));this.tweens.push(sa.tweenDrawable(this,"translateY",this.translateY,c,b))}else{this.translateX=a;this.translateY=c;this.view.invalidate()}return this}else return new T(this.translateX,this.translateY)},updateBounds:function(a,
c){a&&(!this.bounds||a.x!=this.bounds.x||a.y!=this.bounds.y)&&this.trigger("move",this,a,this.bounds);this.bounds=a;if(c)this.xy=this.bounds.center()}};ba("drawable","marker",function(a,c,b){b=D({fill:true,stroke:false,markerType:"simple",hoverStyle:"highlight",typeName:"Marker"},b);return new Ca(a,c,b)});ba("drawable","poly",function(a,c,b){function f(){var d,m,l,n,o,v,w;e=b.simplify?j.simplify():j;for(d=e.length;d--;){m=e[d].x;l=e[d].y;v=N(v,wa)||m<v?m:v;w=N(w,wa)||l<w?l:w;n=N(n,wa)||m>n?m:n;o=
N(o,wa)||l>o?l:o}k.updateBounds(new ua(v,w,n-v,o-w),true)}function g(d){if(N(d,xb)){j=new Ja(b.allowCull);Eb.process(d,function(m,l){for(var n=0;n<l;n++)j.push(new a.XY(m[n]))},i,h);return k}else return e}function i(){j.length&&Eb.process(j,function(d,m){for(var l=m;l--;)d[l].sync(a)},f,h)}b=D({allowCull:false,simplify:false,fill:true,points:[],typeName:"Poly"},b);var h=500,j=new Ja(b.allowCull),e,k=D(new Ca(a,c,b),{points:g,resync:i});g(b.points);return k});ba("drawable","line",function(a,c,b){b.fill=
false;b.allowCull=true;return xa("drawable","poly",a,c,b)});ba("drawable","image",function(a,c,b){function f(){if(e&&e.width>0){if(!this.centerOffset)this.centerOffset=new T(-e.width>>1,-e.height>>1);this.updateBounds(new ua(this.xy.x+this.centerOffset.x,this.xy.y+this.centerOffset.y,e.width,e.height),false)}}function g(d){if(this.imageUrl=d){var m=this;ab(this.imageUrl,function(l,n){e=l;if(n){var o=k.layer?k.layer.view:null;o&&o.invalidate()}f.apply(m)})}}b=D({image:null,imageUrl:null,centerOffset:null,
typeName:"Image"},b);var i=Ca.prototype.resync,h=0,j=0,e=b.image,k=D(new Ca(a,c,b),{changeImage:g,getProps:function(){this.bounds||f(this,e);return{image:e,x:this.xy.x+h,y:this.xy.y+j}},resync:function(d){i.call(this,d);f.call(this)}});e||g.call(this,this.imageUrl);if(this.centerOffset){h=this.centerOffset.x;j=this.centerOffset.y}});ba("drawable","arc",function(a,c,b){b=D({startAngle:0,endAngle:Math.PI*2,typeName:"Arc"},b);return new Ca(a,c,b)});Wa.prototype={constructor:Wa,clip:null,cycle:function(){},
draw:function(){},hitGuess:null,remove:function(){this.view.trigger("layerRemove",this)}};ba("layer","tile",function(a,c){c=D({generator:"osm",imageLoadArgs:{}},c);var b=xa("generator",c.generator,c).run,f=null,g=[],i=D(new Wa(a,c),{draw:function(h,j,e){h.drawTiles&&h.drawTiles(j,f.search(j.buffer(128)),e.panSpeed<2)}});a.bind("resync",function(){var h=a&&a.zoom?a.zoom():0;g[h]||(g[h]=vb(h));f=g[h]});a.bind("refresh",function(h,j,e){f&&b(j,e,f,function(){j.invalidate()})});return i});ba("layer","draw",
function(a,c){function b(k,d,m,l){var n=this.dragOffset;if(!n)n=this.dragOffset=new a.XY(k.startX-this.xy.x,k.startY-this.xy.y);this.xy.x=d-n.x;this.xy.y=m-n.y;if(l){delete this.dragOffset;a.invalidate();this.xy.sync(a,true);this.trigger("dragDrop")}return true}function f(k){clearTimeout(j);j=setTimeout(function(){i.sort(function(d,m){if(m.xy&&d.xy){var l=m.xy.y-d.xy.y;return l!=0?l:m.xy.x-d.xy.x}});k&&k.invalidate()},50)}function g(k,d,m,l){l&&h.remove(l,d);h.insert(m,d)}c=D({zindex:10},c);var i=
[],h,j=0,e=D(new Wa(a,c),{itemCount:0,clear:function(){h=new wb;i=[];e.trigger("cleared");e.itemCount=0;a.invalidate()},create:function(k,d,m){d=xa("drawable",k,a,e,d);if(m)i.unshift(d);else i[i.length]=d;d.resync();h&&d.bounds&&h.insert(d.bounds,d);f(a);d.bind("move",g);e.itemCount=i.length;e.trigger(k+"Added",d);return d},draw:function(k,d,m,l,n){m={};l=h&&d?h.search(d):[];for(var o=l.length;o--;){var v=l[o],w=v.style||e.style,A,E,K=v.getProps?v.getProps(k):m;A=k["prep"+v.typeName];v.tweens.length>
0&&v.applyTweens();E=k.applyTransform(v);if(K=A?A.call(k,v,d,n,K):null){if(n&&K.hit){n.elements.push(Hits.initHit(v.type,v,v.draggable?b:null));A=n.type+"Style";w=v[A]||e[A]||w}w=w?k.applyStyle(w,true):null;(A=v.draw||K.draw)&&A.call(v,K);w&&k.applyStyle(w)}E&&E.undo&&E.undo()}},find:function(){return[].concat(i)},hitGuess:function(k,d){return h&&h.search({x:k-10,y:d-10,w:20,h:20}).length>0}});a.bind("resync",function(){h=vb(a.zoom(),h);for(var k=i.length;k--;)i[k].resync()});return e});Xa.prototype=
{constructor:Xa};ba("control","zoombar",function(a,c,b,f){function g(u,C){var x=K[u]=X.create("div","t5-zoombar-button",{position:"absolute",background:i(u),"z-index":51,width:f.width+"px",height:f.buttonHeight+"px","margin-top":(C||0)+"px"});p.appendChild(x)}function i(u,C){return"url("+f.images+") 0 -"+(m+n*3+(u||0)*k*3+(C||0)*k)+"px"}function h(u){return"url("+f.images+") 0 -"+(m+(u||0)*n)+"px"}function j(u,C){var x;if(u===l){l.style.background=h(C);x="thumb"}else for(var G=0;G<K.length;G++)if(u===
K[G]){x="button"+G;K[G].style.background=i(G,C);break}return x}function e(u){if(u!==A){A=u;w=v-A/E*(v-o)|0;X.move(l,0,w-o);clearTimeout(y);y=setTimeout(function(){a.zoom(A)},500)}}f=D({width:24,height:200,images:"img/zoom.png",align:"right",marginTop:10,spacing:10,thumbHeight:16,buttonHeight:16},f);var k=f.buttonHeight,d,m=f.height,l,n=f.thumbHeight,o=f.spacing+k-(n>>1),v=f.height-k-(n>>1),w=o,A=-1;c=a.minZoom();var E=a.maxZoom()-c+1,K=[],p,y=0,B={button0:function(){a.zoom(a.zoom()+1)},button1:function(){a.zoom(a.zoom()-
1)}};p=X.create("div","t5-zoombar",{position:"absolute",background:"url("+f.images+")","z-index":50,overflow:"hidden",width:f.width+"px",height:f.height+"px",margin:function(){var u=f.spacing,C=za("{0}px 0 0 {1}px");if(f.align==="right")u=b.offsetWidth-f.width-f.spacing;return C(f.marginTop,u)}()});b.childNodes[0]?b.insertBefore(p,b.childNodes[0]):b.appendChild(p);p.appendChild(l=X.create("div","t5-zoombar-thumb",{position:"absolute",background:h(),"z-index":51,width:f.width+"px",height:f.thumbHeight+
"px",margin:"10px 0 0 0",top:w-o+"px"}));g(0);g(1,f.height-f.buttonHeight);d=INTERACT.watch(p,{bindTarget:p});d.bind("pointerMove",function(u,C,x){w=Math.min(Math.max(o,x.y-(n>>1)),v);e(E-(w-o)/v*E|0)});d.bind("pointerDown",function(u){j(u.target,2)});d.bind("pointerUp",function(u){j(u.target,0)});d.bind("tap",function(u){(u=B[j(u.target,2)])&&u()});c=new Xa(a);c.bind("detach",function(){d.unbind();b.removeChild(p)});a.bind("zoom",function(u,C){e(C)});e(a.zoom());return c});ja.prototype={constructor:ja,
distanceTo:function(){if(!targetPos||this.empty()||targetPos.empty())return 0;var a=(targetPos.lat-this.lat)*aa>>1,c=(targetPos.lon-this.lon)*aa>>1;a=ka(a)*ka(a)+Fa(this.lat*aa)*Fa(targetPos.lat*aa)*ka(c)*ka(c);return 6371*2*Tb(lb(a),lb(1-a))},equalTo:function(a){return pos&&this.lat===a.lat&&this.lon===a.lon},empty:function(){return this.lat===0&&this.lon===0},inArray:function(a){for(var c=a.length;c--;)if(this.equal(a[c]))return true;return false},offset:function(a,c){var b=this.lat*aa,f=this.lon*
aa,g=b+a/6371;b=Db(ka(c/6371)/Fa(b));f=f+b;g=(g+Ua)%Math.PI-Ua;f%=Z;return new ja(g*ma,f*ma)},toPixels:function(){return $a(this.lon,this.lat)},toBounds:function(a){var c=a.radians(),b=this.lat*aa,f=this.lon*aa;a=b-c;var g=b+c;if(a>Ab&&g<kb){b=Db(ka(c)/Fa(b));c=f-b;if(c<Sb)c+=Z;f=f+b;if(f>Bb)f-=Z}else{a=Da(a,Ab);g=Ma(g,kb);c=yb;f=Ya}return new Ka(new ja(a*ma,c*ma),new ja(g*ma,f*ma))},toString:function(a){return this.lat+(a||" ")+this.lon}};(function(){ba("fn","generalize",function(a,c,b){var f=a.length,
g=[],i=null;b=(b||250)/1E3;for(f=f;f--;)if(f===0)g.unshift(a[f]);else{var h=!i||a[f].inArray(c)?b:i.distanceTo(a[f]);if(a[f]&&h>=b){g.unshift(a[f]);i=a[f]}}return g})})();Ka.prototype={constructor:Ka,bestZoomLevel:function(a){var c=this.center();c=Ma(La(na(c.lat)*0.05),jb.length);var b=jb[c],f=this.size();c=Cb(Ba(jb[3]*a.h/f.y)/Ba(2));a=Cb(Ba(b*a.w/f.x)/Ba(2));return Ma(isNaN(c)?1E3:c,isNaN(a)?1E3:a)},center:function(){var a=this.size();return new ja(this.min.lat+(a.y>>1),this.min.lon+(a.x>>1))},
expand:function(a){this.min.lat-=a;this.max.lat+=a;this.min.lon-=a%360;this.max.lon+=a%360},size:function(a){var c=new T(0,this.max.lat-this.min.lat);c.x=(a||N(a,wa))&&this.min.lon>this.max.lon?360-this.min.lon+this.max.lon:this.max.lon-this.min.lon;return c},toString:function(){return"min: "+this.min+", max: "+this.max}};hb.prototype={constructor:hb,radians:function(a){if(N(a,pa)){this.meters=a*6371E3;return this}else return this.meters/6371E3},toString:function(){if(this.meters>1E3)return(this.meters/
10|0)/100+"km";return this.meters+"m"}};D(fa,{ex:D,log:ta,observable:va,configurable:zb,formatter:za,wordExists:function(a,c){for(var b=a.split(/\s|\,/).length;b--;)if(a.toLowerCase()==c.toLowerCase())return true;return false},is:N,indexOf:ib,fn:function(a){return Vb("fn",a)},project:$a,unproject:mb,getImage:ab,userMessage:sb,Registry:Za,Style:Fb,DOM:X,Rect:ua,XY:T,Line:Ja,Pos:ja,BBox:Ka,Distance:hb,Hits:Hits,Control:Xa,Tile:Va,Tweener:sa});ba("generator","osm",function(a){a=D({flipY:false,tileSize:256,
tilePath:"{0}/{1}/{2}.png",osmDataAck:true},a);var c=Math.PI/180,b=180/Math.PI,f=null,g=[],i,h=za(a.tilePath),j={buildTileUrl:function(e,k,d,m,l){if(k>=0&&k<m){e=(e%m+m)%m;k=h(d,e,l?Math.abs(k-m+1):k);if(f)k=i(g[e%(g.length||1)])+k;return k}},run:function(e,k,d,m){var l=e.zoom?e.zoom():0;if(l){var n=2<<l-1,o=a.tileSize,v=(k.w/o|0)+1,w=(k.h/o|0)+1;k=(new ia(k.x,k.y)).sync(e,true).pos();var A=k.lat;k=new ia((k.lon+180)/360*n|0,(1-Math.log(Math.tan(A*c)+1/Math.cos(A*c))/Math.PI)/2*n%n|0);A=Math.PI-2*
Math.PI*k.y/n;A=new ja(b*Math.atan(0.5*(Math.exp(A)-Math.exp(-A))),k.x/n*360-180);A=new ia(A);A.sync(e);e=a.flipY;var E=d.search({x:A.x,y:A.y,w:v*o,h:w*o}),K={},p;for(p=E.length;p--;)K[E[p].id]=true;g=(f=j.getServerDetails?j.getServerDetails():null)&&f.subDomains?f.subDomains:[];i=za(f?f.baseUrl:"");for(E=0;E<=v;E++)for(p=0;p<=w;p++){var y=k.x+E,B=k.y+p,u=y+"_"+B;if(!K[u]){tileUrl=j.buildTileUrl(y,B,l,n,e);y=new Va(A.x+E*o,A.y+p*o,tileUrl,o,o,u);d.insert(y,y)}}m&&m()}}};a.osmDataAck&&sb("ack","osm",
'Map data (c) <a href="http://openstreetmap.org/" target="_blank">OpenStreetMap</a> (and) contributors, CC-BY-SA');return j});fa.Cloudmade=function(){fa.Registry.register("generator","osm.cloudmade",function(a){a=fa.ex({apikey:null,styleid:1},a);var c=fa.formatter("http://{3}.tile.cloudmade.com/{0}/{1}/{2}/");fa.userMessage("ack","osm.cloudmade",'This product uses the <a href="http://cloudmade.com/" target="_blank">CloudMade</a> APIs, but is not endorsed or certified by CloudMade.');return fa.ex(fa.Registry.create("generator",
"osm",a),{getServerDetails:function(){return{baseUrl:c(a.apikey,a.styleid,256,"{0}"),subDomains:["a","b","c"]}}})})}();rb.T5=fa;rb.Tile5=function(a,c){c=D({container:a,type:"map",renderer:"canvas",starpos:null,zoom:1,fastpan:false,drawOnScale:true,zoombar:{}},c);return xa("view",c.type,c)}})(window);
