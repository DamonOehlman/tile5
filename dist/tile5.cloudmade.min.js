(function(gb){function J(){var a=arguments[0]||{},b=Array.prototype.slice.call(arguments,1),c,e;for(e=b.length;e--;)if((c=b[e])!==null)for(var k in c){var i=c[k];if(a!==i)if(i!==undefined)a[k]=i}return a}function ia(a,b){if(typeof console!=="undefined")console[b||"debug"](a)}function ya(a){var b=a.match(Fb),c=[],e=0,k;for(k=b?b.length:0;k--;){var i=b[k].slice(1);c[i]||(c[i]=RegExp("\\{"+i+"\\}","g"))}e=c.length;return function(){var h=a;for(k=0;k<e;k++)h=h.replace(c[k],arguments[k]||"");return h}}
function Ua(a){a=a.replace(/[\-\_\s\.]/g,"").toLowerCase();return za[a]||za.linear}function hb(a,b,c,e,k){function i(f){f=f?f:(new Date).getTime();if(d+ib<f){var g=f-h,q=c(g,a,j,e),l=h+e<=f;f=!l;if(k){g=k(q,l,g);f=typeof g!="undefined"?g&&f:f}f&&animFrame(i)}}var h=(new Date).getTime(),d=0,j=b-a;animFrame(i);return{}}function jb(a,b,c){ca.trigger("userMessage",a,b,c)}function kb(a){a=parseFloat(a)*ja;a=ra(a);var b=Ia*a;return la((1+a)/(1-a)*ma((1-b)/(1+b),Ia))/2}function lb(a){return fa/(256<<a)}
function mb(a,b){var c=Ia*ra(a);return Aa-2*nb(b*ma((1-c)/(1+c),Ia/2))}function S(a,b){this.mercY=this.mercX=null;if(V(a,Ba))ob.parseXY(a,this);else if(a&&a.toPixels){var c=a.toPixels();this.mercX=c.x;this.mercY=c.y}else{this.x=a||0;this.y=b||0}}function na(a,b,c,e){this.x=a||0;this.y=b||0;this.w=c||0;this.h=e||0;this.x2=this.x+this.w;this.y2=this.y+this.h}function pb(a,b){var c=new qb(Math.sqrt(256<<a)|0);b&&b.zoomLevel===a&&b.copyInto(c);c.zoomLevel=a;return c}function rb(a){a=a||(new Date).getTime();
for(var b=0;b<ua.length;){var c=ua[b],e=sa[c],k=sa[c].image&&sa[c].image.complete&&sa[c].image.width>0,i=a-e.start;i=k||i>=Gb;if(k){k=e.callbacks;sb[c]=e.image;for(var h=0;h<k.length;h++)k[h](e.image,true)}if(i){ua.splice(b,1);delete sa[c]}else b++}ua.length>0&&animFrame(rb)}function Ja(a,b){var c=a&&b?sb[a]:null;if(c&&c&&c.complete&&c.width>0)b(c);else{if(c=sa[a])c.callbacks.push(b);else{c=new Image;c.id="_ldimg"+ ++Hb;sa[a]={start:(new Date).getTime(),image:c,callbacks:[b]};c.src=a;ua[ua.length]=
a}animFrame(rb)}}function Ka(a,b,c,e,k,i){this.x=a;this.y=b;this.w=e||256;this.h=e||256;this.x2=this.x+this.w;this.y2=this.y+this.h;this.url=c;this.id=i||a+"_"+b;this.loaded=false;this.image=null}function tb(a){a=a?a:(new Date).getTime();if(a-ub>ib){for(var b=Ca.splice(0),c=b.length;c--;)b[c](a);ub=a}Ca.length&&animFrame(tb)}function vb(a){var b=Ca.length==0;Ca[Ca.length]=a;b&&animFrame(tb)}function Ib(a,b,c,e,k){k=J({easing:"sine.out",duration:1E3,progress:null,complete:null,autoInvalidate:true},
k);var i=(new Date).getTime(),h=a[b],d=b=="translate",j=k.autoInvalidate,f=c.length&&e.length&&c.length==e.length?c.length:0,g=Array(f),q=Array(f),l=Ua(k.easing),m=k.duration,o=k.progress,w=function(y){var x=y-i;y=i+m<=y;for(var G=a.layer?a.layer.view:null,H,B=f;B--;){H=l(x,c[B],g[B],m);q[B]=d?H|0:H}h.apply(a,q);j&&G&&G.invalidate();if(o){x=[].concat(y?e:q);x.unshift(y);o.apply(a,x)}if(y){a.animations--;h.apply(a,e);k.complete&&k.complete.apply(a,e)}else vb(w)};if(h&&h.apply&&f>0){m=m?m:DEFAULT_DURATION;
for(b=f;b--;)g[b]=e[b]-c[b];a.animations++;vb(w)}}function La(a,b){b=J({id:"layer_"+Jb++,zindex:0,animated:false,style:null,minXY:null,maxXY:null},b);this.visible=true;ka(J(this,b))}function Ma(){ka(this)}function ha(a,b){if(a&&a.split){var c=a.split(wb);if(c.length>1){a=c[0];b=c[1]}}else if(a&&a.lat){b=a.lon;a=a.lat}this.lat=parseFloat(a||0);this.lon=parseFloat(b||0)}function Da(a,b){if(V(a,Kb)){for(var c=b,e=this.min=new ha(xb,yb),k=this.max=new ha(Lb,Mb),i=a.length;i--;){var h=a[i];if(h.lat<e.lat)e.lat=
h.lat;if(h.lat>k.lat)k.lat=h.lat;if(h.lon<e.lon)e.lon=h.lon;if(h.lon>k.lon)k.lon=h.lon}if(V(c,oa)){c=calcSize(bounds.min,bounds.max);c=Va(c.x,c.y)*0.3}this.expand(c)}else{this.min=a;this.max=b}}var Wa={};(function(a){var b=[],c=0,e=false,k=a.register=function(i,h){b.push({section:i,run:h})};a.init=function(i){function h(){if(c<b.length){var j=b[c++];d[j.section]||(d[j.section]={});j.run(d[j.section],h)}else{for(j in d)a[j]=d[j];e=true;i&&i(a)}}var d={};if(e&&i)i(a);else{c=0;h()}};k("canvas",function(i,
h){function d(){var q,l=j.getContext("2d");l.save();try{l.translate(50,50);l.beginPath();l.rect(0,0,20,20);q=l.isPointInPath(10,10)}finally{l.restore()}return q}var j=document.createElement("canvas"),f=typeof FlashCanvas!="undefined",g=typeof G_vmlCanvasManager!="undefnined";j.width=200;j.height=200;i.pipTransformed=f||g?false:d();h()})})(Wa);window.animFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||
window.msRequestAnimationFrame||function(a){setTimeout(function(){a((new Date).getTime())},1E3/60)}}();var Fb=/\{(\d+)(?=\})/g,za=function(){var a=1.70158,b=Math.PI/2,c=Math.abs,e=Math.pow,k=Math.sin,i=Math.asin,h=Math.cos;return{linear:function(d,j,f,g){return f*d/g+j},backin:function(d,j,f,g){return f*(d/=g)*d*((a+1)*d-a)+j},backout:function(d,j,f,g){return f*((d=d/g-1)*d*((a+1)*d+a)+1)+j},backinout:function(d,j,f,g){return(d/=g/2)<1?f/2*d*d*(((a*=1.525)+1)*d-a)+j:f/2*((d-=2)*d*(((a*=1.525)+1)*
d+a)+2)+j},bouncein:function(d,j,f,g){return f-za.bounceout(g-d,0,f,g)+j},bounceout:function(d,j,f,g){return(d/=g)<1/2.75?f*7.5625*d*d+j:d<2/2.75?f*(7.5625*(d-=1.5/2.75)*d+0.75)+j:d<2.5/2.75?f*(7.5625*(d-=2.25/2.75)*d+0.9375)+j:f*(7.5625*(d-=2.625/2.75)*d+0.984375)+j},bounceinout:function(d,j,f,g){return d<g/2?za.bouncein(d*2,0,f,g)/2+j:za.bounceout(d*2-g,0,f,g)/2+f/2+j},cubicin:function(d,j,f,g){return f*(d/=g)*d*d+j},cubicout:function(d,j,f,g){return f*((d=d/g-1)*d*d+1)+j},cubicinout:function(d,
j,f,g){if((d/=g/2)<1)return f/2*d*d*d+j;return f/2*((d-=2)*d*d+2)+j},elasticin:function(d,j,f,g,q,l){if(d==0)return j;if((d/=g)==1)return j+f;l||(l=g*0.3);if(!q||q<c(f)){q=f;f=l/4}else f=l/fa*i(f/q);return-(q*e(2,10*(d-=1))*k((d*g-f)*fa/l))+j},elasticout:function(d,j,f,g,q,l){var m;if(d==0)return j;if((d/=g)==1)return j+f;l||(l=g*0.3);if(!q||q<c(f)){q=f;m=l/4}else m=l/fa*i(f/q);return q*e(2,-10*d)*k((d*g-m)*fa/l)+f+j},elasticinout:function(d,j,f,g,q,l){var m;if(d==0)return j;if((d/=g/2)==2)return j+
f;l||(l=g*0.3*1.5);if(!q||q<c(f)){q=f;m=l/4}else m=l/fa*i(f/q);if(d<1)return-0.5*q*e(2,10*(d-=1))*k((d*g-m)*fa/l)+j;return q*e(2,-10*(d-=1))*k((d*g-m)*fa/l)*0.5+f+j},quadin:function(d,j,f,g){return f*(d/=g)*d+j},quadout:function(d,j,f,g){return-f*(d/=g)*(d-2)+j},quadinout:function(d,j,f,g){if((d/=g/2)<1)return f/2*d*d+j;return-f/2*(--d*(d-2)-1)+j},sinein:function(d,j,f,g){return-f*h(d/g*b)+f+j},sineout:function(d,j,f,g){return f*k(d/g*b)+j},sineinout:function(d,j,f,g){return-f/2*(h(Math.PI*d/g)-1)+
j}}}();if(typeof animFrame==="undefined")throw Error("animFrame COG required for tweening support");var ka=function(){function a(c,e){var k=c.hasOwnProperty("obsHandlers")?c.obsHandlers:null;k[e]||(k[e]=[]);return k[e]}var b=0;return function(c){if(!c)return null;if(!(c.hasOwnProperty("obsHandlers")?c.obsHandlers:null))c.obsHandlers={};if(!c.hasOwnProperty("bind")){c.bind=function(e,k){var i="callback"+b++;a(c,e).unshift({fn:k,id:i});return i};c.triggerCustom=function(e,k){var i=a(c,e),h={cancel:false,
name:e,source:this},d;for(d in k)h[d]=k[d];if(!i)return null;d=Array.prototype.slice.call(arguments,2);c.eventInterceptor&&c.eventInterceptor(e,h,d);d.unshift(h);for(var j=i.length;j--&&!h.cancel;)i[j].fn.apply(this,d);return h};c.trigger=function(e){var k=Array.prototype.slice.call(arguments,1);k.splice(0,0,e,null);return c.triggerCustom.apply(this,k)};c.unbind=function(e,k){if(typeof e==="undefined")c.obsHandlers={};else for(var i=a(c,e),h=0;i&&h<i.length;h++)if(i[h].id===k){i.splice(h,1);break}return c}}return c}}(),
Nb=function(){function a(b,c,e,k){if(typeof b[k]=="undefined")b[k]=function(i){if(typeof i!="undefined"){c[k]=i;e[k]&&e[k](i);return b}else return c[k]}}return function(b,c,e){for(var k in c)a(b,c,e,k)}}(),zb=Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1},V=function(){return function(a,b){b=Ob.call(b);if(b=="finite")return!Pb[Qb](+a);return b=="null"&&a===null||b==typeof a||b=="object"&&a===Object(a)||b=="array"&&Array.isArray&&Array.isArray(a)||
Rb.call(a).slice(8,-1).toLowerCase()==b}}();(function(){function a(k){var i=document.createElement("script"),h=false;i.src=k;i.async=true;i.onload=i.onreadystatechange=function(){if(!h&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){h=true;i.onload=i.onreadystatechange=null;i&&i.parentNode&&i.parentNode.removeChild(i)}};c||(c=document.getElementsByTagName("head")[0]);c.appendChild(i)}var b=0,c,e=this;return function(k,i,h){k+=k.indexOf("?")>=0?"&":"?";var d="json"+ ++b;
e[d]=function(j){i(j);e[d]=null;try{delete e[d]}catch(f){}};a(k+(h?h:"callback")+"="+d);return d}})();INTERACT=function(){function a(l){return function(m,o){l.addEventListener(m,o,false)}}function b(l){return function(m,o){l.removeEventListener(m,o,false)}}function c(l){return function(m,o){l.attachEvent("on"+m,o)}}function e(l,m){return{x:l?l:0,y:m?m:0,count:1}}function k(l,m){g.push(J({handler:null,checks:{},type:l},m))}function i(l){var m=0,o=0;if(l.offsetParent){do{m+=l.offsetLeft;o+=l.offsetTop;
l=l.offsetParent}while(l)}return{left:m,top:o}}function h(l,m){return{source:l,target:m.target?m.target:m.srcElement}}function d(l,m){for(var o=l.target?l.target:l.srcElement;o&&o!==m;)o=o.parentNode;return o&&o===m}function j(l,m){return{x:l.x-(m?m.left:0),y:l.y-(m?m.top:0)}}function f(l,m){if(l.preventDefault){l.preventDefault();l.stopPropagation()}else if(typeof l.cancelBubble!="undefined")l.cancelBubble=true;m&&l.stopImmediatePropagation&&l.stopImmediatePropagation()}var g=[],q=function(l,m,o){o=
J({binder:null,unbinder:null,observable:null},o);for(var w=o.observable,y=[],x,G,H={bind:function(){return w.bind.apply(null,arguments)},unbind:function(){w.unbind();for(B=0;B<y.length;B++)y[B].unbind();return H}},B=0;B<m.length;B++)y.push(m[B](l,w,o));w.bind("pointerDown",function(){G=x=0});w.bind("pointerMove",function(p,C,v,s){x+=s.x||0;G+=s.y||0});w.bind("pointerUp",function(p,C,v){Math.abs(x)>20||Math.abs(G)>20||w.triggerCustom("tap",p,C,v)});return H};k("pointer",{handler:function(l,m,o){function w(t){if(t.pageX&&
t.pageY)return e(t.pageX,t.pageY);else{var I=document.documentElement,Q=document.body;return e(t.clientX+(I&&I.scrollLeft||Q&&Q.scrollLeft||0)-(I&&I.clientLeft||Q&&Q.clientLeft||0),t.clientY+(I&&I.scrollTop||Q&&Q.scrollTop||0)-(I&&I.clientTop||Q&&Q.clientTop||0))}}function y(t){if(d(t,l))if(s=B(t)){var I=w(t);l.style.cursor="move";f(t,true);M=I.x;K=I.y;E=e(M,K);m.triggerCustom("pointerDown",h("mouse",t),E,j(E,i(l)))}}function x(t){var I=w(t);D=I.x;F=I.y;if(d(t,l))p(t,s?"pointerMove":"pointerHover")}
function G(t){if(s&&B(t)){s=false;if(d(t,l)){l.style.cursor="default";p(t,"pointerUp")}}}function H(t){if(d(t,l)){var I;t=t||window.event;if(t.detail)I=t.axis===2?-t.detail*C:0;else{I=t.wheelDeltaY?t.wheelDeltaY:t.wheelDelta;if(window.opera)I=-I}if(I!==0){var Q=e(D,F);m.triggerCustom("zoom",h("mouse",t),Q,j(Q,i(l)),I/v,"wheel");f(t);t.returnValue=false}}}function B(t){t=t||window.event;return(t.which||t.button)==1}function p(t,I,Q,Z,W){Q=typeof Q!="undefined"?Q:D;Z=typeof Z!="undefined"?Z:F;var z=
Q-M,N=Z-K,A=e(Q,Z);m.triggerCustom(I,h("mouse",t),A,j(A,i(l)),e(z,N));if(typeof W=="undefined"||W){M=Q;K=Z}}o=J({},o);var C=120,v=C*8,s=false,E,D,F,M,K;o.binder("mousedown",y);o.binder("mousemove",x);o.binder("mouseup",G);o.binder("dblclick",function(t){ia("captured double click");if(d(t,l)){var I=w(t);m.triggerCustom("doubleTap",h("mouse",t),I,j(I,i(l)))}});o.binder("mousewheel",H);o.binder("DOMMouseScroll",H);return{unbind:function(){o.unbinder("mousedown",y);o.unbinder("mousemove",x);o.unbinder("mouseup",
G);o.unbinder("mousewheel",H);o.unbinder("DOMMouseScroll",H)}}},checks:{touch:false}});k("pointer",{handler:function(l,m,o){function w(z){if(z.count<2)return 0;var N=z.x-z.next.x;z=z.y-z.next.y;return~~Math.sqrt(N*N+z*z)}function y(z,N,A){N=N?N:0;A=A?A:0;for(var R={x:z.x-N,y:z.y-A,id:z.id,count:z.count},Y=R;z.next;){z=z.next;Y=Y.next={x:z.x-N,y:z.y-A,id:z.id}}return R}function x(z,N){var A=z[N?N:"touches"],R,Y;if(A.length===0)return null;Y=R={x:A[0].pageX,y:A[0].pageY,id:A[0].identifier,count:A.length};
for(var $=1,Ea=A.length;$<Ea;$++)Y=Y.next={x:A[$].pageX,y:A[$].pageY,id:A[$].identifier};return R}function G(z){if(d(z,l)){F=i(l);var N=x(z,"changedTouches"),A=y(N,F.left,F.top);if(!K){M=s;m.triggerCustom("pointerDown",h("touch",z),N,A)}Z&&m.triggerCustom("pointerDownMulti",h("touch",z),N,A);K=x(z);if(K.count>1)I=w(K);W=1;Q=y(K)}}function H(z){if(d(z,l)){f(z);t=x(z);if(M==s)M=Math.abs(K.x-t.x)>C||Math.abs(K.y-t.y)>C?v:s;if(M!=s){M=t.count>1?D:E;if(M==D)if(K.count===1){K=y(t);I=w(K)}else{var N=w(t);
if(Math.abs(I-N)<p)M=E;else{var A;A=t.x;var R=t.next.x,Y=t.y,$=t.next.y;A={x:(A<R?A:R)+(Math.abs(A-R)>>1),y:(Y<$?Y:$)+(Math.abs(Y-$)>>1)};N=N/I;R=N-W;m.triggerCustom("zoom",h("touch",z),A,j(A,F),R,"pinch");W=N}}M==E&&m.triggerCustom("pointerMove",h("touch",z),t,y(t,F.left,F.top),e(t.x-Q.x,t.y-Q.y));Z&&m.triggerCustom("pointerMoveMulti",h("touch",z),t,y(t,F.left,F.top))}Q=y(t)}}function B(z){if(d(z,l)){var N=x(z,"changedTouches"),A=y(N,F.left,F.top);t=x(z);if(!t){m.triggerCustom("pointerUp",h("touch",
z),N,A);K=null}Z&&m.triggerCustom("pointerUpMulti",h("touch",z),N,A)}}o=J({detailed:false,inertia:false},o);var p=20,C=7,v=0,s=1,E=2,D=3,F,M,K,t,I,Q,Z=o.detailed,W=1;o.binder("touchstart",G);o.binder("touchmove",H);o.binder("touchend",B);ia("initialized touch handler");return{unbind:function(){o.unbinder("touchstart",G);o.unbinder("touchmove",H);o.unbinder("touchend",B)}}},checks:{touch:true}});return{register:k,watch:function(l,m,o){m=J({bindTarget:null,observable:null,isIE:typeof window.attachEvent!=
"undefined",types:null},m);capabilities=J({touch:"ontouchstart"in window},o);if(!m.observable){ia("creating observable");m.observable=ka({});globalOpts=m}m.binder=(m.isIE?c:a)(m.bindTarget||document);m.unbinder=(m.isIE?c:b)(m.bindTarget||document);o=m.types;for(var w=capabilities,y=[],x=g.length;x--;){var G=g[x],H=!o||o.indexOf(G.type)>=0,B=true,p;for(p in G.checks){var C=G.checks[p];ia("checking "+p+" capability. require: "+C+", capability = "+w[p]);B=B&&C===w[p]}if(H&&B)y[y.length]=G.handler}return new q(l,
y,m)}}}();var Xa=function(){var a={};return{create:function(b,c){if(a[b][c])return a[b][c].apply(null,Array.prototype.slice.call(arguments,2))},register:function(b,c,e){a[b]||(a[b]={});a[b][c]&&ia(Sb(b,c),"warn");a[b][c]=e}}}(),Sb=ya("Registration of {0}: {1} will override existing definition"),Ya=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],fa=Math.PI*2,Aa=Math.PI/2,ja=Math.PI/180,Na=180/Math.PI,xb=Aa,Lb=-xb,yb=fa,Mb=-yb,Ia=0.08181919084262157,pa=Math.abs,
Ab=Math.ceil,va=Math.round,Oa=Math.min,Va=Math.max,ma=Math.pow,Bb=Math.sqrt,la=Math.log,ra=Math.sin,Tb=Math.asin,Za=Math.cos,nb=Math.atan,Ub=Math.atan2,Qb="hasOwnProperty",Pb={NaN:1,Infinity:1,"-Infinity":1},Ob=String.prototype.toLowerCase,Rb=Object.prototype.toString,oa="undefined",Ba="string",$a="number",Kb="array",aa=Xa.register,qa=Xa.create,Vb=0,Jb=0,wb=/[\,\s]+/,Wb=function(){function a(k){e++;k=k||(new Date).getTime();for(var i=c.length;i--;){var h=c[i];e%h.every===0&&h.cb(k)}animFrame(a)}var b=
1E3/60,c=[],e=0;animFrame(a);return{attach:function(k,i){c[c.length]={cb:k,every:i?va(i/b):1}},detact:function(){}}}(),ob=function(){var a=/^xy\((.*)\).*$/i;return{parseXY:function(b,c){c=c||new S;if(!a.test(b)){var e=b.split(wb);c.mercX=parseFloat(e[1])*ja;c.mercY=kb(e[0])}return c}}}(),X=function(){var a={"-webkit-user-select":"none",position:"absolute"},b;b=function(c){for(var e=0;e<c.length;e++){var k=c[e];if(typeof document.body.style[k]!="undefined")return k}}(["-webkit-transform","MozTransform"]);
return{supportTransforms:b,create:function(c,e,k){c=document.createElement(c);var i=[];k=k||{};c.className=e||"";for(var h in k)i[i.length]=h+": "+k[h];c.style.cssText=i.join(";");return c},move:function(c,e,k,i){if(b)c.style[b]="translate("+e+"px, "+k+"px) translateZ(0) "+(i||[]).join(" ");else{c.style.left=e+"px";c.style.top=k+"px"}},styles:function(c){return J({},a,c)}}}();S.prototype={constructor:S,add:function(){for(var a=this.x,b=this.y,c=arguments.length;c--;){a+=arguments[c].x;b+=arguments[c].y}return new S(a,
b)},equals:function(a){return this.x===a.x&&this.y===a.y},offset:function(a,b){return new S(this.x+a,this.y+b)},sync:function(a,b){if(b){this.mercX=this.x*a-Math.PI;this.mercY=Math.PI-this.y*a}else if(this.mercX||this.mercY){this.x=va((this.mercX+Math.PI)/a);this.y=va((Math.PI-this.mercY)/a)}return this},pos:function(){for(var a=ma(Math.E,-this.mercY),b=Aa-2*nb(a),c=mb(b,a),e=0;e<12&&pa(b-c)>1.0E-7;){b=c;c=mb(b,a);e++}return new ha(c*Na,this.mercX%360*Na)},toString:function(){return this.x+", "+this.y}};
na.prototype={constructor:na,buffer:function(a,b){return new na(this.x-a,this.y-(b||a),this.w+a*2,this.h+(b||a)*2)},center:function(){return new S(this.x+(this.w>>1),this.y+(this.h>>1))}};Hits=function(){return{diffHits:function(a,b){var c=[],e={},k;for(k=b.length;k--;)e[b[k].target.id]=true;for(k=a.length;k--;)e[a[k].target.id]||(c[c.length]=a[k]);return c},init:function(a,b,c,e){return{type:a,x:e.x|0,y:e.y|0,elements:[],absXY:b,relXY:c}},initHit:function(a,b,c){return{type:a,target:b,drag:c}},triggerEvent:function(a,
b,c,e){b.triggerCustom(a.type+(c?c:"Hit"),{hitType:a.type},e?e:a.elements,a.absXY,a.relXY,new S(a.x,a.y))}}}();var qb=function(a){function b(i,h){var d=c[i],j;d||(d=c[i]=[]);(j=d[h])||(j=d[h]=[]);return j}a=a||128;var c=[],e={},k=0;return{copyInto:function(i){for(var h in e){var d=e[h];i.insert(d.bounds||d,d,h)}},insert:function(i,h,d){var j=i.x/a|0,f=i.y/a|0,g=(i.x+i.w)/a|0;i=(i.y+i.h)/a|0;d=d||h.id||"obj_"+k++;e[d]=h;for(h=j;h<=g;h++)for(j=f;j<=i;j++)b(h,j).push(d)},remove:function(i,h,d){d=d||
h.id;if(e[d]){var j=i.x/a|0;h=i.y/a|0;var f=(i.x+i.w)/a|0;i=(i.y+i.h)/a|0;delete e[d];for(j=j;j<=f;j++)for(var g=h;g<=i;g++){var q=b(j,g),l=zb.call(q,d);l>=0&&q.splice(l,1)}}},search:function(i){var h=i.y/a|0,d=(i.x+i.w)/a|0,j=(i.y+i.h)/a|0,f=[],g=[];for(i=i.x/a|0;i<=d;i++)for(var q=h;q<=j;q++)f=f.concat(b(i,q));f.sort();for(h=f.length;h--;){d=f[h];if(j=e[d])g[g.length]=j;for(;h>0&&f[h-1]==d;)h--}return g}}},Gb=3E4,sb={},Hb=0;(new Date).getTime();var sa={},ua=[];Ka.prototype={constructor:Ka,load:function(a){var b=
this;Ja(this.url,function(c){b.loaded=true;b.image=c;a&&a()})}};var Xb=function(){return ka({fastpan:true,applyStyle:function(){},applyTransform:function(a,b,c){return{restore:null,x:b,y:c}},checkSize:function(){},getDimensions:function(){return{width:0,height:0}},getViewport:function(){},hitTest:function(){return false},prepare:function(){},projectXY:null,reset:function(){}})};aa("renderer","canvas",function(a,b,c,e,k){function i(p,C,v){var s,E;m[C]=function(D){for(s=H.length;s--;)if(E=v[H[s]])D[B[s]]=
E}}function h(p,C,v){var s=false;if(C)s=g.isPointInPath(w?C.x-q:C.relXY.x,w?C.y-l:C.relXY.y);return{draw:v||G,viewport:p,hit:s,vpX:q,vpY:l,context:g}}e=J({},e);var d,j,f,g,q=0,l=0,m={},o=null,w=Wa.canvas.pipTransformed,y={},x=function(){},G=function(){this.fill&&g.fill();this.stroke&&g.stroke()},H=["fill","stroke","lineWidth","opacity"],B=["fillStyle","strokeStyle","lineWidth","globalAlpha"];if(b){d=b.offsetWidth;j=b.offsetHeight;f=X.create("canvas",null,{position:"absolute","z-index":1});f.width=
d;f.height=j;a.attachFrame(f,true);g=null}c=J(k,{applyStyle:function(p){var C=m[p],v=g&&g.canvas?g.canvas.id:"default",s;y[v]||(y[v]=[]);s=y[v].pop()||"basic";if(C){y[v].push(p);C(g);return s}},applyTransform:function(p){if(p.translateX!==0||p.translateY!==0||p.scaling!==1||p.rotation!==0){g.save();o={undo:function(){g.restore();o=null},x:p.xy.x,y:p.xy.y};g.translate(p.xy.x-q+p.translateX,p.xy.y-l+p.translateY);p.rotation!==0&&g.rotate(p.rotation);p.scaling!==1&&g.scale(p.scaling,p.scaling)}return o},
drawTiles:function(p,C,v){for(var s,E=q-256,D=l-256,F=p.x2,M=p.y2,K=C.length;K--;){p=C[K];if(s=p.x>=E&&p.x<=F&&p.y>=D&&p.y<=M)if(!p.loaded&&v)p.load(a.invalidate);else p.image&&g.drawImage(p.image,p.x-q,p.y-l)}},prepare:function(p,C){var v,s=false,E=C.scaled||C;if(g)g.restore();else g=f.getContext("2d");for(v=p.length;v--;)s=s||p[v].clip;q=E.x;l=E.y;if(g){s||g.clearRect(0,0,d,j);g.save()}g.globalCompositeOperation="source-over";return g},prepArc:function(p,C,v){g.beginPath();g.arc(p.xy.x-(o?o.x:q),
p.xy.y-(o?o.y:l),p.size>>1,p.startAngle,p.endAngle,false);return h(C,v)},prepImage:function(p,C,v,s){var E=(s.x||p.xy.x)-(o?o.x:q),D=(s.y||p.xy.y)-(o?o.y:l),F=s.image||p.image;if(F){g.beginPath();g.rect(E,D,s.width||F.width,s.height||F.height);return h(C,v,function(){g.drawImage(F,E,D,s.width||F.width,s.height||F.height)})}},prepMarker:function(p,C,v){var s=p.xy.x-(o?o.x:q),E=p.xy.y-(o?o.y:l),D=p.size,F=undefined;g.beginPath();switch(p.markerStyle.toLowerCase()){case "image":F=x;g.rect(s-(D>>1),E-
(D>>1),D,D);if(p.reset&&p.image){p.image=null;p.reset=false}p.image?g.drawImage(p.image,s-(D>>1),E-(D>>1),D,D):Ja(p.imageUrl,function(M){p.image=M;g.drawImage(p.image,s-(D>>1),E-(D>>1),D,D)});break;default:g.moveTo(s,E);g.lineTo(s-(D>>1),E-D);g.lineTo(s+(D>>1),E-D);g.lineTo(s,E)}return h(C,v,F)},prepPoly:function(p,C,v,s){var E=true;p=s.points||p.points;s=o?o.x:q;var D=o?o.y:l;g.beginPath();for(var F=p.length;F--;){var M=p[F].x-s,K=p[F].y-D;if(E){g.moveTo(M,K);E=false}else g.lineTo(M,K)}return h(C,
v)},getContext:function(){return g}});(function(){for(var p in ca.styles)i(null,p,ca.styles[p]);Cb.bind("defined",i)})();c.bind("detach",function(){b.removeChild(f)});return c});aa("renderer","dom",function(a,b,c,e,k){function i(g){var q=g.image=new Image;j[g.id]=g;q.src=g.url;q.onload=function(){if(f[g.id])d.appendChild(this);else g.image=null};q.style.cssText="-webkit-user-select: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute;";
return q}function h(g,q,l){var m=[],o;for(o in g){var w=g[o];if(l?w[l]:!q[o]){if(w.image&&w.image.parentNode){d.removeChild(w.image);w.image=null}m[m.length]=o}}for(q=m.length;q--;)delete g[m[q]]}var d=null,j={},f={};d=X.create("div","",X.styles({width:b.offsetWidth+"px",height:b.offsetHeight+"px"}));b.childNodes.length>0?b.insertBefore(d,b.childNodes[0]):b.appendChild(d);a.attachFrame(d);a=J(k,{drawTiles:function(g,q,l){for(var m,o=g.x,w=g.y,y=q.length;y--;){g=q[y];if(g.url){(m=g.image||(l?i(g):
null))&&X.move(m,g.x-o,g.y-w);f[g.id]=g}}}});a.bind("predraw",function(){h(j,f);f={}});a.bind("detach",function(){b.removeChild(d)});a.bind("reset",function(){for(h(j,f={});d.childNodes.length>0;)d.removeChild(d.childNodes[0])});return a});var Cb=function(){function a(e,k){if(V(e,Ba)){c.trigger("defined",e,b[e]=k);return e}else{var i=[],h;for(h in e)i[i.length]=a(h,e[h]);return i}}var b={},c=ka({get:function(e){return b[e]},define:a});a({basic:{fill:"#ffffff"},highlight:{fill:"#ff0000"},waypoints:{lineWidth:4,
stroke:"#003377",fill:"#ffffff"},waypointsHover:{lineWidth:4,stroke:"#ff0000",fill:"#ffffff"}});return c}();aa("view","simple",function(a){function b(n,r,u,L){B(Oa(Va(T+ma(2,L)-1,0.5),2))}function c(n){var r=n|0;n=r+Math.round((n-r)*50)/50;if(n!==T){T=n;n=la(T)/Math.LN2|0;if(n!==0){T=ma(2,n);y(Fa+n,Yb,Zb)}da++}}function e(n,r){var u=renderer&&renderer.projectXY?renderer.projectXY(n,r):null;if(!u){u=O.getViewport();var L=1/T;u=new S(u?u.x+n*L:n,u?u.y+r*L:r)}return u}function k(n,r,u){p("doubleTap",
r,u,e(u.x,u.y));a.scalable&&B(2,e(u.x,u.y),$b,null,ac)}function i(n,r,u){K=null;Z=true;w("down",r,u)}function h(n,r,u){w("hover",r,u)}function d(n,r,u,L){m(r,u,false);if(!K){W=L.x;z=L.y}}function j(n,r,u){m(r,u,true);Z=false}function f(){clearTimeout(Db);Db=setTimeout(function(){renderer.checkSize()},250)}function g(n,r,u){w("tap",r,u);p("tap",r,u,e(u.x,u.y,true))}function q(n){var r=O,u=D,L=M,P=a;n=(n||a.renderer).split("/");for(var U=new Xb(r,u,L,P),ga=0;ga<n.length;ga++)U=qa("renderer",n[ga],r,
u,L,P,U);renderer=U;Q=renderer.fastpan;l()}function l(){ea&&ea.unbind();if(renderer){ea=INTERACT.watch(renderer.interactTarget||M);if(a.scalable){ea.bind("zoom",b);ea.bind("doubleTap",k)}ea.bind("pointerDown",i);ea.bind("pointerMove",d);ea.bind("pointerUp",j);a.captureHover&&ea.bind("pointerHover",h);ea.bind("tap",g)}}function m(n,r,u){if(K){n=e(r.x,r.y);K.drag.call(K.target,K,n.x,n.y,u)&&da++;if(u)K=null}}function o(n){M=document.getElementById(n);M.appendChild(F=X.create("div","",X.styles({overflow:"hidden",
width:M.offsetWidth+"px",height:M.offsetHeight+"px"})));Pa=F.offsetWidth+Ga*2;Qa=F.offsetHeight+Ga*2;ab=Pa/2;bb=Qa/2;cb=M.offsetWidth/2;db=M.offsetHeight/2;F.appendChild(D=X.create("div","",X.styles({width:Pa+"px",height:Qa+"px","z-index":2,margin:-Ga+"px 0 0 "+-Ga+"px"})));q()}function w(n,r,u){ba=Hits.init(n,r,u,e(u.x,u.y,true));for(n=E;n--;)I=I||(s[n].hitGuess?s[n].hitGuess(ba.x,ba.y,O):false);I&&da++}function y(n,r,u){if(V(n,$a)){n=Va(a.minZoom,Oa(a.maxZoom,n|0));if(n!==Fa){var L=ma(2,n-Fa),P=
ab/L|0,U=bb/L|0;Fa=n;C(((r||A+ab)-P)*L,((u||R+bb)-U)*L);eb=Ea=0;p("zoom",n);T=1;renderer.trigger("reset");H()}return O}else return Fa}function x(){var n=new na(A,R,Pa,Qa);n.scaleFactor=T;return n}function G(n,r,u){if(V(r,oa))for(r=0;r<E;r++){if(s[r].id===n)return s[r]}else if(V(n,Ba)){r=qa("layer",r,O,u);r.added=(new Date).getTime();r.id=n;s[s.length]=r;s.sort(function(L,P){return P.zindex-L.zindex||P.added-L.added});E=s.length;r.trigger("resync");r.trigger("refresh",O,x());O.trigger("layerChange",
O,r);da++;return r}else return[].concat(s)}function H(){var n=x();if(n){if(wa||xa)if(n){var r=Ra?A+(n.w>>1):A,u=Sa?R+(n.h>>1):R,L=n.w,P=n.h;if(wa&&wa>L)if(r+L>wa)A=Ra?A:wa-L;else if(r<0)A=Ra?A:0;if(xa&&xa>P)if(u+P>xa)R=Sa?R:xa-P;else if(u<0)R=Sa?R:0}Ea=A;eb=R;p("refresh",O,n);da++}}function B(n,r,u,L,P){var U;if(!bc){u=false;U=va(la(n)/Math.LN2);n=ma(2,U)}u?hb(T,n,u,P,function(ga,Ta){n=ga;if(Ta){U=va(la(n)/Math.LN2);n=ma(2,U);L&&L()}c(n)}):c(n);return O}function p(){for(var n=O.trigger.apply(null,
arguments).cancel,r=s.length;r--;)n=s[r].trigger.apply(null,arguments).cancel||n;return!n}function C(n,r,u){if(V(n,$a)){if(!(u&&panSpeed===0)){A=n|0;R=r|0}}else return new S(A,R)}a=J({container:"",captureHover:true,controls:["zoombar"],drawOnScale:true,padding:0,inertia:true,refreshDistance:256,pannable:false,scalable:false,minZoom:1,maxZoom:1,renderer:"canvas/dom",zoom:1,zoombar:{}},a);var v=[],s=[],E=0,D=null,F=null,M,K=null,t=!V(window.attachEvent,oa),I=false,Q=true,Z=false,W=0,z=0,N=a.refreshDistance,
A=0,R=0,Y=0,$=0,Ea=0,eb=0,wa=null,xa=null,Ra=false,Sa=false,Ga=a.padding,ba=null,Ha=null,Db=0,T=1,Eb=1,ea=null,fb={index:0,draw:false},bc=true,da=0,Pa,Qa,ab,bb,cb,db,Yb,Zb,Fa=a.zoom||a.zoomLevel,$b=Ua("quad.out"),ac=300,O={id:a.id,padding:Ga,panSpeed:0,attachFrame:function(n,r){r&&D.appendChild(n)},center:function(n,r,u){if(V(n,Ba)){r=ob.parseXY(n).sync(O.rpp);n=r.x;r=r.y}if(V(n,$a)){C(n-cb,r-db,u);return O}else{r=C().offset(cb,db);O.rpp&&r.sync(O.rpp,true);return r}},detach:function(){renderer&&
renderer.trigger("detach");ea&&ea.unbind();if(F){M.removeChild(F);D=F=null}},layer:G,invalidate:function(){da++},refresh:H,resetScale:function(){T=1},scale:B,triggerAll:p,removeLayer:function(n){a:{for(var r=E;r--;)if(s[r].id===n){n=r;break a}n=-1}if(n>=0&&n<E){O.trigger("layerRemove",O,s[n]);s.splice(n,1);da++}E=s.length},getRenderer:function(){return renderer},getScaleFactor:function(){return T},setMaxOffset:function(n,r,u,L){wa=n;xa=r;Ra=u;Sa=L},getViewport:x,offset:C,pan:function(n,r){W=n;z=r;
da++},zoom:y};ka(O);O.bind("resize",function(){renderer.checkSize()});Nb(O,a,{container:o,captureHover:l,scalable:l,pannable:l,renderer:function(n){if(renderer){renderer.trigger("detach");renderer=null}q(n);da++}});Wa.init(function(){G("markers","draw",{zindex:20});o(a.container);t?window.attachEvent("onresize",f):window.addEventListener("resize",f,false)});Wb.attach(function(n){var r=[],u,L,P;self.panSpeed=panSpeed=pa(W)+pa(z);u=T!==Eb;if(panSpeed>0||u)da++;if(panSpeed<2&&(pa(A-Ea)>=N||pa(R-eb)>=
N))H();fb.index++;fb.draw=da||panSpeed||0;if(renderer&&fb.draw){Y+=W;$+=z;if(W||z)O.trigger("pan");if(T!==1&&X.supportTransforms)r[r.length]="scale("+T+")";if(u=!Q||(a.drawOnScale||T===1)&&panSpeed<5){A=A-Y/T|0;R=R-$/T|0;P=x();renderer.trigger("predraw",P);if(renderer.prepare(s,P,n,ba)){L=$=u=Y=da=0;for(ii=E;ii--;){var U=s[ii];if(U.visible){var ga=U.style?renderer.applyStyle(U.style,true):null;U.draw(renderer,P,O,n,ba);ga&&renderer.applyStyle(ga)}}renderer.trigger("render",P);O.trigger("drawComplete",
P,n);Eb=T;X.move(D,u,L,r)}}else X.move(D,Y,$,r);if(Z||!a.inertia)z=W=0;else if(W!=0||z!=0){W*=0.8;z*=0.8;if(pa(W)<0.5)W=0;if(pa(z)<0.5)z=0}if(ba){n=ba?ba.elements:[];if(Ha&&Ha.type==="hover"){r=Hits.diffHits(Ha.elements,n);r.length>0&&Hits.triggerEvent(Ha,O,"Out",r)}if(n.length>0){u=ba.x;L=ba.y;for(r=n.length;r--;){P=n[r];U=u;ga=L;var Ta=P&&P.drag&&(!P.canDrag||P.canDrag(P,U,ga));if(Ta){K=P;K.startX=U;K.startY=ga}if(Ta)break}Hits.triggerEvent(ba,O)}Ha=n.length>0?J({},ba):null;ba=null}}});(function(n){v=
[];for(var r=0;r<n.length;r++)v[v.length]=qa("control",n[r],O,F,M,a[n[r]])})(a.controls);return O});aa("view","map",function(a){function b(d,j,f){h.zoom(j);c(d,f)}function c(d,j,f,g){d=new S(d);d.sync(lb(h.zoom()));h.center(d.x,d.y,f,g,function(){j&&j(h)})}a=J({zoomLevel:1,minZoom:1,maxZoom:18,pannable:true,scalable:true},a);var e=new S,k=0,i=a.tapExtent;a.adjustScaleFactor=function(d){return Math.pow(2,(d<1?Math.floor:Math.ceil)(Math.log(d)))};var h=J(qa("view","simple",a),{getBoundingBox:function(){var d=
h.getViewport();return d?new Da((new S(d.x,d.y2)).sync(k,true).pos(),(new S(d.x2,d.y)).sync(k,true).pos()):null},getCenterPosition:function(){var d=h.getViewport();if(d)return(new S(d.x+(d.w>>1),d.y+(d.h>>1))).sync(k,true).pos();return null},gotoBounds:function(d,j){b(d.center(),d.bestZoomLevel(h.getViewport()),j)},gotoPosition:b,panToPosition:c});h.bind("tap",function(d,j,f,g){d=g.sync(k,true).pos();var q=g.offset(-i,i).sync(k,true).pos();g=g.offset(i,-i).sync(k,true).pos();h.trigger("geotap",j,
f,d,new Da(q,g))});h.bind("refresh",function(d,j,f){if(e.x!=f.x||e.y!=f.y){h.trigger("boundsChange",h.getBoundingBox());e.x=f.x;e.y=f.y}});h.bind("zoom",function(d,j){var f;k=h.rpp=lb(j);f=fa/k|0;h.setMaxOffset(f,f,true,false);h.resetScale();h.triggerAll("resync")});return h});var ta=function(a,b,c){c=J({style:null,xy:null,size:20,fill:false,stroke:true,draggable:false,observable:true,properties:{},typeName:"Shape"},c);J(this,c);if(V(this.xy,Ba))this.xy=new S(this.xy);this.id="drawable_"+Vb++;this.bounds=
null;this.view=a;this.layer=b;this.rotation=this.animations=0;this.scaling=1;this.translateY=this.translateX=0;this.observable&&ka(this)};ta.prototype={constructor:ta,animate:function(a,b,c,e){Ib(this,a,b,c,e)},drag:null,draw:null,getProps:null,resync:function(){if(this.xy){this.xy.sync(this.view.rpp);if(this.size){var a=this.size>>1;this.updateBounds(new na(this.xy.x-a,this.xy.y-a,this.size,this.size))}}},rotate:function(a){this.rotation=a},scale:function(a){this.scaling=a},translate:function(a,
b){this.translateX=a;this.translateY=b},updateBounds:function(a,b){a&&(!this.bounds||a.x!=this.bounds.x||a.y!=this.bounds.y)&&this.trigger("move",this,a,this.bounds);this.bounds=a;if(b)this.xy=this.bounds.center()}};var ib=1E3/60|0,Ca=[],ub=0;aa("drawable","marker",function(a,b,c){c=J({fill:true,stroke:false,markerStyle:"simple",hoverStyle:"highlight",typeName:"Marker"},c);return new ta(a,b,c)});aa("drawable","poly",function(a,b,c){c=J({simplify:false,fill:true,points:[],typeName:"Poly"},c);var e=
c.points,k=c.simplify;ta.call(this,c);J(this,{getPoints:function(){return[].concat(e)},resync:function(){var i,h,d,j,f,g,q,l;for(i=e.length;i--;)e[i].sync(a.rpp);l=this.points=k?k(e):e;for(i=l.length;i--;){h=l[i].x;d=l[i].y;g=V(g,oa)||h<g?h:g;q=V(q,oa)||d<q?d:q;j=V(j,oa)||h>j?h:j;f=V(f,oa)||d>f?d:f}this.updateBounds(new na(g,q,j-g,f-q),true)}});this.haveData=e&&e.length>=2});aa("drawable","line",function(a,b,c){c.fill=false;return qa("drawable","poly",a,b,c)});aa("drawable","image",function(a,b,c){function e(){if(j&&
j.width>0){if(!this.centerOffset)this.centerOffset=new S(-j.width>>1,-j.height>>1);this.updateBounds(new na(this.xy.x+this.centerOffset.x,this.xy.y+this.centerOffset.y,j.width,j.height),false)}}function k(g){if(this.imageUrl=g){var q=this;Ja(this.imageUrl,function(l,m){j=l;if(m){var o=f.layer?f.layer.view:null;o&&o.invalidate()}e.apply(q)})}}c=J({image:null,imageUrl:null,centerOffset:null,typeName:"Image"},c);var i=ta.prototype.resync,h=0,d=0,j=c.image,f=J(new ta(a,b,c),{changeImage:k,getProps:function(){this.bounds||
e(this,j);return{image:j,x:this.xy.x+h,y:this.xy.y+d}},resync:function(g){i.call(this,g);e.call(this)}});j||k.call(this,this.imageUrl);if(this.centerOffset){h=this.centerOffset.x;d=this.centerOffset.y}});aa("drawable","arc",function(a,b,c){c=J({startAngle:0,endAngle:Math.PI*2,typeName:"Arc"},c);return new ta(a,b,c)});La.prototype={constructor:La,clip:null,cycle:function(){},draw:function(){},hitGuess:null};aa("layer","tile",function(a,b){b=J({generator:"osm",imageLoadArgs:{}},b);var c=qa("generator",
b.generator,b).run,e=null,k=[],i=J(new La(a,b),{draw:function(h,d,j){h.drawTiles&&h.drawTiles(d,e.search(d.buffer(128)),j.panSpeed<2)}});i.bind("refresh",function(h,d,j){var f=(new Date).getTime();e&&c(d,j,e,function(){d.invalidate();ia("GEN COMPLETED IN "+((new Date).getTime()-f)+" ms")})});i.bind("resync",function(){var h=a&&a.zoom?a.zoom():0;k[h]||(k[h]=pb(h));e=k[h]});return i});aa("layer","draw",function(a,b){function c(f,g,q,l){var m=this.dragOffset;if(!m)m=this.dragOffset=new S(f.startX-this.xy.x,
f.startY-this.xy.y);this.xy.x=g-m.x;this.xy.y=q-m.y;if(l){delete this.dragOffset;a.invalidate();this.trigger("dragDrop")}return true}function e(f){clearTimeout(d);d=setTimeout(function(){i.sort(function(g,q){if(q.xy&&g.xy){var l=q.xy.y-g.xy.y;return l!=0?l:q.xy.x-g.xy.x}});f&&f.invalidate()},50)}function k(f,g,q,l){l&&h.remove(l,g);h.insert(q,g)}b=J({zindex:10},b);var i=[],h,d=0,j=J(new La(a,b),{itemCount:0,clear:function(){h=new qb;i=[];j.itemCount=0},create:function(f,g,q){f=qa("drawable",f,a,j,
g);if(q)i.unshift(f);else i[i.length]=f;f.resync();h&&f.bounds&&h.insert(f.bounds,f);e(a);f.bind("move",k);j.itemCount=i.length;return f},draw:function(f,g,q,l,m){q={};l=h&&g?h.search(g):[];for(var o=l.length;o--;){var w=l[o],y=w.style||j.style,x,G=f.applyTransform(w),H=w.getProps?w.getProps(f):q;if(H=(x=f["prep"+w.typeName])?x.call(f,w,g,m,H):null){if(m&&H.hit){m.elements.push(Hits.initHit(w.type,w,w.draggable?c:null));x=m.type+"Style";y=w[x]||j[x]||y}y=y?f.applyStyle(y,true):null;(x=w.draw||H.draw)&&
x.call(w,H);y&&f.applyStyle(y)}G&&G.undo&&G.undo()}},find:function(){return[].concat(i)},hitGuess:function(f,g){return h&&h.search({x:f-10,y:g-10,w:20,h:20}).length>0}});j.bind("resync",function(){h=pb(a.zoom(),h);for(var f=i.length;f--;)i[f].resync()});return j});Ma.prototype={constructor:Ma};aa("control","zoombar",function(a,b,c,e){function k(v,s){var E=H[v]=X.create("div","t5-zoombar-button",{position:"absolute",background:i(v),"z-index":51,width:e.width+"px",height:e.buttonHeight+"px","margin-top":(s||
0)+"px"});B.appendChild(E)}function i(v,s){return"url("+e.images+") 0 -"+(q+m*3+(v||0)*f*3+(s||0)*f)+"px"}function h(v){return"url("+e.images+") 0 -"+(q+(v||0)*m)+"px"}function d(v,s){var E;if(v===l){l.style.background=h(s);E="thumb"}else for(var D=0;D<H.length;D++)if(v===H[D]){E="button"+D;H[D].style.background=i(D,s);break}return E}function j(v){if(v!==x){x=v;y=w-x/G*(w-o)|0;X.move(l,0,y-o);clearTimeout(p);p=setTimeout(function(){a.zoom(x)},500)}}e=J({width:24,height:200,images:"img/zoom.png",align:"right",
marginTop:10,spacing:10,thumbHeight:16,buttonHeight:16},e.zoombar);var f=e.buttonHeight,g,q=e.height,l,m=e.thumbHeight,o=e.spacing+f-(m>>1),w=e.height-f-(m>>1),y=o,x=-1;b=a.minZoom();var G=a.maxZoom()-b+1,H=[],B,p=0,C={button0:function(){a.zoom(a.zoom()+1)},button1:function(){a.zoom(a.zoom()-1)}};B=X.create("div","t5-zoombar",{position:"absolute",background:"url("+e.images+")","z-index":50,overflow:"hidden",width:e.width+"px",height:e.height+"px",margin:function(){var v=e.spacing,s=ya("{0}px 0 0 {1}px");
if(e.align==="right")v=c.offsetWidth-e.width-e.spacing;return s(e.marginTop,v)}()});c.childNodes[0]?c.insertBefore(B,c.childNodes[0]):c.appendChild(B);B.appendChild(l=X.create("div","t5-zoombar-thumb",{position:"absolute",background:h(),"z-index":51,width:e.width+"px",height:e.thumbHeight+"px",margin:"10px 0 0 0",top:y-o+"px"}));k(0);k(1,e.height-e.buttonHeight);g=INTERACT.watch(B,{bindTarget:B});g.bind("pointerMove",function(v,s,E){y=Math.min(Math.max(o,E.y-(m>>1)),w);j(G-(y-o)/w*G|0)});g.bind("pointerDown",
function(v){d(v.target,2)});g.bind("pointerUp",function(v){d(v.target,0)});g.bind("tap",function(v){(v=C[d(v.target,2)])&&v()});b=new Ma(a);b.bind("detach",function(){g.unbind();c.removeChild(B)});a.bind("zoom",function(v,s){j(s)});j(a.zoom());return b});ha.prototype={constructor:ha,distanceTo:function(){if(!targetPos||this.empty()||targetPos.empty())return 0;var a=(targetPos.lat-this.lat)*ja>>1,b=(targetPos.lon-this.lon)*ja>>1;a=ra(a)*ra(a)+Za(this.lat*ja)*Za(targetPos.lat*ja)*ra(b)*ra(b);return 6371*
2*Ub(Bb(a),Bb(1-a))},equalTo:function(a){return pos&&this.lat===a.lat&&this.lon===a.lon},empty:function(){return this.lat===0&&this.lon===0},inArray:function(a){for(var b=a.length;b--;)if(this.equal(a[b]))return true;return false},offset:function(a,b){var c=this.lat*ja,e=this.lon*ja,k=c+a/6371;c=Tb(ra(b/6371)/Za(c));e=e+c;k=(k+Aa)%Math.PI-Aa;e%=fa;return new ha(k*Na,e*Na)},toPixels:function(){return new S(parseFloat(this.lon)*ja,kb(this.lat))},toString:function(a){return this.lat+(a||" ")+this.lon}};
var cc=function(){return{generalize:function(a,b,c){var e=a.length,k=[],i=null;c||(c=250);c/=1E3;ia("generalizing positions, must include "+b.length+" positions");for(var h=e;h--;)if(h===0)k.unshift(a[h]);else{var d=!i||a[h].inArray(b)?c:i.distanceTo(a[h]);if(a[h]&&d>=c){k.unshift(a[h]);i=a[h]}}ia("generalized "+e+" positions into "+k.length+" positions");return k},parseArray:function(a){var b=a.length,c=Array(b);for(b=b;b--;)c[b]=new ha(a[b]);return c},vectorize:function(a,b){function c(){for(var h=
0,d=b.chunkSize,j=e;j--;){k[j]=new S(a[j]);h+=1;if(h>d)break}e=j;if(e<=0)b.callback&&b.callback(k);else animFrame(c)}var e=a.length,k=Array(e);b=J({chunkSize:500,async:true,callback:null},b);if(!b.async){for(var i=e;i--;)k[i]=new S(a[i]);return k}animFrame(c);return null}}}();Da.prototype={constructor:Da,bestZoomLevel:function(a){var b=this.center();b=Oa(va(pa(b.lat)*0.05),Ya.length);var c=Ya[b],e=this.size();b=Ab(la(Ya[3]*a.h/e.y)/la(2));a=Ab(la(c*a.w/e.x)/la(2));return Oa(isNaN(b)?1E3:b,isNaN(a)?
1E3:a)},center:function(){var a=this.size();return new ha(this.min.lat+(a.y>>1),this.min.lon+(a.x>>1))},expand:function(a){this.min.lat-=a;this.max.lat+=a;this.min.lon-=a%360;this.max.lon+=a%360},size:function(a){var b=new S(0,this.max.lat-this.min.lat);b.x=(a||isType(a,oa))&&this.min.lon>this.max.lon?360-this.min.lon+this.max.lon:this.max.lon-this.min.lon;return b},toString:function(){return"min: "+this.min+", max: "+this.max}};var ca={ex:J,log:ia,observable:ka,formatter:ya,wordExists:function(a,
b){for(var c=a.split(/\s|\,/).length;c--;)if(a.toLowerCase()==b.toLowerCase())return true;return false},is:V,indexOf:zb,userMessage:jb,Registry:Xa,Style:Cb,DOM:X,Rect:na,XY:S,Hits:Hits,tweenValue:hb,easing:Ua,Control:Ma,Tile:Ka,getImage:Ja,Pos:ha,PosFns:cc,BBox:Da};ka(ca);aa("generator","osm",function(a){a=J({flipY:false,tileSize:256,tilePath:"{0}/{1}/{2}.png",osmDataAck:true},a);var b=Math.PI/180,c=180/Math.PI,e=null,k=[],i,h=ya(a.tilePath),d={buildTileUrl:function(j,f,g,q,l){if(f>=0&&f<q){j=(j%
q+q)%q;f=h(g,j,l?Math.abs(f-q+1):f);if(e)f=i(k[j%(k.length||1)])+f;return f}},run:function(j,f,g,q){if(j=j.zoom?j.zoom():0){var l=2<<j-1,m=a.tileSize,o=Math.PI*2/(m<<j),w=(f.w/m|0)+1,y=(f.h/m|0)+1;f=(new S(f.x,f.y)).sync(o,true).pos();var x=f.lat;f=new S((f.lon+180)/360*l|0,(1-Math.log(Math.tan(x*b)+1/Math.cos(x*b))/Math.PI)/2*l%l|0);x=Math.PI-2*Math.PI*f.y/l;x=new ha(c*Math.atan(0.5*(Math.exp(x)-Math.exp(-x))),f.x/l*360-180);x=new S(x);x.sync(o);o=a.flipY;var G=g.search({x:x.x,y:x.y,w:w*m,h:y*m}),
H={},B;for(B=G.length;B--;)H[G[B].id]=true;k=(e=d.getServerDetails?d.getServerDetails():null)&&e.subDomains?e.subDomains:[];i=ya(e?e.baseUrl:"");for(G=0;G<=w;G++)for(B=0;B<=y;B++){var p=f.x+G,C=f.y+B,v=p+"_"+C;if(!H[v]){tileUrl=d.buildTileUrl(p,C,j,l,o);p=new Ka(x.x+G*m,x.y+B*m,tileUrl,m,m,v);g.insert(p,p)}}q&&q()}}};a.osmDataAck&&jb("ack","osm",'Map data (c) <a href="http://openstreetmap.org/" target="_blank">OpenStreetMap</a> (and) contributors, CC-BY-SA');return d});ca.Cloudmade=function(){ca.Registry.register("generator",
"osm.cloudmade",function(a){a=ca.ex({apikey:null,styleid:1},a);var b=ca.formatter("http://{3}.tile.cloudmade.com/{0}/{1}/{2}/");ca.userMessage("ack","osm.cloudmade",'This product uses the <a href="http://cloudmade.com/" target="_blank">CloudMade</a> APIs, but is not endorsed or certified by CloudMade.');return ca.ex(ca.Registry.create("generator","osm",a),{getServerDetails:function(){return{baseUrl:b(a.apikey,a.styleid,256,"{0}"),subDomains:["a","b","c"]}}})})}();gb.T5=ca;gb.Tile5=function(a,b){b=
J({container:a,type:"map",renderer:"canvas",starpos:null,zoom:1,fastpan:false,drawOnScale:true,zoombar:{}},b);return qa("view",b.type,b)}})(window);
