(function(mb){function K(){var a=arguments[0]||{},c=Array.prototype.slice.call(arguments,1),b,d;for(d=c.length;d--;)if((b=c[d])!==null)for(var k in b){var h=b[k];if(a!==h)if(h!==undefined)a[k]=h}return a}function ha(a,c){if(typeof console!=="undefined")console[c||"debug"](a)}function Aa(a){var c=a.match(Ib),b=[],d=0,k;for(k=c?c.length:0;k--;){var h=c[k].slice(1);b[h]||(b[h]=RegExp("\\{"+h+"\\}","g"))}d=b.length;return function(){var j=a;for(k=0;k<d;k++)j=j.replace(b[k],arguments[k]||"");return j}}
function Xa(a){a=a.replace(/[\-\_\s\.]/g,"").toLowerCase();return Ba[a]||Ba.linear}function nb(a,c,b,d,k){function h(f){f=f?f:(new Date).getTime();if(e+ob<f){var g=f-j,q=b(g,a,i,d),l=j+d<=f;f=!l;if(k){g=k(q,l,g);f=typeof g!="undefined"?g&&f:f}f&&animFrame(h)}}var j=(new Date).getTime(),e=0,i=c-a;animFrame(h);return{}}function pb(a,c,b){aa.trigger("userMessage",a,c,b)}function qb(a,c){var b=Ha*qa(a);return Ca-2*rb(c*ka((1-b)/(1+b),Ha/2))}function T(a,c){this.mercY=this.mercX=null;if(V(a,Da))sb.parseXY(a,
this);else if(a&&a.toPixels){var b=a.toPixels();this.mercX=b.x;this.mercY=b.y}else{this.x=a||0;this.y=c||0}}function la(a,c,b,d){this.x=a||0;this.y=c||0;this.w=b||0;this.h=d||0;this.x2=this.x+this.w;this.y2=this.y+this.h}function tb(a,c){var b=new ub(Math.sqrt(256<<a)|0);c&&c.zoomLevel===a&&c.copyInto(b);b.zoomLevel=a;return b}function vb(a){a=a||(new Date).getTime();for(var c=0;c<ua.length;){var b=ua[c],d=ra[b],k=ra[b].image&&ra[b].image.complete&&ra[b].image.width>0,h=a-d.start;h=k||h>=Jb;if(k){k=
d.callbacks;wb[b]=d.image;for(var j=0;j<k.length;j++)k[j](d.image,true)}if(h){ua.splice(c,1);delete ra[b]}else c++}ua.length>0&&animFrame(vb)}function Ia(a,c){var b=a&&c?wb[a]:null;if(b&&b&&b.complete&&b.width>0)c(b);else{if(b=ra[a])b.callbacks.push(c);else{b=new Image;b.id="_ldimg"+ ++Kb;ra[a]={start:(new Date).getTime(),image:b,callbacks:[c]};b.src=a;ua[ua.length]=a}animFrame(vb)}}function Ja(a,c,b,d,k,h){this.x=a;this.y=c;this.w=d||256;this.h=d||256;this.x2=this.x+this.w;this.y2=this.y+this.h;
this.url=b;this.id=h||a+"_"+c;this.loaded=false;this.image=null}function xb(a){a=a?a:(new Date).getTime();if(a-yb>ob){for(var c=Ea.splice(0),b=c.length;b--;)c[b](a);yb=a}Ea.length&&animFrame(xb)}function zb(a){var c=Ea.length==0;Ea[Ea.length]=a;c&&animFrame(xb)}function Lb(a,c,b,d,k){k=K({easing:"sine.out",duration:1E3,progress:null,complete:null,autoInvalidate:true},k);var h=(new Date).getTime(),j=a[c],e=c=="translate",i=k.autoInvalidate,f=b.length&&d.length&&b.length==d.length?b.length:0,g=Array(f),
q=Array(f),l=Xa(k.easing),m=k.duration,o=k.progress,w=function(y){var z=y-h;y=h+m<=y;for(var H=a.layer?a.layer.view:null,G,B=f;B--;){G=l(z,b[B],g[B],m);q[B]=e?G|0:G}j.apply(a,q);i&&H&&H.invalidate();if(o){z=[].concat(y?d:q);z.unshift(y);o.apply(a,z)}if(y){a.animations--;j.apply(a,d);k.complete&&k.complete.apply(a,d)}else zb(w)};if(j&&j.apply&&f>0){m=m?m:DEFAULT_DURATION;for(c=f;c--;)g[c]=d[c]-b[c];a.animations++;zb(w)}}function Ka(a,c){c=K({id:"layer_"+Mb++,zindex:0,animated:false,style:null,minXY:null,
maxXY:null},c);this.visible=true;ia(K(this,c))}function La(){ia(this)}function ga(a,c){if(a&&a.split){var b=a.split(Ab);if(b.length>1){a=b[0];c=b[1]}}else if(a&&a.lat){c=a.lon;a=a.lat}this.lat=parseFloat(a||0);this.lon=parseFloat(c||0)}function Ma(a,c){if(V(a,Nb)){for(var b=c,d=this.min=new ga(Bb,Cb),k=this.max=new ga(Ob,Pb),h=a.length;h--;){var j=a[h];if(j.lat<d.lat)d.lat=j.lat;if(j.lat>k.lat)k.lat=j.lat;if(j.lon<d.lon)d.lon=j.lon;if(j.lon>k.lon)k.lon=j.lon}if(V(b,ma)){b=calcSize(bounds.min,bounds.max);
b=Ya(b.x,b.y)*0.3}this.expand(b)}else{this.min=a;this.max=c}}var Za={};(function(a){var c=[],b=0,d=false,k=a.register=function(h,j){c.push({section:h,run:j})};a.init=function(h){function j(){if(b<c.length){var i=c[b++];e[i.section]||(e[i.section]={});i.run(e[i.section],j)}else{for(i in e)a[i]=e[i];d=true;h&&h(a)}}var e={};if(d&&h)h(a);else{b=0;j()}};k("canvas",function(h,j){function e(){var q,l=i.getContext("2d");l.save();try{l.translate(50,50);l.beginPath();l.rect(0,0,20,20);q=l.isPointInPath(10,
10)}finally{l.restore()}return q}var i=document.createElement("canvas"),f=typeof FlashCanvas!="undefined",g=typeof G_vmlCanvasManager!="undefnined";i.width=200;i.height=200;h.pipTransformed=f||g?false:e();j()})})(Za);window.animFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){setTimeout(function(){a((new Date).getTime())},1E3/60)}}();var Ib=/\{(\d+)(?=\})/g,
Ba=function(){var a=1.70158,c=Math.PI/2,b=Math.abs,d=Math.pow,k=Math.sin,h=Math.asin,j=Math.cos;return{linear:function(e,i,f,g){return f*e/g+i},backin:function(e,i,f,g){return f*(e/=g)*e*((a+1)*e-a)+i},backout:function(e,i,f,g){return f*((e=e/g-1)*e*((a+1)*e+a)+1)+i},backinout:function(e,i,f,g){return(e/=g/2)<1?f/2*e*e*(((a*=1.525)+1)*e-a)+i:f/2*((e-=2)*e*(((a*=1.525)+1)*e+a)+2)+i},bouncein:function(e,i,f,g){return f-Ba.bounceout(g-e,0,f,g)+i},bounceout:function(e,i,f,g){return(e/=g)<1/2.75?f*7.5625*
e*e+i:e<2/2.75?f*(7.5625*(e-=1.5/2.75)*e+0.75)+i:e<2.5/2.75?f*(7.5625*(e-=2.25/2.75)*e+0.9375)+i:f*(7.5625*(e-=2.625/2.75)*e+0.984375)+i},bounceinout:function(e,i,f,g){return e<g/2?Ba.bouncein(e*2,0,f,g)/2+i:Ba.bounceout(e*2-g,0,f,g)/2+f/2+i},cubicin:function(e,i,f,g){return f*(e/=g)*e*e+i},cubicout:function(e,i,f,g){return f*((e=e/g-1)*e*e+1)+i},cubicinout:function(e,i,f,g){if((e/=g/2)<1)return f/2*e*e*e+i;return f/2*((e-=2)*e*e+2)+i},elasticin:function(e,i,f,g,q,l){if(e==0)return i;if((e/=g)==1)return i+
f;l||(l=g*0.3);if(!q||q<b(f)){q=f;f=l/4}else f=l/ba*h(f/q);return-(q*d(2,10*(e-=1))*k((e*g-f)*ba/l))+i},elasticout:function(e,i,f,g,q,l){var m;if(e==0)return i;if((e/=g)==1)return i+f;l||(l=g*0.3);if(!q||q<b(f)){q=f;m=l/4}else m=l/ba*h(f/q);return q*d(2,-10*e)*k((e*g-m)*ba/l)+f+i},elasticinout:function(e,i,f,g,q,l){var m;if(e==0)return i;if((e/=g/2)==2)return i+f;l||(l=g*0.3*1.5);if(!q||q<b(f)){q=f;m=l/4}else m=l/ba*h(f/q);if(e<1)return-0.5*q*d(2,10*(e-=1))*k((e*g-m)*ba/l)+i;return q*d(2,-10*(e-=
1))*k((e*g-m)*ba/l)*0.5+f+i},quadin:function(e,i,f,g){return f*(e/=g)*e+i},quadout:function(e,i,f,g){return-f*(e/=g)*(e-2)+i},quadinout:function(e,i,f,g){if((e/=g/2)<1)return f/2*e*e+i;return-f/2*(--e*(e-2)-1)+i},sinein:function(e,i,f,g){return-f*j(e/g*c)+f+i},sineout:function(e,i,f,g){return f*k(e/g*c)+i},sineinout:function(e,i,f,g){return-f/2*(j(Math.PI*e/g)-1)+i}}}();if(typeof animFrame==="undefined")throw Error("animFrame COG required for tweening support");var ia=function(){function a(b,d){var k=
b.hasOwnProperty("obsHandlers")?b.obsHandlers:null;k[d]||(k[d]=[]);return k[d]}var c=0;return function(b){if(!b)return null;if(!(b.hasOwnProperty("obsHandlers")?b.obsHandlers:null))b.obsHandlers={};if(!b.hasOwnProperty("bind")){b.bind=function(d,k){var h="callback"+c++;a(b,d).unshift({fn:k,id:h});return h};b.triggerCustom=function(d,k){var h=a(b,d),j={cancel:false,name:d,source:this},e;for(e in k)j[e]=k[e];if(!h)return null;e=Array.prototype.slice.call(arguments,2);b.eventInterceptor&&b.eventInterceptor(d,
j,e);e.unshift(j);for(var i=h.length;i--&&!j.cancel;)h[i].fn.apply(this,e);return j};b.trigger=function(d){var k=Array.prototype.slice.call(arguments,1);k.splice(0,0,d,null);return b.triggerCustom.apply(this,k)};b.unbind=function(d,k){if(typeof d==="undefined")b.obsHandlers={};else for(var h=a(b,d),j=0;h&&j<h.length;j++)if(h[j].id===k){h.splice(j,1);break}return b}}return b}}(),Qb=function(){function a(c,b,d,k){if(typeof c[k]=="undefined")c[k]=function(h){if(typeof h!="undefined"){b[k]=h;d[k]&&d[k](h);
return c}else return b[k]}}return function(c,b,d){for(var k in b)a(c,b,d,k)}}(),$a=Array.prototype.indexOf||function(a){for(var c=0;c<this.length;c++)if(this[c]===a)return c;return-1},V=function(){return function(a,c){c=Rb.call(c);if(c=="finite")return!Sb[Tb](+a);return c=="null"&&a===null||c==typeof a||c=="object"&&a===Object(a)||c=="array"&&Array.isArray&&Array.isArray(a)||Ub.call(a).slice(8,-1).toLowerCase()==c}}();(function(){function a(k){var h=document.createElement("script"),j=false;h.src=
k;h.async=true;h.onload=h.onreadystatechange=function(){if(!j&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){j=true;h.onload=h.onreadystatechange=null;h&&h.parentNode&&h.parentNode.removeChild(h)}};b||(b=document.getElementsByTagName("head")[0]);b.appendChild(h)}var c=0,b,d=this;return function(k,h,j){k+=k.indexOf("?")>=0?"&":"?";var e="json"+ ++c;d[e]=function(i){h(i);d[e]=null;try{delete d[e]}catch(f){}};a(k+(j?j:"callback")+"="+e);return e}})();INTERACT=function(){function a(l){return function(m,
o){l.addEventListener(m,o,false)}}function c(l){return function(m,o){l.removeEventListener(m,o,false)}}function b(l){return function(m,o){l.attachEvent("on"+m,o)}}function d(l,m){return{x:l?l:0,y:m?m:0,count:1}}function k(l,m){g.push(K({handler:null,checks:{},type:l},m))}function h(l){var m=0,o=0;if(l.offsetParent){do{m+=l.offsetLeft;o+=l.offsetTop;l=l.offsetParent}while(l)}return{left:m,top:o}}function j(l,m){return{source:l,target:m.target?m.target:m.srcElement}}function e(l,m){for(var o=l.target?
l.target:l.srcElement;o&&o!==m;)o=o.parentNode;return o&&o===m}function i(l,m){return{x:l.x-(m?m.left:0),y:l.y-(m?m.top:0)}}function f(l,m){if(l.preventDefault){l.preventDefault();l.stopPropagation()}else if(typeof l.cancelBubble!="undefined")l.cancelBubble=true;m&&l.stopImmediatePropagation&&l.stopImmediatePropagation()}var g=[],q=function(l,m,o){o=K({binder:null,unbinder:null,observable:null},o);for(var w=o.observable,y=[],z,H,G={bind:function(){return w.bind.apply(null,arguments)},unbind:function(){w.unbind();
for(B=0;B<y.length;B++)y[B].unbind();return G}},B=0;B<m.length;B++)y.push(m[B](l,w,o));w.bind("pointerDown",function(){H=z=0});w.bind("pointerMove",function(p,C,v,u){z+=u.x||0;H+=u.y||0});w.bind("pointerUp",function(p,C,v){Math.abs(z)>20||Math.abs(H)>20||w.triggerCustom("tap",p,C,v)});return G};k("pointer",{handler:function(l,m,o){function w(s){if(s.pageX&&s.pageY)return d(s.pageX,s.pageY);else{var D=document.documentElement,Q=document.body;return d(s.clientX+(D&&D.scrollLeft||Q&&Q.scrollLeft||0)-
(D&&D.clientLeft||Q&&Q.clientLeft||0),s.clientY+(D&&D.scrollTop||Q&&Q.scrollTop||0)-(D&&D.clientTop||Q&&Q.clientTop||0))}}function y(s){if(e(s,l))if(u=B(s)){var D=w(s);l.style.cursor="move";f(s,true);O=D.x;M=D.y;F=d(O,M);m.triggerCustom("pointerDown",j("mouse",s),F,i(F,h(l)))}}function z(s){var D=w(s);x=D.x;I=D.y;if(e(s,l))p(s,u?"pointerMove":"pointerHover")}function H(s){if(u&&B(s)){u=false;if(e(s,l)){l.style.cursor="default";p(s,"pointerUp")}}}function G(s){if(e(s,l)){var D;s=s||window.event;if(s.detail)D=
s.axis===2?-s.detail*C:0;else{D=s.wheelDeltaY?s.wheelDeltaY:s.wheelDelta;if(window.opera)D=-D}if(D!==0){var Q=d(x,I);m.triggerCustom("zoom",j("mouse",s),Q,i(Q,h(l)),D/v,"wheel");f(s);s.returnValue=false}}}function B(s){s=s||window.event;return(s.which||s.button)==1}function p(s,D,Q,Y,ja){Q=typeof Q!="undefined"?Q:x;Y=typeof Y!="undefined"?Y:I;var A=Q-O,J=Y-M,E=d(Q,Y);m.triggerCustom(D,j("mouse",s),E,i(E,h(l)),d(A,J));if(typeof ja=="undefined"||ja){O=Q;M=Y}}o=K({},o);var C=120,v=C*8,u=false,F,x,I,
O,M;o.binder("mousedown",y);o.binder("mousemove",z);o.binder("mouseup",H);o.binder("dblclick",function(s){ha("captured double click");if(e(s,l)){var D=w(s);m.triggerCustom("doubleTap",j("mouse",s),D,i(D,h(l)))}});o.binder("mousewheel",G);o.binder("DOMMouseScroll",G);return{unbind:function(){o.unbinder("mousedown",y);o.unbinder("mousemove",z);o.unbinder("mouseup",H);o.unbinder("mousewheel",G);o.unbinder("DOMMouseScroll",G)}}},checks:{touch:false}});k("pointer",{handler:function(l,m,o){function w(A){if(A.count<
2)return 0;var J=A.x-A.next.x;A=A.y-A.next.y;return~~Math.sqrt(J*J+A*A)}function y(A,J,E){J=J?J:0;E=E?E:0;for(var Z={x:A.x-J,y:A.y-E,id:A.id,count:A.count},R=Z;A.next;){A=A.next;R=R.next={x:A.x-J,y:A.y-E,id:A.id}}return Z}function z(A,J){var E=A[J?J:"touches"],Z,R;if(E.length===0)return null;R=Z={x:E[0].pageX,y:E[0].pageY,id:E[0].identifier,count:E.length};for(var S=1,va=E.length;S<va;S++)R=R.next={x:E[S].pageX,y:E[S].pageY,id:E[S].identifier};return Z}function H(A){if(e(A,l)){I=h(l);var J=z(A,"changedTouches"),
E=y(J,I.left,I.top);if(!M){O=u;m.triggerCustom("pointerDown",j("touch",A),J,E)}Y&&m.triggerCustom("pointerDownMulti",j("touch",A),J,E);M=z(A);if(M.count>1)D=w(M);ja=1;Q=y(M)}}function G(A){if(e(A,l)){f(A);s=z(A);if(O==u)O=Math.abs(M.x-s.x)>C||Math.abs(M.y-s.y)>C?v:u;if(O!=u){O=s.count>1?x:F;if(O==x)if(M.count===1){M=y(s);D=w(M)}else{var J=w(s);if(Math.abs(D-J)<p)O=F;else{var E;E=s.x;var Z=s.next.x,R=s.y,S=s.next.y;E={x:(E<Z?E:Z)+(Math.abs(E-Z)>>1),y:(R<S?R:S)+(Math.abs(R-S)>>1)};J=J/D;Z=J-ja;m.triggerCustom("zoom",
j("touch",A),E,i(E,I),Z,"pinch");ja=J}}O==F&&m.triggerCustom("pointerMove",j("touch",A),s,y(s,I.left,I.top),d(s.x-Q.x,s.y-Q.y));Y&&m.triggerCustom("pointerMoveMulti",j("touch",A),s,y(s,I.left,I.top))}Q=y(s)}}function B(A){if(e(A,l)){var J=z(A,"changedTouches"),E=y(J,I.left,I.top);s=z(A);if(!s){m.triggerCustom("pointerUp",j("touch",A),J,E);M=null}Y&&m.triggerCustom("pointerUpMulti",j("touch",A),J,E)}}o=K({detailed:false,inertia:false},o);var p=20,C=7,v=0,u=1,F=2,x=3,I,O,M,s,D,Q,Y=o.detailed,ja=1;o.binder("touchstart",
H);o.binder("touchmove",G);o.binder("touchend",B);ha("initialized touch handler");return{unbind:function(){o.unbinder("touchstart",H);o.unbinder("touchmove",G);o.unbinder("touchend",B)}}},checks:{touch:true}});return{register:k,watch:function(l,m,o){m=K({bindTarget:null,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},m);capabilities=K({touch:"ontouchstart"in window},o);if(!m.observable){ha("creating observable");m.observable=ia({});globalOpts=m}m.binder=(m.isIE?b:a)(m.bindTarget||
document);m.unbinder=(m.isIE?b:c)(m.bindTarget||document);o=m.types;for(var w=capabilities,y=[],z=g.length;z--;){var H=g[z],G=!o||o.indexOf(H.type)>=0,B=true,p;for(p in H.checks){var C=H.checks[p];ha("checking "+p+" capability. require: "+C+", capability = "+w[p]);B=B&&C===w[p]}if(G&&B)y[y.length]=H.handler}return new q(l,y,m)}}}();var ab=function(){var a={};return{create:function(c,b){if(a[c][b])return a[c][b].apply(null,Array.prototype.slice.call(arguments,2))},register:function(c,b,d){a[c]||(a[c]=
{});a[c][b]&&ha(Vb(c,b),"warn");a[c][b]=d}}}(),Vb=Aa("Registration of {0}: {1} will override existing definition"),bb=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],ba=Math.PI*2,Ca=Math.PI/2,na=Math.PI/180,Na=180/Math.PI,Bb=Ca,Ob=-Bb,Cb=ba,Pb=-Cb,Ha=0.08181919084262157,oa=Math.abs,Db=Math.ceil,wa=Math.round,Oa=Math.min,Ya=Math.max,ka=Math.pow,Eb=Math.sqrt,pa=Math.log,qa=Math.sin,Wb=Math.asin,cb=Math.cos,rb=Math.atan,Xb=Math.atan2,Tb="hasOwnProperty",Sb=
{NaN:1,Infinity:1,"-Infinity":1},Rb=String.prototype.toLowerCase,Ub=Object.prototype.toString,ma="undefined",Da="string",db="number",Nb="array",ca=ab.register,sa=ab.create,Yb=0,Mb=0,Ab=/[\,\s]+/,Zb=function(){function a(k){d++;k=k||(new Date).getTime();for(var h=b.length;h--;){var j=b[h];d%j.every===0&&j.cb(k)}animFrame(a)}var c=1E3/60,b=[],d=0;animFrame(a);return{attach:function(k,h){b[b.length]={cb:k,every:h?wa(h/c):1}},detact:function(){}}}(),sb=function(){var a=/^xy\((.*)\).*$/i;return{parseXY:function(c,
b){b=b||new T;if(!a.test(c)){var d=c.split(Ab);d=Pa(d[1],d[0]);b.mercX=d.x;b.mercY=d.y}return b}}}(),X=function(){var a={"-webkit-user-select":"none",position:"absolute"},c;c=function(b){for(var d=0;d<b.length;d++){var k=b[d];if(typeof document.body.style[k]!="undefined")return k}}(["-webkit-transform","MozTransform"]);return{supportTransforms:c,create:function(b,d,k){b=document.createElement(b);var h=[];k=k||{};b.className=d||"";for(var j in k)h[h.length]=j+": "+k[j];b.style.cssText=h.join(";");
return b},move:function(b,d,k,h){if(c)b.style[c]="translate("+d+"px, "+k+"px) translateZ(0) "+(h||[]).join(" ");else{b.style.left=d+"px";b.style.top=k+"px"}},styles:function(b){return K({},a,b)}}}(),Pa=Pa||function(a,c){var b=parseFloat(c)*na;b=qa(b);var d=Ha*b;b=pa((1+b)/(1-b)*ka((1-d)/(1+d),Ha))/2;return new T(parseFloat(a)*na,b)},eb=eb||function(a,c){for(var b=ka(Math.E,-c),d=Ca-2*rb(b),k=qb(d,b),h=0;h<12&&oa(d-k)>1.0E-7;){d=k;k=qb(d,b);h++}return new ga(k*Na,a%360*Na)};T.prototype={constructor:T,
add:function(){for(var a=this.x,c=this.y,b=arguments.length;b--;){a+=arguments[b].x;c+=arguments[b].y}return new T(a,c)},equals:function(a){return this.x===a.x&&this.y===a.y},offset:function(a,c){return new T(this.x+a,this.y+c)},sync:function(a,c){if(c){this.mercX=this.x*a-Math.PI;this.mercY=Math.PI-this.y*a}else if(this.mercX||this.mercY){this.x=wa((this.mercX+Math.PI)/a);this.y=wa((Math.PI-this.mercY)/a)}return this},pos:function(){return eb(this.mercX,this.mercY)},toString:function(){return this.x+
", "+this.y}};la.prototype={constructor:la,buffer:function(a,c){return new la(this.x-a,this.y-(c||a),this.w+a*2,this.h+(c||a)*2)},center:function(){return new T(this.x+(this.w>>1),this.y+(this.h>>1))}};Hits=function(){return{diffHits:function(a,c){var b=[],d={},k;for(k=c.length;k--;)d[c[k].target.id]=true;for(k=a.length;k--;)d[a[k].target.id]||(b[b.length]=a[k]);return b},init:function(a,c,b,d){return{type:a,x:d.x|0,y:d.y|0,elements:[],absXY:c,relXY:b}},initHit:function(a,c,b){return{type:a,target:c,
drag:b}},triggerEvent:function(a,c,b,d){c.triggerCustom(a.type+(b?b:"Hit"),{hitType:a.type},d?d:a.elements,a.absXY,a.relXY,new T(a.x,a.y))}}}();var ub=function(a){function c(h,j){var e=b[h],i;e||(e=b[h]=[]);(i=e[j])||(i=e[j]=[]);return i}a=a||128;var b=[],d={},k=0;return{copyInto:function(h){for(var j in d){var e=d[j];h.insert(e.bounds||e,e,j)}},insert:function(h,j,e){var i=h.x/a|0,f=h.y/a|0,g=(h.x+h.w)/a|0;h=(h.y+h.h)/a|0;e=e||j.id||"obj_"+k++;d[e]=j;for(j=i;j<=g;j++)for(i=f;i<=h;i++)c(j,i).push(e)},
remove:function(h,j,e){e=e||j.id;if(d[e]){var i=h.x/a|0;j=h.y/a|0;var f=(h.x+h.w)/a|0;h=(h.y+h.h)/a|0;delete d[e];for(i=i;i<=f;i++)for(var g=j;g<=h;g++){var q=c(i,g),l=$a.call(q,e);l>=0&&q.splice(l,1)}}},search:function(h){var j=h.y/a|0,e=(h.x+h.w)/a|0,i=(h.y+h.h)/a|0,f=[],g=[];for(h=h.x/a|0;h<=e;h++)for(var q=j;q<=i;q++)f=f.concat(c(h,q));f.sort();for(j=f.length;j--;){e=f[j];if(i=d[e])g[g.length]=i;for(;j>0&&f[j-1]==e;)j--}return g}}},Jb=3E4,wb={},Kb=0;(new Date).getTime();var ra={},ua=[];Ja.prototype=
{constructor:Ja,load:function(a){var c=this;Ia(this.url,function(b){c.loaded=true;c.image=b;a&&a()})}};var $b=function(){return ia({fastpan:true,applyStyle:function(){},applyTransform:function(a,c,b){return{restore:null,x:c,y:b}},checkSize:function(){},getDimensions:function(){return{width:0,height:0}},getViewport:function(){},hitTest:function(){return false},prepare:function(){},projectXY:null,reset:function(){}})};ca("renderer","canvas",function(a,c,b,d,k){function h(p,C,v){var u,F;m[C]=function(x){for(u=
G.length;u--;)if(F=v[G[u]])x[B[u]]=F}}function j(p,C,v){var u=false;if(C)u=g.isPointInPath(w?C.x-q:C.relXY.x,w?C.y-l:C.relXY.y);return{draw:v||H,viewport:p,hit:u,vpX:q,vpY:l,context:g}}d=K({},d);var e,i,f,g,q=0,l=0,m={},o=null,w=Za.canvas.pipTransformed,y={},z=function(){},H=function(){this.fill&&g.fill();this.stroke&&g.stroke()},G=["fill","stroke","lineWidth","opacity"],B=["fillStyle","strokeStyle","lineWidth","globalAlpha"];if(c){e=c.offsetWidth;i=c.offsetHeight;f=X.create("canvas",null,{position:"absolute",
"z-index":1});f.width=e;f.height=i;a.attachFrame(f,true);g=null}b=K(k,{applyStyle:function(p){var C=m[p],v=g&&g.canvas?g.canvas.id:"default",u;y[v]||(y[v]=[]);u=y[v].pop()||"basic";if(C){y[v].push(p);C(g);return u}},applyTransform:function(p){if(p.translateX!==0||p.translateY!==0||p.scaling!==1||p.rotation!==0){g.save();o={undo:function(){g.restore();o=null},x:p.xy.x,y:p.xy.y};g.translate(p.xy.x-q+p.translateX,p.xy.y-l+p.translateY);p.rotation!==0&&g.rotate(p.rotation);p.scaling!==1&&g.scale(p.scaling,
p.scaling)}return o},drawTiles:function(p,C,v){for(var u,F=q-256,x=l-256,I=p.x2,O=p.y2,M=C.length;M--;){p=C[M];if(u=p.x>=F&&p.x<=I&&p.y>=x&&p.y<=O)if(!p.loaded&&v)p.load(a.invalidate);else p.image&&g.drawImage(p.image,p.x-q,p.y-l)}},prepare:function(p,C){var v,u=false,F=C.scaled||C;if(g)g.restore();else g=f.getContext("2d");for(v=p.length;v--;)u=u||p[v].clip;q=F.x;l=F.y;if(g){u||g.clearRect(0,0,e,i);g.save()}g.globalCompositeOperation="source-over";return g},prepArc:function(p,C,v){g.beginPath();
g.arc(p.xy.x-(o?o.x:q),p.xy.y-(o?o.y:l),p.size>>1,p.startAngle,p.endAngle,false);return j(C,v)},prepImage:function(p,C,v,u){var F=(u.x||p.xy.x)-(o?o.x:q),x=(u.y||p.xy.y)-(o?o.y:l),I=u.image||p.image;if(I){g.beginPath();g.rect(F,x,u.width||I.width,u.height||I.height);return j(C,v,function(){g.drawImage(I,F,x,u.width||I.width,u.height||I.height)})}},prepMarker:function(p,C,v){var u=p.xy.x-(o?o.x:q),F=p.xy.y-(o?o.y:l),x=p.size,I=undefined;g.beginPath();switch(p.markerStyle.toLowerCase()){case "image":I=
z;g.rect(u-(x>>1),F-(x>>1),x,x);if(p.reset&&p.image){p.image=null;p.reset=false}p.image?g.drawImage(p.image,u-(x>>1),F-(x>>1),x,x):Ia(p.imageUrl,function(O){p.image=O;g.drawImage(p.image,u-(x>>1),F-(x>>1),x,x)});break;default:g.moveTo(u,F);g.lineTo(u-(x>>1),F-x);g.lineTo(u+(x>>1),F-x);g.lineTo(u,F)}return j(C,v,I)},prepPoly:function(p,C,v,u){var F=true;p=u.points||p.points;u=o?o.x:q;var x=o?o.y:l;g.beginPath();for(var I=p.length;I--;){var O=p[I].x-u,M=p[I].y-x;if(F){g.moveTo(O,M);F=false}else g.lineTo(O,
M)}return j(C,v)},getContext:function(){return g}});(function(){for(var p in aa.styles)h(null,p,aa.styles[p]);Fb.bind("defined",h)})();b.bind("detach",function(){c.removeChild(f)});return b});ca("renderer","dom",function(a,c,b,d,k){function h(g){var q=g.image=new Image;i[g.id]=g;q.src=g.url;q.onload=function(){if(f[g.id])e.appendChild(this);else g.image=null};q.style.cssText="-webkit-user-select: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute;";
return q}function j(g,q,l){var m=[],o;for(o in g){var w=g[o];if(l?w[l]:!q[o]){if(w.image&&w.image.parentNode){e.removeChild(w.image);w.image=null}m[m.length]=o}}for(q=m.length;q--;)delete g[m[q]]}var e=null,i={},f={};e=X.create("div","",X.styles({width:c.offsetWidth+"px",height:c.offsetHeight+"px"}));c.childNodes.length>0?c.insertBefore(e,c.childNodes[0]):c.appendChild(e);a.attachFrame(e);a=K(k,{drawTiles:function(g,q,l){for(var m,o=g.x,w=g.y,y=q.length;y--;){g=q[y];if(g.url){(m=g.image||(l?h(g):
null))&&X.move(m,g.x-o,g.y-w);f[g.id]=g}}}});a.bind("predraw",function(){j(i,f);f={}});a.bind("detach",function(){c.removeChild(e)});a.bind("reset",function(){for(j(i,f={});e.childNodes.length>0;)e.removeChild(e.childNodes[0])});return a});var Fb=function(){function a(d,k){if(V(d,Da)){b.trigger("defined",d,c[d]=k);return d}else{var h=[],j;for(j in d)h[h.length]=a(j,d[j]);return h}}var c={},b=ia({get:function(d){return c[d]},define:a});a({basic:{fill:"#ffffff"},highlight:{fill:"#ff0000"},waypoints:{lineWidth:4,
stroke:"#003377",fill:"#ffffff"},waypointsHover:{lineWidth:4,stroke:"#ff0000",fill:"#ffffff"}});return b}();ca("view","map",function(a){function c(n,r,t,L){C(Oa(Ya(W+ka(2,L)-1,0.5),2))}function b(n){var r=n|0;n=r+Math.round((n-r)*50)/50;if(n!==W){W=n;n=pa(W)/Math.LN2|0;if(n!==0){W=ka(2,n);z(xa+n,ac,bc)}ea++}}function d(n,r){var t=renderer&&renderer.projectXY?renderer.projectXY(n,r):null;if(!t){t=N.getViewport();var L=1/W;t=new T(t?t.x+n*L:n,t?t.y+r*L:r)}return t.sync(N.rpp,true)}function k(n,r,t){v("doubleTap",
r,t,d(t.x,t.y));a.scalable&&C(2,d(t.x,t.y),cc,null,dc)}function h(n,r,t){D=null;A=true;w("down",r,t)}function j(n,r,t){w("hover",r,t)}function e(n,r,t,L){m(r,t,false);if(!D){J=L.x;E=L.y}}function i(n,r,t){m(r,t,true);A=false}function f(){clearTimeout(Gb);Gb=setTimeout(function(){renderer.checkSize()},250)}function g(n,r,t){w("tap",r,t);v("tap",r,t,d(t.x,t.y,true))}function q(n){var r=N,t=O,L=s,P=a;n=(n||a.renderer).split("/");for(var U=new $b(r,t,L,P),fa=0;fa<n.length;fa++)U=sa("renderer",n[fa],r,
t,L,P,U);renderer=U;ja=renderer.fastpan;l()}function l(){da&&da.unbind();if(renderer){da=INTERACT.watch(renderer.interactTarget||s);if(a.scalable){da.bind("zoom",c);da.bind("doubleTap",k)}da.bind("pointerDown",h);da.bind("pointerMove",e);da.bind("pointerUp",i);a.captureHover&&da.bind("pointerHover",j);da.bind("tap",g)}}function m(n,r,t){if(D){n=d(r.x,r.y);D.drag.call(D.target,D,n.x,n.y,t)&&ea++;if(t)D=null}}function o(n){s=document.getElementById(n);s.appendChild(M=X.create("div","",X.styles({overflow:"hidden",
width:s.offsetWidth+"px",height:s.offsetHeight+"px"})));Qa=M.offsetWidth+Fa*2;Ra=M.offsetHeight+Fa*2;fb=Qa/2;gb=Ra/2;hb=s.offsetWidth/2;ib=s.offsetHeight/2;M.appendChild(O=X.create("div","",X.styles({width:Qa+"px",height:Ra+"px","z-index":2,margin:-Fa+"px 0 0 "+-Fa+"px"})));q()}function w(n,r,t){$=Hits.init(n,r,t,d(t.x,t.y,true));for(n=I;n--;)Y=Y||(x[n].hitGuess?x[n].hitGuess($.x,$.y,N):false);Y&&ea++}function y(n){var r=G();return n?z(n.bestZoomLevel(r)).center(n.center()):new Ma((new T(r.x,r.y2)).sync(rpp,
true).pos(),(new T(r.x2,r.y)).sync(rpp,true).pos())}function z(n,r,t){if(V(n,db)){n=Ya(a.minZoom,Oa(a.maxZoom,n|0));if(n!==xa){var L=ka(2,n-xa),P=fb/L|0,U=gb/L|0;xa=n;u(((r||R+fb)-P)*L,((t||S+gb)-U)*L);jb=kb=0;v("zoom",n);rpp=N.rpp=ba/(256<<xa);H(ba/rpp|0,ba/rpp|0,true,false);W=1;v("resync");renderer.trigger("reset");p()}return N}else return xa}function H(n,r,t,L){ya=n;za=r;Sa=t;Ta=L}function G(){var n=new la(R,S,Qa,Ra);n.scaleFactor=W;return n}function B(n,r,t){if(V(r,ma))for(r=0;r<I;r++){if(x[r].id===
n)return x[r]}else if(V(n,Da)){r=sa("layer",r,N,t);r.added=(new Date).getTime();r.id=n;x[x.length]=r;x.sort(function(L,P){return P.zindex-L.zindex||P.added-L.added});I=x.length;r.trigger("resync");r.trigger("refresh",N,G());N.trigger("layerChange",N,r);ea++;return r}else return[].concat(x)}function p(){var n=G();if(n){if(ya||za)if(n){var r=Sa?R+(n.w>>1):R,t=Ta?S+(n.h>>1):S,L=n.w,P=n.h;if(ya&&ya>L)if(r+L>ya)R=Sa?R:ya-L;else if(r<0)R=Sa?R:0;if(za&&za>P)if(t+P>za)S=Ta?S:za-P;else if(t<0)S=Ta?S:0}kb=
R;jb=S;if(Ua.x!=n.x||Ua.y!=n.y){N.trigger("boundsChange",y());Ua.x=n.x;Ua.y=n.y}v("refresh",N,n);ea++}}function C(n,r,t,L,P){var U;if(!ec){t=false;U=wa(pa(n)/Math.LN2);n=ka(2,U)}t?nb(W,n,t,P,function(fa,Va){n=fa;if(Va){U=wa(pa(n)/Math.LN2);n=ka(2,U);L&&L()}b(n)}):b(n);return N}function v(){for(var n=N.trigger.apply(null,arguments).cancel,r=x.length;r--;)n=x[r].trigger.apply(null,arguments).cancel||n;return!n}function u(n,r,t){if(V(n,db)){if(!(t&&panSpeed===0)){R=n|0;S=r|0}}else return new T(R,S)}
a=K({container:"",captureHover:true,controls:["zoombar"],drawOnScale:true,padding:0,inertia:true,refreshDistance:256,pannable:true,scalable:true,minZoom:1,maxZoom:18,renderer:"canvas/dom",zoom:1,zoombar:{}},a);var F=[],x=[],I=0,O=null,M=null,s,D=null,Q=!V(window.attachEvent,ma),Y=false,ja=true,A=false,J=0,E=0,Z=a.refreshDistance,R=0,S=0,va=0,Wa=0,kb=0,jb=0,ya=null,za=null,Sa=false,Ta=false,Fa=a.padding,$=null,Ga=null,Gb=0,W=1,Hb=1,Ua=new T,da=null,lb={index:0,draw:false},ec=true,ea=0,Qa,Ra,fb,gb,
hb,ib,ac,bc,xa=a.zoom||a.zoomLevel,cc=Xa("quad.out"),dc=300,N={id:a.id,padding:Fa,panSpeed:0,attachFrame:function(n,r){r&&O.appendChild(n)},bounds:y,center:function(n,r,t){if(V(n,Da)){r=sb.parseXY(n).sync(N.rpp);n=r.x;r=r.y}if(V(n,db)){u(n-hb,r-ib,t);return N}else{r=u().offset(hb,ib);N.rpp&&r.sync(N.rpp,true);return r}},detach:function(){renderer&&renderer.trigger("detach");da&&da.unbind();if(M){s.removeChild(M);O=M=null}},layer:B,invalidate:function(){ea++},refresh:p,resetScale:function(){W=1},scale:C,
triggerAll:v,setMaxOffset:H,getViewport:G,offset:u,zoom:z};ia(N);N.bind("resize",function(){renderer.checkSize()});N.bind("layerRemove",function(n,r){var t=$a(x,r.id);if(t>=0&&t<I){x.splice(t,1);ea++}I=x.length});Qb(N,a,{container:o,captureHover:l,scalable:l,pannable:l,renderer:function(n){if(renderer){renderer.trigger("detach");renderer=null}q(n);ea++}});Za.init(function(){B("markers","draw",{zindex:20});o(a.container);Q?window.attachEvent("onresize",f):window.addEventListener("resize",f,false)});
Zb.attach(function(n){var r=[],t,L,P;self.panSpeed=panSpeed=oa(J)+oa(E);t=W!==Hb;if(panSpeed>0||t)ea++;if(panSpeed<2&&(oa(R-kb)>=Z||oa(S-jb)>=Z))p();lb.index++;lb.draw=ea||panSpeed||0;if(renderer&&lb.draw){va+=J;Wa+=E;if(J||E)N.trigger("pan");if(W!==1&&X.supportTransforms)r[r.length]="scale("+W+")";if(t=!ja||(a.drawOnScale||W===1)&&panSpeed<5){R=R-va/W|0;S=S-Wa/W|0;P=G();renderer.trigger("predraw",P);if(renderer.prepare(x,P,n,$)){L=Wa=t=va=ea=0;for(ii=I;ii--;){var U=x[ii];if(U.visible){var fa=U.style?
renderer.applyStyle(U.style,true):null;U.draw(renderer,P,N,n,$);fa&&renderer.applyStyle(fa)}}renderer.trigger("render",P);N.trigger("drawComplete",P,n);Hb=W;X.move(O,t,L,r)}}else X.move(O,va,Wa,r);if(A||!a.inertia)E=J=0;else if(J!=0||E!=0){J*=0.8;E*=0.8;if(oa(J)<0.5)J=0;if(oa(E)<0.5)E=0}if($){n=$?$.elements:[];if(Ga&&Ga.type==="hover"){r=Hits.diffHits(Ga.elements,n);r.length>0&&Hits.triggerEvent(Ga,N,"Out",r)}if(n.length>0){t=$.x;L=$.y;for(r=n.length;r--;){P=n[r];U=t;fa=L;var Va=P&&P.drag&&(!P.canDrag||
P.canDrag(P,U,fa));if(Va){D=P;D.startX=U;D.startY=fa}if(Va)break}Hits.triggerEvent($,N)}Ga=n.length>0?K({},$):null;$=null}}});(function(n){F=[];for(var r=0;r<n.length;r++)F[F.length]=sa("control",n[r],N,M,s,a[n[r]])})(a.controls);return N});var ta=function(a,c,b){b=K({style:null,xy:null,size:20,fill:false,stroke:true,draggable:false,observable:true,properties:{},typeName:"Shape"},b);K(this,b);if(V(this.xy,Da))this.xy=new T(this.xy);this.id="drawable_"+Yb++;this.bounds=null;this.view=a;this.layer=
c;this.rotation=this.animations=0;this.scaling=1;this.translateY=this.translateX=0;this.observable&&ia(this)};ta.prototype={constructor:ta,animate:function(a,c,b,d){Lb(this,a,c,b,d)},drag:null,draw:null,getProps:null,resync:function(){if(this.xy){this.xy.sync(this.view.rpp);if(this.size){var a=this.size>>1;this.updateBounds(new la(this.xy.x-a,this.xy.y-a,this.size,this.size))}}},rotate:function(a){this.rotation=a},scale:function(a){this.scaling=a},translate:function(a,c){this.translateX=a;this.translateY=
c},updateBounds:function(a,c){a&&(!this.bounds||a.x!=this.bounds.x||a.y!=this.bounds.y)&&this.trigger("move",this,a,this.bounds);this.bounds=a;if(c)this.xy=this.bounds.center()}};var ob=1E3/60|0,Ea=[],yb=0;ca("drawable","marker",function(a,c,b){b=K({fill:true,stroke:false,markerStyle:"simple",hoverStyle:"highlight",typeName:"Marker"},b);return new ta(a,c,b)});ca("drawable","poly",function(a,c,b){b=K({simplify:false,fill:true,points:[],typeName:"Poly"},b);var d=b.points,k=b.simplify;ta.call(this,b);
K(this,{getPoints:function(){return[].concat(d)},resync:function(){var h,j,e,i,f,g,q,l;for(h=d.length;h--;)d[h].sync(a.rpp);l=this.points=k?k(d):d;for(h=l.length;h--;){j=l[h].x;e=l[h].y;g=V(g,ma)||j<g?j:g;q=V(q,ma)||e<q?e:q;i=V(i,ma)||j>i?j:i;f=V(f,ma)||e>f?e:f}this.updateBounds(new la(g,q,i-g,f-q),true)}});this.haveData=d&&d.length>=2});ca("drawable","line",function(a,c,b){b.fill=false;return sa("drawable","poly",a,c,b)});ca("drawable","image",function(a,c,b){function d(){if(i&&i.width>0){if(!this.centerOffset)this.centerOffset=
new T(-i.width>>1,-i.height>>1);this.updateBounds(new la(this.xy.x+this.centerOffset.x,this.xy.y+this.centerOffset.y,i.width,i.height),false)}}function k(g){if(this.imageUrl=g){var q=this;Ia(this.imageUrl,function(l,m){i=l;if(m){var o=f.layer?f.layer.view:null;o&&o.invalidate()}d.apply(q)})}}b=K({image:null,imageUrl:null,centerOffset:null,typeName:"Image"},b);var h=ta.prototype.resync,j=0,e=0,i=b.image,f=K(new ta(a,c,b),{changeImage:k,getProps:function(){this.bounds||d(this,i);return{image:i,x:this.xy.x+
j,y:this.xy.y+e}},resync:function(g){h.call(this,g);d.call(this)}});i||k.call(this,this.imageUrl);if(this.centerOffset){j=this.centerOffset.x;e=this.centerOffset.y}});ca("drawable","arc",function(a,c,b){b=K({startAngle:0,endAngle:Math.PI*2,typeName:"Arc"},b);return new ta(a,c,b)});Ka.prototype={constructor:Ka,clip:null,cycle:function(){},draw:function(){},hitGuess:null,remove:function(){this.view.trigger("layerRemove",this)}};ca("layer","tile",function(a,c){c=K({generator:"osm",imageLoadArgs:{}},
c);var b=sa("generator",c.generator,c).run,d=null,k=[],h=K(new Ka(a,c),{draw:function(j,e,i){j.drawTiles&&j.drawTiles(e,d.search(e.buffer(128)),i.panSpeed<2)}});h.bind("refresh",function(j,e,i){var f=(new Date).getTime();d&&b(e,i,d,function(){e.invalidate();ha("GEN COMPLETED IN "+((new Date).getTime()-f)+" ms")})});h.bind("resync",function(){var j=a&&a.zoom?a.zoom():0;k[j]||(k[j]=tb(j));d=k[j]});return h});ca("layer","draw",function(a,c){function b(f,g,q,l){var m=this.dragOffset;if(!m)m=this.dragOffset=
new T(f.startX-this.xy.x,f.startY-this.xy.y);this.xy.x=g-m.x;this.xy.y=q-m.y;if(l){delete this.dragOffset;a.invalidate();this.trigger("dragDrop")}return true}function d(f){clearTimeout(e);e=setTimeout(function(){h.sort(function(g,q){if(q.xy&&g.xy){var l=q.xy.y-g.xy.y;return l!=0?l:q.xy.x-g.xy.x}});f&&f.invalidate()},50)}function k(f,g,q,l){l&&j.remove(l,g);j.insert(q,g)}c=K({zindex:10},c);var h=[],j,e=0,i=K(new Ka(a,c),{itemCount:0,clear:function(){j=new ub;h=[];i.itemCount=0},create:function(f,g,
q){f=sa("drawable",f,a,i,g);if(q)h.unshift(f);else h[h.length]=f;f.resync();j&&f.bounds&&j.insert(f.bounds,f);d(a);f.bind("move",k);i.itemCount=h.length;return f},draw:function(f,g,q,l,m){q={};l=j&&g?j.search(g):[];for(var o=l.length;o--;){var w=l[o],y=w.style||i.style,z,H=f.applyTransform(w),G=w.getProps?w.getProps(f):q;if(G=(z=f["prep"+w.typeName])?z.call(f,w,g,m,G):null){if(m&&G.hit){m.elements.push(Hits.initHit(w.type,w,w.draggable?b:null));z=m.type+"Style";y=w[z]||i[z]||y}y=y?f.applyStyle(y,
true):null;(z=w.draw||G.draw)&&z.call(w,G);y&&f.applyStyle(y)}H&&H.undo&&H.undo()}},find:function(){return[].concat(h)},hitGuess:function(f,g){return j&&j.search({x:f-10,y:g-10,w:20,h:20}).length>0}});i.bind("resync",function(){j=tb(a.zoom(),j);for(var f=h.length;f--;)h[f].resync()});return i});La.prototype={constructor:La};ca("control","zoombar",function(a,c,b,d){function k(v,u){var F=G[v]=X.create("div","t5-zoombar-button",{position:"absolute",background:h(v),"z-index":51,width:d.width+"px",height:d.buttonHeight+
"px","margin-top":(u||0)+"px"});B.appendChild(F)}function h(v,u){return"url("+d.images+") 0 -"+(q+m*3+(v||0)*f*3+(u||0)*f)+"px"}function j(v){return"url("+d.images+") 0 -"+(q+(v||0)*m)+"px"}function e(v,u){var F;if(v===l){l.style.background=j(u);F="thumb"}else for(var x=0;x<G.length;x++)if(v===G[x]){F="button"+x;G[x].style.background=h(x,u);break}return F}function i(v){if(v!==z){z=v;y=w-z/H*(w-o)|0;X.move(l,0,y-o);clearTimeout(p);p=setTimeout(function(){a.zoom(z)},500)}}d=K({width:24,height:200,images:"img/zoom.png",
align:"right",marginTop:10,spacing:10,thumbHeight:16,buttonHeight:16},d.zoombar);var f=d.buttonHeight,g,q=d.height,l,m=d.thumbHeight,o=d.spacing+f-(m>>1),w=d.height-f-(m>>1),y=o,z=-1;c=a.minZoom();var H=a.maxZoom()-c+1,G=[],B,p=0,C={button0:function(){a.zoom(a.zoom()+1)},button1:function(){a.zoom(a.zoom()-1)}};B=X.create("div","t5-zoombar",{position:"absolute",background:"url("+d.images+")","z-index":50,overflow:"hidden",width:d.width+"px",height:d.height+"px",margin:function(){var v=d.spacing,u=
Aa("{0}px 0 0 {1}px");if(d.align==="right")v=b.offsetWidth-d.width-d.spacing;return u(d.marginTop,v)}()});b.childNodes[0]?b.insertBefore(B,b.childNodes[0]):b.appendChild(B);B.appendChild(l=X.create("div","t5-zoombar-thumb",{position:"absolute",background:j(),"z-index":51,width:d.width+"px",height:d.thumbHeight+"px",margin:"10px 0 0 0",top:y-o+"px"}));k(0);k(1,d.height-d.buttonHeight);g=INTERACT.watch(B,{bindTarget:B});g.bind("pointerMove",function(v,u,F){y=Math.min(Math.max(o,F.y-(m>>1)),w);i(H-(y-
o)/w*H|0)});g.bind("pointerDown",function(v){e(v.target,2)});g.bind("pointerUp",function(v){e(v.target,0)});g.bind("tap",function(v){(v=C[e(v.target,2)])&&v()});c=new La(a);c.bind("detach",function(){g.unbind();b.removeChild(B)});a.bind("zoom",function(v,u){i(u)});i(a.zoom());return c});ga.prototype={constructor:ga,distanceTo:function(){if(!targetPos||this.empty()||targetPos.empty())return 0;var a=(targetPos.lat-this.lat)*na>>1,c=(targetPos.lon-this.lon)*na>>1;a=qa(a)*qa(a)+cb(this.lat*na)*cb(targetPos.lat*
na)*qa(c)*qa(c);return 6371*2*Xb(Eb(a),Eb(1-a))},equalTo:function(a){return pos&&this.lat===a.lat&&this.lon===a.lon},empty:function(){return this.lat===0&&this.lon===0},inArray:function(a){for(var c=a.length;c--;)if(this.equal(a[c]))return true;return false},offset:function(a,c){var b=this.lat*na,d=this.lon*na,k=b+a/6371;b=Wb(qa(c/6371)/cb(b));d=d+b;k=(k+Ca)%Math.PI-Ca;d%=ba;return new ga(k*Na,d*Na)},toPixels:function(){return Pa(this.lon,this.lat)},toString:function(a){return this.lat+(a||" ")+this.lon}};
var fc=function(){return{generalize:function(a,c,b){var d=a.length,k=[],h=null;b||(b=250);b/=1E3;ha("generalizing positions, must include "+c.length+" positions");for(var j=d;j--;)if(j===0)k.unshift(a[j]);else{var e=!h||a[j].inArray(c)?b:h.distanceTo(a[j]);if(a[j]&&e>=b){k.unshift(a[j]);h=a[j]}}ha("generalized "+d+" positions into "+k.length+" positions");return k},parseArray:function(a){var c=a.length,b=Array(c);for(c=c;c--;)b[c]=new ga(a[c]);return b},vectorize:function(a,c){function b(){for(var j=
0,e=c.chunkSize,i=d;i--;){k[i]=new T(a[i]);j+=1;if(j>e)break}d=i;if(d<=0)c.callback&&c.callback(k);else animFrame(b)}var d=a.length,k=Array(d);c=K({chunkSize:500,async:true,callback:null},c);if(!c.async){for(var h=d;h--;)k[h]=new T(a[h]);return k}animFrame(b);return null}}}();Ma.prototype={constructor:Ma,bestZoomLevel:function(a){var c=this.center();c=Oa(wa(oa(c.lat)*0.05),bb.length);var b=bb[c],d=this.size();c=Db(pa(bb[3]*a.h/d.y)/pa(2));a=Db(pa(b*a.w/d.x)/pa(2));return Oa(isNaN(c)?1E3:c,isNaN(a)?
1E3:a)},center:function(){var a=this.size();return new ga(this.min.lat+(a.y>>1),this.min.lon+(a.x>>1))},expand:function(a){this.min.lat-=a;this.max.lat+=a;this.min.lon-=a%360;this.max.lon+=a%360},size:function(a){var c=new T(0,this.max.lat-this.min.lat);c.x=(a||isType(a,ma))&&this.min.lon>this.max.lon?360-this.min.lon+this.max.lon:this.max.lon-this.min.lon;return c},toString:function(){return"min: "+this.min+", max: "+this.max}};var aa={ex:K,log:ha,observable:ia,formatter:Aa,wordExists:function(a,
c){for(var b=a.split(/\s|\,/).length;b--;)if(a.toLowerCase()==c.toLowerCase())return true;return false},is:V,indexOf:$a,project:Pa,unproject:eb,userMessage:pb,Registry:ab,Style:Fb,DOM:X,Rect:la,XY:T,Hits:Hits,tweenValue:nb,easing:Xa,Control:La,Tile:Ja,getImage:Ia,Pos:ga,PosFns:fc,BBox:Ma};ia(aa);ca("generator","osm",function(a){a=K({flipY:false,tileSize:256,tilePath:"{0}/{1}/{2}.png",osmDataAck:true},a);var c=Math.PI/180,b=180/Math.PI,d=null,k=[],h,j=Aa(a.tilePath),e={buildTileUrl:function(i,f,g,
q,l){if(f>=0&&f<q){i=(i%q+q)%q;f=j(g,i,l?Math.abs(f-q+1):f);if(d)f=h(k[i%(k.length||1)])+f;return f}},run:function(i,f,g,q){if(i=i.zoom?i.zoom():0){var l=2<<i-1,m=a.tileSize,o=Math.PI*2/(m<<i),w=(f.w/m|0)+1,y=(f.h/m|0)+1;f=(new T(f.x,f.y)).sync(o,true).pos();var z=f.lat;f=new T((f.lon+180)/360*l|0,(1-Math.log(Math.tan(z*c)+1/Math.cos(z*c))/Math.PI)/2*l%l|0);z=Math.PI-2*Math.PI*f.y/l;z=new ga(b*Math.atan(0.5*(Math.exp(z)-Math.exp(-z))),f.x/l*360-180);z=new T(z);z.sync(o);o=a.flipY;var H=g.search({x:z.x,
y:z.y,w:w*m,h:y*m}),G={},B;for(B=H.length;B--;)G[H[B].id]=true;k=(d=e.getServerDetails?e.getServerDetails():null)&&d.subDomains?d.subDomains:[];h=Aa(d?d.baseUrl:"");for(H=0;H<=w;H++)for(B=0;B<=y;B++){var p=f.x+H,C=f.y+B,v=p+"_"+C;if(!G[v]){tileUrl=e.buildTileUrl(p,C,i,l,o);p=new Ja(z.x+H*m,z.y+B*m,tileUrl,m,m,v);g.insert(p,p)}}q&&q()}}};a.osmDataAck&&pb("ack","osm",'Map data (c) <a href="http://openstreetmap.org/" target="_blank">OpenStreetMap</a> (and) contributors, CC-BY-SA');return e});aa.Cloudmade=
function(){aa.Registry.register("generator","osm.cloudmade",function(a){a=aa.ex({apikey:null,styleid:1},a);var c=aa.formatter("http://{3}.tile.cloudmade.com/{0}/{1}/{2}/");aa.userMessage("ack","osm.cloudmade",'This product uses the <a href="http://cloudmade.com/" target="_blank">CloudMade</a> APIs, but is not endorsed or certified by CloudMade.');return aa.ex(aa.Registry.create("generator","osm",a),{getServerDetails:function(){return{baseUrl:c(a.apikey,a.styleid,256,"{0}"),subDomains:["a","b","c"]}}})})}();
mb.T5=aa;mb.Tile5=function(a,c){c=K({container:a,type:"map",renderer:"canvas",starpos:null,zoom:1,fastpan:false,drawOnScale:true,zoombar:{}},c);return sa("view",c.type,c)}})(window);
