(function(rb){function D(){var a=arguments[0]||{},c=Array.prototype.slice.call(arguments,1),b=c.length,f,g;for(g=0;g<b;g++)if((f=c[g])!==null)for(var i in f){var h=f[i];if(a!==h)if(h!==undefined)a[i]=h}return a}function oa(a,c){if(typeof console!=="undefined")console[c||"debug"](a)}function za(a){var c=a.match(Lb),b=[],f=0,g;for(g=c?c.length:0;g--;){var i=c[g].slice(1);b[i]||(b[i]=RegExp("\\{"+i+"\\}","g"))}f=b.length;return function(){var h=a;for(g=0;g<f;g++){var k=arguments[g];if(typeof k=="undefined")k=
"";h=h.replace(b[g],k)}return h}}function sb(a,c,b){fa.trigger("userMessage",a,c,b)}function tb(a,c){var b=Ra*ka(a);return Sa-2*ub(c*Aa((1-b)/(1+b),Ra/2))}function T(a,c){if(N(a,pa)){var b=a.split(eb);this.x=parseFloat(b[0]);this.y=parseFloat(b[1])}else if(a&&a.x){this.x=a.x;this.y=a.y}else{this.x=a||0;this.y=c||0}}function ia(a,c,b,f){this.mercX=b;this.mercY=f;if(N(a,pa))D(this,Mb.parseXY(a));else a&&a.toPixels?D(this,a.toPixels()):T.call(this,a,c)}function ua(a,c,b,f){this.x=a||0;this.y=c||0;this.w=
b||0;this.h=f||0;this.x2=this.x+this.w;this.y2=this.y+this.h}function vb(a,c){if(!a)return null;c=c||Nb;for(var b=[],f=null,g=a.length;g--;){var i=a[g];if(include=!f||g===0||la(i.x-f.x)+la(i.y-f.y)>c){b.unshift(i);f=i}}return b}function wb(a,c){var b=new xb(Math.sqrt(256<<a)|0);c&&c.zoomLevel===a&&c.copyInto(b);b.zoomLevel=a;return b}function Ta(a,c,b,f,g,i){this.x=a;this.y=c;this.w=f||256;this.h=f||256;this.x2=this.x+this.w;this.y2=this.y+this.h;this.url=b;this.id=i||a+"_"+c;this.loaded=false;this.image=
null}function Ua(a,c){c=D({id:"layer_"+Ob++,zindex:0,animated:false,style:null,minXY:null,maxXY:null},c);this.visible=true;this.view=a;va(D(this,c))}function Va(){va(this)}function ja(a,c){if(a&&a.split){var b=a.split(eb);if(b.length>1){a=b[0];c=b[1]}}else if(a&&a.lat){c=a.lon;a=a.lat}this.lat=parseFloat(a||0);this.lon=parseFloat(c||0)}function Ia(a,c){if(N(a,yb)){for(var b=c,f=new ja(fb,Wa),g=new ja(Pb,zb),i=a.length;i--;){var h=a[i];if(h.lat<f.lat)f.lat=h.lat;if(h.lat>g.lat)g.lat=h.lat;if(h.lon<
f.lon)f.lon=h.lon;if(h.lon>g.lon)g.lon=h.lon}this.min=f;this.max=g;if(N(b,wa)){b=this.size();b=Ja(b.x,b.y)*0.3}this.expand(b)}else{this.min=a;this.max=c}}function gb(a){if(!N(a,pa))this.meters=a}var Lb=/\{(\d+)(?=\})/g,Qb=function(){var a=1.70158,c=Math.PI/2,b=Math.abs,f=Math.pow,g=Math.sin,i=Math.asin,h=Math.cos,k={linear:function(d,j,e,l){return e*d/l+j},backin:function(d,j,e,l){return e*(d/=l)*d*((a+1)*d-a)+j},backout:function(d,j,e,l){return e*((d=d/l-1)*d*((a+1)*d+a)+1)+j},backinout:function(d,
j,e,l){return(d/=l/2)<1?e/2*d*d*(((a*=1.525)+1)*d-a)+j:e/2*((d-=2)*d*(((a*=1.525)+1)*d+a)+2)+j},bouncein:function(d,j,e,l){return e-k.bounceout(l-d,0,e,l)+j},bounceout:function(d,j,e,l){return(d/=l)<1/2.75?e*7.5625*d*d+j:d<2/2.75?e*(7.5625*(d-=1.5/2.75)*d+0.75)+j:d<2.5/2.75?e*(7.5625*(d-=2.25/2.75)*d+0.9375)+j:e*(7.5625*(d-=2.625/2.75)*d+0.984375)+j},bounceinout:function(d,j,e,l){return d<l/2?k.bouncein(d*2,0,e,l)/2+j:k.bounceout(d*2-l,0,e,l)/2+e/2+j},cubicin:function(d,j,e,l){return e*(d/=l)*d*d+
j},cubicout:function(d,j,e,l){return e*((d=d/l-1)*d*d+1)+j},cubicinout:function(d,j,e,l){if((d/=l/2)<1)return e/2*d*d*d+j;return e/2*((d-=2)*d*d+2)+j},elasticin:function(d,j,e,l,m,o){if(d==0)return j;if((d/=l)==1)return j+e;o||(o=l*0.3);if(!m||m<b(e)){m=e;e=o/4}else e=o/$*i(e/m);return-(m*f(2,10*(d-=1))*g((d*l-e)*$/o))+j},elasticout:function(d,j,e,l,m,o){var n;if(d==0)return j;if((d/=l)==1)return j+e;o||(o=l*0.3);if(!m||m<b(e)){m=e;n=o/4}else n=o/$*i(e/m);return m*f(2,-10*d)*g((d*l-n)*$/o)+e+j},elasticinout:function(d,
j,e,l,m,o){var n;if(d==0)return j;if((d/=l/2)==2)return j+e;o||(o=l*0.3*1.5);if(!m||m<b(e)){m=e;n=o/4}else n=o/$*i(e/m);if(d<1)return-0.5*m*f(2,10*(d-=1))*g((d*l-n)*$/o)+j;return m*f(2,-10*(d-=1))*g((d*l-n)*$/o)*0.5+e+j},quadin:function(d,j,e,l){return e*(d/=l)*d+j},quadout:function(d,j,e,l){return-e*(d/=l)*(d-2)+j},quadinout:function(d,j,e,l){if((d/=l/2)<1)return e/2*d*d+j;return-e/2*(--d*(d-2)-1)+j},sinein:function(d,j,e,l){return-e*h(d/l*c)+e+j},sineout:function(d,j,e,l){return e*g(d/l*c)+j},sineinout:function(d,
j,e,l){return-e/2*(h(Math.PI*d/l)-1)+j}};return function(d){d=d.replace(/[\-\_\s\.]/g,"").toLowerCase();return k[d]||k.linear}}(),va=function(){function a(b,f){var g=b.hasOwnProperty("obsHandlers")?b.obsHandlers:null;g[f]||(g[f]=[]);return g[f]}var c=0;return function(b){if(!b)return null;if(!(b.hasOwnProperty("obsHandlers")?b.obsHandlers:null))b.obsHandlers={};if(!b.hasOwnProperty("bind")){b.bind=function(f,g){var i="callback"+c++;a(b,f).unshift({fn:g,id:i});return i};b.triggerCustom=function(f,
g){var i=a(b,f),h={cancel:false,name:f,source:this},k;for(k in g)h[k]=g[k];if(!i)return null;k=Array.prototype.slice.call(arguments,2);b.eventInterceptor&&b.eventInterceptor(f,h,k);k.unshift(h);for(var d=i.length;d--&&!h.cancel;)i[d].fn.apply(this,k);return h};b.trigger=function(f){var g=Array.prototype.slice.call(arguments,1);g.splice(0,0,f,null);return b.triggerCustom.apply(this,g)};b.unbind=function(f,g){if(typeof f==="undefined")b.obsHandlers={};else for(var i=a(b,f),h=0;i&&h<i.length;h++)if(i[h].id===
g){i.splice(h,1);break}return b}}return b}}(),hb=function(){function a(c,b,f,g){if(typeof c[g]=="undefined")c[g]=function(i){if(typeof i!="undefined"){b[g]=i;f[g]&&f[g](i);return c}else return b[g]}}return function(c,b,f){b=b||c;for(var g in b)typeof b[g]!="function"&&a(c,b,f,g);return c}}(),ib=Array.prototype.indexOf||function(a){for(var c=0;c<this.length;c++)if(this[c]===a)return c;return-1},N=function(){var a={NaN:1,Infinity:1,"-Infinity":1},c=String.prototype.toLowerCase,b=Object.prototype.toString;
return function(f,g){g=c.call(g);if(g=="finite")return!a.hasOwnProperty(+f);return g=="null"&&f===null||g==typeof f||g=="object"&&f===Object(f)||g=="array"&&Array.isArray&&Array.isArray(f)||b.call(f).slice(8,-1).toLowerCase()==g}}();(function(){function a(g){var i=document.createElement("script"),h=false;i.src=g;i.async=true;i.onload=i.onreadystatechange=function(){if(!h&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){h=true;i.onload=i.onreadystatechange=null;i&&i.parentNode&&
i.parentNode.removeChild(i)}};b||(b=document.getElementsByTagName("head")[0]);b.appendChild(i)}var c=0,b,f=this;return function(g,i,h){g+=g.indexOf("?")>=0?"&":"?";var k="json"+ ++c;f[k]=function(d){i(d);f[k]=null;try{delete f[k]}catch(j){}};a(g+(h?h:"callback")+"="+k);return k}})();INTERACT=function(){function a(m){return function(o,n){m.addEventListener(o,n,false)}}function c(m){return function(o,n){m.removeEventListener(o,n,false)}}function b(m){return function(o,n){m.attachEvent("on"+o,n)}}function f(m,
o){return{x:m?m:0,y:o?o:0,count:1}}function g(m,o){e.push(D({handler:null,checks:{},type:m},o))}function i(m){var o=0,n=0;if(m.offsetParent){do{o+=m.offsetLeft;n+=m.offsetTop;m=m.offsetParent}while(m)}return{left:o,top:n}}function h(m,o){return{source:m,target:o.target?o.target:o.srcElement}}function k(m,o){for(var n=m.target?m.target:m.srcElement;n&&n!==o;)n=n.parentNode;return n&&n===o}function d(m,o){return{x:m.x-(o?o.left:0),y:m.y-(o?o.top:0)}}function j(m,o){if(m.preventDefault){m.preventDefault();
m.stopPropagation()}else if(typeof m.cancelBubble!="undefined")m.cancelBubble=true;o&&m.stopImmediatePropagation&&m.stopImmediatePropagation()}var e=[],l=function(m,o,n){n=D({binder:null,unbinder:null,observable:null},n);for(var v=n.observable,x=[],z,E,K={bind:function(){return v.bind.apply(null,arguments)},unbind:function(){v.unbind();for(p=0;p<x.length;p++)x[p].unbind();return K}},p=0;p<o.length;p++)x.push(o[p](m,v,n));v.bind("pointerDown",function(){E=z=0});v.bind("pointerMove",function(A,C,u,
B){z+=B.x||0;E+=B.y||0});v.bind("pointerUp",function(A,C,u){Math.abs(z)>20||Math.abs(E)>20||v.triggerCustom("tap",A,C,u)});return K};g("pointer",{handler:function(m,o,n){function v(s){if(s.pageX&&s.pageY)return f(s.pageX,s.pageY);else{var L=document.documentElement,P=document.body;return f(s.clientX+(L&&L.scrollLeft||P&&P.scrollLeft||0)-(L&&L.clientLeft||P&&P.clientLeft||0),s.clientY+(L&&L.scrollTop||P&&P.scrollTop||0)-(L&&L.clientTop||P&&P.clientTop||0))}}function x(s){if(k(s,m))if(B=p(s)){var L=
v(s);m.style.cursor="move";j(s,true);S=L.x;M=L.y;w=f(S,M);o.triggerCustom("pointerDown",h("mouse",s),w,d(w,i(m)))}}function z(s){var L=v(s);G=L.x;R=L.y;if(k(s,m))A(s,B?"pointerMove":"pointerHover")}function E(s){if(B&&p(s)){B=false;if(k(s,m)){m.style.cursor="default";A(s,"pointerUp")}}}function K(s){if(k(s,m)){var L;s=s||window.event;if(s.detail){if(typeof s.axis=="undefined"||s.axis===2)L=-s.detail*C}else{L=s.wheelDeltaY?s.wheelDeltaY:s.wheelDelta;if(window.opera)L=-L}if(L){var P=f(G,R);o.triggerCustom("zoom",
h("mouse",s),P,d(P,i(m)),L/u,"wheel");j(s);s.returnValue=false}}}function p(s){s=s||window.event;return(s.which||s.button)==1}function A(s,L,P,da,ma){P=typeof P!="undefined"?P:G;da=typeof da!="undefined"?da:R;var y=P-S,F=da-M,I=f(P,da);o.triggerCustom(L,h("mouse",s),I,d(I,i(m)),f(y,F));if(typeof ma=="undefined"||ma){S=P;M=da}}n=D({},n);var C=120,u=C*8,B=false,w,G,R,S,M;n.binder("mousedown",x);n.binder("mousemove",z);n.binder("mouseup",E);n.binder("dblclick",function(s){oa("captured double click");
if(k(s,m)){var L=v(s);o.triggerCustom("doubleTap",h("mouse",s),L,d(L,i(m)))}});n.binder("mousewheel",K);n.binder("DOMMouseScroll",K);return{unbind:function(){n.unbinder("mousedown",x);n.unbinder("mousemove",z);n.unbinder("mouseup",E);n.unbinder("mousewheel",K);n.unbinder("DOMMouseScroll",K)}}},checks:{touch:false}});g("pointer",{handler:function(m,o,n){function v(y){if(y.count<2)return 0;var F=y.x-y.next.x;y=y.y-y.next.y;return~~Math.sqrt(F*F+y*y)}function x(y,F,I){F=F?F:0;I=I?I:0;for(var O={x:y.x-
F,y:y.y-I,id:y.id,count:y.count},Q=O;y.next;){y=y.next;Q=Q.next={x:y.x-F,y:y.y-I,id:y.id}}return O}function z(y,F){var I=y[F?F:"touches"],O,Q;if(I.length===0)return null;Q=O={x:I[0].pageX,y:I[0].pageY,id:I[0].identifier,count:I.length};for(var aa=1,Da=I.length;aa<Da;aa++)Q=Q.next={x:I[aa].pageX,y:I[aa].pageY,id:I[aa].identifier};return O}function E(y){if(k(y,m)){R=i(m);var F=z(y,"changedTouches"),I=x(F,R.left,R.top);if(!M){S=B;o.triggerCustom("pointerDown",h("touch",y),F,I)}da&&o.triggerCustom("pointerDownMulti",
h("touch",y),F,I);M=z(y);if(M.count>1)L=v(M);ma=1;P=x(M)}}function K(y){if(k(y,m)){j(y);s=z(y);if(S==B)S=Math.abs(M.x-s.x)>C||Math.abs(M.y-s.y)>C?u:B;if(S!=B){S=s.count>1?G:w;if(S==G)if(M.count===1){M=x(s);L=v(M)}else{var F=v(s);if(Math.abs(L-F)<A)S=w;else{var I;I=s.x;var O=s.next.x,Q=s.y,aa=s.next.y;I={x:(I<O?I:O)+(Math.abs(I-O)>>1),y:(Q<aa?Q:aa)+(Math.abs(Q-aa)>>1)};F=F/L;O=F-ma;o.triggerCustom("zoom",h("touch",y),I,d(I,R),O,"pinch");ma=F}}S==w&&o.triggerCustom("pointerMove",h("touch",y),s,x(s,
R.left,R.top),f(s.x-P.x,s.y-P.y));da&&o.triggerCustom("pointerMoveMulti",h("touch",y),s,x(s,R.left,R.top))}P=x(s)}}function p(y){if(k(y,m)){var F=z(y,"changedTouches"),I=x(F,R.left,R.top);s=z(y);if(!s){o.triggerCustom("pointerUp",h("touch",y),F,I);M=null}da&&o.triggerCustom("pointerUpMulti",h("touch",y),F,I)}}n=D({detailed:false,inertia:false},n);var A=20,C=7,u=0,B=1,w=2,G=3,R,S,M,s,L,P,da=n.detailed,ma=1;n.binder("touchstart",E);n.binder("touchmove",K);n.binder("touchend",p);oa("initialized touch handler");
return{unbind:function(){n.unbinder("touchstart",E);n.unbinder("touchmove",K);n.unbinder("touchend",p)}}},checks:{touch:true}});return{register:g,watch:function(m,o,n){o=D({bindTarget:null,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},o);capabilities=D({touch:"ontouchstart"in window},n);if(!o.observable){oa("creating observable");o.observable=va({});globalOpts=o}o.binder=(o.isIE?b:a)(o.bindTarget||document);o.unbinder=(o.isIE?b:c)(o.bindTarget||document);n=o.types;for(var v=
capabilities,x=[],z=e.length;z--;){var E=e[z],K=!n||n.indexOf(E.type)>=0,p=true,A;for(A in E.checks){var C=E.checks[A];oa("checking "+A+" capability. require: "+C+", capability = "+v[A]);p=p&&C===v[A]}if(K&&p)x[x.length]=E.handler}return new l(m,x,o)}}}();var fa=va({}),Xa=function(){var a={};return{create:function(c,b){if(a[c][b])return a[c][b].apply(null,Array.prototype.slice.call(arguments,2));throw Rb(c,b);},get:function(c,b){return a[c]?a[c][b]:null},register:function(c,b,f){a[c]||(a[c]={});a[c][b]&&
oa(Sb(c,b),"warn");a[c][b]=f}}}(),Sb=za("Registration of {0}: {1} will override existing definition"),Rb=za("Could not create {0} of type: {1}");za("Could not create drawable of type: {0}");var jb=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],$=Math.PI*2,Sa=Math.PI/2,Nb=3,ba=Math.PI/180,na=180/Math.PI,fb=90,Pb=-fb,Wa=180,zb=-Wa,kb=fb*ba,Ab=-kb,Bb=Wa*ba,Tb=-Bb,Ra=0.08181919084262157,la=Math.abs,Cb=Math.ceil,Ka=Math.round,Ya=Math.min,Ja=Math.max,Aa=Math.pow,
lb=Math.sqrt,Ba=Math.log,ka=Math.sin,Db=Math.asin,Ea=Math.cos,ub=Math.atan,Ub=Math.atan2,wa="undefined",pa="string",Vb="object",qa="number",yb="array",Y=Xa.register,xa=Xa.create,Wb=Xa.get,Xb=0,Ob=0,eb=/[\,\s]+/,Fa=function(){function a(h){g++;h=h||(new Date).getTime();for(var k=f.length;k--;){var d=f[k];g%d.every===0&&d.cb(h)}i&&animFrame(a)}var c=1E3/60,b=["r","webkitR","mozR","oR","msR"],f=[],g=0,i=function(){for(var h=0;h<b.length;h++)window.animFrame=window.animFrame||window[b[h]+"equestAnimationFrame"];
window.animFrame&&oa("Using request animation frame");return animFrame}();i?animFrame(a):setInterval(a,1E3/60);return{attach:function(h,k){f[f.length]={cb:h,every:k?Ka(k/c):1}},detach:function(h){for(var k=f.length;k--;)if(f[k].cb===h){f.splice(k,1);break}}}}(),Mb=function(){var a=/^xy\((.*)\).*$/i;return{parseXY:function(c){if(!a.test(c)){c=c.split(eb);return Za(c[1],c[0])}}}}(),X=function(){function a(g){for(var i=0;i<g.length;i++){var h=g[i];if(typeof document.body.style[h]!="undefined")return h}}
var c={"-webkit-user-select":"none",position:"absolute"},b,f;b=a(["-webkit-transform","MozTransform"]);css3DTransformProp=a(["WebkitPerspective","MozPerspective"]);f=a(["-webkit-transform-origin","MozTransformOrigin"]);return{transforms:N(b,pa),create:function(g,i,h){g=document.createElement(g);var k=[];h=h||{};g.className=i||"";for(var d in h)k[k.length]=d+": "+h[d];g.style.cssText=k.join(";");return g},move:function(g,i,h,k,d){if(b){g.style[b]="translate("+i+"px, "+h+"px) "+(k||[]).join(" ");if(d&&
f)g.style[f]=d.x+"px "+d.y+"px"}else{g.style.left=i+"px";g.style.top=h+"px"}},styles:function(g){return D({},c,g)}}}(),Eb=function(){function a(){for(var g=f.length,i=g;i--;)try{f[i](g)}catch(h){oa(h.toString(),"error")}}var c=20,b=50,f=[];return{process:function(g,i,h){function k(e){e=(d||b)/e;if(j<g.length){var l=g.slice(j,j+e);e=l.length;var m=d?0:(new Date).getTime();i(l,e);if(!d){d=(l=((new Date).getTime()-m)/e)?c/l|0:g.length;oa("calculated that we can process "+d+" items per cycle")}j+=e}else{for(e=
f.length;e--;)if(f[e]===k){f.splice(e,1);break}f.length===0&&Fa.detach(a);h&&h()}}var d,j=0;f.push(k)===1&&Fa.attach(a)}}}(),Za=Za||function(a,c){var b=parseFloat(c)*ba;b=ka(b);var f=Ra*b;b=Ba((1+b)/(1-b)*Aa((1-f)/(1+f),Ra))/2;return new ia(0,0,parseFloat(a)*ba,b)},mb=mb||function(a,c){for(var b=Aa(Math.E,-c),f=Sa-2*ub(b),g=tb(f,b),i=0;i<12&&la(f-g)>1.0E-7;){f=g;g=tb(f,b);i++}return new ja(g*na,a%360*na)};T.prototype={constructor:T,add:function(){for(var a=this.x,c=this.y,b=arguments.length;b--;){a+=
arguments[b].x;c+=arguments[b].y}return this.copy(a,c)},copy:function(a,c){var b=D({},this);b.x=a||b.x;b.y=c||b.y;return b},equals:function(a){return this.x===a.x&&this.y===a.y},offset:function(a,c){return this.copy(this.x+a,this.y+c)},relative:function(a){a=a.viewport();return this.copy(this.x-a.x-a.padding.x,this.y-a.y-a.padding.y)},rotate:function(a,c){c=c||new T(0,0);var b=this.x-c.x,f=this.y-c.y;return new T(c.x+Ea(a)*b+-ka(a)*f,c.y+ka(a)*b+Ea(a)*f)},scale:function(a,c){c=c||new T(0,0);return new T(c.x+
(this.x-c.x)*a,c.y+(this.y-c.y)*a)},sync:function(){return this},toString:function(){return this.x+", "+this.y}};ia.prototype=D(new T,{constructor:ia,pos:function(){return mb(this.mercX,this.mercY)},sync:function(a,c){var b;if(!(b=a.rpp)){b=a.zoom();b=$/(256<<b)}b=b;if(c){this.mercX=this.x*b-Math.PI;this.mercY=Math.PI-this.y*b}else{this.x=Ka(((this.mercX||0)+Math.PI)/b);this.y=Ka((Math.PI-(this.mercY||0))/b)}return this}});ua.prototype={constructor:ua,buffer:function(a,c){return new ua(this.x-a,this.y-
(c||a),this.w+a*2,this.h+(c||a)*2)},center:function(){return new T(this.x+(this.w>>1),this.y+(this.h>>1))}};Y("fn","simplify",vb);Hits=function(){return{diffHits:function(a,c){var b=[],f={},g;for(g=c.length;g--;)f[c[g].target.id]=true;for(g=a.length;g--;)f[a[g].target.id]||(b[b.length]=a[g]);return b},init:function(a,c,b,f,g){return{type:a,x:g.x,y:g.y,gridX:f.x|0,gridY:f.y|0,elements:[],absXY:c,relXY:b}},initHit:function(a,c,b){return{type:a,target:c,drag:b}},triggerEvent:function(a,c,b,f){c.triggerCustom(a.type+
(b?b:"Hit"),{hitType:a.type},f?f:a.elements,a.absXY,a.relXY,new ia(a.gridX,a.gridY))}}}();var xb=function(a){function c(i,h){var k=b[i],d;k||(k=b[i]=[]);(d=k[h])||(d=k[h]=[]);return d}a=a||128;var b=[],f={},g=0;return{copyInto:function(i){for(var h in f){var k=f[h];i.insert(k.bounds||k,k,h)}},insert:function(i,h,k){var d=i.x/a|0,j=i.y/a|0,e=(i.x+i.w)/a|0;i=(i.y+i.h)/a|0;k=k||h.id||"obj_"+g++;f[k]=h;for(h=d;h<=e;h++)for(d=j;d<=i;d++)c(h,d).push(k)},remove:function(i,h,k){k=k||h.id;if(f[k]){var d=i.x/
a|0;h=i.y/a|0;var j=(i.x+i.w)/a|0;i=(i.y+i.h)/a|0;delete f[k];for(d=d;d<=j;d++)for(var e=h;e<=i;e++){var l=c(d,e),m=ib.call(l,k);m>=0&&l.splice(m,1)}}},search:function(i){var h=i.y/a|0,k=(i.x+i.w)/a|0,d=(i.y+i.h)/a|0,j=[],e=[];for(i=i.x/a|0;i<=k;i++)for(var l=h;l<=d;l++)j=j.concat(c(i,l));j.sort();for(h=j.length;h--;){k=j[h];if(d=f[k])e[e.length]=d;for(;h>0&&j[h-1]==k;)h--}return e}}},$a=function(){var a={},c=0;(new Date).getTime();var b={},f=[];Fa.attach(function(g){g=g||(new Date).getTime();for(var i=
0;i<f.length;){var h=f[i],k=b[h],d=b[h].image&&b[h].image.complete&&b[h].image.width>0,j=g-k.start;j=d||j>=3E4;if(d){d=k.callbacks;a[h]=k.image;for(var e=0;e<d.length;e++)d[e](k.image,true)}if(j){f.splice(i,1);delete b[h]}else i++}},250);return function(g,i){var h=g&&i?a[g]:null;if(h&&h&&h.complete&&h.width>0)i(h);else if(h=b[g])h.callbacks.push(i);else{h=new Image;h.id="_ldimg"+ ++c;b[g]={start:(new Date).getTime(),image:h,callbacks:[i]};h.src=g;f[f.length]=g}}}();Ta.prototype={constructor:Ta,load:function(a){var c=
this;$a(this.url,function(b){c.loaded=true;c.image=b;a&&a()})}};var Yb=function(){return va({fastpan:true,applyStyle:function(){},applyTransform:function(a,c,b){return{restore:null,x:c,y:b}},getDimensions:function(){return{width:0,height:0}},getViewport:function(){},hitTest:function(){return false},prepare:function(){},projectXY:null,reset:function(){}})};Y("renderer","canvas",function(a,c,b,f,g){function i(p,A,C){var u,B;o[A]=function(w){for(u=E.length;u--;)if(B=C[E[u]])w[K[u]]=B}}function h(p,A,
C){return{draw:C||z,viewport:p,hit:A&&e.isPointInPath(A.x,A.y),vpX:l,vpY:m,context:e}}f=D({},f);var k,d,j,e,l=0,m=0,o={},n=null,v={},x=function(){},z=function(){this.fill&&e.fill();this.stroke&&e.stroke()},E=["fill","stroke","lineWidth","opacity"],K=["fillStyle","strokeStyle","lineWidth","globalAlpha"];if(c){k=c.offsetWidth;d=c.offsetHeight;j=X.create("canvas",null,{position:"absolute","z-index":1});j.width=k;j.height=d;a.attachFrame(j,true);e=null}b=D(g,{applyStyle:function(p){var A=o[p],C=e&&e.canvas?
e.canvas.id:"default",u;v[C]||(v[C]=[]);u=v[C].pop()||"reset";if(A){v[C].push(p);A(e);return u}},applyTransform:function(p){if(p.translateX!==0||p.translateY!==0||p.scaling!==1||p.rotation!==0){e.save();n={undo:function(){e.restore();n=null},x:p.xy.x,y:p.xy.y};e.translate(p.xy.x-l+p.translateX,p.xy.y-m+p.translateY);p.rotation!==0&&e.rotate(p.rotation);p.scaling!==1&&e.scale(p.scaling,p.scaling)}return n},drawTiles:function(p,A,C){for(var u=A.length;u--;){p=A[u];if(!p.loaded&&C)p.load(a.invalidate);
else p.image&&e.drawImage(p.image,p.x-l,p.y-m)}},prepare:function(p,A){var C,u=false;if(e)e.restore();else e=j.getContext("2d");for(C=p.length;C--;)u=u||p[C].clip;l=A.x;m=A.y;if(e){u||e.clearRect(0,0,k,d);e.save()}e.globalCompositeOperation="source-over";return e},prepArc:function(p,A,C){e.beginPath();e.arc(p.xy.x-(n?n.x:l),p.xy.y-(n?n.y:m),p.size>>1,p.startAngle,p.endAngle,false);return h(A,C)},prepImage:function(p,A,C,u){var B=(u.x||p.xy.x)-(n?n.x:l),w=(u.y||p.xy.y)-(n?n.y:m),G=u.image||p.image;
if(G){e.beginPath();e.rect(B,w,u.width||G.width,u.height||G.height);return h(A,C,function(){e.drawImage(G,B,w,u.width||G.width,u.height||G.height)})}},prepMarker:function(p,A,C){var u=p.xy.x-(n?n.x:l),B=p.xy.y-(n?n.y:m),w=p.size,G=undefined;e.beginPath();switch(p.markerType.toLowerCase()){case "image":G=x;e.rect(u-(w>>1),B-(w>>1),w,w);if(p.reset&&p.image){p.image=null;p.reset=false}p.image?e.drawImage(p.image,u-(w>>1),B-(w>>1),w,w):$a(p.imageUrl,function(R){p.image=R;e.drawImage(p.image,u-(w>>1),
B-(w>>1),w,w)});break;default:e.moveTo(u,B);e.lineTo(u-(w>>1),B-w);e.lineTo(u+(w>>1),B-w);e.lineTo(u,B)}return h(A,C,G)},prepPoly:function(p,A,C,u){var B=true;p=u.points||p.points;u=n?n.x:l;var w=n?n.y:m;e.beginPath();for(var G=p.length;G--;){var R=p[G].x-u,S=p[G].y-w;if(B){e.moveTo(R,S);B=false}else e.lineTo(R,S)}return h(A,C)},getContext:function(){return e}});(function(){Fb.each(function(p,A){i(null,p,A)});fa.bind("styleDefined",i)})();b.bind("detach",function(){c.removeChild(j)});b.bind("resize",
function(){});return b});Y("renderer","dom",function(a,c,b,f,g){function i(e){var l=e.image=new Image;d[e.id]=e;l.src=e.url;l.onload=function(){if(j[e.id])k.appendChild(this);else e.image=null};l.style.cssText="-webkit-user-select: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute;";
return l}function h(e,l,m){var o=[],n;for(n in e){var v=e[n];if(m?v[m]:!l[n]){if(v.image&&v.image.parentNode){k.removeChild(v.image);v.image=null}o[o.length]=n}}for(l=o.length;l--;)delete e[o[l]]}var k=null,d={},j={};k=X.create("div","",X.styles({width:c.offsetWidth+"px",height:c.offsetHeight+"px"}));c.childNodes.length>0?c.insertBefore(k,c.childNodes[0]):c.appendChild(k);a.attachFrame(k);b=D(g,{drawTiles:function(e,l,m){for(var o,n=e.x,v=e.y,x=l.length;x--;){e=l[x];if(e.url){(o=e.image||(m?i(e):
null))&&X.move(o,e.x-n,e.y-v);j[e.id]=e}}}});b.bind("predraw",function(){h(d,j);j={}});b.bind("detach",function(){c.removeChild(k)});a.bind("reset",function(){for(h(d,j={});k.childNodes.length>0;)k.removeChild(k.childNodes[0])});return b});var Fb=function(){function a(b,f){if(N(b,pa)){fa.trigger("styleDefined",b,c[b]=f);return b}else{var g=[],i;for(i in b)g[g.length]=a(i,b[i]);return g}}var c={};a({reset:{fill:"#ffffff",opacity:1},highlight:{fill:"#ff0000"},waypoints:{lineWidth:4,stroke:"#003377",
fill:"#ffffff"},waypointsHover:{lineWidth:4,stroke:"#ff0000",fill:"#ffffff"}});return{resetStyle:"reset",each:function(b){for(var f in c)b(f,c[f])},get:function(b){return c[b]},define:a}}();Y("view","view",function(a){function c(q,r,t,H){p(Ja(U+Aa(2,H)-1,0.125),false,true)}function b(q,r){var t=V&&V.projectXY?V.projectXY(q,r):null;if(!t){t=z();var H=1/U;t=new J.XY(t?t.x+q*H:q,t?t.y+r*H:r)}return t.sync(J,true)}function f(q,r,t){A("doubleTap",r,t,b(t.x,t.y));a.scalable&&p(2,{easing:"quad.out",duration:300},
true)}function g(q,r,t){s=null;ma=true;v("down",r,t)}function i(q,r,t){v("hover",r,t)}function h(q,r,t,H){m(r,t,false);if(!s){y=H.x;F=H.y}}function k(q,r,t){m(r,t,true);ma=false}function d(){clearTimeout(Gb);Gb=setTimeout(function(){if(M)if(M.offsetWidth!==La*2||M.offsetHeight!==Ma*2){var q=x();n(a.container);x(q.x,q.y)}},250)}function j(q,r,t){v("tap",r,t);J.trigger("tap",r,t,b(t.x,t.y,true))}function e(){ga&&ga.unbind();if(V){ga=INTERACT.watch(V.interactTarget||M);if(a.scalable){ga.bind("zoom",
c);ga.bind("doubleTap",f)}ga.bind("pointerDown",g);ga.bind("pointerMove",h);ga.bind("pointerUp",k);a.captureHover&&ga.bind("pointerHover",i);ga.bind("tap",j)}}function l(q){if(V){V.trigger("detach");V=null}var r=J,t=R,H=M,W=a;q=q.split("/");for(var Z=new Yb(r,t,H,W),ra=0;ra<q.length;ra++)Z=xa("renderer",q[ra],r,t,H,W,Z);V=Z;da=V.fastpan&&X.transforms;e();J.trigger("reset");K()}function m(q,r,t){if(s){q=b(r.x,r.y);s.drag.call(s.target,s,q.x,q.y,t)&&ca++;if(t)s=null}}function o(q){for(var r=G;r--;)if(w[r].id===
q)return r;return G}function n(q){M=document.getElementById(q);M.appendChild(S=X.create("div","",X.styles({overflow:"hidden",width:M.offsetWidth+"px",height:M.offsetHeight+"px"})));q=a.padding;if(q===u){q=M.offsetWidth;var r=M.offsetHeight,t=lb(q*q+r*r);ha=new T(t-q>>1,t-r>>1)}else ha=new T(q,q);ab=S.offsetWidth+ha.x*2;bb=S.offsetHeight+ha.y*2;nb=ab/2;ob=bb/2;La=M.offsetWidth/2;Ma=M.offsetHeight/2;Na=new T(nb,ob);S.appendChild(R=X.create("div","",X.styles({width:ab+"px",height:bb+"px","z-index":2,
margin:-ha.y+"px 0 0 "+-ha.x+"px"})));l(a.renderer);q=a.controls;for(r=0;r<B.length;r++)B[r].trigger("detach");B=[];for(r=0;r<q.length;r++)B[B.length]=xa("control",q[r],J,S,M,a[q[r]])}function v(q,r,t){var H=(new T(t.x-La+nb,t.y-Ma+ob)).rotate(-sa*ba,Na).scale(1/U,Na);ea=Hits.init(q,r,t,b(t.x,t.y,true),H);for(q=G;q--;)if(w[q].visible)P=P||(w[q].hitGuess?w[q].hitGuess(ea.gridX,ea.gridY,J):false);P&&ca++}function x(q,r,t){if(N(q,pa)||N(q,Vb)){r=new J.XY(q);r.sync(J);q=r.x;r=r.y}if(N(q,qa)){C(q-La-ha.x,
r-Ma-ha.y,t);return J}else return C().offset(La+ha.x|0,Ma+ha.y|0).sync(J,true)}function z(){var q=new ua(O,Q,ab,bb);q.scaleFactor=U;q.padding=ha?ha.copy():new T;return q}function E(q,r,t){if(N(q,pa)&&N(r,wa))for(r=0;r<G;r++){if(w[r].id===q)return w[r]}else if(N(q,pa)){r=xa("layer",r,J,t);r.added=(new Date).getTime();r.id=q;w[o(q)]=r;w.sort(function(H,W){return W.zindex-H.zindex||W.added-H.added});G=w.length;J.trigger("resync");K();J.trigger("layerChange",J,r);ca++;return r}else return[].concat(w)}
function K(){var q=z();if(q){if(Ga||Ha)if(q){var r=cb?O+(q.w>>1):O,t=db?Q+(q.h>>1):Q,H=q.w,W=q.h;if(Ga&&Ga>H)if(r+H>Ga)O=cb?O:Ga-H;else if(r<0)O=cb?O:0;if(Ha&&Ha>W)if(t+W>Ha)Q=db?Q:Ha-W;else if(t<0)Q=db?Q:0}Hb=O;Ib=Q;J.trigger("refresh",J,q);ca++}}function p(q,r,t){if(N(q,qa)){var H=t?q:U*q;if(!Zb){r=null;q=Ka(Ba(H)/Math.LN2);H=Aa(2,q)}if(r)Oa=ta.tween([U],[H],r,function(){U=H;Oa=null;ca++});else{U=H;ca++}return J}else return U}function A(){for(var q=J.trigger.apply(null,arguments).cancel,r=w.length;r--;)q=
w[r].trigger.apply(null,arguments).cancel||q;return!q}function C(q,r,t){if(N(q,qa)){if(t)ya=ta.tween([O,Q],[q,r],t,function(){ya=null});else{O=q|0;Q=r|0;ca++}return J}else return(new J.XY(O,Q)).sync(J,true)}a=D({container:"",captureHover:true,controls:[],drawOnScale:true,padding:128,inertia:true,refreshDistance:256,pannable:true,scalable:true,renderer:"canvas"},a);var u="auto",B=[],w=[],G=0,R=null,S=null,M,s=null,L=!N(window.attachEvent,wa),P=false,da,ma=false,y=0,F=0,I=a.refreshDistance,O=0,Q=0,
aa=0,Da=0,Hb=0,Ib=0,Ga=null,Ha=null,cb=false,db=false,ya=null,ha,ea=null,Pa=null,V,Gb=0,Na=new T,sa=0,Qa=null,U=1,Oa=null,pb=1,ga=null,qb={index:0,draw:false},Zb=true,ca=0,ab,bb,nb,ob,La,Ma,J={XY:T,id:a.id,panSpeed:0,attachFrame:function(q,r){r&&R.appendChild(q)},center:x,detach:function(){V&&V.trigger("detach");ga&&ga.unbind();if(S){M.removeChild(S);R=S=null}},layer:E,invalidate:function(){ca++},pan:function(q,r,t){C(O+q,Q+r,t)},refresh:K,rotate:function(q,r,t){if(N(q,qa)){var H=t?q:sa+q;if(r)Qa=
ta.tween([sa],[H],r,function(){sa=H%360;Qa=null;ca++});else{sa=H%360;ca++}return J}else return sa},scale:p,triggerAll:A,setMaxOffset:function(q,r,t,H){Ga=q;Ha=r;cb=t;db=H},offset:C,viewport:z};va(J);J.bind("resize",d);J.bind("layerRemove",function(q,r){var t=ib(w,r.id);if(t>=0&&t<G){w.splice(t,1);ca++}G=w.length});hb(J,a,{container:n,captureHover:e,scalable:e,pannable:e,renderer:l});E("markers","draw",{zindex:20});n(a.container);L?window.attachEvent("onresize",d):window.addEventListener("resize",
d,false);Fa.attach(function(q){var r=[],t,H,W;self.panSpeed=panSpeed=la(y)+la(F);t=U!==pb;if(panSpeed>0||t||ya||Oa||Qa){ca++;if(ya&&panSpeed>0){ya(true);ya=null}}if(panSpeed<2&&(la(O-Hb)>=I||la(Q-Ib)>=I))K();qb.index++;qb.draw=ca||panSpeed||0;if(V&&qb.draw){if(Oa)U=Oa()[0];if(Qa)sa=Qa()[0];aa+=y;Da+=F;if(y||F)J.trigger("pan");if(X.transforms){if(U!==1)r[r.length]="scale("+U+")";if(sa!==0)r[r.length]="rotate("+sa+"deg)"}if(t=!da||(a.drawOnScale||U===1)&&panSpeed<5){if(ya){t=ya();O=t[0]|0;Q=t[1]|0}else{O=
O-aa/U|0;Q=Q-Da/U|0}W=z();V.trigger("predraw",W);if(V.prepare(w,W,q,ea)){H=Da=t=aa=ca=0;for(ii=G;ii--;){var Z=w[ii];if(Z.visible){var ra=Z.style?V.applyStyle(Z.style,true):null;Z.draw(V,W,J,q,ea);ra&&V.applyStyle(ra)}}V.trigger("render",W);J.trigger("drawComplete",W,q);X.move(R,t,H,r,Na)}}else X.move(R,aa,Da,r,Na);if(ma||!a.inertia)F=y=0;else if(y!=0||F!=0){y*=0.8;F*=0.8;if(la(y)<0.5)y=0;if(la(F)<0.5)F=0}if(ea){q=true;r=ea?ea.elements:[];if(Pa&&Pa.type==="hover"){diffElements=Hits.diffHits(Pa.elements,
r);if(diffElements.length>0)Hits.triggerEvent(Pa,J,"Out",diffElements);else q=false}if(r.length>0){H=ea.gridX;W=ea.gridY;for(t=r.length;t--;){Z=r[t];ra=H;var Jb=W,Kb=Z&&Z.drag&&(!Z.canDrag||Z.canDrag(Z,ra,Jb));if(Kb){s=Z;s.startX=ra;s.startY=Jb}if(Kb)break}q&&Hits.triggerEvent(ea,J)}Pa=r.length>0?D({},ea):null;ea=null}if(pb!==U){J.trigger("scaleChanged",U);pb=U}}});return J});Y("view","map",function(a){function c(d,j){var e=k.viewport();if(d){e=Ja(d.bestZoomLevel(e),j||0);return b(e).center(d.center())}else return new Ia((new ia(e.x,
e.y2)).sync(k,true).pos(),(new ia(e.x2,e.y)).sync(k,true).pos())}function b(d,j,e){if(N(d,qa)){d=Ja(a.minZoom,Ya(a.maxZoom,d|0));if(d!==i){var l=k.viewport(),m=k.offset(),o=l.w/2;l=l.h/2;var n=Aa(2,d-i),v=o/n|0,x=l/n|0;i=d;k.offset(((j||m.x+o)-v)*n,((e||m.y+l)-x)*n);refreshY=refreshX=0;k.trigger("zoom",d);k.trigger("reset");g=k.rpp=$/(256<<i);k.setMaxOffset($/g|0,$/g|0,true,false);k.scale(1,false,true);k.trigger("resync");k.refresh()}return k}else return i}a=D({controls:["zoombar"],minZoom:1,maxZoom:18,
renderer:"canvas/dom",zoom:1,zoombar:{}},a);var f=new ia,g,i=a.zoom||a.zoomLevel,h=0,k=D(xa("view","view",a),{XY:ia,bounds:c,zoom:b});k.bind("refresh",function(){var d=k.viewport();if(f.x!=d.x||f.y!=d.y){k.trigger("boundsChange",c());f.x=d.x;f.y=d.y}});k.bind("scaleChanged",function(d,j){var e=Ba(j)/Math.LN2|0;if(e!==0){j=Aa(2,e);clearTimeout(h);h=setTimeout(function(){b(i+e)},500)}});return k});var ta=function(){return{tween:function(a,c,b,f,g){function i(n){var v=n-o;n=o+m<=n;for(var x=h;x--;){k[x]=
j(v,a[x],e[x],m);g&&g.invalidate()}if(n||l){Fa.detach(i);for(x=0;x<d.length;x++)d[x]&&d[x](k,v,l)}}b=D({easing:"sine.out",duration:1E3,complete:null},b);var h=a.length,k=[].concat(a),d=[f,b.complete],j=Qb(b.easing),e=[],l=false,m=b.duration,o=(new Date).getTime();for(b=h;b--;)e[b]=c[b]-a[b];Fa.attach(i);return function(n){l=n;return k}},tweenDrawable:function(a,c,b,f,g){var i=ta.tween([b],[f],g,function(){a[c]=f;for(var k=a.tweens.length;k--;)if(a.tweens[k]===h){a.tweens.splice(k,1);break}},a.view),
h=function(){a[c]=i()[0]};return h}}}(),Ca=function(a,c,b){b=D({style:null,xy:null,size:20,fill:false,stroke:true,draggable:false,observable:true,properties:{},typeName:"Shape"},b);D(this,b);if(N(this.xy,pa))this.xy=new a.XY(this.xy);this.id="drawable_"+Xb++;this.bounds=null;this.view=a;this.layer=c;this.tweens=[];this.rotation=this.animations=0;this.scaling=1;this.translateY=this.translateX=0;this.observable&&va(this)};Ca.prototype={constructor:Ca,applyTweens:function(){for(var a=this.tweens.length;a--;)this.tweens[a]()},
drag:null,draw:null,getProps:null,resync:function(){if(this.xy){this.xy.sync(this.view);if(this.size){var a=this.size>>1;this.updateBounds(new ua(this.xy.x-a,this.xy.y-a,this.size,this.size))}}},rotate:function(a,c,b){if(N(a,qa)){a=(b?a:this.rotation*na+a)*ba;if(c)this.tweens.push(ta.tweenDrawable(this,"rotation",this.rotation,a,c));else{this.rotation=a;this.view.invalidate()}return this}else return this.rotation*na},scale:function(a,c,b){if(N(a,qa)){a=b?a:this.scaling*a;if(c)this.tweens.push(ta.tweenDrawable(this,
"scaling",this.scaling,a,c));else{this.scaling=a;this.view.invalidate()}return this}else return this.scaling},translate:function(a,c,b,f){if(N(a,qa)){a=f?a:this.translateX+a;c=f?c:this.translateY+c;if(b){this.tweens.push(ta.tweenDrawable(this,"translateX",this.translateX,a,b));this.tweens.push(ta.tweenDrawable(this,"translateY",this.translateY,c,b))}else{this.translateX=a;this.translateY=c;this.view.invalidate()}return this}else return new T(this.translateX,this.translateY)},updateBounds:function(a,
c){a&&(!this.bounds||a.x!=this.bounds.x||a.y!=this.bounds.y)&&this.trigger("move",this,a,this.bounds);this.bounds=a;if(c)this.xy=this.bounds.center()}};Y("drawable","marker",function(a,c,b){b=D({fill:true,stroke:false,markerType:"simple",hoverStyle:"highlight",typeName:"Marker"},b);return new Ca(a,c,b)});Y("drawable","poly",function(a,c,b){function f(){var d,j,e,l,m,o,n,v;v=k.points=b.simplify?vb(h):h;for(d=v.length;d--;){j=v[d].x;e=v[d].y;o=N(o,wa)||j<o?j:o;n=N(n,wa)||e<n?e:n;l=N(l,wa)||j>l?j:l;
m=N(m,wa)||e>m?e:m}k.updateBounds(new ua(o,n,l-o,m-n),true)}function g(d){if(N(d,yb)){h=[];Eb.process(d,function(j,e){for(var l=0;l<e;l++)h[h.length]=new a.XY(j[l])},i)}}function i(){h.length&&Eb.process(h,function(d,j){for(var e=j;e--;)d[e].sync(a)},f)}b=D({simplify:false,fill:true,points:[],typeName:"Poly"},b);var h=[],k=D(new Ca(a,c,b),{points:[],getPoints:function(){return[].concat(h)},resync:i});hb(k,b,{points:g});g(b.points);return k});Y("drawable","line",function(a,c,b){b.fill=false;return xa("drawable",
"poly",a,c,b)});Y("drawable","image",function(a,c,b){function f(){if(d&&d.width>0){if(!this.centerOffset)this.centerOffset=new T(-d.width>>1,-d.height>>1);this.updateBounds(new ua(this.xy.x+this.centerOffset.x,this.xy.y+this.centerOffset.y,d.width,d.height),false)}}function g(e){if(this.imageUrl=e){var l=this;$a(this.imageUrl,function(m,o){d=m;if(o){var n=j.layer?j.layer.view:null;n&&n.invalidate()}f.apply(l)})}}b=D({image:null,imageUrl:null,centerOffset:null,typeName:"Image"},b);var i=Ca.prototype.resync,
h=0,k=0,d=b.image,j=D(new Ca(a,c,b),{changeImage:g,getProps:function(){this.bounds||f(this,d);return{image:d,x:this.xy.x+h,y:this.xy.y+k}},resync:function(e){i.call(this,e);f.call(this)}});d||g.call(this,this.imageUrl);if(this.centerOffset){h=this.centerOffset.x;k=this.centerOffset.y}});Y("drawable","arc",function(a,c,b){b=D({startAngle:0,endAngle:Math.PI*2,typeName:"Arc"},b);return new Ca(a,c,b)});Ua.prototype={constructor:Ua,clip:null,cycle:function(){},draw:function(){},hitGuess:null,remove:function(){this.view.trigger("layerRemove",
this)}};Y("layer","tile",function(a,c){c=D({generator:"osm",imageLoadArgs:{}},c);var b=xa("generator",c.generator,c).run,f=null,g=[],i=D(new Ua(a,c),{draw:function(h,k,d){h.drawTiles&&h.drawTiles(k,f.search(k.buffer(128)),d.panSpeed<2)}});a.bind("resync",function(){var h=a&&a.zoom?a.zoom():0;g[h]||(g[h]=wb(h));f=g[h]});a.bind("refresh",function(h,k,d){f&&b(k,d,f,function(){k.invalidate()})});return i});Y("layer","draw",function(a,c){function b(j,e,l,m){var o=this.dragOffset;if(!o)o=this.dragOffset=
new a.XY(j.startX-this.xy.x,j.startY-this.xy.y);this.xy.x=e-o.x;this.xy.y=l-o.y;if(m){delete this.dragOffset;a.invalidate();this.xy.sync(a,true);this.trigger("dragDrop")}return true}function f(j){clearTimeout(k);k=setTimeout(function(){i.sort(function(e,l){if(l.xy&&e.xy){var m=l.xy.y-e.xy.y;return m!=0?m:l.xy.x-e.xy.x}});j&&j.invalidate()},50)}function g(j,e,l,m){m&&h.remove(m,e);h.insert(l,e)}c=D({zindex:10},c);var i=[],h,k=0,d=D(new Ua(a,c),{itemCount:0,clear:function(){h=new xb;i=[];d.trigger("cleared");
d.itemCount=0;a.invalidate()},create:function(j,e,l){e=xa("drawable",j,a,d,e);if(l)i.unshift(e);else i[i.length]=e;e.resync();h&&e.bounds&&h.insert(e.bounds,e);f(a);e.bind("move",g);d.itemCount=i.length;d.trigger(j+"Added",e);return e},draw:function(j,e,l,m,o){l={};m=h&&e?h.search(e):[];for(var n=m.length;n--;){var v=m[n],x=v.style||d.style,z,E,K=v.getProps?v.getProps(j):l;z=j["prep"+v.typeName];v.tweens.length>0&&v.applyTweens();E=j.applyTransform(v);if(K=z?z.call(j,v,e,o,K):null){if(o&&K.hit){o.elements.push(Hits.initHit(v.type,
v,v.draggable?b:null));z=o.type+"Style";x=v[z]||d[z]||x}x=x?j.applyStyle(x,true):null;(z=v.draw||K.draw)&&z.call(v,K);x&&j.applyStyle(x)}E&&E.undo&&E.undo()}},find:function(){return[].concat(i)},hitGuess:function(j,e){return h&&h.search({x:j-10,y:e-10,w:20,h:20}).length>0}});a.bind("resync",function(){h=wb(a.zoom(),h);for(var j=i.length;j--;)i[j].resync()});return d});Va.prototype={constructor:Va};Y("control","zoombar",function(a,c,b,f){function g(u,B){var w=K[u]=X.create("div","t5-zoombar-button",
{position:"absolute",background:i(u),"z-index":51,width:f.width+"px",height:f.buttonHeight+"px","margin-top":(B||0)+"px"});p.appendChild(w)}function i(u,B){return"url("+f.images+") 0 -"+(l+o*3+(u||0)*j*3+(B||0)*j)+"px"}function h(u){return"url("+f.images+") 0 -"+(l+(u||0)*o)+"px"}function k(u,B){var w;if(u===m){m.style.background=h(B);w="thumb"}else for(var G=0;G<K.length;G++)if(u===K[G]){w="button"+G;K[G].style.background=i(G,B);break}return w}function d(u){if(u!==z){z=u;x=v-z/E*(v-n)|0;X.move(m,
0,x-n);clearTimeout(A);A=setTimeout(function(){a.zoom(z)},500)}}f=D({width:24,height:200,images:"img/zoom.png",align:"right",marginTop:10,spacing:10,thumbHeight:16,buttonHeight:16},f);var j=f.buttonHeight,e,l=f.height,m,o=f.thumbHeight,n=f.spacing+j-(o>>1),v=f.height-j-(o>>1),x=n,z=-1;c=a.minZoom();var E=a.maxZoom()-c+1,K=[],p,A=0,C={button0:function(){a.zoom(a.zoom()+1)},button1:function(){a.zoom(a.zoom()-1)}};p=X.create("div","t5-zoombar",{position:"absolute",background:"url("+f.images+")","z-index":50,
overflow:"hidden",width:f.width+"px",height:f.height+"px",margin:function(){var u=f.spacing,B=za("{0}px 0 0 {1}px");if(f.align==="right")u=b.offsetWidth-f.width-f.spacing;return B(f.marginTop,u)}()});b.childNodes[0]?b.insertBefore(p,b.childNodes[0]):b.appendChild(p);p.appendChild(m=X.create("div","t5-zoombar-thumb",{position:"absolute",background:h(),"z-index":51,width:f.width+"px",height:f.thumbHeight+"px",margin:"10px 0 0 0",top:x-n+"px"}));g(0);g(1,f.height-f.buttonHeight);e=INTERACT.watch(p,{bindTarget:p});
e.bind("pointerMove",function(u,B,w){x=Math.min(Math.max(n,w.y-(o>>1)),v);d(E-(x-n)/v*E|0)});e.bind("pointerDown",function(u){k(u.target,2)});e.bind("pointerUp",function(u){k(u.target,0)});e.bind("tap",function(u){(u=C[k(u.target,2)])&&u()});c=new Va(a);c.bind("detach",function(){e.unbind();b.removeChild(p)});a.bind("zoom",function(u,B){d(B)});d(a.zoom());return c});ja.prototype={constructor:ja,distanceTo:function(){if(!targetPos||this.empty()||targetPos.empty())return 0;var a=(targetPos.lat-this.lat)*
ba>>1,c=(targetPos.lon-this.lon)*ba>>1;a=ka(a)*ka(a)+Ea(this.lat*ba)*Ea(targetPos.lat*ba)*ka(c)*ka(c);return 6371*2*Ub(lb(a),lb(1-a))},equalTo:function(a){return pos&&this.lat===a.lat&&this.lon===a.lon},empty:function(){return this.lat===0&&this.lon===0},inArray:function(a){for(var c=a.length;c--;)if(this.equal(a[c]))return true;return false},offset:function(a,c){var b=this.lat*ba,f=this.lon*ba,g=b+a/6371;b=Db(ka(c/6371)/Ea(b));f=f+b;g=(g+Sa)%Math.PI-Sa;f%=$;return new ja(g*na,f*na)},toPixels:function(){return Za(this.lon,
this.lat)},toBounds:function(a){var c=a.radians(),b=this.lat*ba,f=this.lon*ba;a=b-c;var g=b+c;if(a>Ab&&g<kb){b=Db(ka(c)/Ea(b));c=f-b;if(c<Tb)c+=$;f=f+b;if(f>Bb)f-=$}else{a=Ja(a,Ab);g=Ya(g,kb);c=zb;f=Wa}return new Ia(new ja(a*na,c*na),new ja(g*na,f*na))},toString:function(a){return this.lat+(a||" ")+this.lon}};(function(){Y("fn","generalize",function(a,c,b){var f=a.length,g=[],i=null;b=(b||250)/1E3;for(f=f;f--;)if(f===0)g.unshift(a[f]);else{var h=!i||a[f].inArray(c)?b:i.distanceTo(a[f]);if(a[f]&&h>=
b){g.unshift(a[f]);i=a[f]}}return g})})();Ia.prototype={constructor:Ia,bestZoomLevel:function(a){var c=this.center();c=Ya(Ka(la(c.lat)*0.05),jb.length);var b=jb[c],f=this.size();c=Cb(Ba(jb[3]*a.h/f.y)/Ba(2));a=Cb(Ba(b*a.w/f.x)/Ba(2));return Ya(isNaN(c)?1E3:c,isNaN(a)?1E3:a)},center:function(){var a=this.size();return new ja(this.min.lat+(a.y>>1),this.min.lon+(a.x>>1))},expand:function(a){this.min.lat-=a;this.max.lat+=a;this.min.lon-=a%360;this.max.lon+=a%360},size:function(a){var c=new T(0,this.max.lat-
this.min.lat);c.x=(a||N(a,wa))&&this.min.lon>this.max.lon?360-this.min.lon+this.max.lon:this.max.lon-this.min.lon;return c},toString:function(){return"min: "+this.min+", max: "+this.max}};gb.prototype={constructor:gb,radians:function(a){if(N(a,qa)){this.meters=a*6371E3;return this}else return this.meters/6371E3},toString:function(){if(this.meters>1E3)return(this.meters/10|0)/100+"km";return this.meters+"m"}};D(fa,{ex:D,log:oa,observable:va,configurable:hb,formatter:za,wordExists:function(a,c){for(var b=
a.split(/\s|\,/).length;b--;)if(a.toLowerCase()==c.toLowerCase())return true;return false},is:N,indexOf:ib,fn:function(a){return Wb("fn",a)},project:Za,unproject:mb,getImage:$a,userMessage:sb,Registry:Xa,Style:Fb,DOM:X,Rect:ua,XY:T,Pos:ja,BBox:Ia,Distance:gb,Hits:Hits,Control:Va,Tile:Ta,Tweener:ta});Y("generator","osm",function(a){a=D({flipY:false,tileSize:256,tilePath:"{0}/{1}/{2}.png",osmDataAck:true},a);var c=Math.PI/180,b=180/Math.PI,f=null,g=[],i,h=za(a.tilePath),k={buildTileUrl:function(d,j,
e,l,m){if(j>=0&&j<l){d=(d%l+l)%l;j=h(e,d,m?Math.abs(j-l+1):j);if(f)j=i(g[d%(g.length||1)])+j;return j}},run:function(d,j,e,l){var m=d.zoom?d.zoom():0;if(m){var o=2<<m-1,n=a.tileSize,v=(j.w/n|0)+1,x=(j.h/n|0)+1;j=(new ia(j.x,j.y)).sync(d,true).pos();var z=j.lat;j=new ia((j.lon+180)/360*o|0,(1-Math.log(Math.tan(z*c)+1/Math.cos(z*c))/Math.PI)/2*o%o|0);z=Math.PI-2*Math.PI*j.y/o;z=new ja(b*Math.atan(0.5*(Math.exp(z)-Math.exp(-z))),j.x/o*360-180);z=new ia(z);z.sync(d);d=a.flipY;var E=e.search({x:z.x,y:z.y,
w:v*n,h:x*n}),K={},p;for(p=E.length;p--;)K[E[p].id]=true;g=(f=k.getServerDetails?k.getServerDetails():null)&&f.subDomains?f.subDomains:[];i=za(f?f.baseUrl:"");for(E=0;E<=v;E++)for(p=0;p<=x;p++){var A=j.x+E,C=j.y+p,u=A+"_"+C;if(!K[u]){tileUrl=k.buildTileUrl(A,C,m,o,d);A=new Ta(z.x+E*n,z.y+p*n,tileUrl,n,n,u);e.insert(A,A)}}l&&l()}}};a.osmDataAck&&sb("ack","osm",'Map data (c) <a href="http://openstreetmap.org/" target="_blank">OpenStreetMap</a> (and) contributors, CC-BY-SA');return k});fa.Cloudmade=
function(){fa.Registry.register("generator","osm.cloudmade",function(a){a=fa.ex({apikey:null,styleid:1},a);var c=fa.formatter("http://{3}.tile.cloudmade.com/{0}/{1}/{2}/");fa.userMessage("ack","osm.cloudmade",'This product uses the <a href="http://cloudmade.com/" target="_blank">CloudMade</a> APIs, but is not endorsed or certified by CloudMade.');return fa.ex(fa.Registry.create("generator","osm",a),{getServerDetails:function(){return{baseUrl:c(a.apikey,a.styleid,256,"{0}"),subDomains:["a","b","c"]}}})})}();
rb.T5=fa;rb.Tile5=function(a,c){c=D({container:a,type:"map",renderer:"canvas",starpos:null,zoom:1,fastpan:false,drawOnScale:true,zoombar:{}},c);return xa("view",c.type,c)}})(window);
