(function(){function J(){var a=arguments[0]||{},d=Array.prototype.slice.call(arguments,1),b=d.length,e,h;for(h=0;h<b;h++)if((e=d[h])!==null)for(var k in e){var g=e[k];if(a!==g)if(g!==undefined)a[k]=g}return a}function va(a,d){if(typeof console!=="undefined")console[d||"log"](a)}function wa(a){var d=a.match(Bb),b=[],e=0,h;for(h=d?d.length:0;h--;){var k=d[h].slice(1);b[k]||(b[k]=RegExp("\\{"+k+"\\}","g"))}e=b.length;return function(){var g=a;for(h=0;h<e;h++){var i=arguments[h];if(typeof i=="undefined")i=
"";g=g.replace(b[h],i)}return g}}function kb(a,d,b){Ea.trigger("userMessage",a,d,b)}function lb(a,d){var b=Pa*da(a);return mb-2*nb(d*xa((1-b)/(1+b),Pa/2))}function V(a,d){if(R(a,pa)){var b=a.split(ob);this.x=parseFloat(b[0]);this.y=parseFloat(b[1])}else if(a&&a.x){this.x=a.x;this.y=a.y}else{this.x=a||0;this.y=d||0}}function Fa(a){this.allowCull=a}function ha(a,d,b,e){this.mercX=b;this.mercY=e;if(R(a,pa))J(this,Cb.parseXY(a));else a&&a.toBounds?J(this,Qa(a.lon,a.lat)):V.call(this,a,d)}function qa(a,
d,b,e){this.x=a||0;this.y=d||0;this.w=b||0;this.h=e||0;this.x2=this.x+this.w;this.y2=this.y+this.h}function pb(a,d){var b=new qb(Math.sqrt(256<<a)|0);d&&d.zoomLevel===a&&d.copyInto(b);b.zoomLevel=a;return b}function Ra(a,d,b,e,h,k){this.x=a;this.y=d;this.w=e||256;this.h=e||256;this.x2=this.x+this.w;this.y2=this.y+this.h;this.url=b;this.id=k||a+"_"+d;this.loaded=false;this.image=null}function Sa(a,d){d=J({id:"layer_"+Db++,zindex:0,animated:false,style:null,minXY:null,maxXY:null,visible:true},d);this.visible=
d.visible;this.view=a;ra(J(this,d))}function Ta(){ra(this)}var Bb=/\{(\d+)(?=\})/g,Eb=function(){var a=1.70158,d=Math.PI/2,b=Math.abs,e=Math.pow,h=Math.sin,k=Math.asin,g=Math.cos,i={linear:function(c,l,j,f){return j*c/f+l},backin:function(c,l,j,f){return j*(c/=f)*c*((a+1)*c-a)+l},backout:function(c,l,j,f){return j*((c=c/f-1)*c*((a+1)*c+a)+1)+l},backinout:function(c,l,j,f){return(c/=f/2)<1?j/2*c*c*(((a*=1.525)+1)*c-a)+l:j/2*((c-=2)*c*(((a*=1.525)+1)*c+a)+2)+l},bouncein:function(c,l,j,f){return j-i.bounceout(f-
c,0,j,f)+l},bounceout:function(c,l,j,f){return(c/=f)<1/2.75?j*7.5625*c*c+l:c<2/2.75?j*(7.5625*(c-=1.5/2.75)*c+0.75)+l:c<2.5/2.75?j*(7.5625*(c-=2.25/2.75)*c+0.9375)+l:j*(7.5625*(c-=2.625/2.75)*c+0.984375)+l},bounceinout:function(c,l,j,f){return c<f/2?i.bouncein(c*2,0,j,f)/2+l:i.bounceout(c*2-f,0,j,f)/2+j/2+l},cubicin:function(c,l,j,f){return j*(c/=f)*c*c+l},cubicout:function(c,l,j,f){return j*((c=c/f-1)*c*c+1)+l},cubicinout:function(c,l,j,f){if((c/=f/2)<1)return j/2*c*c*c+l;return j/2*((c-=2)*c*c+
2)+l},elasticin:function(c,l,j,f,n,m){if(c==0)return l;if((c/=f)==1)return l+j;m||(m=f*0.3);if(!n||n<b(j)){n=j;j=m/4}else j=m/ea*k(j/n);return-(n*e(2,10*(c-=1))*h((c*f-j)*ea/m))+l},elasticout:function(c,l,j,f,n,m){var p;if(c==0)return l;if((c/=f)==1)return l+j;m||(m=f*0.3);if(!n||n<b(j)){n=j;p=m/4}else p=m/ea*k(j/n);return n*e(2,-10*c)*h((c*f-p)*ea/m)+j+l},elasticinout:function(c,l,j,f,n,m){var p;if(c==0)return l;if((c/=f/2)==2)return l+j;m||(m=f*0.3*1.5);if(!n||n<b(j)){n=j;p=m/4}else p=m/ea*k(j/
n);if(c<1)return-0.5*n*e(2,10*(c-=1))*h((c*f-p)*ea/m)+l;return n*e(2,-10*(c-=1))*h((c*f-p)*ea/m)*0.5+j+l},quadin:function(c,l,j,f){return j*(c/=f)*c+l},quadout:function(c,l,j,f){return-j*(c/=f)*(c-2)+l},quadinout:function(c,l,j,f){if((c/=f/2)<1)return j/2*c*c+l;return-j/2*(--c*(c-2)-1)+l},sinein:function(c,l,j,f){return-j*g(c/f*d)+j+l},sineout:function(c,l,j,f){return j*h(c/f*d)+l},sineinout:function(c,l,j,f){return-j/2*(g(Math.PI*c/f)-1)+l}};return function(c){c=c.replace(/[\-\_\s\.]/g,"").toLowerCase();
return i[c]||i.linear}}(),ra=function(){function a(b,e){var h=b.hasOwnProperty("obsHandlers")?b.obsHandlers:null;h[e]||(h[e]=[]);return h[e]}var d=0;return function(b){if(!b)return null;if(!(b.hasOwnProperty("obsHandlers")?b.obsHandlers:null))b.obsHandlers={};if(!b.hasOwnProperty("bind")){b.bind=function(e,h){var k="callback"+d++;a(b,e).unshift({fn:h,id:k});return k};b.triggerCustom=function(e,h){var k=a(b,e),g={cancel:false,name:e,source:this},i;for(i in h)g[i]=h[i];if(!k)return null;i=Array.prototype.slice.call(arguments,
2);b.eventInterceptor&&b.eventInterceptor(e,g,i);i.unshift(g);for(var c=k.length;c--&&!g.cancel;)k[c].fn.apply(this,i);return g};b.trigger=function(e){var h=Array.prototype.slice.call(arguments,1);h.splice(0,0,e,null);return b.triggerCustom.apply(this,h)};b.unbind=function(e,h){if(typeof e==="undefined")b.obsHandlers={};else for(var k=a(b,e),g=0;k&&g<k.length;g++)if(k[g].id===h){k.splice(g,1);break}return b}}return b}}(),rb=function(){function a(d,b,e,h){if(typeof d[h]=="undefined")d[h]=function(k){if(typeof k!=
"undefined"){b[h]=k;e[h]&&e[h](k);return d}else return b[h]}}return function(d,b,e){b=b||d;for(var h in b)typeof b[h]!="function"&&a(d,b,e,h);return d}}(),bb=Array.prototype.indexOf||function(a){for(var d=0;d<this.length;d++)if(this[d]===a)return d;return-1},R=function(){var a={NaN:1,Infinity:1,"-Infinity":1},d=String.prototype.toLowerCase,b=Object.prototype.toString;return function(e,h){h=d.call(h);if(h=="finite")return!a.hasOwnProperty(+e);return h=="null"&&e===null||h==typeof e||h=="object"&&e===
Object(e)||h=="array"&&Array.isArray&&Array.isArray(e)||b.call(e).slice(8,-1).toLowerCase()==h}}();(function(){function a(k){var g=document.createElement("script"),i=false;g.src=k;g.async=true;g.onload=g.onreadystatechange=function(){if(!i&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){i=true;g.onload=g.onreadystatechange=null;g&&g.parentNode&&g.parentNode.removeChild(g)}};h||(h=document.getElementsByTagName("head")[0]);h.appendChild(g)}function d(k,g,i){k+=k.indexOf("?")>=
0?"&":"?";var c="json"+ ++e;window[c]=function(l){g(l);window[c]=null;try{delete window[c]}catch(j){}};a(k+(i?i:"callback")+"="+c);return c}function b(k,g,i){var c=require("request");k=k+(k.indexOf("?")>=0?"&":"?")+(i?i:"callback")+"=cb";c({uri:k},function(l,j,f){l=f.replace(/^.*\(/,"").replace(/\).*$/,"");g(JSON.parse(l))})}var e=0,h;return typeof window!="undefined"?d:b})();INTERACT=function(){function a(n){return function(m,p){n.addEventListener(m,p,false)}}function d(n){return function(m,p){n.removeEventListener(m,
p,false)}}function b(n){return function(m,p){n.attachEvent("on"+m,p)}}function e(n,m){return{x:n?n:0,y:m?m:0,count:1}}function h(n,m){j.push(J({handler:null,checks:{},type:n},m))}function k(n){var m=0,p=0;if(n.offsetParent){do{m+=n.offsetLeft;p+=n.offsetTop;n=n.offsetParent}while(n)}return{left:m,top:p}}function g(n,m){return{source:n,target:m.target?m.target:m.srcElement}}function i(n,m){for(var p=n.target?n.target:n.srcElement;p&&p!==m;)p=p.parentNode;return p&&p===m}function c(n,m){return{x:n.x-
(m?m.left:0),y:n.y-(m?m.top:0)}}function l(n,m){if(n.preventDefault){n.preventDefault();n.stopPropagation()}else if(typeof n.cancelBubble!="undefined")n.cancelBubble=true;m&&n.stopImmediatePropagation&&n.stopImmediatePropagation()}var j=[],f=function(n,m,p){p=J({binder:null,unbinder:null,observable:null},p);for(var w=p.observable,A=[],B,K,q={bind:function(){return w.bind.apply(null,arguments)},unbind:function(){w.unbind();for(v=0;v<A.length;v++)A[v].unbind();return q}},v=0;v<m.length;v++)A.push(m[v](n,
w,p));w.bind("pointerDown",function(){K=B=0});w.bind("pointerMove",function(o,u,t,y){B+=y.x||0;K+=y.y||0});w.bind("pointerUp",function(o,u,t){Math.abs(B)>20||Math.abs(K)>20||w.triggerCustom("tap",o,u,t)});return q};h("pointer",{handler:function(n,m,p){function w(z){if(z.pageX&&z.pageY)return e(z.pageX,z.pageY);else{var H=document.documentElement,I=document.body;return e(z.clientX+(H&&H.scrollLeft||I&&I.scrollLeft||0)-(H&&H.clientLeft||I&&I.clientLeft||0),z.clientY+(H&&H.scrollTop||I&&I.scrollTop||
0)-(H&&H.clientTop||I&&I.clientTop||0))}}function A(z){if(i(z,n))if(y=v(z)){var H=w(z);n.style.cursor="move";l(z,true);M=H.x;P=H.y;C=e(M,P);m.triggerCustom("pointerDown",g("mouse",z),C,c(C,k(n)))}}function B(z){var H=w(z);F=H.x;N=H.y;if(i(z,n))o(z,y?"pointerMove":"pointerHover")}function K(z){if(y&&v(z)){y=false;if(i(z,n)){n.style.cursor="default";o(z,"pointerUp")}}}function q(z){if(i(z,n)){var H;z=z||window.event;if(z.detail){if(typeof z.axis=="undefined"||z.axis===2)H=-z.detail*u}else{H=z.wheelDeltaY?
z.wheelDeltaY:z.wheelDelta;if(window.opera)H=-H}if(H){var I=e(F,N);m.triggerCustom("zoom",g("mouse",z),I,c(I,k(n)),H/t,"wheel");l(z);z.returnValue=false}}}function v(z){z=z||window.event;return(z.which||z.button)==1}function o(z,H,I,T,ja){I=typeof I!="undefined"?I:F;T=typeof T!="undefined"?T:N;var D=I-M,O=T-P,G=e(I,T);m.triggerCustom(H,g("mouse",z),G,c(G,k(n)),e(D,O));if(typeof ja=="undefined"||ja){M=I;P=T}}p=J({},p);var u=120,t=u*8,y=false,C,F,N,M,P;p.binder("mousedown",A);p.binder("mousemove",B);
p.binder("mouseup",K);p.binder("dblclick",function(z){va("captured double click");if(i(z,n)){var H=w(z);m.triggerCustom("doubleTap",g("mouse",z),H,c(H,k(n)))}});p.binder("mousewheel",q);p.binder("DOMMouseScroll",q);return{unbind:function(){p.unbinder("mousedown",A);p.unbinder("mousemove",B);p.unbinder("mouseup",K);p.unbinder("mousewheel",q);p.unbinder("DOMMouseScroll",q)}}},checks:{touch:false}});h("pointer",{handler:function(n,m,p){function w(D){if(D.count<2)return 0;var O=D.x-D.next.x;D=D.y-D.next.y;
return~~Math.sqrt(O*O+D*D)}function A(D,O,G){O=O?O:0;G=G?G:0;for(var U={x:D.x-O,y:D.y-G,id:D.id,count:D.count},ba=U;D.next;){D=D.next;ba=ba.next={x:D.x-O,y:D.y-G,id:D.id}}return U}function B(D,O){var G=D[O?O:"touches"],U,ba;if(G.length===0)return null;ba=U={x:G[0].pageX,y:G[0].pageY,id:G[0].identifier,count:G.length};for(var S=1,Y=G.length;S<Y;S++)ba=ba.next={x:G[S].pageX,y:G[S].pageY,id:G[S].identifier};return U}function K(D){if(i(D,n)){N=k(n);var O=B(D,"changedTouches"),G=A(O,N.left,N.top);if(!P){M=
y;m.triggerCustom("pointerDown",g("touch",D),O,G)}T&&m.triggerCustom("pointerDownMulti",g("touch",D),O,G);P=B(D);if(P.count>1)H=w(P);ja=1;I=A(P)}}function q(D){if(i(D,n)){l(D);z=B(D);if(M==y)M=Math.abs(P.x-z.x)>u||Math.abs(P.y-z.y)>u?t:y;if(M!=y){M=z.count>1?F:C;if(M==F)if(P.count===1){P=A(z);H=w(P)}else{var O=w(z);if(Math.abs(H-O)<o)M=C;else{var G;G=z.x;var U=z.next.x,ba=z.y,S=z.next.y;G={x:(G<U?G:U)+(Math.abs(G-U)>>1),y:(ba<S?ba:S)+(Math.abs(ba-S)>>1)};O=O/H;U=O-ja;m.triggerCustom("zoom",g("touch",
D),G,c(G,N),U,"pinch");ja=O}}M==C&&m.triggerCustom("pointerMove",g("touch",D),z,A(z,N.left,N.top),e(z.x-I.x,z.y-I.y));T&&m.triggerCustom("pointerMoveMulti",g("touch",D),z,A(z,N.left,N.top))}I=A(z)}}function v(D){if(i(D,n)){var O=B(D,"changedTouches"),G=A(O,N.left,N.top);z=B(D);if(!z){m.triggerCustom("pointerUp",g("touch",D),O,G);P=null}T&&m.triggerCustom("pointerUpMulti",g("touch",D),O,G)}}p=J({detailed:false,inertia:false},p);var o=20,u=7,t=0,y=1,C=2,F=3,N,M,P,z,H,I,T=p.detailed,ja=1;p.binder("touchstart",
K);p.binder("touchmove",q);p.binder("touchend",v);va("initialized touch handler");return{unbind:function(){p.unbinder("touchstart",K);p.unbinder("touchmove",q);p.unbinder("touchend",v)}}},checks:{touch:true}});return{register:h,watch:function(n,m,p){m=J({bindTarget:null,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},m);capabilities=J({touch:"ontouchstart"in window},p);if(!m.observable){va("creating observable");m.observable=ra({});globalOpts=m}m.binder=(m.isIE?b:a)(m.bindTarget||
document);m.unbinder=(m.isIE?b:d)(m.bindTarget||document);p=m.types;for(var w=capabilities,A=[],B=j.length;B--;){var K=j[B],q=!p||p.indexOf(K.type)>=0,v=true,o;for(o in K.checks){var u=K.checks[o];va("checking "+o+" capability. require: "+u+", capability = "+w[o]);v=v&&u===w[o]}if(q&&v)A[A.length]=K.handler}return new f(n,A,m)}}}();(function(){function a(q,v){if(q&&q.split){var o=q.split(B);if(o.length>1){q=o[0];v=o[1]}}else if(q&&q.lat){v=q.lon;q=q.lat}this.lat=parseFloat(q||0);this.lon=parseFloat(v||
0)}function d(q,v){if(q&&q.splice){for(var o=v,u=new a(l,f),t=new a(j,n),y=q.length;y--;){var C=typeof q[y]=="string"?new a(q[y]):q[y];if(C.lat<u.lat)u.lat=C.lat;if(C.lat>t.lat)t.lat=C.lat;if(C.lon<u.lon)u.lon=C.lon;if(C.lon>t.lon)t.lon=C.lon}this.min=u;this.max=t;if(typeof o=="undefined"){o=this.size();o=Math.max(o.x,o.y)*0.3}this.min=new a(u.lat-o,(u.lon-o)%360);this.max=new a(t.lat+o,(t.lon+o)%360)}else{this.min=q;this.max=v}}function b(q){if(typeof q=="string"){var v=(q.replace(/\d|\.|\s/g,"")||
"m").toLowerCase();q=parseFloat(q)*({km:1E3}[v]||1)}this.meters=q||0}var e=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],h=typeof module!="undefined"&&module.exports,k=Math.PI*2,g=Math.PI/2,i=Math.PI/180,c=180/Math.PI,l=90,j=-l,f=180,n=-f,m=l*i,p=-m,w=f*i,A=-w,B=/[\,\s]+/;a.prototype={constructor:a,copy:function(){return new a(this.lat,this.lon)},distanceTo:function(){if(!targetPos||this.empty()||targetPos.empty())return 0;var q=(targetPos.lat-this.lat)*
la/2,v=(targetPos.lon-this.lon)*la/2;q=da(q)*da(q)+sa(this.lat*la)*sa(targetPos.lat*la)*da(v)*da(v);return 6371*2*Fb(cb(q),cb(1-q))},equalTo:function(q){return pos&&this.lat===q.lat&&this.lon===q.lon},empty:function(){return this.lat===0&&this.lon===0},inArray:function(q){for(var v=q.length;v--;)if(this.equal(q[v]))return true;return false},offset:function(q,v){var o=this.lat*i,u=this.lon*i,t=o+q/6371;o=sb(da(v/6371)/sa(o));u=u+o;t=(t+g)%Math.PI-g;u%=k;return new a(t*c,u*c)},toBounds:function(q){var v=
q.radians(),o=this.lat*i,u=this.lon*i;q=o-v;var t=o+v;if(q>p&&t<m){o=sb(da(v)/sa(o));v=u-o;if(v<A)v+=k;u=u+o;if(u>w)u-=k}else{q=Ga(q,p);t=db(t,m);v=n;u=f}return new d(new a(q*c,v*c),new a(t*c,u*c))},toString:function(q){return this.lat+(q||" ")+this.lon}};d.prototype={constructor:d,bestZoomLevel:function(q,v){var o=this.center(),u=e[Math.min(Math.round(Math.abs(o.lat)*0.05),e.length)],t=this.size();o=Math.ceil(Math.log(e[3]*v/t.y)/Math.LN2);u=Math.ceil(Math.log(u*q/t.x)/Math.LN2);return Math.min(isNaN(o)?
1E3:o,isNaN(u)?1E3:u)},center:function(){var q=this.size();return new a(this.min.lat+q.y/2,this.min.lon+q.x/2)},expand:function(q){return new d(new a(this.min.lat-q,(this.min.lon-q)%360),new a(this.max.lat+q,(this.max.lon+q)%360))},size:function(q){var v={x:0,y:this.max.lat-this.min.lat};v.x=typeof q!="undefined"&&q&&this.min.lon>this.max.lon?360-this.min.lon+this.max.lon:this.max.lon-this.min.lon;return v},toString:function(){return"min: "+this.min+", max: "+this.max},union:function(){for(var q=
this.min.copy(),v=this.max.copy(),o=arguments.length;o--;)if(arguments[o]){var u=arguments[o].min,t=arguments[o].max;q.lat=Math.min(q.lat,u.lat);q.lon=Math.min(q.lon,u.lon);v.lat=Math.max(v.lat,t.lat);v.lon=Math.max(v.lon,t.lon)}return new d(q,v)}};b.prototype={add:function(){for(var q=this.meters,v=arguments.length;v--;){var o=typeof arguments[v]=="string"?new b(arguments[v]):arguments[v];q+=o.meters}return new b(q)},radians:function(q){if(typeof q!="undefined"){this.meters=q*6371E3;return this}else return this.meters/
6371E3},toString:function(){if(this.meters>1E3)return(this.meters/10|0)/100+"km";return this.meters+"m"}};var K=this.GeoJS={Pos:a,BBox:d,Distance:b,generalize:function(q,v,o){var u=q.length,t=[],y=null;o=(o||250)/1E3;for(u=u;u--;)if(u===0)t.unshift(q[u]);else{var C=!y||q[u].inArray(v)?o:y.distanceTo(q[u]);if(q[u]&&C>=o){t.unshift(q[u]);y=q[u]}}return t},include:function(q){if(h){q=q.split(",");for(var v=0;v<q.length;v++){var o=require("./plugins/"+q[v].trim()),u;for(u in o)K[u]=o[u]}}return K}};if(h)module.exports=
K})();var Ea=this.T5=ra({}),Ua=function(){var a={};return{create:function(d,b){if(a[d][b])return a[d][b].apply(null,Array.prototype.slice.call(arguments,2));throw Gb(d,b);},get:function(d,b){return a[d]?a[d][b]:null},register:function(d,b,e){a[d]||(a[d]={});a[d][b]&&va(Hb(d,b),"warn");a[d][b]=e}}}(),Hb=wa("Registration of {0}: {1} will override existing definition"),Gb=wa("Could not create {0} of type: {1}");wa("Could not create drawable of type: {0}");var ea=Math.PI*2,mb=Math.PI/2,la=Math.PI/180,
Va=180/Math.PI,Pa=0.08181919084262157,ma=Math.abs,Wa=Math.round,db=Math.min,Ga=Math.max,xa=Math.pow,cb=Math.sqrt,eb=Math.log,da=Math.sin,sb=Math.asin,sa=Math.cos,nb=Math.atan,Fb=Math.atan2,ya="undefined",pa="string",Ib="object",ta="number",Jb="array",ia=Ua.register,Aa=Ua.create,Kb=Ua.get,Lb=0,Db=0,ob=/[\,\s]+/,Ba=function(){function a(g){h++;g=Q?window.mozAnimationStartTime||g||(new Date).getTime():(new Date).getTime();for(var i=e.length;i--;){var c=e[i];h%c.every===0&&c.cb(g)}k&&animFrame(a)}var d=
1E3/60,b=["r","webkitR","mozR","oR","msR"],e=[],h=0,k=Q&&function(){for(var g=0;g<b.length;g++)window.animFrame=window.animFrame||window[b[g]+"equestAnimationFrame"];return animFrame}();k?animFrame(a):setInterval(a,1E3/60);return{attach:function(g,i){e[e.length]={cb:g,every:i?Wa(i/d):1}},detach:function(g){for(var i=e.length;i--;)if(e[i].cb===g){e.splice(i,1);break}}}}(),Cb=function(){var a=/^xy\((.*)\).*$/i;return{parseXY:function(d){if(!a.test(d)){d=d.split(ob);return Qa(d[1],d[0])}}}}(),Q=typeof window!=
"undefined"?function(){function a(h){for(var k=0;k<h.length;k++){var g=h[k];if(typeof document.body.style[g]!="undefined")return g}}var d={"-webkit-user-select":"none",position:"absolute"},b,e;b=a(["-webkit-transform","MozTransform"]);css3DTransformProp=a(["WebkitPerspective","MozPerspective"]);e=a(["-webkit-transform-origin","MozTransformOrigin"]);return{transforms:R(b,pa),create:function(h,k,g){h=document.createElement(h);var i=[];g=g||{};h.className=k||"";for(var c in g)i[i.length]=c+": "+g[c];
h.style.cssText=i.join(";");return h},move:function(h,k,g,i,c){if(b){h.style[b]="translate("+k+"px, "+g+"px) "+(i||[]).join(" ");if(c&&e)h.style[e]=c.x+"px "+c.y+"px"}else{h.style.left=k+"px";h.style.top=g+"px"}},styles:function(h){return J({},d,h)}}}():null,tb=function(){function a(){for(var h=e.length,k=h;k--;)try{e[k](h)}catch(g){va(g.toString(),"error")}}var d=20,b=50,e=[];return{process:function(h,k,g,i){function c(f){f=(l||b)/f;if(j<h.length){var n=h.slice(j,j+f);f=n.length;var m=l?0:(new Date).getTime();
k(n,f);if(!l)l=(n=((new Date).getTime()-m)/f)?d/n|0:h.length;j+=f}else{for(f=e.length;f--;)if(e[f]===c){e.splice(f,1);break}e.length===0&&Ba.detach(a);g&&g()}}var l,j=0;if(Q&&h.length>(i||0))e.push(c)===1&&Ba.attach(a);else{k(h,h.length);g&&g()}}}}(),Qa=Qa||function(a,d){var b=parseFloat(d)*la;b=da(b);var e=Pa*b;b=eb((1+b)/(1-b)*xa((1-e)/(1+e),Pa))/2;return new ha(0,0,parseFloat(a)*la,b)},fb=fb||function(a,d){for(var b=xa(Math.E,-d),e=mb-2*nb(b),h=lb(e,b),k=0;k<12&&ma(e-h)>1.0E-7;){e=h;h=lb(e,b);
k++}return new GeoJS.Pos(h*Va,a%360*Va)};V.prototype={constructor:V,add:function(){for(var a=this.x,d=this.y,b=arguments.length;b--;){a+=arguments[b].x;d+=arguments[b].y}return this.copy(a,d)},copy:function(a,d){var b=J({},this);b.x=a||b.x;b.y=d||b.y;return b},equals:function(a){return this.x===a.x&&this.y===a.y},offset:function(a,d){return this.copy(this.x+a,this.y+d)},relative:function(a){a=a.viewport();return this.copy(this.x-a.x-a.padding.x,this.y-a.y-a.padding.y)},rotate:function(a,d){d=d||new V(0,
0);var b=this.x-d.x,e=this.y-d.y;return new V(d.x+sa(a)*b+-da(a)*e,d.y+da(a)*b+sa(a)*e)},scale:function(a,d){d=d||new V(0,0);return new V(d.x+(this.x-d.x)*a,d.y+(this.y-d.y)*a)},sync:function(){return this},toString:function(){return this.x+", "+this.y}};Fa.prototype=J([],{cull:function(a){if(this.allowCull){var d=a.x,b=a.y,e=a.x+a.w;a=a.y+a.h;for(var h=Infinity,k=0,g,i=this.length;i--;)if(g=this[i].x>=d&&this[i].x<=e&&this[i].y>=b&&this[i].y<=a){h=i<h?i:h;k=i>k?i:k}return this.slice(Ga(h-1,0),db(k+
1,this.length))}return this},simplify:function(a){a=a||3;for(var d=new Fa(this.allowCull),b=null,e=this.length;e--;){var h=this[e];if(include=!b||e===0||ma(h.x-b.x)+ma(h.y-b.y)>a){d.unshift(h);b=h}}return d}});ha.prototype=J(new V,{constructor:ha,pos:function(){return fb(this.mercX,this.mercY)},sync:function(a,d){var b;if(!(b=a.rpp)){b=a.zoom();b=ea/(256<<b)}b=b;if(d){this.mercX=this.x*b-Math.PI;this.mercY=Math.PI-this.y*b}else{this.x=Wa(((this.mercX||0)+Math.PI)/b);this.y=Wa((Math.PI-(this.mercY||
0))/b)}return this}});qa.prototype={constructor:qa,buffer:function(a,d){return new qa(this.x-a,this.y-(d||a),this.w+a*2,this.h+(d||a)*2)},center:function(){return new V(this.x+(this.w>>1),this.y+(this.h>>1))}};Hits=function(){return{diffHits:function(a,d){var b=[],e={},h;for(h=d.length;h--;)e[d[h].target.id]=true;for(h=a.length;h--;)e[a[h].target.id]||(b[b.length]=a[h]);return b},init:function(a,d,b,e,h){return{type:a,x:h.x,y:h.y,gridX:e.x|0,gridY:e.y|0,elements:[],absXY:d,relXY:b}},initHit:function(a,
d,b){return{type:a,target:d,drag:b}},triggerEvent:function(a,d,b,e){d.triggerCustom(a.type+(b?b:"Hit"),{hitType:a.type},e?e:a.elements,a.absXY,a.relXY,new ha(a.gridX,a.gridY))}}}();var qb=function(a){function d(k,g){var i=b[k],c;i||(i=b[k]=[]);(c=i[g])||(c=i[g]=[]);return c}a=a||128;var b=[],e={},h=0;return{copyInto:function(k){for(var g in e){var i=e[g];k.insert(i.bounds||i,i,g)}},insert:function(k,g,i){var c=k.x/a|0,l=k.y/a|0,j=(k.x+k.w)/a|0;k=(k.y+k.h)/a|0;i=i||g.id||"obj_"+h++;e[i]=g;for(g=c;g<=
j;g++)for(c=l;c<=k;c++)d(g,c).push(i)},remove:function(k,g,i){i=i||g.id;if(e[i]){var c=k.x/a|0;g=k.y/a|0;var l=(k.x+k.w)/a|0;k=(k.y+k.h)/a|0;delete e[i];for(c=c;c<=l;c++)for(var j=g;j<=k;j++){var f=d(c,j),n=bb.call(f,i);n>=0&&f.splice(n,1)}}},search:function(k){var g=k.y/a|0,i=(k.x+k.w)/a|0,c=(k.y+k.h)/a|0,l=[],j=[];for(k=k.x/a|0;k<=i;k++)for(var f=g;f<=c;f++)l=l.concat(d(k,f));l.sort();for(g=l.length;g--;){i=l[g];if(c=e[i])j[j.length]=c;for(;g>0&&l[g-1]==i;)g--}return j}}},Xa=function(){var a={},
d=0;(new Date).getTime();var b={},e=[];Ba.attach(function(h){h=h||(new Date).getTime();for(var k=0;k<e.length;){var g=e[k],i=b[g],c=b[g].image&&b[g].image.complete&&b[g].image.width>0,l=h-i.start;l=c||l>=3E4;if(c){c=i.callbacks;a[g]=i.image;for(var j=0;j<c.length;j++)c[j](i.image,true)}if(l){e.splice(k,1);delete b[g]}else k++}},250);return function(h,k){var g=h&&k?a[h]:null;if(g&&g&&g.complete&&g.width>0)k(g);else if(g=b[h])g.callbacks.push(k);else{g=new Image;g.id="_ldimg"+ ++d;b[h]={start:(new Date).getTime(),
image:g,callbacks:[k]};g.src=h;e[e.length]=h}}}();Ra.prototype={constructor:Ra,load:function(a){var d=this;Xa(this.url,function(b){d.loaded=true;d.image=b;a&&a()})}};var Mb=function(){return ra({fastpan:true,applyStyle:function(){},applyTransform:function(a,d,b){return{restore:null,x:d,y:b}},getDimensions:function(){return{width:0,height:0}},getViewport:function(){},hitTest:function(){return false},prepare:function(){},projectXY:null,reset:function(){}})};ia("renderer","canvas",function(a,d,b,e,h){function k(){function o(y,
C){this.save();this.setTransform(1,0,0,1,0,0);var F=this.isPointInPath_old(y,C);this.restore();return F}var u=CanvasRenderingContext2D.prototype,t=document.createElement("canvas").getContext("2d");t.translate(50,0);t.moveTo(125,50);t.arc(100,50,25,0,360,false);if(!t.isPointInPath(150,50)){u.isPointInPath_old=u.isPointInPath;u.isPointInPath=o}}function g(o,u,t){var y,C;p[u]=function(F){for(y=q.length;y--;)if(C=t[q[y]])F[v[y]]=C}}function i(o,u,t){return{draw:t||K,viewport:o,hit:u&&f.isPointInPath(u.x,
u.y),vpX:n,vpY:m,context:f}}e=J({},e);var c,l,j,f,n=0,m=0,p={},w=null,A={},B=function(){},K=function(){this.fill&&f.fill();this.stroke&&f.stroke()},q=["fill","stroke","lineWidth","opacity"],v=["fillStyle","strokeStyle","lineWidth","globalAlpha"];Q&&k();if(d){c=d.offsetWidth;l=d.offsetHeight;j=Q?Q.create("canvas",null,{position:"absolute","z-index":1}):new Canvas;j.width=c;j.height=l;a.attachFrame(j,true);f=null}b=J(h,{applyStyle:function(o){var u=p[o],t=f&&f.canvas?f.canvas.id:"default",y;A[t]||(A[t]=
[]);y=A[t].pop()||"reset";if(u){A[t].push(o);u(f);return y}},applyTransform:function(o){if(o.translateX!==0||o.translateY!==0||o.scaling!==1||o.rotation!==0){f.save();w={undo:function(){f.restore();w=null},x:o.xy.x,y:o.xy.y};f.translate(o.xy.x-n+o.translateX,o.xy.y-m+o.translateY);o.rotation!==0&&f.rotate(o.rotation);o.scaling!==1&&f.scale(o.scaling,o.scaling)}return w},drawTiles:function(o,u,t){for(var y=u.length;y--;){o=u[y];if(!o.loaded&&t)o.load(a.invalidate);else o.image&&f.drawImage(o.image,
o.x-n,o.y-m)}},prepare:function(o,u){var t,y=false;if(f)f.restore();else if(j)f=j.getContext("2d");for(t=o.length;t--;)y=y||o[t].clip;n=u.x;m=u.y;if(f){y||f.clearRect(0,0,c,l);f.save();f.globalCompositeOperation="source-over"}return f},prepArc:function(o,u,t){f.beginPath();f.arc(o.xy.x-(w?w.x:n),o.xy.y-(w?w.y:m),o.size>>1,o.startAngle,o.endAngle,false);return i(u,t)},prepImage:function(o,u,t,y){var C=(y.x||o.xy.x)-(w?w.x:n),F=(y.y||o.xy.y)-(w?w.y:m),N=y.image||o.image;if(N){f.beginPath();f.rect(C,
F,y.width||N.width,y.height||N.height);return i(u,t,function(){f.drawImage(N,C,F,y.width||N.width,y.height||N.height)})}},prepMarker:function(o,u,t){var y=o.xy.x-(w?w.x:n),C=o.xy.y-(w?w.y:m),F=o.size,N=undefined;f.beginPath();switch(o.markerType.toLowerCase()){case "image":N=B;f.rect(y-(F>>1),C-(F>>1),F,F);if(o.reset&&o.image){o.image=null;o.reset=false}o.image?f.drawImage(o.image,y-(F>>1),C-(F>>1),F,F):Xa(o.imageUrl,function(M){o.image=M;f.drawImage(o.image,y-(F>>1),C-(F>>1),F,F)});break;default:f.moveTo(y,
C);f.lineTo(y-(F>>1),C-F);f.lineTo(y+(F>>1),C-F);f.lineTo(y,C)}return i(u,t,N)},prepPoly:function(o,u,t,y){var C=true;o=y.points||o.points().cull(u);y=w?w.x:n;var F=w?w.y:m;f.beginPath();for(var N=o.length;N--;){var M=o[N].x-y,P=o[N].y-F;if(C){f.moveTo(M,P);C=false}else f.lineTo(M,P)}return i(u,t)},getContext:function(){return f}});(function(){ub.each(function(o,u){g(null,o,u)});Ea.bind("styleDefined",g)})();b.bind("detach",function(){d.removeChild(j)});b.bind("resize",function(){});return b});ia("renderer",
"dom",function(a,d,b,e,h){function k(j){var f=j.image=new Image;c[j.id]=j;f.src=j.url;f.onload=function(){if(l[j.id])i.appendChild(this);else j.image=null};f.style.cssText="-webkit-user-select: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute;";
return f}function g(j,f,n){var m=[],p;for(p in j){var w=j[p];if(n?w[n]:!f[p]){if(w.image&&w.image.parentNode){i.removeChild(w.image);w.image=null}m[m.length]=p}}for(f=m.length;f--;)delete j[m[f]]}var i=null,c={},l={};i=Q.create("div","",Q.styles({width:d.offsetWidth+"px",height:d.offsetHeight+"px"}));d.childNodes.length>0?d.insertBefore(i,d.childNodes[0]):d.appendChild(i);a.attachFrame(i);b=J(h,{drawTiles:function(j,f,n){for(var m,p=j.x,w=j.y,A=f.length;A--;){j=f[A];if(j.url){(m=j.image||(n?k(j):
null))&&Q.move(m,j.x-p,j.y-w);l[j.id]=j}}}});b.bind("predraw",function(){g(c,l);l={}});b.bind("detach",function(){d.removeChild(i)});a.bind("reset",function(){for(g(c,l={});i.childNodes.length>0;)i.removeChild(i.childNodes[0])});return b});var ub=function(){function a(b,e){if(R(b,pa)){Ea.trigger("styleDefined",b,d[b]=e);return b}else{var h=[],k;for(k in b)h[h.length]=a(k,b[k]);return h}}var d={};a({reset:{fill:"#ffffff",opacity:1},highlight:{fill:"#ff0000"},waypoints:{lineWidth:4,stroke:"#003377",
fill:"#ffffff"},waypointsHover:{lineWidth:4,stroke:"#ff0000",fill:"#ffffff"}});return{resetStyle:"reset",each:function(b){for(var e in d)b(e,d[e])},get:function(b){return d[b]},define:a}}(),Ab=function(a,d){function b(r,s,x,E){r=C?Ga(W+xa(2,E)-1,0.125):E>0?2:0.5;o(r,false,true)}function e(r,s){var x=X&&X.projectXY?X.projectXY(r,s):null;if(!x){x=K();var E=1/W;x=new L.XY(x?x.x+r*E:r,x?x.y+s*E:s)}return x.sync(L,true)}function h(r,s,x){u("doubleTap",s,x,e(x.x,x.y));d.scalable&&o(2,{easing:"quad.out",
duration:300},true)}function k(r,s,x){T=null;O=true;A("down",s,x)}function g(r,s,x){A("hover",s,x)}function i(r,s,x,E){m(s,x,false);if(!T){G=E.x;U=E.y}}function c(r,s,x){m(s,x,true);O=false}function l(){clearTimeout(vb);vb=setTimeout(function(){if(I)if(I.offsetWidth!==Ha*2||I.offsetHeight!==Ia*2){var r=B();w(a);B(r.x,r.y)}},250)}function j(r,s,x){A("tap",s,x);L.trigger("tap",s,x,e(x.x,x.y,true))}function f(){fa&&fa.unbind();if(Q&&X){fa=INTERACT.watch(X.interactTarget||I);if(d.scalable){fa.bind("zoom",
b);fa.bind("doubleTap",h)}fa.bind("pointerDown",k);fa.bind("pointerMove",i);fa.bind("pointerUp",c);d.captureHover&&fa.bind("pointerHover",g);fa.bind("tap",j)}}function n(r){if(X){X.trigger("detach");X=null}var s=L,x=z,E=I,Z=d;r=r.split("/");for(var $=new Mb(s,x,E,Z),na=0;na<r.length;na++)$=Aa("renderer",r[na],s,x,E,Z,$);X=$;D=Q&&X.fastpan&&Q.transforms;C=Q&&Q.transforms&&d.useTransforms;f();L.trigger("reset");v()}function m(r,s,x){if(T){r=e(s.x,s.y);T.drag.call(T.target,T,r.x,r.y,x)&&aa++;if(x)T=
null}}function p(r){for(var s=P;s--;)if(M[s].id===r)return s;return P}function w(r){if(Q){I=document.getElementById(r);I.appendChild(H=Q.create("div","",Q.styles({overflow:"hidden",width:I.offsetWidth+"px",height:I.offsetHeight+"px"})));r=d.padding;if(r===y){r=I.offsetWidth;var s=I.offsetHeight,x=cb(r*r+s*s);ga=new V(x-r>>1,x-s>>1)}else ga=new V(r,r);Ya=H.offsetWidth+ga.x*2;Za=H.offsetHeight+ga.y*2;gb=Ya/2;hb=Za/2;Ha=I.offsetWidth/2;Ia=I.offsetHeight/2;Ja=new V(gb,hb);H.appendChild(z=Q.create("div",
"",Q.styles({width:Ya+"px",height:Za+"px","z-index":2,margin:-ga.y+"px 0 0 "+-ga.x+"px"})));n(d.renderer);r=d.controls;for(s=0;s<N.length;s++)N[s].trigger("detach");N=[];for(s=0;s<r.length;s++)N[N.length]=Aa("control",r[s],L,H,I,d[r[s]])}else n("canvas")}function A(r,s,x){var E=(new V(x.x-Ha+gb,x.y-Ia+hb)).rotate(-ka*la,Ja).scale(1/W,Ja);ca=Hits.init(r,s,x,e(x.x,x.y,true),E);for(r=P;r--;)if(M[r].visible)ja=ja||(M[r].hitGuess?M[r].hitGuess(ca.gridX,ca.gridY,L):false);ja&&aa++}function B(r,s,x){if(R(r,
pa)||R(r,Ib)){s=new L.XY(r);s.sync(L);r=s.x;s=s.y}if(R(r,ta)){t(r-Ha-ga.x,s-Ia-ga.y,x);return L}else return t().offset(Ha+ga.x|0,Ia+ga.y|0).sync(L,true)}function K(){var r=new qa(S,Y,Ya,Za);r.scaleFactor=W;r.padding=ga?ga.copy():new V;return r}function q(r,s,x){if(R(r,pa)&&R(s,ya))for(s=0;s<P;s++){if(M[s].id===r)return M[s]}else if(R(r,pa)){s=Aa("layer",s,L,x);s.added=(new Date).getTime();s.id=r;M[p(r)]=s;M.sort(function(E,Z){return Z.zindex-E.zindex||Z.added-E.added});P=M.length;L.trigger("resync");
v();L.trigger("layerChange",L,s);aa++;return s}else return[].concat(M)}function v(){var r=K();if(r){if(Ca||Da)if(r){var s=$a?S+(r.w>>1):S,x=ab?Y+(r.h>>1):Y,E=r.w,Z=r.h;if(Ca&&Ca>E)if(s+E>Ca)S=$a?S:Ca-E;else if(s<0)S=$a?S:0;if(Da&&Da>Z)if(x+Z>Da)Y=ab?Y:Da-Z;else if(x<0)Y=ab?Y:0}wb=S;xb=Y;L.trigger("refresh",L,r);aa++}}function o(r,s,x){if(R(r,ta)){var E=x?r:W*r;if(!Nb){s=null;r=Wa(eb(E)/Math.LN2);E=xa(2,r)}if(s)Ka=oa.tween([W],[E],s,function(){W=E;Ka=null;aa++});else{W=E;aa++}return L}else return W}
function u(){for(var r=L.trigger.apply(null,arguments).cancel,s=M.length;s--;)r=M[s].trigger.apply(null,arguments).cancel||r;return!r}function t(r,s,x){if(R(r,ta)){if(x)ua=oa.tween([S,Y],[r,s],x,function(){ua=null});else{S=r|0;Y=s|0;aa++}return L}else return(new L.XY(S,Y)).sync(L,true)}d=J({captureHover:true,controls:[],drawOnScale:true,padding:128,inertia:true,refreshDistance:128,pannable:true,scalable:true,renderer:"canvas",useTransforms:true},d);var y="auto",C=true,F=false,N=[],M=[],P=0,z=null,
H=null,I,T=null,ja=false,D,O=false,G=0,U=0,ba=d.refreshDistance,S=0,Y=0,La=0,Ma=0,wb=0,xb=0,Ca=null,Da=null,$a=false,ab=false,ua=null,ga,ca=null,Na=null,X,vb=0,Ja=new V,ka=0,Oa=null,W=1,Ka=null,ib=1,fa=null,jb={index:0,draw:false},Nb=true,aa=0,Ya,Za,gb,hb,Ha,Ia,L={XY:V,id:d.id,panSpeed:0,attachFrame:function(r,s){s&&z.appendChild(r)},center:B,detach:function(){X&&X.trigger("detach");fa&&fa.unbind();if(H){I.removeChild(H);z=H=null}},frozen:function(r){if(R(r,ya))return F;else{F=r;return L}},layer:q,
invalidate:function(){aa++},pan:function(r,s,x){t(S+r,Y+s,x)},refresh:v,rotate:function(r,s,x){if(R(r,ta)){var E=x?r:ka+r;if(s)Oa=oa.tween([ka],[E],s,function(){ka=E%360;Oa=null;aa++});else{ka=E%360;aa++}return L}else return ka},scale:o,triggerAll:u,setMaxOffset:function(r,s,x,E){Ca=r;Da=s;$a=x;ab=E},offset:t,viewport:K};ra(L);L.bind("resize",l);L.bind("layerRemove",function(r,s){var x=bb(M,s.id);if(x>=0&&x<P){M.splice(x,1);aa++}P=M.length});rb(L,d,{container:w,captureHover:f,scalable:f,pannable:f,
renderer:n});q("markers","draw",{zindex:20});w(a);if(Q&&!R(window.attachEvent,ya))window.attachEvent("onresize",l);else Q&&window.addEventListener("resize",l,false);Ba.attach(function(r){var s=[],x,E,Z;if(!F){L.panSpeed=panSpeed=ma(G)+ma(U);(x=W!==ib)&&L.trigger("scale");if(panSpeed>0||x||ua||Ka||Oa){aa++;if(ua&&panSpeed>0){ua(true);ua=null}}if(panSpeed<2&&(ma(S-wb)>=ba||ma(Y-xb)>=ba))v();jb.index++;jb.draw=aa||panSpeed||0;if(X&&jb.draw){if(Ka)W=Ka()[0];if(Oa)ka=Oa()[0];La+=G;Ma+=U;if(G||U)L.trigger("pan");
if(C){if(W!==1)s[s.length]="scale("+W+")";if(ka!==0)s[s.length]="rotate("+ka+"deg)"}if(x=!D||(d.drawOnScale||W===1)&&panSpeed<5){if(ua){x=ua();S=x[0]|0;Y=x[1]|0}else{E=-ka*la;x=sa(E)*La+-da(E)*Ma;E=da(E)*La+sa(E)*Ma;S=S-x/W|0;Y=Y-E/W|0}Z=K();X.trigger("predraw",Z);if(X.prepare(M,Z,r,ca)){E=Ma=x=La=aa=0;for(ii=P;ii--;){var $=M[ii];if($.visible){var na=$.style?X.applyStyle($.style,true):null;$.draw(X,Z,L,r,ca);na&&X.applyStyle(na)}}X.trigger("render",Z);L.trigger("drawComplete",Z,r);Q.move(z,x,E,s,
Ja)}}else Q.move(z,La,Ma,s,Ja);if(O||!d.inertia)U=G=0;else if(G!=0||U!=0){G*=0.8;U*=0.8;if(ma(G)<0.5)G=0;if(ma(U)<0.5)U=0}if(ca){r=true;s=ca?ca.elements:[];if(Na&&Na.type==="hover"){diffElements=Hits.diffHits(Na.elements,s);if(diffElements.length>0)Hits.triggerEvent(Na,L,"Out",diffElements);else r=false}if(s.length>0){E=ca.gridX;Z=ca.gridY;for(x=s.length;x--;){$=s[x];na=E;var yb=Z,zb=$&&$.drag&&(!$.canDrag||$.canDrag($,na,yb));if(zb){T=$;T.startX=na;T.startY=yb}if(zb)break}r&&Hits.triggerEvent(ca,
L)}Na=s.length>0?J({},ca):null;ca=null}if(ib!==W){L.trigger("scaleChanged",W);ib=W}}}});return L},oa=function(){return{tween:function(a,d,b,e,h){function k(p){var w=p-m;p=m+n<=p;for(var A=g;A--;)i[A]=l(w,a[A],j[A],n);h&&h.invalidate();if(p||f){Ba.detach(k);for(A=0;A<c.length;A++)c[A]&&c[A](i,w,f)}}b=J({easing:"sine.out",duration:1E3,complete:null},b);var g=a.length,i=[].concat(a),c=[e,b.complete],l=Eb(b.easing),j=[],f=false,n=b.duration,m=(new Date).getTime();for(b=g;b--;)j[b]=d[b]-a[b];Ba.attach(k);
return function(p){f=p;return i}},tweenDrawable:function(a,d,b,e,h){var k=oa.tween([b],[e],h,function(){a[d]=e;for(var i=a.tweens.length;i--;)if(a.tweens[i]===g){a.tweens.splice(i,1);break}},a.view),g=function(){a[d]=k()[0]};return g}}}(),za=function(a,d,b){b=J({style:null,xy:null,size:20,fill:false,stroke:true,draggable:false,observable:true,properties:{},typeName:"Shape",zindex:0},b);J(this,b);if(R(this.xy,pa))this.xy=new a.XY(this.xy);this.id="drawable_"+Lb++;this.bounds=null;this.view=a;this.layer=
d;this.tweens=[];this.rotation=this.animations=0;this.scaling=1;this.translateY=this.translateX=0;this.observable&&ra(this)};za.prototype={constructor:za,applyTweens:function(){for(var a=this.tweens.length;a--;)this.tweens[a]()},drag:null,draw:null,getProps:null,resync:function(){if(this.xy){this.xy.sync(this.view);if(this.size){var a=this.size>>1;this.updateBounds(new qa(this.xy.x-a,this.xy.y-a,this.size,this.size))}}},rotate:function(a,d,b){if(R(a,ta)){a=(b?a:this.rotation*Va+a)*la;if(d)this.tweens.push(oa.tweenDrawable(this,
"rotation",this.rotation,a,d));else{this.rotation=a;this.view.invalidate()}return this}else return this.rotation*Va},scale:function(a,d,b){if(R(a,ta)){a=b?a:this.scaling*a;if(d)this.tweens.push(oa.tweenDrawable(this,"scaling",this.scaling,a,d));else{this.scaling=a;this.view.invalidate()}return this}else return this.scaling},translate:function(a,d,b,e){if(R(a,ta)){a=e?a:this.translateX+a;d=e?d:this.translateY+d;if(b){this.tweens.push(oa.tweenDrawable(this,"translateX",this.translateX,a,b));this.tweens.push(oa.tweenDrawable(this,
"translateY",this.translateY,d,b))}else{this.translateX=a;this.translateY=d;this.view.invalidate()}return this}else return new V(this.translateX,this.translateY)},updateBounds:function(a,d){a&&(!this.bounds||a.x!=this.bounds.x||a.y!=this.bounds.y)&&this.trigger("move",this,a,this.bounds);this.bounds=a;if(d)this.xy=this.bounds.center()}};ia("drawable","marker",function(a,d,b){b=J({fill:true,stroke:false,markerType:"simple",hoverStyle:"highlight",typeName:"Marker"},b);return new za(a,d,b)});ia("drawable",
"poly",function(a,d,b){function e(){var j,f,n,m,p,w,A;c=b.simplify?i.simplify():i;for(j=c.length;j--;){f=c[j].x;n=c[j].y;w=R(w,ya)||f<w?f:w;A=R(A,ya)||n<A?n:A;m=R(m,ya)||f>m?f:m;p=R(p,ya)||n>p?n:p}l.updateBounds(new qa(w,A,m-w,p-A),true);a.invalidate()}function h(j){if(R(j,Jb)){i=new Fa(b.allowCull);tb.process(j,function(f,n){for(var m=0;m<n;m++)i.push(new a.XY(f[m]))},k,g);return l}else return c}function k(){i.length&&tb.process(i,function(j,f){for(var n=f;n--;)j[n].sync(a)},e,g)}b=J({allowCull:false,
simplify:false,fill:true,points:[],typeName:"Poly"},b);var g=500,i=new Fa(b.allowCull),c,l=J(new za(a,d,b),{points:h,resync:k});h(b.points);return l});ia("drawable","line",function(a,d,b){b.fill=false;b.allowCull=true;return Aa("drawable","poly",a,d,b)});ia("drawable","image",function(a,d,b){function e(){if(c&&c.width>0){if(!this.centerOffset)this.centerOffset=new V(-c.width>>1,-c.height>>1);this.updateBounds(new qa(this.xy.x+this.centerOffset.x,this.xy.y+this.centerOffset.y,c.width,c.height),false)}}
function h(j){if(this.imageUrl=j){var f=this;Xa(this.imageUrl,function(n,m){c=n;if(m){var p=l.layer?l.layer.view:null;p&&p.invalidate()}e.apply(f)})}}b=J({image:null,imageUrl:null,centerOffset:null,typeName:"Image"},b);var k=za.prototype.resync,g=0,i=0,c=b.image,l=J(new za(a,d,b),{changeImage:h,getProps:function(){this.bounds||e(this,c);return{image:c,x:this.xy.x+g,y:this.xy.y+i}},resync:function(j){k.call(this,j);e.call(this)}});c||h.call(this,this.imageUrl);if(this.centerOffset){g=this.centerOffset.x;
i=this.centerOffset.y}});ia("drawable","arc",function(a,d,b){b=J({startAngle:0,endAngle:Math.PI*2,typeName:"Arc"},b);return new za(a,d,b)});Sa.prototype={constructor:Sa,clip:null,cycle:function(){},draw:function(){},hitGuess:null,remove:function(){this.view.trigger("layerRemove",this)}};ia("layer","tile",function(a,d){d=J({generator:"osm",imageLoadArgs:{}},d);var b=Aa("generator",d.generator,d).run,e=null,h=[],k=J(new Sa(a,d),{draw:function(g,i,c){g.drawTiles&&g.drawTiles(i,e.search(i.buffer(128)),
c.panSpeed<2)}});a.bind("resync",function(){var g=a&&a.zoom?a.zoom():0;h[g]||(h[g]=pb(g));e=h[g]});a.bind("refresh",function(g,i,c){e&&b(i,c,e,function(){i.invalidate()})});return k});ia("layer","draw",function(a,d){function b(i,c,l,j){var f=this.dragOffset;if(!f)f=this.dragOffset=new a.XY(i.startX-this.xy.x,i.startY-this.xy.y);this.xy.x=c-f.x;this.xy.y=l-f.y;if(j){delete this.dragOffset;a.invalidate();this.xy.sync(a,true);this.trigger("dragDrop")}return true}function e(i,c,l,j){j&&k.remove(j,c);
k.insert(l,c)}d=J({zindex:10},d);var h=[],k,g=J(new Sa(a,d),{itemCount:0,clear:function(){k=new qb;h=[];g.trigger("cleared");g.itemCount=0;a.invalidate()},create:function(i,c,l){c=Aa("drawable",i,a,g,c);if(l)h.unshift(c);else h[h.length]=c;c.resync();k&&c.bounds&&k.insert(c.bounds,c);c.bind("move",e);g.itemCount=h.length;g.trigger(i+"Added",c);return c},draw:function(i,c,l,j,f){l={};j=k&&c?k.search(c):[];for(var n=j.length;n--;){var m=j[n],p=m.style||g.style,w,A,B=m.getProps?m.getProps(i):l;w=i["prep"+
m.typeName];m.tweens.length>0&&m.applyTweens();A=i.applyTransform(m);if(B=w?w.call(i,m,c,f,B):null){if(f&&B.hit){f.elements.push(Hits.initHit(m.type,m,m.draggable?b:null));w=f.type+"Style";p=m[w]||g[w]||p}p=p?i.applyStyle(p,true):null;(w=m.draw||B.draw)&&w.call(m,B);p&&i.applyStyle(p)}A&&A.undo&&A.undo()}},find:function(){return[].concat(h)},hitGuess:function(i,c){return k&&k.search({x:i-10,y:c-10,w:20,h:20}).length>0}});a.bind("resync",function(){k=pb(a.zoom(),k);for(var i=h.length;i--;)h[i].resync()});
return g});Ta.prototype={constructor:Ta};ia("control","zoombar",function(a,d,b,e){function h(t,y){var C=q[t]=Q.create("div","t5-zoombar-button",{position:"absolute",background:k(t),"z-index":51,width:e.width+"px",height:e.buttonHeight+"px","margin-top":(y||0)+"px"});v.appendChild(C)}function k(t,y){return"url("+e.images+") 0 -"+(f+m*3+(t||0)*l*3+(y||0)*l)+"px"}function g(t){return"url("+e.images+") 0 -"+(f+(t||0)*m)+"px"}function i(t,y){var C;if(t===n){n.style.background=g(y);C="thumb"}else for(var F=
0;F<q.length;F++)if(t===q[F]){C="button"+F;q[F].style.background=k(F,y);break}return C}function c(t){if(t!==B){B=t;A=w-B/K*(w-p)|0;Q.move(n,0,A-p);clearTimeout(o);o=setTimeout(function(){a.zoom(B)},500)}}e=J({width:24,height:200,images:"img/zoom.png",align:"right",marginTop:10,spacing:10,thumbHeight:16,buttonHeight:16},e);var l=e.buttonHeight,j,f=e.height,n,m=e.thumbHeight,p=e.spacing+l-(m>>1),w=e.height-l-(m>>1),A=p,B=-1;d=a.minZoom();var K=a.maxZoom()-d+1,q=[],v,o=0,u={button0:function(){a.zoom(a.zoom()+
1)},button1:function(){a.zoom(a.zoom()-1)}};v=Q.create("div","t5-zoombar",{position:"absolute",background:"url("+e.images+")","z-index":50,overflow:"hidden",width:e.width+"px",height:e.height+"px",margin:function(){var t=e.spacing,y=wa("{0}px 0 0 {1}px");if(e.align==="right")t=b.offsetWidth-e.width-e.spacing;return y(e.marginTop,t)}()});b.childNodes[0]?b.insertBefore(v,b.childNodes[0]):b.appendChild(v);v.appendChild(n=Q.create("div","t5-zoombar-thumb",{position:"absolute",background:g(),"z-index":51,
width:e.width+"px",height:e.thumbHeight+"px",margin:"10px 0 0 0",top:A-p+"px"}));h(0);h(1,e.height-e.buttonHeight);j=INTERACT.watch(v,{bindTarget:v});j.bind("pointerMove",function(t,y,C){A=Math.min(Math.max(p,C.y-(m>>1)),w);c(K-(A-p)/w*K|0)});j.bind("pointerDown",function(t){i(t.target,2)});j.bind("pointerUp",function(t){i(t.target,0)});j.bind("tap",function(t){(t=u[i(t.target,2)])&&t()});d=new Ta(a);d.bind("detach",function(){j.unbind();b.removeChild(v)});a.bind("zoom",function(t,y){c(y)});c(a.zoom());
return d});J(Ea,{ex:J,log:va,observable:ra,configurable:rb,formatter:wa,wordExists:function(a,d){for(var b=a.split(/\s|\,/).length;b--;)if(a.toLowerCase()==d.toLowerCase())return true;return false},is:R,indexOf:bb,fn:function(a){return Kb("fn",a)},project:Qa,unproject:fb,getImage:Xa,userMessage:kb,Registry:Ua,Style:ub,DOM:Q,Rect:qa,XY:V,Line:Fa,Hits:Hits,Control:Ta,Tile:Ra,Tweener:oa,View:Ab,Map:function(a,d){function b(l,j){var f=c.viewport();if(l){f=Ga(l.bestZoomLevel(f.w,f.h),j||0);return e(f).center(l.center())}else return new GeoJS.BBox((new ha(f.x,
f.y2)).sync(c,true).pos(),(new ha(f.x2,f.y)).sync(c,true).pos())}function e(l,j,f){if(R(l,ta)){l=Ga(d.minZoom,db(d.maxZoom,l|0));if(l!==g){var n=c.viewport(),m=c.offset(),p=n.w/2;n=n.h/2;var w=xa(2,l-g),A=p/w|0,B=n/w|0;g=l;c.offset(((j||m.x+p)-A)*w,((f||m.y+n)-B)*w);refreshY=refreshX=0;c.trigger("zoom",l);c.trigger("reset");k=c.rpp=ea/(256<<g);c.setMaxOffset(ea/k|0,ea/k|0,true,false);c.scale(1,false,true);c.trigger("resync");c.refresh()}return c}else return g}d=J({controls:["zoombar"],minZoom:1,maxZoom:18,
renderer:"canvas/dom",zoom:1,zoombar:{}},d);var h=new ha,k,g=d.zoom||d.zoomLevel,i=0,c=J(new Ab(a,d),{XY:ha,bounds:b,zoom:e});k=c.rpp=ea/(256<<g);c.bind("refresh",function(){var l=c.viewport();if(h.x!=l.x||h.y!=l.y){c.trigger("boundsChange",b());h.x=l.x;h.y=l.y}});c.bind("scaleChanged",function(l,j){var f=eb(j)/Math.LN2|0;if(f!==0){j=xa(2,f);clearTimeout(i);i=setTimeout(function(){e(g+f)},500)}});return c}});if(typeof module!="undefined"&&module.exports)module.exports=Ea;ia("generator","osm",function(a){a=
J({flipY:false,tileSize:256,tilePath:"{0}/{1}/{2}.png",osmDataAck:true},a);var d=Math.PI/180,b=180/Math.PI,e=null,h=[],k,g=wa(a.tilePath),i={buildTileUrl:function(c,l,j,f,n){if(l>=0&&l<f){c=(c%f+f)%f;l=g(j,c,n?Math.abs(l-f+1):l);if(e)l=k(h[c%(h.length||1)])+l;return l}},run:function(c,l,j,f){var n=c.zoom?c.zoom():0;if(n){var m=2<<n-1,p=a.tileSize,w=(l.w/p|0)+1,A=(l.h/p|0)+1;l=(new ha(l.x,l.y)).sync(c,true).pos();var B=l.lat;l=new ha((l.lon+180)/360*m|0,(1-Math.log(Math.tan(B*d)+1/Math.cos(B*d))/Math.PI)/
2*m%m|0);B=Math.PI-2*Math.PI*l.y/m;B=new GeoJS.Pos(b*Math.atan(0.5*(Math.exp(B)-Math.exp(-B))),l.x/m*360-180);B=new ha(B);B.sync(c);c=a.flipY;var K=j.search({x:B.x,y:B.y,w:w*p,h:A*p}),q={},v;for(v=K.length;v--;)q[K[v].id]=true;h=(e=i.getServerDetails?i.getServerDetails():null)&&e.subDomains?e.subDomains:[];k=wa(e?e.baseUrl:"");for(K=0;K<=w;K++)for(v=0;v<=A;v++){var o=l.x+K,u=l.y+v,t=o+"_"+u;if(!q[t]){tileUrl=i.buildTileUrl(o,u,n,m,c);o=new Ra(B.x+K*p,B.y+v*p,tileUrl,p,p,t);j.insert(o,o)}}f&&f()}}};
a.osmDataAck&&kb("ack","osm",'Map data (c) <a href="http://openstreetmap.org/" target="_blank">OpenStreetMap</a> (and) contributors, CC-BY-SA');return i})})();
