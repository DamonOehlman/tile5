(function(cb){function G(){var a=arguments[0]||{},b=Array.prototype.slice.call(arguments,1),c,i;for(i=b.length;i--;)if((c=b[i])!==null)for(var k in c){var j=c[k];if(a!==j)if(j!==undefined)a[k]=j}return a}function ha(a,b){if(typeof console!=="undefined")console[b||"debug"](a)}function Ea(a){var b=a.match(Bb),c=[],i=0,k;for(k=b?b.length:0;k--;){var j=b[k].slice(1);c[j]||(c[j]=RegExp("\\{"+j+"\\}","g"))}i=c.length;return function(){var g=a;for(k=0;k<i;k++)g=g.replace(c[k],arguments[k]||"");return g}}
function Qa(a){a=a.replace(/[\-\_\s\.]/g,"").toLowerCase();return xa[a]||xa.linear}function db(a,b,c,i,k){function j(e){e=e?e:(new Date).getTime();if(d+eb<e){var f=e-g,p=c(f,a,h,i),l=g+i<=e;e=!l;if(k){f=k(p,l,f);e=typeof f!="undefined"?f&&e:e}e&&animFrame(j)}}var g=(new Date).getTime(),d=0,h=b-a;animFrame(j);return{}}function fb(a,b,c){W.trigger("userMessage",a,b,c)}function gb(a){a=parseFloat(a)*ia;a=oa(a);var b=Fa*a;return ja((1+a)/(1-a)*ka((1-b)/(1+b),Fa))/2}function hb(a){return da/(256<<a)}function ib(a,
b){var c=Fa*oa(a);return ya-2*jb(b*ka((1-c)/(1+c),Fa/2))}function O(a,b){this.mercY=this.mercX=null;if(X(a,Ga))kb.parseXY(a,this);else if(a&&a.toPixels){var c=a.toPixels();this.mercX=c.x;this.mercY=c.y}else{this.x=a||0;this.y=b||0}}function la(a,b,c,i){this.x=a||0;this.y=b||0;this.w=c||0;this.h=i||0;this.x2=this.x+this.w;this.y2=this.y+this.h}function lb(a,b){var c=new mb(Math.sqrt(256<<a)|0);b&&b.zoomLevel===a&&b.copyInto(c);c.zoomLevel=a;return c}function nb(a){a=a||(new Date).getTime();for(var b=
0;b<ua.length;){var c=ua[b],i=pa[c],k=pa[c].image&&pa[c].image.complete&&pa[c].image.width>0,j=a-i.start;j=k||j>=Cb;if(k){k=i.callbacks;ob[c]=i.image;for(var g=0;g<k.length;g++)k[g](i.image,true)}if(j){ua.splice(b,1);delete pa[c]}else b++}ua.length>0&&animFrame(nb)}function Ha(a,b){var c=a&&b?ob[a]:null;if(c&&c&&c.complete&&c.width>0)b(c);else{if(c=pa[a])c.callbacks.push(b);else{c=new Image;c.id="_ldimg"+ ++Db;pa[a]={start:(new Date).getTime(),image:c,callbacks:[b]};c.src=a;ua[ua.length]=a}animFrame(nb)}}
function Ia(a,b,c,i,k,j){this.x=a;this.y=b;this.w=i||256;this.h=i||256;this.x2=this.x+this.w;this.y2=this.y+this.h;this.url=c;this.id=j||a+"_"+b;this.loaded=false;this.image=null}function pb(a){a=a?a:(new Date).getTime();if(a-qb>eb){for(var b=za.splice(0),c=b.length;c--;)b[c](a);qb=a}za.length&&animFrame(pb)}function rb(a){var b=za.length==0;za[za.length]=a;b&&animFrame(pb)}function Eb(a,b,c,i,k){k=G({easing:"sine.out",duration:1E3,progress:null,complete:null,autoInvalidate:true},k);var j=(new Date).getTime(),
g=a[b],d=b=="translate",h=k.autoInvalidate,e=c.length&&i.length&&c.length==i.length?c.length:0,f=Array(e),p=Array(e),l=Qa(k.easing),m=k.duration,q=k.progress,w=function(x){var y=x-j;x=j+m<=x;for(var E=a.layer?a.layer.view:null,J,v=e;v--;){J=l(y,c[v],f[v],m);p[v]=d?J|0:J}g.apply(a,p);h&&E&&E.invalidate();if(q){y=[].concat(x?i:p);y.unshift(x);q.apply(a,y)}if(x){a.animations--;g.apply(a,i);k.complete&&k.complete.apply(a,i)}else rb(w)};if(g&&g.apply&&e>0){m=m?m:DEFAULT_DURATION;for(b=e;b--;)f[b]=i[b]-
c[b];a.animations++;rb(w)}}function Ja(a,b){b=G({id:"layer_"+Fb++,zindex:0,animated:false,style:null,minXY:null,maxXY:null},b);this.visible=true;qa(G(this,b))}function ga(a,b){if(a&&a.split){var c=a.split(sb);if(c.length>1){a=c[0];b=c[1]}}else if(a&&a.lat){b=a.lon;a=a.lat}this.lat=parseFloat(a||0);this.lon=parseFloat(b||0)}function Aa(a,b){if(X(a,Gb)){for(var c=b,i=this.min=new ga(tb,ub),k=this.max=new ga(Hb,Ib),j=a.length;j--;){var g=a[j];if(g.lat<i.lat)i.lat=g.lat;if(g.lat>k.lat)k.lat=g.lat;if(g.lon<
i.lon)i.lon=g.lon;if(g.lon>k.lon)k.lon=g.lon}if(X(c,ma)){c=calcSize(bounds.min,bounds.max);c=Ra(c.x,c.y)*0.3}this.expand(c)}else{this.min=a;this.max=b}}var Sa={};(function(a){var b=[],c=0,i=false,k=a.register=function(j,g){b.push({section:j,run:g})};a.init=function(j){function g(){if(c<b.length){var h=b[c++];d[h.section]||(d[h.section]={});h.run(d[h.section],g)}else{for(h in d)a[h]=d[h];i=true;j&&j(a)}}var d={};if(i&&j)j(a);else{c=0;g()}};k("canvas",function(j,g){function d(){var p,l=h.getContext("2d");
l.save();try{l.translate(50,50);l.beginPath();l.rect(0,0,20,20);p=l.isPointInPath(10,10)}finally{l.restore()}return p}var h=document.createElement("canvas"),e=typeof FlashCanvas!="undefined",f=typeof G_vmlCanvasManager!="undefnined";h.width=200;h.height=200;j.pipTransformed=e||f?false:d();g()})})(Sa);window.animFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){setTimeout(function(){a((new Date).getTime())},
1E3/60)}}();var Bb=/\{(\d+)(?=\})/g,xa=function(){var a=1.70158,b=Math.PI/2,c=Math.abs,i=Math.pow,k=Math.sin,j=Math.asin,g=Math.cos;return{linear:function(d,h,e,f){return e*d/f+h},backin:function(d,h,e,f){return e*(d/=f)*d*((a+1)*d-a)+h},backout:function(d,h,e,f){return e*((d=d/f-1)*d*((a+1)*d+a)+1)+h},backinout:function(d,h,e,f){return(d/=f/2)<1?e/2*d*d*(((a*=1.525)+1)*d-a)+h:e/2*((d-=2)*d*(((a*=1.525)+1)*d+a)+2)+h},bouncein:function(d,h,e,f){return e-xa.bounceout(f-d,0,e,f)+h},bounceout:function(d,
h,e,f){return(d/=f)<1/2.75?e*7.5625*d*d+h:d<2/2.75?e*(7.5625*(d-=1.5/2.75)*d+0.75)+h:d<2.5/2.75?e*(7.5625*(d-=2.25/2.75)*d+0.9375)+h:e*(7.5625*(d-=2.625/2.75)*d+0.984375)+h},bounceinout:function(d,h,e,f){return d<f/2?xa.bouncein(d*2,0,e,f)/2+h:xa.bounceout(d*2-f,0,e,f)/2+e/2+h},cubicin:function(d,h,e,f){return e*(d/=f)*d*d+h},cubicout:function(d,h,e,f){return e*((d=d/f-1)*d*d+1)+h},cubicinout:function(d,h,e,f){if((d/=f/2)<1)return e/2*d*d*d+h;return e/2*((d-=2)*d*d+2)+h},elasticin:function(d,h,e,
f,p,l){if(d==0)return h;if((d/=f)==1)return h+e;l||(l=f*0.3);if(!p||p<c(e)){p=e;e=l/4}else e=l/da*j(e/p);return-(p*i(2,10*(d-=1))*k((d*f-e)*da/l))+h},elasticout:function(d,h,e,f,p,l){var m;if(d==0)return h;if((d/=f)==1)return h+e;l||(l=f*0.3);if(!p||p<c(e)){p=e;m=l/4}else m=l/da*j(e/p);return p*i(2,-10*d)*k((d*f-m)*da/l)+e+h},elasticinout:function(d,h,e,f,p,l){var m;if(d==0)return h;if((d/=f/2)==2)return h+e;l||(l=f*0.3*1.5);if(!p||p<c(e)){p=e;m=l/4}else m=l/da*j(e/p);if(d<1)return-0.5*p*i(2,10*(d-=
1))*k((d*f-m)*da/l)+h;return p*i(2,-10*(d-=1))*k((d*f-m)*da/l)*0.5+e+h},quadin:function(d,h,e,f){return e*(d/=f)*d+h},quadout:function(d,h,e,f){return-e*(d/=f)*(d-2)+h},quadinout:function(d,h,e,f){if((d/=f/2)<1)return e/2*d*d+h;return-e/2*(--d*(d-2)-1)+h},sinein:function(d,h,e,f){return-e*g(d/f*b)+e+h},sineout:function(d,h,e,f){return e*k(d/f*b)+h},sineinout:function(d,h,e,f){return-e/2*(g(Math.PI*d/f)-1)+h}}}();if(typeof animFrame==="undefined")throw Error("animFrame COG required for tweening support");
var qa=function(){function a(c,i){var k=c.hasOwnProperty("obsHandlers")?c.obsHandlers:null;k[i]||(k[i]=[]);return k[i]}var b=0;return function(c){if(!c)return null;if(!(c.hasOwnProperty("obsHandlers")?c.obsHandlers:null))c.obsHandlers={};if(!c.hasOwnProperty("bind")){c.bind=function(i,k){var j="callback"+b++;a(c,i).unshift({fn:k,id:j});return j};c.triggerCustom=function(i,k){var j=a(c,i),g={cancel:false,name:i,source:this},d;for(d in k)g[d]=k[d];if(!j)return null;d=Array.prototype.slice.call(arguments,
2);c.eventInterceptor&&c.eventInterceptor(i,g,d);d.unshift(g);for(var h=j.length;h--&&!g.cancel;)j[h].fn.apply(this,d);return g};c.trigger=function(i){var k=Array.prototype.slice.call(arguments,1);k.splice(0,0,i,null);return c.triggerCustom.apply(this,k)};c.unbind=function(i,k){if(typeof i==="undefined")c.obsHandlers={};else for(var j=a(c,i),g=0;j&&g<j.length;g++)if(j[g].id===k){j.splice(g,1);break}return c}}return c}}(),vb=Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===
a)return b;return-1},X=function(){return function(a,b){b=Jb.call(b);if(b=="finite")return!Kb[Lb](+a);return b=="null"&&a===null||b==typeof a||b=="object"&&a===Object(a)||b=="array"&&Array.isArray&&Array.isArray(a)||Mb.call(a).slice(8,-1).toLowerCase()==b}}(),Nb=function(){function a(k){var j=document.createElement("script"),g=false;j.src=k;j.async=true;j.onload=j.onreadystatechange=function(){if(!g&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){g=true;j.onload=j.onreadystatechange=
null;j&&j.parentNode&&j.parentNode.removeChild(j)}};c||(c=document.getElementsByTagName("head")[0]);c.appendChild(j)}var b=0,c,i=this;return function(k,j,g){k+=k.indexOf("?")>=0?"&":"?";var d="json"+ ++b;i[d]=function(h){j(h);i[d]=null;try{delete i[d]}catch(e){}};a(k+(g?g:"callback")+"="+d);return d}}();INTERACT=function(){function a(l){return function(m,q){l.addEventListener(m,q,false)}}function b(l){return function(m,q){l.removeEventListener(m,q,false)}}function c(l){return function(m,q){l.attachEvent("on"+
m,q)}}function i(l,m){return{x:l?l:0,y:m?m:0,count:1}}function k(l,m){f.push(G({handler:null,checks:{},type:l},m))}function j(l){var m=0,q=0;if(l.offsetParent){do{m+=l.offsetLeft;q+=l.offsetTop;l=l.offsetParent}while(l)}return{left:m,top:q}}function g(l,m){return{source:l,target:m.target?m.target:m.srcElement}}function d(l,m){for(var q=l.target?l.target:l.srcElement;q&&q!==m;)q=q.parentNode;return q&&q===m}function h(l,m){return{x:l.x-(m?m.left:0),y:l.y-(m?m.top:0)}}function e(l,m){if(l.preventDefault){l.preventDefault();
l.stopPropagation()}else if(typeof l.cancelBubble!="undefined")l.cancelBubble=true;m&&l.stopImmediatePropagation&&l.stopImmediatePropagation()}var f=[],p=function(l,m,q){q=G({binder:null,unbinder:null,observable:null},q);for(var w=q.observable,x=[],y,E,J={bind:function(){return w.bind.apply(null,arguments)},unbind:function(){w.unbind();for(v=0;v<x.length;v++)x[v].unbind();return J}},v=0;v<m.length;v++)x.push(m[v](l,w,q));w.bind("pointerDown",function(){E=y=0});w.bind("pointerMove",function(n,A,C,
u){y+=u.x||0;E+=u.y||0});w.bind("pointerUp",function(n,A,C){Math.abs(y)>20||Math.abs(E)>20||w.triggerCustom("tap",n,A,C)});return J};k("pointer",{handler:function(l,m,q){function w(s){if(s.pageX&&s.pageY)return i(s.pageX,s.pageY);else{var B=document.documentElement,M=document.body;return i(s.clientX+(B&&B.scrollLeft||M&&M.scrollLeft||0)-(B&&B.clientLeft||M&&M.clientLeft||0),s.clientY+(B&&B.scrollTop||M&&M.scrollTop||0)-(B&&B.clientTop||M&&M.clientTop||0))}}function x(s){if(d(s,l))if(u=v(s)){var B=
w(s);l.style.cursor="move";e(s,true);S=B.x;N=B.y;D=i(S,N);m.triggerCustom("pointerDown",g("mouse",s),D,h(D,j(l)))}}function y(s){var B=w(s);H=B.x;I=B.y;if(d(s,l))n(s,u?"pointerMove":"pointerHover")}function E(s){if(u&&v(s)){u=false;if(d(s,l)){l.style.cursor="default";n(s,"pointerUp")}}}function J(s){if(d(s,l)){var B;s=s||window.event;if(s.detail)B=s.axis===2?-s.detail*A:0;else{B=s.wheelDeltaY?s.wheelDeltaY:s.wheelDelta;if(window.opera)B=-B}if(B!==0){var M=i(H,I);m.triggerCustom("zoom",g("mouse",s),
M,h(M,j(l)),B/C,"wheel");e(s);s.returnValue=false}}}function v(s){s=s||window.event;return(s.which||s.button)==1}function n(s,B,M,P,T){M=typeof M!="undefined"?M:H;P=typeof P!="undefined"?P:I;var z=M-S,K=P-N,F=i(M,P);m.triggerCustom(B,g("mouse",s),F,h(F,j(l)),i(z,K));if(typeof T=="undefined"||T){S=M;N=P}}q=G({},q);var A=120,C=A*8,u=false,D,H,I,S,N;q.binder("mousedown",x);q.binder("mousemove",y);q.binder("mouseup",E);q.binder("dblclick",function(s){ha("captured double click");if(d(s,l)){var B=w(s);
m.triggerCustom("doubleTap",g("mouse",s),B,h(B,j(l)))}});q.binder("mousewheel",J);q.binder("DOMMouseScroll",J);return{unbind:function(){q.unbinder("mousedown",x);q.unbinder("mousemove",y);q.unbinder("mouseup",E);q.unbinder("mousewheel",J);q.unbinder("DOMMouseScroll",J)}}},checks:{touch:false}});k("pointer",{handler:function(l,m,q){function w(z){if(z.count<2)return 0;var K=z.x-z.next.x;z=z.y-z.next.y;return~~Math.sqrt(K*K+z*z)}function x(z,K,F){K=K?K:0;F=F?F:0;for(var Z={x:z.x-K,y:z.y-F,id:z.id,count:z.count},
V=Z;z.next;){z=z.next;V=V.next={x:z.x-K,y:z.y-F,id:z.id}}return Z}function y(z,K){var F=z[K?K:"touches"],Z,V;if(F.length===0)return null;V=Z={x:F[0].pageX,y:F[0].pageY,id:F[0].identifier,count:F.length};for(var Y=1,va=F.length;Y<va;Y++)V=V.next={x:F[Y].pageX,y:F[Y].pageY,id:F[Y].identifier};return Z}function E(z){if(d(z,l)){I=j(l);var K=y(z,"changedTouches"),F=x(K,I.left,I.top);if(!N){S=u;m.triggerCustom("pointerDown",g("touch",z),K,F)}P&&m.triggerCustom("pointerDownMulti",g("touch",z),K,F);N=y(z);
if(N.count>1)B=w(N);T=1;M=x(N)}}function J(z){if(d(z,l)){e(z);s=y(z);if(S==u)S=Math.abs(N.x-s.x)>A||Math.abs(N.y-s.y)>A?C:u;if(S!=u){S=s.count>1?H:D;if(S==H)if(N.count===1){N=x(s);B=w(N)}else{var K=w(s);if(Math.abs(B-K)<n)S=D;else{var F;F=s.x;var Z=s.next.x,V=s.y,Y=s.next.y;F={x:(F<Z?F:Z)+(Math.abs(F-Z)>>1),y:(V<Y?V:Y)+(Math.abs(V-Y)>>1)};K=K/B;Z=K-T;m.triggerCustom("zoom",g("touch",z),F,h(F,I),Z,"pinch");T=K}}S==D&&m.triggerCustom("pointerMove",g("touch",z),s,x(s,I.left,I.top),i(s.x-M.x,s.y-M.y));
P&&m.triggerCustom("pointerMoveMulti",g("touch",z),s,x(s,I.left,I.top))}M=x(s)}}function v(z){if(d(z,l)){var K=y(z,"changedTouches"),F=x(K,I.left,I.top);s=y(z);if(!s){m.triggerCustom("pointerUp",g("touch",z),K,F);N=null}P&&m.triggerCustom("pointerUpMulti",g("touch",z),K,F)}}q=G({detailed:false,inertia:false},q);var n=20,A=7,C=0,u=1,D=2,H=3,I,S,N,s,B,M,P=q.detailed,T=1;q.binder("touchstart",E);q.binder("touchmove",J);q.binder("touchend",v);ha("initialized touch handler");return{unbind:function(){q.unbinder("touchstart",
E);q.unbinder("touchmove",J);q.unbinder("touchend",v)}}},checks:{touch:true}});return{register:k,watch:function(l,m,q){m=G({bindTarget:null,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},m);capabilities=G({touch:"ontouchstart"in window},q);if(!m.observable){ha("creating observable");m.observable=qa({});globalOpts=m}m.binder=(m.isIE?c:a)(m.bindTarget||document);m.unbinder=(m.isIE?c:b)(m.bindTarget||document);q=m.types;for(var w=capabilities,x=[],y=f.length;y--;){var E=f[y],
J=!q||q.indexOf(E.type)>=0,v=true,n;for(n in E.checks){var A=E.checks[n];ha("checking "+n+" capability. require: "+A+", capability = "+w[n]);v=v&&A===w[n]}if(J&&v)x[x.length]=E.handler}return new p(l,x,m)}}}();var W={ex:G,log:ha,observable:qa,formatter:Ea,wordExists:function(a,b){for(var c=a.split(/\s|\,/).length;c--;)if(a.toLowerCase()==b.toLowerCase())return true;return false},is:X,indexOf:vb};qa(W);var Ta=function(){var a={};return{create:function(b,c){if(a[b][c])return a[b][c].apply(null,Array.prototype.slice.call(arguments,
2))},register:function(b,c,i){a[b]||(a[b]={});a[b][c]&&ha(Ob(b,c),"warn");a[b][c]=i}}}(),Ob=Ea("Registration of {0}: {1} will override existing definition"),Ua=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],da=Math.PI*2,ya=Math.PI/2,ia=Math.PI/180,Ka=180/Math.PI,tb=ya,Hb=-tb,ub=da,Ib=-ub,Fa=0.08181919084262157,na=Math.abs,wb=Math.ceil,wa=Math.round,La=Math.min,Ra=Math.max,ka=Math.pow,xb=Math.sqrt,ja=Math.log,oa=Math.sin,Pb=Math.asin,Va=Math.cos,jb=Math.atan,
Qb=Math.atan2,Lb="hasOwnProperty",Kb={NaN:1,Infinity:1,"-Infinity":1},Jb=String.prototype.toLowerCase,Mb=Object.prototype.toString,ma="undefined",Ga="string",Wa="number",Gb="array",ba=Ta.register,ra=Ta.create,Rb=0,Fb=0,sb=/[\,\s]+/,Sb=W.newCanvas=function(a,b){var c=document.createElement("canvas");c.width=a?a:0;c.height=b?b:0;W.trigger("createCanvas",c);return c},Tb=function(){function a(k){i++;k=k||(new Date).getTime();for(var j=c.length;j--;){var g=c[j];i%g.every===0&&g.cb(k)}animFrame(a)}var b=
1E3/60,c=[],i=0;animFrame(a);return{attach:function(k,j){c[c.length]={cb:k,every:j?wa(j/b):1}},detact:function(){}}}(),kb=function(){var a=/^xy\((.*)\).*$/i;return{parseXY:function(b,c){c=c||new O;if(!a.test(b)){var i=b.split(sb);c.mercX=parseFloat(i[1])*ia;c.mercY=gb(i[0])}return c}}}(),ea=function(){var a={"-webkit-user-select":"none",position:"absolute"},b;b=function(c){for(var i=0;i<c.length;i++){var k=c[i];if(typeof document.body.style[k]!="undefined")return k}}(["-webkit-transform","MozTransform"]);
return{supportTransforms:b,create:function(c,i,k){c=document.createElement(c);var j=[];k=k||{};c.className=i||"";for(var g in k)j[j.length]=g+": "+k[g];c.style.cssText=j.join(";");return c},move:function(c,i,k,j){if(b)c.style[b]="translate("+i+"px, "+k+"px) translateZ(0) "+(j||[]).join(" ");else{c.style.left=i+"px";c.style.top=k+"px"}},styles:function(c){return G({},a,c)}}}();O.prototype={constructor:O,add:function(){for(var a=this.x,b=this.y,c=arguments.length;c--;){a+=arguments[c].x;b+=arguments[c].y}return new O(a,
b)},equals:function(a){return this.x===a.x&&this.y===a.y},offset:function(a,b){return new O(this.x+a,this.y+b)},sync:function(a,b){if(b){this.mercX=this.x*a-Math.PI;this.mercY=Math.PI-this.y*a}else if(this.mercX||this.mercY){this.x=wa((this.mercX+Math.PI)/a);this.y=wa((Math.PI-this.mercY)/a)}return this},pos:function(){for(var a=ka(Math.E,-this.mercY),b=ya-2*jb(a),c=ib(b,a),i=0;i<12&&na(b-c)>1.0E-7;){b=c;c=ib(b,a);i++}return new ga(c*Ka,this.mercX%360*Ka)},toString:function(){return this.x+", "+this.y}};
la.prototype={constructor:la,buffer:function(a,b){return new la(this.x-a,this.y-(b||a),this.w+a*2,this.h+(b||a)*2)},center:function(){return new O(this.x+(this.w>>1),this.y+(this.h>>1))}};Hits=function(){return{diffHits:function(a,b){var c=[],i={},k;for(k=b.length;k--;)i[b[k].target.id]=true;for(k=a.length;k--;)i[a[k].target.id]||(c[c.length]=a[k]);return c},init:function(a,b,c,i){return{type:a,x:i.x|0,y:i.y|0,elements:[],absXY:b,relXY:c}},initHit:function(a,b,c){return{type:a,target:b,drag:c}},triggerEvent:function(a,
b,c,i){b.triggerCustom(a.type+(c?c:"Hit"),{hitType:a.type},i?i:a.elements,a.absXY,a.relXY,new O(a.x,a.y))}}}();var mb=function(a){function b(j,g){var d=c[j],h;d||(d=c[j]=[]);(h=d[g])||(h=d[g]=[]);return h}a=a||128;var c=[],i={},k=0;return{copyInto:function(j){for(var g in i){var d=i[g];j.insert(d.bounds||d,d,g)}},insert:function(j,g,d){var h=j.x/a|0,e=j.y/a|0,f=(j.x+j.w)/a|0;j=(j.y+j.h)/a|0;d=d||g.id||"obj_"+k++;i[d]=g;for(g=h;g<=f;g++)for(h=e;h<=j;h++)b(g,h).push(d)},remove:function(j,g,d){d=d||
g.id;if(i[d]){var h=j.x/a|0;g=j.y/a|0;var e=(j.x+j.w)/a|0;j=(j.y+j.h)/a|0;delete i[d];for(h=h;h<=e;h++)for(var f=g;f<=j;f++){var p=b(h,f),l=vb.call(p,d);l>=0&&p.splice(l,1)}}},search:function(j){var g=j.y/a|0,d=(j.x+j.w)/a|0,h=(j.y+j.h)/a|0,e=[],f=[];for(j=j.x/a|0;j<=d;j++)for(var p=g;p<=h;p++)e=e.concat(b(j,p));e.sort();for(g=e.length;g--;){d=e[g];if(h=i[d])f[f.length]=h;for(;g>0&&e[g-1]==d;)g--}return f}}},Cb=3E4,ob={},Db=0;(new Date).getTime();var pa={},ua=[];Ia.prototype={constructor:Ia,load:function(a){var b=
this;Ha(this.url,function(c){b.loaded=true;b.image=c;a&&a()})}};var Ub=function(){return qa({fastpan:true,applyStyle:function(){},applyTransform:function(a,b,c){return{restore:null,x:b,y:c}},checkSize:function(){},getDimensions:function(){return{width:0,height:0}},getViewport:function(){},hitTest:function(){return false},prepare:function(){},projectXY:null,reset:function(){}})},Vb=W.attachRenderer=function(a,b,c,i,k){a=a.split("/");for(var j=new Ub(b,c,i,k),g=0;g<a.length;g++)j=ra("renderer",a[g],
b,c,i,k,j);return j};ba("renderer","canvas",function(a,b,c,i,k){function j(n,A,C){var u,D;m[A]=function(H){for(u=J.length;u--;)if(D=C[J[u]])H[v[u]]=D}}function g(n,A,C){var u=false;if(A)u=f.isPointInPath(w?A.x-p:A.relXY.x,w?A.y-l:A.relXY.y);return{draw:C||E,viewport:n,hit:u,vpX:p,vpY:l,context:f}}i=G({},i);var d,h,e,f,p=0,l=0,m={},q=null,w=Sa.canvas.pipTransformed,x={},y=function(){},E=function(){this.fill&&f.fill();this.stroke&&f.stroke()},J=["fill","stroke","lineWidth","opacity"],v=["fillStyle",
"strokeStyle","lineWidth","globalAlpha"];if(b){d=b.offsetWidth;h=b.offsetHeight;e=Sb(d,h);e.style.cssText="position: absolute; z-index: 1;";a.attachFrame(e,true);f=null}c=G(k,{applyStyle:function(n){var A=m[n],C=f&&f.canvas?f.canvas.id:"default",u;x[C]||(x[C]=[]);u=x[C].pop()||"basic";if(A){x[C].push(n);A(f);return u}},applyTransform:function(n){if(n.translateX!==0||n.translateY!==0||n.scaling!==1||n.rotation!==0){f.save();q={undo:function(){f.restore();q=null},x:n.xy.x,y:n.xy.y};f.translate(n.xy.x-
p+n.translateX,n.xy.y-l+n.translateY);n.rotation!==0&&f.rotate(n.rotation);n.scaling!==1&&f.scale(n.scaling,n.scaling)}return q},drawTiles:function(n,A,C){for(var u,D=p-256,H=l-256,I=n.x2,S=n.y2,N=A.length;N--;){n=A[N];if(u=n.x>=D&&n.x<=I&&n.y>=H&&n.y<=S)if(!n.loaded&&C)n.load(a.invalidate);else n.image&&f.drawImage(n.image,n.x-p,n.y-l)}},prepare:function(n,A){var C,u=false,D=A.scaled||A;if(f)f.restore();else f=e.getContext("2d");for(C=n.length;C--;)u=u||n[C].clip;p=D.x;l=D.y;if(f){u||f.clearRect(0,
0,d,h);f.save()}f.globalCompositeOperation="source-over";return f},prepArc:function(n,A,C){f.beginPath();f.arc(n.xy.x-(q?q.x:p),n.xy.y-(q?q.y:l),n.size>>1,n.startAngle,n.endAngle,false);return g(A,C)},prepImage:function(n,A,C,u){var D=(u.x||n.xy.x)-(q?q.x:p),H=(u.y||n.xy.y)-(q?q.y:l),I=u.image||n.image;if(I){f.beginPath();f.rect(D,H,u.width||I.width,u.height||I.height);return g(A,C,function(){f.drawImage(I,D,H,u.width||I.width,u.height||I.height)})}},prepMarker:function(n,A,C){var u=n.xy.x-(q?q.x:
p),D=n.xy.y-(q?q.y:l),H=n.size,I=undefined;f.beginPath();switch(n.markerStyle.toLowerCase()){case "image":I=y;f.rect(u-(H>>1),D-(H>>1),H,H);if(n.reset&&n.image){n.image=null;n.reset=false}n.image?f.drawImage(n.image,u-(H>>1),D-(H>>1),H,H):Ha(n.imageUrl,function(S){n.image=S;f.drawImage(n.image,u-(H>>1),D-(H>>1),H,H)});break;default:f.moveTo(u,D);f.lineTo(u-(H>>1),D-H);f.lineTo(u+(H>>1),D-H);f.lineTo(u,D)}return g(A,C,I)},prepPoly:function(n,A,C,u){var D=true;n=u.points||n.points;u=q?q.x:p;var H=q?
q.y:l;f.beginPath();for(var I=n.length;I--;){var S=n[I].x-u,N=n[I].y-H;if(D){f.moveTo(S,N);D=false}else f.lineTo(S,N)}return g(A,C)},getContext:function(){return f}});(function(){for(var n in W.styles)j(null,n,W.styles[n]);W.bind("styleDefined",j)})();c.bind("detach",function(){b.removeChild(e)});return c});ba("renderer","dom",function(a,b,c,i,k){function j(f){var p=f.image=new Image;h[f.id]=f;p.src=f.url;p.onload=function(){if(e[f.id])d.appendChild(this);else f.image=null};p.style.cssText="-webkit-user-select: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute;";
return p}function g(f,p,l){var m=[],q;for(q in f){var w=f[q];if(l?w[l]:!p[q]){if(w.image&&w.image.parentNode){d.removeChild(w.image);w.image=null}m[m.length]=q}}for(p=m.length;p--;)delete f[m[p]]}var d=null,h={},e={};d=ea.create("div","",ea.styles({width:b.offsetWidth+"px",height:b.offsetHeight+"px"}));b.childNodes.length>0?b.insertBefore(d,b.childNodes[0]):b.appendChild(d);a.attachFrame(d);a=G(k,{drawTiles:function(f,p,l){for(var m,q=f.x,w=f.y,x=p.length;x--;){f=p[x];if(f.url){(m=f.image||(l?j(f):
null))&&ea.move(m,f.x-q,f.y-w);e[f.id]=f}}}});a.bind("predraw",function(){g(h,e);e={}});a.bind("detach",function(){b.removeChild(d)});a.bind("reset",function(){for(g(h,e={});d.childNodes.length>0;)d.removeChild(d.childNodes[0])});return a});var Xa=W.styles={},Wb=W.defineStyle=function(a,b){Xa[a]=b;W.trigger("styleDefined",a,Xa[a]);return a},yb=W.defineStyles=function(a){for(var b in a)Wb(b,a[b])};W.getStyle=function(a){return Xa[a]};W.loadStyles=function(a){Nb(a,function(b){yb(b)})};yb({basic:{fill:"#ffffff"},
highlight:{fill:"#ff0000"},waypoints:{lineWidth:4,stroke:"#003377",fill:"#ffffff"},waypointsHover:{lineWidth:4,stroke:"#ff0000",fill:"#ffffff"}});ba("view","simple",function(a){function b(o,r,t,L){y(La(Ra(U+ka(2,L)-1,0.5),2))}function c(o){var r=o|0;o=r+Math.round((o-r)*50)/50;if(o!==U){U=o;o=ja(U)/Math.LN2|0;if(o!==0){U=ka(2,o);m(Ba+o,Xb,Yb)}fa++}}function i(o,r){var t=renderer&&renderer.projectXY?renderer.projectXY(o,r):null;if(!t){t=Q.getViewport();var L=1/U;t=new O(t?t.x+o*L:o,t?t.y+r*L:r)}return t}
function k(o,r,t){E("doubleTap",r,t,i(t.x,t.y));a.scalable&&y(2,i(t.x,t.y),Zb,null,$b)}function j(o,r,t){D=null;N=true;l("down",r,t)}function g(o,r,t){l("hover",r,t)}function d(o,r,t,L){p(r,t,false);if(!D){s=L.x;B=L.y}}function h(o,r,t){p(r,t,true);N=false}function e(){clearTimeout(zb);zb=setTimeout(function(){renderer.checkSize()},250)}function f(o,r,t){l("tap",r,t);E("tap",r,t,i(t.x,t.y,true))}function p(o,r,t){if(D){o=i(r.x,r.y);D.drag.call(D.target,D,o.x,o.y,t)&&fa++;if(t)D=null}}function l(o,
r,t){aa=Hits.init(o,r,t,i(t.x,t.y,true));for(o=n;o--;)I=I||(v[o].hitGuess?v[o].hitGuess(aa.x,aa.y,Q):false);I&&fa++}function m(o,r,t){if(X(o,Wa)){o=Ra(a.minZoom,La(a.maxZoom,o|0));if(o!==Ba){var L=ka(2,o-Ba),R=Ya/L|0,$=Za/L|0;Ba=o;J(((r||P+Ya)-R)*L,((t||T+Za)-$)*L);Z=F=0;E("zoom",o);U=1;renderer.trigger("reset");x()}return Q}else return Ba}function q(){var o=new la(P,T,Ma,Na);o.scaleFactor=U;return o}function w(o,r,t){if(X(r,ma))for(r=0;r<n;r++){if(v[r].id===o)return v[r]}else if(X(o,Ga)){r=ra("layer",
r,Q,t);r.added=(new Date).getTime();r.id=o;v[v.length]=r;v.sort(function(L,R){return R.zindex-L.zindex||R.added-L.added});n=v.length;r.trigger("resync");r.trigger("refresh",Q,q());Q.trigger("layerChange",Q,r);fa++;return r}else return[].concat(v)}function x(){var o=q();if(o){if(V||Y)if(o){var r=va?P+(o.w>>1):P,t=Oa?T+(o.h>>1):T,L=o.w,R=o.h;if(V&&V>L)if(r+L>V)P=va?P:V-L;else if(r<0)P=va?P:0;if(Y&&Y>R)if(t+R>Y)T=Oa?T:Y-R;else if(t<0)T=Oa?T:0}F=P;Z=T;E("refresh",Q,o);fa++}}function y(o,r,t,L,R){var $;
if(!ac){t=false;$=wa(ja(o)/Math.LN2);o=ka(2,$)}t?db(U,o,t,R,function(sa,Pa){o=sa;if(Pa){$=wa(ja(o)/Math.LN2);o=ka(2,$);L&&L()}c(o)}):c(o);return Q}function E(){for(var o=Q.trigger.apply(null,arguments).cancel,r=v.length;r--;)o=v[r].trigger.apply(null,arguments).cancel||o;return!o}function J(o,r,t){if(X(o,Wa)){if(!(t&&panSpeed===0)){P=o|0;T=r|0}}else return new O(P,T)}a=G({container:"",captureHover:true,drawOnScale:true,padding:0,inertia:true,refreshDistance:256,pannable:false,scalable:false,minZoom:1,
maxZoom:1,renderer:"canvas/dom",zoom:1},a);var v=[],n=0,A=null,C=null,u,D=null,H=!X(window.attachEvent,ma),I=false,S=true,N=false,s=0,B=0,M=a.refreshDistance,P=0,T=0,z=0,K=0,F=0,Z=0,V=null,Y=null,va=false,Oa=false,Ca=a.padding,aa=null,Da=null,zb=0,U=1,Ab=1,ca=null,$a={index:0,draw:false},ac=true,fa=0,Ma,Na,Ya,Za,ab,bb,Xb,Yb,Ba=a.zoom||a.zoomLevel,Zb=Qa("quad.out"),$b=300,Q={id:a.id,padding:Ca,panSpeed:0,attachFrame:function(o,r){r&&A.appendChild(o)},center:function(o,r,t){if(X(o,Ga)){r=kb.parseXY(o).sync(Q.rpp);
o=r.x;r=r.y}if(X(o,Wa)){J(o-ab,r-bb,t);return Q}else{r=J().offset(ab,bb);Q.rpp&&r.sync(Q.rpp,true);return r}},detach:function(){renderer&&renderer.trigger("detach");ca&&ca.unbind();if(C){u.removeChild(C);A=C=null}},layer:w,invalidate:function(){fa++},refresh:x,resetScale:function(){U=1},scale:y,triggerAll:E,removeLayer:function(o){a:{for(var r=n;r--;)if(v[r].id===o){o=r;break a}o=-1}if(o>=0&&o<n){Q.trigger("layerRemove",Q,v[o]);v.splice(o,1);fa++}n=v.length},getRenderer:function(){return renderer},
getScaleFactor:function(){return U},setMaxOffset:function(o,r,t,L){V=o;Y=r;va=t;Oa=L},getViewport:q,offset:J,pan:function(o,r){s=o;B=r;fa++},zoom:m};qa(Q);Q.bind("resize",function(){renderer.checkSize()});Sa.init(function(){w("markers","draw",{zindex:20});u=document.getElementById(a.container);u.appendChild(C=ea.create("div","",ea.styles({overflow:"hidden",width:u.offsetWidth+"px",height:u.offsetHeight+"px"})));Ma=C.offsetWidth+Ca*2;Na=C.offsetHeight+Ca*2;Ya=Ma/2;Za=Na/2;ab=u.offsetWidth/2;bb=u.offsetHeight/
2;C.appendChild(A=ea.create("div","",ea.styles({width:Ma+"px",height:Na+"px","z-index":2,margin:-Ca+"px 0 0 "+-Ca+"px"})));renderer=Vb(a.renderer,Q,A,u,a);S=renderer.fastpan;ca&&ca.unbind();if(renderer){ca=INTERACT.watch(renderer.interactTarget||u);if(a.scalable){ca.bind("zoom",b);ca.bind("doubleTap",k)}ca.bind("pointerDown",j);ca.bind("pointerMove",d);ca.bind("pointerUp",h);a.captureHover&&ca.bind("pointerHover",g);ca.bind("tap",f)}H?window.attachEvent("onresize",e):window.addEventListener("resize",
e,false)});Tb.attach(function(o){var r=[],t,L,R;self.panSpeed=panSpeed=na(s)+na(B);t=U!==Ab;if(panSpeed>0||t)fa++;if(panSpeed<2&&(na(P-F)>=M||na(T-Z)>=M))x();$a.index++;$a.draw=fa||panSpeed||0;if(renderer&&$a.draw){z+=s;K+=B;if(s||B)Q.trigger("pan");if(U!==1&&ea.supportTransforms)r[r.length]="scale("+U+")";if(t=!S||(a.drawOnScale||U===1)&&panSpeed<5){P=P-z/U|0;T=T-K/U|0;R=q();renderer.trigger("predraw",R);if(renderer.prepare(v,R,o,aa)){L=K=t=z=fa=0;for(ii=n;ii--;){var $=v[ii];if($.visible){var sa=
$.style?renderer.applyStyle($.style,true):null;$.draw(renderer,R,Q,o,aa);sa&&renderer.applyStyle(sa)}}renderer.trigger("render",R);Q.trigger("drawComplete",R,o);Ab=U;ea.move(A,t,L,r)}}else ea.move(A,z,K,r);if(N||!a.inertia)B=s=0;else if(s!=0||B!=0){s*=0.8;B*=0.8;if(na(s)<0.5)s=0;if(na(B)<0.5)B=0}if(aa){o=aa?aa.elements:[];if(Da&&Da.type==="hover"){r=Hits.diffHits(Da.elements,o);r.length>0&&Hits.triggerEvent(Da,Q,"Out",r)}if(o.length>0){t=aa.x;L=aa.y;for(r=o.length;r--;){R=o[r];$=t;sa=L;var Pa=R&&
R.drag&&(!R.canDrag||R.canDrag(R,$,sa));if(Pa){D=R;D.startX=$;D.startY=sa}if(Pa)break}Hits.triggerEvent(aa,Q)}Da=o.length>0?G({},aa):null;aa=null}}});return Q});ba("view","map",function(a){function b(d,h,e){g.zoom(h);c(d,e)}function c(d,h,e,f){d=new O(d);d.sync(hb(g.zoom()));g.center(d.x,d.y,e,f,function(){h&&h(g)})}a=G({zoomLevel:1,minZoom:1,maxZoom:18,pannable:true,scalable:true},a);var i=new O,k=0,j=a.tapExtent;a.adjustScaleFactor=function(d){return Math.pow(2,(d<1?Math.floor:Math.ceil)(Math.log(d)))};
var g=G(ra("view","simple",a),{getBoundingBox:function(){var d=g.getViewport();return d?new Aa((new O(d.x,d.y2)).sync(k,true).pos(),(new O(d.x2,d.y)).sync(k,true).pos()):null},getCenterPosition:function(){var d=g.getViewport();if(d)return(new O(d.x+(d.w>>1),d.y+(d.h>>1))).sync(k,true).pos();return null},gotoBounds:function(d,h){b(d.center(),d.bestZoomLevel(g.getViewport()),h)},gotoPosition:b,panToPosition:c});g.bind("tap",function(d,h,e,f){d=f.sync(k,true).pos();var p=f.offset(-j,j).sync(k,true).pos();
f=f.offset(j,-j).sync(k,true).pos();g.trigger("geotap",h,e,d,new Aa(p,f))});g.bind("refresh",function(d,h,e){if(i.x!=e.x||i.y!=e.y){g.trigger("boundsChange",g.getBoundingBox());i.x=e.x;i.y=e.y}});g.bind("zoom",function(d,h){var e;k=g.rpp=hb(h);e=da/k|0;g.setMaxOffset(e,e,true,false);g.resetScale();g.triggerAll("resync")});return g});var ta=function(a,b,c){c=G({style:null,xy:null,size:20,fill:false,stroke:true,draggable:false,observable:true,properties:{},typeName:"Shape"},c);G(this,c);if(X(this.xy,
Ga))this.xy=new O(this.xy);this.id="drawable_"+Rb++;this.bounds=null;this.view=a;this.layer=b;this.rotation=this.animations=0;this.scaling=1;this.translateY=this.translateX=0;this.observable&&qa(this)};ta.prototype={constructor:ta,animate:function(a,b,c,i){Eb(this,a,b,c,i)},drag:null,draw:null,getProps:null,resync:function(){if(this.xy){this.xy.sync(this.view.rpp);if(this.size){var a=this.size>>1;this.updateBounds(new la(this.xy.x-a,this.xy.y-a,this.size,this.size))}}},rotate:function(a){this.rotation=
a},scale:function(a){this.scaling=a},translate:function(a,b){this.translateX=a;this.translateY=b},updateBounds:function(a,b){a&&(!this.bounds||a.x!=this.bounds.x||a.y!=this.bounds.y)&&this.trigger("move",this,a,this.bounds);this.bounds=a;if(b)this.xy=this.bounds.center()}};var eb=1E3/60|0,za=[],qb=0;ba("drawable","marker",function(a,b,c){c=G({fill:true,stroke:false,markerStyle:"simple",hoverStyle:"highlight",typeName:"Marker"},c);return new ta(a,b,c)});ba("drawable","poly",function(a,b,c){c=G({simplify:false,
fill:true,points:[],typeName:"Poly"},c);var i=c.points,k=c.simplify;ta.call(this,c);G(this,{getPoints:function(){return[].concat(i)},resync:function(){var j,g,d,h,e,f,p,l;for(j=i.length;j--;)i[j].sync(a.rpp);l=this.points=k?k(i):i;for(j=l.length;j--;){g=l[j].x;d=l[j].y;f=X(f,ma)||g<f?g:f;p=X(p,ma)||d<p?d:p;h=X(h,ma)||g>h?g:h;e=X(e,ma)||d>e?d:e}this.updateBounds(new la(f,p,h-f,e-p),true)}});this.haveData=i&&i.length>=2});ba("drawable","line",function(a,b,c){c.fill=false;return ra("drawable","poly",
a,b,c)});ba("drawable","image",function(a,b,c){function i(){if(h&&h.width>0){if(!this.centerOffset)this.centerOffset=new O(-h.width>>1,-h.height>>1);this.updateBounds(new la(this.xy.x+this.centerOffset.x,this.xy.y+this.centerOffset.y,h.width,h.height),false)}}function k(f){if(this.imageUrl=f){var p=this;Ha(this.imageUrl,function(l,m){h=l;if(m){var q=e.layer?e.layer.view:null;q&&q.invalidate()}i.apply(p)})}}c=G({image:null,imageUrl:null,centerOffset:null,typeName:"Image"},c);var j=ta.prototype.resync,
g=0,d=0,h=c.image,e=G(new ta(a,b,c),{changeImage:k,getProps:function(){this.bounds||i(this,h);return{image:h,x:this.xy.x+g,y:this.xy.y+d}},resync:function(f){j.call(this,f);i.call(this)}});h||k.call(this,this.imageUrl);if(this.centerOffset){g=this.centerOffset.x;d=this.centerOffset.y}});ba("drawable","arc",function(a,b,c){c=G({startAngle:0,endAngle:Math.PI*2,typeName:"Arc"},c);return new ta(a,b,c)});Ja.prototype={constructor:Ja,clip:null,cycle:function(){},draw:function(){},hitGuess:null};ba("layer",
"tile",function(a,b){b=G({generator:"osm",imageLoadArgs:{}},b);var c=ra("generator",b.generator,b).run,i=null,k=[],j=G(new Ja(a,b),{draw:function(g,d,h){g.drawTiles&&g.drawTiles(d,i.search(d.buffer(128)),h.panSpeed<2)}});j.bind("refresh",function(g,d,h){var e=(new Date).getTime();i&&c(d,h,i,function(){d.invalidate();ha("GEN COMPLETED IN "+((new Date).getTime()-e)+" ms")})});j.bind("resync",function(){var g=a&&a.zoom?a.zoom():0;k[g]||(k[g]=lb(g));i=k[g]});return j});ba("layer","draw",function(a,b){function c(e,
f,p,l){var m=this.dragOffset;if(!m)m=this.dragOffset=new O(e.startX-this.xy.x,e.startY-this.xy.y);this.xy.x=f-m.x;this.xy.y=p-m.y;if(l){delete this.dragOffset;a.invalidate();this.trigger("dragDrop")}return true}function i(e){clearTimeout(d);d=setTimeout(function(){j.sort(function(f,p){if(p.xy&&f.xy){var l=p.xy.y-f.xy.y;return l!=0?l:p.xy.x-f.xy.x}});e&&e.invalidate()},50)}function k(e,f,p,l){l&&g.remove(l,f);g.insert(p,f)}b=G({zindex:10},b);var j=[],g,d=0,h=G(new Ja(a,b),{itemCount:0,clear:function(){g=
new mb;j=[];h.itemCount=0},create:function(e,f,p){e=ra("drawable",e,a,h,f);if(p)j.unshift(e);else j[j.length]=e;e.resync();g&&e.bounds&&g.insert(e.bounds,e);i(a);e.bind("move",k);h.itemCount=j.length;return e},draw:function(e,f,p,l,m){p={};l=g&&f?g.search(f):[];for(var q=l.length;q--;){var w=l[q],x=w.style||h.style,y,E=e.applyTransform(w),J=w.getProps?w.getProps(e):p;if(J=(y=e["prep"+w.typeName])?y.call(e,w,f,m,J):null){if(m&&J.hit){m.elements.push(Hits.initHit(w.type,w,w.draggable?c:null));y=m.type+
"Style";x=w[y]||h[y]||x}x=x?e.applyStyle(x,true):null;(y=w.draw||J.draw)&&y.call(w,J);x&&e.applyStyle(x)}E&&E.undo&&E.undo()}},find:function(){return[].concat(j)},hitGuess:function(e,f){return g&&g.search({x:e-10,y:f-10,w:20,h:20}).length>0}});h.bind("resync",function(){g=lb(a.zoom(),g);for(var e=j.length;e--;)j[e].resync()});return h});ga.prototype={constructor:ga,distanceTo:function(){if(!targetPos||this.empty()||targetPos.empty())return 0;var a=(targetPos.lat-this.lat)*ia>>1,b=(targetPos.lon-this.lon)*
ia>>1;a=oa(a)*oa(a)+Va(this.lat*ia)*Va(targetPos.lat*ia)*oa(b)*oa(b);return 6371*2*Qb(xb(a),xb(1-a))},equalTo:function(a){return pos&&this.lat===a.lat&&this.lon===a.lon},empty:function(){return this.lat===0&&this.lon===0},inArray:function(a){for(var b=a.length;b--;)if(this.equal(a[b]))return true;return false},offset:function(a,b){var c=this.lat*ia,i=this.lon*ia,k=c+a/6371;c=Pb(oa(b/6371)/Va(c));i=i+c;k=(k+ya)%Math.PI-ya;i%=da;return new ga(k*Ka,i*Ka)},toPixels:function(){return new O(parseFloat(this.lon)*
ia,gb(this.lat))},toString:function(a){return this.lat+(a||" ")+this.lon}};var bc=function(){return{generalize:function(a,b,c){var i=a.length,k=[],j=null;c||(c=250);c/=1E3;ha("generalizing positions, must include "+b.length+" positions");for(var g=i;g--;)if(g===0)k.unshift(a[g]);else{var d=!j||a[g].inArray(b)?c:j.distanceTo(a[g]);if(a[g]&&d>=c){k.unshift(a[g]);j=a[g]}}ha("generalized "+i+" positions into "+k.length+" positions");return k},parseArray:function(a){var b=a.length,c=Array(b);for(b=b;b--;)c[b]=
new ga(a[b]);return c},vectorize:function(a,b){function c(){for(var g=0,d=b.chunkSize,h=i;h--;){k[h]=new O(a[h]);g+=1;if(g>d)break}i=h;if(i<=0)b.callback&&b.callback(k);else animFrame(c)}var i=a.length,k=Array(i);b=G({chunkSize:500,async:true,callback:null},b);if(!b.async){for(var j=i;j--;)k[j]=new O(a[j]);return k}animFrame(c);return null}}}();Aa.prototype={constructor:Aa,bestZoomLevel:function(a){var b=this.center();b=La(wa(na(b.lat)*0.05),Ua.length);var c=Ua[b],i=this.size();b=wb(ja(Ua[3]*a.h/
i.y)/ja(2));a=wb(ja(c*a.w/i.x)/ja(2));return La(isNaN(b)?1E3:b,isNaN(a)?1E3:a)},center:function(){var a=this.size();return new ga(this.min.lat+(a.y>>1),this.min.lon+(a.x>>1))},expand:function(a){this.min.lat-=a;this.max.lat+=a;this.min.lon-=a%360;this.max.lon+=a%360},size:function(a){var b=new O(0,this.max.lat-this.min.lat);b.x=(a||isType(a,ma))&&this.min.lon>this.max.lon?360-this.min.lon+this.max.lon:this.max.lon-this.min.lon;return b},toString:function(){return"min: "+this.min+", max: "+this.max}};
G(W,{userMessage:fb,Registry:Ta,DOM:ea,Rect:la,XY:O,Hits:Hits,tweenValue:db,easing:Qa,Tile:Ia,getImage:Ha,Pos:ga,PosFns:bc,BBox:Aa});ba("generator","osm",function(a){a=G({flipY:false,tileSize:256,tilePath:"{0}/{1}/{2}.png",osmDataAck:true},a);var b=Math.PI/180,c=180/Math.PI,i=null,k=[],j,g=Ea(a.tilePath),d={buildTileUrl:function(h,e,f,p,l){if(e>=0&&e<p){h=(h%p+p)%p;e=g(f,h,l?Math.abs(e-p+1):e);if(i)e=j(k[h%(k.length||1)])+e;return e}},run:function(h,e,f,p){if(h=h.zoom?h.zoom():0){var l=2<<h-1,m=a.tileSize,
q=Math.PI*2/(m<<h),w=(e.w/m|0)+1,x=(e.h/m|0)+1;e=(new O(e.x,e.y)).sync(q,true).pos();var y=e.lat;e=new O((e.lon+180)/360*l|0,(1-Math.log(Math.tan(y*b)+1/Math.cos(y*b))/Math.PI)/2*l%l|0);y=Math.PI-2*Math.PI*e.y/l;y=new ga(c*Math.atan(0.5*(Math.exp(y)-Math.exp(-y))),e.x/l*360-180);y=new O(y);y.sync(q);q=a.flipY;var E=f.search({x:y.x,y:y.y,w:w*m,h:x*m}),J={},v;for(v=E.length;v--;)J[E[v].id]=true;k=(i=d.getServerDetails?d.getServerDetails():null)&&i.subDomains?i.subDomains:[];j=Ea(i?i.baseUrl:"");for(E=
0;E<=w;E++)for(v=0;v<=x;v++){var n=e.x+E,A=e.y+v,C=n+"_"+A;if(!J[C]){tileUrl=d.buildTileUrl(n,A,h,l,q);n=new Ia(y.x+E*m,y.y+v*m,tileUrl,m,m,C);f.insert(n,n)}}p&&p()}}};a.osmDataAck&&fb("ack","osm",'Map data (c) <a href="http://openstreetmap.org/" target="_blank">OpenStreetMap</a> (and) contributors, CC-BY-SA');return d});cb.T5=W;cb.Tile5=function(a,b){b=G({container:a,type:"map",renderer:"canvas",starpos:null,zoom:1,fastpan:false,drawOnScale:true,zoombar:{}},b);return ra("view",b.type,b)}})(window);
