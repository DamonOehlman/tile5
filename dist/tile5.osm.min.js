(function(){function z(r,A){if(r&&r.split){var B=r.split(Pa);if(B.length>1){r=B[0];A=B[1]}}else if(r&&r.lat){A=r.lon;r=r.lat}this.lat=parseFloat(r||0);this.lon=parseFloat(A||0)}function ja(r,A){if(r&&r.splice){for(var B=A,I=new z(Ha,ta),P=new z(Ia,Ca),pa=r.length;pa--;){var fa=typeof r[pa]=="string"?new z(r[pa]):r[pa];if(fa.lat<I.lat)I.lat=fa.lat;if(fa.lat>P.lat)P.lat=fa.lat;if(fa.lon<I.lon)I.lon=fa.lon;if(fa.lon>P.lon)P.lon=fa.lon}this.min=I;this.max=P;if(typeof B=="undefined"){B=this.size();B=Math.max(B.x,
B.y)*0.3}this.min=new z(I.lat-B,(I.lon-B)%360);this.max=new z(P.lat+B,(P.lon+B)%360)}else{this.min=r;this.max=A}}function ma(r){if(typeof r=="string"){var A=(r.replace(/\d|\.|\s/g,"")||"m").toLowerCase();r=parseFloat(r)*({km:1E3}[A]||1)}this.meters=r||0}var Ja=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],Qa=typeof module!="undefined"&&module.exports,aa=Math.PI*2,za=Math.PI/2,ba=Math.PI/180,ga=180/Math.PI,Ha=90,Ia=-Ha,ta=180,Ca=-ta,Ra=Ha*ba,Ya=-Ra,qa=
ta*ba,Za=-qa,Pa=/[\,\s]+/;z.prototype={constructor:z,copy:function(){return new z(this.lat,this.lon)},distanceTo:function(r){if(!r||this.empty()||r.empty())return 0;var A=(r.lat-this.lat)*ba/2,B=(r.lon-this.lon)*ba/2;r=Math.sin(A)*Math.sin(A)+Math.cos(this.lat*ba)*Math.cos(r.lat*ba)*Math.sin(B)*Math.sin(B);return 6371*2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))},equalTo:function(r){return pos&&this.lat===r.lat&&this.lon===r.lon},empty:function(){return this.lat===0&&this.lon===0},inArray:function(r){if(r)for(var A=
r.length;A--;)if(this.equal(r[A]))return true;return false},offset:function(r,A){var B=this.lat*ba,I=B+r/6371;B=this.lon*ba+Math.asin(Math.sin(A/6371)/Math.cos(B));I=(I+za)%Math.PI-za;B%=aa;return new z(I*ga,B*ga)},toBounds:function(r){var A=r.radians(),B=this.lat*ba,I=this.lon*ba;r=B-A;var P=B+A;if(r>Ya&&P<Ra){B=Math.asin(Math.sin(A)/Math.cos(B));A=I-B;if(A<Za)A+=aa;I=I+B;if(I>qa)I-=aa}else{r=Math.max(r,Ya);P=Math.min(P,Ra);A=Ca;I=ta}return new ja(new z(r*ga,A*ga),new z(P*ga,I*ga))},toString:function(r){return this.lat+
(r||" ")+this.lon},valid:function(){return!(isNaN(this.lat)||isNaN(this.lon))}};ja.prototype={constructor:ja,bestZoomLevel:function(r,A){var B=this.center(),I=Ja[Math.min(Math.round(Math.abs(B.lat)*0.05),Ja.length)],P=this.size();B=Math.ceil(Math.log(Ja[3]*A/P.y)/Math.LN2);I=Math.ceil(Math.log(I*r/P.x)/Math.LN2);return Math.min(isNaN(B)?1E3:B,isNaN(I)?1E3:I)},center:function(){var r=this.size();return new z(this.min.lat+r.y/2,this.min.lon+r.x/2)},expand:function(r){return new ja(new z(this.min.lat-
r,(this.min.lon-r)%360),new z(this.max.lat+r,(this.max.lon+r)%360))},size:function(r){var A={x:0,y:this.max.lat-this.min.lat};A.x=typeof r!="undefined"&&r&&this.min.lon>this.max.lon?360-this.min.lon+this.max.lon:this.max.lon-this.min.lon;return A},toString:function(){return"min: "+this.min+", max: "+this.max},union:function(){for(var r=this.min.copy(),A=this.max.copy(),B=arguments.length;B--;)if(arguments[B]){var I=arguments[B].min,P=arguments[B].max;r.lat=Math.min(r.lat,I.lat);r.lon=Math.min(r.lon,
I.lon);A.lat=Math.max(A.lat,P.lat);A.lon=Math.max(A.lon,P.lon)}return new ja(r,A)}};ma.prototype={add:function(){for(var r=this.meters,A=arguments.length;A--;){var B=typeof arguments[A]=="string"?new ma(arguments[A]):arguments[A];r+=B.meters}return new ma(r)},radians:function(r){if(typeof r!="undefined"){this.meters=r*6371E3;return this}else return this.meters/6371E3},toString:function(){if(this.meters>1E3)return(this.meters/10|0)/100+"km";return this.meters+"m"}};var S=this.GeoJS={Pos:z,BBox:ja,
Distance:ma,generalize:function(r,A,B){var I=r.length,P=[],pa=null;B=(B||250)/1E3;for(I=I;I--;)if(I===0)P.unshift(r[I]);else{var fa=!pa||r[I].inArray(A)?B:pa.distanceTo(r[I]);if(r[I]&&fa>=B){P.unshift(r[I]);pa=r[I]}}return P},include:function(r){if(Qa){r=r.split(",");for(var A=0;A<r.length;A++){var B=require("./plugins/"+r[A].trim()),I;for(I in B)S[I]=B[I]}}return S}};if(Qa)module.exports=S})();
(function(){function z(){var a=arguments[0]||{},d=Array.prototype.slice.call(arguments,1),b=d.length,e,h;for(h=0;h<b;h++)if((e=d[h])!==null)for(var k in e){var g=e[k];if(a!==g)if(g!==undefined)a[k]=g}return a}function ja(a,d){if(typeof console!=="undefined")console[d||"log"](a)}function ma(a){var d=a.match(Ra),b=[],e=0,h;for(h=d?d.length:0;h--;){var k=d[h].slice(1);b[k]||(b[k]=RegExp("\\{"+k+"\\}","g"))}e=b.length;return function(){var g=a;for(h=0;h<e;h++){var i=arguments[h];if(typeof i=="undefined")i=
"";g=g.replace(b[h],i)}return g}}function Ja(a,d,b){r.trigger("userMessage",a,d,b)}function Qa(a,d){var b=$a*Ka(a);return pa-2*qb(d*Da((1-b)/(1+b),$a/2))}function aa(a,d){if(S(a,Aa)){var b=a.split(rb);this.x=parseFloat(b[0]);this.y=parseFloat(b[1])}else if(a&&a.x){this.x=a.x;this.y=a.y}else{this.x=a||0;this.y=d||0}}function za(a){this.allowCull=a}function ba(a,d,b,e){this.mercX=b;this.mercY=e;if(S(a,Aa))z(this,Cb.parseXY(a));else a&&a.toBounds?z(this,ab(a.lon,a.lat)):aa.call(this,a,d)}function ga(a,
d,b,e){this.x=a||0;this.y=d||0;this.w=b||0;this.h=e||0;this.x2=this.x+this.w;this.y2=this.y+this.h}function Ha(a,d){var b=new sb(Math.sqrt(256<<a)|0);d&&d.zoomLevel===a&&d.copyInto(b);b.zoomLevel=a;return b}function Ia(a,d,b,e,h,k){this.x=a;this.y=d;this.w=e||256;this.h=e||256;this.x2=this.x+this.w;this.y2=this.y+this.h;this.url=b;this.id=k||a+"_"+d;this.loaded=false;this.image=null}function ta(a,d){d=z({id:"layer_"+Db++,zindex:0,animated:false,style:null,minXY:null,maxXY:null,visible:true},d);this.visible=
d.visible;this.view=a;qa(z(this,d))}function Ca(){qa(this)}var Ra=/\{(\d+)(?=\})/g,Ya=function(){var a=1.70158,d=Math.PI/2,b=Math.abs,e=Math.pow,h=Math.sin,k=Math.asin,g=Math.cos,i={linear:function(c,l,j,f){return j*c/f+l},backin:function(c,l,j,f){return j*(c/=f)*c*((a+1)*c-a)+l},backout:function(c,l,j,f){return j*((c=c/f-1)*c*((a+1)*c+a)+1)+l},backinout:function(c,l,j,f){return(c/=f/2)<1?j/2*c*c*(((a*=1.525)+1)*c-a)+l:j/2*((c-=2)*c*(((a*=1.525)+1)*c+a)+2)+l},bouncein:function(c,l,j,f){return j-i.bounceout(f-
c,0,j,f)+l},bounceout:function(c,l,j,f){return(c/=f)<1/2.75?j*7.5625*c*c+l:c<2/2.75?j*(7.5625*(c-=1.5/2.75)*c+0.75)+l:c<2.5/2.75?j*(7.5625*(c-=2.25/2.75)*c+0.9375)+l:j*(7.5625*(c-=2.625/2.75)*c+0.984375)+l},bounceinout:function(c,l,j,f){return c<f/2?i.bouncein(c*2,0,j,f)/2+l:i.bounceout(c*2-f,0,j,f)/2+j/2+l},cubicin:function(c,l,j,f){return j*(c/=f)*c*c+l},cubicout:function(c,l,j,f){return j*((c=c/f-1)*c*c+1)+l},cubicinout:function(c,l,j,f){if((c/=f/2)<1)return j/2*c*c*c+l;return j/2*((c-=2)*c*c+
2)+l},elasticin:function(c,l,j,f,n,m){if(c==0)return l;if((c/=f)==1)return l+j;m||(m=f*0.3);if(!n||n<b(j)){n=j;j=m/4}else j=m/P*k(j/n);return-(n*e(2,10*(c-=1))*h((c*f-j)*P/m))+l},elasticout:function(c,l,j,f,n,m){var o;if(c==0)return l;if((c/=f)==1)return l+j;m||(m=f*0.3);if(!n||n<b(j)){n=j;o=m/4}else o=m/P*k(j/n);return n*e(2,-10*c)*h((c*f-o)*P/m)+j+l},elasticinout:function(c,l,j,f,n,m){var o;if(c==0)return l;if((c/=f/2)==2)return l+j;m||(m=f*0.3*1.5);if(!n||n<b(j)){n=j;o=m/4}else o=m/P*k(j/n);if(c<
1)return-0.5*n*e(2,10*(c-=1))*h((c*f-o)*P/m)+l;return n*e(2,-10*(c-=1))*h((c*f-o)*P/m)*0.5+j+l},quadin:function(c,l,j,f){return j*(c/=f)*c+l},quadout:function(c,l,j,f){return-j*(c/=f)*(c-2)+l},quadinout:function(c,l,j,f){if((c/=f/2)<1)return j/2*c*c+l;return-j/2*(--c*(c-2)-1)+l},sinein:function(c,l,j,f){return-j*g(c/f*d)+j+l},sineout:function(c,l,j,f){return j*h(c/f*d)+l},sineinout:function(c,l,j,f){return-j/2*(g(Math.PI*c/f)-1)+l}};return function(c){c=c.replace(/[\-\_\s\.]/g,"").toLowerCase();return i[c]||
i.linear}}(),qa=function(){function a(b,e){var h=b.hasOwnProperty("obsHandlers")?b.obsHandlers:null;h[e]||(h[e]=[]);return h[e]}var d=0;return function(b){if(!b)return null;if(!(b.hasOwnProperty("obsHandlers")?b.obsHandlers:null))b.obsHandlers={};if(!b.hasOwnProperty("bind")){b.bind=function(e,h){var k="callback"+d++;a(b,e).unshift({fn:h,id:k});return k};b.triggerCustom=function(e,h){var k=a(b,e),g={cancel:false,name:e,source:this},i;for(i in h)g[i]=h[i];if(!k)return null;i=Array.prototype.slice.call(arguments,
2);b.eventInterceptor&&b.eventInterceptor(e,g,i);i.unshift(g);for(var c=k.length;c--&&!g.cancel;)k[c].fn.apply(this,i);return g};b.trigger=function(e){var h=Array.prototype.slice.call(arguments,1);h.splice(0,0,e,null);return b.triggerCustom.apply(this,h)};b.unbind=function(e,h){if(typeof e==="undefined")b.obsHandlers={};else for(var k=a(b,e),g=0;k&&g<k.length;g++)if(k[g].id===h){k.splice(g,1);break}return b}}return b}}(),Za=function(){function a(d,b,e,h){if(typeof d[h]=="undefined")d[h]=function(k){if(typeof k!=
"undefined"){b[h]=k;e[h]&&e[h](k);return d}else return b[h]}}return function(d,b,e){b=b||d;for(var h in b)typeof b[h]!="function"&&a(d,b,e,h);return d}}(),Pa=Array.prototype.indexOf||function(a){for(var d=0;d<this.length;d++)if(this[d]===a)return d;return-1},S=function(){var a={NaN:1,Infinity:1,"-Infinity":1},d=String.prototype.toLowerCase,b=Object.prototype.toString;return function(e,h){h=d.call(h);if(h=="finite")return!a.hasOwnProperty(+e);return h=="null"&&e===null||h==typeof e||h=="object"&&e===
Object(e)||h=="array"&&Array.isArray&&Array.isArray(e)||b.call(e).slice(8,-1).toLowerCase()==h}}();(function(){function a(k){var g=document.createElement("script"),i=false;g.src=k;g.async=true;g.onload=g.onreadystatechange=function(){if(!i&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){i=true;g.onload=g.onreadystatechange=null;g&&g.parentNode&&g.parentNode.removeChild(g)}};h||(h=document.getElementsByTagName("head")[0]);h.appendChild(g)}function d(k,g,i){k+=k.indexOf("?")>=
0?"&":"?";var c="json"+ ++e;window[c]=function(l){g(l);window[c]=null;try{delete window[c]}catch(j){}};a(k+(i?i:"callback")+"="+c);return c}function b(k,g,i){var c=require("request");k=k+(k.indexOf("?")>=0?"&":"?")+(i?i:"callback")+"=cb";c({uri:k},function(l,j,f){if(l)g({error:l});else{l=f.replace(/^.*\(/,"").replace(/\).*$/,"");g(JSON.parse(l))}})}var e=0,h;return typeof window!="undefined"?d:b})();INTERACT=function(){function a(n){return function(m,o){n.addEventListener(m,o,false)}}function d(n){return function(m,
o){n.removeEventListener(m,o,false)}}function b(n){return function(m,o){n.attachEvent("on"+m,o)}}function e(n,m){return{x:n?n:0,y:m?m:0,count:1}}function h(n,m){j.push(z({handler:null,checks:{},type:n},m))}function k(n){var m=0,o=0;if(n.offsetParent){do{m+=n.offsetLeft;o+=n.offsetTop;n=n.offsetParent}while(n)}return{left:m,top:o}}function g(n,m){return{source:n,target:m.target?m.target:m.srcElement}}function i(n,m){for(var o=n.target?n.target:n.srcElement;o&&o!==m;)o=o.parentNode;return o&&o===m}
function c(n,m){return{x:n.x-(m?m.left:0),y:n.y-(m?m.top:0)}}function l(n,m){if(n.preventDefault){n.preventDefault();n.stopPropagation()}else if(typeof n.cancelBubble!="undefined")n.cancelBubble=true;m&&n.stopImmediatePropagation&&n.stopImmediatePropagation()}var j=[],f=function(n,m,o){o=z({binder:null,unbinder:null,observable:null},o);for(var t=o.observable,x=[],E,Q,Y={bind:function(){return t.bind.apply(null,arguments)},unbind:function(){t.unbind();for(J=0;J<x.length;J++)x[J].unbind();return Y}},
J=0;J<m.length;J++)x.push(m[J](n,t,o));t.bind("pointerDown",function(){Q=E=0});t.bind("pointerMove",function(s,C,v,y){E+=y.x||0;Q+=y.y||0});t.bind("pointerUp",function(s,C,v){Math.abs(E)>20||Math.abs(Q)>20||t.triggerCustom("tap",s,C,v)});return Y};h("pointer",{handler:function(n,m,o){function t(w){if(w.pageX&&w.pageY)return e(w.pageX,w.pageY);else{var K=document.documentElement,T=document.body;return e(w.clientX+(K&&K.scrollLeft||T&&T.scrollLeft||0)-(K&&K.clientLeft||T&&T.clientLeft||0),w.clientY+
(K&&K.scrollTop||T&&T.scrollTop||0)-(K&&K.clientTop||T&&T.clientTop||0))}}function x(w){if(i(w,n))if(N=J(w)){var K=t(w);n.style.cursor="move";l(w,true);Z=K.x;R=K.y;F=e(Z,R);m.triggerCustom("pointerDown",g("mouse",w),F,c(F,k(n)))}}function E(w){var K=t(w);G=K.x;W=K.y;if(i(w,n))C(w,N?"pointerMove":"pointerHover")}function Q(w){if(N&&J(w)){N=false;if(i(w,n)){n.style.cursor="default";C(w,"pointerUp")}}}function Y(w){if(i(w,n)){var K;w=w||window.event;if(w.detail){if(typeof w.axis=="undefined"||w.axis===
2)K=-w.detail*v}else{K=w.wheelDeltaY?w.wheelDeltaY:w.wheelDelta;if(window.opera)K=-K}if(K){var T=e(G,W);m.triggerCustom("zoom",g("mouse",w),T,c(T,k(n)),K/y,"wheel");l(w);w.returnValue=false}}}function J(w){w=w||window.event;return(w.which||w.button)==1}function s(){return false}function C(w,K,T,ka,D){T=typeof T!="undefined"?T:G;ka=typeof ka!="undefined"?ka:W;var O=T-Z,L=ka-R,ea=e(T,ka);m.triggerCustom(K,g("mouse",w),ea,c(ea,k(n)),e(O,L));if(typeof D=="undefined"||D){Z=T;R=ka}}o=z({},o);var v=120,
y=v*8,N=false,F,G,W,Z,R;o.binder("mousedown",x);o.binder("mousemove",E);o.binder("mouseup",Q);o.binder("dblclick",function(w){if(i(w,n)){var K=t(w);m.triggerCustom("doubleTap",g("mouse",w),K,c(K,k(n)))}});o.binder("selectstart",s);o.binder("dragstart",s);o.binder("mousewheel",Y);o.binder("DOMMouseScroll",Y);return{unbind:function(){o.unbinder("mousedown",x);o.unbinder("mousemove",E);o.unbinder("mouseup",Q);o.unbinder("mousewheel",Y);o.unbinder("DOMMouseScroll",Y)}}},checks:{touch:false}});h("pointer",
{handler:function(n,m,o){function t(D){if(D.count<2)return 0;var O=D.x-D.next.x;D=D.y-D.next.y;return~~Math.sqrt(O*O+D*D)}function x(D,O,L){O=O?O:0;L=L?L:0;for(var ea={x:D.x-O,y:D.y-L,id:D.id,count:D.count},U=ea;D.next;){D=D.next;U=U.next={x:D.x-O,y:D.y-L,id:D.id}}return ea}function E(D,O){var L=D[O?O:"touches"],ea,U;if(L.length===0)return null;U=ea={x:L[0].pageX,y:L[0].pageY,id:L[0].identifier,count:L.length};for(var X=1,ua=L.length;X<ua;X++)U=U.next={x:L[X].pageX,y:L[X].pageY,id:L[X].identifier};
return ea}function Q(D){if(i(D,n)){G=k(n);var O=E(D,"changedTouches"),L=x(O,G.left,G.top);if(!Z){W=y;m.triggerCustom("pointerDown",g("touch",D),O,L)}T&&m.triggerCustom("pointerDownMulti",g("touch",D),O,L);Z=E(D);if(Z.count>1)w=t(Z);ka=1;K=x(Z)}}function Y(D){if(i(D,n)){l(D);R=E(D);if(W==y)W=Math.abs(Z.x-R.x)>C||Math.abs(Z.y-R.y)>C?v:y;if(W!=y){W=R.count>1?F:N;if(W==F)if(Z.count===1){Z=x(R);w=t(Z)}else{var O=t(R);if(Math.abs(w-O)<s)W=N;else{var L;L=R.x;var ea=R.next.x,U=R.y,X=R.next.y;L={x:(L<ea?L:
ea)+(Math.abs(L-ea)>>1),y:(U<X?U:X)+(Math.abs(U-X)>>1)};O=O/w;ea=O-ka;m.triggerCustom("zoom",g("touch",D),L,c(L,G),ea,"pinch");ka=O}}W==N&&m.triggerCustom("pointerMove",g("touch",D),R,x(R,G.left,G.top),e(R.x-K.x,R.y-K.y));T&&m.triggerCustom("pointerMoveMulti",g("touch",D),R,x(R,G.left,G.top))}K=x(R)}}function J(D){if(i(D,n)){var O=E(D,"changedTouches"),L=x(O,G.left,G.top);R=E(D);if(!R){m.triggerCustom("pointerUp",g("touch",D),O,L);Z=null}T&&m.triggerCustom("pointerUpMulti",g("touch",D),O,L)}}o=z({detailed:false,
inertia:false},o);var s=20,C=7,v=0,y=1,N=2,F=3,G,W,Z,R,w,K,T=o.detailed,ka=1;o.binder("touchstart",Q);o.binder("touchmove",Y);o.binder("touchend",J);ja("initialized touch handler");return{unbind:function(){o.unbinder("touchstart",Q);o.unbinder("touchmove",Y);o.unbinder("touchend",J)}}},checks:{touch:true}});return{register:h,watch:function(n,m,o){m=z({bindTarget:null,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},m);capabilities=z({touch:"ontouchstart"in window},o);if(!m.observable){ja("creating observable");
m.observable=qa({});globalOpts=m}m.binder=(m.isIE?b:a)(m.bindTarget||document);m.unbinder=(m.isIE?b:d)(m.bindTarget||document);o=m.types;for(var t=capabilities,x=[],E=j.length;E--;){var Q=j[E],Y=!o||o.indexOf(Q.type)>=0,J=true,s;for(s in Q.checks){var C=Q.checks[s];ja("checking "+s+" capability. require: "+C+", capability = "+t[s]);J=J&&C===t[s]}if(Y&&J)x[x.length]=Q.handler}return new f(n,x,m)}}}();var r=this.T5=qa({}),A=function(){var a={};return{create:function(d,b){if(a[d][b])return a[d][b].apply(null,
Array.prototype.slice.call(arguments,2));throw I(d,b);},get:function(d,b){return a[d]?a[d][b]:null},register:function(d,b,e){a[d]||(a[d]={});a[d][b]&&ja(B(d,b),"warn");a[d][b]=e}}}(),B=ma("Registration of {0}: {1} will override existing definition"),I=ma("Could not create {0} of type: {1}");ma("Could not create drawable of type: {0}");var P=Math.PI*2,pa=Math.PI/2,fa=Math.PI/180,bb=180/Math.PI,$a=0.08181919084262157,va=Math.abs,cb=Math.round,tb=Math.min,db=Math.max,Da=Math.pow,Eb=Math.sqrt,kb=Math.log,
Ka=Math.sin,eb=Math.cos,qb=Math.atan,Ea="undefined",Aa="string",Ba="number",ra=A.register,La=A.create,Fb=A.get,Gb=0,Db=0,rb=/[\,\s]+/,Ma=function(){function a(g){h++;g=V?window.mozAnimationStartTime||g||(new Date).getTime():(new Date).getTime();for(var i=e.length;i--;){var c=e[i];h%c.every===0&&c.cb(g)}k&&animFrame(a)}var d=1E3/60,b=["r","webkitR","mozR","oR","msR"],e=[],h=0,k=V&&function(){for(var g=0;g<b.length;g++)window.animFrame=window.animFrame||window[b[g]+"equestAnimationFrame"];return animFrame}();
k?animFrame(a):setInterval(a,1E3/60);return{attach:function(g,i){e[e.length]={cb:g,every:i?cb(i/d):1}},detach:function(g){for(var i=e.length;i--;)if(e[i].cb===g){e.splice(i,1);break}}}}(),Cb=function(){var a=/^xy\((.*)\).*$/i;return{parseXY:function(d){if(!a.test(d)){d=d.split(rb);return ab(d[1],d[0])}}}}(),V=typeof window!="undefined"?function(){function a(h){for(var k=0;k<h.length;k++){var g=h[k];if(typeof document.body.style[g]!="undefined")return g}}var d={"-webkit-user-select":"none",position:"absolute"},
b,e;b=a(["-webkit-transform","MozTransform"]);css3DTransformProp=a(["WebkitPerspective","MozPerspective"]);e=a(["-webkit-transform-origin","MozTransformOrigin"]);return{transforms:S(b,Aa),create:function(h,k,g){h=document.createElement(h);var i=[];g=g||{};h.className=k||"";for(var c in g)i[i.length]=c+": "+g[c];h.style.cssText=i.join(";");return h},move:function(h,k,g,i,c){if(b){h.style[b]="translate("+k+"px, "+g+"px) "+(i||[]).join(" ");if(c&&e)h.style[e]=c.x+"px "+c.y+"px"}else{h.style.left=k+"px";
h.style.top=g+"px"}},styles:function(h){return z({},d,h)}}}():null,ub=function(){function a(){for(var h=e.length,k=h;k--;)try{e[k](h)}catch(g){ja(g.toString(),"error")}}var d=20,b=50,e=[];return{process:function(h,k,g,i){function c(f){f=(l||b)/f;if(j<h.length){var n=h.slice(j,j+f);f=n.length;var m=l?0:(new Date).getTime();k(n,f);if(!l)l=(n=((new Date).getTime()-m)/f)?d/n|0:h.length;j+=f}else{for(f=e.length;f--;)if(e[f]===c){e.splice(f,1);break}e.length===0&&Ma.detach(a);g&&g()}}var l,j=0;if(V&&h.length>
(i||0))e.push(c)===1&&Ma.attach(a);else{k(h,h.length);g&&g()}}}}(),ab=ab||function(a,d){var b=parseFloat(d)*fa;b=Ka(b);var e=$a*b;b=kb((1+b)/(1-b)*Da((1-e)/(1+e),$a))/2;return new ba(0,0,parseFloat(a)*fa,b)},lb=lb||function(a,d){for(var b=Da(Math.E,-d),e=pa-2*qb(b),h=Qa(e,b),k=0;k<12&&va(e-h)>1.0E-7;){e=h;h=Qa(e,b);k++}return new GeoJS.Pos(h*bb,a%360*bb)};aa.prototype={constructor:aa,add:function(){for(var a=this.x,d=this.y,b=arguments.length;b--;){a+=arguments[b].x;d+=arguments[b].y}return this.copy(a,
d)},copy:function(a,d){var b=z({},this);b.x=a||b.x;b.y=d||b.y;return b},equals:function(a){return this.x===a.x&&this.y===a.y},offset:function(a,d){return this.copy(this.x+a,this.y+d)},relative:function(a){a=a.viewport();return this.copy(this.x-a.x-a.padding.x,this.y-a.y-a.padding.y)},rotate:function(a,d){d=d||new aa(0,0);var b=this.x-d.x,e=this.y-d.y;return new aa(d.x+eb(a)*b+-Ka(a)*e,d.y+Ka(a)*b+eb(a)*e)},scale:function(a,d){d=d||new aa(0,0);return new aa(d.x+(this.x-d.x)*a,d.y+(this.y-d.y)*a)},
sync:function(){return this},toString:function(){return this.x+", "+this.y}};za.prototype=z([],{cull:function(a){if(this.allowCull){var d=a.x,b=a.y,e=a.x+a.w;a=a.y+a.h;for(var h=Infinity,k=0,g,i=this.length;i--;)if(g=this[i].x>=d&&this[i].x<=e&&this[i].y>=b&&this[i].y<=a){h=i<h?i:h;k=i>k?i:k}return this.slice(db(h-1,0),tb(k+1,this.length))}return this},simplify:function(a){a=a||3;for(var d=new za(this.allowCull),b=null,e=this.length;e--;){var h=this[e];if(include=!b||e===0||va(h.x-b.x)+va(h.y-b.y)>
a){d.unshift(h);b=h}}return d}});ba.prototype=z(new aa,{constructor:ba,pos:function(){return lb(this.mercX,this.mercY)},sync:function(a,d){var b;if(!(b=a.rpp)){b=a.zoom();b=P/(256<<b)}b=b;if(d){this.mercX=this.x*b-Math.PI;this.mercY=Math.PI-this.y*b}else{this.x=cb(((this.mercX||0)+Math.PI)/b);this.y=cb((Math.PI-(this.mercY||0))/b)}return this}});ga.prototype={constructor:ga,buffer:function(a,d){return new ga(this.x-a,this.y-(d||a),this.w+a*2,this.h+(d||a)*2)},center:function(){return new aa(this.x+
(this.w>>1),this.y+(this.h>>1))}};Hits=function(){return{diffHits:function(a,d){var b=[],e={},h;for(h=d.length;h--;)e[d[h].target.id]=true;for(h=a.length;h--;)e[a[h].target.id]||(b[b.length]=a[h]);return b},init:function(a,d,b,e,h){return{type:a,x:h.x,y:h.y,gridX:e.x|0,gridY:e.y|0,elements:[],absXY:d,relXY:b}},initHit:function(a,d,b){return{type:a,target:d,drag:b}},triggerEvent:function(a,d,b,e){d.triggerCustom(a.type+(b?b:"Hit"),{hitType:a.type},e?e:a.elements,a.absXY,a.relXY,new ba(a.gridX,a.gridY))}}}();
var sb=function(a){function d(k,g){var i=b[k],c;i||(i=b[k]=[]);(c=i[g])||(c=i[g]=[]);return c}a=a||128;var b=[],e={},h=0;return{copyInto:function(k){for(var g in e){var i=e[g];k.insert(i.bounds||i,i,g)}},insert:function(k,g,i){var c=k.x/a|0,l=k.y/a|0,j=(k.x+k.w)/a|0;k=(k.y+k.h)/a|0;i=i||g.id||"obj_"+h++;e[i]=g;for(g=c;g<=j;g++)for(c=l;c<=k;c++)d(g,c).push(i)},remove:function(k,g,i){i=i||g.id;if(e[i]){var c=k.x/a|0;g=k.y/a|0;var l=(k.x+k.w)/a|0;k=(k.y+k.h)/a|0;delete e[i];for(c=c;c<=l;c++)for(var j=
g;j<=k;j++){var f=d(c,j),n=Pa.call(f,i);n>=0&&f.splice(n,1)}}},search:function(k){var g=k.y/a|0,i=(k.x+k.w)/a|0,c=(k.y+k.h)/a|0,l=[],j=[];for(k=k.x/a|0;k<=i;k++)for(var f=g;f<=c;f++)l=l.concat(d(k,f));l.sort();for(g=l.length;g--;){i=l[g];if(c=e[i])j[j.length]=c;for(;g>0&&l[g-1]==i;)g--}return j}}},fb=function(){var a={},d=0;(new Date).getTime();var b={},e=[];Ma.attach(function(h){h=h||(new Date).getTime();for(var k=0;k<e.length;){var g=e[k],i=b[g],c=b[g].image&&b[g].image.complete&&b[g].image.width>
0,l=h-i.start;l=c||l>=3E4;if(c){c=i.callbacks;a[g]=i.image;for(var j=0;j<c.length;j++)c[j](i.image,true)}if(l){e.splice(k,1);delete b[g]}else k++}},250);return function(h,k){var g=h&&k?a[h]:null;if(g&&g&&g.complete&&g.width>0)k(g);else if(g=b[h])g.callbacks.push(k);else{g=new Image;g.id="_ldimg"+ ++d;b[h]={start:(new Date).getTime(),image:g,callbacks:[k]};g.src=h;e[e.length]=h}}}();Ia.prototype={constructor:Ia,load:function(a){var d=this;fb(this.url,function(b){d.loaded=true;d.image=b;a&&a()})}};
var Hb=function(){return qa({fastpan:true,applyStyle:function(){},applyTransform:function(a,d,b){return{restore:null,x:d,y:b}},getDimensions:function(){return{width:0,height:0}},getViewport:function(){},hitTest:function(){return false},prepare:function(){},projectXY:null,reset:function(){}})};ra("renderer","canvas",function(a,d,b,e,h){function k(){function s(y,N){this.save();this.setTransform(1,0,0,1,0,0);var F=this.isPointInPath_old(y,N);this.restore();return F}var C=CanvasRenderingContext2D.prototype,
v=document.createElement("canvas").getContext("2d");v.translate(50,0);v.moveTo(125,50);v.arc(100,50,25,0,360,false);if(!v.isPointInPath(150,50)){C.isPointInPath_old=C.isPointInPath;C.isPointInPath=s}}function g(s,C,v){var y,N;o[C]=function(F){for(y=Y.length;y--;)if(N=v[Y[y]])F[J[y]]=N}}function i(s,C,v){return{draw:v||Q,viewport:s,hit:C&&f.isPointInPath(C.x,C.y),vpX:n,vpY:m,context:f}}e=z({},e);var c,l,j,f,n=0,m=0,o={},t=null,x={},E=function(){},Q=function(){this.fill&&f.fill();this.stroke&&f.stroke()},
Y=["fill","stroke","lineWidth","opacity"],J=["fillStyle","strokeStyle","lineWidth","globalAlpha"];V&&k();if(d){c=d.offsetWidth;l=d.offsetHeight;j=V?V.create("canvas",null,{position:"absolute","z-index":1}):new Canvas;j.width=c;j.height=l;a.attachFrame(j,true);f=null}b=z(h,{applyStyle:function(s){var C=o[s],v=f&&f.canvas?f.canvas.id:"default",y;x[v]||(x[v]=[]);y=x[v].pop()||"reset";if(C){x[v].push(s);C(f);return y}},applyTransform:function(s){if(s.translateX!==0||s.translateY!==0||s.scaling!==1||s.rotation!==
0){f.save();t={undo:function(){f.restore();t=null},x:s.xy.x,y:s.xy.y};f.translate(s.xy.x-n+s.translateX,s.xy.y-m+s.translateY);s.rotation!==0&&f.rotate(s.rotation);s.scaling!==1&&f.scale(s.scaling,s.scaling)}return t},drawTiles:function(s,C,v){for(var y=C.length;y--;){s=C[y];if(!s.loaded&&v)s.load(a.invalidate);else s.image&&f.drawImage(s.image,s.x-n,s.y-m)}},prepare:function(s,C){var v,y=false;if(f)f.restore();else if(j)f=j.getContext("2d");for(v=s.length;v--;)y=y||s[v].clip;n=C.x;m=C.y;if(f){y||
f.clearRect(0,0,c,l);f.save();f.globalCompositeOperation="source-over"}return f},prepArc:function(s,C,v){f.beginPath();f.arc(s.xy.x-(t?t.x:n),s.xy.y-(t?t.y:m),s.size>>1,s.startAngle,s.endAngle,false);return i(C,v)},prepImage:function(s,C,v,y){var N=(y.x||s.xy.x)-(t?t.x:n),F=(y.y||s.xy.y)-(t?t.y:m),G=y.image||s.image;if(G){f.beginPath();f.rect(N,F,y.width||G.width,y.height||G.height);return i(C,v,function(){f.drawImage(G,N,F,y.width||G.width,y.height||G.height)})}},prepMarker:function(s,C,v){var y=
s.xy.x-(t?t.x:n),N=s.xy.y-(t?t.y:m),F=s.size,G=undefined;f.beginPath();switch(s.markerType.toLowerCase()){case "image":G=E;f.rect(y-(F>>1),N-(F>>1),F,F);if(s.reset&&s.image){s.image=null;s.reset=false}s.image?f.drawImage(s.image,y-(F>>1),N-(F>>1),F,F):fb(s.imageUrl,function(W){s.image=W;f.drawImage(s.image,y-(F>>1),N-(F>>1),F,F)});break;default:f.moveTo(y,N);f.lineTo(y-(F>>1),N-F);f.lineTo(y+(F>>1),N-F);f.lineTo(y,N)}return i(C,v,G)},prepPoly:function(s,C,v,y){var N=true;s=y.points||s.points().cull(C);
y=t?t.x:n;var F=t?t.y:m;f.beginPath();for(var G=s.length;G--;){var W=s[G].x-y,Z=s[G].y-F;if(N){f.moveTo(W,Z);N=false}else f.lineTo(W,Z)}return i(C,v)},getContext:function(){return f}});(function(){vb.each(function(s,C){g(null,s,C)});r.bind("styleDefined",g)})();b.bind("detach",function(){d.removeChild(j)});b.bind("resize",function(){});return b});ra("renderer","dom",function(a,d,b,e,h){function k(j){var f=j.image=new Image;c[j.id]=j;f.src=j.url;f.onload=function(){if(l[j.id])i.appendChild(this);else j.image=
null};f.style.cssText="-webkit-user-select: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute;";return f}function g(j,f,n){var m=[],o;for(o in j){var t=j[o];if(n?t[n]:
!f[o]){if(t.image&&t.image.parentNode){i.removeChild(t.image);t.image=null}m[m.length]=o}}for(f=m.length;f--;)delete j[m[f]]}var i=null,c={},l={};i=V.create("div","",V.styles({width:d.offsetWidth+"px",height:d.offsetHeight+"px"}));d.childNodes.length>0?d.insertBefore(i,d.childNodes[0]):d.appendChild(i);a.attachFrame(i);b=z(h,{drawTiles:function(j,f,n){for(var m,o=j.x,t=j.y,x=f.length;x--;){j=f[x];if(j.url){(m=j.image||(n?k(j):null))&&V.move(m,j.x-o,j.y-t);l[j.id]=j}}}});b.bind("predraw",function(){g(c,
l);l={}});b.bind("detach",function(){d.removeChild(i)});a.bind("reset",function(){for(g(c,l={});i.childNodes.length>0;)i.removeChild(i.childNodes[0])});return b});var vb=function(){function a(b,e){if(S(b,Aa)){r.trigger("styleDefined",b,d[b]=e);return b}else{var h=[],k;for(k in b)h[h.length]=a(k,b[k]);return h}}var d={};a({reset:{fill:"#ffffff",opacity:1},highlight:{fill:"#ff0000"},waypoints:{lineWidth:4,stroke:"#003377",fill:"#ffffff"},waypointsHover:{lineWidth:4,stroke:"#ff0000",fill:"#ffffff"}});
return{resetStyle:"reset",each:function(b){for(var e in d)b(e,d[e])},get:function(b){return d[b]},define:a}}(),Bb=function(a,d){function b(p,q,u,H){p=y?db(ca+Da(2,H)-1,0.125):H>0?2:0.5;s(p,false,true)}function e(p,q){var u=da&&da.projectXY?da.projectXY(p,q):null;if(!u){u=Q();var H=1/ca;u=new M.XY(u?u.x+(p+u.padding.x)*H:p,u?u.y+(q+u.padding.y)*H:q)}return u.sync(M,true)}function h(p,q,u){p=e(u.x,u.y);M.trigger("doubleTap",q,u,p);d.scalable&&s(2,{easing:"sine.inout",duration:700},true,p)}function k(p,
q,u){K=null;D=true;x("down",q,u)}function g(p,q,u){x("hover",q,u)}function i(p,q,u,H){m(q,u,false);if(!K){O+=H.x;L+=H.y}}function c(p,q,u){m(q,u,true);D=false}function l(){clearTimeout(wb);wb=setTimeout(function(){if(w)if(w.offsetWidth!==Sa*2||w.offsetHeight!==Ta*2){var p=E();t(a);E(p.x,p.y)}},250)}function j(p,q,u){x("tap",q,u);M.trigger("tap",q,u,e(u.x,u.y,true))}function f(){na&&na.unbind();if(V&&da){na=INTERACT.watch(da.interactTarget||w);if(d.scalable){na.bind("zoom",b);na.bind("doubleTap",h)}na.bind("pointerDown",
k);na.bind("pointerMove",i);na.bind("pointerUp",c);d.captureHover&&na.bind("pointerHover",g);na.bind("tap",j)}}function n(p){if(da){da.trigger("detach");da=null}var q=M,u=Z,H=w,$=d;p=p.split("/");for(var ha=new Hb(q,u,H,$),wa=0;wa<p.length;wa++)ha=La("renderer",p[wa],q,u,H,$,ha);da=ha;ka=V&&da.fastpan&&V.transforms;y=V&&V.transforms&&d.useTransforms;f();M.trigger("reset");J()}function m(p,q,u){if(K){p=e(q.x,q.y);K.drag.call(K.target,K,p.x,p.y,u)&&ia++;if(u)K=null}}function o(p){for(var q=W;q--;)if(G[q].id===
p)return q;return W}function t(p){if(V){w=document.getElementById(p);w.appendChild(R=V.create("div","",V.styles({overflow:"hidden",width:w.offsetWidth+"px",height:w.offsetHeight+"px"})));p=d.padding;if(p===v){p=w.offsetWidth;var q=w.offsetHeight,u=Eb(p*p+q*q);oa=new aa(u-p>>1,u-q>>1)}else oa=new aa(p,p);gb=R.offsetWidth+oa.x*2;hb=R.offsetHeight+oa.y*2;mb=gb/2;nb=hb/2;Sa=w.offsetWidth/2;Ta=w.offsetHeight/2;Ua=new aa(mb,nb);R.appendChild(Z=V.create("div","",V.styles({width:gb+"px",height:hb+"px","z-index":2,
margin:-oa.y+"px 0 0 "+-oa.x+"px"})));n(d.renderer);p=d.controls;for(q=0;q<F.length;q++)F[q].trigger("detach");F=[];for(q=0;q<p.length;q++)F[F.length]=La("control",p[q],M,R,w,d[p[q]])}else n("canvas")}function x(p,q,u){var H=(new aa(u.x-Sa+mb,u.y-Ta+nb)).rotate(-sa*fa,Ua).scale(1/ca,Ua);la=Hits.init(p,q,u,e(u.x,u.y,true),H);T=false;for(p=W;p--;)if(G[p].visible)T=T||(G[p].hitGuess?G[p].hitGuess(la.gridX,la.gridY,M):false);T&&ia++}function E(p,q,u){if(typeof p!="undefined"&&(S(p,Aa)||S(p,"object"))){q=
new M.XY(p);q.sync(M);p=q.x;q=q.y}if(S(p,Ba)){C(p-Sa-oa.x,q-Ta-oa.y,u);return M}else return C().offset(Sa+oa.x|0,Ta+oa.y|0).sync(M,true)}function Q(){var p=new ga(U,X,gb,hb);p.scaleFactor=ca;p.padding=oa?oa.copy():new aa;return p}function Y(p,q,u){if(S(p,Aa)&&S(q,Ea))for(q=0;q<W;q++){if(G[q].id===p)return G[q]}else if(S(p,Aa)){q=La("layer",q,M,u);u=o(p);u!==W&&M.trigger("layerRemove",G[u]);q.added=(new Date).getTime();q.id=p;G[u]=q;G.sort(function(H,$){return $.zindex-H.zindex||$.added-H.added});
W=G.length;M.trigger("resync");J();M.trigger("layerChange",M,q);ia++;return q}else return[].concat(G)}function J(){var p=Q();if(p){if(Na||Oa)if(p){var q=ib?U+(p.w>>1):U,u=jb?X+(p.h>>1):X,H=p.w,$=p.h;if(Na&&Na>H)if(q+H>Na)U=ib?U:Na-H;else if(q<0)U=ib?U:0;if(Oa&&Oa>$)if(u+$>Oa)X=jb?X:Oa-$;else if(u<0)X=jb?X:0}xb=U;yb=X;M.trigger("refresh",M,p);ia++}}function s(p,q,u,H){if(S(p,Ba)){var $=u?p:ca*p;if(!y){q=undefined;p=cb(kb($)/Math.LN2);$=Da(2,p)}if(H){p=M.center();M.pan(H.x-p.x,H.y-p.y,q)}if(q)Va=xa.tween([ca],
[$],q,function(){ca=$;Va=null;ia++});else{ca=$;ia++}return M}else return ca}function C(p,q,u){if(S(p,Ba)){if(u)ya=xa.tween([U,X],[p,q],u,function(){U=p|0;X=q|0;ua=Fa=0;ya=null;ia++});else{U=p|0;X=q|0;ia++}return M}else return(new M.XY(U,X)).sync(M,true)}d=z({captureHover:true,controls:[],drawOnScale:true,padding:128,inertia:true,refreshDistance:128,pannable:true,scalable:true,renderer:"canvas",useTransforms:true},d);var v="auto",y=true,N=false,F=[],G=[],W=0,Z=null,R=null,w,K=null,T=false,ka,D=false,
O=0,L=0,ea=d.refreshDistance,U=0,X=0,ua=0,Fa=0,xb=0,yb=0,Na=null,Oa=null,ib=false,jb=false,ya=null,oa,la=null,Wa=null,da,wb=0,Ua=new aa,sa=0,Xa=null,ca=1,Va=null,ob=1,na=null,pb={index:0,draw:false},ia=0,gb,hb,mb,nb,Sa,Ta,M={XY:aa,id:d.id,panSpeed:0,attachFrame:function(p,q){q&&Z.appendChild(p)},center:E,detach:function(){da&&da.trigger("detach");na&&na.unbind();if(R){w.removeChild(R);Z=R=null}},frozen:function(p){if(S(p,Ea))return N;else{N=p;return M}},layer:Y,invalidate:function(){ia++},pan:function(p,
q,u){C(U+p,X+q,u)},refresh:J,rotate:function(p,q,u){if(S(p,Ba)){var H=u?p:sa+p;if(q)Xa=xa.tween([sa],[H],q,function(){sa=H%360;Xa=null;ia++});else{sa=H%360;ia++}return M}else return sa},scale:s,setMaxOffset:function(p,q,u,H){Na=p;Oa=q;ib=u;jb=H},offset:C,viewport:Q};qa(M);M.bind("resize",l);M.bind("layerRemove",function(p,q){var u=Pa(G,q.id);if(u>=0&&u<W){G.splice(u,1);ia++}W=G.length});Za(M,d,{container:t,captureHover:f,scalable:f,pannable:f,renderer:n});Y("markers","draw",{zindex:20});t(a);if(V&&
!S(window.attachEvent,Ea))window.attachEvent("onresize",l);else V&&window.addEventListener("resize",l,false);Ma.attach(function(p){var q=[],u,H,$;if(!N){M.panSpeed=panSpeed=va(O)+va(L);(u=ca!==ob)&&M.trigger("scale");if(panSpeed>0||u||ya||Va||Xa){ia++;if(ya&&panSpeed>0){ya(true);ya=null}}if(!D&&panSpeed<=0&&(va(U-xb)>=ea||va(X-yb)>=ea))J();pb.index++;pb.draw=ia||panSpeed||0;if(da&&pb.draw){if(Va)ca=Va()[0];if(Xa)sa=Xa()[0];ua+=O;Fa+=L;if(O||L)M.trigger("pan");if(y){if(ca!==1)q[q.length]="scale("+
ca+")";if(sa!==0)q[q.length]="rotate("+sa+"deg)"}u=T||!ka||!D&&!ya&&(d.drawOnScale||ca===1)&&panSpeed<=2;if(ya){H=ya();ua=U-H[0]|0;Fa=X-H[1]|0}if(u){H=-sa*fa;u=eb(H)*ua+-Ka(H)*Fa;H=Ka(H)*ua+eb(H)*Fa;U=U-u/ca|0;X=X-H/ca|0;$=Q();da.trigger("predraw",$);if(da.prepare(G,$,p,la)){H=Fa=u=ua=ia=0;for(ii=W;ii--;){var ha=G[ii];if(ha.visible){var wa=ha.style?da.applyStyle(ha.style,true):null;ha.draw(da,$,M,p,la);wa&&da.applyStyle(wa)}}da.trigger("render",$);M.trigger("drawComplete",$,p);V.move(Z,u,H,q,Ua)}}else V.move(Z,
ua,Fa,q,Ua);if(D||!d.inertia)L=O=0;else if(O!=0||L!=0){O*=0.8;L*=0.8;if(va(O)<0.5)O=0;if(va(L)<0.5)L=0}if(la){p=true;q=la?la.elements:[];if(Wa&&Wa.type==="hover"){diffElements=Hits.diffHits(Wa.elements,q);if(diffElements.length>0)Hits.triggerEvent(Wa,M,"Out",diffElements);else p=false}if(q.length>0){H=la.gridX;$=la.gridY;for(u=q.length;D&&u--;){ha=q[u];wa=H;var zb=$,Ab=ha&&ha.drag&&(!ha.canDrag||ha.canDrag(ha,wa,zb));if(Ab){K=ha;K.startX=wa;K.startY=zb}if(Ab)break}p&&Hits.triggerEvent(la,M)}Wa=q.length>
0?z({},la):null;la=null}if(ob!==ca){M.trigger("scaleChanged",ca);ob=ca}}}});return M},xa=function(){return{tween:function(a,d,b,e,h){function k(o){var t=o-m;o=m+n<=o;for(var x=g;x--;)i[x]=l(t,a[x],j[x],n);h&&h.invalidate();if(o||f){Ma.detach(k);for(x=0;x<c.length;x++)c[x]&&c[x](i,t,f)}}b=z({easing:"sine.out",duration:1E3,complete:null},b);var g=a.length,i=[].concat(a),c=[e,b.complete],l=Ya(b.easing),j=[],f=false,n=b.duration,m=(new Date).getTime();for(b=g;b--;)j[b]=d[b]-a[b];Ma.attach(k);return function(o){f=
o;return i}},tweenDrawable:function(a,d,b,e,h){var k=xa.tween([b],[e],h,function(){a[d]=e;for(var i=a.tweens.length;i--;)if(a.tweens[i]===g){a.tweens.splice(i,1);break}},a.view),g=function(){a[d]=k()[0]};return g}}}(),Ga=function(a,d,b){b=z({style:null,xy:null,size:20,fill:false,stroke:true,draggable:false,observable:true,properties:{},typeName:"Shape",zindex:0},b);z(this,b);if(S(this.xy,Aa))this.xy=new a.XY(this.xy);this.id="drawable_"+Gb++;this.bounds=null;this.view=a;this.layer=d;this.tweens=[];
this.rotation=this.animations=0;this.scaling=1;this.translateY=this.translateX=0;this.observable&&qa(this)};Ga.prototype={constructor:Ga,applyTweens:function(){for(var a=this.tweens.length;a--;)this.tweens[a]()},drag:null,draw:null,getProps:null,resync:function(){if(this.xy){this.xy.sync(this.view);if(this.size){var a=this.size>>1;this.updateBounds(new ga(this.xy.x-a,this.xy.y-a,this.size,this.size))}}},rotate:function(a,d,b){if(S(a,Ba)){a=(b?a:this.rotation*bb+a)*fa;if(d)this.tweens.push(xa.tweenDrawable(this,
"rotation",this.rotation,a,d));else{this.rotation=a;this.view.invalidate()}return this}else return this.rotation*bb},scale:function(a,d,b){if(S(a,Ba)){a=b?a:this.scaling*a;if(d)this.tweens.push(xa.tweenDrawable(this,"scaling",this.scaling,a,d));else{this.scaling=a;this.view.invalidate()}return this}else return this.scaling},translate:function(a,d,b,e){if(S(a,Ba)){a=e?a:this.translateX+a;d=e?d:this.translateY+d;if(b){this.tweens.push(xa.tweenDrawable(this,"translateX",this.translateX,a,b));this.tweens.push(xa.tweenDrawable(this,
"translateY",this.translateY,d,b))}else{this.translateX=a;this.translateY=d;this.view.invalidate()}return this}else return new aa(this.translateX,this.translateY)},updateBounds:function(a,d){a&&(!this.bounds||a.x!=this.bounds.x||a.y!=this.bounds.y)&&this.trigger("move",this,a,this.bounds);this.bounds=a;if(d)this.xy=this.bounds.center()}};ra("drawable","marker",function(a,d,b){b=z({fill:true,stroke:false,markerType:"simple",hoverStyle:"highlight",typeName:"Marker"},b);return new Ga(a,d,b)});ra("drawable",
"poly",function(a,d,b){function e(){var j,f,n,m,o,t,x;c=b.simplify?i.simplify():i;for(j=c.length;j--;){f=c[j].x;n=c[j].y;t=S(t,Ea)||f<t?f:t;x=S(x,Ea)||n<x?n:x;m=S(m,Ea)||f>m?f:m;o=S(o,Ea)||n>o?n:o}l.updateBounds(new ga(t,x,m-t,o-x),true);a.invalidate()}function h(j){if(S(j,"array")){i=new za(b.allowCull);ub.process(j,function(f,n){for(var m=0;m<n;m++)i.push(new a.XY(f[m]))},k,g);return l}else return c}function k(){i.length&&ub.process(i,function(j,f){for(var n=f;n--;)j[n].sync(a)},e,g)}b=z({allowCull:false,
simplify:false,fill:true,points:[],typeName:"Poly"},b);var g=500,i=new za(b.allowCull),c=[],l=z(new Ga(a,d,b),{points:h,resync:k});h(b.points);return l});ra("drawable","line",function(a,d,b){b.fill=false;b.allowCull=true;return La("drawable","poly",a,d,b)});ra("drawable","image",function(a,d,b){function e(){if(c&&c.width>0){if(!this.centerOffset)this.centerOffset=new aa(-c.width>>1,-c.height>>1);this.updateBounds(new ga(this.xy.x+this.centerOffset.x,this.xy.y+this.centerOffset.y,c.width,c.height),
false)}}function h(j){if(this.imageUrl=j){var f=this;fb(this.imageUrl,function(n,m){c=n;if(m){var o=l.layer?l.layer.view:null;o&&o.invalidate()}e.apply(f)})}}b=z({image:null,imageUrl:null,centerOffset:null,typeName:"Image"},b);var k=Ga.prototype.resync,g=0,i=0,c=b.image,l=z(new Ga(a,d,b),{changeImage:h,getProps:function(){this.bounds||e(this,c);return{image:c,x:this.xy.x+g,y:this.xy.y+i}},resync:function(j){k.call(this,j);e.call(this)}});c||h.call(this,this.imageUrl);if(this.centerOffset){g=this.centerOffset.x;
i=this.centerOffset.y}});ra("drawable","arc",function(a,d,b){b=z({startAngle:0,endAngle:Math.PI*2,typeName:"Arc"},b);return new Ga(a,d,b)});ta.prototype={constructor:ta,clip:null,cycle:function(){},draw:function(){},hitGuess:null,remove:function(){this.view.trigger("layerRemove",this)}};ra("layer","tile",function(a,d){d=z({generator:"osm",imageLoadArgs:{}},d);var b=La("generator",d.generator,d).run,e=null,h=[],k=z(new ta(a,d),{draw:function(g,i,c){g.drawTiles&&g.drawTiles(i,e.search(i.buffer(128)),
c.panSpeed<2)}});a.bind("resync",function(){var g=a&&a.zoom?a.zoom():0;h[g]||(h[g]=Ha(g));e=h[g]});a.bind("refresh",function(g,i,c){e&&b(i,c,e,function(){i.invalidate()})});return k});ra("layer","draw",function(a,d){function b(i,c,l,j){var f=this.dragOffset;if(!f)f=this.dragOffset=new a.XY(i.startX-this.xy.x,i.startY-this.xy.y);this.xy.x=c-f.x;this.xy.y=l-f.y;if(j){delete this.dragOffset;a.invalidate();this.xy.sync(a,true);this.trigger("dragDrop")}return true}function e(i,c,l,j){j&&k.remove(j,c);
k.insert(l,c)}d=z({zindex:10},d);var h=[],k,g=z(new ta(a,d),{itemCount:0,clear:function(){k=new sb;h=[];g.trigger("cleared");g.itemCount=0;a.invalidate()},create:function(i,c,l){c=La("drawable",i,a,g,c);if(l)h.unshift(c);else h[h.length]=c;c.resync();k&&c.bounds&&k.insert(c.bounds,c);c.bind("move",e);g.itemCount=h.length;g.trigger(i+"Added",c);return c},draw:function(i,c,l,j,f){l={};j=k&&c?k.search(c):[];for(var n=j.length;n--;){var m=j[n],o=m.style||g.style,t,x,E=m.getProps?m.getProps(i):l;t=i["prep"+
m.typeName];m.tweens.length>0&&m.applyTweens();x=i.applyTransform(m);if(E=t?t.call(i,m,c,f,E):null){if(f&&E.hit){f.elements.push(Hits.initHit(m.type,m,m.draggable?b:null));t=f.type+"Style";o=m[t]||g[t]||o}o=o?i.applyStyle(o,true):null;(t=m.draw||E.draw)&&t.call(m,E);o&&i.applyStyle(o)}x&&x.undo&&x.undo()}},find:function(){return[].concat(h)},hitGuess:function(i,c){return k&&k.search({x:i-10,y:c-10,w:20,h:20}).length>0}});a.bind("resync",function(){k=Ha(a.zoom(),k);for(var i=h.length;i--;)h[i].resync()});
return g});Ca.prototype={constructor:Ca};ra("control","zoombar",function(a,d,b,e){function h(v,y){var N=Y[v]=V.create("div","t5-zoombar-button",{position:"absolute",background:k(v),"z-index":51,width:e.width+"px",height:e.buttonHeight+"px","margin-top":(y||0)+"px"});J.appendChild(N)}function k(v,y){return"url("+e.images+") 0 -"+(f+m*3+(v||0)*l*3+(y||0)*l)+"px"}function g(v){return"url("+e.images+") 0 -"+(f+(v||0)*m)+"px"}function i(v,y){var N;if(v===n){n.style.background=g(y);N="thumb"}else for(var F=
0;F<Y.length;F++)if(v===Y[F]){N="button"+F;Y[F].style.background=k(F,y);break}return N}function c(v){if(v!==E){E=v;x=t-E/Q*(t-o)|0;V.move(n,0,x-o);clearTimeout(s);s=setTimeout(function(){a.zoom(E)},500)}}e=z({width:24,height:200,images:"img/zoom.png",align:"right",marginTop:10,spacing:10,thumbHeight:16,buttonHeight:16},e);var l=e.buttonHeight,j,f=e.height,n,m=e.thumbHeight,o=e.spacing+l-(m>>1),t=e.height-l-(m>>1),x=o,E=-1;d=a.minZoom();var Q=a.maxZoom()-d+1,Y=[],J,s=0,C={button0:function(){a.zoom(a.zoom()+
1)},button1:function(){a.zoom(a.zoom()-1)}};J=V.create("div","t5-zoombar",{position:"absolute",background:"url("+e.images+")","z-index":50,overflow:"hidden",width:e.width+"px",height:e.height+"px",margin:function(){var v=e.spacing,y=ma("{0}px 0 0 {1}px");if(e.align==="right")v=b.offsetWidth-e.width-e.spacing;return y(e.marginTop,v)}()});b.childNodes[0]?b.insertBefore(J,b.childNodes[0]):b.appendChild(J);J.appendChild(n=V.create("div","t5-zoombar-thumb",{position:"absolute",background:g(),"z-index":51,
width:e.width+"px",height:e.thumbHeight+"px",margin:"10px 0 0 0",top:x-o+"px"}));h(0);h(1,e.height-e.buttonHeight);j=INTERACT.watch(J,{bindTarget:J});j.bind("pointerMove",function(v,y,N){x=Math.min(Math.max(o,N.y-(m>>1)),t);c(Q-(x-o)/t*Q|0)});j.bind("pointerDown",function(v){i(v.target,2)});j.bind("pointerUp",function(v){i(v.target,0)});j.bind("tap",function(v){(v=C[i(v.target,2)])&&v()});d=new Ca(a);d.bind("detach",function(){j.unbind();b.removeChild(J)});a.bind("zoom",function(v,y){c(y)});c(a.zoom());
return d});z(r,{ex:z,log:ja,observable:qa,configurable:Za,formatter:ma,wordExists:function(a,d){for(var b=a.split(/\s|\,/).length;b--;)if(a.toLowerCase()==d.toLowerCase())return true;return false},is:S,indexOf:Pa,fn:function(a){return Fb("fn",a)},project:ab,unproject:lb,getImage:fb,userMessage:Ja,Registry:A,Style:vb,DOM:V,Rect:ga,XY:aa,Line:za,Hits:Hits,Control:Ca,Tile:Ia,Tweener:xa,View:Bb,Map:function(a,d){function b(l,j){var f=c.viewport();if(l){f=db(l.bestZoomLevel(f.w,f.h),j||0);return e(f).center(l.center())}else return new GeoJS.BBox((new ba(f.x,
f.y2)).sync(c,true).pos(),(new ba(f.x2,f.y)).sync(c,true).pos())}function e(l,j,f){if(S(l,Ba)){l=db(d.minZoom,tb(d.maxZoom,l|0));if(l!==g){var n=c.viewport(),m=c.offset(),o=n.w/2;n=n.h/2;var t=Da(2,l-g),x=o/t|0,E=n/t|0;g=l;c.offset(((j||m.x+o)-x)*t,((f||m.y+n)-E)*t);c.trigger("zoom",l);c.trigger("reset");k=c.rpp=P/(256<<g);c.setMaxOffset(P/k|0,P/k|0,true,false);c.scale(1,false,true);c.trigger("resync");c.refresh()}return c}else return g}d=z({controls:["zoombar"],minZoom:1,maxZoom:18,renderer:"canvas/dom",
zoom:1,zoombar:{}},d);var h=new ba,k,g=d.zoom||d.zoomLevel,i=0,c=z(new Bb(a,d),{XY:ba,bounds:b,zoom:e});k=c.rpp=P/(256<<g);c.bind("refresh",function(){var l=c.viewport();if(h.x!=l.x||h.y!=l.y){c.trigger("boundsChange",b());h.x=l.x;h.y=l.y}});c.bind("scaleChanged",function(l,j){var f=kb(j)/Math.LN2|0;if(f!==0){j=Da(2,f);clearTimeout(i);i=setTimeout(function(){e(g+f)},500)}});return c}});if(typeof module!="undefined"&&module.exports)module.exports=r;ra("generator","osm",function(a){a=z({flipY:false,
tileSize:256,tilePath:"{0}/{1}/{2}.png",osmDataAck:true},a);var d=Math.PI/180,b=180/Math.PI,e=null,h=[],k,g=ma(a.tilePath),i={buildTileUrl:function(c,l,j,f,n){if(l>=0&&l<f){c=(c%f+f)%f;l=g(j,c,n?Math.abs(l-f+1):l);if(e)l=k(h[c%(h.length||1)])+l;return l}},run:function(c,l,j,f){var n=c.zoom?c.zoom():0;if(n){var m=2<<n-1,o=a.tileSize,t=(l.w/o|0)+1,x=(l.h/o|0)+1;l=(new ba(l.x,l.y)).sync(c,true).pos();var E=l.lat;l=new ba((l.lon+180)/360*m|0,(1-Math.log(Math.tan(E*d)+1/Math.cos(E*d))/Math.PI)/2*m%m|0);
E=Math.PI-2*Math.PI*l.y/m;E=new GeoJS.Pos(b*Math.atan(0.5*(Math.exp(E)-Math.exp(-E))),l.x/m*360-180);E=new ba(E);E.sync(c);c=a.flipY;var Q=j.search({x:E.x,y:E.y,w:t*o,h:x*o}),Y={},J;for(J=Q.length;J--;)Y[Q[J].id]=true;h=(e=i.getServerDetails?i.getServerDetails():null)&&e.subDomains?e.subDomains:[];k=ma(e?e.baseUrl:"");for(Q=0;Q<=t;Q++)for(J=0;J<=x;J++){var s=l.x+Q,C=l.y+J,v=s+"_"+C;if(!Y[v]){tileUrl=i.buildTileUrl(s,C,n,m,c);s=new Ia(E.x+Q*o,E.y+J*o,tileUrl,o,o,v);j.insert(s,s)}}f&&f()}}};a.osmDataAck&&
Ja("ack","osm",'Map data (c) <a href="http://openstreetmap.org/" target="_blank">OpenStreetMap</a> (and) contributors, CC-BY-SA');return i})})();
