COG=typeof COG!=="undefined"?COG:{};COG.extend=function(){for(var Q=arguments[0]||{},ka,K=1,D=arguments.length;K<D;K++)if((ka=arguments[K])!==null)for(var k in ka){var n=ka[k];if(Q!==n)if(n!==undefined)Q[k]=n}return Q};
(function(){var Q=Object.prototype.hasOwnProperty,ka=0,K={};K.toID=function(D){return D.replace(/\s/g,"-")};K.objId=function(D){return(D?D:"obj")+ka++};K.isFunction=function(D){return toString.call(D)==="[object Function]"};K.isArray=function(D){return toString.call(D)==="[object Array]"};K.isPlainObject=function(D){if(!D||toString.call(D)!=="[object Object]"||D.nodeType||D.setInterval)return false;if(D.constructor&&!Q.call(D,"constructor")&&!Q.call(D.constructor.prototype,"isPrototypeOf"))return false;
var k;for(k in D);return k===undefined||Q.call(D,k)};K.isEmptyObject=function(D){for(var k in D)return false;return true};K.isXmlDocument=function(D){return toString.call(D)==="[object Document]"};K.contains=function(D,k){var n=D,y=arguments,E=1;if(k&&module.isArray(k)){y=k;E=0}for(E=E;E<y;E++)n=n&&typeof foo[y[E]]!=="undefined";return n};K.formatStr=function(D){if(arguments.length<=1)return D;for(var k=arguments.length-2,n=0;n<=k;n++)D=D.replace(RegExp("\\{"+n+"\\}","gi"),arguments[n+1]);return D};
K.wordExists=function(D,k){var n="";if(k.toString)k=k.toString();for(var y=0;y<k.length;y++)n+=!/\w/.test(k[y])?"\\"+k[y]:k[y];return RegExp("(^|\\s|\\,)"+n+"(\\,|\\s|$)","i").test(D)};COG.extend(COG,K)})();
(function(){function Q(n){return typeof console!=="undefined"?function(){console[n](Array.prototype.slice.call(arguments,0).join(" "));return true}:function(){return false}}var ka=window.console&&window.console.markTimeline,K=Q("error"),D=Q("info"),k=function(){return ka?function(n,y){console.markTimeline(n+(y?": "+((new Date).getTime()-y)+"ms":""))}:function(){}}();COG.extend(COG,{trace:k,debug:Q("debug"),info:D,warn:Q("warn"),error:K,exception:function(n){if(K)for(var y in n)D("ERROR DETAIL: "+
y+": "+n[y])}})})();
(function(){function Q(K,D){var k=K.obsHandlers;k[D]||(k[D]=[]);return k[D]}var ka=0;COG.observable=function(K){if(!K)return null;if(!K.obsHandlers)K.obsHandlers={};if(!(K.bind||K.trigger||K.unbind)){K.bind=function(D,k){var n="callback"+ka++;Q(K,D).unshift({fn:k,id:n});return n};K.triggerCustom=function(D,k){var n=Q(K,D),y={cancel:false,name:D,source:this},E;k&&COG.extend(y,k);if(!n)return null;E=Array.prototype.slice.call(arguments,2);K.eventInterceptor&&K.eventInterceptor(D,y,E);E.unshift(y);for(var h=
n.length;h--&&!y.cancel;)n[h].fn.apply(this,E);return y};K.trigger=function(D){var k=Array.prototype.slice.call(arguments,1);k.splice(0,0,D,null);return K.triggerCustom.apply(this,k)};K.unbind=function(D,k){if(typeof D==="undefined")K.obsHandlers={};else for(var n=Q(K,D),y=0;n&&y<n.length;y++)if(n[y].id===k){n.splice(y,1);break}return K}}return K}})();
(function(){function Q(k,n){k[n]||(k[n]=function(y){return k.configure(n,y)})}function ka(k){k.gtConfId="configurable"+D++;k.gtConfig={};k.gtConfigFns=[];return k.gtConfig}var K={},D=0;COG.paramTweaker=function(k,n,y){return function(E,h){if(typeof h!=="undefined"){if(E in k)k[E]=h;y&&E in y&&y[E](E,h)}else return n&&E in n?n[E](E):k[E]}};COG.configurable=function(k,n,y,E){if(k){k.gtConfId||ka(k);var h=k.gtConfId,H=k.gtConfig,G=k.gtConfigFns;K[h]=k;G.push(y);for(y=n.length;y--;){H[n[y]]=true;E&&Q(k,
n[y])}if(!k.configure)k.configure=function(L,ia){if(H[L]){for(var w=G.length;w--;){var B=G[w](L,ia);if(typeof B!=="undefined")return B}return K[h]}return null}}}})();
(function(){function Q(k){var n=document.createElement("script"),y=false;n.src=k;n.async=true;n.onload=n.onreadystatechange=function(){if(!y&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){y=true;n.onload=n.onreadystatechange=null;n&&n.parentNode&&n.parentNode.removeChild(n)}};K||(K=document.getElementsByTagName("head")[0]);K.appendChild(n)}var ka=0,K,D=this;COG.jsonp=function(k,n,y){k+=k.indexOf("?")>=0?"&":"?";var E="json"+ ++ka;D[E]=function(h){n(h);D[E]=null;try{delete D[E]}catch(H){}};
Q(k+(y?y:"callback")+"="+E);return E}})();
(function(){var Q=1.70158,ka=Math.PI/2,K=Math.abs,D=Math.pow,k=Math.sin,n=Math.asin,y=Math.cos,E={linear:function(h,H,G,L){return G*h/L+H},backin:function(h,H,G,L){return G*(h/=L)*h*((Q+1)*h-Q)+H},backout:function(h,H,G,L){return G*((h=h/L-1)*h*((Q+1)*h+Q)+1)+H},backinout:function(h,H,G,L){return(h/=L/2)<1?G/2*h*h*(((Q*=1.525)+1)*h-Q)+H:G/2*((h-=2)*h*(((Q*=1.525)+1)*h+Q)+2)+H},bouncein:function(h,H,G,L){return G-E.bounceout(L-h,0,G,L)+H},bounceout:function(h,H,G,L){return(h/=L)<1/2.75?G*7.5625*h*
h+H:h<2/2.75?G*(7.5625*(h-=1.5/2.75)*h+0.75)+H:h<2.5/2.75?G*(7.5625*(h-=2.25/2.75)*h+0.9375)+H:G*(7.5625*(h-=2.625/2.75)*h+0.984375)+H},bounceinout:function(h,H,G,L){return h<L/2?E.bouncein(h*2,0,G,L)/2+H:E.bounceout(h*2-L,0,G,L)/2+G/2+H},cubicin:function(h,H,G,L){return G*(h/=L)*h*h+H},cubicout:function(h,H,G,L){return G*((h=h/L-1)*h*h+1)+H},cubicinout:function(h,H,G,L){if((h/=L/2)<1)return G/2*h*h*h+H;return G/2*((h-=2)*h*h+2)+H},elasticin:function(h,H,G,L,ia,w){if(h==0)return H;if((h/=L)==1)return H+
G;w||(w=L*0.3);if(!ia||ia<K(G)){ia=G;G=w/4}else G=w/TWO_PI*n(G/ia);return-(ia*D(2,10*(h-=1))*k((h*L-G)*TWO_PI/w))+H},elasticout:function(h,H,G,L,ia,w){var B;if(h==0)return H;if((h/=L)==1)return H+G;w||(w=L*0.3);if(!ia||ia<K(G)){ia=G;B=w/4}else B=w/TWO_PI*n(G/ia);return ia*D(2,-10*h)*k((h*L-B)*TWO_PI/w)+G+H},elasticinout:function(h,H,G,L,ia,w){var B;if(h==0)return H;if((h/=L/2)==2)return H+G;w||(w=L*0.3*1.5);if(!ia||ia<K(G)){ia=G;B=w/4}else B=w/TWO_PI*n(G/ia);if(h<1)return-0.5*ia*D(2,10*(h-=1))*k((h*
L-B)*TWO_PI/w)+H;return ia*D(2,-10*(h-=1))*k((h*L-B)*TWO_PI/w)*0.5+G+H},quadin:function(h,H,G,L){return G*(h/=L)*h+H},quadout:function(h,H,G,L){return-G*(h/=L)*(h-2)+H},quadinout:function(h,H,G,L){if((h/=L/2)<1)return G/2*h*h+H;return-G/2*(--h*(h-2)-1)+H},sinein:function(h,H,G,L){return-G*y(h/L*ka)+G+H},sineout:function(h,H,G,L){return G*k(h/L*ka)+H},sineinout:function(h,H,G,L){return-G/2*(y(Math.PI*h/L)-1)+H}};COG.tweenValue=function(h,H,G,L,ia){function w(da){var Y=da-B,ta=G(Y,h,M,L),ya=B+L<=da;
da=!ya;if(ia){Y=ia(ta,ya,Y);da=typeof Y!="undefined"?Y&&da:da}da&&animFrame(w)}var B=(new Date).getTime(),M=H-h;animFrame(w);return{}};COG.easing=function(h){return E[h.replace(/[\-\_\s\.]/g,"").toLowerCase()]};COG.registerEasingType=function(h,H){E[h.replace(/[\-\_\s\.]/g,"").toLowerCase()]=H}})();
(function(){var Q=/^P(\d+Y)?(\d+M)?(\d+D)?$/,ka=/^(\d+H)?(\d+M)?(\d+S)?$/,K={8601:function(k){k=k.split("T");var n=null;n=null;var y=0,E=0;Q.lastIndex=-1;n=Q.exec(k[0]);y+=n[3]?parseInt(n[3].slice(0,-1),10):0;ka.lastIndex=-1;n=ka.exec(k[1]);E+=n[1]?parseInt(n[1].slice(0,-1),10)*3600:0;E+=n[2]?parseInt(n[2].slice(0,-1),10)*60:0;E+=n[3]?parseInt(n[3].slice(0,-1),10):0;return new D(y,E)}},D=COG.Duration=function(k,n){return{days:k?k:0,seconds:n?n:0}};COG.addDuration=function(){for(var k=new D,n=arguments.length;n--;){k.days+=
arguments[n].days;k.seconds+=arguments[n].seconds}if(k.seconds>=86400){k.days+=~~(k.seconds/86400);k.seconds%=86400}return k};COG.formatDuration=function(k){var n,y,E="";if(k.days)E=k.days+" days ";if(k.seconds){k=k.seconds;if(k>=3600){n=~~(k/3600);k-=n*3600}if(k>=60){y=Math.round(k/60);k-=y*60}if(n)E=E+n+(n>1?" hrs ":" hr ")+(y?(y>10?y:"0"+y)+" min ":"");else if(y)E=E+y+" min";else if(k>0)E=E+(k>10?k:"0"+k)+" sec"}return E};COG.parseDuration=function(k,n){var y=n?K[n]:null;if(y)return y(k);COG.Log.warn("Could not find duration parser for specified format: "+
n);return new D}})();var CANI={};
(function(Q){var ka=[],K=0,D=false,k=Q.register=function(n,y){ka.push({section:n,run:y})};Q.init=function(n){function y(){if(K<ka.length){var h=ka[K++];E[h.section]||(E[h.section]={});h.run(E[h.section],y)}else{for(h in E)Q[h]=E[h];D=true;n&&n(Q)}}var E={};if(D&&n)n(Q);else{K=0;y()}};k("canvas",function(n,y){var E=document.createElement("canvas"),h=E.getContext("2d");E.width=200;E.height=200;n.pipTransformed=function(){var H;h.save();try{h.translate(50,50);h.beginPath();h.rect(0,0,20,20);H=h.isPointInPath(10,
10)}finally{h.restore()}return H}();y()})})(CANI);
INTERACT=function(){function Q(w){return function(B,M,da){(da?da:w?document.body:document).addEventListener(B,M,false)}}function ka(w){return function(B,M,da){(da?da:w?document.body:document).removeEventListener(B,M,false)}}function K(w,B,M){(M?M:document).attachEvent("on"+w,B)}function D(w,B,M){(M?M:document).detachEvent("on"+w,B)}function k(w,B){return{x:w?w:0,y:B?B:0,count:1}}function n(w,B){L.push(COG.extend({handler:null,checks:{},type:w},B))}function y(w){var B=0,M=0;if(w.offsetParent){do{B+=
w.offsetLeft;M+=w.offsetTop;w=w.offsetParent}while(w)}return{x:B,y:M}}function E(w,B){return{source:w,target:B.target?B.target:B.srcElement}}function h(w,B){for(var M=w.target?w.target:w.srcElement;M&&M!==B&&M.nodeName&&M.nodeName.toUpperCase()!="CANVAS";)M=M.parentNode;return M&&M===B}function H(w,B){return{x:w.x-(B?B.x:0),y:w.y-(B?B.y:0)}}function G(w){if(w.preventDefault){w.preventDefault();w.stopPropagation()}else w.cancelBubble&&w.cancelBubble()}var L=[],ia=function(w,B,M){function da(la,aa,
qa,V){var ea=0,Aa=0,o=0;COG.tweenValue(0,la,qa,V,function(va){o=ea;ea=va});COG.tweenValue(0,aa,qa,V,function(va){Y.trigger("pan",ea-o,va-Aa);Aa=va})}M=COG.extend({binder:null,unbinder:null,observable:null},M);for(var Y=M.observable,ta=null,ya=[],fa=[],wa,xa,Fa={bind:function(){return Y.bind.apply(null,arguments)},pannable:function(la){ta=COG.extend({inertia:true},la);return Fa},unbind:function(){Y.unbind();for(var la=0;la<ya.length;la++)ya[la].unbind();return Fa}},Ca=0;Ca<B.length;Ca++)ya.push(B[Ca](w,
Y,M));Y.bind("pointerDown",function(){fa=[];xa=wa=0});Y.bind("pointerMove",function(la,aa,qa,V){if(ta){fa[fa.length]={ticks:(new Date).getTime(),x:V.x,y:V.y};Y.trigger("pan",V.x,V.y)}wa+=V.x?V.x:0;xa+=V.y?V.y:0});Y.bind("pointerUp",function(la,aa,qa){if(Math.abs(wa)>20||Math.abs(xa)>20){if(ta){qa=fa.length;var V,ea;aa=0;for(ea=fa.length;--ea>1&&aa<50;)aa+=fa[ea].ticks-fa[ea-1].ticks;if(qa-ea>1){la=fa[qa-1].x-fa[ea].x;V=fa[qa-1].y-fa[ea].y;ea=Math.sqrt(la*la+V*V)|0;if(ea>15){la=fa[qa-1].x-fa[0].x;
V=fa[qa-1].y-fa[0].y;ea=Math.sqrt(la*la+V*V)|0;qa=Math.asin(V/ea);aa=ea*500/aa|0;aa=aa>300?300:aa;da(Math.cos(la>0?qa:Math.PI-qa)*aa,Math.sin(qa)*aa,COG.easing("sine.out"),500)}}}}else Y.trigger("tap",aa,qa)});return Fa};n("pointer",{handler:function(w,B,M){function da(o){if(h(o,w))if(Ca=fa(o)){w.style.cursor="move";G(o);ea=o.pageX?o.pageX:o.screenX;Aa=o.pageY?o.pageY:o.screenY;la=k(ea,Aa);aa=y(w);B.triggerCustom("pointerDown",E("mouse",o),la,H(la,aa))}}function Y(o){qa=o.pageX?o.pageX:o.screenX;
V=o.pageY?o.pageY:o.screenY;if(h(o,w))wa(o,Ca?"pointerMove":"pointerHover")}function ta(o){if(Ca&&fa(o)){Ca=false;if(h(o,w)){w.style.cursor="default";wa(o,"pointerUp")}}}function ya(o){if(h(o,w)){var va;o=o||window.event;if(o.detail)va=o.axis===2?-o.detail*xa:0;else{va=o.wheelDeltaY?o.wheelDeltaY:o.wheelDelta;if(window.opera)va=-va}if(va!==0){var oa=k(qa,V);B.triggerCustom("zoom",E("mouse",o),oa,H(oa,y(w)),va/Fa,"wheel");G(o);o.returnValue=false}}}function fa(o){o=o||window.event;return(o.which||
o.button)==1}function wa(o,va,oa,Ra,Ga){oa=typeof oa!="undefined"?oa:qa;Ra=typeof Ra!="undefined"?Ra:V;var T=oa-ea,ba=Ra-Aa,Z=k(oa,Ra);aa||(aa=y(w));B.triggerCustom(va,E("mouse",o),Z,H(Z,aa),k(T,ba));if(typeof Ga=="undefined"||Ga){ea=oa;Aa=Ra}}M=COG.extend({},M);var xa=120,Fa=xa*8,Ca=false,la,aa,qa,V,ea,Aa;M.binder("mousedown",da,false);M.binder("mousemove",Y,false);M.binder("mouseup",ta,false);M.binder("dblclick",function(o){COG.info("captured double click");if(h(o,w)){var va=k(o.pageX?o.pageX:o.screenX,
o.pageY?o.pageY:o.screenY);COG.info("captured double click + target matched");B.triggerCustom("doubleTap",E("mouse",o),va,H(va,y(w)))}},false);M.binder("mousewheel",ya,document);M.binder("DOMMouseScroll",ya,document);return{unbind:function(){M.unbinder("mousedown",da,false);M.unbinder("mousemove",Y,false);M.unbinder("mouseup",ta,false);M.unbinder("mousewheel",ya,document);M.unbinder("DOMMouseScroll",ya,document)}}},checks:{touch:false}});n("pointer",{handler:function(w,B,M){function da(T){if(T.count<
2)return 0;var ba=T.x-T.next.x;T=T.y-T.next.y;return~~Math.sqrt(ba*ba+T*T)}function Y(T,ba,Z){ba=ba?ba:0;Z=Z?Z:0;for(var Na={x:T.x-ba,y:T.y-Z,id:T.id,count:T.count},Sa=Na;T.next;){T=T.next;Sa=Sa.next={x:T.x-ba,y:T.y-Z,id:T.id}}return Na}function ta(T,ba){var Z=T[ba?ba:"touches"],Na,Sa;if(Z.length===0)return null;Sa=Na={x:Z[0].pageX,y:Z[0].pageY,id:Z[0].identifier,count:Z.length};for(var Oa=1,gb=Z.length;Oa<gb;Oa++)Sa=Sa.next={x:Z[Oa].pageX,y:Z[Oa].pageY,id:Z[Oa].identifier};return Na}function ya(T){if(h(T,
w)){V=y(w);var ba=ta(T,"changedTouches"),Z=Y(ba,V.x,V.y);if(!Aa){ea=la;B.triggerCustom("pointerDown",E("touch",T),ba,Z)}Ra&&B.triggerCustom("pointerDownMulti",E("touch",T),ba,Z);Aa=ta(T);if(Aa.count>1)va=da(Aa);Ga=1;oa=Y(Aa)}}function fa(T){if(h(T,w)){T.preventDefault();o=ta(T);if(ea==la)ea=Math.abs(Aa.x-o.x)>Fa||Math.abs(Aa.y-o.y)>Fa?Ca:la;if(ea!=la){ea=o.count>1?qa:aa;if(ea==qa)if(Aa.count===1){Aa=Y(o);va=da(Aa)}else{var ba=da(o);if(Math.abs(va-ba)<xa)ea=aa;else{var Z;Z=o.x;var Na=o.next.x,Sa=o.y,
Oa=o.next.y,gb=Sa<Oa?Sa:Oa;Z={x:(Z<Na?Z:Na)+(Math.abs(Z-Na)>>1),y:gb+(Math.abs(Sa-Oa)>>1)};ba=ba/va;Na=ba-Ga;B.triggerCustom("zoom",E("touch",T),Z,H(Z,V),Na,"pinch");Ga=ba}}ea==aa&&B.triggerCustom("pointerMove",E("touch",T),o,Y(o,V.x,V.y),k(o.x-oa.x,o.y-oa.y));Ra&&B.triggerCustom("pointerMoveMulti",E("touch",T),o,Y(o,V.x,V.y))}oa=Y(o)}}function wa(T){if(h(T,w)){var ba=ta(T,"changedTouches"),Z=Y(ba,V.x,V.y);o=ta(T);if(!o){B.triggerCustom("pointerUp",E("touch",T),ba,Z);Aa=null}Ra&&B.triggerCustom("pointerUpMulti",
E("touch",T),ba,Z)}}M=COG.extend({detailed:false,inertia:false},M);var xa=20,Fa=7,Ca=0,la=1,aa=2,qa=3,V,ea,Aa,o,va,oa,Ra=M.detailed,Ga=1;M.binder("touchstart",ya,false);M.binder("touchmove",fa,false);M.binder("touchend",wa,false);COG.info("initialized touch handler");return{unbind:function(){M.unbinder("touchstart",ya,false);M.unbinder("touchmove",fa,false);M.unbinder("touchend",wa,false)}}},checks:{touch:true}});return{register:n,watch:function(w,B,M){B=COG.extend({bindToBody:false,observable:null,
isIE:typeof window.attachEvent!="undefined",types:null},B);capabilities=COG.extend({touch:"ontouchstart"in window},M);if(!B.observable){COG.info("creating observable");B.observable=COG.observable({});globalOpts=B}B.binder=B.isIE?K:Q(B.bindToBody);B.unbinder=B.isIE?D:ka(B.bindToBody);M=B.types;for(var da=capabilities,Y=[],ta=L.length;ta--;){var ya=L[ta],fa=!M||M.indexOf(ya.type)>=0,wa=true;for(var xa in ya.checks){var Fa=ya.checks[xa];COG.info("checking "+xa+" capability. require: "+Fa+", capability = "+
da[xa]);wa=wa&&Fa===da[xa]}if(fa&&wa)Y[Y.length]=ya.handler}return new ia(w,Y,B)}}}();var T5={};
(function(Q){function ka(){return(new Date).getTime()}function K(){for(;Na.length>0;){var b=Na.shift();document.location=b}Z=0}function D(b){for(var m=true,j=Sa.length;j--;)m=m&&b!=Sa[j];return m}function k(b,m){var j=[];for(var e in m)e&&j.push(e+"="+escape(m[e]));return"tile5://"+b+"/"+(j.length>0?"?"+j.join("&"):"")}function n(b,m){D(b)&&COG.info("would push url: "+k(b,m))}function y(b,m){if(D(b)){Na.push(k(b,m));Z||(Z=setTimeout(K,100))}}function E(b){return function(m,j,e){(e?e:b?document.body:
document).addEventListener(m,j,false)}}function h(b){return function(m,j,e){(e?e:b?document.body:document).removeEventListener(m,j,false)}}function H(b,m,j){(j?j:document).attachEvent("on"+b,m)}function G(b,m,j){(j?j:document).detachEvent("on"+b,m)}function L(){Ga={base:{name:"Unknown",bindEvent:E(),unbindEvent:h(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:n,targetFps:null},ie:{name:"MSIE",regex:/msie/i,
bindEvent:H,unbindEvent:G,requireFastDraw:false,targetFps:25},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:y,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:y},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:y},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:E(true),unbindEvent:h(true),supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},
bridgeNotify:y},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:y}};T=[Ga.froyo,Ga.android,Ga.ipod,Ga.iphone,Ga.ipad,Ga.ie]}function ia(){Ga||L();if(!ba){COG.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var b=0;b<T.length;b++){var m=T[b];if(m.regex&&m.regex.test(navigator.userAgent)){ba=COG.extend({},Ga.base,m);COG.info("PLATFORM DETECTED AS: "+ba.name);break}}if(!ba){COG.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
ba=Ga.base}COG.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return ba}function w(){for(var b=0,m=arguments.length;m--;){var j=Hb[arguments[m].toUpperCase()];if(j)b|=j}return b}function B(b,m){var j,e;if(m&&m.width>0){if(!b.imageOffset)b.imageOffset=o.init(-m.width>>1,-m.height>>1);if(!b.bounds){j=b.xy.x+b.imageOffset.x;e=b.xy.y+b.imageOffset.y;b.bounds=oa.init(j,e,j+m.width,e+m.height)}}}function M(b){var m=0,j=1,e=0,i=0;COG.extend(b,{rotate:function(p){m=p},scale:function(p){j=p},
translate:function(p,l){e=p;i=l},transform:function(p,l,z){p.save();p.translate(b.xy.x-l+e,b.xy.y-z+i);m!==0&&p.rotate(m);j!==1&&p.scale(j,j)}})}window.animFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b){setTimeout(function(){b((new Date).getTime())},1E3/60)}}();var da=Math.PI*2,Y=Math.PI/2,ta=Math.abs,ya=Math.ceil,fa=Math.min,wa=Math.max,xa=Math.pow,
Fa=Math.sqrt,Ca=Math.log,la=Math.round,aa=Math.sin,qa=Math.asin,V=Math.cos,ea=Math.atan,Aa=Math.atan2,o=function(){function b(e,i){return j(e.x-i.x,e.y-i.y)}function m(e,i){if(!i)i=e.length;if(i<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var p={edges:Array(i-1),accrued:Array(i-1),total:0},l=0;l<i-1;l++){var z=b(e[l],e[l+1]);p.edges[l]=Fa(z.x*z.x+z.y*z.y);p.accrued[l]=p.total+p.edges[l];p.total+=p.edges[l]}return p}function j(e,i){return{x:e?e:0,y:i?
i:0}}return{VECTOR_SIMPLIFICATION:3,SIMPLIFICATION_MIN_VECTORS:25,add:function(){for(var e=0,i=0,p=arguments.length;p--;){e+=arguments[p].x;i+=arguments[p].y}return j(e,i)},absSize:function(e){return wa(ta(e.x),ta(e.y))},copy:function(e){return e?j(e.x,e.y):null},diff:b,distance:function(e,i){return m(e,i).total},edges:m,equals:function(e,i){return e.x===i.x&&e.y===i.y},extendBy:function(e,i,p){var l=V(i)*p;i=aa(i)*p;return j(e.x-l,e.y-i)},floor:function(e){for(var i=Array(e.length),p=e.length;p--;)i[p]=
j(~~e[p].x,~~e[p].y);return i},getRect:function(e){for(var i,p,l,z,J=e.length;J--;){var u=e[J];i=typeof i==="undefined"||u.x<i?u.x:i;p=typeof p==="undefined"||u.y<p?u.y:p;l=typeof l==="undefined"||u.x>l?u.x:l;z=typeof z==="undefined"||u.y>z?u.y:z}return oa.init(i,p,l,z)},init:j,invert:function(e){return j(-e.x,-e.y)},min:function(e,i){return j(e.x<i.x?e.x:i.x,e.y<i.y?e.y:i.y)},max:function(e,i){return j(e.x>i.x?e.x:i.x,e.y>i.y?e.y:i.y)},offset:function(e,i,p){return j(e.x+i,e.y+(p?p:i))},scale:function(e,
i){return j(e.x/i|0,e.y/i|0)},simplify:function(e,i){if(!e)return null;i=i?i:o.VECTOR_SIMPLIFICATION;for(var p=[],l=null,z=e.length;z--;){var J=e[z];if(include=!l||z===0||ta(J.x-l.x)+ta(J.y-l.y)>i){p.unshift(J);l=J}}return p},theta:function(e,i,p){p=qa((e.y-i.y)/p);return e.x>i.x?p:Math.PI-p},toString:function(e){return e?e.x+", "+e.y:""}}}(),va=function(){return{dotProduct:function(b,m){return b.x*m.x+b.y*m.y}}}(),oa=function(){function b(j){return m(j.x1,j.y1,j.x2,j.y2)}function m(j,e,i,p){j=j?
j:0;e=e?e:0;i=typeof i!=="undefined"?i:j;p=typeof p!=="undefined "?p:p;return{x1:j,y1:e,x2:i,y2:p,width:i-j,height:p-e}}return{center:function(j){return o.init(j.x1+(j.width>>1),j.y1+(j.height>>1))},copy:b,diagonalSize:function(j){return Fa(j.width*j.width+j.height*j.height)},fromCenter:function(j,e,i,p){i=i>>1;p=p>>1;return m(j-i,e-p,j+i,e+p)},init:m,intersect:function(j,e){var i=wa(j.x1,e.x1),p=wa(j.y1,e.y1),l=fa(j.x2,e.x2),z=fa(j.y2,e.y2);i=m(i,p,l,z);return i.width>0&&i.height>0?i:null},toString:function(j){return j?
"["+j.x1+", "+j.y1+", "+j.x2+", "+j.y2+"]":""},union:function(j,e){if(j.width===0||j.height===0)return b(e);else if(e.width===0||e.height===0)return b(j);else{var i=fa(j.x1,e.x1),p=fa(j.y1,e.y1),l=wa(j.x2,e.x2),z=wa(j.y2,e.y2);i=m(i,p,l,z);return i.width>0&&i.height>0?i:null}}}}(),Ra=function(){return{getAspectRatio:function(b){return b.height!==0?b.width/b.height:1},getCenter:function(b){return o.init(b.width>>1,b.height>>1)},getSize:function(b){return Fa(xa(b.width,2)+xa(b.height,2))},init:function(b,
m){b=b?b:0;return{width:b,height:m?m:b}}}}();Hits=function(){return{diffHits:function(b,m){var j=[],e={},i;for(i=m.length;i--;)e[m[i].target.id]=true;for(i=b.length;i--;)e[b[i].target.id]||(j[j.length]=b[i]);return j},init:function(b,m,j,e){return{type:b,x:e.x|0,y:e.y|0,elements:[],absXY:m,relXY:j}},initHit:function(b,m,j){return j=COG.extend({type:b,target:m,drag:false},j)},triggerEvent:function(b,m,j,e){m.triggerCustom(b.type+(j?j:"Hit"),{hitType:b.type},e?e:b.elements,b.absXY,b.relXY,o.init(b.x,
b.y))}}}();var Ga=null,T=[],ba=null,Z=0,Na=[],Sa=["view.wake","tile.loaded"],Oa=function(){function b(){var r=ia().maxImageLoads;if(!r||x.length<r){var P=u.shift();r=T5.ticks();if(P){x[x.length]=P;P.image.onload=j;P.image.src=P.url;P.requested=r}if(r-ma>p){P=false;for(var ca=0,U=ia();ca<x.length;)if(r-x[ca].requested>$.loadTimeout*1E3){x.splice(ca,1);P=true}else ca++;P&&b();if(U&&U.imageCacheMaxSize){R=F.length*$.avgImageSize/U.imageCacheMaxSize;R>=1&&m()}ma=r}}}function m(){sa=true;try{var r=F.length>>
1;if(r>0){F.sort(function(ca,U){return ca.created-U.created});for(var P=r;P--;)delete l[F[P].url];F.splice(0,r)}}finally{sa=false}$.trigger("cacheCleared")}function j(){var r=z[this.id],P;if(r&&r.image.complete&&r.image.width>0){r.loaded=true;r.hitCount=1;for(P=x.length;P--;)if(x[P].image.src==this.src){x.splice(P,1);break}if(r.background||r.postProcess||r.drawBackground||r.customDraw)if(r.image){globalImageData=r;P=i(r.realSize?r.realSize.width:r.image.width,r.realSize?r.realSize.height:r.image.height);
var ca=P.getContext("2d"),U=r.offset?r.offset:T5.XY.init();r.background&&ca.drawImage(r.background,0,0);r.drawBackground&&r.drawBackground(ca);r.customDraw?r.customDraw(ca,r):ca.drawImage(r.image,U.x,U.y);r.postProcess&&r.postProcess(ca,r);r.image=P}for(P=r.callbacks.length;P--;)r.callbacks[P]&&r.callbacks[P](this,false);r.callbacks=[];F[F.length]={url:this.src,created:r.requested};delete z[this.id];b()}}function e(r,P,ca){var U=l[r];if(U){U.hitCount++;U.image.complete&&U.image.width>0&&P?P(U.image,
true):U.callbacks.push(P)}else{U=COG.extend({url:r,image:new Image,loaded:false,created:T5.ticks(),requested:null,hitCount:0,callbacks:[P]},ca);U.image.id="resourceLoaderImage"+J++;l[r]=U;z[U.image.id]=U;u[u.length]=U;b()}return U}function i(r,P){var ca=document.createElement("canvas");COG.info("creating new canvas");ca.width=r?r:0;ca.height=P?P:0;if(typeof FlashCanvas!="undefined"){document.body.appendChild(ca);FlashCanvas.initElement(ca)}return ca}var p=1E4,l={},z={},J=0,u=[],x=[],F=[],R=0,ma=0,
sa=false,$={avgImageSize:25,loadTimeout:10,cancelLoad:function(){var r;for(r=x.length;r--;)delete l[x[r].url];x=[];for(r=u.length;r--;)delete l[u[r].url];u=[]},get:function(r,P,ca){var U=null,Ta=null;sa||(U=l[r]);if((Ta=U?U.image:null)&&(Ta.getContext||Ta.complete&&Ta.width>0))return Ta;else P&&e(r,P,ca);return null},load:e,newCanvas:i,reset:function(){l={}},stats:function(){return{imageLoadingCount:x.length,queuedImageCount:u.length,imageCacheFullness:R}}};COG.observable($);return $}(),gb=function(){var b=
{};return{init:function(m,j){var e=b[m];if(!e)throw Error("Unable to locate requested generator: "+m);return new e(j)},register:function(m,j){b[m]=j},Template:function(){}}}(),ib=function(){function b(l,z){i[l]=j(z);return l}function m(l){for(var z in l)b(z,l[z])}function j(l){function z(F){var R=l[F];typeof R!=="undefined"&&u.push(function(ma){ma[F]=R})}function J(){u=[];for(var F in l)z(F)}l=COG.extend({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,
fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},l);var u=[],x={applyToContext:function(F){for(var R=u.length;R--;)u[R](F)},update:function(F,R){l[F]=R;J()}};J();return x}var e={},i={},p={apply:function(l,z){var J=i[z]?i[z]:i.basic,u;if(l&&l.canvas){u=e[l.canvas.id];e[l.canvas.id]=z}J.applyToContext(l);return u},define:b,defineMany:m,get:function(l){return i[l]},init:j,load:function(l){COG.jsonp(l,function(z){m(z)})}};m({basic:{lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"},
waypoints:{lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"},waypointsHover:{lineWidth:4,strokeStyle:"#f00",fillStyle:"#FFF"}});return p}(),Hb={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,ZOOM:16,FREEZE:128},Fb=function(b){function m(t,v,C){Wa||Xa(d-v,f-C)}function j(t,v,C,ha){bb(fa(wa(Da+xa(2,ha)-1,0.5),2))}function e(){var t=Ca(Da)/Math.LN2|0;if(t!==0){Da=xa(2,t);mb(jb+t,nb,ob)}U()}function i(t){t||(t=o.init(S,N));W=o.init(d,f);ga=o.offset(t,d,f);nb=ga.x;ob=ga.y}function p(t,v){var C=1/Da;
return o.init(ua.x1+t*C,ua.y1+v*C)}function l(t,v,C){Ka("doubleTap",v,C,p(C.x,C.y));b.scalable&&bb(2,C,b.zoomEasing,null,b.zoomDuration)}function z(t,v,C){Wa=null;ca("down",v,C)}function J(t,v,C){ca("hover",v,C)}function u(t,v,C){r(v,C,false)}function x(t,v,C){r(v,C,true)}function F(){clearTimeout(Bb);Bb=setTimeout(ma,250)}function R(t,v,C){ca("tap",v,C);Ka("tap",v,C,p(C.x,C.y,true))}function ma(t,v){var C;$a=typeof FlashCanvas!=="undefined";COG.info("is flash = "+$a);if(Ea){if(b.autoSize&&Ea.parentNode){t=
Ea.parentNode.offsetWidth;v=Ea.parentNode.offsetHeight}try{if(!Ea.id)Ea.id=b.id+"_canvas";Ha=Ea.getContext("2d")}catch(ha){COG.exception(ha);throw Error("Could not initialise canvas on specified view element");}if(t&&v&&(Pa!==v||Qa!==t)){sb=true;Qa=t;Pa=v;S=Qa>>1;N=Pa>>1;Ba.trigger("resize",Qa,Pa);for(C=La;C--;)ra[C].trigger("resize",Qa,Pa)}for(C=La;C--;)ra[C].trigger("contextChanged",Ha);U();$()}}function sa(t,v){v.setId(t);v.added=ka();v.bind("remove",function(){Ba.removeLayer(t)});v.trigger("contextChanged",
Ha);v.setParent(Ba);ra.push(v);ra.sort(function(C,ha){var na=ha.zindex-C.zindex;if(na===0)na=ha.added-C.added;return na});La=ra.length;return v}function $(){Ua&&Ua.unbind();Ua=INTERACT.watch(Ea);b.pannable&&Ua.pannable().bind("pan",m);if(b.scalable){Ua.bind("zoom",j);Ua.bind("doubleTap",l)}Ua.bind("pointerDown",z);Ua.bind("pointerMove",u);Ua.bind("pointerUp",x);b.captureHover&&Ua.bind("pointerHover",J);Ua.bind("tap",R)}function r(t,v,C){if(Wa){t=p(v.x,v.y);Wa.drag.call(Wa.target,Wa,t.x,t.y,C)&&U();
if(C)Wa=null}}function P(t){var v,C=false;if(tb|$a){cb=Cb|(Da!==1?Db:0)|(d!==q||f!==s?ub:0)|(vb?wb:0);za=(v=(cb&(Db|ub))!==0)&&(cb&wb)===0;if(sb&&Ea){$a&&FlashCanvas.initElement(Ea);Ea.width=Qa;Ea.height=Pa;Ea.style.width=Qa+"px";Ea.style.height=Pa+"px";sb=false}X=Ta();for(var ha=La;ha--;){cb|=ra[ha].animated?wb:0;ra[ha].cycle(t,X,cb);C=ra[ha].clip||C}ha=cb;var na=X;v=I&&C&&!v;var Ia;oa.center(na);C=0;var Va;if(Da!==1){Va=1/Da;nb=ga.x+(d-W.x);ob=ga.y+(f-W.y);Va=na?oa.fromCenter(nb>>0,ob>>0,na.width*
Va>>0,na.height*Va>>0):void 0}else Va=oa.copy(na);ua=Va;v||Ha.clearRect(0,0,Qa,Pa);ua.scaleFactor=Da;Ha.save();try{Da!==1&&Ha.scale(Da,Da);Ya=db=null;if(v){Ha.beginPath();for(C=La;C--;)ra[C].clip&&ra[C].clip(Ha,ua,ha,Ba,t);Ha.closePath();Ha.clip()}Ha.globalCompositeOperation="source-over";for(C=La;C--;){Ia=ra[C];if(Ia.shouldDraw(cb,X)){var Ma=Ia.style,ab=Ma?ib.apply(Ha,Ma):null;Ia.draw(Ha,ua,ha,Ba,t,O);ab&&ib.apply(Ha,ab)}}}finally{Ha.restore()}tb=0;Ka("drawComplete",na,t);if(O){Ia=O?O.elements:[];
if(kb&&kb.type==="hover"){Ma=Hits.diffHits(kb.elements,Ia);Ma.length>0&&Hits.triggerEvent(kb,Ba,"Out",Ma)}if(Ia.length>0){ab=O.x;ha=O.y;for(Ma=Ia.length;Ma--;){na=Ia[Ma];v=ab;C=ha;if(Va=na&&na.drag&&(!na.canDrag||na.canDrag(na,v,C))){Wa=na;Wa.startX=v;Wa.startY=C}if(Va)break}Hits.triggerEvent(O,Ba)}kb=Ia.length>0?COG.extend({},O):null;O=null}t-Eb>xb&&pa();Ib=t;q=d;s=f;animFrame(P)}else ja=false}function ca(t,v,C){O=Hits.init(t,v,C,p(C.x,C.y,true));for(t=La;t--;)lb=lb||(ra[t].hitGuess?ra[t].hitGuess(O.x,
O.y,cb,Ba):false);lb&&U()}function U(){tb+=1;if(!ja){ja=true;animFrame(P)}}function Ta(){return oa.init(d,f,d+Qa,f+Pa)}function pa(){if(a||c){var t=g?d+S:d,v=A?f+N:f;if(a&&a>Qa)if(t+Qa>a)d=g?t-a>0?d-a:d:a-Qa;else if(t<0)d=g?d+a:0;if(c&&c>Pa)if(v+Pa>c)f=A?v-c>0?f-c:f:c-Pa;else if(v<0)f=A?f+c:0}Eb=(new Date).getTime();Ka("refresh",Ba,Ta());U()}function bb(t,v,C,ha,na){if(C)COG.tweenValue(Da,t,C,na,function(Ia,Va){Da=Ia;if(Va){var Ma=la(Ca(Da)/Math.LN2);Da=xa(2,Ma);ha&&ha()}i(v);e()});else{Da=t;i(v);
e()}return Ba}function mb(t,v,C){t=wa(b.minZoom,fa(b.maxZoom,t));if(t!==jb){var ha=xa(2,t-jb),na=S/ha|0,Ia=N/ha|0;jb=t;Xa(((v?v:d+S)-na)*ha,((C?C:f+N)-Ia)*ha);q=d;s=f;Ka("zoomLevelChange",t);Da=1;pa()}}function Ka(){for(var t=Ba.trigger.apply(null,arguments).cancel,v=ra.length;v--;)t=ra[v].trigger.apply(null,arguments).cancel||t;return!t}function Xa(t,v,C,ha,na){function Ia(){Va+=1;if(Va>=2){vb=false;na&&na()}}var Va=0,Ma=db?o.offset(db,-S,-N):null,ab=Ya?o.offset(Ya,-S,-N):null;if(Ma){t=t<Ma.x?Ma.x:
t;v=v<Ma.y?Ma.y:v}if(ab){t=t>ab.x?ab.x:t;v=v>ab.y?ab.y:v}if(C){if((cb&ub)===0){COG.tweenValue(d,t,C,ha,function(yb,zb){d=yb|0;(zb?Ia:U)();return!za});COG.tweenValue(f,v,C,ha,function(yb,zb){f=yb|0;(zb?Ia:U)();return!za});vb=true}}else{d=t|0;f=v|0;U();na&&na()}}b=COG.extend({id:COG.objId("view"),container:"",captureHover:true,captureDrag:false,fastDraw:false,inertia:true,minRefresh:1E3,pannable:false,clipping:true,scalable:false,panAnimationEasing:COG.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,
autoSize:true,tapExtent:10,guides:false,turbo:false,fps:25,minZoom:1,maxZoom:1,zoomEasing:COG.easing("quad.out"),zoomDuration:300,zoomLevel:1},b);var ra=[],La=0,Ea=document.getElementById(b.container),Wa=null,Ha=null,pb=typeof window.attachEvent!="undefined",$a,lb=false,xb=b.minRefresh,d=0,f=0,q=0,s=0,a=null,c=null,g=false,A=false,I=b.clipping,X=null,ja=false,ua,Ja=1,S=0,N=0,O=null,W=null,ga=null,za=false,db=null,Ya=null,Eb=0,kb=null,Bb=0,Da=1,Ib=0,sb=false,Ua=null,vb=false,Pa,Qa,tb=0,nb,ob,jb=b.zoomLevel,
Cb=w("ACTIVE"),ub=w("PAN"),Db=w("ZOOM"),wb=w("ANIMATING"),cb=Cb,Ba={id:b.id,deviceScaling:Ja,fastDraw:b.fastDraw||ia().requireFastDraw,detach:function(){Ua&&Ua.unbind()},eachLayer:function(t){for(var v=La;v--;)t(ra[v])},getDimensions:function(){return Ra.init(Qa,Pa)},getLayer:function(t){for(var v=0;v<La;v++)if(ra[v].getId()==t)return ra[v];return null},getZoomLevel:function(){return jb},setLayer:function(t,v){for(var C=0;C<La;C++)if(ra[C].getId()===t){ra.splice(C,1);break}if(v){sa(t,v);v.trigger("refresh",
Ba,Ta())}U();return v},invalidate:U,refresh:pa,resetScale:function(){Da=1},resize:function(t,v){if(Ea){b.autoSize=false;if(Qa!==t||Pa!==v)ma(t,v)}},scale:bb,setZoomLevel:mb,syncXY:function(){},triggerAll:Ka,removeLayer:function(t){a:{for(var v=La;v--;)if(ra[v].getId()==t){t=v;break a}t=-1}if(t>=0&&t<La){Ba.trigger("layerRemoved",ra[t]);ra.splice(t,1);U()}La=ra.length},getOffset:function(){return o.init(d,f)},setMaxOffset:function(t,v,C,ha){a=t;c=v;g=typeof C!="undefined"?C:false;A=typeof ha!="undefined"?
ha:false},getViewRect:Ta,updateOffset:Xa,pan:function(t,v,C,ha,na){Xa(d+t,f+v,C,ha,na)}};Ja=ia().getScaling();COG.observable(Ba);Ba.bind("invalidate",function(){U()});Ba.bind("resync",function(){Ya=db=null});COG.configurable(Ba,["container","captureHover","captureDrag","scalable","pannable","inertia","minZoom","maxZoom","zoom"],COG.paramTweaker(b,null,{container:function(t,v){Ea=document.getElementById(v);ma()},inertia:$,captureHover:$,scalable:$,pannable:$}),true);CANI.init(function(t){Ba.markers=
sa("markers",new qb({zindex:20}));canvasCaps=t.canvas;ma();if(b.autoSize)pb?window.attachEvent("onresize",F):window.addEventListener("resize",F,false)});return Ba},Ab=function(b){b=COG.extend({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:w("ACTIVE","ANIMATING","PAN","ZOOM"),style:null,minXY:null,maxXY:null},b);var m=null,j=false,e=false,i=b.id,p=w("ACTIVE"),l=b.validStates,z=0,J=0,u=COG.extend({addToView:function(x){x.setLayer(i,u)},shouldDraw:function(x){return(x&l)!==0},clip:null,
cycle:function(){},draw:function(){},hitGuess:null,remove:function(){u.trigger("remove",u)},changed:function(){e=true;m&&m.invalidate()},hitTest:null,getId:function(){return i},setId:function(x){i=x},getParent:function(){return m},setParent:function(x){j=(m=x)?m.fastDraw&&displayState!==p:false;u.trigger("parentChange",m)}},b);COG.observable(u);u.bind("drawComplete",function(x,F){e=false;z=F.x1;J=F.y1});u.bind("resync",function(x,F){u.minXY&&F.syncXY(u.minXY);u.maxXY&&F.syncXY(u.maxXY)});return u},
eb=function(b){b=COG.extend({style:null,xy:null,fill:false,draggable:false,observable:true,properties:{},type:"shape",transformable:false},b);COG.extend(this,b);this.id=COG.objId(this.type);this.bounds=null;this.observable&&COG.observable(this);this.transformable&&M(this)};eb.prototype={constructor:eb,drag:null,draw:function(b){this.fill&&b.fill();b.stroke()},prepPath:function(){},resync:function(b){this.xy&&b.syncXY([this.xy])},updateBounds:function(b,m){this.bounds=b;if(m)this.xy=oa.center(this.bounds)}};
var fb=function(b,m){m=COG.extend({simplify:false},m);var j=false,e=m.simplify;w("ZOOM");var i=[];m.type=m.fill?"polygon":"line";eb.call(this,m);COG.extend(this,{prepPath:function(p,l,z){if(j){var J=true;p.beginPath();for(var u=i.length;u--;){var x=i[u].x-l,F=i[u].y-z;if(J){p.moveTo(x,F);J=false}else p.lineTo(x,F)}}return j},resync:function(p){var l,z,J,u,x;p.syncXY(b);i=o.floor(e?o.simplify(b):b);for(var F=i.length;F--;){p=i[F].x;l=i[F].y;u=typeof u=="undefined"||p<u?p:u;x=typeof x=="undefined"||
l<x?l:x;z=typeof z=="undefined"||p>z?p:z;J=typeof J=="undefined"||l>J?l:J}this.updateBounds(oa.init(u,x,z,J),true)}});j=b&&b.length>=2};fb.prototype=new eb;fb.prototype.constructor=fb;var Gb=function(b,m){m.fill=false;fb.call(this,b,m)};Gb.prototype=new fb;var hb=function(b){function m(J){if(this.imageUrl=J)l=Oa.get(this.imageUrl,function(u){var x=z.layer?z.layer.getParent():null;l=u;x&&x.invalidate()})}b=COG.extend({image:null,imageUrl:null,imageOffset:null},b);var j=null,e=eb.prototype.updateBounds,
i,p,l=b.image;eb.call(this,b);var z=COG.extend(this,{changeImage:m,drag:function(J,u,x,F){j||(j=o.init(J.startX-this.xy.x,J.startY-this.xy.y));this.xy.x=u-j.x;this.xy.y=x-j.y;if(F){j=null;if(this.layer)(J=this.layer.getParent())&&J.syncXY([this.xy],true);this.trigger("dragDrop")}return true},draw:function(J){J.drawImage(l,i,p)},prepPath:function(J,u,x){var F=l&&l.width>0;if(F){B(this,l);i=this.xy.x+this.imageOffset.x-u;p=this.xy.y+this.imageOffset.y-x;COG.info("draw x = "+i+", image offset x = "+
this.imageOffset.x+", view offset x = "+u);J.beginPath();J.rect(i,p,l.width,l.height)}return F},updateBounds:function(J,u){e.call(this,J,u);B(this,l)}});l||m(this.imageUrl)};hb.prototype=new eb;hb.prototype.constructor=hb;var rb=function(b){b=COG.extend({imageAnchor:null},b);if(b.imageAnchor)b.imageOffset=o.invert(b.imageAnchor);hb.call(this,b)};rb.prototype=new hb;rb.prototype.constructor=rb;var qb=function(b){function m(l){for(var z=e.length;z--;)e[z].resync(l);e.sort(function(J,u){var x=u.xy.y-
J.xy.y;return x!=0?x:u.xy.x-J.xy.y});p.changed()}function j(l,z){m(z)}b=COG.extend({zindex:10},b);var e=[],i=CANI.canvas.pipTransformed,p=COG.extend(new Ab(b),{add:function(l){if(l){l.layer=p;var z=p.getParent();if(z){l.resync(p.getParent());z.invalidate()}e[e.length]=l}},clear:function(){e=[]},draw:function(l,z,J,u,x,F){u=z.x1;x=z.y1;var R=F?i?F.x-u:F.relXY.x:0,ma=F?i?F.y-x:F.relXY.y:0,sa=z.width;z=z.height;for(var $=e.length;$--;){var r=e[$],P=r.style,ca;if(r.transform){r.transform(l,u,x);if(i){R-=
r.xy.x;ma-=r.xy.y}}if(r.prepPath(l,r.transform?r.xy.x:u,r.transform?r.xy.y:x,sa,z,J)){if(F&&l.isPointInPath(R,ma)){F.elements.push(Hits.initHit(r.type,r,{drag:r.draggable?r.drag:null}));ca=F.type+"Style";P=r[ca]||p[ca]||P}P=P?ib.apply(l,P):null;r.draw(l,u,x,sa,z,J);P&&ib.apply(l,P)}r.transform&&l.restore()}},hitGuess:function(l,z){for(var J=false,u=e.length;!J&&u--;){var x=e[u].bounds;J=J||x&&l>=x.x1&&l<=x.x2&&z>=x.y1&&z<=x.y2}return J}});p.bind("parentChange",j);p.bind("resync",j);return p},Jb=function(){return{tileSize:256,
init:function(b,m,j,e,i){return COG.extend({x:b,y:m,width:j,height:e},i)}}}();COG.extend(Q,{ex:COG.extend,ticks:ka,getConfig:ia,userMessage:function(b,m,j){Q.trigger("userMessage",b,m,j)},XY:o,XYRect:oa,Dimensions:Ra,Vector:va,Hits:Hits,Images:Oa,Generator:gb,tween:COG.tween,tweenValue:COG.tweenValue,easing:COG.easing,Tween:COG.Tween,Style:ib,viewState:w,View:Fb,ViewLayer:Ab,ImageLayer:function(b,m){function j(u,x,F){for(x=l.length;x--;){var R=l[x],ma=R.x,sa=R.y,$=oa.init(R.x,R.y,R.x+R.width,R.y+
R.height);if(F&&oa.intersect(u,$))($=Oa.get(R.url,function(){J.changed()},z))&&F($,ma,sa,R.width,R.height)}}function e(u){var x=++p,F=J.getParent();i&&i.run(F,u,function(R){if(x==p){l=[].concat(R);F.invalidate()}})}m=COG.extend({imageLoadArgs:{}},m);var i=b?gb.init(b,m):null,p=0,l=[],z=m.imageLoadArgs,J=COG.extend(new Ab(m),{changeGenerator:function(u,x){i=gb.init(u,COG.extend({},m,x));l=null;e(J.getParent().getViewRect())},clip:function(u,x,F){var R=x.x1,ma=x.y1;j(x,F,function(sa,$,r,P,ca){u.rect($-
R,r-ma,P,ca)})},draw:function(u,x,F){var R=x.x1,ma=x.y1;j(x,F,function(sa,$,r){u.drawImage(sa,$-R,r-ma,sa.width,sa.height)})},mask:function(u,x,F){j(x,F,function(R,ma,sa,$,r){COG.info("clearing rect @ x = "+ma+", y = "+sa+", width = "+$+", height = "+r);u.clearRect(ma,sa,$,r)})}});J.bind("refresh",function(u,x,F){e(F)});J.bind("tap",function(u,x,F,R){u=[];var ma=R.x,sa=R.y,$,r;if(l)for(var P=l.length;P--;){$=l[P];if(r=ma>=$.x&&ma<=$.x+$.width&&sa>=$.y&&sa<=$.y+$.height)u[u.length]=$}u.length>0&&J.trigger("tapImage",
u,x,F,R)});return J},ImageGenerator:function(b){b=COG.extend({relative:false,padding:2},b);b={run:function(){COG.warn("running base generator - this should be overriden")}};COG.observable(b);return b},Drawable:eb,Poly:fb,Line:Gb,ImageDrawable:hb,ImageMarker:rb,ShapeLayer:qb,transformable:M,Tiling:Jb});COG.observable(Q);var Za=Q.Geo=function(){function b(d){for(var f=null,q=1;!f&&q<arguments.length;q++)f=p(d,arguments[q]);f=f?f:p(d);if(!f)throw Error("Unable to find GEO engine with "+d+" capability");
return f}function m(d){d=parseFloat(d)*F;d=aa(d);var f=r*d;return Ca((1+d)/(1-d)*xa((1-f)/(1+f),r))/2}function j(d){return parseFloat(d)*F}function e(d){d=xa(Math.E,-d);for(var f=Y-2*ea(d),q=l(f,d),s=0;s<ca&&ta(f-q)>P;){f=q;q=l(f,d);s++}return q*R}function i(d){return d%360*R}function p(d,f){var q=null;for(var s in Xa)if(f){if(s==f&&Xa[s][d]){q=Xa[s];break}}else if(Xa[s][d]){q=Xa[s];break}return q}function l(d,f){var q=r*aa(d);return Y-2*ea(f*xa((1-q)/(1+q),r/2))}function z(d,f,q,s){f=J(f);d.add(s(f,
q));return f.length}function J(d){var f=d?d.length:0,q=Array(f);for(f=f;f--;)q[f]=Za.Position.init(d[f][1],d[f][0]);return Za.Position.vectorize(q,pb)}function u(d,f,q){return new xb(d,f,q)}var x=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],F=Math.PI/180,R=180/Math.PI,ma=Y,sa=-ma,$=-da,r=0.08181919084262157,P=1.0E-7,ca=12,U=null,Ta={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",HWY:"HIGHWAY",MWY:"MOTORWAY"},pa=function(){function d(a){return a?
q(a.lat,a.lon):null}function f(a){return!a||a.lat===0&&a.lon===0}function q(a,c){return{lat:parseFloat(a?a:0),lon:parseFloat(c?c:0)}}function s(a){if(a)if(typeof a.lat!=="undefined")return d(a);else{if(a.split)for(var c=[" ",","],g=0;g<c.length;g++){var A=a.split(c[g]);if(A.length===2)return q(A[0],A[1])}}else return q();return null}return{calcDistance:function(a,c){if(f(a)||f(c))return 0;var g=(c.lat-a.lat)*F>>1,A=(c.lon-a.lon)*F>>1;g=aa(g)*aa(g)+V(a.lat*F)*V(c.lat*F)*aa(A)*aa(A);return 6371*2*Aa(Fa(g),
Fa(1-g))},copy:d,empty:f,equal:function(a,c){return a&&c&&a.lat==c.lat&&a.lon==c.lon},fromMercatorPixels:function(a,c){return q(e(c),i(a))},generalize:function(a,c,g){var A=a.length,I=[],X=null;g||(g=250);g/=1E3;COG.info("generalizing positions, must include "+c.length+" positions");for(var ja=A;ja--;)if(ja===0)I.unshift(a[ja]);else{var ua=!X||pa.inArray(a[ja],c)?g:pa.calcDistance(X,a[ja]);if(a[ja]&&ua>=g){I.unshift(a[ja]);X=a[ja]}}COG.info("generalized "+A+" positions into "+I.length+" positions");
return I},inArray:function(a,c){for(var g=pa.equal,A=c.length;A--;)if(g(a,c[A]))return true;return false},inBounds:function(a,c){var g=!(pa.empty(a)||pa.empty(c));return g=(g=g&&a.lat>=c.min.lat&&a.lat<=c.max.lat)&&a.lon>=c.min.lon&&a.lon<=c.max.lon},init:q,offset:function(a,c,g){var A=a.lat*F;a=a.lon*F;c=A+c/6371;g=qa(aa(g/6371)/V(A));g=a+g;c=(c+Y)%Math.PI-Y;g%=da;return q(c*R,g*R)},parse:s,parseArray:function(a){var c=a.length,g=Array(c);for(c=c;c--;)g[c]=s(a[c]);return g},toMercatorPixels:function(a){return T5.XY.init(j(a.lon),
m(a.lat))},toString:function(a){return a?a.lat+" "+a.lon:""},vectorize:function(a,c){function g(){for(var ja=0,ua=c.chunkSize,Ja=A;Ja--;){I[Ja]=T5.GeoXY.init(a[Ja]);ja+=1;if(ja>ua)break}A=Ja;if(A<=0)c.callback&&c.callback(I);else animFrame(g)}var A=a.length,I=Array(A);c=COG.extend({chunkSize:500,async:true,callback:null},c);if(!c.async){for(var X=A;X--;)I[X]=T5.GeoXY.init(a[X]);return I}animFrame(g);return null}}}(),bb=function(){function d(a,c,g){var A=T5.XY.init(0,c.lat-a.lat);if(typeof g==="undefined")g=
true;A.x=g&&a.lon>c.lon?360-a.lon+c.lon:c.lon-a.lon;return A}function f(a,c){return bb.init(pa.init(a.min.lat-c,a.min.lon-c%360),pa.init(a.max.lat+c,a.max.lon+c%360))}function q(a){var c=d(a.min,a.max);return pa.init(a.min.lat+(c.y>>1),a.min.lon+(c.x>>1))}function s(a,c){return{min:pa.parse(a),max:pa.parse(c)}}return{calcSize:d,createBoundsFromCenter:function(a,c){var g=c/6371,A=a.lat*F,I=a.lon*F,X=A-g,ja=A+g;if(X>sa&&ja<ma){A=qa(aa(g)/V(A));g=(I-A)%da;I=(I+A)%da}else{X=wa(X,sa);ja=fa(ja,ma);g=$;
I=da}return bb.init(pa.init(X*R,g*R),pa.init(ja*R,I*R))},expand:f,forPositions:function(a,c){var g=null,A=T5.ticks();c||(c="auto");for(var I=a.length;I--;)if(g){var X=d(g.min,a[I],false),ja=d(a[I],g.max,false);if(X.x<0)g.min.lon=a[I].lon;if(X.y<0)g.min.lat=a[I].lat;if(ja.x<0)g.max.lon=a[I].lon;if(ja.y<0)g.max.lat=a[I].lat}else g=s(a[I],a[I]);if(c){if(c=="auto"){I=d(g.min,g.max);c=wa(I.x,I.y)*0.3}g=f(g,c)}COG.trace("calculated bounds for "+a.length+" positions",A);return g},getCenter:q,getGeoHash:function(a){var c=
T5.Geo.GeoHash.encode(a.min.lat,a.min.lon);a=T5.Geo.GeoHash.encode(a.max.lat,a.max.lon);COG.info("min hash = "+c+", max hash = "+a)},getZoomLevel:function(a,c){var g=q(a);g=fa(la(ta(g.lat)*0.05),x.length);var A=x[g],I=d(a.min,a.max);g=ya(Ca(x[3]*c.height/I.y)/Ca(2));A=ya(Ca(A*c.width/I.x)/Ca(2));return fa(isNaN(g)?1E3:g,isNaN(A)?1E3:A)},init:s,isEmpty:function(a){return!a||pa.empty(a.min)||pa.empty(a.max)},toString:function(a){return"min: "+pa.toString(a.min)+", max: "+pa.toString(a.max)}}}(),mb=
function(){var d=/^(\d+).*$/,f=/(\d+)\s?\-\s?(\d+)/;return{buildingMatch:function(q,s){d.lastIndex=-1;if(d.test(q))for(var a=q.replace(d,"$1"),c=s.split(","),g=0;g<c.length;g++){f.lastIndex=-1;if(f.test(c[g])){var A=f.exec(c[g]);if(a>=parseInt(A[1],10)&&a<=parseInt(A[2],10))return true}else if(a==c[g])return true}return false},normalize:function(q){if(!q)return"";q=q.toUpperCase();if(!U){var s=[];for(var a in Ta)s.push(a);U=RegExp("(\\s)("+s.join("|")+")(\\s|$)","i")}U.lastIndex=-1;if(s=U.exec(q))q=
q.replace(U,"$1"+Ta[s[2]]);return q},toString:function(q){return q.streetDetails+" "+q.location}}}(),Ka=Q.GeoXY=function(){function d(s,a){if(s.length){for(var c,g,A,I,X=s.length;X--;){d(s[X],a);c=typeof c==="undefined"||s.x<c?s.x:c;g=typeof g==="undefined"||s.y<g?s.y:g;A=typeof A==="undefined"||s.x>A?s.x:A;I=typeof I==="undefined"||s.y>I?s.y:I}return oa.init(c,g,I,I)}else if(s.mercXY){c=s.mercXY;s.x=(c.x+Math.PI)/a|0;s.y=(Math.PI-c.y)/a|0;s.rpp=a}else COG.warn("Attempted to sync an XY composite, not a GeoXY");
return s}function f(s,a){if(s.length)for(var c=s.length;c--;)f(s[c],a);else{s.mercXY=o.init(s.x*a-Math.PI,Math.PI-s.y*a);s.pos=pa.fromMercatorPixels(s.mercXY.x,s.mercXY.y)}return s}function q(s,a,c){s.pos=a;s.mercXY=pa.toMercatorPixels(a);(c=typeof c!=="undefined"?c:s.rpp)&&d(s,c)}return{init:function(s,a){var c=o.init();q(c,s,a);return c},sync:d,syncPos:f,toPos:function(s,a){a=a?a:_self.rpp;return pa.fromMercatorPixels(s.x*a-Math.PI,Math.PI-s.y*a)},updatePos:q}}(),Xa={},ra=function(){return{bestResults:function(d,
f){f||(f=20);for(var q=d.length>0?d[0]:null,s=[],a=0;a<d.length;a++)if(q&&d[a]&&q.matchWeight-d[a].matchWeight<=f)s.push(d[a]);else break;return s}}}(),La=function(d){d=COG.extend({id:null,caption:"",resultType:"",data:null,pos:null,matchWeight:0},d);return COG.extend(d,{toString:function(){return d.caption+(d.matchWeight?" ("+d.matchWeight+")":"")}})},Ea=function(){function d(a,c){var g=new T5.ShapeLayer;c.geometry&&pa.vectorize(c.geometry,{callback:function(A){g.add(new T5.Line(A,{style:"waypoints",
simplify:true}));a.setLayer("route",g)}})}function f(a){for(var c=q.Unknown,g=s,A=0;A<g.length;A++){g[A].regex.lastIndex=-1;var I=g[A].regex.exec(a);if(I){c=g[A].customCheck?g[A].customCheck(a,I):g[A].turnType;break}}return c}var q={Unknown:"turn-unknown",Start:"turn-none-start",Continue:"turn-none",Arrive:"turn-none-arrive",TurnLeft:"turn-left",TurnLeftSlight:"turn-left-slight",TurnLeftSharp:"turn-left-sharp",TurnRight:"turn-right",TurnRightSlight:"turn-right-slight",TurnRightSharp:"turn-right-sharp",
Merge:"merge",UTurnLeft:"uturn-left",UTurnRight:"uturn-right",EnterRoundabout:"roundabout-enter",Ramp:"ramp",RampExit:"ramp-exit"},s=function(){var a=[];a.push({regex:/continue/i,turnType:q.Continue});a.push({regex:/(take|bear|turn)(.*?)left/i,customCheck:function(c,g){return/bear/i.test(g[1])?q.TurnLeftSlight:q.TurnLeft}});a.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(c,g){return/bear/i.test(g[1])?q.TurnRightSlight:q.TurnRight}});a.push({regex:/enter\s(roundabout|rotaty)/i,turnType:q.EnterRoundabout});
a.push({regex:/take.*?ramp/i,turnType:q.Ramp});a.push({regex:/take.*?exit/i,turnType:q.RampExit});a.push({regex:/make(.*?)u\-turn/i,customCheck:function(c,g){return/right/i.test(g[1])?q.UTurnRight:q.UTurnLeft}});a.push({regex:/proceed/i,turnType:q.Start});a.push({regex:/arrive/i,turnType:q.Arrive});a.push({regex:/fell\sthrough/i,turnType:q.Merge});return a}();return{calculate:function(a){a=COG.extend({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},a);var c=
b("route");c&&c.route(a,function(g){if(a.generalize)g.geometry=pa.generalize(g.geometry,g.getInstructionPositions());if(a.map){d(a.map,g);a.autoFit&&a.map.gotoBounds(g.boundingBox)}a.success&&a.success(g)})},createMapOverlay:d,parseTurnType:f,TurnType:q,Instruction:function(a){var c=a=COG.extend({position:null,description:"",distance:0,distanceTotal:0,time:0,timeTotal:0,turnType:null},a),g=a.description;g=g.replace(/(\w)(\/)(\w)/g,"$1 $2 $3");c.description=g;if(!a.turnType)a.turnType=f(a.description);
return a},RouteData:function(a){a=COG.extend({geometry:[],instructions:[],boundingBox:null},a);if(!a.boundingBox)a.boundingBox=bb.forPositions(a.geometry);return COG.extend({getInstructionPositions:function(){for(var c=[],g=0;g<a.instructions.length;g++)a.instructions[g].position&&c.push(a.instructions[g].position);return c}},a)}}}(),Wa="featurecollection",Ha="feature",pb={async:false},$a={processor:null,group:"shapes",layerClass:qb},lb={point:COG.extend({},$a,{processor:function(d,f,q,s){f=J([f.coordinates],
pb);if(f.length>0)if(q=s.marker(f[0],q)){d.add(q);return f.length}},group:"markers",layerClass:qb}),linestring:COG.extend({},$a,{processor:function(d,f,q,s){f=J(f&&f.coordinates?f.coordinates:[]);return z(d,f,q,s.line)}}),multilinestring:COG.extend({},$a,{processor:function(d,f,q,s){f=f&&f.coordinates?f.coordinates:[];for(var a=0,c=f.length;c--;)a+=z(d,f[c],q,s.line);return a}}),polygon:COG.extend({},$a,{processor:function(d,f,q,s){f=f&&f.coordinates?f.coordinates:[];if(f.length>0)return z(d,f[0],
q,s.poly);return 0}}),multipolygon:COG.extend({},$a,{processor:function(d,f,q,s){f=f&&f.coordinates?f.coordinates:[];for(var a=0,c=0;c<f.length;c++)a+=z(d,f[c][0],q,s.poly);return a}})},xb=function(d,f,q,s){function a(O,W){var ga=O.processor,za=X+O.group,db=COG.extend({},O,q,{properties:W.properties});if(ga){var Ya=N[za];if(!Ya){Ya=new O.layerClass({id:za});N[za]=Ya}globalLayers=N;return ga(Ya,W.data,db,s)}return 0}function c(O,W){var ga=O&&O.type?O.type.toLowerCase():null;return ga&&ga===Ha?c(O.geometry,
O.properties):{type:ga,isCollection:ga?ga===Wa:false,definition:lb[ga],data:O,properties:W?W:O.properties}}function g(){var O=0,W=ja;if(!Ja){for(;W<ua;W++){var ga=c(I?I(d[W]):d[W]),za=null;if(ga.isCollection){S+=1;Ja=u(ga.data.features,function(db){Ja=null;for(var Ya in db)N[Ya]=db[Ya]},{layerPrefix:X+S+"-"});za+=1}else if(ga.definition)za=a(ga.definition,ga);O+=za?za:1;if(O>=A)break}ja=W+1;if(Ja||ja<ua)animFrame(g);else f&&f(N)}}q=COG.extend({vectorsPerCycle:Za.VECTORIZE_PER_CYCLE,rowPreParse:null,
simplify:false,layerPrefix:"geojson-"},q);s=COG.extend({marker:function(O){return new Marker({xy:O})},line:function(O,W){return new fb(O,W)},poly:function(O,W){return new fb(O,COG.extend({fill:true},W))}},s);var A=q.vectorsPerCycle,I=q.rowPreParse,X=q.layerPrefix,ja=0,ua=0,Ja=null,S=0,N={};if(d){if(typeof d.length==="undefined")d=[d];ua=d.length;animFrame(g)}};Q.GeoJSON={parse:u};Q.Map=function(d){function f(N){try{var O=Za.Position.init(N.coords.latitude,N.coords.longitude),W=N.coords.accuracy/1E3;
S.trigger("locationUpdate",N,W);if(ja){if(!I){I=new Za.UI.LocationOverlay({pos:O,accuracy:W});I.update(S.getTileLayer());S.setLayer("location",I)}var ga=Za.BoundingBox.createBoundsFromCenter(O,Math.max(W,1));S.gotoBounds(ga)}else{I.pos=O;I.accuracy=W;I.update(S.getTileLayer());a(O,null,COG.easing("sine.out"))}ja=false}catch(za){COG.exception(za)}}function q(N){COG.info("caught location tracking error:",N)}function s(N,O,W){S.setZoomLevel(O);a(N,W)}function a(N,O,W,ga){N=Ka.init(N,Za.radsPerPixel(S.getZoomLevel()));
var za=S.getDimensions();S.updateOffset(N.x-(za.width>>1),N.y-(za.height>>1),W,ga,function(){S.refresh();S.trigger("boundsChange",S.getBoundingBox());O&&O(S)})}d=COG.extend({tapExtent:10,crosshair:false,zoomLevel:0,boundsChangeThreshold:30,minZoom:1,maxZoom:18,pannable:true,scalable:true},d);var c={NONE:0,SINGLE:1,WATCH:2},g=o.init(),A=c.NONE,I=null,X=0,ja=true,ua=0,Ja=d.tapExtent;d.adjustScaleFactor=function(N){return Math.pow(2,(N<1?Math.floor:Math.ceil)(Math.log(N)))};var S=COG.extend(new Fb(d),
{getBoundingBox:function(){var N=S.getViewRect();return Za.BoundingBox.init(Ka.toPos(o.init(N.x1,N.y2),ua),Ka.toPos(o.init(N.x2,N.y1),ua))},getCenterPosition:function(){var N=S.getViewRect();if(N){N=o.init(N.x1+(N.width>>1),N.y1+(N.height>>1));return Ka.toPos(N,ua)}return null},gotoBounds:function(N,O){var W=Za.BoundingBox.getZoomLevel(N,S.getDimensions());s(Za.BoundingBox.getCenter(N),W,O)},gotoPosition:s,panToPosition:a,syncXY:function(N,O){return(O?Ka.syncPos:Ka.sync)(N,ua)},locate:function(){S.trackStart(c.SINGLE);
setTimeout(S.trackCancel,1E4)},trackStart:function(N){if(navigator.geolocation&&!X){A=N?N:c.WATCH;ja=true;X=navigator.geolocation.watchPosition(f,q,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3})}},trackCancel:function(){X&&navigator.geolocation&&navigator.geolocation.clearWatch(X);S.removeLayer("location");I=null;A=c.NONE;X=0},animateRoute:function(N,O,W,ga){var za=S.getLayer("route");if(za)(N=za.getAnimation(N,O,W,ga))&&N.addToView(S)}});S.bind("pan",function(){A===c.SINGLE&&S.trackCancel()});
S.bind("tap",function(N,O,W,ga){N=Ka.toPos(ga,ua);var za=Ka.toPos(o.offset(ga,-Ja,Ja),ua);ga=Ka.toPos(o.offset(ga,Ja,-Ja),ua);S.trigger("geotap",O,W,N,bb.init(za,ga))});S.bind("refresh",function(){if(o.absSize(o.diff(g,S.getOffset()))>d.boundsChangeThreshold){g=o.copy(S.getOffset());S.trigger("boundsChange",S.getBoundingBox())}});S.bind("zoomLevelChange",function(N,O){var W;ua=Za.radsPerPixel(O);W=da/ua|0;S.setMaxOffset(W,W,true,false);Oa.cancelLoad();S.resetScale();S.triggerAll("resync",S);S.refresh()});
return S};Q.GeoShape=function(d,f){f=COG.extend({autoParse:true},f);for(var q=Array(d.length),s=f.autoParse,a=T5.Geo.Position.parse,c=d.length;c--;)q[c]=T5.GeoXY.init(s?a(d[c]):d[c]);return new T5.Poly(q,f)};Q.LocationOverlay=function(d){d=COG.extend({pos:null,accuracy:null,zindex:90},d);var f=new Image,q=T5.XY.init(),s=T5.XY.init(),a=null;f.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAACIQAAAiEBPhEQkwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAG+SURBVCiRlZHNahNRAIW/O7mTTJPahLZBA1YUyriINRAE3bQIKm40m8K8gLj0CRQkO32ELHUlKbgoIu4EqeJPgtCaoBuNtjXt5LeTMZk0mbmuWiuuPLsD3+HAOUIpxf9IHjWmaUbEyWv5ROrsVULhcHP761rUfnN3Y2Otc8CIg4YT85lzuVsPP+Qupw1vpPjRCvhS9ymvV0e77x7nNj+uvADQAIQQ+uLyvdfLV9JGZi7EdEwQlqBpEJ019f0z1mo2u5Q8DMydv25lshemmj1FueZTawbs7inarqLbV7Qjab1upB9YlhWSAHLavLHZCvg1VEhN0PMU9W7At4bPVidg7CtkLLXkut+lBPD6/Ub155jJiADAHSpaLmx3ApyBQoYEUd0PBoOBkAC6+3llvda/YxgGgYL+UNHf/zN3KiExGlsvTdP0NYDkhPdWrz35ZDsBzV5wCMuQwEyFmXFeeadjzfuFQmGkAZRKpdGC/n7x+M6jqvA9Zo6FWDhlcHE+wqT93J1tP7vpOE7rrx8ALMuasPf8S12St4WmJ6bYWTUC52k8Hm8Vi0X/nwBAPp/XKpWKdF1X2LYdlMvlsToC/QYTls7DLFr/PAAAAABJRU5ErkJggg%3D%3D";
f.onload=function(){q=T5.XY.init(f.width>>1,f.height>>1)};var c=COG.extend(new T5.ViewLayer(d),{pos:d.pos,accuracy:d.accuracy,drawAccuracyIndicator:false,draw:function(g,A){var I=s.x-A.x,X=s.y-A.y;if(a){g.fillStyle="rgba(30, 30, 30, 0.2)";g.beginPath();g.arc(I,X,a,0,Math.PI*2,false);g.fill()}f.complete&&f.width>0&&g.drawImage(f,I-q.x,X-q.y,f.width,f.height);c.changed()},update:function(g){if(g){a=g.getPixelDistance(c.accuracy)>>1;s=g.getGridXYForPosition(c.pos);c.changed()}}});c.bind("gridUpdate",
function(g,A){c.update(A)});return c};return{distanceToString:function(d){if(d>1E3)return~~(d/10)/100+" km";return d?d+" m":""},dist2rad:function(d){return d/6371},getEngine:b,lat2pix:m,lon2pix:j,pix2lat:e,pix2lon:i,radsPerPixel:function(d){return da/(256<<d)},Position:pa,BoundingBox:bb,Radius:function(d,f){return{distance:parseInt(d,10),uom:f}},Address:function(d){return d=COG.extend({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},d)},A:mb,GeocodeFieldWeights:{streetDetails:50,
location:50},AddressCompareFns:{},Engine:function(d){if(!d.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var f=COG.extend({remove:function(){delete Xa[f.id]}},d);return Xa[f.id]=f},Search:ra,GeoSearchResult:La,LocationSearch:function(d){function f(g,A){navigator.geolocation.clearWatch(s);s=0;if(a){clearTimeout(a);a=0}A&&A([g],d)}function q(g){COG.info("caught location tracking error:",g)}d=COG.extend({name:"Geolocation Search",requiredAccuracy:null,searchTimeout:5E3,
watch:false},d);var s=0,a=0,c=null;return new T5.Geo.GeoSearchAgent(COG.extend({execute:function(g,A){if(navigator.geolocation&&!s){s=navigator.geolocation.watchPosition(function(I){var X=pa.init(I.coords.latitude,I.coords.longitude);I=new La({id:1,caption:"Current Location",pos:X,accuracy:I.coords.accuracy/1E3,matchWeight:100});if(!c||I.accuracy<c.accuracy)c=I;if(!d.requiredAccuracy||c.accuracy<d.requiredAccuracy)f(c,A)},q,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3});if(d.searchTimeout)a=
setTimeout(function(){c&&f(c,A)},d.searchTimeout)}}},d))},Routing:Ea}}()})(T5);
