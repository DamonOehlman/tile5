COG=typeof COG!=="undefined"?COG:{};COG.extend=function(){for(var X=arguments[0]||{},sa,O=1,E=arguments.length;O<E;O++)if((sa=arguments[O])!==null)for(var p in sa){var s=sa[p];if(X!==s)if(s!==undefined)X[p]=s}return X};
(function(){var X=Object.prototype.hasOwnProperty,sa=0,O={};O.toID=function(E){return E.replace(/\s/g,"-")};O.objId=function(E){return(E?E:"obj")+sa++};O.isFunction=function(E){return toString.call(E)==="[object Function]"};O.isArray=function(E){return toString.call(E)==="[object Array]"};O.isPlainObject=function(E){if(!E||toString.call(E)!=="[object Object]"||E.nodeType||E.setInterval)return false;if(E.constructor&&!X.call(E,"constructor")&&!X.call(E.constructor.prototype,"isPrototypeOf"))return false;
var p;for(p in E);return p===undefined||X.call(E,p)};O.isEmptyObject=function(E){for(var p in E)return false;return true};O.isXmlDocument=function(E){return toString.call(E)==="[object Document]"};O.contains=function(E,p){var s=E,F=arguments,I=1;if(p&&module.isArray(p)){F=p;I=0}for(I=I;I<F;I++)s=s&&typeof foo[F[I]]!=="undefined";return s};O.formatStr=function(E){if(arguments.length<=1)return E;for(var p=arguments.length-2,s=0;s<=p;s++)E=E.replace(RegExp("\\{"+s+"\\}","gi"),arguments[s+1]);return E};
O.wordExists=function(E,p){var s="";if(p.toString)p=p.toString();for(var F=0;F<p.length;F++)s+=!/\w/.test(p[F])?"\\"+p[F]:p[F];return RegExp("(^|\\s|\\,)"+s+"(\\,|\\s|$)","i").test(E)};COG.extend(COG,O)})();
(function(){function X(s){return typeof console!=="undefined"?function(){console[s](Array.prototype.slice.call(arguments,0).join(" "));return true}:function(){return false}}var sa=window.console&&window.console.markTimeline,O=X("error"),E=X("info"),p=function(){return sa?function(s,F){console.markTimeline(s+(F?": "+((new Date).getTime()-F)+"ms":""))}:function(){}}();COG.extend(COG,{trace:p,debug:X("debug"),info:E,warn:X("warn"),error:O,exception:function(s){if(O)for(var F in s)E("ERROR DETAIL: "+
F+": "+s[F])}})})();
(function(){function X(O,E){var p=O.obsHandlers;p[E]||(p[E]=[]);return p[E]}var sa=0;COG.observable=function(O){if(!O)return null;if(!O.obsHandlers)O.obsHandlers={};if(!(O.bind||O.trigger||O.unbind)){O.bind=function(E,p){var s="callback"+sa++;X(O,E).unshift({fn:p,id:s});return s};O.triggerCustom=function(E,p){var s=X(O,E),F={cancel:false,name:E},I;p&&COG.extend(F,p);if(!s)return null;I=Array.prototype.slice.call(arguments,2);O.eventInterceptor&&O.eventInterceptor(E,F,I);I.unshift(F);for(var o=s.length;o--&&
!F.cancel;)s[o].fn.apply(this,I);return F};O.trigger=function(E){var p=Array.prototype.slice.call(arguments,1);p.splice(0,0,E,null);return O.triggerCustom.apply(this,p)};O.unbind=function(E,p){if(typeof E==="undefined")O.obsHandlers={};else for(var s=X(O,E),F=0;s&&F<s.length;F++)if(s[F].id===p){s.splice(F,1);break}return O}}return O}})();
(function(){function X(p,s){p[s]||(p[s]=function(F){return p.configure(s,F)})}function sa(p){p.gtConfId="configurable"+E++;p.gtConfig={};p.gtConfigFns=[];return p.gtConfig}var O={},E=0;COG.paramTweaker=function(p,s,F){return function(I,o){if(typeof o!=="undefined"){if(I in p)p[I]=o;F&&I in F&&F[I](I,o)}else return s&&I in s?s[I](I):p[I]}};COG.configurable=function(p,s,F,I){if(p){p.gtConfId||sa(p);var o=p.gtConfId,H=p.gtConfig,D=p.gtConfigFns;O[o]=p;D.push(F);for(F=s.length;F--;){H[s[F]]=true;I&&X(p,
s[F])}if(!p.configure)p.configure=function(K,la){if(H[K]){for(var u=D.length;u--;){var x=D[u](K,la);if(typeof x!=="undefined")return x}return O[o]}return null}}}})();
(function(){function X(p){var s=document.createElement("script"),F=false;s.src=p;s.async=true;s.onload=s.onreadystatechange=function(){if(!F&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){F=true;s.onload=s.onreadystatechange=null;s&&s.parentNode&&s.parentNode.removeChild(s)}};O||(O=document.getElementsByTagName("head")[0]);O.appendChild(s)}var sa=0,O,E=this;COG.jsonp=function(p,s,F){p+=p.indexOf("?")>=0?"&":"?";var I="json"+ ++sa;E[I]=function(o){s(o);E[I]=null;try{delete E[I]}catch(H){}};
X(p+(F?F:"callback")+"="+I);return I}})();
(function(){var X=1.70158,sa=Math.PI/2,O=Math.abs,E=Math.pow,p=Math.sin,s=Math.asin,F=Math.cos,I={linear:function(o,H,D,K){return D*o/K+H},backin:function(o,H,D,K){return D*(o/=K)*o*((X+1)*o-X)+H},backout:function(o,H,D,K){return D*((o=o/K-1)*o*((X+1)*o+X)+1)+H},backinout:function(o,H,D,K){return(o/=K/2)<1?D/2*o*o*(((X*=1.525)+1)*o-X)+H:D/2*((o-=2)*o*(((X*=1.525)+1)*o+X)+2)+H},bouncein:function(o,H,D,K){return D-I.bounceout(K-o,0,D,K)+H},bounceout:function(o,H,D,K){return(o/=K)<1/2.75?D*7.5625*o*
o+H:o<2/2.75?D*(7.5625*(o-=1.5/2.75)*o+0.75)+H:o<2.5/2.75?D*(7.5625*(o-=2.25/2.75)*o+0.9375)+H:D*(7.5625*(o-=2.625/2.75)*o+0.984375)+H},bounceinout:function(o,H,D,K){return o<K/2?I.bouncein(o*2,0,D,K)/2+H:I.bounceout(o*2-K,0,D,K)/2+D/2+H},cubicin:function(o,H,D,K){return D*(o/=K)*o*o+H},cubicout:function(o,H,D,K){return D*((o=o/K-1)*o*o+1)+H},cubicinout:function(o,H,D,K){if((o/=K/2)<1)return D/2*o*o*o+H;return D/2*((o-=2)*o*o+2)+H},elasticin:function(o,H,D,K,la,u){if(o==0)return H;if((o/=K)==1)return H+
D;u||(u=K*0.3);if(!la||la<O(D)){la=D;D=u/4}else D=u/TWO_PI*s(D/la);return-(la*E(2,10*(o-=1))*p((o*K-D)*TWO_PI/u))+H},elasticout:function(o,H,D,K,la,u){var x;if(o==0)return H;if((o/=K)==1)return H+D;u||(u=K*0.3);if(!la||la<O(D)){la=D;x=u/4}else x=u/TWO_PI*s(D/la);return la*E(2,-10*o)*p((o*K-x)*TWO_PI/u)+D+H},elasticinout:function(o,H,D,K,la,u){var x;if(o==0)return H;if((o/=K/2)==2)return H+D;u||(u=K*0.3*1.5);if(!la||la<O(D)){la=D;x=u/4}else x=u/TWO_PI*s(D/la);if(o<1)return-0.5*la*E(2,10*(o-=1))*p((o*
K-x)*TWO_PI/u)+H;return la*E(2,-10*(o-=1))*p((o*K-x)*TWO_PI/u)*0.5+D+H},quadin:function(o,H,D,K){return D*(o/=K)*o+H},quadout:function(o,H,D,K){return-D*(o/=K)*(o-2)+H},quadinout:function(o,H,D,K){if((o/=K/2)<1)return D/2*o*o+H;return-D/2*(--o*(o-2)-1)+H},sinein:function(o,H,D,K){return-D*F(o/K*sa)+D+H},sineout:function(o,H,D,K){return D*p(o/K*sa)+H},sineinout:function(o,H,D,K){return-D/2*(F(Math.PI*o/K)-1)+H}};COG.tweenValue=function(o,H,D,K,la){function u(ea){var ca=ea-x,ma=D(ca,o,L,K),ia=x+K<=
ea;ea=!ia;if(la){ca=la(ma,ia,ca);ea=typeof ca!="undefined"?ca&&ea:ea}ea&&animFrame(u)}var x=(new Date).getTime(),L=H-o;animFrame(u);return{}};COG.easing=function(o){return I[o.replace(/[\-\_\s\.]/g,"").toLowerCase()]};COG.registerEasingType=function(o,H){I[o.replace(/[\-\_\s\.]/g,"").toLowerCase()]=H}})();
(function(){var X=/^P(\d+Y)?(\d+M)?(\d+D)?$/,sa=/^(\d+H)?(\d+M)?(\d+S)?$/,O={8601:function(p){p=p.split("T");var s=null;s=null;var F=0,I=0;X.lastIndex=-1;s=X.exec(p[0]);F+=s[3]?parseInt(s[3].slice(0,-1),10):0;sa.lastIndex=-1;s=sa.exec(p[1]);I+=s[1]?parseInt(s[1].slice(0,-1),10)*3600:0;I+=s[2]?parseInt(s[2].slice(0,-1),10)*60:0;I+=s[3]?parseInt(s[3].slice(0,-1),10):0;return new E(F,I)}},E=COG.Duration=function(p,s){return{days:p?p:0,seconds:s?s:0}};COG.addDuration=function(){for(var p=new E,s=arguments.length;s--;){p.days+=
arguments[s].days;p.seconds+=arguments[s].seconds}if(p.seconds>=86400){p.days+=~~(p.seconds/86400);p.seconds%=86400}return p};COG.formatDuration=function(p){var s,F,I="";if(p.days)I=p.days+" days ";if(p.seconds){p=p.seconds;if(p>=3600){s=~~(p/3600);p-=s*3600}if(p>=60){F=Math.round(p/60);p-=F*60}if(s)I=I+s+(s>1?" hrs ":" hr ")+(F?(F>10?F:"0"+F)+" min ":"");else if(F)I=I+F+" min";else if(p>0)I=I+(p>10?p:"0"+p)+" sec"}return I};COG.parseDuration=function(p,s){var F=s?O[s]:null;if(F)return F(p);COG.Log.warn("Could not find duration parser for specified format: "+
s);return new E}})();
INTERACT=function(){function X(u){return function(x,L,ea){(ea?ea:u?document.body:document).addEventListener(x,L,false)}}function sa(u){return function(x,L,ea){(ea?ea:u?document.body:document).removeEventListener(x,L,false)}}function O(u,x,L){(L?L:document).attachEvent("on"+u,x)}function E(u,x,L){(L?L:document).detachEvent("on"+u,x)}function p(u,x){return{x:u?u:0,y:x?x:0,count:1}}function s(u,x){K.push(COG.extend({handler:null,checks:{},type:u},x))}function F(u){var x=0,L=0;if(u.offsetParent){do{x+=u.offsetLeft;
L+=u.offsetTop;u=u.offsetParent}while(u)}return{x:x,y:L}}function I(u,x){return{source:u,target:x.target?x.target:x.srcElement}}function o(u,x){for(var L=u.target?u.target:u.srcElement;L&&L!==x&&L.nodeName&&L.nodeName.toUpperCase()!="CANVAS";)L=L.parentNode;return L&&L===x}function H(u,x){return{x:u.x-(x?x.x:0),y:u.y-(x?x.y:0)}}function D(u){if(u.preventDefault){u.preventDefault();u.stopPropagation()}else u.cancelBubble&&u.cancelBubble()}var K=[],la=function(u,x,L){function ea(aa,oa,ya,Y){var M=0,
ra=0,v=0;COG.tweenValue(0,aa,ya,Y,function(ja){v=M;M=ja});COG.tweenValue(0,oa,ya,Y,function(ja){ca.trigger("pan",M-v,ja-ra);ra=ja})}L=COG.extend({binder:null,unbinder:null,observable:null},L);for(var ca=L.observable,ma=null,ia=[],ua=[],Aa,va,Ma={bind:function(){return ca.bind.apply(null,arguments)},pannable:function(aa){ma=COG.extend({inertia:true},aa);return Ma},unbind:function(){ca.unbind();for(var aa=0;aa<ia.length;aa++)ia[aa].unbind();return Ma}},za=0;za<x.length;za++)ia.push(x[za](u,ca,L));ca.bind("pointerDown",
function(){ua=[];va=Aa=0});ca.bind("pointerMove",function(aa,oa,ya,Y){if(ma){ua[ua.length]={ticks:(new Date).getTime(),x:Y.x,y:Y.y};ca.trigger("pan",Y.x,Y.y)}Aa+=Y.x?Y.x:0;va+=Y.y?Y.y:0});ca.bind("pointerUp",function(aa,oa,ya){if(Math.abs(Aa)>20||Math.abs(va)>20){if(ma){aa=ua;oa=aa.length;var Y;var M=ya=0,ra,v,ja;Y=oa>0?(new Date).getTime()-aa[oa-1].ticks:0;var W;for(W=aa.length;--W>1&&Y<50;)Y+=aa[W].ticks-aa[W-1].ticks;Y=oa-W;if(Y>1){for(;W<oa;W++){ra=aa[W].x-aa[W-1].x;v=aa[W].y-aa[W-1].y;ja=aa[W].ticks-
aa[W-1].ticks;ya+=ra/ja;M+=v/ja}ya=Math.min(ya/Y*500|0,300);M=Math.min(M/Y*500|0,300);ea(ya,M,COG.easing("quad.out"),500)}}}else ca.trigger("tap",oa,ya)});return Ma};s("pointer",{handler:function(u,x,L){function ea(v){if(o(v,u))if(za=ua(v)){u.style.cursor="move";D(v);M=v.pageX?v.pageX:v.screenX;ra=v.pageY?v.pageY:v.screenY;aa=p(M,ra);oa=F(u);x.triggerCustom("pointerDown",I("mouse",v),aa,H(aa,oa))}}function ca(v){ya=v.pageX?v.pageX:v.screenX;Y=v.pageY?v.pageY:v.screenY;if(o(v,u))Aa(v,za?"pointerMove":
"pointerHover")}function ma(v){if(za&&ua(v)){za=false;if(o(v,u)){u.style.cursor="default";Aa(v,"pointerUp")}}}function ia(v){if(o(v,u)){var ja;v=v||window.event;if(v.detail)ja=v.axis===2?-v.detail*va:0;else{ja=v.wheelDeltaY?v.wheelDeltaY:v.wheelDelta;if(window.opera)ja=-ja}if(ja!==0){var W=p(ya,Y);x.triggerCustom("zoom",I("mouse",v),W,H(W,F(u)),ja/Ma,"wheel");D(v);v.returnValue=false}}}function ua(v){v=v||window.event;return(v.which||v.button)==1}function Aa(v,ja,W,Na,Pa){W=typeof W!="undefined"?
W:ya;Na=typeof Na!="undefined"?Na:Y;var R=W-M,fa=Na-ra,Z=p(W,Na);oa||(oa=F(u));x.triggerCustom(ja,I("mouse",v),Z,H(Z,oa),p(R,fa));if(typeof Pa=="undefined"||Pa){M=W;ra=Na}}L=COG.extend({},L);var va=120,Ma=va*8,za=false,aa,oa,ya,Y,M,ra;L.binder("mousedown",ea,false);L.binder("mousemove",ca,false);L.binder("mouseup",ma,false);L.binder("dblclick",function(v){COG.info("captured double click");if(o(v,u)){var ja=p(v.pageX?v.pageX:v.screenX,v.pageY?v.pageY:v.screenY);COG.info("captured double click + target matched");
x.triggerCustom("doubleTap",I("mouse",v),ja,H(ja,F(u)))}},false);L.binder("mousewheel",ia,document);L.binder("DOMMouseScroll",ia,document);return{unbind:function(){L.unbinder("mousedown",ea,false);L.unbinder("mousemove",ca,false);L.unbinder("mouseup",ma,false);L.unbinder("mousewheel",ia,document);L.unbinder("DOMMouseScroll",ia,document)}}},checks:{touch:false}});s("pointer",{handler:function(u,x,L){function ea(R){if(R.count<2)return 0;var fa=R.x-R.next.x;R=R.y-R.next.y;return~~Math.sqrt(fa*fa+R*R)}
function ca(R,fa,Z){fa=fa?fa:0;Z=Z?Z:0;for(var Da={x:R.x-fa,y:R.y-Z,id:R.id,count:R.count},Oa=Da;R.next;){R=R.next;Oa=Oa.next={x:R.x-fa,y:R.y-Z,id:R.id}}return Da}function ma(R,fa){var Z=R[fa?fa:"touches"],Da,Oa;if(Z.length===0)return null;Oa=Da={x:Z[0].pageX,y:Z[0].pageY,id:Z[0].identifier,count:Z.length};for(var Ha=1,hb=Z.length;Ha<hb;Ha++)Oa=Oa.next={x:Z[Ha].pageX,y:Z[Ha].pageY,id:Z[Ha].identifier};return Da}function ia(R){if(o(R,u)){Y=F(u);var fa=ma(R,"changedTouches"),Z=ca(fa,Y.x,Y.y);if(!ra){M=
aa;x.triggerCustom("pointerDown",I("touch",R),fa,Z)}Na&&x.triggerCustom("pointerDownMulti",I("touch",R),fa,Z);ra=ma(R);if(ra.count>1)ja=ea(ra);Pa=1;W=ca(ra)}}function ua(R){if(o(R,u)){R.preventDefault();v=ma(R);if(M==aa)M=Math.abs(ra.x-v.x)>Ma||Math.abs(ra.y-v.y)>Ma?za:aa;if(M!=aa){M=v.count>1?ya:oa;if(M==ya)if(ra.count===1){ra=ca(v);ja=ea(ra)}else{var fa=ea(v);if(Math.abs(ja-fa)<va)M=oa;else{var Z;Z=v.x;var Da=v.next.x,Oa=v.y,Ha=v.next.y,hb=Oa<Ha?Oa:Ha;Z={x:(Z<Da?Z:Da)+(Math.abs(Z-Da)>>1),y:hb+(Math.abs(Oa-
Ha)>>1)};fa=fa/ja;Da=fa-Pa;x.triggerCustom("zoom",I("touch",R),Z,H(Z,Y),Da,"pinch");Pa=fa}}M==oa&&x.triggerCustom("pointerMove",I("touch",R),v,ca(v,Y.x,Y.y),p(v.x-W.x,v.y-W.y));Na&&x.triggerCustom("pointerMoveMulti",I("touch",R),v,ca(v,Y.x,Y.y))}W=ca(v)}}function Aa(R){if(o(R,u)){var fa=ma(R,"changedTouches"),Z=ca(fa,Y.x,Y.y);v=ma(R);if(!v){M===aa&&x.triggerCustom("tap",I("touch",R),fa,Z);x.triggerCustom("pointerUp",I("touch",R),fa,Z);ra=null}Na&&x.triggerCustom("pointerUpMulti",I("touch",R),fa,Z)}}
L=COG.extend({detailed:false,inertia:false},L);var va=20,Ma=7,za=0,aa=1,oa=2,ya=3,Y,M,ra,v,ja,W,Na=L.detailed,Pa=1;L.binder("touchstart",ia,false);L.binder("touchmove",ua,false);L.binder("touchend",Aa,false);COG.info("initialized touch handler");return{unbind:function(){L.unbinder("touchstart",ia,false);L.unbinder("touchmove",ua,false);L.unbinder("touchend",Aa,false)}}},checks:{touch:true}});return{register:s,watch:function(u,x,L){x=COG.extend({bindToBody:false,observable:null,isIE:typeof window.attachEvent!=
"undefined",types:null},x);capabilities=COG.extend({touch:"ontouchstart"in window},L);if(!x.observable){COG.info("creating observable");x.observable=COG.observable({});globalOpts=x}x.binder=x.isIE?O:X(x.bindToBody);x.unbinder=x.isIE?E:sa(x.bindToBody);L=x.types;for(var ea=capabilities,ca=[],ma=K.length;ma--;){var ia=K[ma],ua=!L||L.indexOf(ia.type)>=0,Aa=true;for(var va in ia.checks){var Ma=ia.checks[va];COG.info("checking "+va+" capability. require: "+Ma+", capability = "+ea[va]);Aa=Aa&&Ma===ea[va]}if(ua&&
Aa)ca[ca.length]=ia.handler}return new la(u,ca,x)}}}();
T5=function(){function X(){return(new Date).getTime()}function sa(){for(;fa.length>0;){var c=fa.shift();document.location=c}R=0}function O(c){for(var r=true,f=Z.length;f--;)r=r&&c!=Z[f];return r}function E(c,r){var f=[];for(var b in r)b&&f.push(b+"="+escape(r[b]));return"tile5://"+c+"/"+(f.length>0?"?"+f.join("&"):"")}function p(c,r){O(c)&&COG.info("would push url: "+E(c,r))}function s(c,r){if(O(c)){fa.push(E(c,r));R||(R=setTimeout(sa,100))}}function F(c){return function(r,f,b){(b?b:c?document.body:
document).addEventListener(r,f,false)}}function I(c){return function(r,f,b){(b?b:c?document.body:document).removeEventListener(r,f,false)}}function o(c,r,f){(f?f:document).attachEvent("on"+c,r)}function H(c,r,f){(f?f:document).detachEvent("on"+c,r)}function D(){W={base:{name:"Unknown",bindEvent:F(),unbindEvent:I(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:p,targetFps:null},ie:{name:"MSIE",regex:/msie/i,
bindEvent:o,unbindEvent:H,requireFastDraw:false,targetFps:25},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:s,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:s},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:s},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:F(true),unbindEvent:I(true),supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},
bridgeNotify:s},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:s}};Na=[W.froyo,W.android,W.ipod,W.iphone,W.ipad,W.ie]}function K(){W||D();if(!Pa){COG.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var c=0;c<Na.length;c++){var r=Na[c];if(r.regex&&r.regex.test(navigator.userAgent)){Pa=COG.extend({},W.base,r);COG.info("PLATFORM DETECTED AS: "+Pa.name);break}}if(!Pa){COG.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
Pa=W.base}COG.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return Pa}function la(c,r){function f(j,t){j=j?ia(ma(j,m),d):d;if(j!=b){b=j;c.triggerAll("zoomLevelChange",j,t)}}r=COG.extend({initial:1,minZoom:1,maxZoom:16},r);var b=null,d=r.minZoom,m=r.maxZoom;COG.extend(c,{getZoomLevel:function(){return b},setZoomLevel:f});c.bind("scale",function(j,t,q){f(b+Math.log(t)/Math.LN2,q);c.updateOffset(q.x*t,q.y*t)})}function u(){for(var c=0,r=arguments.length;r--;){var f=hb[arguments[r].toUpperCase()];
if(f)c|=f}return c}window.animFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(){setTimeout(function(){window.callback((new Date).getTime())},1E3/60)}}();var x=Math.PI*2,L=Math.PI/2,ea=Math.abs,ca=Math.ceil,ma=Math.min,ia=Math.max,ua=Math.pow,Aa=Math.sqrt,va=Math.log,Ma=Math.round,za=Math.sin,aa=Math.asin,oa=Math.cos,ya=Math.atan,Y=Math.atan2,M=function(){function c(b,
d){return f(b.x-d.x,b.y-d.y)}function r(b,d){if(!d)d=b.length;if(d<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var m={edges:Array(d-1),accrued:Array(d-1),total:0},j=0;j<d-1;j++){var t=c(b[j],b[j+1]);m.edges[j]=Aa(t.x*t.x+t.y*t.y);m.accrued[j]=m.total+m.edges[j];m.total+=m.edges[j]}return m}function f(b,d){return{x:b?b:0,y:d?d:0}}return{VECTOR_SIMPLIFICATION:3,SIMPLIFICATION_MIN_VECTORS:25,add:function(){for(var b=0,d=0,m=arguments.length;m--;){b+=arguments[m].x;
d+=arguments[m].y}return f(b,d)},absSize:function(b){return ia(ea(b.x),ea(b.y))},copy:function(b){return b?f(b.x,b.y):null},diff:c,distance:function(b,d){return r(b,d).total},edges:r,equals:function(b,d){return b.x===d.x&&b.y===d.y},extendBy:function(b,d,m){var j=oa(d)*m;d=za(d)*m;return f(b.x-j,b.y-d)},floor:function(b){for(var d=Array(b.length),m=b.length;m--;)d[m]=f(~~b[m].x,~~b[m].y);return d},getRect:function(b){for(var d,m,j,t,q=b.length;q--;){var n=b[q];d=typeof d==="undefined"||n.x<d?n.x:
d;m=typeof m==="undefined"||n.y<m?n.y:m;j=typeof j==="undefined"||n.x>j?n.x:j;t=typeof t==="undefined"||n.y>t?n.y:t}return v.init(d,m,j,t)},init:f,invert:function(b){return f(-b.x,-b.y)},min:function(b,d){return f(b.x<d.x?b.x:d.x,b.y<d.y?b.y:d.y)},max:function(b,d){return f(b.x>d.x?b.x:d.x,b.y>d.y?b.y:d.y)},offset:function(b,d,m){return f(b.x+d,b.y+(m?m:d))},simplify:function(b,d){if(!b)return null;d=d?d:M.VECTOR_SIMPLIFICATION;for(var m=[],j=null,t=b.length;t--;){var q=b[t];if(include=!j||t===0||
ea(q.x-j.x)+ea(q.y-j.y)>d){m.unshift(q);j=q}}return m},theta:function(b,d,m){m=aa((b.y-d.y)/m);return b.x>d.x?m:Math.PI-m},toString:function(b){return b.x+", "+b.y}}}(),ra=function(){return{dotProduct:function(c,r){return c.x*r.x+c.y*r.y}}}(),v=function(){function c(f){return r(f.x1,f.y1,f.x2,f.y2)}function r(f,b,d,m){f=f?f:0;b=b?b:0;d=typeof d!=="undefined"?d:f;m=typeof m!=="undefined "?m:m;return{x1:f,y1:b,x2:d,y2:m,width:d-f,height:m-b}}return{center:function(f){return M.init(f.x1+f.width/2,f.y1+
f.height/2)},copy:c,diagonalSize:function(f){return Aa(f.width*f.width+f.height*f.height)},fromCenter:function(f,b,d,m){d=d>>1;m=m>>1;return r(f-d,b-m,f+d,b+m)},init:r,intersect:function(f,b){var d=ia(f.x1,b.x1),m=ia(f.y1,b.y1),j=ma(f.x2,b.x2),t=ma(f.y2,b.y2);d=r(d,m,j,t);return d.width>0&&d.height>0?d:null},toString:function(f){return"["+f.x1+", "+f.y1+", "+f.x2+", "+f.y2+"]"},union:function(f,b){if(f.width===0||f.height===0)return c(b);else if(b.width===0||b.height===0)return c(f);else{var d=ma(f.x1,
b.x1),m=ma(f.y1,b.y1),j=ia(f.x2,b.x2),t=ia(f.y2,b.y2);d=r(d,m,j,t);return d.width>0&&d.height>0?d:null}}}}(),ja=function(){return{getAspectRatio:function(c){return c.height!==0?c.width/c.height:1},getCenter:function(c){return M.init(c.width>>1,c.height>>1)},getSize:function(c){return Aa(ua(c.width,2)+ua(c.height,2))},init:function(c,r){c=c?c:0;return{width:c,height:r?r:c}}}}(),W=null,Na=[],Pa=null,R=0,fa=[],Z=["view.wake","tile.loaded"],Da=function(){function c(){var k=K().maxImageLoads;if(!k||q.length<
k)if(k=t.shift()){q[q.length]=k;k.image.onload=r;k.image.src=k.url;k.requested=T5.ticks()}}function r(){var k=m[this.id],y;if(k&&k.image.complete&&k.image.width>0){k.loaded=true;k.hitCount=1;for(y=q.length;y--;)if(q[y].image.src==this.src){q.splice(y,1);break}if(k.background||k.postProcess||k.drawBackground||k.customDraw)if(k.image){globalImageData=k;y=b(k.realSize?k.realSize.width:k.image.width,k.realSize?k.realSize.height:k.image.height);var P=y.getContext("2d"),S=k.offset?k.offset:T5.XY.init();
k.background&&P.drawImage(k.background,0,0);k.drawBackground&&k.drawBackground(P);k.customDraw?k.customDraw(P,k):P.drawImage(k.image,S.x,S.y);k.postProcess&&k.postProcess(P,k);k.image=y}for(y=k.callbacks.length;y--;)k.callbacks[y]&&k.callbacks[y](this,false);k.callbacks=[];n[n.length]={url:this.src,created:k.requested};delete m[this.id];c()}}function f(k,y,P){var S=d[k];if(S){S.hitCount++;S.image.complete&&S.image.width>0&&y?y(S.image,true):S.callbacks.push(y)}else{S=COG.extend({url:k,image:new Image,
loaded:false,created:T5.ticks(),requested:null,hitCount:0,callbacks:[y]},P);S.image.id="resourceLoaderImage"+j++;d[k]=S;m[S.image.id]=S;t[t.length]=S;c()}return S}function b(k,y){var P=document.createElement("canvas");COG.info("creating new canvas");P.width=k?k:0;P.height=y?y:0;if(typeof FlashCanvas!="undefined"){document.body.appendChild(P);FlashCanvas.initElement(P)}return P}var d={},m={},j=0,t=[],q=[],n=[],w={avgImageSize:25,loadTimeout:10,cancelLoad:function(){var k;for(k=q.length;k--;)delete d[q[k].url];
q=[];for(k=t.length;k--;)delete d[t[k].url];t=[]},get:function(k,y,P){var S=null;S=null;if((S=(S=d[k])?S.image:null)&&(S.getContext||S.complete&&S.width>0))return S;else y&&f(k,y,P);return null},load:f,newCanvas:b,reset:function(){d={}},stats:function(){return{imageLoadingCount:q.length,queuedImageCount:t.length,imageCacheFullness:0}}};COG.observable(w);return w}(),Oa=function(){var c={};return{init:function(r,f){var b=c[r];if(!b)throw Error("Unable to locate requested generator: "+r);return new b(f)},
register:function(r,f){c[r]=f},Template:function(){}}}(),Ha=function(){function c(j,t){d[j]=f(t);return j}function r(j){for(var t in j)c(t,j[t])}function f(j){function t(k){var y=j[k];typeof y!=="undefined"&&n.push(function(P){P[k]=y})}function q(){n=[];for(var k in j)t(k)}j=COG.extend({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},j);var n=[],w={applyToContext:function(k){for(var y=
n.length;y--;)n[y](k)},update:function(k,y){j[k]=y;q()}};q();return w}var b={},d={},m={apply:function(j,t){var q=d[t]?d[t]:d.basic,n;if(j&&j.canvas){n=b[j.canvas.id];b[j.canvas.id]=t}q.applyToContext(j);return n},define:c,defineMany:r,get:function(j){return d[j]},init:f,load:function(j){COG.jsonp(j,function(t){r(t)})}};r({basic:{lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"},waypoints:{lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"}});return m}(),hb={NONE:0,ACTIVE:1,ANIMATING:4,
PAN:8,ZOOM:16,FREEZE:128},yb=function(c){function r(C,z,G,T){Qa=kb;na(wa-z,xa-G,T?c.panAnimationEasing:null,T?c.panAnimationDuration:null);clearTimeout(Ga);Ga=setTimeout(f,100)}function f(){Qa=ob;Ba()}function b(C,z,G,T){Xa(ma(ia(U+ua(2,T)-1,0.5),2))}function d(){var C=va(U)/Math.LN2>>0;if(C!==0){U=ua(2,C);C=M.init(lb-(e/U>>0),mb-(h/U>>0));if(!Ca.trigger("scale",U,C).cancel){for(var z=da.length;z--;)da[z].trigger("scale",U,C);U=1;Qa=ob}ib()}Ba()}function m(C){C||(C=M.init(e,h));A=M.init(wa,xa);J=
M.offset(C,wa,xa);lb=J.x;mb=J.y}function j(C,z){var G,T;T=1/U;if(U!==1&&i){G=i.x1+C*T;T=i.y1+z*T}else{G=C+wa;T=z+xa}return M.init(G,T)}function t(C,z,G){$a("doubleTap",z,G,j(G.x,G.y));c.scalable&&Xa(2,G,c.zoomEasing,null,c.zoomDuration)}function q(C,z,G){jb=null;y(z,G,j(G.x,G.y),"down")}function n(C,z,G){jb=j(G.x,G.y);y(z,G,jb,"hover")}function w(){clearTimeout(ha);ha=setTimeout(P,250)}function k(C,z,G){y(z,G,j(G.x,G.y),"tap");$a("tap",z,G,j(G.x,G.y))}function y(C,z,G,T){for(var pa=[],Ea=Ia;Ea--;)if(da[Ea].hitTest)pa=
pa.concat(da[Ea].hitTest(G.x,G.y,Qa,Ca));pa.length>0&&Ca.triggerCustom(T+"Hit",{hitType:T},pa,C,z,G)}function P(C,z){var G;if(qa){if(c.autoSize&&qa.parentNode){C=qa.parentNode.offsetWidth;z=qa.parentNode.offsetHeight}try{if(!qa.id)qa.id=c.id+"_canvas";ga=qa.getContext("2d")}catch(T){COG.exception(T);throw Error("Could not initialise canvas on specified view element");}if(C&&z&&(Ja!==z||Ka!==C)){Ta=true;Ka=C;Ja=z;e=Ka>>1;h=Ja>>1;Ca.trigger("resize",Ka,Ja);for(G=Ia;G--;)da[G].trigger("resize",Ka,Ja)}for(G=
Ia;G--;)da[G].trigger("contextChanged",ga);Ba();ta()}}function S(C,z){z.setId(C);z.added=X();z.bind("remove",function(){Ca.removeLayer(C)});z.trigger("contextChanged",ga);z.setParent(Ca);da.push(z);da.sort(function(G,T){var pa=T.zindex-G.zindex;if(pa===0)pa=T.added-G.added;return pa});Ia=da.length;return z}function ta(){Ya&&Ya.unbind();Ya=INTERACT.watch(qa);c.pannable&&Ya.pannable().bind("pan",r);if(c.scalable){Ya.bind("zoom",b);Ya.bind("doubleTap",t)}if(c.captureHover){Ya.bind("pointerDown",q);Ya.bind("pointerHover",
n)}Ya.bind("tap",k)}function Ua(C){var z,G=false;if(pb){if(C-Za>Cb){if(U!==1)Qa|=xb;ba=(z=(Qa&(xb|kb))!==0)&&(Qa&qb)===0;if(Ta&&qa){typeof FlashCanvas!="undefined"&&FlashCanvas.initElement(qa);qa.width=Ka;qa.height=Ja;qa.style.width=Ka+"px";qa.style.height=Ja+"px";Ta=false}if(Ra||La){var T=cb?wa+e:wa,pa=db?xa+h:xa;if(Ra&&Ra>Ka)if(T+Ka>Ra)wa=cb?T-Ra>0?wa-Ra:wa:Ra-Ka;else if(T<0)wa=cb?wa+Ra:0;if(La&&La>Ja)if(pa+Ja>La)xa=db?pa-La>0?xa-La:xa:La-Ja;else if(pa<0)xa=db?xa+La:0}g=eb();if(ba){ka=false;if(Fa!==
0){clearTimeout(Fa);Fa=0}}for(T=Ia;T--;){if(da[T].animated)Qa|=qb;da[T].cycle(C,g,Qa);da[T].shouldDraw(Qa,g);G=da[T].clip||G}T=Qa;pa=g;z=rb&&G&&!z;var Ea;v.center(pa);G=0;i=v.copy(pa);i.scaleFactor=U;z||ga.clearRect(0,0,Ka,Ja);ga.save();try{ga.globalCompositeOperation="source-over";if(U!==1){var ab=i,Va=1/U;lb=J.x+(wa-A.x);mb=J.y+(xa-A.y);i=ab?v.fromCenter(lb>>0,mb>>0,ab.width*Va>>0,ab.height*Va>>0):void 0;ga.scale(U,U)}ga.translate(-i.x1,-i.y1);N=Q=null;if(z){ga.beginPath();for(G=Ia;G--;)da[G].clip&&
da[G].clip(ga,i,T,Ca,C);ga.closePath();ga.clip()}for(G=Ia;G--;){Ea=da[G];var bb=Ea.style,fb=bb?Ha.apply(ga,bb):null;if(Ea.minXY)Q=Q?M.min(Q,Ea.minXY):M.copy(Ea.minXY);if(Ea.maxXY)N=N?M.max(N,Ea.maxXY):M.copy(Ea.maxXY);Ea.draw(ga,i,T,Ca,C);fb&&Ha.apply(ga,fb)}}finally{ga.restore()}if(B){ga.globalCompositeOperation="source-over";ga.strokeStyle="#f00";ga.beginPath();ga.moveTo(e,0);ga.lineTo(e,Ja);ga.moveTo(0,h);ga.lineTo(Ka,h);ga.stroke()}pb=0;$a("drawComplete",pa,C);C-V>nb&&ib();Za=C}animFrame(Ua)}else l=
false}function Ba(){pb+=1;if(!l){l=true;animFrame(Ua)}}function eb(){return v.init(wa,xa,wa+Ka,xa+Ja)}function ib(){V=(new Date).getTime();$a("refresh",Ca,eb());Ba()}function Xa(C,z,G,T,pa){if(G)COG.tweenValue(U,C,G,pa,function(Ea,ab){U=Ea;if(ab){var Va=Ma(va(U)/Math.LN2);U=ua(2,Va);T&&T()}m(z);d()});else{U=C;m(z);d()}return Ca}function $a(){for(var C=Ca.trigger.apply(null,arguments).cancel,z=da.length;z--;)C=da[z].trigger.apply(null,arguments).cancel||C;return!C}function na(C,z,G,T,pa){function Ea(){ab+=
1;if(ab>=2){f();pa&&pa()}}var ab=0,Va=Q?M.offset(Q,-e,-h):null,bb=N?M.offset(N,-e,-h):null;if(Va){C=C<Va.x?Va.x:C;z=z<Va.y?Va.y:z}if(bb){C=C>bb.x?bb.x:C;z=z>bb.y?bb.y:z}if(G){if((Qa&kb)===0){COG.tweenValue(wa,C,G,T,function(fb,sb){wa=fb|0;(sb?Ea:Ba)();return!ba});COG.tweenValue(xa,z,G,T,function(fb,sb){xa=fb|0;(sb?Ea:Ba)();return!ba});Qa=kb|qb}}else{wa=C|0;xa=z|0;Ba();pa&&pa()}}c=COG.extend({id:COG.objId("view"),container:"",captureHover:true,fastDraw:false,inertia:true,idleDelay:100,minRefresh:1E3,
pannable:true,clipping:true,scalable:true,panAnimationEasing:COG.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,autoSize:true,tapExtent:10,guides:false,fps:25,zoomEasing:COG.easing("quad.out"),zoomDuration:300},c);var da=[],Ia=0,qa=document.getElementById(c.container),ga=null,tb=typeof window.attachEvent!="undefined",nb=c.minRefresh,jb=null,wa=0,xa=0,Ra=null,La=null,cb=false,db=false,rb=c.clipping,g=null,l=false,i,B=c.guides,a=1,e=0,h=0,A=null,J=null,ba=false,ka=false,Fa=
0,Ga=0,Q=null,N=null,V=0,$=0,ha=0,U=1,Za=0,Ta=false,Ya=null,Ja,Ka,Cb=1E3/c.fps|0,pb=0,lb,mb,ob=u("ACTIVE"),kb=u("PAN"),xb=u("ZOOM"),qb=u("ANIMATING"),Qa=ob,Ca={id:c.id,deviceScaling:a,fastDraw:c.fastDraw||K().requireFastDraw,getDimensions:function(){return ja.init(Ka,Ja)},getLayer:function(C){for(var z=0;z<Ia;z++)if(da[z].getId()==C)return da[z];return null},setLayer:function(C,z){for(var G=0;G<Ia;G++)if(da[G].getId()===C){da.splice(G,1);break}if(z){S(C,z);z.trigger("refresh",Ca,eb())}Ba();return z},
eachLayer:function(C){for(var z=Ia;z--;)C(da[z])},invalidate:Ba,refresh:ib,resetScale:function(){U=1},resize:function(C,z){if(qa){c.autoSize=false;if(Ka!==C||Ja!==z)P(C,z)}},scale:Xa,triggerAll:$a,removeLayer:function(C){a:{for(var z=Ia;z--;)if(da[z].getId()==C){C=z;break a}C=-1}if(C>=0&&C<Ia){Ca.trigger("layerRemoved",da[C]);da.splice(C,1);Ba()}Ia=da.length},getOffset:function(){return M.init(wa,xa)},setMaxOffset:function(C,z,G,T){Ra=C;La=z;cb=typeof G!="undefined"?G:false;db=typeof T!="undefined"?
T:false},getViewRect:eb,updateOffset:na,pan:function(C,z,G,T,pa){na(wa+C,xa+z,G,T,pa)}};a=K().getScaling();Ca.markers=S("markers",new ub);COG.observable(Ca);Ca.bind("invalidate",function(){Ba()});Ca.bind("resync",function(){N=Q=null});COG.configurable(Ca,["inertia","container","rotation","tapExtent","scalable","pannable"],COG.paramTweaker(c,null,{container:function(C,z){qa=document.getElementById(z);P()},rotation:function(C,z){$=z},scalable:ta,pannable:ta}),true);P();if(c.autoSize)tb?window.attachEvent("onresize",
w):window.addEventListener("resize",w,false);return Ca},gb=function(c){c=COG.extend({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:u("ACTIVE","ANIMATING","PAN","ZOOM"),style:null,minXY:null,maxXY:null},c);var r=null,f=false,b=false,d=c.id,m=u("ACTIVE"),j=c.validStates,t=0,q=0,n=COG.extend({addToView:function(w){w.setLayer(d,n)},shouldDraw:function(w){return(w&j)!==0},clip:null,cycle:function(){},draw:function(){},remove:function(){n.trigger("remove",n)},changed:function(){b=true;
r&&r.invalidate()},hitTest:null,getId:function(){return d},setId:function(w){d=w},getParent:function(){return r},setParent:function(w){f=(r=w)?r.fastDraw&&displayState!==m:false;n.trigger("parentChange",r)}},c);COG.observable(n);n.bind("drawComplete",function(w,k){b=false;t=k.x1;q=k.y1});n.bind("resync",function(w,k){if(k.syncXY){n.minXY&&k.syncXY(n.minXY);n.maxXY&&k.syncXY(n.maxXY)}});return n},vb=function(c){function r(q,n,w,k){b=q;d=n;m=w;j=k}c=COG.extend({xy:M.init(),offset:true,tweenIn:null,
animationSpeed:null,isNew:true},c);var f=false,b=0,d=0,m=0,j=0,t=COG.extend(c,{isAnimating:function(){return f},draw:function(q,n,w,k,y){if(t.isNew&&c.tweenIn)COG.tweenValue(n.y1-20,t.xy.y,c.tweenIn,c.animationSpeed?c.animationSpeed:250+Math.random()*500,function(P,S){t.xy.y=P|0;f=!S;y.invalidate()});t.drawMarker(q,n,t.xy.x,t.xy.y,w,k,y);t.isNew=false},drawMarker:function(q,n,w,k){q.beginPath();q.arc(w,k,4,0,Math.PI*2,false);q.fill();r(w-4,k-4,8,8)},hitTest:function(q,n){return q>=b&&q<=b+m&&n>=d&&
n<=d+j},updateBounds:r});COG.observable(t);return t},ub=function(c){function r(){f();d.changed();d.trigger("markerUpdate",b)}function f(){var m=d.getParent();if(m&&m.syncXY)for(var j=b.length;j--;)m.syncXY([b[j].xy]);b.sort(function(t,q){var n=q.xy.y-t.xy.y;if(n==0)n=q.xy.x-t.xy.x;return n})}c=COG.extend({zindex:100,style:"basic"},c);var b=[],d=COG.extend(new gb(c),{draw:function(m,j,t,q){for(var n=b.length;n--;)b[n].draw(m,j,t,d,q)},add:function(m){if(m&&typeof m.length!=="undefined")for(var j=m.length;j--;){if(m[j])b[b.length]=
m[j]}else if(m)b[b.length]=m;r()},clear:function(m){if(m)for(var j=0;j<b.length;)if(m(b[j]))b.splice(j,1);else j+=1;else b=[];r()},each:function(m){if(m)for(var j=b.length;j--;)m(b[j])},find:function(m){for(var j=[],t=b.length;t--;)if(!m||m(b[t]))j[j.length]=b[t];return j},hitTest:function(m,j){for(var t=[],q=b.length;q--;)if(b[q].hitTest(m,j))t[t.length]={type:"marker",data:b[q]};return t}});d.bind("tap",function(m,j,t,q){var n=[],w=q.x;q=q.y;for(var k=b.length;k--;)if(b[k].hitTest(w,q))n[n.length]=
b[k];if(n.length>0)m.cancel=d.trigger("markerTap",j,t,n).cancel});d.bind("parentChange",f);d.bind("resync",f);return d},zb=function(c){function r(q,n,w){q.fillStyle="#FFFFFF";q.strokeStyle="#222222";q.beginPath();q.arc(w.x,w.y,4,0,Math.PI*2,false);q.stroke();q.fill()}c=COG.extend({path:[],id:COG.objId("pathAni"),easing:COG.easing("sine.inout"),validStates:u("ACTIVE","PAN","ZOOM"),drawIndicator:null,duration:2E3},c);var f=M.edges(c.path),b,d=null,m=c.drawIndicator?c.drawIndicator:r,j=0,t=COG.extend(new gb(c),
{cycle:function(){for(var q=0;q<f.accrued.length&&f.accrued[q]<j;)q++;d=null;if(q<c.path.length-1){var n=j-(q>0?f.accrued[q-1]:0),w=c.path[q];b=M.theta(w,c.path[q+1],f.edges[q]);d=M.extendBy(w,b,n)}return d},draw:function(q,n){d&&m&&m(q,n,M.init(d.x,d.y),b)}});COG.tweenValue(0,f.total,c.easing,c.duration,function(q,n){j=q;n&&t.remove();t.changed()});return t},Ab=function(c){c=COG.extend({style:null,properties:{}},c);return COG.extend(c,{rect:null,draw:function(){},resync:function(){}})},wb=function(c,
r){r=COG.extend({fill:false,simplify:false},r);var f=false,b=r.fill,d=r.simplify,m=u("ZOOM"),j=[],t=COG.extend(new Ab(r),{draw:function(q,n,w,k,y,P){if(f){n=true;w=(P&m)!==0;q.beginPath();for(P=j.length;P--;){w=j[P].x;k=j[P].y;if(n){q.moveTo(w,k);n=false}else q.lineTo(w,k);w=true}if(w){b&&q.fill();q.stroke()}}},resync:function(q){t.xy=q.syncXY(c);j=M.floor(d?M.simplify(c):c)}});f=c&&c.length>=2;return t},Bb=function(c){function r(m){for(var j=b.length;j--;)b[j].resync(m);b.sort(function(t,q){var n=
q.xy.y-t.xy.y;if(n===0)n=q.xy.x-t.xy.y;return n});d.changed()}function f(m,j){j.syncXY&&r(j)}c=COG.extend({zindex:80},c);var b=[],d=COG.extend(new gb(c),{add:function(m){b[b.length]=m},each:function(m){for(var j=b.length;j--;)m(b[j])},draw:function(m,j,t){var q=j.x1,n=j.y1,w=j.width;j=j.height;for(var k=b.length;k--;){var y=b[k].style;y=y?Ha.apply(m,y):null;b[k].draw(m,q,n,w,j,t);y&&Ha.apply(m,y)}}});d.bind("parentChange",f);d.bind("resync",f);return d},Db=function(){return{tileSize:256,init:function(c,
r,f,b,d){return COG.extend({x:c,y:r,width:f,height:b},d)}}}(),Wa={ex:COG.extend,ticks:X,getConfig:K,userMessage:function(c,r,f){Wa.trigger("userMessage",c,r,f)},zoomable:la,XY:M,XYRect:v,Dimensions:ja,Vector:ra,D:ja,Images:Da,Generator:Oa,tween:COG.tween,tweenValue:COG.tweenValue,easing:COG.easing,Tween:COG.Tween,Style:Ha,viewState:u,View:yb,ViewLayer:gb,ImageLayer:function(c,r){function f(n,w,k){for(w=j.length;w--;){var y=j[w],P=y.x,S=y.y,ta=v.init(y.x,y.y,y.x+y.width,y.y+y.height);if(k&&v.intersect(n,
ta))(ta=Da.get(y.url,function(){q.changed()},t))&&k(ta,P,S,y.width,y.height)}}function b(n){var w=++m,k=q.getParent();d&&d.run(k,n,function(y){if(w==m){j=[].concat(y);k.invalidate()}})}r=COG.extend({imageLoadArgs:{}},r);var d=c?Oa.init(c,r):null,m=0,j=[],t=r.imageLoadArgs,q=COG.extend(new gb(r),{changeGenerator:function(n,w){d=Oa.init(n,COG.extend({},r,w));j=null;b(q.getParent().getViewRect())},clip:function(n,w,k){f(w,k,function(y,P,S,ta,Ua){n.rect(P,S,ta,Ua)})},draw:function(n,w,k){f(w,k,function(y,
P,S,ta,Ua){q.drawImage(n,y,P,S,ta,Ua,w,k)})},drawImage:function(n,w,k,y){w&&n.drawImage(w,k,y,w.width,w.height)}});q.bind("refresh",function(n,w,k){b(k)});q.bind("tap",function(n,w,k,y){n=[];var P=y.x,S=y.y,ta,Ua;if(j)for(var Ba=j.length;Ba--;){ta=j[Ba];if(Ua=P>=ta.x&&P<=ta.x+ta.width&&S>=ta.y&&S<=ta.y+ta.height)n[n.length]=ta}n.length>0&&q.trigger("tapImage",n,w,k,y)});return q},ImageGenerator:function(c){c=COG.extend({relative:false,padding:2},c);c={run:function(){COG.warn("running base generator - this should be overriden")}};
COG.observable(c);return c},Marker:vb,ImageMarker:function(c){c=COG.extend({image:null,imageUrl:null,animatingImage:null,animatingImageUrl:null,imageAnchor:null,rotation:0,scale:1,opacity:1},c);var r=c.imageAnchor?T5.XY.invert(c.imageAnchor):null,f=COG.extend(new vb(c),{changeImage:function(b){f.image=Da.get(b,function(d){f.image=d})},drawMarker:function(b,d,m,j){if((d=f.isAnimating()&&f.animatingImage?f.animatingImage:f.image)&&d.width>0){r||(r=M.init(-d.width>>1,-d.height>>1));var t=f.scale,q=m+
~~(r.x*t),n=j+~~(r.y*t),w=~~(d.width*t),k=~~(d.height*t);f.updateBounds(q,n,w,w);if(f.rotation||f.opacity!==1){b.save();try{b.globalAlpha=f.opacity;b.translate(m,j);b.rotate(f.rotation);b.drawImage(d,r.x*t,r.y*t,w,k)}finally{b.restore()}}else b.drawImage(d,q,n,w,k)}}});if(!f.image)f.image=Da.get(c.imageUrl,function(b){f.image=b});if(!f.animatingImage)f.animatingImage=Da.get(c.animatingImageUrl,function(b){f.animatingImage=b});return f},MarkerLayer:ub,PathLayer:function(c){function r(){var n=q.getParent();
if(n&&n.syncXY){n.syncXY(d);m&&n.syncXY(m);q.trigger("tidy")}}c=COG.extend({style:"waypoints",pixelGeneralization:8,zindex:50},c);var f=[],b=null,d=[],m=null,j=0,t=[],q=COG.extend(new gb(c),{getAnimation:function(n,w,k,y){var P="pathAnimation"+j++;t.push(P);return new zb({id:P,path:f,zindex:c.zindex+1,easing:n?n:COG.easing("sine.inout"),duration:w?w:5E3,drawIndicator:k,autoCenter:y?y:false})},draw:function(n){var w,k=f.length;n.save();try{Ha.apply(n,c.style);if(k>0){n.beginPath();n.moveTo(f[k-1].x,
f[k-1].y);for(w=k;w--;)n.lineTo(f[w].x,f[w].y);n.stroke();if(b){n.fillStyle=c.waypointFillStyle;for(w=b.length;w--;){n.beginPath();n.arc(b[w].x,b[w].y,2,0,Math.PI*2,false);n.stroke();n.fill()}}}}finally{n.restore()}},updateCoordinates:function(n,w){d=n;m=w;r()}});q.bind("tidy",function(){f=M.simplify(d,c.pixelGeneralization);b=M.simplify(m,c.pixelGeneralization);q.changed(true)});q.bind("resync",r);return q},AnimatedPathLayer:zb,Shape:Ab,Arc:function(c,r){r=COG.extend({size:4},r);var f=M.init(),b=
COG.extend(r,{draw:function(d){d.beginPath();d.arc(f.x,f.y,b.size,0,Math.PI*2,false);d.fill();d.stroke()},resync:function(d){d.syncXY([c]);f=M.floor([c])[0]}});COG.info("created arc = ",c);return b},Poly:wb,ShapeLayer:Bb,Tiling:Db};COG.observable(Wa);var Sa=Wa.Geo=function(){function c(g){for(var l=null,i=1;!l&&i<arguments.length;i++)l=m(g,arguments[i]);l=l?l:m(g);if(!l)throw Error("Unable to find GEO engine with "+g+" capability");return l}function r(g){g=parseFloat(g)*y;g=za(g);var l=Ba*g;return va((1+
g)/(1-g)*ua((1-l)/(1+l),Ba))/2}function f(g){return parseFloat(g)*y}function b(g){g=ua(Math.E,-g);for(var l=L-2*ya(g),i=j(l,g),B=0;B<ib&&ea(l-i)>eb;){l=i;i=j(l,g);B++}return i*P}function d(g){return g%360*P}function m(g,l){var i=null;for(var B in ga)if(l){if(B==l&&ga[B][g]){i=ga[B];break}}else if(ga[B][g]){i=ga[B];break}return i}function j(g,l){var i=Ba*za(g);return L-2*ya(l*ua((1-i)/(1+i),Ba/2))}function t(g,l,i,B){l=n(l);g.add(B.line(l,i));return l.length}function q(g,l,i,B){l=n(l);g.add(B.poly(l,
i));return l.length}function n(g){var l=g?g.length:0,i=Array(l);for(l=l;l--;)i[l]=Sa.Position.init(g[l][1],g[l][0]);return Sa.Position.vectorize(i,Ra)}function w(g,l,i){return new db(g,l,i)}var k=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],y=Math.PI/180,P=180/Math.PI,S=L,ta=-S,Ua=-x,Ba=0.08181919084262157,eb=1.0E-7,ib=12,Xa=null,$a={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",HWY:"HIGHWAY",MWY:"MOTORWAY"},na=function(){function g(a){return a?
i(a.lat,a.lon):null}function l(a){return!a||a.lat===0&&a.lon===0}function i(a,e){return{lat:parseFloat(a?a:0),lon:parseFloat(e?e:0)}}function B(a){if(a)if(typeof a.lat!=="undefined")return g(a);else{if(a.split)for(var e=[" ",","],h=0;h<e.length;h++){var A=a.split(e[h]);if(A.length===2)return i(A[0],A[1])}}else return i();return null}return{calcDistance:function(a,e){if(l(a)||l(e))return 0;var h=(e.lat-a.lat)*y>>1,A=(e.lon-a.lon)*y>>1;h=za(h)*za(h)+oa(a.lat*y)*oa(e.lat*y)*za(A)*za(A);return 6371*2*
Y(Aa(h),Aa(1-h))},copy:g,empty:l,equal:function(a,e){return a&&e&&a.lat==e.lat&&a.lon==e.lon},fromMercatorPixels:function(a,e){return i(b(e),d(a))},generalize:function(a,e,h){var A=a.length,J=[],ba=null;h||(h=250);h/=1E3;COG.info("generalizing positions, must include "+e.length+" positions");for(var ka=A;ka--;)if(ka===0)J.unshift(a[ka]);else{var Fa=!ba||na.inArray(a[ka],e)?h:na.calcDistance(ba,a[ka]);if(a[ka]&&Fa>=h){J.unshift(a[ka]);ba=a[ka]}}COG.info("generalized "+A+" positions into "+J.length+
" positions");return J},inArray:function(a,e){for(var h=na.equal,A=e.length;A--;)if(h(a,e[A]))return true;return false},inBounds:function(a,e){var h=!(na.empty(a)||na.empty(e));return h=(h=h&&a.lat>=e.min.lat&&a.lat<=e.max.lat)&&a.lon>=e.min.lon&&a.lon<=e.max.lon},init:i,offset:function(a,e,h){var A=a.lat*y;a=a.lon*y;e=A+e/6371;h=aa(za(h/6371)/oa(A));h=a+h;e=(e+L)%Math.PI-L;h%=x;return i(e*P,h*P)},parse:B,parseArray:function(a){var e=a.length,h=Array(e);for(e=e;e--;)h[e]=B(a[e]);return h},toMercatorPixels:function(a){return T5.XY.init(f(a.lon),
r(a.lat))},toString:function(a){return a?a.lat+" "+a.lon:""},vectorize:function(a,e){function h(){for(var ka=0,Fa=e.chunkSize,Ga=A;Ga--;){J[Ga]=T5.GeoXY.init(a[Ga]);ka+=1;if(ka>Fa)break}A=Ga;if(A<=0)e.callback&&e.callback(J);else animFrame(h)}var A=a.length,J=Array(A);e=COG.extend({chunkSize:500,async:true,callback:null},e);if(!e.async){for(var ba=A;ba--;)J[ba]=T5.GeoXY.init(a[ba]);return J}animFrame(h);return null}}}(),da=function(){function g(a,e,h){var A=T5.XY.init(0,e.lat-a.lat);if(typeof h===
"undefined")h=true;A.x=h&&a.lon>e.lon?360-a.lon+e.lon:e.lon-a.lon;return A}function l(a,e){return da.init(na.init(a.min.lat-e,a.min.lon-e%360),na.init(a.max.lat+e,a.max.lon+e%360))}function i(a){var e=g(a.min,a.max);return na.init(a.min.lat+(e.y>>1),a.min.lon+(e.x>>1))}function B(a,e){return{min:na.parse(a),max:na.parse(e)}}return{calcSize:g,createBoundsFromCenter:function(a,e){var h=e/6371,A=a.lat*y,J=a.lon*y,ba=A-h,ka=A+h;if(ba>ta&&ka<S){A=aa(za(h)/oa(A));h=(J-A)%x;J=(J+A)%x}else{ba=ia(ba,ta);ka=
ma(ka,S);h=Ua;J=x}return da.init(na.init(ba*P,h*P),na.init(ka*P,J*P))},expand:l,forPositions:function(a,e){var h=null,A=T5.ticks();e||(e="auto");for(var J=a.length;J--;)if(h){var ba=g(h.min,a[J],false),ka=g(a[J],h.max,false);if(ba.x<0)h.min.lon=a[J].lon;if(ba.y<0)h.min.lat=a[J].lat;if(ka.x<0)h.max.lon=a[J].lon;if(ka.y<0)h.max.lat=a[J].lat}else h=B(a[J],a[J]);if(e){if(e=="auto"){J=g(h.min,h.max);e=ia(J.x,J.y)*0.3}h=l(h,e)}COG.trace("calculated bounds for "+a.length+" positions",A);return h},getCenter:i,
getGeoHash:function(a){var e=T5.Geo.GeoHash.encode(a.min.lat,a.min.lon);a=T5.Geo.GeoHash.encode(a.max.lat,a.max.lon);COG.info("min hash = "+e+", max hash = "+a)},getZoomLevel:function(a,e){var h=i(a);h=ma(Ma(ea(h.lat)*0.05),k.length);var A=k[h],J=g(a.min,a.max);h=ca(va(k[3]*e.height/J.y)/va(2));A=ca(va(A*e.width/J.x)/va(2));return ma(isNaN(h)?1E3:h,isNaN(A)?1E3:A)},init:B,isEmpty:function(a){return!a||na.empty(a.min)||na.empty(a.max)},toString:function(a){return"min: "+na.toString(a.min)+", max: "+
na.toString(a.max)}}}(),Ia=function(){var g=/^(\d+).*$/,l=/(\d+)\s?\-\s?(\d+)/;return{buildingMatch:function(i,B){g.lastIndex=-1;if(g.test(i))for(var a=i.replace(g,"$1"),e=B.split(","),h=0;h<e.length;h++){l.lastIndex=-1;if(l.test(e[h])){var A=l.exec(e[h]);if(a>=parseInt(A[1],10)&&a<=parseInt(A[2],10))return true}else if(a==e[h])return true}return false},normalize:function(i){if(!i)return"";i=i.toUpperCase();if(!Xa){var B=[];for(var a in $a)B.push(a);Xa=RegExp("(\\s)("+B.join("|")+")(\\s|$)","i")}Xa.lastIndex=
-1;if(B=Xa.exec(i))i=i.replace(Xa,"$1"+$a[B[2]]);return i},toString:function(i){return i.streetDetails+" "+i.location}}}(),qa=Wa.GeoXY=function(){function g(i,B){if(i.length){for(var a,e,h,A,J=i.length;J--;){g(i[J],B);a=typeof a==="undefined"||i.x<a?i.x:a;e=typeof e==="undefined"||i.y<e?i.y:e;h=typeof h==="undefined"||i.x>h?i.x:h;A=typeof A==="undefined"||i.y>A?i.y:A}return v.init(a,e,A,A)}else if(i.mercXY){a=i.mercXY;i.x=(a.x+Math.PI)/B|0;i.y=(Math.PI-a.y)/B|0;i.rpp=B}else COG.warn("Attempted to sync an XY composite, not a GeoXY");
return i}function l(i,B,a){i.pos=B;i.mercXY=na.toMercatorPixels(B);(a=typeof a!=="undefined"?a:i.rpp)&&g(i,a)}return{init:function(i,B){var a=M.init();l(a,i,B);return a},sync:g,toPos:function(i,B){B=B?B:self.rpp;return na.fromMercatorPixels(i.x*B-Math.PI,Math.PI-i.y*B)},updatePos:l}}(),ga={},tb=function(){return{bestResults:function(g,l){l||(l=20);for(var i=g.length>0?g[0]:null,B=[],a=0;a<g.length;a++)if(i&&g[a]&&i.matchWeight-g[a].matchWeight<=l)B.push(g[a]);else break;return B}}}(),nb=function(g){g=
COG.extend({id:null,caption:"",resultType:"",data:null,pos:null,matchWeight:0},g);return COG.extend(g,{toString:function(){return g.caption+(g.matchWeight?" ("+g.matchWeight+")":"")}})},jb=function(){function g(a,e){var h=a.getDimensions();h=new rb({data:e,width:h.width,height:h.height});a.setLayer("route",h)}function l(a){for(var e=i.Unknown,h=B,A=0;A<h.length;A++){h[A].regex.lastIndex=-1;var J=h[A].regex.exec(a);if(J){e=h[A].customCheck?h[A].customCheck(a,J):h[A].turnType;break}}return e}var i=
{Unknown:"turn-unknown",Start:"turn-none-start",Continue:"turn-none",Arrive:"turn-none-arrive",TurnLeft:"turn-left",TurnLeftSlight:"turn-left-slight",TurnLeftSharp:"turn-left-sharp",TurnRight:"turn-right",TurnRightSlight:"turn-right-slight",TurnRightSharp:"turn-right-sharp",Merge:"merge",UTurnLeft:"uturn-left",UTurnRight:"uturn-right",EnterRoundabout:"roundabout-enter",Ramp:"ramp",RampExit:"ramp-exit"},B=function(){var a=[];a.push({regex:/continue/i,turnType:i.Continue});a.push({regex:/(take|bear|turn)(.*?)left/i,
customCheck:function(e,h){return/bear/i.test(h[1])?i.TurnLeftSlight:i.TurnLeft}});a.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(e,h){return/bear/i.test(h[1])?i.TurnRightSlight:i.TurnRight}});a.push({regex:/enter\s(roundabout|rotaty)/i,turnType:i.EnterRoundabout});a.push({regex:/take.*?ramp/i,turnType:i.Ramp});a.push({regex:/take.*?exit/i,turnType:i.RampExit});a.push({regex:/make(.*?)u\-turn/i,customCheck:function(e,h){return/right/i.test(h[1])?i.UTurnRight:i.UTurnLeft}});a.push({regex:/proceed/i,
turnType:i.Start});a.push({regex:/arrive/i,turnType:i.Arrive});a.push({regex:/fell\sthrough/i,turnType:i.Merge});return a}();return{calculate:function(a){a=COG.extend({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},a);var e=c("route");e&&e.route(a,function(h){if(a.generalize)h.geometry=na.generalize(h.geometry,h.getInstructionPositions());if(a.map){g(a.map,h);a.autoFit&&a.map.gotoBounds(h.boundingBox)}a.success&&a.success(h)})},createMapOverlay:g,parseTurnType:l,
TurnType:i,Instruction:function(a){var e=a=COG.extend({position:null,description:"",distance:0,distanceTotal:0,time:0,timeTotal:0,turnType:null},a),h=a.description;h=h.replace(/(\w)(\/)(\w)/g,"$1 $2 $3");e.description=h;if(!a.turnType)a.turnType=l(a.description);return a},RouteData:function(a){a=COG.extend({geometry:[],instructions:[],boundingBox:null},a);if(!a.boundingBox)a.boundingBox=da.forPositions(a.geometry);return COG.extend({getInstructionPositions:function(){for(var e=[],h=0;h<a.instructions.length;h++)a.instructions[h].position&&
e.push(a.instructions[h].position);return e}},a)}}}(),wa="featurecollection",xa="feature",Ra={async:false},La={processor:null,group:"shapes",layerClass:Bb},cb={point:COG.extend({},La,{processor:function(g,l,i,B){l=n([l.coordinates],Ra);if(l.length>0)if(i=B.marker(l[0],i)){g.add(i);return l.length}},group:"markers",layerClass:ub}),linestring:COG.extend({},La,{processor:function(g,l,i,B){l=n(l&&l.coordinates?l.coordinates:[]);return t(g,l,i,B)}}),multilinestring:COG.extend({},La,{processor:function(g,
l,i,B){l=l&&l.coordinates?l.coordinates:[];for(var a=0,e=l.length;e--;)a+=t(g,l[e],i,B);return a}}),polygon:COG.extend({},La,{processor:function(g,l,i,B){l=l&&l.coordinates?l.coordinates:[];if(l.length>0)return q(g,l[0],i,B);return 0}}),multipolygon:COG.extend({},La,{processor:function(g,l,i,B){l=l&&l.coordinates?l.coordinates:[];for(var a=0,e=0;e<l.length;e++)a+=q(g,l[e][0],i,B);return a}})},db=function(g,l,i,B){function a(V,$){var ha=V.processor,U=ba+V.group,Za=COG.extend({},V,i,{properties:$.properties});
if(ha){var Ta=N[U];if(!Ta){Ta=new V.layerClass({id:U});N[U]=Ta}globalLayers=N;return ha(Ta,$.data,Za,B)}return 0}function e(V,$){var ha=V&&V.type?V.type.toLowerCase():null;return ha&&ha===xa?e(V.geometry,V.properties):{type:ha,isCollection:ha?ha===wa:false,definition:cb[ha],data:V,properties:$?$:V.properties}}function h(){var V=0,$=ka;if(!Ga){for(;$<Fa;$++){var ha=e(J?J(g[$]):g[$]),U=null;if(ha.isCollection){Q+=1;Ga=w(ha.data.features,function(Za){Ga=null;for(var Ta in Za)N[Ta]=Za[Ta]},{layerPrefix:ba+
Q+"-"});U+=1}else if(ha.definition)U=a(ha.definition,ha);V+=U?U:1;if(V>=A)break}ka=$+1;if(Ga||ka<Fa)animFrame(h);else l&&l(N)}}i=COG.extend({vectorsPerCycle:Sa.VECTORIZE_PER_CYCLE,rowPreParse:null,simplify:false,layerPrefix:"geojson-"},i);B=COG.extend({marker:function(V){return new vb({xy:V})},line:function(V,$){return new wb(V,$)},poly:function(V,$){return new wb(V,COG.extend({fill:true},$))}},B);var A=i.vectorsPerCycle,J=i.rowPreParse,ba=i.layerPrefix,ka=0,Fa=0,Ga=null,Q=0,N={};if(g){if(typeof g.length===
"undefined")g=[g];Fa=g.length;animFrame(h)}};Wa.GeoJSON={parse:w};Wa.Map=function(g){function l(N){try{var V=Sa.Position.init(N.coords.latitude,N.coords.longitude),$=N.coords.accuracy/1E3;Q.trigger("locationUpdate",N,$);if(ka){if(!J){J=new Sa.UI.LocationOverlay({pos:V,accuracy:$});J.update(Q.getTileLayer());Q.setLayer("location",J)}var ha=Sa.BoundingBox.createBoundsFromCenter(V,Math.max($,1));Q.gotoBounds(ha)}else{J.pos=V;J.accuracy=$;J.update(Q.getTileLayer());a(V,null,COG.easing("sine.out"))}ka=
false}catch(U){COG.exception(U)}}function i(N){COG.info("caught location tracking error:",N)}function B(N,V,$){Q.setZoomLevel(V);a(N,$)}function a(N,V,$,ha){N=qa.init(N,Sa.radsPerPixel(Q.getZoomLevel()));var U=Q.getDimensions();Q.updateOffset(N.x-(U.width>>1),N.y-(U.height>>1),$,ha,function(){Q.refresh();Q.trigger("boundsChange",Q.getBoundingBox());V&&V(Q)})}g=COG.extend({tapExtent:10,crosshair:false,zoomLevel:0,boundsChangeThreshold:30},g);var e={NONE:0,SINGLE:1,WATCH:2},h=M.init(),A=e.NONE,J=null,
ba=0,ka=true,Fa=0,Ga=g.tapExtent;g.adjustScaleFactor=function(N){return Math.pow(2,(N<1?Math.floor:Math.ceil)(Math.log(N)))};var Q=COG.extend(new yb(g),{getBoundingBox:function(){var N=Q.getViewRect();return Sa.BoundingBox.init(qa.toPos(M.init(N.x1,N.y2),Fa),qa.toPos(M.init(N.x2,N.y1),Fa))},getCenterPosition:function(){var N=Q.getViewRect();if(N){N=M.init(N.x1+(N.width>>1),N.y1+(N.height>>1));return qa.toPos(N,Fa)}return null},gotoBounds:function(N,V){var $=Sa.BoundingBox.getZoomLevel(N,Q.getDimensions());
B(Sa.BoundingBox.getCenter(N),$,V)},gotoPosition:B,panToPosition:a,syncXY:function(N){return qa.sync(N,Fa)},locate:function(){Q.trackStart(e.SINGLE);setTimeout(Q.trackCancel,1E4)},trackStart:function(N){if(navigator.geolocation&&!ba){A=N?N:e.WATCH;ka=true;ba=navigator.geolocation.watchPosition(l,i,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3})}},trackCancel:function(){ba&&navigator.geolocation&&navigator.geolocation.clearWatch(ba);Q.removeLayer("location");J=null;A=e.NONE;ba=0},animateRoute:function(N,
V,$,ha){var U=Q.getLayer("route");if(U)(N=U.getAnimation(N,V,$,ha))&&N.addToView(Q)}});Q.bind("pan",function(){A===e.SINGLE&&Q.trackCancel()});Q.bind("tap",function(N,V,$,ha){var U=Sa.radsPerPixel(Q.getZoomLevel());N=qa.toPos(ha,U);var Za=qa.toPos(M.offset(ha,-Ga,Ga),U);ha=qa.toPos(M.offset(ha,Ga,-Ga),U);Q.trigger("geotap",V,$,N,da.init(Za,ha))});Q.bind("refresh",function(){if(M.absSize(M.diff(h,Q.getOffset()))>g.boundsChangeThreshold){h=M.copy(Q.getOffset());Q.trigger("boundsChange",Q.getBoundingBox())}});
la(Q,g);Q.bind("zoomLevelChange",function(N,V){var $;Fa=Sa.radsPerPixel(V);$=x/Fa|0;Q.setMaxOffset($,$,true,false);Da.cancelLoad();Q.resetScale();Q.triggerAll("resync",Q);Q.refresh()});return Q};Wa.GeoShape=function(g,l){l=COG.extend({autoParse:true},l);for(var i=Array(g.length),B=l.autoParse,a=T5.Geo.Position.parse,e=g.length;e--;)i[e]=T5.GeoXY.init(B?a(g[e]):g[e]);return new T5.Poly(i,l)};var rb=Wa.RouteOverlay=function(g){g=COG.extend({data:null,pixelGeneralization:8,partialDraw:false,strokeStyle:"rgba(0, 51, 119, 0.9)",
waypointFillStyle:"#FFFFFF",lineWidth:4,zindex:50},g);var l=[],i=[],B=new T5.PathLayer(g);(function(){if(g.data&&g.data.instructions){for(var a=g.data.instructions,e=Array(a.length),h=a.length;h--;)e[h]=a[h].position;na.vectorize(e,{callback:function(A){i=A}})}g.data&&g.data.geometry&&na.vectorize(g.data.geometry,{callback:function(A){l=A;B.updateCoordinates(l,i,true)}})})();return B};Wa.LocationOverlay=function(g){g=COG.extend({pos:null,accuracy:null,zindex:90},g);var l=new Image,i=T5.XY.init(),
B=T5.XY.init(),a=null;l.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAACIQAAAiEBPhEQkwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAG+SURBVCiRlZHNahNRAIW/O7mTTJPahLZBA1YUyriINRAE3bQIKm40m8K8gLj0CRQkO32ELHUlKbgoIu4EqeJPgtCaoBuNtjXt5LeTMZk0mbmuWiuuPLsD3+HAOUIpxf9IHjWmaUbEyWv5ROrsVULhcHP761rUfnN3Y2Otc8CIg4YT85lzuVsPP+Qupw1vpPjRCvhS9ymvV0e77x7nNj+uvADQAIQQ+uLyvdfLV9JGZi7EdEwQlqBpEJ019f0z1mo2u5Q8DMydv25lshemmj1FueZTawbs7inarqLbV7Qjab1upB9YlhWSAHLavLHZCvg1VEhN0PMU9W7At4bPVidg7CtkLLXkut+lBPD6/Ub155jJiADAHSpaLmx3ApyBQoYEUd0PBoOBkAC6+3llvda/YxgGgYL+UNHf/zN3KiExGlsvTdP0NYDkhPdWrz35ZDsBzV5wCMuQwEyFmXFeeadjzfuFQmGkAZRKpdGC/n7x+M6jqvA9Zo6FWDhlcHE+wqT93J1tP7vpOE7rrx8ALMuasPf8S12St4WmJ6bYWTUC52k8Hm8Vi0X/nwBAPp/XKpWKdF1X2LYdlMvlsToC/QYTls7DLFr/PAAAAABJRU5ErkJggg%3D%3D";
l.onload=function(){i=T5.XY.init(l.width>>1,l.height>>1)};var e=COG.extend(new T5.ViewLayer(g),{pos:g.pos,accuracy:g.accuracy,drawAccuracyIndicator:false,draw:function(h,A){var J=B.x-A.x,ba=B.y-A.y;if(a){h.fillStyle="rgba(30, 30, 30, 0.2)";h.beginPath();h.arc(J,ba,a,0,Math.PI*2,false);h.fill()}l.complete&&l.width>0&&h.drawImage(l,J-i.x,ba-i.y,l.width,l.height);e.changed()},update:function(h){if(h){a=h.getPixelDistance(e.accuracy)>>1;B=h.getGridXYForPosition(e.pos);e.changed()}}});e.bind("gridUpdate",
function(h,A){e.update(A)});return e};return{distanceToString:function(g){if(g>1E3)return~~(g/10)/100+" km";return g?g+" m":""},dist2rad:function(g){return g/6371},getEngine:c,lat2pix:r,lon2pix:f,pix2lat:b,pix2lon:d,radsPerPixel:function(g){return x/(256<<g)},Position:na,BoundingBox:da,Radius:function(g,l){return{distance:parseInt(g,10),uom:l}},Address:function(g){return g=COG.extend({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},g)},A:Ia,GeocodeFieldWeights:{streetDetails:50,
location:50},AddressCompareFns:{},Engine:function(g){if(!g.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var l=COG.extend({remove:function(){delete ga[l.id]}},g);return ga[l.id]=l},Search:tb,GeoSearchResult:nb,LocationSearch:function(g){function l(h,A){navigator.geolocation.clearWatch(B);B=0;if(a){clearTimeout(a);a=0}A&&A([h],g)}function i(h){COG.info("caught location tracking error:",h)}g=COG.extend({name:"Geolocation Search",requiredAccuracy:null,searchTimeout:5E3,
watch:false},g);var B=0,a=0,e=null;return new T5.Geo.GeoSearchAgent(COG.extend({execute:function(h,A){if(navigator.geolocation&&!B){B=navigator.geolocation.watchPosition(function(J){var ba=na.init(J.coords.latitude,J.coords.longitude);J=new nb({id:1,caption:"Current Location",pos:ba,accuracy:J.coords.accuracy/1E3,matchWeight:100});if(!e||J.accuracy<e.accuracy)e=J;if(!g.requiredAccuracy||e.accuracy<g.requiredAccuracy)l(e,A)},i,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3});if(g.searchTimeout)a=
setTimeout(function(){e&&l(e,A)},g.searchTimeout)}}},g))},Routing:jb}}();return Wa}();
