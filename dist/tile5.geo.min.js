COG=typeof COG!=="undefined"?COG:{};COG.extend=function(){for(var ia=arguments[0]||{},sa,L=1,J=arguments.length;L<J;L++)if((sa=arguments[L])!==null)for(var x in sa){var A=sa[x];if(ia!==A)if(A!==undefined)ia[x]=A}return ia};
(function(){var ia=Object.prototype.hasOwnProperty,sa=0,L={};L.toID=function(J){return J.replace(/\s/g,"-")};L.objId=function(J){return(J?J:"obj")+sa++};L.isFunction=function(J){return toString.call(J)==="[object Function]"};L.isArray=function(J){return toString.call(J)==="[object Array]"};L.isPlainObject=function(J){if(!J||toString.call(J)!=="[object Object]"||J.nodeType||J.setInterval)return false;if(J.constructor&&!ia.call(J,"constructor")&&!ia.call(J.constructor.prototype,"isPrototypeOf"))return false;
var x;for(x in J);return x===undefined||ia.call(J,x)};L.isEmptyObject=function(J){for(var x in J)return false;return true};L.isXmlDocument=function(J){return toString.call(J)==="[object Document]"};L.contains=function(J,x){var A=J,G=arguments,R=1;if(x&&module.isArray(x)){G=x;R=0}for(R=R;R<G;R++)A=A&&typeof foo[G[R]]!=="undefined";return A};L.formatStr=function(J){if(arguments.length<=1)return J;for(var x=arguments.length-2,A=0;A<=x;A++)J=J.replace(RegExp("\\{"+A+"\\}","gi"),arguments[A+1]);return J};
L.wordExists=function(J,x){var A="";if(x.toString)x=x.toString();for(var G=0;G<x.length;G++)A+=!/\w/.test(x[G])?"\\"+x[G]:x[G];return RegExp("(^|\\s|\\,)"+A+"(\\,|\\s|$)","i").test(J)};COG.extend(COG,L)})();
(function(){function ia(A){return typeof console!=="undefined"?function(){console[A](Array.prototype.slice.call(arguments,0).join(" "));return true}:function(){return false}}var sa=window.console&&window.console.markTimeline,L=ia("error"),J=ia("info"),x=function(){return sa?function(A,G){console.markTimeline(A+(G?": "+((new Date).getTime()-G)+"ms":""))}:function(){}}();COG.extend(COG,{trace:x,debug:ia("debug"),info:J,warn:ia("warn"),error:L,exception:function(A){if(L)for(var G in A)J("ERROR DETAIL: "+
G+": "+A[G])}})})();
COG.Loopage=function(){function ia(Z){return COG.extend({id:A++,frequency:0,after:0,single:false,lastTick:0,execute:function(){}},Z)}function sa(Z){R.push(Z);L()}function L(){pa&&clearTimeout(pa);pa=setTimeout(J,0);va=true}function J(){for(var Z,B=(new Date).getTime(),C=G.length;R.length>0;){var H=R.shift();for(Z=C;Z--;)if(G[Z].id===H){G.splice(Z,1);break}va=true;C=G.length}if(va){ha=x;for(Z=C;Z--;)ha=G[Z].frequency<ha?G[Z].frequency:ha}for(Z=C;Z--;){H=B-G[Z].lastTick;if(G[Z].lastTick===0||H>=G[Z].frequency){G[Z].execute(B,
G[Z]);G[Z].lastTick=B;G[Z].single&&G[Z].trigger("complete")}}pa=C?setTimeout(J,ha):0}var x=6E4,A=0,G=[],R=[],pa=0,ha=x,va=true;return{join:function(Z){var B=new ia(Z);if(B.after>0)B.lastTick=(new Date).getTime()+B.after;COG.observable(B);B.bind("complete",function(){sa(B.id)});G.unshift(B);L();return B},leave:sa}}();
(function(){function ia(L,J){var x=L.obsHandlers;x[J]||(x[J]=[]);return x[J]}var sa=0;COG.observable=function(L){if(!L)return null;if(!L.obsHandlers)L.obsHandlers={};if(!(L.bind||L.trigger||L.unbind)){L.bind=function(J,x){var A="callback"+sa++;ia(L,J).unshift({fn:x,id:A});return A};L.trigger=function(J){var x=ia(L,J),A={cancel:false,name:J,tickCount:(new Date).getTime()},G;if(!x)return null;G=Array.prototype.slice.call(arguments,1);L.eventInterceptor&&L.eventInterceptor(J,A,G);G.unshift(A);for(var R=
x.length;R--&&!A.cancel;)x[R].fn.apply(self,G);return A};L.unbind=function(J,x){if(typeof J==="undefined")L.obsHandlers={};else for(var A=ia(L,J),G=0;A&&G<A.length;G++)if(A[G].id===x){A.splice(G,1);break}return L}}return L}})();
(function(){function ia(x,A){x[A]||(x[A]=function(G){return x.configure(A,G)})}function sa(x){x.gtConfId="configurable"+J++;x.gtConfig={};x.gtConfigFns=[];return x.gtConfig}var L={},J=0;COG.paramTweaker=function(x,A,G){return function(R,pa){if(typeof pa!=="undefined"){if(R in x)x[R]=pa;G&&R in G&&G[R](R,pa)}else return A&&R in A?A[R](R):x[R]}};COG.configurable=function(x,A,G,R){if(x){x.gtConfId||sa(x);var pa=x.gtConfId,ha=x.gtConfig,va=x.gtConfigFns;L[pa]=x;va.push(G);for(G=A.length;G--;){ha[A[G]]=
true;R&&ia(x,A[G])}if(!x.configure)x.configure=function(Z,B){if(ha[Z]){for(var C=va.length;C--;){var H=va[C](Z,B);if(typeof H!=="undefined")return H}return L[pa]}return null}}}})();
(function(){function ia(x){var A=document.createElement("script"),G=false;A.src=x;A.async=true;A.onload=A.onreadystatechange=function(){if(!G&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){G=true;A.onload=A.onreadystatechange=null;A&&A.parentNode&&A.parentNode.removeChild(A)}};L||(L=document.getElementsByTagName("head")[0]);L.appendChild(A)}var sa=0,L,J=this;COG.jsonp=function(x,A,G){x+=x.indexOf("?")>=0?"&":"?";var R="json"+ ++sa;J[R]=function(pa){A(pa);J[R]=null;
try{delete J[R]}catch(ha){}};ia(x+(G?G:"callback")+"="+R);return R}})();
(function(){function ia(f){if(Z)return ha.length;Z=true;try{for(var s=0;s<ha.length;)if(ha[s].isComplete()){ha[s].triggerComplete(false);ha.splice(s,1)}else{ha[s].update(f);s++}}finally{Z=false}ha.length===0&&va.trigger("complete");return ha.length}function sa(){if(!va){va=COG.Loopage.join({execute:ia,frequency:20});va.bind("complete",function(){va=null})}}var L=1.70158,J=Math.PI/2,x=Math.abs,A=Math.pow,G=Math.sin,R=Math.asin,pa=Math.cos,ha=[],va=null,Z=false,B={linear:function(f,s,v,y){return v*
f/y+s},backin:function(f,s,v,y){return v*(f/=y)*f*((L+1)*f-L)+s},backout:function(f,s,v,y){return v*((f=f/y-1)*f*((L+1)*f+L)+1)+s},backinout:function(f,s,v,y){return(f/=y/2)<1?v/2*f*f*(((L*=1.525)+1)*f-L)+s:v/2*((f-=2)*f*(((L*=1.525)+1)*f+L)+2)+s},bouncein:function(f,s,v,y){return v-B.bounceout(y-f,0,v,y)+s},bounceout:function(f,s,v,y){return(f/=y)<1/2.75?v*7.5625*f*f+s:f<2/2.75?v*(7.5625*(f-=1.5/2.75)*f+0.75)+s:f<2.5/2.75?v*(7.5625*(f-=2.25/2.75)*f+0.9375)+s:v*(7.5625*(f-=2.625/2.75)*f+0.984375)+
s},bounceinout:function(f,s,v,y){return f<y/2?B.bouncein(f*2,0,v,y)/2+s:B.bounceout(f*2-y,0,v,y)/2+v/2+s},cubicin:function(f,s,v,y){return v*(f/=y)*f*f+s},cubicout:function(f,s,v,y){return v*((f=f/y-1)*f*f+1)+s},cubicinout:function(f,s,v,y){if((f/=y/2)<1)return v/2*f*f*f+s;return v/2*((f-=2)*f*f+2)+s},elasticin:function(f,s,v,y,S,P){if(f==0)return s;if((f/=y)==1)return s+v;P||(P=y*0.3);if(!S||S<x(v)){S=v;v=P/4}else v=P/TWO_PI*R(v/S);return-(S*A(2,10*(f-=1))*G((f*y-v)*TWO_PI/P))+s},elasticout:function(f,
s,v,y,S,P){var la;if(f==0)return s;if((f/=y)==1)return s+v;P||(P=y*0.3);if(!S||S<x(v)){S=v;la=P/4}else la=P/TWO_PI*R(v/S);return S*A(2,-10*f)*G((f*y-la)*TWO_PI/P)+v+s},elasticinout:function(f,s,v,y,S,P){var la;if(f==0)return s;if((f/=y/2)==2)return s+v;P||(P=y*0.3*1.5);if(!S||S<x(v)){S=v;la=P/4}else la=P/TWO_PI*R(v/S);if(f<1)return-0.5*S*A(2,10*(f-=1))*G((f*y-la)*TWO_PI/P)+s;return S*A(2,-10*(f-=1))*G((f*y-la)*TWO_PI/P)*0.5+v+s},quadin:function(f,s,v,y){return v*(f/=y)*f+s},quadout:function(f,s,v,
y){return-v*(f/=y)*(f-2)+s},quadinout:function(f,s,v,y){if((f/=y/2)<1)return v/2*f*f+s;return-v/2*(--f*(f-2)-1)+s},sinein:function(f,s,v,y){return-v*pa(f/y*J)+v+s},sineout:function(f,s,v,y){return v*G(f/y*J)+s},sineinout:function(f,s,v,y){return-v/2*(pa(Math.PI*f/y)-1)+s}},C=COG.Tween=function(f){f=COG.extend({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:H("sine.out"),complete:null},f);var s=(new Date).getTime(),v=[],y=false,S=0,P=0,la={isComplete:function(){return y},
triggerComplete:function(ta){f.complete&&f.complete(ta)},update:function(ta){try{var Ia=f.tweenFn(ta-s,S,P,f.duration);if(f.target)f.target[f.property]=Ia;for(var ua=v.length;ua--;)v[ua](Ia,void 0);if(y=s+f.duration<=ta){if(f.target)f.target[f.property]=f.tweenFn(f.duration,S,P,f.duration);for(var Ja=v.length;Ja--;)v[Ja](Ia,true)}}catch(Ea){COG.exception(Ea)}},requestUpdates:function(ta){v.push(ta)}};S=f.target&&f.property&&f.target[f.property]?f.target[f.property]:f.startValue;if(typeof f.endValue!==
"undefined")P=f.endValue-S;if(P==0)y=true;sa();return la};COG.tweenValue=function(f,s,v,y,S){f=new C({startValue:f,endValue:s,tweenFn:v,complete:y,duration:S});ha.push(f);return f};COG.tween=function(f,s,v,y,S,P){f=new C({target:f,property:s,endValue:v,tweenFn:y,duration:P,complete:S});ha.push(f);return f};COG.endTweens=function(f){if(!Z){Z=true;try{for(var s=0;s<ha.length;)if(!f||f(ha[s])){ha[s].triggerComplete(true);ha.splice(s,1)}else s++}finally{Z=false}}};COG.getTweens=function(){return[].concat(ha)};
var H=COG.easing=function(f){return B[f.replace(/[\-\_\s\.]/g,"").toLowerCase()]};COG.registerEasingType=function(f,s){B[f.replace(/[\-\_\s\.]/g,"").toLowerCase()]=s}})();
INTERACT=function(){function ia(B){return function(C,H,f){(f?f:B?document.body:document).addEventListener(C,H,false)}}function sa(B){return function(C,H,f){(f?f:B?document.body:document).removeEventListener(C,H,false)}}function L(B,C,H){(H?H:document).attachEvent("on"+B,C)}function J(B,C,H){(H?H:document).detachEvent("on"+B,C)}function x(B,C){return{x:B?B:0,y:C?C:0,count:1}}function A(B,C){va.push(COG.extend({handler:null,checks:{},type:B},C))}function G(B){var C=0,H=0;if(B.offsetParent){do{C+=B.offsetLeft;
H+=B.offsetTop;B=B.offsetParent}while(B)}return{x:C,y:H}}function R(B,C){for(var H=B.target?B.target:B.srcElement;H&&H.nodeName&&H.nodeName.toUpperCase()!="CANVAS";)H=H.parentNode;return H&&H===C}function pa(B,C){return{x:B.x-(C?C.x:0),y:B.y-(C?C.y:0)}}function ha(B){if(B.preventDefault){B.preventDefault();B.stopPropagation()}else B.cancelBubble&&B.cancelBubble()}var va=[],Z=function(B,C,H){function f(P,la,ta,Ia){s.trigger("pan",Ia.x,Ia.y)}H=COG.extend({binder:null,unbinder:null,observable:null},
H);for(var s=H.observable,v=[],y={bind:function(){return s.bind.apply(null,arguments)},pannable:function(P){COG.extend({inertia:true},P);s.bind("pointerMove",f);return y},unbind:function(){s.unbind();for(var P=0;P<v.length;P++)v[P].unbind();return y}},S=0;S<C.length;S++)v.push(C[S](B,s,H));return y};A("pointer",{handler:function(B,C,H){function f(w){if(R(w,B))if(Ia=S(w)){B.style.cursor="move";ha(w);Fa=w.pageX?w.pageX:w.screenX;N=w.pageY?w.pageY:w.screenY;ua=x(Fa,N);Ja=G(B);C.trigger("pointerDown",
ua,pa(ua,Ja))}}function s(w){Ea=w.pageX?w.pageX:w.screenX;wa=w.pageY?w.pageY:w.screenY;Ia&&R(w,B)&&P("pointerMove")}function v(w){if(Ia&&S(w)){Ia=false;if(R(w,B)){B.style.cursor="default";P("pointerUp")}}}function y(w){if(R(w,B)){var ma;w=w||window.event;if(w.detail)ma=w.axis===2?-w.detail*la:0;else{ma=w.wheelDeltaY?w.wheelDeltaY:w.wheelDelta;if(window.opera)ma=-ma}if(ma!==0){var Ta=x(Ea,wa);C.trigger("zoom",Ta,pa(Ta,G(B)),ma/ta,"wheel");ha(w);w.returnValue=false}}}function S(w){w=w||window.event;
return(w.which||w.button)==1}function P(w){var ma=x(Ea,wa);C.trigger(w,ma,pa(ma,Ja),x(Ea-Fa,wa-N));Fa=Ea;N=wa}H=COG.extend({inertia:false},H);var la=120,ta=la*8,Ia=false,ua,Ja,Ea,wa,Fa,N;H.binder("mousedown",f,false);H.binder("mousemove",s,false);H.binder("mouseup",v,false);H.binder("click",function(w){if(R(w,B)){w=x(w.pageX?w.pageX:w.screenX,w.pageY?w.pageY:w.screenY);C.trigger("tap",w,pa(w,G(B)))}},false);H.binder("dblclick",function(w){COG.info("captured double click");if(R(w,B)){w=x(w.pageX?w.pageX:
w.screenX,w.pageY?w.pageY:w.screenY);COG.info("captured double click + target matched");C.trigger("doubleTap",w,pa(w,G(B)))}},false);H.binder("mousewheel",y,document);H.binder("DOMMouseScroll",y,document);return{unbind:function(){H.unbinder("mousedown",f,false);H.unbinder("mousemove",s,false);H.unbinder("mouseup",v,false);H.unbinder("mousewheel",y,document);H.unbinder("DOMMouseScroll",y,document)}}},checks:{touch:false}});A("pointer",{handler:function(B,C,H){function f(U){if(U.count<2)return 0;var da=
U.x-U.next.x;U=U.y-U.next.y;return~~Math.sqrt(da*da+U*U)}function s(U,da,ea){da=da?da:0;ea=ea?ea:0;for(var La={x:U.x-da,y:U.y-ea,id:U.id,count:U.count},Ga=La;U.next;){U=U.next;Ga=Ga.next={x:U.x-da,y:U.y-ea,id:U.id}}return La}function v(U,da){var ea=U[da?da:"touches"],La,Ga;if(ea.length===0)return null;Ga=La={x:ea[0].pageX,y:ea[0].pageY,id:ea[0].identifier,count:ea.length};for(var Ua=1,$a=ea.length;Ua<$a;Ua++)Ga=Ga.next={x:ea[Ua].pageX,y:ea[Ua].pageY,id:ea[Ua].identifier};return La}function y(U){if(R(U,
B)){wa=G(B);var da=v(U,"changedTouches"),ea=s(da,wa.x,wa.y);if(!N){Fa=ua;C.trigger("pointerDown",da,ea)}Ka&&C.trigger("pointerDownMulti",da,ea);N=v(U);if(N.count>1)ma=f(N);bb=1;Ta=s(N)}}function S(U){if(R(U,B)){U.preventDefault();w=v(U);if(Fa==ua)Fa=Math.abs(N.x-w.x)>ta||Math.abs(N.y-w.y)>ta?Ia:ua;if(Fa!=ua){Fa=w.count>1?Ea:Ja;if(Fa==Ea)if(N.count===1){N=s(w);ma=f(N)}else{U=f(w);if(Math.abs(ma-U)<la)Fa=Ja;else{var da;da=w.x;var ea=w.next.x,La=w.y,Ga=w.next.y,Ua=La<Ga?La:Ga;da={x:(da<ea?da:ea)+(Math.abs(da-
ea)>>1),y:Ua+(Math.abs(La-Ga)>>1)};U=U/ma;ea=U-bb;C.trigger("zoom",da,pa(da,wa),ea,"pinch");bb=U}}Fa==Ja&&C.trigger("pointerMove",w,s(w,wa.x,wa.y),x(w.x-Ta.x,w.y-Ta.y));Ka&&C.trigger("pointerMoveMulti",w,s(w,wa.x,wa.y))}Ta=s(w)}}function P(U){if(R(U,B)){var da=v(U,"changedTouches"),ea=s(da,wa.x,wa.y);w=v(U);if(!w){Fa===ua&&C.trigger("pointerTap",da,ea);C.trigger("pointerUp",da,ea);N=null}Ka&&C.trigger("pointerUpMulti",da,ea)}}H=COG.extend({detailed:false,inertia:false},H);var la=20,ta=7,Ia=0,ua=1,
Ja=2,Ea=3,wa,Fa,N,w,ma,Ta,Ka=H.detailed,bb=1;H.binder("touchstart",y,false);H.binder("touchmove",S,false);H.binder("touchend",P,false);COG.info("initialized touch handler");return{unbind:function(){H.unbinder("touchstart",y,false);H.unbinder("touchmove",S,false);H.unbinder("touchend",P,false)}}},checks:{touch:true}});return{register:A,watch:function(B,C,H){C=COG.extend({bindToBody:false,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},C);capabilities=COG.extend({touch:"ontouchstart"in
window},H);if(!C.observable){COG.info("creating observable");C.observable=COG.observable({});globalOpts=C}C.binder=C.isIE?L:ia(C.bindToBody);C.unbinder=C.isIE?J:sa(C.bindToBody);H=C.types;for(var f=capabilities,s=[],v=va.length;v--;){var y=va[v],S=!H||H.indexOf(y.type)>=0,P=true;for(var la in y.checks){var ta=y.checks[la];COG.info("checking "+la+" capability. require: "+ta+", capability = "+f[la]);P=P&&ta===f[la]}if(S&&P)s[s.length]=y.handler}return new Z(B,s,C)}}}();
T5=function(){function ia(){return(new Date).getTime()}function sa(){for(;ea.length>0;){var c=ea.shift();document.location=c}da=0}function L(c){for(var p=true,h=La.length;h--;)p=p&&c!=La[h];return p}function J(c,p){var h=[];for(var b in p)b&&h.push(b+"="+escape(p[b]));return"tile5://"+c+"/"+(h.length>0?"?"+h.join("&"):"")}function x(c,p){L(c)&&COG.info("would push url: "+J(c,p))}function A(c,p){if(L(c)){ea.push(J(c,p));da||(da=setTimeout(sa,100))}}function G(c){return function(p,h,b){(b?b:c?document.body:
document).addEventListener(p,h,false)}}function R(c){return function(p,h,b){(b?b:c?document.body:document).removeEventListener(p,h,false)}}function pa(c,p,h){(h?h:document).attachEvent("on"+c,p)}function ha(c,p,h){(h?h:document).detachEvent("on"+c,p)}function va(){Ka={base:{name:"Unknown",bindEvent:G(),unbindEvent:R(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:x,targetFps:null},ie:{name:"MSIE",
regex:/msie/i,bindEvent:pa,unbindEvent:ha,requireFastDraw:false,targetFps:25},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:A,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:A},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:A},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:G(true),unbindEvent:R(true),supportsTouch:true,getScaling:function(){return 1/
window.devicePixelRatio},bridgeNotify:A},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:A}};bb=[Ka.froyo,Ka.android,Ka.ipod,Ka.iphone,Ka.ipad,Ka.ie]}function Z(){Ka||va();if(!U){COG.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var c=0;c<bb.length;c++){var p=bb[c];if(p.regex&&p.regex.test(navigator.userAgent)){U=COG.extend({},Ka.base,p);COG.info("PLATFORM DETECTED AS: "+U.name);break}}if(!U){COG.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
U=Ka.base}COG.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return U}function B(c,p){function h(d,i){if(d&&b!==d){var l=c.triggerAll("zoomLevelChange",d,i);if(l)b=d;return l}}p=COG.extend({initial:1,min:0,max:null},p);var b=p.initial;COG.extend(c,{getZoomLevel:function(){return b},setZoomLevel:h});c.bind("scale",function(d,i,l){var q=Math.log(i)/Math.LN2;COG.endTweens(function(u){return u.cancelOnInteract});d.cancel=!h(b+q,l);d.cancel||c.updateOffset(l.x*i,l.y*i)})}function C(){for(var c=
0,p=arguments.length;p--;){var h=yb[arguments[p].toUpperCase()];if(h)c|=h}return c}var H=Math.PI*2,f=Math.PI/2,s=Math.abs,v=Math.ceil,y=Math.min,S=Math.max,P=Math.pow,la=Math.sqrt,ta=Math.log,Ia=Math.round,ua=Math.sin,Ja=Math.asin,Ea=Math.cos,wa=Math.atan,Fa=Math.atan2,N=function(){function c(b,d){return h(b.x-d.x,b.y-d.y)}function p(b,d){if(!d)d=b.length;if(d<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var i={edges:Array(d-1),accrued:Array(d-1),total:0},
l=0;l<d-1;l++){var q=c(b[l],b[l+1]);i.edges[l]=la(q.x*q.x+q.y*q.y);i.accrued[l]=i.total+i.edges[l];i.total+=i.edges[l]}return i}function h(b,d){return{x:b?b:0,y:d?d:0}}return{VECTOR_SIMPLIFICATION:3,SIMPLIFICATION_MIN_VECTORS:25,add:function(){for(var b=0,d=0,i=arguments.length;i--;){b+=arguments[i].x;d+=arguments[i].y}return h(b,d)},absSize:function(b){return S(s(b.x),s(b.y))},copy:function(b){return b?h(b.x,b.y):null},diff:c,distance:function(b,d){return p(b,d).total},edges:p,equals:function(b,
d){return b.x===d.x&&b.y===d.y},extendBy:function(b,d,i){var l=Ea(d)*i;d=ua(d)*i;return h(b.x-l,b.y-d)},floor:function(b){for(var d=Array(b.length),i=b.length;i--;)d[i]=h(~~b[i].x,~~b[i].y);return d},getRect:function(b){for(var d,i,l,q,u=b.length;u--;){var n=b[u];d=typeof d==="undefined"||n.x<d?n.x:d;i=typeof i==="undefined"||n.y<i?n.y:i;l=typeof l==="undefined"||n.x>l?n.x:l;q=typeof q==="undefined"||n.y>q?n.y:q}return ma.init(d,i,l,q)},init:h,invert:function(b){return h(-b.x,-b.y)},min:function(b,
d){return h(b.x<d.x?b.x:d.x,b.y<d.y?b.y:d.y)},max:function(b,d){return h(b.x>d.x?b.x:d.x,b.y>d.y?b.y:d.y)},offset:function(b,d,i){return h(b.x+d,b.y+(i?i:d))},simplify:function(b,d){if(!b)return null;d=d?d:N.VECTOR_SIMPLIFICATION;for(var i=[],l=null,q=b.length;q--;){var u=b[q];if(include=!l||q===0||s(u.x-l.x)+s(u.y-l.y)>d){i.unshift(u);l=u}}return i},theta:function(b,d,i){i=Ja((b.y-d.y)/i);return b.x>d.x?i:Math.PI-i}}}(),w=function(){return{dotProduct:function(c,p){return c.x*p.x+c.y*p.y}}}(),ma=
function(){function c(h){return p(h.x1,h.y1,h.x2,h.y2)}function p(h,b,d,i){h=h?h:0;b=b?b:0;d=typeof d!=="undefined"?d:h;i=typeof i!=="undefined "?i:i;return{x1:h,y1:b,x2:d,y2:i,width:d-h,height:i-b}}return{center:function(h){return N.init(h.x1+h.width/2,h.y1+h.height/2)},copy:c,diagonalSize:function(h){return la(h.width*h.width+h.height*h.height)},fromCenter:function(h,b,d,i){d=d>>1;i=i>>1;return p(h-d,b-i,h+d,b+i)},init:p,intersect:function(h,b){var d=S(h.x1,b.x1),i=S(h.y1,b.y1),l=y(h.x2,b.x2),q=
y(h.y2,b.y2);d=p(d,i,l,q);return d.width>0&&d.height>0?d:null},toString:function(h){return"["+h.x1+", "+h.y1+", "+h.x2+", "+h.y2+"]"},union:function(h,b){if(h.width===0||h.height===0)return c(b);else if(b.width===0||b.height===0)return c(h);else{var d=y(h.x1,b.x1),i=y(h.y1,b.y1),l=S(h.x2,b.x2),q=S(h.y2,b.y2);d=p(d,i,l,q);return d.width>0&&d.height>0?d:null}}}}(),Ta=function(){return{getAspectRatio:function(c){return c.height!==0?c.width/c.height:1},getCenter:function(c){return N.init(c.width>>1,c.height>>
1)},getSize:function(c){return la(P(c.width,2)+P(c.height,2))},init:function(c,p){c=c?c:0;return{width:c,height:p?p:c}}}}(),Ka=null,bb=[],U=null,da=0,ea=[],La=["view.wake","tile.loaded"],Ga=function(){function c(){if(!K){var t=Z().maxImageLoads;K=COG.Loopage.join({execute:function(M,aa){if(!t||n.length<t){var V=u.shift();if(V){n[n.length]=V;V.image.onload=h;V.image.src=V.url;V.requested=T5.ticks()}else aa.trigger("complete")}},frequency:10});K.bind("complete",function(){K=null})}}function p(){X=true;
try{var t=r.length>>1;if(t>0){r.sort(function(aa,V){return aa.created-V.created});for(var M=t;M--;)delete i[r[M].url];r.splice(0,t)}}finally{X=false}W.trigger("cacheCleared")}function h(){var t=l[this.id],M;if(t&&t.image.complete&&t.image.width>0){t.loaded=true;t.hitCount=1;for(M=n.length;M--;)if(n[M].image.src==this.src){n.splice(M,1);break}if(t.background||t.postProcess||t.drawBackground||t.customDraw)if(t.image){globalImageData=t;M=d(t.realSize?t.realSize.width:t.image.width,t.realSize?t.realSize.height:
t.image.height);var aa=M.getContext("2d"),V=t.offset?t.offset:T5.XY.init();t.background&&aa.drawImage(t.background,0,0);t.drawBackground&&t.drawBackground(aa);t.customDraw?t.customDraw(aa,t):aa.drawImage(t.image,V.x,V.y);t.postProcess&&t.postProcess(aa,t);t.image=M}for(M=t.callbacks.length;M--;)t.callbacks[M]&&t.callbacks[M](this,false);t.callbacks=[];r[r.length]={url:this.src,created:t.requested};delete l[this.id];c()}}function b(t,M,aa){var V=i[t];if(V){V.hitCount++;V.image.complete&&V.image.width>
0&&M?M(V.image,true):V.callbacks.push(M)}else{V=COG.extend({url:t,image:new Image,loaded:false,created:T5.ticks(),requested:null,hitCount:0,callbacks:[M]},aa);V.image.id="resourceLoaderImage"+q++;i[t]=V;l[V.image.id]=V;u[u.length]=V;c()}return V}function d(t,M){var aa=document.createElement("canvas");COG.info("creating new canvas");aa.width=t?t:0;aa.height=M?M:0;if(typeof FlashCanvas!="undefined"){document.body.appendChild(aa);FlashCanvas.initElement(aa)}return aa}var i={},l={},q=0,u=[],n=[],r=[],
z=0,K=null,X=false,W={avgImageSize:25,loadTimeout:10,cancelLoad:function(){n=[]},get:function(t,M,aa){var V=null,xa=null;X||(V=i[t]);if((xa=V?V.image:null)&&(xa.getContext||xa.complete&&xa.width>0))return xa;else M&&b(t,M,aa);return null},load:b,newCanvas:d,reset:function(){i={}},stats:function(){return{imageLoadingCount:n.length,queuedImageCount:u.length,imageCacheFullness:z}}};COG.observable(W);COG.Loopage.join({execute:function(t){for(var M=false,aa=0,V=Z();aa<n.length;)if(t-n[aa].requested>W.loadTimeout*
1E3){n.splice(aa,1);M=true}else aa++;M&&c();if(V&&V.imageCacheMaxSize){z=r.length*W.avgImageSize/V.imageCacheMaxSize;z>=1&&p()}},frequency:2E4});return W}(),Ua=function(){var c={};return{init:function(p,h){var b=c[p];if(!b)throw Error("Unable to locate requested generator: "+p);return new b(h)},register:function(p,h){c[p]=h},Template:function(){}}}(),$a=function(){function c(l,q){d[l]=h(q);return l}function p(l){for(var q in l)c(q,l[q])}function h(l){function q(z){var K=l[z];typeof K!=="undefined"&&
n.push(function(X){X[z]=K})}function u(){n=[];for(var z in l)q(z)}l=COG.extend({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},l);var n=[],r={applyToContext:function(z){for(var K=n.length;K--;)n[K](z)},update:function(z,K){l[z]=K;u()}};u();return r}var b={},d={},i={apply:function(l,q){var u=d[q]?d[q]:d.basic,n;if(l&&l.canvas){n=b[l.canvas.id];b[l.canvas.id]=q}u.applyToContext(l);
return n},define:c,defineMany:p,get:function(l){return d[l]},init:h,load:function(l){COG.jsonp(l,function(q){p(q)})}};p({basic:{lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"},waypoints:{lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"}});return i}(),yb={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,ZOOM:16,FREEZE:128},tb=function(c){function p(E,D,Y,ja){Za=gb;M();if(ja&&c.inertia)n(Aa-D,Ba-Y,c.panAnimationEasing,c.panAnimationDuration);else ja||n(Aa-D,Ba-Y);clearTimeout(ka);ka=setTimeout(h,
100)}function h(){Za=lb;I=false;M()}function b(E,D,Y,ja){xa(S(fa+P(2,ja)-1,0.25))}function d(E){var D=ta(fa)/Math.LN2>>0;if(fa!==1)Za=rb;if(D!==0){fa=P(2,D);D=N.init(hb-(o/fa>>0),ib-(a/fa>>0));if(!Ha.trigger("scale",fa,D).cancel){for(E=T.length;E--;)T[E].trigger("scale",fa,D);fa=1;qa=null;Za=lb;E=true}}M(E)}function i(E){E||(E=N.init(o,a));j=N.init(Aa,Ba);m=N.offset(E,Aa,Ba);hb=m.x;ib=m.y}function l(E,D,Y){Ma("doubleTap",D,Y,N.offset(Y,Aa,Ba));if(c.scalable){COG.endTweens(function(ja){return ja.cancelOnInteract});
xa(2,Y,c.zoomAnimation,null,c.zoomDuration)}}function q(){clearTimeout(na);na=setTimeout(r,250)}function u(E,D,Y){Ma("tap",D,Y,N.offset(Y,Aa,Ba))}function n(E,D,Y,ja,oa){function ya(){Va+=1;if(Va>=2){h();oa&&oa()}}var Va=0,Wa=ra?N.offset(ra,-o,-a):null,ab=Ca?N.offset(Ca,-o,-a):null;if(Wa){E=E<Wa.x?Wa.x:E;D=D<Wa.y?Wa.y:D}if(ab){E=E>ab.x?ab.x:E;D=D>ab.y?ab.y:D}if(Y){if(!I){E=COG.tweenValue(Aa,E,Y,ya,ja);D=COG.tweenValue(Ba,D,Y,ya,ja);E.cancelOnInteract=true;E.requestUpdates(function(cb){Aa=cb>>0;I=
true;M()});D.cancelOnInteract=true;D.requestUpdates(function(cb){Ba=cb>>0;I=true;M()})}}else{Aa=E|0;Ba=D|0;COG.info("offset updated: x = "+Aa+", y = "+Ba)}}function r(E,D){var Y;if(za){Na&&Na.unbind();if(c.autoSize&&za.parentNode){E=za.parentNode.offsetWidth;D=za.parentNode.offsetHeight}try{if(!za.id)za.id=c.id+"_canvas";ba=za.getContext("2d")}catch(ja){COG.exception(ja);throw Error("Could not initialise canvas on specified view element");}if(E&&D&&(Oa!==D||Pa!==E)){db=true;Pa=E;Oa=D;o=Pa>>1;a=Oa>>
1;Ha.trigger("resize",Pa,Oa);for(Y=Da;Y--;)T[Y].trigger("resize",Pa,Oa)}if(c.interactive){Na=INTERACT.watch(za).pannable();K()}for(Y=Da;Y--;)T[Y].trigger("contextChanged",ba);M(true)}}function z(E,D){D.setId(E);D.added=ia();D.bind("remove",function(){Ha.removeLayer(E)});D.trigger("contextChanged",ba);D.setParent(Ha);T.push(D);T.sort(function(Y,ja){var oa=ja.zindex-Y.zindex;if(oa===0)oa=ja.added-Y.added;return oa});Da=T.length;return D}function K(){if(Na){if(c.pannable){Na.bind("pan",p);Na.bind("inertiaCancel",
function(){I=false;M()})}if(c.scalable){Na.bind("zoom",b);Na.bind("doubleTap",l)}Na.bind("tap",u)}}function X(){V();F=true;ca=0}function W(E,D,Y,ja){var oa;ma.center(D);var ya=0;Xa=ma.copy(D);Xa.scaleFactor=fa;Y&&ba.clearRect(0,0,Pa,Oa);ba.save();try{ba.globalCompositeOperation="source-over";if(fa!==1){var Va=Xa,Wa=1/fa;hb=m.x+(Aa-j.x);ib=m.y+(Ba-j.y);Xa=Va?ma.fromCenter(hb>>0,ib>>0,Va.width*Wa>>0,Va.height*Wa>>0):void 0;ba.scale(fa,fa)}ba.translate(-Xa.x1,-Xa.y1);Ca=ra=null;if(jb){ba.beginPath();
clipped=false;for(ya=Da;ya--;)if(T[ya].clip){T[ya].clip(ba,Xa,E,Ha,Y,ja);clipped=true}ba.closePath();clipped&&ba.clip()}for(ya=Da;ya--;){oa=T[ya];var ab=oa.style,cb=ab?$a.apply(ba,ab):null;if(oa.minXY)ra=ra?N.min(ra,oa.minXY):N.copy(oa.minXY);if(oa.maxXY)Ca=Ca?N.max(Ca,oa.maxXY):N.copy(oa.maxXY);oa.draw(ba,Xa,E,Ha,Y,ja);cb&&$a.apply(ba,cb)}}finally{ba.restore()}if(g){ba.globalCompositeOperation="source-over";ba.strokeStyle="#f00";ba.beginPath();ba.moveTo(o,0);ba.lineTo(o,Oa);ba.moveTo(0,a);ba.lineTo(Pa,
a);ba.stroke()}Ma("drawComplete",D,ja);COG.trace("draw complete",ja)}function t(E,D){var Y=false,ja=$?$:I?gb:Za,oa=!I&&(ja===rb||ja===gb),ya=ga||ja===gb||COG.getTweens().length>0;if(db&&za){typeof FlashCanvas!="undefined"&&FlashCanvas.initElement(za);za.width=Pa;za.height=Oa;za.style.width=Pa+"px";za.style.height=Oa+"px";db=false}Ya=aa();if(oa){COG.endTweens(function(Va){return Va.cancelOnInteract});F=false;if(ca!==0){clearTimeout(ca);ca=0}}for(oa=Da;oa--;){if(T[oa].animated)Za|=sb;T[oa].cycle(E,
Ya,Za,ya);Y=T[oa].shouldDraw(Za,Ya,ya)||Y}ya=ya||(Za&sb)!==0;if(Y=Y||ya||fa!==1&&fa!==Qa){W(ja,Ya,ya,E);Qa=fa;ga=false}if(!Y&&k===0&&!zb){if(!F&&ca===0)ca=setTimeout(X,kb);D.trigger("complete")}E-Q>mb&&V();k=0;COG.trace("Completed draw cycle",E)}function M(E){ga=E?true:false;k+=1;if(!eb){eb=COG.Loopage.join({execute:t,frequency:Ab});eb.bind("complete",function(){eb=null})}}function aa(){return ma.init(Aa,Ba,Aa+Pa,Ba+Oa)}function V(){Q=(new Date).getTime();Ma("refresh",Ha);M()}function xa(E,D,Y,ja,
oa){function ya(){fa=Math.pow(2,Math.round(Math.log(fa)/Math.LN2));ja&&ja();d(true)}var Va=fa;i(D);if(Y)COG.tweenValue(0,E-Va,Y,ya,oa).requestUpdates(function(Wa){fa=Va+Wa;d()});else{fa=E;d()}return Ha}function Ma(){for(var E=Ha.trigger.apply(null,arguments).cancel,D=T.length;D--;)E=T[D].trigger.apply(null,arguments).cancel||E;return!E}c=COG.extend({id:COG.objId("view"),container:"",fastDraw:false,inertia:true,idleDelay:100,minRefresh:1E3,pannable:true,clipping:false,scalable:true,interactive:true,
panAnimationEasing:COG.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:true,tapExtent:10,mask:true,guides:false,fps:25,zoomAnimation:COG.easing("quad.out"),zoomDuration:300},c);var T=[],Da=0,za=document.getElementById(c.container),ba=null,nb=typeof window.attachEvent!="undefined",kb=c.idleDelay,mb=c.minRefresh,Aa=0,Ba=0,jb=c.clipping,Ya=null,eb=null,Xa,g=c.guides,e=1,k=0,o=0,a=0,j=null,m=null,F=false,I=false,ca=0,ka=0,ra=null,Ca=null,Q=0,O=0,
$=null,ga=false,na=0,qa=null,fa=1,Qa=0,db=false,Na=null,Oa,Pa,zb=typeof FlashCanvas!=="undefined",Ab=~~(1E3/c.fps),hb,ib,lb=C("ACTIVE"),gb=C("PAN"),rb=C("ZOOM"),sb=C("ANIMATING"),Za=lb,Ha={id:c.id,deviceScaling:e,fastDraw:c.fastDraw||Z().requireFastDraw,getDimensions:function(){return Ta.init(Pa,Oa)},getLayer:function(E){for(var D=0;D<Da;D++)if(T[D].getId()==E)return T[D];return null},setLayer:function(E,D){for(var Y=0;Y<Da;Y++)if(T[Y].getId()===E){T.splice(Y,1);break}D&&z(E,D);M();return D},eachLayer:function(E){for(var D=
Da;D--;)E(T[D])},invalidate:M,resize:function(E,D){if(za){c.autoSize=false;if(Pa!==E||Oa!==D)r(E,D)}},refresh:V,scale:xa,triggerAll:Ma,removeLayer:function(E){a:{for(var D=Da;D--;)if(T[D].getId()==E){E=D;break a}E=-1}if(E>=0&&E<Da){Ha.trigger("layerRemoved",T[E]);T.splice(E,1);M()}Da=T.length},stateOverride:function(E){$=E},getOffset:function(){return N.init(Aa,Ba)},getViewRect:aa,updateOffset:n,pan:function(E,D,Y,ja,oa){n(Aa+E,Ba+D,Y,ja,oa)}};e=Z().getScaling();Ha.markers=z("markers",new ob);COG.observable(Ha);
Ha.bind("invalidate",function(E,D){M(D)});Ha.bind("resync",function(){Ca=ra=null});COG.configurable(Ha,["inertia","container","rotation","tapExtent","scalable","pannable"],COG.paramTweaker(c,null,{container:function(E,D){za=document.getElementById(D);r()},rotation:function(E,D){O=D}}),true);r();if(c.autoSize)nb?window.attachEvent("onresize",q):window.addEventListener("resize",q,false);return Ha},fb=function(c){c=COG.extend({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:C("ACTIVE",
"ANIMATING","PAN","ZOOM"),style:null,minXY:null,maxXY:null},c);var p=null,h=false,b=false,d=c.supportFastDraw,i=c.id,l=C("ACTIVE"),q=c.validStates,u=0,n=0,r=COG.extend({addToView:function(z){z.setLayer(i,r)},shouldDraw:function(z,K,X){return(b||X||u!==K.x1||n!==K.y1)&&(z&q)!==0&&(h?d:true)},clip:null,cycle:function(){},draw:function(){},remove:function(){r.trigger("remove",r)},changed:function(z){b=true;r.trigger("changed",r);p&&p.trigger("invalidate",z)},getId:function(){return i},setId:function(z){i=
z},getParent:function(){return p},setParent:function(z){h=(p=z)?p.fastDraw&&displayState!==l:false;r.trigger("parentChange",p)}},c);COG.observable(r);r.bind("drawComplete",function(z,K){b=false;u=K.x1;n=K.y1});r.bind("resync",function(z,K){if(K.syncXY){r.minXY&&K.syncXY(r.minXY);r.maxXY&&K.syncXY(r.maxXY)}});return r},pb=function(c){function p(u,n,r,z){b=u;d=n;i=r;l=z}c=COG.extend({xy:N.init(),offset:true,tweenIn:null,animationSpeed:null,isNew:true},c);var h=false,b=0,d=0,i=0,l=0,q=COG.extend(c,{isAnimating:function(){return h},
draw:function(u,n,r,z,K){if(q.isNew&&c.tweenIn){var X=q.xy.y;q.xy.y=n.y1-20;h=true;COG.tween(q.xy,"y",X,c.tweenIn,function(){q.xy.y=X>>0;h=false},c.animationSpeed?c.animationSpeed:250+Math.random()*500)}q.drawMarker(u,n,q.xy.x,q.xy.y,r,z,K);q.isNew=false},drawMarker:function(u,n,r,z){u.beginPath();u.arc(r,z,4,0,Math.PI*2,false);u.fill();p(r-4,z-4,8,8)},hitTest:function(u,n){return u>=b&&u<=b+i&&n>=d&&n<=d+l},updateBounds:p});COG.observable(q);return q},ob=function(c){function p(){d.changed();d.trigger("markerUpdate",
b)}function h(){var i=d.getParent();if(i&&i.syncXY)for(var l=b.length;l--;)i.syncXY([b[l].xy])}c=COG.extend({zindex:100,style:"basic"},c);var b=[],d=COG.extend(new fb(c),{draw:function(i,l,q,u){for(var n=b.length;n--;)b[n].draw(i,l,q,d,u)},add:function(i){if(i&&typeof i.length!=="undefined")for(var l=i.length;l--;){if(i[l])b[b.length]=i[l]}else if(i)b[b.length]=i;p()},clear:function(i){if(i)for(var l=0;l<b.length;)if(i(b[l]))b.splice(l,1);else l+=1;else b=[];p()},each:function(i){if(i)for(var l=b.length;l--;)i(b[l])},
find:function(i){for(var l=[],q=b.length;q--;)if(!i||i(b[q]))l[l.length]=b[q];return l}});d.bind("tap",function(i,l,q,u){var n=[],r=u.x;u=u.y;for(var z=b.length;z--;)if(b[z].hitTest(r,u))n[n.length]=b[z];if(n.length>0)i.cancel=d.trigger("markerTap",l,q,n).cancel});d.bind("parentChange",h);d.bind("resync",h);d.bind("changed",h);return d},ub=function(c){function p(q,u,n){q.fillStyle="#FFFFFF";q.strokeStyle="#222222";q.beginPath();q.arc(n.x,n.y,4,0,Math.PI*2,false);q.stroke();q.fill()}c=COG.extend({path:[],
id:COG.objId("pathAni"),easing:COG.easing("sine.inout"),validStates:C("ACTIVE","PAN","ZOOM"),drawIndicator:null,duration:2E3},c);var h=N.edges(c.path),b,d=null,i=0;COG.tweenValue(0,h.total,c.easing,function(){l.remove()},c.duration).requestUpdates(function(q,u){i=q;u&&l.remove()});var l=COG.extend(new fb(c),{cycle:function(){for(var q=0;q<h.accrued.length&&h.accrued[q]<i;)q++;d=null;if(q<c.path.length-1){var u=i-(q>0?h.accrued[q-1]:0),n=c.path[q];b=N.theta(n,c.path[q+1],h.edges[q]);d=N.extendBy(n,
b,u)}return d},draw:function(q,u){if(d)(c.drawIndicator?c.drawIndicator:p)(q,u,N.init(d.x,d.y),b)}});return l},vb=function(c){c=COG.extend({style:null,properties:{}},c);return COG.extend(c,{rect:null,draw:function(){},resync:function(){}})},qb=function(c,p){p=COG.extend({fill:false,simplify:false},p);var h=false,b=p.fill,d=p.simplify,i=C("ZOOM"),l=[],q=COG.extend(new vb(p),{draw:function(u,n,r,z,K,X){if(h){n=true;r=(X&i)!==0;u.beginPath();for(X=l.length;X--;){r=l[X].x;z=l[X].y;if(n){u.moveTo(r,z);
n=false}else u.lineTo(r,z);r=true}if(r){b&&u.fill();u.stroke()}}},resync:function(u){q.xy=u.syncXY(c);l=N.floor(d?N.simplify(c):c)}});h=c&&c.length>=2;return q},wb=function(c){function p(i){for(var l=b.length;l--;)b[l].resync(i);b.sort(function(q,u){var n=u.xy.y-q.xy.y;if(n===0)n=u.xy.x-q.xy.y;return n});d.changed()}function h(i,l){l.syncXY&&p(l)}c=COG.extend({zindex:80},c);var b=[],d=COG.extend(new fb(c),{add:function(i){b[b.length]=i},each:function(i){for(var l=b.length;l--;)i(b[l])},draw:function(i,
l,q){var u=l.x1,n=l.y1,r=l.width;l=l.height;for(var z=b.length;z--;){var K=b[z].style;K=K?$a.apply(i,K):null;b[z].draw(i,u,n,r,l,q);K&&$a.apply(i,K)}}});d.bind("parentChange",h);d.bind("resync",h);return d},Bb=function(){return{tileSize:256,init:function(c,p,h,b,d){return COG.extend({x:c,y:p,width:h,height:b},d)}}}(),xb=function(c){function p(W,t,M,aa){function V(){if(X.initTileCreator){q=true;X.initTileCreator(W,t,M,aa)}}X.prepTileCreator?X.prepTileCreator(W,t,M,V):V()}function h(W,t){for(var M=
~~((W.x1-i.x)/u),aa=~~((W.y1-i.y)/n),V=[],xa=-l;xa<z;xa++)for(var Ma=-l;Ma<K;Ma++){var T=r(M+xa,aa+Ma);if(T)V[V.length]=T}t&&t(V);d=ma.copy(W)}c=COG.extend({tileWidth:256,tileHeight:256,relative:false,padding:2},c);var b=null,d=null,i=N.init(),l=c.padding,q=false,u=c.tileWidth,n=c.tileHeight,r=null,z=0,K=0,X={bindToView:function(W){COG.info("initializing generator");b=W;X.trigger("bindView",W)},getTileCreatorArgs:null,initTileCreator:null,prepTileCreator:null,requireRefresh:function(){return false},
reset:function(){r=null;q=false;d=null},run:function(W,t){if(!d||Math.abs(W.x1-d.x1)>u||Math.abs(W.y1-d.y1)>n){if(!r&&!q||X.requireRefresh()){i=c.relative?N.init(W.x1,W.y1):N.init();z=Math.ceil(W.width/u)+l;K=Math.ceil(W.height/n)+l;p(u,n,X.getTileCreatorArgs?X.getTileCreatorArgs(b):{},function(M){r=M;q=false;h(W,t)})}r&&h(W,t)}}};COG.observable(X);X.bind("update",function(){COG.info("captured generator update");d=null});return X},Ra={ex:COG.extend,ticks:ia,getConfig:Z,userMessage:function(c,p,h){Ra.trigger("userMessage",
c,p,h)},zoomable:B,XY:N,XYRect:ma,Dimensions:Ta,Vector:w,D:Ta,Images:Ga,Generator:Ua,tween:COG.tween,tweenValue:COG.tweenValue,easing:COG.easing,Tween:COG.Tween,Style:$a,viewState:C,View:tb,ViewLayer:fb,ImageLayer:function(c,p){function h(n,r,z){for(r=i.length;r--;){var K=i[r],X=K.x,W=K.y,t=ma.init(K.x,K.y,K.x+K.width,K.y+K.height);if(z&&ma.intersect(n,t)){t=Ga.get(K.url,function(){u.changed()},q);z(t,X,W,K.width,K.height)}}}function b(n){d&&d.run(n,function(r){i=[].concat(r);u.changed()})}p=COG.extend({imageLoadArgs:{}},
p);var d=c?Ua.init(c,p):null,i=[],l=ma.init(),q=p.imageLoadArgs,u=COG.extend(new fb(p),{changeGenerator:function(n,r){d=Ua.init(n,COG.extend({},p,r));d.bindToView(u.getParent());i=null;b(l)},clip:function(n,r,z){h(r,z,function(K,X,W,t,M){K&&n.rect(X,W,t,M)})},cycle:function(n,r){b(r)},draw:function(n,r,z){h(r,z,function(K,X,W,t,M){u.drawImage(n,K,X,W,t,M,r,z)});l=ma.copy(r)},drawImage:function(n,r,z,K){r&&n.drawImage(r,z,K,r.width,r.height)}});u.bind("idle",function(){b(l)});u.bind("parentChange",
function(n,r){d&&d.bindToView(r)});u.bind("tap",function(n,r,z,K){n=[];var X=K.x,W=K.y,t,M;if(i)for(var aa=i.length;aa--;){t=i[aa];if(M=X>=t.x&&X<=t.x+t.width&&W>=t.y&&W<=t.y+t.height)n[n.length]=t}n.length>0&&u.trigger("tapImage",n,r,z,K)});return u},Marker:pb,ImageMarker:function(c){c=COG.extend({image:null,imageUrl:null,animatingImage:null,animatingImageUrl:null,imageAnchor:null,rotation:0,scale:1,opacity:1},c);var p=c.imageAnchor?T5.XY.invert(c.imageAnchor):null,h=COG.extend(new pb(c),{drawMarker:function(b,
d,i,l){if((d=h.isAnimating()&&h.animatingImage?h.animatingImage:h.image)&&d.width>0){p||(p=N.init(-d.width>>1,-d.height>>1));var q=h.scale,u=i+~~(p.x*q),n=l+~~(p.y*q),r=~~(d.width*q),z=~~(d.height*q);h.updateBounds(u,n,r,r);if(h.rotation||h.opacity!==1){b.save();try{b.globalAlpha=h.opacity;b.translate(i,l);b.rotate(h.rotation);b.drawImage(d,p.x*q,p.y*q,r,z)}finally{b.restore()}}else b.drawImage(d,u,n,r,z)}}});if(!h.image)h.image=Ga.get(c.imageUrl,function(b){h.image=b});if(!h.animatingImage)h.animatingImage=
Ga.get(c.animatingImageUrl,function(b){h.animatingImage=b});return h},MarkerLayer:ob,PathLayer:function(c){c=COG.extend({style:"waypoints",pixelGeneralization:8,zindex:50},c);var p=false,h=[],b=null,d=[],i=null,l=0,q=[],u=COG.extend(new fb(c),{getAnimation:function(n,r,z,K){var X="pathAnimation"+l++;q.push(X);return new ub({id:X,path:h,zindex:c.zindex+1,easing:n?n:COG.easing("sine.inout"),duration:r?r:5E3,drawIndicator:z,autoCenter:K?K:false})},cycle:function(n,r,z,K){return K},draw:function(n){var r,
z=h.length;n.save();try{$a.apply(n,c.style);if(z>0){n.beginPath();n.moveTo(h[z-1].x,h[z-1].y);for(r=z;r--;)n.lineTo(h[r].x,h[r].y);n.stroke();if(b){n.fillStyle=c.waypointFillStyle;for(r=b.length;r--;){n.beginPath();n.arc(b[r].x,b[r].y,2,0,Math.PI*2,false);n.stroke();n.fill()}}}}finally{n.restore()}p=false},updateCoordinates:function(n,r){d=n;i=r;var z=u.getParent();if(z&&z.syncXY){z.syncXY(d);i&&z.syncXY(i);u.trigger("tidy")}}});u.bind("tidy",function(){h=N.simplify(d,c.pixelGeneralization);b=N.simplify(i,
c.pixelGeneralization);p=true;u.changed()});return u},AnimatedPathLayer:ub,Shape:vb,Arc:function(c,p){p=COG.extend({size:4},p);var h=N.init(),b=COG.extend(p,{draw:function(d){d.beginPath();d.arc(h.x,h.y,b.size,0,Math.PI*2,false);d.fill();d.stroke()},resync:function(d){d.syncXY([c]);h=N.floor([c])[0]}});COG.info("created arc = ",c);return b},Poly:qb,ShapeLayer:wb,Tiling:Bb,TileGenerator:xb};COG.observable(Ra);var Sa=Ra.Geo=function(){function c(g){g=parseFloat(g)*W;g=ua(g);var e=M*g;return ta((1+g)/
(1-g)*P((1-e)/(1+e),M))/2}function p(g){return parseFloat(g)*W}function h(g){g=P(Math.E,-g);for(var e=f-2*wa(g),k=i(e,g),o=0;o<V&&s(e-k)>aa;){e=k;k=i(e,g);o++}return k*t}function b(g){return g%360*t}function d(g,e){var k=null;for(var o in engines)if(e){if(o==e&&engines[o][g]){k=engines[o];break}}else if(engines[o][g]){k=engines[o];break}return k}function i(g,e){var k=M*ua(g);return f-2*wa(e*P((1-k)/(1+k),M/2))}function l(g,e,k,o){e=u(e);g.add(o.line(e,k));return e.length}function q(g,e,k,o){e=u(e);
g.add(o.poly(e,k));return e.length}function u(g){var e=g?g.length:0,k=Array(e);for(e=e;e--;)k[e]=Sa.Position.init(g[e][1],g[e][0]);return Sa.Position.vectorize(k,jb)}function n(g,e,k){return new Xa(g,e,k)}var r=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],z=-f,K=f,X=-H,W=Math.PI/180,t=180/Math.PI,M=0.08181919084262157,aa=1.0E-7,V=12,xa=null,Ma={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",HWY:"HIGHWAY",MWY:"MOTORWAY"},T=function(){function g(a){return a?
k(a.lat,a.lon):null}function e(a){return!a||a.lat===0&&a.lon===0}function k(a,j){return{lat:parseFloat(a?a:0),lon:parseFloat(j?j:0)}}function o(a){if(a)if(typeof a.lat!=="undefined")return g(a);else{if(a.split)for(var j=[" ",","],m=0;m<j.length;m++){var F=a.split(j[m]);if(F.length===2)return k(F[0],F[1])}}else return k();return null}return{calcDistance:function(a,j){if(e(a)||e(j))return 0;var m=(j.lat-a.lat)*W>>1,F=(j.lon-a.lon)*W>>1;m=ua(m)*ua(m)+Ea(a.lat*W)*Ea(j.lat*W)*ua(F)*ua(F);return 6371*2*
Fa(la(m),la(1-m))},copy:g,empty:e,equal:function(a,j){return a&&j&&a.lat==j.lat&&a.lon==j.lon},fromMercatorPixels:function(a,j){return k(h(j),b(a))},generalize:function(a,j,m){var F=a.length,I=[],ca=null;m||(m=250);m/=1E3;COG.info("generalizing positions, must include "+j.length+" positions");for(var ka=F;ka--;)if(ka===0)I.unshift(a[ka]);else{var ra=!ca||T.inArray(a[ka],j)?m:T.calcDistance(ca,a[ka]);if(a[ka]&&ra>=m){I.unshift(a[ka]);ca=a[ka]}}COG.info("generalized "+F+" positions into "+I.length+
" positions");return I},inArray:function(a,j){for(var m=T.equal,F=j.length;F--;)if(m(a,j[F]))return true;return false},inBounds:function(a,j){var m=!(T.empty(a)||T.empty(j));return m=(m=m&&a.lat>=j.min.lat&&a.lat<=j.max.lat)&&a.lon>=j.min.lon&&a.lon<=j.max.lon},init:k,offset:function(a,j,m){var F=a.lat*W;a=a.lon*W;j=F+j/6371;m=Ja(ua(m/6371)/Ea(F));m=a+m;j=(j+f)%Math.PI-f;m%=H;return k(j*t,m*t)},parse:o,parseArray:function(a){var j=a.length,m=Array(j);for(j=j;j--;)m[j]=o(a[j]);return m},toMercatorPixels:function(a){return T5.XY.init(p(a.lon),
c(a.lat))},toString:function(a){return a?a.lat+" "+a.lon:""},vectorize:function(a,j){var m=a.length,F=Array(m);j=COG.extend({chunkSize:500,async:true},j);if(!j.async){for(var I=m;I--;)F[I]=T5.GeoXY.init(a[I]);return F}return COG.Loopage.join({frequency:10,execute:function(ca,ka){for(var ra=0,Ca=j.chunkSize,Q=m;Q--;){F[Q]=T5.GeoXY.init(a[Q]);ra+=1;if(ra>Ca)break}m=Q;m<=0&&ka.trigger("complete",F)}})}}}(),Da=function(){function g(a,j,m){var F=T5.XY.init(0,j.lat-a.lat);if(typeof m==="undefined")m=true;
F.x=m&&a.lon>j.lon?360-a.lon+j.lon:j.lon-a.lon;return F}function e(a,j){return Da.init(T.init(a.min.lat-j,a.min.lon-j%360),T.init(a.max.lat+j,a.max.lon+j%360))}function k(a){var j=g(a.min,a.max);return T.init(a.min.lat+(j.y>>1),a.min.lon+(j.x>>1))}function o(a,j){return{min:T.parse(a),max:T.parse(j)}}return{calcSize:g,createBoundsFromCenter:function(a,j){var m=j/6371,F=a.lat*W,I=a.lon*W,ca=F-m,ka=F+m;if(ca>z&&ka<K){F=Ja(ua(m)/Ea(F));m=(I-F)%H;I=(I+F)%H}else{ca=S(ca,z);ka=y(ka,K);m=X;I=H}return Da.init(T.init(ca*
t,m*t),T.init(ka*t,I*t))},expand:e,forPositions:function(a,j){var m=null,F=T5.ticks();j||(j="auto");for(var I=a.length;I--;)if(m){var ca=g(m.min,a[I],false),ka=g(a[I],m.max,false);if(ca.x<0)m.min.lon=a[I].lon;if(ca.y<0)m.min.lat=a[I].lat;if(ka.x<0)m.max.lon=a[I].lon;if(ka.y<0)m.max.lat=a[I].lat}else m=o(a[I],a[I]);if(j){if(j=="auto"){I=g(m.min,m.max);j=S(I.x,I.y)*0.3}m=e(m,j)}COG.trace("calculated bounds for "+a.length+" positions",F);return m},getCenter:k,getGeoHash:function(a){var j=T5.Geo.GeoHash.encode(a.min.lat,
a.min.lon);a=T5.Geo.GeoHash.encode(a.max.lat,a.max.lon);COG.info("min hash = "+j+", max hash = "+a)},getZoomLevel:function(a,j){var m=k(a);m=y(Ia(s(m.lat)*0.05),r.length);var F=r[m],I=g(a.min,a.max);m=v(ta(r[3]*j.height/I.y)/ta(2));F=v(ta(F*j.width/I.x)/ta(2));return y(isNaN(m)?1E3:m,isNaN(F)?1E3:F)},init:o,isEmpty:function(a){return!a||T.empty(a.min)||T.empty(a.max)},toString:function(a){return"min: "+T.toString(a.min)+", max: "+T.toString(a.max)}}}(),za=function(){var g=/^(\d+).*$/,e=/(\d+)\s?\-\s?(\d+)/;
return{buildingMatch:function(k,o){g.lastIndex=-1;if(g.test(k))for(var a=k.replace(g,"$1"),j=o.split(","),m=0;m<j.length;m++){e.lastIndex=-1;if(e.test(j[m])){var F=e.exec(j[m]);if(a>=parseInt(F[1],10)&&a<=parseInt(F[2],10))return true}else if(a==j[m])return true}return false},normalize:function(k){if(!k)return"";k=k.toUpperCase();if(!xa){var o=[];for(var a in Ma)o.push(a);xa=RegExp("(\\s)("+o.join("|")+")(\\s|$)","i")}xa.lastIndex=-1;if(o=xa.exec(k))k=k.replace(xa,"$1"+Ma[o[2]]);return k},toString:function(k){return k.streetDetails+
" "+k.location}}}(),ba=Ra.GeoXY=function(){function g(k,o){if(k.length){for(var a,j,m,F,I=k.length;I--;){g(k[I],o);a=typeof a==="undefined"||k.x<a?k.x:a;j=typeof j==="undefined"||k.y<j?k.y:j;m=typeof m==="undefined"||k.x>m?k.x:m;F=typeof F==="undefined"||k.y>F?k.y:F}return ma.init(a,j,F,F)}else if(k.mercXY){a=k.mercXY;k.x=~~(a.x/o);k.y=~~((Math.PI-a.y)/o);k.rpp=o}else COG.warn("Attempted to sync an XY composite, not a GeoXY");return k}function e(k,o,a){k.pos=o;k.mercXY=T.toMercatorPixels(o);(a=typeof a!==
"undefined"?a:k.rpp)&&g(k,a)}return{init:function(k,o){var a=N.init();e(a,k,o);return a},sync:g,toPos:function(k,o){o=o?o:self.rpp;return T.fromMercatorPixels(k.x*o,Math.PI-k.y*o)},updatePos:e}}();Ra.GeoVector=function(g){COG.warn("The T5.Geo.GeoVector class has been deprecated, please use T5.GeoXY.init instead");return ba.init(g)};var nb=function(){return{bestResults:function(g,e){e||(e=20);for(var k=g.length>0?g[0]:null,o=[],a=0;a<g.length;a++)if(k&&g[a]&&k.matchWeight-g[a].matchWeight<=e)o.push(g[a]);
else break;return o}}}(),kb=function(g){g=COG.extend({id:null,caption:"",resultType:"",data:null,pos:null,matchWeight:0},g);return COG.extend(g,{toString:function(){return g.caption+(g.matchWeight?" ("+g.matchWeight+")":"")}})},mb=function(){var g={calculate:function(e){e=COG.extend({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},e);var k=T5.Geo.getEngine("route");k&&k.route(e,function(o){if(e.generalize)o.geometry=T5.Geo.Position.generalize(o.geometry,o.getInstructionPositions());
if(e.map){g.createMapOverlay(e.map,o);e.autoFit&&e.map.gotoBounds(o.boundingBox)}e.success&&e.success(o)})},createMapOverlay:function(e,k){var o=e.getDimensions();o=new T5.Geo.UI.RouteOverlay({data:k,width:o.width,height:o.height});e.setLayer("route",o)},parseTurnType:function(e){for(var k=g.TurnType.Unknown,o=T5.Geo.Routing.TurnTypeRules,a=0;a<o.length;a++){o[a].regex.lastIndex=-1;var j=o[a].regex.exec(e);if(j){k=o[a].customCheck?o[a].customCheck(e,j):o[a].turnType;break}}return k},TurnType:{Unknown:"turn-unknown",
Start:"turn-none-start",Continue:"turn-none",Arrive:"turn-none-arrive",TurnLeft:"turn-left",TurnLeftSlight:"turn-left-slight",TurnLeftSharp:"turn-left-sharp",TurnRight:"turn-right",TurnRightSlight:"turn-right-slight",TurnRightSharp:"turn-right-sharp",Merge:"merge",UTurnLeft:"uturn-left",UTurnRight:"uturn-right",EnterRoundabout:"roundabout-enter",Ramp:"ramp",RampExit:"ramp-exit"},Instruction:function(e){var k=e=COG.extend({position:null,description:"",distance:0,distanceTotal:0,time:0,timeTotal:0,
turnType:null},e),o=e.description;o=o.replace(/(\w)(\/)(\w)/g,"$1 $2 $3");k.description=o;if(!e.turnType)e.turnType=g.parseTurnType(e.description);return e},RouteData:function(e){e=COG.extend({geometry:[],instructions:[],boundingBox:null},e);if(!e.boundingBox)e.boundingBox=T5.Geo.BoundingBox.forPositions(e.geometry);return COG.extend({getInstructionPositions:function(){for(var k=[],o=0;o<e.instructions.length;o++)e.instructions[o].position&&k.push(e.instructions[o].position);return k}},e)}};return g}(),
Aa="featurecollection",Ba="feature",jb={async:false},Ya={processor:null,group:"shapes",layerClass:wb},eb={point:COG.extend({},Ya,{processor:function(g,e,k,o){e=u([e.coordinates],jb);if(e.length>0)if(k=o.marker(e[0],k)){g.add(k);return e.length}},group:"markers",layerClass:ob}),linestring:COG.extend({},Ya,{processor:function(g,e,k,o){e=u(e&&e.coordinates?e.coordinates:[]);return l(g,e,k,o)}}),multilinestring:COG.extend({},Ya,{processor:function(g,e,k,o){e=e&&e.coordinates?e.coordinates:[];for(var a=
0,j=e.length;j--;)a+=l(g,e[j],k,o);return a}}),polygon:COG.extend({},Ya,{processor:function(g,e,k,o){e=e&&e.coordinates?e.coordinates:[];if(e.length>0)return q(g,e[0],k,o);return 0}}),multipolygon:COG.extend({},Ya,{processor:function(g,e,k,o){e=e&&e.coordinates?e.coordinates:[];for(var a=0,j=0;j<e.length;j++)a+=q(g,e[j][0],k,o);return a}})},Xa=function(g,e,k,o){function a($,ga){var na=$.processor,qa=I+$.group,fa=COG.extend({},$,k,{properties:ga.properties});if(na){var Qa=Q[qa];if(!Qa){Qa=new $.layerClass({id:qa});
Q[qa]=Qa}globalLayers=Q;return na(Qa,ga.data,fa,o)}return 0}function j($,ga){var na=$&&$.type?$.type.toLowerCase():null;return na&&na===Ba?j($.geometry,$.properties):{type:na,isCollection:na?na===Aa:false,definition:eb[na],data:$,properties:ga?ga:$.properties}}k=COG.extend({vectorsPerCycle:Sa.VECTORIZE_PER_CYCLE,rowPreParse:null,simplify:false,layerPrefix:"geojson-"},k);o=COG.extend({marker:function($){return new pb({xy:$})},line:function($,ga){return new qb($,ga)},poly:function($,ga){return new qb($,
COG.extend({fill:true},ga))}},o);var m=k.vectorsPerCycle,F=k.rowPreParse,I=k.layerPrefix,ca=0,ka=0,ra=null,Ca=0,Q={},O;if(!g)return null;if(typeof g.length==="undefined")g=[g];ka=g.length;O=COG.Loopage.join({frequency:10,execute:function($,ga){var na=0,qa=ca;if(!ra){for(;qa<ka;qa++){var fa=j(F?F(g[qa]):g[qa]),Qa=null;if(fa.isCollection){Ca+=1;ra=n(fa.data.features,function(db){ra=null;for(var Na in db)Q[Na]=db[Na]},{layerPrefix:I+Ca+"-"});Qa+=1}else if(fa.definition)Qa=a(fa.definition,fa);na+=Qa?
Qa:1;if(na>=m)break}ca=qa+1;!ra&&ca>=ka&&ga.trigger("complete")}}});O.bind("complete",function(){e&&e(Q)});return O};Ra.GeoJSON={parse:n};Ra.Map=function(g){function e(O){try{var $=Sa.Position.init(O.coords.latitude,O.coords.longitude),ga=O.coords.accuracy/1E3;Q.trigger("locationUpdate",O,ga);if(ka){if(!I){I=new Sa.UI.LocationOverlay({pos:$,accuracy:ga});I.update(Q.getTileLayer());Q.setLayer("location",I)}var na=Sa.BoundingBox.createBoundsFromCenter($,Math.max(ga,1));Q.gotoBounds(na)}else{I.pos=$;
I.accuracy=ga;I.update(Q.getTileLayer());a($,null,COG.easing("sine.out"))}ka=false}catch(qa){COG.exception(qa)}}function k(O){COG.info("caught location tracking error:",O)}function o(O,$,ga){Q.setZoomLevel($);Ga.cancelLoad();COG.endTweens();a(O,ga)}function a(O,$,ga,na){O=ba.init(O,Sa.radsPerPixel(Q.getZoomLevel()));var qa=Q.getDimensions();Q.updateOffset(O.x-(qa.width>>1),O.y-(qa.height>>1),ga,na,$);Q.trigger("wake");Q.trigger("boundsChange",Q.getBoundingBox());$&&typeof ga==="undefined"&&$(Q)}g=
COG.extend({tapExtent:10,crosshair:false,zoomLevel:0,boundsChangeThreshold:30},g);var j={NONE:0,SINGLE:1,WATCH:2},m=N.init(),F=j.NONE,I=null,ca=0,ka=true,ra=0,Ca=g.tapExtent;g.adjustScaleFactor=function(O){return Math.pow(2,(O<1?Math.floor:Math.ceil)(Math.log(O)))};var Q=COG.extend(new tb(g),{getBoundingBox:function(){var O=Q.getViewRect();return Sa.BoundingBox.init(ba.toPos(N.init(O.x1,O.y2),ra),ba.toPos(N.init(O.x2,O.y1),ra))},getCenterPosition:function(){var O=Q.getViewRect();if(O){O=N.init(O.x1+
(O.width>>1),O.y1+(O.height>>1));return ba.toPos(O,ra)}return null},gotoBounds:function(O,$){var ga=Sa.BoundingBox.getZoomLevel(O,Q.getDimensions());o(Sa.BoundingBox.getCenter(O),ga,$)},gotoPosition:o,panToPosition:a,syncXY:function(O){return ba.sync(O,ra)},locate:function(){Q.trackStart(j.SINGLE);setTimeout(Q.trackCancel,1E4)},trackStart:function(O){if(navigator.geolocation&&!ca){F=O?O:j.WATCH;ka=true;ca=navigator.geolocation.watchPosition(e,k,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3})}},
trackCancel:function(){ca&&navigator.geolocation&&navigator.geolocation.clearWatch(ca);Q.removeLayer("location");I=null;F=j.NONE;ca=0},animateRoute:function(O,$,ga,na){var qa=Q.getLayer("route");if(qa)(O=qa.getAnimation(O,$,ga,na))&&O.addToView(Q)}});Q.bind("pan",function(){F===j.SINGLE&&Q.trackCancel()});Q.bind("tap",function(O,$,ga,na){var qa=Sa.radsPerPixel(Q.getZoomLevel());O=ba.toPos(na,qa);var fa=ba.toPos(N.offset(na,-Ca,Ca),qa);na=ba.toPos(N.offset(na,Ca,-Ca),qa);Q.trigger("geotap",$,ga,O,
Da.init(fa,na))});Q.bind("refresh",function(){if(N.absSize(N.diff(m,Q.getOffset()))>g.boundsChangeThreshold){m=N.copy(Q.getOffset());Q.trigger("boundsChange",Q.getBoundingBox())}});B(Q,g);Q.bind("zoomLevelChange",function(O,$){ra=Sa.radsPerPixel($);Q.triggerAll("resync",Q)});return Q};Ra.MapTileGenerator=function(g){function e(j,m){var F=m>=a.minLevel&&(!a.maxLevel||m<=a.maxLevel);COG.info("new zoom level = "+m+", zoom ok = "+F);j.cancel=!F;if(F){k=m;a.reset()}}g=COG.extend({relative:true},g);var k=
0,o=null,a=COG.extend(new xb(g),{minLevel:2,maxLevel:20,getTileCreatorArgs:function(j){o=j.getCenterPosition();return{zoomLevel:k,position:o}},requireRefresh:function(){return!o}});a.bind("bindView",function(j,m){if(m.getZoomLevel){k=m.getZoomLevel();m.bind("zoomLevelChange",e)}});return a};Ra.GeoPoly=function(g,e){e=COG.extend({autoParse:true},e);for(var k=Array(g.length),o=e.autoParse,a=T5.Geo.Position.parse,j=g.length;j--;)k[j]=T5.GeoXY.init(o?a(g[j]):g[j]);return new T5.Poly(k,e)};Ra.RouteOverlay=
function(g){g=COG.extend({data:null,pixelGeneralization:8,partialDraw:false,strokeStyle:"rgba(0, 51, 119, 0.9)",waypointFillStyle:"#FFFFFF",lineWidth:4,zindex:50},g);var e=[],k=[],o=new T5.PathLayer(g);(function(){if(g.data&&g.data.instructions){for(var a=g.data.instructions,j=Array(a.length),m=a.length;m--;)j[m]=a[m].position;T5.Geo.Position.vectorize(j).bind("complete",function(F,I){k=I})}g.data&&g.data.geometry&&T5.Geo.Position.vectorize(g.data.geometry).bind("complete",function(F,I){e=I;o.updateCoordinates(e,
k,true)})})();return o};Ra.LocationOverlay=function(g){g=COG.extend({pos:null,accuracy:null,zindex:90},g);var e=new Image,k=T5.XY.init(),o=T5.XY.init(),a=null;e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAACIQAAAiEBPhEQkwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAG+SURBVCiRlZHNahNRAIW/O7mTTJPahLZBA1YUyriINRAE3bQIKm40m8K8gLj0CRQkO32ELHUlKbgoIu4EqeJPgtCaoBuNtjXt5LeTMZk0mbmuWiuuPLsD3+HAOUIpxf9IHjWmaUbEyWv5ROrsVULhcHP761rUfnN3Y2Otc8CIg4YT85lzuVsPP+Qupw1vpPjRCvhS9ymvV0e77x7nNj+uvADQAIQQ+uLyvdfLV9JGZi7EdEwQlqBpEJ019f0z1mo2u5Q8DMydv25lshemmj1FueZTawbs7inarqLbV7Qjab1upB9YlhWSAHLavLHZCvg1VEhN0PMU9W7At4bPVidg7CtkLLXkut+lBPD6/Ub155jJiADAHSpaLmx3ApyBQoYEUd0PBoOBkAC6+3llvda/YxgGgYL+UNHf/zN3KiExGlsvTdP0NYDkhPdWrz35ZDsBzV5wCMuQwEyFmXFeeadjzfuFQmGkAZRKpdGC/n7x+M6jqvA9Zo6FWDhlcHE+wqT93J1tP7vpOE7rrx8ALMuasPf8S12St4WmJ6bYWTUC52k8Hm8Vi0X/nwBAPp/XKpWKdF1X2LYdlMvlsToC/QYTls7DLFr/PAAAAABJRU5ErkJggg%3D%3D";
e.onload=function(){k=T5.XY.init(e.width>>1,e.height>>1)};var j=COG.extend(new T5.ViewLayer(g),{pos:g.pos,accuracy:g.accuracy,drawAccuracyIndicator:false,draw:function(m,F){var I=o.x-F.x,ca=o.y-F.y;if(a){m.fillStyle="rgba(30, 30, 30, 0.2)";m.beginPath();m.arc(I,ca,a,0,Math.PI*2,false);m.fill()}e.complete&&e.width>0&&m.drawImage(e,I-k.x,ca-k.y,e.width,e.height);j.changed()},update:function(m){if(m){a=m.getPixelDistance(j.accuracy)>>1;o=m.getGridXYForPosition(j.pos);j.changed()}}});j.bind("gridUpdate",
function(m,F){j.update(F)});return j};return{distanceToString:function(g){if(g>1E3)return~~(g/10)/100+" km";return g?g+" m":""},dist2rad:function(g){return g/6371},getEngine:function(g){for(var e=null,k=1;!e&&k<arguments.length;k++)e=d(g,arguments[k]);e=e?e:d(g);if(!e)throw Error("Unable to find GEO engine with "+g+" capability");return e},lat2pix:c,lon2pix:p,pix2lat:h,pix2lon:b,radsPerPixel:function(g){return H/(256<<g)},Position:T,BoundingBox:Da,Radius:function(g,e){return{distance:parseInt(g,10),
uom:e}},Address:function(g){return g=COG.extend({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},g)},A:za,GeocodeFieldWeights:{streetDetails:50,location:50},AddressCompareFns:{},Engine:function(g){if(!g.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var e=COG.extend({remove:function(){delete engines[e.id]}},g);return engines[e.id]=e},Search:nb,GeoSearchResult:kb,LocationSearch:function(g){function e(m,F){navigator.geolocation.clearWatch(o);
o=0;if(a){clearTimeout(a);a=0}F&&F([m],g)}function k(m){COG.info("caught location tracking error:",m)}g=COG.extend({name:"Geolocation Search",requiredAccuracy:null,searchTimeout:5E3,watch:false},g);var o=0,a=0,j=null;return new T5.Geo.GeoSearchAgent(COG.extend({execute:function(m,F){if(navigator.geolocation&&!o){o=navigator.geolocation.watchPosition(function(I){var ca=T.init(I.coords.latitude,I.coords.longitude);I=new kb({id:1,caption:"Current Location",pos:ca,accuracy:I.coords.accuracy/1E3,matchWeight:100});
if(!j||I.accuracy<j.accuracy)j=I;if(!g.requiredAccuracy||j.accuracy<g.requiredAccuracy)e(j,F)},k,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3});if(g.searchTimeout)a=setTimeout(function(){j&&e(j,F)},g.searchTimeout)}}},g))},Routing:mb}}();return Ra}();
