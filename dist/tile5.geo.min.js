COG=typeof COG!=="undefined"?COG:{};COG.extend=function(){for(var ja=arguments[0]||{},sa,L=1,J=arguments.length;L<J;L++)if((sa=arguments[L])!==null)for(var z in sa){var C=sa[z];if(ja!==C)if(C!==undefined)ja[z]=C}return ja};
(function(){var ja=Object.prototype.hasOwnProperty,sa=0,L={};L.toID=function(J){return J.replace(/\s/g,"-")};L.objId=function(J){return(J?J:"obj")+sa++};L.isFunction=function(J){return toString.call(J)==="[object Function]"};L.isArray=function(J){return toString.call(J)==="[object Array]"};L.isPlainObject=function(J){if(!J||toString.call(J)!=="[object Object]"||J.nodeType||J.setInterval)return false;if(J.constructor&&!ja.call(J,"constructor")&&!ja.call(J.constructor.prototype,"isPrototypeOf"))return false;
var z;for(z in J);return z===undefined||ja.call(J,z)};L.isEmptyObject=function(J){for(var z in J)return false;return true};L.isXmlDocument=function(J){return toString.call(J)==="[object Document]"};L.contains=function(J,z){var C=J,G=arguments,S=1;if(z&&module.isArray(z)){G=z;S=0}for(S=S;S<G;S++)C=C&&typeof foo[G[S]]!=="undefined";return C};L.formatStr=function(J){if(arguments.length<=1)return J;for(var z=arguments.length-2,C=0;C<=z;C++)J=J.replace(RegExp("\\{"+C+"\\}","gi"),arguments[C+1]);return J};
L.wordExists=function(J,z){var C="";if(z.toString)z=z.toString();for(var G=0;G<z.length;G++)C+=!/\w/.test(z[G])?"\\"+z[G]:z[G];return RegExp("(^|\\s|\\,)"+C+"(\\,|\\s|$)","i").test(J)};COG.extend(COG,L)})();
(function(){function ja(C){return typeof console!=="undefined"?function(){console[C](Array.prototype.slice.call(arguments,0).join(" "));return true}:function(){return false}}var sa=window.console&&window.console.markTimeline,L=ja("error"),J=ja("info"),z=function(){return sa?function(C,G){console.markTimeline(C+(G?": "+((new Date).getTime()-G)+"ms":""))}:function(){}}();COG.extend(COG,{trace:z,debug:ja("debug"),info:J,warn:ja("warn"),error:L,exception:function(C){if(L)for(var G in C)J("ERROR DETAIL: "+
G+": "+C[G])}})})();
COG.Loopage=function(){function ja(u){return COG.extend({id:C++,frequency:0,after:0,single:false,lastTick:0,execute:function(){}},u)}function sa(u){S.push(u);L()}function L(){ta&&clearTimeout(ta);ta=setTimeout(J,0);M=true}function J(){for(var u,H=(new Date).getTime(),$=G.length;S.length>0;){var ca=S.shift();for(u=$;u--;)if(G[u].id===ca){G.splice(u,1);break}M=true;$=G.length}if(M){ka=z;for(u=$;u--;)ka=G[u].frequency<ka?G[u].frequency:ka}for(u=$;u--;){ca=H-G[u].lastTick;if(G[u].lastTick===0||ca>=G[u].frequency){G[u].execute(H,
G[u]);G[u].lastTick=H;G[u].single&&G[u].trigger("complete")}}ta=$?setTimeout(J,ka):0}var z=6E4,C=0,G=[],S=[],ta=0,ka=z,M=true;return{join:function(u){var H=new ja(u);if(H.after>0)H.lastTick=(new Date).getTime()+H.after;COG.observable(H);H.bind("complete",function(){sa(H.id)});G.unshift(H);L();return H},leave:sa}}();
(function(){function ja(L,J){var z=L.obsHandlers;z[J]||(z[J]=[]);return z[J]}var sa=0;COG.observable=function(L){if(!L)return null;if(!L.obsHandlers)L.obsHandlers={};if(!(L.bind||L.trigger||L.unbind)){L.bind=function(J,z){var C="callback"+sa++;ja(L,J).unshift({fn:z,id:C});return C};L.trigger=function(J){var z=ja(L,J),C={cancel:false,name:J,tickCount:(new Date).getTime()},G;if(!z)return null;G=Array.prototype.slice.call(arguments,1);L.eventInterceptor&&L.eventInterceptor(J,C,G);G.unshift(C);for(var S=
z.length;S--&&!C.cancel;)z[S].fn.apply(self,G);return C};L.unbind=function(J,z){if(typeof J==="undefined")L.obsHandlers={};else for(var C=ja(L,J),G=0;C&&G<C.length;G++)if(C[G].id===z){C.splice(G,1);break}return L}}return L}})();
(function(){function ja(z,C){z[C]||(z[C]=function(G){return z.configure(C,G)})}function sa(z){z.gtConfId="configurable"+J++;z.gtConfig={};z.gtConfigFns=[];return z.gtConfig}var L={},J=0;COG.paramTweaker=function(z,C,G){return function(S,ta){if(typeof ta!=="undefined"){if(S in z)z[S]=ta;G&&S in G&&G[S](S,ta)}else return C&&S in C?C[S](S):z[S]}};COG.configurable=function(z,C,G,S){if(z){z.gtConfId||sa(z);var ta=z.gtConfId,ka=z.gtConfig,M=z.gtConfigFns;L[ta]=z;M.push(G);for(G=C.length;G--;){ka[C[G]]=
true;S&&ja(z,C[G])}if(!z.configure)z.configure=function(u,H){if(ka[u]){for(var $=M.length;$--;){var ca=M[$](u,H);if(typeof ca!=="undefined")return ca}return L[ta]}return null}}}})();
(function(){function ja(z){var C=document.createElement("script"),G=false;C.src=z;C.async=true;C.onload=C.onreadystatechange=function(){if(!G&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){G=true;C.onload=C.onreadystatechange=null;C&&C.parentNode&&C.parentNode.removeChild(C)}};L||(L=document.getElementsByTagName("head")[0]);L.appendChild(C)}var sa=0,L,J=this;COG.jsonp=function(z,C,G){z+=z.indexOf("?")>=0?"&":"?";var S="json"+ ++sa;J[S]=function(ta){C(ta);J[S]=null;
try{delete J[S]}catch(ka){}};ja(z+(G?G:"callback")+"="+S);return S}})();
(function(){function ja(g){if(u)return ka.length;u=true;try{for(var t=0;t<ka.length;)if(ka[t].isComplete()){ka[t].triggerComplete(false);ka.splice(t,1)}else{ka[t].update(g);t++}}finally{u=false}ka.length===0&&M.trigger("complete");return ka.length}function sa(){if(!M){M=COG.Loopage.join({execute:ja,frequency:20});M.bind("complete",function(){M=null})}}var L=1.70158,J=Math.PI/2,z=Math.abs,C=Math.pow,G=Math.sin,S=Math.asin,ta=Math.cos,ka=[],M=null,u=false,H={linear:function(g,t,v,A){return v*g/A+t},
backin:function(g,t,v,A){return v*(g/=A)*g*((L+1)*g-L)+t},backout:function(g,t,v,A){return v*((g=g/A-1)*g*((L+1)*g+L)+1)+t},backinout:function(g,t,v,A){return(g/=A/2)<1?v/2*g*g*(((L*=1.525)+1)*g-L)+t:v/2*((g-=2)*g*(((L*=1.525)+1)*g+L)+2)+t},bouncein:function(g,t,v,A){return v-H.bounceout(A-g,0,v,A)+t},bounceout:function(g,t,v,A){return(g/=A)<1/2.75?v*7.5625*g*g+t:g<2/2.75?v*(7.5625*(g-=1.5/2.75)*g+0.75)+t:g<2.5/2.75?v*(7.5625*(g-=2.25/2.75)*g+0.9375)+t:v*(7.5625*(g-=2.625/2.75)*g+0.984375)+t},bounceinout:function(g,
t,v,A){return g<A/2?H.bouncein(g*2,0,v,A)/2+t:H.bounceout(g*2-A,0,v,A)/2+v/2+t},cubicin:function(g,t,v,A){return v*(g/=A)*g*g+t},cubicout:function(g,t,v,A){return v*((g=g/A-1)*g*g+1)+t},cubicinout:function(g,t,v,A){if((g/=A/2)<1)return v/2*g*g*g+t;return v/2*((g-=2)*g*g+2)+t},elasticin:function(g,t,v,A,V,T){if(g==0)return t;if((g/=A)==1)return t+v;T||(T=A*0.3);if(!V||V<z(v)){V=v;v=T/4}else v=T/TWO_PI*S(v/V);return-(V*C(2,10*(g-=1))*G((g*A-v)*TWO_PI/T))+t},elasticout:function(g,t,v,A,V,T){var pa;if(g==
0)return t;if((g/=A)==1)return t+v;T||(T=A*0.3);if(!V||V<z(v)){V=v;pa=T/4}else pa=T/TWO_PI*S(v/V);return V*C(2,-10*g)*G((g*A-pa)*TWO_PI/T)+v+t},elasticinout:function(g,t,v,A,V,T){var pa;if(g==0)return t;if((g/=A/2)==2)return t+v;T||(T=A*0.3*1.5);if(!V||V<z(v)){V=v;pa=T/4}else pa=T/TWO_PI*S(v/V);if(g<1)return-0.5*V*C(2,10*(g-=1))*G((g*A-pa)*TWO_PI/T)+t;return V*C(2,-10*(g-=1))*G((g*A-pa)*TWO_PI/T)*0.5+v+t},quadin:function(g,t,v,A){return v*(g/=A)*g+t},quadout:function(g,t,v,A){return-v*(g/=A)*(g-2)+
t},quadinout:function(g,t,v,A){if((g/=A/2)<1)return v/2*g*g+t;return-v/2*(--g*(g-2)-1)+t},sinein:function(g,t,v,A){return-v*ta(g/A*J)+v+t},sineout:function(g,t,v,A){return v*G(g/A*J)+t},sineinout:function(g,t,v,A){return-v/2*(ta(Math.PI*g/A)-1)+t}},$=COG.Tween=function(g){g=COG.extend({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:ca("sine.out"),complete:null},g);var t=(new Date).getTime(),v=[],A=false,V=0,T=0,pa={isComplete:function(){return A},triggerComplete:function(Ba){g.complete&&
g.complete(Ba)},update:function(Ba){try{var ua=g.tweenFn(Ba-t,V,T,g.duration);if(g.target)g.target[g.property]=ua;for(var Fa=v.length;Fa--;)v[Fa](ua,void 0);if(A=t+g.duration<=Ba){if(g.target)g.target[g.property]=g.tweenFn(g.duration,V,T,g.duration);for(var ra=v.length;ra--;)v[ra](ua,true)}}catch(ya){COG.exception(ya)}},requestUpdates:function(Ba){v.push(Ba)}};V=g.target&&g.property&&g.target[g.property]?g.target[g.property]:g.startValue;if(typeof g.endValue!=="undefined")T=g.endValue-V;if(T==0)A=
true;sa();return pa};COG.tweenValue=function(g,t,v,A,V){g=new $({startValue:g,endValue:t,tweenFn:v,complete:A,duration:V});ka.push(g);return g};COG.tween=function(g,t,v,A,V,T){g=new $({target:g,property:t,endValue:v,tweenFn:A,duration:T,complete:V});ka.push(g);return g};COG.endTweens=function(g){if(!u){u=true;try{for(var t=0;t<ka.length;)if(!g||g(ka[t])){ka[t].triggerComplete(true);ka.splice(t,1)}else t++}finally{u=false}}};COG.getTweens=function(){return[].concat(ka)};var ca=COG.easing=function(g){return H[g.replace(/[\-\_\s\.]/g,
"").toLowerCase()]};COG.registerEasingType=function(g,t){H[g.replace(/[\-\_\s\.]/g,"").toLowerCase()]=t}})();
INTERACT=function(){function ja(M){return function(u,H,$){($?$:M?document.body:document).addEventListener(u,H,false)}}function sa(M){return function(u,H,$){($?$:M?document.body:document).removeEventListener(u,H,false)}}function L(M,u,H){(H?H:document).attachEvent("on"+M,u)}function J(M,u,H){(H?H:document).detachEvent("on"+M,u)}function z(M,u){return{x:M?M:0,y:u?u:0,count:1}}function C(M,u){ta.push(COG.extend({handler:null,checks:{},type:M},u))}function G(M){var u=0,H=0;if(M.offsetParent){do{u+=M.offsetLeft;
H+=M.offsetTop;M=M.offsetParent}while(M)}return{x:u,y:H}}function S(M,u){return{x:M.x-(u?u.x:0),y:M.y-(u?u.y:0)}}var ta=[],ka=function(M,u,H){function $(A,V,T,pa){ca.trigger("pan",pa.x,pa.y)}H=COG.extend({binder:null,unbinder:null,observable:null},H);for(var ca=H.observable,g=[],t={bind:function(){return ca.bind.apply(null,arguments)},pannable:function(A){COG.extend({inertia:true},A);ca.bind("pointerMove",$);return t},unbind:function(){ca.unbind();for(var A=0;A<g.length;A++)g[A].unbind();return t}},
v=0;v<u.length;v++)g.push(u[v](M,ca,H));return t};C("pointer",{handler:function(M,u,H){function $(n){var na=n.target?n.target:n.srcElement;if(T||na&&na===M)if(pa=n.button===0){ya=n.pageX?n.pageX:n.screenX;Ca=n.pageY?n.pageY:n.screenY;Ba=z(ya,Ca);ua=G(M);u.trigger("pointerDown",Ba,S(Ba,ua))}}function ca(n){var na=n.target?n.target:n.srcElement;Fa=n.pageX?n.pageX:n.screenX;ra=n.pageY?n.pageY:n.screenY;if(pa&&(T||na&&na===M))v("pointerMove")}function g(n){var na=n.target?n.target:n.srcElement;if(pa&&
n.button===0){pa=false;if(T||na&&na===M)v("pointerUp")}}function t(n){var na=n.target?n.target:n.srcElement;if(T||na&&na===M){na=n.detail?n.axis===2?-n.detail*A:0:n.wheelDeltaY;if(na!==0){var za=z(Fa,ra);u.trigger("zoom",za,S(za,G(M)),na/V);if(n.preventDefault){n.preventDefault();n.stopPropagation()}else n.cancelBubble&&n.cancelBubble()}}}function v(n){var na=z(Fa,ra);u.trigger(n,na,S(na,ua),z(Fa-ya,ra-Ca));ya=Fa;Ca=ra}H=COG.extend({inertia:false},H);var A=120,V=A*8,T=false,pa=false,Ba,ua,Fa,ra,ya,
Ca;H.binder("mousedown",$,false);H.binder("mousemove",ca,false);H.binder("mouseup",g,false);H.binder("click",function(n){var na=n.target?n.target:n.srcElement;if(T||na&&na===M){n=z(n.pageX?n.pageX:n.screenX,n.pageY?n.pageY:n.screenY);u.trigger("pointerTap",n,S(n,G(M)))}},false);H.binder("mousewheel",t,window);H.binder("DOMMouseScroll",t,window);return{unbind:function(){H.unbinder("mousedown",$,false);H.unbinder("mousemove",ca,false);H.unbinder("mouseup",g,false);H.unbinder("mousewheel",t,window);
H.unbinder("DOMMouseScroll",t,window)}}},checks:{touch:false}});C("pointer",{handler:function(M,u,H){function $(N){if(N.count<2)return 0;var W=N.x-N.next.x;N=N.y-N.next.y;return~~Math.sqrt(W*W+N*N)}function ca(N,W,ga){W=W?W:0;ga=ga?ga:0;for(var Ha={x:N.x-W,y:N.y-ga,id:N.id,count:N.count},Ia=Ha;N.next;){N=N.next;Ia=Ia.next={x:N.x-W,y:N.y-ga,id:N.id}}return Ha}function g(N,W){var ga=N[W?W:"touches"],Ha,Ia;if(ga.length===0)return null;Ia=Ha={x:ga[0].pageX,y:ga[0].pageY,id:ga[0].identifier,count:ga.length};
for(var Ja=1,ab=ga.length;Ja<ab;Ja++)Ia=Ia.next={x:ga[Ja].pageX,y:ga[Ja].pageY,id:ga[Ja].identifier};return Ha}function t(N){var W=N.target?N.target:N.srcElement;if(W&&W===M){ra=G(M);W=g(N,"changedTouches");var ga=ca(W,ra.x,ra.y);if(!Ca){ya=Ba;u.trigger("pointerDown",W,ga)}Sa&&u.trigger("pointerDownMulti",W,ga);Ca=g(N);if(Ca.count>1)na=$(Ca);Ga=1;za=ca(Ca)}}function v(N){var W=N.target?N.target:N.srcElement;if(W&&W===M){N.preventDefault();n=g(N);if(ya==Ba)ya=Math.abs(Ca.x-n.x)>T||Math.abs(Ca.y-n.y)>
T?pa:Ba;if(ya!=Ba){ya=n.count>1?Fa:ua;if(ya==Fa)if(Ca.count===1){Ca=ca(n);na=$(Ca)}else{N=$(n);if(Math.abs(na-N)<V)ya=ua;else{W=n.x;var ga=n.next.x,Ha=n.y,Ia=n.next.y,Ja=Ha<Ia?Ha:Ia;W={x:(W<ga?W:ga)+(Math.abs(W-ga)>>1),y:Ja+(Math.abs(Ha-Ia)>>1)};N=N/na;ga=N-Ga;u.trigger("zoom",W,S(W,ra),ga);Ga=N}}ya==ua&&u.trigger("pointerMove",n,ca(n,ra.x,ra.y),z(n.x-za.x,n.y-za.y));Sa&&u.trigger("pointerMoveMulti",n,ca(n,ra.x,ra.y))}za=ca(n)}}function A(N){var W=N.target?N.target:N.srcElement;if(W&&W===M){W=g(N,
"changedTouches");var ga=ca(W,ra.x,ra.y);n=g(N);if(!n){ya===Ba&&u.trigger("pointerTap",W,ga);u.trigger("pointerUp",W,ga);Ca=null}Sa&&u.trigger("pointerUpMulti",W,ga)}}H=COG.extend({detailed:false,inertia:false},H);var V=20,T=7,pa=0,Ba=1,ua=2,Fa=3,ra,ya,Ca,n,na,za,Sa=H.detailed,Ga=1;H.binder("touchstart",t,false);H.binder("touchmove",v,false);H.binder("touchend",A,false);COG.info("initialized touch handler");return{unbind:function(){H.unbinder("touchstart",t,false);H.unbinder("touchmove",v,false);
H.unbinder("touchend",A,false)}}},checks:{touch:true}});return{register:C,watch:function(M,u,H){u=COG.extend({bindToBody:false,observable:null,isIE:false,types:null},u);capabilities=COG.extend({touch:"ontouchstart"in window},H);if(!u.observable){COG.info("creating observable");u.observable=COG.observable({});globalOpts=u}u.binder=u.isIE?L:ja(u.bindToBody);u.unbinder=u.isIE?J:sa(u.bindToBody);H=u.types;for(var $=capabilities,ca=[],g=ta.length;g--;){var t=ta[g],v=!H||H.indexOf(t.type)>=0,A=true;for(var V in t.checks){var T=
t.checks[V];COG.info("checking "+V+" capability. require: "+T+", capability = "+$[V]);A=A&&T===$[V]}if(v&&A)ca[ca.length]=t.handler}return new ka(M,ca,u)}}}();
T5=function(){function ja(){return(new Date).getTime()}function sa(){for(;Ha.length>0;){var c=Ha.shift();document.location=c}ga=0}function L(c){for(var r=true,h=Ia.length;h--;)r=r&&c!=Ia[h];return r}function J(c,r){var h=[];for(var b in r)b&&h.push(b+"="+escape(r[b]));return"tile5://"+c+"/"+(h.length>0?"?"+h.join("&"):"")}function z(c,r){L(c)&&COG.info("would push url: "+J(c,r))}function C(c,r){if(L(c)){Ha.push(J(c,r));ga||(ga=setTimeout(sa,100))}}function G(c){return function(r,h,b){(b?b:c?document.body:
document).addEventListener(r,h,false)}}function S(c){return function(r,h,b){(b?b:c?document.body:document).removeEventListener(r,h,false)}}function ta(c,r,h){(h?h:document).attachEvent("on"+c,r)}function ka(c,r,h){(h?h:document).detachEvent("on"+c,r)}function M(){Ga={base:{name:"Unknown",bindEvent:G(),unbindEvent:S(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:z,targetFps:null},ie:{name:"MSIE",regex:/msie/i,
bindEvent:ta,unbindEvent:ka,requireFastDraw:false,targetFps:25},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:C,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:C},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:C},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:G(true),unbindEvent:S(true),supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},
bridgeNotify:C},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:C}};N=[Ga.froyo,Ga.android,Ga.ipod,Ga.iphone,Ga.ipad,Ga.ie]}function u(){Ga||M();if(!W){COG.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var c=0;c<N.length;c++){var r=N[c];if(r.regex&&r.regex.test(navigator.userAgent)){W=COG.extend({},Ga.base,r);COG.info("PLATFORM DETECTED AS: "+W.name);break}}if(!W){COG.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
W=Ga.base}COG.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return W}function H(c,r){function h(d,i){if(d&&b!==d){var l=c.triggerAll("zoomLevelChange",d,i);if(l)b=d;return l}}r=COG.extend({initial:1,min:0,max:null,zoomAnimation:COG.easing("quad.out")},r);var b=r.initial;COG.extend(c,{getZoomLevel:function(){return b},setZoomLevel:h});c.bind("scale",function(d,i,l){var p=Math.log(i)/Math.LN2;COG.endTweens(function(w){return w.cancelOnInteract});d.cancel=!h(b+p,l);d.cancel||c.updateOffset(l.x*
i,l.y*i)});c.bind("doubleTap",function(d,i,l){if(c.scalable()){COG.endTweens(function(p){return p.cancelOnInteract});c.scale(2,n.init(l.x,l.y))}})}function $(){for(var c=0,r=arguments.length;r--;){var h=ub[arguments[r].toUpperCase()];if(h)c|=h}return c}var ca=Math.PI*2,g=Math.PI/2,t=Math.abs,v=Math.min,A=Math.max,V=Math.pow,T=Math.sqrt,pa=Math.log,Ba=Math.round,ua=Math.sin,Fa=Math.asin,ra=Math.cos,ya=Math.atan,Ca=Math.atan2,n=function(){function c(b,d){return h(b.x-d.x,b.y-d.y)}function r(b,d){if(!d)d=
b.length;if(d<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var i={edges:Array(d-1),accrued:Array(d-1),total:0},l=0;l<d-1;l++){var p=c(b[l],b[l+1]);i.edges[l]=T(p.x*p.x+p.y*p.y);i.accrued[l]=i.total+i.edges[l];i.total+=i.edges[l]}return i}function h(b,d){return{x:b?b:0,y:d?d:0}}return{VECTOR_SIMPLIFICATION:3,SIMPLIFICATION_MIN_VECTORS:25,add:function(){for(var b=0,d=0,i=arguments.length;i--;){b+=arguments[i].x;d+=arguments[i].y}return h(b,d)},absSize:function(b){return A(t(b.x),
t(b.y))},copy:function(b){return b?h(b.x,b.y):null},diff:c,distance:function(b,d){return r(b,d).total},edges:r,equals:function(b,d){return b.x===d.x&&b.y===d.y},extendBy:function(b,d,i){var l=ra(d)*i;d=ua(d)*i;return h(b.x-l,b.y-d)},floor:function(b){for(var d=Array(b.length),i=b.length;i--;)d[i]=h(~~b[i].x,~~b[i].y);return d},getRect:function(b){for(var d,i,l,p,w=b.length;w--;){var o=b[w];d=typeof d==="undefined"||o.x<d?o.x:d;i=typeof i==="undefined"||o.y<i?o.y:i;l=typeof l==="undefined"||o.x>l?
o.x:l;p=typeof p==="undefined"||o.y>p?o.y:p}return za.init(d,i,l,p)},init:h,invert:function(b){return h(-b.x,-b.y)},min:function(b,d){return h(b.x<d.x?b.x:d.x,b.y<d.y?b.y:d.y)},max:function(b,d){return h(b.x>d.x?b.x:d.x,b.y>d.y?b.y:d.y)},offset:function(b,d,i){return h(b.x+d,b.y+(i?i:d))},simplify:function(b,d){if(!b)return null;d=d?d:n.VECTOR_SIMPLIFICATION;for(var i=[],l=null,p=b.length;p--;){var w=b[p];if(include=!l||p===0||t(w.x-l.x)+t(w.y-l.y)>d){i.unshift(w);l=w}}return i},theta:function(b,
d,i){i=Fa((b.y-d.y)/i);return b.x>d.x?i:Math.PI-i}}}(),na=function(){return{dotProduct:function(c,r){return c.x*r.x+c.y*r.y}}}(),za=function(){function c(h){return r(h.x1,h.y1,h.x2,h.y2)}function r(h,b,d,i){h=h?h:0;b=b?b:0;d=typeof d!=="undefined"?d:h;i=typeof i!=="undefined "?i:i;return{x1:h,y1:b,x2:d,y2:i,width:d-h,height:i-b}}return{center:function(h){return n.init(h.x1+h.width/2,h.y1+h.height/2)},copy:c,diagonalSize:function(h){return T(h.width*h.width+h.height*h.height)},fromCenter:function(h,
b,d,i){d=d>>1;i=i>>1;return r(h-d,b-i,h+d,b+i)},init:r,intersect:function(h,b){var d=A(h.x1,b.x1),i=A(h.y1,b.y1),l=v(h.x2,b.x2),p=v(h.y2,b.y2);d=r(d,i,l,p);return d.width>0&&d.height>0?d:null},union:function(h,b){if(h.width===0||h.height===0)return c(b);else if(b.width===0||b.height===0)return c(h);else{var d=v(h.x1,b.x1),i=v(h.y1,b.y1),l=A(h.x2,b.x2),p=A(h.y2,b.y2);d=r(d,i,l,p);return d.width>0&&d.height>0?d:null}}}}(),Sa=function(){return{getAspectRatio:function(c){return c.height!==0?c.width/c.height:
1},getCenter:function(c){return n.init(c.width>>1,c.height>>1)},getSize:function(c){return T(V(c.width,2)+V(c.height,2))},init:function(c,r){c=c?c:0;return{width:c,height:r?r:c}}}}(),Ga=null,N=[],W=null,ga=0,Ha=[],Ia=["view.wake","tile.loaded"],Ja=function(){function c(){if(!R){var x=u().maxImageLoads;R=COG.Loopage.join({execute:function(X,aa){if(!x||s.length<x){var Q=o.shift();if(Q){s[s.length]=Q;Q.image.onload=h;Q.image.src=Q.url;Q.requested=T5.ticks()}else aa.trigger("complete")}},frequency:10});
R.bind("complete",function(){R=null})}}function r(){U=true;try{var x=y.length>>1;if(x>0){y.sort(function(aa,Q){return aa.created-Q.created});for(var X=x;X--;)delete i[y[X].url];y.splice(0,x)}}finally{U=false}Y.trigger("cacheCleared")}function h(){var x=p[this.id],X;if(x&&x.image.complete&&x.image.width>0){x.loaded=true;x.hitCount=1;for(X=s.length;X--;)if(s[X].image.src==this.src){s.splice(X,1);break}if(x.background||x.postProcess||x.drawBackground||x.customDraw)if(x.image){globalImageData=x;X=d(x.realSize?
x.realSize.width:x.image.width,x.realSize?x.realSize.height:x.image.height);var aa=X.getContext("2d"),Q=x.offset?x.offset:T5.XY.init();x.background&&aa.drawImage(x.background,0,0);x.drawBackground&&x.drawBackground(aa);x.customDraw?x.customDraw(aa,x):aa.drawImage(x.image,Q.x,Q.y);x.postProcess&&x.postProcess(aa,x);x.image=X}for(X=x.callbacks.length;X--;)x.callbacks[X]&&x.callbacks[X](this,false);x.callbacks=[];y[y.length]={url:this.src,created:x.requested};delete p[this.id];c()}}function b(x,X,aa){var Q=
i[x];if(Q){Q.hitCount++;Q.image.complete&&Q.image.width>0&&X?X(Q.image,true):Q.callbacks.push(X)}else{Q=COG.extend({url:x,image:new Image,loaded:false,created:T5.ticks(),requested:null,hitCount:0,callbacks:[X]},aa);Q.image.id="resourceLoaderImage"+w++;i[x]=Q;p[Q.image.id]=Q;o[o.length]=Q;c()}return Q}function d(x,X){var aa=document.createElement("canvas");aa.width=x?x:0;aa.height=X?X:0;if(typeof FlashCanvas!=="undefined"){aa.id="tmpCanvas"+l++;aa.style.cssText="position: absolute; top: -"+(X-1)+"px; left: -"+
(x-1)+"px;";document.body.appendChild(aa);FlashCanvas.initElement(aa)}typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(aa);return aa}var i={},l=0,p={},w=0,o=[],s=[],y=[],K=0,R=null,U=false,Y={avgImageSize:25,loadTimeout:10,cancelLoad:function(){s=[]},get:function(x,X,aa){var Q=null,ba=null;U||(Q=i[x]);if((ba=Q?Q.image:null)&&(ba.getContext||ba.complete&&ba.width>0))return ba;else X&&b(x,X,aa);return null},load:b,newCanvas:d,reset:function(){i={}},stats:function(){return{imageLoadingCount:s.length,
queuedImageCount:o.length,imageCacheFullness:K}}};COG.observable(Y);COG.Loopage.join({execute:function(x){for(var X=false,aa=0,Q=u();aa<s.length;)if(x-s[aa].requested>Y.loadTimeout*1E3){s.splice(aa,1);X=true}else aa++;X&&c();if(Q&&Q.imageCacheMaxSize){K=y.length*Y.avgImageSize/Q.imageCacheMaxSize;K>=1&&r()}},frequency:2E4});return Y}(),ab=function(){var c={};return{init:function(r,h){var b=c[r];if(!b)throw Error("Unable to locate requested generator: "+r);return new b(h)},register:function(r,h){c[r]=
h},Template:function(){}}}(),Xa=function(){function c(l,p){d[l]=h(p);return l}function r(l){for(var p in l)c(p,l[p])}function h(l){function p(y){var K=l[y];typeof K!=="undefined"&&o.push(function(R){R[y]=K})}function w(){o=[];for(var y in l)p(y)}l=COG.extend({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},l);var o=[],s={applyToContext:function(y){for(var K=o.length;K--;)o[K](y)},
update:function(y,K){l[y]=K;w()}};w();return s}var b={},d={},i={apply:function(l,p){var w=d[p]?d[p]:d.basic,o;if(l&&l.canvas){o=b[l.canvas.id];b[l.canvas.id]=p}w.applyToContext(l);return o},define:c,defineMany:r,get:function(l){return d[l]},init:h,load:function(l){COG.jsonp(l,function(p){r(p)})}};r({basic:{lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"},waypoints:{lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"}});return i}(),ub={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,ZOOM:16,FREEZE:128},
pb=function(c){function r(D,E,O,oa){Qa=db;x();if(oa&&c.inertia)w(va-E,Ka-O,c.panAnimationEasing,c.panAnimationDuration);else oa||w(va-E,Ka-O);clearTimeout(m);m=setTimeout(h,100)}function h(){Qa=hb;a=false;x()}function b(D,E,O,oa){Da.zoom(O,oa)}function d(D){R();var E=n.init(Ya-(Ta.width/(F*2)>>0),ib-(Ta.height/(F*2)>>0)),O=Math.log(F)/Math.LN2>>0;if(F!==1)Qa=nb;if(O!==0){F=Math.pow(2,O);if(!Da.trigger("scale",F,E).cancel){for(D=ba.length;D--;)ba[D].trigger("scale",F,E);F=1;P=null;Qa=hb;D=true}}x(D)}
function i(D){e=n.init(La.x1,La.y1);k=n.offset(D,La.x1,La.y1)}function l(){clearTimeout(Ma);Ma=setTimeout(o,250)}function p(D,E,O){Q("tap",E,O,n.offset(O,va,Ka))}function w(D,E,O,oa,ma){function xa(){Ra+=1;if(Ra>=2){h();ma&&ma()}}var Ra=0,Ua=B?n.offset(B,-Wa,-f):null,bb=I?n.offset(I,-Wa,-f):null;if(Ua){D=D<Ua.x?Ua.x:D;E=E<Ua.y?Ua.y:E}if(bb){D=D>bb.x?bb.x:D;E=E>bb.y?bb.y:E}if(O){if(!a){D=COG.tweenValue(va,D,O,xa,oa);E=COG.tweenValue(Ka,E,O,xa,oa);D.cancelOnInteract=true;D.requestUpdates(function(jb){va=
jb>>0;a=true;x()});E.cancelOnInteract=true;E.requestUpdates(function(jb){Ka=jb>>0;a=true;x()})}}else{va=D>>0;Ka=E>>0}}function o(D,E){var O;if(Ea){ea&&ea.unbind();if(c.autoSize&&Ea.parentNode){O=Ea.parentNode.getBoundingClientRect();if(O.height!==0&&O.width!==0){D=O.width;E=O.height}}try{if(!Ea.id)Ea.id=c.id+"_canvas";qa=Ea.getContext("2d")}catch(oa){COG.exception(oa);throw Error("Could not initialise canvas on specified view element");}if(D&&E&&(fa!==E||wa!==D)){ha=true;wa=D;fa=E;Wa=wa>>1;f=fa>>
1;Da.trigger("resize",wa,fa);for(O=da;O--;)ba[O].trigger("resize",wa,fa)}if(c.interactive){ea=INTERACT.watch(Ea).pannable();y()}for(O=da;O--;)ba[O].trigger("contextChanged",qa);x(true)}}function s(D,E){E.setId(D);E.added=ja();E.bind("remove",function(){Da.removeLayer(D)});E.trigger("contextChanged",qa);E.setParent(Da);ba.push(E);ba.sort(function(O,oa){var ma=oa.zindex-O.zindex;if(ma===0)ma=oa.added-O.added;return ma});da=ba.length;return E}function y(){if(ea){if(c.pannable){ea.bind("pan",r);ea.bind("inertiaCancel",
function(){a=false;x()})}c.scalable&&ea.bind("zoom",b);ea.bind("pointerTap",p)}}function K(){Q("idle",Da);q=true;j=0}function R(D){var E=1/F;Ya=k.x+(va-e.x);ib=k.y+(Ka-e.y);if(D)return za.fromCenter(Ya>>0,ib>>0,D.width*E>>0,D.height*E>>0)}function U(D,E,O,oa){var ma,xa=0;La=za.copy(E);O&&qa.clearRect(0,0,wa,fa);qa.save();try{qa.globalCompositeOperation="source-over";if(F!==1){La=R(La);qa.scale(F,F)}qa.translate(-La.x1,-La.y1);I=B=null;if(eb){qa.beginPath();clipped=false;for(xa=da;xa--;)if(ba[xa].clip){ba[xa].clip(qa,
La,D,Da,O,oa);clipped=true}qa.closePath();clipped&&qa.clip()}for(xa=da;xa--;){ma=ba[xa];var Ra=ma.style,Ua=Ra?Xa.apply(qa,Ra):null;if(ma.minXY)B=B?n.min(B,ma.minXY):n.copy(ma.minXY);if(ma.maxXY)I=I?n.max(I,ma.maxXY):n.copy(ma.maxXY);ma.draw(qa,La,D,Da,O,oa);Ua&&Xa.apply(qa,Ua)}}finally{qa.restore()}if(fb){qa.globalCompositeOperation="source-over";qa.strokeStyle="#f00";qa.beginPath();qa.moveTo(Wa,0);qa.lineTo(Wa,fa);qa.moveTo(0,f);qa.lineTo(wa,f);qa.stroke()}Q("drawComplete",E,oa);COG.trace("draw complete",
oa)}function Y(D,E){var O=false,oa=ia?ia:a?db:Qa,ma=!a&&(oa===nb||oa===db),xa=Aa||oa===db||COG.getTweens().length>0;if(ha&&Ea){Ea.width=wa;Ea.height=fa;ha=false}Ta=aa();if(ma){COG.endTweens(function(Ra){return Ra.cancelOnInteract});q=false;if(j!==0){clearTimeout(j);j=0}}for(ma=da;ma--;){if(ba[ma].animated)Qa|=ob;ba[ma].cycle(D,Ta,Qa,xa);O=ba[ma].shouldDraw(Qa,Ta,xa)||O}xa=xa||(Qa&ob)!==0;if(O=O||xa||F!==1&&F!==Z){U(oa,Ta,xa,D);Z=F;Aa=false}if(!O&&cb===0&&!Pa){if(!q&&j===0)j=setTimeout(K,500);E.trigger("complete")}cb=
0;COG.trace("Completed draw cycle",D)}function x(D){Aa=D?true:false;cb+=1;if(!Za){Za=COG.Loopage.join({execute:Y,frequency:gb});Za.bind("complete",function(){Za=null})}}function X(){return Sa.init(wa,fa)}function aa(){return za.init(va,Ka,va+wa,Ka+fa)}function Q(){for(var D=Da.trigger.apply(null,arguments).cancel,E=ba.length;E--;)D=ba[E].trigger.apply(null,arguments).cancel||D;return!D}c=COG.extend({id:COG.objId("view"),container:"",fastDraw:false,inertia:true,pannable:true,clipping:false,scalable:true,
interactive:true,panAnimationEasing:COG.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:true,tapExtent:10,mask:true,guides:false,fps:25},c);var ba=[],da=0,Ea=document.getElementById(c.container),qa=null,va=0,Ka=0,eb=c.clipping,Ta=null,Za=null,La,fb=c.guides,Va=1,cb=0,Wa=0,f=0,e=null,k=null,q=false,a=false,j=0,m=0,B=null,I=null,la=0,ia=null,Aa=false,Ma=0,P=null,F=1,Z=0,ha=false,ea=null,fa,wa,Pa=typeof FlashCanvas!=="undefined",gb=~~(1E3/c.fps),
Ya,ib,hb=$("ACTIVE"),db=$("PAN"),nb=$("ZOOM"),ob=$("ANIMATING"),Qa=hb,Da={id:c.id,deviceScaling:Va,fastDraw:c.fastDraw||u().requireFastDraw,getDimensions:X,getLayer:function(D){for(var E=0;E<da;E++)if(ba[E].getId()==D)return ba[E];return null},setLayer:function(D,E){for(var O=0;O<da;O++)if(ba[O].getId()===D){ba.splice(O,1);break}E&&s(D,E);x();return E},eachLayer:function(D){for(var E=da;E--;)D(ba[E])},invalidate:x,resize:function(D,E){if(Ea){c.autoSize=false;if(wa!==D||fa!==E)o(D,E)}},scale:function(D,
E,O,oa){function ma(){F=Math.pow(2,Math.round(Math.log(F)/Math.LN2));oa&&oa();d(true)}var xa=F;E||(E=Sa.getCenter(X()));i(E);if(O)COG.tweenValue(0,D-xa,O,ma,1E3).requestUpdates(function(Ra){F=xa+Ra;d()});else{F=D;ma()}return Da},triggerAll:Q,removeLayer:function(D){a:{for(var E=da;E--;)if(ba[E].getId()==D){D=E;break a}D=-1}if(D>=0&&D<da){Da.trigger("layerRemoved",ba[D]);ba.splice(D,1);x()}da=ba.length},stateOverride:function(D){ia=D},getOffset:function(){return n.init(va,Ka)},getViewRect:aa,updateOffset:w,
pan:function(D,E,O,oa,ma){w(va+D,Ka+E,O,oa,ma)},zoom:function(D,E){i(D);a=false;F=Math.max(F+Math.pow(2,E)-1,0.25);d()}};Va=u().getScaling();Da.markers=s("markers",new kb);COG.observable(Da);Da.bind("invalidate",function(D,E){x(E)});Da.bind("resync",function(){I=B=null});COG.configurable(Da,["inertia","container","rotation","tapExtent","scalable","pannable"],COG.paramTweaker(c,null,{container:function(D,E){Ea=document.getElementById(E);o()},rotation:function(D,E){la=E}}),true);o();c.autoSize&&window.addEventListener("resize",
l,false);return Da},$a=function(c){c=COG.extend({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:$("ACTIVE","ANIMATING","PAN","ZOOM"),style:null,minXY:null,maxXY:null},c);var r=null,h=false,b=false,d=c.supportFastDraw,i=c.id,l=$("ACTIVE"),p=c.validStates,w=0,o=0,s=COG.extend({addToView:function(y){y.setLayer(i,s)},shouldDraw:function(y,K,R){return(b||R||w!==K.x1||o!==K.y1)&&(y&p)!==0&&(h?d:true)},clip:null,cycle:function(){},draw:function(){},remove:function(){s.trigger("remove",s)},
changed:function(y){b=true;s.trigger("changed",s);r&&r.trigger("invalidate",y)},getId:function(){return i},setId:function(y){i=y},getParent:function(){return r},setParent:function(y){h=(r=y)?r.fastDraw&&displayState!==l:false;s.trigger("parentChange",r)}},c);COG.observable(s);s.bind("drawComplete",function(y,K){b=false;w=K.x1;o=K.y1});s.bind("resync",function(y,K){if(K.syncXY){s.minXY&&K.syncXY(s.minXY);s.maxXY&&K.syncXY(s.maxXY)}});return s},lb=function(c){function r(w,o,s,y){b=w;d=o;i=s;l=y}c=COG.extend({xy:n.init(),
offset:true,tweenIn:null,animationSpeed:null,isNew:true},c);var h=false,b=0,d=0,i=0,l=0,p=COG.extend(c,{isAnimating:function(){return h},draw:function(w,o,s,y,K){if(p.isNew&&c.tweenIn){var R=p.xy.y;p.xy.y=o.y1-20;h=true;COG.tween(p.xy,"y",R,c.tweenIn,function(){p.xy.y=R>>0;h=false},c.animationSpeed?c.animationSpeed:250+Math.random()*500)}p.drawMarker(w,o,p.xy.x,p.xy.y,s,y,K);p.isNew=false},drawMarker:function(w,o,s,y){w.beginPath();w.arc(s,y,4,0,Math.PI*2,false);w.fill();r(s-4,y-4,8,8)},hitTest:function(w,
o){return w>=b&&w<=b+i&&o>=d&&o<=d+l},updateBounds:r});COG.observable(p);return p},kb=function(c){function r(){d.changed();d.trigger("markerUpdate",b)}function h(){var i=d.getParent();if(i&&i.syncXY)for(var l=b.length;l--;)i.syncXY([b[l].xy])}c=COG.extend({zindex:100,style:"basic"},c);var b=[],d=COG.extend(new $a(c),{draw:function(i,l,p,w){for(var o=b.length;o--;)b[o].draw(i,l,p,d,w)},add:function(i){if(i&&typeof i.length!=="undefined")for(var l=i.length;l--;){if(i[l])b[b.length]=i[l]}else if(i)b[b.length]=
i;r()},clear:function(i){if(i)for(var l=0;l<b.length;l++)i(b[l])&&b.splice(l,1);else b=[];r()},each:function(i){if(i)for(var l=b.length;l--;)i(b[l])},find:function(i){for(var l=[],p=b.length;p--;)if(!i||i(b[p]))l[l.length]=b[p];return l}});d.bind("tap",function(i,l,p,w){var o=[],s=w.x;w=w.y;for(var y=b.length;y--;)if(b[y].hitTest(s,w))o[o.length]=b[y];if(o.length>0)i.cancel=d.trigger("markerTap",l,p,o).cancel});d.bind("parentChange",h);d.bind("resync",h);d.bind("changed",h);return d},qb=function(c){function r(p,
w,o){p.fillStyle="#FFFFFF";p.strokeStyle="#222222";p.beginPath();p.arc(o.x,o.y,4,0,Math.PI*2,false);p.stroke();p.fill()}c=COG.extend({path:[],id:COG.objId("pathAni"),easing:COG.easing("sine.inout"),validStates:$("ACTIVE","PAN","ZOOM"),drawIndicator:null,duration:2E3},c);var h=n.edges(c.path),b,d=null,i=0;COG.tweenValue(0,h.total,c.easing,function(){l.remove()},c.duration).requestUpdates(function(p,w){i=p;w&&l.remove()});var l=COG.extend(new $a(c),{cycle:function(){for(var p=0;p<h.accrued.length&&
h.accrued[p]<i;)p++;d=null;if(p<c.path.length-1){var w=i-(p>0?h.accrued[p-1]:0),o=c.path[p];b=n.theta(o,c.path[p+1],h.edges[p]);d=n.extendBy(o,b,w)}return d},draw:function(p,w){if(d)(c.drawIndicator?c.drawIndicator:r)(p,w,n.init(d.x,d.y),b)}});return l},rb=function(c){c=COG.extend({style:null,properties:{}},c);return COG.extend(c,{rect:null,draw:function(){},resync:function(){}})},mb=function(c,r){r=COG.extend({fill:false,simplify:false},r);var h=false,b=r.fill,d=r.simplify,i=$("ZOOM"),l=[],p=COG.extend(new rb(r),
{draw:function(w,o,s,y,K,R){if(h){o=true;s=(R&i)!==0;w.beginPath();for(R=l.length;R--;){s=l[R].x;y=l[R].y;if(o){w.moveTo(s,y);o=false}else w.lineTo(s,y);s=true}if(s){b&&w.fill();w.stroke()}}},resync:function(w){p.xy=w.syncXY(c);l=n.floor(d?n.simplify(c):c)}});h=c&&c.length>=2;return p},sb=function(c){function r(i){for(var l=b.length;l--;)b[l].resync(i);b.sort(function(p,w){var o=w.xy.y-p.xy.y;if(o===0)o=w.xy.x-p.xy.y;return o});d.changed()}function h(i,l){l.syncXY&&r(l)}c=COG.extend({zindex:80},c);
var b=[],d=COG.extend(new $a(c),{add:function(i){b[b.length]=i},each:function(i){for(var l=b.length;l--;)i(b[l])},draw:function(i,l,p){var w=l.x1,o=l.y1,s=l.width;l=l.height;for(var y=b.length;y--;){var K=b[y].style;K=K?Xa.apply(i,K):null;b[y].draw(i,w,o,s,l,p);K&&Xa.apply(i,K)}}});d.bind("parentChange",h);d.bind("resync",h);return d},vb=function(){return{tileSize:256,init:function(c,r,h,b,d){return COG.extend({x:c,y:r,width:h,height:b},d)}}}(),tb=function(c){function r(U,Y,x,X){function aa(){if(R.initTileCreator){p=
true;R.initTileCreator(U,Y,x,X)}}R.prepTileCreator?R.prepTileCreator(U,Y,x,aa):aa()}function h(U,Y){for(var x=~~((U.x1-i.x)/w),X=~~((U.y1-i.y)/o),aa=[],Q=-l;Q<y;Q++)for(var ba=-l;ba<K;ba++){var da=s(x+Q,X+ba);if(da)aa[aa.length]=da}Y&&Y(aa);d=za.copy(U)}c=COG.extend({tileWidth:256,tileHeight:256,relative:false,padding:2},c);var b=null,d=null,i=n.init(),l=c.padding,p=false,w=c.tileWidth,o=c.tileHeight,s=null,y=0,K=0,R={bindToView:function(U){COG.info("initializing generator");b=U;R.trigger("bindView",
U)},getTileCreatorArgs:null,initTileCreator:null,prepTileCreator:null,requireRefresh:function(){return false},reset:function(){s=null;p=false;d=null},run:function(U,Y){if(!d||Math.abs(U.x1-d.x1)>w||Math.abs(U.y1-d.y1)>o){if(!s&&!p||R.requireRefresh()){i=c.relative?n.init(U.x1,U.y1):n.init();y=Math.ceil(U.width/w)+l;K=Math.ceil(U.height/o)+l;r(w,o,R.getTileCreatorArgs?R.getTileCreatorArgs(b):{},function(x){s=x;p=false;h(U,Y)})}s&&h(U,Y)}}};COG.observable(R);R.bind("update",function(){COG.info("captured generator update");
d=null});return R},Na={ex:COG.extend,ticks:ja,getConfig:u,userMessage:function(c,r,h){Na.trigger("userMessage",c,r,h)},XY:n,XYRect:za,Dimensions:Sa,Vector:na,D:Sa,Images:Ja,Generator:ab,tween:COG.tween,tweenValue:COG.tweenValue,easing:COG.easing,Tween:COG.Tween,Style:Xa,viewState:$,View:pb,ViewLayer:$a,ImageLayer:function(c,r){function h(o,s,y){for(s=i.length;s--;){var K=i[s],R=K.x,U=K.y,Y=za.init(K.x,K.y,K.x+K.width,K.y+K.height);if(y&&za.intersect(o,Y)){Y=Ja.get(K.url,function(){w.changed()},p);
y(Y,R,U,K.width,K.height)}}}function b(o){d&&d.run(o,function(s){i=[].concat(s);w.changed()})}r=COG.extend({imageLoadArgs:{}},r);var d=c?ab.init(c,r):null,i=[],l=za.init(),p=r.imageLoadArgs,w=COG.extend(new $a(r),{changeGenerator:function(o,s){d=ab.init(o,COG.extend({},r,s));d.bindToView(w.getParent());i=null;b(l)},clip:function(o,s,y){h(s,y,function(K,R,U,Y,x){K&&o.rect(R,U,Y,x)})},cycle:function(o,s){b(s)},draw:function(o,s,y){h(s,y,function(K,R,U,Y,x){w.drawImage(o,K,R,U,Y,x,s,y)});l=za.copy(s)},
drawImage:function(o,s,y,K){s&&o.drawImage(s,y,K,s.width,s.height)}});w.bind("idle",function(){b(l)});w.bind("parentChange",function(o,s){d&&d.bindToView(s)});w.bind("tap",function(o,s,y,K){o=[];var R=K.x,U=K.y,Y,x;if(i)for(var X=i.length;X--;){Y=i[X];if(x=R>=Y.x&&R<=Y.x+Y.width&&U>=Y.y&&U<=Y.y+Y.height)o[o.length]=Y}o.length>0&&w.trigger("tapImage",o,s,y,K)});return w},Marker:lb,ImageMarker:function(c){c=COG.extend({image:null,imageUrl:null,animatingImage:null,animatingImageUrl:null,imageAnchor:null,
rotation:0,scale:1,opacity:1},c);var r=c.imageAnchor?T5.XY.invert(c.imageAnchor):null,h=COG.extend(new lb(c),{drawMarker:function(b,d,i,l){if((d=h.isAnimating()&&h.animatingImage?h.animatingImage:h.image)&&d.width>0){r||(r=n.init(-d.width>>1,-d.height>>1));var p=h.scale,w=i+~~(r.x*p),o=l+~~(r.y*p),s=~~(d.width*p),y=~~(d.height*p);h.updateBounds(w,o,s,s);if(h.rotation||h.opacity!==1){b.save();try{b.globalAlpha=h.opacity;b.translate(i,l);b.rotate(h.rotation);b.drawImage(d,r.x*p,r.y*p,s,y)}finally{b.restore()}}else b.drawImage(d,
w,o,s,y)}}});if(!h.image)h.image=Ja.get(c.imageUrl,function(b){h.image=b});if(!h.animatingImage)h.animatingImage=Ja.get(c.animatingImageUrl,function(b){h.animatingImage=b});return h},MarkerLayer:kb,PathLayer:function(c){c=COG.extend({style:"waypoints",pixelGeneralization:8,zindex:50},c);var r=false,h=[],b=null,d=[],i=null,l=0,p=[],w=COG.extend(new $a(c),{getAnimation:function(o,s,y,K){var R="pathAnimation"+l++;p.push(R);return new qb({id:R,path:h,zindex:c.zindex+1,easing:o?o:COG.easing("sine.inout"),
duration:s?s:5E3,drawIndicator:y,autoCenter:K?K:false})},cycle:function(o,s,y,K){return K},draw:function(o){var s,y=h.length;o.save();try{Xa.apply(o,c.style);if(y>0){o.beginPath();o.moveTo(h[y-1].x,h[y-1].y);for(s=y;s--;)o.lineTo(h[s].x,h[s].y);o.stroke();if(b){o.fillStyle=c.waypointFillStyle;for(s=b.length;s--;){o.beginPath();o.arc(b[s].x,b[s].y,2,0,Math.PI*2,false);o.stroke();o.fill()}}}}finally{o.restore()}r=false},updateCoordinates:function(o,s){d=o;i=s;var y=w.getParent();if(y&&y.syncXY){y.syncXY(d);
i&&y.syncXY(i);w.trigger("tidy")}}});w.bind("tidy",function(){h=n.simplify(d,c.pixelGeneralization);b=n.simplify(i,c.pixelGeneralization);r=true;w.changed()});return w},AnimatedPathLayer:qb,Shape:rb,Arc:function(c,r){r=COG.extend({size:4},r);var h=n.init(),b=COG.extend(r,{draw:function(d){d.beginPath();d.arc(h.x,h.y,b.size,0,Math.PI*2,false);d.fill();d.stroke()},resync:function(d){d.syncXY([c]);h=n.floor([c])[0]}});COG.info("created arc = ",c);return b},Poly:mb,ShapeLayer:sb,Tiling:vb,TileGenerator:tb};
COG.observable(Na);var Oa=Na.Geo=function(){function c(f){f=parseFloat(f)*U;f=ua(f);var e=x*f;return pa((1+f)/(1-f)*V((1-e)/(1+e),x))/2}function r(f){return parseFloat(f)*U}function h(f){f=V(Math.E,-f);for(var e=g-2*ya(f),k=i(e,f),q=0;q<aa&&t(e-k)>X;){e=k;k=i(e,f);q++}return k*Y}function b(f){return f%360*Y}function d(f,e){var k=null;for(var q in engines)if(e){if(q==e&&engines[q][f]){k=engines[q];break}}else if(engines[q][f]){k=engines[q];break}return k}function i(f,e){var k=x*ua(f);return g-2*ya(e*
V((1-k)/(1+k),x/2))}function l(f,e,k,q){e=w(e);f.add(q.line(e,k));return e.length}function p(f,e,k,q){e=w(e);f.add(q.poly(e,k));return e.length}function w(f){var e=f?f.length:0,k=Array(e);for(e=e;e--;)k[e]=Oa.Position.init(f[e][1],f[e][0]);return Oa.Position.vectorize(k,fb)}function o(f,e,k){return new Wa(f,e,k)}var s=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],y=-g,K=g,R=-ca,U=Math.PI/180,Y=180/Math.PI,x=0.08181919084262157,X=1.0E-7,aa=12,Q=null,ba=
{RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",HWY:"HIGHWAY",MWY:"MOTORWAY"},da=function(){function f(a){return a?k(a.lat,a.lon):null}function e(a){return!a||a.lat===0&&a.lon===0}function k(a,j){return{lat:parseFloat(a?a:0),lon:parseFloat(j?j:0)}}function q(a){if(a)if(typeof a.lat!=="undefined")return f(a);else{if(a.split)for(var j=[" ",","],m=0;m<j.length;m++){var B=a.split(j[m]);if(B.length===2)return k(B[0],B[1])}}else return k();return null}return{calcDistance:function(a,
j){if(e(a)||e(j))return 0;var m=(j.lat-a.lat)*U>>1,B=(j.lon-a.lon)*U>>1;m=ua(m)*ua(m)+ra(a.lat*U)*ra(j.lat*U)*ua(B)*ua(B);return 6371*2*Ca(T(m),T(1-m))},copy:f,empty:e,equal:function(a,j){return a&&j&&a.lat==j.lat&&a.lon==j.lon},fromMercatorPixels:function(a,j){return k(h(j),b(a))},generalize:function(a,j,m){var B=a.length,I=[],la=null;m||(m=250);m/=1E3;COG.info("generalizing positions, must include "+j.length+" positions");for(var ia=B;ia--;)if(ia===0)I.unshift(a[ia]);else{var Aa=!la||da.inArray(a[ia],
j)?m:da.calcDistance(la,a[ia]);if(a[ia]&&Aa>=m){I.unshift(a[ia]);la=a[ia]}}COG.info("generalized "+B+" positions into "+I.length+" positions");return I},inArray:function(a,j){for(var m=da.equal,B=j.length;B--;)if(m(a,j[B]))return true;return false},inBounds:function(a,j){var m=!(da.empty(a)||da.empty(j));return m=(m=m&&a.lat>=j.min.lat&&a.lat<=j.max.lat)&&a.lon>=j.min.lon&&a.lon<=j.max.lon},init:k,offset:function(a,j,m){var B=a.lat*U;a=a.lon*U;j=B+j/6371;m=Fa(ua(m/6371)/ra(B));m=a+m;j=(j+g)%Math.PI-
g;m%=ca;return k(j*Y,m*Y)},parse:q,parseArray:function(a){var j=a.length,m=Array(j);for(j=j;j--;)m[j]=q(a[j]);return m},toMercatorPixels:function(a){return T5.XY.init(r(a.lon),c(a.lat))},toString:function(a){return a?a.lat+" "+a.lon:""},vectorize:function(a,j){var m=a.length,B=Array(m);j=COG.extend({chunkSize:500,async:true},j);if(!j.async){for(var I=m;I--;)B[I]=T5.GeoXY.init(a[I]);return B}return COG.Loopage.join({frequency:10,execute:function(la,ia){for(var Aa=0,Ma=j.chunkSize,P=m;P--;){B[P]=T5.GeoXY.init(a[P]);
Aa+=1;if(Aa>Ma)break}m=P;m<=0&&ia.trigger("complete",B)}})}}}(),Ea=function(){function f(a,j,m){var B=T5.XY.init(0,j.lat-a.lat);if(typeof m==="undefined")m=true;B.x=m&&a.lon>j.lon?360-a.lon+j.lon:j.lon-a.lon;return B}function e(a,j){return Ea.init(da.init(a.min.lat-j,a.min.lon-j%360),da.init(a.max.lat+j,a.max.lon+j%360))}function k(a){var j=f(a.min,a.max);return da.init(a.min.lat+(j.y>>1),a.min.lon+(j.x>>1))}function q(a,j){return{min:da.parse(a),max:da.parse(j)}}return{calcSize:f,createBoundsFromCenter:function(a,
j){var m=j/6371,B=a.lat*U,I=a.lon*U,la=B-m,ia=B+m;if(la>y&&ia<K){B=Fa(ua(m)/ra(B));m=(I-B)%ca;I=(I+B)%ca}else{la=A(la,y);ia=v(ia,K);m=R;I=ca}return Ea.init(da.init(la*Y,m*Y),da.init(ia*Y,I*Y))},expand:e,forPositions:function(a,j){var m=null,B=T5.ticks();j||(j="auto");for(var I=a.length;I--;)if(m){var la=f(m.min,a[I],false),ia=f(a[I],m.max,false);if(la.x<0)m.min.lon=a[I].lon;if(la.y<0)m.min.lat=a[I].lat;if(ia.x<0)m.max.lon=a[I].lon;if(ia.y<0)m.max.lat=a[I].lat}else m=q(a[I],a[I]);if(j){if(j=="auto"){I=
f(m.min,m.max);j=A(I.x,I.y)*0.3}m=e(m,j)}COG.trace("calculated bounds for "+a.length+" positions",B);return m},getCenter:k,getGeoHash:function(a){var j=T5.Geo.GeoHash.encode(a.min.lat,a.min.lon);a=T5.Geo.GeoHash.encode(a.max.lat,a.max.lon);COG.info("min hash = "+j+", max hash = "+a)},getZoomLevel:function(a,j){var m=k(a);m=v(Ba(t(m.lat)*0.05),s.length);var B=s[m],I=f(a.min,a.max);m=ceil(pa(s[3]*j.height/I.y)/pa(2));B=ceil(pa(B*j.width/I.x)/pa(2));return v(isNaN(m)?1E3:m,isNaN(B)?1E3:B)},init:q,isEmpty:function(a){return!a||
da.empty(a.min)||da.empty(a.max)},toString:function(a){return"min: "+da.toString(a.min)+", max: "+da.toString(a.max)}}}(),qa=function(){var f=/^(\d+).*$/,e=/(\d+)\s?\-\s?(\d+)/;return{buildingMatch:function(k,q){f.lastIndex=-1;if(f.test(k))for(var a=k.replace(f,"$1"),j=q.split(","),m=0;m<j.length;m++){e.lastIndex=-1;if(e.test(j[m])){var B=e.exec(j[m]);if(a>=parseInt(B[1],10)&&a<=parseInt(B[2],10))return true}else if(a==j[m])return true}return false},normalize:function(k){if(!k)return"";k=k.toUpperCase();
if(!Q){var q=[];for(var a in ba)q.push(a);Q=RegExp("(\\s)("+q.join("|")+")(\\s|$)","i")}Q.lastIndex=-1;if(q=Q.exec(k))k=k.replace(Q,"$1"+ba[q[2]]);return k},toString:function(k){return k.streetDetails+" "+k.location}}}(),va=Na.GeoXY=function(){function f(k,q){if(k.length){for(var a,j,m,B,I=k.length;I--;){f(k[I],q);a=typeof a==="undefined"||k.x<a?k.x:a;j=typeof j==="undefined"||k.y<j?k.y:j;m=typeof m==="undefined"||k.x>m?k.x:m;B=typeof B==="undefined"||k.y>B?k.y:B}return za.init(a,j,B,B)}else if(k.mercXY){a=
k.mercXY;k.x=~~(a.x/q);k.y=~~((Math.PI-a.y)/q);k.rpp=q}else COG.warn("Attempted to sync an XY composite, not a GeoXY");return k}function e(k,q,a){k.pos=q;k.mercXY=da.toMercatorPixels(q);(a=typeof a!=="undefined"?a:k.rpp)&&f(k,a)}return{init:function(k,q){var a=n.init();e(a,k,q);return a},sync:f,toPos:function(k,q){q=q?q:self.rpp;return da.fromMercatorPixels(k.x*q,Math.PI-k.y*q)},updatePos:e}}();Na.GeoVector=function(f){COG.warn("The T5.Geo.GeoVector class has been deprecated, please use T5.GeoXY.init instead");
return va.init(f)};var Ka=function(){return{bestResults:function(f,e){e||(e=20);for(var k=f.length>0?f[0]:null,q=[],a=0;a<f.length;a++)if(k&&f[a]&&k.matchWeight-f[a].matchWeight<=e)q.push(f[a]);else break;return q}}}(),eb=function(f){f=COG.extend({id:null,caption:"",resultType:"",data:null,pos:null,matchWeight:0},f);return COG.extend(f,{toString:function(){return f.caption+(f.matchWeight?" ("+f.matchWeight+")":"")}})},Ta=function(){var f={calculate:function(e){e=COG.extend({engineId:"",waypoints:[],
map:null,error:null,autoFit:true,success:null,generalize:false},e);var k=T5.Geo.getEngine("route");k&&k.route(e,function(q){if(e.generalize)q.geometry=T5.Geo.Position.generalize(q.geometry,q.getInstructionPositions());if(e.map){f.createMapOverlay(e.map,q);e.autoFit&&e.map.gotoBounds(q.boundingBox)}e.success&&e.success(q)})},createMapOverlay:function(e,k){var q=e.getDimensions();q=new T5.Geo.UI.RouteOverlay({data:k,width:q.width,height:q.height});e.setLayer("route",q)},parseTurnType:function(e){for(var k=
f.TurnType.Unknown,q=T5.Geo.Routing.TurnTypeRules,a=0;a<q.length;a++){q[a].regex.lastIndex=-1;var j=q[a].regex.exec(e);if(j){k=q[a].customCheck?q[a].customCheck(e,j):q[a].turnType;break}}return k},TurnType:{Unknown:"turn-unknown",Start:"turn-none-start",Continue:"turn-none",Arrive:"turn-none-arrive",TurnLeft:"turn-left",TurnLeftSlight:"turn-left-slight",TurnLeftSharp:"turn-left-sharp",TurnRight:"turn-right",TurnRightSlight:"turn-right-slight",TurnRightSharp:"turn-right-sharp",Merge:"merge",UTurnLeft:"uturn-left",
UTurnRight:"uturn-right",EnterRoundabout:"roundabout-enter",Ramp:"ramp",RampExit:"ramp-exit"},Instruction:function(e){var k=e=COG.extend({position:null,description:"",distance:0,distanceTotal:0,time:0,timeTotal:0,turnType:null},e),q=e.description;q=q.replace(/(\w)(\/)(\w)/g,"$1 $2 $3");k.description=q;if(!e.turnType)e.turnType=f.parseTurnType(e.description);return e},RouteData:function(e){e=COG.extend({geometry:[],instructions:[],boundingBox:null},e);if(!e.boundingBox)e.boundingBox=T5.Geo.BoundingBox.forPositions(e.geometry);
return COG.extend({getInstructionPositions:function(){for(var k=[],q=0;q<e.instructions.length;q++)e.instructions[q].position&&k.push(e.instructions[q].position);return k}},e)}};return f}(),Za="featurecollection",La="feature",fb={async:false},Va={processor:null,group:"shapes",layerClass:sb},cb={point:COG.extend({},Va,{processor:function(f,e,k,q){e=w([e.coordinates],fb);if(e.length>0)if(k=q.marker(e[0],k)){f.add(k);return e.length}},group:"markers",layerClass:kb}),linestring:COG.extend({},Va,{processor:function(f,
e,k,q){e=w(e&&e.coordinates?e.coordinates:[]);return l(f,e,k,q)}}),multilinestring:COG.extend({},Va,{processor:function(f,e,k,q){e=e&&e.coordinates?e.coordinates:[];for(var a=0,j=e.length;j--;)a+=l(f,e[j],k,q);return a}}),polygon:COG.extend({},Va,{processor:function(f,e,k,q){e=e&&e.coordinates?e.coordinates:[];if(e.length>0)return p(f,e[0],k,q);return 0}}),multipolygon:COG.extend({},Va,{processor:function(f,e,k,q){e=e&&e.coordinates?e.coordinates:[];for(var a=0,j=0;j<e.length;j++)a+=p(f,e[j][0],k,
q);return a}})},Wa=function(f,e,k,q){function a(Z,ha){var ea=Z.processor,fa=I+Z.group,wa=COG.extend({},Z,k,{properties:ha.properties});if(ea){var Pa=P[fa];if(!Pa){Pa=new Z.layerClass({id:fa});P[fa]=Pa}globalLayers=P;return ea(Pa,ha.data,wa,q)}return 0}function j(Z,ha){var ea=Z&&Z.type?Z.type.toLowerCase():null;return ea&&ea===La?j(Z.geometry,Z.properties):{type:ea,isCollection:ea?ea===Za:false,definition:cb[ea],data:Z,properties:ha?ha:Z.properties}}k=COG.extend({vectorsPerCycle:Oa.VECTORIZE_PER_CYCLE,
rowPreParse:null,simplify:false,layerPrefix:"geojson-"},k);q=COG.extend({marker:function(Z){return new lb({xy:Z})},line:function(Z,ha){return new mb(Z,ha)},poly:function(Z,ha){return new mb(Z,COG.extend({fill:true},ha))}},q);var m=k.vectorsPerCycle,B=k.rowPreParse,I=k.layerPrefix,la=0,ia=0,Aa=null,Ma=0,P={},F;if(!f)return null;if(typeof f.length==="undefined")f=[f];ia=f.length;F=COG.Loopage.join({frequency:10,execute:function(Z,ha){var ea=0,fa=la;if(!Aa){for(;fa<ia;fa++){var wa=j(B?B(f[fa]):f[fa]),
Pa=null;if(wa.isCollection){Ma+=1;Aa=o(wa.data.features,function(gb){Aa=null;for(var Ya in gb)P[Ya]=gb[Ya]},{layerPrefix:I+Ma+"-"});Pa+=1}else if(wa.definition)Pa=a(wa.definition,wa);ea+=Pa?Pa:1;if(ea>=m)break}la=fa+1;!Aa&&la>=ia&&ha.trigger("complete")}}});F.bind("complete",function(){e&&e(P)});return F};Na.GeoJSON={parse:o};Na.Map=function(f){function e(F){try{var Z=Oa.Position.init(F.coords.latitude,F.coords.longitude),ha=F.coords.accuracy/1E3;P.trigger("locationUpdate",F,ha);if(ia){if(!I){I=new Oa.UI.LocationOverlay({pos:Z,
accuracy:ha});I.update(P.getTileLayer());P.setLayer("location",I)}var ea=Oa.BoundingBox.createBoundsFromCenter(Z,Math.max(ha,1));P.gotoBounds(ea)}else{I.pos=Z;I.accuracy=ha;I.update(P.getTileLayer());a(Z,null,COG.easing("sine.out"))}ia=false}catch(fa){COG.exception(fa)}}function k(F){COG.info("caught location tracking error:",F)}function q(F,Z,ha){P.setZoomLevel(Z);Ja.cancelLoad();COG.endTweens();a(F,ha)}function a(F,Z,ha,ea){F=va.init(F,Oa.radsPerPixel(P.getZoomLevel()));var fa=P.getDimensions();
P.updateOffset(F.x-(fa.width>>1),F.y-(fa.height>>1),ha,ea,Z);P.trigger("wake");P.trigger("boundsChange",P.getBoundingBox());Z&&typeof ha==="undefined"&&Z(P)}f=COG.extend({tapExtent:10,crosshair:false,zoomLevel:0,boundsChangeThreshold:30},f);var j={NONE:0,SINGLE:1,WATCH:2},m=n.init(),B=j.NONE,I=null,la=0,ia=true,Aa=0,Ma=f.tapExtent;f.adjustScaleFactor=function(F){return Math.pow(2,(F<1?Math.floor:Math.ceil)(Math.log(F)))};var P=COG.extend(new pb(f),{getBoundingBox:function(){var F=P.getViewRect();
return Oa.BoundingBox.init(va.toPos(n.init(F.x1,F.y2),Aa),va.toPos(n.init(F.x2,F.y1),Aa))},getCenterPosition:function(){var F=P.getViewRect();if(F){F=n.init(F.x1+(F.width>>1),F.y1+(F.height>>1));return va.toPos(F,Aa)}return null},gotoBounds:function(F,Z){var ha=Oa.BoundingBox.getZoomLevel(F,P.getDimensions());q(Oa.BoundingBox.getCenter(F),ha,Z)},gotoPosition:q,panToPosition:a,syncXY:function(F){return va.sync(F,Aa)},locate:function(){P.trackStart(j.SINGLE);setTimeout(P.trackCancel,1E4)},trackStart:function(F){if(navigator.geolocation&&
!la){B=F?F:j.WATCH;ia=true;la=navigator.geolocation.watchPosition(e,k,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3})}},trackCancel:function(){la&&navigator.geolocation&&navigator.geolocation.clearWatch(la);P.removeLayer("location");I=null;B=j.NONE;la=0},animateRoute:function(F,Z,ha,ea){var fa=P.getLayer("route");if(fa)(F=fa.getAnimation(F,Z,ha,ea))&&F.addToView(P)}});P.bind("pan",function(){B===j.SINGLE&&P.trackCancel()});P.bind("tap",function(F,Z,ha,ea){var fa=Oa.radsPerPixel(P.getZoomLevel());
F=va.toPos(ea,fa);var wa=va.toPos(n.offset(ea,-Ma,Ma),fa);ea=va.toPos(n.offset(ea,Ma,-Ma),fa);P.trigger("geotap",Z,ha,F,Ea.init(wa,ea))});P.bind("idle",function(){var F=n.absSize(n.diff(m,P.getOffset()));COG.info("idle detected, change delta = "+F);if(F>f.boundsChangeThreshold){m=n.copy(P.getOffset());P.trigger("boundsChange",P.getBoundingBox())}});H(P,f);P.bind("zoomLevelChange",function(F,Z){Aa=Oa.radsPerPixel(Z);P.triggerAll("resync",P)});return P};Na.MapTileGenerator=function(f){function e(j,
m){var B=m>=a.minLevel&&(!a.maxLevel||m<=a.maxLevel);COG.info("new zoom level = "+m+", zoom ok = "+B);j.cancel=!B;if(B){k=m;a.reset()}}f=COG.extend({relative:true},f);var k=0,q=null,a=COG.extend(new tb(f),{minLevel:2,maxLevel:20,getTileCreatorArgs:function(j){q=j.getCenterPosition();return{zoomLevel:k,position:q}},requireRefresh:function(){return!q}});a.bind("bindView",function(j,m){if(m.getZoomLevel){k=m.getZoomLevel();m.bind("zoomLevelChange",e)}});return a};Na.GeoPoly=function(f,e){e=COG.extend({autoParse:true},
e);for(var k=Array(f.length),q=e.autoParse,a=T5.Geo.Position.parse,j=f.length;j--;)k[j]=T5.GeoXY.init(q?a(f[j]):f[j]);return new T5.Poly(k,e)};Na.RouteOverlay=function(f){f=COG.extend({data:null,pixelGeneralization:8,partialDraw:false,strokeStyle:"rgba(0, 51, 119, 0.9)",waypointFillStyle:"#FFFFFF",lineWidth:4,zindex:50},f);var e=[],k=[],q=new T5.PathLayer(f);(function(){if(f.data&&f.data.instructions){for(var a=f.data.instructions,j=Array(a.length),m=a.length;m--;)j[m]=a[m].position;T5.Geo.Position.vectorize(j).bind("complete",
function(B,I){k=I})}f.data&&f.data.geometry&&T5.Geo.Position.vectorize(f.data.geometry).bind("complete",function(B,I){e=I;q.updateCoordinates(e,k,true)})})();return q};Na.LocationOverlay=function(f){f=COG.extend({pos:null,accuracy:null,zindex:90},f);var e=new Image,k=T5.XY.init(),q=T5.XY.init(),a=null;e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAACIQAAAiEBPhEQkwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAG+SURBVCiRlZHNahNRAIW/O7mTTJPahLZBA1YUyriINRAE3bQIKm40m8K8gLj0CRQkO32ELHUlKbgoIu4EqeJPgtCaoBuNtjXt5LeTMZk0mbmuWiuuPLsD3+HAOUIpxf9IHjWmaUbEyWv5ROrsVULhcHP761rUfnN3Y2Otc8CIg4YT85lzuVsPP+Qupw1vpPjRCvhS9ymvV0e77x7nNj+uvADQAIQQ+uLyvdfLV9JGZi7EdEwQlqBpEJ019f0z1mo2u5Q8DMydv25lshemmj1FueZTawbs7inarqLbV7Qjab1upB9YlhWSAHLavLHZCvg1VEhN0PMU9W7At4bPVidg7CtkLLXkut+lBPD6/Ub155jJiADAHSpaLmx3ApyBQoYEUd0PBoOBkAC6+3llvda/YxgGgYL+UNHf/zN3KiExGlsvTdP0NYDkhPdWrz35ZDsBzV5wCMuQwEyFmXFeeadjzfuFQmGkAZRKpdGC/n7x+M6jqvA9Zo6FWDhlcHE+wqT93J1tP7vpOE7rrx8ALMuasPf8S12St4WmJ6bYWTUC52k8Hm8Vi0X/nwBAPp/XKpWKdF1X2LYdlMvlsToC/QYTls7DLFr/PAAAAABJRU5ErkJggg%3D%3D";
e.onload=function(){k=T5.XY.init(e.width>>1,e.height>>1)};var j=COG.extend(new T5.ViewLayer(f),{pos:f.pos,accuracy:f.accuracy,drawAccuracyIndicator:false,draw:function(m,B){var I=q.x-B.x,la=q.y-B.y;if(a){m.fillStyle="rgba(30, 30, 30, 0.2)";m.beginPath();m.arc(I,la,a,0,Math.PI*2,false);m.fill()}e.complete&&e.width>0&&m.drawImage(e,I-k.x,la-k.y,e.width,e.height);j.changed()},update:function(m){if(m){a=m.getPixelDistance(j.accuracy)>>1;q=m.getGridXYForPosition(j.pos);j.changed()}}});j.bind("gridUpdate",
function(m,B){j.update(B)});return j};return{distanceToString:function(f){if(f>1E3)return~~(f/10)/100+" km";return f?f+" m":""},dist2rad:function(f){return f/6371},getEngine:function(f){for(var e=null,k=1;!e&&k<arguments.length;k++)e=d(f,arguments[k]);e=e?e:d(f);if(!e)throw Error("Unable to find GEO engine with "+f+" capability");return e},lat2pix:c,lon2pix:r,pix2lat:h,pix2lon:b,radsPerPixel:function(f){return ca/(256<<f)},Position:da,BoundingBox:Ea,Radius:function(f,e){return{distance:parseInt(f,
10),uom:e}},Address:function(f){return f=COG.extend({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},f)},A:qa,GeocodeFieldWeights:{streetDetails:50,location:50},AddressCompareFns:{},Engine:function(f){if(!f.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var e=COG.extend({remove:function(){delete engines[e.id]}},f);return engines[e.id]=e},Search:Ka,GeoSearchResult:eb,LocationSearch:function(f){function e(m,B){navigator.geolocation.clearWatch(q);
q=0;if(a){clearTimeout(a);a=0}B&&B([m],f)}function k(m){COG.info("caught location tracking error:",m)}f=COG.extend({name:"Geolocation Search",requiredAccuracy:null,searchTimeout:5E3,watch:false},f);var q=0,a=0,j=null;return new T5.Geo.GeoSearchAgent(COG.extend({execute:function(m,B){if(navigator.geolocation&&!q){q=navigator.geolocation.watchPosition(function(I){var la=da.init(I.coords.latitude,I.coords.longitude);I=new eb({id:1,caption:"Current Location",pos:la,accuracy:I.coords.accuracy/1E3,matchWeight:100});
if(!j||I.accuracy<j.accuracy)j=I;if(!f.requiredAccuracy||j.accuracy<f.requiredAccuracy)e(j,B)},k,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3});if(f.searchTimeout)a=setTimeout(function(){j&&e(j,B)},f.searchTimeout)}}},f))},Routing:Ta}}();return Na}();
