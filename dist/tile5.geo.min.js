COG=typeof COG!=="undefined"?COG:{};COG.extend=function(){for(var Q=arguments[0]||{},ha,M=1,A=arguments.length;M<A;M++)if((ha=arguments[M])!==null)for(var k in ha){var l=ha[k];if(Q!==l)if(l!==undefined)Q[k]=l}return Q};
(function(){var Q=Object.prototype.hasOwnProperty,ha=0,M={};M.toID=function(A){return A.replace(/\s/g,"-")};M.objId=function(A){return(A?A:"obj")+ha++};M.isFunction=function(A){return toString.call(A)==="[object Function]"};M.isArray=function(A){return toString.call(A)==="[object Array]"};M.isPlainObject=function(A){if(!A||toString.call(A)!=="[object Object]"||A.nodeType||A.setInterval)return false;if(A.constructor&&!Q.call(A,"constructor")&&!Q.call(A.constructor.prototype,"isPrototypeOf"))return false;
var k;for(k in A);return k===undefined||Q.call(A,k)};M.isEmptyObject=function(A){for(var k in A)return false;return true};M.isXmlDocument=function(A){return toString.call(A)==="[object Document]"};M.contains=function(A,k){var l=A,v=arguments,D=1;if(k&&module.isArray(k)){v=k;D=0}for(D=D;D<v;D++)l=l&&typeof foo[v[D]]!=="undefined";return l};M.formatStr=function(A){if(arguments.length<=1)return A;for(var k=arguments.length-2,l=0;l<=k;l++)A=A.replace(RegExp("\\{"+l+"\\}","gi"),arguments[l+1]);return A};
M.wordExists=function(A,k){var l="";if(k.toString)k=k.toString();for(var v=0;v<k.length;v++)l+=!/\w/.test(k[v])?"\\"+k[v]:k[v];return RegExp("(^|\\s|\\,)"+l+"(\\,|\\s|$)","i").test(A)};COG.extend(COG,M)})();
(function(){function Q(l){return typeof console!=="undefined"?function(){console[l](Array.prototype.slice.call(arguments,0).join(" "));return true}:function(){return false}}var ha=window.console&&window.console.markTimeline,M=Q("error"),A=Q("info"),k=function(){return ha?function(l,v){console.markTimeline(l+(v?": "+((new Date).getTime()-v)+"ms":""))}:function(){}}();COG.extend(COG,{trace:k,debug:Q("debug"),info:A,warn:Q("warn"),error:M,exception:function(l){if(M)for(var v in l)A("ERROR DETAIL: "+
v+": "+l[v])}})})();
(function(){function Q(M,A){var k=M.obsHandlers;k[A]||(k[A]=[]);return k[A]}var ha=0;COG.observable=function(M){if(!M)return null;if(!M.obsHandlers)M.obsHandlers={};if(!(M.bind||M.trigger||M.unbind)){M.bind=function(A,k){var l="callback"+ha++;Q(M,A).unshift({fn:k,id:l});return l};M.triggerCustom=function(A,k){var l=Q(M,A),v={cancel:false,name:A,source:this},D;k&&COG.extend(v,k);if(!l)return null;D=Array.prototype.slice.call(arguments,2);M.eventInterceptor&&M.eventInterceptor(A,v,D);D.unshift(v);for(var U=
l.length;U--&&!v.cancel;)l[U].fn.apply(this,D);return v};M.trigger=function(A){var k=Array.prototype.slice.call(arguments,1);k.splice(0,0,A,null);return M.triggerCustom.apply(this,k)};M.unbind=function(A,k){if(typeof A==="undefined")M.obsHandlers={};else for(var l=Q(M,A),v=0;l&&v<l.length;v++)if(l[v].id===k){l.splice(v,1);break}return M}}return M}})();
(function(){function Q(k,l){k[l]||(k[l]=function(v){return k.configure(l,v)})}function ha(k){k.gtConfId="configurable"+A++;k.gtConfig={};k.gtConfigFns=[];return k.gtConfig}var M={},A=0;COG.paramTweaker=function(k,l,v){return function(D,U){if(typeof U!=="undefined"){if(D in k)k[D]=U;v&&D in v&&v[D](D,U)}else return l&&D in l?l[D](D):k[D]}};COG.configurable=function(k,l,v,D){if(k){k.gtConfId||ha(k);var U=k.gtConfId,m=k.gtConfig,I=k.gtConfigFns;M[U]=k;I.push(v);for(v=l.length;v--;){m[l[v]]=true;D&&Q(k,
l[v])}if(!k.configure)k.configure=function(B,J){if(m[B]){for(var x=I.length;x--;){var u=I[x](B,J);if(typeof u!=="undefined")return u}return M[U]}return null}}}})();
(function(){function Q(k){var l=document.createElement("script"),v=false;l.src=k;l.async=true;l.onload=l.onreadystatechange=function(){if(!v&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){v=true;l.onload=l.onreadystatechange=null;l&&l.parentNode&&l.parentNode.removeChild(l)}};M||(M=document.getElementsByTagName("head")[0]);M.appendChild(l)}var ha=0,M,A=this;COG.jsonp=function(k,l,v){k+=k.indexOf("?")>=0?"&":"?";var D="json"+ ++ha;A[D]=function(U){l(U);A[D]=null;try{delete A[D]}catch(m){}};
Q(k+(v?v:"callback")+"="+D);return D}})();
(function(){var Q=1.70158,ha=Math.PI/2,M=1E3/60|0,A=Math.abs,k=Math.pow,l=Math.sin,v=Math.asin,D=Math.cos,U={linear:function(m,I,B,J){return B*m/J+I},backin:function(m,I,B,J){return B*(m/=J)*m*((Q+1)*m-Q)+I},backout:function(m,I,B,J){return B*((m=m/J-1)*m*((Q+1)*m+Q)+1)+I},backinout:function(m,I,B,J){return(m/=J/2)<1?B/2*m*m*(((Q*=1.525)+1)*m-Q)+I:B/2*((m-=2)*m*(((Q*=1.525)+1)*m+Q)+2)+I},bouncein:function(m,I,B,J){return B-U.bounceout(J-m,0,B,J)+I},bounceout:function(m,I,B,J){return(m/=J)<1/2.75?
B*7.5625*m*m+I:m<2/2.75?B*(7.5625*(m-=1.5/2.75)*m+0.75)+I:m<2.5/2.75?B*(7.5625*(m-=2.25/2.75)*m+0.9375)+I:B*(7.5625*(m-=2.625/2.75)*m+0.984375)+I},bounceinout:function(m,I,B,J){return m<J/2?U.bouncein(m*2,0,B,J)/2+I:U.bounceout(m*2-J,0,B,J)/2+B/2+I},cubicin:function(m,I,B,J){return B*(m/=J)*m*m+I},cubicout:function(m,I,B,J){return B*((m=m/J-1)*m*m+1)+I},cubicinout:function(m,I,B,J){if((m/=J/2)<1)return B/2*m*m*m+I;return B/2*((m-=2)*m*m+2)+I},elasticin:function(m,I,B,J,x,u){if(m==0)return I;if((m/=
J)==1)return I+B;u||(u=J*0.3);if(!x||x<A(B)){x=B;B=u/4}else B=u/TWO_PI*v(B/x);return-(x*k(2,10*(m-=1))*l((m*J-B)*TWO_PI/u))+I},elasticout:function(m,I,B,J,x,u){var F;if(m==0)return I;if((m/=J)==1)return I+B;u||(u=J*0.3);if(!x||x<A(B)){x=B;F=u/4}else F=u/TWO_PI*v(B/x);return x*k(2,-10*m)*l((m*J-F)*TWO_PI/u)+B+I},elasticinout:function(m,I,B,J,x,u){var F;if(m==0)return I;if((m/=J/2)==2)return I+B;u||(u=J*0.3*1.5);if(!x||x<A(B)){x=B;F=u/4}else F=u/TWO_PI*v(B/x);if(m<1)return-0.5*x*k(2,10*(m-=1))*l((m*
J-F)*TWO_PI/u)+I;return x*k(2,-10*(m-=1))*l((m*J-F)*TWO_PI/u)*0.5+B+I},quadin:function(m,I,B,J){return B*(m/=J)*m+I},quadout:function(m,I,B,J){return-B*(m/=J)*(m-2)+I},quadinout:function(m,I,B,J){if((m/=J/2)<1)return B/2*m*m+I;return-B/2*(--m*(m-2)-1)+I},sinein:function(m,I,B,J){return-B*D(m/J*ha)+B+I},sineout:function(m,I,B,J){return B*l(m/J*ha)+I},sineinout:function(m,I,B,J){return-B/2*(D(Math.PI*m/J)-1)+I}};COG.tweenValue=function(m,I,B,J,x){function u(ga){ga=ga?ga:(new Date).getTime();if(wa+M<
ga){var ra=ga-F,na=B(ra,m,da,J),sa=F+J<=ga;ga=!sa;if(x){ra=x(na,sa,ra);ga=typeof ra!="undefined"?ra&&ga:ga}ga&&animFrame(u)}}var F=(new Date).getTime(),wa=0,da=I-m;animFrame(u);return{}};COG.easing=function(m){return U[m.replace(/[\-\_\s\.]/g,"").toLowerCase()]};COG.registerEasingType=function(m,I){U[m.replace(/[\-\_\s\.]/g,"").toLowerCase()]=I}})();
(function(){var Q=/^P(\d+Y)?(\d+M)?(\d+D)?$/,ha=/^(\d+H)?(\d+M)?(\d+S)?$/,M={8601:function(k){k=k.split("T");var l=null;l=null;var v=0,D=0;Q.lastIndex=-1;l=Q.exec(k[0]);v+=l[3]?parseInt(l[3].slice(0,-1),10):0;ha.lastIndex=-1;l=ha.exec(k[1]);D+=l[1]?parseInt(l[1].slice(0,-1),10)*3600:0;D+=l[2]?parseInt(l[2].slice(0,-1),10)*60:0;D+=l[3]?parseInt(l[3].slice(0,-1),10):0;return new A(v,D)}},A=COG.Duration=function(k,l){return{days:k?k:0,seconds:l?l:0}};COG.addDuration=function(){for(var k=new A,l=arguments.length;l--;){k.days+=
arguments[l].days;k.seconds+=arguments[l].seconds}if(k.seconds>=86400){k.days+=~~(k.seconds/86400);k.seconds%=86400}return k};COG.formatDuration=function(k){var l,v,D="";if(k.days)D=k.days+" days ";if(k.seconds){k=k.seconds;if(k>=3600){l=~~(k/3600);k-=l*3600}if(k>=60){v=Math.round(k/60);k-=v*60}if(l)D=D+l+(l>1?" hrs ":" hr ")+(v?(v>10?v:"0"+v)+" min ":"");else if(v)D=D+v+" min";else if(k>0)D=D+(k>10?k:"0"+k)+" sec"}return D};COG.parseDuration=function(k,l){var v=l?M[l]:null;if(v)return v(k);COG.Log.warn("Could not find duration parser for specified format: "+
l);return new A}})();COG.ObjectStore=function(){var Q={},ha={},M="obj_"+(new Date).getTime(),A=0,k=Object.prototype.hasOwnProperty;return{add:function(l,v){var D;v=v?v:"default";if(l&&l.constructor)if(!k.call(l,"id"))l.id=M+ ++A;D=ha[v]?ha[v]:ha[v]=[];Q[l.id]=D.length;D[l.length]=l}}};var CANI={};
(function(Q){var ha=[],M=0,A=false,k=Q.register=function(l,v){ha.push({section:l,run:v})};Q.init=function(l){function v(){if(M<ha.length){var U=ha[M++];D[U.section]||(D[U.section]={});U.run(D[U.section],v)}else{for(U in D)Q[U]=D[U];A=true;l&&l(Q)}}var D={};if(A&&l)l(Q);else{M=0;v()}};k("canvas",function(l,v){function D(){var B,J=U.getContext("2d");J.save();try{J.translate(50,50);J.beginPath();J.rect(0,0,20,20);B=J.isPointInPath(10,10)}finally{J.restore()}return B}var U=document.createElement("canvas"),
m=typeof FlashCanvas!="undefined",I=typeof G_vmlCanvasManager!="undefnined";U.width=200;U.height=200;l.pipTransformed=m||I?false:D();v()})})(CANI);
INTERACT=function(){function Q(x){return function(u,F,wa){(wa?wa:x?document.body:document).addEventListener(u,F,false)}}function ha(x){return function(u,F,wa){(wa?wa:x?document.body:document).removeEventListener(u,F,false)}}function M(x,u,F){(F?F:document).attachEvent("on"+x,u)}function A(x,u,F){(F?F:document).detachEvent("on"+x,u)}function k(x,u){return{x:x?x:0,y:u?u:0,count:1}}function l(x,u){B.push(COG.extend({handler:null,checks:{},type:x},u))}function v(x){var u=0,F=0;if(x.offsetParent){do{u+=
x.offsetLeft;F+=x.offsetTop;x=x.offsetParent}while(x)}return{left:u,top:F}}function D(x,u){return{source:x,target:u.target?u.target:u.srcElement}}function U(x,u){for(var F=x.target?x.target:x.srcElement;F&&F!==u&&F.nodeName&&F.nodeName.toUpperCase()!="CANVAS";)F=F.parentNode;return F&&F===u}function m(x,u){return{x:x.x-(u?u.left:0),y:x.y-(u?u.top:0)}}function I(x){if(x.preventDefault){x.preventDefault();x.stopPropagation()}else x.cancelBubble&&x.cancelBubble()}var B=[],J=function(x,u,F){function wa(ea,
ua,ia,X){var $=0,Ba=0,G=0;COG.tweenValue(0,ea,ia,X,function(K){G=$;$=K});COG.tweenValue(0,ua,ia,X,function(K){da.trigger("pan",$-G,K-Ba);Ba=K})}F=COG.extend({binder:null,unbinder:null,observable:null},F);for(var da=F.observable,ga=null,ra=[],na=[],sa,Aa,Ca={bind:function(){return da.bind.apply(null,arguments)},pannable:function(ea){ga=COG.extend({inertia:true},ea);return Ca},unbind:function(){da.unbind();for(var ea=0;ea<ra.length;ea++)ra[ea].unbind();return Ca}},Ua=0;Ua<u.length;Ua++)ra.push(u[Ua](x,
da,F));da.bind("pointerDown",function(){na=[];Aa=sa=0});da.bind("pointerMove",function(ea,ua,ia,X){if(ga){na[na.length]={ticks:(new Date).getTime(),x:X.x,y:X.y};da.trigger("pan",X.x,X.y)}sa+=X.x?X.x:0;Aa+=X.y?X.y:0});da.bind("pointerUp",function(ea,ua,ia){if(Math.abs(sa)>20||Math.abs(Aa)>20){if(ga){ia=na.length;var X,$;ua=0;for($=na.length;--$>1&&ua<50;)ua+=na[$].ticks-na[$-1].ticks;if(ia-$>1){ea=na[ia-1].x-na[$].x;X=na[ia-1].y-na[$].y;$=Math.sqrt(ea*ea+X*X)|0;if($>15){ea=na[ia-1].x-na[0].x;X=na[ia-
1].y-na[0].y;$=Math.sqrt(ea*ea+X*X)|0;ia=Math.asin(X/$);ua=$*500/ua|0;ua=ua>300?300:ua;wa(Math.cos(ea>0?ia:Math.PI-ia)*ua,Math.sin(ia)*ua,COG.easing("sine.out"),500)}}}}else da.trigger("tap",ua,ia)});return Ca};l("pointer",{handler:function(x,u,F){function wa(G){if(G.pageX&&G.pageY)return k(G.pageX,G.pageY);else{var K=document.documentElement,va=document.body;return k(G.clientX+(K&&K.scrollLeft||va&&va.scrollLeft||0)-(K&&K.clientLeft||va&&va.clientLeft||0),G.clientY+(K&&K.scrollTop||va&&va.scrollTop||
0)-(K&&K.clientTop||va&&va.clientTop||0))}}function da(G){if(U(G,x))if(ea=sa(G)){var K=wa(G);x.style.cursor="move";I(G);$=K.x;Ba=K.y;ua=k($,Ba);u.triggerCustom("pointerDown",D("mouse",G),ua,m(ua,v(x)))}}function ga(G){var K=wa(G);ia=K.x;X=K.y;if(U(G,x))Aa(G,ea?"pointerMove":"pointerHover")}function ra(G){if(ea&&sa(G)){ea=false;if(U(G,x)){x.style.cursor="default";Aa(G,"pointerUp")}}}function na(G){if(U(G,x)){var K;G=G||window.event;if(G.detail)K=G.axis===2?-G.detail*Ca:0;else{K=G.wheelDeltaY?G.wheelDeltaY:
G.wheelDelta;if(window.opera)K=-K}if(K!==0){var va=k(ia,X);u.triggerCustom("zoom",D("mouse",G),va,m(va,v(x)),K/Ua,"wheel");I(G);G.returnValue=false}}}function sa(G){G=G||window.event;return(G.which||G.button)==1}function Aa(G,K,va,oa,bb){va=typeof va!="undefined"?va:ia;oa=typeof oa!="undefined"?oa:X;var P=va-$,ma=oa-Ba,V=k(va,oa);u.triggerCustom(K,D("mouse",G),V,m(V,v(x)),k(P,ma));if(typeof bb=="undefined"||bb){$=va;Ba=oa}}F=COG.extend({},F);var Ca=120,Ua=Ca*8,ea=false,ua,ia,X,$,Ba;F.binder("mousedown",
da,false);F.binder("mousemove",ga,false);F.binder("mouseup",ra,false);F.binder("dblclick",function(G){COG.info("captured double click");if(U(G,x)){var K=wa(G);u.triggerCustom("doubleTap",D("mouse",G),K,m(K,v(x)))}},false);F.binder("mousewheel",na,document);F.binder("DOMMouseScroll",na,document);return{unbind:function(){F.unbinder("mousedown",da,false);F.unbinder("mousemove",ga,false);F.unbinder("mouseup",ra,false);F.unbinder("mousewheel",na,document);F.unbinder("DOMMouseScroll",na,document)}}},checks:{touch:false}});
l("pointer",{handler:function(x,u,F){function wa(P){if(P.count<2)return 0;var ma=P.x-P.next.x;P=P.y-P.next.y;return~~Math.sqrt(ma*ma+P*P)}function da(P,ma,V){ma=ma?ma:0;V=V?V:0;for(var La={x:P.x-ma,y:P.y-V,id:P.id,count:P.count},Na=La;P.next;){P=P.next;Na=Na.next={x:P.x-ma,y:P.y-V,id:P.id}}return La}function ga(P,ma){var V=P[ma?ma:"touches"],La,Na;if(V.length===0)return null;Na=La={x:V[0].pageX,y:V[0].pageY,id:V[0].identifier,count:V.length};for(var Wa=1,mb=V.length;Wa<mb;Wa++)Na=Na.next={x:V[Wa].pageX,
y:V[Wa].pageY,id:V[Wa].identifier};return La}function ra(P){if(U(P,x)){X=v(x);var ma=ga(P,"changedTouches"),V=da(ma,X.left,X.top);if(!Ba){$=ea;u.triggerCustom("pointerDown",D("touch",P),ma,V)}oa&&u.triggerCustom("pointerDownMulti",D("touch",P),ma,V);Ba=ga(P);if(Ba.count>1)K=wa(Ba);bb=1;va=da(Ba)}}function na(P){if(U(P,x)){P.preventDefault();G=ga(P);if($==ea)$=Math.abs(Ba.x-G.x)>Ca||Math.abs(Ba.y-G.y)>Ca?Ua:ea;if($!=ea){$=G.count>1?ia:ua;if($==ia)if(Ba.count===1){Ba=da(G);K=wa(Ba)}else{var ma=wa(G);
if(Math.abs(K-ma)<Aa)$=ua;else{var V;V=G.x;var La=G.next.x,Na=G.y,Wa=G.next.y,mb=Na<Wa?Na:Wa;V={x:(V<La?V:La)+(Math.abs(V-La)>>1),y:mb+(Math.abs(Na-Wa)>>1)};ma=ma/K;La=ma-bb;u.triggerCustom("zoom",D("touch",P),V,m(V,X),La,"pinch");bb=ma}}$==ua&&u.triggerCustom("pointerMove",D("touch",P),G,da(G,X.left,X.top),k(G.x-va.x,G.y-va.y));oa&&u.triggerCustom("pointerMoveMulti",D("touch",P),G,da(G,X.left,X.top))}va=da(G)}}function sa(P){if(U(P,x)){var ma=ga(P,"changedTouches"),V=da(ma,X.left,X.top);G=ga(P);
if(!G){u.triggerCustom("pointerUp",D("touch",P),ma,V);Ba=null}oa&&u.triggerCustom("pointerUpMulti",D("touch",P),ma,V)}}F=COG.extend({detailed:false,inertia:false},F);var Aa=20,Ca=7,Ua=0,ea=1,ua=2,ia=3,X,$,Ba,G,K,va,oa=F.detailed,bb=1;F.binder("touchstart",ra,false);F.binder("touchmove",na,false);F.binder("touchend",sa,false);COG.info("initialized touch handler");return{unbind:function(){F.unbinder("touchstart",ra,false);F.unbinder("touchmove",na,false);F.unbinder("touchend",sa,false)}}},checks:{touch:true}});
return{register:l,watch:function(x,u,F){u=COG.extend({bindToBody:false,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},u);capabilities=COG.extend({touch:"ontouchstart"in window},F);if(!u.observable){COG.info("creating observable");u.observable=COG.observable({});globalOpts=u}u.binder=u.isIE?M:Q(u.bindToBody);u.unbinder=u.isIE?A:ha(u.bindToBody);F=u.types;for(var wa=capabilities,da=[],ga=B.length;ga--;){var ra=B[ga],na=!F||F.indexOf(ra.type)>=0,sa=true;for(var Aa in ra.checks){var Ca=
ra.checks[Aa];COG.info("checking "+Aa+" capability. require: "+Ca+", capability = "+wa[Aa]);sa=sa&&Ca===wa[Aa]}if(na&&sa)da[da.length]=ra.handler}return new J(x,da,u)}}}();var T5={};
(function(Q){function ha(){return(new Date).getTime()}function M(){for(;Na.length>0;){var b=Na.shift();document.location=b}La=0}function A(b){for(var i=true,f=Wa.length;f--;)i=i&&b!=Wa[f];return i}function k(b,i){var f=[];for(var d in i)d&&f.push(d+"="+escape(i[d]));return"tile5://"+b+"/"+(f.length>0?"?"+f.join("&"):"")}function l(b,i){A(b)&&COG.info("would push url: "+k(b,i))}function v(b,i){if(A(b)){Na.push(k(b,i));La||(La=setTimeout(M,100))}}function D(b){return function(i,f,d){(d?d:b?document.body:
document).addEventListener(i,f,false)}}function U(b){return function(i,f,d){(d?d:b?document.body:document).removeEventListener(i,f,false)}}function m(b,i,f){(f?f:document).attachEvent("on"+b,i)}function I(b,i,f){(f?f:document).detachEvent("on"+b,i)}function B(){P={base:{name:"Unknown",bindEvent:D(),unbindEvent:U(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:l,targetFps:null},ie:{name:"MSIE",regex:/msie/i,
bindEvent:m,unbindEvent:I,requireFastDraw:false,targetFps:25},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:v,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:v},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:v},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:D(true),unbindEvent:U(true),supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},
bridgeNotify:v},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:v}};ma=[P.froyo,P.android,P.ipod,P.iphone,P.ipad,P.ie]}function J(){P||B();if(!V){COG.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var b=0;b<ma.length;b++){var i=ma[b];if(i.regex&&i.regex.test(navigator.userAgent)){V=COG.extend({},P.base,i);COG.info("PLATFORM DETECTED AS: "+V.name);break}}if(!V){COG.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
V=P.base}COG.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return V}function x(){var b=(new Date).getTime(),i=0;clearTimeout(pb);for(pb=0;i<nb.length;){var f=nb[i],d=jb[f],g=jb[f].image&&(Ib||jb[f].image.complete&&jb[f].image.width>0),t=b-d.start;t=g||t>=Qb;if(g){g=d.image;d=d.callbacks;Jb[f]=g;for(var r=0;r<d.length;r++)d[r](g,true)}if(t){nb.splice(i,1);delete jb[f]}else i++}if(nb.length>0)pb=setTimeout(x,mb)}function u(){for(var b=0,i=arguments.length;i--;){var f=Rb[arguments[i].toUpperCase()];
if(f)b|=f}return b}function F(b,i){var f,d;if(i&&i.width>0){if(!b.imageOffset)b.imageOffset=K.init(-i.width>>1,-i.height>>1);if(!b.bounds){f=b.xy.x+b.imageOffset.x;d=b.xy.y+b.imageOffset.y;b.bounds=oa.init(f,d,f+i.width,d+i.height)}}}function wa(b){function i(){b.transformed=g!==1||d%da!==0||t!==0||r!==0}var f=1E3/60|0,d=0,g=1,t=0,r=0;COG.extend(b,{animate:function(p,z,y,O,w,N){var fa=(new Date).getTime(),W=b[p],Y=z.length&&y.length&&z.length==y.length?z.length:0,aa=Array(Y),T=Array(Y),Da=COG.easing(O?
O:"sine.out"),ta=function(xa){xa=xa?xa:(new Date).getTime();if(xa-0>f){var eb=xa-fa;xa=fa+w<=xa;for(var ja=Y;ja--;)T[ja]=Da(eb,z[ja],aa[ja],w);W.apply(b,T);b.invalidate.call(b);if(xa){W.apply(b,y);b.invalidate.call(b);N&&N()}else animFrame(ta)}};if(W&&W.apply&&Y>0){w=w?w:1E3;for(p=Y;p--;)aa[p]=y[p]-z[p];animFrame(ta)}},rotate:function(p){d=p;i()},scale:function(p){g=p;i()},translate:function(p,z){t=p;r=z;i()},transform:function(p,z,y){p.save();p.translate(b.xy.x-z+t,b.xy.y-y+r);d!==0&&p.rotate(d);
g!==1&&p.scale(g,g)}})}window.animFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b){setTimeout(function(){b((new Date).getTime())},1E3/60)}}();var da=Math.PI*2,ga=Math.PI/2,ra=Math.abs,na=Math.ceil,sa=Math.min,Aa=Math.max,Ca=Math.pow,Ua=Math.sqrt,ea=Math.log,ua=Math.round,ia=Math.sin,X=Math.asin,$=Math.cos,Ba=Math.atan,G=Math.atan2,K=function(){function b(d,
g){return f(d.x-g.x,d.y-g.y)}function i(d,g){if(!g)g=d.length;if(g<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var t={edges:Array(g-1),accrued:Array(g-1),total:0},r=0;r<g-1;r++){var p=b(d[r],d[r+1]);t.edges[r]=Ua(p.x*p.x+p.y*p.y);t.accrued[r]=t.total+t.edges[r];t.total+=t.edges[r]}return t}function f(d,g){return{x:d?d:0,y:g?g:0}}return{VECTOR_SIMPLIFICATION:3,SIMPLIFICATION_MIN_VECTORS:25,add:function(){for(var d=0,g=0,t=arguments.length;t--;){d+=arguments[t].x;
g+=arguments[t].y}return f(d,g)},absSize:function(d){return Aa(ra(d.x),ra(d.y))},copy:function(d){return d?f(d.x,d.y):null},diff:b,distance:function(d,g){return i(d,g).total},edges:i,equals:function(d,g){return d.x===g.x&&d.y===g.y},extendBy:function(d,g,t){var r=$(g)*t;g=ia(g)*t;return f(d.x-r,d.y-g)},floor:function(d){for(var g=Array(d.length),t=d.length;t--;)g[t]=f(~~d[t].x,~~d[t].y);return g},getRect:function(d){for(var g,t,r,p,z=d.length;z--;){var y=d[z];g=typeof g==="undefined"||y.x<g?y.x:g;
t=typeof t==="undefined"||y.y<t?y.y:t;r=typeof r==="undefined"||y.x>r?y.x:r;p=typeof p==="undefined"||y.y>p?y.y:p}return oa.init(g,t,r,p)},init:f,invert:function(d){return f(-d.x,-d.y)},min:function(d,g){return f(d.x<g.x?d.x:g.x,d.y<g.y?d.y:g.y)},max:function(d,g){return f(d.x>g.x?d.x:g.x,d.y>g.y?d.y:g.y)},offset:function(d,g,t){return f(d.x+g,d.y+(t?t:g))},scale:function(d,g){return f(d.x/g|0,d.y/g|0)},simplify:function(d,g){if(!d)return null;g=g?g:K.VECTOR_SIMPLIFICATION;for(var t=[],r=null,p=d.length;p--;){var z=
d[p];if(include=!r||p===0||ra(z.x-r.x)+ra(z.y-r.y)>g){t.unshift(z);r=z}}return t},theta:function(d,g,t){t=X((d.y-g.y)/t);return d.x>g.x?t:Math.PI-t},toString:function(d){return d?d.x+", "+d.y:""}}}(),va=function(){return{dotProduct:function(b,i){return b.x*i.x+b.y*i.y}}}(),oa=function(){function b(f){return i(f.x1,f.y1,f.x2,f.y2)}function i(f,d,g,t){f=f?f:0;d=d?d:0;g=typeof g!=="undefined"?g:f;t=typeof t!=="undefined "?t:t;return{x1:f,y1:d,x2:g,y2:t,width:g-f,height:t-d}}return{center:function(f){return K.init(f.x1+
(f.width>>1),f.y1+(f.height>>1))},copy:b,diagonalSize:function(f){return Ua(f.width*f.width+f.height*f.height)},fromCenter:function(f,d,g,t){g=g>>1;t=t>>1;return i(f-g,d-t,f+g,d+t)},init:i,intersect:function(f,d){var g=Aa(f.x1,d.x1),t=Aa(f.y1,d.y1),r=sa(f.x2,d.x2),p=sa(f.y2,d.y2);g=i(g,t,r,p);return g.width>0&&g.height>0?g:null},toString:function(f){return f?"["+f.x1+", "+f.y1+", "+f.x2+", "+f.y2+"]":""},union:function(f,d){if(f.width===0||f.height===0)return b(d);else if(d.width===0||d.height===
0)return b(f);else{var g=sa(f.x1,d.x1),t=sa(f.y1,d.y1),r=Aa(f.x2,d.x2),p=Aa(f.y2,d.y2);g=i(g,t,r,p);return g.width>0&&g.height>0?g:null}}}}(),bb=function(){return{getAspectRatio:function(b){return b.height!==0?b.width/b.height:1},getCenter:function(b){return K.init(b.width>>1,b.height>>1)},getSize:function(b){return Ua(Ca(b.width,2)+Ca(b.height,2))},init:function(b,i){b=b?b:0;return{width:b,height:i?i:b}}}}();Hits=function(){return{diffHits:function(b,i){var f=[],d={},g;for(g=i.length;g--;)d[i[g].target.id]=
true;for(g=b.length;g--;)d[b[g].target.id]||(f[f.length]=b[g]);return f},init:function(b,i,f,d){return{type:b,x:d.x|0,y:d.y|0,elements:[],absXY:i,relXY:f}},initHit:function(b,i,f){return f=COG.extend({type:b,target:i,drag:false},f)},triggerEvent:function(b,i,f,d){i.triggerCustom(b.type+(f?f:"Hit"),{hitType:b.type},d?d:b.elements,b.absXY,b.relXY,K.init(b.x,b.y))}}}();var P=null,ma=[],V=null,La=0,Na=[],Wa=["view.wake","tile.loaded"],mb=100,Qb=3E4,Jb={},Sb=0;(new Date).getTime();var jb={},nb=[],Ib=typeof FlashCanvas!=
"undefined",pb=0,xb=T5.getImage=function(b,i){var f=b&&i?Jb[b]:null;if(f&&f&&(Ib||f.complete&&f.width>0))i(f);else{if(f=jb[b])f.callbacks.push(i);else{f=new Image;f.id="_ldimg"+ ++Sb;jb[b]={start:(new Date).getTime(),image:f,callbacks:[i]};f.src=b;nb[nb.length]=b}pb||(pb=setTimeout(x,mb))}};T5.newCanvas=function(b,i){var f=document.createElement("canvas");f.width=b?b:0;f.height=i?i:0;if(typeof FlashCanvas!="undefined"){document.body.appendChild(f);FlashCanvas.initElement(f)}typeof G_vmlCanvasManager!=
"undefined"&&G_vmlCanvasManager.initElement(f);return f};var yb=function(){var b={};return{init:function(i,f){var d=b[i];if(!d)throw Error("Unable to locate requested generator: "+i);return new d(f)},register:function(i,f){b[i]=f},Template:function(){}}}(),qb=function(){function b(r,p){g[r]=f(p);return r}function i(r){for(var p in r)b(p,r[p])}function f(r){function p(w){var N=r[w];typeof N!=="undefined"&&y.push(function(fa){fa[w]=N})}function z(){y=[];for(var w in r)p(w)}r=COG.extend({lineWidth:undefined,
lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},r);var y=[],O={applyToContext:function(w){for(var N=y.length;N--;)y[N](w)},update:function(w,N){r[w]=N;z()}};z();return O}var d={},g={},t={apply:function(r,p){var z=g[p]?g[p]:g.basic,y;if(r&&r.canvas){y=d[r.canvas.id];d[r.canvas.id]=p}z.applyToContext(r);return y},define:b,defineMany:i,get:function(r){return g[r]},init:f,load:function(r){COG.jsonp(r,
function(p){i(p)})}};i({basic:{lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"},waypoints:{lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"},waypointsHover:{lineWidth:4,strokeStyle:"#f00",fillStyle:"#FFF"}});return t}(),Rb={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,ZOOM:16,FREEZE:128},Ob=function(b){function i(q,s,E){Xa||Oa(ya-s,e-E)}function f(q,s,E,ka){ja(sa(Aa(Ia+Ca(2,ka)-1,0.5),2))}function d(){var q=ea(Ia)/Math.LN2|0;if(q!==0){Ia=Ca(2,q);fb(rb+q,sb,tb)}ta()}function g(q){q||(q=K.init(Ea,
S));R=K.init(ya,e);Z=K.offset(q,ya,e);sb=Z.x;tb=Z.y}function t(q,s){var E=1/Ia;return K.init(ba?ba.x1+q*E:q,ba?ba.y1+s*E:s)}function r(q,s,E){gb("doubleTap",s,E,t(E.x,E.y));b.scalable&&ja(2,E,b.zoomEasing,null,b.zoomDuration)}function p(q,s,E){Xa=null;Da("down",s,E)}function z(q,s,E){Da("hover",s,E)}function y(q,s,E){aa(s,E,false)}function O(q,s,E){aa(s,E,true)}function w(){clearTimeout(Kb);Kb=setTimeout(fa,250)}function N(q,s,E){Da("tap",s,E);gb("tap",s,E,t(E.x,E.y,true))}function fa(q,s){var E;
kb=typeof FlashCanvas!=="undefined";COG.info("is flash = "+kb);if(Fa){if(b.autoSize&&Fa.parentNode){q=Fa.parentNode.offsetWidth;s=Fa.parentNode.offsetHeight}try{if(!Fa.id)Fa.id=b.id+"_canvas";Ja=Fa.getContext("2d")}catch(ka){COG.exception(ka);throw Error("Could not initialise canvas on specified view element");}if(q&&s&&(Pa!==s||Qa!==q)){zb=true;Qa=q;Pa=s;Ea=Qa>>1;S=Pa>>1;Ha.trigger("resize",Qa,Pa);for(E=Ma;E--;)la[E].trigger("resize",Qa,Pa)}for(E=Ma;E--;)la[E].trigger("contextChanged",Ja);ta();Y()}}
function W(q,s){s.setId(q);s.added=ha();s.bind("remove",function(){Ha.removeLayer(q)});s.trigger("contextChanged",Ja);s.setParent(Ha);la.push(s);la.sort(function(E,ka){var pa=ka.zindex-E.zindex;if(pa===0)pa=ka.added-E.added;return pa});Ma=la.length;return s}function Y(){Va&&Va.unbind();Va=INTERACT.watch(Fa);b.pannable&&Va.pannable().bind("pan",i);if(b.scalable){Va.bind("zoom",f);Va.bind("doubleTap",r)}Va.bind("pointerDown",p);Va.bind("pointerMove",y);Va.bind("pointerUp",O);b.captureHover&&Va.bind("pointerHover",
z);Va.bind("tap",N)}function aa(q,s,E){if(Xa){q=t(s.x,s.y);Xa.drag.call(Xa.target,Xa,q.x,q.y,E)&&ta();if(E)Xa=null}}function T(q){var s,E,ka=false;if(Ab|kb){q=q?q:(new Date).getTime();if(q-Lb>Tb){E=ya!==j||e!==n;cb=Mb|(Ia!==1?Nb:0)|(E?Bb:0)|(Cb?Db:0);qa=(s=(cb&(Nb|Bb))!==0)&&(cb&Db)===0;if(zb&&Fa){Fa.width=Qa;Fa.height=Pa;Fa.style.width=Qa+"px";Fa.style.height=Pa+"px";kb&&FlashCanvas.initElement(Fa);typeof G_vmlCanvasManager!="undefined"&&G_vmlCanvasManager.initElement(Fa);zb=false}H=xa();for(E=Ma;E--;){cb|=
la[E].animated?Db:0;la[E].cycle(q,H,cb);ka=la[E].clip||ka}E=cb;var pa=H;ka=C&&ka&&!s;s=q;var Ka;oa.center(pa);var Ra=0,Sa;if(Ia!==1){Sa=1/Ia;sb=Z.x+(ya-R.x);tb=Z.y+(e-R.y);Sa=pa?oa.fromCenter(sb>>0,tb>>0,pa.width*Sa>>0,pa.height*Sa>>0):void 0}else Sa=oa.copy(pa);ba=Sa;ka||Ja.clearRect(0,0,Qa,Pa);ba.scaleFactor=Ia;Ja.save();try{Ia!==1&&Ja.scale(Ia,Ia);Ya=za=null;if(ka){Ja.beginPath();for(Ra=Ma;Ra--;)la[Ra].clip&&la[Ra].clip(Ja,ba,E,Ha,s);Ja.closePath();Ja.clip()}Ja.globalCompositeOperation="source-over";
for(Ra=Ma;Ra--;){Ka=la[Ra];if(Ka.shouldDraw(cb,H)){var Ta=Ka.style,hb=Ta?qb.apply(Ja,Ta):null;Ka.draw(Ja,ba,E,Ha,s,L);hb&&qb.apply(Ja,hb)}}}finally{Ja.restore()}Ab=0;gb("drawComplete",pa,s);if(L){Ka=L?L.elements:[];if(ib&&ib.type==="hover"){Ta=Hits.diffHits(ib.elements,Ka);Ta.length>0&&Hits.triggerEvent(ib,Ha,"Out",Ta)}if(Ka.length>0){hb=L.x;E=L.y;for(Ta=Ka.length;Ta--;){pa=Ka[Ta];ka=hb;s=E;if(Ra=pa&&pa.drag&&(!pa.canDrag||pa.canDrag(pa,ka,s))){Xa=pa;Xa.startX=ka;Xa.startY=s}if(Ra)break}Hits.triggerEvent(L,
Ha)}ib=Ka.length>0?COG.extend({},L):null;L=null}q-$a>Eb&&eb();Lb=q;j=ya;n=e}animFrame(T)}else ca=false}function Da(q,s,E){L=Hits.init(q,s,E,t(E.x,E.y,true));for(q=Ma;q--;)db=db||(la[q].hitGuess?la[q].hitGuess(L.x,L.y,cb,Ha):false);db&&ta()}function ta(){Ab+=1;if(!ca){ca=true;animFrame(T)}}function xa(){return oa.init(ya,e,ya+Qa,e+Pa)}function eb(){if(o||a){var q=c?ya+Ea:ya,s=h?e+S:e;if(o&&o>Qa)if(q+Qa>o)ya=c?q-o>0?ya-o:ya:o-Qa;else if(q<0)ya=c?ya+o:0;if(a&&a>Pa)if(s+Pa>a)e=h?s-a>0?e-a:e:a-Pa;else if(s<
0)e=h?e+a:0}$a=(new Date).getTime();gb("refresh",Ha,xa());ta()}function ja(q,s,E,ka,pa){if(E)COG.tweenValue(Ia,q,E,pa,function(Ka,Ra){Ia=Ka;if(Ra){var Sa=ua(ea(Ia)/Math.LN2);Ia=Ca(2,Sa);ka&&ka()}g(s);d()});else{Ia=q;g(s);d()}return Ha}function fb(q,s,E){q=Aa(b.minZoom,sa(b.maxZoom,q));if(q!==rb){var ka=Ca(2,q-rb),pa=Ea/ka|0,Ka=S/ka|0;rb=q;Oa(((s?s:ya+Ea)-pa)*ka,((E?E:e+S)-Ka)*ka);j=ya;n=e;gb("zoomLevelChange",q);Ia=1;eb()}}function gb(){for(var q=Ha.trigger.apply(null,arguments).cancel,s=la.length;s--;)q=
la[s].trigger.apply(null,arguments).cancel||q;return!q}function Oa(q,s,E,ka,pa){function Ka(){Ra+=1;if(Ra>=2){Cb=false;pa&&pa()}}var Ra=0,Sa=za?K.offset(za,-Ea,-S):null,Ta=Ya?K.offset(Ya,-Ea,-S):null;if(Sa){q=q<Sa.x?Sa.x:q;s=s<Sa.y?Sa.y:s}if(Ta){q=q>Ta.x?Ta.x:q;s=s>Ta.y?Ta.y:s}if(E){if((cb&Bb)===0){COG.tweenValue(ya,q,E,ka,function(hb,Fb){ya=hb|0;(Fb?Ka:ta)();return!qa});COG.tweenValue(e,s,E,ka,function(hb,Fb){e=hb|0;(Fb?Ka:ta)();return!qa});Cb=true}}else{ya=q|0;e=s|0;ta();pa&&pa()}}b=COG.extend({id:COG.objId("view"),
container:"",captureHover:true,captureDrag:false,fastDraw:false,inertia:true,minRefresh:1E3,pannable:false,clipping:true,scalable:false,panAnimationEasing:COG.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,autoSize:true,tapExtent:10,guides:false,turbo:false,fps:25,minZoom:1,maxZoom:1,zoomEasing:COG.easing("quad.out"),zoomDuration:300,zoomLevel:1},b);var la=[],Ma=0,Fa=document.getElementById(b.container),Xa=null,Ja=null,Gb=typeof window.attachEvent!="undefined",kb,db=false,
Eb=b.minRefresh,ya=0,e=0,j=0,n=0,o=null,a=null,c=false,h=false,C=b.clipping,H=null,ca=false,ba,Ga=1,Ea=0,S=0,L=null,R=null,Z=null,qa=false,za=null,Ya=null,$a=0,ib=null,Kb=0,Ia=1,Lb=0,zb=false,Va=null,Cb=false,Pa,Qa,Tb=1E3/b.fps|0,Ab=0,sb,tb,rb=b.zoomLevel,Mb=u("ACTIVE"),Bb=u("PAN"),Nb=u("ZOOM"),Db=u("ANIMATING"),cb=Mb,Ha={id:b.id,deviceScaling:Ga,fastDraw:b.fastDraw||J().requireFastDraw,detach:function(){Va&&Va.unbind()},eachLayer:function(q){for(var s=Ma;s--;)q(la[s])},getDimensions:function(){return bb.init(Qa,
Pa)},getLayer:function(q){for(var s=0;s<Ma;s++)if(la[s].getId()==q)return la[s];return null},getZoomLevel:function(){return rb},setLayer:function(q,s){for(var E=0;E<Ma;E++)if(la[E].getId()===q){la.splice(E,1);break}if(s){W(q,s);s.trigger("refresh",Ha,xa())}ta();return s},invalidate:ta,refresh:eb,resetScale:function(){Ia=1},resize:function(q,s){if(Fa){b.autoSize=false;if(Qa!==q||Pa!==s)fa(q,s)}},scale:ja,setZoomLevel:fb,syncXY:function(){},triggerAll:gb,removeLayer:function(q){a:{for(var s=Ma;s--;)if(la[s].getId()==
q){q=s;break a}q=-1}if(q>=0&&q<Ma){Ha.trigger("layerRemoved",la[q]);la.splice(q,1);ta()}Ma=la.length},getOffset:function(){return K.init(ya,e)},setMaxOffset:function(q,s,E,ka){o=q;a=s;c=typeof E!="undefined"?E:false;h=typeof ka!="undefined"?ka:false},getViewRect:xa,updateOffset:Oa,pan:function(q,s,E,ka,pa){Oa(ya+q,e+s,E,ka,pa)}};Ga=J().getScaling();COG.observable(Ha);Ha.bind("invalidate",function(){ta()});Ha.bind("resync",function(){Ya=za=null});COG.configurable(Ha,["container","captureHover","captureDrag",
"scalable","pannable","inertia","minZoom","maxZoom","zoom"],COG.paramTweaker(b,null,{container:function(q,s){Fa=document.getElementById(s);fa()},inertia:Y,captureHover:Y,scalable:Y,pannable:Y}),true);CANI.init(function(q){Ha.markers=W("markers",new ub({zindex:20}));canvasCaps=q.canvas;fa();if(b.autoSize)Gb?window.attachEvent("onresize",w):window.addEventListener("resize",w,false)});return Ha},Hb=function(b){b=COG.extend({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:u("ACTIVE","ANIMATING",
"PAN","ZOOM"),style:null,minXY:null,maxXY:null},b);var i=null,f=false,d=false,g=b.id,t=u("ACTIVE"),r=b.validStates,p=0,z=0,y=COG.extend({addToView:function(O){O.setLayer(g,y)},shouldDraw:function(O){return(O&r)!==0},clip:null,cycle:function(){},draw:function(){},hitGuess:null,remove:function(){y.trigger("remove",y)},changed:function(){d=true;i&&i.invalidate()},hitTest:null,getId:function(){return g},setId:function(O){g=O},getParent:function(){return i},setParent:function(O){f=(i=O)?i.fastDraw&&displayState!==
t:false;y.trigger("parentChange",i)}},b);COG.observable(y);y.bind("drawComplete",function(O,w){d=false;p=w.x1;z=w.y1});y.bind("resync",function(O,w){y.minXY&&w.syncXY(y.minXY);y.maxXY&&w.syncXY(y.maxXY)});return y},ab=function(b){b=COG.extend({style:null,xy:null,size:null,fill:false,stroke:true,draggable:false,observable:true,properties:{},type:"shape",transformable:false},b);COG.extend(this,b);this.id=COG.objId(this.type);this.bounds=null;this.observable&&COG.observable(this);this.transformable&&
wa(this);this.transformed=false};ab.prototype={constructor:ab,drag:null,draw:function(b){this.fill&&b.fill();this.stroke&&b.stroke()},invalidate:function(){var b=this.layer?this.layer.getParent():null;b&&b.invalidate()},prepPath:function(){},resync:function(b){if(this.xy){b.syncXY([this.xy]);this.size&&this.updateBounds(oa.fromCenter(this.xy.x,this.xy.y,this.size,this.size))}},setTransformable:function(b){b&&!this.transformable&&wa(this);this.transformable=b},updateBounds:function(b,i){this.bounds=
b;if(i)this.xy=oa.center(this.bounds)}};var vb=function(b){ab.call(this,b)};vb.prototype=COG.extend(ab.prototype,{constructor:vb,prepPath:function(b,i,f){b.beginPath();b.arc(this.xy.x-i,this.xy.y-f,this.size>>1,0,Math.PI*2,false);return true}});var lb=function(b,i){i=COG.extend({simplify:false},i);var f=false,d=i.simplify;u("ZOOM");var g=[];i.type=i.fill?"polygon":"line";ab.call(this,i);COG.extend(this,{animatePath:function(){},prepPath:function(t,r,p){if(f){var z=true;t.beginPath();for(var y=g.length;y--;){var O=
g[y].x-r,w=g[y].y-p;if(z){t.moveTo(O,w);z=false}else t.lineTo(O,w)}}return f},resync:function(t){var r,p,z,y,O;t.syncXY(b);g=K.floor(d?K.simplify(b):b);for(var w=g.length;w--;){t=g[w].x;r=g[w].y;y=typeof y=="undefined"||t<y?t:y;O=typeof O=="undefined"||r<O?r:O;p=typeof p=="undefined"||t>p?t:p;z=typeof z=="undefined"||r>z?r:z}this.updateBounds(oa.init(y,O,p,z),true)}});f=b&&b.length>=2};lb.prototype=COG.extend(ab.prototype,{constructor:lb});var Pb=function(b,i){i.fill=false;lb.call(this,b,i)};Pb.prototype=
new lb;var ob=function(b){function i(z){(this.imageUrl=z)&&xb(this.imageUrl,function(y,O){r=y;if(O){var w=p.layer?p.layer.getParent():null;w&&w.invalidate()}})}b=COG.extend({image:null,imageUrl:null,imageOffset:null},b);var f=null,d=ab.prototype.updateBounds,g,t,r=b.image;ab.call(this,b);var p=COG.extend(this,{changeImage:i,drag:function(z,y,O,w){f||(f=K.init(z.startX-this.xy.x,z.startY-this.xy.y));this.xy.x=y-f.x;this.xy.y=O-f.y;if(w){f=null;if(this.layer)(z=this.layer.getParent())&&z.syncXY([this.xy],
true);this.trigger("dragDrop")}return true},draw:function(z){z.drawImage(r,g,t)},prepPath:function(z,y,O){var w=r&&r.width>0;if(w){F(this,r);g=this.xy.x+this.imageOffset.x-y;t=this.xy.y+this.imageOffset.y-O;z.beginPath();z.rect(g,t,r.width,r.height)}return w},updateBounds:function(z,y){d.call(this,z,y);F(this,r)}});r||i(this.imageUrl)};ob.prototype=new ab;ob.prototype.constructor=ob;var wb=function(b){b=COG.extend({imageAnchor:null},b);if(b.imageAnchor)b.imageOffset=K.invert(b.imageAnchor);ob.call(this,
b)};wb.prototype=new ob;wb.prototype.constructor=wb;var ub=function(b){function i(p){for(var z=d.length;z--;)d[z].resync(p);d.sort(function(y,O){var w=O.xy.y-y.xy.y;return w!=0?w:O.xy.x-y.xy.y});r.changed()}function f(p,z){i(z)}b=COG.extend({zindex:10},b);var d=[],g=CANI.canvas.pipTransformed,t=typeof FlashCanvas!="undefined",r=COG.extend(new Hb(b),{add:function(p,z){if(p){p.layer=r;var y=r.getParent();if(y){p.resync(r.getParent());y.invalidate()}if(z)d.unshift(p);else d[d.length]=p}},clear:function(){d=
[]},draw:function(p,z,y,O,w,N){O=z.x1;w=z.y1;var fa=N?g?N.x-O:N.relXY.x:0,W=N?g?N.y-w:N.relXY.y:0,Y=z.width;z=z.height;for(var aa=d.length;aa--;){var T=d[aa],Da=T.style||r.style,ta,xa=T.transformed&&!t;if(xa){T.transform(p,O,w);if(g){fa-=T.xy.x;W-=T.xy.y}}if(T.prepPath(p,xa?T.xy.x:O,xa?T.xy.y:w,Y,z,y)){if(N&&p.isPointInPath(fa,W)){N.elements.push(Hits.initHit(T.type,T,{drag:T.draggable?T.drag:null}));ta=N.type+"Style";Da=T[ta]||r[ta]||Da}Da=Da?qb.apply(p,Da):null;T.draw(p,O,w,Y,z,y);Da&&qb.apply(p,
Da)}xa&&p.restore()}},find:function(){return[].concat(d)},hitGuess:function(p,z){for(var y=false,O=d.length;!y&&O--;){var w=d[O];if(!(y=y))y=(w=w.bounds)&&p>=w.x1&&p<=w.x2&&z>=w.y1&&z<=w.y2;y=y}return y}});r.bind("parentChange",f);r.bind("resync",f);return r},Ub=function(){return{tileSize:256,init:function(b,i,f,d,g){return COG.extend({x:b,y:i,width:f,height:d},g)}}}();COG.extend(Q,{ex:COG.extend,ticks:ha,getConfig:J,userMessage:function(b,i,f){Q.trigger("userMessage",b,i,f)},XY:K,XYRect:oa,Dimensions:bb,
Vector:va,Hits:Hits,Generator:yb,tween:COG.tween,tweenValue:COG.tweenValue,easing:COG.easing,Tween:COG.Tween,Style:qb,viewState:u,View:Ob,ViewLayer:Hb,ImageLayer:function(b,i){function f(w,N,fa,W){N.image?w.drawImage(N.image,fa,W):xb(N.url,function(Y){N.image=Y;O.changed()})}function d(w,N,fa){for(N=p.length;N--;){var W=p[N],Y=W.x,aa=W.y,T=oa.init(W.x,W.y,W.x+W.width,W.y+W.height);fa&&oa.intersect(w,T)&&xb(W.url,function(Da,ta){fa(Da,Y,aa,W.width,W.height);ta&&O.changed()},y)}}function g(w){var N=
z?Math.abs(z.x1-w.x1)+Math.abs(z.y1-w.y1):0;if(t&&(!z||N>256)){var fa=++r;N=O.getParent();t.run(N,w,function(W){z=oa.copy(w);if(fa==r)for(var Y=W.length;Y--;){var aa=W[Y];p[p.length]={image:null,sequence:fa,url:aa.url,rect:oa.init(aa.x,aa.y,aa.x+aa.width,aa.y+aa.height)}}})}}i=COG.extend({imageLoadArgs:{}},i);var t=b?yb.init(b,i):null,r=0,p=[],z=null,y=i.imageLoadArgs,O=COG.extend(new Hb(i),{changeGenerator:function(w,N){t=yb.init(w,COG.extend({},i,N));g(O.getParent().getViewRect())},clip:function(w,
N){for(var fa=N.x1,W=N.y1,Y=p.length;Y--;){var aa=p[Y].rect;oa.intersect(N,aa)&&w.rect(aa.x1-fa,aa.y1-W,aa.width,aa.height)}},draw:function(w,N){for(var fa=N.x1,W=N.y1,Y=0;Y<p.length;){var aa=p[Y],T=aa.rect;oa.intersect(N,T)&&f(w,aa,T.x1-fa,T.y1-W);if(aa.sequence!==r)p.splice(Y,1);else Y++}},mask:function(w,N,fa){d(N,fa,function(W,Y,aa,T,Da){COG.info("clearing rect @ x = "+Y+", y = "+aa+", width = "+T+", height = "+Da);w.clearRect(Y,aa,T,Da)})}});O.bind("refresh",function(w,N,fa){g(fa)});O.bind("tap",
function(w,N,fa,W){w=[];var Y=W.x,aa=W.y,T,Da;if(p)for(var ta=p.length;ta--;){T=p[ta];if(Da=Y>=T.x&&Y<=T.x+T.width&&aa>=T.y&&aa<=T.y+T.height)w[w.length]=T}w.length>0&&O.trigger("tapImage",w,N,fa,W)});return O},ImageGenerator:function(b){b=COG.extend({relative:false,padding:2},b);b={run:function(){COG.warn("running base generator - this should be overriden")}};COG.observable(b);return b},Drawable:ab,Marker:vb,Poly:lb,Line:Pb,ImageDrawable:ob,ImageMarker:wb,ShapeLayer:ub,transformable:wa,Tiling:Ub});
COG.observable(Q);var Za=Q.Geo=function(){function b(e){for(var j=null,n=1;!j&&n<arguments.length;n++)j=t(e,arguments[n]);j=j?j:t(e);if(!j)throw Error("Unable to find GEO engine with "+e+" capability");return j}function i(e){e=parseFloat(e)*w;e=ia(e);var j=T*e;return ea((1+e)/(1-e)*Ca((1-j)/(1+j),T))/2}function f(e){return parseFloat(e)*w}function d(e){e=Ca(Math.E,-e);for(var j=ga-2*Ba(e),n=r(j,e),o=0;o<ta&&ra(j-n)>Da;){j=n;n=r(j,e);o++}return n*N}function g(e){return e%360*N}function t(e,j){var n=
null;for(var o in la)if(j){if(o==j&&la[o][e]){n=la[o];break}}else if(la[o][e]){n=la[o];break}return n}function r(e,j){var n=T*ia(e);return ga-2*Ba(j*Ca((1-n)/(1+n),T/2))}function p(e,j,n,o){j=z(j);e.add(o(j,n));return j.length}function z(e){var j=e?e.length:0,n=Array(j);for(j=j;j--;)n[j]=Za.Position.init(e[j][1],e[j][0]);return Za.Position.vectorize(n,kb)}function y(e,j,n){return new ya(e,j,n)}var O=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],w=Math.PI/
180,N=180/Math.PI,fa=ga,W=-fa,Y=da,aa=-Y,T=0.08181919084262157,Da=1.0E-7,ta=12,xa=null,eb={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",HWY:"HIGHWAY",MWY:"MOTORWAY"},ja=function(){function e(a){return a?n(a.lat,a.lon):null}function j(a){return!a||a.lat===0&&a.lon===0}function n(a,c){return{lat:parseFloat(a?a:0),lon:parseFloat(c?c:0)}}function o(a){if(a)if(typeof a.lat!=="undefined")return e(a);else{if(a.split)for(var c=[" ",","],h=0;h<c.length;h++){var C=a.split(c[h]);
if(C.length===2)return n(C[0],C[1])}}else return n();return null}return{calcDistance:function(a,c){if(j(a)||j(c))return 0;var h=(c.lat-a.lat)*w>>1,C=(c.lon-a.lon)*w>>1;h=ia(h)*ia(h)+$(a.lat*w)*$(c.lat*w)*ia(C)*ia(C);return 6371*2*G(Ua(h),Ua(1-h))},copy:e,empty:j,equal:function(a,c){return a&&c&&a.lat==c.lat&&a.lon==c.lon},fromMercatorPixels:function(a,c){return n(d(c),g(a))},generalize:function(a,c,h){var C=a.length,H=[],ca=null;h||(h=250);h/=1E3;COG.info("generalizing positions, must include "+c.length+
" positions");for(var ba=C;ba--;)if(ba===0)H.unshift(a[ba]);else{var Ga=!ca||ja.inArray(a[ba],c)?h:ja.calcDistance(ca,a[ba]);if(a[ba]&&Ga>=h){H.unshift(a[ba]);ca=a[ba]}}COG.info("generalized "+C+" positions into "+H.length+" positions");return H},inArray:function(a,c){for(var h=ja.equal,C=c.length;C--;)if(h(a,c[C]))return true;return false},inBounds:function(a,c){var h=!(ja.empty(a)||ja.empty(c));return h=(h=h&&a.lat>=c.min.lat&&a.lat<=c.max.lat)&&a.lon>=c.min.lon&&a.lon<=c.max.lon},init:n,offset:function(a,
c,h){var C=a.lat*w;a=a.lon*w;c=C+c/6371;h=X(ia(h/6371)/$(C));h=a+h;c=(c+ga)%Math.PI-ga;h%=da;return n(c*N,h*N)},parse:o,parseArray:function(a){var c=a.length,h=Array(c);for(c=c;c--;)h[c]=o(a[c]);return h},toMercatorPixels:function(a){return T5.XY.init(f(a.lon),i(a.lat))},toString:function(a){return a?a.lat+" "+a.lon:""},vectorize:function(a,c){function h(){for(var ba=0,Ga=c.chunkSize,Ea=C;Ea--;){H[Ea]=T5.GeoXY.init(a[Ea]);ba+=1;if(ba>Ga)break}C=Ea;if(C<=0)c.callback&&c.callback(H);else animFrame(h)}
var C=a.length,H=Array(C);c=COG.extend({chunkSize:500,async:true,callback:null},c);if(!c.async){for(var ca=C;ca--;)H[ca]=T5.GeoXY.init(a[ca]);return H}animFrame(h);return null}}}(),fb=function(){function e(a,c,h){var C=T5.XY.init(0,c.lat-a.lat);if(typeof h==="undefined")h=true;C.x=h&&a.lon>c.lon?360-a.lon+c.lon:c.lon-a.lon;return C}function j(a,c){return fb.init(ja.init(a.min.lat-c,a.min.lon-c%360),ja.init(a.max.lat+c,a.max.lon+c%360))}function n(a){var c=e(a.min,a.max);return ja.init(a.min.lat+(c.y>>
1),a.min.lon+(c.x>>1))}function o(a,c){return{min:ja.parse(a),max:ja.parse(c)}}return{calcSize:e,createBoundsFromCenter:function(a,c){var h=c/6371,C=a.lat*w,H=a.lon*w,ca=C-h,ba=C+h;if(ca>W&&ba<fa){C=X(ia(h)/$(C));h=(H-C)%da;H=(H+C)%da}else{ca=Aa(ca,W);ba=sa(ba,fa);h=aa;H=Y}return fb.init(ja.init(ca*N,h*N),ja.init(ba*N,H*N))},expand:j,forPositions:function(a,c){var h=null,C=T5.ticks();c||(c="auto");for(var H=a.length;H--;)if(h){var ca=e(h.min,a[H],false),ba=e(a[H],h.max,false);if(ca.x<0)h.min.lon=
a[H].lon;if(ca.y<0)h.min.lat=a[H].lat;if(ba.x<0)h.max.lon=a[H].lon;if(ba.y<0)h.max.lat=a[H].lat}else h=o(a[H],a[H]);if(c){if(c=="auto"){H=e(h.min,h.max);c=Aa(H.x,H.y)*0.3}h=j(h,c)}COG.trace("calculated bounds for "+a.length+" positions",C);return h},getCenter:n,getGeoHash:function(a){var c=T5.Geo.GeoHash.encode(a.min.lat,a.min.lon);a=T5.Geo.GeoHash.encode(a.max.lat,a.max.lon);COG.info("min hash = "+c+", max hash = "+a)},getZoomLevel:function(a,c){var h=n(a);h=sa(ua(ra(h.lat)*0.05),O.length);var C=
O[h],H=e(a.min,a.max);h=na(ea(O[3]*c.height/H.y)/ea(2));C=na(ea(C*c.width/H.x)/ea(2));return sa(isNaN(h)?1E3:h,isNaN(C)?1E3:C)},init:o,isEmpty:function(a){return!a||ja.empty(a.min)||ja.empty(a.max)},toString:function(a){return"min: "+ja.toString(a.min)+", max: "+ja.toString(a.max)}}}(),gb=function(){var e=/^(\d+).*$/,j=/(\d+)\s?\-\s?(\d+)/;return{buildingMatch:function(n,o){e.lastIndex=-1;if(e.test(n))for(var a=n.replace(e,"$1"),c=o.split(","),h=0;h<c.length;h++){j.lastIndex=-1;if(j.test(c[h])){var C=
j.exec(c[h]);if(a>=parseInt(C[1],10)&&a<=parseInt(C[2],10))return true}else if(a==c[h])return true}return false},normalize:function(n){if(!n)return"";n=n.toUpperCase();if(!xa){var o=[];for(var a in eb)o.push(a);xa=RegExp("(\\s)("+o.join("|")+")(\\s|$)","i")}xa.lastIndex=-1;if(o=xa.exec(n))n=n.replace(xa,"$1"+eb[o[2]]);return n},toString:function(n){return n.streetDetails+" "+n.location}}}(),Oa=Q.GeoXY=function(){function e(o,a){if(o.length){for(var c,h,C,H,ca=o.length;ca--;){e(o[ca],a);c=typeof c===
"undefined"||o.x<c?o.x:c;h=typeof h==="undefined"||o.y<h?o.y:h;C=typeof C==="undefined"||o.x>C?o.x:C;H=typeof H==="undefined"||o.y>H?o.y:H}return oa.init(c,h,H,H)}else if(o.mercXY){c=o.mercXY;o.x=(c.x+Math.PI)/a|0;o.y=(Math.PI-c.y)/a|0;o.rpp=a}else COG.warn("Attempted to sync an XY composite, not a GeoXY");return o}function j(o,a){if(o.length)for(var c=o.length;c--;)j(o[c],a);else{o.mercXY=K.init(o.x*a-Math.PI,Math.PI-o.y*a);o.pos=ja.fromMercatorPixels(o.mercXY.x,o.mercXY.y)}return o}function n(o,
a,c){o.pos=a;o.mercXY=ja.toMercatorPixels(a);(c=typeof c!=="undefined"?c:o.rpp)&&e(o,c)}return{init:function(o,a){var c=K.init();n(c,o,a);return c},sync:e,syncPos:j,toPos:function(o,a){a=a?a:_self.rpp;return ja.fromMercatorPixels(o.x*a-Math.PI,Math.PI-o.y*a)},updatePos:n}}(),la={},Ma=function(){return{bestResults:function(e,j){j||(j=20);for(var n=e.length>0?e[0]:null,o=[],a=0;a<e.length;a++)if(n&&e[a]&&n.matchWeight-e[a].matchWeight<=j)o.push(e[a]);else break;return o}}}(),Fa=function(e){e=COG.extend({id:null,
caption:"",resultType:"",data:null,pos:null,matchWeight:0},e);return COG.extend(e,{toString:function(){return e.caption+(e.matchWeight?" ("+e.matchWeight+")":"")}})},Xa=function(){function e(a,c){var h=new T5.ShapeLayer;c.geometry&&ja.vectorize(c.geometry,{callback:function(C){h.add(new T5.Line(C,{style:"waypoints",simplify:true}));a.setLayer("route",h)}})}function j(a){for(var c=n.Unknown,h=o,C=0;C<h.length;C++){h[C].regex.lastIndex=-1;var H=h[C].regex.exec(a);if(H){c=h[C].customCheck?h[C].customCheck(a,
H):h[C].turnType;break}}return c}var n={Unknown:"turn-unknown",Start:"turn-none-start",Continue:"turn-none",Arrive:"turn-none-arrive",TurnLeft:"turn-left",TurnLeftSlight:"turn-left-slight",TurnLeftSharp:"turn-left-sharp",TurnRight:"turn-right",TurnRightSlight:"turn-right-slight",TurnRightSharp:"turn-right-sharp",Merge:"merge",UTurnLeft:"uturn-left",UTurnRight:"uturn-right",EnterRoundabout:"roundabout-enter",Ramp:"ramp",RampExit:"ramp-exit"},o=function(){var a=[];a.push({regex:/continue/i,turnType:n.Continue});
a.push({regex:/(take|bear|turn)(.*?)left/i,customCheck:function(c,h){return/bear/i.test(h[1])?n.TurnLeftSlight:n.TurnLeft}});a.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(c,h){return/bear/i.test(h[1])?n.TurnRightSlight:n.TurnRight}});a.push({regex:/enter\s(roundabout|rotaty)/i,turnType:n.EnterRoundabout});a.push({regex:/take.*?ramp/i,turnType:n.Ramp});a.push({regex:/take.*?exit/i,turnType:n.RampExit});a.push({regex:/make(.*?)u\-turn/i,customCheck:function(c,h){return/right/i.test(h[1])?
n.UTurnRight:n.UTurnLeft}});a.push({regex:/proceed/i,turnType:n.Start});a.push({regex:/arrive/i,turnType:n.Arrive});a.push({regex:/fell\sthrough/i,turnType:n.Merge});return a}();return{calculate:function(a){a=COG.extend({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},a);var c=b("route");c&&c.route(a,function(h){if(a.generalize)h.geometry=ja.generalize(h.geometry,h.getInstructionPositions());if(a.map){e(a.map,h);a.autoFit&&a.map.gotoBounds(h.boundingBox)}a.success&&
a.success(h)})},createMapOverlay:e,parseTurnType:j,TurnType:n,Instruction:function(a){var c=a=COG.extend({position:null,description:"",distance:0,distanceTotal:0,time:0,timeTotal:0,turnType:null},a),h=a.description;h=h.replace(/(\w)(\/)(\w)/g,"$1 $2 $3");c.description=h;if(!a.turnType)a.turnType=j(a.description);return a},RouteData:function(a){a=COG.extend({geometry:[],instructions:[],boundingBox:null},a);if(!a.boundingBox)a.boundingBox=fb.forPositions(a.geometry);return COG.extend({getInstructionPositions:function(){for(var c=
[],h=0;h<a.instructions.length;h++)a.instructions[h].position&&c.push(a.instructions[h].position);return c}},a)}}}(),Ja="featurecollection",Gb="feature",kb={async:false},db={processor:null,group:"shapes",layerClass:ub},Eb={point:COG.extend({},db,{processor:function(e,j,n,o){j=z([j.coordinates],kb);if(j.length>0)if(n=o.marker(j[0],n)){e.add(n);return j.length}},group:"markers",layerClass:ub}),linestring:COG.extend({},db,{processor:function(e,j,n,o){j=z(j&&j.coordinates?j.coordinates:[]);return p(e,
j,n,o.line)}}),multilinestring:COG.extend({},db,{processor:function(e,j,n,o){j=j&&j.coordinates?j.coordinates:[];for(var a=0,c=j.length;c--;)a+=p(e,j[c],n,o.line);return a}}),polygon:COG.extend({},db,{processor:function(e,j,n,o){j=j&&j.coordinates?j.coordinates:[];if(j.length>0)return p(e,j[0],n,o.poly);return 0}}),multipolygon:COG.extend({},db,{processor:function(e,j,n,o){j=j&&j.coordinates?j.coordinates:[];for(var a=0,c=0;c<j.length;c++)a+=p(e,j[c][0],n,o.poly);return a}})},ya=function(e,j,n,o){function a(R,
Z){var qa=R.processor,za=ca+R.group,Ya=COG.extend({},R,n,{properties:Z.properties});if(qa){var $a=L[za];if(!$a){$a=new R.layerClass({id:za});L[za]=$a}globalLayers=L;return qa($a,Z.data,Ya,o)}return 0}function c(R,Z){var qa=R&&R.type?R.type.toLowerCase():null;return qa&&qa===Gb?c(R.geometry,R.properties):{type:qa,isCollection:qa?qa===Ja:false,definition:Eb[qa],data:R,properties:Z?Z:R.properties}}function h(R){var Z=0,qa=COG.extend({},n),za=ba;R=R?R:(new Date).getTime();if(!Ea){for(;za<Ga;za++){R=c(H?
H(e[za]):e[za]);var Ya=null;if(R.isCollection){qa.layerPrefix=ca+S++ +"-";Ea=y(R.data.features,function($a){Ea=null;for(var ib in $a)L[ib]=$a[ib]},qa);Ya+=1}else if(R.definition)Ya=a(R.definition,R);Z+=Ya?Ya:1;if(Z>=C)break}ba=za+1;if(Ea||ba<Ga)animFrame(h);else j&&j(L)}}n=COG.extend({vectorsPerCycle:Za.VECTORIZE_PER_CYCLE,rowPreParse:null,simplify:false,layerPrefix:"geojson-"},n);o=COG.extend({marker:function(R){return new vb({xy:R})},line:function(R,Z){return new lb(R,COG.extend({},n,Z))},poly:function(R,
Z){return new lb(R,COG.extend({fill:true},n,Z))}},o);var C=n.vectorsPerCycle,H=n.rowPreParse,ca=n.layerPrefix,ba=0,Ga=0,Ea=null,S=0,L={};if(e){if(typeof e.length==="undefined")e=[e];Ga=e.length;animFrame(h)}};Q.GeoJSON={parse:y};Q.Map=function(e){function j(L){try{var R=Za.Position.init(L.coords.latitude,L.coords.longitude),Z=L.coords.accuracy/1E3;S.trigger("locationUpdate",L,Z);if(ba){if(!H){H=new Za.UI.LocationOverlay({pos:R,accuracy:Z});H.update(S.getTileLayer());S.setLayer("location",H)}var qa=
Za.BoundingBox.createBoundsFromCenter(R,Math.max(Z,1));S.gotoBounds(qa)}else{H.pos=R;H.accuracy=Z;H.update(S.getTileLayer());a(R,null,COG.easing("sine.out"))}ba=false}catch(za){COG.exception(za)}}function n(L){COG.info("caught location tracking error:",L)}function o(L,R,Z){S.setZoomLevel(R);a(L,Z)}function a(L,R,Z,qa){L=Oa.init(L,Za.radsPerPixel(S.getZoomLevel()));var za=S.getDimensions();S.updateOffset(L.x-(za.width>>1),L.y-(za.height>>1),Z,qa,function(){S.refresh();S.trigger("boundsChange",S.getBoundingBox());
R&&R(S)})}e=COG.extend({tapExtent:10,crosshair:false,zoomLevel:0,boundsChangeThreshold:30,minZoom:1,maxZoom:18,pannable:true,scalable:true},e);var c={NONE:0,SINGLE:1,WATCH:2},h=K.init(),C=c.NONE,H=null,ca=0,ba=true,Ga=0,Ea=e.tapExtent;e.adjustScaleFactor=function(L){return Math.pow(2,(L<1?Math.floor:Math.ceil)(Math.log(L)))};var S=COG.extend(new Ob(e),{getBoundingBox:function(){var L=S.getViewRect();return Za.BoundingBox.init(Oa.toPos(K.init(L.x1,L.y2),Ga),Oa.toPos(K.init(L.x2,L.y1),Ga))},getCenterPosition:function(){var L=
S.getViewRect();if(L){L=K.init(L.x1+(L.width>>1),L.y1+(L.height>>1));return Oa.toPos(L,Ga)}return null},gotoBounds:function(L,R){var Z=Za.BoundingBox.getZoomLevel(L,S.getDimensions());o(Za.BoundingBox.getCenter(L),Z,R)},gotoPosition:o,panToPosition:a,syncXY:function(L,R){return(R?Oa.syncPos:Oa.sync)(L,Ga)},locate:function(){S.trackStart(c.SINGLE);setTimeout(S.trackCancel,1E4)},trackStart:function(L){if(navigator.geolocation&&!ca){C=L?L:c.WATCH;ba=true;ca=navigator.geolocation.watchPosition(j,n,{enableHighAccuracy:true,
timeout:1E4,maximumAge:5E3})}},trackCancel:function(){ca&&navigator.geolocation&&navigator.geolocation.clearWatch(ca);S.removeLayer("location");H=null;C=c.NONE;ca=0},animateRoute:function(L,R,Z,qa){var za=S.getLayer("route");if(za)(L=za.getAnimation(L,R,Z,qa))&&L.addToView(S)}});S.bind("pan",function(){C===c.SINGLE&&S.trackCancel()});S.bind("tap",function(L,R,Z,qa){L=Oa.toPos(qa,Ga);var za=Oa.toPos(K.offset(qa,-Ea,Ea),Ga);qa=Oa.toPos(K.offset(qa,Ea,-Ea),Ga);S.trigger("geotap",R,Z,L,fb.init(za,qa))});
S.bind("refresh",function(){if(K.absSize(K.diff(h,S.getOffset()))>e.boundsChangeThreshold){h=K.copy(S.getOffset());S.trigger("boundsChange",S.getBoundingBox())}});S.bind("zoomLevelChange",function(L,R){var Z;Ga=Za.radsPerPixel(R);Z=da/Ga|0;S.setMaxOffset(Z,Z,true,false);S.resetScale();S.triggerAll("resync",S);S.refresh()});return S};Q.GeoShape=function(e,j){j=COG.extend({autoParse:true},j);for(var n=Array(e.length),o=j.autoParse,a=T5.Geo.Position.parse,c=e.length;c--;)n[c]=T5.GeoXY.init(o?a(e[c]):
e[c]);return new T5.Poly(n,j)};Q.LocationOverlay=function(e){e=COG.extend({pos:null,accuracy:null,zindex:90},e);var j=new Image,n=T5.XY.init(),o=T5.XY.init(),a=null;j.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAACIQAAAiEBPhEQkwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAG+SURBVCiRlZHNahNRAIW/O7mTTJPahLZBA1YUyriINRAE3bQIKm40m8K8gLj0CRQkO32ELHUlKbgoIu4EqeJPgtCaoBuNtjXt5LeTMZk0mbmuWiuuPLsD3+HAOUIpxf9IHjWmaUbEyWv5ROrsVULhcHP761rUfnN3Y2Otc8CIg4YT85lzuVsPP+Qupw1vpPjRCvhS9ymvV0e77x7nNj+uvADQAIQQ+uLyvdfLV9JGZi7EdEwQlqBpEJ019f0z1mo2u5Q8DMydv25lshemmj1FueZTawbs7inarqLbV7Qjab1upB9YlhWSAHLavLHZCvg1VEhN0PMU9W7At4bPVidg7CtkLLXkut+lBPD6/Ub155jJiADAHSpaLmx3ApyBQoYEUd0PBoOBkAC6+3llvda/YxgGgYL+UNHf/zN3KiExGlsvTdP0NYDkhPdWrz35ZDsBzV5wCMuQwEyFmXFeeadjzfuFQmGkAZRKpdGC/n7x+M6jqvA9Zo6FWDhlcHE+wqT93J1tP7vpOE7rrx8ALMuasPf8S12St4WmJ6bYWTUC52k8Hm8Vi0X/nwBAPp/XKpWKdF1X2LYdlMvlsToC/QYTls7DLFr/PAAAAABJRU5ErkJggg%3D%3D";
j.onload=function(){n=T5.XY.init(j.width>>1,j.height>>1)};var c=COG.extend(new T5.ViewLayer(e),{pos:e.pos,accuracy:e.accuracy,drawAccuracyIndicator:false,draw:function(h,C){var H=o.x-C.x,ca=o.y-C.y;if(a){h.fillStyle="rgba(30, 30, 30, 0.2)";h.beginPath();h.arc(H,ca,a,0,Math.PI*2,false);h.fill()}j.complete&&j.width>0&&h.drawImage(j,H-n.x,ca-n.y,j.width,j.height);c.changed()},update:function(h){if(h){a=h.getPixelDistance(c.accuracy)>>1;o=h.getGridXYForPosition(c.pos);c.changed()}}});c.bind("gridUpdate",
function(h,C){c.update(C)});return c};return{distanceToString:function(e){if(e>1E3)return~~(e/10)/100+" km";return e?e+" m":""},dist2rad:function(e){return e/6371},getEngine:b,lat2pix:i,lon2pix:f,pix2lat:d,pix2lon:g,radsPerPixel:function(e){return da/(256<<e)},Position:ja,BoundingBox:fb,Radius:function(e,j){return{distance:parseInt(e,10),uom:j}},Address:function(e){return e=COG.extend({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},e)},A:gb,GeocodeFieldWeights:{streetDetails:50,
location:50},AddressCompareFns:{},Engine:function(e){if(!e.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var j=COG.extend({remove:function(){delete la[j.id]}},e);return la[j.id]=j},Search:Ma,GeoSearchResult:Fa,LocationSearch:function(e){function j(h,C){navigator.geolocation.clearWatch(o);o=0;if(a){clearTimeout(a);a=0}C&&C([h],e)}function n(h){COG.info("caught location tracking error:",h)}e=COG.extend({name:"Geolocation Search",requiredAccuracy:null,searchTimeout:5E3,
watch:false},e);var o=0,a=0,c=null;return new T5.Geo.GeoSearchAgent(COG.extend({execute:function(h,C){if(navigator.geolocation&&!o){o=navigator.geolocation.watchPosition(function(H){var ca=ja.init(H.coords.latitude,H.coords.longitude);H=new Fa({id:1,caption:"Current Location",pos:ca,accuracy:H.coords.accuracy/1E3,matchWeight:100});if(!c||H.accuracy<c.accuracy)c=H;if(!e.requiredAccuracy||c.accuracy<e.requiredAccuracy)j(c,C)},n,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3});if(e.searchTimeout)a=
setTimeout(function(){c&&j(c,C)},e.searchTimeout)}}},e))},Routing:Xa}}()})(T5);
