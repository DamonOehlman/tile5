COG=typeof COG!=="undefined"?COG:{};COG.extend=function(){for(var P=arguments[0]||{},ia,M=1,E=arguments.length;M<E;M++)if((ia=arguments[M])!==null)for(var j in ia){var k=ia[j];if(P!==k)if(k!==undefined)P[j]=k}return P};
(function(){var P=Object.prototype.hasOwnProperty,ia=0,M={};M.toID=function(E){return E.replace(/\s/g,"-")};M.objId=function(E){return(E?E:"obj")+ia++};M.isFunction=function(E){return toString.call(E)==="[object Function]"};M.isArray=function(E){return toString.call(E)==="[object Array]"};M.isPlainObject=function(E){if(!E||toString.call(E)!=="[object Object]"||E.nodeType||E.setInterval)return false;if(E.constructor&&!P.call(E,"constructor")&&!P.call(E.constructor.prototype,"isPrototypeOf"))return false;
var j;for(j in E);return j===undefined||P.call(E,j)};M.isEmptyObject=function(E){for(var j in E)return false;return true};M.isXmlDocument=function(E){return toString.call(E)==="[object Document]"};M.contains=function(E,j){var k=E,x=arguments,G=1;if(j&&module.isArray(j)){x=j;G=0}for(G=G;G<x;G++)k=k&&typeof foo[x[G]]!=="undefined";return k};M.formatStr=function(E){if(arguments.length<=1)return E;for(var j=arguments.length-2,k=0;k<=j;k++)E=E.replace(RegExp("\\{"+k+"\\}","gi"),arguments[k+1]);return E};
M.wordExists=function(E,j){var k="";if(j.toString)j=j.toString();for(var x=0;x<j.length;x++)k+=!/\w/.test(j[x])?"\\"+j[x]:j[x];return RegExp("(^|\\s|\\,)"+k+"(\\,|\\s|$)","i").test(E)};COG.extend(COG,M)})();
(function(){function P(k){return typeof console!=="undefined"?function(){console[k](Array.prototype.slice.call(arguments,0).join(" "));return true}:function(){return false}}var ia=window.console&&window.console.markTimeline,M=P("error"),E=P("info"),j=function(){return ia?function(k,x){console.markTimeline(k+(x?": "+((new Date).getTime()-x)+"ms":""))}:function(){}}();COG.extend(COG,{trace:j,debug:P("debug"),info:E,warn:P("warn"),error:M,exception:function(k){if(M)for(var x in k)E("ERROR DETAIL: "+
x+": "+k[x])}})})();
(function(){function P(M,E){var j=M.obsHandlers;j[E]||(j[E]=[]);return j[E]}var ia=0;COG.observable=function(M){if(!M)return null;if(!M.obsHandlers)M.obsHandlers={};if(!(M.bind||M.trigger||M.unbind)){M.bind=function(E,j){var k="callback"+ia++;P(M,E).unshift({fn:j,id:k});return k};M.triggerCustom=function(E,j){var k=P(M,E),x={cancel:false,name:E,source:this},G;j&&COG.extend(x,j);if(!k)return null;G=Array.prototype.slice.call(arguments,2);M.eventInterceptor&&M.eventInterceptor(E,x,G);G.unshift(x);for(var W=
k.length;W--&&!x.cancel;)k[W].fn.apply(this,G);return x};M.trigger=function(E){var j=Array.prototype.slice.call(arguments,1);j.splice(0,0,E,null);return M.triggerCustom.apply(this,j)};M.unbind=function(E,j){if(typeof E==="undefined")M.obsHandlers={};else for(var k=P(M,E),x=0;k&&x<k.length;x++)if(k[x].id===j){k.splice(x,1);break}return M}}return M}})();
(function(){function P(j,k){j[k]||(j[k]=function(x){return j.configure(k,x)})}function ia(j){j.gtConfId="configurable"+E++;j.gtConfig={};j.gtConfigFns=[];return j.gtConfig}var M={},E=0;COG.paramTweaker=function(j,k,x){return function(G,W){if(typeof W!=="undefined"){if(G in j)j[G]=W;x&&G in x&&x[G](G,W)}else return k&&G in k?k[G](G):j[G]}};COG.configurable=function(j,k,x,G){if(j){j.gtConfId||ia(j);var W=j.gtConfId,n=j.gtConfig,K=j.gtConfigFns;M[W]=j;K.push(x);for(x=k.length;x--;){n[k[x]]=true;G&&P(j,
k[x])}if(!j.configure)j.configure=function(C,N){if(n[C]){for(var y=K.length;y--;){var A=K[y](C,N);if(typeof A!=="undefined")return A}return M[W]}return null}}}})();
(function(){function P(j){var k=document.createElement("script"),x=false;k.src=j;k.async=true;k.onload=k.onreadystatechange=function(){if(!x&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){x=true;k.onload=k.onreadystatechange=null;k&&k.parentNode&&k.parentNode.removeChild(k)}};M||(M=document.getElementsByTagName("head")[0]);M.appendChild(k)}var ia=0,M,E=this;COG.jsonp=function(j,k,x){j+=j.indexOf("?")>=0?"&":"?";var G="json"+ ++ia;E[G]=function(W){k(W);E[G]=null;try{delete E[G]}catch(n){}};
P(j+(x?x:"callback")+"="+G);return G}})();
(function(){var P=1.70158,ia=Math.PI/2,M=1E3/60|0,E=Math.abs,j=Math.pow,k=Math.sin,x=Math.asin,G=Math.cos,W={linear:function(n,K,C,N){return C*n/N+K},backin:function(n,K,C,N){return C*(n/=N)*n*((P+1)*n-P)+K},backout:function(n,K,C,N){return C*((n=n/N-1)*n*((P+1)*n+P)+1)+K},backinout:function(n,K,C,N){return(n/=N/2)<1?C/2*n*n*(((P*=1.525)+1)*n-P)+K:C/2*((n-=2)*n*(((P*=1.525)+1)*n+P)+2)+K},bouncein:function(n,K,C,N){return C-W.bounceout(N-n,0,C,N)+K},bounceout:function(n,K,C,N){return(n/=N)<1/2.75?
C*7.5625*n*n+K:n<2/2.75?C*(7.5625*(n-=1.5/2.75)*n+0.75)+K:n<2.5/2.75?C*(7.5625*(n-=2.25/2.75)*n+0.9375)+K:C*(7.5625*(n-=2.625/2.75)*n+0.984375)+K},bounceinout:function(n,K,C,N){return n<N/2?W.bouncein(n*2,0,C,N)/2+K:W.bounceout(n*2-N,0,C,N)/2+C/2+K},cubicin:function(n,K,C,N){return C*(n/=N)*n*n+K},cubicout:function(n,K,C,N){return C*((n=n/N-1)*n*n+1)+K},cubicinout:function(n,K,C,N){if((n/=N/2)<1)return C/2*n*n*n+K;return C/2*((n-=2)*n*n+2)+K},elasticin:function(n,K,C,N,y,A){if(n==0)return K;if((n/=
N)==1)return K+C;A||(A=N*0.3);if(!y||y<E(C)){y=C;C=A/4}else C=A/TWO_PI*x(C/y);return-(y*j(2,10*(n-=1))*k((n*N-C)*TWO_PI/A))+K},elasticout:function(n,K,C,N,y,A){var I;if(n==0)return K;if((n/=N)==1)return K+C;A||(A=N*0.3);if(!y||y<E(C)){y=C;I=A/4}else I=A/TWO_PI*x(C/y);return y*j(2,-10*n)*k((n*N-I)*TWO_PI/A)+C+K},elasticinout:function(n,K,C,N,y,A){var I;if(n==0)return K;if((n/=N/2)==2)return K+C;A||(A=N*0.3*1.5);if(!y||y<E(C)){y=C;I=A/4}else I=A/TWO_PI*x(C/y);if(n<1)return-0.5*y*j(2,10*(n-=1))*k((n*
N-I)*TWO_PI/A)+K;return y*j(2,-10*(n-=1))*k((n*N-I)*TWO_PI/A)*0.5+C+K},quadin:function(n,K,C,N){return C*(n/=N)*n+K},quadout:function(n,K,C,N){return-C*(n/=N)*(n-2)+K},quadinout:function(n,K,C,N){if((n/=N/2)<1)return C/2*n*n+K;return-C/2*(--n*(n-2)-1)+K},sinein:function(n,K,C,N){return-C*G(n/N*ia)+C+K},sineout:function(n,K,C,N){return C*k(n/N*ia)+K},sineinout:function(n,K,C,N){return-C/2*(G(Math.PI*n/N)-1)+K}};COG.tweenValue=function(n,K,C,N,y){function A(ea){ea=ea?ea:(new Date).getTime();if(ra+M<
ea){var za=ea-I,Z=C(za,n,ja,N),ua=I+N<=ea;ea=!ua;if(y){za=y(Z,ua,za);ea=typeof za!="undefined"?za&&ea:ea}ea&&animFrame(A)}}var I=(new Date).getTime(),ra=0,ja=K-n;animFrame(A);return{}};COG.easing=function(n){return W[n.replace(/[\-\_\s\.]/g,"").toLowerCase()]};COG.registerEasingType=function(n,K){W[n.replace(/[\-\_\s\.]/g,"").toLowerCase()]=K}})();
(function(){var P=/^P(\d+Y)?(\d+M)?(\d+D)?$/,ia=/^(\d+H)?(\d+M)?(\d+S)?$/,M={8601:function(j){j=j.split("T");var k=null;k=null;var x=0,G=0;P.lastIndex=-1;k=P.exec(j[0]);x+=k[3]?parseInt(k[3].slice(0,-1),10):0;ia.lastIndex=-1;k=ia.exec(j[1]);G+=k[1]?parseInt(k[1].slice(0,-1),10)*3600:0;G+=k[2]?parseInt(k[2].slice(0,-1),10)*60:0;G+=k[3]?parseInt(k[3].slice(0,-1),10):0;return new E(x,G)}},E=COG.Duration=function(j,k){return{days:j?j:0,seconds:k?k:0}};COG.addDuration=function(){for(var j=new E,k=arguments.length;k--;){j.days+=
arguments[k].days;j.seconds+=arguments[k].seconds}if(j.seconds>=86400){j.days+=~~(j.seconds/86400);j.seconds%=86400}return j};COG.formatDuration=function(j){var k,x,G="";if(j.days)G=j.days+" days ";if(j.seconds){j=j.seconds;if(j>=3600){k=~~(j/3600);j-=k*3600}if(j>=60){x=Math.round(j/60);j-=x*60}if(k)G=G+k+(k>1?" hrs ":" hr ")+(x?(x>10?x:"0"+x)+" min ":"");else if(x)G=G+x+" min";else if(j>0)G=G+(j>10?j:"0"+j)+" sec"}return G};COG.parseDuration=function(j,k){var x=k?M[k]:null;if(x)return x(j);COG.Log.warn("Could not find duration parser for specified format: "+
k);return new E}})();COG.ObjectStore=function(){var P={},ia={},M="obj_"+(new Date).getTime(),E=0,j=Object.prototype.hasOwnProperty;return{add:function(k,x){var G;x=x?x:"default";if(k&&k.constructor)if(!j.call(k,"id"))k.id=M+ ++E;G=ia[x]?ia[x]:ia[x]=[];P[k.id]=G.length;G[k.length]=k}}};var CANI={};
(function(P){var ia=[],M=0,E=false,j=P.register=function(k,x){ia.push({section:k,run:x})};P.init=function(k){function x(){if(M<ia.length){var W=ia[M++];G[W.section]||(G[W.section]={});W.run(G[W.section],x)}else{for(W in G)P[W]=G[W];E=true;k&&k(P)}}var G={};if(E&&k)k(P);else{M=0;x()}};j("canvas",function(k,x){function G(){var K,C=W.getContext("2d");C.save();try{C.translate(50,50);C.beginPath();C.rect(0,0,20,20);K=C.isPointInPath(10,10)}finally{C.restore()}return K}var W=document.createElement("canvas"),
n=typeof FlashCanvas!="undefined";W.width=200;W.height=200;k.pipTransformed=n?false:G();x()})})(CANI);
INTERACT=function(){function P(y){return function(A,I,ra){(ra?ra:y?document.body:document).addEventListener(A,I,false)}}function ia(y){return function(A,I,ra){(ra?ra:y?document.body:document).removeEventListener(A,I,false)}}function M(y,A,I){(I?I:document).attachEvent("on"+y,A)}function E(y,A,I){(I?I:document).detachEvent("on"+y,A)}function j(y,A){return{x:y?y:0,y:A?A:0,count:1}}function k(y,A){C.push(COG.extend({handler:null,checks:{},type:y},A))}function x(y){var A=0,I=0;if(y.offsetParent){do{A+=
y.offsetLeft;I+=y.offsetTop;y=y.offsetParent}while(y)}return{left:A,top:I}}function G(y,A){return{source:y,target:A.target?A.target:A.srcElement}}function W(y,A){for(var I=y.target?y.target:y.srcElement;I&&I!==A&&I.nodeName&&I.nodeName.toUpperCase()!="CANVAS";)I=I.parentNode;return I&&I===A}function n(y,A){return{x:y.x-(A?A.left:0),y:y.y-(A?A.top:0)}}function K(y){if(y.preventDefault){y.preventDefault();y.stopPropagation()}else y.cancelBubble&&y.cancelBubble()}var C=[],N=function(y,A,I){function ra(qa,
ka,va,X){var ha=0,Ca=0,t=0;COG.tweenValue(0,qa,va,X,function(Y){t=ha;ha=Y});COG.tweenValue(0,ka,va,X,function(Y){ja.trigger("pan",ha-t,Y-Ca);Ca=Y})}I=COG.extend({binder:null,unbinder:null,observable:null},I);for(var ja=I.observable,ea=null,za=[],Z=[],ua,Aa,Ga={bind:function(){return ja.bind.apply(null,arguments)},pannable:function(qa){ea=COG.extend({inertia:true},qa);return Ga},unbind:function(){ja.unbind();for(var qa=0;qa<za.length;qa++)za[qa].unbind();return Ga}},La=0;La<A.length;La++)za.push(A[La](y,
ja,I));ja.bind("pointerDown",function(){Z=[];Aa=ua=0});ja.bind("pointerMove",function(qa,ka,va,X){if(ea){Z[Z.length]={ticks:(new Date).getTime(),x:X.x,y:X.y};ja.trigger("pan",X.x,X.y)}ua+=X.x?X.x:0;Aa+=X.y?X.y:0});ja.bind("pointerUp",function(qa,ka,va){if(Math.abs(ua)>20||Math.abs(Aa)>20){if(ea){va=Z.length;var X,ha;ka=0;for(ha=Z.length;--ha>1&&ka<50;)ka+=Z[ha].ticks-Z[ha-1].ticks;if(va-ha>1){qa=Z[va-1].x-Z[ha].x;X=Z[va-1].y-Z[ha].y;ha=Math.sqrt(qa*qa+X*X)|0;if(ha>15){qa=Z[va-1].x-Z[0].x;X=Z[va-1].y-
Z[0].y;ha=Math.sqrt(qa*qa+X*X)|0;va=Math.asin(X/ha);ka=ha*500/ka|0;ka=ka>300?300:ka;ra(Math.cos(qa>0?va:Math.PI-va)*ka,Math.sin(va)*ka,COG.easing("sine.out"),500)}}}}else ja.trigger("tap",ka,va)});return Ga};k("pointer",{handler:function(y,A,I){function ra(t){if(t.pageX&&t.pageY)return j(t.pageX,t.pageY);else{var Y=document.documentElement,$=document.body;return j(t.clientX+(Y&&Y.scrollLeft||$&&$.scrollLeft||0)-(Y&&Y.clientLeft||$&&$.clientLeft||0),t.clientY+(Y&&Y.scrollTop||$&&$.scrollTop||0)-(Y&&
Y.clientTop||$&&$.clientTop||0))}}function ja(t){if(W(t,y))if(qa=ua(t)){var Y=ra(t);y.style.cursor="move";K(t);ha=Y.x;Ca=Y.y;ka=j(ha,Ca);A.triggerCustom("pointerDown",G("mouse",t),ka,n(ka,x(y)))}}function ea(t){var Y=ra(t);va=Y.x;X=Y.y;if(W(t,y))Aa(t,qa?"pointerMove":"pointerHover")}function za(t){if(qa&&ua(t)){qa=false;if(W(t,y)){y.style.cursor="default";Aa(t,"pointerUp")}}}function Z(t){if(W(t,y)){var Y;t=t||window.event;if(t.detail)Y=t.axis===2?-t.detail*Ga:0;else{Y=t.wheelDeltaY?t.wheelDeltaY:
t.wheelDelta;if(window.opera)Y=-Y}if(Y!==0){var $=j(va,X);A.triggerCustom("zoom",G("mouse",t),$,n($,x(y)),Y/La,"wheel");K(t);t.returnValue=false}}}function ua(t){t=t||window.event;return(t.which||t.button)==1}function Aa(t,Y,$,Va,Ia){$=typeof $!="undefined"?$:va;Va=typeof Va!="undefined"?Va:X;var U=$-ha,fa=Va-Ca,ba=j($,Va);A.triggerCustom(Y,G("mouse",t),ba,n(ba,x(y)),j(U,fa));if(typeof Ia=="undefined"||Ia){ha=$;Ca=Va}}I=COG.extend({},I);var Ga=120,La=Ga*8,qa=false,ka,va,X,ha,Ca;I.binder("mousedown",
ja,false);I.binder("mousemove",ea,false);I.binder("mouseup",za,false);I.binder("dblclick",function(t){COG.info("captured double click");if(W(t,y)){var Y=ra(t);A.triggerCustom("doubleTap",G("mouse",t),Y,n(Y,x(y)))}},false);I.binder("mousewheel",Z,document);I.binder("DOMMouseScroll",Z,document);return{unbind:function(){I.unbinder("mousedown",ja,false);I.unbinder("mousemove",ea,false);I.unbinder("mouseup",za,false);I.unbinder("mousewheel",Z,document);I.unbinder("DOMMouseScroll",Z,document)}}},checks:{touch:false}});
k("pointer",{handler:function(y,A,I){function ra(U){if(U.count<2)return 0;var fa=U.x-U.next.x;U=U.y-U.next.y;return~~Math.sqrt(fa*fa+U*U)}function ja(U,fa,ba){fa=fa?fa:0;ba=ba?ba:0;for(var Ma={x:U.x-fa,y:U.y-ba,id:U.id,count:U.count},Wa=Ma;U.next;){U=U.next;Wa=Wa.next={x:U.x-fa,y:U.y-ba,id:U.id}}return Ma}function ea(U,fa){var ba=U[fa?fa:"touches"],Ma,Wa;if(ba.length===0)return null;Wa=Ma={x:ba[0].pageX,y:ba[0].pageY,id:ba[0].identifier,count:ba.length};for(var Oa=1,jb=ba.length;Oa<jb;Oa++)Wa=Wa.next=
{x:ba[Oa].pageX,y:ba[Oa].pageY,id:ba[Oa].identifier};return Ma}function za(U){if(W(U,y)){X=x(y);var fa=ea(U,"changedTouches"),ba=ja(fa,X.left,X.top);if(!Ca){ha=qa;A.triggerCustom("pointerDown",G("touch",U),fa,ba)}Va&&A.triggerCustom("pointerDownMulti",G("touch",U),fa,ba);Ca=ea(U);if(Ca.count>1)Y=ra(Ca);Ia=1;$=ja(Ca)}}function Z(U){if(W(U,y)){U.preventDefault();t=ea(U);if(ha==qa)ha=Math.abs(Ca.x-t.x)>Ga||Math.abs(Ca.y-t.y)>Ga?La:qa;if(ha!=qa){ha=t.count>1?va:ka;if(ha==va)if(Ca.count===1){Ca=ja(t);
Y=ra(Ca)}else{var fa=ra(t);if(Math.abs(Y-fa)<Aa)ha=ka;else{var ba;ba=t.x;var Ma=t.next.x,Wa=t.y,Oa=t.next.y,jb=Wa<Oa?Wa:Oa;ba={x:(ba<Ma?ba:Ma)+(Math.abs(ba-Ma)>>1),y:jb+(Math.abs(Wa-Oa)>>1)};fa=fa/Y;Ma=fa-Ia;A.triggerCustom("zoom",G("touch",U),ba,n(ba,X),Ma,"pinch");Ia=fa}}ha==ka&&A.triggerCustom("pointerMove",G("touch",U),t,ja(t,X.left,X.top),j(t.x-$.x,t.y-$.y));Va&&A.triggerCustom("pointerMoveMulti",G("touch",U),t,ja(t,X.left,X.top))}$=ja(t)}}function ua(U){if(W(U,y)){var fa=ea(U,"changedTouches"),
ba=ja(fa,X.left,X.top);t=ea(U);if(!t){A.triggerCustom("pointerUp",G("touch",U),fa,ba);Ca=null}Va&&A.triggerCustom("pointerUpMulti",G("touch",U),fa,ba)}}I=COG.extend({detailed:false,inertia:false},I);var Aa=20,Ga=7,La=0,qa=1,ka=2,va=3,X,ha,Ca,t,Y,$,Va=I.detailed,Ia=1;I.binder("touchstart",za,false);I.binder("touchmove",Z,false);I.binder("touchend",ua,false);COG.info("initialized touch handler");return{unbind:function(){I.unbinder("touchstart",za,false);I.unbinder("touchmove",Z,false);I.unbinder("touchend",
ua,false)}}},checks:{touch:true}});return{register:k,watch:function(y,A,I){A=COG.extend({bindToBody:false,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},A);capabilities=COG.extend({touch:"ontouchstart"in window},I);if(!A.observable){COG.info("creating observable");A.observable=COG.observable({});globalOpts=A}A.binder=A.isIE?M:P(A.bindToBody);A.unbinder=A.isIE?E:ia(A.bindToBody);I=A.types;for(var ra=capabilities,ja=[],ea=C.length;ea--;){var za=C[ea],Z=!I||I.indexOf(za.type)>=
0,ua=true;for(var Aa in za.checks){var Ga=za.checks[Aa];COG.info("checking "+Aa+" capability. require: "+Ga+", capability = "+ra[Aa]);ua=ua&&Ga===ra[Aa]}if(Z&&ua)ja[ja.length]=za.handler}return new N(y,ja,A)}}}();var T5={};
(function(P){function ia(){return(new Date).getTime()}function M(){for(;Ma.length>0;){var b=Ma.shift();document.location=b}ba=0}function E(b){for(var m=true,h=Wa.length;h--;)m=m&&b!=Wa[h];return m}function j(b,m){var h=[];for(var d in m)d&&h.push(d+"="+escape(m[d]));return"tile5://"+b+"/"+(h.length>0?"?"+h.join("&"):"")}function k(b,m){E(b)&&COG.info("would push url: "+j(b,m))}function x(b,m){if(E(b)){Ma.push(j(b,m));ba||(ba=setTimeout(M,100))}}function G(b){return function(m,h,d){(d?d:b?document.body:
document).addEventListener(m,h,false)}}function W(b){return function(m,h,d){(d?d:b?document.body:document).removeEventListener(m,h,false)}}function n(b,m,h){(h?h:document).attachEvent("on"+b,m)}function K(b,m,h){(h?h:document).detachEvent("on"+b,m)}function C(){Ia={base:{name:"Unknown",bindEvent:G(),unbindEvent:W(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:k,targetFps:null},ie:{name:"MSIE",regex:/msie/i,
bindEvent:n,unbindEvent:K,requireFastDraw:false,targetFps:25},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:x,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:x},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:x},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:G(true),unbindEvent:W(true),supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},
bridgeNotify:x},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:x}};U=[Ia.froyo,Ia.android,Ia.ipod,Ia.iphone,Ia.ipad,Ia.ie]}function N(){Ia||C();if(!fa){COG.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var b=0;b<U.length;b++){var m=U[b];if(m.regex&&m.regex.test(navigator.userAgent)){fa=COG.extend({},Ia.base,m);COG.info("PLATFORM DETECTED AS: "+fa.name);break}}if(!fa){COG.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
fa=Ia.base}COG.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return fa}function y(){for(var b=0,m=arguments.length;m--;){var h=Hb[arguments[m].toUpperCase()];if(h)b|=h}return b}function A(b,m){var h,d;if(m&&m.width>0){if(!b.imageOffset)b.imageOffset=t.init(-m.width>>1,-m.height>>1);if(!b.bounds){h=b.xy.x+b.imageOffset.x;d=b.xy.y+b.imageOffset.y;b.bounds=$.init(h,d,h+m.width,d+m.height)}}}function I(b){function m(){b.transformed=g!==1||d%ra!==0||r!==0||l!==0}var h=1E3/60|0,d=0,g=1,
r=0,l=0;COG.extend(b,{animate:function(v,D,q,z,B,R){var oa=(new Date).getTime(),pa=b[v],V=D.length&&q.length&&D.length==q.length?D.length:0,s=Array(V),O=Array(V),ca=COG.easing(z?z:"sine.out"),S=function(wa){wa=wa?wa:(new Date).getTime();if(wa-0>h){var db=wa-oa;wa=oa+B<=wa;for(var la=V;la--;)O[la]=ca(db,D[la],s[la],B);pa.apply(b,O);b.invalidate.call(b);if(wa){pa.apply(b,q);b.invalidate.call(b);R&&R()}else animFrame(S)}};if(pa&&pa.apply&&V>0){B=B?B:1E3;for(v=V;v--;)s[v]=q[v]-D[v];animFrame(S)}},rotate:function(v){d=
v;m()},scale:function(v){g=v;m()},translate:function(v,D){r=v;l=D;m()},transform:function(v,D,q){v.save();v.translate(b.xy.x-D+r,b.xy.y-q+l);d!==0&&v.rotate(d);g!==1&&v.scale(g,g)}})}window.animFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b){setTimeout(function(){b((new Date).getTime())},1E3/60)}}();var ra=Math.PI*2,ja=Math.PI/2,ea=Math.abs,za=Math.ceil,
Z=Math.min,ua=Math.max,Aa=Math.pow,Ga=Math.sqrt,La=Math.log,qa=Math.round,ka=Math.sin,va=Math.asin,X=Math.cos,ha=Math.atan,Ca=Math.atan2,t=function(){function b(d,g){return h(d.x-g.x,d.y-g.y)}function m(d,g){if(!g)g=d.length;if(g<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var r={edges:Array(g-1),accrued:Array(g-1),total:0},l=0;l<g-1;l++){var v=b(d[l],d[l+1]);r.edges[l]=Ga(v.x*v.x+v.y*v.y);r.accrued[l]=r.total+r.edges[l];r.total+=r.edges[l]}return r}
function h(d,g){return{x:d?d:0,y:g?g:0}}return{VECTOR_SIMPLIFICATION:3,SIMPLIFICATION_MIN_VECTORS:25,add:function(){for(var d=0,g=0,r=arguments.length;r--;){d+=arguments[r].x;g+=arguments[r].y}return h(d,g)},absSize:function(d){return ua(ea(d.x),ea(d.y))},copy:function(d){return d?h(d.x,d.y):null},diff:b,distance:function(d,g){return m(d,g).total},edges:m,equals:function(d,g){return d.x===g.x&&d.y===g.y},extendBy:function(d,g,r){var l=X(g)*r;g=ka(g)*r;return h(d.x-l,d.y-g)},floor:function(d){for(var g=
Array(d.length),r=d.length;r--;)g[r]=h(~~d[r].x,~~d[r].y);return g},getRect:function(d){for(var g,r,l,v,D=d.length;D--;){var q=d[D];g=typeof g==="undefined"||q.x<g?q.x:g;r=typeof r==="undefined"||q.y<r?q.y:r;l=typeof l==="undefined"||q.x>l?q.x:l;v=typeof v==="undefined"||q.y>v?q.y:v}return $.init(g,r,l,v)},init:h,invert:function(d){return h(-d.x,-d.y)},min:function(d,g){return h(d.x<g.x?d.x:g.x,d.y<g.y?d.y:g.y)},max:function(d,g){return h(d.x>g.x?d.x:g.x,d.y>g.y?d.y:g.y)},offset:function(d,g,r){return h(d.x+
g,d.y+(r?r:g))},scale:function(d,g){return h(d.x/g|0,d.y/g|0)},simplify:function(d,g){if(!d)return null;g=g?g:t.VECTOR_SIMPLIFICATION;for(var r=[],l=null,v=d.length;v--;){var D=d[v];if(include=!l||v===0||ea(D.x-l.x)+ea(D.y-l.y)>g){r.unshift(D);l=D}}return r},theta:function(d,g,r){r=va((d.y-g.y)/r);return d.x>g.x?r:Math.PI-r},toString:function(d){return d?d.x+", "+d.y:""}}}(),Y=function(){return{dotProduct:function(b,m){return b.x*m.x+b.y*m.y}}}(),$=function(){function b(h){return m(h.x1,h.y1,h.x2,
h.y2)}function m(h,d,g,r){h=h?h:0;d=d?d:0;g=typeof g!=="undefined"?g:h;r=typeof r!=="undefined "?r:r;return{x1:h,y1:d,x2:g,y2:r,width:g-h,height:r-d}}return{center:function(h){return t.init(h.x1+(h.width>>1),h.y1+(h.height>>1))},copy:b,diagonalSize:function(h){return Ga(h.width*h.width+h.height*h.height)},fromCenter:function(h,d,g,r){g=g>>1;r=r>>1;return m(h-g,d-r,h+g,d+r)},init:m,intersect:function(h,d){var g=ua(h.x1,d.x1),r=ua(h.y1,d.y1),l=Z(h.x2,d.x2),v=Z(h.y2,d.y2);g=m(g,r,l,v);return g.width>
0&&g.height>0?g:null},toString:function(h){return h?"["+h.x1+", "+h.y1+", "+h.x2+", "+h.y2+"]":""},union:function(h,d){if(h.width===0||h.height===0)return b(d);else if(d.width===0||d.height===0)return b(h);else{var g=Z(h.x1,d.x1),r=Z(h.y1,d.y1),l=ua(h.x2,d.x2),v=ua(h.y2,d.y2);g=m(g,r,l,v);return g.width>0&&g.height>0?g:null}}}}(),Va=function(){return{getAspectRatio:function(b){return b.height!==0?b.width/b.height:1},getCenter:function(b){return t.init(b.width>>1,b.height>>1)},getSize:function(b){return Ga(Aa(b.width,
2)+Aa(b.height,2))},init:function(b,m){b=b?b:0;return{width:b,height:m?m:b}}}}();Hits=function(){return{diffHits:function(b,m){var h=[],d={},g;for(g=m.length;g--;)d[m[g].target.id]=true;for(g=b.length;g--;)d[b[g].target.id]||(h[h.length]=b[g]);return h},init:function(b,m,h,d){return{type:b,x:d.x|0,y:d.y|0,elements:[],absXY:m,relXY:h}},initHit:function(b,m,h){return h=COG.extend({type:b,target:m,drag:false},h)},triggerEvent:function(b,m,h,d){m.triggerCustom(b.type+(h?h:"Hit"),{hitType:b.type},d?d:
b.elements,b.absXY,b.relXY,t.init(b.x,b.y))}}}();var Ia=null,U=[],fa=null,ba=0,Ma=[],Wa=["view.wake","tile.loaded"],Oa=function(){function b(){var s=N().maxImageLoads;if(!s||z.length<s){var O=q.shift();s=T5.ticks();if(O){z[z.length]=O;O.image.onload=h;O.image.src=O.url;O.requested=s}if(s-oa>r){O=false;for(var ca=0,S=N();ca<z.length;)if(s-z[ca].requested>V.loadTimeout*1E3){z.splice(ca,1);O=true}else ca++;O&&b();if(S&&S.imageCacheMaxSize){R=B.length*V.avgImageSize/S.imageCacheMaxSize;R>=1&&m()}oa=s}}}
function m(){pa=true;try{var s=B.length>>1;if(s>0){B.sort(function(ca,S){return ca.created-S.created});for(var O=s;O--;)delete l[B[O].url];B.splice(0,s)}}finally{pa=false}V.trigger("cacheCleared")}function h(){var s=v[this.id],O;if(s&&s.image.complete&&s.image.width>0){s.loaded=true;s.hitCount=1;for(O=z.length;O--;)if(z[O].image.src==this.src){z.splice(O,1);break}if(s.background||s.postProcess||s.drawBackground||s.customDraw)if(s.image){globalImageData=s;O=g(s.realSize?s.realSize.width:s.image.width,
s.realSize?s.realSize.height:s.image.height);var ca=O.getContext("2d"),S=s.offset?s.offset:T5.XY.init();s.background&&ca.drawImage(s.background,0,0);s.drawBackground&&s.drawBackground(ca);s.customDraw?s.customDraw(ca,s):ca.drawImage(s.image,S.x,S.y);s.postProcess&&s.postProcess(ca,s);s.image=O}for(O=s.callbacks.length;O--;)s.callbacks[O]&&s.callbacks[O](this,false);s.callbacks=[];B[B.length]={url:this.src,created:s.requested};delete v[this.id];b()}}function d(s,O,ca){var S=l[s];if(S){S.hitCount++;
S.image.complete&&S.image.width>0&&O?O(S.image,true):S.callbacks.push(O)}else{S=COG.extend({url:s,image:new Image,loaded:false,created:T5.ticks(),requested:null,hitCount:0,callbacks:[O]},ca);S.image.id="resourceLoaderImage"+D++;l[s]=S;v[S.image.id]=S;q[q.length]=S;b()}return S}function g(s,O){var ca=document.createElement("canvas");COG.info("creating new canvas");ca.width=s?s:0;ca.height=O?O:0;if(typeof FlashCanvas!="undefined"){document.body.appendChild(ca);FlashCanvas.initElement(ca)}return ca}
var r=1E4,l={},v={},D=0,q=[],z=[],B=[],R=0,oa=0,pa=false,V={avgImageSize:25,loadTimeout:10,cancelLoad:function(){var s;for(s=z.length;s--;)delete l[z[s].url];z=[];for(s=q.length;s--;)delete l[q[s].url];q=[]},get:function(s,O,ca){var S=null,wa=null;pa||(S=l[s]);if((wa=S?S.image:null)&&(wa.getContext||wa.complete&&wa.width>0))return wa;else O&&d(s,O,ca);return null},load:d,newCanvas:g,reset:function(){l={}},stats:function(){return{imageLoadingCount:z.length,queuedImageCount:q.length,imageCacheFullness:R}}};
COG.observable(V);return V}(),jb=function(){var b={};return{init:function(m,h){var d=b[m];if(!d)throw Error("Unable to locate requested generator: "+m);return new d(h)},register:function(m,h){b[m]=h},Template:function(){}}}(),nb=function(){function b(l,v){g[l]=h(v);return l}function m(l){for(var v in l)b(v,l[v])}function h(l){function v(B){var R=l[B];typeof R!=="undefined"&&q.push(function(oa){oa[B]=R})}function D(){q=[];for(var B in l)v(B)}l=COG.extend({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,
miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},l);var q=[],z={applyToContext:function(B){for(var R=q.length;R--;)q[R](B)},update:function(B,R){l[B]=R;D()}};D();return z}var d={},g={},r={apply:function(l,v){var D=g[v]?g[v]:g.basic,q;if(l&&l.canvas){q=d[l.canvas.id];d[l.canvas.id]=v}D.applyToContext(l);return q},define:b,defineMany:m,get:function(l){return g[l]},init:h,load:function(l){COG.jsonp(l,function(v){m(v)})}};m({basic:{lineWidth:1,
strokeStyle:"#000",fillStyle:"#fff"},waypoints:{lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"},waypointsHover:{lineWidth:4,strokeStyle:"#f00",fillStyle:"#FFF"}});return r}(),Hb={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,ZOOM:16,FREEZE:128},Fb=function(b){function m(u,w,H){Ya||Pa(xa-w,e-H)}function h(u,w,H,ma){la(Z(ua(Ha+Aa(2,ma)-1,0.5),2))}function d(){var u=La(Ha)/Math.LN2|0;if(u!==0){Ha=Aa(2,u);eb(ob+u,pb,qb)}S()}function g(u){u||(u=t.init(Ba,T));Q=t.init(xa,e);aa=t.offset(u,xa,e);pb=
aa.x;qb=aa.y}function r(u,w){var H=1/Ha;return t.init(ga.x1+u*H,ga.y1+w*H)}function l(u,w,H){fb("doubleTap",w,H,r(H.x,H.y));b.scalable&&la(2,H,b.zoomEasing,null,b.zoomDuration)}function v(u,w,H){Ya=null;ca("down",w,H)}function D(u,w,H){ca("hover",w,H)}function q(u,w,H){s(w,H,false)}function z(u,w,H){s(w,H,true)}function B(){clearTimeout(Cb);Cb=setTimeout(oa,250)}function R(u,w,H){ca("tap",w,H);fb("tap",w,H,r(H.x,H.y,true))}function oa(u,w){var H;kb=typeof FlashCanvas!=="undefined";COG.info("is flash = "+
kb);if(Ea){if(b.autoSize&&Ea.parentNode){u=Ea.parentNode.offsetWidth;w=Ea.parentNode.offsetHeight}try{if(!Ea.id)Ea.id=b.id+"_canvas";Ja=Ea.getContext("2d")}catch(ma){COG.exception(ma);throw Error("Could not initialise canvas on specified view element");}if(u&&w&&(Qa!==w||Ra!==u)){tb=true;Ra=u;Qa=w;Ba=Ra>>1;T=Qa>>1;Fa.trigger("resize",Ra,Qa);for(H=Na;H--;)na[H].trigger("resize",Ra,Qa)}for(H=Na;H--;)na[H].trigger("contextChanged",Ja);S();V()}}function pa(u,w){w.setId(u);w.added=ia();w.bind("remove",
function(){Fa.removeLayer(u)});w.trigger("contextChanged",Ja);w.setParent(Fa);na.push(w);na.sort(function(H,ma){var sa=ma.zindex-H.zindex;if(sa===0)sa=ma.added-H.added;return sa});Na=na.length;return w}function V(){Xa&&Xa.unbind();Xa=INTERACT.watch(Ea);b.pannable&&Xa.pannable().bind("pan",m);if(b.scalable){Xa.bind("zoom",h);Xa.bind("doubleTap",l)}Xa.bind("pointerDown",v);Xa.bind("pointerMove",q);Xa.bind("pointerUp",z);b.captureHover&&Xa.bind("pointerHover",D);Xa.bind("tap",R)}function s(u,w,H){if(Ya){u=
r(w.x,w.y);Ya.drag.call(Ya.target,Ya,u.x,u.y,H)&&S();if(H)Ya=null}}function O(u){var w,H,ma=false;if(ub|kb){u=u?u:(new Date).getTime();H=xa!==i||e!==o;bb=Db|(Ha!==1?Eb:0)|(H?vb:0)|(wb?xb:0);ta=(w=(bb&(Eb|vb))!==0)&&(bb&xb)===0;if(tb&&Ea){kb&&FlashCanvas.initElement(Ea);Ea.width=Ra;Ea.height=Qa;Ea.style.width=Ra+"px";Ea.style.height=Qa+"px";tb=false}J=wa();for(H=Na;H--;){bb|=na[H].animated?xb:0;na[H].cycle(u,J,bb);ma=na[H].clip||ma}H=bb;var sa=J;ma=F&&ma&&!w;w=u;var Ka;$.center(sa);var Sa=0,Ta;if(Ha!==
1){Ta=1/Ha;pb=aa.x+(xa-Q.x);qb=aa.y+(e-Q.y);Ta=sa?$.fromCenter(pb>>0,qb>>0,sa.width*Ta>>0,sa.height*Ta>>0):void 0}else Ta=$.copy(sa);ga=Ta;ma||Ja.clearRect(0,0,Ra,Qa);ga.scaleFactor=Ha;Ja.save();try{Ha!==1&&Ja.scale(Ha,Ha);Za=ya=null;if(ma){Ja.beginPath();for(Sa=Na;Sa--;)na[Sa].clip&&na[Sa].clip(Ja,ga,H,Fa,w);Ja.closePath();Ja.clip()}Ja.globalCompositeOperation="source-over";for(Sa=Na;Sa--;){Ka=na[Sa];if(Ka.shouldDraw(bb,J)){var Ua=Ka.style,gb=Ua?nb.apply(Ja,Ua):null;Ka.draw(Ja,ga,H,Fa,w,L);gb&&nb.apply(Ja,
gb)}}}finally{Ja.restore()}ub=0;fb("drawComplete",sa,w);if(L){Ka=L?L.elements:[];if(hb&&hb.type==="hover"){Ua=Hits.diffHits(hb.elements,Ka);Ua.length>0&&Hits.triggerEvent(hb,Fa,"Out",Ua)}if(Ka.length>0){gb=L.x;H=L.y;for(Ua=Ka.length;Ua--;){sa=Ka[Ua];ma=gb;w=H;if(Sa=sa&&sa.drag&&(!sa.canDrag||sa.canDrag(sa,ma,w))){Ya=sa;Ya.startX=ma;Ya.startY=w}if(Sa)break}Hits.triggerEvent(L,Fa)}hb=Ka.length>0?COG.extend({},L):null;L=null}u-ab>yb&&db();Ib=u;i=xa;o=e;animFrame(O)}else da=false}function ca(u,w,H){L=
Hits.init(u,w,H,r(H.x,H.y,true));for(u=Na;u--;)cb=cb||(na[u].hitGuess?na[u].hitGuess(L.x,L.y,bb,Fa):false);cb&&S()}function S(){ub+=1;if(!da){da=true;animFrame(O)}}function wa(){return $.init(xa,e,xa+Ra,e+Qa)}function db(){if(p||a){var u=c?xa+Ba:xa,w=f?e+T:e;if(p&&p>Ra)if(u+Ra>p)xa=c?u-p>0?xa-p:xa:p-Ra;else if(u<0)xa=c?xa+p:0;if(a&&a>Qa)if(w+Qa>a)e=f?w-a>0?e-a:e:a-Qa;else if(w<0)e=f?e+a:0}ab=(new Date).getTime();fb("refresh",Fa,wa());S()}function la(u,w,H,ma,sa){if(H)COG.tweenValue(Ha,u,H,sa,function(Ka,
Sa){Ha=Ka;if(Sa){var Ta=qa(La(Ha)/Math.LN2);Ha=Aa(2,Ta);ma&&ma()}g(w);d()});else{Ha=u;g(w);d()}return Fa}function eb(u,w,H){u=ua(b.minZoom,Z(b.maxZoom,u));if(u!==ob){var ma=Aa(2,u-ob),sa=Ba/ma|0,Ka=T/ma|0;ob=u;Pa(((w?w:xa+Ba)-sa)*ma,((H?H:e+T)-Ka)*ma);i=xa;o=e;fb("zoomLevelChange",u);Ha=1;db()}}function fb(){for(var u=Fa.trigger.apply(null,arguments).cancel,w=na.length;w--;)u=na[w].trigger.apply(null,arguments).cancel||u;return!u}function Pa(u,w,H,ma,sa){function Ka(){Sa+=1;if(Sa>=2){wb=false;sa&&
sa()}}var Sa=0,Ta=ya?t.offset(ya,-Ba,-T):null,Ua=Za?t.offset(Za,-Ba,-T):null;if(Ta){u=u<Ta.x?Ta.x:u;w=w<Ta.y?Ta.y:w}if(Ua){u=u>Ua.x?Ua.x:u;w=w>Ua.y?Ua.y:w}if(H){if((bb&vb)===0){COG.tweenValue(xa,u,H,ma,function(gb,zb){xa=gb|0;(zb?Ka:S)();return!ta});COG.tweenValue(e,w,H,ma,function(gb,zb){e=gb|0;(zb?Ka:S)();return!ta});wb=true}}else{xa=u|0;e=w|0;S();sa&&sa()}}b=COG.extend({id:COG.objId("view"),container:"",captureHover:true,captureDrag:false,fastDraw:false,inertia:true,minRefresh:1E3,pannable:false,
clipping:true,scalable:false,panAnimationEasing:COG.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,autoSize:true,tapExtent:10,guides:false,turbo:false,fps:25,minZoom:1,maxZoom:1,zoomEasing:COG.easing("quad.out"),zoomDuration:300,zoomLevel:1},b);var na=[],Na=0,Ea=document.getElementById(b.container),Ya=null,Ja=null,Ab=typeof window.attachEvent!="undefined",kb,cb=false,yb=b.minRefresh,xa=0,e=0,i=0,o=0,p=null,a=null,c=false,f=false,F=b.clipping,J=null,da=false,ga,Da=1,Ba=0,T=
0,L=null,Q=null,aa=null,ta=false,ya=null,Za=null,ab=0,hb=null,Cb=0,Ha=1,Ib=0,tb=false,Xa=null,wb=false,Qa,Ra,ub=0,pb,qb,ob=b.zoomLevel,Db=y("ACTIVE"),vb=y("PAN"),Eb=y("ZOOM"),xb=y("ANIMATING"),bb=Db,Fa={id:b.id,deviceScaling:Da,fastDraw:b.fastDraw||N().requireFastDraw,detach:function(){Xa&&Xa.unbind()},eachLayer:function(u){for(var w=Na;w--;)u(na[w])},getDimensions:function(){return Va.init(Ra,Qa)},getLayer:function(u){for(var w=0;w<Na;w++)if(na[w].getId()==u)return na[w];return null},getZoomLevel:function(){return ob},
setLayer:function(u,w){for(var H=0;H<Na;H++)if(na[H].getId()===u){na.splice(H,1);break}if(w){pa(u,w);w.trigger("refresh",Fa,wa())}S();return w},invalidate:S,refresh:db,resetScale:function(){Ha=1},resize:function(u,w){if(Ea){b.autoSize=false;if(Ra!==u||Qa!==w)oa(u,w)}},scale:la,setZoomLevel:eb,syncXY:function(){},triggerAll:fb,removeLayer:function(u){a:{for(var w=Na;w--;)if(na[w].getId()==u){u=w;break a}u=-1}if(u>=0&&u<Na){Fa.trigger("layerRemoved",na[u]);na.splice(u,1);S()}Na=na.length},getOffset:function(){return t.init(xa,
e)},setMaxOffset:function(u,w,H,ma){p=u;a=w;c=typeof H!="undefined"?H:false;f=typeof ma!="undefined"?ma:false},getViewRect:wa,updateOffset:Pa,pan:function(u,w,H,ma,sa){Pa(xa+u,e+w,H,ma,sa)}};Da=N().getScaling();COG.observable(Fa);Fa.bind("invalidate",function(){S()});Fa.bind("resync",function(){Za=ya=null});COG.configurable(Fa,["container","captureHover","captureDrag","scalable","pannable","inertia","minZoom","maxZoom","zoom"],COG.paramTweaker(b,null,{container:function(u,w){Ea=document.getElementById(w);
oa()},inertia:V,captureHover:V,scalable:V,pannable:V}),true);CANI.init(function(u){Fa.markers=pa("markers",new rb({zindex:20}));canvasCaps=u.canvas;oa();if(b.autoSize)Ab?window.attachEvent("onresize",B):window.addEventListener("resize",B,false)});return Fa},Bb=function(b){b=COG.extend({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:y("ACTIVE","ANIMATING","PAN","ZOOM"),style:null,minXY:null,maxXY:null},b);var m=null,h=false,d=false,g=b.id,r=y("ACTIVE"),l=b.validStates,v=0,D=0,q=COG.extend({addToView:function(z){z.setLayer(g,
q)},shouldDraw:function(z){return(z&l)!==0},clip:null,cycle:function(){},draw:function(){},hitGuess:null,remove:function(){q.trigger("remove",q)},changed:function(){d=true;m&&m.invalidate()},hitTest:null,getId:function(){return g},setId:function(z){g=z},getParent:function(){return m},setParent:function(z){h=(m=z)?m.fastDraw&&displayState!==r:false;q.trigger("parentChange",m)}},b);COG.observable(q);q.bind("drawComplete",function(z,B){d=false;v=B.x1;D=B.y1});q.bind("resync",function(z,B){q.minXY&&B.syncXY(q.minXY);
q.maxXY&&B.syncXY(q.maxXY)});return q},ib=function(b){b=COG.extend({style:null,xy:null,size:null,fill:false,stroke:true,draggable:false,observable:true,properties:{},type:"shape",transformable:false},b);COG.extend(this,b);this.id=COG.objId(this.type);this.bounds=null;this.observable&&COG.observable(this);this.transformable&&I(this);this.transformed=false};ib.prototype={constructor:ib,drag:null,draw:function(b){this.fill&&b.fill();this.stroke&&b.stroke()},invalidate:function(){var b=this.layer?this.layer.getParent():
null;b&&b.invalidate()},prepPath:function(){},resync:function(b){if(this.xy){b.syncXY([this.xy]);this.size&&this.updateBounds($.fromCenter(this.xy.x,this.xy.y,this.size,this.size))}},setTransformable:function(b){b&&!this.transformable&&I(this);this.transformable=b},updateBounds:function(b,m){this.bounds=b;if(m)this.xy=$.center(this.bounds)}};var lb=function(b,m){m=COG.extend({simplify:false},m);var h=false,d=m.simplify;y("ZOOM");var g=[];m.type=m.fill?"polygon":"line";ib.call(this,m);COG.extend(this,
{animatePath:function(){},prepPath:function(r,l,v){if(h){var D=true;r.beginPath();for(var q=g.length;q--;){var z=g[q].x-l,B=g[q].y-v;if(D){r.moveTo(z,B);D=false}else r.lineTo(z,B)}}return h},resync:function(r){var l,v,D,q,z;r.syncXY(b);g=t.floor(d?t.simplify(b):b);for(var B=g.length;B--;){r=g[B].x;l=g[B].y;q=typeof q=="undefined"||r<q?r:q;z=typeof z=="undefined"||l<z?l:z;v=typeof v=="undefined"||r>v?r:v;D=typeof D=="undefined"||l>D?l:D}this.updateBounds($.init(q,z,v,D),true)}});h=b&&b.length>=2};
lb.prototype=COG.extend(ib.prototype,{constructor:lb});var Gb=function(b,m){m.fill=false;lb.call(this,b,m)};Gb.prototype=new lb;var mb=function(b){function m(D){if(this.imageUrl=D)l=Oa.get(this.imageUrl,function(q){var z=v.layer?v.layer.getParent():null;l=q;z&&z.invalidate()})}b=COG.extend({image:null,imageUrl:null,imageOffset:null},b);var h=null,d=ib.prototype.updateBounds,g,r,l=b.image;ib.call(this,b);var v=COG.extend(this,{changeImage:m,drag:function(D,q,z,B){h||(h=t.init(D.startX-this.xy.x,D.startY-
this.xy.y));this.xy.x=q-h.x;this.xy.y=z-h.y;if(B){h=null;if(this.layer)(D=this.layer.getParent())&&D.syncXY([this.xy],true);this.trigger("dragDrop")}return true},draw:function(D){D.drawImage(l,g,r)},prepPath:function(D,q,z){var B=l&&l.width>0;if(B){A(this,l);g=this.xy.x+this.imageOffset.x-q;r=this.xy.y+this.imageOffset.y-z;D.beginPath();D.rect(g,r,l.width,l.height)}return B},updateBounds:function(D,q){d.call(this,D,q);A(this,l)}});l||m(this.imageUrl)};mb.prototype=new ib;mb.prototype.constructor=
mb;var sb=function(b){b=COG.extend({imageAnchor:null},b);if(b.imageAnchor)b.imageOffset=t.invert(b.imageAnchor);mb.call(this,b)};sb.prototype=new mb;sb.prototype.constructor=sb;var rb=function(b){function m(l){for(var v=d.length;v--;)d[v].resync(l);d.sort(function(D,q){var z=q.xy.y-D.xy.y;return z!=0?z:q.xy.x-D.xy.y});r.changed()}function h(l,v){m(v)}b=COG.extend({zindex:10},b);var d=[],g=CANI.canvas.pipTransformed,r=COG.extend(new Bb(b),{add:function(l,v){if(l){l.layer=r;var D=r.getParent();if(D){l.resync(r.getParent());
D.invalidate()}if(v)d.unshift(l);else d[d.length]=l}},clear:function(){d=[]},draw:function(l,v,D,q,z,B){q=v.x1;z=v.y1;var R=B?g?B.x-q:B.relXY.x:0,oa=B?g?B.y-z:B.relXY.y:0,pa=v.width;v=v.height;for(var V=d.length;V--;){var s=d[V],O=s.style,ca,S=s.transformed;if(S){s.transform(l,q,z);if(g){R-=s.xy.x;oa-=s.xy.y}}if(s.prepPath(l,S?s.xy.x:q,S?s.xy.y:z,pa,v,D)){if(B&&l.isPointInPath(R,oa)){B.elements.push(Hits.initHit(s.type,s,{drag:s.draggable?s.drag:null}));ca=B.type+"Style";O=s[ca]||r[ca]||O}O=O?nb.apply(l,
O):null;s.draw(l,q,z,pa,v,D);O&&nb.apply(l,O)}S&&l.restore()}},find:function(){return[].concat(d)},hitGuess:function(l,v){for(var D=false,q=d.length;!D&&q--;){var z=d[q].bounds;D=D||z&&l>=z.x1&&l<=z.x2&&v>=z.y1&&v<=z.y2}return D}});r.bind("parentChange",h);r.bind("resync",h);return r},Jb=function(){return{tileSize:256,init:function(b,m,h,d,g){return COG.extend({x:b,y:m,width:h,height:d},g)}}}();COG.extend(P,{ex:COG.extend,ticks:ia,getConfig:N,userMessage:function(b,m,h){P.trigger("userMessage",b,
m,h)},XY:t,XYRect:$,Dimensions:Va,Vector:Y,Hits:Hits,Images:Oa,Generator:jb,tween:COG.tween,tweenValue:COG.tweenValue,easing:COG.easing,Tween:COG.Tween,Style:nb,viewState:y,View:Fb,ViewLayer:Bb,ImageLayer:function(b,m){function h(q,z,B){for(z=l.length;z--;){var R=l[z],oa=R.x,pa=R.y,V=$.init(R.x,R.y,R.x+R.width,R.y+R.height);if(B&&$.intersect(q,V))(V=Oa.get(R.url,function(){D.changed()},v))&&B(V,oa,pa,R.width,R.height)}}function d(q){var z=++r,B=D.getParent();g&&g.run(B,q,function(R){if(z==r){l=[].concat(R);
B.invalidate()}})}m=COG.extend({imageLoadArgs:{}},m);var g=b?jb.init(b,m):null,r=0,l=[],v=m.imageLoadArgs,D=COG.extend(new Bb(m),{changeGenerator:function(q,z){g=jb.init(q,COG.extend({},m,z));l=null;d(D.getParent().getViewRect())},clip:function(q,z,B){var R=z.x1,oa=z.y1;h(z,B,function(pa,V,s,O,ca){q.rect(V-R,s-oa,O,ca)})},draw:function(q,z,B){var R=z.x1,oa=z.y1;h(z,B,function(pa,V,s){q.drawImage(pa,V-R,s-oa,pa.width,pa.height)})},mask:function(q,z,B){h(z,B,function(R,oa,pa,V,s){COG.info("clearing rect @ x = "+
oa+", y = "+pa+", width = "+V+", height = "+s);q.clearRect(oa,pa,V,s)})}});D.bind("refresh",function(q,z,B){d(B)});D.bind("tap",function(q,z,B,R){q=[];var oa=R.x,pa=R.y,V,s;if(l)for(var O=l.length;O--;){V=l[O];if(s=oa>=V.x&&oa<=V.x+V.width&&pa>=V.y&&pa<=V.y+V.height)q[q.length]=V}q.length>0&&D.trigger("tapImage",q,z,B,R)});return D},ImageGenerator:function(b){b=COG.extend({relative:false,padding:2},b);b={run:function(){COG.warn("running base generator - this should be overriden")}};COG.observable(b);
return b},Drawable:ib,Poly:lb,Line:Gb,ImageDrawable:mb,ImageMarker:sb,ShapeLayer:rb,transformable:I,Tiling:Jb});COG.observable(P);var $a=P.Geo=function(){function b(e){for(var i=null,o=1;!i&&o<arguments.length;o++)i=r(e,arguments[o]);i=i?i:r(e);if(!i)throw Error("Unable to find GEO engine with "+e+" capability");return i}function m(e){e=parseFloat(e)*B;e=ka(e);var i=O*e;return La((1+e)/(1-e)*Aa((1-i)/(1+i),O))/2}function h(e){return parseFloat(e)*B}function d(e){e=Aa(Math.E,-e);for(var i=ja-2*ha(e),
o=l(i,e),p=0;p<S&&ea(i-o)>ca;){i=o;o=l(i,e);p++}return o*R}function g(e){return e%360*R}function r(e,i){var o=null;for(var p in na)if(i){if(p==i&&na[p][e]){o=na[p];break}}else if(na[p][e]){o=na[p];break}return o}function l(e,i){var o=O*ka(e);return ja-2*ha(i*Aa((1-o)/(1+o),O/2))}function v(e,i,o,p){i=D(i);e.add(p(i,o));return i.length}function D(e){var i=e?e.length:0,o=Array(i);for(i=i;i--;)o[i]=$a.Position.init(e[i][1],e[i][0]);return $a.Position.vectorize(o,kb)}function q(e,i,o){return new xa(e,
i,o)}var z=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],B=Math.PI/180,R=180/Math.PI,oa=ja,pa=-oa,V=ra,s=-V,O=0.08181919084262157,ca=1.0E-7,S=12,wa=null,db={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",HWY:"HIGHWAY",MWY:"MOTORWAY"},la=function(){function e(a){return a?o(a.lat,a.lon):null}function i(a){return!a||a.lat===0&&a.lon===0}function o(a,c){return{lat:parseFloat(a?a:0),lon:parseFloat(c?c:0)}}function p(a){if(a)if(typeof a.lat!==
"undefined")return e(a);else{if(a.split)for(var c=[" ",","],f=0;f<c.length;f++){var F=a.split(c[f]);if(F.length===2)return o(F[0],F[1])}}else return o();return null}return{calcDistance:function(a,c){if(i(a)||i(c))return 0;var f=(c.lat-a.lat)*B>>1,F=(c.lon-a.lon)*B>>1;f=ka(f)*ka(f)+X(a.lat*B)*X(c.lat*B)*ka(F)*ka(F);return 6371*2*Ca(Ga(f),Ga(1-f))},copy:e,empty:i,equal:function(a,c){return a&&c&&a.lat==c.lat&&a.lon==c.lon},fromMercatorPixels:function(a,c){return o(d(c),g(a))},generalize:function(a,
c,f){var F=a.length,J=[],da=null;f||(f=250);f/=1E3;COG.info("generalizing positions, must include "+c.length+" positions");for(var ga=F;ga--;)if(ga===0)J.unshift(a[ga]);else{var Da=!da||la.inArray(a[ga],c)?f:la.calcDistance(da,a[ga]);if(a[ga]&&Da>=f){J.unshift(a[ga]);da=a[ga]}}COG.info("generalized "+F+" positions into "+J.length+" positions");return J},inArray:function(a,c){for(var f=la.equal,F=c.length;F--;)if(f(a,c[F]))return true;return false},inBounds:function(a,c){var f=!(la.empty(a)||la.empty(c));
return f=(f=f&&a.lat>=c.min.lat&&a.lat<=c.max.lat)&&a.lon>=c.min.lon&&a.lon<=c.max.lon},init:o,offset:function(a,c,f){var F=a.lat*B;a=a.lon*B;c=F+c/6371;f=va(ka(f/6371)/X(F));f=a+f;c=(c+ja)%Math.PI-ja;f%=ra;return o(c*R,f*R)},parse:p,parseArray:function(a){var c=a.length,f=Array(c);for(c=c;c--;)f[c]=p(a[c]);return f},toMercatorPixels:function(a){return T5.XY.init(h(a.lon),m(a.lat))},toString:function(a){return a?a.lat+" "+a.lon:""},vectorize:function(a,c){function f(){for(var ga=0,Da=c.chunkSize,
Ba=F;Ba--;){J[Ba]=T5.GeoXY.init(a[Ba]);ga+=1;if(ga>Da)break}F=Ba;if(F<=0)c.callback&&c.callback(J);else animFrame(f)}var F=a.length,J=Array(F);c=COG.extend({chunkSize:500,async:true,callback:null},c);if(!c.async){for(var da=F;da--;)J[da]=T5.GeoXY.init(a[da]);return J}animFrame(f);return null}}}(),eb=function(){function e(a,c,f){var F=T5.XY.init(0,c.lat-a.lat);if(typeof f==="undefined")f=true;F.x=f&&a.lon>c.lon?360-a.lon+c.lon:c.lon-a.lon;return F}function i(a,c){return eb.init(la.init(a.min.lat-c,
a.min.lon-c%360),la.init(a.max.lat+c,a.max.lon+c%360))}function o(a){var c=e(a.min,a.max);return la.init(a.min.lat+(c.y>>1),a.min.lon+(c.x>>1))}function p(a,c){return{min:la.parse(a),max:la.parse(c)}}return{calcSize:e,createBoundsFromCenter:function(a,c){var f=c/6371,F=a.lat*B,J=a.lon*B,da=F-f,ga=F+f;if(da>pa&&ga<oa){F=va(ka(f)/X(F));f=(J-F)%ra;J=(J+F)%ra}else{da=ua(da,pa);ga=Z(ga,oa);f=s;J=V}return eb.init(la.init(da*R,f*R),la.init(ga*R,J*R))},expand:i,forPositions:function(a,c){var f=null,F=T5.ticks();
c||(c="auto");for(var J=a.length;J--;)if(f){var da=e(f.min,a[J],false),ga=e(a[J],f.max,false);if(da.x<0)f.min.lon=a[J].lon;if(da.y<0)f.min.lat=a[J].lat;if(ga.x<0)f.max.lon=a[J].lon;if(ga.y<0)f.max.lat=a[J].lat}else f=p(a[J],a[J]);if(c){if(c=="auto"){J=e(f.min,f.max);c=ua(J.x,J.y)*0.3}f=i(f,c)}COG.trace("calculated bounds for "+a.length+" positions",F);return f},getCenter:o,getGeoHash:function(a){var c=T5.Geo.GeoHash.encode(a.min.lat,a.min.lon);a=T5.Geo.GeoHash.encode(a.max.lat,a.max.lon);COG.info("min hash = "+
c+", max hash = "+a)},getZoomLevel:function(a,c){var f=o(a);f=Z(qa(ea(f.lat)*0.05),z.length);var F=z[f],J=e(a.min,a.max);f=za(La(z[3]*c.height/J.y)/La(2));F=za(La(F*c.width/J.x)/La(2));return Z(isNaN(f)?1E3:f,isNaN(F)?1E3:F)},init:p,isEmpty:function(a){return!a||la.empty(a.min)||la.empty(a.max)},toString:function(a){return"min: "+la.toString(a.min)+", max: "+la.toString(a.max)}}}(),fb=function(){var e=/^(\d+).*$/,i=/(\d+)\s?\-\s?(\d+)/;return{buildingMatch:function(o,p){e.lastIndex=-1;if(e.test(o))for(var a=
o.replace(e,"$1"),c=p.split(","),f=0;f<c.length;f++){i.lastIndex=-1;if(i.test(c[f])){var F=i.exec(c[f]);if(a>=parseInt(F[1],10)&&a<=parseInt(F[2],10))return true}else if(a==c[f])return true}return false},normalize:function(o){if(!o)return"";o=o.toUpperCase();if(!wa){var p=[];for(var a in db)p.push(a);wa=RegExp("(\\s)("+p.join("|")+")(\\s|$)","i")}wa.lastIndex=-1;if(p=wa.exec(o))o=o.replace(wa,"$1"+db[p[2]]);return o},toString:function(o){return o.streetDetails+" "+o.location}}}(),Pa=P.GeoXY=function(){function e(p,
a){if(p.length){for(var c,f,F,J,da=p.length;da--;){e(p[da],a);c=typeof c==="undefined"||p.x<c?p.x:c;f=typeof f==="undefined"||p.y<f?p.y:f;F=typeof F==="undefined"||p.x>F?p.x:F;J=typeof J==="undefined"||p.y>J?p.y:J}return $.init(c,f,J,J)}else if(p.mercXY){c=p.mercXY;p.x=(c.x+Math.PI)/a|0;p.y=(Math.PI-c.y)/a|0;p.rpp=a}else COG.warn("Attempted to sync an XY composite, not a GeoXY");return p}function i(p,a){if(p.length)for(var c=p.length;c--;)i(p[c],a);else{p.mercXY=t.init(p.x*a-Math.PI,Math.PI-p.y*a);
p.pos=la.fromMercatorPixels(p.mercXY.x,p.mercXY.y)}return p}function o(p,a,c){p.pos=a;p.mercXY=la.toMercatorPixels(a);(c=typeof c!=="undefined"?c:p.rpp)&&e(p,c)}return{init:function(p,a){var c=t.init();o(c,p,a);return c},sync:e,syncPos:i,toPos:function(p,a){a=a?a:_self.rpp;return la.fromMercatorPixels(p.x*a-Math.PI,Math.PI-p.y*a)},updatePos:o}}(),na={},Na=function(){return{bestResults:function(e,i){i||(i=20);for(var o=e.length>0?e[0]:null,p=[],a=0;a<e.length;a++)if(o&&e[a]&&o.matchWeight-e[a].matchWeight<=
i)p.push(e[a]);else break;return p}}}(),Ea=function(e){e=COG.extend({id:null,caption:"",resultType:"",data:null,pos:null,matchWeight:0},e);return COG.extend(e,{toString:function(){return e.caption+(e.matchWeight?" ("+e.matchWeight+")":"")}})},Ya=function(){function e(a,c){var f=new T5.ShapeLayer;c.geometry&&la.vectorize(c.geometry,{callback:function(F){f.add(new T5.Line(F,{style:"waypoints",simplify:true}));a.setLayer("route",f)}})}function i(a){for(var c=o.Unknown,f=p,F=0;F<f.length;F++){f[F].regex.lastIndex=
-1;var J=f[F].regex.exec(a);if(J){c=f[F].customCheck?f[F].customCheck(a,J):f[F].turnType;break}}return c}var o={Unknown:"turn-unknown",Start:"turn-none-start",Continue:"turn-none",Arrive:"turn-none-arrive",TurnLeft:"turn-left",TurnLeftSlight:"turn-left-slight",TurnLeftSharp:"turn-left-sharp",TurnRight:"turn-right",TurnRightSlight:"turn-right-slight",TurnRightSharp:"turn-right-sharp",Merge:"merge",UTurnLeft:"uturn-left",UTurnRight:"uturn-right",EnterRoundabout:"roundabout-enter",Ramp:"ramp",RampExit:"ramp-exit"},
p=function(){var a=[];a.push({regex:/continue/i,turnType:o.Continue});a.push({regex:/(take|bear|turn)(.*?)left/i,customCheck:function(c,f){return/bear/i.test(f[1])?o.TurnLeftSlight:o.TurnLeft}});a.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(c,f){return/bear/i.test(f[1])?o.TurnRightSlight:o.TurnRight}});a.push({regex:/enter\s(roundabout|rotaty)/i,turnType:o.EnterRoundabout});a.push({regex:/take.*?ramp/i,turnType:o.Ramp});a.push({regex:/take.*?exit/i,turnType:o.RampExit});a.push({regex:/make(.*?)u\-turn/i,
customCheck:function(c,f){return/right/i.test(f[1])?o.UTurnRight:o.UTurnLeft}});a.push({regex:/proceed/i,turnType:o.Start});a.push({regex:/arrive/i,turnType:o.Arrive});a.push({regex:/fell\sthrough/i,turnType:o.Merge});return a}();return{calculate:function(a){a=COG.extend({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},a);var c=b("route");c&&c.route(a,function(f){if(a.generalize)f.geometry=la.generalize(f.geometry,f.getInstructionPositions());if(a.map){e(a.map,
f);a.autoFit&&a.map.gotoBounds(f.boundingBox)}a.success&&a.success(f)})},createMapOverlay:e,parseTurnType:i,TurnType:o,Instruction:function(a){var c=a=COG.extend({position:null,description:"",distance:0,distanceTotal:0,time:0,timeTotal:0,turnType:null},a),f=a.description;f=f.replace(/(\w)(\/)(\w)/g,"$1 $2 $3");c.description=f;if(!a.turnType)a.turnType=i(a.description);return a},RouteData:function(a){a=COG.extend({geometry:[],instructions:[],boundingBox:null},a);if(!a.boundingBox)a.boundingBox=eb.forPositions(a.geometry);
return COG.extend({getInstructionPositions:function(){for(var c=[],f=0;f<a.instructions.length;f++)a.instructions[f].position&&c.push(a.instructions[f].position);return c}},a)}}}(),Ja="featurecollection",Ab="feature",kb={async:false},cb={processor:null,group:"shapes",layerClass:rb},yb={point:COG.extend({},cb,{processor:function(e,i,o,p){i=D([i.coordinates],kb);if(i.length>0)if(o=p.marker(i[0],o)){e.add(o);return i.length}},group:"markers",layerClass:rb}),linestring:COG.extend({},cb,{processor:function(e,
i,o,p){i=D(i&&i.coordinates?i.coordinates:[]);return v(e,i,o,p.line)}}),multilinestring:COG.extend({},cb,{processor:function(e,i,o,p){i=i&&i.coordinates?i.coordinates:[];for(var a=0,c=i.length;c--;)a+=v(e,i[c],o,p.line);return a}}),polygon:COG.extend({},cb,{processor:function(e,i,o,p){i=i&&i.coordinates?i.coordinates:[];if(i.length>0)return v(e,i[0],o,p.poly);return 0}}),multipolygon:COG.extend({},cb,{processor:function(e,i,o,p){i=i&&i.coordinates?i.coordinates:[];for(var a=0,c=0;c<i.length;c++)a+=
v(e,i[c][0],o,p.poly);return a}})},xa=function(e,i,o,p){function a(Q,aa){var ta=Q.processor,ya=da+Q.group,Za=COG.extend({},Q,o,{properties:aa.properties});if(ta){var ab=L[ya];if(!ab){ab=new Q.layerClass({id:ya});L[ya]=ab}globalLayers=L;return ta(ab,aa.data,Za,p)}return 0}function c(Q,aa){var ta=Q&&Q.type?Q.type.toLowerCase():null;return ta&&ta===Ab?c(Q.geometry,Q.properties):{type:ta,isCollection:ta?ta===Ja:false,definition:yb[ta],data:Q,properties:aa?aa:Q.properties}}function f(Q){var aa=0,ta=COG.extend({},
o),ya=ga;Q=Q?Q:(new Date).getTime();if(!Ba){for(;ya<Da;ya++){Q=c(J?J(e[ya]):e[ya]);var Za=null;if(Q.isCollection){ta.layerPrefix=da+T++ +"-";Ba=q(Q.data.features,function(ab){Ba=null;for(var hb in ab)L[hb]=ab[hb]},ta);Za+=1}else if(Q.definition)Za=a(Q.definition,Q);aa+=Za?Za:1;if(aa>=F)break}ga=ya+1;if(Ba||ga<Da)animFrame(f);else i&&i(L)}}o=COG.extend({vectorsPerCycle:$a.VECTORIZE_PER_CYCLE,rowPreParse:null,simplify:false,layerPrefix:"geojson-"},o);p=COG.extend({marker:function(Q){return new Marker({xy:Q})},
line:function(Q,aa){return new lb(Q,COG.extend({},o,aa))},poly:function(Q,aa){return new lb(Q,COG.extend({fill:true},o,aa))}},p);var F=o.vectorsPerCycle,J=o.rowPreParse,da=o.layerPrefix,ga=0,Da=0,Ba=null,T=0,L={};if(e){if(typeof e.length==="undefined")e=[e];Da=e.length;animFrame(f)}};P.GeoJSON={parse:q};P.Map=function(e){function i(L){try{var Q=$a.Position.init(L.coords.latitude,L.coords.longitude),aa=L.coords.accuracy/1E3;T.trigger("locationUpdate",L,aa);if(ga){if(!J){J=new $a.UI.LocationOverlay({pos:Q,
accuracy:aa});J.update(T.getTileLayer());T.setLayer("location",J)}var ta=$a.BoundingBox.createBoundsFromCenter(Q,Math.max(aa,1));T.gotoBounds(ta)}else{J.pos=Q;J.accuracy=aa;J.update(T.getTileLayer());a(Q,null,COG.easing("sine.out"))}ga=false}catch(ya){COG.exception(ya)}}function o(L){COG.info("caught location tracking error:",L)}function p(L,Q,aa){T.setZoomLevel(Q);a(L,aa)}function a(L,Q,aa,ta){L=Pa.init(L,$a.radsPerPixel(T.getZoomLevel()));var ya=T.getDimensions();T.updateOffset(L.x-(ya.width>>1),
L.y-(ya.height>>1),aa,ta,function(){T.refresh();T.trigger("boundsChange",T.getBoundingBox());Q&&Q(T)})}e=COG.extend({tapExtent:10,crosshair:false,zoomLevel:0,boundsChangeThreshold:30,minZoom:1,maxZoom:18,pannable:true,scalable:true},e);var c={NONE:0,SINGLE:1,WATCH:2},f=t.init(),F=c.NONE,J=null,da=0,ga=true,Da=0,Ba=e.tapExtent;e.adjustScaleFactor=function(L){return Math.pow(2,(L<1?Math.floor:Math.ceil)(Math.log(L)))};var T=COG.extend(new Fb(e),{getBoundingBox:function(){var L=T.getViewRect();return $a.BoundingBox.init(Pa.toPos(t.init(L.x1,
L.y2),Da),Pa.toPos(t.init(L.x2,L.y1),Da))},getCenterPosition:function(){var L=T.getViewRect();if(L){L=t.init(L.x1+(L.width>>1),L.y1+(L.height>>1));return Pa.toPos(L,Da)}return null},gotoBounds:function(L,Q){var aa=$a.BoundingBox.getZoomLevel(L,T.getDimensions());p($a.BoundingBox.getCenter(L),aa,Q)},gotoPosition:p,panToPosition:a,syncXY:function(L,Q){return(Q?Pa.syncPos:Pa.sync)(L,Da)},locate:function(){T.trackStart(c.SINGLE);setTimeout(T.trackCancel,1E4)},trackStart:function(L){if(navigator.geolocation&&
!da){F=L?L:c.WATCH;ga=true;da=navigator.geolocation.watchPosition(i,o,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3})}},trackCancel:function(){da&&navigator.geolocation&&navigator.geolocation.clearWatch(da);T.removeLayer("location");J=null;F=c.NONE;da=0},animateRoute:function(L,Q,aa,ta){var ya=T.getLayer("route");if(ya)(L=ya.getAnimation(L,Q,aa,ta))&&L.addToView(T)}});T.bind("pan",function(){F===c.SINGLE&&T.trackCancel()});T.bind("tap",function(L,Q,aa,ta){L=Pa.toPos(ta,Da);var ya=Pa.toPos(t.offset(ta,
-Ba,Ba),Da);ta=Pa.toPos(t.offset(ta,Ba,-Ba),Da);T.trigger("geotap",Q,aa,L,eb.init(ya,ta))});T.bind("refresh",function(){if(t.absSize(t.diff(f,T.getOffset()))>e.boundsChangeThreshold){f=t.copy(T.getOffset());T.trigger("boundsChange",T.getBoundingBox())}});T.bind("zoomLevelChange",function(L,Q){var aa;Da=$a.radsPerPixel(Q);aa=ra/Da|0;T.setMaxOffset(aa,aa,true,false);Oa.cancelLoad();T.resetScale();T.triggerAll("resync",T);T.refresh()});return T};P.GeoShape=function(e,i){i=COG.extend({autoParse:true},
i);for(var o=Array(e.length),p=i.autoParse,a=T5.Geo.Position.parse,c=e.length;c--;)o[c]=T5.GeoXY.init(p?a(e[c]):e[c]);return new T5.Poly(o,i)};P.LocationOverlay=function(e){e=COG.extend({pos:null,accuracy:null,zindex:90},e);var i=new Image,o=T5.XY.init(),p=T5.XY.init(),a=null;i.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAACIQAAAiEBPhEQkwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAG+SURBVCiRlZHNahNRAIW/O7mTTJPahLZBA1YUyriINRAE3bQIKm40m8K8gLj0CRQkO32ELHUlKbgoIu4EqeJPgtCaoBuNtjXt5LeTMZk0mbmuWiuuPLsD3+HAOUIpxf9IHjWmaUbEyWv5ROrsVULhcHP761rUfnN3Y2Otc8CIg4YT85lzuVsPP+Qupw1vpPjRCvhS9ymvV0e77x7nNj+uvADQAIQQ+uLyvdfLV9JGZi7EdEwQlqBpEJ019f0z1mo2u5Q8DMydv25lshemmj1FueZTawbs7inarqLbV7Qjab1upB9YlhWSAHLavLHZCvg1VEhN0PMU9W7At4bPVidg7CtkLLXkut+lBPD6/Ub155jJiADAHSpaLmx3ApyBQoYEUd0PBoOBkAC6+3llvda/YxgGgYL+UNHf/zN3KiExGlsvTdP0NYDkhPdWrz35ZDsBzV5wCMuQwEyFmXFeeadjzfuFQmGkAZRKpdGC/n7x+M6jqvA9Zo6FWDhlcHE+wqT93J1tP7vpOE7rrx8ALMuasPf8S12St4WmJ6bYWTUC52k8Hm8Vi0X/nwBAPp/XKpWKdF1X2LYdlMvlsToC/QYTls7DLFr/PAAAAABJRU5ErkJggg%3D%3D";
i.onload=function(){o=T5.XY.init(i.width>>1,i.height>>1)};var c=COG.extend(new T5.ViewLayer(e),{pos:e.pos,accuracy:e.accuracy,drawAccuracyIndicator:false,draw:function(f,F){var J=p.x-F.x,da=p.y-F.y;if(a){f.fillStyle="rgba(30, 30, 30, 0.2)";f.beginPath();f.arc(J,da,a,0,Math.PI*2,false);f.fill()}i.complete&&i.width>0&&f.drawImage(i,J-o.x,da-o.y,i.width,i.height);c.changed()},update:function(f){if(f){a=f.getPixelDistance(c.accuracy)>>1;p=f.getGridXYForPosition(c.pos);c.changed()}}});c.bind("gridUpdate",
function(f,F){c.update(F)});return c};return{distanceToString:function(e){if(e>1E3)return~~(e/10)/100+" km";return e?e+" m":""},dist2rad:function(e){return e/6371},getEngine:b,lat2pix:m,lon2pix:h,pix2lat:d,pix2lon:g,radsPerPixel:function(e){return ra/(256<<e)},Position:la,BoundingBox:eb,Radius:function(e,i){return{distance:parseInt(e,10),uom:i}},Address:function(e){return e=COG.extend({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},e)},A:fb,GeocodeFieldWeights:{streetDetails:50,
location:50},AddressCompareFns:{},Engine:function(e){if(!e.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var i=COG.extend({remove:function(){delete na[i.id]}},e);return na[i.id]=i},Search:Na,GeoSearchResult:Ea,LocationSearch:function(e){function i(f,F){navigator.geolocation.clearWatch(p);p=0;if(a){clearTimeout(a);a=0}F&&F([f],e)}function o(f){COG.info("caught location tracking error:",f)}e=COG.extend({name:"Geolocation Search",requiredAccuracy:null,searchTimeout:5E3,
watch:false},e);var p=0,a=0,c=null;return new T5.Geo.GeoSearchAgent(COG.extend({execute:function(f,F){if(navigator.geolocation&&!p){p=navigator.geolocation.watchPosition(function(J){var da=la.init(J.coords.latitude,J.coords.longitude);J=new Ea({id:1,caption:"Current Location",pos:da,accuracy:J.coords.accuracy/1E3,matchWeight:100});if(!c||J.accuracy<c.accuracy)c=J;if(!e.requiredAccuracy||c.accuracy<e.requiredAccuracy)i(c,F)},o,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3});if(e.searchTimeout)a=
setTimeout(function(){c&&i(c,F)},e.searchTimeout)}}},e))},Routing:Ya}}()})(T5);
