T5.OSM=function(){var r=Math.PI/180,x=180/Math.PI,p=function(b){b=T5.ex({flipY:false,tileSize:256,tilePath:"{0}/{1}/{2}.png",osmDataAck:true},b);var f=null,q=[],s,y=T5.formatter(b.tilePath),o={buildTileUrl:function(c,a,m,g,h){if(a>=0&&a<g){c=(c%g+g)%g;a=y(m,c,h?Math.abs(a-g+1):a);if(f)a=s(q[c%(q.length||1)])+a;return a}},run:function(c,a,m,g){if(c=c.getZoomLevel?c.getZoomLevel():0){var h=2<<c-1,d=b.tileSize,j=Math.PI*2/(d<<c),t=(a.w/d|0)+1,u=(a.h/d|0)+1;a=T5.GeoXY.toPos(T5.XY.init(a.x,a.y),j);var e=
a.lat;a=T5.XY.init((a.lon+180)/360*h|0,(1-Math.log(Math.tan(e*r)+1/Math.cos(e*r))/Math.PI)/2*h%h|0);e=Math.PI-2*Math.PI*a.y/h;var n=a.x/h*360-180;e=new T5.Pos(x*Math.atan(0.5*(Math.exp(e)-Math.exp(-e))),n);j=T5.GeoXY.init(e,j);e=b.flipY;var k=m.search({x:j.x,y:j.y,w:t*d,h:u*d});n={};var i;for(i=k.length;i--;)n[k[i].id]=true;q=(f=o.getServerDetails?o.getServerDetails():null)&&f.subDomains?f.subDomains:[];s=T5.formatter(f?f.baseUrl:"");for(k=0;k<=t;k++)for(i=0;i<=u;i++){var l=a.x+k,v=a.y+i,w=l+"_"+
v;if(!n[w]){tileUrl=o.buildTileUrl(l,v,c,h,e);l=new T5.Tile(j.x+k*d,j.y+i*d,tileUrl,d,d,w);m.insert(l,l)}}g&&g()}}};b.osmDataAck&&T5.userMessage("ack","osm",'Map data (c) <a href="http://openstreetmap.org/" target="_blank">OpenStreetMap</a> (and) contributors, CC-BY-SA');return o};T5.Generator.register("osm.mapbox",function(b){b=T5.ex({style:"world-light",version:"1.0.0",flipY:true},b);var f=T5.formatter("http://{2}.tile.mapbox.com/{0}/{1}/");T5.userMessage("ack","osm.mapbox",'Tiles Courtesy of <a href="http://mapbox.com/" target="_blank">MapBox</a>');
return T5.ex(new p(b),{getServerDetails:function(){return{baseUrl:f(b.version,b.style,"{0}"),subDomains:["a","b","c","d"]}}})});T5.Generator.register("osm.mapquest",function(b){T5.userMessage("ack","osm.mapquest",'Tiles Courtesy of <a href="http://open.mapquest.co.uk/" target="_blank">MapQuest</a>');return T5.ex(new p(b),{getServerDetails:function(){return{baseUrl:"http://otile{0}.mqcdn.com/tiles/1.0.0/osm/",subDomains:["1","2","3","4"]}}})});T5.Generator.register("osm.local",p);return{Generator:p}}();
