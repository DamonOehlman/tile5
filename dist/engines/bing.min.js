T5.Geo.Bing=function(){function m(a,c,b){_log("attempting authentication, apikey = "+a+", style = "+c);if(i[c])b&&b();else _jsonp(n(c,a),function(d){var g=d.resourceSets[0].resources[0];i[c]=g.imageUrl;l=g.imageUrlSubdomains;o=d.brandLogoUri;T5.userMessage("ack","bing",d.copyright);b&&b()},"jsonp")}var i={},o,l=[],n=_formatter("http://dev.virtualearth.net/REST/V1/Imagery/Metadata/{0}?key={1}");T5.Registry.register("generator","bing",function(a){a=_extend({apikey:null,style:"Road",osmDataAck:false},
a);var c="",b=0,d=new T5.Geo.OSM.Generator(a),g=d.run;return _extend(d,{buildTileUrl:function(e,j,f){for(var h="",k=1;k<=f;k++)h+=(j>>f-k&1)<<1|e>>f-k&1;e=h;b=b?b%l.length+1:0;return c.replace("{quadkey}",e).replace("{culture}","").replace("{subdomain}",l[b])},run:function(e,j,f,h){i[a.style]?g(e,j,f,h):m(a.apikey,a.style,function(){c=i[a.style];g(e,j,f,h)})}})})}();
