COG=typeof COG!=="undefined"?COG:{};COG.extend=function(){for(var r=arguments[0]||{},s,v=1,q=arguments.length;v<q;v++)if((s=arguments[v])!==null)for(var f in s){var e=s[f];if(r!==e)if(e!==undefined)r[f]=e}return r};
(function(){var r=/^P(\d+Y)?(\d+M)?(\d+D)?$/,s=/^(\d+H)?(\d+M)?(\d+S)?$/,v={8601:function(f){f=f.split("T");var e=null;e=null;var n=0,o=0;r.lastIndex=-1;e=r.exec(f[0]);n+=e[3]?parseInt(e[3].slice(0,-1),10):0;s.lastIndex=-1;e=s.exec(f[1]);o+=e[1]?parseInt(e[1].slice(0,-1),10)*3600:0;o+=e[2]?parseInt(e[2].slice(0,-1),10)*60:0;o+=e[3]?parseInt(e[3].slice(0,-1),10):0;return new q(n,o)}},q=COG.Duration=function(f,e){return{days:f?f:0,seconds:e?e:0}};COG.addDuration=function(){for(var f=new q,e=arguments.length;e--;){f.days+=
arguments[e].days;f.seconds+=arguments[e].seconds}if(f.seconds>=86400){f.days+=~~(f.seconds/86400);f.seconds%=86400}return f};COG.formatDuration=function(f){var e,n,o="";if(f.days)o=f.days+" days ";if(f.seconds){f=f.seconds;if(f>=3600){e=~~(f/3600);f-=e*3600}if(f>=60){n=Math.round(f/60);f-=n*60}if(e)o=o+e+(e>1?" hrs ":" hr ")+(n?(n>10?n:"0"+n)+" min ":"");else if(n)o=o+n+" min";else if(f>0)o=o+(f>10?f:"0"+f)+" sec"}return o};COG.parseDuration=function(f,e){var n=e?v[e]:null;if(n)return n(f);COG.Log.warn("Could not find duration parser for specified format: "+
e);return new q}})();
T5.Decarta=function(){function r(b){return COG.formatStr("<xls:XLS version='1' xls:lang='en' xmlns:xls='http://www.opengis.net/xls' rel='{4}' xmlns:gml='http://www.opengis.net/gml'><xls:RequestHeader clientName='{0}' clientPassword='{1}' sessionID='{2}' configuration='{3}' />{5}</xls:XLS>",e.clientName,e.clientPassword,e.sessionID,e.configuration,e.release,b)}function s(b,d){return COG.formatStr("<xls:Request maximumResponses='{0}' version='{1}' requestID='{2}' methodName='{3}Request'>{4}</xls:Request>",b.maxResponses,
b.version,b.requestID,b.methodName,d)}function v(b,d){e.server||COG.warn("No server configured for deCarta - we are going to have issues");return COG.formatStr("{0}/JSON?reqID={1}&chunkNo=1&numChunks=1&data={2}&responseFormat=JSON",e.server,b.requestID,escape(d))}function q(b,d){COG.jsonp(v(b,r(s(b,b.getRequestBody()))),function(c){var a=c.response.XLS.Response;if(a.numberOfResponses>0&&a[b.methodName+"Response"]){c=null;if(b.parseResponse)c=b.parseResponse(a[b.methodName+"Response"]);d&&d(c)}else COG.error("no responses from server: "+
c.response)})}function f(b,d){var c=new C({json:b.StreetAddress}),a=new D({countryCode:b.countryCode});a.parse(b.Place);return new T5.Geo.Address({streetDetails:c,location:a,country:b.countryCode?b.countryCode:"",postalCode:b.PostalCode?b.PostalCode:"",pos:d})}var e={sessionID:T5.ticks(),server:"",clientName:"",clientPassword:"",configuration:"",maxResponses:25,release:"4.4.2sp03",tileFormat:"PNG",fixedGrid:true,useCache:true,tileHosts:[],requestTimeout:3E4,geocoding:{countryCode:"US",language:"EN"}},
n={DEFAULT:function(b){for(var d=["landmark","municipalitySubdivision","municipality","countrySubdivision"],c="",a=0;a<d.length;a++)if(b[d[a]])c+=b[d[a]]+" ";return c}},o=1,D=function(b){b=COG.extend({landmark:"",municipality:"",municipalitySubdivision:"",countrySubdivision:"",countryCode:""},b);var d=COG.extend({calcMatchPercentage:function(c){var a=0;if(b.landmark&&b.landmarkSubType){if(COG.wordExists(c,b.landmarkSubType)){a+=0.4;a+=COG.wordExists(c,b.landmark)?0.6:0}}else{a+=COG.wordExists(c,b.municipalitySubdivision)?
0.8:0;if(a===0&&b.municipality)a+=COG.wordExists(c,b.municipality)?0.7:0}if(b.countrySubdivision)a+=COG.wordExists(c,b.countrySubdivision)?0.2:0;return a},getCountryCode:function(){if(b.countryCode)return b.countryCode.toUpperCase();return""},parse:function(c){for(var a=0;c&&a<c.length;a++){var g=c[a].type?c[a].type.slice(0,1).toLowerCase()+c[a].type.slice(1):"";if(typeof b[g]!=="undefined"){b[g]=c[a].content;if(c[a].subType)b[g+"SubType"]=c[a].subType}}COG.extend(d,b)},toString:function(){var c=
n[d.getCountryCode()];if(!c)c=n.DEFAULT;return c(b)}},b);return d},C=function(b){b=COG.extend({json:{}},b);var d="",c="";if(b.json.Street)d=b.json.Street.content?b.json.Street.content:b.json.Street;d=d&&d.replace?d.replace(/\/\d+$/,""):"";if(b.json.Building)if(b.json.Building.number)c=b.json.Building.number;return{building:c,street:d,calcMatchPercentage:function(a){var g=0,h=T5.Geo.A.normalize(a),j=T5.Geo.A.normalize(d);if(b.json.Building)if(T5.Geo.A.buildingMatch(a,b.json.Building.number.toString()))g+=
0.2;if(h&&j&&COG.wordExists(h,j))g+=0.8;return g},toString:function(){if(d)return(c?c+" ":"")+d;return""}}},y=function(){return{methodName:"",maxResponses:25,version:"1.0",requestID:o++,getRequestBody:function(){return""},parseResponse:function(b){return b}}},E=function(){return COG.extend(new y,{methodName:"RUOK",parseResponse:function(b){return{aliasCount:b.maxHostAliases,host:b.hostName}}})};T5.Generator.register("decarta",function(b){function d(g,h,j,m){if(g=g.getZoomLevel?g.getZoomLevel():0){var l=
2<<g-1,k=l>>1,i=b.tileSize,p=(h.w/i|0)+1,w=(h.h/i|0)+1,z=(h.x/i|0)-k;h=l-(h.y/i|0)-k-w;var t=j.search({x:(k+z)*i,y:(k+h*-1-w)*i,w:p*i,h:w*i});l={};var u;for(u=t.length;u--;)l[t[u].id]=true;for(t=0;t<=p;t++)for(u=0;u<=w;u++){var x=z+t,A=h+u-1,B=x+"_"+A;if(!l[B]){x=new T5.Tile((k+z+t)*i,(k+h*-1-u)*i,a[t%a.length]+"/openls/image-cache/TILE?LLMIN=0.0,0.0&LLMAX="+c[g]+"&CACHEABLE=true&DS=navteq-world&WIDTH=256&HEIGHT=256&CLIENTNAME="+e.clientName+"&SESSIONID="+e.sessionID+"&FORMAT=PNG&CONFIG="+e.configuration+
"&N="+A+"&E="+x,i,i,B);j.insert(x,x)}}m&&m()}}b=COG.extend({tileSize:256},b);var c=["89.787438015348100000,360.00000000000000000","85.084059050110410000,180.00000000000000000","66.653475896509040000,90.00000000000000000","41.170427238429790000,45.000000000000000000","22.076741328793200000,22.500000000000000000","11.251819676168665000,11.250000000000000000","5.653589942659626000,5.625000000000000000","2.830287664051185000,2.812500000000000000","1.415581451872543800,1.406250000000000000","0.707845460801532700,0.703125000000000000",
"0.353929573271679340,0.351562500000000000","0.176965641673330230,0.175781250000000000","0.088482927761462040,0.087890625000000000","0.044241477246363230,0.043945312500000000","0.022120740293895182,0.021972656250000000","0.011060370355776452,0.010986328125000000","0.005530185203987857,0.005493164062500000","0.002765092605263539,0.002746582031250000","0.001382546303032519,0.001373291015625000","0.000691272945568983,0.000686645507812500","0.000345636472797214,0.000343322753906250"],a=null;T5.userMessage("ack",
"decarta","&copy; deCarta, Inc. Map and Imagery Data &copy; NAVTEQ or Tele Atlas or DigitalGlobe");return{run:function(g,h,j,m){a?d(g,h,j,m):q(new E,function(l){a=[];if(l.aliasCount)for(var k=0;k<l.aliasCount;k++)a[k]="http://"+l.host.replace("^(.*?).(.*)$","\u0001-0"+(k+1)+".\u0002");else a=["http://"+l.host];d(g,h,j,m)})}}});T5.Service.register("geocoder",function(){var b=function(c){function a(h){var j=[],m=h?h.numberOfGeocodedAddresses:0,l=[];if(m>1)l=h.GeocodedAddress;else if(m==1)l=[h.GeocodedAddress];
try{for(h=0;l&&h<l.length;h++){var k,i=l[h],p=m=null;if(i&&i.GeocodeMatchCode&&i.GeocodeMatchCode.matchType!=="NO_MATCH"){if(i&&i.Point)p=new T5.Pos(i.Point.pos);if(i&&i.Address)m=f(i.Address,p)}(k=m)&&j.push(k)}}catch(w){COG.exception(w)}return j}c=COG.extend({addresses:[],parserReport:false,parseOnly:false,returnSpatialKeys:false},c);var g=new y;return COG.extend({},g,{methodName:"Geocode",getRequestBody:function(){for(var h=COG.formatStr('<xls:GeocodeRequest parserReport="{0}" parseOnly="{1}" returnSpatialKeys="{2}">',
c.parserReport,c.parseOnly,c.returnSpatialKeys),j=0;j<c.addresses.length;j++)h+=c.addresses[j].getXML();return h+"</xls:GeocodeRequest>"},parseResponse:function(h){if(c.addresses.length===1)return[a(h.GeocodeResponseList)];else{for(var j=[],m=0;m<c.addresses.length;m++)j.push(a(h.GeocodeResponseList[m]));return j}}})},d=function(c){c=COG.extend({position:null,geocodePreference:"StreetAddress"},c);return COG.extend(new y,{methodName:"ReverseGeocode",getRequestBody:function(){return"<xls:ReverseGeocodeRequest><xls:Position><gml:Point><gml:pos>"+
c.position.toString()+"</gml:pos></gml:Point></xls:Position><xls:ReverseGeocodePreference>"+c.geocodePreference+"</xls:ReverseGeocodePreference></xls:ReverseGeocodeRequest>"},parseResponse:function(a){var g=null;if(a&&a.Point)g=new T5.Pos(match.Point.pos);if(a&&a.ReverseGeocodedLocation&&a.ReverseGeocodedLocation.Address)return f(a.ReverseGeocodedLocation.Address,g);return null}})};return{forward:function(c){c=COG.extend({addresses:[],complete:null},c);var a,g=[];if(c.addresses&&!COG.isArray(c.addresses))c.addresses=
[c.addresses];for(a=0;a<c.addresses.length;a++)COG.isPlainObject(c.addresses[a])?COG.warn("attempting to geocode a simple object - not implemented"):g.push(new types.Address({freeform:c.addresses[a]}));if(g.length>0){g=new b({addresses:g});q(g,function(h){if(c.complete)for(a=0;a<h.length;a++)c.complete(c.addresses[a],h[a])})}},reverse:function(c){c=COG.extend({position:null,complete:null},c);if(!c.position)throw Error("Cannot reverse geocode without a position");var a=new d(c);q(a,function(g){c.complete&&
c.complete(g)})}}});T5.Service.register("routing",function(){var b=function(d){d=COG.extend({waypoints:[],provideRouteHandle:false,distanceUnit:"KM",routeQueryType:"RMAN",routePreference:"Fastest",routeInstructions:true,routeGeometry:true},d);var c=new y;return COG.extend({},c,{methodName:"DetermineRoute",getRequestBody:function(){if(d.waypoints.length<2)throw Error("Cannot send RouteRequest, less than 2 waypoints specified");var a=COG.formatStr('<xls:DetermineRouteRequest provideRouteHandle="{0}" distanceUnit="{1}" routeQueryType="{2}">',
d.provideRouteHandle,d.distanceUnit,d.routeQueryType);a+="<xls:RoutePlan>";a+="<xls:RoutePreference>"+d.routePreference+"</xls:RoutePreference>";a+="<xls:WayPointList>";for(var g=0;g<d.waypoints.length;g++)a+=COG.formatStr("<xls:{0}><xls:Position><gml:Point><gml:pos>{1}</gml:pos></gml:Point></xls:Position></xls:{0}>",g===0?"StartPoint":g===d.waypoints.length-1?"EndPoint":"ViaPoint",d.waypoints[g].toString());a+="</xls:WayPointList>";a+="</xls:RoutePlan>";if(d.routeInstructions)a+='<xls:RouteInstructionsRequest rules="maneuver-rules" providePoint="true" />';
if(d.routeGeometry)a+="<xls:RouteGeometryRequest />";a+="</xls:DetermineRouteRequest>";return a},parseResponse:function(a){var g=T5.RouteTools.RouteData,h=T5.Geo.Position.parseArray(a.RouteGeometry.LineString.pos),j=a.RouteInstructionsList;a=[];j=j&&j.RouteInstruction?j.RouteInstruction:[];for(var m=0,l=new COG.Duration,k=0;k<j.length;k++){var i;i=j[k].distance;var p={M:1,KM:1E3}[i.uom?i.uom.toUpperCase():"M"];i=i.value&&p?i.value*p:0;p=COG.parseDuration(j[k].duration,"8601");m+=i;l=COG.addDuration(l,
p);a.push(new T5.RouteTools.Instruction({position:new T5.Pos(j[k].Point),description:j[k].Instruction,distance:i,distanceTotal:m,time:p,timeTotal:l}))}return new g({geometry:h,instructions:a})}})};return{calculate:function(d,c){d=COG.extend({waypoints:[]},d);if(typeof T5.RouteTools!=="undefined"){var a=new b(d);q(a,function(g){c&&c(g)})}else COG.warn("Could not generate route, T5.RouteTools plugin not found")}}});return{applyConfig:function(b){COG.extend(e,b)},compareFns:function(){return{streetDetails:function(b,
d){return d.calcMatchPercentage(b)},location:function(b,d){return d.calcMatchPercentage(b)}}}()}}();
