if(!this.JSON)this.JSON={};
(function(){function o(b){return b<10?"0"+b:b}function n(b){h.lastIndex=0;return h.test(b)?'"'+b.replace(h,function(f){var j=g[f];return typeof j==="string"?j:"\\u"+("0000"+f.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+b+'"'}function e(b,f){var j,k,l,p,r=a,m,q=f[b];if(q&&typeof q==="object"&&typeof q.toJSON==="function")q=q.toJSON(b);if(typeof i==="function")q=i.call(f,b,q);switch(typeof q){case "string":return n(q);case "number":return isFinite(q)?String(q):"null";case "boolean":case "null":return String(q);
case "object":if(!q)return"null";a+=d;m=[];if(Object.prototype.toString.apply(q)==="[object Array]"){p=q.length;for(j=0;j<p;j+=1)m[j]=e(j,q)||"null";l=m.length===0?"[]":a?"[\n"+a+m.join(",\n"+a)+"\n"+r+"]":"["+m.join(",")+"]";a=r;return l}if(i&&typeof i==="object"){p=i.length;for(j=0;j<p;j+=1){k=i[j];if(typeof k==="string")if(l=e(k,q))m.push(n(k)+(a?": ":":")+l)}}else for(k in q)if(Object.hasOwnProperty.call(q,k))if(l=e(k,q))m.push(n(k)+(a?": ":":")+l);l=m.length===0?"{}":a?"{\n"+a+m.join(",\n"+a)+
"\n"+r+"}":"{"+m.join(",")+"}";a=r;return l}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+o(this.getUTCMonth()+1)+"-"+o(this.getUTCDate())+"T"+o(this.getUTCHours())+":"+o(this.getUTCMinutes())+":"+o(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var c=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
h=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,a,d,g={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},i;if(typeof JSON.stringify!=="function")JSON.stringify=function(b,f,j){var k;d=a="";if(typeof j==="number")for(k=0;k<j;k+=1)d+=" ";else if(typeof j==="string")d=j;if((i=f)&&typeof f!=="function"&&(typeof f!=="object"||typeof f.length!=="number"))throw Error("JSON.stringify");return e("",
{"":b})};if(typeof JSON.parse!=="function")JSON.parse=function(b,f){function j(l,p){var r,m,q=l[p];if(q&&typeof q==="object")for(r in q)if(Object.hasOwnProperty.call(q,r)){m=j(q,r);if(m!==undefined)q[r]=m;else delete q[r]}return f.call(l,p,q)}var k;b=String(b);c.lastIndex=0;if(c.test(b))b=b.replace(c,function(l){return"\\u"+("0000"+l.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(b.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){k=eval("("+b+")");return typeof f==="function"?j({"":k},""):k}throw new SyntaxError("JSON.parse");}})();if(!String.format)String.format=function(o){if(arguments.length<=1)return o;for(var n=arguments.length-2,e=0;e<=n;e++)o=o.replace(RegExp("\\{"+e+"\\}","gi"),arguments[e+1]);return o};
String.prototype.containsWord=function(o){var n="";if(o.toString)o=o.toString();for(var e=0;e<o.length;e++)n+=!/\w/.test(o[e])?"\\"+o[e]:o[e];return RegExp("(^|\\s|\\,)"+n+"(\\,|\\s|$)","i").test(this)};Number.prototype.toRad=function(){return this*Math.PI/180};Number.prototype.sec=function(){return 1/Math.cos(this)};
GRUNT=function(){var o=Object.prototype.hasOwnProperty,n=0,e={id:"GRUNT.core",extend:function(){var c=arguments[0]||{},h=1,a=arguments.length,d=false,g,i,b,f;if(typeof c==="boolean"){d=c;c=arguments[1]||{};h=2}if(typeof c!=="object"&&!e.isFunction(c))c={};if(a===h){c=this;--h}for(;h<a;h++)if((g=arguments[h])!=null)for(i in g){b=c[i];f=g[i];if(c!==f)if(d&&f&&(e.isPlainObject(f)||e.isArray(f))){b=b&&(e.isPlainObject(b)||e.isArray(b))?b:e.isArray(f)?[]:{};c[i]=e.extend(d,b,f)}else if(f!==undefined)c[i]=
f}return c},isFunction:function(c){return toString.call(c)==="[object Function]"},isArray:function(c){return toString.call(c)==="[object Array]"},isPlainObject:function(c){if(!c||toString.call(c)!=="[object Object]"||c.nodeType||c.setInterval)return false;if(c.constructor&&!o.call(c,"constructor")&&!o.call(c.constructor.prototype,"isPrototypeOf"))return false;var h;for(h in c);return h===undefined||o.call(c,h)},isEmptyObject:function(c){for(var h in c)return false;return true},isXmlDocument:function(c){return toString.call(c)===
"[object Document]"},contains:function(c,h){var a=c,d=arguments,g=1;if(h&&e.isArray(h)){d=h;g=0}for(g=g;g<d;g++)a=a&&typeof foo[d[g]]!=="undefined";return a},newModule:function(c){c=e.extend({id:null,requires:[],parent:null},c);if(c.parent)c=e.extend({},c.parent,c);return c},toID:function(c){return c.replace(/\s/g,"-")},generateObjectID:function(c){return(c?c:"obj")+n++}};return e}();
GRUNT.Log=function(){function o(a,d){var g,i=d&&d.length>0?d[0]:"";for(g=1;d&&g<d.length;g++)i+=" "+(e&&GRUNT.isPlainObject(d[g])?JSON.stringify(d[g]):d[g]);typeof console!=="undefined"&&console[a](i);for(g=0;g<n.length;g++)n[g].call(h,i,a)}var n=[],e=typeof JSON!=="undefined",c=window.console&&window.console.markTimeline,h={id:"GRUNT.log",getTraceTicks:function(){return c?(new Date).getTime():null},trace:function(a,d){if(c)console.markTimeline(a+(d?": "+(h.getTraceTicks()-d)+"ms":""))},debug:function(){o("debug",
arguments)},info:function(){o("info",arguments)},warn:function(){o("warn",arguments)},error:function(){o("error",arguments)},exception:function(a){h.error(arguments);for(var d in a)h.info("ERROR DETAIL: "+d+": "+a[d])},watch:function(a,d){try{d()}catch(g){h.exception(g,a)}},throwError:function(a){h.error(a);throw Error(a);},requestUpdates:function(a){n.push(a)}};return h}();
GRUNT.Data=function(){var o={determineObjectMapping:function(e){if(!e)return null;e=e.split("|");for(var c={},h=0;h<e.length;h++)c[e[h]]=h;return c},mapLineToObject:function(e,c){var h=e.split("|"),a={};for(var d in c){var g=c[d];a[d]=h.length>g?h[g]:null}return a},parse:function(e){var c=null,h=[];e=e.split("\n");for(var a=0;a<e.length;a++){var d=e[a];if(c)h.push(o.mapLineToObject(d,c));else c=o.determineObjectMapping(d)}return h}},n={supportedFormats:{JSON:{parse:function(e){return JSON.parse(e)}},
PDON:{parse:function(e){return o.parse(e)}}},parse:function(e){e=GRUNT.extend({data:"",format:"JSON"},e);if(!n.supportedFormats[e.format])throw Error("Unsupported data format: "+e.format+", cannot parse data in javascript object");try{return n.supportedFormats[e.format].parse(e.data)}catch(c){GRUNT.Log.error("ERROR PARSING DATA FROM FORMAT: "+e.format,e.data);GRUNT.Log.exception(c)}return{}}};return n}();
GRUNT.Template=function(){var o=/\$\{(.*?)\}/ig;return{parse:function(n,e){for(var c=n,h=o.exec(c);h;){c=c.replace(h[0],GRUNT.XPath.first(h[1],e));o.lastIndex=0;h=o.exec(c)}return c}}}();
GRUNT.JSONP=function(){function o(h){var a=document.createElement("script"),d=false;a.src=h;a.async=true;a.onload=a.onreadystatechange=function(){if(!d&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){d=true;a.onload=a.onreadystatechange=null;a&&a.parentNode&&a.parentNode.removeChild(a)}};e||(e=document.getElementsByTagName("head")[0]);e.appendChild(a)}var n=0,e,c=this;return{get:function(h,a){h+=h.indexOf("?")>=0?"&":"?";var d="json"+ ++n;c[d]=function(g){a(g);c[d]=
null;try{delete c[d]}catch(i){}};o(h+"callback="+d);return d}}}();
GRUNT.XHR=function(){var o={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},n={JSON:["json"],PDON:["pdon.txt"]},e=["TEXT","STREAM"],c=/^(\w+:)?\/\/([^\/?#]+)/,h={XML:function(g){return g.responseXML},JSON:function(g){try{return JSON.parse(g.responseText)}catch(i){GRUNT.Log.error("Error parsing JSON data: ",g.responseText);GRUNT.Log.exception(i)}return""},PDON:function(g){return GRUNT.Data.parse({data:g.responseText,format:"PDON"})},DEFAULT:function(g){return g.responseText}},
a={CONTENT_TYPE:"Content-Type"},d=GRUNT.newModule({id:"GRUNT.xhr",ajaxSettings:{xhr:null},ajax:function(g){try{g=GRUNT.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},d.ajaxSettings,g);var i=c.exec(g.url),b=i&&(i[1]&&i[1]!==location.protocol||i[2]!==location.host);if(g.data)g.method="POST";if(g.url){i=null;if(g.xhr)i=g.xhr(g);i||(i=new XMLHttpRequest);i.open(g.method,g.url,g.async);g.data&&i.setRequestHeader("Content-Type",
g.contentType);b||i.setRequestHeader("X-Requested-With","XMLHttpRequest");i.onreadystatechange=function(){if(this.readyState===4){var j=null,k=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(k)if(g.handleResponse)g.handleResponse(this);else{var l=g,p=this.getResponseHeader(a.CONTENT_TYPE),r,m=false;for(r in o)if(p&&p.indexOf(o[r])>=0){m=true;break}p=!m;for(m=0;m<e.length;m++)p=p||e[m]==r;if(p)b:{p=r;for(var q in n)for(m=
0;m<n[q].length;m++)if(RegExp(n[q][m]+"$","i").test(l.url)){r=q;break b}r=p?p:"DEFAULT"}try{j=h[r](this,l)}catch(s){GRUNT.Log.warn("error applying processor '"+r+"' to response type, falling back to default");j=h.DEFAULT(this,l)}}else g.error&&g.error(this)}catch(u){GRUNT.Log.exception(u,"PROCESSING AJAX RESPONSE")}k&&j&&g.success&&g.success.call(this,j)}};i.send(g.method=="POST"?d.param(g.data):null)}else GRUNT.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(f){GRUNT.Log.exception(f)}},
param:function(g){var i=[],b=function(j,k){k=GRUNT.isFunction(k)?k():k;i[i.length]=encodeURIComponent(j)+"="+encodeURIComponent(k)};if(GRUNT.isArray(g))for(var f=0;f<g.length;f++)b(g[f].name,g[f].value);else for(f in g)b(f,g[f]);return i.join("&").replace(/%20/g,"+")}});return d}();
GRUNT.XPath=function(){function o(h){for(var a=null,d=0;d<n.length;d++)if(a=n[d](h))break;return a}var n=[],e=[null,function(h){return h.numberValue},function(h){return h.stringValue},function(h){return h.booleanValue},null,null,null,null,function(h){return h.singleNodeValue?h.singleNodeValue.textContent:null},function(h){return h.singleNodeValue?h.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||GRUNT.Log.warn("No XPATH support, this is going to cause problems");var c={SearchResult:function(h){return{toString:function(){var a=
null;if(h){var d=null;if(h.resultType>=0&&h.resultType<e.length)d=e[h.resultType];if(d){GRUNT.Log.info("invoking match handler for result type: "+h.resultType);a=d(h)}}return a?a:""}}},first:function(h,a){var d=c.SearchResult,g;var i=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!i)i=XPathResult.ANY_TYPE;try{if(GRUNT.isXmlDocument(a))g=a.evaluate(h,a,o,i,null);else{GRUNT.Log.warn("attempted xpath expression: "+h+" on a non-xml document");g=null}}catch(b){GRUNT.Log.warn("attempted to run invalid xpath expression: "+
h+" on node: "+a);g=null}return new d(g)},registerResolver:function(h){n.push(h)}};return c}();GRUNT.WaterCooler=function(){var o={};return{listen:function(n,e){o[n]||(o[n]=[]);e&&o[n].push(e)},say:function(n,e){if(o[n])for(var c=0;c<o[n].length;c++)o[n][c](e)},leave:function(){}}}();
SLICK=function(){var o={copyRect:function(n){return n?new o.Rect(n.origin.x,n.origin.y,n.dimensions.width,n.dimensions.height):null},Settings:function(){var n={};return{get:function(e){return n[e]},set:function(e,c){n[e]=c},extend:function(e){GRUNT.extend(n,e)}}}(),Clock:function(){var n=null;return{getTime:function(e){return e&&n?n:n=(new Date).getTime()}}}(),Vector:function(n,e){return{x:n?n:0,y:e?e:0}},V:function(){return{create:function(n,e){return new o.Vector(n,e)},add:function(){for(var n=
new o.Vector,e=arguments.length;e--;){n.x+=arguments[e].x;n.y+=arguments[e].y}return n},absSize:function(n){return Math.max(Math.abs(n.x),Math.abs(n.y))},diff:function(n,e){return new o.Vector(n.x-e.x,n.y-e.y)},copy:function(n){return n?new o.Vector(n.x,n.y):null},invert:function(n){return new SLICK.Vector(-n.x,-n.y)},offset:function(n,e,c){return new SLICK.Vector(n.x+e,n.y+(c?c:e))}}}(),VectorArray:function(n,e){for(var c=Array(n.length),h=n.length;h--;)c[h]=e?o.V.copy(n[h]):n[h];return{applyOffset:function(a){for(var d=
c.length;d--;){c[d].x+=a.x;c[d].y+=a.y}},getRect:function(){return new SLICK.Rect(Math.min(c[0].x,c[1].x),Math.min(c[0].y,c[1].y),Math.abs(c[0].x-c[1].x),Math.abs(c[0].y-c[1].y))},toString:function(){for(var a="",d=c.length;d--;)a+="["+c[d].toString()+"] ";return a}}},VectorMath:function(){function n(e){if(!e||e.length<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var c={edges:Array(e.length-1),accrued:Array(e.length-1),total:0},h=SLICK.V.diff,a=0;a<e.length-
1;a++){var d=h(e[a],e[a+1]);c.edges[a]=Math.sqrt(d.x*d.x+d.y*d.y);c.accrued[a]=c.total+c.edges[a];c.total+=c.edges[a]}return c}return{edges:n,distance:function(e){return n(e).total},theta:function(e,c,h){h=Math.asin((e.y-c.y)/h);return e.x>c.x?h:Math.PI-h},pointOnEdge:function(e,c,h,a){c=new SLICK.Vector(Math.cos(h)*a,Math.sin(h)*a);return new SLICK.Vector(e.x-c.x,e.y-c.y)}}}(),Dimensions:function(n,e){var c=e?n/e:1,h={width:n,height:e,aspect_ratio:c,inv_aspect_ratio:1/c,getAspectRatio:function(){return h.height!==
0?h.width/h.height:1},getCenter:function(){return new SLICK.Vector(h.width>>1,h.height>>1)},grow:function(a,d){return new SLICK.Dimensions(h.width+a,h.height+d)},matches:function(a){return a&&h.width==a.width&&h.height==a.height},toString:function(){return h.width+" x "+h.height}};return h},Rect:function(n,e,c,h){var a={origin:new SLICK.Vector(n,e),dimensions:new SLICK.Dimensions(c,h),getCenter:function(){return new SLICK.Vector(a.origin.x+(a.dimensions.width>>1),a.origin.y+(a.dimensions.height>>
1))},getSize:function(){return Math.sqrt(Math.pow(a.dimensions.width,2)+Math.pow(a.dimensions.height,2))},grow:function(d,g){var i=new SLICK.Dimensions(d-a.dimensions.width,g-a.dimensions.height);a.dimensions.width=d;a.dimensions.height=g;return i},expand:function(d,g){a.origin.x-=d;a.origin.y-=g;a.dimensions.width+=d;a.dimensions.height+=g},offset:function(d){return new o.Rect(a.origin.x+d.x,a.origin.y+d.y,a.dimensions.width,a.dimensions.height)},getRequiredDelta:function(d,g){var i={top:0,left:0,
bottom:0,right:0};i.top=d.origin.y-a.origin.y+(g?g.y:0);i.left=d.origin.x-a.origin.x+(g?g.x:0);i.right=d.origin.x+d.dimensions.width-(a.origin.x+a.dimensions.width)-i.left;i.bottom=d.origin.y+d.dimensions.height-(a.origin.y+a.dimensions.height)-i.top;return i},applyDelta:function(d,g,i){if(!d||!GRUNT.contains(d,["top","left","bottom","right"]))throw Error("Invalid delta - cannot apply to SLICK.Rect");g||(g=1);a.origin.x+=d.left*g;a.origin.y+=d.top*g;a.dimensions.width+=d.right*g;a.dimensions.height+=
d.bottom*g;i&&a.constrainAspectRatio(i)},constrainAspectRatio:function(d){var g=0,i={top:0,left:0,bottom:0,right:0};if(a.dimensions.getAspectRatio()<d){g=Math.abs(a.dimensions.width-a.dimensions.height*d);i.left=-g;i.right=g}else{g=Math.abs(a.dimensions.height-a.dimensions.width/d);i.top=-g;i.bottom=g}a.applyDelta(i)},moveTo:function(d,g){var i=new SLICK.Vector(d-a.origin.x,g-a.origin.y);a.origin.x=d;a.origin.y=g;return i},toString:function(){return String.format("(origin: {0}, dimensions: {1})",
a.origin,a.dimensions)}};return a}};return o}();
SLICK.Device=function(){function o(){n={base:{name:"Unknown",eventTarget:document,supportsTouch:"createTouch"in document,imageCacheMaxSize:4096,getScaling:function(){return 1},maxImageLoads:4,requireFastDraw:false},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:true},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144},android:{name:"Android OS <= 2.1",regex:/android/i,eventTarget:document.body,
supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio}},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true}};e=[n.froyo,n.android,n.ipod,n.iphone,n.ipad]}var n=null,e=[],c=null;return{getConfig:function(){n||o();if(!c){GRUNT.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var h=0;h<e.length;h++){var a=e[h];if(a.regex&&a.regex.test(navigator.userAgent)){c=GRUNT.extend({},n.base,a);GRUNT.Log.info("PLATFORM DETECTED AS: "+
c.name);break}}if(!c){GRUNT.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");c=n.base}GRUNT.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return c}}}();
SLICK.Resources=function(){var o="",n={},e=function(){function h(){var m=i[this.id];if(m){m.loaded=true;m.hitCount=1;for(var q=j.length;q--;)if(j[q].image.src==this.src){j.splice(q,1);break}m.loadCallback&&m.loadCallback(this,false);k.push({url:this.src,created:m.requested});delete i[this.id];a()}}function a(){for(var m=SLICK.Device.getConfig().maxImageLoads;f.length>0&&(!m||j.length<m);){var q=f.shift();j.push(q);q.image.onload=h;q.image.src=q.url;q.requested=(new Date).getTime()}}function d(){p=
true;try{var m=Math.floor(k.length*0.5);if(m>0){k.sort(function(s,u){return s.created-u.created});for(var q=m;q--;)delete g[k[q].url];k.splice(0,m)}}finally{p=false}GRUNT.WaterCooler.say("imagecache.cleared")}var g={},i={},b=0,f=[],j=[],k=[],l=0,p=false,r={loadingImages:j,queuedImages:f,getCacheFullness:function(){return l},getImage:function(m){var q=null;p||(q=g[m]);return q?q.image:null},loadImage:function(m,q){var s=g[m];if(s){s.hitCount++;s.image.complete&&q&&q(s.image,true)}else{s={url:c.getPath(m),
image:new Image,loaded:false,created:(new Date).getTime(),requested:null,hitCount:0,loadCallback:q};s.image.id="resourceLoaderImage"+b++;g[m]=s;i[s.image.id]=s;f.push(s);a()}return s},resetLoadingQueue:function(){j=[]}};setInterval(function(){for(var m=(new Date).getTime(),q=false,s=0,u=SLICK.Device.getConfig();s<j.length;)if(m-j[s].requested>c.loadTimeout*1E3){j.splice(s,1);q=true}else s++;q&&a();if(u&&u.imageCacheMaxSize){l=k.length*c.avgImageSize/u.imageCacheMaxSize;l>=1&&d()}},1E3);return r}(),
c={avgImageSize:25,loadTimeout:10,Cache:function(){return{read:function(){return null},write:function(){},getUrlCacheKey:function(h,a){for(var d=(h?h.replace(/^.*\?/,""):"").split("&"),g=h?h.replace(/\?.*$/,"?"):"",i=0;i<d.length;i++){var b=d[i].split("=");if(!a||!a.test(b[0]))g+=d[i]+"&"}return g.replace(/\W/g,"")},isValidCacheKey:function(h){GRUNT.Log.info("cache key = "+h);return false}}}(),getCachedUrl:function(h){return h},getPath:function(h){return/^(https?|\/)/.test(h)?h:o+h},setBasePath:function(h){o=
h},getImage:function(h){return e.getImage(h)},loadImage:function(h,a){e.loadImage(h,a)},resetImageLoadQueue:function(){e.resetLoadingQueue()},getStats:function(){return{imageLoadingCount:e.loadingImages.length,queuedImageCount:e.queuedImages.length,imageCacheFullness:e.getCacheFullness()}},loadResource:function(h){h=GRUNT.extend({filename:"",cacheable:true,dataType:null,callback:null},h);var a=function(d){h.callback&&GRUNT.Log.watch("CALLING RESOURCE CALLBACK",function(){h.callback(d)})};h.cacheable&&
n[h.filename]?a(n[h.filename]):GRUNT.XHR.ajax({url:c.getPath(h.filename),dataType:h.dataType,success:function(d){if(h.cacheable)n[h.filename]=d;a(d)},error:function(d,g,i){GRUNT.Log.error("error loading resource ["+h.filename+"], error = "+i)}})},loadSnippet:function(h,a){/\.\w+$/.test(h)||(h+=".html");c.loadResource({filename:"snippets/"+h,callback:a,dataType:"html"})}};return c}();
SLICK.Touch=function(){function o(b,f){var j=b&&b.length>0?b[0]:null;if(j&&f&&f.length>0)return SLICK.V.diff(j,f[0]);return null}function n(b){b.preventDefault();b.stopPropagation()}function e(b){for(var f=Array(b.length),j=b.length;j--;)f[j]=new SLICK.Vector(b[j].pageX,b[j].pageY);return f}var c={TAP:0,MOVE:1,PINCHZOOM:2},h=7,a=0,d=0,g={TouchHelper:function(b){function f(t){t=new SLICK.VectorArray(t,true);b.element&&t.applyOffset(new SLICK.Vector(-b.element.offsetLeft,-b.element.offsetTop));return t}
function j(t){var A=Array(arguments.length-1),B=0;for(B=1;B<arguments.length;B++)A[B-1]=arguments[B];for(B=E.length;B--;)E[B][t]&&E[B][t].apply(M,A)}function k(t){if(t.target&&t.target===b.element){s=q?e(t.touches):[new SLICK.Vector(t.pageX,t.pageY)];x=new SLICK.Vector;y=new SLICK.Vector;D=true;r=false;q&&n(t);I.current=SLICK.Clock.getTime();if(t=s.length>0?s[0]:null){j("touchStartHandler",t.x,t.y);if(I.current-I.last<M.THRESHOLD_DOUBLETAP)if((t=u?SLICK.V.diff(s[0],u[0]):null)&&Math.abs(t.x)<b.maxDistDoubleTap&&
Math.abs(t.y)<b.maxDistDoubleTap)r=true;z=c.TAP;u=[].concat(s)}else GRUNT.Log.warn("Touch start fired, but no touch vector found")}}function l(t){if(t.target&&t.target===b.element)if(D)try{q&&n(t);var A=q?e(t.touches):[new SLICK.Vector(t.pageX,t.pageY)];t=0;if(A.length>1){if(s.length===1)s=[].concat(A);t=SLICK.VectorMath.distance(s)-SLICK.VectorMath.distance(u)}if(z===c.TAP){var B=o(A,s);if(B&&(Math.abs(B.x)>=h||Math.abs(B.y)>=h))z=c.MOVE}if(z!==c.TAP)if(!t||Math.abs(t)<b.pinchZoomThreshold){if(x=
o(A,u)){y.x+=x.x;y.y+=x.y;C.x+=x.x;C.y+=x.y}if(SLICK.V.absSize(C)>b.panEventThreshhold){j("moveHandler",C.x,C.y);C=SLICK.V.create()}z=c.MOVE}else{j("pinchZoomHandler",f(s),f(A));z=c.PINCHZOOM}u=[].concat(A)}catch(J){GRUNT.Log.exception(J)}}function p(t){if(t.target&&t.target===b.element)try{q&&n(t);SLICK.Clock.getTime();I.last=I.current;if(z===c.TAP)m||(m=setTimeout(function(){m=0;var B=r?"doubleTapHandler":"tapHandler",J=s[0],P=null;if(b.element)P=SLICK.V.offset(J,-b.element.offsetLeft,-b.element.offsetTop);
j(B,J,P)},M.THRESHOLD_DOUBLETAP+50));else if(z==c.MOVE)j("moveEndHandler",y.x,y.y);else z==c.PINCHZOOM&&j("pinchZoomEndHandler",f(s),f(u));D=false}catch(A){GRUNT.Log.exception(A)}}b=GRUNT.extend({element:null,inertiaTrigger:20,maxDistDoubleTap:20,panEventThreshhold:0,pinchZoomThreshold:5,touchStartHandler:null,moveHandler:null,moveEndHandler:null,pinchZoomHandler:null,pinchZoomEndHandler:null,tapHandler:null,doubleTapHandler:null,wheelZoomHandler:null},b);var r=false,m=0,q=SLICK.Device.getConfig().supportsTouch,
s=null,u=null,x=null,y=null,C=new SLICK.Vector,z=null,D=false,E=[],I={current:0,last:0},F=SLICK.Device.getConfig(),M={supportsTouch:q,THRESHOLD_DOUBLETAP:300,addListeners:function(t){E.push(t)},decoupleListeners:function(t){for(var A=0;t&&A<E.length;A++)if(E[A].listenerId===t){E.splice(A,1);GRUNT.Log.info("successfully decoupled touch listener: "+t);break}},release:function(){F.eventTarget.removeEventListener(F.supportsTouch?"touchstart":"mousedown",k,false);F.eventTarget.removeEventListener(F.supportsTouch?
"touchmove":"mousemove",l,false);F.eventTarget.removeEventListener(F.supportsTouch?"touchend":"mouseup",p,false)},wheelie:function(t){var A=new SLICK.Vector(t.wheelDeltaX,t.wheelDeltaY);t=new SLICK.Vector(t.clientX,t.clientY);var B=A.y!==0?Math.abs(A.y/120):0;if(B!==0)j("wheelZoomHandler",t,A.y>0?B+0.5:0.5/B);GRUNT.Log.info("capture mouse wheel event, delta = "+A+", position = "+t)}};F.eventTarget.addEventListener(F.supportsTouch?"touchstart":"mousedown",k,false);F.eventTarget.addEventListener(F.supportsTouch?
"touchmove":"mousemove",l,false);F.eventTarget.addEventListener(F.supportsTouch?"touchend":"mouseup",p,false);return M}},i=[];return{captureTouch:function(b,f){try{if(!b)throw Error("Unable to capture touch of null element");if(!b.id)b.id="touchable_"+a++;var j=i[b.id];if(!j){j=g.TouchHelper(GRUNT.extend({element:b},f));i[b.id]=j;GRUNT.Log.info("CREATED TOUCH HELPER. SUPPORTS TOUCH = "+j.supportsTouch)}f.listenerId&&j.decoupleListeners(f.listenerId);f.listenerId=++d;j.addListeners(f)}catch(k){GRUNT.Log.exception(k)}},
resetTouch:function(b){if(b&&b.id&&i[b.id]){i[b.id].release();delete i[b.id]}}}}();if(typeof jQuery!=="undefined"){jQuery.fn.canTouchThis=function(o){return this.each(function(){SLICK.Touch.captureTouch(this,o)})};jQuery.fn.untouchable=function(){return this.bind("touchmove",function(o){o.preventDefault()})}}
SLICK.Pannable=function(o){o=GRUNT.extend({container:null,onPan:null,onPanEnd:null,onAnimate:null,checkOffset:null},o);var n=false,e=new SLICK.Vector,c={pannable:true,getOffset:function(){return new SLICK.Vector(e.x,e.y)},setOffset:function(a,d){e.x=a;e.y=d},pan:function(a,d,g){if(g)c.updateOffset(e.x+a,e.y+d,g);else{c.updateOffset(e.x+a,e.y+d);o.onPan&&o.onPan(a,d)}},isAnimating:function(){return n},panEnd:function(a,d){o.onPanEnd&&o.onPanEnd(a,d)},updateOffset:function(a,d,g){if(g){a=new SLICK.Vector(a,
d);n=true;g=SLICK.Animation.tweenVector(e,a.x,a.y,g,function(){n=false;c.panEnd(0,0)});for(a=g.length;a--;){g[a].cancelOnInteract=true;g[a].requestUpdates(function(){o.onAnimate&&o.onAnimate(e.x,e.y)})}}else c.setOffset(a,d)}},h=document.getElementById(o.container);h&&SLICK.Touch.captureTouch(h,{moveHandler:function(a,d){c.pan(-a,-d)},moveEndHandler:function(a,d){c.panEnd(a,d)}});return c};
SLICK.Scalable=function(o){function n(k,l){c=k.getRect();h=l.getRect();var p=c.getSize(),r=h.getSize();b=h.getCenter();a=c&&p!==0?r/p:1}o=GRUNT.extend({container:null,onAnimate:null,onPinchZoom:null,onScale:null,scaleDamping:false},o);var e=false,c=null,h=null,a=1,d=null,g=null,i=null,b=null,f={scalable:true,animate:function(k,l,p,r,m){function q(){m&&m();e=false;o.onScale&&o.onScale(a,b);a=1;d=null}e=true;i=SLICK.V.copy(l);b=SLICK.V.copy(p);c=null;if(r){g=a;SLICK.Animation.tweenValue(0,k-g,r,q,1E3).requestUpdates(function(s){d=
s/(k-g);a=g+s;o.onAnimate&&o.onAnimate()})}else{a=k;q()}},getScaleInfo:function(){return{factor:a,startRect:SLICK.copyRect(c),endRect:SLICK.copyRect(h),start:i,center:b,progress:d}},getScaling:function(){return e},getScaleFactor:function(){return a}},j=document.getElementById(o.container);j&&SLICK.Touch.captureTouch(j,{pinchZoomHandler:function(k,l){n(k,l);(e=a!==1)&&o.onPinchZoom&&o.onPinchZoom(k,l)},pinchZoomEndHandler:function(k,l){n(k,l);e=false;o.onScale&&o.onScale(a,b,true);a=1},wheelZoomHandler:function(k){c=
h=null;b=SLICK.V.copy(k)}});return f};
SLICK.Dispatcher=function(){var o=[],n={execute:function(e){var c=n.findAction(e);GRUNT.Log.info("looking for action id: "+e+", found: "+c);if(c){var h=[].concat(arguments).slice(0,1);GRUNT.Log.watch("EXECUTING ACTION: "+e,function(){c.execute(h)})}},findAction:function(e){for(var c=o.length;c--;)if(o[c].id==e)return o[c];return null},getRegisteredActions:function(){return[].concat(o)},getRegisteredActionIds:function(){for(var e=[],c=o.length;c--;)o[c].id&&e.push(o[c].id);return e},registerAction:function(e){e&&
e.id&&o.push(e)},Action:function(e){e=GRUNT.extend({autoRegister:true,id:"",title:"",icon:"",execute:null},e);var c={id:e.id,execute:function(){e.execute&&e.execute.apply(this,arguments)},getParam:function(h){return e[h]?e[h]:""},toString:function(){return String.format("{0} [title = {1}, icon = {2}]",c.id,e.title,e.icon)}};e.autoRegister&&n.registerAction(c);return c},createAgent:function(e){e=GRUNT.extend({name:"Untitled",trashOrphanedResults:true,translator:null,execute:null},e);var c=null,h={getName:function(){return e.name},
getParam:function(a){return e[a]},getId:function(){return GRUNT.toID(h.getName())},run:function(a,d){if(e.execute){var g=c=SLICK.Clock.getTime(true),i=e.translator?e.translator(a):a;e.execute.call(h,i,function(b,f){if(!e.trashOrphanedResults||g==c)d&&d(b,f,i)})}}};return h},runAgents:function(e,c,h){for(var a=0;a<e.length;a++)e[a].run(c,h)}};return n}();
SLICK.Messaging=function(){var o=[],n=[],e=GRUNT.newModule({id:"slick.messaging",requires:["slick.core"],STATUS:{none:0,created:1,updated:2,handled:3},send:function(c){c=GRUNT.extend({type:"",payload:{},index:0,status:e.STATUS.created,statusChange:null},c);c.index=n.push(c)-1;c=c.index;var h=c>=0&&c<n.length?n[c]:null;GRUNT.Log.info("firing message update, index = "+c+", message = "+h);for(var a=0;h&&a<o.length&&h.status!==e.STATUS.handled;){var d=o[a].processUpdate(n[c]);if(d){d=d;o[a].getId();var g=
c>=0&&c<n.length?n[c]:null;if(g){g.status=d;g.statusChange&&g.statusChange(g)}}a++}},Handler:function(c){c=GRUNT.extend({id:"",processUpdate:null},c);var h={getId:function(){return c.id},processUpdate:function(a){if(c.processUpdate)return c.processUpdate(a);return e.STATUS.none}};o.push(h);return h}});return e}();
SLICK.Animation=function(){function o(){if(c===0)c=setInterval(function(){if(h.update(SLICK.Clock.getTime())===0){clearInterval(c);c=0}},20)}var n=[],e=false,c=0,h={DURATION:2E3,tweenValue:function(a,d,g,i,b){a=new h.Tween({startValue:a,endValue:d,tweenFn:g,complete:i,duration:b});n.push(a);return a},tween:function(a,d,g,i,b,f){a=new h.Tween({target:a,property:d,endValue:g,tweenFn:i,duration:f,complete:b});n.push(a);return a},tweenVector:function(a,d,g,i,b,f){var j=[];if(a){var k=a.x==d,l=a.y==g;
k||j.push(h.tween(a,"x",d,i,function(){(k=true)&&l&&b()},f));l||j.push(h.tween(a,"y",g,i,function(){l=true;k&&l&&b()},f))}return j},cancel:function(a){if(!e){e=true;try{for(var d=0;d<n.length;)if(!a||a(n[d])){GRUNT.Log.info("CANCELLING ANIMATION");n[d].triggerComplete(true);n.splice(d,1)}else d++}finally{e=false}}},isTweening:function(){return n.length>0},update:function(a){if(e)return n.length;e=true;try{for(var d=0;d<n.length;)if(n[d].isComplete()){n[d].triggerComplete(false);n.splice(d,1);GRUNT.WaterCooler.say("animation.complete")}else{n[d].update(a);
d++}}finally{e=false}return n.length},Tween:function(a){a=GRUNT.extend({target:null,property:null,startValue:0,endValue:null,duration:h.DURATION,tweenFn:h.DEFAULT,complete:null,cancelOnInteract:false},a);var d=SLICK.Clock.getTime(),g=[],i=false,b=0,f=0,j={cancelOnInteract:a.cancelOnInteract,isComplete:function(){return i},triggerComplete:function(k){a.complete&&a.complete(k)},update:function(k){try{var l=a.tweenFn(k-d,b,f,a.duration);if(a.target)a.target[a.property]=l;for(var p=g.length;p--;)g[p](l,
void 0);if(i=d+a.duration<=k){if(a.target)a.target[a.property]=a.tweenFn(a.duration,b,f,a.duration);for(var r=g.length;r--;)g[r](l,true)}}catch(m){GRUNT.Log.exception(m)}},requestUpdates:function(k){g.push(k)}};b=a.target&&a.property&&a.target[a.property]?a.target[a.property]:a.startValue;if(typeof a.endValue!=="undefined")f=a.endValue-b;if(f==0)i=true;o();return j},Easing:function(){var a=1.70158;return{Linear:function(d,g,i,b){return i*d/b+g},Back:{In:function(d,g,i,b){return i*(d/=b)*d*((a+1)*
d-a)+g},Out:function(d,g,i,b){return i*((d=d/b-1)*d*((a+1)*d+a)+1)+g},InOut:function(d,g,i,b){return(d/=b/2)<1?i/2*d*d*(((a*=1.525)+1)*d-a)+g:i/2*((d-=2)*d*(((a*=1.525)+1)*d+a)+2)+g}},Bounce:{In:function(d,g,i,b){return i-h.Easing.Bounce.Out(b-d,0,i,b)+g},Out:function(d,g,i,b){return(d/=b)<1/2.75?i*7.5625*d*d+g:d<2/2.75?i*(7.5625*(d-=1.5/2.75)*d+0.75)+g:d<2.5/2.75?i*(7.5625*(d-=2.25/2.75)*d+0.9375)+g:i*(7.5625*(d-=2.625/2.75)*d+0.984375)+g},InOut:function(d,g,i,b){return d<b/2?h.Easing.Bounce.In(d*
2,0,i,b)*0.5+g:h.Easing.Bounce.Out(d*2-b,0,i,b)*0.5+i*0.5+g}},Cubic:{In:function(d,g,i,b){return i*(d/=b)*d*d+g},Out:function(d,g,i,b){return i*((d=d/b-1)*d*d+1)+g},InOut:function(d,g,i,b){if((d/=b/2)<1)return i/2*d*d*d+g;return i/2*((d-=2)*d*d+2)+g}},Elastic:{In:function(d,g,i,b,f,j){if(d==0)return g;if((d/=b)==1)return g+i;j||(j=b*0.3);if(!f||f<Math.abs(i)){f=i;i=j/4}else i=j/(2*Math.PI)*Math.asin(i/f);return-(f*Math.pow(2,10*(d-=1))*Math.sin((d*b-i)*2*Math.PI/j))+g},Out:function(d,g,i,b,f,j){var k;
if(d==0)return g;if((d/=b)==1)return g+i;j||(j=b*0.3);if(!f||f<Math.abs(i)){f=i;k=j/4}else k=j/(2*Math.PI)*Math.asin(i/f);return f*Math.pow(2,-10*d)*Math.sin((d*b-k)*2*Math.PI/j)+i+g},InOut:function(d,g,i,b,f,j){var k;if(d==0)return g;if((d/=b/2)==2)return g+i;j||(j=b*0.3*1.5);if(!f||f<Math.abs(i)){f=i;k=j/4}else k=j/(2*Math.PI)*Math.asin(i/f);if(d<1)return-0.5*f*Math.pow(2,10*(d-=1))*Math.sin((d*b-k)*2*Math.PI/j)+g;return f*Math.pow(2,-10*(d-=1))*Math.sin((d*b-k)*2*Math.PI/j)*0.5+i+g}},Quad:{In:function(d,
g,i,b){return i*(d/=b)*d+g},Out:function(d,g,i,b){return-i*(d/=b)*(d-2)+g},InOut:function(d,g,i,b){if((d/=b/2)<1)return i/2*d*d+g;return-i/2*(--d*(d-2)-1)+g}},Sine:{In:function(d,g,i,b){return-i*Math.cos(d/b*(Math.PI/2))+i+g},Out:function(d,g,i,b){return i*Math.sin(d/b*(Math.PI/2))+g},InOut:function(d,g,i,b){return-i/2*(Math.cos(Math.PI*d/b)-1)+g}}}}()};return GRUNT.extend(h,{DEFAULT:h.Easing.Back.Out})}();SLICK.Border={NONE:0,TOP:1,RIGHT:2,BOTTOM:3,LEFT:4};
SLICK.Graphics=function(){var o={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,PINCHZOOM:16,FREEZE:128},n=0,e={DisplayState:o,AnyDisplayState:255,ActiveDisplayStates:o.ACTIVE|o.ANIMATING,DefaultDisplayStates:o.ACTIVE|o.ANIMATING|o.PAN|o.PINCHZOOM,ViewLayer:function(c){c=GRUNT.extend({id:"",centerOnScale:true,created:(new Date).getTime(),scalePosition:true,zindex:0,supportFastDraw:false,validStates:e.DefaultDisplayStates},c);var h=null,a=GRUNT.extend({isAnimating:function(){return false},addToView:function(d){d.setLayer(c.id,
a)},shouldDraw:function(d){var g=h?h.fastDraw&&d!==o.ACTIVE:false;return(d&c.validStates)!==0&&(g?c.supportFastDraw:true)},cycle:function(){return 0},draw:function(){},notify:function(){},remove:function(){GRUNT.WaterCooler.say("layer.remove",{id:c.id})},wakeParent:function(){GRUNT.WaterCooler.say("view.wake",{id:h?h.id:null})},getParent:function(){return h},setParent:function(d){h=d}},c);return a},StatusViewLayer:function(){return new e.ViewLayer({validStates:e.AnyDisplayState,zindex:5E3,draw:function(c,
h,a,d,g){c.fillStyle="#FF0000";c.fillRect(10,10,50,50);c.fillStyle="#FFFFFF";c.font="bold 10px sans";c.fillText(g.getDisplayState(),20,20)}})},AnimatedPathLayer:function(c){function h(f,j,k){f.fillStyle="#FFFFFF";f.strokeStyle="#222222";f.beginPath();f.arc(k.x,k.y,4,0,Math.PI*2,false);f.stroke();f.fill()}c=GRUNT.extend({path:[],id:GRUNT.generateObjectID("pathAnimation"),easing:SLICK.Animation.Easing.Sine.InOut,canCache:false,validStates:e.ActiveDisplayStates|o.PAN|o.PINCHZOOM,drawIndicator:null,duration:2E3,
autoCenter:false},c);var a=SLICK.VectorMath.edges(c.path),d,g=null,i=0;SLICK.Animation.tweenValue(0,a.total,c.easing,function(){b.remove()},c.duration).requestUpdates(function(f,j){i=f;j&&b.remove()});var b=GRUNT.extend(new e.ViewLayer(c),{cycle:function(){for(var f=0;f<a.accrued.length&&a.accrued[f]<i;)f++;g=null;if(f<c.path.length-1){var j=i-(f>0?a.accrued[f-1]:0),k=c.path[f],l=c.path[f+1];d=SLICK.VectorMath.theta(k,l,a.edges[f]);g=SLICK.VectorMath.pointOnEdge(k,l,d,j);if(c.autoCenter)(f=b.getParent())&&
f.centerOn(g)}return g?1:0},draw:function(f,j){if(g)(c.drawIndicator?c.drawIndicator:h)(f,j,new SLICK.Vector(g.x-j.x,g.y-j.y),d)}});return b},FPSLayer:function(c){c=GRUNT.extend({zindex:1E3,scalePosition:false},c);var h=null,a=GRUNT.extend(new e.ViewLayer(c),{delays:[],draw:function(d,g,i){d.font="bold 8pt Arial";d.textAlign="right";d.fillStyle="rgba(0, 0, 0, 0.8)";d.fillText((h?h:"?")+" fps",i.width-20,20)}});setInterval(function(){for(var d=0,g=a.delays.length,i=g;i--;)d+=a.delays[i];if(g!==0)h=
Math.floor(1E3/(d/g))},1E3);return a},ResourceStatsLayer:function(c){c=GRUNT.extend({zindex:500,indicatorSize:5,scalePosition:false,validStates:o.ACTIVE|o.PAN},c);return GRUNT.extend(new e.ViewLayer(c),{fps:null,draw:function(h){var a=SLICK.Resources.getStats(),d=c.indicatorSize,g=10,i;if(a.imageCacheFullness){h.strokeStyle="rgba(0, 0, 255, 1)";h.beginPath();h.arc(15,15,5,0,Math.PI*2*a.imageCacheFullness,false);h.stroke();g=30}if(a.imageLoadingCount>=0){h.fillStyle="rgba(0, 255, 0, 0.7)";for(i=a.imageLoadingCount;i--;)h.fillRect(g+
i*(d+2),10,d,d)}if(a.queuedImageCount>=0){h.fillStyle="rgba(255, 0, 0, 0.7)";for(i=a.queuedImageCount;i--;)h.fillRect(g+i*(d+2),10+d+2,d,d)}}})},LoadingLayer:function(c){GRUNT.extend({},c)},View:function(c){function h(v,w){w.id=v;w.setParent(G);b.push(w);b.sort(function(H,K){var L=K.zindex-H.zindex;if(L===0)L=K.created-H.created;return L})}function a(){GRUNT.WaterCooler.say("view-idle",{id:G.id});F=true;t=0}function d(v,w){var H=0,K=G.getScaleFactor(),L=G.getDisplayState(),T=(new Date).getTime(),
R=(L&o.PINCHZOOM)!==0;p=G.getScaleFactor();var Q=0;if(l||R){v.clearRect(0,0,f.width,f.height);l=false}if(R){var N=I.getScaleInfo();G.getDimensions().getCenter();var O=(N.progress?N.progress:1)*0.5;D=N.center;if(N.startRect){O=N.startRect.getCenter();O=SLICK.V.diff(O,D);A=new SLICK.Vector(D.x+O.x,D.y+O.y)}else{N=SLICK.V.diff(N.start,D);A=new SLICK.Vector(D.x-N.x*O,D.y-N.y*O)}if(A)w=SLICK.V.offset(w,A.x,A.y)}v.save();try{if(s!==1)v.scale(s,s);else if(R){v.translate(D.x,D.y);v.scale(K,K)}for(Q=b.length;Q--;)if(b[Q].shouldDraw(L)){var S=
b[Q].draw(v,w,x,L,G);H+=S?S:0}}finally{v.restore()}GRUNT.Log.trace("draw complete",T);return H}function g(){var v=0,w=J===o.PINCHZOOM||J===o.PAN;B=(new Date).getTime();k=E?E.getOffset():new SLICK.Vector;z&&r&&z.delays.push(B-r);if(w){SLICK.Animation.cancel(function(K){return K.cancelOnInteract});F=false;if(t!==0){clearTimeout(t);t=0}}for(w=b.length;w--;){var H=b[w].cycle(B,k);v+=H?H:0}v+=d(j,k);r=B;M=0;if(C+v>0)i();else if(!F&&t===0)t=setTimeout(a,500);GRUNT.Log.trace("Completed draw cycle",B)}function i(){C++;
if(!(q||M!==0)){C=0;M=setTimeout(g,0)}}c=GRUNT.extend({id:"view_"+n++,container:"",pannable:false,scalable:false,clearOnDraw:false,displayFPS:false,displayResourceStats:false,scaleDamping:false,fastDraw:false,fillStyle:"rgb(200, 200, 200)",initialDrawMode:"source-over",bufferRefresh:100,defaultFreezeDelay:500,onPan:null,onPinchZoom:null,onScale:null,onDraw:null,autoSize:false},c);var b=[],f=document.getElementById(c.container),j=null,k=new SLICK.Vector,l=false,p=1,r=null,m=0,q=false,s=1,u=new SLICK.Vector,
x=null,y=null,C=0,z=null,D=null,E=null,I=null,F=false,M=0,t=0,A=null,B=0,J=e.DisplayState.ACTIVE;GRUNT.Log.info("Creating a new view instance, attached to container: "+c.container+", canvas = ",f);if(f){SLICK.Touch.resetTouch(f);if(c.autoSize){GRUNT.Log.info("autosizing view: window.height = "+window.innerHeight+", width = "+window.innerWidth);f.height=window.innerHeight-f.offsetTop-49;f.width=window.innerWidth-f.offsetLeft}try{j=f.getContext("2d");j.globalCompositeOperation=c.initialDrawMode}catch(P){GRUNT.Log.exception(P);
throw Error("Could not initialise canvas on specified view element");}}if(c.pannable)E=new SLICK.Pannable({container:c.container,onAnimate:function(){i()},onPan:function(v,w){m=SLICK.Clock.getTime(true);i();u=SLICK.V.offset(u,v,w);c.onPan&&c.onPan(v,w);J=o.PAN},onPanEnd:function(){i();J=o.ACTIVE}});if(c.scalable)I=new SLICK.Scalable({scaleDamping:c.scaleDamping,container:c.container,onAnimate:function(){J=e.DisplayState.PINCHZOOM;i()},onPinchZoom:function(v,w){m=SLICK.Clock.getTime(true);i();c.onPinchZoom&&
c.onPinchZoom(v,w);J=e.DisplayState.PINCHZOOM},onScale:function(v,w){GRUNT.WaterCooler.say("view.scale",{id:G.id});J=e.DisplayState.ACTIVE;i();c.onScale&&c.onScale(v,w)}});var G=GRUNT.extend({},c,E,I,{id:c.id,deviceScaling:s,fastDraw:c.fastDraw||SLICK.Device.getConfig().requireFastDraw,centerOn:function(v){E.setOffset(v.x-f.width*0.5,v.y-f.height*0.5)},getDimensions:function(){if(f)return new SLICK.Dimensions(f.width,f.height)},getZoomCenter:function(){return A},getLayer:function(v){for(var w=0;w<
b.length;w++)if(b[w].id==v)return b[w];return null},setLayer:function(v,w){for(var H=0;H<b.length;H++)if(b[H].id===v){b.splice(H,1);break}w&&h(v,w);GRUNT.WaterCooler.say("layer.update",{value:w});i()},eachLayer:function(v){for(var w=0;w<b.length;w++)v(b[w])},clearBackground:function(){l=true},freeze:function(){q=true},unfreeze:function(){q=false;i()},snapshot:function(){},getDisplayState:function(){return q?o.FROZEN:J},scale:function(v,w,H,K,L){K||(K=G.getDimensions().getCenter());L||(L=G.getDimensions().getCenter());
I&&I.animate(v,K,L,w,H);return I},removeLayer:function(v){a:{for(var w=b.length;w--;)if(b[w].id==v){v=w;break a}v=-1}if(v>=0&&v<b.length){GRUNT.WaterCooler.say("layer.removed",{layer:b[v]});b.splice(v,1)}}});x=G.getDimensions();y=x.getCenter();GRUNT.WaterCooler.listen("layer.remove",function(v){v.id&&G.removeLayer(v.id)});GRUNT.WaterCooler.listen("view.wake",function(v){if(!v.id||v.id===G.id)i()});s=SLICK.Device.getConfig().getScaling();if(c.displayFPS){z=new e.FPSLayer;G.setLayer("fps",z)}c.displayResourceStats&&
G.setLayer("resourceStats",new e.ResourceStatsLayer);i();return G}};return e}();
SLICK.Tiling=function(){function o(){if(!e){e=document.createElement("canvas");e.width=h.Config.TILESIZE;e.height=h.Config.TILESIZE;var a=e.getContext("2d");a.fillStyle="rgba(150, 150, 150, 0.05)";a.fillRect(0,0,e.width,e.height)}return e}function n(){if(!c){c=document.createElement("canvas");c.width=h.Config.TILESIZE;c.height=h.Config.TILESIZE;var a=c.getContext("2d"),d=Math.sqrt(h.Config.TILESIZE);a.fillStyle="rgba(200, 200, 200, 1)";a.strokeStyle="rgb(190, 190, 190)";a.lineWidth=0.5;a.fillRect(0,
0,c.width,c.height);a.beginPath();for(var g=0;g<c.width;g+=d){a.moveTo(g,0);a.lineTo(g,c.height);for(var i=0;i<c.height;i+=d){a.moveTo(0,i);a.lineTo(c.width,i)}}a.stroke()}return c}TileStore=function(a){a=GRUNT.extend({gridSize:20,center:new SLICK.Vector,onPopulate:null},a);var d=Array(Math.pow(a.gridSize,2)),g=SLICK.V.offset(a.center,-Math.ceil(a.gridSize>>1)),i=null,b=new SLICK.Vector,f=null,j={getGridSize:function(){return a.gridSize},getNormalizedPos:function(k,l){return SLICK.V.add(new SLICK.Vector(k,
l),SLICK.V.invert(g),b)},getTileShift:function(){return SLICK.V.copy(b)},getTile:function(k,l){return k>=0&&k<a.gridSize?d[l*a.gridSize+k]:null},setTile:function(k,l,p){d[l*a.gridSize+k]=p},populate:function(k,l){var p=GRUNT.Log.getTraceTicks(),r=0;new SLICK.Vector(a.gridSize*0.5,a.gridSize*0.5);if(k)for(var m=0;m<a.gridSize;m++)for(var q=0;q<a.gridSize;q++){if(!d[r]){var s=k(q,m,g,a.gridSize);d[r]=s}r++}i=k;f=l;GRUNT.Log.trace("tile grid populated",p);a.onPopulate&&a.onPopulate()},getShiftDelta:function(k,
l,p,r){var m=Math.floor(a.gridSize*0.2),q=new SLICK.Vector;if(k<0||k+p>a.gridSize)q.x=k<0?-m:m;if(l<0||l+r>a.gridSize)q.y=l<0?-m:m;return q},shift:function(k,l){if(!(k.x===0&&k.y===0)){var p=GRUNT.Log.getTraceTicks(),r=Array(d.length);r.length=d.length;for(var m=0;m<a.gridSize;m++)for(var q=0;q<a.gridSize;q++)r[q*a.gridSize+m]=j.getTile(m+k.x,q+k.y);d=r;g=l?l(g,k):SLICK.V.add(g,k);b.x+=-k.x*a.tileSize;b.y+=-k.y*a.tileSize;GRUNT.Log.trace("tile storage shifted",p);j.populate(i,f)}},setOrigin:function(k,
l){if(tileOrigin)shiftOrigin(k,l);else g=SLICK.V.offset(new SLICK.Vector(k,l),-tileHalfWidth)}};GRUNT.WaterCooler.listen("imagecache.cleared",function(){for(var k=d.length;k--;)if(d[k])d[k].loaded=false});return j};var e=null,c=null,h={Config:{TILESIZE:256,TILEBUFFER:1,TILEBUFFER_LOADNEW:0.2},Tile:function(a){return a=GRUNT.extend({x:0,y:0,size:256},a)},ImageTile:function(a){a=GRUNT.extend({url:"",sessionParamRegex:null,loaded:false},a);return new h.Tile(a)},TileGrid:function(a){function d(m,q,s,
u){if((f?SLICK.V.absSize(SLICK.V.diff(f,q)):i)>=20){m=g.getTileShift();m=new SLICK.Vector(Math.floor((q.x+m.x)*b),Math.floor((q.y+m.y)*b));var x=Math.ceil(s.width*b)+1;s=Math.ceil(s.height*b)+1;var y=new SLICK.Vector((x-1)*0.5,(s-1)*0.5),C=new SLICK.Vector(m.x*a.tileSize,m.y*a.tileSize);u.isAnimating();k=[];tilesNeeded=false;for(var z=s;z--;)for(var D=z*a.tileSize+C.y,E=x;E--;){u=g.getTile(E+m.x,z+m.y);var I=E*a.tileSize+C.x,F=new SLICK.Vector(E-y.x,z-y.y);u||(l=g.getShiftDelta(m.x,m.y,x,s));k.push({tile:u,
coordinates:new SLICK.Vector(I,D),centerness:SLICK.V.absSize(F)})}k.sort(function(M,t){return t.centerness-M.centerness});f=SLICK.V.copy(q)}}a=GRUNT.extend({tileSize:SLICK.Tiling.Config.TILESIZE,drawGrid:false,center:new SLICK.Vector,shiftOrigin:null,supportFastDraw:true,checkChange:100},a);var g=new TileStore(GRUNT.extend({onPopulate:function(){j=true;r.wakeParent()}},a)),i=Math.round(a.tileSize>>1),b=a.tileSize?1/a.tileSize:0,f=null,j=false,k=[];new SLICK.Vector;var l=new SLICK.Vector,p=g.getGridSize()*
a.tileSize,r=GRUNT.extend(new SLICK.Graphics.ViewLayer(a),{gridDimensions:new SLICK.Dimensions(p,p),cycle:function(){var m=0;if(l.x+l.y!==0){g.shift(l,a.shiftOrigin);l=new SLICK.Vector;m++}return m+j?1:0},drawTile:function(){},draw:function(m,q,s,u,x){var y=GRUNT.Log.getTraceTicks(),C=g.getTileShift(),z=q.x+C.x;C=q.y+C.y;if(u!==SLICK.Graphics.DisplayState.PINCHZOOM){d(m,q,s,x);GRUNT.Log.trace("updated draw queue",y)}if(a.drawGrid)m.strokeStyle="rgba(50, 50, 50, 0.3)";m.beginPath();for(q=k.length;q--;){s=
k[q].tile;x=k[q].coordinates.x-z;var D=k[q].coordinates.y-C;if(s){r.drawTile(m,s,x,D,u);s.x=x;s.y=D}a.drawGrid&&m.rect(x,D,a.tileSize,a.tileSize)}m.stroke();GRUNT.Log.trace("drawn tiles",y);j=false},getTileSize:function(){return a.tileSize},getTileVirtualXY:function(m,q,s){m=g.getNormalizedPos(m,q);m=new SLICK.Vector(m.x*a.tileSize,m.y*a.tileSize);if(s){m.x+=i;m.y+=i}return m},getCenterXY:function(){var m=Math.ceil(g.getGridSize()>>1);return r.getTileVirtualXY(m,m,true)},populate:function(m){g.populate(m,
function(){})}});GRUNT.WaterCooler.listen("tile.loaded",function(){j=true;r.wakeParent()});return r},ImageTileGrid:function(a){function d(){GRUNT.WaterCooler.say("tile.loaded")}a=GRUNT.extend({},a);return GRUNT.extend(new h.TileGrid(a),{drawTile:function(g,i,b,f,j){var k=SLICK.Resources.getImage(i.url);j===SLICK.Graphics.DisplayState.PAN&&g.drawImage(n(),b,f);if(k&&k.complete)g.drawImage(k,b,f);else{g.drawImage(o(),b,f);k||SLICK.Resources.loadImage(i.url,d)}}})},Tiler:function(a){a=GRUNT.extend({container:"",
drawCenter:false,onPan:null,onPanEnd:null,tapHandler:null,doubleTapHandler:null,zoomHandler:null,onDraw:null,datasources:{},tileLoadThreshold:"first"},a);var d=new SLICK.Graphics.View(GRUNT.extend({},a,{pannable:true,scalable:true,scaleDamping:true}));SLICK.Touch.captureTouch(document.getElementById(a.container),a);GRUNT.extend(d,{getTileLayer:function(){return d.getLayer("grid0")},setTileLayer:function(g){d.setLayer("grid0",g);GRUNT.WaterCooler.say("grid.updated",{grid:g})},gridPixToViewPix:function(g){var i=
d.getOffset();return new SLICK.Vector(g.x-i.x,g.y-i.y)},viewPixToGridPix:function(g){var i=d.getOffset();return new SLICK.Vector(g.x+i.x,g.y+i.y)},cleanup:function(){d.removeLayer("grid0")}});return d}};return h}();
SLICK.Geo=function(){function o(b,f){var j=null;for(var k in g)if(f){if(k==f&&g[k][b]){j=g[k];break}}else if(g[k][b]){j=g[k];break}return j}function n(b,f,j,k){var l=0;b=b.toUpperCase();for(var p in k){var r=f[p];if(r){var m=j[p];r=m?m(b,r):b.containsWord(r)?1:0;l+=r*k[p]}}return l}var e=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],c=/(\d+)\s?\-\s?(\d+)/,h=/^(\d+).*$/,a=null,d={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",
HWY:"HIGHWAY",MWY:"MOTORWAY"},g={},i={Engine:function(b){if(!b.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var f=GRUNT.extend({remove:function(){delete g[f.id]}},b);return g[f.id]=f},getEngine:function(b){for(var f=null,j=1;!f&&j<arguments.length;j++)f=o(b,arguments[j]);f=f?f:o(b);if(!f)throw Error("Unable to find GEO engine with "+b+" capability");return f},Distance:function(b,f){var j=0;if(!i.emptyPos(b)&&!i.emptyPos(f)){var k=(f.lat-b.lat).toRad()>>1,l=(f.lon-b.lon).toRad()>>
1;k=Math.sin(k)*Math.sin(k)+Math.cos(b.lat.toRad())*Math.cos(f.lat.toRad())*Math.sin(l)*Math.sin(l);j=6371*2*Math.atan2(Math.sqrt(k),Math.sqrt(1-k))}return{toM:function(){return j*1E3},toKM:function(){return j},toString:function(){return j+"km"}}},Radius:function(b,f){return{distance:parseInt(b,10),uom:f}},Position:function(b,f){return{lat:parseFloat(b?b:0),lon:parseFloat(f?f:0)}},BoundingBox:function(b,f){var j={min:i.parsePosition(b),max:i.parsePosition(f),expand:function(k){j.min.lat-=k;j.min.lon-=
i.Utilities.normalizeLon(k);j.max.lat+=k;j.max.lon+=i.Utilities.normalizeLon(k)},getDistance:function(){return new i.Distance(j.min,j.max)},getCenter:function(){var k=i.calculateBoundsSize(j.min,j.max);return new SLICK.Geo.Position(j.min.lat+k.y*0.5,j.min.lon+k.x*0.5)},transform:function(k){var l=new SLICK.Geo.BoundingBox(j.min,j.max);GRUNT.Log.info("applying "+k.length+" transformers");for(var p=0;k&&p<k.length;p++)k[p].apply(l);return l},toString:function(){return String.format("({0}, {1})",j.min,
j.max)}};return j},Transforms:function(){return{Shrink:function(){return function(){}},Offset:function(){return function(){}}}}(),Address:function(b){b=GRUNT.extend({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},b);return GRUNT.extend(b,{getPos:function(){return b.pos},toString:function(){return b.streetDetails+" "+b.location}})},GeocodeFieldWeights:{streetDetails:50,location:50},AddressCompareFns:{},Utilities:function(){var b={lat2pix:function(f,j){var k=parseFloat(f)*
2*Math.PI/360;k=Math.sin(k);var l=0.08181919084262157*k;return Math.log((1+k)/(1-k)*Math.pow((1-l)/(1+l),0.08181919084262157))/2/j},lon2pix:function(f,j){return parseFloat(f)/180*Math.PI/j},pix2lon:function(f,j){return b.normalizeLon(f*j*180/Math.PI)},pix2lat:function(f,j){for(var k=Math.pow(Math.E,-f*j),l=b.mercatorUnproject(k),p=b.findRadPhi(l,k),r=0;r<12&&Math.abs(l-p)>1.0E-7;){l=p;p=b.findRadPhi(l,k);r++}return p*180/Math.PI},mercatorUnproject:function(f){return Math.PI/2-2*Math.atan(f)},findRadPhi:function(f,
j){var k=0.08181919084262157*Math.sin(f);return Math.PI/2-2*Math.atan(j*Math.pow((1-k)/(1+k),0.040909595421310785))},normalizeLon:function(f){for(;f<-180;)f+=360;for(;f>180;)f-=360;return f}};return b}(),GeoSearchResult:function(b){b=GRUNT.extend({id:null,caption:"",resultType:"",data:null,pos:null,matchWeight:0},b);return GRUNT.extend(b,{toString:function(){return b.caption+(b.matchWeight?" ("+b.matchWeight+")":"")}})},GeoSearchAgent:function(b){b=GRUNT.extend({},b);return GRUNT.extend({},SLICK.Dispatcher.createAgent(b))},
GeocodingAgent:function(b){b=GRUNT.extend({name:"Geocoding Search Agent",paramTranslator:null,execute:function(f,j){try{if(!f.reverse&&!f.freeform)address=new i.Address(f);var k=i.getEngine("geocode");if(k)k.geocode({addresses:[f.freeform?f.freeform:address],complete:function(p,r){if(j){var m=r;if(f.freeform)m=i.rankGeocodeResponses(f.freeform,m,i.getEngine("geocode"));j(m,b)}}})}catch(l){GRUNT.Log.exception(l)}}},b);return new i.GeoSearchAgent(b)},PointOfInterest:function(b){b=GRUNT.extend({id:0,
title:"",pos:null,lat:"",lon:"",group:"",retrieved:0,isNew:true},b);if(!b.pos&&b.lat&&b.lon)b.pos=new SLICK.Geo.Position(b.lat,b.lon);return GRUNT.extend({toString:function(){return b.id+": '"+b.title+"'"}},b)},POIStorage:function(b){function f(m){m=m?m:"default";l[m]||(l[m]=[]);return l[m]}function j(m){var q=[];for(var s in l)for(var u=0;u<l[s].length;u++)if(!m||m(l[s][u]))q.push(l[s][u]);return q}function k(){GRUNT.WaterCooler.say("geo.pois-updated",{srcID:r.id,pois:r.getPOIs()})}b=GRUNT.extend({visibilityChange:null,
onPOIDeleted:null,onPOIAdded:null},b);var l={},p=true,r={id:GRUNT.generateObjectID(),getPOIs:function(){return j()},getOldPOIs:function(m,q){return j(function(s){return s.group==m&&s.retrieved<q})},getVisible:function(){return p},setVisible:function(m){if(m!=p){p=m;b.visibilityChange&&b.visibilityChange()}},findById:function(m){var q=j(function(s){return s.id==m});return q.length>0?q[0]:null},findByBounds:function(m){return j(function(q){return SLICK.Geo.posInBounds(q.pos,m)})},addPOIs:function(m,
q){if(q)l={};for(var s=0;m&&s<m.length;s++){m[s].retrieved=SLICK.Clock.getTime(true);var u=m[s];f(u.group).push(u)}},removeGroup:function(m){if(l[m]){delete l[m];k()}},update:function(m){var q=[],s=0,u=m.length>0?m[0].group:"",x=SLICK.Clock.getTime(true);for(s=0;s<m.length;s++){var y;a:{if(y=m[s])for(var C=f(y.group),z=0;z<C.length;z++)if(C[z].id==y.id){y=C[z];break a}y=null}if(y){y.retrieved=x;y.isNew=false}else q.push(m[s])}m=r.getOldPOIs(u,x);r.addPOIs(q);for(s=0;b.onPOIAdded&&s<q.length;s++)b.onPOIAdded(q[s]);
for(s=0;s<m.length;s++){b.onPOIDeleted&&b.onPOIDeleted(m[s]);u=m[s];x=f(u.group);for(y=0;y<x.length;y++)if(x[y].id==u.id){x.splice(y,1);break}}q.length+m.length>0&&k()}};return r},MapProvider:function(){return{zoomLevel:0,checkZoomLevel:function(b){return b},getCopyright:function(){},getMapTiles:function(){},getPositionForXY:function(){return null}}},P:function(){var b={calcDistance:function(f,j){if(b.empty(f)||b.empty(j))return 0;var k=(j.lat-f.lat).toRad()*0.5,l=(j.lon-f.lon).toRad()*0.5;k=Math.sin(k)*
Math.sin(k)+Math.cos(f.lat.toRad())*Math.cos(j.lat.toRad())*Math.sin(l)*Math.sin(l);return 6371*2*Math.atan2(Math.sqrt(k),Math.sqrt(1-k))},empty:function(f){return!f||f.lat===0&&f.lon===0},equal:function(f,j){return f&&j&&f.lat==j.lat&&f.lon==j.lon},almostEqual:function(f,j){return f&&j&&Math.floor(f.lat*1E3)===Math.floor(j.lat*1E3)&&Math.floor(f.lon*1E3)===Math.floor(j.lon*1E3)},inArray:function(f,j){for(var k=i.P.equal,l=j.length;l--;)if(k(f,j[l]))return true;return false}};return b}(),copyPos:function(b){return b?
new i.Position(b.lat,b.lon):null},emptyPos:function(b){return!b||b.lat===0&&b.lon===0},posToStr:function(b){return b.lat+" "+b.lon},parsePosition:function(b){if(b)if(GRUNT.isPlainObject(b)&&b.lat!=="undefined")return b;else{if(b.split)for(var f=[" ",","],j=0;j<f.length;j++){var k=b.split(f[j]);if(k.length===2)return new i.Position(k[0],k[1])}}else return new i.Position;return null},parsePositionArray:function(b){var f=b.length,j=Array(f);for(f=f;f--;)j[f]=i.parsePosition(b[f]);GRUNT.Log.info("parsed "+
j.length+" positions");return j},generalizePositions:function(b,f,j){var k=b.length,l=[],p=null;j||(j=250);j/=1E3;GRUNT.Log.info("generalizing positions, must include "+f.length+" positions");for(var r=k;r--;)if(r===0)l.unshift(b[r]);else{var m=!p||i.P.inArray(b[r],f)?j:i.P.calcDistance(p,b[r]);if(b[r]&&m>=j){l.unshift(b[r]);p=b[r]}}GRUNT.Log.info("generalized "+k+" positions into "+l.length+" positions");return l},posToMercatorPixels:function(b,f){return new SLICK.Vector(SLICK.Geo.Utilities.lon2pix(b.lon,
f),SLICK.Geo.Utilities.lat2pix(b.lat,f))},mercatorPixelsToPos:function(b,f,j){return new i.Position(SLICK.Geo.Utilities.pix2lat(f,j),SLICK.Geo.Utilities.normalizeLon(SLICK.Geo.Utilities.pix2lon(b,j)))},emptyBounds:function(b){return!b||i.emptyPos(b.min)||i.emptyPos(b.max)},posInBounds:function(b,f){var j=!(i.emptyPos(b)||i.emptyBounds(f));return j=(j=j&&b.lat>=f.min.lat&&b.lat<=f.max.lat)&&b.lon>=f.min.lon&&b.lon<=f.max.lon},calculateBoundsSize:function(b,f,j){var k=new SLICK.Vector(0,f.lat-b.lat);
if(typeof j==="undefined")j=true;k.x=j&&b.lon>f.lon?360-b.lon+f.lon:f.lon-b.lon;return k},getBoundingBoxZoomLevel:function(b,f){var j=b.getCenter();j=e[Math.min(Math.round(Math.abs(j.lat)*0.05),e.length)];var k=i.calculateBoundsSize(b.min,b.max);return Math.min(Math.ceil(Math.log(e[3]*f.height/k.y)/Math.log(2)),Math.ceil(Math.log(j*f.width/k.x)/Math.log(2)))},getBoundsForPositions:function(b,f){var j=null,k=SLICK.Clock.getTime();f||(f="auto");for(var l=b.length;l--;)if(j){var p=i.calculateBoundsSize(j.min,
b[l],false),r=i.calculateBoundsSize(b[l],j.max,false);if(p.x<0)j.min.lon=b[l].lon;if(p.y<0)j.min.lat=b[l].lat;if(r.x<0)j.max.lon=b[l].lon;if(r.y<0)j.max.lat=b[l].lat}else j=new SLICK.Geo.BoundingBox(i.copyPos(b[l]),i.copyPos(b[l]));if(f){if(f=="auto"){l=i.calculateBoundsSize(j.min,j.max);f=Math.max(l.x,l.y)*0.3}j.expand(f)}GRUNT.Log.trace("calculated bounds for "+b.length+" positions",k);return j},normalizeAddress:function(b){if(!b)return"";b=b.toUpperCase();if(!a){var f=[];for(var j in d)f.push(j);
a=RegExp("(\\s)("+f.join("|")+")(\\s|$)","i")}a.lastIndex=-1;if(f=a.exec(b))b=b.replace(a,"$1"+d[f[2]]);return b},buildingMatch:function(b,f){h.lastIndex=-1;if(h.test(b))for(var j=b.replace(h,"$1"),k=f.split(","),l=0;l<k.length;l++){c.lastIndex=-1;if(c.test(k[l])){var p=c.exec(k[l]);if(j>=parseInt(p[1],10)&&j<=parseInt(p[2],10))return true}else if(j==k[l])return true}return false},rankGeocodeResponses:function(b,f,j){var k=[],l=i.AddressCompareFns;if(j&&j.compareFns)l=GRUNT.extend({},l,j.compareFns);
for(j=0;j<f.length;j++)k.push(new i.GeoSearchResult({caption:f[j].toString(),data:f[j],pos:f[j].pos,matchWeight:n(b,f[j],l,i.GeocodeFieldWeights)}));k.sort(function(p,r){return r.matchWeight-p.matchWeight});return k}};return i}();
SLICK.Geo.Location=function(){function o(c){function h(f){try{var j=new SLICK.Geo.Position(f.coords.latitude,f.coords.longitude),k=GRUNT.isPlainObject(f.coords.accuracy)&&f.coords.accuracy.horizontal?f.coords.accuracy.horizontal:f.coords.accuracy;GRUNT.Log.info("got position coordinates: "+j+", accuracy = "+k);if(c.successCallback&&(!i||k<b))c.successCallback(j,g,f);if(k>c.highAccuracyCutoff&&g<2){g=2;c.enableHighAccuracy=true;GRUNT.Log.info("Position not at required accuracy, trying again with high accuracy");
d()}i=f;b=k}catch(l){GRUNT.Log.exception(l)}}function a(f){if(f.code===f.PERMISSION_DENIED)c.errorCallback&&c.errorCallback(f);else if(f.code===f.POSITION_UNAVAILABLE)c.errorCallback&&c.errorCallback(f);else if(f.code===f.TIMEOUT){GRUNT.Log.info("had a timeout on cached position, moving to phase 1");if(c.timeout===0&&c.autoPhasing){g=1;c.timeout=n;c.enableHighAccuracy=false;d()}}}function d(){navigator.geolocation.getCurrentPosition(h,a,c)}c=GRUNT.extend({autoPhasing:true,maximumAge:3E5,timeout:0,
highAccuracyCutoff:10,enableHighAccuracy:true,successCallback:null,errorCallback:null},c);var g=0,i=null,b=1E6;d()}var n=3E3,e={get:function(){throw Error("No geolocation APIs supported.");}};if(navigator.geolocation)e.get=o;return e}();SLICK.Geo.Search=function(){return{bestResults:function(o,n){n||(n=20);for(var e=o.length>0?o[0]:null,c=[],h=0;h<o.length;h++)if(e.matchWeight-o[h].matchWeight<=n)c.push(o[h]);else break;return c}}}();
SLICK.Mapping=function(){var o=0,n={AnnotationTween:null,GeoTileGrid:function(e){e=GRUNT.extend({grid:null,centerPos:new SLICK.Geo.Position,centerXY:new SLICK.Vector,radsPerPixel:0},e);var c=SLICK.Geo.posToMercatorPixels(e.centerPos,e.radsPerPixel),h=c.x-e.centerXY.x,a=c.y-e.centerXY.y,d=GRUNT.extend({},e.grid,{getBoundingBox:function(g,i,b,f){return new SLICK.Geo.BoundingBox(d.pixelsToPos(new SLICK.Vector(g,i+f)),d.pixelsToPos(new SLICK.Vector(g+b,i)))},getCenterOffset:function(){return e.centerXY},
getGridXYForPosition:function(g){g=SLICK.Geo.posToMercatorPixels(g,e.radsPerPixel);return new SLICK.Vector(g.x-h,d.gridDimensions.height-(g.y-a))},getGuideOffset:function(g){var i=d.getTileSize();return new SLICK.Vector(g.x%i,g.y%i)},pixelsToPos:function(g){return SLICK.Geo.mercatorPixelsToPos(h+g.x,a+d.gridDimensions.height-g.y,e.radsPerPixel)}});return d},POIViewLayer:function(e){GRUNT.extend({},e)},Overlay:function(e){GRUNT.extend({},e);return{}},RadarOverlay:function(e){e=GRUNT.extend({radarFill:"rgba(0, 221, 238, 0.1)",
radarStroke:"rgba(0, 102, 136, 0.3)",zindex:100},e);return GRUNT.extend(new SLICK.Graphics.ViewLayer(e),{draw:function(c,h,a){h=a.width>>1;a=a.height>>1;c.fillStyle=e.radarFill;c.strokeStyle=e.radarStroke;c.beginPath();c.arc(h,a,50,0,Math.PI*2,false);c.fill();c.stroke()}})},CrosshairOverlay:function(e){e=GRUNT.extend({lineWidth:1.5,strokeStyle:"rgba(0, 0, 0, 0.5)",size:15,zindex:150,scalePosition:false,validStates:SLICK.Graphics.DisplayState.ACTIVE|SLICK.Graphics.DisplayState.ANIMATING|SLICK.Graphics.DisplayState.PAN},
e);return GRUNT.extend(new SLICK.Graphics.ViewLayer(e),{draw:function(c,h,a){h=a.getCenter();c.lineWidth=e.lineWidth;c.strokeStyle=e.strokeStyle;a=e.size;c.beginPath();c.moveTo(h.x,h.y-a);c.lineTo(h.x,h.y+a);c.moveTo(h.x-a,h.y);c.lineTo(h.x+a,h.y);c.arc(h.x,h.y,a*0.6666,0,2*Math.PI,false);c.stroke()}})},RouteOverlay:function(e){e=GRUNT.extend({strokeStyle:"rgba(0, 51, 119, 0.9)",waypointFillStyle:"#FFFFFF",lineWidth:4,data:null,pixelGeneralization:8,calculationsPerCycle:250,partialDraw:false,zindex:50},
e);var c=true,h=null,a=[],d=0,g=[],i=[],b=GRUNT.extend(new SLICK.Graphics.ViewLayer(e),{getAnimation:function(f,j,k,l){if(c)return null;var p="routeAnimation"+o++;i.push(p);return new SLICK.Graphics.AnimatedPathLayer({id:p,path:a,zindex:e.zindex+1,easing:f?f:SLICK.Animation.Easing.Sine.InOut,duration:j?j:5E3,drawIndicator:k,autoCenter:l?l:false})},draw:function(f,j,k,l,p){k=0;l=e.data?e.data.geometry:null;if(c){c=false;a=[];d=0}if(l&&d<l.length){a:{p=p.getTileLayer();g=[];l=GRUNT.Log.getTraceTicks();
var r,m,q,s=e.data?e.data.geometry:[],u=s.length,x=e.data?e.data.instructions:[],y=x.length,C=e.calculationsPerCycle,z=0;for(r=d;r<u;r++){m=p.getGridXYForPosition(s[r]);if(q=!h||r===0||r===u||Math.abs(m.x-h.x)+Math.abs(m.y-h.y)>e.pixelGeneralization){a.push(m);h=m}z++;if(z>=C){d=r;break a}}d=u;GRUNT.Log.trace(u+" geometry points generalized to "+a.length+" coordinates",l);h=null;for(r=y;r--;)if(x[r].position){m=p.getGridXYForPosition(x[r].position);if(q=!h||r===0||Math.abs(m.x-h.x)+Math.abs(m.y-h.y)>
e.pixelGeneralization){g.push(m);h=m}}}k++}p=a.length;if(p>0&&(!k||e.partialDraw)){f.strokeStyle=e.strokeStyle;f.lineWidth=e.lineWidth;f.beginPath();for(p=p;p--;)f.lineTo(a[p].x-j.x,a[p].y-j.y);f.stroke();f.fillStyle=e.waypointFillStyle;for(p=g.length;p--;){f.beginPath();f.arc(g[p].x-j.x,g[p].y-j.y,2,0,Math.PI*2,false);f.stroke();f.fill()}}return k}});GRUNT.WaterCooler.listen("grid.updated",function(){for(var f=i.length;f--;)GRUNT.WaterCooler.say("layer.remove",{id:i[f]});i=[];c=true;b.wakeParent()});
return b},Annotation:function(e){e=GRUNT.extend({xy:null,pos:null,draw:null,tweenIn:n.AnnotationTween},e);var c=false,h={xy:e.xy,pos:e.pos,isNew:false,isAnimating:function(){return c},draw:function(a,d,g,i){if(h.xy){if(h.isNew&&e.tweenIn){var b=h.xy.y;h.xy.y=d.y-20;c=true;SLICK.Animation.tween(h.xy,"y",b,e.tweenIn,function(){h.xy.y=b;c=false},250+Math.random()*500)}if(e.draw)e.draw(a,d,new SLICK.Vector(h.xy.x-d.x,h.xy.y-d.y),g,i);else{a.beginPath();a.arc(h.xy.x-d.x,h.xy.y-d.y,4,0,Math.PI*2,false);
a.fill()}h.isNew=false}}};return h},ImageAnnotation:function(e){e=GRUNT.extend({imageUrl:null},e);var c=null;e.draw=function(h,a,d,g,i){if(a=SLICK.Resources.getImage(e.imageUrl)){if(a.complete){c||(c=new SLICK.Vector(-a.width>>1,-a.height>>1));d=SLICK.V.offset(d,c.x,c.y);h.drawImage(a,d.x,d.y,a.width,a.height)}}else SLICK.Resources.loadImage(e.imageUrl,function(){i.wakeParent()})};return new n.Annotation(e)},AnnotationsOverlay:function(e){function c(i){for(var b=e.map?e.map.getTileLayer():null,f=
0;b&&f<i.length;f++)i[f].xy=b.getGridXYForPosition(i[f].pos)}e=GRUNT.extend({pois:null,map:null,createAnnotationForPOI:null,zindex:100},e);var h=[],a=false,d=[],g=GRUNT.extend(new SLICK.Graphics.ViewLayer(e),{draw:function(i,b,f,j){i.save();try{var k;a=false;i.fillStyle="rgba(255, 0, 0, 0.75)";i.globalCompositeOperation="source-over";for(k=h.length;k--;){h[k].draw(i,b,j,g);a=a||h[k].isAnimating()}for(k=d.length;k--;){d[k].draw(i,b,j,g);a=a||h[k].isAnimating()}a&&g.wakeParent()}finally{i.restore()}},
add:function(i){d.push(i);c(d)},isAnimating:function(){return a}});GRUNT.WaterCooler.listen("geo.pois-updated",function(i){if(e.pois&&e.pois.id==i.srcID){i=i.pois;try{h=[];for(var b=0;b<i.length;b++)if(i[b].pos){var f;var j=i[b];if(j&&j.pos){var k=null;if(k=e.createAnnotationForPOI?e.createAnnotationForPOI(j):new n.Annotation({pos:j.pos})){k.isNew=j.isNew;j.isNew=false}f=k}else f=void 0;f&&h.push(f)}c(h)}catch(l){GRUNT.Log.exception(l)}g.wakeParent()}});GRUNT.WaterCooler.listen("grid.updated",function(){c(h);
c(d)});return g},Tiler:function(e){e=GRUNT.extend({tapExtent:10,provider:null,crosshair:true,copyright:undefined,zoomLevel:0,boundsChange:null,tapPOI:null,boundsChangeThreshold:30,pois:new SLICK.Geo.POIStorage,createAnnotationForPOI:null},e);if(typeof e.copyright==="undefined")e.copyright=e.provider?e.provider.getCopyright():"";var c=new SLICK.Vector,h=e.copyright,a=false,d=[],g=0,i=null,b=e.zoomLevel;if(!e.provider)e.provider=new SLICK.Geo.MapProvider;var f=e.panHandler,j=e.tapHandler;e.onPan=function(p,
r){f&&f(p,r)};e.tapHandler=function(p,r){var m=l.getTileLayer(),q=null;if(m){q=l.viewPixToGridPix(new SLICK.Vector(r.x,r.y));var s=m.pixelsToPos(SLICK.V.offset(q,-e.tapExtent,e.tapExtent)),u=m.pixelsToPos(SLICK.V.offset(q,e.tapExtent,-e.tapExtent));GRUNT.Log.info("grid tapped @ "+SLICK.Geo.posToStr(m.pixelsToPos(q)));q=new SLICK.Geo.BoundingBox(s,u);d=l.pois.findByBounds(q);e.tapPOI&&e.tapPOI(d)}j&&j(p,r,q)};e.doubleTapHandler=function(p,r){l.animate(2,l.getDimensions().getCenter(),new SLICK.Vector(r.x,
r.y),SLICK.Animation.Easing.Sine.Out)};e.onScale=function(p,r){var m=0;p=Math.sqrt(p);if(p<1)m=-(0.5/p);else if(p>1)m=p;l.gotoPosition(l.getXYPosition(r),b+Math.floor(m))};var k=new SLICK.Tiling.Tiler(e),l=GRUNT.extend({},k,{pois:e.pois,getBoundingBox:function(){var p=new SLICK.Geo.BoundingBox,r=l.getTileLayer(),m=l.getOffset(),q=l.getDimensions();if(r)p=r.getBoundingBox(m.x,m.y,q.width,q.height);return p},getCenterPosition:function(){return l.getXYPosition(l.gridDimensions.getCenter())},getXYPosition:function(p){return l.getTileLayer().pixelsToPos(l.viewPixToGridPix(p))},
gotoBounds:function(p,r){var m=SLICK.Geo.getBoundingBoxZoomLevel(p,l.getDimensions());l.gotoPosition(p.getCenter(),m,r)},gotoCurrentPosition:function(p){SLICK.Geo.Location.get({successCallback:function(r){l.clearBackground();l.gotoPosition(r,15,p)},errorCallback:function(){}})},gotoPosition:function(p,r,m){var q=b,s=(new Date).getTime();b=r?r:b;if(!b)throw"Zoom level required to goto a position.";if(e.provider)b=e.provider.checkZoomLevel(b);if(!a||b!==q){SLICK.Resources.resetImageLoadQueue();SLICK.Animation.cancel();
a&&l.freeze();g=s;e.provider.zoomLevel=b;e.provider.getMapTiles(l,p,function(u){if(s===g){l.setTileLayer(u);l.panToPosition(p,function(){l.unfreeze();m&&m()})}else GRUNT.Log.info("request time mismatch - ignoring update")});a=true}else l.panToPosition(p,m)},panToPosition:function(p,r,m){var q=l.getTileLayer();if(q){p=q.getGridXYForPosition(p);q=l.getDimensions();p.x-=q.width>>1;p.y-=q.height>>1;if(i)i=null;l.updateOffset(p.x,p.y,m);GRUNT.WaterCooler.say("view.wake",{id:l.id});e.boundsChange&&e.boundsChange(l.getBoundingBox());
r&&r(l)}},setZoomLevel:function(p){l.gotoPosition(l.getCenterPosition(),p)},zoomIn:function(){l.scale(2,SLICK.Animation.Easing.Sine.Out)||l.setZoomLevel(b+1)},zoomOut:function(){l.scale(0.5,SLICK.Animation.Easing.Sine.Out)||l.setZoomLevel(b-1)},animateRoute:function(p,r,m,q){var s=l.getLayer("route");if(s)(p=s.getAnimation(p,r,m,q))&&p.addToView(l)}},k);k=new SLICK.Mapping.AnnotationsOverlay({pois:l.pois,map:l,createAnnotationForPOI:e.createAnnotationForPOI});l.setLayer("annotations",k);e.crosshair&&
l.setLayer("crosshair",new SLICK.Mapping.CrosshairOverlay);h&&l.setLayer("copyright",new SLICK.Graphics.ViewLayer({zindex:999,draw:function(p,r,m){p.lineWidth=2.5;p.fillStyle="rgb(50, 50, 50)";p.strokeStyle="rgba(255, 255, 255, 0.8)";p.font="bold 10px sans";p.textBaseline="bottom";p.strokeText(h,10,m.height-10);p.fillText(h,10,m.height-10)}}));GRUNT.WaterCooler.listen("view-idle",function(p){if(p.id&&p.id==l.id)if(SLICK.V.absSize(SLICK.V.diff(c,l.getOffset()))>e.boundsChangeThreshold&&e.boundsChange){c=
l.getOffset();e.boundsChange(l.getBoundingBox())}});return l}};return n}();
SLICK.Geo.Routing=function(){var o={calculate:function(n){n=GRUNT.extend({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:true},n);GRUNT.Log.info("attempting to calculate route");var e=SLICK.Geo.getEngine("route");e&&e.route(n,function(c){if(n.generalize)c.geometry=SLICK.Geo.generalizePositions(c.geometry,c.getInstructionPositions());if(n.map){o.createMapOverlay(n.map,c);if(n.autoFit){GRUNT.Log.info("AUTOFITTING MAP TO ROUTE: bounds = "+c.boundingBox);n.map.gotoBounds(c.boundingBox)}}n.success&&
n.success(c)})},createMapOverlay:function(n,e){var c=n.getDimensions();c=new SLICK.Mapping.RouteOverlay({data:e,width:c.width,height:c.height});n.setLayer("route",c)},Maneuver:{None:0,Continue:1,TurnLeft:100,TurnLeftSlight:101,TurnLeftSharp:102,TurnRight:110,TurnRightSlight:111,TurnRightSharp:112,TurnAround:190,EnterRoundabout:200,ExitRamp:300},Instruction:function(n){n=GRUNT.extend({position:null,description:"",manuever:o.Maneuver.None},n);return GRUNT.extend(n,{})},RouteData:function(n){n=GRUNT.extend({geometry:[],
instructions:[],boundingBox:null},n);if(!n.boundingBox)n.boundingBox=SLICK.Geo.getBoundsForPositions(n.geometry);return GRUNT.extend({getInstructionPositions:function(){for(var e=[],c=0;c<n.instructions.length;c++)n.instructions[c].position&&e.push(n.instructions[c].position);return e}},n)}};return o}();
