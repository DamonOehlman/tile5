if(!this.JSON)this.JSON={};
(function(){function o(c){return c<10?"0"+c:c}function h(c){f.lastIndex=0;return f.test(c)?'"'+c.replace(f,function(g){var i=e[g];return typeof i==="string"?i:"\\u"+("0000"+g.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+c+'"'}function j(c,g){var i,l,m,q,r=a,p,n=g[c];if(n&&typeof n==="object"&&typeof n.toJSON==="function")n=n.toJSON(c);if(typeof k==="function")n=k.call(g,c,n);switch(typeof n){case "string":return h(n);case "number":return isFinite(n)?String(n):"null";case "boolean":case "null":return String(n);
case "object":if(!n)return"null";a+=d;p=[];if(Object.prototype.toString.apply(n)==="[object Array]"){q=n.length;for(i=0;i<q;i+=1)p[i]=j(i,n)||"null";m=p.length===0?"[]":a?"[\n"+a+p.join(",\n"+a)+"\n"+r+"]":"["+p.join(",")+"]";a=r;return m}if(k&&typeof k==="object"){q=k.length;for(i=0;i<q;i+=1){l=k[i];if(typeof l==="string")if(m=j(l,n))p.push(h(l)+(a?": ":":")+m)}}else for(l in n)if(Object.hasOwnProperty.call(n,l))if(m=j(l,n))p.push(h(l)+(a?": ":":")+m);m=p.length===0?"{}":a?"{\n"+a+p.join(",\n"+a)+
"\n"+r+"}":"{"+p.join(",")+"}";a=r;return m}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+o(this.getUTCMonth()+1)+"-"+o(this.getUTCDate())+"T"+o(this.getUTCHours())+":"+o(this.getUTCMinutes())+":"+o(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
f=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,a,d,e={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},k;if(typeof JSON.stringify!=="function")JSON.stringify=function(c,g,i){var l;d=a="";if(typeof i==="number")for(l=0;l<i;l+=1)d+=" ";else if(typeof i==="string")d=i;if((k=g)&&typeof g!=="function"&&(typeof g!=="object"||typeof g.length!=="number"))throw Error("JSON.stringify");return j("",
{"":c})};if(typeof JSON.parse!=="function")JSON.parse=function(c,g){function i(m,q){var r,p,n=m[q];if(n&&typeof n==="object")for(r in n)if(Object.hasOwnProperty.call(n,r)){p=i(n,r);if(p!==undefined)n[r]=p;else delete n[r]}return g.call(m,q,n)}var l;c=String(c);b.lastIndex=0;if(b.test(c))c=c.replace(b,function(m){return"\\u"+("0000"+m.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(c.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){l=eval("("+c+")");return typeof g==="function"?i({"":l},""):l}throw new SyntaxError("JSON.parse");}})();if(!String.format)String.format=function(o){if(arguments.length<=1)return o;for(var h=arguments.length-2,j=0;j<=h;j++)o=o.replace(RegExp("\\{"+j+"\\}","gi"),arguments[j+1]);return o};
String.prototype.containsWord=function(o){var h="";if(o.toString)o=o.toString();for(var j=0;j<o.length;j++)h+=!/\w/.test(o[j])?"\\"+o[j]:o[j];return RegExp("(^|\\s|\\,)"+h+"(\\,|\\s|$)","i").test(this)};Number.prototype.toRad=function(){return this*Math.PI/180};Number.prototype.sec=function(){return 1/Math.cos(this)};
GRUNT=function(){var o=Object.prototype.hasOwnProperty,h=0,j={id:"GRUNT.core",extend:function(){var b=arguments[0]||{},f=1,a=arguments.length,d=false,e,k,c,g;if(typeof b==="boolean"){d=b;b=arguments[1]||{};f=2}if(typeof b!=="object"&&!j.isFunction(b))b={};if(a===f){b=this;--f}for(;f<a;f++)if((e=arguments[f])!=null)for(k in e){c=b[k];g=e[k];if(b!==g)if(d&&g&&(j.isPlainObject(g)||j.isArray(g))){c=c&&(j.isPlainObject(c)||j.isArray(c))?c:j.isArray(g)?[]:{};b[k]=j.extend(d,c,g)}else if(g!==undefined)b[k]=
g}return b},isFunction:function(b){return toString.call(b)==="[object Function]"},isArray:function(b){return toString.call(b)==="[object Array]"},isPlainObject:function(b){if(!b||toString.call(b)!=="[object Object]"||b.nodeType||b.setInterval)return false;if(b.constructor&&!o.call(b,"constructor")&&!o.call(b.constructor.prototype,"isPrototypeOf"))return false;var f;for(f in b);return f===undefined||o.call(b,f)},isEmptyObject:function(b){for(var f in b)return false;return true},isXmlDocument:function(b){return toString.call(b)===
"[object Document]"},contains:function(b,f){var a=b,d=arguments,e=1;if(f&&j.isArray(f)){d=f;e=0}for(e=e;e<d;e++)a=a&&typeof foo[d[e]]!=="undefined";return a},newModule:function(b){b=j.extend({id:null,requires:[],parent:null},b);if(b.parent)b=j.extend({},b.parent,b);return b},toID:function(b){return b.replace(/\s/g,"-")},generateObjectID:function(b){return(b?b:"obj")+h++}};return j}();
GRUNT.Log=function(){function o(a,d){var e,k=d&&d.length>0?d[0]:"";for(e=1;d&&e<d.length;e++)k+=" "+(j&&GRUNT.isPlainObject(d[e])?JSON.stringify(d[e]):d[e]);typeof console!=="undefined"&&console[a](k);for(e=0;e<h.length;e++)h[e].call(f,k,a)}var h=[],j=typeof JSON!=="undefined",b=window.console&&window.console.markTimeline,f={id:"GRUNT.log",getTraceTicks:function(){return b?(new Date).getTime():null},trace:function(a,d){if(b)console.markTimeline(a+(d?": "+(f.getTraceTicks()-d)+"ms":""))},debug:function(){o("debug",
arguments)},info:function(){o("info",arguments)},warn:function(){o("warn",arguments)},error:function(){o("error",arguments)},exception:function(a){f.error(arguments);for(var d in a)f.info("ERROR DETAIL: "+d+": "+a[d])},watch:function(a,d){try{d()}catch(e){f.exception(e,a)}},throwError:function(a){f.error(a);throw Error(a);},requestUpdates:function(a){h.push(a)}};return f}();
GRUNT.Data=function(){var o={determineObjectMapping:function(j){if(!j)return null;j=j.split("|");for(var b={},f=0;f<j.length;f++)b[j[f]]=f;return b},mapLineToObject:function(j,b){var f=j.split("|"),a={};for(var d in b){var e=b[d];a[d]=f.length>e?f[e]:null}return a},parse:function(j){var b=null,f=[];j=j.split("\n");for(var a=0;a<j.length;a++){var d=j[a];if(b)f.push(o.mapLineToObject(d,b));else b=o.determineObjectMapping(d)}return f}},h={supportedFormats:{JSON:{parse:function(j){return JSON.parse(j)}},
PDON:{parse:function(j){return o.parse(j)}}},parse:function(j){j=GRUNT.extend({data:"",format:"JSON"},j);if(!h.supportedFormats[j.format])throw Error("Unsupported data format: "+j.format+", cannot parse data in javascript object");try{return h.supportedFormats[j.format].parse(j.data)}catch(b){GRUNT.Log.error("ERROR PARSING DATA FROM FORMAT: "+j.format,j.data);GRUNT.Log.exception(b)}return{}}};return h}();
GRUNT.Template=function(){var o=/\$\{(.*?)\}/ig;return{parse:function(h,j){for(var b=h,f=o.exec(b);f;){b=b.replace(f[0],GRUNT.XPath.first(f[1],j));o.lastIndex=0;f=o.exec(b)}return b}}}();
GRUNT.JSONP=function(){function o(f){var a=document.createElement("script"),d=false;a.src=f;a.async=true;a.onload=a.onreadystatechange=function(){if(!d&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){d=true;a.onload=a.onreadystatechange=null;a&&a.parentNode&&a.parentNode.removeChild(a)}};j||(j=document.getElementsByTagName("head")[0]);j.appendChild(a)}var h=0,j,b=this;return{get:function(f,a){f+=f.indexOf("?")>=0?"&":"?";var d="json"+ ++h;b[d]=function(e){a(e);b[d]=
null;try{delete b[d]}catch(k){}};o(f+"callback="+d);return d}}}();
GRUNT.XHR=function(){var o={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},h={JSON:["json"],PDON:["pdon.txt"]},j=["TEXT","STREAM"],b=/^(\w+:)?\/\/([^\/?#]+)/,f={XML:function(e){return e.responseXML},JSON:function(e){try{return JSON.parse(e.responseText)}catch(k){GRUNT.Log.error("Error parsing JSON data: ",e.responseText);GRUNT.Log.exception(k)}return""},PDON:function(e){return GRUNT.Data.parse({data:e.responseText,format:"PDON"})},DEFAULT:function(e){return e.responseText}},
a={CONTENT_TYPE:"Content-Type"},d=GRUNT.newModule({id:"GRUNT.xhr",ajaxSettings:{xhr:null},ajax:function(e){try{e=GRUNT.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},d.ajaxSettings,e);var k=b.exec(e.url),c=k&&(k[1]&&k[1]!==location.protocol||k[2]!==location.host);if(e.data)e.method="POST";if(e.url){k=null;if(e.xhr)k=e.xhr(e);k||(k=new XMLHttpRequest);k.open(e.method,e.url,e.async);e.data&&k.setRequestHeader("Content-Type",
e.contentType);c||k.setRequestHeader("X-Requested-With","XMLHttpRequest");k.onreadystatechange=function(){if(this.readyState===4){var i=null,l=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(l)if(e.handleResponse)e.handleResponse(this);else{var m=e,q=this.getResponseHeader(a.CONTENT_TYPE),r,p=false;for(r in o)if(q&&q.indexOf(o[r])>=0){p=true;break}q=!p;for(p=0;p<j.length;p++)q=q||j[p]==r;if(q)b:{q=r;for(var n in h)for(p=
0;p<h[n].length;p++)if(RegExp(h[n][p]+"$","i").test(m.url)){r=n;break b}r=q?q:"DEFAULT"}try{i=f[r](this,m)}catch(s){GRUNT.Log.warn("error applying processor '"+r+"' to response type, falling back to default");i=f.DEFAULT(this,m)}}else e.error&&e.error(this)}catch(u){GRUNT.Log.exception(u,"PROCESSING AJAX RESPONSE")}l&&i&&e.success&&e.success.call(this,i)}};k.send(e.method=="POST"?d.param(e.data):null)}else GRUNT.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(g){GRUNT.Log.exception(g)}},
param:function(e){var k=[],c=function(i,l){l=GRUNT.isFunction(l)?l():l;k[k.length]=encodeURIComponent(i)+"="+encodeURIComponent(l)};if(GRUNT.isArray(e))for(var g=0;g<e.length;g++)c(e[g].name,e[g].value);else for(g in e)c(g,e[g]);return k.join("&").replace(/%20/g,"+")}});return d}();
GRUNT.XPath=function(){function o(f){for(var a=null,d=0;d<h.length;d++)if(a=h[d](f))break;return a}var h=[],j=[null,function(f){return f.numberValue},function(f){return f.stringValue},function(f){return f.booleanValue},null,null,null,null,function(f){return f.singleNodeValue?f.singleNodeValue.textContent:null},function(f){return f.singleNodeValue?f.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||GRUNT.Log.warn("No XPATH support, this is going to cause problems");var b={SearchResult:function(f){return{toString:function(){var a=
null;if(f){var d=null;if(f.resultType>=0&&f.resultType<j.length)d=j[f.resultType];if(d){GRUNT.Log.info("invoking match handler for result type: "+f.resultType);a=d(f)}}return a?a:""}}},first:function(f,a){var d=b.SearchResult,e;var k=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!k)k=XPathResult.ANY_TYPE;try{if(GRUNT.isXmlDocument(a))e=a.evaluate(f,a,o,k,null);else{GRUNT.Log.warn("attempted xpath expression: "+f+" on a non-xml document");e=null}}catch(c){GRUNT.Log.warn("attempted to run invalid xpath expression: "+
f+" on node: "+a);e=null}return new d(e)},registerResolver:function(f){h.push(f)}};return b}();GRUNT.WaterCooler=function(){var o={};return{listen:function(h,j){o[h]||(o[h]=[]);j&&o[h].push(j)},say:function(h,j){if(o[h])for(var b=0;b<o[h].length;b++)o[h][b](j)},leave:function(){}}}();
SLICK=function(){var o={copyRect:function(h){return h?new o.Rect(h.origin.x,h.origin.y,h.dimensions.width,h.dimensions.height):null},Settings:function(){var h={};return{get:function(j){return h[j]},set:function(j,b){h[j]=b},extend:function(j){GRUNT.extend(h,j)}}}(),Clock:function(){var h=null;return{getTime:function(j){return j&&h?h:h=(new Date).getTime()}}}(),Vector:function(h,j){return{x:h?h:0,y:j?j:0}},V:function(){return{create:function(h,j){return new o.Vector(h,j)},add:function(){for(var h=
new o.Vector,j=arguments.length;j--;){h.x+=arguments[j].x;h.y+=arguments[j].y}return h},absSize:function(h){return Math.max(Math.abs(h.x),Math.abs(h.y))},diff:function(h,j){return new o.Vector(h.x-j.x,h.y-j.y)},copy:function(h){return h?new o.Vector(h.x,h.y):null},invert:function(h){return new SLICK.Vector(-h.x,-h.y)},offset:function(h,j,b){return new SLICK.Vector(h.x+j,h.y+(b?b:j))}}}(),VectorArray:function(h,j){for(var b=Array(h.length),f=h.length;f--;)b[f]=j?o.V.copy(h[f]):h[f];return{applyOffset:function(a){for(var d=
b.length;d--;){b[d].x+=a.x;b[d].y+=a.y}},getRect:function(){return new SLICK.Rect(Math.min(b[0].x,b[1].x),Math.min(b[0].y,b[1].y),Math.abs(b[0].x-b[1].x),Math.abs(b[0].y-b[1].y))},toString:function(){for(var a="",d=b.length;d--;)a+="["+b[d].toString()+"] ";return a}}},VectorMath:function(){function h(j){if(!j||j.length<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var b={edges:Array(j.length-1),accrued:Array(j.length-1),total:0},f=SLICK.V.diff,a=0;a<j.length-
1;a++){var d=f(j[a],j[a+1]);b.edges[a]=Math.sqrt(d.x*d.x+d.y*d.y);b.accrued[a]=b.total+b.edges[a];b.total+=b.edges[a]}return b}return{edges:h,distance:function(j){return h(j).total},theta:function(j,b,f){f=Math.asin((j.y-b.y)/f);return j.x>b.x?f:Math.PI-f},pointOnEdge:function(j,b,f,a){b=new SLICK.Vector(Math.cos(f)*a,Math.sin(f)*a);return new SLICK.Vector(j.x-b.x,j.y-b.y)}}}(),Dimensions:function(h,j){var b=j?h/j:1,f={width:h,height:j,aspect_ratio:b,inv_aspect_ratio:1/b,getAspectRatio:function(){return f.height!==
0?f.width/f.height:1},getCenter:function(){return new SLICK.Vector(f.width>>1,f.height>>1)},grow:function(a,d){return new SLICK.Dimensions(f.width+a,f.height+d)},matches:function(a){return a&&f.width==a.width&&f.height==a.height},toString:function(){return f.width+" x "+f.height}};return f},Rect:function(h,j,b,f){var a={origin:new SLICK.Vector(h,j),dimensions:new SLICK.Dimensions(b,f),getCenter:function(){return new SLICK.Vector(a.origin.x+(a.dimensions.width>>1),a.origin.y+(a.dimensions.height>>
1))},getSize:function(){return Math.sqrt(Math.pow(a.dimensions.width,2)+Math.pow(a.dimensions.height,2))},grow:function(d,e){var k=new SLICK.Dimensions(d-a.dimensions.width,e-a.dimensions.height);a.dimensions.width=d;a.dimensions.height=e;return k},expand:function(d,e){a.origin.x-=d;a.origin.y-=e;a.dimensions.width+=d;a.dimensions.height+=e},offset:function(d){return new o.Rect(a.origin.x+d.x,a.origin.y+d.y,a.dimensions.width,a.dimensions.height)},getRequiredDelta:function(d,e){var k={top:0,left:0,
bottom:0,right:0};k.top=d.origin.y-a.origin.y+(e?e.y:0);k.left=d.origin.x-a.origin.x+(e?e.x:0);k.right=d.origin.x+d.dimensions.width-(a.origin.x+a.dimensions.width)-k.left;k.bottom=d.origin.y+d.dimensions.height-(a.origin.y+a.dimensions.height)-k.top;return k},applyDelta:function(d,e,k){if(!d||!GRUNT.contains(d,["top","left","bottom","right"]))throw Error("Invalid delta - cannot apply to SLICK.Rect");e||(e=1);a.origin.x+=d.left*e;a.origin.y+=d.top*e;a.dimensions.width+=d.right*e;a.dimensions.height+=
d.bottom*e;k&&a.constrainAspectRatio(k)},constrainAspectRatio:function(d){var e=0,k={top:0,left:0,bottom:0,right:0};if(a.dimensions.getAspectRatio()<d){e=Math.abs(a.dimensions.width-a.dimensions.height*d);k.left=-e;k.right=e}else{e=Math.abs(a.dimensions.height-a.dimensions.width/d);k.top=-e;k.bottom=e}a.applyDelta(k)},moveTo:function(d,e){var k=new SLICK.Vector(d-a.origin.x,e-a.origin.y);a.origin.x=d;a.origin.y=e;return k},toString:function(){return String.format("(origin: {0}, dimensions: {1})",
a.origin,a.dimensions)}};return a}};return o}();
SLICK.Device=function(){function o(){h={base:{name:"Unknown",eventTarget:document,supportsTouch:"createTouch"in document,imageCacheMaxSize:4096,getScaling:function(){return 1},maxImageLoads:4,requireFastDraw:false},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:true},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144},android:{name:"Android OS <= 2.1",regex:/android/i,eventTarget:document.body,
supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio}},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true}};j=[h.froyo,h.android,h.ipod,h.iphone,h.ipad]}var h=null,j=[],b=null;return{getConfig:function(){h||o();if(!b){GRUNT.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var f=0;f<j.length;f++){var a=j[f];if(a.regex&&a.regex.test(navigator.userAgent)){b=GRUNT.extend({},h.base,a);GRUNT.Log.info("PLATFORM DETECTED AS: "+
b.name);break}}if(!b){GRUNT.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");b=h.base}GRUNT.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return b}}}();
SLICK.Resources=function(){var o="",h={},j=function(){function f(){var p=k[this.id];if(p){p.loaded=true;p.hitCount=1;for(var n=i.length;n--;)if(i[n].image.src==this.src){i.splice(n,1);break}p.loadCallback&&p.loadCallback(this,false);l.push({url:this.src,created:p.requested});delete k[this.id];a()}}function a(){for(var p=SLICK.Device.getConfig().maxImageLoads;g.length>0&&(!p||i.length<p);){var n=g.shift();i.push(n);n.image.onload=f;n.image.src=n.url;n.requested=(new Date).getTime()}}function d(){q=
true;try{var p=Math.floor(l.length*0.5);if(p>0){l.sort(function(s,u){return s.created-u.created});for(var n=p;n--;)delete e[l[n].url];l.splice(0,p)}}finally{q=false}GRUNT.WaterCooler.say("imagecache.cleared")}var e={},k={},c=0,g=[],i=[],l=[],m=0,q=false,r={loadingImages:i,queuedImages:g,getCacheFullness:function(){return m},getImage:function(p){var n=null;q||(n=e[p]);return n?n.image:null},loadImage:function(p,n){var s=e[p];if(s){s.hitCount++;s.image.complete&&n&&n(s.image,true)}else{s={url:b.getPath(p),
image:new Image,loaded:false,created:(new Date).getTime(),requested:null,hitCount:0,loadCallback:n};s.image.id="resourceLoaderImage"+c++;e[p]=s;k[s.image.id]=s;g.push(s);a()}return s},resetLoadingQueue:function(){i=[]}};setInterval(function(){for(var p=(new Date).getTime(),n=false,s=0,u=SLICK.Device.getConfig();s<i.length;)if(p-i[s].requested>b.loadTimeout*1E3){i.splice(s,1);n=true}else s++;n&&a();if(u&&u.imageCacheMaxSize){m=l.length*b.avgImageSize/u.imageCacheMaxSize;m>=1&&d()}},1E3);return r}(),
b={avgImageSize:25,loadTimeout:10,Cache:function(){return{read:function(){return null},write:function(){},getUrlCacheKey:function(f,a){for(var d=(f?f.replace(/^.*\?/,""):"").split("&"),e=f?f.replace(/\?.*$/,"?"):"",k=0;k<d.length;k++){var c=d[k].split("=");if(!a||!a.test(c[0]))e+=d[k]+"&"}return e.replace(/\W/g,"")},isValidCacheKey:function(f){GRUNT.Log.info("cache key = "+f);return false}}}(),getCachedUrl:function(f){return f},getPath:function(f){return/^(https?|\/)/.test(f)?f:o+f},setBasePath:function(f){o=
f},getImage:function(f){return j.getImage(f)},loadImage:function(f,a){j.loadImage(f,a)},resetImageLoadQueue:function(){j.resetLoadingQueue()},getStats:function(){return{imageLoadingCount:j.loadingImages.length,queuedImageCount:j.queuedImages.length,imageCacheFullness:j.getCacheFullness()}},loadResource:function(f){f=GRUNT.extend({filename:"",cacheable:true,dataType:null,callback:null},f);var a=function(d){f.callback&&GRUNT.Log.watch("CALLING RESOURCE CALLBACK",function(){f.callback(d)})};f.cacheable&&
h[f.filename]?a(h[f.filename]):GRUNT.XHR.ajax({url:b.getPath(f.filename),dataType:f.dataType,success:function(d){if(f.cacheable)h[f.filename]=d;a(d)},error:function(d,e,k){GRUNT.Log.error("error loading resource ["+f.filename+"], error = "+k)}})},loadSnippet:function(f,a){/\.\w+$/.test(f)||(f+=".html");b.loadResource({filename:"snippets/"+f,callback:a,dataType:"html"})}};return b}();
SLICK.Touch=function(){function o(c,g){var i=c&&c.length>0?c[0]:null;if(i&&g&&g.length>0)return SLICK.V.diff(i,g[0]);return null}function h(c){c.preventDefault();c.stopPropagation()}function j(c,g){function i(q,r){for(var p=c[r],n=0;p&&n<p.length;n++)q.push(new SLICK.Vector(p[n].pageX,p[n].pageY))}g||(g=f);for(var l=[],m=0;m<g.length;m++){i(l,g[m]);if(l.length>0)break}l.length===0&&l.push(new SLICK.Vector(c.pageX,c.pageY));return l}var b={GLOBAL:"touches",TARGET:"targetTouches",CHANGED:"changedTouches"},
f=[b.GLOBAL,b.TARGET],a={TAP:0,MOVE:1,PINCHZOOM:2},d=0,e={TouchHelper:function(c){function g(t){t=new SLICK.VectorArray(t,true);c.element&&t.applyOffset(new SLICK.Vector(-c.element.offsetLeft,-c.element.offsetTop));return t}function i(t){var y=[],A=0;for(A=1;A<arguments.length;A++)y.push(arguments[A]);for(A=0;A<x.length;A++)x[A][t]&&x[A][t].apply(E,y)}c=GRUNT.extend({element:null,inertiaTrigger:20,maxDistDoubleTap:20,panEventThreshhold:0,pinchZoomThreshold:5,touchStartHandler:null,moveHandler:null,
moveEndHandler:null,pinchZoomHandler:null,pinchZoomEndHandler:null,tapHandler:null,doubleTapHandler:null,wheelZoomHandler:null},c);var l=false,m=0,q=null,r=null,p=null,n=null,s=new SLICK.Vector,u=null,B=false,x=[],C={current:0,last:0},D=SLICK.Device.getConfig(),E={supportsTouch:SLICK.Device.getConfig().supportsTouch,THRESHOLD_DOUBLETAP:300,addListeners:function(t){x.push(t)},wheelie:function(t){var y=new SLICK.Vector(t.wheelDeltaX,t.wheelDeltaY);t=new SLICK.Vector(t.clientX,t.clientY);var A=y.y!==
0?Math.abs(y.y/120):0;if(A!==0)i("wheelZoomHandler",t,y.y>0?A+0.5:0.5/A);GRUNT.Log.info("capture mouse wheel event, delta = "+y+", position = "+t)}};D.eventTarget.addEventListener(D.supportsTouch?"touchstart":"mousedown",function(t){q=j(t);p=new SLICK.Vector;n=new SLICK.Vector;B=true;l=false;if(t.target&&t.target===c.element){h(t);C.current=SLICK.Clock.getTime();if(t=q.length>0?q[0]:null){i("touchStartHandler",t.x,t.y);if(C.current-C.last<E.THRESHOLD_DOUBLETAP)if((t=r?SLICK.V.diff(q[0],r[0]):null)&&
Math.abs(t.x)<c.maxDistDoubleTap&&Math.abs(t.y)<c.maxDistDoubleTap)l=true;u=a.TAP;r=[].concat(q)}else GRUNT.Log.warn("Touch start fired, but no touch vector found")}},false);D.eventTarget.addEventListener(D.supportsTouch?"touchmove":"mousemove",function(t){if(B)if(t.target&&t.target===c.element)try{h(t);var y=j(t);t=0;if(y.length>1){if(q.length===1)q=[].concat(y);t=SLICK.VectorMath.distance(q)-SLICK.VectorMath.distance(r)}if(u===a.TAP){var A=o(y,q);if(A&&(Math.abs(A.x)>=7||Math.abs(A.y)>=7))u=a.MOVE}if(u!==
a.TAP)if(!t||Math.abs(t)<c.pinchZoomThreshold){if(p=o(y,r)){n.x+=p.x;n.y+=p.y;s.x+=p.x;s.y+=p.y}if(SLICK.V.absSize(s)>c.panEventThreshhold){i("moveHandler",s.x,s.y);s=SLICK.V.create()}u=a.MOVE}else{i("pinchZoomHandler",g(q),g(y));u=a.PINCHZOOM}r=[].concat(y)}catch(J){GRUNT.Log.exception(J)}},false);D.eventTarget.addEventListener(D.supportsTouch?"touchend":"mouseup",function(t){if(t.target&&t.target===c.element)try{h(t);SLICK.Clock.getTime();C.last=C.current;if(u===a.TAP)m||(m=setTimeout(function(){m=
0;var A=l?"doubleTapHandler":"tapHandler",J=q[0],G=null;if(c.element)G=SLICK.V.offset(J,-c.element.offsetLeft,-c.element.offsetTop);i(A,J,G)},E.THRESHOLD_DOUBLETAP+50));else if(u==a.MOVE)i("moveEndHandler",n.x,n.y);else u==a.PINCHZOOM&&i("pinchZoomEndHandler",g(q),g(r));B=false}catch(y){GRUNT.Log.exception(y)}},false);return E}},k=[];return{captureTouch:function(c,g){try{if(!c)throw Error("Unable to capture touch of null element");if(!c.id)c.id="touchable_"+d++;var i=k[c.id];if(!i){i=e.TouchHelper(GRUNT.extend({element:c},
g));k[c.id]=i;GRUNT.Log.info("CREATED TOUCH HELPER. SUPPORTS TOUCH = "+i.supportsTouch)}i.addListeners(g)}catch(l){GRUNT.Log.exception(l)}}}}();if(typeof jQuery!=="undefined"){jQuery.fn.canTouchThis=function(o){return this.each(function(){SLICK.Touch.captureTouch(this,o)})};jQuery.fn.untouchable=function(){return this.bind("touchmove",function(o){o.preventDefault()})}}
SLICK.Pannable=function(o){o=GRUNT.extend({container:null,onPan:null,onPanEnd:null,onAnimate:null,checkOffset:null},o);var h=false,j=new SLICK.Vector,b={pannable:true,getOffset:function(){return new SLICK.Vector(j.x,j.y)},setOffset:function(a,d){j.x=a;j.y=d},pan:function(a,d,e){if(e)b.updateOffset(j.x+a,j.y+d,e);else{b.updateOffset(j.x+a,j.y+d);o.onPan&&o.onPan(a,d)}},isAnimating:function(){return h},panEnd:function(a,d){o.onPanEnd&&o.onPanEnd(a,d)},updateOffset:function(a,d,e){if(e){a=new SLICK.Vector(a,
d);h=true;e=SLICK.Animation.tweenVector(j,a.x,a.y,e,function(){h=false;b.panEnd(0,0)});for(a=e.length;a--;){e[a].cancelOnInteract=true;e[a].requestUpdates(function(){o.onAnimate&&o.onAnimate(j.x,j.y)})}}else b.setOffset(a,d)}},f=document.getElementById(o.container);f&&SLICK.Touch.captureTouch(f,{moveHandler:function(a,d){b.pan(-a,-d)},moveEndHandler:function(a,d){b.panEnd(a,d)}});return b};
SLICK.Scalable=function(o){function h(l,m){b=l.getRect();f=m.getRect();var q=b.getSize(),r=f.getSize();c=f.getCenter();a=b&&q!==0?r/q:1}o=GRUNT.extend({container:null,onAnimate:null,onPinchZoom:null,onScale:null,scaleDamping:false},o);var j=false,b=null,f=null,a=1,d=null,e=null,k=null,c=null,g={scalable:true,animate:function(l,m,q,r,p){function n(){p&&p();j=false;o.onScale&&o.onScale(a,c);a=1;d=null}j=true;k=SLICK.V.copy(m);c=SLICK.V.copy(q);b=null;if(r){e=a;SLICK.Animation.tweenValue(0,l-e,r,n,1E3).requestUpdates(function(s){d=
s/(l-e);a=e+s;o.onAnimate&&o.onAnimate()})}else{a=l;n()}},getScaleInfo:function(){return{factor:a,startRect:SLICK.copyRect(b),endRect:SLICK.copyRect(f),start:k,center:c,progress:d}},getScaling:function(){return j},getScaleFactor:function(){return a}},i=document.getElementById(o.container);i&&SLICK.Touch.captureTouch(i,{pinchZoomHandler:function(l,m){h(l,m);(j=a!==1)&&o.onPinchZoom&&o.onPinchZoom(l,m)},pinchZoomEndHandler:function(l,m){h(l,m);j=false;o.onScale&&o.onScale(a,c,true);a=1},wheelZoomHandler:function(l){b=
f=null;c=SLICK.V.copy(l)}});return g};
SLICK.Dispatcher=function(){var o=[],h={execute:function(j){var b=h.findAction(j);GRUNT.Log.info("looking for action id: "+j+", found: "+b);if(b){var f=[].concat(arguments).slice(0,1);GRUNT.Log.watch("EXECUTING ACTION: "+j,function(){b.execute(f)})}},findAction:function(j){for(var b=o.length;b--;)if(o[b].id==j)return o[b];return null},getRegisteredActions:function(){return[].concat(o)},getRegisteredActionIds:function(){for(var j=[],b=o.length;b--;)o[b].id&&j.push(o[b].id);return j},registerAction:function(j){j&&
j.id&&o.push(j)},Action:function(j){j=GRUNT.extend({autoRegister:true,id:"",title:"",icon:"",execute:null},j);var b={id:j.id,execute:function(){j.execute&&j.execute.apply(this,arguments)},getParam:function(f){return j[f]?j[f]:""},toString:function(){return String.format("{0} [title = {1}, icon = {2}]",b.id,j.title,j.icon)}};j.autoRegister&&h.registerAction(b);return b},createAgent:function(j){j=GRUNT.extend({name:"Untitled",trashOrphanedResults:true,translator:null,execute:null},j);var b=null,f={getName:function(){return j.name},
getParam:function(a){return j[a]},getId:function(){return GRUNT.toID(f.getName())},run:function(a,d){if(j.execute){var e=b=SLICK.Clock.getTime(true),k=j.translator?j.translator(a):a;j.execute.call(f,k,function(c,g){if(!j.trashOrphanedResults||e==b)d&&d(c,g,k)})}}};return f},runAgents:function(j,b,f){for(var a=0;a<j.length;a++)j[a].run(b,f)}};return h}();
SLICK.Messaging=function(){var o=[],h=[],j=GRUNT.newModule({id:"slick.messaging",requires:["slick.core"],STATUS:{none:0,created:1,updated:2,handled:3},send:function(b){b=GRUNT.extend({type:"",payload:{},index:0,status:j.STATUS.created,statusChange:null},b);b.index=h.push(b)-1;b=b.index;var f=b>=0&&b<h.length?h[b]:null;GRUNT.Log.info("firing message update, index = "+b+", message = "+f);for(var a=0;f&&a<o.length&&f.status!==j.STATUS.handled;){var d=o[a].processUpdate(h[b]);if(d){d=d;o[a].getId();var e=
b>=0&&b<h.length?h[b]:null;if(e){e.status=d;e.statusChange&&e.statusChange(e)}}a++}},Handler:function(b){b=GRUNT.extend({id:"",processUpdate:null},b);var f={getId:function(){return b.id},processUpdate:function(a){if(b.processUpdate)return b.processUpdate(a);return j.STATUS.none}};o.push(f);return f}});return j}();
SLICK.Animation=function(){function o(){if(b===0)b=setInterval(function(){if(f.update(SLICK.Clock.getTime())===0){clearInterval(b);b=0}},20)}var h=[],j=false,b=0,f={DURATION:2E3,tweenValue:function(a,d,e,k,c){a=new f.Tween({startValue:a,endValue:d,tweenFn:e,complete:k,duration:c});h.push(a);return a},tween:function(a,d,e,k,c,g){a=new f.Tween({target:a,property:d,endValue:e,tweenFn:k,duration:g,complete:c});h.push(a);return a},tweenVector:function(a,d,e,k,c,g){var i=[];if(a){var l=a.x==d,m=a.y==e;
l||i.push(f.tween(a,"x",d,k,function(){(l=true)&&m&&c()},g));m||i.push(f.tween(a,"y",e,k,function(){m=true;l&&m&&c()},g))}return i},cancel:function(a){if(!j){j=true;try{for(var d=0;d<h.length;)if(!a||a(h[d])){GRUNT.Log.info("CANCELLING ANIMATION");h[d].triggerComplete(true);h.splice(d,1)}else d++}finally{j=false}}},isTweening:function(){return h.length>0},update:function(a){if(j)return h.length;j=true;try{for(var d=0;d<h.length;)if(h[d].isComplete()){h[d].triggerComplete(false);h.splice(d,1);GRUNT.WaterCooler.say("animation.complete")}else{h[d].update(a);
d++}}finally{j=false}return h.length},Tween:function(a){a=GRUNT.extend({target:null,property:null,startValue:0,endValue:null,duration:f.DURATION,tweenFn:f.DEFAULT,complete:null,cancelOnInteract:false},a);var d=SLICK.Clock.getTime(),e=[],k=false,c=0,g=0,i={cancelOnInteract:a.cancelOnInteract,isComplete:function(){return k},triggerComplete:function(l){a.complete&&a.complete(l)},update:function(l){try{var m=a.tweenFn(l-d,c,g,a.duration);if(a.target)a.target[a.property]=m;for(var q=e.length;q--;)e[q](m,
void 0);if(k=d+a.duration<=l){if(a.target)a.target[a.property]=a.tweenFn(a.duration,c,g,a.duration);for(var r=e.length;r--;)e[r](m,true)}}catch(p){GRUNT.Log.exception(p)}},requestUpdates:function(l){e.push(l)}};c=a.target&&a.property&&a.target[a.property]?a.target[a.property]:a.startValue;if(typeof a.endValue!=="undefined")g=a.endValue-c;if(g==0)k=true;o();return i},Easing:function(){var a=1.70158;return{Linear:function(d,e,k,c){return k*d/c+e},Back:{In:function(d,e,k,c){return k*(d/=c)*d*((a+1)*
d-a)+e},Out:function(d,e,k,c){return k*((d=d/c-1)*d*((a+1)*d+a)+1)+e},InOut:function(d,e,k,c){return(d/=c/2)<1?k/2*d*d*(((a*=1.525)+1)*d-a)+e:k/2*((d-=2)*d*(((a*=1.525)+1)*d+a)+2)+e}},Bounce:{In:function(d,e,k,c){return k-f.Easing.Bounce.Out(c-d,0,k,c)+e},Out:function(d,e,k,c){return(d/=c)<1/2.75?k*7.5625*d*d+e:d<2/2.75?k*(7.5625*(d-=1.5/2.75)*d+0.75)+e:d<2.5/2.75?k*(7.5625*(d-=2.25/2.75)*d+0.9375)+e:k*(7.5625*(d-=2.625/2.75)*d+0.984375)+e},InOut:function(d,e,k,c){return d<c/2?f.Easing.Bounce.In(d*
2,0,k,c)*0.5+e:f.Easing.Bounce.Out(d*2-c,0,k,c)*0.5+k*0.5+e}},Cubic:{In:function(d,e,k,c){return k*(d/=c)*d*d+e},Out:function(d,e,k,c){return k*((d=d/c-1)*d*d+1)+e},InOut:function(d,e,k,c){if((d/=c/2)<1)return k/2*d*d*d+e;return k/2*((d-=2)*d*d+2)+e}},Elastic:{In:function(d,e,k,c,g,i){if(d==0)return e;if((d/=c)==1)return e+k;i||(i=c*0.3);if(!g||g<Math.abs(k)){g=k;k=i/4}else k=i/(2*Math.PI)*Math.asin(k/g);return-(g*Math.pow(2,10*(d-=1))*Math.sin((d*c-k)*2*Math.PI/i))+e},Out:function(d,e,k,c,g,i){var l;
if(d==0)return e;if((d/=c)==1)return e+k;i||(i=c*0.3);if(!g||g<Math.abs(k)){g=k;l=i/4}else l=i/(2*Math.PI)*Math.asin(k/g);return g*Math.pow(2,-10*d)*Math.sin((d*c-l)*2*Math.PI/i)+k+e},InOut:function(d,e,k,c,g,i){var l;if(d==0)return e;if((d/=c/2)==2)return e+k;i||(i=c*0.3*1.5);if(!g||g<Math.abs(k)){g=k;l=i/4}else l=i/(2*Math.PI)*Math.asin(k/g);if(d<1)return-0.5*g*Math.pow(2,10*(d-=1))*Math.sin((d*c-l)*2*Math.PI/i)+e;return g*Math.pow(2,-10*(d-=1))*Math.sin((d*c-l)*2*Math.PI/i)*0.5+k+e}},Quad:{In:function(d,
e,k,c){return k*(d/=c)*d+e},Out:function(d,e,k,c){return-k*(d/=c)*(d-2)+e},InOut:function(d,e,k,c){if((d/=c/2)<1)return k/2*d*d+e;return-k/2*(--d*(d-2)-1)+e}},Sine:{In:function(d,e,k,c){return-k*Math.cos(d/c*(Math.PI/2))+k+e},Out:function(d,e,k,c){return k*Math.sin(d/c*(Math.PI/2))+e},InOut:function(d,e,k,c){return-k/2*(Math.cos(Math.PI*d/c)-1)+e}}}}()};return GRUNT.extend(f,{DEFAULT:f.Easing.Back.Out})}();SLICK.Border={NONE:0,TOP:1,RIGHT:2,BOTTOM:3,LEFT:4};
SLICK.Graphics=function(){var o={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,PINCHZOOM:16,FREEZE:128},h=0,j={DisplayState:o,AnyDisplayState:255,ActiveDisplayStates:o.ACTIVE|o.ANIMATING,DefaultDisplayStates:o.ACTIVE|o.ANIMATING|o.PAN|o.PINCHZOOM,ViewLayer:function(b){b=GRUNT.extend({id:"",centerOnScale:true,created:(new Date).getTime(),scalePosition:true,zindex:0,supportFastDraw:false,validStates:j.DefaultDisplayStates},b);var f=null,a=GRUNT.extend({isAnimating:function(){return false},addToView:function(d){d.setLayer(b.id,
a)},shouldDraw:function(d){var e=f?f.fastDraw&&d!==o.ACTIVE:false;return(d&b.validStates)!==0&&(e?b.supportFastDraw:true)},cycle:function(){return 0},draw:function(){},notify:function(){},remove:function(){GRUNT.WaterCooler.say("layer.remove",{id:b.id})},wakeParent:function(){GRUNT.WaterCooler.say("view.wake",{id:f?f.id:null})},getParent:function(){return f},setParent:function(d){f=d}},b);return a},StatusViewLayer:function(){return new j.ViewLayer({validStates:j.AnyDisplayState,zindex:5E3,draw:function(b,
f,a,d,e){b.fillStyle="#FF0000";b.fillRect(10,10,50,50);b.fillStyle="#FFFFFF";b.font="bold 10px sans";b.fillText(e.getDisplayState(),20,20)}})},AnimatedPathLayer:function(b){function f(g,i,l){g.fillStyle="#FFFFFF";g.strokeStyle="#222222";g.beginPath();g.arc(l.x,l.y,4,0,Math.PI*2,false);g.stroke();g.fill()}b=GRUNT.extend({path:[],id:GRUNT.generateObjectID("pathAnimation"),easing:SLICK.Animation.Easing.Sine.InOut,canCache:false,validStates:j.ActiveDisplayStates|o.PAN|o.PINCHZOOM,drawIndicator:null,duration:2E3,
autoCenter:false},b);var a=SLICK.VectorMath.edges(b.path),d,e=null,k=0;SLICK.Animation.tweenValue(0,a.total,b.easing,function(){c.remove()},b.duration).requestUpdates(function(g,i){k=g;i&&c.remove()});var c=GRUNT.extend(new j.ViewLayer(b),{cycle:function(){for(var g=0;g<a.accrued.length&&a.accrued[g]<k;)g++;e=null;if(g<b.path.length-1){var i=k-(g>0?a.accrued[g-1]:0),l=b.path[g],m=b.path[g+1];d=SLICK.VectorMath.theta(l,m,a.edges[g]);e=SLICK.VectorMath.pointOnEdge(l,m,d,i);if(b.autoCenter)(g=c.getParent())&&
g.centerOn(e)}return e?1:0},draw:function(g,i){if(e)(b.drawIndicator?b.drawIndicator:f)(g,i,new SLICK.Vector(e.x-i.x,e.y-i.y),d)}});return c},FPSLayer:function(b){b=GRUNT.extend({zindex:1E3,scalePosition:false},b);var f=null,a=GRUNT.extend(new j.ViewLayer(b),{delays:[],draw:function(d,e,k){d.font="bold 8pt Arial";d.textAlign="right";d.fillStyle="rgba(0, 0, 0, 0.8)";d.fillText((f?f:"?")+" fps",k.width-20,20)}});setInterval(function(){for(var d=0,e=a.delays.length,k=e;k--;)d+=a.delays[k];if(e!==0)f=
Math.floor(1E3/(d/e))},1E3);return a},ResourceStatsLayer:function(b){b=GRUNT.extend({zindex:500,indicatorSize:5,scalePosition:false,validStates:o.ACTIVE|o.PAN},b);return GRUNT.extend(new j.ViewLayer(b),{fps:null,draw:function(f){var a=SLICK.Resources.getStats(),d=b.indicatorSize,e=10,k;if(a.imageCacheFullness){f.strokeStyle="rgba(0, 0, 255, 1)";f.beginPath();f.arc(15,15,5,0,Math.PI*2*a.imageCacheFullness,false);f.stroke();e=30}if(a.imageLoadingCount>=0){f.fillStyle="rgba(0, 255, 0, 0.7)";for(k=a.imageLoadingCount;k--;)f.fillRect(e+
k*(d+2),10,d,d)}if(a.queuedImageCount>=0){f.fillStyle="rgba(255, 0, 0, 0.7)";for(k=a.queuedImageCount;k--;)f.fillRect(e+k*(d+2),10+d+2,d,d)}}})},LoadingLayer:function(b){GRUNT.extend({},b)},View:function(b){function f(v,w){w.id=v;w.setParent(F);c.push(w);c.sort(function(z,H){var I=H.zindex-z.zindex;if(I===0)I=H.created-z.created;return I})}function a(){GRUNT.Log.info("view idle, "+c.length+" active layers");GRUNT.WaterCooler.say("view-idle",{id:F.id});A=true;G=0}function d(v,w){var z=0,H=F.getScaleFactor(),
I=F.getDisplayState(),S=(new Date).getTime(),Q=(I&o.PINCHZOOM)!==0;q=F.getScaleFactor();var P=0;if(m||Q){v.clearRect(0,0,g.width,g.height);m=false}if(Q){var K=y.getScaleInfo();F.getDimensions().getCenter();var N=(K.progress?K.progress:1)*0.5;E=K.center;if(K.startRect){N=K.startRect.getCenter();N=SLICK.V.diff(N,E);L=new SLICK.Vector(E.x+N.x,E.y+N.y)}else{K=SLICK.V.diff(K.start,E);L=new SLICK.Vector(E.x-K.x*N,E.y-K.y*N)}if(L)w=SLICK.V.offset(w,L.x,L.y)}v.save();try{if(s!==1)v.scale(s,s);else if(Q){v.translate(E.x,
E.y);v.scale(H,H)}for(P=c.length;P--;)if(c[P].shouldDraw(I)){var R=c[P].draw(v,w,B,I,F);z+=R?R:0}}finally{v.restore()}GRUNT.Log.trace("draw complete",S);return z}function e(){var v=0,w=M===o.PINCHZOOM||M===o.PAN;O=(new Date).getTime();l=t?t.getOffset():new SLICK.Vector;D&&r&&D.delays.push(O-r);if(w){SLICK.Animation.cancel(function(H){return H.cancelOnInteract});A=false;if(G!==0){clearTimeout(G);G=0}}for(w=c.length;w--;){var z=c[w].cycle(O,l);v+=z?z:0}v+=d(i,l);r=O;J=0;if(C+v>0)k();else if(!A&&G===
0)G=setTimeout(a,500);GRUNT.Log.trace("Completed draw cycle",O)}function k(){C++;if(!(n||J!==0)){C=0;J=setTimeout(e,0)}}b=GRUNT.extend({id:"view_"+h++,container:"",pannable:false,scalable:false,clearOnDraw:false,displayFPS:true,displayResourceStats:true,scaleDamping:false,fastDraw:false,fillStyle:"rgb(200, 200, 200)",initialDrawMode:"source-over",bufferRefresh:100,defaultFreezeDelay:500,onPan:null,onPinchZoom:null,onScale:null,onDraw:null,autoSize:false},b);var c=[],g=document.getElementById(b.container),
i=null,l=new SLICK.Vector,m=false,q=1,r=null,p=0,n=false,s=1,u=new SLICK.Vector,B=null,x=null,C=0,D=null,E=null,t=null,y=null,A=false,J=0,G=0,L=null,O=0,M=j.DisplayState.ACTIVE;GRUNT.Log.info("Creating a new view instance, attached to container: "+b.container+", canvas = ",g);if(g){if(b.autoSize){GRUNT.Log.info("autosizing view: window.height = "+window.innerHeight+", width = "+window.innerWidth);g.height=window.innerHeight-g.offsetTop-49;g.width=window.innerWidth-g.offsetLeft}try{i=g.getContext("2d");
i.globalCompositeOperation=b.initialDrawMode}catch(T){GRUNT.Log.exception(T);throw Error("Could not initialise canvas on specified view element");}}if(b.pannable)t=new SLICK.Pannable({container:b.container,onAnimate:function(){k()},onPan:function(v,w){p=SLICK.Clock.getTime(true);k();u=SLICK.V.offset(u,v,w);b.onPan&&b.onPan(v,w);M=o.PAN},onPanEnd:function(){k();M=o.ACTIVE}});if(b.scalable)y=new SLICK.Scalable({scaleDamping:b.scaleDamping,container:b.container,onAnimate:function(){M=j.DisplayState.PINCHZOOM;
k()},onPinchZoom:function(v,w){p=SLICK.Clock.getTime(true);k();b.onPinchZoom&&b.onPinchZoom(v,w);M=j.DisplayState.PINCHZOOM},onScale:function(v,w){GRUNT.WaterCooler.say("view.scale",{id:F.id});M=j.DisplayState.ACTIVE;k();b.onScale&&b.onScale(v,w)}});var F=GRUNT.extend({},b,t,y,{id:b.id,deviceScaling:s,fastDraw:b.fastDraw||SLICK.Device.getConfig().requireFastDraw,centerOn:function(v){t.setOffset(v.x-g.width*0.5,v.y-g.height*0.5)},getDimensions:function(){if(g)return new SLICK.Dimensions(g.width,g.height)},
getZoomCenter:function(){return L},getLayer:function(v){for(var w=0;w<c.length;w++)if(c[w].id==v){/^grid/i.test(v)||GRUNT.Log.info("found layer: "+v);return c[w]}return null},setLayer:function(v,w){for(var z=0;z<c.length;z++)if(c[z].id===v){c.splice(z,1);break}w&&f(v,w);GRUNT.WaterCooler.say("layer.update",{value:w});k()},eachLayer:function(v){for(var w=0;w<c.length;w++)v(c[w])},clearBackground:function(){m=true},freeze:function(){n=true},unfreeze:function(){n=false;k()},snapshot:function(){},getDisplayState:function(){return n?
o.FROZEN:M},scale:function(v,w,z,H,I){H||(H=F.getDimensions().getCenter());I||(I=F.getDimensions().getCenter());y&&y.animate(v,H,I,w,z);return y},removeLayer:function(v,w){setTimeout(function(){var z;a:{for(z=c.length;z--;)if(c[z].id==v){z=z;break a}z=-1}if(z>=0&&z<c.length){GRUNT.WaterCooler.say("layer.remove",{layer:c[z]});c.splice(z,1)}},w?w:1)}});B=F.getDimensions();x=B.getCenter();GRUNT.WaterCooler.listen("layer.remove",function(v){v.id&&F.removeLayer(v.id)});GRUNT.WaterCooler.listen("view.wake",
function(v){if(!v.id||v.id===F.id)k()});s=SLICK.Device.getConfig().getScaling();if(b.displayFPS){D=new j.FPSLayer;F.setLayer("fps",D)}b.displayResourceStats&&F.setLayer("resourceStats",new j.ResourceStatsLayer);k();return F}};return j}();
SLICK.Tiling=function(){function o(){if(!j){j=document.createElement("canvas");j.width=f.Config.TILESIZE;j.height=f.Config.TILESIZE;var a=j.getContext("2d");a.fillStyle="rgba(150, 150, 150, 0.05)";a.fillRect(0,0,j.width,j.height)}return j}function h(){if(!b){b=document.createElement("canvas");b.width=f.Config.TILESIZE;b.height=f.Config.TILESIZE;var a=b.getContext("2d"),d=Math.sqrt(f.Config.TILESIZE);a.fillStyle="rgba(200, 200, 200, 1)";a.strokeStyle="rgb(190, 190, 190)";a.lineWidth=0.5;a.fillRect(0,
0,b.width,b.height);a.beginPath();for(var e=0;e<b.width;e+=d){a.moveTo(e,0);a.lineTo(e,b.height);for(var k=0;k<b.height;k+=d){a.moveTo(0,k);a.lineTo(b.width,k)}}a.stroke()}return b}TileStore=function(a){a=GRUNT.extend({gridSize:20,center:new SLICK.Vector,onPopulate:null},a);var d=Array(Math.pow(a.gridSize,2)),e=SLICK.V.offset(a.center,-Math.ceil(a.gridSize>>1)),k=null,c=new SLICK.Vector,g=null;GRUNT.Log.info("created tile store with tl offset = "+e);var i={getGridSize:function(){return a.gridSize},
getNormalizedPos:function(l,m){return SLICK.V.add(new SLICK.Vector(l,m),SLICK.V.invert(e),c)},getTileShift:function(){return SLICK.V.copy(c)},getTile:function(l,m){return l>=0&&l<a.gridSize?d[m*a.gridSize+l]:null},setTile:function(l,m,q){d[m*a.gridSize+l]=q},populate:function(l,m){var q=GRUNT.Log.getTraceTicks(),r=0;new SLICK.Vector(a.gridSize*0.5,a.gridSize*0.5);GRUNT.Log.info("poulating grid, top left offset = "+e);if(l)for(var p=0;p<a.gridSize;p++)for(var n=0;n<a.gridSize;n++){if(!d[r]){var s=
l(n,p,e,a.gridSize);d[r]=s}r++}k=l;g=m;GRUNT.Log.trace("tile grid populated",q);a.onPopulate&&a.onPopulate()},getShiftDelta:function(l,m,q,r){var p=Math.floor(a.gridSize*0.2),n=new SLICK.Vector;if(l<0||l+q>a.gridSize)n.x=l<0?-p:p;if(m<0||m+r>a.gridSize)n.y=m<0?-p:p;return n},shift:function(l,m){if(!(l.x===0&&l.y===0)){var q=GRUNT.Log.getTraceTicks(),r=Array(d.length);r.length=d.length;for(var p=0;p<a.gridSize;p++)for(var n=0;n<a.gridSize;n++)r[n*a.gridSize+p]=i.getTile(p+l.x,n+l.y);d=r;e=m?m(e,l):
SLICK.V.add(e,l);c.x+=-l.x*a.tileSize;c.y+=-l.y*a.tileSize;GRUNT.Log.trace("tile storage shifted",q);i.populate(k,g)}},setOrigin:function(l,m){if(tileOrigin)shiftOrigin(l,m);else e=SLICK.V.offset(new SLICK.Vector(l,m),-tileHalfWidth)}};GRUNT.WaterCooler.listen("imagecache.cleared",function(){for(var l=d.length;l--;)if(d[l])d[l].loaded=false});return i};var j=null,b=null,f={Config:{TILESIZE:256,TILEBUFFER:1,TILEBUFFER_LOADNEW:0.2},Tile:function(a){return a=GRUNT.extend({x:0,y:0,size:256},a)},ImageTile:function(a){a=
GRUNT.extend({url:"",sessionParamRegex:null,loaded:false},a);return new f.Tile(a)},TileGrid:function(a){function d(n,s,u,B){if((i?SLICK.V.absSize(SLICK.V.diff(i,s)):k)>=20){n=e.getTileShift();n=new SLICK.Vector(Math.floor((s.x+n.x)*g),Math.floor((s.y+n.y)*g));var x=Math.ceil(u.width*g)+1;u=Math.ceil(u.height*g)+1;var C=new SLICK.Vector((x-1)*0.5,(u-1)*0.5),D=new SLICK.Vector(n.x*a.tileSize,n.y*a.tileSize);B.isAnimating();m=[];tilesNeeded=false;for(var E=u;E--;)for(var t=E*a.tileSize+D.y,y=x;y--;){B=
e.getTile(y+n.x,E+n.y);var A=y*a.tileSize+D.x,J=new SLICK.Vector(y-C.x,E-C.y);B||(q=e.getShiftDelta(n.x,n.y,x,u));m.push({tile:B,coordinates:new SLICK.Vector(A,t),centerness:SLICK.V.absSize(J)})}m.sort(function(G,L){return L.centerness-G.centerness});i=SLICK.V.copy(s)}}a=GRUNT.extend({tileSize:SLICK.Tiling.Config.TILESIZE,drawGrid:false,center:new SLICK.Vector,shiftOrigin:null,supportFastDraw:true,checkChange:100},a);var e=new TileStore(GRUNT.extend({onPopulate:function(){l=true;p.wakeParent()}},
a)),k=Math.round(a.tileSize>>1),c=true,g=a.tileSize?1/a.tileSize:0,i=null,l=false,m=[];new SLICK.Vector;var q=new SLICK.Vector,r=e.getGridSize()*a.tileSize,p=GRUNT.extend(new SLICK.Graphics.ViewLayer(a),{gridDimensions:new SLICK.Dimensions(r,r),cycle:function(){var n=0;if(q.x+q.y!==0){e.shift(q,a.shiftOrigin);q=new SLICK.Vector;n++}return n+l?1:0},drawTile:function(){},draw:function(n,s,u,B,x){if(c){var C=GRUNT.Log.getTraceTicks(),D=e.getTileShift(),E=s.x+D.x;D=s.y+D.y;if(B!==SLICK.Graphics.DisplayState.PINCHZOOM){d(n,
s,u,x);GRUNT.Log.trace("updated draw queue",C)}if(a.drawGrid)n.strokeStyle="rgba(50, 50, 50, 0.3)";n.beginPath();for(s=m.length;s--;){u=m[s].tile;x=m[s].coordinates.x-E;var t=m[s].coordinates.y-D;if(u){p.drawTile(n,u,x,t,B);u.x=x;u.y=t}a.drawGrid&&n.rect(x,t,a.tileSize,a.tileSize)}n.stroke();GRUNT.Log.trace("drawn tiles",C)}l=false},getTileSize:function(){return a.tileSize},getTileVirtualXY:function(n,s,u){n=e.getNormalizedPos(n,s);n=new SLICK.Vector(n.x*a.tileSize,n.y*a.tileSize);if(u){n.x+=k;n.y+=
k}return n},getCenterXY:function(){var n=Math.ceil(e.getGridSize()>>1);return p.getTileVirtualXY(n,n,true)},populate:function(n){e.populate(n,function(){})}});GRUNT.WaterCooler.listen("view.scale",function(n){if(n.id==p.getParent().id)c=false});GRUNT.WaterCooler.listen("tile.loaded",function(){l=true;p.wakeParent()});return p},ImageTileGrid:function(a){function d(){GRUNT.WaterCooler.say("tile.loaded")}a=GRUNT.extend({},a);return GRUNT.extend(new f.TileGrid(a),{drawTile:function(e,k,c,g,i){var l=SLICK.Resources.getImage(k.url);
i===SLICK.Graphics.DisplayState.PAN&&e.drawImage(h(),c,g);if(l&&l.complete)e.drawImage(l,c,g);else{e.drawImage(o(),c,g);l||SLICK.Resources.loadImage(k.url,d)}}})},Tiler:function(a){a=GRUNT.extend({container:"",drawCenter:false,onPan:null,onPanEnd:null,tapHandler:null,doubleTapHandler:null,zoomHandler:null,onDraw:null,datasources:{},tileLoadThreshold:"first"},a);SLICK.Touch.captureTouch(document.getElementById(a.container),a);var d=new SLICK.Graphics.View(GRUNT.extend({},a,{pannable:true,scalable:true,
scaleDamping:true}));GRUNT.extend(d,{getTileLayer:function(){return d.getLayer("grid0")},setTileLayer:function(e){d.setLayer("grid0",e);GRUNT.WaterCooler.say("grid.updated",{grid:e})},gridPixToViewPix:function(e){var k=d.getOffset();return new SLICK.Vector(e.x-k.x,e.y-k.y)},viewPixToGridPix:function(e){var k=d.getOffset();return new SLICK.Vector(e.x+k.x,e.y+k.y)}});return d}};return f}();
SLICK.Geo=function(){function o(c,g){var i=null;for(var l in e)if(g){if(l==g&&e[l][c]){i=e[l];break}}else if(e[l][c]){i=e[l];break}return i}function h(c,g,i,l){var m=0;c=c.toUpperCase();for(var q in l){var r=g[q];if(r){var p=i[q];r=p?p(c,r):c.containsWord(r)?1:0;m+=r*l[q]}}return m}var j=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],b=/(\d+)\s?\-\s?(\d+)/,f=/^(\d+).*$/,a=null,d={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",
HWY:"HIGHWAY",MWY:"MOTORWAY"},e={},k={Engine:function(c){if(!c.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var g=GRUNT.extend({remove:function(){delete e[g.id]}},c);return e[g.id]=g},getEngine:function(c){for(var g=null,i=1;!g&&i<arguments.length;i++)g=o(c,arguments[i]);g=g?g:o(c);if(!g)throw Error("Unable to find GEO engine with "+c+" capability");return g},Distance:function(c,g){var i=0;if(!k.emptyPos(c)&&!k.emptyPos(g)){var l=(g.lat-c.lat).toRad()>>1,m=(g.lon-c.lon).toRad()>>
1;l=Math.sin(l)*Math.sin(l)+Math.cos(c.lat.toRad())*Math.cos(g.lat.toRad())*Math.sin(m)*Math.sin(m);i=6371*2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))}return{toM:function(){return i*1E3},toKM:function(){return i},toString:function(){return i+"km"}}},Radius:function(c,g){return{distance:parseInt(c,10),uom:g}},Position:function(c,g){return{lat:parseFloat(c?c:0),lon:parseFloat(g?g:0)}},BoundingBox:function(c,g){var i={min:k.parsePosition(c),max:k.parsePosition(g),expand:function(l){i.min.lat-=l;i.min.lon-=
k.Utilities.normalizeLon(l);i.max.lat+=l;i.max.lon+=k.Utilities.normalizeLon(l)},getDistance:function(){return new k.Distance(i.min,i.max)},getCenter:function(){var l=k.calculateBoundsSize(i.min,i.max);return new SLICK.Geo.Position(i.min.lat+l.y*0.5,i.min.lon+l.x*0.5)},transform:function(l){var m=new SLICK.Geo.BoundingBox(i.min,i.max);GRUNT.Log.info("applying "+l.length+" transformers");for(var q=0;l&&q<l.length;q++)l[q].apply(m);return m},toString:function(){return String.format("({0}, {1})",i.min,
i.max)}};return i},Transforms:function(){return{Shrink:function(){return function(){}},Offset:function(){return function(){}}}}(),Address:function(c){c=GRUNT.extend({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},c);return GRUNT.extend(c,{getPos:function(){return c.pos},toString:function(){return c.streetDetails+" "+c.location}})},GeocodeFieldWeights:{streetDetails:50,location:50},AddressCompareFns:{},Utilities:function(){var c={lat2pix:function(g,i){var l=parseFloat(g)*
2*Math.PI/360;l=Math.sin(l);var m=0.08181919084262157*l;return Math.log((1+l)/(1-l)*Math.pow((1-m)/(1+m),0.08181919084262157))/2/i},lon2pix:function(g,i){return parseFloat(g)/180*Math.PI/i},pix2lon:function(g,i){return c.normalizeLon(g*i*180/Math.PI)},pix2lat:function(g,i){for(var l=Math.pow(Math.E,-g*i),m=c.mercatorUnproject(l),q=c.findRadPhi(m,l),r=0;r<12&&Math.abs(m-q)>1.0E-7;){m=q;q=c.findRadPhi(m,l);r++}return q*180/Math.PI},mercatorUnproject:function(g){return Math.PI/2-2*Math.atan(g)},findRadPhi:function(g,
i){var l=0.08181919084262157*Math.sin(g);return Math.PI/2-2*Math.atan(i*Math.pow((1-l)/(1+l),0.040909595421310785))},normalizeLon:function(g){for(;g<-180;)g+=360;for(;g>180;)g-=360;return g}};return c}(),GeoSearchResult:function(c){c=GRUNT.extend({id:null,caption:"",resultType:"",data:null,pos:null,matchWeight:0},c);return GRUNT.extend(c,{toString:function(){return c.caption+(c.matchWeight?" ("+c.matchWeight+")":"")}})},GeoSearchAgent:function(c){c=GRUNT.extend({},c);return GRUNT.extend({},SLICK.Dispatcher.createAgent(c))},
GeocodingAgent:function(c){c=GRUNT.extend({name:"Geocoding Search Agent",paramTranslator:null,execute:function(g,i){try{if(!g.reverse&&!g.freeform)address=new k.Address(g);var l=k.getEngine("geocode");if(l)l.geocode({addresses:[g.freeform?g.freeform:address],complete:function(q,r){if(i){var p=r;if(g.freeform)p=k.rankGeocodeResponses(g.freeform,p,k.getEngine("geocode"));i(p,c)}}})}catch(m){GRUNT.Log.exception(m)}}},c);return new k.GeoSearchAgent(c)},PointOfInterest:function(c){c=GRUNT.extend({id:0,
title:"",pos:null,lat:"",lon:"",group:"",retrieved:0,isNew:true},c);if(!c.pos&&c.lat&&c.lon)c.pos=new SLICK.Geo.Position(c.lat,c.lon);return GRUNT.extend({toString:function(){return c.id+": '"+c.title+"'"}},c)},POIStorage:function(c){function g(p){p=p?p:"default";m[p]||(m[p]=[]);return m[p]}function i(p){var n=[];for(var s in m)for(var u=0;u<m[s].length;u++)if(!p||p(m[s][u]))n.push(m[s][u]);return n}function l(){GRUNT.WaterCooler.say("geo.pois-updated",{srcID:r.id,pois:r.getPOIs()})}c=GRUNT.extend({visibilityChange:null,
onPOIDeleted:null,onPOIAdded:null},c);var m={},q=true,r={id:GRUNT.generateObjectID(),getPOIs:function(){return i()},getOldPOIs:function(p,n){return i(function(s){return s.group==p&&s.retrieved<n})},getVisible:function(){return q},setVisible:function(p){if(p!=q){q=p;c.visibilityChange&&c.visibilityChange()}},findById:function(p){var n=i(function(s){return s.id==p});return n.length>0?n[0]:null},findByBounds:function(p){return i(function(n){return SLICK.Geo.posInBounds(n.pos,p)})},addPOIs:function(p,
n){if(n)m={};for(var s=0;p&&s<p.length;s++){p[s].retrieved=SLICK.Clock.getTime(true);var u=p[s];g(u.group).push(u)}},removeGroup:function(p){if(m[p]){delete m[p];l()}},update:function(p){var n=[],s=0,u=p.length>0?p[0].group:"",B=SLICK.Clock.getTime(true);for(s=0;s<p.length;s++){var x;a:{if(x=p[s])for(var C=g(x.group),D=0;D<C.length;D++)if(C[D].id==x.id){x=C[D];break a}x=null}if(x){x.retrieved=B;x.isNew=false}else n.push(p[s])}p=r.getOldPOIs(u,B);r.addPOIs(n);for(s=0;c.onPOIAdded&&s<n.length;s++)c.onPOIAdded(n[s]);
for(s=0;s<p.length;s++){c.onPOIDeleted&&c.onPOIDeleted(p[s]);u=p[s];B=g(u.group);for(x=0;x<B.length;x++)if(B[x].id==u.id){B.splice(x,1);break}}n.length+p.length>0&&l()}};return r},MapProvider:function(){return{zoomLevel:0,checkZoomLevel:function(c){return c},getCopyright:function(){},getMapTiles:function(){},getPositionForXY:function(){return null}}},copyPos:function(c){return c?new k.Position(c.lat,c.lon):null},emptyPos:function(c){return!c||c.lat===0&&c.lon===0},posToStr:function(c){return c.lat+
" "+c.lon},parsePosition:function(c){if(c)if(GRUNT.isPlainObject(c)&&c.lat!=="undefined")return c;else{if(c.split)for(var g=[" ",","],i=0;i<g.length;i++){var l=c.split(g[i]);if(l.length===2)return new k.Position(l[0],l[1])}}else return new k.Position;return null},parsePositionArray:function(c){var g=c.length,i=Array(g);for(g=g;g--;)i[g]=k.parsePosition(c[g]);return i},posToMercatorPixels:function(c,g){return new SLICK.Vector(SLICK.Geo.Utilities.lon2pix(c.lon,g),SLICK.Geo.Utilities.lat2pix(c.lat,g))},
mercatorPixelsToPos:function(c,g,i){return new k.Position(SLICK.Geo.Utilities.pix2lat(g,i),SLICK.Geo.Utilities.normalizeLon(SLICK.Geo.Utilities.pix2lon(c,i)))},emptyBounds:function(c){return!c||k.emptyPos(c.min)||k.emptyPos(c.max)},posInBounds:function(c,g){var i=!(k.emptyPos(c)||k.emptyBounds(g));return i=(i=i&&c.lat>=g.min.lat&&c.lat<=g.max.lat)&&c.lon>=g.min.lon&&c.lon<=g.max.lon},calculateBoundsSize:function(c,g,i){var l=new SLICK.Vector(0,g.lat-c.lat);if(typeof i==="undefined")i=true;l.x=i&&
c.lon>g.lon?360-c.lon+g.lon:g.lon-c.lon;return l},getBoundingBoxZoomLevel:function(c,g){var i=c.getCenter(),l=Math.min(Math.round(Math.abs(i.lat)*0.05),j.length),m=j[l],q=k.calculateBoundsSize(c.min,c.max),r=Math.ceil(Math.log(j[3]*g.height/q.y)/Math.log(2));m=Math.ceil(Math.log(m*g.width/q.x)/Math.log(2));GRUNT.Log.info("constant index for bbox: "+c+" (center = "+i+") is "+l);GRUNT.Log.info("distances  = "+q);GRUNT.Log.info("optimal zoom levels: height = "+r+", width = "+m);return Math.min(r,m)},
getBoundsForPositions:function(c,g){var i=null,l=SLICK.Clock.getTime();g||(g="auto");for(var m=c.length;m--;)if(i){var q=k.calculateBoundsSize(i.min,c[m],false),r=k.calculateBoundsSize(c[m],i.max,false);if(q.x<0)i.min.lon=c[m].lon;if(q.y<0)i.min.lat=c[m].lat;if(r.x<0)i.max.lon=c[m].lon;if(r.y<0)i.max.lat=c[m].lat}else i=new SLICK.Geo.BoundingBox(k.copyPos(c[m]),k.copyPos(c[m]));if(g){if(g=="auto"){m=k.calculateBoundsSize(i.min,i.max);g=Math.max(m.x,m.y)*0.3}i.expand(g)}GRUNT.Log.info("bounds calculated in "+
(SLICK.Clock.getTime()-l)+" ms");return i},normalizeAddress:function(c){if(!c)return"";c=c.toUpperCase();if(!a){var g=[];for(var i in d)g.push(i);a=RegExp("(\\s)("+g.join("|")+")(\\s|$)","i")}a.lastIndex=-1;if(g=a.exec(c))c=c.replace(a,"$1"+d[g[2]]);return c},buildingMatch:function(c,g){f.lastIndex=-1;if(f.test(c))for(var i=c.replace(f,"$1"),l=g.split(","),m=0;m<l.length;m++){b.lastIndex=-1;if(b.test(l[m])){var q=b.exec(l[m]);if(i>=parseInt(q[1],10)&&i<=parseInt(q[2],10))return true}else if(i==l[m])return true}return false},
rankGeocodeResponses:function(c,g,i){var l=[],m=k.AddressCompareFns;if(i&&i.compareFns)m=GRUNT.extend({},m,i.compareFns);for(i=0;i<g.length;i++)l.push(new k.GeoSearchResult({caption:g[i].toString(),data:g[i],pos:g[i].pos,matchWeight:h(c,g[i],m,k.GeocodeFieldWeights)}));l.sort(function(q,r){return r.matchWeight-q.matchWeight});return l}};return k}();
SLICK.Geo.Location=function(){function o(b){function f(g){try{var i=new SLICK.Geo.Position(g.coords.latitude,g.coords.longitude),l=GRUNT.isPlainObject(g.coords.accuracy)&&g.coords.accuracy.horizontal?g.coords.accuracy.horizontal:g.coords.accuracy;GRUNT.Log.info("got position coordinates: "+i+", accuracy = "+l);if(b.successCallback&&(!k||l<c))b.successCallback(i,e,g);if(l>b.highAccuracyCutoff&&e<2){e=2;b.enableHighAccuracy=true;GRUNT.Log.info("Position not at required accuracy, trying again with high accuracy");
d()}k=g;c=l}catch(m){GRUNT.Log.exception(m)}}function a(g){if(g.code===g.PERMISSION_DENIED)b.errorCallback&&b.errorCallback(g);else if(g.code===g.POSITION_UNAVAILABLE)b.errorCallback&&b.errorCallback(g);else if(g.code===g.TIMEOUT){GRUNT.Log.info("had a timeout on cached position, moving to phase 1");if(b.timeout===0&&b.autoPhasing){e=1;b.timeout=h;b.enableHighAccuracy=false;d()}}}function d(){navigator.geolocation.getCurrentPosition(f,a,b)}b=GRUNT.extend({autoPhasing:true,maximumAge:3E5,timeout:0,
highAccuracyCutoff:10,enableHighAccuracy:true,successCallback:null,errorCallback:null},b);var e=0,k=null,c=1E6;d()}var h=3E3,j={get:function(){throw Error("No geolocation APIs supported.");}};if(navigator.geolocation)j.get=o;return j}();SLICK.Geo.Search=function(){return{bestResults:function(o,h){h||(h=20);for(var j=o.length>0?o[0]:null,b=[],f=0;f<o.length;f++)if(j.matchWeight-o[f].matchWeight<=h)b.push(o[f]);else break;return b}}}();
SLICK.Mapping=function(){var o={AnnotationTween:null,GeoTileGrid:function(h){h=GRUNT.extend({grid:null,centerPos:new SLICK.Geo.Position,centerXY:new SLICK.Vector,radsPerPixel:0},h);var j=SLICK.Geo.posToMercatorPixels(h.centerPos,h.radsPerPixel),b=j.x-h.centerXY.x,f=j.y-h.centerXY.y,a=GRUNT.extend({},h.grid,{getBoundingBox:function(d,e,k,c){return new SLICK.Geo.BoundingBox(a.pixelsToPos(new SLICK.Vector(d,e+c)),a.pixelsToPos(new SLICK.Vector(d+k,e)))},getCenterOffset:function(){return h.centerXY},
getGridXYForPosition:function(d){d=SLICK.Geo.posToMercatorPixels(d,h.radsPerPixel);return new SLICK.Vector(d.x-b,a.gridDimensions.height-(d.y-f))},getGuideOffset:function(d){var e=a.getTileSize();return new SLICK.Vector(d.x%e,d.y%e)},pixelsToPos:function(d){return SLICK.Geo.mercatorPixelsToPos(b+d.x,f+a.gridDimensions.height-d.y,h.radsPerPixel)}});return a},POIViewLayer:function(h){GRUNT.extend({},h)},Overlay:function(h){GRUNT.extend({},h);return{}},RadarOverlay:function(h){h=GRUNT.extend({radarFill:"rgba(0, 221, 238, 0.1)",
radarStroke:"rgba(0, 102, 136, 0.3)",zindex:100},h);return GRUNT.extend(new SLICK.Graphics.ViewLayer(h),{draw:function(j,b,f){b=f.width>>1;f=f.height>>1;j.fillStyle=h.radarFill;j.strokeStyle=h.radarStroke;j.beginPath();j.arc(b,f,50,0,Math.PI*2,false);j.fill();j.stroke()}})},CrosshairOverlay:function(h){h=GRUNT.extend({lineWidth:1.5,strokeStyle:"rgba(0, 0, 0, 0.5)",size:15,zindex:150,scalePosition:false,validStates:SLICK.Graphics.DisplayState.ACTIVE|SLICK.Graphics.DisplayState.ANIMATING|SLICK.Graphics.DisplayState.PAN},
h);return GRUNT.extend(new SLICK.Graphics.ViewLayer(h),{draw:function(j,b,f){b=f.getCenter();j.lineWidth=h.lineWidth;j.strokeStyle=h.strokeStyle;f=h.size;j.beginPath();j.moveTo(b.x,b.y-f);j.lineTo(b.x,b.y+f);j.moveTo(b.x-f,b.y);j.lineTo(b.x+f,b.y);j.arc(b.x,b.y,f*0.6666,0,2*Math.PI,false);j.stroke()}})},RouteOverlay:function(h){h=GRUNT.extend({strokeStyle:"rgba(0, 51, 119, 0.9)",waypointFillStyle:"#FFFFFF",lineWidth:4,data:null,pixelGeneralization:8,calculationsPerCycle:250,partialDraw:false,zindex:50,
validStates:SLICK.Graphics.DisplayState.ACTIVE|SLICK.Graphics.DisplayState.PAN},h);var j=true,b=null,f=[],a=0,d=[],e=GRUNT.extend(new SLICK.Graphics.ViewLayer(h),{getAnimation:function(k,c,g,i){if(j||a>0)return null;return new SLICK.Graphics.AnimatedPathLayer({path:f,zindex:h.zindex+1,easing:k?k:SLICK.Animation.Easing.Sine.InOut,duration:c?c:5E3,drawIndicator:g,autoCenter:i?i:false})},draw:function(k,c,g,i,l){g=0;i=h.data?h.data.geometry:null;if(j){f=[];a=0;GRUNT.Log.info("recalc condition detected, geometry length = "+
i.length)}if(i&&a<i.length){a:{l=l.getTileLayer();d=[];j=false;i=GRUNT.Log.getTraceTicks();var m,q,r,p=h.data?h.data.geometry:[],n=p.length,s=h.data?h.data.instructions:[],u=s.length,B=h.calculationsPerCycle,x=0,C=Math.ceil(Math.log(n)/Math.log(10));for(m=a;m<n;m+=C){q=l.getGridXYForPosition(p[m]);if(r=!b||m===n||Math.abs(q.x-b.x)+Math.abs(q.y-b.y)>h.pixelGeneralization){f.push(q);b=q}x++;if(x>=B){a=m;break a}if(m+C>=n){C=Math.max(n-m-1,1);GRUNT.Log.info("increment adjusted to "+C)}}a=n;GRUNT.Log.trace(n+
" geometry points generalized to "+f.length+" coordinates",i);b=null;for(m=u;m--;)if(s[m].position){q=l.getGridXYForPosition(s[m].position);if(r=!b||m===0||Math.abs(q.x-b.x)+Math.abs(q.y-b.y)>h.pixelGeneralization){d.push(q);b=q}}GRUNT.Log.trace(u+" instructions generalized to "+d.length+" coordinates",i);GRUNT.Log.info("finished route calc coordinates")}g++}l=f.length;if(l>0&&(!g||h.partialDraw)){k.strokeStyle=h.strokeStyle;k.lineWidth=h.lineWidth;k.beginPath();k.moveTo(f[l-1].x-c.x,f[l-1].y-c.y);
for(l=l;l--;)k.lineTo(f[l].x-c.x,f[l].y-c.y);k.stroke();k.fillStyle=h.waypointFillStyle;for(l=d.length;l--;){k.beginPath();k.arc(d[l].x-c.x,d[l].y-c.y,2,0,Math.PI*2,false);k.stroke();k.fill()}}return g}});GRUNT.WaterCooler.listen("grid.updated",function(){j=true;e.wakeParent()});return e},Annotation:function(h){h=GRUNT.extend({xy:null,pos:null,draw:null,tweenIn:o.AnnotationTween},h);var j=false,b={xy:h.xy,pos:h.pos,isNew:false,isAnimating:function(){return j},draw:function(f,a,d,e){if(b.xy){if(b.isNew&&
h.tweenIn){var k=b.xy.y;b.xy.y=a.y-20;j=true;SLICK.Animation.tween(b.xy,"y",k,h.tweenIn,function(){b.xy.y=k;j=false},250+Math.random()*500)}if(h.draw)h.draw(f,a,new SLICK.Vector(b.xy.x-a.x,b.xy.y-a.y),d,e);else{f.beginPath();f.arc(b.xy.x-a.x,b.xy.y-a.y,4,0,Math.PI*2,false);f.fill()}b.isNew=false}}};return b},ImageAnnotation:function(h){h=GRUNT.extend({imageUrl:null},h);var j=null;h.draw=function(b,f,a,d,e){if(f=SLICK.Resources.getImage(h.imageUrl)){if(f.complete){j||(j=new SLICK.Vector(-f.width>>
1,-f.height>>1));a=SLICK.V.offset(a,j.x,j.y);b.drawImage(f,a.x,a.y,f.width,f.height)}}else SLICK.Resources.loadImage(h.imageUrl,function(){e.wakeParent()})};return new o.Annotation(h)},AnnotationsOverlay:function(h){function j(e){for(var k=h.map?h.map.getTileLayer():null,c=0;k&&c<e.length;c++)e[c].xy=k.getGridXYForPosition(e[c].pos)}h=GRUNT.extend({pois:null,map:null,createAnnotationForPOI:null,zindex:100},h);var b=[],f=false,a=[],d=GRUNT.extend(new SLICK.Graphics.ViewLayer(h),{draw:function(e,k,
c,g){e.save();try{var i;f=false;e.fillStyle="rgba(255, 0, 0, 0.75)";e.globalCompositeOperation="source-over";for(i=b.length;i--;){b[i].draw(e,k,g,d);f=f||b[i].isAnimating()}for(i=a.length;i--;){a[i].draw(e,k,g,d);f=f||b[i].isAnimating()}f&&d.wakeParent()}finally{e.restore()}},add:function(e){a.push(e);j(a)},isAnimating:function(){return f}});GRUNT.WaterCooler.listen("geo.pois-updated",function(e){if(h.pois&&h.pois.id==e.srcID){e=e.pois;try{b=[];for(var k=0;k<e.length;k++)if(e[k].pos){var c;var g=
e[k];if(g&&g.pos){var i=null;if(i=h.createAnnotationForPOI?h.createAnnotationForPOI(g):new o.Annotation({pos:g.pos})){i.isNew=g.isNew;g.isNew=false}c=i}else c=void 0;c&&b.push(c)}j(b)}catch(l){GRUNT.Log.exception(l)}d.wakeParent()}});GRUNT.WaterCooler.listen("grid.updated",function(){j(b);j(a)});return d},Tiler:function(h){h=GRUNT.extend({tapExtent:10,provider:null,crosshair:true,copyright:undefined,zoomLevel:0,boundsChange:null,tapPOI:null,boundsChangeThreshold:30,pois:new SLICK.Geo.POIStorage,createAnnotationForPOI:null},
h);if(typeof h.copyright==="undefined")h.copyright=h.provider?h.provider.getCopyright():"";var j=new SLICK.Vector,b=h.copyright,f=false,a=[],d=null,e=h.zoomLevel;if(!h.provider)h.provider=new SLICK.Geo.MapProvider;var k=h.panHandler,c=h.tapHandler;h.onPan=function(l,m){k&&k(l,m)};h.tapHandler=function(l,m){var q=i.getTileLayer(),r=null;if(q){var p=i.viewPixToGridPix(new SLICK.Vector(m.x,m.y));r=q.pixelsToPos(SLICK.V.offset(p,-h.tapExtent,h.tapExtent));q=q.pixelsToPos(SLICK.V.offset(p,h.tapExtent,
-h.tapExtent));r=new SLICK.Geo.BoundingBox(r,q);a=i.pois.findByBounds(r);h.tapPOI&&h.tapPOI(a)}c&&c(l,m,r)};h.doubleTapHandler=function(l,m){i.animate(2,i.getDimensions().getCenter(),new SLICK.Vector(m.x,m.y),SLICK.Animation.Easing.Sine.Out)};h.onScale=function(l,m){var q=0;l=Math.sqrt(l);if(l<1)q=-(0.5/l);else if(l>1)q=l;i.removeLayer("grid");SLICK.Resources.resetImageLoadQueue();i.gotoPosition(i.getXYPosition(m),e+Math.floor(q));GRUNT.Log.info("zoom change = "+Math.floor(q)+", new zoom level = "+
(e+Math.floor(q)))};var g=new SLICK.Tiling.Tiler(h),i=GRUNT.extend({},g,{pois:h.pois,getBoundingBox:function(){var l=new SLICK.Geo.BoundingBox,m=i.getTileLayer(),q=i.getOffset(),r=i.getDimensions();if(m)l=m.getBoundingBox(q.x,q.y,r.width,r.height);return l},getCenterPosition:function(){return i.getXYPosition(i.gridDimensions.getCenter())},getXYPosition:function(l){return i.getTileLayer().pixelsToPos(i.viewPixToGridPix(l))},gotoBounds:function(l,m){var q=SLICK.Geo.getBoundingBoxZoomLevel(l,i.getDimensions());
GRUNT.Log.info("BOUNDS CHANGE REQUIRED CENTER: "+l.getCenter()+", ZOOM LEVEL: "+q);i.gotoPosition(l.getCenter(),q,m)},gotoCurrentPosition:function(l){SLICK.Geo.Location.get({successCallback:function(m){i.clearBackground();i.gotoPosition(m,15,l)},errorCallback:function(){}})},gotoPosition:function(l,m,q){var r=e;e=m?m:e;if(!e)throw"Zoom level required to goto a position.";if(h.provider)e=h.provider.checkZoomLevel(e);if(!f||e!=r){SLICK.Animation.cancel();f&&i.freeze();h.provider.zoomLevel=e;h.provider.getMapTiles(i,
l,function(p){i.setTileLayer(p);i.panToPosition(l,function(){i.unfreeze();q&&q()})});f=true}else i.panToPosition(l,q)},panToPosition:function(l,m,q){var r=i.getTileLayer();if(r){l=r.getGridXYForPosition(l);r=i.getDimensions();l.x-=r.width>>1;l.y-=r.height>>1;if(d)d=null;i.updateOffset(l.x,l.y,q);GRUNT.WaterCooler.say("view.wake",{id:i.id});h.boundsChange&&h.boundsChange(i.getBoundingBox());m&&m(i)}},setZoomLevel:function(l){i.gotoPosition(i.getCenterPosition(),l)},zoomIn:function(){GRUNT.Log.info("scaling needed is "+
2*Math.PI/(1<<e)/(2*Math.PI/(1<<e+1)));i.scale(2,SLICK.Animation.Easing.Sine.Out)||i.setZoomLevel(e+1)},zoomOut:function(){GRUNT.Log.info("scaling needed is "+2*Math.PI/(1<<e)/(2*Math.PI/(1<<e-1)));i.scale(0.5,SLICK.Animation.Easing.Sine.Out)||i.setZoomLevel(e-1)},animateRoute:function(l,m,q,r){var p=i.getLayer("route");if(p)(l=p.getAnimation(l,m,q,r))&&l.addToView(i)}},g);g=new SLICK.Mapping.AnnotationsOverlay({pois:i.pois,map:i,createAnnotationForPOI:h.createAnnotationForPOI});i.setLayer("annotations",
g);h.crosshair&&i.setLayer("crosshair",new SLICK.Mapping.CrosshairOverlay);b&&i.setLayer("copyright",new SLICK.Graphics.ViewLayer({zindex:999,draw:function(l,m,q){l.lineWidth=2.5;l.fillStyle="rgb(50, 50, 50)";l.strokeStyle="rgba(255, 255, 255, 0.8)";l.font="bold 10px sans";l.textBaseline="bottom";l.strokeText(b,10,q.height-10);l.fillText(b,10,q.height-10)}}));GRUNT.WaterCooler.listen("view-idle",function(l){if(l.id&&l.id==i.id)if(SLICK.V.absSize(SLICK.V.diff(j,i.getOffset()))>h.boundsChangeThreshold&&
h.boundsChange){j=i.getOffset();h.boundsChange(i.getBoundingBox())}});return i}};return o}();
SLICK.Geo.Routing=function(){var o={calculate:function(h){h=GRUNT.extend({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null},h);GRUNT.Log.info("attempting to calculate route");var j=SLICK.Geo.getEngine("route");j&&j.route(h,function(b){if(h.map){o.createMapOverlay(h.map,b);if(h.autoFit){GRUNT.Log.info("AUTOFITTING MAP TO ROUTE: bounds = "+b.boundingBox);h.map.gotoBounds(b.boundingBox)}}h.success&&h.success(b)})},createMapOverlay:function(h,j){var b=h.getDimensions();b=new SLICK.Mapping.RouteOverlay({data:j,
width:b.width,height:b.height});h.setLayer("route",b)},Maneuver:{None:0,Continue:1,TurnLeft:100,TurnLeftSlight:101,TurnLeftSharp:102,TurnRight:110,TurnRightSlight:111,TurnRightSharp:112,TurnAround:190,EnterRoundabout:200,ExitRamp:300},Instruction:function(h){h=GRUNT.extend({position:null,description:"",manuever:o.Maneuver.None},h);return GRUNT.extend(h,{})},RouteData:function(h){h=GRUNT.extend({geometry:[],instructions:[],boundingBox:null},h);if(!h.boundingBox)h.boundingBox=SLICK.Geo.getBoundsForPositions(h.geometry);
return h}};return o}();
