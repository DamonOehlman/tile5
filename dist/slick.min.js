if(!this.JSON)this.JSON={};
(function(){function s(k){return k<10?"0"+k:k}function o(k){f.lastIndex=0;return f.test(k)?'"'+k.replace(f,function(j){var h=e[j];return typeof h==="string"?h:"\\u"+("0000"+j.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+k+'"'}function c(k,j){var h,g,l,m,n=a,r,p=j[k];if(p&&typeof p==="object"&&typeof p.toJSON==="function")p=p.toJSON(k);if(typeof i==="function")p=i.call(j,k,p);switch(typeof p){case "string":return o(p);case "number":return isFinite(p)?String(p):"null";case "boolean":case "null":return String(p);
case "object":if(!p)return"null";a+=d;r=[];if(Object.prototype.toString.apply(p)==="[object Array]"){m=p.length;for(h=0;h<m;h+=1)r[h]=c(h,p)||"null";l=r.length===0?"[]":a?"[\n"+a+r.join(",\n"+a)+"\n"+n+"]":"["+r.join(",")+"]";a=n;return l}if(i&&typeof i==="object"){m=i.length;for(h=0;h<m;h+=1){g=i[h];if(typeof g==="string")if(l=c(g,p))r.push(o(g)+(a?": ":":")+l)}}else for(g in p)if(Object.hasOwnProperty.call(p,g))if(l=c(g,p))r.push(o(g)+(a?": ":":")+l);l=r.length===0?"{}":a?"{\n"+a+r.join(",\n"+a)+
"\n"+n+"}":"{"+r.join(",")+"}";a=n;return l}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+s(this.getUTCMonth()+1)+"-"+s(this.getUTCDate())+"T"+s(this.getUTCHours())+":"+s(this.getUTCMinutes())+":"+s(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
f=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,a,d,e={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},i;if(typeof JSON.stringify!=="function")JSON.stringify=function(k,j,h){var g;d=a="";if(typeof h==="number")for(g=0;g<h;g+=1)d+=" ";else if(typeof h==="string")d=h;if((i=j)&&typeof j!=="function"&&(typeof j!=="object"||typeof j.length!=="number"))throw Error("JSON.stringify");return c("",
{"":k})};if(typeof JSON.parse!=="function")JSON.parse=function(k,j){function h(l,m){var n,r,p=l[m];if(p&&typeof p==="object")for(n in p)if(Object.hasOwnProperty.call(p,n)){r=h(p,n);if(r!==undefined)p[n]=r;else delete p[n]}return j.call(l,m,p)}var g;k=String(k);b.lastIndex=0;if(b.test(k))k=k.replace(b,function(l){return"\\u"+("0000"+l.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(k.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){g=eval("("+k+")");return typeof j==="function"?h({"":g},""):g}throw new SyntaxError("JSON.parse");}})();if(!String.format)String.format=function(s){if(arguments.length<=1)return s;for(var o=arguments.length-2,c=0;c<=o;c++)s=s.replace(RegExp("\\{"+c+"\\}","gi"),arguments[c+1]);return s};
String.prototype.containsWord=function(s){var o="";if(s.toString)s=s.toString();for(var c=0;c<s.length;c++)o+=!/\w/.test(s[c])?"\\"+s[c]:s[c];return RegExp("(^|\\s|\\,)"+o+"(\\,|\\s|$)","i").test(this)};Number.prototype.toRad=function(){return this*Math.PI/180};Number.prototype.sec=function(){return 1/Math.cos(this)};
GRUNT=function(){var s=Object.prototype.hasOwnProperty,o=0,c={id:"GRUNT.core",extend:function(){var b=arguments[0]||{},f=1,a=arguments.length,d=false,e,i,k,j;if(typeof b==="boolean"){d=b;b=arguments[1]||{};f=2}if(typeof b!=="object"&&!c.isFunction(b))b={};if(a===f){b=this;--f}for(;f<a;f++)if((e=arguments[f])!=null)for(i in e){k=b[i];j=e[i];if(b!==j)if(d&&j&&(c.isPlainObject(j)||c.isArray(j))){k=k&&(c.isPlainObject(k)||c.isArray(k))?k:c.isArray(j)?[]:{};b[i]=c.extend(d,k,j)}else if(j!==undefined)b[i]=
j}return b},isFunction:function(b){return toString.call(b)==="[object Function]"},isArray:function(b){return toString.call(b)==="[object Array]"},isPlainObject:function(b){if(!b||toString.call(b)!=="[object Object]"||b.nodeType||b.setInterval)return false;if(b.constructor&&!s.call(b,"constructor")&&!s.call(b.constructor.prototype,"isPrototypeOf"))return false;var f;for(f in b);return f===undefined||s.call(b,f)},isEmptyObject:function(b){for(var f in b)return false;return true},isXmlDocument:function(b){return toString.call(b)===
"[object Document]"},contains:function(b,f){var a=b,d=arguments,e=1;if(f&&c.isArray(f)){d=f;e=0}for(e=e;e<d;e++)a=a&&typeof foo[d[e]]!=="undefined";return a},newModule:function(b){b=c.extend({id:null,requires:[],parent:null},b);if(b.parent)b=c.extend({},b.parent,b);return b},toID:function(b){return b.replace(/\s/g,"-")},generateObjectID:function(b){return(b?b:"obj")+o++}};return c}();
GRUNT.Log=function(){function s(a,d){var e,i=d&&d.length>0?d[0]:"";for(e=1;d&&e<d.length;e++)i+=" "+(c&&GRUNT.isPlainObject(d[e])?JSON.stringify(d[e]):d[e]);typeof console!=="undefined"&&console[a](i);for(e=0;e<o.length;e++)o[e].call(f,i,a)}var o=[],c=typeof JSON!=="undefined",b=window.console&&window.console.markTimeline,f={id:"GRUNT.log",getTraceTicks:function(){return b?(new Date).getTime():null},trace:function(a,d){if(b)console.markTimeline(a+(d?": "+(f.getTraceTicks()-d)+"ms":""))},debug:function(){s("debug",
arguments)},info:function(){s("info",arguments)},warn:function(){s("warn",arguments)},error:function(){s("error",arguments)},exception:function(a){f.error(arguments);for(var d in a)f.info("ERROR DETAIL: "+d+": "+a[d])},watch:function(a,d){try{d()}catch(e){f.exception(e,a)}},throwError:function(a){f.error(a);throw Error(a);},requestUpdates:function(a){o.push(a)}};return f}();
GRUNT.Data=function(){var s={determineObjectMapping:function(c){if(!c)return null;c=c.split("|");for(var b={},f=0;f<c.length;f++)b[c[f]]=f;return b},mapLineToObject:function(c,b){var f=c.split("|"),a={};for(var d in b){var e=b[d];a[d]=f.length>e?f[e]:null}return a},parse:function(c){var b=null,f=[];c=c.split("\n");for(var a=0;a<c.length;a++){var d=c[a];if(b)f.push(s.mapLineToObject(d,b));else b=s.determineObjectMapping(d)}return f}},o={supportedFormats:{JSON:{parse:function(c){return JSON.parse(c)}},
PDON:{parse:function(c){return s.parse(c)}}},parse:function(c){c=GRUNT.extend({data:"",format:"JSON"},c);if(!o.supportedFormats[c.format])throw Error("Unsupported data format: "+c.format+", cannot parse data in javascript object");try{return o.supportedFormats[c.format].parse(c.data)}catch(b){GRUNT.Log.error("ERROR PARSING DATA FROM FORMAT: "+c.format,c.data);GRUNT.Log.exception(b)}return{}}};return o}();
GRUNT.Template=function(){var s=/\$\{(.*?)\}/ig;return{parse:function(o,c){for(var b=o,f=s.exec(b);f;){b=b.replace(f[0],GRUNT.XPath.first(f[1],c));s.lastIndex=0;f=s.exec(b)}return b}}}();
GRUNT.JSONP=function(){function s(f){var a=document.createElement("script"),d=false;a.src=f;a.async=true;a.onload=a.onreadystatechange=function(){if(!d&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){d=true;a.onload=a.onreadystatechange=null;a&&a.parentNode&&a.parentNode.removeChild(a)}};c||(c=document.getElementsByTagName("head")[0]);c.appendChild(a)}var o=0,c,b=this;return{get:function(f,a){f+=f.indexOf("?")>=0?"&":"?";var d="json"+ ++o;b[d]=function(e){a(e);b[d]=
null;try{delete b[d]}catch(i){}};s(f+"callback="+d);return d}}}();
GRUNT.XHR=function(){var s={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},o={JSON:["json"],PDON:["pdon.txt"]},c=["TEXT","STREAM"],b=/^(\w+:)?\/\/([^\/?#]+)/,f={XML:function(e){return e.responseXML},JSON:function(e){try{return JSON.parse(e.responseText)}catch(i){GRUNT.Log.error("Error parsing JSON data: ",e.responseText);GRUNT.Log.exception(i)}return""},PDON:function(e){return GRUNT.Data.parse({data:e.responseText,format:"PDON"})},DEFAULT:function(e){return e.responseText}},
a={CONTENT_TYPE:"Content-Type"},d=GRUNT.newModule({id:"GRUNT.xhr",ajaxSettings:{xhr:null},ajax:function(e){try{e=GRUNT.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},d.ajaxSettings,e);var i=b.exec(e.url),k=i&&(i[1]&&i[1]!==location.protocol||i[2]!==location.host);if(e.data)e.method="POST";if(e.url){i=null;if(e.xhr)i=e.xhr(e);i||(i=new XMLHttpRequest);i.open(e.method,e.url,e.async);e.data&&i.setRequestHeader("Content-Type",
e.contentType);k||i.setRequestHeader("X-Requested-With","XMLHttpRequest");i.onreadystatechange=function(){if(this.readyState===4){var h=null,g=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(g)if(e.handleResponse)e.handleResponse(this);else{var l=e,m=this.getResponseHeader(a.CONTENT_TYPE),n,r=false;for(n in s)if(m&&m.indexOf(s[n])>=0){r=true;break}m=!r;for(r=0;r<c.length;r++)m=m||c[r]==n;if(m)b:{m=n;for(var p in o)for(r=
0;r<o[p].length;r++)if(RegExp(o[p][r]+"$","i").test(l.url)){n=p;break b}n=m?m:"DEFAULT"}try{h=f[n](this,l)}catch(q){GRUNT.Log.warn("error applying processor '"+n+"' to response type, falling back to default");h=f.DEFAULT(this,l)}}else e.error&&e.error(this)}catch(t){GRUNT.Log.exception(t,"PROCESSING AJAX RESPONSE")}g&&h&&e.success&&e.success.call(this,h)}};i.send(e.method=="POST"?d.param(e.data):null)}else GRUNT.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(j){GRUNT.Log.exception(j)}},
param:function(e){var i=[],k=function(h,g){g=GRUNT.isFunction(g)?g():g;i[i.length]=encodeURIComponent(h)+"="+encodeURIComponent(g)};if(GRUNT.isArray(e))for(var j=0;j<e.length;j++)k(e[j].name,e[j].value);else for(j in e)k(j,e[j]);return i.join("&").replace(/%20/g,"+")}});return d}();
GRUNT.XPath=function(){function s(f){for(var a=null,d=0;d<o.length;d++)if(a=o[d](f))break;return a}var o=[],c=[null,function(f){return f.numberValue},function(f){return f.stringValue},function(f){return f.booleanValue},null,null,null,null,function(f){return f.singleNodeValue?f.singleNodeValue.textContent:null},function(f){return f.singleNodeValue?f.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||GRUNT.Log.warn("No XPATH support, this is going to cause problems");var b={SearchResult:function(f){return{toString:function(){var a=
null;if(f){var d=null;if(f.resultType>=0&&f.resultType<c.length)d=c[f.resultType];if(d){GRUNT.Log.info("invoking match handler for result type: "+f.resultType);a=d(f)}}return a?a:""}}},first:function(f,a){var d=b.SearchResult,e;var i=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!i)i=XPathResult.ANY_TYPE;try{if(GRUNT.isXmlDocument(a))e=a.evaluate(f,a,s,i,null);else{GRUNT.Log.warn("attempted xpath expression: "+f+" on a non-xml document");e=null}}catch(k){GRUNT.Log.warn("attempted to run invalid xpath expression: "+
f+" on node: "+a);e=null}return new d(e)},registerResolver:function(f){o.push(f)}};return b}();GRUNT.WaterCooler=function(){var s={};return{listen:function(o,c){s[o]||(s[o]=[]);c&&s[o].push(c)},say:function(o,c){if(s[o])for(var b=0;b<s[o].length;b++)s[o][b](c)},leave:function(){}}}();
SLICK=function(){var s={copyRect:function(o){return o?new s.Rect(o.origin.x,o.origin.y,o.dimensions.width,o.dimensions.height):null},Settings:function(){var o={};return{get:function(c){return o[c]},set:function(c,b){o[c]=b},extend:function(c){GRUNT.extend(o,c)}}}(),Clock:function(){var o=null;return{getTime:function(c){return c&&o?o:o=(new Date).getTime()}}}(),Vector:function(o,c){return{x:o?o:0,y:c?c:0}},V:function(){return{create:function(o,c){return new s.Vector(o,c)},add:function(){for(var o=
new s.Vector,c=arguments.length;c--;){o.x+=arguments[c].x;o.y+=arguments[c].y}return o},absSize:function(o){return Math.max(Math.abs(o.x),Math.abs(o.y))},diff:function(o,c){return new s.Vector(o.x-c.x,o.y-c.y)},copy:function(o){return o?new s.Vector(o.x,o.y):null},invert:function(o){return new SLICK.Vector(-o.x,-o.y)},offset:function(o,c,b){return new SLICK.Vector(o.x+c,o.y+(b?b:c))}}}(),VectorArray:function(o,c){for(var b=Array(o.length),f=o.length;f--;)b[f]=c?s.V.copy(o[f]):o[f];return{applyOffset:function(a){for(var d=
b.length;d--;){b[d].x+=a.x;b[d].y+=a.y}},getRect:function(){return new SLICK.Rect(Math.min(b[0].x,b[1].x),Math.min(b[0].y,b[1].y),Math.abs(b[0].x-b[1].x),Math.abs(b[0].y-b[1].y))},toString:function(){for(var a="",d=b.length;d--;)a+="["+b[d].toString()+"] ";return a}}},VectorMath:function(){function o(c){if(!c||c.length<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var b={edges:Array(c.length-1),accrued:Array(c.length-1),total:0},f=SLICK.V.diff,a=0;a<c.length-
1;a++){var d=f(c[a],c[a+1]);b.edges[a]=Math.sqrt(d.x*d.x+d.y*d.y);b.accrued[a]=b.total+b.edges[a];b.total+=b.edges[a]}return b}return{edges:o,distance:function(c){return o(c).total},theta:function(c,b,f){f=Math.asin((c.y-b.y)/f);return c.x>b.x?f:Math.PI-f},pointOnEdge:function(c,b,f,a){b=new SLICK.Vector(Math.cos(f)*a,Math.sin(f)*a);return new SLICK.Vector(c.x-b.x,c.y-b.y)}}}(),Dimensions:function(o,c){var b=c?o/c:1,f={width:o,height:c,aspect_ratio:b,inv_aspect_ratio:1/b,getAspectRatio:function(){return f.height!==
0?f.width/f.height:1},getCenter:function(){return new SLICK.Vector(f.width>>1,f.height>>1)},grow:function(a,d){return new SLICK.Dimensions(f.width+a,f.height+d)},matches:function(a){return a&&f.width==a.width&&f.height==a.height},toString:function(){return f.width+" x "+f.height}};return f},Rect:function(o,c,b,f){var a={origin:new SLICK.Vector(o,c),dimensions:new SLICK.Dimensions(b,f),getCenter:function(){return new SLICK.Vector(a.origin.x+(a.dimensions.width>>1),a.origin.y+(a.dimensions.height>>
1))},getSize:function(){return Math.sqrt(Math.pow(a.dimensions.width,2)+Math.pow(a.dimensions.height,2))},grow:function(d,e){var i=new SLICK.Dimensions(d-a.dimensions.width,e-a.dimensions.height);a.dimensions.width=d;a.dimensions.height=e;return i},expand:function(d,e){a.origin.x-=d;a.origin.y-=e;a.dimensions.width+=d;a.dimensions.height+=e},offset:function(d){return new s.Rect(a.origin.x+d.x,a.origin.y+d.y,a.dimensions.width,a.dimensions.height)},getRequiredDelta:function(d,e){var i={top:0,left:0,
bottom:0,right:0};i.top=d.origin.y-a.origin.y+(e?e.y:0);i.left=d.origin.x-a.origin.x+(e?e.x:0);i.right=d.origin.x+d.dimensions.width-(a.origin.x+a.dimensions.width)-i.left;i.bottom=d.origin.y+d.dimensions.height-(a.origin.y+a.dimensions.height)-i.top;return i},applyDelta:function(d,e,i){if(!d||!GRUNT.contains(d,["top","left","bottom","right"]))throw Error("Invalid delta - cannot apply to SLICK.Rect");e||(e=1);a.origin.x+=d.left*e;a.origin.y+=d.top*e;a.dimensions.width+=d.right*e;a.dimensions.height+=
d.bottom*e;i&&a.constrainAspectRatio(i)},constrainAspectRatio:function(d){var e=0,i={top:0,left:0,bottom:0,right:0};if(a.dimensions.getAspectRatio()<d){e=Math.abs(a.dimensions.width-a.dimensions.height*d);i.left=-e;i.right=e}else{e=Math.abs(a.dimensions.height-a.dimensions.width/d);i.top=-e;i.bottom=e}a.applyDelta(i)},moveTo:function(d,e){var i=new SLICK.Vector(d-a.origin.x,e-a.origin.y);a.origin.x=d;a.origin.y=e;return i},toString:function(){return String.format("(origin: {0}, dimensions: {1})",
a.origin,a.dimensions)}};return a}};return s}();
SLICK.Device=function(){function s(){o={base:{name:"Unknown",eventTarget:document,supportsTouch:"createTouch"in document,imageCacheMaxSize:4096,getScaling:function(){return 1},maxImageLoads:4,requireFastDraw:false},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:true},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144},android:{name:"Android OS <= 2.1",regex:/android/i,eventTarget:document.body,
supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio}},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true}};c=[o.froyo,o.android,o.ipod,o.iphone,o.ipad]}var o=null,c=[],b=null;return{getConfig:function(){o||s();if(!b){GRUNT.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var f=0;f<c.length;f++){var a=c[f];if(a.regex&&a.regex.test(navigator.userAgent)){b=GRUNT.extend({},o.base,a);GRUNT.Log.info("PLATFORM DETECTED AS: "+
b.name);break}}if(!b){GRUNT.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");b=o.base}GRUNT.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return b}}}();
SLICK.Resources=function(){var s="",o={},c=function(){function f(){var r=i[this.id];if(r){r.loaded=true;r.hitCount=1;for(var p=h.length;p--;)if(h[p].image.src==this.src){h.splice(p,1);break}r.loadCallback&&r.loadCallback(this,false);g.push({url:this.src,created:r.requested});delete i[this.id];a()}}function a(){for(var r=SLICK.Device.getConfig().maxImageLoads;j.length>0&&(!r||h.length<r);){var p=j.shift();h.push(p);p.image.onload=f;p.image.src=p.url;p.requested=(new Date).getTime()}}function d(){m=
true;try{var r=Math.floor(g.length*0.5);if(r>0){g.sort(function(q,t){return q.created-t.created});for(var p=r;p--;)delete e[g[p].url];g.splice(0,r)}}finally{m=false}GRUNT.WaterCooler.say("imagecache.cleared")}var e={},i={},k=0,j=[],h=[],g=[],l=0,m=false,n={loadingImages:h,queuedImages:j,getCacheFullness:function(){return l},getImage:function(r){var p=null;m||(p=e[r]);return p?p.image:null},loadImage:function(r,p){var q=e[r];if(q){q.hitCount++;q.image.complete&&p&&p(q.image,true)}else{q={url:b.getPath(r),
image:new Image,loaded:false,created:(new Date).getTime(),requested:null,hitCount:0,loadCallback:p};q.image.id="resourceLoaderImage"+k++;e[r]=q;i[q.image.id]=q;j.push(q);a()}return q},resetLoadingQueue:function(){h=[]}};setInterval(function(){for(var r=(new Date).getTime(),p=false,q=0,t=SLICK.Device.getConfig();q<h.length;)if(r-h[q].requested>b.loadTimeout*1E3){h.splice(q,1);p=true}else q++;p&&a();if(t&&t.imageCacheMaxSize){l=g.length*b.avgImageSize/t.imageCacheMaxSize;l>=1&&d()}},1E3);return n}(),
b={avgImageSize:25,loadTimeout:10,Cache:function(){return{read:function(){return null},write:function(){},getUrlCacheKey:function(f,a){for(var d=(f?f.replace(/^.*\?/,""):"").split("&"),e=f?f.replace(/\?.*$/,"?"):"",i=0;i<d.length;i++){var k=d[i].split("=");if(!a||!a.test(k[0]))e+=d[i]+"&"}return e.replace(/\W/g,"")},isValidCacheKey:function(f){GRUNT.Log.info("cache key = "+f);return false}}}(),getCachedUrl:function(f){return f},getPath:function(f){return/^(https?|\/)/.test(f)?f:s+f},setBasePath:function(f){s=
f},getImage:function(f){return c.getImage(f)},loadImage:function(f,a){c.loadImage(f,a)},resetImageLoadQueue:function(){c.resetLoadingQueue()},getStats:function(){return{imageLoadingCount:c.loadingImages.length,queuedImageCount:c.queuedImages.length,imageCacheFullness:c.getCacheFullness()}},loadResource:function(f){f=GRUNT.extend({filename:"",cacheable:true,dataType:null,callback:null},f);var a=function(d){f.callback&&GRUNT.Log.watch("CALLING RESOURCE CALLBACK",function(){f.callback(d)})};f.cacheable&&
o[f.filename]?a(o[f.filename]):GRUNT.XHR.ajax({url:b.getPath(f.filename),dataType:f.dataType,success:function(d){if(f.cacheable)o[f.filename]=d;a(d)},error:function(d,e,i){GRUNT.Log.error("error loading resource ["+f.filename+"], error = "+i)}})},loadSnippet:function(f,a){/\.\w+$/.test(f)||(f+=".html");b.loadResource({filename:"snippets/"+f,callback:a,dataType:"html"})}};return b}();
SLICK.Touch=function(){function s(k,j){var h=k&&k.length>0?k[0]:null;if(h&&j&&j.length>0)return SLICK.V.diff(h,j[0]);return null}function o(k){k.preventDefault();k.stopPropagation()}function c(k){for(var j=Array(k.length),h=k.length;h--;)j[h]=new SLICK.Vector(k[h].pageX,k[h].pageY);return j}var b={TAP:0,MOVE:1,PINCHZOOM:2},f=7,a=0,d=0,e={TouchHelper:function(k){function j(v){v=new SLICK.VectorArray(v,true);k.element&&v.applyOffset(new SLICK.Vector(-k.element.offsetLeft,-k.element.offsetTop));return v}
function h(v){var A=Array(arguments.length-1),C=0;for(C=1;C<arguments.length;C++)A[C-1]=arguments[C];for(C=D.length;C--;)D[C][v]&&D[C][v].apply(M,A)}function g(v){if(v.target&&v.target===k.element){q=p?c(v.touches):[new SLICK.Vector(v.pageX,v.pageY)];u=new SLICK.Vector;x=new SLICK.Vector;E=true;n=false;p&&o(v);G.current=SLICK.Clock.getTime();if(v=q.length>0?q[0]:null){h("touchStartHandler",v.x,v.y);if(G.current-G.last<M.THRESHOLD_DOUBLETAP)if((v=t?SLICK.V.diff(q[0],t[0]):null)&&Math.abs(v.x)<k.maxDistDoubleTap&&
Math.abs(v.y)<k.maxDistDoubleTap)n=true;z=b.TAP;t=[].concat(q)}else GRUNT.Log.warn("Touch start fired, but no touch vector found")}}function l(v){if(v.target&&v.target===k.element)if(E)try{p&&o(v);var A=p?c(v.touches):[new SLICK.Vector(v.pageX,v.pageY)];v=0;if(A.length>1){if(q.length===1)q=[].concat(A);v=SLICK.VectorMath.distance(q)-SLICK.VectorMath.distance(t)}if(z===b.TAP){var C=s(A,q);if(C&&(Math.abs(C.x)>=f||Math.abs(C.y)>=f))z=b.MOVE}if(z!==b.TAP)if(!v||Math.abs(v)<k.pinchZoomThreshold){if(u=
s(A,t)){x.x+=u.x;x.y+=u.y;B.x+=u.x;B.y+=u.y}if(SLICK.V.absSize(B)>k.panEventThreshhold){h("moveHandler",B.x,B.y);B=SLICK.V.create()}z=b.MOVE}else{h("pinchZoomHandler",j(q),j(A));z=b.PINCHZOOM}t=[].concat(A)}catch(J){GRUNT.Log.exception(J)}}function m(v){if(v.target&&v.target===k.element)try{p&&o(v);SLICK.Clock.getTime();G.last=G.current;if(z===b.TAP)r||(r=setTimeout(function(){r=0;var C=n?"doubleTapHandler":"tapHandler",J=q[0],P=null;if(k.element)P=SLICK.V.offset(J,-k.element.offsetLeft,-k.element.offsetTop);
h(C,J,P)},M.THRESHOLD_DOUBLETAP+50));else if(z==b.MOVE)h("moveEndHandler",x.x,x.y);else z==b.PINCHZOOM&&h("pinchZoomEndHandler",j(q),j(t))}catch(A){GRUNT.Log.exception(A)}E=false}k=GRUNT.extend({element:null,inertiaTrigger:20,maxDistDoubleTap:20,panEventThreshhold:0,pinchZoomThreshold:5,touchStartHandler:null,moveHandler:null,moveEndHandler:null,pinchZoomHandler:null,pinchZoomEndHandler:null,tapHandler:null,doubleTapHandler:null,wheelZoomHandler:null},k);var n=false,r=0,p=SLICK.Device.getConfig().supportsTouch,
q=null,t=null,u=null,x=null,B=new SLICK.Vector,z=null,E=false,D=[],G={current:0,last:0},F=SLICK.Device.getConfig(),M={supportsTouch:p,THRESHOLD_DOUBLETAP:300,addListeners:function(v){D.push(v)},decoupleListeners:function(v){for(var A=0;v&&A<D.length;A++)if(D[A].listenerId===v){D.splice(A,1);GRUNT.Log.info("successfully decoupled touch listener: "+v);break}},release:function(){F.eventTarget.removeEventListener(F.supportsTouch?"touchstart":"mousedown",g,false);F.eventTarget.removeEventListener(F.supportsTouch?
"touchmove":"mousemove",l,false);F.eventTarget.removeEventListener(F.supportsTouch?"touchend":"mouseup",m,false)},wheelie:function(v){var A=new SLICK.Vector(v.wheelDeltaX,v.wheelDeltaY);v=new SLICK.Vector(v.clientX,v.clientY);var C=A.y!==0?Math.abs(A.y/120):0;if(C!==0)h("wheelZoomHandler",v,A.y>0?C+0.5:0.5/C);GRUNT.Log.info("capture mouse wheel event, delta = "+A+", position = "+v)}};F.eventTarget.addEventListener(F.supportsTouch?"touchstart":"mousedown",g,false);F.eventTarget.addEventListener(F.supportsTouch?
"touchmove":"mousemove",l,false);F.eventTarget.addEventListener(F.supportsTouch?"touchend":"mouseup",m,false);return M}},i=[];return{captureTouch:function(k,j){try{if(!k)throw Error("Unable to capture touch of null element");if(!k.id)k.id="touchable_"+a++;var h=i[k.id];if(!h){h=e.TouchHelper(GRUNT.extend({element:k},j));i[k.id]=h;GRUNT.Log.info("CREATED TOUCH HELPER. SUPPORTS TOUCH = "+h.supportsTouch)}j.listenerId&&h.decoupleListeners(j.listenerId);j.listenerId=++d;h.addListeners(j)}catch(g){GRUNT.Log.exception(g)}},
resetTouch:function(k){if(k&&k.id&&i[k.id]){i[k.id].release();delete i[k.id]}}}}();if(typeof jQuery!=="undefined"){jQuery.fn.canTouchThis=function(s){return this.each(function(){SLICK.Touch.captureTouch(this,s)})};jQuery.fn.untouchable=function(){return this.bind("touchmove",function(s){s.preventDefault()})}}
SLICK.Pannable=function(s){s=GRUNT.extend({container:null,onPan:null,onPanEnd:null,onAnimate:null,checkOffset:null},s);var o=false,c=new SLICK.Vector,b={pannable:true,getOffset:function(){return new SLICK.Vector(c.x,c.y)},setOffset:function(a,d){c.x=a;c.y=d},pan:function(a,d,e){if(e)b.updateOffset(c.x+a,c.y+d,e);else{b.updateOffset(c.x+a,c.y+d);s.onPan&&s.onPan(a,d)}},isAnimating:function(){return o},panEnd:function(a,d){s.onPanEnd&&s.onPanEnd(a,d)},updateOffset:function(a,d,e){if(e){a=new SLICK.Vector(a,
d);o=true;e=SLICK.Animation.tweenVector(c,a.x,a.y,e,function(){o=false;b.panEnd(0,0)});for(a=e.length;a--;){e[a].cancelOnInteract=true;e[a].requestUpdates(function(){s.onAnimate&&s.onAnimate(c.x,c.y)})}}else b.setOffset(a,d)}},f=document.getElementById(s.container);f&&SLICK.Touch.captureTouch(f,{moveHandler:function(a,d){b.pan(-a,-d)},moveEndHandler:function(a,d){b.panEnd(a,d)}});return b};
SLICK.Scalable=function(s){function o(g,l){b=g.getRect();f=l.getRect();var m=b.getSize(),n=f.getSize();k=f.getCenter();a=b&&m!==0?n/m:1}s=GRUNT.extend({container:null,onAnimate:null,onPinchZoom:null,onScale:null,scaleDamping:false},s);var c=false,b=null,f=null,a=1,d=null,e=null,i=null,k=null,j={scalable:true,animate:function(g,l,m,n,r){function p(){r&&r();c=false;s.onScale&&s.onScale(a,k);a=1;d=null}c=true;i=SLICK.V.copy(l);k=SLICK.V.copy(m);b=null;if(n){e=a;SLICK.Animation.tweenValue(0,g-e,n,p,1E3).requestUpdates(function(q){d=
q/(g-e);a=e+q;s.onAnimate&&s.onAnimate()})}else{a=g;p()}},getScaleInfo:function(){return{factor:a,startRect:SLICK.copyRect(b),endRect:SLICK.copyRect(f),start:i,center:k,progress:d}},getScaling:function(){return c},getScaleFactor:function(){return a}},h=document.getElementById(s.container);h&&SLICK.Touch.captureTouch(h,{pinchZoomHandler:function(g,l){o(g,l);(c=a!==1)&&s.onPinchZoom&&s.onPinchZoom(g,l)},pinchZoomEndHandler:function(g,l){o(g,l);c=false;s.onScale&&s.onScale(a,k,true);a=1},wheelZoomHandler:function(g){b=
f=null;k=SLICK.V.copy(g)}});return j};
SLICK.Dispatcher=function(){var s=[],o={execute:function(c){var b=o.findAction(c);GRUNT.Log.info("looking for action id: "+c+", found: "+b);if(b){var f=[].concat(arguments).slice(0,1);GRUNT.Log.watch("EXECUTING ACTION: "+c,function(){b.execute(f)})}},findAction:function(c){for(var b=s.length;b--;)if(s[b].id==c)return s[b];return null},getRegisteredActions:function(){return[].concat(s)},getRegisteredActionIds:function(){for(var c=[],b=s.length;b--;)s[b].id&&c.push(s[b].id);return c},registerAction:function(c){c&&
c.id&&s.push(c)},Action:function(c){c=GRUNT.extend({autoRegister:true,id:"",title:"",icon:"",execute:null},c);var b={id:c.id,execute:function(){c.execute&&c.execute.apply(this,arguments)},getParam:function(f){return c[f]?c[f]:""},toString:function(){return String.format("{0} [title = {1}, icon = {2}]",b.id,c.title,c.icon)}};c.autoRegister&&o.registerAction(b);return b},createAgent:function(c){c=GRUNT.extend({name:"Untitled",trashOrphanedResults:true,translator:null,execute:null},c);var b=null,f={getName:function(){return c.name},
getParam:function(a){return c[a]},getId:function(){return GRUNT.toID(f.getName())},run:function(a,d){if(c.execute){var e=b=SLICK.Clock.getTime(true),i=c.translator?c.translator(a):a;c.execute.call(f,i,function(k,j){if(!c.trashOrphanedResults||e==b)d&&d(k,j,i)})}}};return f},runAgents:function(c,b,f){for(var a=0;a<c.length;a++)c[a].run(b,f)}};return o}();
SLICK.Messaging=function(){var s=[],o=[],c=GRUNT.newModule({id:"slick.messaging",requires:["slick.core"],STATUS:{none:0,created:1,updated:2,handled:3},send:function(b){b=GRUNT.extend({type:"",payload:{},index:0,status:c.STATUS.created,statusChange:null},b);b.index=o.push(b)-1;b=b.index;var f=b>=0&&b<o.length?o[b]:null;GRUNT.Log.info("firing message update, index = "+b+", message = "+f);for(var a=0;f&&a<s.length&&f.status!==c.STATUS.handled;){var d=s[a].processUpdate(o[b]);if(d){d=d;s[a].getId();var e=
b>=0&&b<o.length?o[b]:null;if(e){e.status=d;e.statusChange&&e.statusChange(e)}}a++}},Handler:function(b){b=GRUNT.extend({id:"",processUpdate:null},b);var f={getId:function(){return b.id},processUpdate:function(a){if(b.processUpdate)return b.processUpdate(a);return c.STATUS.none}};s.push(f);return f}});return c}();
SLICK.Animation=function(){function s(){if(b===0)b=setInterval(function(){if(f.update(SLICK.Clock.getTime())===0){clearInterval(b);b=0}},20)}var o=[],c=false,b=0,f={DURATION:2E3,tweenValue:function(a,d,e,i,k){a=new f.Tween({startValue:a,endValue:d,tweenFn:e,complete:i,duration:k});o.push(a);return a},tween:function(a,d,e,i,k,j){a=new f.Tween({target:a,property:d,endValue:e,tweenFn:i,duration:j,complete:k});o.push(a);return a},tweenVector:function(a,d,e,i,k,j){var h=[];if(a){var g=a.x==d,l=a.y==e;
g||h.push(f.tween(a,"x",d,i,function(){(g=true)&&l&&k()},j));l||h.push(f.tween(a,"y",e,i,function(){l=true;g&&l&&k()},j))}return h},cancel:function(a){if(!c){c=true;try{for(var d=0;d<o.length;)if(!a||a(o[d])){GRUNT.Log.info("CANCELLING ANIMATION");o[d].triggerComplete(true);o.splice(d,1)}else d++}finally{c=false}}},isTweening:function(){return o.length>0},update:function(a){if(c)return o.length;c=true;try{for(var d=0;d<o.length;)if(o[d].isComplete()){o[d].triggerComplete(false);o.splice(d,1);GRUNT.WaterCooler.say("animation.complete")}else{o[d].update(a);
d++}}finally{c=false}return o.length},Tween:function(a){a=GRUNT.extend({target:null,property:null,startValue:0,endValue:null,duration:f.DURATION,tweenFn:f.DEFAULT,complete:null,cancelOnInteract:false},a);var d=SLICK.Clock.getTime(),e=[],i=false,k=0,j=0,h={cancelOnInteract:a.cancelOnInteract,isComplete:function(){return i},triggerComplete:function(g){a.complete&&a.complete(g)},update:function(g){try{var l=a.tweenFn(g-d,k,j,a.duration);if(a.target)a.target[a.property]=l;for(var m=e.length;m--;)e[m](l,
void 0);if(i=d+a.duration<=g){if(a.target)a.target[a.property]=a.tweenFn(a.duration,k,j,a.duration);for(var n=e.length;n--;)e[n](l,true)}}catch(r){GRUNT.Log.exception(r)}},requestUpdates:function(g){e.push(g)}};k=a.target&&a.property&&a.target[a.property]?a.target[a.property]:a.startValue;if(typeof a.endValue!=="undefined")j=a.endValue-k;if(j==0)i=true;s();return h},Easing:function(){var a=1.70158;return{Linear:function(d,e,i,k){return i*d/k+e},Back:{In:function(d,e,i,k){return i*(d/=k)*d*((a+1)*
d-a)+e},Out:function(d,e,i,k){return i*((d=d/k-1)*d*((a+1)*d+a)+1)+e},InOut:function(d,e,i,k){return(d/=k/2)<1?i/2*d*d*(((a*=1.525)+1)*d-a)+e:i/2*((d-=2)*d*(((a*=1.525)+1)*d+a)+2)+e}},Bounce:{In:function(d,e,i,k){return i-f.Easing.Bounce.Out(k-d,0,i,k)+e},Out:function(d,e,i,k){return(d/=k)<1/2.75?i*7.5625*d*d+e:d<2/2.75?i*(7.5625*(d-=1.5/2.75)*d+0.75)+e:d<2.5/2.75?i*(7.5625*(d-=2.25/2.75)*d+0.9375)+e:i*(7.5625*(d-=2.625/2.75)*d+0.984375)+e},InOut:function(d,e,i,k){return d<k/2?f.Easing.Bounce.In(d*
2,0,i,k)*0.5+e:f.Easing.Bounce.Out(d*2-k,0,i,k)*0.5+i*0.5+e}},Cubic:{In:function(d,e,i,k){return i*(d/=k)*d*d+e},Out:function(d,e,i,k){return i*((d=d/k-1)*d*d+1)+e},InOut:function(d,e,i,k){if((d/=k/2)<1)return i/2*d*d*d+e;return i/2*((d-=2)*d*d+2)+e}},Elastic:{In:function(d,e,i,k,j,h){if(d==0)return e;if((d/=k)==1)return e+i;h||(h=k*0.3);if(!j||j<Math.abs(i)){j=i;i=h/4}else i=h/(2*Math.PI)*Math.asin(i/j);return-(j*Math.pow(2,10*(d-=1))*Math.sin((d*k-i)*2*Math.PI/h))+e},Out:function(d,e,i,k,j,h){var g;
if(d==0)return e;if((d/=k)==1)return e+i;h||(h=k*0.3);if(!j||j<Math.abs(i)){j=i;g=h/4}else g=h/(2*Math.PI)*Math.asin(i/j);return j*Math.pow(2,-10*d)*Math.sin((d*k-g)*2*Math.PI/h)+i+e},InOut:function(d,e,i,k,j,h){var g;if(d==0)return e;if((d/=k/2)==2)return e+i;h||(h=k*0.3*1.5);if(!j||j<Math.abs(i)){j=i;g=h/4}else g=h/(2*Math.PI)*Math.asin(i/j);if(d<1)return-0.5*j*Math.pow(2,10*(d-=1))*Math.sin((d*k-g)*2*Math.PI/h)+e;return j*Math.pow(2,-10*(d-=1))*Math.sin((d*k-g)*2*Math.PI/h)*0.5+i+e}},Quad:{In:function(d,
e,i,k){return i*(d/=k)*d+e},Out:function(d,e,i,k){return-i*(d/=k)*(d-2)+e},InOut:function(d,e,i,k){if((d/=k/2)<1)return i/2*d*d+e;return-i/2*(--d*(d-2)-1)+e}},Sine:{In:function(d,e,i,k){return-i*Math.cos(d/k*(Math.PI/2))+i+e},Out:function(d,e,i,k){return i*Math.sin(d/k*(Math.PI/2))+e},InOut:function(d,e,i,k){return-i/2*(Math.cos(Math.PI*d/k)-1)+e}}}}()};return GRUNT.extend(f,{DEFAULT:f.Easing.Back.Out})}();SLICK.Border={NONE:0,TOP:1,RIGHT:2,BOTTOM:3,LEFT:4};
SLICK.Graphics=function(){var s={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,PINCHZOOM:16,FREEZE:128},o=0,c={DisplayState:s,AnyDisplayState:255,ActiveDisplayStates:s.ACTIVE|s.ANIMATING,DefaultDisplayStates:s.ACTIVE|s.ANIMATING|s.PAN|s.PINCHZOOM,ViewLayer:function(b){b=GRUNT.extend({centerOnScale:true,created:(new Date).getTime(),scalePosition:true,zindex:0,supportFastDraw:false,validStates:c.DefaultDisplayStates},b);var f=null,a="",d=GRUNT.extend({isAnimating:function(){return false},addToView:function(e){e.setLayer(a,
d)},shouldDraw:function(e){var i=f?f.fastDraw&&e!==s.ACTIVE:false;return(e&b.validStates)!==0&&(i?b.supportFastDraw:true)},cycle:function(){return 0},draw:function(){},notify:function(){},remove:function(){GRUNT.WaterCooler.say("layer.remove",{id:a})},wakeParent:function(){GRUNT.WaterCooler.say("view.wake",{id:f?f.id:null})},getId:function(){return a},setId:function(e){a=e},getParent:function(){return f},setParent:function(e){f=e}},b);return d},StatusViewLayer:function(){return new c.ViewLayer({validStates:c.AnyDisplayState,
zindex:5E3,draw:function(b,f,a,d,e){b.fillStyle="#FF0000";b.fillRect(10,10,50,50);b.fillStyle="#FFFFFF";b.font="bold 10px sans";b.fillText(e.getDisplayState(),20,20)}})},AnimatedPathLayer:function(b){function f(j,h,g){j.fillStyle="#FFFFFF";j.strokeStyle="#222222";j.beginPath();j.arc(g.x,g.y,4,0,Math.PI*2,false);j.stroke();j.fill()}b=GRUNT.extend({path:[],id:GRUNT.generateObjectID("pathAnimation"),easing:SLICK.Animation.Easing.Sine.InOut,canCache:false,validStates:c.ActiveDisplayStates|s.PAN|s.PINCHZOOM,
drawIndicator:null,duration:2E3,autoCenter:false},b);var a=SLICK.VectorMath.edges(b.path),d,e=null,i=0;SLICK.Animation.tweenValue(0,a.total,b.easing,function(){k.remove()},b.duration).requestUpdates(function(j,h){i=j;h&&k.remove()});var k=GRUNT.extend(new c.ViewLayer(b),{cycle:function(){for(var j=0;j<a.accrued.length&&a.accrued[j]<i;)j++;e=null;if(j<b.path.length-1){var h=i-(j>0?a.accrued[j-1]:0),g=b.path[j],l=b.path[j+1];d=SLICK.VectorMath.theta(g,l,a.edges[j]);e=SLICK.VectorMath.pointOnEdge(g,
l,d,h);if(b.autoCenter)(j=k.getParent())&&j.centerOn(e)}return e?1:0},draw:function(j,h){if(e)(b.drawIndicator?b.drawIndicator:f)(j,h,new SLICK.Vector(e.x-h.x,e.y-h.y),d)}});return k},FPSLayer:function(b){b=GRUNT.extend({zindex:1E3,scalePosition:false},b);var f=null,a=GRUNT.extend(new c.ViewLayer(b),{delays:[],draw:function(d,e,i){d.font="bold 8pt Arial";d.textAlign="right";d.fillStyle="rgba(0, 0, 0, 0.8)";d.fillText((f?f:"?")+" fps",i.width-20,20)}});setInterval(function(){for(var d=0,e=a.delays.length,
i=e;i--;)d+=a.delays[i];if(e!==0)f=Math.floor(1E3/(d/e))},1E3);return a},ResourceStatsLayer:function(b){b=GRUNT.extend({zindex:500,indicatorSize:5,scalePosition:false,validStates:s.ACTIVE|s.PAN},b);return GRUNT.extend(new c.ViewLayer(b),{fps:null,draw:function(f){var a=SLICK.Resources.getStats(),d=b.indicatorSize,e=10,i;if(a.imageCacheFullness){f.strokeStyle="rgba(0, 0, 255, 1)";f.beginPath();f.arc(15,15,5,0,Math.PI*2*a.imageCacheFullness,false);f.stroke();e=30}if(a.imageLoadingCount>=0){f.fillStyle=
"rgba(0, 255, 0, 0.7)";for(i=a.imageLoadingCount;i--;)f.fillRect(e+i*(d+2),10,d,d)}if(a.queuedImageCount>=0){f.fillStyle="rgba(255, 0, 0, 0.7)";for(i=a.queuedImageCount;i--;)f.fillRect(e+i*(d+2),10+d+2,d,d)}}})},LoadingLayer:function(b){GRUNT.extend({},b)},View:function(b){function f(w,y){y.setId(w);y.setParent(H);k.push(y);k.sort(function(I,K){var L=K.zindex-I.zindex;if(L===0)L=K.created-I.created;return L})}function a(){GRUNT.WaterCooler.say("view-idle",{id:H.id});F=true;v=0}function d(w,y){var I=
0,K=H.getScaleFactor(),L=H.getDisplayState(),T=(new Date).getTime(),R=(L&s.PINCHZOOM)!==0;m=H.getScaleFactor();var Q=0;if(l||R){w.clearRect(0,0,j.width,j.height);l=false}if(R){var N=G.getScaleInfo();H.getDimensions().getCenter();var O=(N.progress?N.progress:1)*0.5;E=N.center;if(N.startRect){O=N.startRect.getCenter();O=SLICK.V.diff(O,E);A=new SLICK.Vector(E.x+O.x,E.y+O.y)}else{N=SLICK.V.diff(N.start,E);A=new SLICK.Vector(E.x-N.x*O,E.y-N.y*O)}if(A)y=SLICK.V.offset(y,A.x,A.y)}w.save();try{if(q!==1)w.scale(q,
q);else if(R){w.translate(E.x,E.y);w.scale(K,K)}for(Q=k.length;Q--;)if(k[Q].shouldDraw(L)){var S=k[Q].draw(w,y,u,L,H);I+=S?S:0}}finally{w.restore()}GRUNT.Log.trace("draw complete",T);return I}function e(){var w=0,y=J===s.PINCHZOOM||J===s.PAN;C=(new Date).getTime();g=D?D.getOffset():new SLICK.Vector;z&&n&&z.delays.push(C-n);if(y){SLICK.Animation.cancel(function(K){return K.cancelOnInteract});F=false;if(v!==0){clearTimeout(v);v=0}}for(y=k.length;y--;){var I=k[y].cycle(C,g);w+=I?I:0}w+=d(h,g);n=C;M=
0;if(B+w>0)i();else if(!F&&v===0)v=setTimeout(a,500);GRUNT.Log.trace("Completed draw cycle",C)}function i(){B++;if(!(p||M!==0)){B=0;M=setTimeout(e,0)}}b=GRUNT.extend({id:"view_"+o++,container:"",pannable:false,scalable:false,clearOnDraw:false,displayFPS:false,displayResourceStats:false,scaleDamping:false,fastDraw:false,fillStyle:"rgb(200, 200, 200)",initialDrawMode:"source-over",bufferRefresh:100,defaultFreezeDelay:500,onPan:null,onPinchZoom:null,onScale:null,onDraw:null,autoSize:false},b);var k=
[],j=document.getElementById(b.container),h=null,g=new SLICK.Vector,l=false,m=1,n=null,r=0,p=false,q=1,t=new SLICK.Vector,u=null,x=null,B=0,z=null,E=null,D=null,G=null,F=false,M=0,v=0,A=null,C=0,J=c.DisplayState.ACTIVE;GRUNT.Log.info("Creating a new view instance, attached to container: "+b.container+", canvas = ",j);if(j){SLICK.Touch.resetTouch(j);if(b.autoSize){GRUNT.Log.info("autosizing view: window.height = "+window.innerHeight+", width = "+window.innerWidth);j.height=window.innerHeight-j.offsetTop-
49;j.width=window.innerWidth-j.offsetLeft}try{h=j.getContext("2d");h.globalCompositeOperation=b.initialDrawMode;h.clearRect(0,0,j.width,j.height)}catch(P){GRUNT.Log.exception(P);throw Error("Could not initialise canvas on specified view element");}}if(b.pannable)D=new SLICK.Pannable({container:b.container,onAnimate:function(){i()},onPan:function(w,y){r=SLICK.Clock.getTime(true);i();t=SLICK.V.offset(t,w,y);b.onPan&&b.onPan(w,y);J=s.PAN},onPanEnd:function(){i();J=s.ACTIVE}});if(b.scalable)G=new SLICK.Scalable({scaleDamping:b.scaleDamping,
container:b.container,onAnimate:function(){J=c.DisplayState.PINCHZOOM;i()},onPinchZoom:function(w,y){r=SLICK.Clock.getTime(true);i();b.onPinchZoom&&b.onPinchZoom(w,y);J=c.DisplayState.PINCHZOOM},onScale:function(w,y){GRUNT.WaterCooler.say("view.scale",{id:H.id});J=c.DisplayState.ACTIVE;i();b.onScale&&b.onScale(w,y)}});var H=GRUNT.extend({},b,D,G,{id:b.id,deviceScaling:q,fastDraw:b.fastDraw||SLICK.Device.getConfig().requireFastDraw,centerOn:function(w){D.setOffset(w.x-j.width*0.5,w.y-j.height*0.5)},
getDimensions:function(){if(j)return new SLICK.Dimensions(j.width,j.height)},getZoomCenter:function(){return A},getLayer:function(w){for(var y=0;y<k.length;y++)if(k[y].getId()==w)return k[y];return null},setLayer:function(w,y){for(var I=0;I<k.length;I++)if(k[I].getId()===w){k.splice(I,1);break}y&&f(w,y);GRUNT.WaterCooler.say("layer.update",{value:y});i()},eachLayer:function(w){for(var y=0;y<k.length;y++)w(k[y])},clearBackground:function(){l=true},freeze:function(){p=true},unfreeze:function(){p=false;
i()},snapshot:function(){},getDisplayState:function(){return p?s.FROZEN:J},scale:function(w,y,I,K,L){K||(K=H.getDimensions().getCenter());L||(L=H.getDimensions().getCenter());G&&G.animate(w,K,L,y,I);return G},removeLayer:function(w){a:{for(var y=k.length;y--;)if(k[y].getId()==w){w=y;break a}w=-1}if(w>=0&&w<k.length){GRUNT.WaterCooler.say("layer.removed",{layer:k[w]});k.splice(w,1)}}});u=H.getDimensions();x=u.getCenter();GRUNT.WaterCooler.listen("layer.remove",function(w){w.id&&H.removeLayer(w.id)});
GRUNT.WaterCooler.listen("view.wake",function(w){if(!w.id||w.id===H.id)i()});q=SLICK.Device.getConfig().getScaling();if(b.displayFPS){z=new c.FPSLayer;H.setLayer("fps",z)}b.displayResourceStats&&H.setLayer("resourceStats",new c.ResourceStatsLayer);i();return H}};return c}();
SLICK.Tiling=function(){function s(){if(!c){c=document.createElement("canvas");c.width=f.Config.TILESIZE;c.height=f.Config.TILESIZE;var a=c.getContext("2d");a.fillStyle="rgba(150, 150, 150, 0.05)";a.fillRect(0,0,c.width,c.height)}return c}function o(){if(!b){b=document.createElement("canvas");b.width=f.Config.TILESIZE;b.height=f.Config.TILESIZE;var a=b.getContext("2d"),d=Math.sqrt(f.Config.TILESIZE);a.fillStyle="rgba(200, 200, 200, 1)";a.strokeStyle="rgb(190, 190, 190)";a.lineWidth=0.5;a.fillRect(0,
0,b.width,b.height);a.beginPath();for(var e=0;e<b.width;e+=d){a.moveTo(e,0);a.lineTo(e,b.height);for(var i=0;i<b.height;i+=d){a.moveTo(0,i);a.lineTo(b.width,i)}}a.stroke()}return b}TileStore=function(a){a=GRUNT.extend({gridSize:20,center:new SLICK.Vector,onPopulate:null},a);var d=Array(Math.pow(a.gridSize,2)),e=SLICK.V.offset(a.center,-Math.ceil(a.gridSize>>1)),i=null,k=new SLICK.Vector,j=null,h={getGridSize:function(){return a.gridSize},getNormalizedPos:function(g,l){return SLICK.V.add(new SLICK.Vector(g,
l),SLICK.V.invert(e),k)},getTileShift:function(){return SLICK.V.copy(k)},getTile:function(g,l){return g>=0&&g<a.gridSize?d[l*a.gridSize+g]:null},setTile:function(g,l,m){d[l*a.gridSize+g]=m},populate:function(g,l){var m=GRUNT.Log.getTraceTicks(),n=0;new SLICK.Vector(a.gridSize*0.5,a.gridSize*0.5);if(g)for(var r=0;r<a.gridSize;r++)for(var p=0;p<a.gridSize;p++){if(!d[n]){var q=g(p,r,e,a.gridSize);d[n]=q}n++}i=g;j=l;GRUNT.Log.trace("tile grid populated",m);a.onPopulate&&a.onPopulate()},getShiftDelta:function(g,
l,m,n){var r=Math.floor(a.gridSize*0.2),p=new SLICK.Vector;if(g<0||g+m>a.gridSize)p.x=g<0?-r:r;if(l<0||l+n>a.gridSize)p.y=l<0?-r:r;return p},shift:function(g,l){if(!(g.x===0&&g.y===0)){var m=GRUNT.Log.getTraceTicks(),n=Array(d.length);n.length=d.length;for(var r=0;r<a.gridSize;r++)for(var p=0;p<a.gridSize;p++)n[p*a.gridSize+r]=h.getTile(r+g.x,p+g.y);d=n;e=l?l(e,g):SLICK.V.add(e,g);k.x+=-g.x*a.tileSize;k.y+=-g.y*a.tileSize;GRUNT.Log.trace("tile storage shifted",m);h.populate(i,j)}},setOrigin:function(g,
l){if(tileOrigin)shiftOrigin(g,l);else e=SLICK.V.offset(new SLICK.Vector(g,l),-tileHalfWidth)}};GRUNT.WaterCooler.listen("imagecache.cleared",function(){for(var g=d.length;g--;)if(d[g])d[g].loaded=false});return h};var c=null,b=null,f={Config:{TILESIZE:256,TILEBUFFER:1,TILEBUFFER_LOADNEW:0.2},Tile:function(a){return a=GRUNT.extend({x:0,y:0,size:256},a)},ImageTile:function(a){a=GRUNT.extend({url:"",sessionParamRegex:null,loaded:false},a);return new f.Tile(a)},TileGrid:function(a){function d(q,t,u,
x){if((j?SLICK.V.absSize(SLICK.V.diff(j,t)):i)>=20){q=e.getTileShift();q=new SLICK.Vector(Math.floor((t.x+q.x)*k),Math.floor((t.y+q.y)*k));var B=Math.ceil(u.width*k)+1;u=Math.ceil(u.height*k)+1;var z=new SLICK.Vector((B-1)*0.5,(u-1)*0.5),E=new SLICK.Vector(q.x*a.tileSize,q.y*a.tileSize);x.isAnimating();l=[];tilesNeeded=false;for(var D=u;D--;)for(var G=D*a.tileSize+E.y,F=B;F--;){x=e.getTile(F+q.x,D+q.y);var M=F*a.tileSize+E.x,v=new SLICK.Vector(F-z.x,D-z.y);x||(n=e.getShiftDelta(q.x,q.y,B,u));l.push({tile:x,
coordinates:new SLICK.Vector(M,G),centerness:SLICK.V.absSize(v)})}l.sort(function(A,C){return C.centerness-A.centerness});j=SLICK.V.copy(t)}}a=GRUNT.extend({tileSize:SLICK.Tiling.Config.TILESIZE,drawGrid:false,center:new SLICK.Vector,shiftOrigin:null,supportFastDraw:true,checkChange:100},a);var e=new TileStore(GRUNT.extend({onPopulate:function(){h=true;p.wakeParent()}},a)),i=Math.round(a.tileSize>>1),k=a.tileSize?1/a.tileSize:0,j=null,h=false,g=true,l=[],m=false;new SLICK.Vector;var n=new SLICK.Vector,
r=e.getGridSize()*a.tileSize,p=GRUNT.extend(new SLICK.Graphics.ViewLayer(a),{gridDimensions:new SLICK.Dimensions(r,r),cycle:function(){var q=0;if(n.x+n.y!==0){e.shift(n,a.shiftOrigin);n=new SLICK.Vector;q++}return q+h?1:0},deactivate:function(){g=false},drawTile:function(){return false},draw:function(q,t,u,x,B){if(g){var z=GRUNT.Log.getTraceTicks(),E=e.getTileShift(),D=t.x+E.x;E=t.y+E.y;var G=true;if(x!==SLICK.Graphics.DisplayState.PINCHZOOM){d(q,t,u,B);GRUNT.Log.trace("updated draw queue",z)}if(a.drawGrid)q.strokeStyle=
"rgba(50, 50, 50, 0.3)";q.beginPath();for(t=l.length;t--;){u=l[t].tile;B=l[t].coordinates.x-D;var F=l[t].coordinates.y-E;if(u){G=p.drawTile(q,u,B,F,x)&&G;u.x=B;u.y=F}else G=false;a.drawGrid&&q.rect(B,F,a.tileSize,a.tileSize)}q.stroke();GRUNT.Log.trace("drawn tiles",z);G&&!m&&GRUNT.WaterCooler.say("tiles.drawn",{id:p.getId()});m=G;h=false}},getTileSize:function(){return a.tileSize},getTileVirtualXY:function(q,t,u){q=e.getNormalizedPos(q,t);q=new SLICK.Vector(q.x*a.tileSize,q.y*a.tileSize);if(u){q.x+=
i;q.y+=i}return q},getCenterXY:function(){var q=Math.ceil(e.getGridSize()>>1);return p.getTileVirtualXY(q,q,true)},populate:function(q){e.populate(q,function(){})}});GRUNT.WaterCooler.listen("tile.loaded",function(){h=true;p.wakeParent()});return p},ImageTileGrid:function(a){function d(){GRUNT.WaterCooler.say("tile.loaded")}a=GRUNT.extend({},a);return GRUNT.extend(new f.TileGrid(a),{drawTile:function(e,i,k,j,h){var g=SLICK.Resources.getImage(i.url),l=false;h===SLICK.Graphics.DisplayState.PAN&&e.drawImage(o(),
k,j);if(g&&g.complete&&g.width>0){e.drawImage(g,k,j);l=true}else{e.drawImage(s(),k,j);g||SLICK.Resources.loadImage(i.url,d)}return l}})},Tiler:function(a){a=GRUNT.extend({container:"",drawCenter:false,onPan:null,onPanEnd:null,tapHandler:null,doubleTapHandler:null,zoomHandler:null,onDraw:null,datasources:{},tileLoadThreshold:"first"},a);var d=new SLICK.Graphics.View(GRUNT.extend({},a,{pannable:true,scalable:true,scaleDamping:true}));SLICK.Touch.captureTouch(document.getElementById(a.container),a);
GRUNT.extend(d,{getTileLayer:function(){return d.getLayer("grid0")},setTileLayer:function(e){d.setLayer("grid0",e);GRUNT.WaterCooler.say("grid.updated",{grid:e})},gridPixToViewPix:function(e){var i=d.getOffset();return new SLICK.Vector(e.x-i.x,e.y-i.y)},viewPixToGridPix:function(e){var i=d.getOffset();return new SLICK.Vector(e.x+i.x,e.y+i.y)},cleanup:function(){d.removeLayer("grid0")}});return d}};return f}();
SLICK.Geo=function(){function s(h,g){var l=null;for(var m in k)if(g){if(m==g&&k[m][h]){l=k[m];break}}else if(k[m][h]){l=k[m];break}return l}function o(h,g,l,m){var n=0;h=h.toUpperCase();for(var r in m){var p=g[r];if(p){var q=l[r];p=q?q(h,p):h.containsWord(p)?1:0;n+=p*m[r]}}return n}var c=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],b=Math.PI/180,f=180/Math.PI,a=/(\d+)\s?\-\s?(\d+)/,d=/^(\d+).*$/,e=null,i={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",
CT:"COURT",LN:"LANE",HWY:"HIGHWAY",MWY:"MOTORWAY"},k={},j={Engine:function(h){if(!h.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var g=GRUNT.extend({remove:function(){delete k[g.id]}},h);return k[g.id]=g},getEngine:function(h){for(var g=null,l=1;!g&&l<arguments.length;l++)g=s(h,arguments[l]);g=g?g:s(h);if(!g)throw Error("Unable to find GEO engine with "+h+" capability");return g},Radius:function(h,g){return{distance:parseInt(h,10),uom:g}},Position:function(h,g){return{lat:parseFloat(h?
h:0),lon:parseFloat(g?g:0)}},BoundingBox:function(h,g){var l={min:j.P.parse(h),max:j.P.parse(g),expand:function(m){l.min.lat-=m;l.min.lon-=j.Utilities.normalizeLon(m);l.max.lat+=m;l.max.lon+=j.Utilities.normalizeLon(m)},getDistance:function(){return j.P.calcDistance(l.min,l.max)},getCenter:function(){var m=j.calculateBoundsSize(l.min,l.max);return new SLICK.Geo.Position(l.min.lat+m.y*0.5,l.min.lon+m.x*0.5)},transform:function(m){var n=new SLICK.Geo.BoundingBox(l.min,l.max);GRUNT.Log.info("applying "+
m.length+" transformers");for(var r=0;m&&r<m.length;r++)m[r].apply(n);return n}};return l},Transforms:function(){return{Shrink:function(){return function(){}},Offset:function(){return function(){}}}}(),Address:function(h){h=GRUNT.extend({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},h);return GRUNT.extend(h,{getPos:function(){return h.pos},toString:function(){return h.streetDetails+" "+h.location}})},GeocodeFieldWeights:{streetDetails:50,location:50},AddressCompareFns:{},
Utilities:function(){var h={lat2pix:function(g,l){var m=parseFloat(g)*2*Math.PI/360;m=Math.sin(m);var n=0.08181919084262157*m;return Math.log((1+m)/(1-m)*Math.pow((1-n)/(1+n),0.08181919084262157))/2/l},lon2pix:function(g,l){return parseFloat(g)/180*Math.PI/l},pix2lon:function(g,l){return h.normalizeLon(g*l*180/Math.PI)},pix2lat:function(g,l){for(var m=Math.pow(Math.E,-g*l),n=h.mercatorUnproject(m),r=h.findRadPhi(n,m),p=0;p<12&&Math.abs(n-r)>1.0E-7;){n=r;r=h.findRadPhi(n,m);p++}return r*180/Math.PI},
mercatorUnproject:function(g){return Math.PI/2-2*Math.atan(g)},findRadPhi:function(g,l){var m=0.08181919084262157*Math.sin(g);return Math.PI/2-2*Math.atan(l*Math.pow((1-m)/(1+m),0.040909595421310785))},normalizeLon:function(g){for(;g<-180;)g+=360;for(;g>180;)g-=360;return g}};return h}(),GeoSearchResult:function(h){h=GRUNT.extend({id:null,caption:"",resultType:"",data:null,pos:null,matchWeight:0},h);return GRUNT.extend(h,{toString:function(){return h.caption+(h.matchWeight?" ("+h.matchWeight+")":
"")}})},GeoSearchAgent:function(h){h=GRUNT.extend({},h);return GRUNT.extend({},SLICK.Dispatcher.createAgent(h))},GeocodingAgent:function(h){h=GRUNT.extend({name:"Geocoding Search Agent",paramTranslator:null,execute:function(g,l){try{if(!g.reverse&&!g.freeform)address=new j.Address(g);var m=j.getEngine("geocode");if(m)m.geocode({addresses:[g.freeform?g.freeform:address],complete:function(r,p){if(l){var q=p;if(g.freeform)q=j.rankGeocodeResponses(g.freeform,q,j.getEngine("geocode"));l(q,h)}}})}catch(n){GRUNT.Log.exception(n)}}},
h);return new j.GeoSearchAgent(h)},PointOfInterest:function(h){h=GRUNT.extend({id:0,title:"",pos:null,lat:"",lon:"",group:"",retrieved:0,isNew:true},h);if(!h.pos&&h.lat&&h.lon)h.pos=new SLICK.Geo.Position(h.lat,h.lon);return GRUNT.extend({toString:function(){return h.id+": '"+h.title+"'"}},h)},POIStorage:function(h){function g(q){q=q?q:"default";n[q]||(n[q]=[]);return n[q]}function l(q){var t=[];for(var u in n)for(var x=0;x<n[u].length;x++)if(!q||q(n[u][x]))t.push(n[u][x]);return t}function m(){GRUNT.WaterCooler.say("geo.pois-updated",
{srcID:p.id,pois:p.getPOIs()})}h=GRUNT.extend({visibilityChange:null,onPOIDeleted:null,onPOIAdded:null},h);var n={},r=true,p={id:GRUNT.generateObjectID(),getPOIs:function(){return l()},getOldPOIs:function(q,t){return l(function(u){return u.group==q&&u.retrieved<t})},getVisible:function(){return r},setVisible:function(q){if(q!=r){r=q;h.visibilityChange&&h.visibilityChange()}},findById:function(q){var t=l(function(u){return u.id==q});return t.length>0?t[0]:null},findByBounds:function(q){return l(function(t){return SLICK.Geo.posInBounds(t.pos,
q)})},addPOIs:function(q,t){if(t)n={};for(var u=0;q&&u<q.length;u++){q[u].retrieved=SLICK.Clock.getTime(true);var x=q[u];g(x.group).push(x)}},removeGroup:function(q){if(n[q]){delete n[q];m()}},update:function(q){var t=[],u=0,x=q.length>0?q[0].group:"",B=SLICK.Clock.getTime(true);for(u=0;u<q.length;u++){var z;a:{if(z=q[u])for(var E=g(z.group),D=0;D<E.length;D++)if(E[D].id==z.id){z=E[D];break a}z=null}if(z){z.retrieved=B;z.isNew=false}else t.push(q[u])}q=p.getOldPOIs(x,B);p.addPOIs(t);for(u=0;h.onPOIAdded&&
u<t.length;u++)h.onPOIAdded(t[u]);for(u=0;u<q.length;u++){h.onPOIDeleted&&h.onPOIDeleted(q[u]);x=q[u];B=g(x.group);for(z=0;z<B.length;z++)if(B[z].id==x.id){B.splice(z,1);break}}t.length+q.length>0&&m()}};return p},MapProvider:function(){return{zoomLevel:0,checkZoomLevel:function(h){return h},getCopyright:function(){},getMapTiles:function(){},getPositionForXY:function(){return null}}},P:function(){var h={calcDistance:function(g,l){if(h.empty(g)||h.empty(l))return 0;var m=(l.lat-g.lat).toRad()*0.5,
n=(l.lon-g.lon).toRad()*0.5;m=Math.sin(m)*Math.sin(m)+Math.cos(g.lat.toRad())*Math.cos(l.lat.toRad())*Math.sin(n)*Math.sin(n);return 6371*2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m))},copy:function(g){return g?new j.Position(g.lat,g.lon):null},empty:function(g){return!g||g.lat===0&&g.lon===0},equal:function(g,l){return g&&l&&g.lat==l.lat&&g.lon==l.lon},almostEqual:function(g,l){return g&&l&&Math.floor(g.lat*1E3)===Math.floor(l.lat*1E3)&&Math.floor(g.lon*1E3)===Math.floor(l.lon*1E3)},inArray:function(g,
l){for(var m=j.P.equal,n=l.length;n--;)if(m(g,l[n]))return true;return false},parse:function(g){if(g)if(typeof g.lat!=="undefined")return h.copy(g);else{if(g.split)for(var l=[" ",","],m=0;m<l.length;m++){var n=g.split(l[m]);if(n.length===2)return new j.Position(n[0],n[1])}}else return new j.Position;return null},parseArray:function(g){var l=g.length,m=Array(l);for(l=l;l--;)m[l]=h.parse(g[l]);GRUNT.Log.info("parsed "+m.length+" positions");return m},fromMercatorPixels:function(g,l,m){return new j.Position(SLICK.Geo.Utilities.pix2lat(l,
m),SLICK.Geo.Utilities.normalizeLon(SLICK.Geo.Utilities.pix2lon(g,m)))},toMercatorPixels:function(g,l){return new SLICK.Vector(SLICK.Geo.Utilities.lon2pix(g.lon,l),SLICK.Geo.Utilities.lat2pix(g.lat,l))},toString:function(g){return g?g.lat+" "+g.lon:""}};return h}(),B:function(){var h=-(Math.PI/2),g=Math.PI/2,l=-Math.PI*2,m=Math.PI*2;return{createBoundsFromCenter:function(n,r){var p=r/6371,q=n.lat*b,t=n.lon*b,u=q-p,x=q+p;GRUNT.Log.info("rad distance = "+p);GRUNT.Log.info("rad lat = "+q+", lon = "+
t);GRUNT.Log.info("min lat = "+u+", max lat = "+x);if(u>h&&x<g){q=Math.asin(Math.sin(p)/Math.cos(q));p=t-q;if(p<l)p+=2*Math.PI;t=t+q;if(t>m)t-=2*Math.PI}else{u=Math.max(u,h);x=Math.min(x,g);p=l;t=m}return new j.BoundingBox(new j.Position(u*f,p*f),new j.Position(x*f,t*f))},toString:function(n){return"min: "+j.P.toString(n.min)+", max: "+j.P.toString(n.max)}}}(),generalizePositions:function(h,g,l){var m=h.length,n=[],r=null;l||(l=250);l/=1E3;GRUNT.Log.info("generalizing positions, must include "+g.length+
" positions");for(var p=m;p--;)if(p===0)n.unshift(h[p]);else{var q=!r||j.P.inArray(h[p],g)?l:j.P.calcDistance(r,h[p]);if(h[p]&&q>=l){n.unshift(h[p]);r=h[p]}}GRUNT.Log.info("generalized "+m+" positions into "+n.length+" positions");return n},emptyBounds:function(h){return!h||j.P.empty(h.min)||j.P.empty(h.max)},posInBounds:function(h,g){var l=!(j.P.empty(h)||j.P.empty(g));return l=(l=l&&h.lat>=g.min.lat&&h.lat<=g.max.lat)&&h.lon>=g.min.lon&&h.lon<=g.max.lon},calculateBoundsSize:function(h,g,l){var m=
new SLICK.Vector(0,g.lat-h.lat);if(typeof l==="undefined")l=true;m.x=l&&h.lon>g.lon?360-h.lon+g.lon:g.lon-h.lon;return m},getBoundingBoxZoomLevel:function(h,g){var l=h.getCenter();l=c[Math.min(Math.round(Math.abs(l.lat)*0.05),c.length)];var m=j.calculateBoundsSize(h.min,h.max);return Math.min(Math.ceil(Math.log(c[3]*g.height/m.y)/Math.log(2)),Math.ceil(Math.log(l*g.width/m.x)/Math.log(2)))},getBoundsForPositions:function(h,g){var l=null,m=SLICK.Clock.getTime();g||(g="auto");for(var n=h.length;n--;)if(l){var r=
j.calculateBoundsSize(l.min,h[n],false),p=j.calculateBoundsSize(h[n],l.max,false);if(r.x<0)l.min.lon=h[n].lon;if(r.y<0)l.min.lat=h[n].lat;if(p.x<0)l.max.lon=h[n].lon;if(p.y<0)l.max.lat=h[n].lat}else l=new SLICK.Geo.BoundingBox(h[n],h[n]);if(g){if(g=="auto"){n=j.calculateBoundsSize(l.min,l.max);g=Math.max(n.x,n.y)*0.3}l.expand(g)}GRUNT.Log.trace("calculated bounds for "+h.length+" positions",m);return l},normalizeAddress:function(h){if(!h)return"";h=h.toUpperCase();if(!e){var g=[];for(var l in i)g.push(l);
e=RegExp("(\\s)("+g.join("|")+")(\\s|$)","i")}e.lastIndex=-1;if(g=e.exec(h))h=h.replace(e,"$1"+i[g[2]]);return h},buildingMatch:function(h,g){d.lastIndex=-1;if(d.test(h))for(var l=h.replace(d,"$1"),m=g.split(","),n=0;n<m.length;n++){a.lastIndex=-1;if(a.test(m[n])){var r=a.exec(m[n]);if(l>=parseInt(r[1],10)&&l<=parseInt(r[2],10))return true}else if(l==m[n])return true}return false},rankGeocodeResponses:function(h,g,l){var m=[],n=j.AddressCompareFns;if(l&&l.compareFns)n=GRUNT.extend({},n,l.compareFns);
for(l=0;l<g.length;l++)m.push(new j.GeoSearchResult({caption:g[l].toString(),data:g[l],pos:g[l].pos,matchWeight:o(h,g[l],n,j.GeocodeFieldWeights)}));m.sort(function(r,p){return p.matchWeight-r.matchWeight});return m}};return j}();
SLICK.Geo.Location=function(){function s(b){function f(j){try{var h=new SLICK.Geo.Position(j.coords.latitude,j.coords.longitude),g=GRUNT.isPlainObject(j.coords.accuracy)&&j.coords.accuracy.horizontal?j.coords.accuracy.horizontal:j.coords.accuracy;GRUNT.Log.info("got position coordinates: "+h+", accuracy = "+g);if(b.successCallback&&(!i||g<k))b.successCallback(h,e,j);if(g>b.highAccuracyCutoff&&e<2){e=2;b.enableHighAccuracy=true;GRUNT.Log.info("Position not at required accuracy, trying again with high accuracy");
d()}i=j;k=g}catch(l){GRUNT.Log.exception(l)}}function a(j){if(j.code===j.PERMISSION_DENIED)b.errorCallback&&b.errorCallback(j);else if(j.code===j.POSITION_UNAVAILABLE)b.errorCallback&&b.errorCallback(j);else if(j.code===j.TIMEOUT){GRUNT.Log.info("had a timeout on cached position, moving to phase 1");if(b.timeout===0&&b.autoPhasing){e=1;b.timeout=o;b.enableHighAccuracy=false;d()}}}function d(){navigator.geolocation.getCurrentPosition(f,a,b)}b=GRUNT.extend({autoPhasing:true,maximumAge:3E5,timeout:0,
highAccuracyCutoff:10,enableHighAccuracy:true,successCallback:null,errorCallback:null},b);var e=0,i=null,k=1E6;d()}var o=3E3,c={get:function(){throw Error("No geolocation APIs supported.");}};if(navigator.geolocation)c.get=s;return c}();SLICK.Geo.Search=function(){return{bestResults:function(s,o){o||(o=20);for(var c=s.length>0?s[0]:null,b=[],f=0;f<s.length;f++)if(c.matchWeight-s[f].matchWeight<=o)b.push(s[f]);else break;return b}}}();
SLICK.Mapping=function(){var s=0,o={AnnotationTween:null,GeoTileGrid:function(c){c=GRUNT.extend({grid:null,centerPos:new SLICK.Geo.Position,centerXY:new SLICK.Vector,radsPerPixel:0},c);var b=SLICK.Geo.P.toMercatorPixels(c.centerPos,c.radsPerPixel),f=b.x-c.centerXY.x,a=b.y-c.centerXY.y,d=GRUNT.extend({},c.grid,{getBoundingBox:function(e,i,k,j){return new SLICK.Geo.BoundingBox(d.pixelsToPos(new SLICK.Vector(e,i+j)),d.pixelsToPos(new SLICK.Vector(e+k,i)))},getCenterOffset:function(){return c.centerXY},
getGridXYForPosition:function(e){e=SLICK.Geo.P.toMercatorPixels(e,c.radsPerPixel);return new SLICK.Vector(e.x-f,d.gridDimensions.height-(e.y-a))},getGuideOffset:function(e){var i=d.getTileSize();return new SLICK.Vector(e.x%i,e.y%i)},pixelsToPos:function(e){return SLICK.Geo.P.fromMercatorPixels(f+e.x,a+d.gridDimensions.height-e.y,c.radsPerPixel)}});return d},POIViewLayer:function(c){GRUNT.extend({},c)},Overlay:function(c){GRUNT.extend({},c);return{}},RadarOverlay:function(c){c=GRUNT.extend({radarFill:"rgba(0, 221, 238, 0.1)",
radarStroke:"rgba(0, 102, 136, 0.3)",zindex:100},c);return GRUNT.extend(new SLICK.Graphics.ViewLayer(c),{draw:function(b,f,a){f=a.width>>1;a=a.height>>1;b.fillStyle=c.radarFill;b.strokeStyle=c.radarStroke;b.beginPath();b.arc(f,a,50,0,Math.PI*2,false);b.fill();b.stroke()}})},CrosshairOverlay:function(c){c=GRUNT.extend({lineWidth:1.5,strokeStyle:"rgba(0, 0, 0, 0.5)",size:15,zindex:150,scalePosition:false,validStates:SLICK.Graphics.DisplayState.ACTIVE|SLICK.Graphics.DisplayState.ANIMATING|SLICK.Graphics.DisplayState.PAN},
c);return GRUNT.extend(new SLICK.Graphics.ViewLayer(c),{draw:function(b,f,a){f=a.getCenter();b.lineWidth=c.lineWidth;b.strokeStyle=c.strokeStyle;a=c.size;b.beginPath();b.moveTo(f.x,f.y-a);b.lineTo(f.x,f.y+a);b.moveTo(f.x-a,f.y);b.lineTo(f.x+a,f.y);b.arc(f.x,f.y,a*0.6666,0,2*Math.PI,false);b.stroke()}})},RouteOverlay:function(c){c=GRUNT.extend({strokeStyle:"rgba(0, 51, 119, 0.9)",waypointFillStyle:"#FFFFFF",lineWidth:4,data:null,pixelGeneralization:8,calculationsPerCycle:250,partialDraw:false,zindex:50},
c);var b=true,f=null,a=[],d=0,e=[],i=[],k=GRUNT.extend(new SLICK.Graphics.ViewLayer(c),{getAnimation:function(j,h,g,l){if(b)return null;var m="routeAnimation"+s++;i.push(m);return new SLICK.Graphics.AnimatedPathLayer({id:m,path:a,zindex:c.zindex+1,easing:j?j:SLICK.Animation.Easing.Sine.InOut,duration:h?h:5E3,drawIndicator:g,autoCenter:l?l:false})},draw:function(j,h,g,l,m){g=0;l=c.data?c.data.geometry:null;if(b){b=false;f=null;a=[];d=0}if(l&&d<l.length){a:{m=m.getTileLayer();e=[];l=GRUNT.Log.getTraceTicks();
var n,r,p,q=c.data?c.data.geometry:[],t=q.length,u=c.data?c.data.instructions:[],x=u.length,B=c.calculationsPerCycle,z=0;for(n=d;n<t;n++){r=m.getGridXYForPosition(q[n]);if(p=!f||n===0||Math.abs(r.x-f.x)+Math.abs(r.y-f.y)>c.pixelGeneralization){a.push(r);f=r}z++;if(z>=B){d=n;break a}}d=t;GRUNT.Log.trace(t+" geometry points generalized to "+a.length+" coordinates",l);f=null;for(n=x;n--;)if(u[n].position){r=m.getGridXYForPosition(u[n].position);if(p=!f||n===0||Math.abs(r.x-f.x)+Math.abs(r.y-f.y)>c.pixelGeneralization){e.push(r);
f=r}}}g++}m=a.length;if(m>0&&(!g||c.partialDraw)){j.strokeStyle=c.strokeStyle;j.lineWidth=c.lineWidth;j.beginPath();j.moveTo(a[m-1].x-h.x,a[m-1].y-h.y);for(m=m;m--;)j.lineTo(a[m].x-h.x,a[m].y-h.y);j.stroke();j.fillStyle=c.waypointFillStyle;for(m=e.length;m--;){j.beginPath();j.arc(e[m].x-h.x,e[m].y-h.y,2,0,Math.PI*2,false);j.stroke();j.fill()}}return g}});GRUNT.WaterCooler.listen("grid.updated",function(){for(var j=i.length;j--;)GRUNT.WaterCooler.say("layer.remove",{id:i[j]});i=[];b=true;k.wakeParent()});
return k},Annotation:function(c){c=GRUNT.extend({xy:null,pos:null,draw:null,tweenIn:o.AnnotationTween,animationSpeed:null},c);var b=false,f={xy:c.xy,pos:c.pos,isNew:true,isAnimating:function(){return b},draw:function(a,d,e,i){if(f.xy){if(f.isNew&&c.tweenIn){var k=f.xy.y;f.xy.y=d.y-20;b=true;SLICK.Animation.tween(f.xy,"y",k,c.tweenIn,function(){f.xy.y=k;b=false},c.animationSpeed?c.animationSpeed:250+Math.random()*500)}if(c.draw)c.draw(a,d,new SLICK.Vector(f.xy.x-d.x,f.xy.y-d.y),e,i);else{a.beginPath();
a.arc(f.xy.x-d.x,f.xy.y-d.y,4,0,Math.PI*2,false);a.fill()}f.isNew=false}}};return f},ImageAnnotation:function(c){c=GRUNT.extend({imageUrl:null,animatingImageUrl:null,imageAnchor:null},c);var b=c.imageAnchor?SLICK.V.invert(c.imageAnchor):null;c.draw=function(a,d,e,i,k){if(c.animatingImageUrl&&f.isAnimating()){SLICK.Resources.loadImage(c.imageUrl);i=c.animatingImageUrl}else i=c.imageUrl;if(d=SLICK.Resources.getImage(i)){if(d.complete&&d.width>0){b||(b=new SLICK.Vector(-d.width>>1,-d.height>>1));e=SLICK.V.offset(e,
b.x,b.y);a.drawImage(d,e.x,e.y,d.width,d.height)}}else SLICK.Resources.loadImage(i,function(){k.wakeParent()})};var f=new o.Annotation(c);return f},AnnotationsOverlay:function(c){function b(i){for(var k=c.map?c.map.getTileLayer():null,j=0;k&&j<i.length;j++)i[j].xy=k.getGridXYForPosition(i[j].pos)}c=GRUNT.extend({pois:null,map:null,createAnnotationForPOI:null,zindex:100},c);var f=[],a=false,d=[],e=GRUNT.extend(new SLICK.Graphics.ViewLayer(c),{draw:function(i,k,j,h){i.save();try{var g;a=false;i.fillStyle=
"rgba(255, 0, 0, 0.75)";i.globalCompositeOperation="source-over";for(g=f.length;g--;){f[g].draw(i,k,h,e);a=a||f[g].isAnimating()}for(g=d.length;g--;){d[g].draw(i,k,h,e);a=a||d[g].isAnimating()}a&&e.wakeParent()}finally{i.restore()}},add:function(i){d.push(i);b(d);e.wakeParent()},clear:function(i){d=[];b(d);if(i){f=[];b(f)}e.wakeParent()},isAnimating:function(){return a}});GRUNT.WaterCooler.listen("geo.pois-updated",function(i){if(c.pois&&c.pois.id==i.srcID){i=i.pois;try{f=[];for(var k=0;k<i.length;k++)if(i[k].pos){var j;
var h=i[k];if(h&&h.pos){var g=null;if(g=c.createAnnotationForPOI?c.createAnnotationForPOI(h):new o.Annotation({pos:h.pos})){g.isNew=h.isNew;h.isNew=false}j=g}else j=void 0;j&&f.push(j)}b(f)}catch(l){GRUNT.Log.exception(l)}e.wakeParent()}});GRUNT.WaterCooler.listen("grid.updated",function(){b(f);b(d);e.wakeParent()});return e},Tiler:function(c){c=GRUNT.extend({tapExtent:10,provider:null,crosshair:true,copyright:undefined,zoomLevel:0,boundsChange:null,tapPOI:null,tapHandler:null,boundsChangeThreshold:30,
pois:new SLICK.Geo.POIStorage,createAnnotationForPOI:null,onTilesLoaded:null},c);if(typeof c.copyright==="undefined")c.copyright=c.provider?c.provider.getCopyright():"";var b=new SLICK.Vector,f=c.copyright,a=false,d=[],e=0,i=null,k=null,j=c.zoomLevel;if(!c.provider)c.provider=new SLICK.Geo.MapProvider;var h=c.panHandler,g=c.tapHandler;c.onPan=function(n,r){h&&h(n,r)};c.tapHandler=function(n,r){var p=m.getTileLayer(),q=null;if(p){q=m.viewPixToGridPix(new SLICK.Vector(r.x,r.y));var t=p.pixelsToPos(q),
u=p.pixelsToPos(SLICK.V.offset(q,-c.tapExtent,c.tapExtent)),x=p.pixelsToPos(SLICK.V.offset(q,c.tapExtent,-c.tapExtent));GRUNT.Log.info("grid tapped @ "+SLICK.Geo.P.toString(p.pixelsToPos(q)));q=new SLICK.Geo.BoundingBox(u,x);d=m.pois.findByBounds(q);c.tapPOI&&c.tapPOI(d)}g&&g(n,r,t,q)};c.doubleTapHandler=function(n,r){m.animate(2,m.getDimensions().getCenter(),new SLICK.Vector(r.x,r.y),SLICK.Animation.Easing.Sine.Out)};c.onScale=function(n,r){var p=0;n=Math.sqrt(n);if(n<1)p=-(0.5/n);else if(n>1)p=
n;m.gotoPosition(m.getXYPosition(r),j+Math.floor(p))};var l=new SLICK.Tiling.Tiler(c),m=GRUNT.extend({},l,{pois:c.pois,annotations:null,getBoundingBox:function(){var n=new SLICK.Geo.BoundingBox,r=m.getTileLayer(),p=m.getOffset(),q=m.getDimensions();if(r)n=r.getBoundingBox(p.x,p.y,q.width,q.height);return n},getCenterPosition:function(){return m.getXYPosition(m.gridDimensions.getCenter())},getXYPosition:function(n){return m.getTileLayer().pixelsToPos(m.viewPixToGridPix(n))},gotoBounds:function(n,r){var p=
SLICK.Geo.getBoundingBoxZoomLevel(n,m.getDimensions());m.gotoPosition(n.getCenter(),p,r)},gotoCurrentPosition:function(n){SLICK.Geo.Location.get({successCallback:function(r){m.clearBackground();m.gotoPosition(r,15,n)},errorCallback:function(){}})},gotoPosition:function(n,r,p){var q=j,t=(new Date).getTime();j=r?r:j;if(!j)throw"Zoom level required to goto a position.";if(c.provider)j=c.provider.checkZoomLevel(j);if(!a||j!==q){SLICK.Resources.resetImageLoadQueue();(r=m.getTileLayer())&&r.deactivate();
SLICK.Animation.cancel();a&&m.freeze();e=t;c.provider.zoomLevel=j;c.provider.getMapTiles(m,n,function(u){if(t===e){m.setTileLayer(u);k=u.getId();m.panToPosition(n,function(){m.unfreeze();p&&p()})}else GRUNT.Log.info("request time mismatch - ignoring update")});a=true}else m.panToPosition(n,p)},panToPosition:function(n,r,p){var q=m.getTileLayer();if(q){n=q.getGridXYForPosition(n);q=m.getDimensions();n.x-=q.width>>1;n.y-=q.height>>1;if(i)i=null;m.updateOffset(n.x,n.y,p);GRUNT.WaterCooler.say("view.wake",
{id:m.id});c.boundsChange&&c.boundsChange(m.getBoundingBox());r&&r(m)}},setZoomLevel:function(n){m.gotoPosition(m.getCenterPosition(),n)},zoomIn:function(){m.scale(2,SLICK.Animation.Easing.Sine.Out)||m.setZoomLevel(j+1)},zoomOut:function(){m.scale(0.5,SLICK.Animation.Easing.Sine.Out)||m.setZoomLevel(j-1)},animateRoute:function(n,r,p,q){var t=m.getLayer("route");if(t)(n=t.getAnimation(n,r,p,q))&&n.addToView(m)}},l);l=new SLICK.Mapping.AnnotationsOverlay({pois:m.pois,map:m,createAnnotationForPOI:c.createAnnotationForPOI});
m.annotations=l;m.setLayer("annotations",l);c.crosshair&&m.setLayer("crosshair",new SLICK.Mapping.CrosshairOverlay);f&&m.setLayer("copyright",new SLICK.Graphics.ViewLayer({zindex:999,draw:function(n,r,p){n.lineWidth=2.5;n.fillStyle="rgb(50, 50, 50)";n.strokeStyle="rgba(255, 255, 255, 0.8)";n.font="bold 10px sans";n.textBaseline="bottom";n.strokeText(f,10,p.height-10);n.fillText(f,10,p.height-10)}}));GRUNT.WaterCooler.listen("view-idle",function(n){if(n.id&&n.id==m.id)if(SLICK.V.absSize(SLICK.V.diff(b,
m.getOffset()))>c.boundsChangeThreshold&&c.boundsChange){b=m.getOffset();c.boundsChange(m.getBoundingBox())}});GRUNT.WaterCooler.listen("tiles.drawn",function(n){n.id&&n.id==k&&c.onTilesLoaded&&c.onTilesLoaded()});return m}};return o}();
SLICK.Geo.Routing=function(){var s={calculate:function(o){o=GRUNT.extend({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:true},o);GRUNT.Log.info("attempting to calculate route");var c=SLICK.Geo.getEngine("route");c&&c.route(o,function(b){if(o.generalize)b.geometry=SLICK.Geo.generalizePositions(b.geometry,b.getInstructionPositions());if(o.map){s.createMapOverlay(o.map,b);if(o.autoFit){GRUNT.Log.info("AUTOFITTING MAP TO ROUTE: bounds = "+b.boundingBox);o.map.gotoBounds(b.boundingBox)}}o.success&&
o.success(b)})},createMapOverlay:function(o,c){var b=o.getDimensions();b=new SLICK.Mapping.RouteOverlay({data:c,width:b.width,height:b.height});o.setLayer("route",b)},Maneuver:{None:0,Continue:1,TurnLeft:100,TurnLeftSlight:101,TurnLeftSharp:102,TurnRight:110,TurnRightSlight:111,TurnRightSharp:112,TurnAround:190,EnterRoundabout:200,ExitRamp:300},Instruction:function(o){o=GRUNT.extend({position:null,description:"",manuever:s.Maneuver.None},o);return GRUNT.extend(o,{})},RouteData:function(o){o=GRUNT.extend({geometry:[],
instructions:[],boundingBox:null},o);if(!o.boundingBox)o.boundingBox=SLICK.Geo.getBoundsForPositions(o.geometry);return GRUNT.extend({getInstructionPositions:function(){for(var c=[],b=0;b<o.instructions.length;b++)o.instructions[b].position&&c.push(o.instructions[b].position);return c}},o)}};return s}();
