if(!this.JSON)this.JSON={};
(function(){function p(a){return a<10?"0"+a:a}function l(a){j.lastIndex=0;return j.test(a)?'"'+a.replace(j,function(e){var g=c[e];return typeof g==="string"?g:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function k(a,e){var g,i,m,n,r=b,o,q=e[a];if(q&&typeof q==="object"&&typeof q.toJSON==="function")q=q.toJSON(a);if(typeof h==="function")q=h.call(e,a,q);switch(typeof q){case "string":return l(q);case "number":return isFinite(q)?String(q):"null";case "boolean":case "null":return String(q);
case "object":if(!q)return"null";b+=d;o=[];if(Object.prototype.toString.apply(q)==="[object Array]"){n=q.length;for(g=0;g<n;g+=1)o[g]=k(g,q)||"null";m=o.length===0?"[]":b?"[\n"+b+o.join(",\n"+b)+"\n"+r+"]":"["+o.join(",")+"]";b=r;return m}if(h&&typeof h==="object"){n=h.length;for(g=0;g<n;g+=1){i=h[g];if(typeof i==="string")if(m=k(i,q))o.push(l(i)+(b?": ":":")+m)}}else for(i in q)if(Object.hasOwnProperty.call(q,i))if(m=k(i,q))o.push(l(i)+(b?": ":":")+m);m=o.length===0?"{}":b?"{\n"+b+o.join(",\n"+b)+
"\n"+r+"}":"{"+o.join(",")+"}";b=r;return m}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+p(this.getUTCMonth()+1)+"-"+p(this.getUTCDate())+"T"+p(this.getUTCHours())+":"+p(this.getUTCMinutes())+":"+p(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var f=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
j=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,b,d,c={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},h;if(typeof JSON.stringify!=="function")JSON.stringify=function(a,e,g){var i;d=b="";if(typeof g==="number")for(i=0;i<g;i+=1)d+=" ";else if(typeof g==="string")d=g;if((h=e)&&typeof e!=="function"&&(typeof e!=="object"||typeof e.length!=="number"))throw Error("JSON.stringify");return k("",
{"":a})};if(typeof JSON.parse!=="function")JSON.parse=function(a,e){function g(m,n){var r,o,q=m[n];if(q&&typeof q==="object")for(r in q)if(Object.hasOwnProperty.call(q,r)){o=g(q,r);if(o!==undefined)q[r]=o;else delete q[r]}return e.call(m,n,q)}var i;a=String(a);f.lastIndex=0;if(f.test(a))a=a.replace(f,function(m){return"\\u"+("0000"+m.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){i=eval("("+a+")");return typeof e==="function"?g({"":i},""):i}throw new SyntaxError("JSON.parse");}})();if(!String.format)String.format=function(p){if(arguments.length<=1)return p;for(var l=arguments.length-2,k=0;k<=l;k++)p=p.replace(RegExp("\\{"+k+"\\}","gi"),arguments[k+1]);return p};
String.prototype.containsWord=function(p){var l="";if(p.toString)p=p.toString();for(var k=0;k<p.length;k++)l+=!/\w/.test(p[k])?"\\"+p[k]:p[k];return RegExp("(^|\\s|\\,)"+l+"(\\,|\\s|$)","i").test(this)};Number.prototype.toRad=function(){return this*Math.PI/180};Number.prototype.sec=function(){return 1/Math.cos(this)};
GRUNT=function(){var p=Object.prototype.hasOwnProperty,l=0,k={id:"GRUNT.core",extend:function(){var f=arguments[0]||{},j=1,b=arguments.length,d=false,c,h,a,e;if(typeof f==="boolean"){d=f;f=arguments[1]||{};j=2}if(typeof f!=="object"&&!k.isFunction(f))f={};if(b===j){f=this;--j}for(;j<b;j++)if((c=arguments[j])!=null)for(h in c){a=f[h];e=c[h];if(f!==e)if(d&&e&&(k.isPlainObject(e)||k.isArray(e))){a=a&&(k.isPlainObject(a)||k.isArray(a))?a:k.isArray(e)?[]:{};f[h]=k.extend(d,a,e)}else if(e!==undefined)f[h]=
e}return f},isFunction:function(f){return toString.call(f)==="[object Function]"},isArray:function(f){return toString.call(f)==="[object Array]"},isPlainObject:function(f){if(!f||toString.call(f)!=="[object Object]"||f.nodeType||f.setInterval)return false;if(f.constructor&&!p.call(f,"constructor")&&!p.call(f.constructor.prototype,"isPrototypeOf"))return false;var j;for(j in f);return j===undefined||p.call(f,j)},isEmptyObject:function(f){for(var j in f)return false;return true},isXmlDocument:function(f){return toString.call(f)===
"[object Document]"},contains:function(f,j){var b=f,d=arguments,c=1;if(j&&k.isArray(j)){d=j;c=0}for(c=c;c<d;c++)b=b&&typeof foo[d[c]]!=="undefined";return b},newModule:function(f){f=k.extend({id:null,requires:[],parent:null},f);if(f.parent)f=k.extend({},f.parent,f);return f},toID:function(f){return f.replace(/\s/g,"-")},generateObjectID:function(f){return(f?f:"obj")+l++}};return k}();
GRUNT.Log=function(){function p(b,d){var c,h=d&&d.length>0?d[0]:"";for(c=1;d&&c<d.length;c++)h+=" "+(k&&GRUNT.isPlainObject(d[c])?JSON.stringify(d[c]):d[c]);typeof console!=="undefined"&&console[b](h);for(c=0;c<l.length;c++)l[c].call(j,h,b)}var l=[],k=typeof JSON!=="undefined",f=window.console&&window.console.markTimeline,j={id:"GRUNT.log",getTraceTicks:function(){return f?(new Date).getTime():null},trace:function(b,d){if(f)console.markTimeline(b+(d?": "+(j.getTraceTicks()-d)+"ms":""))},debug:function(){p("debug",
arguments)},info:function(){p("info",arguments)},warn:function(){p("warn",arguments)},error:function(){p("error",arguments)},exception:function(b){j.error(arguments);for(var d in b)j.info("ERROR DETAIL: "+d+": "+b[d])},watch:function(b,d){try{d()}catch(c){j.exception(c,b)}},throwError:function(b){j.error(b);throw Error(b);},requestUpdates:function(b){l.push(b)}};return j}();
GRUNT.Data=function(){var p={determineObjectMapping:function(k){if(!k)return null;k=k.split("|");for(var f={},j=0;j<k.length;j++)f[k[j]]=j;return f},mapLineToObject:function(k,f){var j=k.split("|"),b={};for(var d in f){var c=f[d];b[d]=j.length>c?j[c]:null}return b},parse:function(k){var f=null,j=[];k=k.split("\n");for(var b=0;b<k.length;b++){var d=k[b];if(f)j.push(p.mapLineToObject(d,f));else f=p.determineObjectMapping(d)}return j}},l={supportedFormats:{JSON:{parse:function(k){return JSON.parse(k)}},
PDON:{parse:function(k){return p.parse(k)}}},parse:function(k){k=GRUNT.extend({data:"",format:"JSON"},k);if(!l.supportedFormats[k.format])throw Error("Unsupported data format: "+k.format+", cannot parse data in javascript object");try{return l.supportedFormats[k.format].parse(k.data)}catch(f){GRUNT.Log.error("ERROR PARSING DATA FROM FORMAT: "+k.format,k.data);GRUNT.Log.exception(f)}return{}}};return l}();
GRUNT.Template=function(){var p=/\$\{(.*?)\}/ig;return{parse:function(l,k){for(var f=l,j=p.exec(f);j;){f=f.replace(j[0],GRUNT.XPath.first(j[1],k));p.lastIndex=0;j=p.exec(f)}return f}}}();
GRUNT.JSONP=function(){function p(j){var b=document.createElement("script"),d=false;b.src=j;b.async=true;b.onload=b.onreadystatechange=function(){if(!d&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){d=true;b.onload=b.onreadystatechange=null;b&&b.parentNode&&b.parentNode.removeChild(b)}};k||(k=document.getElementsByTagName("head")[0]);k.appendChild(b)}var l=0,k,f=this;return{get:function(j,b){j+=j.indexOf("?")>=0?"&":"?";var d="json"+ ++l;f[d]=function(c){b(c);f[d]=
null;try{delete f[d]}catch(h){}};p(j+"callback="+d);return d}}}();
GRUNT.XHR=function(){var p={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},l={JSON:["json"],PDON:["pdon.txt"]},k=["TEXT","STREAM"],f=/^(\w+:)?\/\/([^\/?#]+)/,j={XML:function(c){return c.responseXML},JSON:function(c){try{return JSON.parse(c.responseText)}catch(h){GRUNT.Log.error("Error parsing JSON data: ",c.responseText);GRUNT.Log.exception(h)}return""},PDON:function(c){return GRUNT.Data.parse({data:c.responseText,format:"PDON"})},DEFAULT:function(c){return c.responseText}},
b={CONTENT_TYPE:"Content-Type"},d=GRUNT.newModule({id:"GRUNT.xhr",ajaxSettings:{xhr:null},ajax:function(c){try{c=GRUNT.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},d.ajaxSettings,c);var h=f.exec(c.url),a=h&&(h[1]&&h[1]!==location.protocol||h[2]!==location.host);if(c.data)c.method="POST";if(c.url){h=null;if(c.xhr)h=c.xhr(c);h||(h=new XMLHttpRequest);h.open(c.method,c.url,c.async);c.data&&h.setRequestHeader("Content-Type",
c.contentType);a||h.setRequestHeader("X-Requested-With","XMLHttpRequest");h.onreadystatechange=function(){if(this.readyState===4){var g=null,i=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(i)if(c.handleResponse)c.handleResponse(this);else{var m=c,n=this.getResponseHeader(b.CONTENT_TYPE),r,o=false;for(r in p)if(n&&n.indexOf(p[r])>=0){o=true;break}n=!o;for(o=0;o<k.length;o++)n=n||k[o]==r;if(n)b:{n=r;for(var q in l)for(o=
0;o<l[q].length;o++)if(RegExp(l[q][o]+"$","i").test(m.url)){r=q;break b}r=n?n:"DEFAULT"}try{g=j[r](this,m)}catch(s){GRUNT.Log.warn("error applying processor '"+r+"' to response type, falling back to default");g=j.DEFAULT(this,m)}}else c.error&&c.error(this)}catch(v){GRUNT.Log.exception(v,"PROCESSING AJAX RESPONSE")}i&&g&&c.success&&c.success.call(this,g)}};h.send(c.method=="POST"?d.param(c.data):null)}else GRUNT.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(e){GRUNT.Log.exception(e)}},
param:function(c){var h=[],a=function(g,i){i=GRUNT.isFunction(i)?i():i;h[h.length]=encodeURIComponent(g)+"="+encodeURIComponent(i)};if(GRUNT.isArray(c))for(var e=0;e<c.length;e++)a(c[e].name,c[e].value);else for(e in c)a(e,c[e]);return h.join("&").replace(/%20/g,"+")}});return d}();
GRUNT.XPath=function(){function p(j){for(var b=null,d=0;d<l.length;d++)if(b=l[d](j))break;return b}var l=[],k=[null,function(j){return j.numberValue},function(j){return j.stringValue},function(j){return j.booleanValue},null,null,null,null,function(j){return j.singleNodeValue?j.singleNodeValue.textContent:null},function(j){return j.singleNodeValue?j.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||GRUNT.Log.warn("No XPATH support, this is going to cause problems");var f={SearchResult:function(j){return{toString:function(){var b=
null;if(j){var d=null;if(j.resultType>=0&&j.resultType<k.length)d=k[j.resultType];if(d){GRUNT.Log.info("invoking match handler for result type: "+j.resultType);b=d(j)}}return b?b:""}}},first:function(j,b){var d=f.SearchResult,c;var h=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!h)h=XPathResult.ANY_TYPE;try{if(GRUNT.isXmlDocument(b))c=b.evaluate(j,b,p,h,null);else{GRUNT.Log.warn("attempted xpath expression: "+j+" on a non-xml document");c=null}}catch(a){GRUNT.Log.warn("attempted to run invalid xpath expression: "+
j+" on node: "+b);c=null}return new d(c)},registerResolver:function(j){l.push(j)}};return f}();GRUNT.WaterCooler=function(){var p={};return{listen:function(l,k){p[l]||(p[l]=[]);k&&p[l].push(k)},say:function(l,k){if(p[l])for(var f=0;f<p[l].length;f++)p[l][f](k)},leave:function(){}}}();
SLICK=function(){function p(){l={base:{name:"Unknown",eventTarget:document,supportsTouch:"createTouch"in document,imageCacheMaxSize:4096,getScaling:function(){return 1},maxImageLoads:4},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144},android:{name:"Android OS <= 2.1",regex:/android/i,eventTarget:document.body,supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio}},froyo:{name:"Android OS >= 2.2",
regex:/froyo/i,eventTarget:document.body,supportsTouch:true}};k=[l.iphone,l.froyo,l.android,l.ipad]}var l=null,k=[],f=null,j={getDeviceConfig:function(){l||p();if(!f){GRUNT.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var b=0;b<k.length;b++){var d=k[b];if(d.regex&&d.regex.test(navigator.userAgent)){f=GRUNT.extend({},l.base,d);GRUNT.Log.info("PLATFORM DETECTED AS: "+f.name);break}}if(!f){GRUNT.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
f=l.base}GRUNT.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return f},copyRect:function(b){return b?new j.Rect(b.origin.x,b.origin.y,b.dimensions.width,b.dimensions.height):null},Settings:function(){var b={};return{get:function(d){return b[d]},set:function(d,c){b[d]=c},extend:function(d){GRUNT.extend(b,d)}}}(),Clock:function(){var b=null;return{getTime:function(d){return d&&b?b:b=(new Date).getTime()}}}(),Vector:function(b,d){return{x:b?b:0,y:d?d:0}},V:function(){return{create:function(b,
d){return new j.Vector(b,d)},add:function(){for(var b=new j.Vector,d=arguments.length;d--;){b.x+=arguments[d].x;b.y+=arguments[d].y}return b},absSize:function(b){return Math.max(Math.abs(b.x),Math.abs(b.y))},diff:function(b,d){return new j.Vector(b.x-d.x,b.y-d.y)},copy:function(b){return b?new j.Vector(b.x,b.y):null},invert:function(b){return new SLICK.Vector(-b.x,-b.y)},offset:function(b,d,c){return new SLICK.Vector(b.x+d,b.y+(c?c:d))}}}(),VectorArray:function(b,d){for(var c=Array(b.length),h=b.length;h--;)c[h]=
d?j.V.copy(b[h]):b[h];return{applyOffset:function(a){for(var e=c.length;e--;){c[e].x+=a.x;c[e].y+=a.y}},getRect:function(){return new SLICK.Rect(Math.min(c[0].x,c[1].x),Math.min(c[0].y,c[1].y),Math.abs(c[0].x-c[1].x),Math.abs(c[0].y-c[1].y))},toString:function(){for(var a="",e=c.length;e--;)a+="["+c[e].toString()+"] ";return a}}},VectorMath:function(){function b(d){if(!d||d.length<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var c={edges:Array(d.length-
1),accrued:Array(d.length-1),total:0},h=SLICK.V.diff,a=0;a<d.length-1;a++){var e=h(d[a],d[a+1]);c.edges[a]=Math.sqrt(e.x*e.x+e.y*e.y);c.accrued[a]=c.total+c.edges[a];c.total+=c.edges[a]}return c}return{edges:b,distance:function(d){return b(d).total},theta:function(d,c,h){h=Math.asin((d.y-c.y)/h);return d.x>c.x?h:Math.PI-h},pointOnEdge:function(d,c,h,a){c=new SLICK.Vector(Math.cos(h)*a,Math.sin(h)*a);return new SLICK.Vector(d.x-c.x,d.y-c.y)}}}(),Dimensions:function(b,d){var c=d?b/d:1,h={width:b,height:d,
aspect_ratio:c,inv_aspect_ratio:1/c,getAspectRatio:function(){return h.height!==0?h.width/h.height:1},getCenter:function(){return new SLICK.Vector(h.width>>1,h.height>>1)},grow:function(a,e){return new SLICK.Dimensions(h.width+a,h.height+e)},matches:function(a){return a&&h.width==a.width&&h.height==a.height},toString:function(){return h.width+" x "+h.height}};return h},Rect:function(b,d,c,h){var a={origin:new SLICK.Vector(b,d),dimensions:new SLICK.Dimensions(c,h),getCenter:function(){return new SLICK.Vector(a.origin.x+
(a.dimensions.width>>1),a.origin.y+(a.dimensions.height>>1))},getSize:function(){return Math.sqrt(Math.pow(a.dimensions.width,2)+Math.pow(a.dimensions.height,2))},grow:function(e,g){var i=new SLICK.Dimensions(e-a.dimensions.width,g-a.dimensions.height);a.dimensions.width=e;a.dimensions.height=g;return i},expand:function(e,g){a.origin.x-=e;a.origin.y-=g;a.dimensions.width+=e;a.dimensions.height+=g},offset:function(e){return new j.Rect(a.origin.x+e.x,a.origin.y+e.y,a.dimensions.width,a.dimensions.height)},
getRequiredDelta:function(e,g){var i={top:0,left:0,bottom:0,right:0};i.top=e.origin.y-a.origin.y+(g?g.y:0);i.left=e.origin.x-a.origin.x+(g?g.x:0);i.right=e.origin.x+e.dimensions.width-(a.origin.x+a.dimensions.width)-i.left;i.bottom=e.origin.y+e.dimensions.height-(a.origin.y+a.dimensions.height)-i.top;return i},applyDelta:function(e,g,i){if(!e||!GRUNT.contains(e,["top","left","bottom","right"]))throw Error("Invalid delta - cannot apply to SLICK.Rect");g||(g=1);a.origin.x+=e.left*g;a.origin.y+=e.top*
g;a.dimensions.width+=e.right*g;a.dimensions.height+=e.bottom*g;i&&a.constrainAspectRatio(i)},constrainAspectRatio:function(e){var g=0,i={top:0,left:0,bottom:0,right:0};if(a.dimensions.getAspectRatio()<e){g=Math.abs(a.dimensions.width-a.dimensions.height*e);i.left=-g;i.right=g}else{g=Math.abs(a.dimensions.height-a.dimensions.width/e);i.top=-g;i.bottom=g}a.applyDelta(i)},moveTo:function(e,g){var i=new SLICK.Vector(e-a.origin.x,g-a.origin.y);a.origin.x=e;a.origin.y=g;return i},toString:function(){return String.format("(origin: {0}, dimensions: {1})",
a.origin,a.dimensions)}};return a}};return j}();
SLICK.Resources=function(){var p="",l={},k=function(){function j(){var n=c[this.src];if(n){n.loaded=true;n.hitCount=1;for(var r=a.length;r--;)if(a[r].image.src==this.src){a.splice(r,1);break}n.loadCallback&&n.loadCallback(this,false);e.push({url:this.src,created:n.requested});b()}}function b(){for(var n=SLICK.getDeviceConfig().maxImageLoads;h.length>0&&(!n||a.length<n);){var r=h.shift();a.push(r);r.image.onload=j;r.image.src=r.url;r.requested=(new Date).getTime()}}function d(){i=true;try{var n=Math.floor(e.length*
0.5);if(n>0){e.sort(function(o,q){return o.created-q.created});for(var r=n;r--;)delete c[e[r].url];e.splice(0,n)}}finally{i=false}GRUNT.WaterCooler.say("imagecache.cleared")}var c={},h=[],a=[],e=[],g=0,i=false,m={loadingImages:a,queuedImages:h,getCacheFullness:function(){return g},getImage:function(n){var r=null;i||(r=c[n]);return r?r.image:null},loadImage:function(n,r){var o=c[n];if(o){o.hitCount++;o.image.complete&&r&&r(o.image,true)}else{o={url:n,image:new Image,loaded:false,created:(new Date).getTime(),
requested:null,hitCount:0,loadCallback:r};c[n]=o;h.push(o);b()}return o},resetLoadingQueue:function(){a=[]}};setInterval(function(){for(var n=(new Date).getTime(),r=false,o=0,q=SLICK.getDeviceConfig();o<a.length;)if(n-a[o].requested>f.loadTimeout*1E3){a.splice(o,1);r=true}else o++;r&&b();if(q&&q.imageCacheMaxSize){g=e.length*f.avgImageSize/q.imageCacheMaxSize;g>=1&&d()}},1E3);return m}(),f={avgImageSize:25,loadTimeout:10,Cache:function(){return{read:function(){return null},write:function(){},getUrlCacheKey:function(j,
b){for(var d=(j?j.replace(/^.*\?/,""):"").split("&"),c=j?j.replace(/\?.*$/,"?"):"",h=0;h<d.length;h++){var a=d[h].split("=");if(!b||!b.test(a[0]))c+=d[h]+"&"}return c.replace(/\W/g,"")},isValidCacheKey:function(j){GRUNT.Log.info("cache key = "+j);return false}}}(),getCachedUrl:function(j){return j},getPath:function(j){return/^(https?|\/)/.test(j)?j:p+j},setBasePath:function(j){p=j},getImage:function(j){return k.getImage(j)},loadImage:function(j,b){k.loadImage(j,b)},resetImageLoadQueue:function(){k.resetLoadingQueue()},
getStats:function(){return{imageLoadingCount:k.loadingImages.length,queuedImageCount:k.queuedImages.length,imageCacheFullness:k.getCacheFullness()}},loadResource:function(j){j=GRUNT.extend({filename:"",cacheable:true,dataType:null,callback:null},j);var b=function(d){j.callback&&GRUNT.Log.watch("CALLING RESOURCE CALLBACK",function(){j.callback(d)})};j.cacheable&&l[j.filename]?b(l[j.filename]):GRUNT.XHR.ajax({url:f.getPath(j.filename),dataType:j.dataType,success:function(d){if(j.cacheable)l[j.filename]=
d;b(d)},error:function(d,c,h){GRUNT.Log.error("error loading resource ["+j.filename+"], error = "+h)}})},loadSnippet:function(j,b){/\.\w+$/.test(j)||(j+=".html");f.loadResource({filename:"snippets/"+j,callback:b,dataType:"html"})}};return f}();
SLICK.Touch=function(){function p(a,e){var g=a.length>0?a[0]:null;if(g&&e.length>0)return SLICK.V.diff(g,e[0]);return null}function l(a){a.preventDefault();a.stopPropagation()}function k(a,e){function g(n,r){for(var o=a[r],q=0;o&&q<o.length;q++)n.push(new SLICK.Vector(o[q].pageX,o[q].pageY))}e||(e=j);for(var i=[],m=0;m<e.length;m++){g(i,e[m]);if(i.length>0)break}i.length===0&&i.push(new SLICK.Vector(a.pageX,a.pageY));return i}var f={GLOBAL:"touches",TARGET:"targetTouches",CHANGED:"changedTouches"},
j=[f.GLOBAL,f.TARGET],b={TAP:0,MOVE:1,PINCHZOOM:2},d=0,c={TouchHelper:function(a){function e(t){t=new SLICK.VectorArray(t,true);a.element&&t.applyOffset(new SLICK.Vector(-a.element.offsetLeft,-a.element.offsetTop));return t}function g(t){var z=[],B=0;for(B=1;B<arguments.length;B++)z.push(arguments[B]);for(B=0;B<x.length;B++)x[B][t]&&x[B][t].apply(F,z)}a=GRUNT.extend({element:null,inertiaTrigger:20,maxDistDoubleTap:20,panEventThreshhold:0,pinchZoomThreshold:5,touchStartHandler:null,moveHandler:null,
moveEndHandler:null,pinchZoomHandler:null,pinchZoomEndHandler:null,tapHandler:null,doubleTapHandler:null,wheelZoomHandler:null},a);var i=false,m=0,n=null,r=null,o=null,q=null,s=new SLICK.Vector,v=null,C=false,x=[],D={current:0,last:0},y=SLICK.getDeviceConfig(),F={supportsTouch:SLICK.getDeviceConfig().supportsTouch,THRESHOLD_DOUBLETAP:300,addListeners:function(t){x.push(t)},wheelie:function(t){var z=new SLICK.Vector(t.wheelDeltaX,t.wheelDeltaY);t=new SLICK.Vector(t.clientX,t.clientY);var B=z.y!==0?
Math.abs(z.y/120):0;if(B!==0)g("wheelZoomHandler",t,z.y>0?B+0.5:0.5/B);GRUNT.Log.info("capture mouse wheel event, delta = "+z+", position = "+t)}};y.eventTarget.addEventListener(y.supportsTouch?"touchstart":"mousedown",function(t){n=k(t);o=new SLICK.Vector;q=new SLICK.Vector;C=true;i=false;if(t.target&&t.target===a.element){l(t);D.current=SLICK.Clock.getTime();if(t=n.length>0?n[0]:null){g("touchStartHandler",t.x,t.y);if(D.current-D.last<F.THRESHOLD_DOUBLETAP)if((t=r?SLICK.V.diff(n[0],r[0]):null)&&
Math.abs(t.x)<a.maxDistDoubleTap&&Math.abs(t.y)<a.maxDistDoubleTap)i=true;v=b.TAP;r=[].concat(n)}else GRUNT.Log.warn("Touch start fired, but no touch vector found")}},false);y.eventTarget.addEventListener(y.supportsTouch?"touchmove":"mousemove",function(t){if(C)if(t.target&&t.target===a.element)try{l(t);var z=k(t);t=0;if(z.length>1){if(n.length===1)n=[].concat(z);t=SLICK.VectorMath.distance(n)-SLICK.VectorMath.distance(r)}if(v===b.TAP){var B=p(z,n);if(B&&(Math.abs(B.x)>=7||Math.abs(B.y)>=7))v=b.MOVE}if(v!==
b.TAP)if(!t||Math.abs(t)<a.pinchZoomThreshold){o=p(z,r);q.x+=o.x;q.y+=o.y;s.x+=o.x;s.y+=o.y;if(SLICK.V.absSize(s)>a.panEventThreshhold){g("moveHandler",s.x,s.y);s=SLICK.V.create()}v=b.MOVE}else{g("pinchZoomHandler",e(n),e(z));v=b.PINCHZOOM}r=[].concat(z)}catch(G){GRUNT.Log.exception(G)}},false);y.eventTarget.addEventListener(y.supportsTouch?"touchend":"mouseup",function(t){if(t.target&&t.target===a.element)try{l(t);SLICK.Clock.getTime();D.last=D.current;if(v===b.TAP)m||(m=setTimeout(function(){m=
0;var B=i?"doubleTapHandler":"tapHandler",G=n[0],J=null;if(a.element)J=SLICK.V.offset(G,-a.element.offsetLeft,-a.element.offsetTop);g(B,G,J)},F.THRESHOLD_DOUBLETAP+50));else if(v==b.MOVE)g("moveEndHandler",q.x,q.y);else v==b.PINCHZOOM&&g("pinchZoomEndHandler",e(n),e(r));C=false}catch(z){GRUNT.Log.exception(z)}},false);return F}},h=[];return{captureTouch:function(a,e){try{if(!a)throw Error("Unable to capture touch of null element");if(!a.id)a.id="touchable_"+d++;var g=h[a.id];if(!g){g=c.TouchHelper(GRUNT.extend({element:a},
e));h[a.id]=g;GRUNT.Log.info("CREATED TOUCH HELPER. SUPPORTS TOUCH = "+g.supportsTouch)}g.addListeners(e)}catch(i){GRUNT.Log.exception(i)}}}}();if(typeof jQuery!=="undefined"){jQuery.fn.canTouchThis=function(p){return this.each(function(){SLICK.Touch.captureTouch(this,p)})};jQuery.fn.untouchable=function(){return this.bind("touchmove",function(p){p.preventDefault()})}}
SLICK.Pannable=function(p){p=GRUNT.extend({container:null,onPan:null,onPanEnd:null,onAnimate:null,checkOffset:null},p);var l=false,k=new SLICK.Vector,f={pannable:true,getOffset:function(){return new SLICK.Vector(k.x,k.y)},setOffset:function(b,d){k.x=b;k.y=d},pan:function(b,d,c){if(c)f.updateOffset(k.x+b,k.y+d,c);else{f.updateOffset(k.x+b,k.y+d);p.onPan&&p.onPan(b,d)}},isAnimating:function(){return l},panEnd:function(b,d){p.onPanEnd&&p.onPanEnd(b,d)},updateOffset:function(b,d,c){if(c){b=new SLICK.Vector(b,
d);l=true;c=SLICK.Animation.tweenVector(k,b.x,b.y,c,function(){l=false;f.panEnd(0,0)});for(b=c.length;b--;){c[b].cancelOnInteract=true;c[b].requestUpdates(function(){p.onAnimate&&p.onAnimate(k.x,k.y)})}}else f.setOffset(b,d)}},j=document.getElementById(p.container);j&&SLICK.Touch.captureTouch(j,{moveHandler:function(b,d){f.pan(-b,-d)},moveEndHandler:function(b,d){f.panEnd(b,d)}});return f};
SLICK.Scalable=function(p){function l(i,m){f=i.getRect();j=m.getRect();var n=f.getSize(),r=j.getSize();a=j.getCenter();b=f&&n!==0?r/n:1}p=GRUNT.extend({container:null,onAnimate:null,onPinchZoom:null,onScale:null,scaleDamping:false},p);var k=false,f=null,j=null,b=1,d=null,c=null,h=null,a=null,e={scalable:true,animate:function(i,m,n,r,o){function q(){o&&o();k=false;p.onScale&&p.onScale(b,a);b=1;d=null}k=true;h=SLICK.V.copy(m);a=SLICK.V.copy(n);f=null;if(r){c=b;SLICK.Animation.tweenValue(0,i-c,r,q,1E3).requestUpdates(function(s){d=
s/(i-c);b=c+s;p.onAnimate&&p.onAnimate()})}else{b=i;q()}},getScaleInfo:function(){return{factor:b,startRect:SLICK.copyRect(f),endRect:SLICK.copyRect(j),start:h,center:a,progress:d}},getScaling:function(){return k},getScaleFactor:function(){return b}},g=document.getElementById(p.container);g&&SLICK.Touch.captureTouch(g,{pinchZoomHandler:function(i,m){l(i,m);(k=b!==1)&&p.onPinchZoom&&p.onPinchZoom(i,m)},pinchZoomEndHandler:function(i,m){l(i,m);k=false;p.onScale&&p.onScale(b,a,true);b=1},wheelZoomHandler:function(i){f=
j=null;a=SLICK.V.copy(i)}});return e};
SLICK.Dispatcher=function(){var p=[],l={execute:function(k){var f=l.findAction(k);GRUNT.Log.info("looking for action id: "+k+", found: "+f);if(f){var j=[].concat(arguments).slice(0,1);GRUNT.Log.watch("EXECUTING ACTION: "+k,function(){f.execute(j)})}},findAction:function(k){for(var f=p.length;f--;)if(p[f].id==k)return p[f];return null},getRegisteredActions:function(){return[].concat(p)},getRegisteredActionIds:function(){for(var k=[],f=p.length;f--;)p[f].id&&k.push(p[f].id);return k},registerAction:function(k){k&&
k.id&&p.push(k)},Action:function(k){k=GRUNT.extend({autoRegister:true,id:"",title:"",icon:"",execute:null},k);var f={id:k.id,execute:function(){k.execute&&k.execute.apply(this,arguments)},getParam:function(j){return k[j]?k[j]:""},toString:function(){return String.format("{0} [title = {1}, icon = {2}]",f.id,k.title,k.icon)}};k.autoRegister&&l.registerAction(f);return f},createAgent:function(k){k=GRUNT.extend({name:"Untitled",trashOrphanedResults:true,translator:null,execute:null},k);var f=null,j={getName:function(){return k.name},
getParam:function(b){return k[b]},getId:function(){return GRUNT.toID(j.getName())},run:function(b,d){if(k.execute){var c=f=SLICK.Clock.getTime(true),h=k.translator?k.translator(b):b;k.execute.call(j,h,function(a,e){if(!k.trashOrphanedResults||c==f)d&&d(a,e,h)})}}};return j},runAgents:function(k,f,j){for(var b=0;b<k.length;b++)k[b].run(f,j)}};return l}();
SLICK.Messaging=function(){var p=[],l=[],k=GRUNT.newModule({id:"slick.messaging",requires:["slick.core"],STATUS:{none:0,created:1,updated:2,handled:3},send:function(f){f=GRUNT.extend({type:"",payload:{},index:0,status:k.STATUS.created,statusChange:null},f);f.index=l.push(f)-1;f=f.index;var j=f>=0&&f<l.length?l[f]:null;GRUNT.Log.info("firing message update, index = "+f+", message = "+j);for(var b=0;j&&b<p.length&&j.status!==k.STATUS.handled;){var d=p[b].processUpdate(l[f]);if(d){d=d;p[b].getId();var c=
f>=0&&f<l.length?l[f]:null;if(c){c.status=d;c.statusChange&&c.statusChange(c)}}b++}},Handler:function(f){f=GRUNT.extend({id:"",processUpdate:null},f);var j={getId:function(){return f.id},processUpdate:function(b){if(f.processUpdate)return f.processUpdate(b);return k.STATUS.none}};p.push(j);return j}});return k}();
SLICK.Animation=function(){function p(){if(f===0)f=setInterval(function(){if(j.update(SLICK.Clock.getTime())===0){clearInterval(f);f=0}},20)}var l=[],k=false,f=0,j={DURATION:2E3,tweenValue:function(b,d,c,h,a){b=new j.Tween({startValue:b,endValue:d,tweenFn:c,complete:h,duration:a});l.push(b);return b},tween:function(b,d,c,h,a,e){b=new j.Tween({target:b,property:d,endValue:c,tweenFn:h,duration:e,complete:a});l.push(b);return b},tweenVector:function(b,d,c,h,a,e){var g=[];if(b){var i=b.x==d,m=b.y==c;
i||g.push(j.tween(b,"x",d,h,function(){(i=true)&&m&&a()},e));m||g.push(j.tween(b,"y",c,h,function(){m=true;i&&m&&a()},e))}return g},cancel:function(b){if(!k){k=true;try{for(var d=0;d<l.length;)if(!b||b(l[d])){GRUNT.Log.info("CANCELLING ANIMATION");l[d].triggerComplete(true);l.splice(d,1)}else d++}finally{k=false}}},isTweening:function(){return l.length>0},update:function(b){if(k)return l.length;k=true;try{for(var d=0;d<l.length;)if(l[d].isComplete()){l[d].triggerComplete(false);l.splice(d,1);GRUNT.WaterCooler.say("animation.complete")}else{l[d].update(b);
d++}}finally{k=false}return l.length},Tween:function(b){b=GRUNT.extend({target:null,property:null,startValue:0,endValue:null,duration:j.DURATION,tweenFn:j.DEFAULT,complete:null,cancelOnInteract:false},b);var d=SLICK.Clock.getTime(),c=[],h=false,a=0,e=0,g={cancelOnInteract:b.cancelOnInteract,isComplete:function(){return h},triggerComplete:function(i){b.complete&&b.complete(i)},update:function(i){try{var m=b.tweenFn(i-d,a,e,b.duration);if(b.target)b.target[b.property]=m;for(var n=c.length;n--;)c[n](m,
void 0);if(h=d+b.duration<=i){if(b.target)b.target[b.property]=b.tweenFn(b.duration,a,e,b.duration);for(var r=c.length;r--;)c[r](m,true)}}catch(o){GRUNT.Log.exception(o)}},requestUpdates:function(i){c.push(i)}};a=b.target&&b.property&&b.target[b.property]?b.target[b.property]:b.startValue;if(typeof b.endValue!=="undefined")e=b.endValue-a;if(e==0)h=true;p();return g},Easing:function(){var b=1.70158;return{Linear:function(d,c,h,a){return h*d/a+c},Back:{In:function(d,c,h,a){return h*(d/=a)*d*((b+1)*
d-b)+c},Out:function(d,c,h,a){return h*((d=d/a-1)*d*((b+1)*d+b)+1)+c},InOut:function(d,c,h,a){return(d/=a/2)<1?h/2*d*d*(((b*=1.525)+1)*d-b)+c:h/2*((d-=2)*d*(((b*=1.525)+1)*d+b)+2)+c}},Bounce:{In:function(d,c,h,a){return h-j.Easing.Bounce.Out(a-d,0,h,a)+c},Out:function(d,c,h,a){return(d/=a)<1/2.75?h*7.5625*d*d+c:d<2/2.75?h*(7.5625*(d-=1.5/2.75)*d+0.75)+c:d<2.5/2.75?h*(7.5625*(d-=2.25/2.75)*d+0.9375)+c:h*(7.5625*(d-=2.625/2.75)*d+0.984375)+c},InOut:function(d,c,h,a){return d<a/2?j.Easing.Bounce.In(d*
2,0,h,a)*0.5+c:j.Easing.Bounce.Out(d*2-a,0,h,a)*0.5+h*0.5+c}},Cubic:{In:function(d,c,h,a){return h*(d/=a)*d*d+c},Out:function(d,c,h,a){return h*((d=d/a-1)*d*d+1)+c},InOut:function(d,c,h,a){if((d/=a/2)<1)return h/2*d*d*d+c;return h/2*((d-=2)*d*d+2)+c}},Elastic:{In:function(d,c,h,a,e,g){if(d==0)return c;if((d/=a)==1)return c+h;g||(g=a*0.3);if(!e||e<Math.abs(h)){e=h;h=g/4}else h=g/(2*Math.PI)*Math.asin(h/e);return-(e*Math.pow(2,10*(d-=1))*Math.sin((d*a-h)*2*Math.PI/g))+c},Out:function(d,c,h,a,e,g){var i;
if(d==0)return c;if((d/=a)==1)return c+h;g||(g=a*0.3);if(!e||e<Math.abs(h)){e=h;i=g/4}else i=g/(2*Math.PI)*Math.asin(h/e);return e*Math.pow(2,-10*d)*Math.sin((d*a-i)*2*Math.PI/g)+h+c},InOut:function(d,c,h,a,e,g){var i;if(d==0)return c;if((d/=a/2)==2)return c+h;g||(g=a*0.3*1.5);if(!e||e<Math.abs(h)){e=h;i=g/4}else i=g/(2*Math.PI)*Math.asin(h/e);if(d<1)return-0.5*e*Math.pow(2,10*(d-=1))*Math.sin((d*a-i)*2*Math.PI/g)+c;return e*Math.pow(2,-10*(d-=1))*Math.sin((d*a-i)*2*Math.PI/g)*0.5+h+c}},Quad:{In:function(d,
c,h,a){return h*(d/=a)*d+c},Out:function(d,c,h,a){return-h*(d/=a)*(d-2)+c},InOut:function(d,c,h,a){if((d/=a/2)<1)return h/2*d*d+c;return-h/2*(--d*(d-2)-1)+c}},Sine:{In:function(d,c,h,a){return-h*Math.cos(d/a*(Math.PI/2))+h+c},Out:function(d,c,h,a){return h*Math.sin(d/a*(Math.PI/2))+c},InOut:function(d,c,h,a){return-h/2*(Math.cos(Math.PI*d/a)-1)+c}}}}()};return GRUNT.extend(j,{DEFAULT:j.Easing.Back.Out})}();SLICK.Border={NONE:0,TOP:1,RIGHT:2,BOTTOM:3,LEFT:4};
SLICK.Graphics=function(){var p={NONE:0,ACTIVE:1,ANIMATING:2,PAN:4,PINCHZOOM:8,FREEZE:128},l=0,k={DisplayState:p,AnyDisplayState:255,ActiveDisplayStates:p.ACTIVE|p.ANIMATING,DefaultDisplayStates:p.ACTIVE|p.ANIMATING|p.PAN|p.PINCHZOOM,ViewLayer:function(f){f=GRUNT.extend({id:"",centerOnScale:true,created:(new Date).getTime(),scalePosition:true,zindex:0,validStates:k.DefaultDisplayStates},f);var j=[],b=null,d=GRUNT.extend({isAnimating:function(){return false},addToView:function(c){c.setLayer(f.id,d)},
shouldDraw:function(c){return(c&f.validStates)!==0},cycle:function(){return 0},draw:function(){},layerChanged:function(){for(var c=j.length;c--;)j[c](d)},notify:function(){},remove:function(){GRUNT.WaterCooler.say("layer.remove",{id:f.id})},registerChangeListener:function(c){j.push(c)},wakeParent:function(){GRUNT.WaterCooler.say("view.wake",{id:b?b.id:null})},getParent:function(){return b},setParent:function(c){b=c}},f);return d},StatusViewLayer:function(){return new k.ViewLayer({validStates:k.AnyDisplayState,
zindex:5E3,draw:function(f,j,b,d,c){f.fillStyle="#FF0000";f.fillRect(10,10,50,50);f.fillStyle="#FFFFFF";f.font="bold 10px sans";f.fillText(c.getDisplayState(),20,20)}})},AnimatedPathLayer:function(f){function j(e,g,i){e.fillStyle="#FFFFFF";e.strokeStyle="#222222";e.beginPath();e.arc(i.x,i.y,4,0,Math.PI*2,false);e.stroke();e.fill()}f=GRUNT.extend({path:[],id:GRUNT.generateObjectID("pathAnimation"),easing:SLICK.Animation.Easing.Sine.InOut,canCache:false,validStates:k.ActiveDisplayStates|p.PAN|p.PINCHZOOM,
drawIndicator:null,duration:2E3,autoCenter:false},f);var b=SLICK.VectorMath.edges(f.path),d,c=null,h=0;SLICK.Animation.tweenValue(0,b.total,f.easing,function(){a.remove()},f.duration).requestUpdates(function(e,g){h=e;g&&a.remove()});var a=GRUNT.extend(new k.ViewLayer(f),{cycle:function(){for(var e=0;e<b.accrued.length&&b.accrued[e]<h;)e++;c=null;if(e<f.path.length-1){var g=h-(e>0?b.accrued[e-1]:0),i=f.path[e],m=f.path[e+1];d=SLICK.VectorMath.theta(i,m,b.edges[e]);c=SLICK.VectorMath.pointOnEdge(i,
m,d,g);if(f.autoCenter)(e=a.getParent())&&e.centerOn(c)}return c?1:0},draw:function(e,g){if(c)(f.drawIndicator?f.drawIndicator:j)(e,g,new SLICK.Vector(c.x-g.x,c.y-g.y),d)}});return a},FPSLayer:function(f){f=GRUNT.extend({zindex:1E3,scalePosition:false},f);var j=null,b=GRUNT.extend(new k.ViewLayer(f),{delays:[],draw:function(d,c,h){d.font="bold 8pt Arial";d.textAlign="right";d.fillStyle="rgba(0, 0, 0, 0.8)";d.fillText((j?j:"?")+" fps",h.width-20,20)}});setInterval(function(){for(var d=0,c=b.delays.length,
h=c;h--;)d+=b.delays[h];if(c!==0)j=Math.floor(1E3/(d/c))},1E3);return b},ResourceStatsLayer:function(f){f=GRUNT.extend({zindex:500,indicatorSize:5,scalePosition:false,validStates:p.ACTIVE|p.PAN},f);return GRUNT.extend(new k.ViewLayer(f),{fps:null,draw:function(j){var b=SLICK.Resources.getStats(),d=f.indicatorSize,c=10,h;if(b.imageCacheFullness){j.strokeStyle="rgba(0, 0, 255, 1)";j.beginPath();j.arc(15,15,5,0,Math.PI*2*b.imageCacheFullness,false);j.stroke();c=30}if(b.imageLoadingCount>=0){j.fillStyle=
"rgba(0, 255, 0, 0.7)";for(h=b.imageLoadingCount;h--;)j.fillRect(c+h*(d+2),10,d,d)}if(b.queuedImageCount>=0){j.fillStyle="rgba(255, 0, 0, 0.7)";for(h=b.queuedImageCount;h--;)j.fillRect(c+h*(d+2),10+d+2,d,d)}}})},LoadingLayer:function(f){GRUNT.extend({},f)},View:function(f){function j(u,w){w.id=u;w.registerChangeListener(function(){c()});w.setParent(E);h.push(w);h.sort(function(A,I){var H=I.zindex-A.zindex;if(H===0)H=I.created-A.created;return H})}function b(u,w){var A=0,I=E.getScaleFactor(),H=E.getDisplayState(),
Q=(new Date).getTime(),O=(H&p.PINCHZOOM)!==0;m=E.getScaleFactor();var N=0;if(i||O){u.clearRect(0,0,a.width,a.height);i=false}if(O){var K=t.getScaleInfo();E.getDimensions().getCenter();var M=(K.progress?K.progress:1)*0.5;y=K.center;if(K.startRect){M=K.startRect.getCenter();M=SLICK.V.diff(M,y);G=new SLICK.Vector(y.x+M.x,y.y+M.y)}else{K=SLICK.V.diff(K.start,y);G=new SLICK.Vector(y.x-K.x*M,y.y-K.y*M)}if(G)w=SLICK.V.offset(w,G.x,G.y)}u.save();try{if(q!==1)u.scale(q,q);else if(O){u.translate(y.x,y.y);u.scale(I,
I)}for(N=h.length;N--;)if(h[N].shouldDraw(H)){var P=h[N].draw(u,w,v,H,E);A+=P?P:0}}finally{u.restore()}GRUNT.Log.trace("draw complete",Q);return A}function d(){var u=0,w=L==k.DisplayState.PINCHZOOM||J-r<f.bufferRefresh;J=(new Date).getTime();g=F?F.getOffset():new SLICK.Vector;D&&n&&D.delays.push(J-n);w&&SLICK.Animation.cancel(function(H){return H.cancelOnInteract});for(var A=h.length;A--;){var I=h[A].cycle(J,g);u+=I?I:0}z=z&&!w;u+=b(e,g);if(!w&&!z){z=true;GRUNT.WaterCooler.say("view-idle",{id:E.id})}n=
J;B=0;x+u>0&&c();GRUNT.Log.trace("Completed draw cycle",J)}function c(){x++;if(!(o||B!==0)){x=0;B=setTimeout(d,0)}}f=GRUNT.extend({id:"view_"+l++,container:"",pannable:false,scalable:false,clearOnDraw:false,displayFPS:true,displayResourceStats:true,scaleDamping:false,fillStyle:"rgb(200, 200, 200)",initialDrawMode:"source-over",bufferRefresh:100,defaultFreezeDelay:500,onPan:null,onPinchZoom:null,onScale:null,onDraw:null,autoSize:false},f);var h=[],a=document.getElementById(f.container),e=null,g=new SLICK.Vector,
i=false,m=1,n=null,r=0,o=false,q=1,s=new SLICK.Vector,v=null,C=null,x=0,D=null,y=null,F=null,t=null,z=false,B=0,G=null,J=0,L=k.DisplayState.ACTIVE;GRUNT.Log.info("Creating a new view instance, attached to container: "+f.container+", canvas = ",a);if(a){if(f.autoSize){GRUNT.Log.info("autosizing view: window.height = "+window.innerHeight+", width = "+window.innerWidth);a.height=window.innerHeight-a.offsetTop-49;a.width=window.innerWidth-a.offsetLeft}try{e=a.getContext("2d");e.globalCompositeOperation=
f.initialDrawMode}catch(R){GRUNT.Log.exception(R);throw Error("Could not initialise canvas on specified view element");}}if(f.pannable)F=new SLICK.Pannable({container:f.container,onAnimate:function(){c()},onPan:function(u,w){r=SLICK.Clock.getTime(true);c();s=SLICK.V.offset(s,u,w);f.onPan&&f.onPan(u,w);L=p.PAN},onPanEnd:function(){c();L=p.ACTIVE}});if(f.scalable)t=new SLICK.Scalable({scaleDamping:f.scaleDamping,container:f.container,onAnimate:function(){L=k.DisplayState.PINCHZOOM;c()},onPinchZoom:function(u,
w){r=SLICK.Clock.getTime(true);c();f.onPinchZoom&&f.onPinchZoom(u,w);L=k.DisplayState.PINCHZOOM},onScale:function(u,w){GRUNT.WaterCooler.say("view.scale",{id:E.id});u>1?E.snapshot():E.clearBackground();L=k.DisplayState.ACTIVE;c();f.onScale&&f.onScale(u,w)}});var E=GRUNT.extend({},f,F,t,{id:f.id,deviceScaling:q,centerOn:function(u){F.setOffset(u.x-a.width*0.5,u.y-a.height*0.5)},getDimensions:function(){if(a)return new SLICK.Dimensions(a.width,a.height)},getZoomCenter:function(){return G},getLayer:function(u){for(var w=
0;w<h.length;w++)if(h[w].id==u){/^grid/i.test(u)||GRUNT.Log.info("found layer: "+u);return h[w]}return null},setLayer:function(u,w){for(var A=0;A<h.length;A++)if(h[A].id===u){h.splice(A,1);break}w&&j(u,w);GRUNT.WaterCooler.say("layer.update",{value:w});c()},eachLayer:function(u){for(var w=0;w<h.length;w++)u(h[w])},clearBackground:function(){i=true},freeze:function(){o=true},unfreeze:function(){o=false;c()},snapshot:function(){},getDisplayState:function(){return o?p.FROZEN:L},scale:function(u,w,A,
I,H){I||(I=E.getDimensions().getCenter());H||(H=E.getDimensions().getCenter());t&&t.animate(u,I,H,w,A);return t},removeLayer:function(u,w){setTimeout(function(){var A;a:{for(A=h.length;A--;)if(h[A].id==u){A=A;break a}A=-1}if(A>=0&&A<h.length){GRUNT.WaterCooler.say("layer.remove",{layer:h[A]});h.splice(A,1)}},w?w:1)}});v=E.getDimensions();C=v.getCenter();GRUNT.WaterCooler.listen("layer.remove",function(u){u.id&&E.removeLayer(u.id)});GRUNT.WaterCooler.listen("view.wake",function(u){if(!u.id||u.id===
E.id)c()});q=SLICK.getDeviceConfig().getScaling();if(f.displayFPS){D=new k.FPSLayer;E.setLayer("fps",D)}f.displayResourceStats&&E.setLayer("resourceStats",new k.ResourceStatsLayer);c();return E}};return k}();
SLICK.Tiling=function(){function p(){if(!k){k=document.createElement("canvas");k.width=j.Config.TILESIZE;k.height=j.Config.TILESIZE;var b=k.getContext("2d");b.fillStyle="rgba(150, 150, 150, 0.05)";b.fillRect(0,0,k.width,k.height)}return k}function l(){if(!f){f=document.createElement("canvas");f.width=j.Config.TILESIZE;f.height=j.Config.TILESIZE;var b=f.getContext("2d"),d=Math.sqrt(j.Config.TILESIZE);b.fillStyle="rgba(200, 200, 200, 1)";b.strokeStyle="rgb(190, 190, 190)";b.lineWidth=0.5;b.fillRect(0,
0,f.width,f.height);b.beginPath();for(var c=0;c<f.width;c+=d){b.moveTo(c,0);b.lineTo(c,f.height);for(var h=0;h<f.height;h+=d){b.moveTo(0,h);b.lineTo(f.width,h)}}b.stroke()}return f}TileStore=function(b){b=GRUNT.extend({gridSize:20,center:new SLICK.Vector,onPopulate:null},b);var d=Array(Math.pow(b.gridSize,2)),c=SLICK.V.offset(b.center,-Math.ceil(b.gridSize>>1)),h=null,a=new SLICK.Vector,e=null;GRUNT.Log.info("created tile store with tl offset = "+c);var g={getGridSize:function(){return b.gridSize},
getNormalizedPos:function(i,m){return SLICK.V.add(new SLICK.Vector(i,m),SLICK.V.invert(c),a)},getTileShift:function(){return SLICK.V.copy(a)},getTile:function(i,m){return i>=0&&i<b.gridSize?d[m*b.gridSize+i]:null},setTile:function(i,m,n){d[m*b.gridSize+i]=n},populate:function(i,m){var n=GRUNT.Log.getTraceTicks(),r=0;new SLICK.Vector(b.gridSize*0.5,b.gridSize*0.5);GRUNT.Log.info("poulating grid, top left offset = "+c);if(i)for(var o=0;o<b.gridSize;o++)for(var q=0;q<b.gridSize;q++){if(!d[r]){var s=
i(q,o,c,b.gridSize);d[r]=s}r++}h=i;e=m;GRUNT.Log.trace("tile grid populated",n);b.onPopulate&&b.onPopulate()},getShiftDelta:function(i,m,n,r){var o=Math.floor(b.gridSize*0.2),q=new SLICK.Vector;if(i<0||i+n>b.gridSize)q.x=i<0?-o:o;if(m<0||m+r>b.gridSize)q.y=m<0?-o:o;return q},shift:function(i,m){if(!(i.x===0&&i.y===0)){var n=GRUNT.Log.getTraceTicks(),r=Array(d.length);r.length=d.length;for(var o=0;o<b.gridSize;o++)for(var q=0;q<b.gridSize;q++)r[q*b.gridSize+o]=g.getTile(o+i.x,q+i.y);d=r;c=m?m(c,i):
SLICK.V.add(c,i);a.x+=-i.x*b.tileSize;a.y+=-i.y*b.tileSize;GRUNT.Log.trace("tile storage shifted",n);g.populate(h,e)}},setOrigin:function(i,m){if(tileOrigin)shiftOrigin(i,m);else c=SLICK.V.offset(new SLICK.Vector(i,m),-tileHalfWidth)}};GRUNT.WaterCooler.listen("imagecache.cleared",function(){for(var i=d.length;i--;)if(d[i])d[i].loaded=false});return g};var k=null,f=null,j={Config:{TILESIZE:256,TILEBUFFER:1,TILEBUFFER_LOADNEW:0.2},Tile:function(b){return b=GRUNT.extend({x:0,y:0,size:256},b)},ImageTile:function(b){b=
GRUNT.extend({url:"",sessionParamRegex:null,loaded:false},b);return new j.Tile(b)},TileGrid:function(b){function d(q,s,v,C){if((g?SLICK.V.absSize(SLICK.V.diff(g,s)):h)>=20){q=c.getTileShift();q=new SLICK.Vector(Math.floor((s.x+q.x)*e),Math.floor((s.y+q.y)*e));var x=Math.ceil(v.width*e)+1;v=Math.ceil(v.height*e)+1;var D=new SLICK.Vector((x-1)*0.5,(v-1)*0.5),y=new SLICK.Vector(q.x*b.tileSize,q.y*b.tileSize);C.isAnimating();m=[];tilesNeeded=false;for(var F=v;F--;)for(var t=F*b.tileSize+y.y,z=x;z--;){C=
c.getTile(z+q.x,F+q.y);var B=z*b.tileSize+y.x,G=new SLICK.Vector(z-D.x,F-D.y);C||(n=c.getShiftDelta(q.x,q.y,x,v));m.push({tile:C,coordinates:new SLICK.Vector(B,t),centerness:SLICK.V.absSize(G)})}m.sort(function(J,L){return L.centerness-J.centerness});g=SLICK.V.copy(s)}}b=GRUNT.extend({tileSize:SLICK.Tiling.Config.TILESIZE,drawGrid:false,center:new SLICK.Vector,shiftOrigin:null,checkChange:100},b);var c=new TileStore(GRUNT.extend({onPopulate:function(){i=true;o.wakeParent()}},b)),h=Math.round(b.tileSize>>
1),a=true,e=b.tileSize?1/b.tileSize:0,g=null,i=false,m=[];new SLICK.Vector;var n=new SLICK.Vector,r=c.getGridSize()*b.tileSize,o=GRUNT.extend(new SLICK.Graphics.ViewLayer(b),{gridDimensions:new SLICK.Dimensions(r,r),cycle:function(){var q=0;if(n.x+n.y!==0){c.shift(n,b.shiftOrigin);n=new SLICK.Vector;q++}return q+i?1:0},drawTile:function(){},draw:function(q,s,v,C,x){if(a){var D=GRUNT.Log.getTraceTicks(),y=c.getTileShift(),F=s.x+y.x;y=s.y+y.y;if(C!==SLICK.Graphics.DisplayState.PINCHZOOM){d(q,s,v,x);
GRUNT.Log.trace("updated draw queue",D)}if(b.drawGrid)q.strokeStyle="rgba(50, 50, 50, 0.3)";q.beginPath();for(s=m.length;s--;){v=m[s].tile;x=m[s].coordinates.x-F;var t=m[s].coordinates.y-y;v?o.drawTile(q,v,x,t,C):q.drawImage(l(),x,t);b.drawGrid&&q.rect(x,t,b.tileSize,b.tileSize)}q.stroke();GRUNT.Log.trace("drawn tiles",D)}i=false},getTileSize:function(){return b.tileSize},getTileVirtualXY:function(q,s,v){q=c.getNormalizedPos(q,s);q=new SLICK.Vector(q.x*b.tileSize,q.y*b.tileSize);if(v){q.x+=h;q.y+=
h}return q},getCenterXY:function(){var q=Math.ceil(c.getGridSize()>>1);return o.getTileVirtualXY(q,q,true)},populate:function(q){c.populate(q,function(){})}});GRUNT.WaterCooler.listen("view.scale",function(q){if(q.id==o.getParent().id)a=false});GRUNT.WaterCooler.listen("tile.loaded",function(){i=true;o.wakeParent()});return o},ImageTileGrid:function(b){function d(){GRUNT.WaterCooler.say("tile.loaded")}b=GRUNT.extend({},b);return GRUNT.extend(new j.TileGrid(b),{drawTile:function(c,h,a,e,g){var i=SLICK.Resources.getImage(h.url);
g===SLICK.Graphics.DisplayState.PAN&&c.drawImage(l(),a,e);if(i&&i.complete)c.drawImage(i,a,e);else if(i)c.drawImage(p(),a,e);else{c.drawImage(p(),a,e);SLICK.Resources.loadImage(h.url,d)}}})},Tiler:function(b){b=GRUNT.extend({container:"",drawCenter:false,onPan:null,onPanEnd:null,tapHandler:null,doubleTapHandler:null,zoomHandler:null,onDraw:null,datasources:{},tileLoadThreshold:"first"},b);SLICK.Touch.captureTouch(document.getElementById(b.container),b);var d=new SLICK.Graphics.View(GRUNT.extend({},
b,{pannable:true,scalable:true,scaleDamping:true}));GRUNT.extend(d,{getTileLayer:function(){return d.getLayer("grid0")},setTileLayer:function(c){d.setLayer("grid0",c);GRUNT.WaterCooler.say("grid.updated",{grid:c})},gridPixToViewPix:function(c){var h=d.getOffset();return new SLICK.Vector(c.x-h.x,c.y-h.y)},viewPixToGridPix:function(c){var h=d.getOffset();return new SLICK.Vector(c.x+h.x,c.y+h.y)}});return d}};return j}();
SLICK.Geo=function(){function p(a,e){var g=null;for(var i in c)if(e){if(i==e&&c[i][a]){g=c[i];break}}else if(c[i][a]){g=c[i];break}return g}function l(a,e,g,i){var m=0;a=a.toUpperCase();for(var n in i){var r=e[n];if(r){var o=g[n];r=o?o(a,r):a.containsWord(r)?1:0;m+=r*i[n]}}return m}var k=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],f=/(\d+)\s?\-\s?(\d+)/,j=/^(\d+).*$/,b=null,d={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",
HWY:"HIGHWAY",MWY:"MOTORWAY"},c={},h={Engine:function(a){if(!a.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var e=GRUNT.extend({remove:function(){delete c[e.id]}},a);return c[e.id]=e},getEngine:function(a){for(var e=null,g=1;!e&&g<arguments.length;g++)e=p(a,arguments[g]);e=e?e:p(a);if(!e)throw Error("Unable to find GEO engine with "+a+" capability");return e},Distance:function(a,e){var g=0;if(!h.emptyPos(a)&&!h.emptyPos(e)){var i=(e.lat-a.lat).toRad()>>1,m=(e.lon-a.lon).toRad()>>
1;i=Math.sin(i)*Math.sin(i)+Math.cos(a.lat.toRad())*Math.cos(e.lat.toRad())*Math.sin(m)*Math.sin(m);g=6371*2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))}return{toM:function(){return g*1E3},toKM:function(){return g},toString:function(){return g+"km"}}},Radius:function(a,e){return{distance:parseInt(a,10),uom:e}},Position:function(a,e){return{lat:parseFloat(a?a:0),lon:parseFloat(e?e:0)}},BoundingBox:function(a,e){var g={min:h.parsePosition(a),max:h.parsePosition(e),expand:function(i){g.min.lat-=i;g.min.lon-=
h.Utilities.normalizeLon(i);g.max.lat+=i;g.max.lon+=h.Utilities.normalizeLon(i)},getDistance:function(){return new h.Distance(g.min,g.max)},getCenter:function(){var i=h.calculateBoundsSize(g.min,g.max);return new SLICK.Geo.Position(g.min.lat+i.y*0.5,g.min.lon+i.x*0.5)},transform:function(i){var m=new SLICK.Geo.BoundingBox(g.min,g.max);GRUNT.Log.info("applying "+i.length+" transformers");for(var n=0;i&&n<i.length;n++)i[n].apply(m);return m},toString:function(){return String.format("({0}, {1})",g.min,
g.max)}};return g},Transforms:function(){return{Shrink:function(){return function(){}},Offset:function(){return function(){}}}}(),Address:function(a){a=GRUNT.extend({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},a);return GRUNT.extend(a,{getPos:function(){return a.pos},toString:function(){return a.streetDetails+" "+a.location}})},GeocodeFieldWeights:{streetDetails:50,location:50},AddressCompareFns:{},Utilities:function(){var a={lat2pix:function(e,g){var i=parseFloat(e)*
2*Math.PI/360;i=Math.sin(i);var m=0.08181919084262157*i;return Math.log((1+i)/(1-i)*Math.pow((1-m)/(1+m),0.08181919084262157))/2/g},lon2pix:function(e,g){return parseFloat(e)/180*Math.PI/g},pix2lon:function(e,g){return a.normalizeLon(e*g*180/Math.PI)},pix2lat:function(e,g){for(var i=Math.pow(Math.E,-e*g),m=a.mercatorUnproject(i),n=a.findRadPhi(m,i),r=0;r<12&&Math.abs(m-n)>1.0E-7;){m=n;n=a.findRadPhi(m,i);r++}return n*180/Math.PI},mercatorUnproject:function(e){return Math.PI/2-2*Math.atan(e)},findRadPhi:function(e,
g){var i=0.08181919084262157*Math.sin(e);return Math.PI/2-2*Math.atan(g*Math.pow((1-i)/(1+i),0.040909595421310785))},normalizeLon:function(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}};return a}(),GeoSearchResult:function(a){a=GRUNT.extend({id:null,caption:"",resultType:"",data:null,pos:null,matchWeight:0},a);return GRUNT.extend(a,{toString:function(){return a.caption+(a.matchWeight?" ("+a.matchWeight+")":"")}})},GeoSearchAgent:function(a){a=GRUNT.extend({},a);return GRUNT.extend({},SLICK.Dispatcher.createAgent(a))},
GeocodingAgent:function(a){a=GRUNT.extend({name:"Geocoding Search Agent",paramTranslator:null,execute:function(e,g){try{if(!e.reverse&&!e.freeform)address=new h.Address(e);var i=h.getEngine("geocode");if(i)i.geocode({addresses:[e.freeform?e.freeform:address],complete:function(n,r){if(g){var o=r;if(e.freeform)o=h.rankGeocodeResponses(e.freeform,o,h.getEngine("geocode"));g(o,a)}}})}catch(m){GRUNT.Log.exception(m)}}},a);return new h.GeoSearchAgent(a)},PointOfInterest:function(a){a=GRUNT.extend({id:0,
title:"",pos:null,lat:"",lon:"",group:"",retrieved:0,isNew:true},a);if(!a.pos&&a.lat&&a.lon)a.pos=new SLICK.Geo.Position(a.lat,a.lon);return GRUNT.extend({toString:function(){return a.id+": '"+a.title+"'"}},a)},POIStorage:function(a){function e(o){o=o?o:"default";m[o]||(m[o]=[]);return m[o]}function g(o){var q=[];for(var s in m)for(var v=0;v<m[s].length;v++)if(!o||o(m[s][v]))q.push(m[s][v]);return q}function i(){GRUNT.WaterCooler.say("geo.pois-updated",{srcID:r.id,pois:r.getPOIs()})}a=GRUNT.extend({visibilityChange:null,
onPOIDeleted:null,onPOIAdded:null},a);var m={},n=true,r={id:GRUNT.generateObjectID(),getPOIs:function(){return g()},getOldPOIs:function(o,q){return g(function(s){return s.group==o&&s.retrieved<q})},getVisible:function(){return n},setVisible:function(o){if(o!=n){n=o;a.visibilityChange&&a.visibilityChange()}},findById:function(o){var q=g(function(s){return s.id==o});return q.length>0?q[0]:null},findByBounds:function(o){return g(function(q){return SLICK.Geo.posInBounds(q.pos,o)})},addPOIs:function(o,
q){if(q)m={};for(var s=0;o&&s<o.length;s++){o[s].retrieved=SLICK.Clock.getTime(true);var v=o[s];e(v.group).push(v)}},removeGroup:function(o){if(m[o]){delete m[o];i()}},update:function(o){var q=[],s=0,v=o.length>0?o[0].group:"",C=SLICK.Clock.getTime(true);for(s=0;s<o.length;s++){var x;a:{if(x=o[s])for(var D=e(x.group),y=0;y<D.length;y++)if(D[y].id==x.id){x=D[y];break a}x=null}if(x){x.retrieved=C;x.isNew=false}else q.push(o[s])}o=r.getOldPOIs(v,C);r.addPOIs(q);for(s=0;a.onPOIAdded&&s<q.length;s++)a.onPOIAdded(q[s]);
for(s=0;s<o.length;s++){a.onPOIDeleted&&a.onPOIDeleted(o[s]);v=o[s];C=e(v.group);for(x=0;x<C.length;x++)if(C[x].id==v.id){C.splice(x,1);break}}q.length+o.length>0&&i()}};return r},MapProvider:function(){return{zoomLevel:0,checkZoomLevel:function(a){return a},getCopyright:function(){},getMapTiles:function(){},getPositionForXY:function(){return null}}},copyPos:function(a){return a?new h.Position(a.lat,a.lon):null},emptyPos:function(a){return!a||a.lat===0&&a.lon===0},posToStr:function(a){return a.lat+
" "+a.lon},parsePosition:function(a){if(a)if(GRUNT.isPlainObject(a)&&a.lat!=="undefined")return a;else{if(a.split)for(var e=[" ",","],g=0;g<e.length;g++){var i=a.split(e[g]);if(i.length===2)return new h.Position(i[0],i[1])}}else return new h.Position;return null},parsePositionArray:function(a){var e=a.length,g=Array(e);for(e=e;e--;)g[e]=h.parsePosition(a[e]);return g},posToMercatorPixels:function(a,e){return new SLICK.Vector(SLICK.Geo.Utilities.lon2pix(a.lon,e),SLICK.Geo.Utilities.lat2pix(a.lat,e))},
mercatorPixelsToPos:function(a,e,g){return new h.Position(SLICK.Geo.Utilities.pix2lat(e,g),SLICK.Geo.Utilities.normalizeLon(SLICK.Geo.Utilities.pix2lon(a,g)))},emptyBounds:function(a){return!a||h.emptyPos(a.min)||h.emptyPos(a.max)},posInBounds:function(a,e){var g=!(h.emptyPos(a)||h.emptyBounds(e));return g=(g=g&&a.lat>=e.min.lat&&a.lat<=e.max.lat)&&a.lon>=e.min.lon&&a.lon<=e.max.lon},calculateBoundsSize:function(a,e,g){var i=new SLICK.Vector(0,e.lat-a.lat);if(typeof g==="undefined")g=true;i.x=g&&
a.lon>e.lon?360-a.lon+e.lon:e.lon-a.lon;return i},getBoundingBoxZoomLevel:function(a,e){var g=a.getCenter(),i=Math.min(Math.round(Math.abs(g.lat)*0.05),k.length),m=k[i],n=h.calculateBoundsSize(a.min,a.max),r=Math.ceil(Math.log(k[3]*e.height/n.y)/Math.log(2));m=Math.ceil(Math.log(m*e.width/n.x)/Math.log(2));GRUNT.Log.info("constant index for bbox: "+a+" (center = "+g+") is "+i);GRUNT.Log.info("distances  = "+n);GRUNT.Log.info("optimal zoom levels: height = "+r+", width = "+m);return Math.min(r,m)},
getBoundsForPositions:function(a,e){var g=null,i=SLICK.Clock.getTime();e||(e="auto");for(var m=a.length;m--;)if(g){var n=h.calculateBoundsSize(g.min,a[m],false),r=h.calculateBoundsSize(a[m],g.max,false);if(n.x<0)g.min.lon=a[m].lon;if(n.y<0)g.min.lat=a[m].lat;if(r.x<0)g.max.lon=a[m].lon;if(r.y<0)g.max.lat=a[m].lat}else g=new SLICK.Geo.BoundingBox(h.copyPos(a[m]),h.copyPos(a[m]));if(e){if(e=="auto"){m=h.calculateBoundsSize(g.min,g.max);e=Math.max(m.x,m.y)*0.3}g.expand(e)}GRUNT.Log.info("bounds calculated in "+
(SLICK.Clock.getTime()-i)+" ms");return g},normalizeAddress:function(a){if(!a)return"";a=a.toUpperCase();if(!b){var e=[];for(var g in d)e.push(g);b=RegExp("(\\s)("+e.join("|")+")(\\s|$)","i")}b.lastIndex=-1;if(e=b.exec(a))a=a.replace(b,"$1"+d[e[2]]);return a},buildingMatch:function(a,e){j.lastIndex=-1;if(j.test(a))for(var g=a.replace(j,"$1"),i=e.split(","),m=0;m<i.length;m++){f.lastIndex=-1;if(f.test(i[m])){var n=f.exec(i[m]);if(g>=parseInt(n[1],10)&&g<=parseInt(n[2],10))return true}else if(g==i[m])return true}return false},
rankGeocodeResponses:function(a,e,g){var i=[],m=h.AddressCompareFns;if(g&&g.compareFns)m=GRUNT.extend({},m,g.compareFns);for(g=0;g<e.length;g++)i.push(new h.GeoSearchResult({caption:e[g].toString(),data:e[g],pos:e[g].pos,matchWeight:l(a,e[g],m,h.GeocodeFieldWeights)}));i.sort(function(n,r){return r.matchWeight-n.matchWeight});return i}};return h}();
SLICK.Geo.Location=function(){function p(f){function j(e){try{var g=new SLICK.Geo.Position(e.coords.latitude,e.coords.longitude),i=GRUNT.isPlainObject(e.coords.accuracy)&&e.coords.accuracy.horizontal?e.coords.accuracy.horizontal:e.coords.accuracy;GRUNT.Log.info("got position coordinates: "+g+", accuracy = "+i);if(f.successCallback&&(!h||i<a))f.successCallback(g,c,e);if(i>f.highAccuracyCutoff&&c<2){c=2;f.enableHighAccuracy=true;GRUNT.Log.info("Position not at required accuracy, trying again with high accuracy");
d()}h=e;a=i}catch(m){GRUNT.Log.exception(m)}}function b(e){if(e.code===e.PERMISSION_DENIED)f.errorCallback&&f.errorCallback(e);else if(e.code===e.POSITION_UNAVAILABLE)f.errorCallback&&f.errorCallback(e);else if(e.code===e.TIMEOUT){GRUNT.Log.info("had a timeout on cached position, moving to phase 1");if(f.timeout===0&&f.autoPhasing){c=1;f.timeout=l;f.enableHighAccuracy=false;d()}}}function d(){navigator.geolocation.getCurrentPosition(j,b,f)}f=GRUNT.extend({autoPhasing:true,maximumAge:3E5,timeout:0,
highAccuracyCutoff:10,enableHighAccuracy:true,successCallback:null,errorCallback:null},f);var c=0,h=null,a=1E6;d()}var l=3E3,k={get:function(){throw Error("No geolocation APIs supported.");}};if(navigator.geolocation)k.get=p;return k}();SLICK.Geo.Search=function(){return{bestResults:function(p,l){l||(l=20);for(var k=p.length>0?p[0]:null,f=[],j=0;j<p.length;j++)if(k.matchWeight-p[j].matchWeight<=l)f.push(p[j]);else break;return f}}}();
SLICK.Mapping=function(){var p={AnnotationTween:null,GeoTileGrid:function(l){l=GRUNT.extend({grid:null,centerPos:new SLICK.Geo.Position,centerXY:new SLICK.Vector,radsPerPixel:0},l);var k=SLICK.Geo.posToMercatorPixels(l.centerPos,l.radsPerPixel),f=k.x-l.centerXY.x,j=k.y-l.centerXY.y,b=GRUNT.extend({},l.grid,{getBoundingBox:function(d,c,h,a){return new SLICK.Geo.BoundingBox(b.pixelsToPos(new SLICK.Vector(d,c+a)),b.pixelsToPos(new SLICK.Vector(d+h,c)))},getCenterOffset:function(){return l.centerXY},
getGridXYForPosition:function(d){d=SLICK.Geo.posToMercatorPixels(d,l.radsPerPixel);return new SLICK.Vector(d.x-f,b.gridDimensions.height-(d.y-j))},getGuideOffset:function(d){var c=b.getTileSize();return new SLICK.Vector(d.x%c,d.y%c)},pixelsToPos:function(d){return SLICK.Geo.mercatorPixelsToPos(f+d.x,j+b.gridDimensions.height-d.y,l.radsPerPixel)}});return b},POIViewLayer:function(l){GRUNT.extend({},l)},Overlay:function(l){GRUNT.extend({},l);return{}},RadarOverlay:function(l){l=GRUNT.extend({radarFill:"rgba(0, 221, 238, 0.1)",
radarStroke:"rgba(0, 102, 136, 0.3)",zindex:100},l);return GRUNT.extend(new SLICK.Graphics.ViewLayer(l),{draw:function(k,f,j){f=j.width>>1;j=j.height>>1;k.fillStyle=l.radarFill;k.strokeStyle=l.radarStroke;k.beginPath();k.arc(f,j,50,0,Math.PI*2,false);k.fill();k.stroke()}})},CrosshairOverlay:function(l){l=GRUNT.extend({lineWidth:1.5,strokeStyle:"rgba(0, 0, 0, 0.5)",size:15,zindex:150,scalePosition:false,validStates:SLICK.Graphics.DisplayState.ACTIVE|SLICK.Graphics.DisplayState.ANIMATING|SLICK.Graphics.DisplayState.PAN},
l);return GRUNT.extend(new SLICK.Graphics.ViewLayer(l),{draw:function(k,f,j){f=j.getCenter();k.lineWidth=l.lineWidth;k.strokeStyle=l.strokeStyle;j=l.size;k.beginPath();k.moveTo(f.x,f.y-j);k.lineTo(f.x,f.y+j);k.moveTo(f.x-j,f.y);k.lineTo(f.x+j,f.y);k.arc(f.x,f.y,j*0.6666,0,2*Math.PI,false);k.stroke()}})},RouteOverlay:function(l){function k(c){j=[];b=[];GRUNT.Log.info("started route calc coordinates");var h=GRUNT.Log.getTraceTicks(),a,e,g=null,i,m=l.data?l.data.geometry:[],n=m.length,r=l.data?l.data.instructions:
[],o=r.length;for(a=n;a--;){e=c.getGridXYForPosition(m[a]);if(i=!g||a===0||Math.abs(e.x-g.x)+Math.abs(e.y-g.y)>l.pixelGeneralization){j.unshift(e);g=e}}GRUNT.Log.trace(n+" geometry points generalized to "+j.length+" coordinates",h);g=null;for(a=o;a--;)if(r[a].position){e=c.getGridXYForPosition(r[a].position);if(i=!g||a===0||Math.abs(e.x-g.x)+Math.abs(e.y-g.y)>l.pixelGeneralization){b.push(e);g=e}}GRUNT.Log.trace(o+" instructions generalized to "+b.length+" coordinates",h);GRUNT.Log.info("finished route calc coordinates");
f=false}l=GRUNT.extend({strokeStyle:"rgba(0, 51, 119, 0.9)",waypointFillStyle:"#FFFFFF",lineWidth:4,data:null,pixelGeneralization:8,zindex:50,validStates:SLICK.Graphics.DisplayState.ACTIVE|SLICK.Graphics.DisplayState.PAN},l);var f=true,j=[],b=[],d=GRUNT.extend(new SLICK.Graphics.ViewLayer(l),{getAnimation:function(c,h,a,e){f&&k(d.getParent().getTileLayer());return new SLICK.Graphics.AnimatedPathLayer({path:j,zindex:l.zindex+1,easing:c?c:SLICK.Animation.Easing.Sine.InOut,duration:h?h:5E3,drawIndicator:a,
autoCenter:e?e:false})},draw:function(c,h,a,e,g){f&&k(g.getTileLayer());a=j.length;c.strokeStyle=l.strokeStyle;c.lineWidth=l.lineWidth;c.beginPath();c.moveTo(j[a-1].x-h.x,j[a-1].y-h.y);for(a=a;a--;)c.lineTo(j[a].x-h.x,j[a].y-h.y);c.stroke();c.fillStyle=l.waypointFillStyle;for(a=b.length;a--;){c.beginPath();c.arc(b[a].x-h.x,b[a].y-h.y,2,0,Math.PI*2,false);c.stroke();c.fill()}}});GRUNT.WaterCooler.listen("grid.updated",function(){f=true;d.wakeParent()});return d},Annotation:function(l){l=GRUNT.extend({xy:null,
pos:null,draw:null,tweenIn:p.AnnotationTween},l);var k=false,f={xy:l.xy,pos:l.pos,isNew:false,isAnimating:function(){return k},draw:function(j,b){if(f.xy){if(f.isNew&&l.tweenIn){var d=f.xy.y;f.xy.y=b.y-20;k=true;SLICK.Animation.tween(f.xy,"y",d,l.tweenIn,function(){f.xy.y=d;k=false},250+Math.random()*500)}if(l.draw)l.draw(j,b,new SLICK.Vector(f.xy.x-b.x,f.xy.y-b.y));else{j.beginPath();j.arc(f.xy.x-b.x,f.xy.y-b.y,4,0,Math.PI*2,false);j.fill()}f.isNew=false}}};return f},ImageAnnotation:function(l){l=
GRUNT.extend({imageUrl:null},l);var k=null,f=new SLICK.Vector;l.draw=function(j,b,d){if(k){b=SLICK.V.offset(d,f.x,f.y);j.drawImage(k,b.x,b.y,k.width,k.height)}};SLICK.Resources.getImage(l.imageUrl,function(j){if(k=j){f.x=-k.width>>1;f.y=-k.height>>1}});return new p.Annotation(l)},AnnotationsOverlay:function(l){function k(c){for(var h=l.map?l.map.getTileLayer():null,a=0;h&&a<c.length;a++)c[a].xy=h.getGridXYForPosition(c[a].pos)}l=GRUNT.extend({pois:null,map:null,createAnnotationForPOI:null,zindex:100},
l);var f=[],j=false,b=[],d=GRUNT.extend(new SLICK.Graphics.ViewLayer(l),{draw:function(c,h){c.save();try{var a;j=false;c.fillStyle="rgba(255, 0, 0, 0.75)";c.globalCompositeOperation="source-over";for(a=f.length;a--;){f[a].draw(c,h);j=j||f[a].isAnimating()}for(a=b.length;a--;){b[a].draw(c,h);j=j||f[a].isAnimating()}if(j){d.layerChanged();d.wakeParent()}}finally{c.restore()}},add:function(c){b.push(c);k(b)},isAnimating:function(){return j}});GRUNT.WaterCooler.listen("geo.pois-updated",function(c){if(l.pois&&
l.pois.id==c.srcID){c=c.pois;try{f=[];for(var h=0;h<c.length;h++)if(c[h].pos){var a;var e=c[h];if(e&&e.pos){var g=null;if(g=l.createAnnotationForPOI?l.createAnnotationForPOI(e):new p.Annotation({pos:e.pos})){g.isNew=e.isNew;e.isNew=false}a=g}else a=void 0;a&&f.push(a)}k(f)}catch(i){GRUNT.Log.exception(i)}d.layerChanged();d.wakeParent()}});GRUNT.WaterCooler.listen("grid.updated",function(){k(f);k(b)});return d},Tiler:function(l){l=GRUNT.extend({tapExtent:10,provider:null,crosshair:true,copyright:undefined,
zoomLevel:0,boundsChange:null,tapPOI:null,boundsChangeThreshold:30,pois:new SLICK.Geo.POIStorage,createAnnotationForPOI:null},l);if(typeof l.copyright==="undefined")l.copyright=l.provider?l.provider.getCopyright():"";var k=new SLICK.Vector,f=l.copyright,j=false,b=[],d=null,c=l.zoomLevel;if(!l.provider)l.provider=new SLICK.Geo.MapProvider;var h=l.panHandler,a=l.tapHandler;l.onPan=function(i,m){h&&h(i,m)};l.tapHandler=function(i,m){var n=g.getTileLayer(),r=null;if(n){var o=g.viewPixToGridPix(new SLICK.Vector(m.x,
m.y));r=n.pixelsToPos(SLICK.V.offset(o,-l.tapExtent));n=n.pixelsToPos(SLICK.V.offset(o,-l.tapExtent));r=new SLICK.Geo.BoundingBox(r.toString(),n.toString());b=g.pois.findByBounds(r);GRUNT.Log.info("TAPPED POIS = ",b);l.tapPOI&&l.tapPOI(b)}a&&a(i,m,r)};l.doubleTapHandler=function(i,m){g.animate(2,g.getDimensions().getCenter(),new SLICK.Vector(m.x,m.y),SLICK.Animation.Easing.Sine.Out)};l.onScale=function(i,m){var n=0;i=Math.sqrt(i);if(i<1)n=-(0.5/i);else if(i>1)n=i;g.removeLayer("grid");SLICK.Resources.resetImageLoadQueue();
g.gotoPosition(g.getXYPosition(m),c+Math.floor(n));GRUNT.Log.info("zoom change = "+Math.floor(n)+", new zoom level = "+(c+Math.floor(n)))};var e=new SLICK.Tiling.Tiler(l),g=GRUNT.extend({},e,{pois:l.pois,getBoundingBox:function(){var i=new SLICK.Geo.BoundingBox,m=g.getTileLayer(),n=g.getOffset(),r=g.getDimensions();if(m)i=m.getBoundingBox(n.x,n.y,r.width,r.height);return i},getCenterPosition:function(){return g.getXYPosition(g.gridDimensions.getCenter())},getXYPosition:function(i){return g.getTileLayer().pixelsToPos(g.viewPixToGridPix(i))},
gotoBounds:function(i,m){var n=SLICK.Geo.getBoundingBoxZoomLevel(i,g.getDimensions());GRUNT.Log.info("BOUNDS CHANGE REQUIRED CENTER: "+i.getCenter()+", ZOOM LEVEL: "+n);g.gotoPosition(i.getCenter(),n,m)},gotoCurrentPosition:function(i){SLICK.Geo.Location.get({successCallback:function(m){g.clearBackground();g.gotoPosition(m,15,i)},errorCallback:function(){}})},gotoPosition:function(i,m,n){var r=c;c=m?m:c;if(!c)throw"Zoom level required to goto a position.";if(l.provider)c=l.provider.checkZoomLevel(c);
if(!j||c!=r){SLICK.Animation.cancel();j&&g.freeze();l.provider.zoomLevel=c;l.provider.getMapTiles(g,i,function(o){g.setTileLayer(o);g.panToPosition(i,function(){g.unfreeze();n&&n()})});j=true}else g.panToPosition(i,n)},panToPosition:function(i,m,n){var r=g.getTileLayer();if(r){i=r.getGridXYForPosition(i);r=g.getDimensions();i.x-=r.width>>1;i.y-=r.height>>1;if(d)d=null;g.updateOffset(i.x,i.y,n);GRUNT.WaterCooler.say("view.wake",{id:g.id});l.boundsChange&&l.boundsChange(g.getBoundingBox());m&&m(g)}},
setZoomLevel:function(i){g.gotoPosition(g.getCenterPosition(),i)},zoomIn:function(){GRUNT.Log.info("scaling needed is "+2*Math.PI/(1<<c)/(2*Math.PI/(1<<c+1)));g.scale(2,SLICK.Animation.Easing.Sine.Out)||g.setZoomLevel(c+1)},zoomOut:function(){GRUNT.Log.info("scaling needed is "+2*Math.PI/(1<<c)/(2*Math.PI/(1<<c-1)));g.scale(0.5,SLICK.Animation.Easing.Sine.Out)||g.setZoomLevel(c-1)},animateRoute:function(i,m,n,r){var o=g.getLayer("route");o&&o.getAnimation(i,m,n,r).addToView(g)}},e);e=new SLICK.Mapping.AnnotationsOverlay({pois:g.pois,
map:g,createAnnotationForPOI:l.createAnnotationForPOI});g.setLayer("annotations",e);l.crosshair&&g.setLayer("crosshair",new SLICK.Mapping.CrosshairOverlay);f&&g.setLayer("copyright",new SLICK.Graphics.ViewLayer({zindex:999,draw:function(i,m,n){i.lineWidth=2.5;i.fillStyle="rgb(50, 50, 50)";i.strokeStyle="rgba(255, 255, 255, 0.8)";i.font="bold 10px sans";i.textBaseline="bottom";i.strokeText(f,10,n.height-10);i.fillText(f,10,n.height-10)}}));GRUNT.WaterCooler.listen("view-idle",function(i){if(i.id&&
i.id==g.id)if(SLICK.V.absSize(SLICK.V.diff(k,g.getOffset()))>l.boundsChangeThreshold&&l.boundsChange){k=g.getOffset();l.boundsChange(g.getBoundingBox())}});return g}};return p}();
SLICK.Geo.Routing=function(){var p={calculate:function(l){l=GRUNT.extend({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null},l);GRUNT.Log.info("attempting to calculate route");var k=SLICK.Geo.getEngine("route");k&&k.route(l,function(f){if(l.map){p.createMapOverlay(l.map,f);if(l.autoFit){GRUNT.Log.info("AUTOFITTING MAP TO ROUTE: bounds = "+f.boundingBox);l.map.gotoBounds(f.boundingBox)}}l.success&&l.success(f)})},createMapOverlay:function(l,k){var f=l.getDimensions();f=new SLICK.Mapping.RouteOverlay({data:k,
width:f.width,height:f.height});l.setLayer("route",f)},Maneuver:{None:0,Continue:1,TurnLeft:100,TurnLeftSlight:101,TurnLeftSharp:102,TurnRight:110,TurnRightSlight:111,TurnRightSharp:112,TurnAround:190,EnterRoundabout:200,ExitRamp:300},Instruction:function(l){l=GRUNT.extend({position:null,description:"",manuever:p.Maneuver.None},l);return GRUNT.extend(l,{})},RouteData:function(l){l=GRUNT.extend({geometry:[],instructions:[],boundingBox:null},l);if(!l.boundingBox)l.boundingBox=SLICK.Geo.getBoundsForPositions(l.geometry);
return l}};return p}();
