if(!this.JSON)this.JSON={};
(function(){function q(c){return c<10?"0"+c:c}function m(c){h.lastIndex=0;return h.test(c)?'"'+c.replace(h,function(f){var j=g[f];return typeof j==="string"?j:"\\u"+("0000"+f.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+c+'"'}function e(c,f){var j,k,l,p,r=a,n,o=f[c];if(o&&typeof o==="object"&&typeof o.toJSON==="function")o=o.toJSON(c);if(typeof i==="function")o=i.call(f,c,o);switch(typeof o){case "string":return m(o);case "number":return isFinite(o)?String(o):"null";case "boolean":case "null":return String(o);
case "object":if(!o)return"null";a+=d;n=[];if(Object.prototype.toString.apply(o)==="[object Array]"){p=o.length;for(j=0;j<p;j+=1)n[j]=e(j,o)||"null";l=n.length===0?"[]":a?"[\n"+a+n.join(",\n"+a)+"\n"+r+"]":"["+n.join(",")+"]";a=r;return l}if(i&&typeof i==="object"){p=i.length;for(j=0;j<p;j+=1){k=i[j];if(typeof k==="string")if(l=e(k,o))n.push(m(k)+(a?": ":":")+l)}}else for(k in o)if(Object.hasOwnProperty.call(o,k))if(l=e(k,o))n.push(m(k)+(a?": ":":")+l);l=n.length===0?"{}":a?"{\n"+a+n.join(",\n"+a)+
"\n"+r+"}":"{"+n.join(",")+"}";a=r;return l}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+q(this.getUTCMonth()+1)+"-"+q(this.getUTCDate())+"T"+q(this.getUTCHours())+":"+q(this.getUTCMinutes())+":"+q(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
h=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,a,d,g={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},i;if(typeof JSON.stringify!=="function")JSON.stringify=function(c,f,j){var k;d=a="";if(typeof j==="number")for(k=0;k<j;k+=1)d+=" ";else if(typeof j==="string")d=j;if((i=f)&&typeof f!=="function"&&(typeof f!=="object"||typeof f.length!=="number"))throw Error("JSON.stringify");return e("",
{"":c})};if(typeof JSON.parse!=="function")JSON.parse=function(c,f){function j(l,p){var r,n,o=l[p];if(o&&typeof o==="object")for(r in o)if(Object.hasOwnProperty.call(o,r)){n=j(o,r);if(n!==undefined)o[r]=n;else delete o[r]}return f.call(l,p,o)}var k;c=String(c);b.lastIndex=0;if(b.test(c))c=c.replace(b,function(l){return"\\u"+("0000"+l.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(c.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){k=eval("("+c+")");return typeof f==="function"?j({"":k},""):k}throw new SyntaxError("JSON.parse");}})();if(!String.format)String.format=function(q){if(arguments.length<=1)return q;for(var m=arguments.length-2,e=0;e<=m;e++)q=q.replace(RegExp("\\{"+e+"\\}","gi"),arguments[e+1]);return q};
String.prototype.containsWord=function(q){var m="";if(q.toString)q=q.toString();for(var e=0;e<q.length;e++)m+=!/\w/.test(q[e])?"\\"+q[e]:q[e];return RegExp("(^|\\s|\\,)"+m+"(\\,|\\s|$)","i").test(this)};Number.prototype.toRad=function(){return this*Math.PI/180};Number.prototype.sec=function(){return 1/Math.cos(this)};
GRUNT=function(){var q=Object.prototype.hasOwnProperty,m=0,e={id:"GRUNT.core",extend:function(){var b=arguments[0]||{},h=1,a=arguments.length,d=false,g,i,c,f;if(typeof b==="boolean"){d=b;b=arguments[1]||{};h=2}if(typeof b!=="object"&&!e.isFunction(b))b={};if(a===h){b=this;--h}for(;h<a;h++)if((g=arguments[h])!=null)for(i in g){c=b[i];f=g[i];if(b!==f)if(d&&f&&(e.isPlainObject(f)||e.isArray(f))){c=c&&(e.isPlainObject(c)||e.isArray(c))?c:e.isArray(f)?[]:{};b[i]=e.extend(d,c,f)}else if(f!==undefined)b[i]=
f}return b},isFunction:function(b){return toString.call(b)==="[object Function]"},isArray:function(b){return toString.call(b)==="[object Array]"},isPlainObject:function(b){if(!b||toString.call(b)!=="[object Object]"||b.nodeType||b.setInterval)return false;if(b.constructor&&!q.call(b,"constructor")&&!q.call(b.constructor.prototype,"isPrototypeOf"))return false;var h;for(h in b);return h===undefined||q.call(b,h)},isEmptyObject:function(b){for(var h in b)return false;return true},isXmlDocument:function(b){return toString.call(b)===
"[object Document]"},contains:function(b,h){var a=b,d=arguments,g=1;if(h&&e.isArray(h)){d=h;g=0}for(g=g;g<d;g++)a=a&&typeof foo[d[g]]!=="undefined";return a},newModule:function(b){b=e.extend({id:null,requires:[],parent:null},b);if(b.parent)b=e.extend({},b.parent,b);return b},toID:function(b){return b.replace(/\s/g,"-")},generateObjectID:function(b){return(b?b:"obj")+m++}};return e}();
GRUNT.Log=function(){function q(a,d){var g,i=d&&d.length>0?d[0]:"";for(g=1;d&&g<d.length;g++)i+=" "+(e&&GRUNT.isPlainObject(d[g])?JSON.stringify(d[g]):d[g]);typeof console!=="undefined"&&console[a](i);for(g=0;g<m.length;g++)m[g].call(h,i,a)}var m=[],e=typeof JSON!=="undefined",b=window.console&&window.console.markTimeline,h={id:"GRUNT.log",getTraceTicks:function(){return b?(new Date).getTime():null},trace:function(a,d){if(b)console.markTimeline(a+(d?": "+(h.getTraceTicks()-d)+"ms":""))},debug:function(){q("debug",
arguments)},info:function(){q("info",arguments)},warn:function(){q("warn",arguments)},error:function(){q("error",arguments)},exception:function(a){h.error(arguments);for(var d in a)h.info("ERROR DETAIL: "+d+": "+a[d])},watch:function(a,d){try{d()}catch(g){h.exception(g,a)}},throwError:function(a){h.error(a);throw Error(a);},requestUpdates:function(a){m.push(a)}};return h}();
GRUNT.Data=function(){var q={determineObjectMapping:function(e){if(!e)return null;e=e.split("|");for(var b={},h=0;h<e.length;h++)b[e[h]]=h;return b},mapLineToObject:function(e,b){var h=e.split("|"),a={};for(var d in b){var g=b[d];a[d]=h.length>g?h[g]:null}return a},parse:function(e){var b=null,h=[];e=e.split("\n");for(var a=0;a<e.length;a++){var d=e[a];if(b)h.push(q.mapLineToObject(d,b));else b=q.determineObjectMapping(d)}return h}},m={supportedFormats:{JSON:{parse:function(e){return JSON.parse(e)}},
PDON:{parse:function(e){return q.parse(e)}}},parse:function(e){e=GRUNT.extend({data:"",format:"JSON"},e);if(!m.supportedFormats[e.format])throw Error("Unsupported data format: "+e.format+", cannot parse data in javascript object");try{return m.supportedFormats[e.format].parse(e.data)}catch(b){GRUNT.Log.error("ERROR PARSING DATA FROM FORMAT: "+e.format,e.data);GRUNT.Log.exception(b)}return{}}};return m}();
GRUNT.Template=function(){var q=/\$\{(.*?)\}/ig;return{parse:function(m,e){for(var b=m,h=q.exec(b);h;){b=b.replace(h[0],GRUNT.XPath.first(h[1],e));q.lastIndex=0;h=q.exec(b)}return b}}}();
GRUNT.JSONP=function(){function q(h){var a=document.createElement("script"),d=false;a.src=h;a.async=true;a.onload=a.onreadystatechange=function(){if(!d&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){d=true;a.onload=a.onreadystatechange=null;a&&a.parentNode&&a.parentNode.removeChild(a)}};e||(e=document.getElementsByTagName("head")[0]);e.appendChild(a)}var m=0,e,b=this;return{get:function(h,a){h+=h.indexOf("?")>=0?"&":"?";var d="json"+ ++m;b[d]=function(g){a(g);b[d]=
null;try{delete b[d]}catch(i){}};q(h+"callback="+d);return d}}}();
GRUNT.XHR=function(){var q={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},m={JSON:["json"],PDON:["pdon.txt"]},e=["TEXT","STREAM"],b=/^(\w+:)?\/\/([^\/?#]+)/,h={XML:function(g){return g.responseXML},JSON:function(g){try{return JSON.parse(g.responseText)}catch(i){GRUNT.Log.error("Error parsing JSON data: ",g.responseText);GRUNT.Log.exception(i)}return""},PDON:function(g){return GRUNT.Data.parse({data:g.responseText,format:"PDON"})},DEFAULT:function(g){return g.responseText}},
a={CONTENT_TYPE:"Content-Type"},d=GRUNT.newModule({id:"GRUNT.xhr",ajaxSettings:{xhr:null},ajax:function(g){try{g=GRUNT.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},d.ajaxSettings,g);var i=b.exec(g.url),c=i&&(i[1]&&i[1]!==location.protocol||i[2]!==location.host);if(g.data)g.method="POST";if(g.url){i=null;if(g.xhr)i=g.xhr(g);i||(i=new XMLHttpRequest);i.open(g.method,g.url,g.async);g.data&&i.setRequestHeader("Content-Type",
g.contentType);c||i.setRequestHeader("X-Requested-With","XMLHttpRequest");i.onreadystatechange=function(){if(this.readyState===4){var j=null,k=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(k)if(g.handleResponse)g.handleResponse(this);else{var l=g,p=this.getResponseHeader(a.CONTENT_TYPE),r,n=false;for(r in q)if(p&&p.indexOf(q[r])>=0){n=true;break}p=!n;for(n=0;n<e.length;n++)p=p||e[n]==r;if(p)b:{p=r;for(var o in m)for(n=
0;n<m[o].length;n++)if(RegExp(m[o][n]+"$","i").test(l.url)){r=o;break b}r=p?p:"DEFAULT"}try{j=h[r](this,l)}catch(s){GRUNT.Log.warn("error applying processor '"+r+"' to response type, falling back to default");j=h.DEFAULT(this,l)}}else g.error&&g.error(this)}catch(u){GRUNT.Log.exception(u,"PROCESSING AJAX RESPONSE")}k&&j&&g.success&&g.success.call(this,j)}};i.send(g.method=="POST"?d.param(g.data):null)}else GRUNT.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(f){GRUNT.Log.exception(f)}},
param:function(g){var i=[],c=function(j,k){k=GRUNT.isFunction(k)?k():k;i[i.length]=encodeURIComponent(j)+"="+encodeURIComponent(k)};if(GRUNT.isArray(g))for(var f=0;f<g.length;f++)c(g[f].name,g[f].value);else for(f in g)c(f,g[f]);return i.join("&").replace(/%20/g,"+")}});return d}();
GRUNT.XPath=function(){function q(h){for(var a=null,d=0;d<m.length;d++)if(a=m[d](h))break;return a}var m=[],e=[null,function(h){return h.numberValue},function(h){return h.stringValue},function(h){return h.booleanValue},null,null,null,null,function(h){return h.singleNodeValue?h.singleNodeValue.textContent:null},function(h){return h.singleNodeValue?h.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||GRUNT.Log.warn("No XPATH support, this is going to cause problems");var b={SearchResult:function(h){return{toString:function(){var a=
null;if(h){var d=null;if(h.resultType>=0&&h.resultType<e.length)d=e[h.resultType];if(d){GRUNT.Log.info("invoking match handler for result type: "+h.resultType);a=d(h)}}return a?a:""}}},first:function(h,a){var d=b.SearchResult,g;var i=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!i)i=XPathResult.ANY_TYPE;try{if(GRUNT.isXmlDocument(a))g=a.evaluate(h,a,q,i,null);else{GRUNT.Log.warn("attempted xpath expression: "+h+" on a non-xml document");g=null}}catch(c){GRUNT.Log.warn("attempted to run invalid xpath expression: "+
h+" on node: "+a);g=null}return new d(g)},registerResolver:function(h){m.push(h)}};return b}();GRUNT.WaterCooler=function(){var q={};return{listen:function(m,e){q[m]||(q[m]=[]);e&&q[m].push(e)},say:function(m,e){if(q[m])for(var b=0;b<q[m].length;b++)q[m][b](e)},leave:function(){}}}();
SLICK=function(){var q={copyRect:function(m){return m?new q.Rect(m.origin.x,m.origin.y,m.dimensions.width,m.dimensions.height):null},Settings:function(){var m={};return{get:function(e){return m[e]},set:function(e,b){m[e]=b},extend:function(e){GRUNT.extend(m,e)}}}(),Clock:function(){var m=null;return{getTime:function(e){return e&&m?m:m=(new Date).getTime()}}}(),Vector:function(m,e){return{x:m?m:0,y:e?e:0}},V:function(){return{create:function(m,e){return new q.Vector(m,e)},add:function(){for(var m=
new q.Vector,e=arguments.length;e--;){m.x+=arguments[e].x;m.y+=arguments[e].y}return m},absSize:function(m){return Math.max(Math.abs(m.x),Math.abs(m.y))},diff:function(m,e){return new q.Vector(m.x-e.x,m.y-e.y)},copy:function(m){return m?new q.Vector(m.x,m.y):null},invert:function(m){return new SLICK.Vector(-m.x,-m.y)},offset:function(m,e,b){return new SLICK.Vector(m.x+e,m.y+(b?b:e))}}}(),VectorArray:function(m,e){for(var b=Array(m.length),h=m.length;h--;)b[h]=e?q.V.copy(m[h]):m[h];return{applyOffset:function(a){for(var d=
b.length;d--;){b[d].x+=a.x;b[d].y+=a.y}},getRect:function(){return new SLICK.Rect(Math.min(b[0].x,b[1].x),Math.min(b[0].y,b[1].y),Math.abs(b[0].x-b[1].x),Math.abs(b[0].y-b[1].y))},toString:function(){for(var a="",d=b.length;d--;)a+="["+b[d].toString()+"] ";return a}}},VectorMath:function(){function m(e){if(!e||e.length<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var b={edges:Array(e.length-1),accrued:Array(e.length-1),total:0},h=SLICK.V.diff,a=0;a<e.length-
1;a++){var d=h(e[a],e[a+1]);b.edges[a]=Math.sqrt(d.x*d.x+d.y*d.y);b.accrued[a]=b.total+b.edges[a];b.total+=b.edges[a]}return b}return{edges:m,distance:function(e){return m(e).total},theta:function(e,b,h){h=Math.asin((e.y-b.y)/h);return e.x>b.x?h:Math.PI-h},pointOnEdge:function(e,b,h,a){b=new SLICK.Vector(Math.cos(h)*a,Math.sin(h)*a);return new SLICK.Vector(e.x-b.x,e.y-b.y)}}}(),Dimensions:function(m,e){var b=e?m/e:1,h={width:m,height:e,aspect_ratio:b,inv_aspect_ratio:1/b,getAspectRatio:function(){return h.height!==
0?h.width/h.height:1},getCenter:function(){return new SLICK.Vector(h.width>>1,h.height>>1)},grow:function(a,d){return new SLICK.Dimensions(h.width+a,h.height+d)},matches:function(a){return a&&h.width==a.width&&h.height==a.height},toString:function(){return h.width+" x "+h.height}};return h},Rect:function(m,e,b,h){var a={origin:new SLICK.Vector(m,e),dimensions:new SLICK.Dimensions(b,h),getCenter:function(){return new SLICK.Vector(a.origin.x+(a.dimensions.width>>1),a.origin.y+(a.dimensions.height>>
1))},getSize:function(){return Math.sqrt(Math.pow(a.dimensions.width,2)+Math.pow(a.dimensions.height,2))},grow:function(d,g){var i=new SLICK.Dimensions(d-a.dimensions.width,g-a.dimensions.height);a.dimensions.width=d;a.dimensions.height=g;return i},expand:function(d,g){a.origin.x-=d;a.origin.y-=g;a.dimensions.width+=d;a.dimensions.height+=g},offset:function(d){return new q.Rect(a.origin.x+d.x,a.origin.y+d.y,a.dimensions.width,a.dimensions.height)},getRequiredDelta:function(d,g){var i={top:0,left:0,
bottom:0,right:0};i.top=d.origin.y-a.origin.y+(g?g.y:0);i.left=d.origin.x-a.origin.x+(g?g.x:0);i.right=d.origin.x+d.dimensions.width-(a.origin.x+a.dimensions.width)-i.left;i.bottom=d.origin.y+d.dimensions.height-(a.origin.y+a.dimensions.height)-i.top;return i},applyDelta:function(d,g,i){if(!d||!GRUNT.contains(d,["top","left","bottom","right"]))throw Error("Invalid delta - cannot apply to SLICK.Rect");g||(g=1);a.origin.x+=d.left*g;a.origin.y+=d.top*g;a.dimensions.width+=d.right*g;a.dimensions.height+=
d.bottom*g;i&&a.constrainAspectRatio(i)},constrainAspectRatio:function(d){var g=0,i={top:0,left:0,bottom:0,right:0};if(a.dimensions.getAspectRatio()<d){g=Math.abs(a.dimensions.width-a.dimensions.height*d);i.left=-g;i.right=g}else{g=Math.abs(a.dimensions.height-a.dimensions.width/d);i.top=-g;i.bottom=g}a.applyDelta(i)},moveTo:function(d,g){var i=new SLICK.Vector(d-a.origin.x,g-a.origin.y);a.origin.x=d;a.origin.y=g;return i},toString:function(){return String.format("(origin: {0}, dimensions: {1})",
a.origin,a.dimensions)}};return a}};return q}();
SLICK.Device=function(){function q(){m={base:{name:"Unknown",eventTarget:document,supportsTouch:"createTouch"in document,imageCacheMaxSize:4096,getScaling:function(){return 1},maxImageLoads:4,requireFastDraw:false},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:true},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144},android:{name:"Android OS <= 2.1",regex:/android/i,eventTarget:document.body,
supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio}},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true}};e=[m.froyo,m.android,m.ipod,m.iphone,m.ipad]}var m=null,e=[],b=null;return{getConfig:function(){m||q();if(!b){GRUNT.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var h=0;h<e.length;h++){var a=e[h];if(a.regex&&a.regex.test(navigator.userAgent)){b=GRUNT.extend({},m.base,a);GRUNT.Log.info("PLATFORM DETECTED AS: "+
b.name);break}}if(!b){GRUNT.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");b=m.base}GRUNT.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return b}}}();
SLICK.Resources=function(){var q="",m={},e=function(){function h(){var n=i[this.id];if(n){n.loaded=true;n.hitCount=1;for(var o=j.length;o--;)if(j[o].image.src==this.src){j.splice(o,1);break}n.loadCallback&&n.loadCallback(this,false);k.push({url:this.src,created:n.requested});delete i[this.id];a()}}function a(){for(var n=SLICK.Device.getConfig().maxImageLoads;f.length>0&&(!n||j.length<n);){var o=f.shift();j.push(o);o.image.onload=h;o.image.src=o.url;o.requested=(new Date).getTime()}}function d(){p=
true;try{var n=Math.floor(k.length*0.5);if(n>0){k.sort(function(s,u){return s.created-u.created});for(var o=n;o--;)delete g[k[o].url];k.splice(0,n)}}finally{p=false}GRUNT.WaterCooler.say("imagecache.cleared")}var g={},i={},c=0,f=[],j=[],k=[],l=0,p=false,r={loadingImages:j,queuedImages:f,getCacheFullness:function(){return l},getImage:function(n){var o=null;p||(o=g[n]);return o?o.image:null},loadImage:function(n,o){var s=g[n];if(s){s.hitCount++;s.image.complete&&o&&o(s.image,true)}else{s={url:b.getPath(n),
image:new Image,loaded:false,created:(new Date).getTime(),requested:null,hitCount:0,loadCallback:o};s.image.id="resourceLoaderImage"+c++;g[n]=s;i[s.image.id]=s;f.push(s);a()}return s},resetLoadingQueue:function(){j=[]}};setInterval(function(){for(var n=(new Date).getTime(),o=false,s=0,u=SLICK.Device.getConfig();s<j.length;)if(n-j[s].requested>b.loadTimeout*1E3){j.splice(s,1);o=true}else s++;o&&a();if(u&&u.imageCacheMaxSize){l=k.length*b.avgImageSize/u.imageCacheMaxSize;l>=1&&d()}},1E3);return r}(),
b={avgImageSize:25,loadTimeout:10,Cache:function(){return{read:function(){return null},write:function(){},getUrlCacheKey:function(h,a){for(var d=(h?h.replace(/^.*\?/,""):"").split("&"),g=h?h.replace(/\?.*$/,"?"):"",i=0;i<d.length;i++){var c=d[i].split("=");if(!a||!a.test(c[0]))g+=d[i]+"&"}return g.replace(/\W/g,"")},isValidCacheKey:function(h){GRUNT.Log.info("cache key = "+h);return false}}}(),getCachedUrl:function(h){return h},getPath:function(h){return/^(https?|\/)/.test(h)?h:q+h},setBasePath:function(h){q=
h},getImage:function(h){return e.getImage(h)},loadImage:function(h,a){e.loadImage(h,a)},resetImageLoadQueue:function(){e.resetLoadingQueue()},getStats:function(){return{imageLoadingCount:e.loadingImages.length,queuedImageCount:e.queuedImages.length,imageCacheFullness:e.getCacheFullness()}},loadResource:function(h){h=GRUNT.extend({filename:"",cacheable:true,dataType:null,callback:null},h);var a=function(d){h.callback&&GRUNT.Log.watch("CALLING RESOURCE CALLBACK",function(){h.callback(d)})};h.cacheable&&
m[h.filename]?a(m[h.filename]):GRUNT.XHR.ajax({url:b.getPath(h.filename),dataType:h.dataType,success:function(d){if(h.cacheable)m[h.filename]=d;a(d)},error:function(d,g,i){GRUNT.Log.error("error loading resource ["+h.filename+"], error = "+i)}})},loadSnippet:function(h,a){/\.\w+$/.test(h)||(h+=".html");b.loadResource({filename:"snippets/"+h,callback:a,dataType:"html"})}};return b}();
SLICK.Touch=function(){function q(c,f){var j=c&&c.length>0?c[0]:null;if(j&&f&&f.length>0)return SLICK.V.diff(j,f[0]);return null}function m(c){c.preventDefault();c.stopPropagation()}function e(c){for(var f=Array(c.length),j=c.length;j--;)f[j]=new SLICK.Vector(c[j].pageX,c[j].pageY);return f}var b={TAP:0,MOVE:1,PINCHZOOM:2},h=7,a=0,d=0,g={TouchHelper:function(c){function f(t){t=new SLICK.VectorArray(t,true);c.element&&t.applyOffset(new SLICK.Vector(-c.element.offsetLeft,-c.element.offsetTop));return t}
function j(t){var y=Array(arguments.length-1),B=0;for(B=1;B<arguments.length;B++)y[B-1]=arguments[B];for(B=E.length;B--;)E[B][t]&&E[B][t].apply(M,y)}function k(t){if(t.target&&t.target===c.element){s=o?e(t.touches):[new SLICK.Vector(t.pageX,t.pageY)];A=new SLICK.Vector;x=new SLICK.Vector;D=true;r=false;o&&m(t);G.current=SLICK.Clock.getTime();if(t=s.length>0?s[0]:null){j("touchStartHandler",t.x,t.y);if(G.current-G.last<M.THRESHOLD_DOUBLETAP)if((t=u?SLICK.V.diff(s[0],u[0]):null)&&Math.abs(t.x)<c.maxDistDoubleTap&&
Math.abs(t.y)<c.maxDistDoubleTap)r=true;z=b.TAP;u=[].concat(s)}else GRUNT.Log.warn("Touch start fired, but no touch vector found")}}function l(t){if(t.target&&t.target===c.element)if(D)try{o&&m(t);var y=o?e(t.touches):[new SLICK.Vector(t.pageX,t.pageY)];t=0;if(y.length>1){if(s.length===1)s=[].concat(y);t=SLICK.VectorMath.distance(s)-SLICK.VectorMath.distance(u)}if(z===b.TAP){var B=q(y,s);if(B&&(Math.abs(B.x)>=h||Math.abs(B.y)>=h))z=b.MOVE}if(z!==b.TAP)if(!t||Math.abs(t)<c.pinchZoomThreshold){if(A=
q(y,u)){x.x+=A.x;x.y+=A.y;C.x+=A.x;C.y+=A.y}if(SLICK.V.absSize(C)>c.panEventThreshhold){j("moveHandler",C.x,C.y);C=SLICK.V.create()}z=b.MOVE}else{j("pinchZoomHandler",f(s),f(y));z=b.PINCHZOOM}u=[].concat(y)}catch(J){GRUNT.Log.exception(J)}}function p(t){if(t.target&&t.target===c.element)try{o&&m(t);SLICK.Clock.getTime();G.last=G.current;if(z===b.TAP)n||(n=setTimeout(function(){n=0;var B=r?"doubleTapHandler":"tapHandler",J=s[0],P=null;if(c.element)P=SLICK.V.offset(J,-c.element.offsetLeft,-c.element.offsetTop);
j(B,J,P)},M.THRESHOLD_DOUBLETAP+50));else if(z==b.MOVE)j("moveEndHandler",x.x,x.y);else z==b.PINCHZOOM&&j("pinchZoomEndHandler",f(s),f(u))}catch(y){GRUNT.Log.exception(y)}D=false}c=GRUNT.extend({element:null,inertiaTrigger:20,maxDistDoubleTap:20,panEventThreshhold:0,pinchZoomThreshold:5,touchStartHandler:null,moveHandler:null,moveEndHandler:null,pinchZoomHandler:null,pinchZoomEndHandler:null,tapHandler:null,doubleTapHandler:null,wheelZoomHandler:null},c);var r=false,n=0,o=SLICK.Device.getConfig().supportsTouch,
s=null,u=null,A=null,x=null,C=new SLICK.Vector,z=null,D=false,E=[],G={current:0,last:0},F=SLICK.Device.getConfig(),M={supportsTouch:o,THRESHOLD_DOUBLETAP:300,addListeners:function(t){E.push(t)},decoupleListeners:function(t){for(var y=0;t&&y<E.length;y++)if(E[y].listenerId===t){E.splice(y,1);GRUNT.Log.info("successfully decoupled touch listener: "+t);break}},release:function(){F.eventTarget.removeEventListener(F.supportsTouch?"touchstart":"mousedown",k,false);F.eventTarget.removeEventListener(F.supportsTouch?
"touchmove":"mousemove",l,false);F.eventTarget.removeEventListener(F.supportsTouch?"touchend":"mouseup",p,false)},wheelie:function(t){var y=new SLICK.Vector(t.wheelDeltaX,t.wheelDeltaY);t=new SLICK.Vector(t.clientX,t.clientY);var B=y.y!==0?Math.abs(y.y/120):0;if(B!==0)j("wheelZoomHandler",t,y.y>0?B+0.5:0.5/B);GRUNT.Log.info("capture mouse wheel event, delta = "+y+", position = "+t)}};F.eventTarget.addEventListener(F.supportsTouch?"touchstart":"mousedown",k,false);F.eventTarget.addEventListener(F.supportsTouch?
"touchmove":"mousemove",l,false);F.eventTarget.addEventListener(F.supportsTouch?"touchend":"mouseup",p,false);return M}},i=[];return{captureTouch:function(c,f){try{if(!c)throw Error("Unable to capture touch of null element");if(!c.id)c.id="touchable_"+a++;var j=i[c.id];if(!j){j=g.TouchHelper(GRUNT.extend({element:c},f));i[c.id]=j;GRUNT.Log.info("CREATED TOUCH HELPER. SUPPORTS TOUCH = "+j.supportsTouch)}f.listenerId&&j.decoupleListeners(f.listenerId);f.listenerId=++d;j.addListeners(f)}catch(k){GRUNT.Log.exception(k)}},
resetTouch:function(c){if(c&&c.id&&i[c.id]){i[c.id].release();delete i[c.id]}}}}();if(typeof jQuery!=="undefined"){jQuery.fn.canTouchThis=function(q){return this.each(function(){SLICK.Touch.captureTouch(this,q)})};jQuery.fn.untouchable=function(){return this.bind("touchmove",function(q){q.preventDefault()})}}
SLICK.Pannable=function(q){q=GRUNT.extend({container:null,onPan:null,onPanEnd:null,onAnimate:null,checkOffset:null},q);var m=false,e=new SLICK.Vector,b={pannable:true,getOffset:function(){return new SLICK.Vector(e.x,e.y)},setOffset:function(a,d){e.x=a;e.y=d},pan:function(a,d,g){if(g)b.updateOffset(e.x+a,e.y+d,g);else{b.updateOffset(e.x+a,e.y+d);q.onPan&&q.onPan(a,d)}},isAnimating:function(){return m},panEnd:function(a,d){q.onPanEnd&&q.onPanEnd(a,d)},updateOffset:function(a,d,g){if(g){a=new SLICK.Vector(a,
d);m=true;g=SLICK.Animation.tweenVector(e,a.x,a.y,g,function(){m=false;b.panEnd(0,0)});for(a=g.length;a--;){g[a].cancelOnInteract=true;g[a].requestUpdates(function(){q.onAnimate&&q.onAnimate(e.x,e.y)})}}else b.setOffset(a,d)}},h=document.getElementById(q.container);h&&SLICK.Touch.captureTouch(h,{moveHandler:function(a,d){b.pan(-a,-d)},moveEndHandler:function(a,d){b.panEnd(a,d)}});return b};
SLICK.Scalable=function(q){function m(k,l){b=k.getRect();h=l.getRect();var p=b.getSize(),r=h.getSize();c=h.getCenter();a=b&&p!==0?r/p:1}q=GRUNT.extend({container:null,onAnimate:null,onPinchZoom:null,onScale:null,scaleDamping:false},q);var e=false,b=null,h=null,a=1,d=null,g=null,i=null,c=null,f={scalable:true,animate:function(k,l,p,r,n){function o(){n&&n();e=false;q.onScale&&q.onScale(a,c);a=1;d=null}e=true;i=SLICK.V.copy(l);c=SLICK.V.copy(p);b=null;if(r){g=a;SLICK.Animation.tweenValue(0,k-g,r,o,1E3).requestUpdates(function(s){d=
s/(k-g);a=g+s;q.onAnimate&&q.onAnimate()})}else{a=k;o()}},getScaleInfo:function(){return{factor:a,startRect:SLICK.copyRect(b),endRect:SLICK.copyRect(h),start:i,center:c,progress:d}},getScaling:function(){return e},getScaleFactor:function(){return a}},j=document.getElementById(q.container);j&&SLICK.Touch.captureTouch(j,{pinchZoomHandler:function(k,l){m(k,l);(e=a!==1)&&q.onPinchZoom&&q.onPinchZoom(k,l)},pinchZoomEndHandler:function(k,l){m(k,l);e=false;q.onScale&&q.onScale(a,c,true);a=1},wheelZoomHandler:function(k){b=
h=null;c=SLICK.V.copy(k)}});return f};
SLICK.Dispatcher=function(){var q=[],m={execute:function(e){var b=m.findAction(e);GRUNT.Log.info("looking for action id: "+e+", found: "+b);if(b){var h=[].concat(arguments).slice(0,1);GRUNT.Log.watch("EXECUTING ACTION: "+e,function(){b.execute(h)})}},findAction:function(e){for(var b=q.length;b--;)if(q[b].id==e)return q[b];return null},getRegisteredActions:function(){return[].concat(q)},getRegisteredActionIds:function(){for(var e=[],b=q.length;b--;)q[b].id&&e.push(q[b].id);return e},registerAction:function(e){e&&
e.id&&q.push(e)},Action:function(e){e=GRUNT.extend({autoRegister:true,id:"",title:"",icon:"",execute:null},e);var b={id:e.id,execute:function(){e.execute&&e.execute.apply(this,arguments)},getParam:function(h){return e[h]?e[h]:""},toString:function(){return String.format("{0} [title = {1}, icon = {2}]",b.id,e.title,e.icon)}};e.autoRegister&&m.registerAction(b);return b},createAgent:function(e){e=GRUNT.extend({name:"Untitled",trashOrphanedResults:true,translator:null,execute:null},e);var b=null,h={getName:function(){return e.name},
getParam:function(a){return e[a]},getId:function(){return GRUNT.toID(h.getName())},run:function(a,d){if(e.execute){var g=b=SLICK.Clock.getTime(true),i=e.translator?e.translator(a):a;e.execute.call(h,i,function(c,f){if(!e.trashOrphanedResults||g==b)d&&d(c,f,i)})}}};return h},runAgents:function(e,b,h){for(var a=0;a<e.length;a++)e[a].run(b,h)}};return m}();
SLICK.Messaging=function(){var q=[],m=[],e=GRUNT.newModule({id:"slick.messaging",requires:["slick.core"],STATUS:{none:0,created:1,updated:2,handled:3},send:function(b){b=GRUNT.extend({type:"",payload:{},index:0,status:e.STATUS.created,statusChange:null},b);b.index=m.push(b)-1;b=b.index;var h=b>=0&&b<m.length?m[b]:null;GRUNT.Log.info("firing message update, index = "+b+", message = "+h);for(var a=0;h&&a<q.length&&h.status!==e.STATUS.handled;){var d=q[a].processUpdate(m[b]);if(d){d=d;q[a].getId();var g=
b>=0&&b<m.length?m[b]:null;if(g){g.status=d;g.statusChange&&g.statusChange(g)}}a++}},Handler:function(b){b=GRUNT.extend({id:"",processUpdate:null},b);var h={getId:function(){return b.id},processUpdate:function(a){if(b.processUpdate)return b.processUpdate(a);return e.STATUS.none}};q.push(h);return h}});return e}();
SLICK.Animation=function(){function q(){if(b===0)b=setInterval(function(){if(h.update(SLICK.Clock.getTime())===0){clearInterval(b);b=0}},20)}var m=[],e=false,b=0,h={DURATION:2E3,tweenValue:function(a,d,g,i,c){a=new h.Tween({startValue:a,endValue:d,tweenFn:g,complete:i,duration:c});m.push(a);return a},tween:function(a,d,g,i,c,f){a=new h.Tween({target:a,property:d,endValue:g,tweenFn:i,duration:f,complete:c});m.push(a);return a},tweenVector:function(a,d,g,i,c,f){var j=[];if(a){var k=a.x==d,l=a.y==g;
k||j.push(h.tween(a,"x",d,i,function(){(k=true)&&l&&c()},f));l||j.push(h.tween(a,"y",g,i,function(){l=true;k&&l&&c()},f))}return j},cancel:function(a){if(!e){e=true;try{for(var d=0;d<m.length;)if(!a||a(m[d])){GRUNT.Log.info("CANCELLING ANIMATION");m[d].triggerComplete(true);m.splice(d,1)}else d++}finally{e=false}}},isTweening:function(){return m.length>0},update:function(a){if(e)return m.length;e=true;try{for(var d=0;d<m.length;)if(m[d].isComplete()){m[d].triggerComplete(false);m.splice(d,1);GRUNT.WaterCooler.say("animation.complete")}else{m[d].update(a);
d++}}finally{e=false}return m.length},Tween:function(a){a=GRUNT.extend({target:null,property:null,startValue:0,endValue:null,duration:h.DURATION,tweenFn:h.DEFAULT,complete:null,cancelOnInteract:false},a);var d=SLICK.Clock.getTime(),g=[],i=false,c=0,f=0,j={cancelOnInteract:a.cancelOnInteract,isComplete:function(){return i},triggerComplete:function(k){a.complete&&a.complete(k)},update:function(k){try{var l=a.tweenFn(k-d,c,f,a.duration);if(a.target)a.target[a.property]=l;for(var p=g.length;p--;)g[p](l,
void 0);if(i=d+a.duration<=k){if(a.target)a.target[a.property]=a.tweenFn(a.duration,c,f,a.duration);for(var r=g.length;r--;)g[r](l,true)}}catch(n){GRUNT.Log.exception(n)}},requestUpdates:function(k){g.push(k)}};c=a.target&&a.property&&a.target[a.property]?a.target[a.property]:a.startValue;if(typeof a.endValue!=="undefined")f=a.endValue-c;if(f==0)i=true;q();return j},Easing:function(){var a=1.70158;return{Linear:function(d,g,i,c){return i*d/c+g},Back:{In:function(d,g,i,c){return i*(d/=c)*d*((a+1)*
d-a)+g},Out:function(d,g,i,c){return i*((d=d/c-1)*d*((a+1)*d+a)+1)+g},InOut:function(d,g,i,c){return(d/=c/2)<1?i/2*d*d*(((a*=1.525)+1)*d-a)+g:i/2*((d-=2)*d*(((a*=1.525)+1)*d+a)+2)+g}},Bounce:{In:function(d,g,i,c){return i-h.Easing.Bounce.Out(c-d,0,i,c)+g},Out:function(d,g,i,c){return(d/=c)<1/2.75?i*7.5625*d*d+g:d<2/2.75?i*(7.5625*(d-=1.5/2.75)*d+0.75)+g:d<2.5/2.75?i*(7.5625*(d-=2.25/2.75)*d+0.9375)+g:i*(7.5625*(d-=2.625/2.75)*d+0.984375)+g},InOut:function(d,g,i,c){return d<c/2?h.Easing.Bounce.In(d*
2,0,i,c)*0.5+g:h.Easing.Bounce.Out(d*2-c,0,i,c)*0.5+i*0.5+g}},Cubic:{In:function(d,g,i,c){return i*(d/=c)*d*d+g},Out:function(d,g,i,c){return i*((d=d/c-1)*d*d+1)+g},InOut:function(d,g,i,c){if((d/=c/2)<1)return i/2*d*d*d+g;return i/2*((d-=2)*d*d+2)+g}},Elastic:{In:function(d,g,i,c,f,j){if(d==0)return g;if((d/=c)==1)return g+i;j||(j=c*0.3);if(!f||f<Math.abs(i)){f=i;i=j/4}else i=j/(2*Math.PI)*Math.asin(i/f);return-(f*Math.pow(2,10*(d-=1))*Math.sin((d*c-i)*2*Math.PI/j))+g},Out:function(d,g,i,c,f,j){var k;
if(d==0)return g;if((d/=c)==1)return g+i;j||(j=c*0.3);if(!f||f<Math.abs(i)){f=i;k=j/4}else k=j/(2*Math.PI)*Math.asin(i/f);return f*Math.pow(2,-10*d)*Math.sin((d*c-k)*2*Math.PI/j)+i+g},InOut:function(d,g,i,c,f,j){var k;if(d==0)return g;if((d/=c/2)==2)return g+i;j||(j=c*0.3*1.5);if(!f||f<Math.abs(i)){f=i;k=j/4}else k=j/(2*Math.PI)*Math.asin(i/f);if(d<1)return-0.5*f*Math.pow(2,10*(d-=1))*Math.sin((d*c-k)*2*Math.PI/j)+g;return f*Math.pow(2,-10*(d-=1))*Math.sin((d*c-k)*2*Math.PI/j)*0.5+i+g}},Quad:{In:function(d,
g,i,c){return i*(d/=c)*d+g},Out:function(d,g,i,c){return-i*(d/=c)*(d-2)+g},InOut:function(d,g,i,c){if((d/=c/2)<1)return i/2*d*d+g;return-i/2*(--d*(d-2)-1)+g}},Sine:{In:function(d,g,i,c){return-i*Math.cos(d/c*(Math.PI/2))+i+g},Out:function(d,g,i,c){return i*Math.sin(d/c*(Math.PI/2))+g},InOut:function(d,g,i,c){return-i/2*(Math.cos(Math.PI*d/c)-1)+g}}}}()};return GRUNT.extend(h,{DEFAULT:h.Easing.Back.Out})}();SLICK.Border={NONE:0,TOP:1,RIGHT:2,BOTTOM:3,LEFT:4};
SLICK.Graphics=function(){var q={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,PINCHZOOM:16,FREEZE:128},m=0,e={DisplayState:q,AnyDisplayState:255,ActiveDisplayStates:q.ACTIVE|q.ANIMATING,DefaultDisplayStates:q.ACTIVE|q.ANIMATING|q.PAN|q.PINCHZOOM,ViewLayer:function(b){b=GRUNT.extend({id:"",centerOnScale:true,created:(new Date).getTime(),scalePosition:true,zindex:0,supportFastDraw:false,validStates:e.DefaultDisplayStates},b);var h=null,a=GRUNT.extend({isAnimating:function(){return false},addToView:function(d){d.setLayer(b.id,
a)},shouldDraw:function(d){var g=h?h.fastDraw&&d!==q.ACTIVE:false;return(d&b.validStates)!==0&&(g?b.supportFastDraw:true)},cycle:function(){return 0},draw:function(){},notify:function(){},remove:function(){GRUNT.WaterCooler.say("layer.remove",{id:b.id})},wakeParent:function(){GRUNT.WaterCooler.say("view.wake",{id:h?h.id:null})},getParent:function(){return h},setParent:function(d){h=d}},b);return a},StatusViewLayer:function(){return new e.ViewLayer({validStates:e.AnyDisplayState,zindex:5E3,draw:function(b,
h,a,d,g){b.fillStyle="#FF0000";b.fillRect(10,10,50,50);b.fillStyle="#FFFFFF";b.font="bold 10px sans";b.fillText(g.getDisplayState(),20,20)}})},AnimatedPathLayer:function(b){function h(f,j,k){f.fillStyle="#FFFFFF";f.strokeStyle="#222222";f.beginPath();f.arc(k.x,k.y,4,0,Math.PI*2,false);f.stroke();f.fill()}b=GRUNT.extend({path:[],id:GRUNT.generateObjectID("pathAnimation"),easing:SLICK.Animation.Easing.Sine.InOut,canCache:false,validStates:e.ActiveDisplayStates|q.PAN|q.PINCHZOOM,drawIndicator:null,duration:2E3,
autoCenter:false},b);var a=SLICK.VectorMath.edges(b.path),d,g=null,i=0;SLICK.Animation.tweenValue(0,a.total,b.easing,function(){c.remove()},b.duration).requestUpdates(function(f,j){i=f;j&&c.remove()});var c=GRUNT.extend(new e.ViewLayer(b),{cycle:function(){for(var f=0;f<a.accrued.length&&a.accrued[f]<i;)f++;g=null;if(f<b.path.length-1){var j=i-(f>0?a.accrued[f-1]:0),k=b.path[f],l=b.path[f+1];d=SLICK.VectorMath.theta(k,l,a.edges[f]);g=SLICK.VectorMath.pointOnEdge(k,l,d,j);if(b.autoCenter)(f=c.getParent())&&
f.centerOn(g)}return g?1:0},draw:function(f,j){if(g)(b.drawIndicator?b.drawIndicator:h)(f,j,new SLICK.Vector(g.x-j.x,g.y-j.y),d)}});return c},FPSLayer:function(b){b=GRUNT.extend({zindex:1E3,scalePosition:false},b);var h=null,a=GRUNT.extend(new e.ViewLayer(b),{delays:[],draw:function(d,g,i){d.font="bold 8pt Arial";d.textAlign="right";d.fillStyle="rgba(0, 0, 0, 0.8)";d.fillText((h?h:"?")+" fps",i.width-20,20)}});setInterval(function(){for(var d=0,g=a.delays.length,i=g;i--;)d+=a.delays[i];if(g!==0)h=
Math.floor(1E3/(d/g))},1E3);return a},ResourceStatsLayer:function(b){b=GRUNT.extend({zindex:500,indicatorSize:5,scalePosition:false,validStates:q.ACTIVE|q.PAN},b);return GRUNT.extend(new e.ViewLayer(b),{fps:null,draw:function(h){var a=SLICK.Resources.getStats(),d=b.indicatorSize,g=10,i;if(a.imageCacheFullness){h.strokeStyle="rgba(0, 0, 255, 1)";h.beginPath();h.arc(15,15,5,0,Math.PI*2*a.imageCacheFullness,false);h.stroke();g=30}if(a.imageLoadingCount>=0){h.fillStyle="rgba(0, 255, 0, 0.7)";for(i=a.imageLoadingCount;i--;)h.fillRect(g+
i*(d+2),10,d,d)}if(a.queuedImageCount>=0){h.fillStyle="rgba(255, 0, 0, 0.7)";for(i=a.queuedImageCount;i--;)h.fillRect(g+i*(d+2),10+d+2,d,d)}}})},LoadingLayer:function(b){GRUNT.extend({},b)},View:function(b){function h(v,w){w.id=v;w.setParent(H);c.push(w);c.sort(function(I,K){var L=K.zindex-I.zindex;if(L===0)L=K.created-I.created;return L})}function a(){GRUNT.WaterCooler.say("view-idle",{id:H.id});F=true;t=0}function d(v,w){var I=0,K=H.getScaleFactor(),L=H.getDisplayState(),T=(new Date).getTime(),
R=(L&q.PINCHZOOM)!==0;p=H.getScaleFactor();var Q=0;if(l||R){v.clearRect(0,0,f.width,f.height);l=false}if(R){var N=G.getScaleInfo();H.getDimensions().getCenter();var O=(N.progress?N.progress:1)*0.5;D=N.center;if(N.startRect){O=N.startRect.getCenter();O=SLICK.V.diff(O,D);y=new SLICK.Vector(D.x+O.x,D.y+O.y)}else{N=SLICK.V.diff(N.start,D);y=new SLICK.Vector(D.x-N.x*O,D.y-N.y*O)}if(y)w=SLICK.V.offset(w,y.x,y.y)}v.save();try{if(s!==1)v.scale(s,s);else if(R){v.translate(D.x,D.y);v.scale(K,K)}for(Q=c.length;Q--;)if(c[Q].shouldDraw(L)){var S=
c[Q].draw(v,w,A,L,H);I+=S?S:0}}finally{v.restore()}GRUNT.Log.trace("draw complete",T);return I}function g(){var v=0,w=J===q.PINCHZOOM||J===q.PAN;B=(new Date).getTime();k=E?E.getOffset():new SLICK.Vector;z&&r&&z.delays.push(B-r);if(w){SLICK.Animation.cancel(function(K){return K.cancelOnInteract});F=false;if(t!==0){clearTimeout(t);t=0}}for(w=c.length;w--;){var I=c[w].cycle(B,k);v+=I?I:0}v+=d(j,k);r=B;M=0;if(C+v>0)i();else if(!F&&t===0)t=setTimeout(a,500);GRUNT.Log.trace("Completed draw cycle",B)}function i(){C++;
if(!(o||M!==0)){C=0;M=setTimeout(g,0)}}b=GRUNT.extend({id:"view_"+m++,container:"",pannable:false,scalable:false,clearOnDraw:false,displayFPS:false,displayResourceStats:false,scaleDamping:false,fastDraw:false,fillStyle:"rgb(200, 200, 200)",initialDrawMode:"source-over",bufferRefresh:100,defaultFreezeDelay:500,onPan:null,onPinchZoom:null,onScale:null,onDraw:null,autoSize:false},b);var c=[],f=document.getElementById(b.container),j=null,k=new SLICK.Vector,l=false,p=1,r=null,n=0,o=false,s=1,u=new SLICK.Vector,
A=null,x=null,C=0,z=null,D=null,E=null,G=null,F=false,M=0,t=0,y=null,B=0,J=e.DisplayState.ACTIVE;GRUNT.Log.info("Creating a new view instance, attached to container: "+b.container+", canvas = ",f);if(f){SLICK.Touch.resetTouch(f);if(b.autoSize){GRUNT.Log.info("autosizing view: window.height = "+window.innerHeight+", width = "+window.innerWidth);f.height=window.innerHeight-f.offsetTop-49;f.width=window.innerWidth-f.offsetLeft}try{j=f.getContext("2d");j.globalCompositeOperation=b.initialDrawMode;j.clearRect(0,
0,f.width,f.height)}catch(P){GRUNT.Log.exception(P);throw Error("Could not initialise canvas on specified view element");}}if(b.pannable)E=new SLICK.Pannable({container:b.container,onAnimate:function(){i()},onPan:function(v,w){n=SLICK.Clock.getTime(true);i();u=SLICK.V.offset(u,v,w);b.onPan&&b.onPan(v,w);J=q.PAN},onPanEnd:function(){i();J=q.ACTIVE}});if(b.scalable)G=new SLICK.Scalable({scaleDamping:b.scaleDamping,container:b.container,onAnimate:function(){J=e.DisplayState.PINCHZOOM;i()},onPinchZoom:function(v,
w){n=SLICK.Clock.getTime(true);i();b.onPinchZoom&&b.onPinchZoom(v,w);J=e.DisplayState.PINCHZOOM},onScale:function(v,w){GRUNT.WaterCooler.say("view.scale",{id:H.id});J=e.DisplayState.ACTIVE;i();b.onScale&&b.onScale(v,w)}});var H=GRUNT.extend({},b,E,G,{id:b.id,deviceScaling:s,fastDraw:b.fastDraw||SLICK.Device.getConfig().requireFastDraw,centerOn:function(v){E.setOffset(v.x-f.width*0.5,v.y-f.height*0.5)},getDimensions:function(){if(f)return new SLICK.Dimensions(f.width,f.height)},getZoomCenter:function(){return y},
getLayer:function(v){for(var w=0;w<c.length;w++)if(c[w].id==v)return c[w];return null},setLayer:function(v,w){for(var I=0;I<c.length;I++)if(c[I].id===v){c.splice(I,1);break}w&&h(v,w);GRUNT.WaterCooler.say("layer.update",{value:w});i()},eachLayer:function(v){for(var w=0;w<c.length;w++)v(c[w])},clearBackground:function(){l=true},freeze:function(){o=true},unfreeze:function(){o=false;i()},snapshot:function(){},getDisplayState:function(){return o?q.FROZEN:J},scale:function(v,w,I,K,L){K||(K=H.getDimensions().getCenter());
L||(L=H.getDimensions().getCenter());G&&G.animate(v,K,L,w,I);return G},removeLayer:function(v){a:{for(var w=c.length;w--;)if(c[w].id==v){v=w;break a}v=-1}if(v>=0&&v<c.length){GRUNT.WaterCooler.say("layer.removed",{layer:c[v]});c.splice(v,1)}}});A=H.getDimensions();x=A.getCenter();GRUNT.WaterCooler.listen("layer.remove",function(v){v.id&&H.removeLayer(v.id)});GRUNT.WaterCooler.listen("view.wake",function(v){if(!v.id||v.id===H.id)i()});s=SLICK.Device.getConfig().getScaling();if(b.displayFPS){z=new e.FPSLayer;
H.setLayer("fps",z)}b.displayResourceStats&&H.setLayer("resourceStats",new e.ResourceStatsLayer);i();return H}};return e}();
SLICK.Tiling=function(){function q(){if(!e){e=document.createElement("canvas");e.width=h.Config.TILESIZE;e.height=h.Config.TILESIZE;var a=e.getContext("2d");a.fillStyle="rgba(150, 150, 150, 0.05)";a.fillRect(0,0,e.width,e.height)}return e}function m(){if(!b){b=document.createElement("canvas");b.width=h.Config.TILESIZE;b.height=h.Config.TILESIZE;var a=b.getContext("2d"),d=Math.sqrt(h.Config.TILESIZE);a.fillStyle="rgba(200, 200, 200, 1)";a.strokeStyle="rgb(190, 190, 190)";a.lineWidth=0.5;a.fillRect(0,
0,b.width,b.height);a.beginPath();for(var g=0;g<b.width;g+=d){a.moveTo(g,0);a.lineTo(g,b.height);for(var i=0;i<b.height;i+=d){a.moveTo(0,i);a.lineTo(b.width,i)}}a.stroke()}return b}TileStore=function(a){a=GRUNT.extend({gridSize:20,center:new SLICK.Vector,onPopulate:null},a);var d=Array(Math.pow(a.gridSize,2)),g=SLICK.V.offset(a.center,-Math.ceil(a.gridSize>>1)),i=null,c=new SLICK.Vector,f=null,j={getGridSize:function(){return a.gridSize},getNormalizedPos:function(k,l){return SLICK.V.add(new SLICK.Vector(k,
l),SLICK.V.invert(g),c)},getTileShift:function(){return SLICK.V.copy(c)},getTile:function(k,l){return k>=0&&k<a.gridSize?d[l*a.gridSize+k]:null},setTile:function(k,l,p){d[l*a.gridSize+k]=p},populate:function(k,l){var p=GRUNT.Log.getTraceTicks(),r=0;new SLICK.Vector(a.gridSize*0.5,a.gridSize*0.5);if(k)for(var n=0;n<a.gridSize;n++)for(var o=0;o<a.gridSize;o++){if(!d[r]){var s=k(o,n,g,a.gridSize);d[r]=s}r++}i=k;f=l;GRUNT.Log.trace("tile grid populated",p);a.onPopulate&&a.onPopulate()},getShiftDelta:function(k,
l,p,r){var n=Math.floor(a.gridSize*0.2),o=new SLICK.Vector;if(k<0||k+p>a.gridSize)o.x=k<0?-n:n;if(l<0||l+r>a.gridSize)o.y=l<0?-n:n;return o},shift:function(k,l){if(!(k.x===0&&k.y===0)){var p=GRUNT.Log.getTraceTicks(),r=Array(d.length);r.length=d.length;for(var n=0;n<a.gridSize;n++)for(var o=0;o<a.gridSize;o++)r[o*a.gridSize+n]=j.getTile(n+k.x,o+k.y);d=r;g=l?l(g,k):SLICK.V.add(g,k);c.x+=-k.x*a.tileSize;c.y+=-k.y*a.tileSize;GRUNT.Log.trace("tile storage shifted",p);j.populate(i,f)}},setOrigin:function(k,
l){if(tileOrigin)shiftOrigin(k,l);else g=SLICK.V.offset(new SLICK.Vector(k,l),-tileHalfWidth)}};GRUNT.WaterCooler.listen("imagecache.cleared",function(){for(var k=d.length;k--;)if(d[k])d[k].loaded=false});return j};var e=null,b=null,h={Config:{TILESIZE:256,TILEBUFFER:1,TILEBUFFER_LOADNEW:0.2},Tile:function(a){return a=GRUNT.extend({x:0,y:0,size:256},a)},ImageTile:function(a){a=GRUNT.extend({url:"",sessionParamRegex:null,loaded:false},a);return new h.Tile(a)},TileGrid:function(a){function d(o,s,u,
A){if((f?SLICK.V.absSize(SLICK.V.diff(f,s)):i)>=20){o=g.getTileShift();o=new SLICK.Vector(Math.floor((s.x+o.x)*c),Math.floor((s.y+o.y)*c));var x=Math.ceil(u.width*c)+1;u=Math.ceil(u.height*c)+1;var C=new SLICK.Vector((x-1)*0.5,(u-1)*0.5),z=new SLICK.Vector(o.x*a.tileSize,o.y*a.tileSize);A.isAnimating();l=[];tilesNeeded=false;for(var D=u;D--;)for(var E=D*a.tileSize+z.y,G=x;G--;){A=g.getTile(G+o.x,D+o.y);var F=G*a.tileSize+z.x,M=new SLICK.Vector(G-C.x,D-C.y);A||(p=g.getShiftDelta(o.x,o.y,x,u));l.push({tile:A,
coordinates:new SLICK.Vector(F,E),centerness:SLICK.V.absSize(M)})}l.sort(function(t,y){return y.centerness-t.centerness});f=SLICK.V.copy(s)}}a=GRUNT.extend({tileSize:SLICK.Tiling.Config.TILESIZE,drawGrid:false,center:new SLICK.Vector,shiftOrigin:null,supportFastDraw:true,checkChange:100},a);var g=new TileStore(GRUNT.extend({onPopulate:function(){j=true;n.wakeParent()}},a)),i=Math.round(a.tileSize>>1),c=a.tileSize?1/a.tileSize:0,f=null,j=false,k=true,l=[];new SLICK.Vector;var p=new SLICK.Vector,r=
g.getGridSize()*a.tileSize,n=GRUNT.extend(new SLICK.Graphics.ViewLayer(a),{gridDimensions:new SLICK.Dimensions(r,r),cycle:function(){var o=0;if(p.x+p.y!==0){g.shift(p,a.shiftOrigin);p=new SLICK.Vector;o++}return o+j?1:0},deactivate:function(){k=false},drawTile:function(){},draw:function(o,s,u,A,x){if(k){var C=GRUNT.Log.getTraceTicks(),z=g.getTileShift(),D=s.x+z.x;z=s.y+z.y;if(A!==SLICK.Graphics.DisplayState.PINCHZOOM){d(o,s,u,x);GRUNT.Log.trace("updated draw queue",C)}if(a.drawGrid)o.strokeStyle=
"rgba(50, 50, 50, 0.3)";o.beginPath();for(s=l.length;s--;){u=l[s].tile;x=l[s].coordinates.x-D;var E=l[s].coordinates.y-z;if(u){n.drawTile(o,u,x,E,A);u.x=x;u.y=E}a.drawGrid&&o.rect(x,E,a.tileSize,a.tileSize)}o.stroke();GRUNT.Log.trace("drawn tiles",C);j=false}},getTileSize:function(){return a.tileSize},getTileVirtualXY:function(o,s,u){o=g.getNormalizedPos(o,s);o=new SLICK.Vector(o.x*a.tileSize,o.y*a.tileSize);if(u){o.x+=i;o.y+=i}return o},getCenterXY:function(){var o=Math.ceil(g.getGridSize()>>1);
return n.getTileVirtualXY(o,o,true)},populate:function(o){g.populate(o,function(){})}});GRUNT.WaterCooler.listen("tile.loaded",function(){j=true;n.wakeParent()});return n},ImageTileGrid:function(a){function d(){GRUNT.WaterCooler.say("tile.loaded")}a=GRUNT.extend({},a);return GRUNT.extend(new h.TileGrid(a),{drawTile:function(g,i,c,f,j){var k=SLICK.Resources.getImage(i.url);j===SLICK.Graphics.DisplayState.PAN&&g.drawImage(m(),c,f);if(k&&k.complete&&k.width>0)g.drawImage(k,c,f);else{g.drawImage(q(),
c,f);k||SLICK.Resources.loadImage(i.url,d)}}})},Tiler:function(a){a=GRUNT.extend({container:"",drawCenter:false,onPan:null,onPanEnd:null,tapHandler:null,doubleTapHandler:null,zoomHandler:null,onDraw:null,datasources:{},tileLoadThreshold:"first"},a);var d=new SLICK.Graphics.View(GRUNT.extend({},a,{pannable:true,scalable:true,scaleDamping:true}));SLICK.Touch.captureTouch(document.getElementById(a.container),a);GRUNT.extend(d,{getTileLayer:function(){return d.getLayer("grid0")},setTileLayer:function(g){d.setLayer("grid0",
g);GRUNT.WaterCooler.say("grid.updated",{grid:g})},gridPixToViewPix:function(g){var i=d.getOffset();return new SLICK.Vector(g.x-i.x,g.y-i.y)},viewPixToGridPix:function(g){var i=d.getOffset();return new SLICK.Vector(g.x+i.x,g.y+i.y)},cleanup:function(){d.removeLayer("grid0")}});return d}};return h}();
SLICK.Geo=function(){function q(c,f){var j=null;for(var k in g)if(f){if(k==f&&g[k][c]){j=g[k];break}}else if(g[k][c]){j=g[k];break}return j}function m(c,f,j,k){var l=0;c=c.toUpperCase();for(var p in k){var r=f[p];if(r){var n=j[p];r=n?n(c,r):c.containsWord(r)?1:0;l+=r*k[p]}}return l}var e=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],b=/(\d+)\s?\-\s?(\d+)/,h=/^(\d+).*$/,a=null,d={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",
HWY:"HIGHWAY",MWY:"MOTORWAY"},g={},i={Engine:function(c){if(!c.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var f=GRUNT.extend({remove:function(){delete g[f.id]}},c);return g[f.id]=f},getEngine:function(c){for(var f=null,j=1;!f&&j<arguments.length;j++)f=q(c,arguments[j]);f=f?f:q(c);if(!f)throw Error("Unable to find GEO engine with "+c+" capability");return f},Radius:function(c,f){return{distance:parseInt(c,10),uom:f}},Position:function(c,f){return{lat:parseFloat(c?
c:0),lon:parseFloat(f?f:0)}},BoundingBox:function(c,f){var j={min:i.P.parse(c),max:i.P.parse(f),expand:function(k){j.min.lat-=k;j.min.lon-=i.Utilities.normalizeLon(k);j.max.lat+=k;j.max.lon+=i.Utilities.normalizeLon(k)},getDistance:function(){return i.P.calcDistance(j.min,j.max)},getCenter:function(){var k=i.calculateBoundsSize(j.min,j.max);return new SLICK.Geo.Position(j.min.lat+k.y*0.5,j.min.lon+k.x*0.5)},transform:function(k){var l=new SLICK.Geo.BoundingBox(j.min,j.max);GRUNT.Log.info("applying "+
k.length+" transformers");for(var p=0;k&&p<k.length;p++)k[p].apply(l);return l}};return j},Transforms:function(){return{Shrink:function(){return function(){}},Offset:function(){return function(){}}}}(),Address:function(c){c=GRUNT.extend({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},c);return GRUNT.extend(c,{getPos:function(){return c.pos},toString:function(){return c.streetDetails+" "+c.location}})},GeocodeFieldWeights:{streetDetails:50,location:50},AddressCompareFns:{},
Utilities:function(){var c={lat2pix:function(f,j){var k=parseFloat(f)*2*Math.PI/360;k=Math.sin(k);var l=0.08181919084262157*k;return Math.log((1+k)/(1-k)*Math.pow((1-l)/(1+l),0.08181919084262157))/2/j},lon2pix:function(f,j){return parseFloat(f)/180*Math.PI/j},pix2lon:function(f,j){return c.normalizeLon(f*j*180/Math.PI)},pix2lat:function(f,j){for(var k=Math.pow(Math.E,-f*j),l=c.mercatorUnproject(k),p=c.findRadPhi(l,k),r=0;r<12&&Math.abs(l-p)>1.0E-7;){l=p;p=c.findRadPhi(l,k);r++}return p*180/Math.PI},
mercatorUnproject:function(f){return Math.PI/2-2*Math.atan(f)},findRadPhi:function(f,j){var k=0.08181919084262157*Math.sin(f);return Math.PI/2-2*Math.atan(j*Math.pow((1-k)/(1+k),0.040909595421310785))},normalizeLon:function(f){for(;f<-180;)f+=360;for(;f>180;)f-=360;return f}};return c}(),GeoSearchResult:function(c){c=GRUNT.extend({id:null,caption:"",resultType:"",data:null,pos:null,matchWeight:0},c);return GRUNT.extend(c,{toString:function(){return c.caption+(c.matchWeight?" ("+c.matchWeight+")":
"")}})},GeoSearchAgent:function(c){c=GRUNT.extend({},c);return GRUNT.extend({},SLICK.Dispatcher.createAgent(c))},GeocodingAgent:function(c){c=GRUNT.extend({name:"Geocoding Search Agent",paramTranslator:null,execute:function(f,j){try{if(!f.reverse&&!f.freeform)address=new i.Address(f);var k=i.getEngine("geocode");if(k)k.geocode({addresses:[f.freeform?f.freeform:address],complete:function(p,r){if(j){var n=r;if(f.freeform)n=i.rankGeocodeResponses(f.freeform,n,i.getEngine("geocode"));j(n,c)}}})}catch(l){GRUNT.Log.exception(l)}}},
c);return new i.GeoSearchAgent(c)},PointOfInterest:function(c){c=GRUNT.extend({id:0,title:"",pos:null,lat:"",lon:"",group:"",retrieved:0,isNew:true},c);if(!c.pos&&c.lat&&c.lon)c.pos=new SLICK.Geo.Position(c.lat,c.lon);return GRUNT.extend({toString:function(){return c.id+": '"+c.title+"'"}},c)},POIStorage:function(c){function f(n){n=n?n:"default";l[n]||(l[n]=[]);return l[n]}function j(n){var o=[];for(var s in l)for(var u=0;u<l[s].length;u++)if(!n||n(l[s][u]))o.push(l[s][u]);return o}function k(){GRUNT.WaterCooler.say("geo.pois-updated",
{srcID:r.id,pois:r.getPOIs()})}c=GRUNT.extend({visibilityChange:null,onPOIDeleted:null,onPOIAdded:null},c);var l={},p=true,r={id:GRUNT.generateObjectID(),getPOIs:function(){return j()},getOldPOIs:function(n,o){return j(function(s){return s.group==n&&s.retrieved<o})},getVisible:function(){return p},setVisible:function(n){if(n!=p){p=n;c.visibilityChange&&c.visibilityChange()}},findById:function(n){var o=j(function(s){return s.id==n});return o.length>0?o[0]:null},findByBounds:function(n){return j(function(o){return SLICK.Geo.posInBounds(o.pos,
n)})},addPOIs:function(n,o){if(o)l={};for(var s=0;n&&s<n.length;s++){n[s].retrieved=SLICK.Clock.getTime(true);var u=n[s];f(u.group).push(u)}},removeGroup:function(n){if(l[n]){delete l[n];k()}},update:function(n){var o=[],s=0,u=n.length>0?n[0].group:"",A=SLICK.Clock.getTime(true);for(s=0;s<n.length;s++){var x;a:{if(x=n[s])for(var C=f(x.group),z=0;z<C.length;z++)if(C[z].id==x.id){x=C[z];break a}x=null}if(x){x.retrieved=A;x.isNew=false}else o.push(n[s])}n=r.getOldPOIs(u,A);r.addPOIs(o);for(s=0;c.onPOIAdded&&
s<o.length;s++)c.onPOIAdded(o[s]);for(s=0;s<n.length;s++){c.onPOIDeleted&&c.onPOIDeleted(n[s]);u=n[s];A=f(u.group);for(x=0;x<A.length;x++)if(A[x].id==u.id){A.splice(x,1);break}}o.length+n.length>0&&k()}};return r},MapProvider:function(){return{zoomLevel:0,checkZoomLevel:function(c){return c},getCopyright:function(){},getMapTiles:function(){},getPositionForXY:function(){return null}}},P:function(){var c={calcDistance:function(f,j){if(c.empty(f)||c.empty(j))return 0;var k=(j.lat-f.lat).toRad()*0.5,
l=(j.lon-f.lon).toRad()*0.5;k=Math.sin(k)*Math.sin(k)+Math.cos(f.lat.toRad())*Math.cos(j.lat.toRad())*Math.sin(l)*Math.sin(l);return 6371*2*Math.atan2(Math.sqrt(k),Math.sqrt(1-k))},copy:function(f){return f?new i.Position(f.lat,f.lon):null},empty:function(f){return!f||f.lat===0&&f.lon===0},equal:function(f,j){return f&&j&&f.lat==j.lat&&f.lon==j.lon},almostEqual:function(f,j){return f&&j&&Math.floor(f.lat*1E3)===Math.floor(j.lat*1E3)&&Math.floor(f.lon*1E3)===Math.floor(j.lon*1E3)},inArray:function(f,
j){for(var k=i.P.equal,l=j.length;l--;)if(k(f,j[l]))return true;return false},parse:function(f){if(f)if(typeof f.lat!=="undefined")return c.copy(f);else{if(f.split)for(var j=[" ",","],k=0;k<j.length;k++){var l=f.split(j[k]);if(l.length===2)return new i.Position(l[0],l[1])}}else return new i.Position;return null},parseArray:function(f){var j=f.length,k=Array(j);for(j=j;j--;)k[j]=c.parse(f[j]);GRUNT.Log.info("parsed "+k.length+" positions");return k},fromMercatorPixels:function(f,j,k){return new i.Position(SLICK.Geo.Utilities.pix2lat(j,
k),SLICK.Geo.Utilities.normalizeLon(SLICK.Geo.Utilities.pix2lon(f,k)))},toMercatorPixels:function(f,j){return new SLICK.Vector(SLICK.Geo.Utilities.lon2pix(f.lon,j),SLICK.Geo.Utilities.lat2pix(f.lat,j))},toString:function(f){return f?f.lat+" "+f.lon:""}};return c}(),generalizePositions:function(c,f,j){var k=c.length,l=[],p=null;j||(j=250);j/=1E3;GRUNT.Log.info("generalizing positions, must include "+f.length+" positions");for(var r=k;r--;)if(r===0)l.unshift(c[r]);else{var n=!p||i.P.inArray(c[r],f)?
j:i.P.calcDistance(p,c[r]);if(c[r]&&n>=j){l.unshift(c[r]);p=c[r]}}GRUNT.Log.info("generalized "+k+" positions into "+l.length+" positions");return l},emptyBounds:function(c){return!c||i.P.empty(c.min)||i.P.empty(c.max)},posInBounds:function(c,f){var j=!(i.P.empty(c)||i.P.empty(f));return j=(j=j&&c.lat>=f.min.lat&&c.lat<=f.max.lat)&&c.lon>=f.min.lon&&c.lon<=f.max.lon},calculateBoundsSize:function(c,f,j){var k=new SLICK.Vector(0,f.lat-c.lat);if(typeof j==="undefined")j=true;k.x=j&&c.lon>f.lon?360-c.lon+
f.lon:f.lon-c.lon;return k},getBoundingBoxZoomLevel:function(c,f){var j=c.getCenter();j=e[Math.min(Math.round(Math.abs(j.lat)*0.05),e.length)];var k=i.calculateBoundsSize(c.min,c.max);return Math.min(Math.ceil(Math.log(e[3]*f.height/k.y)/Math.log(2)),Math.ceil(Math.log(j*f.width/k.x)/Math.log(2)))},getBoundsForPositions:function(c,f){var j=null,k=SLICK.Clock.getTime();f||(f="auto");for(var l=c.length;l--;)if(j){var p=i.calculateBoundsSize(j.min,c[l],false),r=i.calculateBoundsSize(c[l],j.max,false);
if(p.x<0)j.min.lon=c[l].lon;if(p.y<0)j.min.lat=c[l].lat;if(r.x<0)j.max.lon=c[l].lon;if(r.y<0)j.max.lat=c[l].lat}else j=new SLICK.Geo.BoundingBox(c[l],c[l]);if(f){if(f=="auto"){l=i.calculateBoundsSize(j.min,j.max);f=Math.max(l.x,l.y)*0.3}j.expand(f)}GRUNT.Log.trace("calculated bounds for "+c.length+" positions",k);return j},normalizeAddress:function(c){if(!c)return"";c=c.toUpperCase();if(!a){var f=[];for(var j in d)f.push(j);a=RegExp("(\\s)("+f.join("|")+")(\\s|$)","i")}a.lastIndex=-1;if(f=a.exec(c))c=
c.replace(a,"$1"+d[f[2]]);return c},buildingMatch:function(c,f){h.lastIndex=-1;if(h.test(c))for(var j=c.replace(h,"$1"),k=f.split(","),l=0;l<k.length;l++){b.lastIndex=-1;if(b.test(k[l])){var p=b.exec(k[l]);if(j>=parseInt(p[1],10)&&j<=parseInt(p[2],10))return true}else if(j==k[l])return true}return false},rankGeocodeResponses:function(c,f,j){var k=[],l=i.AddressCompareFns;if(j&&j.compareFns)l=GRUNT.extend({},l,j.compareFns);for(j=0;j<f.length;j++)k.push(new i.GeoSearchResult({caption:f[j].toString(),
data:f[j],pos:f[j].pos,matchWeight:m(c,f[j],l,i.GeocodeFieldWeights)}));k.sort(function(p,r){return r.matchWeight-p.matchWeight});return k}};return i}();
SLICK.Geo.Location=function(){function q(b){function h(f){try{var j=new SLICK.Geo.Position(f.coords.latitude,f.coords.longitude),k=GRUNT.isPlainObject(f.coords.accuracy)&&f.coords.accuracy.horizontal?f.coords.accuracy.horizontal:f.coords.accuracy;GRUNT.Log.info("got position coordinates: "+j+", accuracy = "+k);if(b.successCallback&&(!i||k<c))b.successCallback(j,g,f);if(k>b.highAccuracyCutoff&&g<2){g=2;b.enableHighAccuracy=true;GRUNT.Log.info("Position not at required accuracy, trying again with high accuracy");
d()}i=f;c=k}catch(l){GRUNT.Log.exception(l)}}function a(f){if(f.code===f.PERMISSION_DENIED)b.errorCallback&&b.errorCallback(f);else if(f.code===f.POSITION_UNAVAILABLE)b.errorCallback&&b.errorCallback(f);else if(f.code===f.TIMEOUT){GRUNT.Log.info("had a timeout on cached position, moving to phase 1");if(b.timeout===0&&b.autoPhasing){g=1;b.timeout=m;b.enableHighAccuracy=false;d()}}}function d(){navigator.geolocation.getCurrentPosition(h,a,b)}b=GRUNT.extend({autoPhasing:true,maximumAge:3E5,timeout:0,
highAccuracyCutoff:10,enableHighAccuracy:true,successCallback:null,errorCallback:null},b);var g=0,i=null,c=1E6;d()}var m=3E3,e={get:function(){throw Error("No geolocation APIs supported.");}};if(navigator.geolocation)e.get=q;return e}();SLICK.Geo.Search=function(){return{bestResults:function(q,m){m||(m=20);for(var e=q.length>0?q[0]:null,b=[],h=0;h<q.length;h++)if(e.matchWeight-q[h].matchWeight<=m)b.push(q[h]);else break;return b}}}();
SLICK.Mapping=function(){var q=0,m={AnnotationTween:null,GeoTileGrid:function(e){e=GRUNT.extend({grid:null,centerPos:new SLICK.Geo.Position,centerXY:new SLICK.Vector,radsPerPixel:0},e);var b=SLICK.Geo.P.toMercatorPixels(e.centerPos,e.radsPerPixel),h=b.x-e.centerXY.x,a=b.y-e.centerXY.y,d=GRUNT.extend({},e.grid,{getBoundingBox:function(g,i,c,f){return new SLICK.Geo.BoundingBox(d.pixelsToPos(new SLICK.Vector(g,i+f)),d.pixelsToPos(new SLICK.Vector(g+c,i)))},getCenterOffset:function(){return e.centerXY},
getGridXYForPosition:function(g){g=SLICK.Geo.P.toMercatorPixels(g,e.radsPerPixel);return new SLICK.Vector(g.x-h,d.gridDimensions.height-(g.y-a))},getGuideOffset:function(g){var i=d.getTileSize();return new SLICK.Vector(g.x%i,g.y%i)},pixelsToPos:function(g){return SLICK.Geo.P.fromMercatorPixels(h+g.x,a+d.gridDimensions.height-g.y,e.radsPerPixel)}});return d},POIViewLayer:function(e){GRUNT.extend({},e)},Overlay:function(e){GRUNT.extend({},e);return{}},RadarOverlay:function(e){e=GRUNT.extend({radarFill:"rgba(0, 221, 238, 0.1)",
radarStroke:"rgba(0, 102, 136, 0.3)",zindex:100},e);return GRUNT.extend(new SLICK.Graphics.ViewLayer(e),{draw:function(b,h,a){h=a.width>>1;a=a.height>>1;b.fillStyle=e.radarFill;b.strokeStyle=e.radarStroke;b.beginPath();b.arc(h,a,50,0,Math.PI*2,false);b.fill();b.stroke()}})},CrosshairOverlay:function(e){e=GRUNT.extend({lineWidth:1.5,strokeStyle:"rgba(0, 0, 0, 0.5)",size:15,zindex:150,scalePosition:false,validStates:SLICK.Graphics.DisplayState.ACTIVE|SLICK.Graphics.DisplayState.ANIMATING|SLICK.Graphics.DisplayState.PAN},
e);return GRUNT.extend(new SLICK.Graphics.ViewLayer(e),{draw:function(b,h,a){h=a.getCenter();b.lineWidth=e.lineWidth;b.strokeStyle=e.strokeStyle;a=e.size;b.beginPath();b.moveTo(h.x,h.y-a);b.lineTo(h.x,h.y+a);b.moveTo(h.x-a,h.y);b.lineTo(h.x+a,h.y);b.arc(h.x,h.y,a*0.6666,0,2*Math.PI,false);b.stroke()}})},RouteOverlay:function(e){e=GRUNT.extend({strokeStyle:"rgba(0, 51, 119, 0.9)",waypointFillStyle:"#FFFFFF",lineWidth:4,data:null,pixelGeneralization:8,calculationsPerCycle:250,partialDraw:false,zindex:50},
e);var b=true,h=null,a=[],d=0,g=[],i=[],c=GRUNT.extend(new SLICK.Graphics.ViewLayer(e),{getAnimation:function(f,j,k,l){if(b)return null;var p="routeAnimation"+q++;i.push(p);return new SLICK.Graphics.AnimatedPathLayer({id:p,path:a,zindex:e.zindex+1,easing:f?f:SLICK.Animation.Easing.Sine.InOut,duration:j?j:5E3,drawIndicator:k,autoCenter:l?l:false})},draw:function(f,j,k,l,p){k=0;l=e.data?e.data.geometry:null;if(b){b=false;h=null;a=[];d=0}if(l&&d<l.length){a:{p=p.getTileLayer();g=[];l=GRUNT.Log.getTraceTicks();
var r,n,o,s=e.data?e.data.geometry:[],u=s.length,A=e.data?e.data.instructions:[],x=A.length,C=e.calculationsPerCycle,z=0;for(r=d;r<u;r++){n=p.getGridXYForPosition(s[r]);if(o=!h||r===0||Math.abs(n.x-h.x)+Math.abs(n.y-h.y)>e.pixelGeneralization){a.push(n);h=n}z++;if(z>=C){d=r;break a}}d=u;GRUNT.Log.trace(u+" geometry points generalized to "+a.length+" coordinates",l);h=null;for(r=x;r--;)if(A[r].position){n=p.getGridXYForPosition(A[r].position);if(o=!h||r===0||Math.abs(n.x-h.x)+Math.abs(n.y-h.y)>e.pixelGeneralization){g.push(n);
h=n}}}k++}p=a.length;if(p>0&&(!k||e.partialDraw)){f.strokeStyle=e.strokeStyle;f.lineWidth=e.lineWidth;f.beginPath();f.moveTo(a[p-1].x-j.x,a[p-1].y-j.y);for(p=p;p--;)f.lineTo(a[p].x-j.x,a[p].y-j.y);f.stroke();f.fillStyle=e.waypointFillStyle;for(p=g.length;p--;){f.beginPath();f.arc(g[p].x-j.x,g[p].y-j.y,2,0,Math.PI*2,false);f.stroke();f.fill()}}return k}});GRUNT.WaterCooler.listen("grid.updated",function(){for(var f=i.length;f--;)GRUNT.WaterCooler.say("layer.remove",{id:i[f]});i=[];b=true;c.wakeParent()});
return c},Annotation:function(e){e=GRUNT.extend({xy:null,pos:null,draw:null,tweenIn:m.AnnotationTween},e);var b=false,h={xy:e.xy,pos:e.pos,isNew:false,isAnimating:function(){return b},draw:function(a,d,g,i){if(h.xy){if(h.isNew&&e.tweenIn){var c=h.xy.y;h.xy.y=d.y-20;b=true;SLICK.Animation.tween(h.xy,"y",c,e.tweenIn,function(){h.xy.y=c;b=false},250+Math.random()*500)}if(e.draw)e.draw(a,d,new SLICK.Vector(h.xy.x-d.x,h.xy.y-d.y),g,i);else{a.beginPath();a.arc(h.xy.x-d.x,h.xy.y-d.y,4,0,Math.PI*2,false);
a.fill()}h.isNew=false}}};return h},ImageAnnotation:function(e){e=GRUNT.extend({imageUrl:null},e);var b=null;e.draw=function(h,a,d,g,i){if(a=SLICK.Resources.getImage(e.imageUrl)){if(a.complete){b||(b=new SLICK.Vector(-a.width>>1,-a.height>>1));d=SLICK.V.offset(d,b.x,b.y);h.drawImage(a,d.x,d.y,a.width,a.height)}}else SLICK.Resources.loadImage(e.imageUrl,function(){i.wakeParent()})};return new m.Annotation(e)},AnnotationsOverlay:function(e){function b(i){for(var c=e.map?e.map.getTileLayer():null,f=
0;c&&f<i.length;f++)i[f].xy=c.getGridXYForPosition(i[f].pos)}e=GRUNT.extend({pois:null,map:null,createAnnotationForPOI:null,zindex:100},e);var h=[],a=false,d=[],g=GRUNT.extend(new SLICK.Graphics.ViewLayer(e),{draw:function(i,c,f,j){i.save();try{var k;a=false;i.fillStyle="rgba(255, 0, 0, 0.75)";i.globalCompositeOperation="source-over";for(k=h.length;k--;){h[k].draw(i,c,j,g);a=a||h[k].isAnimating()}for(k=d.length;k--;){d[k].draw(i,c,j,g);a=a||h[k].isAnimating()}a&&g.wakeParent()}finally{i.restore()}},
add:function(i){d.push(i);b(d)},isAnimating:function(){return a}});GRUNT.WaterCooler.listen("geo.pois-updated",function(i){if(e.pois&&e.pois.id==i.srcID){i=i.pois;try{h=[];for(var c=0;c<i.length;c++)if(i[c].pos){var f;var j=i[c];if(j&&j.pos){var k=null;if(k=e.createAnnotationForPOI?e.createAnnotationForPOI(j):new m.Annotation({pos:j.pos})){k.isNew=j.isNew;j.isNew=false}f=k}else f=void 0;f&&h.push(f)}b(h)}catch(l){GRUNT.Log.exception(l)}g.wakeParent()}});GRUNT.WaterCooler.listen("grid.updated",function(){b(h);
b(d)});return g},Tiler:function(e){e=GRUNT.extend({tapExtent:10,provider:null,crosshair:true,copyright:undefined,zoomLevel:0,boundsChange:null,tapPOI:null,boundsChangeThreshold:30,pois:new SLICK.Geo.POIStorage,createAnnotationForPOI:null},e);if(typeof e.copyright==="undefined")e.copyright=e.provider?e.provider.getCopyright():"";var b=new SLICK.Vector,h=e.copyright,a=false,d=[],g=0,i=null,c=e.zoomLevel;if(!e.provider)e.provider=new SLICK.Geo.MapProvider;var f=e.panHandler,j=e.tapHandler;e.onPan=function(p,
r){f&&f(p,r)};e.tapHandler=function(p,r){var n=l.getTileLayer(),o=null;if(n){o=l.viewPixToGridPix(new SLICK.Vector(r.x,r.y));var s=n.pixelsToPos(SLICK.V.offset(o,-e.tapExtent,e.tapExtent)),u=n.pixelsToPos(SLICK.V.offset(o,e.tapExtent,-e.tapExtent));GRUNT.Log.info("grid tapped @ "+SLICK.Geo.P.toString(n.pixelsToPos(o)));o=new SLICK.Geo.BoundingBox(s,u);d=l.pois.findByBounds(o);e.tapPOI&&e.tapPOI(d)}j&&j(p,r,o)};e.doubleTapHandler=function(p,r){l.animate(2,l.getDimensions().getCenter(),new SLICK.Vector(r.x,
r.y),SLICK.Animation.Easing.Sine.Out)};e.onScale=function(p,r){var n=0;p=Math.sqrt(p);if(p<1)n=-(0.5/p);else if(p>1)n=p;l.gotoPosition(l.getXYPosition(r),c+Math.floor(n))};var k=new SLICK.Tiling.Tiler(e),l=GRUNT.extend({},k,{pois:e.pois,getBoundingBox:function(){var p=new SLICK.Geo.BoundingBox,r=l.getTileLayer(),n=l.getOffset(),o=l.getDimensions();if(r)p=r.getBoundingBox(n.x,n.y,o.width,o.height);return p},getCenterPosition:function(){return l.getXYPosition(l.gridDimensions.getCenter())},getXYPosition:function(p){return l.getTileLayer().pixelsToPos(l.viewPixToGridPix(p))},
gotoBounds:function(p,r){var n=SLICK.Geo.getBoundingBoxZoomLevel(p,l.getDimensions());l.gotoPosition(p.getCenter(),n,r)},gotoCurrentPosition:function(p){SLICK.Geo.Location.get({successCallback:function(r){l.clearBackground();l.gotoPosition(r,15,p)},errorCallback:function(){}})},gotoPosition:function(p,r,n){var o=c,s=(new Date).getTime();c=r?r:c;if(!c)throw"Zoom level required to goto a position.";if(e.provider)c=e.provider.checkZoomLevel(c);if(!a||c!==o){SLICK.Resources.resetImageLoadQueue();(r=l.getTileLayer())&&
r.deactivate();SLICK.Animation.cancel();a&&l.freeze();g=s;e.provider.zoomLevel=c;e.provider.getMapTiles(l,p,function(u){if(s===g){l.setTileLayer(u);l.panToPosition(p,function(){l.unfreeze();n&&n()})}else GRUNT.Log.info("request time mismatch - ignoring update")});a=true}else l.panToPosition(p,n)},panToPosition:function(p,r,n){var o=l.getTileLayer();if(o){p=o.getGridXYForPosition(p);o=l.getDimensions();p.x-=o.width>>1;p.y-=o.height>>1;if(i)i=null;l.updateOffset(p.x,p.y,n);GRUNT.WaterCooler.say("view.wake",
{id:l.id});e.boundsChange&&e.boundsChange(l.getBoundingBox());r&&r(l)}},setZoomLevel:function(p){l.gotoPosition(l.getCenterPosition(),p)},zoomIn:function(){l.scale(2,SLICK.Animation.Easing.Sine.Out)||l.setZoomLevel(c+1)},zoomOut:function(){l.scale(0.5,SLICK.Animation.Easing.Sine.Out)||l.setZoomLevel(c-1)},animateRoute:function(p,r,n,o){var s=l.getLayer("route");if(s)(p=s.getAnimation(p,r,n,o))&&p.addToView(l)}},k);k=new SLICK.Mapping.AnnotationsOverlay({pois:l.pois,map:l,createAnnotationForPOI:e.createAnnotationForPOI});
l.setLayer("annotations",k);e.crosshair&&l.setLayer("crosshair",new SLICK.Mapping.CrosshairOverlay);h&&l.setLayer("copyright",new SLICK.Graphics.ViewLayer({zindex:999,draw:function(p,r,n){p.lineWidth=2.5;p.fillStyle="rgb(50, 50, 50)";p.strokeStyle="rgba(255, 255, 255, 0.8)";p.font="bold 10px sans";p.textBaseline="bottom";p.strokeText(h,10,n.height-10);p.fillText(h,10,n.height-10)}}));GRUNT.WaterCooler.listen("view-idle",function(p){if(p.id&&p.id==l.id)if(SLICK.V.absSize(SLICK.V.diff(b,l.getOffset()))>
e.boundsChangeThreshold&&e.boundsChange){b=l.getOffset();e.boundsChange(l.getBoundingBox())}});return l}};return m}();
SLICK.Geo.Routing=function(){var q={calculate:function(m){m=GRUNT.extend({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:true},m);GRUNT.Log.info("attempting to calculate route");var e=SLICK.Geo.getEngine("route");e&&e.route(m,function(b){if(m.generalize)b.geometry=SLICK.Geo.generalizePositions(b.geometry,b.getInstructionPositions());if(m.map){q.createMapOverlay(m.map,b);if(m.autoFit){GRUNT.Log.info("AUTOFITTING MAP TO ROUTE: bounds = "+b.boundingBox);m.map.gotoBounds(b.boundingBox)}}m.success&&
m.success(b)})},createMapOverlay:function(m,e){var b=m.getDimensions();b=new SLICK.Mapping.RouteOverlay({data:e,width:b.width,height:b.height});m.setLayer("route",b)},Maneuver:{None:0,Continue:1,TurnLeft:100,TurnLeftSlight:101,TurnLeftSharp:102,TurnRight:110,TurnRightSlight:111,TurnRightSharp:112,TurnAround:190,EnterRoundabout:200,ExitRamp:300},Instruction:function(m){m=GRUNT.extend({position:null,description:"",manuever:q.Maneuver.None},m);return GRUNT.extend(m,{})},RouteData:function(m){m=GRUNT.extend({geometry:[],
instructions:[],boundingBox:null},m);if(!m.boundingBox)m.boundingBox=SLICK.Geo.getBoundsForPositions(m.geometry);return GRUNT.extend({getInstructionPositions:function(){for(var e=[],b=0;b<m.instructions.length;b++)m.instructions[b].position&&e.push(m.instructions[b].position);return e}},m)}};return q}();
