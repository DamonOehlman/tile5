if(!this.JSON)this.JSON={};
(function(){function p(a){return a<10?"0"+a:a}function g(a){l.lastIndex=0;return l.test(a)?'"'+a.replace(l,function(f){var h=c[f];return typeof h==="string"?h:"\\u"+("0000"+f.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function m(a,f){var h,j,k,n,o=b,q,r=f[a];if(r&&typeof r==="object"&&typeof r.toJSON==="function")r=r.toJSON(a);if(typeof i==="function")r=i.call(f,a,r);switch(typeof r){case "string":return g(r);case "number":return isFinite(r)?String(r):"null";case "boolean":case "null":return String(r);
case "object":if(!r)return"null";b+=d;q=[];if(Object.prototype.toString.apply(r)==="[object Array]"){n=r.length;for(h=0;h<n;h+=1)q[h]=m(h,r)||"null";k=q.length===0?"[]":b?"[\n"+b+q.join(",\n"+b)+"\n"+o+"]":"["+q.join(",")+"]";b=o;return k}if(i&&typeof i==="object"){n=i.length;for(h=0;h<n;h+=1){j=i[h];if(typeof j==="string")if(k=m(j,r))q.push(g(j)+(b?": ":":")+k)}}else for(j in r)if(Object.hasOwnProperty.call(r,j))if(k=m(j,r))q.push(g(j)+(b?": ":":")+k);k=q.length===0?"{}":b?"{\n"+b+q.join(",\n"+b)+
"\n"+o+"}":"{"+q.join(",")+"}";b=o;return k}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+p(this.getUTCMonth()+1)+"-"+p(this.getUTCDate())+"T"+p(this.getUTCHours())+":"+p(this.getUTCMinutes())+":"+p(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
l=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,b,d,c={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},i;if(typeof JSON.stringify!=="function")JSON.stringify=function(a,f,h){var j;d=b="";if(typeof h==="number")for(j=0;j<h;j+=1)d+=" ";else if(typeof h==="string")d=h;if((i=f)&&typeof f!=="function"&&(typeof f!=="object"||typeof f.length!=="number"))throw Error("JSON.stringify");return m("",
{"":a})};if(typeof JSON.parse!=="function")JSON.parse=function(a,f){function h(k,n){var o,q,r=k[n];if(r&&typeof r==="object")for(o in r)if(Object.hasOwnProperty.call(r,o)){q=h(r,o);if(q!==undefined)r[o]=q;else delete r[o]}return f.call(k,n,r)}var j;a=String(a);e.lastIndex=0;if(e.test(a))a=a.replace(e,function(k){return"\\u"+("0000"+k.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+a+")");return typeof f==="function"?h({"":j},""):j}throw new SyntaxError("JSON.parse");}})();if(!String.format)String.format=function(p){if(arguments.length<=1)return p;for(var g=arguments.length-2,m=0;m<=g;m++)p=p.replace(RegExp("\\{"+m+"\\}","gi"),arguments[m+1]);return p};
String.prototype.containsWord=function(p){var g="";if(p.toString)p=p.toString();for(var m=0;m<p.length;m++)g+=!/\w/.test(p[m])?"\\"+p[m]:p[m];return RegExp("(^|\\s|\\,)"+g+"(\\,|\\s|$)","i").test(this)};Number.prototype.toRad=function(){return this*Math.PI/180};Number.prototype.sec=function(){return 1/Math.cos(this)};
GRUNT=function(){var p=Object.prototype.hasOwnProperty,g=0,m={id:"GRUNT.core",extend:function(){var e=arguments[0]||{},l=1,b=arguments.length,d=false,c,i,a,f;if(typeof e==="boolean"){d=e;e=arguments[1]||{};l=2}if(typeof e!=="object"&&!m.isFunction(e))e={};if(b===l){e=this;--l}for(;l<b;l++)if((c=arguments[l])!=null)for(i in c){a=e[i];f=c[i];if(e!==f)if(d&&f&&(m.isPlainObject(f)||m.isArray(f))){a=a&&(m.isPlainObject(a)||m.isArray(a))?a:m.isArray(f)?[]:{};e[i]=m.extend(d,a,f)}else if(f!==undefined)e[i]=
f}return e},isFunction:function(e){return toString.call(e)==="[object Function]"},isArray:function(e){return toString.call(e)==="[object Array]"},isPlainObject:function(e){if(!e||toString.call(e)!=="[object Object]"||e.nodeType||e.setInterval)return false;if(e.constructor&&!p.call(e,"constructor")&&!p.call(e.constructor.prototype,"isPrototypeOf"))return false;var l;for(l in e);return l===undefined||p.call(e,l)},isEmptyObject:function(e){for(var l in e)return false;return true},isXmlDocument:function(e){return toString.call(e)===
"[object Document]"},contains:function(e,l){var b=e,d=arguments,c=1;if(l&&m.isArray(l)){d=l;c=0}for(c=c;c<d;c++)b=b&&typeof foo[d[c]]!=="undefined";return b},newModule:function(e){e=m.extend({id:null,requires:[],parent:null},e);if(e.parent)e=m.extend({},e.parent,e);return e},toID:function(e){return e.replace(/\s/g,"-")},generateObjectID:function(e){return(e?e:"obj")+g++}};return m}();
GRUNT.Log=function(){function p(b,d){var c,i=d&&d.length>0?d[0]:"";for(c=1;d&&c<d.length;c++)i+=" "+(m&&GRUNT.isPlainObject(d[c])?JSON.stringify(d[c]):d[c]);typeof console!=="undefined"&&console[b](i);for(c=0;c<g.length;c++)g[c].call(l,i,b)}var g=[],m=typeof JSON!=="undefined",e=window.console&&window.console.markTimeline,l={id:"GRUNT.log",getTraceTicks:function(){return e?(new Date).getTime():null},trace:function(b,d){if(e)console.markTimeline(b+(d?": "+(l.getTraceTicks()-d)+"ms":""))},debug:function(){p("debug",
arguments)},info:function(){p("info",arguments)},warn:function(){p("warn",arguments)},error:function(){p("error",arguments)},exception:function(b){l.error(arguments);for(var d in b)l.info("ERROR DETAIL: "+d+": "+b[d])},watch:function(b,d){try{d()}catch(c){l.exception(c,b)}},throwError:function(b){l.error(b);throw Error(b);},requestUpdates:function(b){g.push(b)}};return l}();
GRUNT.Data=function(){var p={determineObjectMapping:function(m){if(!m)return null;m=m.split("|");for(var e={},l=0;l<m.length;l++)e[m[l]]=l;return e},mapLineToObject:function(m,e){var l=m.split("|"),b={};for(var d in e){var c=e[d];b[d]=l.length>c?l[c]:null}return b},parse:function(m){var e=null,l=[];m=m.split("\n");for(var b=0;b<m.length;b++){var d=m[b];if(e)l.push(p.mapLineToObject(d,e));else e=p.determineObjectMapping(d)}return l}},g={supportedFormats:{JSON:{parse:function(m){return JSON.parse(m)}},
PDON:{parse:function(m){return p.parse(m)}}},parse:function(m){m=GRUNT.extend({data:"",format:"JSON"},m);if(!g.supportedFormats[m.format])throw Error("Unsupported data format: "+m.format+", cannot parse data in javascript object");try{return g.supportedFormats[m.format].parse(m.data)}catch(e){GRUNT.Log.error("ERROR PARSING DATA FROM FORMAT: "+m.format,m.data);GRUNT.Log.exception(e)}return{}}};return g}();
GRUNT.Template=function(){var p=/\$\{(.*?)\}/ig;return{parse:function(g,m){for(var e=g,l=p.exec(e);l;){e=e.replace(l[0],GRUNT.XPath.first(l[1],m));p.lastIndex=0;l=p.exec(e)}return e}}}();
GRUNT.JSONP=function(){function p(l){var b=document.createElement("script"),d=false;b.src=l;b.async=true;b.onload=b.onreadystatechange=function(){if(!d&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){d=true;b.onload=b.onreadystatechange=null;b&&b.parentNode&&b.parentNode.removeChild(b)}};m||(m=document.getElementsByTagName("head")[0]);m.appendChild(b)}var g=0,m,e=this;return{get:function(l,b){l+=l.indexOf("?")>=0?"&":"?";var d="json"+ ++g;e[d]=function(c){b(c);e[d]=
null;try{delete e[d]}catch(i){}};p(l+"callback="+d);return d}}}();
GRUNT.XHR=function(){var p={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},g={JSON:["json"],PDON:["pdon.txt"]},m=["TEXT","STREAM"],e=/^(\w+:)?\/\/([^\/?#]+)/,l={XML:function(c){return c.responseXML},JSON:function(c){try{return JSON.parse(c.responseText)}catch(i){GRUNT.Log.error("Error parsing JSON data: ",c.responseText);GRUNT.Log.exception(i)}return""},PDON:function(c){return GRUNT.Data.parse({data:c.responseText,format:"PDON"})},DEFAULT:function(c){return c.responseText}},
b={CONTENT_TYPE:"Content-Type"},d=GRUNT.newModule({id:"GRUNT.xhr",ajaxSettings:{xhr:null},ajax:function(c){try{c=GRUNT.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},d.ajaxSettings,c);var i=e.exec(c.url),a=i&&(i[1]&&i[1]!==location.protocol||i[2]!==location.host);if(c.data)c.method="POST";if(c.url){i=null;if(c.xhr)i=c.xhr(c);i||(i=new XMLHttpRequest);i.open(c.method,c.url,c.async);c.data&&i.setRequestHeader("Content-Type",
c.contentType);a||i.setRequestHeader("X-Requested-With","XMLHttpRequest");i.onreadystatechange=function(){if(this.readyState===4){var h=null,j=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(j)if(c.handleResponse)c.handleResponse(this);else{var k=c,n=this.getResponseHeader(b.CONTENT_TYPE),o,q=false;for(o in p)if(n&&n.indexOf(p[o])>=0){q=true;break}n=!q;for(q=0;q<m.length;q++)n=n||m[q]==o;if(n)b:{n=o;for(var r in g)for(q=
0;q<g[r].length;q++)if(RegExp(g[r][q]+"$","i").test(k.url)){o=r;break b}o=n?n:"DEFAULT"}try{h=l[o](this,k)}catch(t){GRUNT.Log.warn("error applying processor '"+o+"' to response type, falling back to default");h=l.DEFAULT(this,k)}}else c.error&&c.error(this)}catch(A){GRUNT.Log.exception(A,"PROCESSING AJAX RESPONSE")}j&&h&&c.success&&c.success.call(this,h)}};i.send(c.method=="POST"?d.param(c.data):null)}else GRUNT.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(f){GRUNT.Log.exception(f)}},
param:function(c){var i=[],a=function(h,j){j=GRUNT.isFunction(j)?j():j;i[i.length]=encodeURIComponent(h)+"="+encodeURIComponent(j)};if(GRUNT.isArray(c))for(var f=0;f<c.length;f++)a(c[f].name,c[f].value);else for(f in c)a(f,c[f]);return i.join("&").replace(/%20/g,"+")}});return d}();
GRUNT.XPath=function(){function p(l){for(var b=null,d=0;d<g.length;d++)if(b=g[d](l))break;return b}var g=[],m=[null,function(l){return l.numberValue},function(l){return l.stringValue},function(l){return l.booleanValue},null,null,null,null,function(l){return l.singleNodeValue?l.singleNodeValue.textContent:null},function(l){return l.singleNodeValue?l.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||GRUNT.Log.warn("No XPATH support, this is going to cause problems");var e={SearchResult:function(l){return{toString:function(){var b=
null;if(l){var d=null;if(l.resultType>=0&&l.resultType<m.length)d=m[l.resultType];if(d){GRUNT.Log.info("invoking match handler for result type: "+l.resultType);b=d(l)}}return b?b:""}}},first:function(l,b){var d=e.SearchResult,c;var i=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!i)i=XPathResult.ANY_TYPE;try{if(GRUNT.isXmlDocument(b))c=b.evaluate(l,b,p,i,null);else{GRUNT.Log.warn("attempted xpath expression: "+l+" on a non-xml document");c=null}}catch(a){GRUNT.Log.warn("attempted to run invalid xpath expression: "+
l+" on node: "+b);c=null}return new d(c)},registerResolver:function(l){g.push(l)}};return e}();GRUNT.WaterCooler=function(){var p={};return{listen:function(g,m){p[g]||(p[g]=[]);m&&p[g].push(m)},say:function(g,m){if(p[g])for(var e=0;e<p[g].length;e++)p[g][e](m)},leave:function(){}}}();
SLICK=function(){function p(){g={base:{name:"Unknown",eventTarget:document,supportsTouch:"createTouch"in document,imageCacheMaxSize:null,getScaling:function(){return 1}},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144},android:{name:"Android OS <= 2.1",regex:/android/i,eventTarget:document.body,supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio}},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,
supportsTouch:true}};m=[g.iphone,g.froyo,g.android,g.ipad]}var g=null,m=[],e=null,l={getDeviceConfig:function(){g||p();if(!e){GRUNT.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var b=0;b<m.length;b++){var d=m[b];if(d.regex&&d.regex.test(navigator.userAgent)){e=GRUNT.extend({},g.base,d);GRUNT.Log.info("PLATFORM DETECTED AS: "+e.name);break}}if(!e){GRUNT.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");e=g.base}GRUNT.Log.info("CURRENT DEVICE PIXEL RATIO = "+
window.devicePixelRatio)}return e},Settings:function(){var b={};return{get:function(d){return b[d]},set:function(d,c){b[d]=c},extend:function(d){GRUNT.extend(b,d)}}}(),Clock:function(){var b=null;return{getTime:function(d){return d&&b?b:b=(new Date).getTime()}}}(),Vector:function(b,d){b||(b=0);d||(d=0);var c={x:b,y:d,add:function(i){c.x+=i.x;c.y+=i.y;return c},diff:function(i){return new SLICK.Vector(c.x-i.x,c.y-i.y)},copy:function(i){c.x=i.x;c.y=i.y},empty:function(){c.x=0;c.y=0},duplicate:function(){return new SLICK.Vector(c.x,
c.y)},getAbsSize:function(){return Math.max(Math.abs(c.x),Math.abs(c.y))},offset:function(i,a){return new SLICK.Vector(c.x+i,c.y+a)},invert:function(){return new SLICK.Vector(-c.x,-c.y)},matches:function(i){return i&&c.x==i.x&&c.y==i.y},toString:function(){return c.x+", "+c.y}};return c},VectorArray:function(b,d){for(var c=Array(b.length),i=b.length;i--;)c[i]=d?b[i].duplicate():b[i];return{applyOffset:function(a){for(var f=c.length;f--;)c[f].add(a)},getRect:function(){return new SLICK.Rect(Math.min(c[0].x,
c[1].x),Math.min(c[0].y,c[1].y),Math.abs(c[0].x-c[1].x),Math.abs(c[0].y-c[1].y))},toString:function(){for(var a="",f=c.length;f--;)a+="["+c[f].toString()+"] ";return a}}},VectorMath:function(){function b(d){if(!d||d.length<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var c={edges:Array(d.length-1),accrued:Array(d.length-1),total:0},i=0;i<d.length-1;i++){var a=d[i].diff(d[i+1]);c.edges[i]=Math.sqrt(a.x*a.x+a.y*a.y);c.accrued[i]=c.total+c.edges[i];c.total+=
c.edges[i]}return c}return{edges:b,distance:function(d){return b(d).total},theta:function(d,c,i){i=Math.asin((d.y-c.y)/i);return d.x>c.x?i:Math.PI-i},pointOnEdge:function(d,c,i,a){c=new SLICK.Vector(Math.cos(i)*a,Math.sin(i)*a);return new SLICK.Vector(d.x-c.x,d.y-c.y)}}}(),Dimensions:function(b,d){var c=d?b/d:1,i={width:b,height:d,aspect_ratio:c,inv_aspect_ratio:1/c,duplicate:function(){return new SLICK.Dimensions(i.width,i.height)},getAspectRatio:function(){return i.height!==0?i.width/i.height:1},
getCenter:function(){return new SLICK.Vector(i.width>>1,i.height>>1)},grow:function(a,f){return new SLICK.Dimensions(i.width+a,i.height+f)},matches:function(a){return a&&i.width==a.width&&i.height==a.height},toString:function(){return i.width+" x "+i.height}};return i},Rect:function(b,d,c,i){var a={origin:new SLICK.Vector(b,d),dimensions:new SLICK.Dimensions(c,i),duplicate:function(){return new SLICK.Rect(a.origin.x,a.origin.y,a.dimensions.width,a.dimensions.height)},getCenter:function(){return new SLICK.Vector(a.origin.x+
(a.dimensions.width>>1),a.origin.y+(a.dimensions.height>>1))},getSize:function(){return Math.sqrt(Math.pow(a.dimensions.width,2)+Math.pow(a.dimensions.height,2))},grow:function(f,h){var j=new SLICK.Dimensions(f-a.dimensions.width,h-a.dimensions.height);a.dimensions.width=f;a.dimensions.height=h;return j},expand:function(f,h){a.origin.x-=f;a.origin.y-=h;a.dimensions.width+=f;a.dimensions.height+=h},offset:function(f){return new l.Rect(a.origin.x+f.x,a.origin.y+f.y,a.dimensions.width,a.dimensions.height)},
getRequiredDelta:function(f,h){var j={top:0,left:0,bottom:0,right:0};j.top=f.origin.y-a.origin.y+(h?h.y:0);j.left=f.origin.x-a.origin.x+(h?h.x:0);j.right=f.origin.x+f.dimensions.width-(a.origin.x+a.dimensions.width)-j.left;j.bottom=f.origin.y+f.dimensions.height-(a.origin.y+a.dimensions.height)-j.top;return j},applyDelta:function(f,h,j){if(!f||!GRUNT.contains(f,["top","left","bottom","right"]))throw Error("Invalid delta - cannot apply to SLICK.Rect");h||(h=1);a.origin.x+=f.left*h;a.origin.y+=f.top*
h;a.dimensions.width+=f.right*h;a.dimensions.height+=f.bottom*h;j&&a.constrainAspectRatio(j)},constrainAspectRatio:function(f){var h=0,j={top:0,left:0,bottom:0,right:0};if(a.dimensions.getAspectRatio()<f){h=Math.abs(a.dimensions.width-a.dimensions.height*f);j.left=-h;j.right=h}else{h=Math.abs(a.dimensions.height-a.dimensions.width/f);j.top=-h;j.bottom=h}a.applyDelta(j)},moveTo:function(f,h){var j=new SLICK.Vector(f-a.origin.x,h-a.origin.y);a.origin.x=f;a.origin.y=h;return j},toString:function(){return String.format("(origin: {0}, dimensions: {1})",
a.origin,a.dimensions)}};return a}};return l}();
SLICK.Resources=function(){function p(){b.sort(function(j,k){var n=j.hitCount-k.hitCount;if(n===0)n=j.created-k.created;return n});d={};b.splice(0,Math.floor(b.length*0.5));for(var h=b.length;h--;)d[b[h].url]=h}function g(h){var j=null,k=SLICK.getDeviceConfig();if(d[h]===undefined){j=new f.ImageResource({url:h});d[h]=b.push(j)-1}else{var n=d[h];if(n<b.length)j=b[n]}if(k&&k.imageCacheMaxSize){a=b.length*f.avgImageSize/k.imageCacheMaxSize;a>=1&&p()}j||GRUNT.Log.warn("could not return image for: "+h);
return j}function m(){if(i.length>0){var h=i.shift();h.queued=false;h.load()}}var e="",l={},b=[],d={},c=0,i=[],a=0,f={maxImageLoads:8,avgImageSize:25,loadTimeout:30,Cache:function(){return{read:function(){return null},write:function(){},getUrlCacheKey:function(h,j){for(var k=(h?h.replace(/^.*\?/,""):"").split("&"),n=h?h.replace(/\?.*$/,"?"):"",o=0;o<k.length;o++){var q=k[o].split("=");if(!j||!j.test(q[0]))n+=k[o]+"&"}return n.replace(/\W/g,"")},isValidCacheKey:function(h){GRUNT.Log.info("cache key = "+
h);return false}}}(),getCachedUrl:function(h){return h},getPath:function(h){return/^(https?|\/)/.test(h)?h:e+h},setBasePath:function(h){e=h},getImage:function(h,j){var k=g(f.getPath(h));if(k){k.hitCount++;if(k.loaded&&k.get())j&&j(k.get(),true);else{k.load();k.loadListeners.push(j)}}},resetImageLoadListeners:function(h){if(h=g(f.getPath(h)))h.loadListeners=[]},resetImageLoadQueue:function(){for(var h=i.length;h--;)i[h].reset();i=[];c=0},getStats:function(){return{imageLoadingCount:c,queuedImageCount:i.length,
imageCacheFullness:a}},loadResource:function(h){h=GRUNT.extend({filename:"",cacheable:true,dataType:null,callback:null},h);var j=function(k){h.callback&&GRUNT.Log.watch("CALLING RESOURCE CALLBACK",function(){h.callback(k)})};h.cacheable&&l[h.filename]?j(l[h.filename]):GRUNT.XHR.ajax({url:f.getPath(h.filename),dataType:h.dataType,success:function(k){if(h.cacheable)l[h.filename]=k;j(k)},error:function(k,n,o){GRUNT.Log.error("error loading resource ["+h.filename+"], error = "+o)}})},loadSnippet:function(h,
j){/\.\w+$/.test(h)||(h+=".html");f.loadResource({filename:"snippets/"+h,callback:j,dataType:"html"})},ImageResource:function(h){function j(){if(!o.loaded){GRUNT.Log.warn("timed out loading image: "+k.src);k.src=null;c=Math.min(c-1,0);m()}}h=GRUNT.extend({url:""},h);var k=new Image,n=0,o={loaded:false,queued:false,loadListeners:[],created:(new Date).getTime(),hitCount:0,url:h.url,get:function(){return k},load:function(){if(h.url&&k&&k.src!=h.url)if(!f.maxImageLoads||c<f.maxImageLoads){c++;k.src=h.url;
n=setTimeout(j,f.loadTimeout*1E3)}else if(!o.queued){i.push(o);o.queued=true}},reset:function(){k.src=null;k.onload=null;n!==0&&clearTimeout(n)}};k.onload=function(){o.loaded=true;c=Math.min(c-1,0);clearTimeout(n);for(var q=0;q<o.loadListeners.length;q++)o.loadListeners[q]&&o.loadListeners[q](k);m()};return o}};return f}();
SLICK.Touch=function(){function p(b,d){var c=b.length>0?b[0]:null;if(c&&d.length>0)return c.diff(d[0]);return null}function g(b){b.preventDefault();b.stopPropagation()}var m=0,e={TouchHelper:function(b){function d(u){u=new SLICK.VectorArray(u,true);b.element&&u.applyOffset(new SLICK.Vector(-b.element.offsetLeft,-b.element.offsetTop));return u}b=GRUNT.extend({element:null,inertiaTrigger:20,maxDistDoubleTap:20,panEventThreshhold:0,pinchZoomThreshold:5,touchStartHandler:null,moveHandler:null,moveEndHandler:null,
pinchZoomHandler:null,pinchZoomEndHandler:null,tapHandler:null,doubleTapHandler:null,wheelZoomHandler:null},b);var c={GLOBAL:"touches",TARGET:"targetTouches",CHANGED:"changedTouches"},i=[c.GLOBAL,c.TARGET],a={TAP:0,MOVE:1,PINCHZOOM:2},f=false,h=0,j=null,k=null,n=null,o=null,q=new SLICK.Vector,r=null,t=false,A=[],B={current:0,last:0},x={supportsTouch:SLICK.getDeviceConfig().supportsTouch,THRESHOLD_DOUBLETAP:300,addListeners:function(u){A.push(u)},fireEvent:function(u){var v=[],z=0;for(z=1;z<arguments.length;z++)v.push(arguments[z]);
for(z=0;z<A.length;z++)A[z][u]&&A[z][u].apply(x,v)},firePositionEvent:function(u,v){var z=null;if(b.element)z=v.offset(-b.element.offsetLeft,-b.element.offsetTop);x.fireEvent(u,v,z)},getTouchPoints:function(u,v){function z(V,P){for(var I=u[P],F=0;I&&F<I.length;F++)V.push(new SLICK.Vector(I[F].pageX,I[F].pageY))}v||(v=i);for(var D=[],N=0;N<v.length;N++){z(D,v[N]);if(D.length>0)break}D.length===0&&D.push(new SLICK.Vector(u.pageX,u.pageY));return D},start:function(u){try{j=x.getTouchPoints(u);n=new SLICK.Vector;
o=new SLICK.Vector;t=true;f=false;g(u);B.current=SLICK.Clock.getTime();var v=j.length>0?j[0]:null;if(v){x.fireEvent("touchStartHandler",v.x,v.y);if(B.current-B.last<x.THRESHOLD_DOUBLETAP){var z=k?j[0].diff(k[0]):null;if(z&&Math.abs(z.x)<b.maxDistDoubleTap&&Math.abs(z.y)<b.maxDistDoubleTap)f=true}r=a.TAP;k=[].concat(j)}else GRUNT.Log.warn("Touch start fired, but no touch vector found")}catch(D){GRUNT.Log.exception(D)}},move:function(u){if(t)try{g(u);var v=x.getTouchPoints(u);u=0;if(v.length>1){if(j.length===
1)j=[].concat(v);u=SLICK.VectorMath.distance(j)-SLICK.VectorMath.distance(k)}if(r===a.TAP){var z=p(v,j);if(z&&(Math.abs(z.x)>=7||Math.abs(z.y)>=7))r=a.MOVE}if(r!==a.TAP)if(!u||Math.abs(u)<b.pinchZoomThreshold){n=p(v,k);o.add(n);q.add(n);if(q.getAbsSize()>b.panEventThreshhold){x.fireEvent("moveHandler",q.x,q.y);q.empty()}r=a.MOVE}else{x.fireEvent("pinchZoomHandler",d(j),d(v));r=a.PINCHZOOM}k=[].concat(v)}catch(D){GRUNT.Log.exception(D)}},end:function(u){try{g(u);SLICK.Clock.getTime();B.last=B.current;
if(r===a.TAP)h||(h=setTimeout(function(){h=0;x.firePositionEvent(f?"doubleTapHandler":"tapHandler",j[0])},x.THRESHOLD_DOUBLETAP+50));else if(r==a.MOVE)x.fireEvent("moveEndHandler",o.x,o.y);else r==a.PINCHZOOM&&x.fireEvent("pinchZoomEndHandler",d(j),d(k));t=false}catch(v){GRUNT.Log.exception(v)}},wheelie:function(u){var v=new SLICK.Vector(u.wheelDeltaX,u.wheelDeltaY);u=new SLICK.Vector(u.clientX,u.clientY);var z=v.y!==0?Math.abs(v.y/120):0;if(z!==0)x.fireEvent("wheelZoomHandler",u,v.y>0?z+0.5:0.5/
z);GRUNT.Log.info("capture mouse wheel event, delta = "+v+", position = "+u)}};return x}},l=[];return{captureTouch:function(b,d){try{if(!b)throw Error("Unable to capture touch of null element");if(!b.id)b.id="touchable_"+m++;var c=l[b.id];if(!c){var i=SLICK.getDeviceConfig().eventTarget;c=e.TouchHelper(GRUNT.extend({element:b},d));l[b.id]=c;GRUNT.Log.info("CREATED TOUCH HELPER. SUPPORTS TOUCH = "+c.supportsTouch);i.addEventListener(c.supportsTouch?"touchstart":"mousedown",function(f){f.target&&f.target===
b&&c.start(f)},false);i.addEventListener(c.supportsTouch?"touchmove":"mousemove",function(f){f.target&&f.target===b&&c.move(f)},false);i.addEventListener(c.supportsTouch?"touchend":"mouseup",function(f){f.target&&f.target===b&&c.end(f)},false);i.addEventListener("mousewheel",function(f){c.wheelie(f)},false)}c.addListeners(d)}catch(a){GRUNT.Log.exception(a)}}}}();
if(typeof jQuery!=="undefined"){jQuery.fn.canTouchThis=function(p){return this.each(function(){SLICK.Touch.captureTouch(this,p)})};jQuery.fn.untouchable=function(){return this.bind("touchmove",function(p){p.preventDefault()})}}
SLICK.Pannable=function(p){p=GRUNT.extend({container:null,onPan:null,onPanEnd:null,onAnimate:null,checkOffset:null},p);var g=false,m=new SLICK.Vector,e={pannable:true,getOffset:function(){return new SLICK.Vector(m.x,m.y)},setOffset:function(b,d){m.x=b;m.y=d},pan:function(b,d,c){if(c)e.updateOffset(m.x+b,m.y+d,c);else{e.updateOffset(m.x+b,m.y+d);p.onPan&&p.onPan(b,d)}},isAnimating:function(){return g},panEnd:function(b,d){p.onPanEnd&&p.onPanEnd(b,d)},updateOffset:function(b,d,c){if(c){b=new SLICK.Vector(b,
d);g=true;c=SLICK.Animation.tweenVector(m,b.x,b.y,c,function(){g=false;e.panEnd(0,0)});for(b=c.length;b--;){c[b].cancelOnInteract=true;c[b].requestUpdates(function(){p.onAnimate&&p.onAnimate(m.x,m.y)})}}else e.setOffset(b,d)}},l=document.getElementById(p.container);l&&SLICK.Touch.captureTouch(l,{moveHandler:function(b,d){e.pan(-b,-d)},moveEndHandler:function(b,d){e.panEnd(b,d)}});return e};
SLICK.Scalable=function(p){function g(j,k){e=j.getRect();l=k.getRect();var n=e.getSize(),o=l.getSize();a=l.getCenter();b=e&&n!==0?o/n:1}p=GRUNT.extend({container:null,onAnimate:null,onPinchZoom:null,onScale:null,scaleDamping:false},p);var m=false,e=null,l=null,b=1,d=null,c=null,i=null,a=null,f={scalable:true,animate:function(j,k,n,o,q){function r(){q&&q();m=false;p.onScale&&p.onScale(b,a);b=1;d=null}m=true;i=k.duplicate();a=n.duplicate();e=null;if(o){c=b;SLICK.Animation.tweenValue(0,j-c,o,r,1E3).requestUpdates(function(t){d=
t/(j-c);b=c+t;p.onAnimate&&p.onAnimate()})}else{b=j;r()}},getScaleInfo:function(){return{factor:b,startRect:e?e.duplicate():null,endRect:l?l.duplicate():null,start:i,center:a,progress:d}},getScaling:function(){return m},getScaleFactor:function(){return b}},h=document.getElementById(p.container);h&&SLICK.Touch.captureTouch(h,{pinchZoomHandler:function(j,k){g(j,k);(m=b!==1)&&p.onPinchZoom&&p.onPinchZoom(j,k)},pinchZoomEndHandler:function(j,k){g(j,k);m=false;p.onScale&&p.onScale(b,a,true);b=1},wheelZoomHandler:function(j){e=
l=null;a=j.duplicate()}});return f};
SLICK.Dispatcher=function(){var p=[],g={execute:function(m){var e=g.findAction(m);GRUNT.Log.info("looking for action id: "+m+", found: "+e);if(e){var l=[].concat(arguments).slice(0,1);GRUNT.Log.watch("EXECUTING ACTION: "+m,function(){e.execute(l)})}},findAction:function(m){for(var e=p.length;e--;)if(p[e].id==m)return p[e];return null},getRegisteredActions:function(){return[].concat(p)},getRegisteredActionIds:function(){for(var m=[],e=p.length;e--;)p[e].id&&m.push(p[e].id);return m},registerAction:function(m){m&&
m.id&&p.push(m)},Action:function(m){m=GRUNT.extend({autoRegister:true,id:"",title:"",icon:"",execute:null},m);var e={id:m.id,execute:function(){m.execute&&m.execute.apply(this,arguments)},getParam:function(l){return m[l]?m[l]:""},toString:function(){return String.format("{0} [title = {1}, icon = {2}]",e.id,m.title,m.icon)}};m.autoRegister&&g.registerAction(e);return e},createAgent:function(m){m=GRUNT.extend({name:"Untitled",trashOrphanedResults:true,translator:null,execute:null},m);var e=null,l={getName:function(){return m.name},
getParam:function(b){return m[b]},getId:function(){return GRUNT.toID(l.getName())},run:function(b,d){if(m.execute){var c=e=SLICK.Clock.getTime(true),i=m.translator?m.translator(b):b;m.execute.call(l,i,function(a,f){if(!m.trashOrphanedResults||c==e)d&&d(a,f,i)})}}};return l},runAgents:function(m,e,l){for(var b=0;b<m.length;b++)m[b].run(e,l)}};return g}();
SLICK.Messaging=function(){var p=[],g=[],m=GRUNT.newModule({id:"slick.messaging",requires:["slick.core"],STATUS:{none:0,created:1,updated:2,handled:3},send:function(e){e=GRUNT.extend({type:"",payload:{},index:0,status:m.STATUS.created,statusChange:null},e);e.index=g.push(e)-1;e=e.index;var l=e>=0&&e<g.length?g[e]:null;GRUNT.Log.info("firing message update, index = "+e+", message = "+l);for(var b=0;l&&b<p.length&&l.status!==m.STATUS.handled;){var d=p[b].processUpdate(g[e]);if(d){d=d;p[b].getId();var c=
e>=0&&e<g.length?g[e]:null;if(c){c.status=d;c.statusChange&&c.statusChange(c)}}b++}},Handler:function(e){e=GRUNT.extend({id:"",processUpdate:null},e);var l={getId:function(){return e.id},processUpdate:function(b){if(e.processUpdate)return e.processUpdate(b);return m.STATUS.none}};p.push(l);return l}});return m}();
SLICK.Animation=function(){function p(){if(e===0)e=setInterval(function(){if(l.update(SLICK.Clock.getTime())===0){clearInterval(e);e=0}},20)}var g=[],m=false,e=0,l={DURATION:2E3,tweenValue:function(b,d,c,i,a){b=new l.Tween({startValue:b,endValue:d,tweenFn:c,complete:i,duration:a});g.push(b);return b},tween:function(b,d,c,i,a,f){b=new l.Tween({target:b,property:d,endValue:c,tweenFn:i,duration:f,complete:a});g.push(b);return b},tweenVector:function(b,d,c,i,a,f){var h=[];if(b){var j=b.x==d,k=b.y==c;
j||h.push(l.tween(b,"x",d,i,function(){(j=true)&&k&&a()},f));k||h.push(l.tween(b,"y",c,i,function(){k=true;j&&k&&a()},f))}return h},cancel:function(b){if(!m){m=true;try{for(var d=0;d<g.length;)if(!b||b(g[d])){GRUNT.Log.info("CANCELLING ANIMATION");g[d].triggerComplete(true);g.splice(d,1)}else d++}finally{m=false}}},isTweening:function(){return g.length>0},update:function(b){if(m)return g.length;m=true;try{for(var d=0;d<g.length;)if(g[d].isComplete()){g[d].triggerComplete(false);g.splice(d,1);GRUNT.WaterCooler.say("animation.complete")}else{g[d].update(b);
d++}}finally{m=false}return g.length},Tween:function(b){b=GRUNT.extend({target:null,property:null,startValue:0,endValue:null,duration:l.DURATION,tweenFn:l.DEFAULT,complete:null,cancelOnInteract:false},b);var d=SLICK.Clock.getTime(),c=[],i=false,a=0,f=0,h={cancelOnInteract:b.cancelOnInteract,isComplete:function(){return i},triggerComplete:function(j){b.complete&&b.complete(j)},update:function(j){try{var k=b.tweenFn(j-d,a,f,b.duration);if(b.target)b.target[b.property]=k;for(var n=c.length;n--;)c[n](k,
void 0);if(i=d+b.duration<=j){if(b.target)b.target[b.property]=b.tweenFn(b.duration,a,f,b.duration);for(var o=c.length;o--;)c[o](k,true)}}catch(q){GRUNT.Log.exception(q)}},requestUpdates:function(j){c.push(j)}};a=b.target&&b.property&&b.target[b.property]?b.target[b.property]:b.startValue;if(typeof b.endValue!=="undefined")f=b.endValue-a;if(f==0)i=true;p();return h},Easing:function(){var b=1.70158;return{Linear:function(d,c,i,a){return i*d/a+c},Back:{In:function(d,c,i,a){return i*(d/=a)*d*((b+1)*
d-b)+c},Out:function(d,c,i,a){return i*((d=d/a-1)*d*((b+1)*d+b)+1)+c},InOut:function(d,c,i,a){return(d/=a/2)<1?i/2*d*d*(((b*=1.525)+1)*d-b)+c:i/2*((d-=2)*d*(((b*=1.525)+1)*d+b)+2)+c}},Bounce:{In:function(d,c,i,a){return i-l.Easing.Bounce.Out(a-d,0,i,a)+c},Out:function(d,c,i,a){return(d/=a)<1/2.75?i*7.5625*d*d+c:d<2/2.75?i*(7.5625*(d-=1.5/2.75)*d+0.75)+c:d<2.5/2.75?i*(7.5625*(d-=2.25/2.75)*d+0.9375)+c:i*(7.5625*(d-=2.625/2.75)*d+0.984375)+c},InOut:function(d,c,i,a){return d<a/2?l.Easing.Bounce.In(d*
2,0,i,a)*0.5+c:l.Easing.Bounce.Out(d*2-a,0,i,a)*0.5+i*0.5+c}},Cubic:{In:function(d,c,i,a){return i*(d/=a)*d*d+c},Out:function(d,c,i,a){return i*((d=d/a-1)*d*d+1)+c},InOut:function(d,c,i,a){if((d/=a/2)<1)return i/2*d*d*d+c;return i/2*((d-=2)*d*d+2)+c}},Elastic:{In:function(d,c,i,a,f,h){if(d==0)return c;if((d/=a)==1)return c+i;h||(h=a*0.3);if(!f||f<Math.abs(i)){f=i;i=h/4}else i=h/(2*Math.PI)*Math.asin(i/f);return-(f*Math.pow(2,10*(d-=1))*Math.sin((d*a-i)*2*Math.PI/h))+c},Out:function(d,c,i,a,f,h){var j;
if(d==0)return c;if((d/=a)==1)return c+i;h||(h=a*0.3);if(!f||f<Math.abs(i)){f=i;j=h/4}else j=h/(2*Math.PI)*Math.asin(i/f);return f*Math.pow(2,-10*d)*Math.sin((d*a-j)*2*Math.PI/h)+i+c},InOut:function(d,c,i,a,f,h){var j;if(d==0)return c;if((d/=a/2)==2)return c+i;h||(h=a*0.3*1.5);if(!f||f<Math.abs(i)){f=i;j=h/4}else j=h/(2*Math.PI)*Math.asin(i/f);if(d<1)return-0.5*f*Math.pow(2,10*(d-=1))*Math.sin((d*a-j)*2*Math.PI/h)+c;return f*Math.pow(2,-10*(d-=1))*Math.sin((d*a-j)*2*Math.PI/h)*0.5+i+c}},Quad:{In:function(d,
c,i,a){return i*(d/=a)*d+c},Out:function(d,c,i,a){return-i*(d/=a)*(d-2)+c},InOut:function(d,c,i,a){if((d/=a/2)<1)return i/2*d*d+c;return-i/2*(--d*(d-2)-1)+c}},Sine:{In:function(d,c,i,a){return-i*Math.cos(d/a*(Math.PI/2))+i+c},Out:function(d,c,i,a){return i*Math.sin(d/a*(Math.PI/2))+c},InOut:function(d,c,i,a){return-i/2*(Math.cos(Math.PI*d/a)-1)+c}}}}()};return GRUNT.extend(l,{DEFAULT:l.Easing.Back.Out})}();SLICK.Border={NONE:0,TOP:1,RIGHT:2,BOTTOM:3,LEFT:4};
SLICK.Graphics=function(){var p={NONE:0,ACTIVE:1,ANIMATING:2,PAN:4,PINCHZOOM:8,GENCACHE:32,SNAPSHOT:64,FREEZE:128},g=0,m={requires:["Resources"],drawRect:function(e,l){e.strokeRect(l.origin.x,l.origin.y,l.dimensions.width,l.dimensions.height)},DisplayState:p,AnyDisplayState:255,ActiveDisplayStates:p.ACTIVE|p.ANIMATING,ViewLayer:function(e){e=GRUNT.extend({id:"",centerOnScale:true,created:(new Date).getTime(),scalePosition:true,zindex:0,validStates:m.ActiveDisplayStates|p.PAN|p.PINCHZOOM|p.SNAPSHOT},
e);var l=[],b=null,d=GRUNT.extend({isAnimating:function(){return false},addToView:function(c){c.setLayer(e.id,d)},shouldDraw:function(c){return(c&e.validStates)!==0},cycle:function(){return 0},draw:function(){},layerChanged:function(){for(var c=l.length;c--;)l[c](d)},notify:function(){},remove:function(){GRUNT.WaterCooler.say("layer.remove",{id:e.id})},registerChangeListener:function(c){l.push(c)},wakeParent:function(){GRUNT.WaterCooler.say("view.wake",{id:b?b.id:null})},getParent:function(){return b},
setParent:function(c){b=c}},e);return d},StatusViewLayer:function(){return new m.ViewLayer({validStates:m.AnyDisplayState,zindex:5E3,draw:function(e,l,b,d){e.fillStyle="#FF0000";e.fillRect(10,10,50,50);e.fillStyle="#FFFFFF";e.font="bold 10px sans";e.fillText(d.getDisplayState(),20,20)}})},AnimatedPathLayer:function(e){function l(f,h,j){f.fillStyle="#FFFFFF";f.strokeStyle="#222222";f.beginPath();f.arc(j.x,j.y,4,0,Math.PI*2,false);f.stroke();f.fill()}e=GRUNT.extend({path:[],id:GRUNT.generateObjectID("pathAnimation"),
easing:SLICK.Animation.Easing.Sine.InOut,canCache:false,validStates:m.ActiveDisplayStates|p.PAN|p.PINCHZOOM,drawIndicator:null,duration:2E3,autoCenter:false},e);var b=SLICK.VectorMath.edges(e.path),d,c=null,i=0;SLICK.Animation.tweenValue(0,b.total,e.easing,function(){a.remove()},e.duration).requestUpdates(function(f,h){i=f;h&&a.remove()});var a=GRUNT.extend(new m.ViewLayer(e),{cycle:function(){for(var f=0;f<b.accrued.length&&b.accrued[f]<i;)f++;c=null;if(f<e.path.length-1){var h=i-(f>0?b.accrued[f-
1]:0),j=e.path[f],k=e.path[f+1];d=SLICK.VectorMath.theta(j,k,b.edges[f]);c=SLICK.VectorMath.pointOnEdge(j,k,d,h);if(e.autoCenter)(f=a.getParent())&&f.centerOn(c)}return c?1:0},draw:function(f,h){if(c)(e.drawIndicator?e.drawIndicator:l)(f,h,new SLICK.Vector(c.x-h.x,c.y-h.y),d)}});return a},FPSLayer:function(e){e=GRUNT.extend({zindex:1E3,scalePosition:false},e);var l=GRUNT.extend(new m.ViewLayer(e),{fps:null,draw:function(b,d,c){b.save();try{b.font="bold 8pt Arial";b.textAlign="right";b.fillStyle="rgba(0, 0, 0, 0.8)";
b.fillText((l.fps?l.fps:"?")+" fps",c.width-20,20)}finally{b.restore()}}});return l},ResourceStatsLayer:function(e){e=GRUNT.extend({zindex:500,indicatorSize:5,scalePosition:false,validStates:p.ACTIVE|p.PAN},e);return GRUNT.extend(new m.ViewLayer(e),{fps:null,draw:function(l){var b=SLICK.Resources.getStats(),d=e.indicatorSize,c=10,i;if(b.imageCacheFullness){l.strokeStyle="rgba(0, 0, 255, 1)";l.beginPath();l.arc(15,15,5,0,Math.PI*2*b.imageCacheFullness,false);l.stroke();c=30}if(b.imageLoadingCount>=
0){l.fillStyle="rgba(0, 255, 0, 0.7)";for(i=b.imageLoadingCount;i--;)l.fillRect(c+i*(d+2),10,d,d)}if(b.queuedImageCount>=0){l.fillStyle="rgba(255, 0, 0, 0.7)";for(i=b.queuedImageCount;i--;)l.fillRect(c+i*(d+2),10+d+2,d,d)}}})},LoadingLayer:function(e){GRUNT.extend({},e)},View:function(e){function l(s,w){w.id=s;w.registerChangeListener(function(){t++;i()});w.setParent(C);a.push(w);a.sort(function(y,G){var E=G.zindex-y.zindex;if(E===0)E=G.created-y.created;return E})}function b(s,w,y,G){var E=0;if(s.shouldDraw(G))E=
s.draw(w,y,D,C);return E?E:0}function d(s,w){var y=0,G=C.getScaleFactor(),E=C.getDisplayStatus(),Q=(E&p.PINCHZOOM)!==0,W=[];A=C.getScaleFactor();var Y=false,J=0;if(!Q&&t>0&&Z+ba<=M){y=y;var K=0,H=GRUNT.Log.getTraceTicks();r=1E3;GRUNT.WaterCooler.say("view.cache",{id:e.id});if(n){k.clearRect(0,0,j.width,j.height);n=false}var ca=o.offset(-e.padding,-e.padding);GRUNT.Log.trace("prepped cached canvas",H);for(var T=a.length;T--;)if(a[T].shouldDraw(u?p.FROZEN:p.GENCACHE)){var $=a[T].draw(k,ca,N,C);K+=$?
$:0;r=Math.min(r,a[T].zindex)}t=0;q=o.duplicate();Z=M;GRUNT.Log.trace("cached context",H);y=y+K}if(e.clearOnDraw||Q)s.clearRect(0,0,f.width,f.height);if(Q){H=O.getScaleInfo();C.getDimensions().getCenter();K=(H.progress?H.progress:1)*0.5;F=H.center;if(H.startRect){K=H.startRect.getCenter().diff(F);R=new SLICK.Vector(F.x+K.x,F.y+K.y)}else{H=H.start.diff(F);R=new SLICK.Vector(F.x-H.x*K,F.y-H.y*K)}R&&w.add(R)}s.save();try{if(v!==1)s.scale(v,v);else if(Q){s.translate(F.x,F.y);s.scale(G,G)}for(J=a.length;J--;){if(!Q||
a[J].scalePosition)y+=b(a[J],s,w,E);else W.unshift(a[J]);if(!Y&&r<a[J].zindex){var aa=q.diff(w).offset(-e.padding,-e.padding);s.drawImage(j,aa.x,aa.y);Y=true}}}finally{s.restore()}for(J=W.length;J--;)y+=b(W[J],s,w,E);return y}function c(){var s=0,w=L==m.DisplayState.PINCHZOOM||M-x<e.bufferRefresh;M=SLICK.Clock.getTime();o=S?S.getOffset():new SLICK.Vector;if(I&&B)I.fps=Math.floor(1E3/(M-B));w&&SLICK.Animation.cancel(function(E){return E.cancelOnInteract});for(var y=a.length;y--;){var G=a[y].cycle(M,
o);s+=G?G:0}U=U&&!w;s+=d(h,o);if(!w&&!U){U=true;GRUNT.WaterCooler.say("view-idle",{id:C.id})}B=M;X=0;P+s>0&&i()}function i(){P++;if(!(u||X!==0)){P=0;X=setTimeout(c,0)}}e=GRUNT.extend({id:"view_"+g++,container:"",pannable:false,scalable:false,clearOnDraw:false,displayFPS:true,displayResourceStats:true,scaleDamping:false,fillStyle:"rgb(200, 200, 200)",bufferRefresh:100,defaultFreezeDelay:500,snapshotFreezeTime:200,padding:100,fps:25,cacheFPS:5,onPan:null,onPinchZoom:null,onScale:null,onDraw:null,autoSize:false},
e);var a=[],f=document.getElementById(e.container),h=null,j=null,k=null,n=false,o=new SLICK.Vector,q=new SLICK.Vector,r=0,t=0,A=1,B=null,x=0,u=false,v=1,z=new SLICK.Vector,D=null,N=null,V=null,P=0,I=null,F=null,S=null,O=null,U=false,X=0,R=null,M=0,Z=0,ba=1E3/(e.cacheFPS?e.cacheFPS:1),L=m.DisplayState.ACTIVE;GRUNT.Log.info("Creating a new view instance, attached to container: "+e.container+", canvas = ",f);if(f){if(e.autoSize){GRUNT.Log.info("autosizing view: window.height = "+window.innerHeight+", width = "+
window.innerWidth);f.height=window.innerHeight-f.offsetTop-49;f.width=window.innerWidth-f.offsetLeft}try{h=f.getContext("2d")}catch(da){GRUNT.Log.exception(da);throw Error("Could not initialise canvas on specified view element");}}j=document.createElement("canvas");j.width=f.width+e.padding*2;j.height=f.height+e.padding*2;k=j.getContext("2d");k.globalCompositeOperation="copy";if(e.pannable)S=new SLICK.Pannable({container:e.container,onAnimate:function(){i()},onPan:function(s,w){n=true;x=SLICK.Clock.getTime(true);
i();z.add(new SLICK.Vector(s,w));e.onPan&&e.onPan(s,w);L=p.PAN},onPanEnd:function(){t++;i();var s=C.getOffset();s.x%=256;s.y%=256;GRUNT.Log.info("current guide offset = "+s);L=p.ACTIVE}});if(e.scalable)O=new SLICK.Scalable({scaleDamping:e.scaleDamping,container:e.container,onAnimate:function(){L=m.DisplayState.PINCHZOOM;i()},onPinchZoom:function(s,w){x=SLICK.Clock.getTime(true);i();e.onPinchZoom&&e.onPinchZoom(s,w);L=m.DisplayState.PINCHZOOM},onScale:function(s,w){GRUNT.WaterCooler.say("view.scale",
{id:C.id});C.snapshot();for(var y=a.length;y--;)a[y].notify("scale");L=m.DisplayState.ACTIVE;i();e.onScale&&e.onScale(s,w)}});var C=GRUNT.extend({},e,S,O,{id:e.id,deviceScaling:v,centerOn:function(s){S.setOffset(s.x-f.width*0.5,s.y-f.height*0.5)},getDimensions:function(){if(f)return new SLICK.Dimensions(f.width,f.height)},getZoomCenter:function(){return R},getLayer:function(s){for(var w=0;w<a.length;w++)if(a[w].id==s){/^grid/i.test(s)||GRUNT.Log.info("found layer: "+s);return a[w]}return null},setLayer:function(s,
w){for(var y=0;y<a.length;y++)if(a[y].id===s){a.splice(y,1);break}w&&l(s,w);GRUNT.WaterCooler.say("layer.update",{value:w});t++;i()},eachLayer:function(s){for(var w=0;w<a.length;w++)s(a[w])},freeze:function(){u=true},unfreeze:function(){u=false;t++;i()},snapshot:function(){var s=GRUNT.Log.getTraceTicks();k.save();try{k.fillStyle="rgba(30, 30, 30)";k.fillRect(e.padding,e.padding,D.width,D.height);k.globalAlpha=0.5;k.drawImage(f,e.padding,e.padding)}finally{k.restore()}GRUNT.Log.trace("taken snapshot",
s)},getDisplayStatus:function(){return u?p.FROZEN:L},setDisplayStatus:function(s){L=s},scale:function(s,w,y,G,E){G||(G=C.getDimensions().getCenter());E||(E=C.getDimensions().getCenter());O&&O.animate(s,G,E,w,y);return O},removeLayer:function(s,w){setTimeout(function(){var y;a:{for(y=a.length;y--;)if(a[y].id==s){y=y;break a}y=-1}if(y>=0&&y<a.length){GRUNT.WaterCooler.say("layer.remove",{layer:a[y]});a.splice(y,1)}},w?w:1)}});D=C.getDimensions();V=D.getCenter();N=D.grow(e.padding,e.padding);GRUNT.WaterCooler.listen("layer.remove",
function(s){s.id&&C.removeLayer(s.id)});GRUNT.WaterCooler.listen("view.wake",function(s){t++;if(!s.id||s.id===C.id)i()});v=SLICK.getDeviceConfig().getScaling();if(e.displayFPS){I=new m.FPSLayer;C.setLayer("fps",I)}e.displayResourceStats&&C.setLayer("resourceStats",new m.ResourceStatsLayer);i();return C},Sprite:function(){var e=[];return{loaded:false,changed:function(l){for(var b=0;b<e.length;b++)e[b](l)},draw:function(){},load:function(){},requestUpdates:function(l){e.push(l)}}}};return m}();
SLICK.Tiling=function(){TileStore=function(g){g=GRUNT.extend({gridSize:20,center:new SLICK.Vector,onPopulate:null},g);var m=Array(Math.pow(g.gridSize,2)),e=Math.ceil(g.gridSize>>1),l=g.center.offset(-e,-e),b=null,d=new SLICK.Vector,c=null;GRUNT.Log.info("created tile store with tl offset = "+l);var i={getGridSize:function(){return g.gridSize},getNormalizedPos:function(a,f){return(new SLICK.Vector(a,f)).add(l.invert()).add(d)},getTileShift:function(){return d.duplicate()},getTile:function(a,f){return a>=
0&&a<g.gridSize?m[f*g.gridSize+a]:null},setTile:function(a,f,h){m[f*g.gridSize+a]=h},populate:function(a,f){var h=GRUNT.Log.getTraceTicks(),j=0;new SLICK.Vector(g.gridSize*0.5,g.gridSize*0.5);GRUNT.Log.info("poulating grid, top left offset = "+l);if(a)for(var k=0;k<g.gridSize;k++)for(var n=0;n<g.gridSize;n++){if(!m[j]){var o=a(n,k,l,g.gridSize);o&&f&&o.requestUpdates(f);m[j]=o}j++}b=a;c=f;GRUNT.Log.trace("tile grid populated",h);g.onPopulate&&g.onPopulate()},getShiftDelta:function(a,f,h,j){var k=
Math.floor(g.gridSize*0.2),n=new SLICK.Vector;if(a<0||a+h>g.gridSize)n.x=a<0?-k:k;if(f<0||f+j>g.gridSize)n.y=f<0?-k:k;return n},shift:function(a,f){if(!(a.x===0&&a.y===0)){var h=GRUNT.Log.getTraceTicks(),j=Array(m.length);j.length=m.length;for(var k=0;k<g.gridSize;k++)for(var n=0;n<g.gridSize;n++)j[n*g.gridSize+k]=i.getTile(k+a.x,n+a.y);m=j;if(f)l=f(l,a);else l.add(a);d.x+=-a.x*g.tileSize;d.y+=-a.y*g.tileSize;GRUNT.Log.trace("tile storage shifted",h);i.populate(b,c)}},setOrigin:function(a,f){if(tileOrigin)shiftOrigin(a,
f);else l=(new SLICK.Vector(a,f)).offset(-tileHalfWidth,-tileHalfWidth)}};return i};var p={Config:{TILESIZE:256,TILEBUFFER:1,TILEBUFFER_LOADNEW:0.2,EMPTYTILE:"/public/images/tile.png"},Tile:function(g){g=GRUNT.extend({},g);return GRUNT.extend(new SLICK.Graphics.Sprite(g),{})},ImageTile:function(g){g=GRUNT.extend({url:"",sessionParamRegex:null},g);var m=new p.Tile(g),e=false,l=GRUNT.extend({},m,{draw:function(b,d,c){e||SLICK.Resources.resetImageLoadListeners(g.url);SLICK.Resources.getImage(g.url,function(i,
a){if(a)b.drawImage(i,d,c);else{e=true;GRUNT.WaterCooler.say("tile.loaded",{tile:l})}})}});return l},EmptyGridTile:function(g){g=GRUNT.extend({tileSize:256,gridLineSpacing:16},g);var m=new SLICK.Graphics.Sprite(g),e=null;m=GRUNT.extend({},m,{draw:function(l,b,d){l.drawImage(e,b,d)},getBuffer:function(){return e},getTileSize:function(){return g.tileSize}});(function(){if(!e){e=document.createElement("canvas");e.width=g.tileSize;e.height=g.tileSize}var l=e.getContext("2d");l.fillStyle="rgb(200, 200, 200)";
l.fillRect(0,0,e.width,e.height);l.strokeStyle="rgb(180, 180, 180)";l.lineWidth=0.5;l.beginPath();for(var b=0;b<e.width;b+=g.gridLineSpacing){l.moveTo(b,0);l.lineTo(b,e.height);for(var d=0;d<e.height;d+=g.gridLineSpacing){l.moveTo(0,d);l.lineTo(e.width,d)}}l.stroke()})();return m},TileGridBackground:function(g){g=GRUNT.extend({lineDist:16,lineWidth:1,fillStyle:"rgb(200, 200, 200)",strokeStyle:"rgb(180, 180, 180)",zindex:-1,validStates:SLICK.Graphics.GENCACHE});var m=document.createElement("canvas"),
e=m.getContext("2d"),l=null;m.width=g.lineDist;m.height=g.lineDist;e.fillStyle=g.fillStyle;e.strokeStyle=g.strokeStyle;e.fillRect(0,0,m.width,m.height);e.lineWidth=g.lineWidth;e.beginPath();e.moveTo(0,0);e.lineTo(0,g.lineDist);e.moveTo(0,0);e.lineTo(g.lineDist,0);e.stroke();return GRUNT.extend(new SLICK.Graphics.ViewLayer(g),{draw:function(b,d,c){var i=GRUNT.Log.getTraceTicks(),a=Math.abs(d.x%g.lineDist);d=Math.abs(d.y%g.lineDist);l||(l=b.createPattern(m,"repeat"));b.save();try{b.translate(-a,-d);
b.fillStyle=l;b.fillRect(0,0,c.width+a,c.height+d)}finally{b.restore()}GRUNT.Log.trace("tile background drawn",i)}})},TileGrid:function(g){function m(k,n){for(var o=0;o<b.length;o++)b[o](k,n)}function e(k,n,o,q){k=h.getTileShift();n=new SLICK.Vector(Math.floor((n.x+k.x)*c),Math.floor((n.y+k.y)*c));k=Math.ceil(o.width*c)+1;o=Math.ceil(o.height*c)+1;var r=new SLICK.Vector((k-1)*0.5,(o-1)*0.5),t=new SLICK.Vector(n.x*g.tileSize,n.y*g.tileSize);q.isAnimating();a=[];tilesNeeded=false;for(var A=0;A<o;A++)for(var B=
A*g.tileSize+t.y,x=0;x<k;x++){q=h.getTile(x+n.x,A+n.y);var u=x*g.tileSize+t.x,v=new SLICK.Vector(x-r.x,A-r.y);q||(f=h.getShiftDelta(n.x,n.y,k,o));a.push({tile:q,coordinates:new SLICK.Vector(u,B),centerness:v.getAbsSize()})}a.sort(function(z,D){return D.centerness-z.centerness})}g=GRUNT.extend({emptyTileImage:null,tileSize:SLICK.Tiling.Config.TILESIZE,drawGrid:false,center:new SLICK.Vector,shiftOrigin:null,checkChange:100,validStates:SLICK.Graphics.DisplayState.GENCACHE|SLICK.Graphics.DisplayState.SNAPSHOT},
g);var l=Math.round(g.tileSize>>1),b=[],d=true,c=g.tileSize?1/g.tileSize:0,i=false,a=[];new p.EmptyGridTile;new SLICK.Vector;var f=new SLICK.Vector,h=new TileStore(GRUNT.extend({onPopulate:function(){i=true;j.wakeParent()}},g)),j=GRUNT.extend(new SLICK.Graphics.ViewLayer(g),{addTile:function(k,n,o){h.setTile(k,n,o);if(o){o.setSize(g.tileSize);o.requestUpdates(function(q){m("updated",q)})}},cycle:function(){var k=0;if(f.x+f.y!==0){h.shift(f,g.shiftOrigin);f=new SLICK.Vector;k++}return k+i?1:0},draw:function(k,
n,o,q){if(d){var r=GRUNT.Log.getTraceTicks(),t=h.getTileShift(),A=n.x+t.x;t=n.y+t.y;e(k,n,o,q);GRUNT.Log.trace("updated draw queue",r);if(g.drawGrid)k.strokeStyle="rgba(50, 50, 50, 0.3)";k.beginPath();for(n=a.length;n--;){o=a[n].tile;q=a[n].coordinates.x-A;var B=a[n].coordinates.y-t;o&&o.draw(k,q,B);g.drawGrid&&k.rect(q,B,g.tileSize,g.tileSize)}k.stroke();GRUNT.Log.trace("drawn tiles",r)}i=false},getLoadedTileCount:function(){return 0},getVisibleTileCount:function(k){if(g.tileSize!==0)return Math.ceil(k.width/
g.tileSize)+Math.ceil(k.height/g.tileSize);return 0},getTileSize:function(){return g.tileSize},getTileVirtualXY:function(k,n,o){k=h.getNormalizedPos(k,n);GRUNT.Log.info("normalised pos = "+k);k=new SLICK.Vector(k.x*g.tileSize,k.y*g.tileSize);if(o){k.x+=l;k.y+=l}return k},getCenterXY:function(){var k=Math.ceil(h.getGridSize()>>1);return j.getTileVirtualXY(k,k,true)},getDimensions:function(){var k=h.getGridSize()*g.tileSize;return new SLICK.Dimensions(k,k)},populate:function(k){h.populate(k,function(n){m("created",
n)})},requestUpdates:function(k){b.push(k)}});GRUNT.WaterCooler.listen("view.scale",function(k){if(k.id==j.getParent().id)d=false});GRUNT.WaterCooler.listen("tile.loaded",function(k){i=true;j.wakeParent();m("load",k.tile)});return j},DataLayer:function(){},Tiler:function(g){g=GRUNT.extend({container:"",drawCenter:false,onPan:null,onPanEnd:null,tapHandler:null,doubleTapHandler:null,zoomHandler:null,onDraw:null,datasources:{},tileLoadThreshold:"first"},g);(new SLICK.Tiling.EmptyGridTile).getTileSize();
var m=0,e={first:function(){return 1},auto:function(b){return b>>1},all:function(b){return b}};SLICK.Touch.captureTouch(document.getElementById(g.container),g);var l=new SLICK.Graphics.View(GRUNT.extend({},g,{pannable:true,scalable:true,scaleDamping:true,datasources:g.datasources,fillBackground:function(b,d,c,i,a){d=b.createLinearGradient(d,0,d,a);d.addColorStop(0,"rgb(170, 170, 170)");d.addColorStop(1,"rgb(210, 210, 210)");b.fillStyle=d;b.fillRect(0,0,i,a)},onDraw:function(b){l.getOffset();g.onDraw&&
g.onDraw(b)}}));GRUNT.extend(l,{getTileLayer:function(){return l.getLayer("grid0")},setTileLayer:function(b){l.setLayer("grid0",b);var d=b.getVisibleTileCount(l.getDimensions());m=e[g.tileLoadThreshold]?e[g.tileLoadThreshold](d):parseInt(g.tileLoadThreshold,10);GRUNT.WaterCooler.say("grid.updated",{grid:b})},gridPixToViewPix:function(b){var d=l.getOffset();return new SLICK.Vector(b.x-d.x,b.y-d.y)},viewPixToGridPix:function(b){var d=l.getOffset();GRUNT.Log.info("Offset = "+d);return new SLICK.Vector(b.x+
d.x,b.y+d.y)}});l.setLayer("background",new p.TileGridBackground);return l}};return p}();
SLICK.Geo=function(){function p(a,f){var h=null;for(var j in c)if(f){if(j==f&&c[j][a]){h=c[j];break}}else if(c[j][a]){h=c[j];break}return h}function g(a,f,h,j){var k=0;a=a.toUpperCase();for(var n in j){var o=f[n];if(o){var q=h[n];o=q?q(a,o):a.containsWord(o)?1:0;k+=o*j[n]}}return k}var m=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],e=/(\d+)\s?\-\s?(\d+)/,l=/^(\d+).*$/,b=null,d={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",
HWY:"HIGHWAY",MWY:"MOTORWAY"},c={},i={Engine:function(a){if(!a.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var f=GRUNT.extend({remove:function(){delete c[f.id]}},a);return c[f.id]=f},getEngine:function(a){for(var f=null,h=1;!f&&h<arguments.length;h++)f=p(a,arguments[h]);f=f?f:p(a);if(!f)throw Error("Unable to find GEO engine with "+a+" capability");return f},Distance:function(a,f){var h=0;if(a&&!a.isEmpty()&&f&&!f.isEmpty()){var j=(f.lat-a.lat).toRad()>>1,k=(f.lon-
a.lon).toRad()>>1;j=Math.sin(j)*Math.sin(j)+Math.cos(a.lat.toRad())*Math.cos(f.lat.toRad())*Math.sin(k)*Math.sin(k);h=6371*2*Math.atan2(Math.sqrt(j),Math.sqrt(1-j))}return{toM:function(){return h*1E3},toKM:function(){return h},toString:function(){return h+"km"}}},Radius:function(a,f){return{distance:parseInt(a,10),uom:f}},Position:function(a,f){if(!f&&a&&a.split&&a.indexOf(" ")>=0){var h=a.split(" ");a=h[0];f=h[1]}if(!a)f=a=0;var j={lat:parseFloat(a),lon:parseFloat(f),copy:function(k){j.lat=k.lat;
j.lon=k.lon},duplicate:function(){return new i.Position(j.lat,j.lon)},clear:function(){j.lat=0;j.lon=0},isEmpty:function(){return j.lat===0&&j.lon===0},getMercatorPixels:function(k){return new SLICK.Vector(SLICK.Geo.Utilities.lon2pix(j.lon,k),SLICK.Geo.Utilities.lat2pix(j.lat,k))},setMercatorPixels:function(k,n,o){if(!o)throw"Unable to calculate position from mercator pixels without rads_per_pixel value";j.lat=SLICK.Geo.Utilities.pix2lat(n,o);j.lon=SLICK.Geo.Utilities.normalizeLon(SLICK.Geo.Utilities.pix2lon(k,
o))},toString:function(){return j.lat+" "+j.lon}};return j},BoundingBox:function(a,f){if(a){if(a.split)a=new SLICK.Geo.Position(a)}else a=new SLICK.Geo.Position;if(f){if(f.split)f=new SLICK.Geo.Position(f)}else f=new SLICK.Geo.Position;var h={min:a,max:f,copy:function(j){h.min.copy(j.min);h.max.copy(j.max)},clear:function(){h.min.clear();h.max.clear()},expand:function(j){h.min.lat-=j;h.min.lon-=i.Utilities.normalizeLon(j);h.max.lat+=j;h.max.lon+=i.Utilities.normalizeLon(j)},getDistance:function(){return new i.Distance(h.min,
h.max)},getCenter:function(){var j=i.calculateBoundsSize(h.min,h.max);return new SLICK.Geo.Position(h.min.lat+j.y*0.5,h.min.lon+j.x*0.5)},isEmpty:function(){return h.min.isEmpty()||h.max.isEmpty()},transform:function(j){var k=new SLICK.Geo.BoundingBox(h.min,h.max);GRUNT.Log.info("applying "+j.length+" transformers");for(var n=0;j&&n<j.length;n++)j[n].apply(k);return k},toString:function(){return String.format("({0}, {1})",h.min,h.max)}};return h},Transforms:function(){return{Shrink:function(){return function(){}},
Offset:function(){return function(){}}}}(),Address:function(a){a=GRUNT.extend({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},a);return GRUNT.extend(a,{getPos:function(){return a.pos},toString:function(){return a.streetDetails+" "+a.location}})},GeocodeFieldWeights:{streetDetails:50,location:50},AddressCompareFns:{},Utilities:function(){var a={lat2pix:function(f,h){var j=parseFloat(f)*2*Math.PI/360;j=Math.sin(j);var k=0.08181919084262157*j;return Math.log((1+j)/(1-
j)*Math.pow((1-k)/(1+k),0.08181919084262157))/2/h},lon2pix:function(f,h){return parseFloat(f)/180*Math.PI/h},pix2lon:function(f,h){return a.normalizeLon(f*h*180/Math.PI)},pix2lat:function(f,h){for(var j=Math.pow(Math.E,-f*h),k=a.mercatorUnproject(j),n=a.findRadPhi(k,j),o=0;o<12&&Math.abs(k-n)>1.0E-7;){k=n;n=a.findRadPhi(k,j);o++}return n*180/Math.PI},mercatorUnproject:function(f){return Math.PI/2-2*Math.atan(f)},findRadPhi:function(f,h){var j=0.08181919084262157*Math.sin(f);return Math.PI/2-2*Math.atan(h*
Math.pow((1-j)/(1+j),0.040909595421310785))},normalizeLon:function(f){for(;f<-180;)f+=360;for(;f>180;)f-=360;return f}};return a}(),GeoSearchResult:function(a){a=GRUNT.extend({id:null,caption:"",resultType:"",data:null,pos:null,matchWeight:0},a);return GRUNT.extend(a,{toString:function(){return a.caption+(a.matchWeight?" ("+a.matchWeight+")":"")}})},GeoSearchAgent:function(a){a=GRUNT.extend({},a);return GRUNT.extend({},SLICK.Dispatcher.createAgent(a))},GeocodingAgent:function(a){a=GRUNT.extend({name:"Geocoding Search Agent",
paramTranslator:null,execute:function(f,h){try{if(!f.reverse&&!f.freeform)address=new i.Address(f);var j=i.getEngine("geocode");if(j)j.geocode({addresses:[f.freeform?f.freeform:address],complete:function(n,o){if(h){var q=o;if(f.freeform)q=i.rankGeocodeResponses(f.freeform,q,i.getEngine("geocode"));h(q,a)}}})}catch(k){GRUNT.Log.exception(k)}}},a);return new i.GeoSearchAgent(a)},PointOfInterest:function(a){a=GRUNT.extend({id:0,title:"",pos:null,lat:"",lon:"",group:"",retrieved:0,isNew:true},a);if(!a.pos&&
a.lat&&a.lon)a.pos=new SLICK.Geo.Position(a.lat,a.lon);return GRUNT.extend({toString:function(){return a.id+": '"+a.title+"'"}},a)},POIStorage:function(a){function f(q){q=q?q:"default";k[q]||(k[q]=[]);return k[q]}function h(q){var r=[];for(var t in k)for(var A=0;A<k[t].length;A++)if(!q||q(k[t][A]))r.push(k[t][A]);return r}function j(){GRUNT.WaterCooler.say("geo.pois-updated",{srcID:o.id,pois:o.getPOIs()})}a=GRUNT.extend({visibilityChange:null,onPOIDeleted:null,onPOIAdded:null},a);var k={},n=true,
o={id:GRUNT.generateObjectID(),getPOIs:function(){return h()},getOldPOIs:function(q,r){return h(function(t){return t.group==q&&t.retrieved<r})},getVisible:function(){return n},setVisible:function(q){if(q!=n){n=q;a.visibilityChange&&a.visibilityChange()}},findById:function(q){var r=h(function(t){return t.id==q});return r.length>0?r[0]:null},findByBounds:function(q){return h(function(r){return SLICK.Geo.posInBounds(r.pos,q)})},addPOIs:function(q,r){if(r)k={};for(var t=0;q&&t<q.length;t++){q[t].retrieved=
SLICK.Clock.getTime(true);var A=q[t];f(A.group).push(A)}},removeGroup:function(q){if(k[q]){delete k[q];j()}},update:function(q){var r=[],t=0,A=q.length>0?q[0].group:"",B=SLICK.Clock.getTime(true);for(t=0;t<q.length;t++){var x;a:{if(x=q[t])for(var u=f(x.group),v=0;v<u.length;v++)if(u[v].id==x.id){x=u[v];break a}x=null}if(x){x.retrieved=B;x.isNew=false}else r.push(q[t])}q=o.getOldPOIs(A,B);o.addPOIs(r);for(t=0;a.onPOIAdded&&t<r.length;t++)a.onPOIAdded(r[t]);for(t=0;t<q.length;t++){a.onPOIDeleted&&a.onPOIDeleted(q[t]);
A=q[t];B=f(A.group);for(x=0;x<B.length;x++)if(B[x].id==A.id){B.splice(x,1);break}}r.length+q.length>0&&j()}};return o},MapProvider:function(){return{zoomLevel:0,checkZoomLevel:function(a){return a},getCopyright:function(){},getMapTiles:function(){},getPositionForXY:function(){return null}}},posInBounds:function(a,f){var h=!(a.isEmpty()||f.isEmpty());return h=(h=h&&a.lat>=f.min.lat&&a.lat<=f.max.lat)&&a.lon>=f.min.lon&&a.lon<=f.max.lon},calculateBoundsSize:function(a,f,h){var j=new SLICK.Vector(0,
f.lat-a.lat);if(typeof h==="undefined")h=true;j.x=h&&a.lon>f.lon?360-a.lon+f.lon:f.lon-a.lon;return j},getBoundingBoxZoomLevel:function(a,f){var h=a.getCenter(),j=Math.min(Math.round(Math.abs(h.lat)*0.05),m.length),k=m[j],n=i.calculateBoundsSize(a.min,a.max),o=Math.ceil(Math.log(m[3]*f.height/n.y)/Math.log(2));k=Math.ceil(Math.log(k*f.width/n.x)/Math.log(2));GRUNT.Log.info("constant index for bbox: "+a+" (center = "+h+") is "+j);GRUNT.Log.info("distances  = "+n);GRUNT.Log.info("optimal zoom levels: height = "+
o+", width = "+k);return Math.min(o,k)},getBoundsForPositions:function(a,f){var h=null,j=SLICK.Clock.getTime();f||(f="auto");for(var k=0;k<a.length;k++)if(h){var n=i.calculateBoundsSize(h.min,a[k],false),o=i.calculateBoundsSize(a[k],h.max,false);if(n.x<0)h.min.lon=a[k].lon;if(n.y<0)h.min.lat=a[k].lat;if(o.x<0)h.max.lon=a[k].lon;if(o.y<0)h.max.lat=a[k].lat}else h=new SLICK.Geo.BoundingBox(a[k].duplicate(),a[k].duplicate());if(f){if(f=="auto"){k=i.calculateBoundsSize(h.min,h.max);f=Math.max(k.x,k.y)*
0.3}h.expand(f)}GRUNT.Log.info("bounds calculated in "+(SLICK.Clock.getTime()-j)+" ms");return h},normalizeAddress:function(a){if(!a)return"";a=a.toUpperCase();if(!b){var f=[];for(var h in d)f.push(h);b=RegExp("(\\s)("+f.join("|")+")(\\s|$)","i")}b.lastIndex=-1;if(f=b.exec(a))a=a.replace(b,"$1"+d[f[2]]);return a},buildingMatch:function(a,f){l.lastIndex=-1;if(l.test(a))for(var h=a.replace(l,"$1"),j=f.split(","),k=0;k<j.length;k++){e.lastIndex=-1;if(e.test(j[k])){var n=e.exec(j[k]);if(h>=parseInt(n[1],
10)&&h<=parseInt(n[2],10))return true}else if(h==j[k])return true}return false},rankGeocodeResponses:function(a,f,h){var j=[],k=i.AddressCompareFns;if(h&&h.compareFns)k=GRUNT.extend({},k,h.compareFns);for(h=0;h<f.length;h++)j.push(new i.GeoSearchResult({caption:f[h].toString(),data:f[h],pos:f[h].pos,matchWeight:g(a,f[h],k,i.GeocodeFieldWeights)}));j.sort(function(n,o){return o.matchWeight-n.matchWeight});return j}};return i}();
SLICK.Geo.Search=function(){return{bestResults:function(p,g){g||(g=20);for(var m=p.length>0?p[0]:null,e=[],l=0;l<p.length;l++)if(m.matchWeight-p[l].matchWeight<=g)e.push(p[l]);else break;return e}}}();
SLICK.Mapping=function(){var p={AnnotationTween:null,GeoTileGrid:function(g){g=GRUNT.extend({grid:null,centerPos:new SLICK.Geo.Position,centerXY:new SLICK.Vector,radsPerPixel:0},g);var m=g.centerPos.getMercatorPixels(g.radsPerPixel),e=m.x-g.centerXY.x,l=m.y-g.centerXY.y,b=GRUNT.extend({},g.grid,{getBoundingBox:function(d,c,i,a){return new SLICK.Geo.BoundingBox(b.pixelsToPos(new SLICK.Vector(d,c+a)),b.pixelsToPos(new SLICK.Vector(d+i,c)))},getCenterOffset:function(){return g.centerXY},getGridXYForPosition:function(d){var c=
d.getMercatorPixels(g.radsPerPixel);d=c.x-e;c=b.getDimensions().height-(c.y-l);return new SLICK.Vector(d,c)},getGuideOffset:function(d){var c=b.getTileSize();return new SLICK.Vector(d.x%c,d.y%c)},pixelsToPos:function(d){var c=new SLICK.Geo.Position,i=e+d.x;d=l+b.getDimensions().height-d.y;c.setMercatorPixels(i,d,g.radsPerPixel);return c}});return b},POIViewLayer:function(g){GRUNT.extend({},g)},Overlay:function(g){GRUNT.extend({},g);return{}},RadarOverlay:function(g){g=GRUNT.extend({radarFill:"rgba(0, 221, 238, 0.1)",
radarStroke:"rgba(0, 102, 136, 0.3)",zindex:100},g);return GRUNT.extend(new SLICK.Graphics.ViewLayer(g),{draw:function(m,e,l){e=l.width>>1;l=l.height>>1;m.fillStyle=g.radarFill;m.strokeStyle=g.radarStroke;m.beginPath();m.arc(e,l,50,0,Math.PI*2,false);m.fill();m.stroke()}})},CrosshairOverlay:function(g){g=GRUNT.extend({lineWidth:1.5,strokeStyle:"rgba(0, 0, 0, 0.5)",size:15,zindex:150,scalePosition:false,validStates:SLICK.Graphics.DisplayState.ACTIVE|SLICK.Graphics.DisplayState.ANIMATING|SLICK.Graphics.DisplayState.PAN},
g);return GRUNT.extend(new SLICK.Graphics.ViewLayer(g),{draw:function(m,e,l){e=l.getCenter();m.lineWidth=g.lineWidth;m.strokeStyle=g.strokeStyle;l=g.size;m.beginPath();m.moveTo(e.x,e.y-l);m.lineTo(e.x,e.y+l);m.moveTo(e.x-l,e.y);m.lineTo(e.x+l,e.y);m.arc(e.x,e.y,l*0.6666,0,2*Math.PI,false);m.stroke()}})},RouteOverlay:function(g){function m(c){l=[];b=[];GRUNT.Log.info("started route calc coordinates");var i=GRUNT.Log.getTraceTicks(),a,f,h=null,j,k=g.data?g.data.getGeometry():[],n=k.length,o=g.data?
g.data.getInstructions():[],q=o.length;for(a=n;a--;){f=c.getGridXYForPosition(k[a]);if(j=!h||a===0||Math.abs(f.x-h.x)+Math.abs(f.y-h.y)>g.pixelGeneralization){l.unshift(f);h=f}}GRUNT.Log.trace(n+" geometry points generalized to "+l.length+" coordinates",i);h=null;for(a=q;a--;)if(o[a].position){f=c.getGridXYForPosition(o[a].position);if(j=!h||a===0||Math.abs(f.x-h.x)+Math.abs(f.y-h.y)>g.pixelGeneralization){b.push(f);h=f}}GRUNT.Log.trace(q+" instructions generalized to "+b.length+" coordinates",i);
GRUNT.Log.info("finished route calc coordinates");e=false}g=GRUNT.extend({strokeStyle:"rgba(0, 51, 119, 0.9)",waypointFillStyle:"#FFFFFF",lineWidth:4,data:null,pixelGeneralization:8,zindex:50,validStates:SLICK.Graphics.DisplayState.GENCACHE},g);var e=true,l=[],b=[],d=GRUNT.extend(new SLICK.Graphics.ViewLayer(g),{getAnimation:function(c,i,a,f){e&&m(d.getParent().getTileLayer());return new SLICK.Graphics.AnimatedPathLayer({path:l,zindex:g.zindex+1,easing:c?c:SLICK.Animation.Easing.Sine.InOut,duration:i?
i:5E3,drawIndicator:a,autoCenter:f?f:false})},draw:function(c,i,a,f){e&&m(f.getTileLayer());a=l.length;c.strokeStyle=g.strokeStyle;c.lineWidth=g.lineWidth;c.beginPath();c.moveTo(l[a-1].x-i.x,l[a-1].y-i.y);for(a=a;a--;)c.lineTo(l[a].x-i.x,l[a].y-i.y);c.stroke();c.fillStyle=g.waypointFillStyle;for(a=b.length;a--;){c.beginPath();c.arc(b[a].x-i.x,b[a].y-i.y,2,0,Math.PI*2,false);c.stroke();c.fill()}}});GRUNT.WaterCooler.listen("grid.updated",function(){e=true;d.wakeParent()});return d},Annotation:function(g){g=
GRUNT.extend({xy:null,pos:null,draw:null,tweenIn:p.AnnotationTween},g);var m=false,e={xy:g.xy,pos:g.pos,isNew:false,isAnimating:function(){return m},draw:function(l,b){if(e.xy){if(e.isNew&&g.tweenIn){var d=e.xy.y;e.xy.y=b.y-20;m=true;SLICK.Animation.tween(e.xy,"y",d,g.tweenIn,function(){e.xy.y=d;m=false},250+Math.random()*500)}if(g.draw)g.draw(l,b,new SLICK.Vector(e.xy.x-b.x,e.xy.y-b.y));else{l.beginPath();l.arc(e.xy.x-b.x,e.xy.y-b.y,4,0,Math.PI*2,false);l.fill()}e.isNew=false}}};return e},ImageAnnotation:function(g){g=
GRUNT.extend({imageUrl:null},g);var m=null,e=new SLICK.Vector;g.draw=function(l,b,d){if(m){b=d.offset(e.x,e.y);l.drawImage(m,b.x,b.y,m.width,m.height)}};SLICK.Resources.getImage(g.imageUrl,function(l){if(m=l){e.x=-m.width>>1;e.y=-m.height>>1}});return new p.Annotation(g)},AnnotationsOverlay:function(g){function m(c){for(var i=g.map?g.map.getTileLayer():null,a=0;i&&a<c.length;a++)c[a].xy=i.getGridXYForPosition(c[a].pos)}g=GRUNT.extend({pois:null,map:null,createAnnotationForPOI:null,validStates:SLICK.Graphics.DisplayState.GENCACHE,
zindex:100},g);var e=[],l=false,b=[],d=GRUNT.extend(new SLICK.Graphics.ViewLayer(g),{draw:function(c,i){c.save();try{var a;l=false;c.fillStyle="rgba(255, 0, 0, 0.75)";c.globalCompositeOperation="source-over";for(a=e.length;a--;){e[a].draw(c,i);l=l||e[a].isAnimating()}for(a=b.length;a--;){b[a].draw(c,i);l=l||e[a].isAnimating()}if(l){d.layerChanged();d.wakeParent()}}finally{c.restore()}},add:function(c){b.push(c);m(b)},isAnimating:function(){return l}});GRUNT.WaterCooler.listen("geo.pois-updated",function(c){if(g.pois&&
g.pois.id==c.srcID){c=c.pois;try{e=[];for(var i=0;i<c.length;i++)if(c[i].pos){var a;var f=c[i];if(f&&f.pos){var h=null;if(h=g.createAnnotationForPOI?g.createAnnotationForPOI(f):new p.Annotation({pos:f.pos})){h.isNew=f.isNew;f.isNew=false}a=h}else a=void 0;a&&e.push(a)}m(e)}catch(j){GRUNT.Log.exception(j)}d.layerChanged();d.wakeParent()}});GRUNT.WaterCooler.listen("grid.updated",function(){m(e);m(b)});return d},Tiler:function(g){function m(){var k=j.getTileLayer(),n=j.getDimensions();if(k)return k.getGuideOffset(j.getOffset().offset(n.width>>
1,n.height>>1));return null}g=GRUNT.extend({tapExtent:10,provider:null,crosshair:true,copyright:undefined,zoomLevel:0,boundsChange:null,tapPOI:null,boundsChangeThreshold:30,pois:new SLICK.Geo.POIStorage,createAnnotationForPOI:null},g);if(typeof g.copyright==="undefined")g.copyright=g.provider?g.provider.getCopyright():"";var e=new SLICK.Vector,l=g.copyright,b=false,d=[],c=null,i=g.zoomLevel;if(!g.provider)g.provider=new SLICK.Geo.MapProvider;var a=g.panHandler,f=g.tapHandler;g.onPan=function(k,n){a&&
a(k,n)};g.tapHandler=function(k,n){var o=j.getTileLayer(),q=null;if(o){var r=j.viewPixToGridPix(new SLICK.Vector(n.x,n.y));q=o.pixelsToPos(r.offset(-g.tapExtent,g.tapExtent));o=o.pixelsToPos(r.offset(g.tapExtent,-g.tapExtent));q=new SLICK.Geo.BoundingBox(q.toString(),o.toString());d=j.pois.findByBounds(q);GRUNT.Log.info("TAPPED POIS = ",d);g.tapPOI&&g.tapPOI(d)}f&&f(k,n,q)};g.doubleTapHandler=function(k,n){j.animate(2,j.getDimensions().getCenter(),new SLICK.Vector(n.x,n.y),SLICK.Animation.Easing.Sine.Out)};
g.onScale=function(k,n){var o=0;k=Math.sqrt(k);if(k<1)o=-(0.5/k);else if(k>1)o=k;j.removeLayer("grid");SLICK.Resources.resetImageLoadQueue();j.gotoPosition(j.getXYPosition(n),i+Math.floor(o));GRUNT.Log.info("zoom change = "+Math.floor(o)+", new zoom level = "+(i+Math.floor(o)))};var h=new SLICK.Tiling.Tiler(g),j=GRUNT.extend({},h,{pois:g.pois,getBoundingBox:function(){var k=new SLICK.Geo.BoundingBox,n=j.getTileLayer(),o=j.getOffset(),q=j.getDimensions();if(n)k=n.getBoundingBox(o.x,o.y,q.width,q.height);
return k},getCenterPosition:function(){return j.getXYPosition(j.getDimensions().getCenter())},getXYPosition:function(k){return j.getTileLayer().pixelsToPos(j.viewPixToGridPix(k))},gotoBounds:function(k,n){var o=SLICK.Geo.getBoundingBoxZoomLevel(k,j.getDimensions());GRUNT.Log.info("BOUNDS CHANGE REQUIRED CENTER: "+k.getCenter()+", ZOOM LEVEL: "+o);j.gotoPosition(k.getCenter(),o,n)},gotoPosition:function(k,n,o){var q=i,r=2*Math.PI/(1<<i)/(2*Math.PI/(1<<n));i=n?n:i;if(!i)throw"Zoom level required to goto a position.";
if(g.provider)i=g.provider.checkZoomLevel(i);if(!b||i!=q){SLICK.Animation.cancel();if(b){j.freeze();c=m(r);GRUNT.Log.info("guide offset calculated as: "+c)}g.provider.zoomLevel=i;g.provider.getMapTiles(j,k,function(t){j.setTileLayer(t);j.panToPosition(k,function(){j.unfreeze();o&&o()})});b=true}else j.panToPosition(k,o)},panToPosition:function(k,n,o){var q=j.getTileLayer();if(q){k=q.getGridXYForPosition(k);q=j.getDimensions();k.x-=q.width>>1;k.y-=q.height>>1;if(c)c=null;j.updateOffset(k.x,k.y,o);
g.boundsChange&&g.boundsChange(j.getBoundingBox());n&&n(j)}},setZoomLevel:function(k){j.gotoPosition(j.getCenterPosition(),k)},zoomIn:function(){GRUNT.Log.info("scaling needed is "+2*Math.PI/(1<<i)/(2*Math.PI/(1<<i+1)));j.scale(2,SLICK.Animation.Easing.Sine.Out)||j.setZoomLevel(i+1)},zoomOut:function(){GRUNT.Log.info("scaling needed is "+2*Math.PI/(1<<i)/(2*Math.PI/(1<<i-1)));j.scale(0.5,SLICK.Animation.Easing.Sine.Out)||j.setZoomLevel(i-1)},animateRoute:function(k,n,o,q){var r=j.getLayer("route");
r&&r.getAnimation(k,n,o,q).addToView(j)}},h);h=new SLICK.Mapping.AnnotationsOverlay({pois:j.pois,map:j,createAnnotationForPOI:g.createAnnotationForPOI});j.setLayer("annotations",h);g.crosshair&&j.setLayer("crosshair",new SLICK.Mapping.CrosshairOverlay);l&&j.setLayer("copyright",new SLICK.Graphics.ViewLayer({zindex:999,draw:function(k,n,o){k.lineWidth=2.5;k.fillStyle="rgb(50, 50, 50)";k.strokeStyle="rgba(255, 255, 255, 0.8)";k.font="bold 10px sans";k.textBaseline="bottom";k.strokeText(l,10,o.height-
10);k.fillText(l,10,o.height-10)}}));GRUNT.WaterCooler.listen("view-idle",function(k){if(k.id&&k.id==j.id)if(e.diff(j.getOffset()).getAbsSize()>g.boundsChangeThreshold&&g.boundsChange){e=j.getOffset();g.boundsChange(j.getBoundingBox())}});return j}};return p}();
SLICK.Geo.Routing=function(){var p={calculate:function(g){g=GRUNT.extend({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null},g);GRUNT.Log.info("attempting to calculate route");var m=SLICK.Geo.getEngine("route");m&&m.route(g,function(e){if(g.map){p.createMapOverlay(g.map,e);if(g.autoFit){GRUNT.Log.info("AUTOFITTING MAP TO ROUTE: bounds = "+e.getBoundingBox());g.map.gotoBounds(e.getBoundingBox())}}g.success&&g.success(e)})},createMapOverlay:function(g,m){var e=g.getDimensions();
e=new SLICK.Mapping.RouteOverlay({data:m,width:e.width,height:e.height});g.setLayer("route",e)},Maneuver:{None:0,Continue:1,TurnLeft:100,TurnLeftSlight:101,TurnLeftSharp:102,TurnRight:110,TurnRightSlight:111,TurnRightSharp:112,TurnAround:190,EnterRoundabout:200,ExitRamp:300},Instruction:function(g){g=GRUNT.extend({position:null,description:"",manuever:p.Maneuver.None},g);return GRUNT.extend(g,{})},RouteData:function(g){g=GRUNT.extend({geometry:[],instructions:[],boundingBox:null},g);for(var m=Array(g.geometry.length),
e=g.boundingBox,l=0;l<g.geometry.length;l++)m[l]=new SLICK.Geo.Position(g.geometry[l]);e||(e=SLICK.Geo.getBoundsForPositions(m));return{getGeometry:function(){return m},getBoundingBox:function(){return e},getInstructions:function(){return g.instructions}}}};return p}();
