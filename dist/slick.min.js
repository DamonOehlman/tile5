if(!this.JSON)this.JSON={};
(function(){function p(a){return a<10?"0"+a:a}function l(a){j.lastIndex=0;return j.test(a)?'"'+a.replace(j,function(e){var g=d[e];return typeof g==="string"?g:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function k(a,e){var g,i,m,q,r=b,n,o=e[a];if(o&&typeof o==="object"&&typeof o.toJSON==="function")o=o.toJSON(a);if(typeof h==="function")o=h.call(e,a,o);switch(typeof o){case "string":return l(o);case "number":return isFinite(o)?String(o):"null";case "boolean":case "null":return String(o);
case "object":if(!o)return"null";b+=c;n=[];if(Object.prototype.toString.apply(o)==="[object Array]"){q=o.length;for(g=0;g<q;g+=1)n[g]=k(g,o)||"null";m=n.length===0?"[]":b?"[\n"+b+n.join(",\n"+b)+"\n"+r+"]":"["+n.join(",")+"]";b=r;return m}if(h&&typeof h==="object"){q=h.length;for(g=0;g<q;g+=1){i=h[g];if(typeof i==="string")if(m=k(i,o))n.push(l(i)+(b?": ":":")+m)}}else for(i in o)if(Object.hasOwnProperty.call(o,i))if(m=k(i,o))n.push(l(i)+(b?": ":":")+m);m=n.length===0?"{}":b?"{\n"+b+n.join(",\n"+b)+
"\n"+r+"}":"{"+n.join(",")+"}";b=r;return m}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+p(this.getUTCMonth()+1)+"-"+p(this.getUTCDate())+"T"+p(this.getUTCHours())+":"+p(this.getUTCMinutes())+":"+p(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var f=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
j=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,b,c,d={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},h;if(typeof JSON.stringify!=="function")JSON.stringify=function(a,e,g){var i;c=b="";if(typeof g==="number")for(i=0;i<g;i+=1)c+=" ";else if(typeof g==="string")c=g;if((h=e)&&typeof e!=="function"&&(typeof e!=="object"||typeof e.length!=="number"))throw Error("JSON.stringify");return k("",
{"":a})};if(typeof JSON.parse!=="function")JSON.parse=function(a,e){function g(m,q){var r,n,o=m[q];if(o&&typeof o==="object")for(r in o)if(Object.hasOwnProperty.call(o,r)){n=g(o,r);if(n!==undefined)o[r]=n;else delete o[r]}return e.call(m,q,o)}var i;a=String(a);f.lastIndex=0;if(f.test(a))a=a.replace(f,function(m){return"\\u"+("0000"+m.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){i=eval("("+a+")");return typeof e==="function"?g({"":i},""):i}throw new SyntaxError("JSON.parse");}})();if(!String.format)String.format=function(p){if(arguments.length<=1)return p;for(var l=arguments.length-2,k=0;k<=l;k++)p=p.replace(RegExp("\\{"+k+"\\}","gi"),arguments[k+1]);return p};
String.prototype.containsWord=function(p){var l="";if(p.toString)p=p.toString();for(var k=0;k<p.length;k++)l+=!/\w/.test(p[k])?"\\"+p[k]:p[k];return RegExp("(^|\\s|\\,)"+l+"(\\,|\\s|$)","i").test(this)};Number.prototype.toRad=function(){return this*Math.PI/180};Number.prototype.sec=function(){return 1/Math.cos(this)};
GRUNT=function(){var p=Object.prototype.hasOwnProperty,l=0,k={id:"GRUNT.core",extend:function(){var f=arguments[0]||{},j=1,b=arguments.length,c=false,d,h,a,e;if(typeof f==="boolean"){c=f;f=arguments[1]||{};j=2}if(typeof f!=="object"&&!k.isFunction(f))f={};if(b===j){f=this;--j}for(;j<b;j++)if((d=arguments[j])!=null)for(h in d){a=f[h];e=d[h];if(f!==e)if(c&&e&&(k.isPlainObject(e)||k.isArray(e))){a=a&&(k.isPlainObject(a)||k.isArray(a))?a:k.isArray(e)?[]:{};f[h]=k.extend(c,a,e)}else if(e!==undefined)f[h]=
e}return f},isFunction:function(f){return toString.call(f)==="[object Function]"},isArray:function(f){return toString.call(f)==="[object Array]"},isPlainObject:function(f){if(!f||toString.call(f)!=="[object Object]"||f.nodeType||f.setInterval)return false;if(f.constructor&&!p.call(f,"constructor")&&!p.call(f.constructor.prototype,"isPrototypeOf"))return false;var j;for(j in f);return j===undefined||p.call(f,j)},isEmptyObject:function(f){for(var j in f)return false;return true},isXmlDocument:function(f){return toString.call(f)===
"[object Document]"},contains:function(f,j){var b=f,c=arguments,d=1;if(j&&k.isArray(j)){c=j;d=0}for(d=d;d<c;d++)b=b&&typeof foo[c[d]]!=="undefined";return b},newModule:function(f){f=k.extend({id:null,requires:[],parent:null},f);if(f.parent)f=k.extend({},f.parent,f);return f},toID:function(f){return f.replace(/\s/g,"-")},generateObjectID:function(f){return(f?f:"obj")+l++}};return k}();
GRUNT.Log=function(){function p(b,c){var d,h=c&&c.length>0?c[0]:"";for(d=1;c&&d<c.length;d++)h+=" "+(k&&GRUNT.isPlainObject(c[d])?JSON.stringify(c[d]):c[d]);typeof console!=="undefined"&&console[b](h);for(d=0;d<l.length;d++)l[d].call(j,h,b)}var l=[],k=typeof JSON!=="undefined",f=window.console&&window.console.markTimeline,j={id:"GRUNT.log",getTraceTicks:function(){return f?(new Date).getTime():null},trace:function(b,c){if(f)console.markTimeline(b+(c?": "+(j.getTraceTicks()-c)+"ms":""))},debug:function(){p("debug",
arguments)},info:function(){p("info",arguments)},warn:function(){p("warn",arguments)},error:function(){p("error",arguments)},exception:function(b){j.error(arguments);for(var c in b)j.info("ERROR DETAIL: "+c+": "+b[c])},watch:function(b,c){try{c()}catch(d){j.exception(d,b)}},throwError:function(b){j.error(b);throw Error(b);},requestUpdates:function(b){l.push(b)}};return j}();
GRUNT.Data=function(){var p={determineObjectMapping:function(k){if(!k)return null;k=k.split("|");for(var f={},j=0;j<k.length;j++)f[k[j]]=j;return f},mapLineToObject:function(k,f){var j=k.split("|"),b={};for(var c in f){var d=f[c];b[c]=j.length>d?j[d]:null}return b},parse:function(k){var f=null,j=[];k=k.split("\n");for(var b=0;b<k.length;b++){var c=k[b];if(f)j.push(p.mapLineToObject(c,f));else f=p.determineObjectMapping(c)}return j}},l={supportedFormats:{JSON:{parse:function(k){return JSON.parse(k)}},
PDON:{parse:function(k){return p.parse(k)}}},parse:function(k){k=GRUNT.extend({data:"",format:"JSON"},k);if(!l.supportedFormats[k.format])throw Error("Unsupported data format: "+k.format+", cannot parse data in javascript object");try{return l.supportedFormats[k.format].parse(k.data)}catch(f){GRUNT.Log.error("ERROR PARSING DATA FROM FORMAT: "+k.format,k.data);GRUNT.Log.exception(f)}return{}}};return l}();
GRUNT.Template=function(){var p=/\$\{(.*?)\}/ig;return{parse:function(l,k){for(var f=l,j=p.exec(f);j;){f=f.replace(j[0],GRUNT.XPath.first(j[1],k));p.lastIndex=0;j=p.exec(f)}return f}}}();
GRUNT.JSONP=function(){function p(j){var b=document.createElement("script"),c=false;b.src=j;b.async=true;b.onload=b.onreadystatechange=function(){if(!c&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){c=true;b.onload=b.onreadystatechange=null;b&&b.parentNode&&b.parentNode.removeChild(b)}};k||(k=document.getElementsByTagName("head")[0]);k.appendChild(b)}var l=0,k,f=this;return{get:function(j,b){j+=j.indexOf("?")>=0?"&":"?";var c="json"+ ++l;f[c]=function(d){b(d);f[c]=
null;try{delete f[c]}catch(h){}};p(j+"callback="+c);return c}}}();
GRUNT.XHR=function(){var p={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},l={JSON:["json"],PDON:["pdon.txt"]},k=["TEXT","STREAM"],f=/^(\w+:)?\/\/([^\/?#]+)/,j={XML:function(d){return d.responseXML},JSON:function(d){try{return JSON.parse(d.responseText)}catch(h){GRUNT.Log.error("Error parsing JSON data: ",d.responseText);GRUNT.Log.exception(h)}return""},PDON:function(d){return GRUNT.Data.parse({data:d.responseText,format:"PDON"})},DEFAULT:function(d){return d.responseText}},
b={CONTENT_TYPE:"Content-Type"},c=GRUNT.newModule({id:"GRUNT.xhr",ajaxSettings:{xhr:null},ajax:function(d){try{d=GRUNT.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},c.ajaxSettings,d);var h=f.exec(d.url),a=h&&(h[1]&&h[1]!==location.protocol||h[2]!==location.host);if(d.data)d.method="POST";if(d.url){h=null;if(d.xhr)h=d.xhr(d);h||(h=new XMLHttpRequest);h.open(d.method,d.url,d.async);d.data&&h.setRequestHeader("Content-Type",
d.contentType);a||h.setRequestHeader("X-Requested-With","XMLHttpRequest");h.onreadystatechange=function(){if(this.readyState===4){var g=null,i=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(i)if(d.handleResponse)d.handleResponse(this);else{var m=d,q=this.getResponseHeader(b.CONTENT_TYPE),r,n=false;for(r in p)if(q&&q.indexOf(p[r])>=0){n=true;break}q=!n;for(n=0;n<k.length;n++)q=q||k[n]==r;if(q)b:{q=r;for(var o in l)for(n=
0;n<l[o].length;n++)if(RegExp(l[o][n]+"$","i").test(m.url)){r=o;break b}r=q?q:"DEFAULT"}try{g=j[r](this,m)}catch(s){GRUNT.Log.warn("error applying processor '"+r+"' to response type, falling back to default");g=j.DEFAULT(this,m)}}else d.error&&d.error(this)}catch(u){GRUNT.Log.exception(u,"PROCESSING AJAX RESPONSE")}i&&g&&d.success&&d.success.call(this,g)}};h.send(d.method=="POST"?c.param(d.data):null)}else GRUNT.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(e){GRUNT.Log.exception(e)}},
param:function(d){var h=[],a=function(g,i){i=GRUNT.isFunction(i)?i():i;h[h.length]=encodeURIComponent(g)+"="+encodeURIComponent(i)};if(GRUNT.isArray(d))for(var e=0;e<d.length;e++)a(d[e].name,d[e].value);else for(e in d)a(e,d[e]);return h.join("&").replace(/%20/g,"+")}});return c}();
GRUNT.XPath=function(){function p(j){for(var b=null,c=0;c<l.length;c++)if(b=l[c](j))break;return b}var l=[],k=[null,function(j){return j.numberValue},function(j){return j.stringValue},function(j){return j.booleanValue},null,null,null,null,function(j){return j.singleNodeValue?j.singleNodeValue.textContent:null},function(j){return j.singleNodeValue?j.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||GRUNT.Log.warn("No XPATH support, this is going to cause problems");var f={SearchResult:function(j){return{toString:function(){var b=
null;if(j){var c=null;if(j.resultType>=0&&j.resultType<k.length)c=k[j.resultType];if(c){GRUNT.Log.info("invoking match handler for result type: "+j.resultType);b=c(j)}}return b?b:""}}},first:function(j,b){var c=f.SearchResult,d;var h=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!h)h=XPathResult.ANY_TYPE;try{if(GRUNT.isXmlDocument(b))d=b.evaluate(j,b,p,h,null);else{GRUNT.Log.warn("attempted xpath expression: "+j+" on a non-xml document");d=null}}catch(a){GRUNT.Log.warn("attempted to run invalid xpath expression: "+
j+" on node: "+b);d=null}return new c(d)},registerResolver:function(j){l.push(j)}};return f}();GRUNT.WaterCooler=function(){var p={};return{listen:function(l,k){p[l]||(p[l]=[]);k&&p[l].push(k)},say:function(l,k){if(p[l])for(var f=0;f<p[l].length;f++)p[l][f](k)},leave:function(){}}}();
SLICK=function(){function p(){l={base:{name:"Unknown",eventTarget:document,supportsTouch:"createTouch"in document,imageCacheMaxSize:4096,getScaling:function(){return 1},maxImageLoads:4,requireFastDraw:false},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:true},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144},android:{name:"Android OS <= 2.1",regex:/android/i,eventTarget:document.body,
supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio}},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true}};k=[l.froyo,l.android,l.ipod,l.iphone,l.ipad]}var l=null,k=[],f=null,j={getDeviceConfig:function(){l||p();if(!f){GRUNT.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var b=0;b<k.length;b++){var c=k[b];if(c.regex&&c.regex.test(navigator.userAgent)){f=GRUNT.extend({},l.base,c);GRUNT.Log.info("PLATFORM DETECTED AS: "+
f.name);break}}if(!f){GRUNT.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");f=l.base}GRUNT.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return f},copyRect:function(b){return b?new j.Rect(b.origin.x,b.origin.y,b.dimensions.width,b.dimensions.height):null},Settings:function(){var b={};return{get:function(c){return b[c]},set:function(c,d){b[c]=d},extend:function(c){GRUNT.extend(b,c)}}}(),Clock:function(){var b=null;return{getTime:function(c){return c&&b?b:
b=(new Date).getTime()}}}(),Vector:function(b,c){return{x:b?b:0,y:c?c:0}},V:function(){return{create:function(b,c){return new j.Vector(b,c)},add:function(){for(var b=new j.Vector,c=arguments.length;c--;){b.x+=arguments[c].x;b.y+=arguments[c].y}return b},absSize:function(b){return Math.max(Math.abs(b.x),Math.abs(b.y))},diff:function(b,c){return new j.Vector(b.x-c.x,b.y-c.y)},copy:function(b){return b?new j.Vector(b.x,b.y):null},invert:function(b){return new SLICK.Vector(-b.x,-b.y)},offset:function(b,
c,d){return new SLICK.Vector(b.x+c,b.y+(d?d:c))}}}(),VectorArray:function(b,c){for(var d=Array(b.length),h=b.length;h--;)d[h]=c?j.V.copy(b[h]):b[h];return{applyOffset:function(a){for(var e=d.length;e--;){d[e].x+=a.x;d[e].y+=a.y}},getRect:function(){return new SLICK.Rect(Math.min(d[0].x,d[1].x),Math.min(d[0].y,d[1].y),Math.abs(d[0].x-d[1].x),Math.abs(d[0].y-d[1].y))},toString:function(){for(var a="",e=d.length;e--;)a+="["+d[e].toString()+"] ";return a}}},VectorMath:function(){function b(c){if(!c||
c.length<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var d={edges:Array(c.length-1),accrued:Array(c.length-1),total:0},h=SLICK.V.diff,a=0;a<c.length-1;a++){var e=h(c[a],c[a+1]);d.edges[a]=Math.sqrt(e.x*e.x+e.y*e.y);d.accrued[a]=d.total+d.edges[a];d.total+=d.edges[a]}return d}return{edges:b,distance:function(c){return b(c).total},theta:function(c,d,h){h=Math.asin((c.y-d.y)/h);return c.x>d.x?h:Math.PI-h},pointOnEdge:function(c,d,h,a){d=new SLICK.Vector(Math.cos(h)*
a,Math.sin(h)*a);return new SLICK.Vector(c.x-d.x,c.y-d.y)}}}(),Dimensions:function(b,c){var d=c?b/c:1,h={width:b,height:c,aspect_ratio:d,inv_aspect_ratio:1/d,getAspectRatio:function(){return h.height!==0?h.width/h.height:1},getCenter:function(){return new SLICK.Vector(h.width>>1,h.height>>1)},grow:function(a,e){return new SLICK.Dimensions(h.width+a,h.height+e)},matches:function(a){return a&&h.width==a.width&&h.height==a.height},toString:function(){return h.width+" x "+h.height}};return h},Rect:function(b,
c,d,h){var a={origin:new SLICK.Vector(b,c),dimensions:new SLICK.Dimensions(d,h),getCenter:function(){return new SLICK.Vector(a.origin.x+(a.dimensions.width>>1),a.origin.y+(a.dimensions.height>>1))},getSize:function(){return Math.sqrt(Math.pow(a.dimensions.width,2)+Math.pow(a.dimensions.height,2))},grow:function(e,g){var i=new SLICK.Dimensions(e-a.dimensions.width,g-a.dimensions.height);a.dimensions.width=e;a.dimensions.height=g;return i},expand:function(e,g){a.origin.x-=e;a.origin.y-=g;a.dimensions.width+=
e;a.dimensions.height+=g},offset:function(e){return new j.Rect(a.origin.x+e.x,a.origin.y+e.y,a.dimensions.width,a.dimensions.height)},getRequiredDelta:function(e,g){var i={top:0,left:0,bottom:0,right:0};i.top=e.origin.y-a.origin.y+(g?g.y:0);i.left=e.origin.x-a.origin.x+(g?g.x:0);i.right=e.origin.x+e.dimensions.width-(a.origin.x+a.dimensions.width)-i.left;i.bottom=e.origin.y+e.dimensions.height-(a.origin.y+a.dimensions.height)-i.top;return i},applyDelta:function(e,g,i){if(!e||!GRUNT.contains(e,["top",
"left","bottom","right"]))throw Error("Invalid delta - cannot apply to SLICK.Rect");g||(g=1);a.origin.x+=e.left*g;a.origin.y+=e.top*g;a.dimensions.width+=e.right*g;a.dimensions.height+=e.bottom*g;i&&a.constrainAspectRatio(i)},constrainAspectRatio:function(e){var g=0,i={top:0,left:0,bottom:0,right:0};if(a.dimensions.getAspectRatio()<e){g=Math.abs(a.dimensions.width-a.dimensions.height*e);i.left=-g;i.right=g}else{g=Math.abs(a.dimensions.height-a.dimensions.width/e);i.top=-g;i.bottom=g}a.applyDelta(i)},
moveTo:function(e,g){var i=new SLICK.Vector(e-a.origin.x,g-a.origin.y);a.origin.x=e;a.origin.y=g;return i},toString:function(){return String.format("(origin: {0}, dimensions: {1})",a.origin,a.dimensions)}};return a}};return j}();
SLICK.Resources=function(){var p="",l={},k=function(){function j(){var n=h[this.id];if(n){n.loaded=true;n.hitCount=1;for(var o=g.length;o--;)if(g[o].image.src==this.src){g.splice(o,1);break}n.loadCallback&&n.loadCallback(this,false);i.push({url:this.src,created:n.requested});delete h[this.id];b()}}function b(){for(var n=SLICK.getDeviceConfig().maxImageLoads;e.length>0&&(!n||g.length<n);){var o=e.shift();g.push(o);o.image.onload=j;o.image.src=o.url;o.requested=(new Date).getTime()}}function c(){q=
true;try{var n=Math.floor(i.length*0.5);if(n>0){i.sort(function(s,u){return s.created-u.created});for(var o=n;o--;)delete d[i[o].url];i.splice(0,n)}}finally{q=false}GRUNT.WaterCooler.say("imagecache.cleared")}var d={},h={},a=0,e=[],g=[],i=[],m=0,q=false,r={loadingImages:g,queuedImages:e,getCacheFullness:function(){return m},getImage:function(n){var o=null;q||(o=d[n]);return o?o.image:null},loadImage:function(n,o){var s=d[n];if(s){s.hitCount++;s.image.complete&&o&&o(s.image,true)}else{s={url:f.getPath(n),
image:new Image,loaded:false,created:(new Date).getTime(),requested:null,hitCount:0,loadCallback:o};s.image.id="resourceLoaderImage"+a++;d[n]=s;h[s.image.id]=s;e.push(s);b()}return s},resetLoadingQueue:function(){g=[]}};setInterval(function(){for(var n=(new Date).getTime(),o=false,s=0,u=SLICK.getDeviceConfig();s<g.length;)if(n-g[s].requested>f.loadTimeout*1E3){g.splice(s,1);o=true}else s++;o&&b();if(u&&u.imageCacheMaxSize){m=i.length*f.avgImageSize/u.imageCacheMaxSize;m>=1&&c()}},1E3);return r}(),
f={avgImageSize:25,loadTimeout:10,Cache:function(){return{read:function(){return null},write:function(){},getUrlCacheKey:function(j,b){for(var c=(j?j.replace(/^.*\?/,""):"").split("&"),d=j?j.replace(/\?.*$/,"?"):"",h=0;h<c.length;h++){var a=c[h].split("=");if(!b||!b.test(a[0]))d+=c[h]+"&"}return d.replace(/\W/g,"")},isValidCacheKey:function(j){GRUNT.Log.info("cache key = "+j);return false}}}(),getCachedUrl:function(j){return j},getPath:function(j){return/^(https?|\/)/.test(j)?j:p+j},setBasePath:function(j){p=
j},getImage:function(j){return k.getImage(j)},loadImage:function(j,b){k.loadImage(j,b)},resetImageLoadQueue:function(){k.resetLoadingQueue()},getStats:function(){return{imageLoadingCount:k.loadingImages.length,queuedImageCount:k.queuedImages.length,imageCacheFullness:k.getCacheFullness()}},loadResource:function(j){j=GRUNT.extend({filename:"",cacheable:true,dataType:null,callback:null},j);var b=function(c){j.callback&&GRUNT.Log.watch("CALLING RESOURCE CALLBACK",function(){j.callback(c)})};j.cacheable&&
l[j.filename]?b(l[j.filename]):GRUNT.XHR.ajax({url:f.getPath(j.filename),dataType:j.dataType,success:function(c){if(j.cacheable)l[j.filename]=c;b(c)},error:function(c,d,h){GRUNT.Log.error("error loading resource ["+j.filename+"], error = "+h)}})},loadSnippet:function(j,b){/\.\w+$/.test(j)||(j+=".html");f.loadResource({filename:"snippets/"+j,callback:b,dataType:"html"})}};return f}();
SLICK.Touch=function(){function p(a,e){var g=a&&a.length>0?a[0]:null;if(g&&e&&e.length>0)return SLICK.V.diff(g,e[0]);return null}function l(a){a.preventDefault();a.stopPropagation()}function k(a,e){function g(q,r){for(var n=a[r],o=0;n&&o<n.length;o++)q.push(new SLICK.Vector(n[o].pageX,n[o].pageY))}e||(e=j);for(var i=[],m=0;m<e.length;m++){g(i,e[m]);if(i.length>0)break}i.length===0&&i.push(new SLICK.Vector(a.pageX,a.pageY));return i}var f={GLOBAL:"touches",TARGET:"targetTouches",CHANGED:"changedTouches"},
j=[f.GLOBAL,f.TARGET],b={TAP:0,MOVE:1,PINCHZOOM:2},c=0,d={TouchHelper:function(a){function e(t){t=new SLICK.VectorArray(t,true);a.element&&t.applyOffset(new SLICK.Vector(-a.element.offsetLeft,-a.element.offsetTop));return t}function g(t){var y=[],A=0;for(A=1;A<arguments.length;A++)y.push(arguments[A]);for(A=0;A<x.length;A++)x[A][t]&&x[A][t].apply(D,y)}a=GRUNT.extend({element:null,inertiaTrigger:20,maxDistDoubleTap:20,panEventThreshhold:0,pinchZoomThreshold:5,touchStartHandler:null,moveHandler:null,
moveEndHandler:null,pinchZoomHandler:null,pinchZoomEndHandler:null,tapHandler:null,doubleTapHandler:null,wheelZoomHandler:null},a);var i=false,m=0,q=null,r=null,n=null,o=null,s=new SLICK.Vector,u=null,C=false,x=[],E={current:0,last:0},B=SLICK.getDeviceConfig(),D={supportsTouch:SLICK.getDeviceConfig().supportsTouch,THRESHOLD_DOUBLETAP:300,addListeners:function(t){x.push(t)},wheelie:function(t){var y=new SLICK.Vector(t.wheelDeltaX,t.wheelDeltaY);t=new SLICK.Vector(t.clientX,t.clientY);var A=y.y!==0?
Math.abs(y.y/120):0;if(A!==0)g("wheelZoomHandler",t,y.y>0?A+0.5:0.5/A);GRUNT.Log.info("capture mouse wheel event, delta = "+y+", position = "+t)}};B.eventTarget.addEventListener(B.supportsTouch?"touchstart":"mousedown",function(t){q=k(t);n=new SLICK.Vector;o=new SLICK.Vector;C=true;i=false;if(t.target&&t.target===a.element){l(t);E.current=SLICK.Clock.getTime();if(t=q.length>0?q[0]:null){g("touchStartHandler",t.x,t.y);if(E.current-E.last<D.THRESHOLD_DOUBLETAP)if((t=r?SLICK.V.diff(q[0],r[0]):null)&&
Math.abs(t.x)<a.maxDistDoubleTap&&Math.abs(t.y)<a.maxDistDoubleTap)i=true;u=b.TAP;r=[].concat(q)}else GRUNT.Log.warn("Touch start fired, but no touch vector found")}},false);B.eventTarget.addEventListener(B.supportsTouch?"touchmove":"mousemove",function(t){if(C)if(t.target&&t.target===a.element)try{l(t);var y=k(t);t=0;if(y.length>1){if(q.length===1)q=[].concat(y);t=SLICK.VectorMath.distance(q)-SLICK.VectorMath.distance(r)}if(u===b.TAP){var A=p(y,q);if(A&&(Math.abs(A.x)>=7||Math.abs(A.y)>=7))u=b.MOVE}if(u!==
b.TAP)if(!t||Math.abs(t)<a.pinchZoomThreshold){n=p(y,r);o.x+=n.x;o.y+=n.y;s.x+=n.x;s.y+=n.y;if(SLICK.V.absSize(s)>a.panEventThreshhold){g("moveHandler",s.x,s.y);s=SLICK.V.create()}u=b.MOVE}else{g("pinchZoomHandler",e(q),e(y));u=b.PINCHZOOM}r=[].concat(y)}catch(J){GRUNT.Log.exception(J)}},false);B.eventTarget.addEventListener(B.supportsTouch?"touchend":"mouseup",function(t){if(t.target&&t.target===a.element)try{l(t);SLICK.Clock.getTime();E.last=E.current;if(u===b.TAP)m||(m=setTimeout(function(){m=
0;var A=i?"doubleTapHandler":"tapHandler",J=q[0],G=null;if(a.element)G=SLICK.V.offset(J,-a.element.offsetLeft,-a.element.offsetTop);g(A,J,G)},D.THRESHOLD_DOUBLETAP+50));else if(u==b.MOVE)g("moveEndHandler",o.x,o.y);else u==b.PINCHZOOM&&g("pinchZoomEndHandler",e(q),e(r));C=false}catch(y){GRUNT.Log.exception(y)}},false);return D}},h=[];return{captureTouch:function(a,e){try{if(!a)throw Error("Unable to capture touch of null element");if(!a.id)a.id="touchable_"+c++;var g=h[a.id];if(!g){g=d.TouchHelper(GRUNT.extend({element:a},
e));h[a.id]=g;GRUNT.Log.info("CREATED TOUCH HELPER. SUPPORTS TOUCH = "+g.supportsTouch)}g.addListeners(e)}catch(i){GRUNT.Log.exception(i)}}}}();if(typeof jQuery!=="undefined"){jQuery.fn.canTouchThis=function(p){return this.each(function(){SLICK.Touch.captureTouch(this,p)})};jQuery.fn.untouchable=function(){return this.bind("touchmove",function(p){p.preventDefault()})}}
SLICK.Pannable=function(p){p=GRUNT.extend({container:null,onPan:null,onPanEnd:null,onAnimate:null,checkOffset:null},p);var l=false,k=new SLICK.Vector,f={pannable:true,getOffset:function(){return new SLICK.Vector(k.x,k.y)},setOffset:function(b,c){k.x=b;k.y=c},pan:function(b,c,d){if(d)f.updateOffset(k.x+b,k.y+c,d);else{f.updateOffset(k.x+b,k.y+c);p.onPan&&p.onPan(b,c)}},isAnimating:function(){return l},panEnd:function(b,c){p.onPanEnd&&p.onPanEnd(b,c)},updateOffset:function(b,c,d){if(d){b=new SLICK.Vector(b,
c);l=true;d=SLICK.Animation.tweenVector(k,b.x,b.y,d,function(){l=false;f.panEnd(0,0)});for(b=d.length;b--;){d[b].cancelOnInteract=true;d[b].requestUpdates(function(){p.onAnimate&&p.onAnimate(k.x,k.y)})}}else f.setOffset(b,c)}},j=document.getElementById(p.container);j&&SLICK.Touch.captureTouch(j,{moveHandler:function(b,c){f.pan(-b,-c)},moveEndHandler:function(b,c){f.panEnd(b,c)}});return f};
SLICK.Scalable=function(p){function l(i,m){f=i.getRect();j=m.getRect();var q=f.getSize(),r=j.getSize();a=j.getCenter();b=f&&q!==0?r/q:1}p=GRUNT.extend({container:null,onAnimate:null,onPinchZoom:null,onScale:null,scaleDamping:false},p);var k=false,f=null,j=null,b=1,c=null,d=null,h=null,a=null,e={scalable:true,animate:function(i,m,q,r,n){function o(){n&&n();k=false;p.onScale&&p.onScale(b,a);b=1;c=null}k=true;h=SLICK.V.copy(m);a=SLICK.V.copy(q);f=null;if(r){d=b;SLICK.Animation.tweenValue(0,i-d,r,o,1E3).requestUpdates(function(s){c=
s/(i-d);b=d+s;p.onAnimate&&p.onAnimate()})}else{b=i;o()}},getScaleInfo:function(){return{factor:b,startRect:SLICK.copyRect(f),endRect:SLICK.copyRect(j),start:h,center:a,progress:c}},getScaling:function(){return k},getScaleFactor:function(){return b}},g=document.getElementById(p.container);g&&SLICK.Touch.captureTouch(g,{pinchZoomHandler:function(i,m){l(i,m);(k=b!==1)&&p.onPinchZoom&&p.onPinchZoom(i,m)},pinchZoomEndHandler:function(i,m){l(i,m);k=false;p.onScale&&p.onScale(b,a,true);b=1},wheelZoomHandler:function(i){f=
j=null;a=SLICK.V.copy(i)}});return e};
SLICK.Dispatcher=function(){var p=[],l={execute:function(k){var f=l.findAction(k);GRUNT.Log.info("looking for action id: "+k+", found: "+f);if(f){var j=[].concat(arguments).slice(0,1);GRUNT.Log.watch("EXECUTING ACTION: "+k,function(){f.execute(j)})}},findAction:function(k){for(var f=p.length;f--;)if(p[f].id==k)return p[f];return null},getRegisteredActions:function(){return[].concat(p)},getRegisteredActionIds:function(){for(var k=[],f=p.length;f--;)p[f].id&&k.push(p[f].id);return k},registerAction:function(k){k&&
k.id&&p.push(k)},Action:function(k){k=GRUNT.extend({autoRegister:true,id:"",title:"",icon:"",execute:null},k);var f={id:k.id,execute:function(){k.execute&&k.execute.apply(this,arguments)},getParam:function(j){return k[j]?k[j]:""},toString:function(){return String.format("{0} [title = {1}, icon = {2}]",f.id,k.title,k.icon)}};k.autoRegister&&l.registerAction(f);return f},createAgent:function(k){k=GRUNT.extend({name:"Untitled",trashOrphanedResults:true,translator:null,execute:null},k);var f=null,j={getName:function(){return k.name},
getParam:function(b){return k[b]},getId:function(){return GRUNT.toID(j.getName())},run:function(b,c){if(k.execute){var d=f=SLICK.Clock.getTime(true),h=k.translator?k.translator(b):b;k.execute.call(j,h,function(a,e){if(!k.trashOrphanedResults||d==f)c&&c(a,e,h)})}}};return j},runAgents:function(k,f,j){for(var b=0;b<k.length;b++)k[b].run(f,j)}};return l}();
SLICK.Messaging=function(){var p=[],l=[],k=GRUNT.newModule({id:"slick.messaging",requires:["slick.core"],STATUS:{none:0,created:1,updated:2,handled:3},send:function(f){f=GRUNT.extend({type:"",payload:{},index:0,status:k.STATUS.created,statusChange:null},f);f.index=l.push(f)-1;f=f.index;var j=f>=0&&f<l.length?l[f]:null;GRUNT.Log.info("firing message update, index = "+f+", message = "+j);for(var b=0;j&&b<p.length&&j.status!==k.STATUS.handled;){var c=p[b].processUpdate(l[f]);if(c){c=c;p[b].getId();var d=
f>=0&&f<l.length?l[f]:null;if(d){d.status=c;d.statusChange&&d.statusChange(d)}}b++}},Handler:function(f){f=GRUNT.extend({id:"",processUpdate:null},f);var j={getId:function(){return f.id},processUpdate:function(b){if(f.processUpdate)return f.processUpdate(b);return k.STATUS.none}};p.push(j);return j}});return k}();
SLICK.Animation=function(){function p(){if(f===0)f=setInterval(function(){if(j.update(SLICK.Clock.getTime())===0){clearInterval(f);f=0}},20)}var l=[],k=false,f=0,j={DURATION:2E3,tweenValue:function(b,c,d,h,a){b=new j.Tween({startValue:b,endValue:c,tweenFn:d,complete:h,duration:a});l.push(b);return b},tween:function(b,c,d,h,a,e){b=new j.Tween({target:b,property:c,endValue:d,tweenFn:h,duration:e,complete:a});l.push(b);return b},tweenVector:function(b,c,d,h,a,e){var g=[];if(b){var i=b.x==c,m=b.y==d;
i||g.push(j.tween(b,"x",c,h,function(){(i=true)&&m&&a()},e));m||g.push(j.tween(b,"y",d,h,function(){m=true;i&&m&&a()},e))}return g},cancel:function(b){if(!k){k=true;try{for(var c=0;c<l.length;)if(!b||b(l[c])){GRUNT.Log.info("CANCELLING ANIMATION");l[c].triggerComplete(true);l.splice(c,1)}else c++}finally{k=false}}},isTweening:function(){return l.length>0},update:function(b){if(k)return l.length;k=true;try{for(var c=0;c<l.length;)if(l[c].isComplete()){l[c].triggerComplete(false);l.splice(c,1);GRUNT.WaterCooler.say("animation.complete")}else{l[c].update(b);
c++}}finally{k=false}return l.length},Tween:function(b){b=GRUNT.extend({target:null,property:null,startValue:0,endValue:null,duration:j.DURATION,tweenFn:j.DEFAULT,complete:null,cancelOnInteract:false},b);var c=SLICK.Clock.getTime(),d=[],h=false,a=0,e=0,g={cancelOnInteract:b.cancelOnInteract,isComplete:function(){return h},triggerComplete:function(i){b.complete&&b.complete(i)},update:function(i){try{var m=b.tweenFn(i-c,a,e,b.duration);if(b.target)b.target[b.property]=m;for(var q=d.length;q--;)d[q](m,
void 0);if(h=c+b.duration<=i){if(b.target)b.target[b.property]=b.tweenFn(b.duration,a,e,b.duration);for(var r=d.length;r--;)d[r](m,true)}}catch(n){GRUNT.Log.exception(n)}},requestUpdates:function(i){d.push(i)}};a=b.target&&b.property&&b.target[b.property]?b.target[b.property]:b.startValue;if(typeof b.endValue!=="undefined")e=b.endValue-a;if(e==0)h=true;p();return g},Easing:function(){var b=1.70158;return{Linear:function(c,d,h,a){return h*c/a+d},Back:{In:function(c,d,h,a){return h*(c/=a)*c*((b+1)*
c-b)+d},Out:function(c,d,h,a){return h*((c=c/a-1)*c*((b+1)*c+b)+1)+d},InOut:function(c,d,h,a){return(c/=a/2)<1?h/2*c*c*(((b*=1.525)+1)*c-b)+d:h/2*((c-=2)*c*(((b*=1.525)+1)*c+b)+2)+d}},Bounce:{In:function(c,d,h,a){return h-j.Easing.Bounce.Out(a-c,0,h,a)+d},Out:function(c,d,h,a){return(c/=a)<1/2.75?h*7.5625*c*c+d:c<2/2.75?h*(7.5625*(c-=1.5/2.75)*c+0.75)+d:c<2.5/2.75?h*(7.5625*(c-=2.25/2.75)*c+0.9375)+d:h*(7.5625*(c-=2.625/2.75)*c+0.984375)+d},InOut:function(c,d,h,a){return c<a/2?j.Easing.Bounce.In(c*
2,0,h,a)*0.5+d:j.Easing.Bounce.Out(c*2-a,0,h,a)*0.5+h*0.5+d}},Cubic:{In:function(c,d,h,a){return h*(c/=a)*c*c+d},Out:function(c,d,h,a){return h*((c=c/a-1)*c*c+1)+d},InOut:function(c,d,h,a){if((c/=a/2)<1)return h/2*c*c*c+d;return h/2*((c-=2)*c*c+2)+d}},Elastic:{In:function(c,d,h,a,e,g){if(c==0)return d;if((c/=a)==1)return d+h;g||(g=a*0.3);if(!e||e<Math.abs(h)){e=h;h=g/4}else h=g/(2*Math.PI)*Math.asin(h/e);return-(e*Math.pow(2,10*(c-=1))*Math.sin((c*a-h)*2*Math.PI/g))+d},Out:function(c,d,h,a,e,g){var i;
if(c==0)return d;if((c/=a)==1)return d+h;g||(g=a*0.3);if(!e||e<Math.abs(h)){e=h;i=g/4}else i=g/(2*Math.PI)*Math.asin(h/e);return e*Math.pow(2,-10*c)*Math.sin((c*a-i)*2*Math.PI/g)+h+d},InOut:function(c,d,h,a,e,g){var i;if(c==0)return d;if((c/=a/2)==2)return d+h;g||(g=a*0.3*1.5);if(!e||e<Math.abs(h)){e=h;i=g/4}else i=g/(2*Math.PI)*Math.asin(h/e);if(c<1)return-0.5*e*Math.pow(2,10*(c-=1))*Math.sin((c*a-i)*2*Math.PI/g)+d;return e*Math.pow(2,-10*(c-=1))*Math.sin((c*a-i)*2*Math.PI/g)*0.5+h+d}},Quad:{In:function(c,
d,h,a){return h*(c/=a)*c+d},Out:function(c,d,h,a){return-h*(c/=a)*(c-2)+d},InOut:function(c,d,h,a){if((c/=a/2)<1)return h/2*c*c+d;return-h/2*(--c*(c-2)-1)+d}},Sine:{In:function(c,d,h,a){return-h*Math.cos(c/a*(Math.PI/2))+h+d},Out:function(c,d,h,a){return h*Math.sin(c/a*(Math.PI/2))+d},InOut:function(c,d,h,a){return-h/2*(Math.cos(Math.PI*c/a)-1)+d}}}}()};return GRUNT.extend(j,{DEFAULT:j.Easing.Back.Out})}();SLICK.Border={NONE:0,TOP:1,RIGHT:2,BOTTOM:3,LEFT:4};
SLICK.Graphics=function(){var p={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,PINCHZOOM:16,FREEZE:128},l=0,k={DisplayState:p,AnyDisplayState:255,ActiveDisplayStates:p.ACTIVE|p.ANIMATING,DefaultDisplayStates:p.ACTIVE|p.ANIMATING|p.PAN|p.PINCHZOOM,ViewLayer:function(f){f=GRUNT.extend({id:"",centerOnScale:true,created:(new Date).getTime(),scalePosition:true,zindex:0,supportFastDraw:false,validStates:k.DefaultDisplayStates},f);var j=null,b=GRUNT.extend({isAnimating:function(){return false},addToView:function(c){c.setLayer(f.id,
b)},shouldDraw:function(c){var d=j?j.fastDraw&&c!==p.ACTIVE:false;return(c&f.validStates)!==0&&(d?f.supportFastDraw:true)},cycle:function(){return 0},draw:function(){},notify:function(){},remove:function(){GRUNT.WaterCooler.say("layer.remove",{id:f.id})},wakeParent:function(){GRUNT.WaterCooler.say("view.wake",{id:j?j.id:null})},getParent:function(){return j},setParent:function(c){j=c}},f);return b},StatusViewLayer:function(){return new k.ViewLayer({validStates:k.AnyDisplayState,zindex:5E3,draw:function(f,
j,b,c,d){f.fillStyle="#FF0000";f.fillRect(10,10,50,50);f.fillStyle="#FFFFFF";f.font="bold 10px sans";f.fillText(d.getDisplayState(),20,20)}})},AnimatedPathLayer:function(f){function j(e,g,i){e.fillStyle="#FFFFFF";e.strokeStyle="#222222";e.beginPath();e.arc(i.x,i.y,4,0,Math.PI*2,false);e.stroke();e.fill()}f=GRUNT.extend({path:[],id:GRUNT.generateObjectID("pathAnimation"),easing:SLICK.Animation.Easing.Sine.InOut,canCache:false,validStates:k.ActiveDisplayStates|p.PAN|p.PINCHZOOM,drawIndicator:null,duration:2E3,
autoCenter:false},f);var b=SLICK.VectorMath.edges(f.path),c,d=null,h=0;SLICK.Animation.tweenValue(0,b.total,f.easing,function(){a.remove()},f.duration).requestUpdates(function(e,g){h=e;g&&a.remove()});var a=GRUNT.extend(new k.ViewLayer(f),{cycle:function(){for(var e=0;e<b.accrued.length&&b.accrued[e]<h;)e++;d=null;if(e<f.path.length-1){var g=h-(e>0?b.accrued[e-1]:0),i=f.path[e],m=f.path[e+1];c=SLICK.VectorMath.theta(i,m,b.edges[e]);d=SLICK.VectorMath.pointOnEdge(i,m,c,g);if(f.autoCenter)(e=a.getParent())&&
e.centerOn(d)}return d?1:0},draw:function(e,g){if(d)(f.drawIndicator?f.drawIndicator:j)(e,g,new SLICK.Vector(d.x-g.x,d.y-g.y),c)}});return a},FPSLayer:function(f){f=GRUNT.extend({zindex:1E3,scalePosition:false},f);var j=null,b=GRUNT.extend(new k.ViewLayer(f),{delays:[],draw:function(c,d,h){c.font="bold 8pt Arial";c.textAlign="right";c.fillStyle="rgba(0, 0, 0, 0.8)";c.fillText((j?j:"?")+" fps",h.width-20,20)}});setInterval(function(){for(var c=0,d=b.delays.length,h=d;h--;)c+=b.delays[h];if(d!==0)j=
Math.floor(1E3/(c/d))},1E3);return b},ResourceStatsLayer:function(f){f=GRUNT.extend({zindex:500,indicatorSize:5,scalePosition:false,validStates:p.ACTIVE|p.PAN},f);return GRUNT.extend(new k.ViewLayer(f),{fps:null,draw:function(j){var b=SLICK.Resources.getStats(),c=f.indicatorSize,d=10,h;if(b.imageCacheFullness){j.strokeStyle="rgba(0, 0, 255, 1)";j.beginPath();j.arc(15,15,5,0,Math.PI*2*b.imageCacheFullness,false);j.stroke();d=30}if(b.imageLoadingCount>=0){j.fillStyle="rgba(0, 255, 0, 0.7)";for(h=b.imageLoadingCount;h--;)j.fillRect(d+
h*(c+2),10,c,c)}if(b.queuedImageCount>=0){j.fillStyle="rgba(255, 0, 0, 0.7)";for(h=b.queuedImageCount;h--;)j.fillRect(d+h*(c+2),10+c+2,c,c)}}})},LoadingLayer:function(f){GRUNT.extend({},f)},View:function(f){function j(v,w){w.id=v;w.setParent(F);a.push(w);a.sort(function(z,H){var I=H.zindex-z.zindex;if(I===0)I=H.created-z.created;return I})}function b(){GRUNT.Log.info("view idle, "+a.length+" active layers");GRUNT.WaterCooler.say("view-idle",{id:F.id});A=true;G=0}function c(v,w){var z=0,H=F.getScaleFactor(),
I=F.getDisplayState(),S=(new Date).getTime(),Q=(I&p.PINCHZOOM)!==0;q=F.getScaleFactor();var P=0;if(m||Q){v.clearRect(0,0,e.width,e.height);m=false}if(Q){var K=y.getScaleInfo();F.getDimensions().getCenter();var N=(K.progress?K.progress:1)*0.5;D=K.center;if(K.startRect){N=K.startRect.getCenter();N=SLICK.V.diff(N,D);L=new SLICK.Vector(D.x+N.x,D.y+N.y)}else{K=SLICK.V.diff(K.start,D);L=new SLICK.Vector(D.x-K.x*N,D.y-K.y*N)}if(L)w=SLICK.V.offset(w,L.x,L.y)}v.save();try{if(s!==1)v.scale(s,s);else if(Q){v.translate(D.x,
D.y);v.scale(H,H)}for(P=a.length;P--;)if(a[P].shouldDraw(I)){var R=a[P].draw(v,w,C,I,F);z+=R?R:0}}finally{v.restore()}GRUNT.Log.trace("draw complete",S);return z}function d(){var v=0,w=M===p.PINCHZOOM||M===p.PAN;O=(new Date).getTime();i=t?t.getOffset():new SLICK.Vector;B&&r&&B.delays.push(O-r);if(w){SLICK.Animation.cancel(function(H){return H.cancelOnInteract});A=false;if(G!==0){clearTimeout(G);G=0}}for(w=a.length;w--;){var z=a[w].cycle(O,i);v+=z?z:0}v+=c(g,i);r=O;J=0;if(E+v>0)h();else if(!A&&G===
0)G=setTimeout(b,500);GRUNT.Log.trace("Completed draw cycle",O)}function h(){E++;if(!(o||J!==0)){E=0;J=setTimeout(d,0)}}f=GRUNT.extend({id:"view_"+l++,container:"",pannable:false,scalable:false,clearOnDraw:false,displayFPS:true,displayResourceStats:true,scaleDamping:false,fastDraw:false,fillStyle:"rgb(200, 200, 200)",initialDrawMode:"source-over",bufferRefresh:100,defaultFreezeDelay:500,onPan:null,onPinchZoom:null,onScale:null,onDraw:null,autoSize:false},f);var a=[],e=document.getElementById(f.container),
g=null,i=new SLICK.Vector,m=false,q=1,r=null,n=0,o=false,s=1,u=new SLICK.Vector,C=null,x=null,E=0,B=null,D=null,t=null,y=null,A=false,J=0,G=0,L=null,O=0,M=k.DisplayState.ACTIVE;GRUNT.Log.info("Creating a new view instance, attached to container: "+f.container+", canvas = ",e);if(e){if(f.autoSize){GRUNT.Log.info("autosizing view: window.height = "+window.innerHeight+", width = "+window.innerWidth);e.height=window.innerHeight-e.offsetTop-49;e.width=window.innerWidth-e.offsetLeft}try{g=e.getContext("2d");
g.globalCompositeOperation=f.initialDrawMode}catch(T){GRUNT.Log.exception(T);throw Error("Could not initialise canvas on specified view element");}}if(f.pannable)t=new SLICK.Pannable({container:f.container,onAnimate:function(){h()},onPan:function(v,w){n=SLICK.Clock.getTime(true);h();u=SLICK.V.offset(u,v,w);f.onPan&&f.onPan(v,w);M=p.PAN},onPanEnd:function(){h();M=p.ACTIVE}});if(f.scalable)y=new SLICK.Scalable({scaleDamping:f.scaleDamping,container:f.container,onAnimate:function(){M=k.DisplayState.PINCHZOOM;
h()},onPinchZoom:function(v,w){n=SLICK.Clock.getTime(true);h();f.onPinchZoom&&f.onPinchZoom(v,w);M=k.DisplayState.PINCHZOOM},onScale:function(v,w){GRUNT.WaterCooler.say("view.scale",{id:F.id});M=k.DisplayState.ACTIVE;h();f.onScale&&f.onScale(v,w)}});var F=GRUNT.extend({},f,t,y,{id:f.id,deviceScaling:s,fastDraw:f.fastDraw||SLICK.getDeviceConfig().requireFastDraw,centerOn:function(v){t.setOffset(v.x-e.width*0.5,v.y-e.height*0.5)},getDimensions:function(){if(e)return new SLICK.Dimensions(e.width,e.height)},
getZoomCenter:function(){return L},getLayer:function(v){for(var w=0;w<a.length;w++)if(a[w].id==v){/^grid/i.test(v)||GRUNT.Log.info("found layer: "+v);return a[w]}return null},setLayer:function(v,w){for(var z=0;z<a.length;z++)if(a[z].id===v){a.splice(z,1);break}w&&j(v,w);GRUNT.WaterCooler.say("layer.update",{value:w});h()},eachLayer:function(v){for(var w=0;w<a.length;w++)v(a[w])},clearBackground:function(){m=true},freeze:function(){o=true},unfreeze:function(){o=false;h()},snapshot:function(){},getDisplayState:function(){return o?
p.FROZEN:M},scale:function(v,w,z,H,I){H||(H=F.getDimensions().getCenter());I||(I=F.getDimensions().getCenter());y&&y.animate(v,H,I,w,z);return y},removeLayer:function(v,w){setTimeout(function(){var z;a:{for(z=a.length;z--;)if(a[z].id==v){z=z;break a}z=-1}if(z>=0&&z<a.length){GRUNT.WaterCooler.say("layer.remove",{layer:a[z]});a.splice(z,1)}},w?w:1)}});C=F.getDimensions();x=C.getCenter();GRUNT.WaterCooler.listen("layer.remove",function(v){v.id&&F.removeLayer(v.id)});GRUNT.WaterCooler.listen("view.wake",
function(v){if(!v.id||v.id===F.id)h()});s=SLICK.getDeviceConfig().getScaling();if(f.displayFPS){B=new k.FPSLayer;F.setLayer("fps",B)}f.displayResourceStats&&F.setLayer("resourceStats",new k.ResourceStatsLayer);h();return F}};return k}();
SLICK.Tiling=function(){function p(){if(!k){k=document.createElement("canvas");k.width=j.Config.TILESIZE;k.height=j.Config.TILESIZE;var b=k.getContext("2d");b.fillStyle="rgba(150, 150, 150, 0.05)";b.fillRect(0,0,k.width,k.height)}return k}function l(){if(!f){f=document.createElement("canvas");f.width=j.Config.TILESIZE;f.height=j.Config.TILESIZE;var b=f.getContext("2d"),c=Math.sqrt(j.Config.TILESIZE);b.fillStyle="rgba(200, 200, 200, 1)";b.strokeStyle="rgb(190, 190, 190)";b.lineWidth=0.5;b.fillRect(0,
0,f.width,f.height);b.beginPath();for(var d=0;d<f.width;d+=c){b.moveTo(d,0);b.lineTo(d,f.height);for(var h=0;h<f.height;h+=c){b.moveTo(0,h);b.lineTo(f.width,h)}}b.stroke()}return f}TileStore=function(b){b=GRUNT.extend({gridSize:20,center:new SLICK.Vector,onPopulate:null},b);var c=Array(Math.pow(b.gridSize,2)),d=SLICK.V.offset(b.center,-Math.ceil(b.gridSize>>1)),h=null,a=new SLICK.Vector,e=null;GRUNT.Log.info("created tile store with tl offset = "+d);var g={getGridSize:function(){return b.gridSize},
getNormalizedPos:function(i,m){return SLICK.V.add(new SLICK.Vector(i,m),SLICK.V.invert(d),a)},getTileShift:function(){return SLICK.V.copy(a)},getTile:function(i,m){return i>=0&&i<b.gridSize?c[m*b.gridSize+i]:null},setTile:function(i,m,q){c[m*b.gridSize+i]=q},populate:function(i,m){var q=GRUNT.Log.getTraceTicks(),r=0;new SLICK.Vector(b.gridSize*0.5,b.gridSize*0.5);GRUNT.Log.info("poulating grid, top left offset = "+d);if(i)for(var n=0;n<b.gridSize;n++)for(var o=0;o<b.gridSize;o++){if(!c[r]){var s=
i(o,n,d,b.gridSize);c[r]=s}r++}h=i;e=m;GRUNT.Log.trace("tile grid populated",q);b.onPopulate&&b.onPopulate()},getShiftDelta:function(i,m,q,r){var n=Math.floor(b.gridSize*0.2),o=new SLICK.Vector;if(i<0||i+q>b.gridSize)o.x=i<0?-n:n;if(m<0||m+r>b.gridSize)o.y=m<0?-n:n;return o},shift:function(i,m){if(!(i.x===0&&i.y===0)){var q=GRUNT.Log.getTraceTicks(),r=Array(c.length);r.length=c.length;for(var n=0;n<b.gridSize;n++)for(var o=0;o<b.gridSize;o++)r[o*b.gridSize+n]=g.getTile(n+i.x,o+i.y);c=r;d=m?m(d,i):
SLICK.V.add(d,i);a.x+=-i.x*b.tileSize;a.y+=-i.y*b.tileSize;GRUNT.Log.trace("tile storage shifted",q);g.populate(h,e)}},setOrigin:function(i,m){if(tileOrigin)shiftOrigin(i,m);else d=SLICK.V.offset(new SLICK.Vector(i,m),-tileHalfWidth)}};GRUNT.WaterCooler.listen("imagecache.cleared",function(){for(var i=c.length;i--;)if(c[i])c[i].loaded=false});return g};var k=null,f=null,j={Config:{TILESIZE:256,TILEBUFFER:1,TILEBUFFER_LOADNEW:0.2},Tile:function(b){return b=GRUNT.extend({x:0,y:0,size:256},b)},ImageTile:function(b){b=
GRUNT.extend({url:"",sessionParamRegex:null,loaded:false},b);return new j.Tile(b)},TileGrid:function(b){function c(o,s,u,C){if((g?SLICK.V.absSize(SLICK.V.diff(g,s)):h)>=20){o=d.getTileShift();o=new SLICK.Vector(Math.floor((s.x+o.x)*e),Math.floor((s.y+o.y)*e));var x=Math.ceil(u.width*e)+1;u=Math.ceil(u.height*e)+1;var E=new SLICK.Vector((x-1)*0.5,(u-1)*0.5),B=new SLICK.Vector(o.x*b.tileSize,o.y*b.tileSize);C.isAnimating();m=[];tilesNeeded=false;for(var D=u;D--;)for(var t=D*b.tileSize+B.y,y=x;y--;){C=
d.getTile(y+o.x,D+o.y);var A=y*b.tileSize+B.x,J=new SLICK.Vector(y-E.x,D-E.y);C||(q=d.getShiftDelta(o.x,o.y,x,u));m.push({tile:C,coordinates:new SLICK.Vector(A,t),centerness:SLICK.V.absSize(J)})}m.sort(function(G,L){return L.centerness-G.centerness});g=SLICK.V.copy(s)}}b=GRUNT.extend({tileSize:SLICK.Tiling.Config.TILESIZE,drawGrid:false,center:new SLICK.Vector,shiftOrigin:null,supportFastDraw:true,checkChange:100},b);var d=new TileStore(GRUNT.extend({onPopulate:function(){i=true;n.wakeParent()}},
b)),h=Math.round(b.tileSize>>1),a=true,e=b.tileSize?1/b.tileSize:0,g=null,i=false,m=[];new SLICK.Vector;var q=new SLICK.Vector,r=d.getGridSize()*b.tileSize,n=GRUNT.extend(new SLICK.Graphics.ViewLayer(b),{gridDimensions:new SLICK.Dimensions(r,r),cycle:function(){var o=0;if(q.x+q.y!==0){d.shift(q,b.shiftOrigin);q=new SLICK.Vector;o++}return o+i?1:0},drawTile:function(){},draw:function(o,s,u,C,x){if(a){var E=GRUNT.Log.getTraceTicks(),B=d.getTileShift(),D=s.x+B.x;B=s.y+B.y;if(C!==SLICK.Graphics.DisplayState.PINCHZOOM){c(o,
s,u,x);GRUNT.Log.trace("updated draw queue",E)}if(b.drawGrid)o.strokeStyle="rgba(50, 50, 50, 0.3)";o.beginPath();for(s=m.length;s--;){u=m[s].tile;x=m[s].coordinates.x-D;var t=m[s].coordinates.y-B;if(u){n.drawTile(o,u,x,t,C);u.x=x;u.y=t}b.drawGrid&&o.rect(x,t,b.tileSize,b.tileSize)}o.stroke();GRUNT.Log.trace("drawn tiles",E)}i=false},getTileSize:function(){return b.tileSize},getTileVirtualXY:function(o,s,u){o=d.getNormalizedPos(o,s);o=new SLICK.Vector(o.x*b.tileSize,o.y*b.tileSize);if(u){o.x+=h;o.y+=
h}return o},getCenterXY:function(){var o=Math.ceil(d.getGridSize()>>1);return n.getTileVirtualXY(o,o,true)},populate:function(o){d.populate(o,function(){})}});GRUNT.WaterCooler.listen("view.scale",function(o){if(o.id==n.getParent().id)a=false});GRUNT.WaterCooler.listen("tile.loaded",function(){i=true;n.wakeParent()});return n},ImageTileGrid:function(b){function c(){GRUNT.WaterCooler.say("tile.loaded")}b=GRUNT.extend({},b);return GRUNT.extend(new j.TileGrid(b),{drawTile:function(d,h,a,e,g){var i=SLICK.Resources.getImage(h.url);
g===SLICK.Graphics.DisplayState.PAN&&d.drawImage(l(),a,e);if(i&&i.complete)d.drawImage(i,a,e);else{d.drawImage(p(),a,e);i||SLICK.Resources.loadImage(h.url,c)}}})},Tiler:function(b){b=GRUNT.extend({container:"",drawCenter:false,onPan:null,onPanEnd:null,tapHandler:null,doubleTapHandler:null,zoomHandler:null,onDraw:null,datasources:{},tileLoadThreshold:"first"},b);SLICK.Touch.captureTouch(document.getElementById(b.container),b);var c=new SLICK.Graphics.View(GRUNT.extend({},b,{pannable:true,scalable:true,
scaleDamping:true}));GRUNT.extend(c,{getTileLayer:function(){return c.getLayer("grid0")},setTileLayer:function(d){c.setLayer("grid0",d);GRUNT.WaterCooler.say("grid.updated",{grid:d})},gridPixToViewPix:function(d){var h=c.getOffset();return new SLICK.Vector(d.x-h.x,d.y-h.y)},viewPixToGridPix:function(d){var h=c.getOffset();return new SLICK.Vector(d.x+h.x,d.y+h.y)}});return c}};return j}();
SLICK.Geo=function(){function p(a,e){var g=null;for(var i in d)if(e){if(i==e&&d[i][a]){g=d[i];break}}else if(d[i][a]){g=d[i];break}return g}function l(a,e,g,i){var m=0;a=a.toUpperCase();for(var q in i){var r=e[q];if(r){var n=g[q];r=n?n(a,r):a.containsWord(r)?1:0;m+=r*i[q]}}return m}var k=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],f=/(\d+)\s?\-\s?(\d+)/,j=/^(\d+).*$/,b=null,c={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",
HWY:"HIGHWAY",MWY:"MOTORWAY"},d={},h={Engine:function(a){if(!a.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var e=GRUNT.extend({remove:function(){delete d[e.id]}},a);return d[e.id]=e},getEngine:function(a){for(var e=null,g=1;!e&&g<arguments.length;g++)e=p(a,arguments[g]);e=e?e:p(a);if(!e)throw Error("Unable to find GEO engine with "+a+" capability");return e},Distance:function(a,e){var g=0;if(!h.emptyPos(a)&&!h.emptyPos(e)){var i=(e.lat-a.lat).toRad()>>1,m=(e.lon-a.lon).toRad()>>
1;i=Math.sin(i)*Math.sin(i)+Math.cos(a.lat.toRad())*Math.cos(e.lat.toRad())*Math.sin(m)*Math.sin(m);g=6371*2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))}return{toM:function(){return g*1E3},toKM:function(){return g},toString:function(){return g+"km"}}},Radius:function(a,e){return{distance:parseInt(a,10),uom:e}},Position:function(a,e){return{lat:parseFloat(a?a:0),lon:parseFloat(e?e:0)}},BoundingBox:function(a,e){var g={min:h.parsePosition(a),max:h.parsePosition(e),expand:function(i){g.min.lat-=i;g.min.lon-=
h.Utilities.normalizeLon(i);g.max.lat+=i;g.max.lon+=h.Utilities.normalizeLon(i)},getDistance:function(){return new h.Distance(g.min,g.max)},getCenter:function(){var i=h.calculateBoundsSize(g.min,g.max);return new SLICK.Geo.Position(g.min.lat+i.y*0.5,g.min.lon+i.x*0.5)},transform:function(i){var m=new SLICK.Geo.BoundingBox(g.min,g.max);GRUNT.Log.info("applying "+i.length+" transformers");for(var q=0;i&&q<i.length;q++)i[q].apply(m);return m},toString:function(){return String.format("({0}, {1})",g.min,
g.max)}};return g},Transforms:function(){return{Shrink:function(){return function(){}},Offset:function(){return function(){}}}}(),Address:function(a){a=GRUNT.extend({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},a);return GRUNT.extend(a,{getPos:function(){return a.pos},toString:function(){return a.streetDetails+" "+a.location}})},GeocodeFieldWeights:{streetDetails:50,location:50},AddressCompareFns:{},Utilities:function(){var a={lat2pix:function(e,g){var i=parseFloat(e)*
2*Math.PI/360;i=Math.sin(i);var m=0.08181919084262157*i;return Math.log((1+i)/(1-i)*Math.pow((1-m)/(1+m),0.08181919084262157))/2/g},lon2pix:function(e,g){return parseFloat(e)/180*Math.PI/g},pix2lon:function(e,g){return a.normalizeLon(e*g*180/Math.PI)},pix2lat:function(e,g){for(var i=Math.pow(Math.E,-e*g),m=a.mercatorUnproject(i),q=a.findRadPhi(m,i),r=0;r<12&&Math.abs(m-q)>1.0E-7;){m=q;q=a.findRadPhi(m,i);r++}return q*180/Math.PI},mercatorUnproject:function(e){return Math.PI/2-2*Math.atan(e)},findRadPhi:function(e,
g){var i=0.08181919084262157*Math.sin(e);return Math.PI/2-2*Math.atan(g*Math.pow((1-i)/(1+i),0.040909595421310785))},normalizeLon:function(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}};return a}(),GeoSearchResult:function(a){a=GRUNT.extend({id:null,caption:"",resultType:"",data:null,pos:null,matchWeight:0},a);return GRUNT.extend(a,{toString:function(){return a.caption+(a.matchWeight?" ("+a.matchWeight+")":"")}})},GeoSearchAgent:function(a){a=GRUNT.extend({},a);return GRUNT.extend({},SLICK.Dispatcher.createAgent(a))},
GeocodingAgent:function(a){a=GRUNT.extend({name:"Geocoding Search Agent",paramTranslator:null,execute:function(e,g){try{if(!e.reverse&&!e.freeform)address=new h.Address(e);var i=h.getEngine("geocode");if(i)i.geocode({addresses:[e.freeform?e.freeform:address],complete:function(q,r){if(g){var n=r;if(e.freeform)n=h.rankGeocodeResponses(e.freeform,n,h.getEngine("geocode"));g(n,a)}}})}catch(m){GRUNT.Log.exception(m)}}},a);return new h.GeoSearchAgent(a)},PointOfInterest:function(a){a=GRUNT.extend({id:0,
title:"",pos:null,lat:"",lon:"",group:"",retrieved:0,isNew:true},a);if(!a.pos&&a.lat&&a.lon)a.pos=new SLICK.Geo.Position(a.lat,a.lon);return GRUNT.extend({toString:function(){return a.id+": '"+a.title+"'"}},a)},POIStorage:function(a){function e(n){n=n?n:"default";m[n]||(m[n]=[]);return m[n]}function g(n){var o=[];for(var s in m)for(var u=0;u<m[s].length;u++)if(!n||n(m[s][u]))o.push(m[s][u]);return o}function i(){GRUNT.WaterCooler.say("geo.pois-updated",{srcID:r.id,pois:r.getPOIs()})}a=GRUNT.extend({visibilityChange:null,
onPOIDeleted:null,onPOIAdded:null},a);var m={},q=true,r={id:GRUNT.generateObjectID(),getPOIs:function(){return g()},getOldPOIs:function(n,o){return g(function(s){return s.group==n&&s.retrieved<o})},getVisible:function(){return q},setVisible:function(n){if(n!=q){q=n;a.visibilityChange&&a.visibilityChange()}},findById:function(n){var o=g(function(s){return s.id==n});return o.length>0?o[0]:null},findByBounds:function(n){return g(function(o){return SLICK.Geo.posInBounds(o.pos,n)})},addPOIs:function(n,
o){if(o)m={};for(var s=0;n&&s<n.length;s++){n[s].retrieved=SLICK.Clock.getTime(true);var u=n[s];e(u.group).push(u)}},removeGroup:function(n){if(m[n]){delete m[n];i()}},update:function(n){var o=[],s=0,u=n.length>0?n[0].group:"",C=SLICK.Clock.getTime(true);for(s=0;s<n.length;s++){var x;a:{if(x=n[s])for(var E=e(x.group),B=0;B<E.length;B++)if(E[B].id==x.id){x=E[B];break a}x=null}if(x){x.retrieved=C;x.isNew=false}else o.push(n[s])}n=r.getOldPOIs(u,C);r.addPOIs(o);for(s=0;a.onPOIAdded&&s<o.length;s++)a.onPOIAdded(o[s]);
for(s=0;s<n.length;s++){a.onPOIDeleted&&a.onPOIDeleted(n[s]);u=n[s];C=e(u.group);for(x=0;x<C.length;x++)if(C[x].id==u.id){C.splice(x,1);break}}o.length+n.length>0&&i()}};return r},MapProvider:function(){return{zoomLevel:0,checkZoomLevel:function(a){return a},getCopyright:function(){},getMapTiles:function(){},getPositionForXY:function(){return null}}},copyPos:function(a){return a?new h.Position(a.lat,a.lon):null},emptyPos:function(a){return!a||a.lat===0&&a.lon===0},posToStr:function(a){return a.lat+
" "+a.lon},parsePosition:function(a){if(a)if(GRUNT.isPlainObject(a)&&a.lat!=="undefined")return a;else{if(a.split)for(var e=[" ",","],g=0;g<e.length;g++){var i=a.split(e[g]);if(i.length===2)return new h.Position(i[0],i[1])}}else return new h.Position;return null},parsePositionArray:function(a){var e=a.length,g=Array(e);for(e=e;e--;)g[e]=h.parsePosition(a[e]);return g},posToMercatorPixels:function(a,e){return new SLICK.Vector(SLICK.Geo.Utilities.lon2pix(a.lon,e),SLICK.Geo.Utilities.lat2pix(a.lat,e))},
mercatorPixelsToPos:function(a,e,g){return new h.Position(SLICK.Geo.Utilities.pix2lat(e,g),SLICK.Geo.Utilities.normalizeLon(SLICK.Geo.Utilities.pix2lon(a,g)))},emptyBounds:function(a){return!a||h.emptyPos(a.min)||h.emptyPos(a.max)},posInBounds:function(a,e){var g=!(h.emptyPos(a)||h.emptyBounds(e));return g=(g=g&&a.lat>=e.min.lat&&a.lat<=e.max.lat)&&a.lon>=e.min.lon&&a.lon<=e.max.lon},calculateBoundsSize:function(a,e,g){var i=new SLICK.Vector(0,e.lat-a.lat);if(typeof g==="undefined")g=true;i.x=g&&
a.lon>e.lon?360-a.lon+e.lon:e.lon-a.lon;return i},getBoundingBoxZoomLevel:function(a,e){var g=a.getCenter(),i=Math.min(Math.round(Math.abs(g.lat)*0.05),k.length),m=k[i],q=h.calculateBoundsSize(a.min,a.max),r=Math.ceil(Math.log(k[3]*e.height/q.y)/Math.log(2));m=Math.ceil(Math.log(m*e.width/q.x)/Math.log(2));GRUNT.Log.info("constant index for bbox: "+a+" (center = "+g+") is "+i);GRUNT.Log.info("distances  = "+q);GRUNT.Log.info("optimal zoom levels: height = "+r+", width = "+m);return Math.min(r,m)},
getBoundsForPositions:function(a,e){var g=null,i=SLICK.Clock.getTime();e||(e="auto");for(var m=a.length;m--;)if(g){var q=h.calculateBoundsSize(g.min,a[m],false),r=h.calculateBoundsSize(a[m],g.max,false);if(q.x<0)g.min.lon=a[m].lon;if(q.y<0)g.min.lat=a[m].lat;if(r.x<0)g.max.lon=a[m].lon;if(r.y<0)g.max.lat=a[m].lat}else g=new SLICK.Geo.BoundingBox(h.copyPos(a[m]),h.copyPos(a[m]));if(e){if(e=="auto"){m=h.calculateBoundsSize(g.min,g.max);e=Math.max(m.x,m.y)*0.3}g.expand(e)}GRUNT.Log.info("bounds calculated in "+
(SLICK.Clock.getTime()-i)+" ms");return g},normalizeAddress:function(a){if(!a)return"";a=a.toUpperCase();if(!b){var e=[];for(var g in c)e.push(g);b=RegExp("(\\s)("+e.join("|")+")(\\s|$)","i")}b.lastIndex=-1;if(e=b.exec(a))a=a.replace(b,"$1"+c[e[2]]);return a},buildingMatch:function(a,e){j.lastIndex=-1;if(j.test(a))for(var g=a.replace(j,"$1"),i=e.split(","),m=0;m<i.length;m++){f.lastIndex=-1;if(f.test(i[m])){var q=f.exec(i[m]);if(g>=parseInt(q[1],10)&&g<=parseInt(q[2],10))return true}else if(g==i[m])return true}return false},
rankGeocodeResponses:function(a,e,g){var i=[],m=h.AddressCompareFns;if(g&&g.compareFns)m=GRUNT.extend({},m,g.compareFns);for(g=0;g<e.length;g++)i.push(new h.GeoSearchResult({caption:e[g].toString(),data:e[g],pos:e[g].pos,matchWeight:l(a,e[g],m,h.GeocodeFieldWeights)}));i.sort(function(q,r){return r.matchWeight-q.matchWeight});return i}};return h}();
SLICK.Geo.Location=function(){function p(f){function j(e){try{var g=new SLICK.Geo.Position(e.coords.latitude,e.coords.longitude),i=GRUNT.isPlainObject(e.coords.accuracy)&&e.coords.accuracy.horizontal?e.coords.accuracy.horizontal:e.coords.accuracy;GRUNT.Log.info("got position coordinates: "+g+", accuracy = "+i);if(f.successCallback&&(!h||i<a))f.successCallback(g,d,e);if(i>f.highAccuracyCutoff&&d<2){d=2;f.enableHighAccuracy=true;GRUNT.Log.info("Position not at required accuracy, trying again with high accuracy");
c()}h=e;a=i}catch(m){GRUNT.Log.exception(m)}}function b(e){if(e.code===e.PERMISSION_DENIED)f.errorCallback&&f.errorCallback(e);else if(e.code===e.POSITION_UNAVAILABLE)f.errorCallback&&f.errorCallback(e);else if(e.code===e.TIMEOUT){GRUNT.Log.info("had a timeout on cached position, moving to phase 1");if(f.timeout===0&&f.autoPhasing){d=1;f.timeout=l;f.enableHighAccuracy=false;c()}}}function c(){navigator.geolocation.getCurrentPosition(j,b,f)}f=GRUNT.extend({autoPhasing:true,maximumAge:3E5,timeout:0,
highAccuracyCutoff:10,enableHighAccuracy:true,successCallback:null,errorCallback:null},f);var d=0,h=null,a=1E6;c()}var l=3E3,k={get:function(){throw Error("No geolocation APIs supported.");}};if(navigator.geolocation)k.get=p;return k}();SLICK.Geo.Search=function(){return{bestResults:function(p,l){l||(l=20);for(var k=p.length>0?p[0]:null,f=[],j=0;j<p.length;j++)if(k.matchWeight-p[j].matchWeight<=l)f.push(p[j]);else break;return f}}}();
SLICK.Mapping=function(){var p={AnnotationTween:null,GeoTileGrid:function(l){l=GRUNT.extend({grid:null,centerPos:new SLICK.Geo.Position,centerXY:new SLICK.Vector,radsPerPixel:0},l);var k=SLICK.Geo.posToMercatorPixels(l.centerPos,l.radsPerPixel),f=k.x-l.centerXY.x,j=k.y-l.centerXY.y,b=GRUNT.extend({},l.grid,{getBoundingBox:function(c,d,h,a){return new SLICK.Geo.BoundingBox(b.pixelsToPos(new SLICK.Vector(c,d+a)),b.pixelsToPos(new SLICK.Vector(c+h,d)))},getCenterOffset:function(){return l.centerXY},
getGridXYForPosition:function(c){c=SLICK.Geo.posToMercatorPixels(c,l.radsPerPixel);return new SLICK.Vector(c.x-f,b.gridDimensions.height-(c.y-j))},getGuideOffset:function(c){var d=b.getTileSize();return new SLICK.Vector(c.x%d,c.y%d)},pixelsToPos:function(c){return SLICK.Geo.mercatorPixelsToPos(f+c.x,j+b.gridDimensions.height-c.y,l.radsPerPixel)}});return b},POIViewLayer:function(l){GRUNT.extend({},l)},Overlay:function(l){GRUNT.extend({},l);return{}},RadarOverlay:function(l){l=GRUNT.extend({radarFill:"rgba(0, 221, 238, 0.1)",
radarStroke:"rgba(0, 102, 136, 0.3)",zindex:100},l);return GRUNT.extend(new SLICK.Graphics.ViewLayer(l),{draw:function(k,f,j){f=j.width>>1;j=j.height>>1;k.fillStyle=l.radarFill;k.strokeStyle=l.radarStroke;k.beginPath();k.arc(f,j,50,0,Math.PI*2,false);k.fill();k.stroke()}})},CrosshairOverlay:function(l){l=GRUNT.extend({lineWidth:1.5,strokeStyle:"rgba(0, 0, 0, 0.5)",size:15,zindex:150,scalePosition:false,validStates:SLICK.Graphics.DisplayState.ACTIVE|SLICK.Graphics.DisplayState.ANIMATING|SLICK.Graphics.DisplayState.PAN},
l);return GRUNT.extend(new SLICK.Graphics.ViewLayer(l),{draw:function(k,f,j){f=j.getCenter();k.lineWidth=l.lineWidth;k.strokeStyle=l.strokeStyle;j=l.size;k.beginPath();k.moveTo(f.x,f.y-j);k.lineTo(f.x,f.y+j);k.moveTo(f.x-j,f.y);k.lineTo(f.x+j,f.y);k.arc(f.x,f.y,j*0.6666,0,2*Math.PI,false);k.stroke()}})},RouteOverlay:function(l){function k(d){j=[];b=[];GRUNT.Log.info("started route calc coordinates");var h=GRUNT.Log.getTraceTicks(),a,e,g=null,i,m=l.data?l.data.geometry:[],q=m.length,r=l.data?l.data.instructions:
[],n=r.length;for(a=q;a--;){e=d.getGridXYForPosition(m[a]);if(i=!g||a===0||Math.abs(e.x-g.x)+Math.abs(e.y-g.y)>l.pixelGeneralization){j.unshift(e);g=e}}GRUNT.Log.trace(q+" geometry points generalized to "+j.length+" coordinates",h);g=null;for(a=n;a--;)if(r[a].position){e=d.getGridXYForPosition(r[a].position);if(i=!g||a===0||Math.abs(e.x-g.x)+Math.abs(e.y-g.y)>l.pixelGeneralization){b.push(e);g=e}}GRUNT.Log.trace(n+" instructions generalized to "+b.length+" coordinates",h);GRUNT.Log.info("finished route calc coordinates");
f=false}l=GRUNT.extend({strokeStyle:"rgba(0, 51, 119, 0.9)",waypointFillStyle:"#FFFFFF",lineWidth:4,data:null,pixelGeneralization:8,zindex:50,validStates:SLICK.Graphics.DisplayState.ACTIVE|SLICK.Graphics.DisplayState.PAN},l);var f=true,j=[],b=[],c=GRUNT.extend(new SLICK.Graphics.ViewLayer(l),{getAnimation:function(d,h,a,e){f&&k(c.getParent().getTileLayer());return new SLICK.Graphics.AnimatedPathLayer({path:j,zindex:l.zindex+1,easing:d?d:SLICK.Animation.Easing.Sine.InOut,duration:h?h:5E3,drawIndicator:a,
autoCenter:e?e:false})},draw:function(d,h,a,e,g){f&&k(g.getTileLayer());a=j.length;d.strokeStyle=l.strokeStyle;d.lineWidth=l.lineWidth;d.beginPath();d.moveTo(j[a-1].x-h.x,j[a-1].y-h.y);for(a=a;a--;)d.lineTo(j[a].x-h.x,j[a].y-h.y);d.stroke();d.fillStyle=l.waypointFillStyle;for(a=b.length;a--;){d.beginPath();d.arc(b[a].x-h.x,b[a].y-h.y,2,0,Math.PI*2,false);d.stroke();d.fill()}}});GRUNT.WaterCooler.listen("grid.updated",function(){f=true;c.wakeParent()});return c},Annotation:function(l){l=GRUNT.extend({xy:null,
pos:null,draw:null,tweenIn:p.AnnotationTween},l);var k=false,f={xy:l.xy,pos:l.pos,isNew:false,isAnimating:function(){return k},draw:function(j,b,c,d){if(f.xy){if(f.isNew&&l.tweenIn){var h=f.xy.y;f.xy.y=b.y-20;k=true;SLICK.Animation.tween(f.xy,"y",h,l.tweenIn,function(){f.xy.y=h;k=false},250+Math.random()*500)}if(l.draw)l.draw(j,b,new SLICK.Vector(f.xy.x-b.x,f.xy.y-b.y),c,d);else{j.beginPath();j.arc(f.xy.x-b.x,f.xy.y-b.y,4,0,Math.PI*2,false);j.fill()}f.isNew=false}}};return f},ImageAnnotation:function(l){l=
GRUNT.extend({imageUrl:null},l);var k=null;l.draw=function(f,j,b,c,d){if(j=SLICK.Resources.getImage(l.imageUrl)){if(j.complete){k||(k=new SLICK.Vector(-j.width>>1,-j.height>>1));b=SLICK.V.offset(b,k.x,k.y);f.drawImage(j,b.x,b.y,j.width,j.height)}}else SLICK.Resources.loadImage(l.imageUrl,function(){d.wakeParent()})};return new p.Annotation(l)},AnnotationsOverlay:function(l){function k(d){for(var h=l.map?l.map.getTileLayer():null,a=0;h&&a<d.length;a++)d[a].xy=h.getGridXYForPosition(d[a].pos)}l=GRUNT.extend({pois:null,
map:null,createAnnotationForPOI:null,zindex:100},l);var f=[],j=false,b=[],c=GRUNT.extend(new SLICK.Graphics.ViewLayer(l),{draw:function(d,h,a,e){d.save();try{var g;j=false;d.fillStyle="rgba(255, 0, 0, 0.75)";d.globalCompositeOperation="source-over";for(g=f.length;g--;){f[g].draw(d,h,e,c);j=j||f[g].isAnimating()}for(g=b.length;g--;){b[g].draw(d,h,e,c);j=j||f[g].isAnimating()}j&&c.wakeParent()}finally{d.restore()}},add:function(d){b.push(d);k(b)},isAnimating:function(){return j}});GRUNT.WaterCooler.listen("geo.pois-updated",
function(d){if(l.pois&&l.pois.id==d.srcID){d=d.pois;try{f=[];for(var h=0;h<d.length;h++)if(d[h].pos){var a;var e=d[h];if(e&&e.pos){var g=null;if(g=l.createAnnotationForPOI?l.createAnnotationForPOI(e):new p.Annotation({pos:e.pos})){g.isNew=e.isNew;e.isNew=false}a=g}else a=void 0;a&&f.push(a)}k(f)}catch(i){GRUNT.Log.exception(i)}c.wakeParent()}});GRUNT.WaterCooler.listen("grid.updated",function(){k(f);k(b)});return c},Tiler:function(l){l=GRUNT.extend({tapExtent:10,provider:null,crosshair:true,copyright:undefined,
zoomLevel:0,boundsChange:null,tapPOI:null,boundsChangeThreshold:30,pois:new SLICK.Geo.POIStorage,createAnnotationForPOI:null},l);if(typeof l.copyright==="undefined")l.copyright=l.provider?l.provider.getCopyright():"";var k=new SLICK.Vector,f=l.copyright,j=false,b=[],c=null,d=l.zoomLevel;if(!l.provider)l.provider=new SLICK.Geo.MapProvider;var h=l.panHandler,a=l.tapHandler;l.onPan=function(i,m){h&&h(i,m)};l.tapHandler=function(i,m){var q=g.getTileLayer(),r=null;if(q){var n=g.viewPixToGridPix(new SLICK.Vector(m.x,
m.y));r=q.pixelsToPos(SLICK.V.offset(n,-l.tapExtent,l.tapExtent));q=q.pixelsToPos(SLICK.V.offset(n,l.tapExtent,-l.tapExtent));r=new SLICK.Geo.BoundingBox(r,q);b=g.pois.findByBounds(r);l.tapPOI&&l.tapPOI(b)}a&&a(i,m,r)};l.doubleTapHandler=function(i,m){g.animate(2,g.getDimensions().getCenter(),new SLICK.Vector(m.x,m.y),SLICK.Animation.Easing.Sine.Out)};l.onScale=function(i,m){var q=0;i=Math.sqrt(i);if(i<1)q=-(0.5/i);else if(i>1)q=i;g.removeLayer("grid");SLICK.Resources.resetImageLoadQueue();g.gotoPosition(g.getXYPosition(m),
d+Math.floor(q));GRUNT.Log.info("zoom change = "+Math.floor(q)+", new zoom level = "+(d+Math.floor(q)))};var e=new SLICK.Tiling.Tiler(l),g=GRUNT.extend({},e,{pois:l.pois,getBoundingBox:function(){var i=new SLICK.Geo.BoundingBox,m=g.getTileLayer(),q=g.getOffset(),r=g.getDimensions();if(m)i=m.getBoundingBox(q.x,q.y,r.width,r.height);return i},getCenterPosition:function(){return g.getXYPosition(g.gridDimensions.getCenter())},getXYPosition:function(i){return g.getTileLayer().pixelsToPos(g.viewPixToGridPix(i))},
gotoBounds:function(i,m){var q=SLICK.Geo.getBoundingBoxZoomLevel(i,g.getDimensions());GRUNT.Log.info("BOUNDS CHANGE REQUIRED CENTER: "+i.getCenter()+", ZOOM LEVEL: "+q);g.gotoPosition(i.getCenter(),q,m)},gotoCurrentPosition:function(i){SLICK.Geo.Location.get({successCallback:function(m){g.clearBackground();g.gotoPosition(m,15,i)},errorCallback:function(){}})},gotoPosition:function(i,m,q){var r=d;d=m?m:d;if(!d)throw"Zoom level required to goto a position.";if(l.provider)d=l.provider.checkZoomLevel(d);
if(!j||d!=r){SLICK.Animation.cancel();j&&g.freeze();l.provider.zoomLevel=d;l.provider.getMapTiles(g,i,function(n){g.setTileLayer(n);g.panToPosition(i,function(){g.unfreeze();q&&q()})});j=true}else g.panToPosition(i,q)},panToPosition:function(i,m,q){var r=g.getTileLayer();if(r){i=r.getGridXYForPosition(i);r=g.getDimensions();i.x-=r.width>>1;i.y-=r.height>>1;if(c)c=null;g.updateOffset(i.x,i.y,q);GRUNT.WaterCooler.say("view.wake",{id:g.id});l.boundsChange&&l.boundsChange(g.getBoundingBox());m&&m(g)}},
setZoomLevel:function(i){g.gotoPosition(g.getCenterPosition(),i)},zoomIn:function(){GRUNT.Log.info("scaling needed is "+2*Math.PI/(1<<d)/(2*Math.PI/(1<<d+1)));g.scale(2,SLICK.Animation.Easing.Sine.Out)||g.setZoomLevel(d+1)},zoomOut:function(){GRUNT.Log.info("scaling needed is "+2*Math.PI/(1<<d)/(2*Math.PI/(1<<d-1)));g.scale(0.5,SLICK.Animation.Easing.Sine.Out)||g.setZoomLevel(d-1)},animateRoute:function(i,m,q,r){var n=g.getLayer("route");n&&n.getAnimation(i,m,q,r).addToView(g)}},e);e=new SLICK.Mapping.AnnotationsOverlay({pois:g.pois,
map:g,createAnnotationForPOI:l.createAnnotationForPOI});g.setLayer("annotations",e);l.crosshair&&g.setLayer("crosshair",new SLICK.Mapping.CrosshairOverlay);f&&g.setLayer("copyright",new SLICK.Graphics.ViewLayer({zindex:999,draw:function(i,m,q){i.lineWidth=2.5;i.fillStyle="rgb(50, 50, 50)";i.strokeStyle="rgba(255, 255, 255, 0.8)";i.font="bold 10px sans";i.textBaseline="bottom";i.strokeText(f,10,q.height-10);i.fillText(f,10,q.height-10)}}));GRUNT.WaterCooler.listen("view-idle",function(i){if(i.id&&
i.id==g.id)if(SLICK.V.absSize(SLICK.V.diff(k,g.getOffset()))>l.boundsChangeThreshold&&l.boundsChange){k=g.getOffset();l.boundsChange(g.getBoundingBox())}});return g}};return p}();
SLICK.Geo.Routing=function(){var p={calculate:function(l){l=GRUNT.extend({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null},l);GRUNT.Log.info("attempting to calculate route");var k=SLICK.Geo.getEngine("route");k&&k.route(l,function(f){if(l.map){p.createMapOverlay(l.map,f);if(l.autoFit){GRUNT.Log.info("AUTOFITTING MAP TO ROUTE: bounds = "+f.boundingBox);l.map.gotoBounds(f.boundingBox)}}l.success&&l.success(f)})},createMapOverlay:function(l,k){var f=l.getDimensions();f=new SLICK.Mapping.RouteOverlay({data:k,
width:f.width,height:f.height});l.setLayer("route",f)},Maneuver:{None:0,Continue:1,TurnLeft:100,TurnLeftSlight:101,TurnLeftSharp:102,TurnRight:110,TurnRightSlight:111,TurnRightSharp:112,TurnAround:190,EnterRoundabout:200,ExitRamp:300},Instruction:function(l){l=GRUNT.extend({position:null,description:"",manuever:p.Maneuver.None},l);return GRUNT.extend(l,{})},RouteData:function(l){l=GRUNT.extend({geometry:[],instructions:[],boundingBox:null},l);if(!l.boundingBox)l.boundingBox=SLICK.Geo.getBoundsForPositions(l.geometry);
return l}};return p}();
