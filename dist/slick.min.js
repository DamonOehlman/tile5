if(!this.JSON)this.JSON={};
(function(){function o(c){return c<10?"0"+c:c}function h(c){g.lastIndex=0;return g.test(c)?'"'+c.replace(g,function(i){var l=e[i];return typeof l==="string"?l:"\\u"+("0000"+i.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+c+'"'}function j(c,i){var l,k,m,q,r=a,n,p=i[c];if(p&&typeof p==="object"&&typeof p.toJSON==="function")p=p.toJSON(c);if(typeof f==="function")p=f.call(i,c,p);switch(typeof p){case "string":return h(p);case "number":return isFinite(p)?String(p):"null";case "boolean":case "null":return String(p);
case "object":if(!p)return"null";a+=d;n=[];if(Object.prototype.toString.apply(p)==="[object Array]"){q=p.length;for(l=0;l<q;l+=1)n[l]=j(l,p)||"null";m=n.length===0?"[]":a?"[\n"+a+n.join(",\n"+a)+"\n"+r+"]":"["+n.join(",")+"]";a=r;return m}if(f&&typeof f==="object"){q=f.length;for(l=0;l<q;l+=1){k=f[l];if(typeof k==="string")if(m=j(k,p))n.push(h(k)+(a?": ":":")+m)}}else for(k in p)if(Object.hasOwnProperty.call(p,k))if(m=j(k,p))n.push(h(k)+(a?": ":":")+m);m=n.length===0?"{}":a?"{\n"+a+n.join(",\n"+a)+
"\n"+r+"}":"{"+n.join(",")+"}";a=r;return m}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+o(this.getUTCMonth()+1)+"-"+o(this.getUTCDate())+"T"+o(this.getUTCHours())+":"+o(this.getUTCMinutes())+":"+o(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
g=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,a,d,e={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},f;if(typeof JSON.stringify!=="function")JSON.stringify=function(c,i,l){var k;d=a="";if(typeof l==="number")for(k=0;k<l;k+=1)d+=" ";else if(typeof l==="string")d=l;if((f=i)&&typeof i!=="function"&&(typeof i!=="object"||typeof i.length!=="number"))throw Error("JSON.stringify");return j("",
{"":c})};if(typeof JSON.parse!=="function")JSON.parse=function(c,i){function l(m,q){var r,n,p=m[q];if(p&&typeof p==="object")for(r in p)if(Object.hasOwnProperty.call(p,r)){n=l(p,r);if(n!==undefined)p[r]=n;else delete p[r]}return i.call(m,q,p)}var k;c=String(c);b.lastIndex=0;if(b.test(c))c=c.replace(b,function(m){return"\\u"+("0000"+m.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(c.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){k=eval("("+c+")");return typeof i==="function"?l({"":k},""):k}throw new SyntaxError("JSON.parse");}})();if(!String.format)String.format=function(o){if(arguments.length<=1)return o;for(var h=arguments.length-2,j=0;j<=h;j++)o=o.replace(RegExp("\\{"+j+"\\}","gi"),arguments[j+1]);return o};
String.prototype.containsWord=function(o){var h="";if(o.toString)o=o.toString();for(var j=0;j<o.length;j++)h+=!/\w/.test(o[j])?"\\"+o[j]:o[j];return RegExp("(^|\\s|\\,)"+h+"(\\,|\\s|$)","i").test(this)};Number.prototype.toRad=function(){return this*Math.PI/180};Number.prototype.sec=function(){return 1/Math.cos(this)};
GRUNT=function(){var o=Object.prototype.hasOwnProperty,h=0,j={id:"GRUNT.core",extend:function(){var b=arguments[0]||{},g=1,a=arguments.length,d=false,e,f,c,i;if(typeof b==="boolean"){d=b;b=arguments[1]||{};g=2}if(typeof b!=="object"&&!j.isFunction(b))b={};if(a===g){b=this;--g}for(;g<a;g++)if((e=arguments[g])!=null)for(f in e){c=b[f];i=e[f];if(b!==i)if(d&&i&&(j.isPlainObject(i)||j.isArray(i))){c=c&&(j.isPlainObject(c)||j.isArray(c))?c:j.isArray(i)?[]:{};b[f]=j.extend(d,c,i)}else if(i!==undefined)b[f]=
i}return b},isFunction:function(b){return toString.call(b)==="[object Function]"},isArray:function(b){return toString.call(b)==="[object Array]"},isPlainObject:function(b){if(!b||toString.call(b)!=="[object Object]"||b.nodeType||b.setInterval)return false;if(b.constructor&&!o.call(b,"constructor")&&!o.call(b.constructor.prototype,"isPrototypeOf"))return false;var g;for(g in b);return g===undefined||o.call(b,g)},isEmptyObject:function(b){for(var g in b)return false;return true},isXmlDocument:function(b){return toString.call(b)===
"[object Document]"},contains:function(b,g){var a=b,d=arguments,e=1;if(g&&j.isArray(g)){d=g;e=0}for(e=e;e<d;e++)a=a&&typeof foo[d[e]]!=="undefined";return a},newModule:function(b){b=j.extend({id:null,requires:[],parent:null},b);if(b.parent)b=j.extend({},b.parent,b);return b},toID:function(b){return b.replace(/\s/g,"-")},generateObjectID:function(b){return(b?b:"obj")+h++}};return j}();
GRUNT.Log=function(){function o(a,d){var e,f=d&&d.length>0?d[0]:"";for(e=1;d&&e<d.length;e++)f+=" "+(j&&GRUNT.isPlainObject(d[e])?JSON.stringify(d[e]):d[e]);typeof console!=="undefined"&&console[a](f);for(e=0;e<h.length;e++)h[e].call(g,f,a)}var h=[],j=typeof JSON!=="undefined",b=window.console&&window.console.markTimeline,g={id:"GRUNT.log",getTraceTicks:function(){return b?(new Date).getTime():null},trace:function(a,d){if(b)console.markTimeline(a+(d?": "+(g.getTraceTicks()-d)+"ms":""))},debug:function(){o("debug",
arguments)},info:function(){o("info",arguments)},warn:function(){o("warn",arguments)},error:function(){o("error",arguments)},exception:function(a){g.error(arguments);for(var d in a)g.info("ERROR DETAIL: "+d+": "+a[d])},watch:function(a,d){try{d()}catch(e){g.exception(e,a)}},throwError:function(a){g.error(a);throw Error(a);},requestUpdates:function(a){h.push(a)}};return g}();
GRUNT.Data=function(){var o={determineObjectMapping:function(j){if(!j)return null;j=j.split("|");for(var b={},g=0;g<j.length;g++)b[j[g]]=g;return b},mapLineToObject:function(j,b){var g=j.split("|"),a={};for(var d in b){var e=b[d];a[d]=g.length>e?g[e]:null}return a},parse:function(j){var b=null,g=[];j=j.split("\n");for(var a=0;a<j.length;a++){var d=j[a];if(b)g.push(o.mapLineToObject(d,b));else b=o.determineObjectMapping(d)}return g}},h={supportedFormats:{JSON:{parse:function(j){return JSON.parse(j)}},
PDON:{parse:function(j){return o.parse(j)}}},parse:function(j){j=GRUNT.extend({data:"",format:"JSON"},j);if(!h.supportedFormats[j.format])throw Error("Unsupported data format: "+j.format+", cannot parse data in javascript object");try{return h.supportedFormats[j.format].parse(j.data)}catch(b){GRUNT.Log.error("ERROR PARSING DATA FROM FORMAT: "+j.format,j.data);GRUNT.Log.exception(b)}return{}}};return h}();
GRUNT.Template=function(){var o=/\$\{(.*?)\}/ig;return{parse:function(h,j){for(var b=h,g=o.exec(b);g;){b=b.replace(g[0],GRUNT.XPath.first(g[1],j));o.lastIndex=0;g=o.exec(b)}return b}}}();
GRUNT.JSONP=function(){function o(g){var a=document.createElement("script"),d=false;a.src=g;a.async=true;a.onload=a.onreadystatechange=function(){if(!d&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){d=true;a.onload=a.onreadystatechange=null;a&&a.parentNode&&a.parentNode.removeChild(a)}};j||(j=document.getElementsByTagName("head")[0]);j.appendChild(a)}var h=0,j,b=this;return{get:function(g,a){g+=g.indexOf("?")>=0?"&":"?";var d="json"+ ++h;b[d]=function(e){a(e);b[d]=
null;try{delete b[d]}catch(f){}};o(g+"callback="+d);return d}}}();
GRUNT.XHR=function(){var o={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},h={JSON:["json"],PDON:["pdon.txt"]},j=["TEXT","STREAM"],b=/^(\w+:)?\/\/([^\/?#]+)/,g={XML:function(e){return e.responseXML},JSON:function(e){try{return JSON.parse(e.responseText)}catch(f){GRUNT.Log.error("Error parsing JSON data: ",e.responseText);GRUNT.Log.exception(f)}return""},PDON:function(e){return GRUNT.Data.parse({data:e.responseText,format:"PDON"})},DEFAULT:function(e){return e.responseText}},
a={CONTENT_TYPE:"Content-Type"},d=GRUNT.newModule({id:"GRUNT.xhr",ajaxSettings:{xhr:null},ajax:function(e){try{e=GRUNT.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},d.ajaxSettings,e);var f=b.exec(e.url),c=f&&(f[1]&&f[1]!==location.protocol||f[2]!==location.host);if(e.data)e.method="POST";if(e.url){f=null;if(e.xhr)f=e.xhr(e);f||(f=new XMLHttpRequest);f.open(e.method,e.url,e.async);e.data&&f.setRequestHeader("Content-Type",
e.contentType);c||f.setRequestHeader("X-Requested-With","XMLHttpRequest");f.onreadystatechange=function(){if(this.readyState===4){var l=null,k=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(k)if(e.handleResponse)e.handleResponse(this);else{var m=e,q=this.getResponseHeader(a.CONTENT_TYPE),r,n=false;for(r in o)if(q&&q.indexOf(o[r])>=0){n=true;break}q=!n;for(n=0;n<j.length;n++)q=q||j[n]==r;if(q)b:{q=r;for(var p in h)for(n=
0;n<h[p].length;n++)if(RegExp(h[p][n]+"$","i").test(m.url)){r=p;break b}r=q?q:"DEFAULT"}try{l=g[r](this,m)}catch(s){GRUNT.Log.warn("error applying processor '"+r+"' to response type, falling back to default");l=g.DEFAULT(this,m)}}else e.error&&e.error(this)}catch(u){GRUNT.Log.exception(u,"PROCESSING AJAX RESPONSE")}k&&l&&e.success&&e.success.call(this,l)}};f.send(e.method=="POST"?d.param(e.data):null)}else GRUNT.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(i){GRUNT.Log.exception(i)}},
param:function(e){var f=[],c=function(l,k){k=GRUNT.isFunction(k)?k():k;f[f.length]=encodeURIComponent(l)+"="+encodeURIComponent(k)};if(GRUNT.isArray(e))for(var i=0;i<e.length;i++)c(e[i].name,e[i].value);else for(i in e)c(i,e[i]);return f.join("&").replace(/%20/g,"+")}});return d}();
GRUNT.XPath=function(){function o(g){for(var a=null,d=0;d<h.length;d++)if(a=h[d](g))break;return a}var h=[],j=[null,function(g){return g.numberValue},function(g){return g.stringValue},function(g){return g.booleanValue},null,null,null,null,function(g){return g.singleNodeValue?g.singleNodeValue.textContent:null},function(g){return g.singleNodeValue?g.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||GRUNT.Log.warn("No XPATH support, this is going to cause problems");var b={SearchResult:function(g){return{toString:function(){var a=
null;if(g){var d=null;if(g.resultType>=0&&g.resultType<j.length)d=j[g.resultType];if(d){GRUNT.Log.info("invoking match handler for result type: "+g.resultType);a=d(g)}}return a?a:""}}},first:function(g,a){var d=b.SearchResult,e;var f=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!f)f=XPathResult.ANY_TYPE;try{if(GRUNT.isXmlDocument(a))e=a.evaluate(g,a,o,f,null);else{GRUNT.Log.warn("attempted xpath expression: "+g+" on a non-xml document");e=null}}catch(c){GRUNT.Log.warn("attempted to run invalid xpath expression: "+
g+" on node: "+a);e=null}return new d(e)},registerResolver:function(g){h.push(g)}};return b}();GRUNT.WaterCooler=function(){var o={};return{listen:function(h,j){o[h]||(o[h]=[]);j&&o[h].push(j)},say:function(h,j){if(o[h])for(var b=0;b<o[h].length;b++)o[h][b](j)},leave:function(){}}}();
SLICK=function(){var o={copyRect:function(h){return h?new o.Rect(h.origin.x,h.origin.y,h.dimensions.width,h.dimensions.height):null},Settings:function(){var h={};return{get:function(j){return h[j]},set:function(j,b){h[j]=b},extend:function(j){GRUNT.extend(h,j)}}}(),Clock:function(){var h=null;return{getTime:function(j){return j&&h?h:h=(new Date).getTime()}}}(),Vector:function(h,j){return{x:h?h:0,y:j?j:0}},V:function(){return{create:function(h,j){return new o.Vector(h,j)},add:function(){for(var h=
new o.Vector,j=arguments.length;j--;){h.x+=arguments[j].x;h.y+=arguments[j].y}return h},absSize:function(h){return Math.max(Math.abs(h.x),Math.abs(h.y))},diff:function(h,j){return new o.Vector(h.x-j.x,h.y-j.y)},copy:function(h){return h?new o.Vector(h.x,h.y):null},invert:function(h){return new SLICK.Vector(-h.x,-h.y)},offset:function(h,j,b){return new SLICK.Vector(h.x+j,h.y+(b?b:j))}}}(),VectorArray:function(h,j){for(var b=Array(h.length),g=h.length;g--;)b[g]=j?o.V.copy(h[g]):h[g];return{applyOffset:function(a){for(var d=
b.length;d--;){b[d].x+=a.x;b[d].y+=a.y}},getRect:function(){return new SLICK.Rect(Math.min(b[0].x,b[1].x),Math.min(b[0].y,b[1].y),Math.abs(b[0].x-b[1].x),Math.abs(b[0].y-b[1].y))},toString:function(){for(var a="",d=b.length;d--;)a+="["+b[d].toString()+"] ";return a}}},VectorMath:function(){function h(j){if(!j||j.length<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var b={edges:Array(j.length-1),accrued:Array(j.length-1),total:0},g=SLICK.V.diff,a=0;a<j.length-
1;a++){var d=g(j[a],j[a+1]);b.edges[a]=Math.sqrt(d.x*d.x+d.y*d.y);b.accrued[a]=b.total+b.edges[a];b.total+=b.edges[a]}return b}return{edges:h,distance:function(j){return h(j).total},theta:function(j,b,g){g=Math.asin((j.y-b.y)/g);return j.x>b.x?g:Math.PI-g},pointOnEdge:function(j,b,g,a){b=new SLICK.Vector(Math.cos(g)*a,Math.sin(g)*a);return new SLICK.Vector(j.x-b.x,j.y-b.y)}}}(),Dimensions:function(h,j){var b=j?h/j:1,g={width:h,height:j,aspect_ratio:b,inv_aspect_ratio:1/b,getAspectRatio:function(){return g.height!==
0?g.width/g.height:1},getCenter:function(){return new SLICK.Vector(g.width>>1,g.height>>1)},grow:function(a,d){return new SLICK.Dimensions(g.width+a,g.height+d)},matches:function(a){return a&&g.width==a.width&&g.height==a.height},toString:function(){return g.width+" x "+g.height}};return g},Rect:function(h,j,b,g){var a={origin:new SLICK.Vector(h,j),dimensions:new SLICK.Dimensions(b,g),getCenter:function(){return new SLICK.Vector(a.origin.x+(a.dimensions.width>>1),a.origin.y+(a.dimensions.height>>
1))},getSize:function(){return Math.sqrt(Math.pow(a.dimensions.width,2)+Math.pow(a.dimensions.height,2))},grow:function(d,e){var f=new SLICK.Dimensions(d-a.dimensions.width,e-a.dimensions.height);a.dimensions.width=d;a.dimensions.height=e;return f},expand:function(d,e){a.origin.x-=d;a.origin.y-=e;a.dimensions.width+=d;a.dimensions.height+=e},offset:function(d){return new o.Rect(a.origin.x+d.x,a.origin.y+d.y,a.dimensions.width,a.dimensions.height)},getRequiredDelta:function(d,e){var f={top:0,left:0,
bottom:0,right:0};f.top=d.origin.y-a.origin.y+(e?e.y:0);f.left=d.origin.x-a.origin.x+(e?e.x:0);f.right=d.origin.x+d.dimensions.width-(a.origin.x+a.dimensions.width)-f.left;f.bottom=d.origin.y+d.dimensions.height-(a.origin.y+a.dimensions.height)-f.top;return f},applyDelta:function(d,e,f){if(!d||!GRUNT.contains(d,["top","left","bottom","right"]))throw Error("Invalid delta - cannot apply to SLICK.Rect");e||(e=1);a.origin.x+=d.left*e;a.origin.y+=d.top*e;a.dimensions.width+=d.right*e;a.dimensions.height+=
d.bottom*e;f&&a.constrainAspectRatio(f)},constrainAspectRatio:function(d){var e=0,f={top:0,left:0,bottom:0,right:0};if(a.dimensions.getAspectRatio()<d){e=Math.abs(a.dimensions.width-a.dimensions.height*d);f.left=-e;f.right=e}else{e=Math.abs(a.dimensions.height-a.dimensions.width/d);f.top=-e;f.bottom=e}a.applyDelta(f)},moveTo:function(d,e){var f=new SLICK.Vector(d-a.origin.x,e-a.origin.y);a.origin.x=d;a.origin.y=e;return f},toString:function(){return String.format("(origin: {0}, dimensions: {1})",
a.origin,a.dimensions)}};return a}};return o}();
SLICK.Device=function(){function o(){h={base:{name:"Unknown",eventTarget:document,supportsTouch:"createTouch"in document,imageCacheMaxSize:4096,getScaling:function(){return 1},maxImageLoads:4,requireFastDraw:false},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:true},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144},android:{name:"Android OS <= 2.1",regex:/android/i,eventTarget:document.body,
supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio}},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true}};j=[h.froyo,h.android,h.ipod,h.iphone,h.ipad]}var h=null,j=[],b=null;return{getConfig:function(){h||o();if(!b){GRUNT.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var g=0;g<j.length;g++){var a=j[g];if(a.regex&&a.regex.test(navigator.userAgent)){b=GRUNT.extend({},h.base,a);GRUNT.Log.info("PLATFORM DETECTED AS: "+
b.name);break}}if(!b){GRUNT.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");b=h.base}GRUNT.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return b}}}();
SLICK.Resources=function(){var o="",h={},j=function(){function g(){var n=f[this.id];if(n){n.loaded=true;n.hitCount=1;for(var p=l.length;p--;)if(l[p].image.src==this.src){l.splice(p,1);break}n.loadCallback&&n.loadCallback(this,false);k.push({url:this.src,created:n.requested});delete f[this.id];a()}}function a(){for(var n=SLICK.Device.getConfig().maxImageLoads;i.length>0&&(!n||l.length<n);){var p=i.shift();l.push(p);p.image.onload=g;p.image.src=p.url;p.requested=(new Date).getTime()}}function d(){q=
true;try{var n=Math.floor(k.length*0.5);if(n>0){k.sort(function(s,u){return s.created-u.created});for(var p=n;p--;)delete e[k[p].url];k.splice(0,n)}}finally{q=false}GRUNT.WaterCooler.say("imagecache.cleared")}var e={},f={},c=0,i=[],l=[],k=[],m=0,q=false,r={loadingImages:l,queuedImages:i,getCacheFullness:function(){return m},getImage:function(n){var p=null;q||(p=e[n]);return p?p.image:null},loadImage:function(n,p){var s=e[n];if(s){s.hitCount++;s.image.complete&&p&&p(s.image,true)}else{s={url:b.getPath(n),
image:new Image,loaded:false,created:(new Date).getTime(),requested:null,hitCount:0,loadCallback:p};s.image.id="resourceLoaderImage"+c++;e[n]=s;f[s.image.id]=s;i.push(s);a()}return s},resetLoadingQueue:function(){l=[]}};setInterval(function(){for(var n=(new Date).getTime(),p=false,s=0,u=SLICK.Device.getConfig();s<l.length;)if(n-l[s].requested>b.loadTimeout*1E3){l.splice(s,1);p=true}else s++;p&&a();if(u&&u.imageCacheMaxSize){m=k.length*b.avgImageSize/u.imageCacheMaxSize;m>=1&&d()}},1E3);return r}(),
b={avgImageSize:25,loadTimeout:10,Cache:function(){return{read:function(){return null},write:function(){},getUrlCacheKey:function(g,a){for(var d=(g?g.replace(/^.*\?/,""):"").split("&"),e=g?g.replace(/\?.*$/,"?"):"",f=0;f<d.length;f++){var c=d[f].split("=");if(!a||!a.test(c[0]))e+=d[f]+"&"}return e.replace(/\W/g,"")},isValidCacheKey:function(g){GRUNT.Log.info("cache key = "+g);return false}}}(),getCachedUrl:function(g){return g},getPath:function(g){return/^(https?|\/)/.test(g)?g:o+g},setBasePath:function(g){o=
g},getImage:function(g){return j.getImage(g)},loadImage:function(g,a){j.loadImage(g,a)},resetImageLoadQueue:function(){j.resetLoadingQueue()},getStats:function(){return{imageLoadingCount:j.loadingImages.length,queuedImageCount:j.queuedImages.length,imageCacheFullness:j.getCacheFullness()}},loadResource:function(g){g=GRUNT.extend({filename:"",cacheable:true,dataType:null,callback:null},g);var a=function(d){g.callback&&GRUNT.Log.watch("CALLING RESOURCE CALLBACK",function(){g.callback(d)})};g.cacheable&&
h[g.filename]?a(h[g.filename]):GRUNT.XHR.ajax({url:b.getPath(g.filename),dataType:g.dataType,success:function(d){if(g.cacheable)h[g.filename]=d;a(d)},error:function(d,e,f){GRUNT.Log.error("error loading resource ["+g.filename+"], error = "+f)}})},loadSnippet:function(g,a){/\.\w+$/.test(g)||(g+=".html");b.loadResource({filename:"snippets/"+g,callback:a,dataType:"html"})}};return b}();
SLICK.Touch=function(){function o(c,i){var l=c&&c.length>0?c[0]:null;if(l&&i&&i.length>0)return SLICK.V.diff(l,i[0]);return null}function h(c){c.preventDefault();c.stopPropagation()}function j(c){for(var i=Array(c.length),l=c.length;l--;)i[l]=new SLICK.Vector(c[l].pageX,c[l].pageY);return i}var b={TAP:0,MOVE:1,PINCHZOOM:2},g=7,a=0,d=0,e={TouchHelper:function(c){function i(t){t=new SLICK.VectorArray(t,true);c.element&&t.applyOffset(new SLICK.Vector(-c.element.offsetLeft,-c.element.offsetTop));return t}
function l(t){var z=Array(arguments.length-1),D=0;for(D=1;D<arguments.length;D++)z[D-1]=arguments[D];for(D=F.length;D--;)F[D][t]&&F[D][t].apply(M,z)}function k(t){if(t.target&&t.target===c.element){s=p?j(t.touches):[new SLICK.Vector(t.pageX,t.pageY)];y=new SLICK.Vector;x=new SLICK.Vector;E=true;r=false;p&&h(t);I.current=SLICK.Clock.getTime();if(t=s.length>0?s[0]:null){l("touchStartHandler",t.x,t.y);if(I.current-I.last<M.THRESHOLD_DOUBLETAP)if((t=u?SLICK.V.diff(s[0],u[0]):null)&&Math.abs(t.x)<c.maxDistDoubleTap&&
Math.abs(t.y)<c.maxDistDoubleTap)r=true;B=b.TAP;u=[].concat(s)}else GRUNT.Log.warn("Touch start fired, but no touch vector found")}}function m(t){if(t.target&&t.target===c.element)if(E)try{p&&h(t);var z=p?j(t.touches):[new SLICK.Vector(t.pageX,t.pageY)];t=0;if(z.length>1){if(s.length===1)s=[].concat(z);t=SLICK.VectorMath.distance(s)-SLICK.VectorMath.distance(u)}if(B===b.TAP){var D=o(z,s);if(D&&(Math.abs(D.x)>=g||Math.abs(D.y)>=g))B=b.MOVE}if(B!==b.TAP)if(!t||Math.abs(t)<c.pinchZoomThreshold){if(y=
o(z,u)){x.x+=y.x;x.y+=y.y;A.x+=y.x;A.y+=y.y}if(SLICK.V.absSize(A)>c.panEventThreshhold){l("moveHandler",A.x,A.y);A=SLICK.V.create()}B=b.MOVE}else{l("pinchZoomHandler",i(s),i(z));B=b.PINCHZOOM}u=[].concat(z)}catch(J){GRUNT.Log.exception(J)}}function q(t){if(t.target&&t.target===c.element)try{p&&h(t);SLICK.Clock.getTime();I.last=I.current;if(B===b.TAP)n||(n=setTimeout(function(){n=0;var D=r?"doubleTapHandler":"tapHandler",J=s[0],P=null;if(c.element)P=SLICK.V.offset(J,-c.element.offsetLeft,-c.element.offsetTop);
l(D,J,P)},M.THRESHOLD_DOUBLETAP+50));else if(B==b.MOVE)l("moveEndHandler",x.x,x.y);else B==b.PINCHZOOM&&l("pinchZoomEndHandler",i(s),i(u));E=false}catch(z){GRUNT.Log.exception(z)}}c=GRUNT.extend({element:null,inertiaTrigger:20,maxDistDoubleTap:20,panEventThreshhold:0,pinchZoomThreshold:5,touchStartHandler:null,moveHandler:null,moveEndHandler:null,pinchZoomHandler:null,pinchZoomEndHandler:null,tapHandler:null,doubleTapHandler:null,wheelZoomHandler:null},c);var r=false,n=0,p=SLICK.Device.getConfig().supportsTouch,
s=null,u=null,y=null,x=null,A=new SLICK.Vector,B=null,E=false,F=[],I={current:0,last:0},G=SLICK.Device.getConfig(),M={supportsTouch:p,THRESHOLD_DOUBLETAP:300,addListeners:function(t){F.push(t)},decoupleListeners:function(t){for(var z=0;t&&z<F.length;z++)if(F[z].listenerId===t){F.splice(z,1);GRUNT.Log.info("successfully decoupled touch listener: "+t);break}},release:function(){G.eventTarget.removeEventListener(G.supportsTouch?"touchstart":"mousedown",k,false);G.eventTarget.removeEventListener(G.supportsTouch?
"touchmove":"mousemove",m,false);G.eventTarget.removeEventListener(G.supportsTouch?"touchend":"mouseup",q,false)},wheelie:function(t){var z=new SLICK.Vector(t.wheelDeltaX,t.wheelDeltaY);t=new SLICK.Vector(t.clientX,t.clientY);var D=z.y!==0?Math.abs(z.y/120):0;if(D!==0)l("wheelZoomHandler",t,z.y>0?D+0.5:0.5/D);GRUNT.Log.info("capture mouse wheel event, delta = "+z+", position = "+t)}};G.eventTarget.addEventListener(G.supportsTouch?"touchstart":"mousedown",k,false);G.eventTarget.addEventListener(G.supportsTouch?
"touchmove":"mousemove",m,false);G.eventTarget.addEventListener(G.supportsTouch?"touchend":"mouseup",q,false);return M}},f=[];return{captureTouch:function(c,i){try{if(!c)throw Error("Unable to capture touch of null element");if(!c.id)c.id="touchable_"+a++;var l=f[c.id];if(!l){l=e.TouchHelper(GRUNT.extend({element:c},i));f[c.id]=l;GRUNT.Log.info("CREATED TOUCH HELPER. SUPPORTS TOUCH = "+l.supportsTouch)}i.listenerId&&l.decoupleListeners(i.listenerId);i.listenerId=++d;l.addListeners(i)}catch(k){GRUNT.Log.exception(k)}},
resetTouch:function(c){if(c&&c.id&&f[c.id]){f[c.id].release();delete f[c.id]}}}}();if(typeof jQuery!=="undefined"){jQuery.fn.canTouchThis=function(o){return this.each(function(){SLICK.Touch.captureTouch(this,o)})};jQuery.fn.untouchable=function(){return this.bind("touchmove",function(o){o.preventDefault()})}}
SLICK.Pannable=function(o){o=GRUNT.extend({container:null,onPan:null,onPanEnd:null,onAnimate:null,checkOffset:null},o);var h=false,j=new SLICK.Vector,b={pannable:true,getOffset:function(){return new SLICK.Vector(j.x,j.y)},setOffset:function(a,d){j.x=a;j.y=d},pan:function(a,d,e){if(e)b.updateOffset(j.x+a,j.y+d,e);else{b.updateOffset(j.x+a,j.y+d);o.onPan&&o.onPan(a,d)}},isAnimating:function(){return h},panEnd:function(a,d){o.onPanEnd&&o.onPanEnd(a,d)},updateOffset:function(a,d,e){if(e){a=new SLICK.Vector(a,
d);h=true;e=SLICK.Animation.tweenVector(j,a.x,a.y,e,function(){h=false;b.panEnd(0,0)});for(a=e.length;a--;){e[a].cancelOnInteract=true;e[a].requestUpdates(function(){o.onAnimate&&o.onAnimate(j.x,j.y)})}}else b.setOffset(a,d)}},g=document.getElementById(o.container);g&&SLICK.Touch.captureTouch(g,{moveHandler:function(a,d){b.pan(-a,-d)},moveEndHandler:function(a,d){b.panEnd(a,d)}});return b};
SLICK.Scalable=function(o){function h(k,m){b=k.getRect();g=m.getRect();var q=b.getSize(),r=g.getSize();c=g.getCenter();a=b&&q!==0?r/q:1}o=GRUNT.extend({container:null,onAnimate:null,onPinchZoom:null,onScale:null,scaleDamping:false},o);var j=false,b=null,g=null,a=1,d=null,e=null,f=null,c=null,i={scalable:true,animate:function(k,m,q,r,n){function p(){n&&n();j=false;o.onScale&&o.onScale(a,c);a=1;d=null}j=true;f=SLICK.V.copy(m);c=SLICK.V.copy(q);b=null;if(r){e=a;SLICK.Animation.tweenValue(0,k-e,r,p,1E3).requestUpdates(function(s){d=
s/(k-e);a=e+s;o.onAnimate&&o.onAnimate()})}else{a=k;p()}},getScaleInfo:function(){return{factor:a,startRect:SLICK.copyRect(b),endRect:SLICK.copyRect(g),start:f,center:c,progress:d}},getScaling:function(){return j},getScaleFactor:function(){return a}},l=document.getElementById(o.container);l&&SLICK.Touch.captureTouch(l,{pinchZoomHandler:function(k,m){h(k,m);(j=a!==1)&&o.onPinchZoom&&o.onPinchZoom(k,m)},pinchZoomEndHandler:function(k,m){h(k,m);j=false;o.onScale&&o.onScale(a,c,true);a=1},wheelZoomHandler:function(k){b=
g=null;c=SLICK.V.copy(k)}});return i};
SLICK.Dispatcher=function(){var o=[],h={execute:function(j){var b=h.findAction(j);GRUNT.Log.info("looking for action id: "+j+", found: "+b);if(b){var g=[].concat(arguments).slice(0,1);GRUNT.Log.watch("EXECUTING ACTION: "+j,function(){b.execute(g)})}},findAction:function(j){for(var b=o.length;b--;)if(o[b].id==j)return o[b];return null},getRegisteredActions:function(){return[].concat(o)},getRegisteredActionIds:function(){for(var j=[],b=o.length;b--;)o[b].id&&j.push(o[b].id);return j},registerAction:function(j){j&&
j.id&&o.push(j)},Action:function(j){j=GRUNT.extend({autoRegister:true,id:"",title:"",icon:"",execute:null},j);var b={id:j.id,execute:function(){j.execute&&j.execute.apply(this,arguments)},getParam:function(g){return j[g]?j[g]:""},toString:function(){return String.format("{0} [title = {1}, icon = {2}]",b.id,j.title,j.icon)}};j.autoRegister&&h.registerAction(b);return b},createAgent:function(j){j=GRUNT.extend({name:"Untitled",trashOrphanedResults:true,translator:null,execute:null},j);var b=null,g={getName:function(){return j.name},
getParam:function(a){return j[a]},getId:function(){return GRUNT.toID(g.getName())},run:function(a,d){if(j.execute){var e=b=SLICK.Clock.getTime(true),f=j.translator?j.translator(a):a;j.execute.call(g,f,function(c,i){if(!j.trashOrphanedResults||e==b)d&&d(c,i,f)})}}};return g},runAgents:function(j,b,g){for(var a=0;a<j.length;a++)j[a].run(b,g)}};return h}();
SLICK.Messaging=function(){var o=[],h=[],j=GRUNT.newModule({id:"slick.messaging",requires:["slick.core"],STATUS:{none:0,created:1,updated:2,handled:3},send:function(b){b=GRUNT.extend({type:"",payload:{},index:0,status:j.STATUS.created,statusChange:null},b);b.index=h.push(b)-1;b=b.index;var g=b>=0&&b<h.length?h[b]:null;GRUNT.Log.info("firing message update, index = "+b+", message = "+g);for(var a=0;g&&a<o.length&&g.status!==j.STATUS.handled;){var d=o[a].processUpdate(h[b]);if(d){d=d;o[a].getId();var e=
b>=0&&b<h.length?h[b]:null;if(e){e.status=d;e.statusChange&&e.statusChange(e)}}a++}},Handler:function(b){b=GRUNT.extend({id:"",processUpdate:null},b);var g={getId:function(){return b.id},processUpdate:function(a){if(b.processUpdate)return b.processUpdate(a);return j.STATUS.none}};o.push(g);return g}});return j}();
SLICK.Animation=function(){function o(){if(b===0)b=setInterval(function(){if(g.update(SLICK.Clock.getTime())===0){clearInterval(b);b=0}},20)}var h=[],j=false,b=0,g={DURATION:2E3,tweenValue:function(a,d,e,f,c){a=new g.Tween({startValue:a,endValue:d,tweenFn:e,complete:f,duration:c});h.push(a);return a},tween:function(a,d,e,f,c,i){a=new g.Tween({target:a,property:d,endValue:e,tweenFn:f,duration:i,complete:c});h.push(a);return a},tweenVector:function(a,d,e,f,c,i){var l=[];if(a){var k=a.x==d,m=a.y==e;
k||l.push(g.tween(a,"x",d,f,function(){(k=true)&&m&&c()},i));m||l.push(g.tween(a,"y",e,f,function(){m=true;k&&m&&c()},i))}return l},cancel:function(a){if(!j){j=true;try{for(var d=0;d<h.length;)if(!a||a(h[d])){GRUNT.Log.info("CANCELLING ANIMATION");h[d].triggerComplete(true);h.splice(d,1)}else d++}finally{j=false}}},isTweening:function(){return h.length>0},update:function(a){if(j)return h.length;j=true;try{for(var d=0;d<h.length;)if(h[d].isComplete()){h[d].triggerComplete(false);h.splice(d,1);GRUNT.WaterCooler.say("animation.complete")}else{h[d].update(a);
d++}}finally{j=false}return h.length},Tween:function(a){a=GRUNT.extend({target:null,property:null,startValue:0,endValue:null,duration:g.DURATION,tweenFn:g.DEFAULT,complete:null,cancelOnInteract:false},a);var d=SLICK.Clock.getTime(),e=[],f=false,c=0,i=0,l={cancelOnInteract:a.cancelOnInteract,isComplete:function(){return f},triggerComplete:function(k){a.complete&&a.complete(k)},update:function(k){try{var m=a.tweenFn(k-d,c,i,a.duration);if(a.target)a.target[a.property]=m;for(var q=e.length;q--;)e[q](m,
void 0);if(f=d+a.duration<=k){if(a.target)a.target[a.property]=a.tweenFn(a.duration,c,i,a.duration);for(var r=e.length;r--;)e[r](m,true)}}catch(n){GRUNT.Log.exception(n)}},requestUpdates:function(k){e.push(k)}};c=a.target&&a.property&&a.target[a.property]?a.target[a.property]:a.startValue;if(typeof a.endValue!=="undefined")i=a.endValue-c;if(i==0)f=true;o();return l},Easing:function(){var a=1.70158;return{Linear:function(d,e,f,c){return f*d/c+e},Back:{In:function(d,e,f,c){return f*(d/=c)*d*((a+1)*
d-a)+e},Out:function(d,e,f,c){return f*((d=d/c-1)*d*((a+1)*d+a)+1)+e},InOut:function(d,e,f,c){return(d/=c/2)<1?f/2*d*d*(((a*=1.525)+1)*d-a)+e:f/2*((d-=2)*d*(((a*=1.525)+1)*d+a)+2)+e}},Bounce:{In:function(d,e,f,c){return f-g.Easing.Bounce.Out(c-d,0,f,c)+e},Out:function(d,e,f,c){return(d/=c)<1/2.75?f*7.5625*d*d+e:d<2/2.75?f*(7.5625*(d-=1.5/2.75)*d+0.75)+e:d<2.5/2.75?f*(7.5625*(d-=2.25/2.75)*d+0.9375)+e:f*(7.5625*(d-=2.625/2.75)*d+0.984375)+e},InOut:function(d,e,f,c){return d<c/2?g.Easing.Bounce.In(d*
2,0,f,c)*0.5+e:g.Easing.Bounce.Out(d*2-c,0,f,c)*0.5+f*0.5+e}},Cubic:{In:function(d,e,f,c){return f*(d/=c)*d*d+e},Out:function(d,e,f,c){return f*((d=d/c-1)*d*d+1)+e},InOut:function(d,e,f,c){if((d/=c/2)<1)return f/2*d*d*d+e;return f/2*((d-=2)*d*d+2)+e}},Elastic:{In:function(d,e,f,c,i,l){if(d==0)return e;if((d/=c)==1)return e+f;l||(l=c*0.3);if(!i||i<Math.abs(f)){i=f;f=l/4}else f=l/(2*Math.PI)*Math.asin(f/i);return-(i*Math.pow(2,10*(d-=1))*Math.sin((d*c-f)*2*Math.PI/l))+e},Out:function(d,e,f,c,i,l){var k;
if(d==0)return e;if((d/=c)==1)return e+f;l||(l=c*0.3);if(!i||i<Math.abs(f)){i=f;k=l/4}else k=l/(2*Math.PI)*Math.asin(f/i);return i*Math.pow(2,-10*d)*Math.sin((d*c-k)*2*Math.PI/l)+f+e},InOut:function(d,e,f,c,i,l){var k;if(d==0)return e;if((d/=c/2)==2)return e+f;l||(l=c*0.3*1.5);if(!i||i<Math.abs(f)){i=f;k=l/4}else k=l/(2*Math.PI)*Math.asin(f/i);if(d<1)return-0.5*i*Math.pow(2,10*(d-=1))*Math.sin((d*c-k)*2*Math.PI/l)+e;return i*Math.pow(2,-10*(d-=1))*Math.sin((d*c-k)*2*Math.PI/l)*0.5+f+e}},Quad:{In:function(d,
e,f,c){return f*(d/=c)*d+e},Out:function(d,e,f,c){return-f*(d/=c)*(d-2)+e},InOut:function(d,e,f,c){if((d/=c/2)<1)return f/2*d*d+e;return-f/2*(--d*(d-2)-1)+e}},Sine:{In:function(d,e,f,c){return-f*Math.cos(d/c*(Math.PI/2))+f+e},Out:function(d,e,f,c){return f*Math.sin(d/c*(Math.PI/2))+e},InOut:function(d,e,f,c){return-f/2*(Math.cos(Math.PI*d/c)-1)+e}}}}()};return GRUNT.extend(g,{DEFAULT:g.Easing.Back.Out})}();SLICK.Border={NONE:0,TOP:1,RIGHT:2,BOTTOM:3,LEFT:4};
SLICK.Graphics=function(){var o={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,PINCHZOOM:16,FREEZE:128},h=0,j={DisplayState:o,AnyDisplayState:255,ActiveDisplayStates:o.ACTIVE|o.ANIMATING,DefaultDisplayStates:o.ACTIVE|o.ANIMATING|o.PAN|o.PINCHZOOM,ViewLayer:function(b){b=GRUNT.extend({id:"",centerOnScale:true,created:(new Date).getTime(),scalePosition:true,zindex:0,supportFastDraw:false,validStates:j.DefaultDisplayStates},b);var g=null,a=GRUNT.extend({isAnimating:function(){return false},addToView:function(d){d.setLayer(b.id,
a)},shouldDraw:function(d){var e=g?g.fastDraw&&d!==o.ACTIVE:false;return(d&b.validStates)!==0&&(e?b.supportFastDraw:true)},cycle:function(){return 0},draw:function(){},notify:function(){},remove:function(){GRUNT.WaterCooler.say("layer.remove",{id:b.id})},wakeParent:function(){GRUNT.WaterCooler.say("view.wake",{id:g?g.id:null})},getParent:function(){return g},setParent:function(d){g=d}},b);return a},StatusViewLayer:function(){return new j.ViewLayer({validStates:j.AnyDisplayState,zindex:5E3,draw:function(b,
g,a,d,e){b.fillStyle="#FF0000";b.fillRect(10,10,50,50);b.fillStyle="#FFFFFF";b.font="bold 10px sans";b.fillText(e.getDisplayState(),20,20)}})},AnimatedPathLayer:function(b){function g(i,l,k){i.fillStyle="#FFFFFF";i.strokeStyle="#222222";i.beginPath();i.arc(k.x,k.y,4,0,Math.PI*2,false);i.stroke();i.fill()}b=GRUNT.extend({path:[],id:GRUNT.generateObjectID("pathAnimation"),easing:SLICK.Animation.Easing.Sine.InOut,canCache:false,validStates:j.ActiveDisplayStates|o.PAN|o.PINCHZOOM,drawIndicator:null,duration:2E3,
autoCenter:false},b);var a=SLICK.VectorMath.edges(b.path),d,e=null,f=0;SLICK.Animation.tweenValue(0,a.total,b.easing,function(){c.remove()},b.duration).requestUpdates(function(i,l){f=i;l&&c.remove()});var c=GRUNT.extend(new j.ViewLayer(b),{cycle:function(){for(var i=0;i<a.accrued.length&&a.accrued[i]<f;)i++;e=null;if(i<b.path.length-1){var l=f-(i>0?a.accrued[i-1]:0),k=b.path[i],m=b.path[i+1];d=SLICK.VectorMath.theta(k,m,a.edges[i]);e=SLICK.VectorMath.pointOnEdge(k,m,d,l);if(b.autoCenter)(i=c.getParent())&&
i.centerOn(e)}return e?1:0},draw:function(i,l){if(e)(b.drawIndicator?b.drawIndicator:g)(i,l,new SLICK.Vector(e.x-l.x,e.y-l.y),d)}});return c},FPSLayer:function(b){b=GRUNT.extend({zindex:1E3,scalePosition:false},b);var g=null,a=GRUNT.extend(new j.ViewLayer(b),{delays:[],draw:function(d,e,f){d.font="bold 8pt Arial";d.textAlign="right";d.fillStyle="rgba(0, 0, 0, 0.8)";d.fillText((g?g:"?")+" fps",f.width-20,20)}});setInterval(function(){for(var d=0,e=a.delays.length,f=e;f--;)d+=a.delays[f];if(e!==0)g=
Math.floor(1E3/(d/e))},1E3);return a},ResourceStatsLayer:function(b){b=GRUNT.extend({zindex:500,indicatorSize:5,scalePosition:false,validStates:o.ACTIVE|o.PAN},b);return GRUNT.extend(new j.ViewLayer(b),{fps:null,draw:function(g){var a=SLICK.Resources.getStats(),d=b.indicatorSize,e=10,f;if(a.imageCacheFullness){g.strokeStyle="rgba(0, 0, 255, 1)";g.beginPath();g.arc(15,15,5,0,Math.PI*2*a.imageCacheFullness,false);g.stroke();e=30}if(a.imageLoadingCount>=0){g.fillStyle="rgba(0, 255, 0, 0.7)";for(f=a.imageLoadingCount;f--;)g.fillRect(e+
f*(d+2),10,d,d)}if(a.queuedImageCount>=0){g.fillStyle="rgba(255, 0, 0, 0.7)";for(f=a.queuedImageCount;f--;)g.fillRect(e+f*(d+2),10+d+2,d,d)}}})},LoadingLayer:function(b){GRUNT.extend({},b)},View:function(b){function g(v,w){w.id=v;w.setParent(H);c.push(w);c.sort(function(C,K){var L=K.zindex-C.zindex;if(L===0)L=K.created-C.created;return L})}function a(){GRUNT.WaterCooler.say("view-idle",{id:H.id});G=true;t=0}function d(v,w){var C=0,K=H.getScaleFactor(),L=H.getDisplayState(),T=(new Date).getTime(),
R=(L&o.PINCHZOOM)!==0;q=H.getScaleFactor();var Q=0;if(m||R){v.clearRect(0,0,i.width,i.height);m=false}if(R){var N=I.getScaleInfo();H.getDimensions().getCenter();var O=(N.progress?N.progress:1)*0.5;E=N.center;if(N.startRect){O=N.startRect.getCenter();O=SLICK.V.diff(O,E);z=new SLICK.Vector(E.x+O.x,E.y+O.y)}else{N=SLICK.V.diff(N.start,E);z=new SLICK.Vector(E.x-N.x*O,E.y-N.y*O)}if(z)w=SLICK.V.offset(w,z.x,z.y)}v.save();try{if(s!==1)v.scale(s,s);else if(R){v.translate(E.x,E.y);v.scale(K,K)}for(Q=c.length;Q--;)if(c[Q].shouldDraw(L)){var S=
c[Q].draw(v,w,y,L,H);C+=S?S:0}}finally{v.restore()}GRUNT.Log.trace("draw complete",T);return C}function e(){var v=0,w=J===o.PINCHZOOM||J===o.PAN;D=(new Date).getTime();k=F?F.getOffset():new SLICK.Vector;B&&r&&B.delays.push(D-r);if(w){SLICK.Animation.cancel(function(K){return K.cancelOnInteract});G=false;if(t!==0){clearTimeout(t);t=0}}for(w=c.length;w--;){var C=c[w].cycle(D,k);v+=C?C:0}v+=d(l,k);r=D;M=0;if(A+v>0)f();else if(!G&&t===0)t=setTimeout(a,500);GRUNT.Log.trace("Completed draw cycle",D)}function f(){A++;
if(!(p||M!==0)){A=0;M=setTimeout(e,0)}}b=GRUNT.extend({id:"view_"+h++,container:"",pannable:false,scalable:false,clearOnDraw:false,displayFPS:false,displayResourceStats:false,scaleDamping:false,fastDraw:false,fillStyle:"rgb(200, 200, 200)",initialDrawMode:"source-over",bufferRefresh:100,defaultFreezeDelay:500,onPan:null,onPinchZoom:null,onScale:null,onDraw:null,autoSize:false},b);var c=[],i=document.getElementById(b.container),l=null,k=new SLICK.Vector,m=false,q=1,r=null,n=0,p=false,s=1,u=new SLICK.Vector,
y=null,x=null,A=0,B=null,E=null,F=null,I=null,G=false,M=0,t=0,z=null,D=0,J=j.DisplayState.ACTIVE;GRUNT.Log.info("Creating a new view instance, attached to container: "+b.container+", canvas = ",i);if(i){SLICK.Touch.resetTouch(i);if(b.autoSize){GRUNT.Log.info("autosizing view: window.height = "+window.innerHeight+", width = "+window.innerWidth);i.height=window.innerHeight-i.offsetTop-49;i.width=window.innerWidth-i.offsetLeft}try{l=i.getContext("2d");l.globalCompositeOperation=b.initialDrawMode}catch(P){GRUNT.Log.exception(P);
throw Error("Could not initialise canvas on specified view element");}}if(b.pannable)F=new SLICK.Pannable({container:b.container,onAnimate:function(){f()},onPan:function(v,w){n=SLICK.Clock.getTime(true);f();u=SLICK.V.offset(u,v,w);b.onPan&&b.onPan(v,w);J=o.PAN},onPanEnd:function(){f();J=o.ACTIVE}});if(b.scalable)I=new SLICK.Scalable({scaleDamping:b.scaleDamping,container:b.container,onAnimate:function(){J=j.DisplayState.PINCHZOOM;f()},onPinchZoom:function(v,w){n=SLICK.Clock.getTime(true);f();b.onPinchZoom&&
b.onPinchZoom(v,w);J=j.DisplayState.PINCHZOOM},onScale:function(v,w){GRUNT.WaterCooler.say("view.scale",{id:H.id});J=j.DisplayState.ACTIVE;f();b.onScale&&b.onScale(v,w)}});var H=GRUNT.extend({},b,F,I,{id:b.id,deviceScaling:s,fastDraw:b.fastDraw||SLICK.Device.getConfig().requireFastDraw,centerOn:function(v){F.setOffset(v.x-i.width*0.5,v.y-i.height*0.5)},getDimensions:function(){if(i)return new SLICK.Dimensions(i.width,i.height)},getZoomCenter:function(){return z},getLayer:function(v){for(var w=0;w<
c.length;w++)if(c[w].id==v){/^grid/i.test(v)||GRUNT.Log.info("found layer: "+v);return c[w]}return null},setLayer:function(v,w){for(var C=0;C<c.length;C++)if(c[C].id===v){c.splice(C,1);break}w&&g(v,w);GRUNT.WaterCooler.say("layer.update",{value:w});f()},eachLayer:function(v){for(var w=0;w<c.length;w++)v(c[w])},clearBackground:function(){m=true},freeze:function(){p=true},unfreeze:function(){p=false;f()},snapshot:function(){},getDisplayState:function(){return p?o.FROZEN:J},scale:function(v,w,C,K,L){K||
(K=H.getDimensions().getCenter());L||(L=H.getDimensions().getCenter());I&&I.animate(v,K,L,w,C);return I},removeLayer:function(v,w){setTimeout(function(){var C;a:{for(C=c.length;C--;)if(c[C].id==v){C=C;break a}C=-1}if(C>=0&&C<c.length){GRUNT.WaterCooler.say("layer.remove",{layer:c[C]});c.splice(C,1)}},w?w:1)}});y=H.getDimensions();x=y.getCenter();GRUNT.WaterCooler.listen("layer.remove",function(v){v.id&&H.removeLayer(v.id)});GRUNT.WaterCooler.listen("view.wake",function(v){if(!v.id||v.id===H.id)f()});
s=SLICK.Device.getConfig().getScaling();if(b.displayFPS){B=new j.FPSLayer;H.setLayer("fps",B)}b.displayResourceStats&&H.setLayer("resourceStats",new j.ResourceStatsLayer);f();return H}};return j}();
SLICK.Tiling=function(){function o(){if(!j){j=document.createElement("canvas");j.width=g.Config.TILESIZE;j.height=g.Config.TILESIZE;var a=j.getContext("2d");a.fillStyle="rgba(150, 150, 150, 0.05)";a.fillRect(0,0,j.width,j.height)}return j}function h(){if(!b){b=document.createElement("canvas");b.width=g.Config.TILESIZE;b.height=g.Config.TILESIZE;var a=b.getContext("2d"),d=Math.sqrt(g.Config.TILESIZE);a.fillStyle="rgba(200, 200, 200, 1)";a.strokeStyle="rgb(190, 190, 190)";a.lineWidth=0.5;a.fillRect(0,
0,b.width,b.height);a.beginPath();for(var e=0;e<b.width;e+=d){a.moveTo(e,0);a.lineTo(e,b.height);for(var f=0;f<b.height;f+=d){a.moveTo(0,f);a.lineTo(b.width,f)}}a.stroke()}return b}TileStore=function(a){a=GRUNT.extend({gridSize:20,center:new SLICK.Vector,onPopulate:null},a);var d=Array(Math.pow(a.gridSize,2)),e=SLICK.V.offset(a.center,-Math.ceil(a.gridSize>>1)),f=null,c=new SLICK.Vector,i=null,l={getGridSize:function(){return a.gridSize},getNormalizedPos:function(k,m){return SLICK.V.add(new SLICK.Vector(k,
m),SLICK.V.invert(e),c)},getTileShift:function(){return SLICK.V.copy(c)},getTile:function(k,m){return k>=0&&k<a.gridSize?d[m*a.gridSize+k]:null},setTile:function(k,m,q){d[m*a.gridSize+k]=q},populate:function(k,m){var q=GRUNT.Log.getTraceTicks(),r=0;new SLICK.Vector(a.gridSize*0.5,a.gridSize*0.5);if(k)for(var n=0;n<a.gridSize;n++)for(var p=0;p<a.gridSize;p++){if(!d[r]){var s=k(p,n,e,a.gridSize);d[r]=s}r++}f=k;i=m;GRUNT.Log.trace("tile grid populated",q);a.onPopulate&&a.onPopulate()},getShiftDelta:function(k,
m,q,r){var n=Math.floor(a.gridSize*0.2),p=new SLICK.Vector;if(k<0||k+q>a.gridSize)p.x=k<0?-n:n;if(m<0||m+r>a.gridSize)p.y=m<0?-n:n;return p},shift:function(k,m){if(!(k.x===0&&k.y===0)){var q=GRUNT.Log.getTraceTicks(),r=Array(d.length);r.length=d.length;for(var n=0;n<a.gridSize;n++)for(var p=0;p<a.gridSize;p++)r[p*a.gridSize+n]=l.getTile(n+k.x,p+k.y);d=r;e=m?m(e,k):SLICK.V.add(e,k);c.x+=-k.x*a.tileSize;c.y+=-k.y*a.tileSize;GRUNT.Log.trace("tile storage shifted",q);l.populate(f,i)}},setOrigin:function(k,
m){if(tileOrigin)shiftOrigin(k,m);else e=SLICK.V.offset(new SLICK.Vector(k,m),-tileHalfWidth)}};GRUNT.WaterCooler.listen("imagecache.cleared",function(){for(var k=d.length;k--;)if(d[k])d[k].loaded=false});return l};var j=null,b=null,g={Config:{TILESIZE:256,TILEBUFFER:1,TILEBUFFER_LOADNEW:0.2},Tile:function(a){return a=GRUNT.extend({x:0,y:0,size:256},a)},ImageTile:function(a){a=GRUNT.extend({url:"",sessionParamRegex:null,loaded:false},a);return new g.Tile(a)},TileGrid:function(a){function d(n,p,s,
u){if((i?SLICK.V.absSize(SLICK.V.diff(i,p)):f)>=20){n=e.getTileShift();n=new SLICK.Vector(Math.floor((p.x+n.x)*c),Math.floor((p.y+n.y)*c));var y=Math.ceil(s.width*c)+1;s=Math.ceil(s.height*c)+1;var x=new SLICK.Vector((y-1)*0.5,(s-1)*0.5),A=new SLICK.Vector(n.x*a.tileSize,n.y*a.tileSize);u.isAnimating();k=[];tilesNeeded=false;for(var B=s;B--;)for(var E=B*a.tileSize+A.y,F=y;F--;){u=e.getTile(F+n.x,B+n.y);var I=F*a.tileSize+A.x,G=new SLICK.Vector(F-x.x,B-x.y);u||(m=e.getShiftDelta(n.x,n.y,y,s));k.push({tile:u,
coordinates:new SLICK.Vector(I,E),centerness:SLICK.V.absSize(G)})}k.sort(function(M,t){return t.centerness-M.centerness});i=SLICK.V.copy(p)}}a=GRUNT.extend({tileSize:SLICK.Tiling.Config.TILESIZE,drawGrid:false,center:new SLICK.Vector,shiftOrigin:null,supportFastDraw:true,checkChange:100},a);var e=new TileStore(GRUNT.extend({onPopulate:function(){l=true;r.wakeParent()}},a)),f=Math.round(a.tileSize>>1),c=a.tileSize?1/a.tileSize:0,i=null,l=false,k=[];new SLICK.Vector;var m=new SLICK.Vector,q=e.getGridSize()*
a.tileSize,r=GRUNT.extend(new SLICK.Graphics.ViewLayer(a),{gridDimensions:new SLICK.Dimensions(q,q),cycle:function(){var n=0;if(m.x+m.y!==0){e.shift(m,a.shiftOrigin);m=new SLICK.Vector;n++}return n+l?1:0},drawTile:function(){},draw:function(n,p,s,u,y){var x=GRUNT.Log.getTraceTicks(),A=e.getTileShift(),B=p.x+A.x;A=p.y+A.y;if(u!==SLICK.Graphics.DisplayState.PINCHZOOM){d(n,p,s,y);GRUNT.Log.trace("updated draw queue",x)}if(a.drawGrid)n.strokeStyle="rgba(50, 50, 50, 0.3)";n.beginPath();for(p=k.length;p--;){s=
k[p].tile;y=k[p].coordinates.x-B;var E=k[p].coordinates.y-A;if(s){r.drawTile(n,s,y,E,u);s.x=y;s.y=E}a.drawGrid&&n.rect(y,E,a.tileSize,a.tileSize)}n.stroke();GRUNT.Log.trace("drawn tiles",x);l=false},getTileSize:function(){return a.tileSize},getTileVirtualXY:function(n,p,s){n=e.getNormalizedPos(n,p);n=new SLICK.Vector(n.x*a.tileSize,n.y*a.tileSize);if(s){n.x+=f;n.y+=f}return n},getCenterXY:function(){var n=Math.ceil(e.getGridSize()>>1);return r.getTileVirtualXY(n,n,true)},populate:function(n){e.populate(n,
function(){})}});GRUNT.WaterCooler.listen("tile.loaded",function(){l=true;r.wakeParent()});return r},ImageTileGrid:function(a){function d(){GRUNT.WaterCooler.say("tile.loaded")}a=GRUNT.extend({},a);return GRUNT.extend(new g.TileGrid(a),{drawTile:function(e,f,c,i,l){var k=SLICK.Resources.getImage(f.url);l===SLICK.Graphics.DisplayState.PAN&&e.drawImage(h(),c,i);if(k&&k.complete)e.drawImage(k,c,i);else{e.drawImage(o(),c,i);k||SLICK.Resources.loadImage(f.url,d)}}})},Tiler:function(a){a=GRUNT.extend({container:"",
drawCenter:false,onPan:null,onPanEnd:null,tapHandler:null,doubleTapHandler:null,zoomHandler:null,onDraw:null,datasources:{},tileLoadThreshold:"first"},a);var d=new SLICK.Graphics.View(GRUNT.extend({},a,{pannable:true,scalable:true,scaleDamping:true}));SLICK.Touch.captureTouch(document.getElementById(a.container),a);GRUNT.extend(d,{getTileLayer:function(){return d.getLayer("grid0")},setTileLayer:function(e){d.setLayer("grid0",e);GRUNT.WaterCooler.say("grid.updated",{grid:e})},gridPixToViewPix:function(e){var f=
d.getOffset();return new SLICK.Vector(e.x-f.x,e.y-f.y)},viewPixToGridPix:function(e){var f=d.getOffset();return new SLICK.Vector(e.x+f.x,e.y+f.y)},cleanup:function(){d.removeLayer("grid0")}});return d}};return g}();
SLICK.Geo=function(){function o(c,i){var l=null;for(var k in e)if(i){if(k==i&&e[k][c]){l=e[k];break}}else if(e[k][c]){l=e[k];break}return l}function h(c,i,l,k){var m=0;c=c.toUpperCase();for(var q in k){var r=i[q];if(r){var n=l[q];r=n?n(c,r):c.containsWord(r)?1:0;m+=r*k[q]}}return m}var j=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],b=/(\d+)\s?\-\s?(\d+)/,g=/^(\d+).*$/,a=null,d={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",
HWY:"HIGHWAY",MWY:"MOTORWAY"},e={},f={Engine:function(c){if(!c.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var i=GRUNT.extend({remove:function(){delete e[i.id]}},c);return e[i.id]=i},getEngine:function(c){for(var i=null,l=1;!i&&l<arguments.length;l++)i=o(c,arguments[l]);i=i?i:o(c);if(!i)throw Error("Unable to find GEO engine with "+c+" capability");return i},Distance:function(c,i){var l=0;if(!f.emptyPos(c)&&!f.emptyPos(i)){var k=(i.lat-c.lat).toRad()>>1,m=(i.lon-c.lon).toRad()>>
1;k=Math.sin(k)*Math.sin(k)+Math.cos(c.lat.toRad())*Math.cos(i.lat.toRad())*Math.sin(m)*Math.sin(m);l=6371*2*Math.atan2(Math.sqrt(k),Math.sqrt(1-k))}return{toM:function(){return l*1E3},toKM:function(){return l},toString:function(){return l+"km"}}},Radius:function(c,i){return{distance:parseInt(c,10),uom:i}},Position:function(c,i){return{lat:parseFloat(c?c:0),lon:parseFloat(i?i:0)}},BoundingBox:function(c,i){var l={min:f.parsePosition(c),max:f.parsePosition(i),expand:function(k){l.min.lat-=k;l.min.lon-=
f.Utilities.normalizeLon(k);l.max.lat+=k;l.max.lon+=f.Utilities.normalizeLon(k)},getDistance:function(){return new f.Distance(l.min,l.max)},getCenter:function(){var k=f.calculateBoundsSize(l.min,l.max);return new SLICK.Geo.Position(l.min.lat+k.y*0.5,l.min.lon+k.x*0.5)},transform:function(k){var m=new SLICK.Geo.BoundingBox(l.min,l.max);GRUNT.Log.info("applying "+k.length+" transformers");for(var q=0;k&&q<k.length;q++)k[q].apply(m);return m},toString:function(){return String.format("({0}, {1})",l.min,
l.max)}};return l},Transforms:function(){return{Shrink:function(){return function(){}},Offset:function(){return function(){}}}}(),Address:function(c){c=GRUNT.extend({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},c);return GRUNT.extend(c,{getPos:function(){return c.pos},toString:function(){return c.streetDetails+" "+c.location}})},GeocodeFieldWeights:{streetDetails:50,location:50},AddressCompareFns:{},Utilities:function(){var c={lat2pix:function(i,l){var k=parseFloat(i)*
2*Math.PI/360;k=Math.sin(k);var m=0.08181919084262157*k;return Math.log((1+k)/(1-k)*Math.pow((1-m)/(1+m),0.08181919084262157))/2/l},lon2pix:function(i,l){return parseFloat(i)/180*Math.PI/l},pix2lon:function(i,l){return c.normalizeLon(i*l*180/Math.PI)},pix2lat:function(i,l){for(var k=Math.pow(Math.E,-i*l),m=c.mercatorUnproject(k),q=c.findRadPhi(m,k),r=0;r<12&&Math.abs(m-q)>1.0E-7;){m=q;q=c.findRadPhi(m,k);r++}return q*180/Math.PI},mercatorUnproject:function(i){return Math.PI/2-2*Math.atan(i)},findRadPhi:function(i,
l){var k=0.08181919084262157*Math.sin(i);return Math.PI/2-2*Math.atan(l*Math.pow((1-k)/(1+k),0.040909595421310785))},normalizeLon:function(i){for(;i<-180;)i+=360;for(;i>180;)i-=360;return i}};return c}(),GeoSearchResult:function(c){c=GRUNT.extend({id:null,caption:"",resultType:"",data:null,pos:null,matchWeight:0},c);return GRUNT.extend(c,{toString:function(){return c.caption+(c.matchWeight?" ("+c.matchWeight+")":"")}})},GeoSearchAgent:function(c){c=GRUNT.extend({},c);return GRUNT.extend({},SLICK.Dispatcher.createAgent(c))},
GeocodingAgent:function(c){c=GRUNT.extend({name:"Geocoding Search Agent",paramTranslator:null,execute:function(i,l){try{if(!i.reverse&&!i.freeform)address=new f.Address(i);var k=f.getEngine("geocode");if(k)k.geocode({addresses:[i.freeform?i.freeform:address],complete:function(q,r){if(l){var n=r;if(i.freeform)n=f.rankGeocodeResponses(i.freeform,n,f.getEngine("geocode"));l(n,c)}}})}catch(m){GRUNT.Log.exception(m)}}},c);return new f.GeoSearchAgent(c)},PointOfInterest:function(c){c=GRUNT.extend({id:0,
title:"",pos:null,lat:"",lon:"",group:"",retrieved:0,isNew:true},c);if(!c.pos&&c.lat&&c.lon)c.pos=new SLICK.Geo.Position(c.lat,c.lon);return GRUNT.extend({toString:function(){return c.id+": '"+c.title+"'"}},c)},POIStorage:function(c){function i(n){n=n?n:"default";m[n]||(m[n]=[]);return m[n]}function l(n){var p=[];for(var s in m)for(var u=0;u<m[s].length;u++)if(!n||n(m[s][u]))p.push(m[s][u]);return p}function k(){GRUNT.WaterCooler.say("geo.pois-updated",{srcID:r.id,pois:r.getPOIs()})}c=GRUNT.extend({visibilityChange:null,
onPOIDeleted:null,onPOIAdded:null},c);var m={},q=true,r={id:GRUNT.generateObjectID(),getPOIs:function(){return l()},getOldPOIs:function(n,p){return l(function(s){return s.group==n&&s.retrieved<p})},getVisible:function(){return q},setVisible:function(n){if(n!=q){q=n;c.visibilityChange&&c.visibilityChange()}},findById:function(n){var p=l(function(s){return s.id==n});return p.length>0?p[0]:null},findByBounds:function(n){return l(function(p){return SLICK.Geo.posInBounds(p.pos,n)})},addPOIs:function(n,
p){if(p)m={};for(var s=0;n&&s<n.length;s++){n[s].retrieved=SLICK.Clock.getTime(true);var u=n[s];i(u.group).push(u)}},removeGroup:function(n){if(m[n]){delete m[n];k()}},update:function(n){var p=[],s=0,u=n.length>0?n[0].group:"",y=SLICK.Clock.getTime(true);for(s=0;s<n.length;s++){var x;a:{if(x=n[s])for(var A=i(x.group),B=0;B<A.length;B++)if(A[B].id==x.id){x=A[B];break a}x=null}if(x){x.retrieved=y;x.isNew=false}else p.push(n[s])}n=r.getOldPOIs(u,y);r.addPOIs(p);for(s=0;c.onPOIAdded&&s<p.length;s++)c.onPOIAdded(p[s]);
for(s=0;s<n.length;s++){c.onPOIDeleted&&c.onPOIDeleted(n[s]);u=n[s];y=i(u.group);for(x=0;x<y.length;x++)if(y[x].id==u.id){y.splice(x,1);break}}p.length+n.length>0&&k()}};return r},MapProvider:function(){return{zoomLevel:0,checkZoomLevel:function(c){return c},getCopyright:function(){},getMapTiles:function(){},getPositionForXY:function(){return null}}},copyPos:function(c){return c?new f.Position(c.lat,c.lon):null},emptyPos:function(c){return!c||c.lat===0&&c.lon===0},posToStr:function(c){return c.lat+
" "+c.lon},parsePosition:function(c){if(c)if(GRUNT.isPlainObject(c)&&c.lat!=="undefined")return c;else{if(c.split)for(var i=[" ",","],l=0;l<i.length;l++){var k=c.split(i[l]);if(k.length===2)return new f.Position(k[0],k[1])}}else return new f.Position;return null},parsePositionArray:function(c){var i=c.length,l=Array(i);for(i=i;i--;)l[i]=f.parsePosition(c[i]);return l},posToMercatorPixels:function(c,i){return new SLICK.Vector(SLICK.Geo.Utilities.lon2pix(c.lon,i),SLICK.Geo.Utilities.lat2pix(c.lat,i))},
mercatorPixelsToPos:function(c,i,l){return new f.Position(SLICK.Geo.Utilities.pix2lat(i,l),SLICK.Geo.Utilities.normalizeLon(SLICK.Geo.Utilities.pix2lon(c,l)))},emptyBounds:function(c){return!c||f.emptyPos(c.min)||f.emptyPos(c.max)},posInBounds:function(c,i){var l=!(f.emptyPos(c)||f.emptyBounds(i));return l=(l=l&&c.lat>=i.min.lat&&c.lat<=i.max.lat)&&c.lon>=i.min.lon&&c.lon<=i.max.lon},calculateBoundsSize:function(c,i,l){var k=new SLICK.Vector(0,i.lat-c.lat);if(typeof l==="undefined")l=true;k.x=l&&
c.lon>i.lon?360-c.lon+i.lon:i.lon-c.lon;return k},getBoundingBoxZoomLevel:function(c,i){var l=c.getCenter(),k=Math.min(Math.round(Math.abs(l.lat)*0.05),j.length),m=j[k],q=f.calculateBoundsSize(c.min,c.max),r=Math.ceil(Math.log(j[3]*i.height/q.y)/Math.log(2));m=Math.ceil(Math.log(m*i.width/q.x)/Math.log(2));GRUNT.Log.info("constant index for bbox: "+c+" (center = "+l+") is "+k);GRUNT.Log.info("distances  = "+q);GRUNT.Log.info("optimal zoom levels: height = "+r+", width = "+m);return Math.min(r,m)},
getBoundsForPositions:function(c,i){var l=null,k=SLICK.Clock.getTime();i||(i="auto");for(var m=c.length;m--;)if(l){var q=f.calculateBoundsSize(l.min,c[m],false),r=f.calculateBoundsSize(c[m],l.max,false);if(q.x<0)l.min.lon=c[m].lon;if(q.y<0)l.min.lat=c[m].lat;if(r.x<0)l.max.lon=c[m].lon;if(r.y<0)l.max.lat=c[m].lat}else l=new SLICK.Geo.BoundingBox(f.copyPos(c[m]),f.copyPos(c[m]));if(i){if(i=="auto"){m=f.calculateBoundsSize(l.min,l.max);i=Math.max(m.x,m.y)*0.3}l.expand(i)}GRUNT.Log.info("bounds calculated in "+
(SLICK.Clock.getTime()-k)+" ms");return l},normalizeAddress:function(c){if(!c)return"";c=c.toUpperCase();if(!a){var i=[];for(var l in d)i.push(l);a=RegExp("(\\s)("+i.join("|")+")(\\s|$)","i")}a.lastIndex=-1;if(i=a.exec(c))c=c.replace(a,"$1"+d[i[2]]);return c},buildingMatch:function(c,i){g.lastIndex=-1;if(g.test(c))for(var l=c.replace(g,"$1"),k=i.split(","),m=0;m<k.length;m++){b.lastIndex=-1;if(b.test(k[m])){var q=b.exec(k[m]);if(l>=parseInt(q[1],10)&&l<=parseInt(q[2],10))return true}else if(l==k[m])return true}return false},
rankGeocodeResponses:function(c,i,l){var k=[],m=f.AddressCompareFns;if(l&&l.compareFns)m=GRUNT.extend({},m,l.compareFns);for(l=0;l<i.length;l++)k.push(new f.GeoSearchResult({caption:i[l].toString(),data:i[l],pos:i[l].pos,matchWeight:h(c,i[l],m,f.GeocodeFieldWeights)}));k.sort(function(q,r){return r.matchWeight-q.matchWeight});return k}};return f}();
SLICK.Geo.Location=function(){function o(b){function g(i){try{var l=new SLICK.Geo.Position(i.coords.latitude,i.coords.longitude),k=GRUNT.isPlainObject(i.coords.accuracy)&&i.coords.accuracy.horizontal?i.coords.accuracy.horizontal:i.coords.accuracy;GRUNT.Log.info("got position coordinates: "+l+", accuracy = "+k);if(b.successCallback&&(!f||k<c))b.successCallback(l,e,i);if(k>b.highAccuracyCutoff&&e<2){e=2;b.enableHighAccuracy=true;GRUNT.Log.info("Position not at required accuracy, trying again with high accuracy");
d()}f=i;c=k}catch(m){GRUNT.Log.exception(m)}}function a(i){if(i.code===i.PERMISSION_DENIED)b.errorCallback&&b.errorCallback(i);else if(i.code===i.POSITION_UNAVAILABLE)b.errorCallback&&b.errorCallback(i);else if(i.code===i.TIMEOUT){GRUNT.Log.info("had a timeout on cached position, moving to phase 1");if(b.timeout===0&&b.autoPhasing){e=1;b.timeout=h;b.enableHighAccuracy=false;d()}}}function d(){navigator.geolocation.getCurrentPosition(g,a,b)}b=GRUNT.extend({autoPhasing:true,maximumAge:3E5,timeout:0,
highAccuracyCutoff:10,enableHighAccuracy:true,successCallback:null,errorCallback:null},b);var e=0,f=null,c=1E6;d()}var h=3E3,j={get:function(){throw Error("No geolocation APIs supported.");}};if(navigator.geolocation)j.get=o;return j}();SLICK.Geo.Search=function(){return{bestResults:function(o,h){h||(h=20);for(var j=o.length>0?o[0]:null,b=[],g=0;g<o.length;g++)if(j.matchWeight-o[g].matchWeight<=h)b.push(o[g]);else break;return b}}}();
SLICK.Mapping=function(){var o={AnnotationTween:null,GeoTileGrid:function(h){h=GRUNT.extend({grid:null,centerPos:new SLICK.Geo.Position,centerXY:new SLICK.Vector,radsPerPixel:0},h);var j=SLICK.Geo.posToMercatorPixels(h.centerPos,h.radsPerPixel),b=j.x-h.centerXY.x,g=j.y-h.centerXY.y,a=GRUNT.extend({},h.grid,{getBoundingBox:function(d,e,f,c){return new SLICK.Geo.BoundingBox(a.pixelsToPos(new SLICK.Vector(d,e+c)),a.pixelsToPos(new SLICK.Vector(d+f,e)))},getCenterOffset:function(){return h.centerXY},
getGridXYForPosition:function(d){d=SLICK.Geo.posToMercatorPixels(d,h.radsPerPixel);return new SLICK.Vector(d.x-b,a.gridDimensions.height-(d.y-g))},getGuideOffset:function(d){var e=a.getTileSize();return new SLICK.Vector(d.x%e,d.y%e)},pixelsToPos:function(d){return SLICK.Geo.mercatorPixelsToPos(b+d.x,g+a.gridDimensions.height-d.y,h.radsPerPixel)}});return a},POIViewLayer:function(h){GRUNT.extend({},h)},Overlay:function(h){GRUNT.extend({},h);return{}},RadarOverlay:function(h){h=GRUNT.extend({radarFill:"rgba(0, 221, 238, 0.1)",
radarStroke:"rgba(0, 102, 136, 0.3)",zindex:100},h);return GRUNT.extend(new SLICK.Graphics.ViewLayer(h),{draw:function(j,b,g){b=g.width>>1;g=g.height>>1;j.fillStyle=h.radarFill;j.strokeStyle=h.radarStroke;j.beginPath();j.arc(b,g,50,0,Math.PI*2,false);j.fill();j.stroke()}})},CrosshairOverlay:function(h){h=GRUNT.extend({lineWidth:1.5,strokeStyle:"rgba(0, 0, 0, 0.5)",size:15,zindex:150,scalePosition:false,validStates:SLICK.Graphics.DisplayState.ACTIVE|SLICK.Graphics.DisplayState.ANIMATING|SLICK.Graphics.DisplayState.PAN},
h);return GRUNT.extend(new SLICK.Graphics.ViewLayer(h),{draw:function(j,b,g){b=g.getCenter();j.lineWidth=h.lineWidth;j.strokeStyle=h.strokeStyle;g=h.size;j.beginPath();j.moveTo(b.x,b.y-g);j.lineTo(b.x,b.y+g);j.moveTo(b.x-g,b.y);j.lineTo(b.x+g,b.y);j.arc(b.x,b.y,g*0.6666,0,2*Math.PI,false);j.stroke()}})},RouteOverlay:function(h){h=GRUNT.extend({strokeStyle:"rgba(0, 51, 119, 0.9)",waypointFillStyle:"#FFFFFF",lineWidth:4,data:null,pixelGeneralization:8,calculationsPerCycle:250,partialDraw:false,zindex:50,
validStates:SLICK.Graphics.DisplayState.ACTIVE|SLICK.Graphics.DisplayState.PAN},h);var j=true,b=null,g=[],a=0,d=[],e=GRUNT.extend(new SLICK.Graphics.ViewLayer(h),{getAnimation:function(f,c,i,l){if(j)return null;return new SLICK.Graphics.AnimatedPathLayer({path:g,zindex:h.zindex+1,easing:f?f:SLICK.Animation.Easing.Sine.InOut,duration:c?c:5E3,drawIndicator:i,autoCenter:l?l:false})},draw:function(f,c,i,l,k){i=0;l=h.data?h.data.geometry:null;if(j){j=false;g=[];a=0;GRUNT.Log.info("recalc condition detected, geometry length = "+
l.length)}if(l&&a<l.length){a:{k=k.getTileLayer();d=[];l=GRUNT.Log.getTraceTicks();var m,q,r,n=h.data?h.data.geometry:[],p=n.length,s=h.data?h.data.instructions:[],u=s.length,y=h.calculationsPerCycle,x=0,A=Math.ceil(Math.log(p)/Math.log(10));for(m=a;m<p;m+=A){q=k.getGridXYForPosition(n[m]);if(r=!b||m===p||Math.abs(q.x-b.x)+Math.abs(q.y-b.y)>h.pixelGeneralization){g.push(q);b=q}x++;if(x>=y){a=m;break a}if(m+A>=p){A=Math.max(p-m-1,1);GRUNT.Log.info("increment adjusted to "+A)}}a=p;GRUNT.Log.trace(p+
" geometry points generalized to "+g.length+" coordinates",l);b=null;for(m=u;m--;)if(s[m].position){q=k.getGridXYForPosition(s[m].position);if(r=!b||m===0||Math.abs(q.x-b.x)+Math.abs(q.y-b.y)>h.pixelGeneralization){d.push(q);b=q}}GRUNT.Log.trace(u+" instructions generalized to "+d.length+" coordinates",l);GRUNT.Log.info("finished route calc coordinates")}i++}k=g.length;if(k>0&&(!i||h.partialDraw)){f.strokeStyle=h.strokeStyle;f.lineWidth=h.lineWidth;f.beginPath();f.moveTo(g[k-1].x-c.x,g[k-1].y-c.y);
for(k=k;k--;)f.lineTo(g[k].x-c.x,g[k].y-c.y);f.stroke();f.fillStyle=h.waypointFillStyle;for(k=d.length;k--;){f.beginPath();f.arc(d[k].x-c.x,d[k].y-c.y,2,0,Math.PI*2,false);f.stroke();f.fill()}}return i}});GRUNT.WaterCooler.listen("grid.updated",function(){j=true;e.wakeParent()});return e},Annotation:function(h){h=GRUNT.extend({xy:null,pos:null,draw:null,tweenIn:o.AnnotationTween},h);var j=false,b={xy:h.xy,pos:h.pos,isNew:false,isAnimating:function(){return j},draw:function(g,a,d,e){if(b.xy){if(b.isNew&&
h.tweenIn){var f=b.xy.y;b.xy.y=a.y-20;j=true;SLICK.Animation.tween(b.xy,"y",f,h.tweenIn,function(){b.xy.y=f;j=false},250+Math.random()*500)}if(h.draw)h.draw(g,a,new SLICK.Vector(b.xy.x-a.x,b.xy.y-a.y),d,e);else{g.beginPath();g.arc(b.xy.x-a.x,b.xy.y-a.y,4,0,Math.PI*2,false);g.fill()}b.isNew=false}}};return b},ImageAnnotation:function(h){h=GRUNT.extend({imageUrl:null},h);var j=null;h.draw=function(b,g,a,d,e){if(g=SLICK.Resources.getImage(h.imageUrl)){if(g.complete){j||(j=new SLICK.Vector(-g.width>>
1,-g.height>>1));a=SLICK.V.offset(a,j.x,j.y);b.drawImage(g,a.x,a.y,g.width,g.height)}}else SLICK.Resources.loadImage(h.imageUrl,function(){e.wakeParent()})};return new o.Annotation(h)},AnnotationsOverlay:function(h){function j(e){for(var f=h.map?h.map.getTileLayer():null,c=0;f&&c<e.length;c++)e[c].xy=f.getGridXYForPosition(e[c].pos)}h=GRUNT.extend({pois:null,map:null,createAnnotationForPOI:null,zindex:100},h);var b=[],g=false,a=[],d=GRUNT.extend(new SLICK.Graphics.ViewLayer(h),{draw:function(e,f,
c,i){e.save();try{var l;g=false;e.fillStyle="rgba(255, 0, 0, 0.75)";e.globalCompositeOperation="source-over";for(l=b.length;l--;){b[l].draw(e,f,i,d);g=g||b[l].isAnimating()}for(l=a.length;l--;){a[l].draw(e,f,i,d);g=g||b[l].isAnimating()}g&&d.wakeParent()}finally{e.restore()}},add:function(e){a.push(e);j(a)},isAnimating:function(){return g}});GRUNT.WaterCooler.listen("geo.pois-updated",function(e){if(h.pois&&h.pois.id==e.srcID){e=e.pois;try{b=[];for(var f=0;f<e.length;f++)if(e[f].pos){var c;var i=
e[f];if(i&&i.pos){var l=null;if(l=h.createAnnotationForPOI?h.createAnnotationForPOI(i):new o.Annotation({pos:i.pos})){l.isNew=i.isNew;i.isNew=false}c=l}else c=void 0;c&&b.push(c)}j(b)}catch(k){GRUNT.Log.exception(k)}d.wakeParent()}});GRUNT.WaterCooler.listen("grid.updated",function(){j(b);j(a)});return d},Tiler:function(h){h=GRUNT.extend({tapExtent:10,provider:null,crosshair:true,copyright:undefined,zoomLevel:0,boundsChange:null,tapPOI:null,boundsChangeThreshold:30,pois:new SLICK.Geo.POIStorage,createAnnotationForPOI:null},
h);if(typeof h.copyright==="undefined")h.copyright=h.provider?h.provider.getCopyright():"";var j=new SLICK.Vector,b=h.copyright,g=false,a=[],d=0,e=null,f=h.zoomLevel;if(!h.provider)h.provider=new SLICK.Geo.MapProvider;var c=h.panHandler,i=h.tapHandler;h.onPan=function(m,q){c&&c(m,q)};h.tapHandler=function(m,q){var r=k.getTileLayer(),n=null;if(r){var p=k.viewPixToGridPix(new SLICK.Vector(q.x,q.y));n=r.pixelsToPos(SLICK.V.offset(p,-h.tapExtent,h.tapExtent));r=r.pixelsToPos(SLICK.V.offset(p,h.tapExtent,
-h.tapExtent));n=new SLICK.Geo.BoundingBox(n,r);a=k.pois.findByBounds(n);h.tapPOI&&h.tapPOI(a)}i&&i(m,q,n)};h.doubleTapHandler=function(m,q){k.animate(2,k.getDimensions().getCenter(),new SLICK.Vector(q.x,q.y),SLICK.Animation.Easing.Sine.Out)};h.onScale=function(m,q){var r=0;m=Math.sqrt(m);if(m<1)r=-(0.5/m);else if(m>1)r=m;k.gotoPosition(k.getXYPosition(q),f+Math.floor(r))};var l=new SLICK.Tiling.Tiler(h),k=GRUNT.extend({},l,{pois:h.pois,getBoundingBox:function(){var m=new SLICK.Geo.BoundingBox,q=
k.getTileLayer(),r=k.getOffset(),n=k.getDimensions();if(q)m=q.getBoundingBox(r.x,r.y,n.width,n.height);return m},getCenterPosition:function(){return k.getXYPosition(k.gridDimensions.getCenter())},getXYPosition:function(m){return k.getTileLayer().pixelsToPos(k.viewPixToGridPix(m))},gotoBounds:function(m,q){var r=SLICK.Geo.getBoundingBoxZoomLevel(m,k.getDimensions());GRUNT.Log.info("BOUNDS CHANGE REQUIRED CENTER: "+m.getCenter()+", ZOOM LEVEL: "+r);k.gotoPosition(m.getCenter(),r,q)},gotoCurrentPosition:function(m){SLICK.Geo.Location.get({successCallback:function(q){k.clearBackground();
k.gotoPosition(q,15,m)},errorCallback:function(){}})},gotoPosition:function(m,q,r){var n=f,p=(new Date).getTime();f=q?q:f;if(!f)throw"Zoom level required to goto a position.";if(h.provider)f=h.provider.checkZoomLevel(f);if(!g||f!==n){SLICK.Resources.resetImageLoadQueue();SLICK.Animation.cancel();g&&k.freeze();d=p;h.provider.zoomLevel=f;h.provider.getMapTiles(k,m,function(s){if(p===d){k.setTileLayer(s);k.panToPosition(m,function(){k.unfreeze();r&&r()})}else GRUNT.Log.info("request time mismatch - ignoring update")});
g=true}else{GRUNT.Log.info("just panning, tile layer = "+k.getTileLayer()+", zoom level = "+f);k.panToPosition(m,r);k.unfreeze()}},panToPosition:function(m,q,r){var n=k.getTileLayer();if(n){m=n.getGridXYForPosition(m);n=k.getDimensions();m.x-=n.width>>1;m.y-=n.height>>1;if(e)e=null;k.updateOffset(m.x,m.y,r);GRUNT.WaterCooler.say("view.wake",{id:k.id});h.boundsChange&&h.boundsChange(k.getBoundingBox());q&&q(k)}},setZoomLevel:function(m){k.gotoPosition(k.getCenterPosition(),m)},zoomIn:function(){GRUNT.Log.info("scaling needed is "+
2*Math.PI/(1<<f)/(2*Math.PI/(1<<f+1)));k.scale(2,SLICK.Animation.Easing.Sine.Out)||k.setZoomLevel(f+1)},zoomOut:function(){GRUNT.Log.info("scaling needed is "+2*Math.PI/(1<<f)/(2*Math.PI/(1<<f-1)));k.scale(0.5,SLICK.Animation.Easing.Sine.Out)||k.setZoomLevel(f-1)},animateRoute:function(m,q,r,n){var p=k.getLayer("route");if(p)(m=p.getAnimation(m,q,r,n))&&m.addToView(k)}},l);l=new SLICK.Mapping.AnnotationsOverlay({pois:k.pois,map:k,createAnnotationForPOI:h.createAnnotationForPOI});k.setLayer("annotations",
l);h.crosshair&&k.setLayer("crosshair",new SLICK.Mapping.CrosshairOverlay);b&&k.setLayer("copyright",new SLICK.Graphics.ViewLayer({zindex:999,draw:function(m,q,r){m.lineWidth=2.5;m.fillStyle="rgb(50, 50, 50)";m.strokeStyle="rgba(255, 255, 255, 0.8)";m.font="bold 10px sans";m.textBaseline="bottom";m.strokeText(b,10,r.height-10);m.fillText(b,10,r.height-10)}}));GRUNT.WaterCooler.listen("view-idle",function(m){if(m.id&&m.id==k.id)if(SLICK.V.absSize(SLICK.V.diff(j,k.getOffset()))>h.boundsChangeThreshold&&
h.boundsChange){j=k.getOffset();h.boundsChange(k.getBoundingBox())}});return k}};return o}();
SLICK.Geo.Routing=function(){var o={calculate:function(h){h=GRUNT.extend({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null},h);GRUNT.Log.info("attempting to calculate route");var j=SLICK.Geo.getEngine("route");j&&j.route(h,function(b){if(h.map){o.createMapOverlay(h.map,b);if(h.autoFit){GRUNT.Log.info("AUTOFITTING MAP TO ROUTE: bounds = "+b.boundingBox);h.map.gotoBounds(b.boundingBox)}}h.success&&h.success(b)})},createMapOverlay:function(h,j){var b=h.getDimensions();b=new SLICK.Mapping.RouteOverlay({data:j,
width:b.width,height:b.height});h.setLayer("route",b)},Maneuver:{None:0,Continue:1,TurnLeft:100,TurnLeftSlight:101,TurnLeftSharp:102,TurnRight:110,TurnRightSlight:111,TurnRightSharp:112,TurnAround:190,EnterRoundabout:200,ExitRamp:300},Instruction:function(h){h=GRUNT.extend({position:null,description:"",manuever:o.Maneuver.None},h);return GRUNT.extend(h,{})},RouteData:function(h){h=GRUNT.extend({geometry:[],instructions:[],boundingBox:null},h);if(!h.boundingBox)h.boundingBox=SLICK.Geo.getBoundsForPositions(h.geometry);
return h}};return o}();
