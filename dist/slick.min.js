if(!this.JSON)this.JSON={};
(function(){function n(i){return i<10?"0"+i:i}function g(i){a.lastIndex=0;return a.test(i)?'"'+i.replace(a,function(k){var l=f[k];return typeof l==="string"?l:"\\u"+("0000"+k.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+i+'"'}function e(i,k){var l,j,m,p,o=b,q,r=k[i];if(r&&typeof r==="object"&&typeof r.toJSON==="function")r=r.toJSON(i);if(typeof h==="function")r=h.call(k,i,r);switch(typeof r){case "string":return g(r);case "number":return isFinite(r)?String(r):"null";case "boolean":case "null":return String(r);
case "object":if(!r)return"null";b+=d;q=[];if(Object.prototype.toString.apply(r)==="[object Array]"){p=r.length;for(l=0;l<p;l+=1)q[l]=e(l,r)||"null";m=q.length===0?"[]":b?"[\n"+b+q.join(",\n"+b)+"\n"+o+"]":"["+q.join(",")+"]";b=o;return m}if(h&&typeof h==="object"){p=h.length;for(l=0;l<p;l+=1){j=h[l];if(typeof j==="string")if(m=e(j,r))q.push(g(j)+(b?": ":":")+m)}}else for(j in r)if(Object.hasOwnProperty.call(r,j))if(m=e(j,r))q.push(g(j)+(b?": ":":")+m);m=q.length===0?"{}":b?"{\n"+b+q.join(",\n"+b)+
"\n"+o+"}":"{"+q.join(",")+"}";b=o;return m}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+n(this.getUTCMonth()+1)+"-"+n(this.getUTCDate())+"T"+n(this.getUTCHours())+":"+n(this.getUTCMinutes())+":"+n(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var c=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
a=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,b,d,f={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},h;if(typeof JSON.stringify!=="function")JSON.stringify=function(i,k,l){var j;d=b="";if(typeof l==="number")for(j=0;j<l;j+=1)d+=" ";else if(typeof l==="string")d=l;if((h=k)&&typeof k!=="function"&&(typeof k!=="object"||typeof k.length!=="number"))throw Error("JSON.stringify");return e("",
{"":i})};if(typeof JSON.parse!=="function")JSON.parse=function(i,k){function l(m,p){var o,q,r=m[p];if(r&&typeof r==="object")for(o in r)if(Object.hasOwnProperty.call(r,o)){q=l(r,o);if(q!==undefined)r[o]=q;else delete r[o]}return k.call(m,p,r)}var j;i=String(i);c.lastIndex=0;if(c.test(i))i=i.replace(c,function(m){return"\\u"+("0000"+m.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(i.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+i+")");return typeof k==="function"?l({"":j},""):j}throw new SyntaxError("JSON.parse");}})();if(!String.format)String.format=function(n){if(arguments.length<=1)return n;for(var g=arguments.length-2,e=0;e<=g;e++)n=n.replace(RegExp("\\{"+e+"\\}","gi"),arguments[e+1]);return n};if(!Number.toRad)Number.prototype.toRad=function(){return this*Math.PI/180};if(!Number.sec)Number.prototype.sec=function(){return 1/Math.cos(this)};
GRUNT=function(){var n=Object.prototype.hasOwnProperty,g=0,e={id:"GRUNT.core",extend:function(){var c=arguments[0]||{},a=1,b=arguments.length,d=false,f,h,i,k;if(typeof c==="boolean"){d=c;c=arguments[1]||{};a=2}if(typeof c!=="object"&&!e.isFunction(c))c={};if(b===a){c=this;--a}for(;a<b;a++)if((f=arguments[a])!=null)for(h in f){i=c[h];k=f[h];if(c!==k)if(d&&k&&(e.isPlainObject(k)||e.isArray(k))){i=i&&(e.isPlainObject(i)||e.isArray(i))?i:e.isArray(k)?[]:{};c[h]=e.extend(d,i,k)}else if(k!==undefined)c[h]=
k}return c},isFunction:function(c){return toString.call(c)==="[object Function]"},isArray:function(c){return toString.call(c)==="[object Array]"},isPlainObject:function(c){if(!c||toString.call(c)!=="[object Object]"||c.nodeType||c.setInterval)return false;if(c.constructor&&!n.call(c,"constructor")&&!n.call(c.constructor.prototype,"isPrototypeOf"))return false;var a;for(a in c);return a===undefined||n.call(c,a)},isEmptyObject:function(c){for(var a in c)return false;return true},isXmlDocument:function(c){return toString.call(c)===
"[object Document]"},contains:function(c,a){var b=c,d=arguments,f=1;if(a&&e.isArray(a)){d=a;f=0}for(f=f;f<d;f++)b=b&&typeof foo[d[f]]!=="undefined";return b},newModule:function(c){c=e.extend({id:null,requires:[],parent:null},c);if(c.parent)c=e.extend({},c.parent,c);return c},toID:function(c){return c.replace(/\s/g,"-")},generateObjectID:function(c){return(c?c:"obj")+g++}};return e}();
GRUNT.Log=function(){function n(a,b){var d,f=b&&b.length>0?b[0]:"";for(d=1;b&&d<b.length;d++)f+=" "+(e&&GRUNT.isPlainObject(b[d])?JSON.stringify(b[d]):b[d]);typeof console!=="undefined"&&console[a](f);for(d=0;d<g.length;d++)g[d].call(c,f,a)}var g=[],e=typeof JSON!=="undefined",c={id:"GRUNT.log",debug:function(){n("debug",arguments)},info:function(){n("info",arguments)},warn:function(){n("warn",arguments)},error:function(){n("error",arguments)},exception:function(a){c.error(arguments);for(var b in a)c.info("ERROR DETAIL: "+
b+": "+a[b])},watch:function(a,b){try{b()}catch(d){c.exception(d,a)}},throwError:function(a){c.error(a);throw Error(a);},requestUpdates:function(a){g.push(a)}};return c}();
GRUNT.Data=function(){var n={determineObjectMapping:function(e){if(!e)return null;e=e.split("|");for(var c={},a=0;a<e.length;a++)c[e[a]]=a;return c},mapLineToObject:function(e,c){var a=e.split("|"),b={};for(var d in c){var f=c[d];b[d]=a.length>f?a[f]:null}return b},parse:function(e){var c=null,a=[];e=e.split("\n");for(var b=0;b<e.length;b++){var d=e[b];if(c)a.push(n.mapLineToObject(d,c));else c=n.determineObjectMapping(d)}return a}},g={supportedFormats:{JSON:{parse:function(e){return JSON.parse(e)}},
PDON:{parse:function(e){return n.parse(e)}}},parse:function(e){e=GRUNT.extend({data:"",format:"JSON"},e);if(!g.supportedFormats[e.format])throw Error("Unsupported data format: "+e.format+", cannot parse data in javascript object");try{return g.supportedFormats[e.format].parse(e.data)}catch(c){GRUNT.Log.error("ERROR PARSING DATA FROM FORMAT: "+e.format,e.data);GRUNT.Log.exception(c)}return{}}};return g}();
GRUNT.Template=function(){var n=/\$\{(.*?)\}/ig;return{parse:function(g,e){for(var c=g,a=n.exec(c);a;){c=c.replace(a[0],GRUNT.XPath.first(a[1],e));n.lastIndex=0;a=n.exec(c)}return c}}}();
GRUNT.JSONP=function(){function n(a){var b=document.createElement("script"),d=false;b.src=a;b.async=true;b.onload=b.onreadystatechange=function(){if(!d&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){d=true;b.onload=b.onreadystatechange=null;b&&b.parentNode&&b.parentNode.removeChild(b)}};e||(e=document.getElementsByTagName("head")[0]);e.appendChild(b)}var g=0,e,c=this;return{get:function(a,b){a+=a.indexOf("?")>=0?"&":"?";var d="json"+ ++g;c[d]=function(f){b(f);c[d]=
null;try{delete c[d]}catch(h){}};n(a+"callback="+d);return d}}}();
GRUNT.XHR=function(){var n={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},g={JSON:["json"],PDON:["pdon.txt"]},e=["TEXT","STREAM"],c=/^(\w+:)?\/\/([^\/?#]+)/,a={XML:function(f){return f.responseXML},JSON:function(f){try{return JSON.parse(f.responseText)}catch(h){GRUNT.Log.error("Error parsing JSON data: ",f.responseText);GRUNT.Log.exception(h)}return""},PDON:function(f){return GRUNT.Data.parse({data:f.responseText,format:"PDON"})},DEFAULT:function(f){return f.responseText}},
b={CONTENT_TYPE:"Content-Type"},d=GRUNT.newModule({id:"GRUNT.xhr",ajaxSettings:{xhr:null},ajax:function(f){try{f=GRUNT.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},d.ajaxSettings,f);var h=c.exec(f.url),i=h&&(h[1]&&h[1]!==location.protocol||h[2]!==location.host);if(f.data)f.method="POST";if(f.url){h=null;if(f.xhr)h=f.xhr(f);h||(h=new XMLHttpRequest);h.open(f.method,f.url,f.async);f.data&&h.setRequestHeader("Content-Type",
f.contentType);i||h.setRequestHeader("X-Requested-With","XMLHttpRequest");h.onreadystatechange=function(){if(this.readyState===4){var l=null,j=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(j)if(f.handleResponse)f.handleResponse(this);else{var m=f,p=this.getResponseHeader(b.CONTENT_TYPE),o,q=false;for(o in n)if(p&&p.indexOf(n[o])>=0){q=true;break}p=!q;for(q=0;q<e.length;q++)p=p||e[q]==o;if(p)b:{p=o;for(var r in g)for(q=
0;q<g[r].length;q++)if(RegExp(g[r][q]+"$","i").test(m.url)){o=r;break b}o=p?p:"DEFAULT"}try{l=a[o](this,m)}catch(C){GRUNT.Log.warn("error applying processor '"+o+"' to response type, falling back to default");l=a.DEFAULT(this,m)}}else f.error&&f.error(this)}catch(z){GRUNT.Log.exception(z,"PROCESSING AJAX RESPONSE")}j&&l&&f.success&&f.success.call(this,l)}};h.send(f.method=="POST"?d.param(f.data):null)}else GRUNT.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(k){GRUNT.Log.exception(k)}},
param:function(f){var h=[],i=function(l,j){j=GRUNT.isFunction(j)?j():j;h[h.length]=encodeURIComponent(l)+"="+encodeURIComponent(j)};if(GRUNT.isArray(f))for(var k=0;k<f.length;k++)i(f[k].name,f[k].value);else for(k in f)i(k,f[k]);return h.join("&").replace(/%20/g,"+")}});return d}();
GRUNT.XPath=function(){function n(a){for(var b=null,d=0;d<g.length;d++)if(b=g[d](a))break;return b}var g=[],e=[null,function(a){return a.numberValue},function(a){return a.stringValue},function(a){return a.booleanValue},null,null,null,null,function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null},function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||GRUNT.Log.warn("No XPATH support, this is going to cause problems");var c={SearchResult:function(a){return{toString:function(){var b=
null;if(a){var d=null;if(a.resultType>=0&&a.resultType<e.length)d=e[a.resultType];if(d){GRUNT.Log.info("invoking match handler for result type: "+a.resultType);b=d(a)}}return b?b:""}}},first:function(a,b){var d=c.SearchResult,f;var h=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!h)h=XPathResult.ANY_TYPE;try{if(GRUNT.isXmlDocument(b))f=b.evaluate(a,b,n,h,null);else{GRUNT.Log.warn("attempted xpath expression: "+a+" on a non-xml document");f=null}}catch(i){GRUNT.Log.warn("attempted to run invalid xpath expression: "+
a+" on node: "+b);f=null}return new d(f)},registerResolver:function(a){g.push(a)}};return c}();GRUNT.WaterCooler=function(){var n={};return{listen:function(g,e){n[g]||(n[g]=[]);e&&n[g].push(e)},say:function(g,e){if(n[g])for(var c=0;c<n[g].length;c++)n[g][c](e)},leave:function(){}}}();
SLICK=function(){var n={base:{eventTarget:document,supportsTouch:"createTouch"in document},iphone:{regex:/iphone/i},android:{regex:/android/i,eventTarget:document.body,supportsTouch:true}},g={Settings:function(){var e={};return{get:function(c){return e[c]},set:function(c,a){e[c]=a},extend:function(c){GRUNT.extend(e,c)}}}(),Device:function(){var e=null;GRUNT.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var c in n){var a=n[c];if(a.regex&&a.regex.test(navigator.userAgent)){e=
GRUNT.extend({},n.base,a);GRUNT.Log.info("PLATFORM DETECTED AS: "+c);break}}if(!e){GRUNT.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");e=n.base}return e}(),Clock:function(){var e=null;return{getTime:function(c){return c&&e?e:e=(new Date).getTime()}}}(),Vector:function(e,c){e||(e=0);c||(c=0);var a={x:e,y:c,add:function(b){a.x+=b.x;a.y+=b.y;return a},diff:function(b){return new SLICK.Vector(a.x-b.x,a.y-b.y)},copy:function(b){a.x=b.x;a.y=b.y},empty:function(){a.x=0;a.y=0},duplicate:function(){return new SLICK.Vector(a.x,
a.y)},getAbsSize:function(){return Math.max(Math.abs(a.x),Math.abs(a.y))},offset:function(b,d){return new SLICK.Vector(a.x+b,a.y+d)},invert:function(){return new SLICK.Vector(-a.x,-a.y)},matches:function(b){return b&&a.x==b.x&&a.y==b.y},toString:function(){return a.x+", "+a.y}};return a},VectorArray:function(e,c){for(var a=[],b=0;b<e.length;b++)a.push(c?e[b].duplicate():e[b]);return{applyOffset:function(d){for(var f=0;f<a.length;f++)a[f].add(d)},getRect:function(){return new SLICK.Rect(Math.min(a[0].x,
a[1].x),Math.min(a[0].y,a[1].y),Math.abs(a[0].x-a[1].x),Math.abs(a[0].y-a[1].y))},toString:function(){for(var d="",f=0;f<a.length;f++)d+="["+a[f].toString()+"] ";return d}}},VectorMath:function(){function e(c){if(!c||c.length<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var a={edges:Array(c.length-1),accrued:Array(c.length-1),total:0},b=0;b<c.length-1;b++){var d=c[b].diff(c[b+1]);a.edges[b]=Math.sqrt(d.x*d.x+d.y*d.y);a.accrued[b]=a.total+a.edges[b];a.total+=
a.edges[b]}return a}return{edges:e,distance:function(c){return e(c).total},theta:function(c,a,b){b=Math.asin((c.y-a.y)/b);return c.x>a.x?b:Math.PI-b},pointOnEdge:function(c,a,b,d){a=new SLICK.Vector(Math.cos(b)*d,Math.sin(b)*d);return new SLICK.Vector(c.x-a.x,c.y-a.y)}}}(),Dimensions:function(e,c){var a=c?e/c:1,b={width:e,height:c,aspect_ratio:a,inv_aspect_ratio:1/a,duplicate:function(){return new SLICK.Dimensions(b.width,b.height)},getAspectRatio:function(){return b.height!==0?b.width/b.height:1},
getCenter:function(){return new SLICK.Vector(b.width*0.5,b.height*0.5)},grow:function(d,f){return new SLICK.Dimensions(b.width+d,b.height+f)},matches:function(d){return d&&b.width==d.width&&b.height==d.height},toString:function(){return b.width+" x "+b.height}};return b},Rect:function(e,c,a,b){var d={origin:new SLICK.Vector(e,c),dimensions:new SLICK.Dimensions(a,b),duplicate:function(){return new SLICK.Rect(d.origin.x,d.origin.y,d.dimensions.width,d.dimensions.height)},getCenter:function(){return new SLICK.Vector(d.origin.x+
d.dimensions.width*0.5,d.origin.y+d.dimensions.height*0.5)},getSize:function(){return Math.sqrt(Math.pow(d.dimensions.width,2)+Math.pow(d.dimensions.height,2))},grow:function(f,h){var i=new SLICK.Dimensions(f-d.dimensions.width,h-d.dimensions.height);d.dimensions.width=f;d.dimensions.height=h;return i},expand:function(f,h){d.origin.x-=f;d.origin.y-=h;d.dimensions.width+=f;d.dimensions.height+=h},offset:function(f){return new g.Rect(d.origin.x+f.x,d.origin.y+f.y,d.dimensions.width,d.dimensions.height)},
getRequiredDelta:function(f,h){var i={top:0,left:0,bottom:0,right:0};i.top=f.origin.y-d.origin.y+(h?h.y:0);i.left=f.origin.x-d.origin.x+(h?h.x:0);i.right=f.origin.x+f.dimensions.width-(d.origin.x+d.dimensions.width)-i.left;i.bottom=f.origin.y+f.dimensions.height-(d.origin.y+d.dimensions.height)-i.top;return i},applyDelta:function(f,h,i){if(!f||!GRUNT.contains(f,["top","left","bottom","right"]))throw Error("Invalid delta - cannot apply to SLICK.Rect");h||(h=1);d.origin.x+=f.left*h;d.origin.y+=f.top*
h;d.dimensions.width+=f.right*h;d.dimensions.height+=f.bottom*h;i&&d.constrainAspectRatio(i)},constrainAspectRatio:function(f){var h=0,i={top:0,left:0,bottom:0,right:0};if(d.dimensions.getAspectRatio()<f){h=Math.abs(d.dimensions.width-d.dimensions.height*f);i.left=-h;i.right=h}else{h=Math.abs(d.dimensions.height-d.dimensions.width/f);i.top=-h;i.bottom=h}d.applyDelta(i)},moveTo:function(f,h){var i=new SLICK.Vector(f-d.origin.x,h-d.origin.y);d.origin.x=f;d.origin.y=h;return i},toString:function(){return String.format("(origin: {0}, dimensions: {1})",
d.origin,d.dimensions)}};return d}};return g}();
SLICK.Resources=function(){var n="",g={},e={},c={Cache:function(){return{read:function(){return null},write:function(){},getUrlCacheKey:function(a,b){for(var d=(a?a.replace(/^.*\?/,""):"").split("&"),f=a?a.replace(/\?.*$/,"?"):"",h=0;h<d.length;h++){var i=d[h].split("=");if(!b||!b.test(i[0]))f+=d[h]+"&"}return f.replace(/\W/g,"")},isValidCacheKey:function(a){GRUNT.Log.info("cache key = "+a);return false}}}(),getCachedUrl:function(a){return a},getPath:function(a){return/^(https?|\/)/.test(a)?a:n+a},
setBasePath:function(a){n=a},loadImage:function(a,b){var d;d=c.getPath(a);e[d]||(e[d]=new c.ImageResource({url:d}));d=e[d];if(d.loaded)b&&b(d.get());else d.loadListeners.push(b)},loadResource:function(a){a=GRUNT.extend({filename:"",cacheable:true,dataType:null,callback:null},a);var b=function(d){a.callback&&GRUNT.Log.watch("CALLING RESOURCE CALLBACK",function(){a.callback(d)})};a.cacheable&&g[a.filename]?b(g[a.filename]):GRUNT.XHR.ajax({url:c.getPath(a.filename),dataType:a.dataType,success:function(d){if(a.cacheable)g[a.filename]=
d;b(d)},error:function(d,f,h){GRUNT.Log.error("error loading resource ["+a.filename+"], error = "+h)}})},loadSnippet:function(a,b){/\.\w+$/.test(a)||(a+=".html");c.loadResource({filename:"snippets/"+a,callback:b,dataType:"html"})},ImageResource:function(a){a=GRUNT.extend({url:""},a);var b=null,d={loaded:false,loadListeners:[],get:function(){return b}};if(a.url){b=new Image;b.onload=function(){d.loaded=true;for(var f=0;f<d.loadListeners.length;f++)d.loadListeners[f]&&d.loadListeners[f](b)};b.src=a.url}return d}};
return c}();
SLICK.Touch=function(){function n(b,d){var f=b.length>0?b[0]:null;if(f&&d.length>0)return f.diff(d[0]);return null}function g(b){b.preventDefault();b.stopPropagation()}var e=0,c={TouchHelper:function(b){function d(s){s=new SLICK.VectorArray(s,true);b.element&&s.applyOffset(new SLICK.Vector(-b.element.offsetLeft,-b.element.offsetTop));return s}b=GRUNT.extend({element:null,inertiaTrigger:20,maxDistDoubleTap:20,panEventThreshhold:0,pinchZoomThreshold:5,touchStartHandler:null,moveHandler:null,moveEndHandler:null,
pinchZoomHandler:null,pinchZoomEndHandler:null,tapHandler:null,doubleTapHandler:null},b);var f={GLOBAL:"touches",TARGET:"targetTouches",CHANGED:"changedTouches"},h=[f.GLOBAL,f.TARGET],i={TAP:0,MOVE:1,PINCHZOOM:2},k=false,l=0,j=null,m=null,p=null,o=null,q=new SLICK.Vector,r=null,C=false,z=[],A={current:0,last:0},y={supportsTouch:SLICK.Device.supportsTouch,THRESHOLD_DOUBLETAP:300,addListeners:function(s){z.push(s)},fireEvent:function(s){var x=[],w=0;for(w=1;w<arguments.length;w++)x.push(arguments[w]);
for(w=0;w<z.length;w++)z[w][s]&&z[w][s].apply(y,x)},firePositionEvent:function(s,x){var w=null;if(b.element)w=x.offset(-b.element.offsetLeft,-b.element.offsetTop);y.fireEvent(s,x,w)},getTouchPoints:function(s,x){function w(D,u){for(var t=s[u],v=0;t&&v<t.length;v++)D.push(new SLICK.Vector(t[v].pageX,t[v].pageY))}x||(x=h);for(var E=[],F=0;F<x.length;F++){w(E,x[F]);if(E.length>0)break}E.length===0&&E.push(new SLICK.Vector(s.pageX,s.pageY));return E},start:function(s){try{j=y.getTouchPoints(s);p=new SLICK.Vector;
o=new SLICK.Vector;C=true;k=false;g(s);A.current=SLICK.Clock.getTime();var x=j.length>0?j[0]:null;if(x){y.fireEvent("touchStartHandler",x.x,x.y);if(A.current-A.last<y.THRESHOLD_DOUBLETAP){var w=m?j[0].diff(m[0]):null;if(w&&Math.abs(w.x)<b.maxDistDoubleTap&&Math.abs(w.y)<b.maxDistDoubleTap)k=true}r=i.TAP;m=[].concat(j)}else GRUNT.Log.warn("Touch start fired, but no touch vector found")}catch(E){GRUNT.Log.exception(E)}},move:function(s){if(C)try{g(s);var x=y.getTouchPoints(s);s=0;if(x.length>1){if(j.length===
1)j=[].concat(x);s=SLICK.VectorMath.distance(j)-SLICK.VectorMath.distance(m)}if(r===i.TAP){var w=n(x,j);if(w&&(Math.abs(w.x)>=7||Math.abs(w.y)>=7))r=i.MOVE}if(r!==i.TAP)if(!s||Math.abs(s)<b.pinchZoomThreshold){p=n(x,m);o.add(p);q.add(p);if(q.getAbsSize()>b.panEventThreshhold){y.fireEvent("moveHandler",q.x,q.y);q.empty()}r=i.MOVE}else{y.fireEvent("pinchZoomHandler",d(j),d(x));r=i.PINCHZOOM}m=[].concat(x)}catch(E){GRUNT.Log.exception(E)}},end:function(s){try{g(s);SLICK.Clock.getTime();A.last=A.current;
if(r===i.TAP)l||(l=setTimeout(function(){l=0;y.firePositionEvent(k?"doubleTapHandler":"tapHandler",j[0])},y.THRESHOLD_DOUBLETAP+50));else if(r==i.MOVE)y.fireEvent("moveEndHandler",o.x,o.y);else r==i.PINCHZOOM&&y.fireEvent("pinchZoomEndHandler",d(j),d(m));C=false}catch(x){GRUNT.Log.exception(x)}}};return y}},a=[];return{captureTouch:function(b,d){try{if(!b)throw Error("Unable to capture touch of null element");if(!b.id)b.id="touchable_"+e++;var f=a[b.id];if(!f){f=c.TouchHelper(GRUNT.extend({element:b},
d));a[b.id]=f;GRUNT.Log.info("CREATED TOUCH HELPER. SUPPORTS TOUCH = "+f.supportsTouch);SLICK.Device.eventTarget.addEventListener(f.supportsTouch?"touchstart":"mousedown",function(i){i.target&&i.target===b&&f.start(i)},false);SLICK.Device.eventTarget.addEventListener(f.supportsTouch?"touchmove":"mousemove",function(i){i.target&&i.target===b&&f.move(i)},false);SLICK.Device.eventTarget.addEventListener(f.supportsTouch?"touchend":"mouseup",function(i){i.target&&i.target===b&&f.end(i)},false);if(f.supportsTouch)b.onmousewheel=
function(i){i.preventDefault()}}f.addListeners(d)}catch(h){GRUNT.Log.exception(h)}}}}();if(typeof jQuery!=="undefined"){jQuery.fn.canTouchThis=function(n){return this.each(function(){SLICK.Touch.captureTouch(this,n)})};jQuery.fn.untouchable=function(){return this.bind("touchmove",function(n){n.preventDefault()})}}
SLICK.Pannable=function(n){n=GRUNT.extend({container:null,onPan:null,onPanEnd:null,checkOffset:null},n);var g=false,e=new SLICK.Vector,c={pannable:true,getOffset:function(){return new SLICK.Vector(e.x,e.y)},setOffset:function(b,d){e.x=b;e.y=d},pan:function(b,d,f){if(f)c.updateOffset(e.x+b,e.y+d,f);else{c.updateOffset(e.x+b,e.y+d);n.onPan&&n.onPan(b,d)}},isAnimating:function(){return g},panEnd:function(b,d){n.onPanEnd&&n.onPanEnd(b,d)},updateOffset:function(b,d,f){if(f){b=new SLICK.Vector(b,d);g=true;
f=SLICK.Animation.tweenVector(e,b.x,b.y,f,function(){g=false;c.panEnd(0,0)});for(b=0;b<f.length;b++)f[b].cancelOnInteract=true}else c.setOffset(b,d)}},a=document.getElementById(n.container);a&&SLICK.Touch.captureTouch(a,{moveHandler:function(b,d){c.pan(-b,-d)},moveEndHandler:function(b,d){c.panEnd(b,d)}});return c};
SLICK.Scalable=function(n){function g(h,i){c=h.getRect();a=i.getRect();b=c&&c.getSize()!=0?a.getSize()/c.getSize():1}n=GRUNT.extend({container:null,onPinchZoom:null,onScale:null,scaleDamping:false},n);var e=false,c=null,a=null,b=1,d={scalable:true,getStartRect:function(){return c.duplicate()},getEndRect:function(){return a.duplicate()},getScaling:function(){return e},getScaleFactor:function(){return b}},f=document.getElementById(n.container);f&&SLICK.Touch.captureTouch(f,{pinchZoomHandler:function(h,
i){g(h,i);e=true;n.onPinchZoom&&n.onPinchZoom()},pinchZoomEndHandler:function(h,i){g(h,i);e=false;n.onScale&&n.onScale(b);b=1}});return d};
SLICK.Dispatcher=function(){var n=[],g={execute:function(e){var c=g.findAction(e);if(c){var a=[].concat(arguments).slice(0,1);GRUNT.Log.watch("EXECUTING ACTION: "+e,function(){c.execute(a)})}},findAction:function(e){for(var c=0;c<n.length;c++)if(n[c].id==e)return n[c];return null},getRegisteredActions:function(){return[].concat(n)},getRegisteredActionIds:function(){for(var e=[],c=0;c<n.length;c++)n[c].id&&e.push(n[c].id);return e},registerAction:function(e){e&&e.id&&n.push(e)},Action:function(e){e=
GRUNT.extend({autoRegister:true,id:"",title:"",icon:"",execute:null},e);var c={id:e.id,execute:function(){e.execute&&e.execute.apply(this,arguments)},getParam:function(a){return e[a]?e[a]:""},toString:function(){return String.format("{0} [title = {1}, icon = {2}]",c.id,e.title,e.icon)}};e.autoRegister&&g.registerAction(c);return c},createAgent:function(e){e=GRUNT.extend({name:"Untitled",trashOrphanedResults:true,execute:null},e);var c=null,a={getName:function(){return e.name},getParam:function(b){return e[b]},
getId:function(){return GRUNT.toID(a.getName())},run:function(b,d){if(e.execute){var f=c=SLICK.Clock.getTime(true);e.execute.call(this,b,function(h,i){if(!e.trashOrphanedResults||f==c)d&&d(h,i)})}}};return a},runAgents:function(e,c,a){for(var b=0;b<e.length;b++)e[b].run(c,a)}};return g}();
SLICK.Messaging=function(){var n=[],g=[],e=GRUNT.newModule({id:"slick.messaging",requires:["slick.core"],STATUS:{none:0,created:1,updated:2,handled:3},send:function(c){c=GRUNT.extend({type:"",payload:{},index:0,status:e.STATUS.created,statusChange:null},c);c.index=g.push(c)-1;c=c.index;var a=c>=0&&c<g.length?g[c]:null;GRUNT.Log.info("firing message update, index = "+c+", message = "+a);for(var b=0;a&&b<n.length&&a.status!==e.STATUS.handled;){var d=n[b].processUpdate(g[c]);if(d){d=d;n[b].getId();var f=
c>=0&&c<g.length?g[c]:null;if(f){f.status=d;f.statusChange&&f.statusChange(f)}}b++}},Handler:function(c){c=GRUNT.extend({id:"",processUpdate:null},c);var a={getId:function(){return c.id},processUpdate:function(b){if(c.processUpdate)return c.processUpdate(b);return e.STATUS.none}};n.push(a);return a}});return e}();
SLICK.Animation=function(){var n=[],g={DURATION:2E3,tweenValue:function(e,c,a,b,d){e=new g.Tween({startValue:e,endValue:c,tweenFn:a,complete:b,duration:d});n.push(e);return e},tween:function(e,c,a,b,d,f){e=new g.Tween({target:e,property:c,endValue:a,tweenFn:b,duration:f,complete:d});n.push(e);return e},tweenVector:function(e,c,a,b,d,f){var h=[];if(e){var i=e.x==c,k=e.y==a;i||h.push(g.tween(e,"x",c,b,function(){(i=true)&&k&&d()},f));k||h.push(g.tween(e,"y",a,b,function(){k=true;i&&k&&d()},f))}return h},
cancel:function(e){for(var c=0;c<n.length;)if(!e||e(n[c])){GRUNT.Log.info("CANCELLING ANIMATION");n[c].triggerComplete(true);n.splice(c,1)}else c++},isTweening:function(){return n.length>0},update:function(e){for(var c=0;c<n.length;)if(n[c].isComplete()){n[c].triggerComplete(false);n.splice(c,1);GRUNT.WaterCooler.say("animation.complete")}else{n[c].update(e);c++}},Tween:function(e){function c(k,l){for(var j=0;j<b.length;j++)b[j](k,l)}e=GRUNT.extend({target:null,property:null,startValue:0,endValue:null,
duration:g.DURATION,tweenFn:g.DEFAULT,complete:null,cancelOnInteract:false},e);var a=SLICK.Clock.getTime(),b=[],d=false,f=0,h=0,i={cancelOnInteract:e.cancelOnInteract,isComplete:function(){return d},triggerComplete:function(k){e.complete&&e.complete(k)},update:function(k){try{var l=e.tweenFn(k-a,f,h,e.duration);if(e.target)e.target[e.property]=l;c(l);if(d=a+e.duration<=k){if(e.target)e.target[e.property]=e.tweenFn(e.duration,f,h,e.duration);c(l,true)}}catch(j){GRUNT.Log.exception(j)}},requestUpdates:function(k){b.push(k)}};
f=e.target&&e.property&&e.target[e.property]?e.target[e.property]:e.startValue;if(typeof e.endValue!=="undefined")h=e.endValue-f;if(h==0)d=true;return i},Easing:function(){var e=1.70158;return{Linear:function(c,a,b,d){return b*c/d+a},Back:{In:function(c,a,b,d){return b*(c/=d)*c*((e+1)*c-e)+a},Out:function(c,a,b,d){return b*((c=c/d-1)*c*((e+1)*c+e)+1)+a},InOut:function(c,a,b,d){return(c/=d/2)<1?b/2*c*c*(((e*=1.525)+1)*c-e)+a:b/2*((c-=2)*c*(((e*=1.525)+1)*c+e)+2)+a}},Bounce:{In:function(c,a,b,d){return b-
g.Easing.Bounce.Out(d-c,0,b,d)+a},Out:function(c,a,b,d){return(c/=d)<1/2.75?b*7.5625*c*c+a:c<2/2.75?b*(7.5625*(c-=1.5/2.75)*c+0.75)+a:c<2.5/2.75?b*(7.5625*(c-=2.25/2.75)*c+0.9375)+a:b*(7.5625*(c-=2.625/2.75)*c+0.984375)+a},InOut:function(c,a,b,d){return c<d/2?g.Easing.Bounce.In(c*2,0,b,d)*0.5+a:g.Easing.Bounce.Out(c*2-d,0,b,d)*0.5+b*0.5+a}},Cubic:{In:function(c,a,b,d){return b*(c/=d)*c*c+a},Out:function(c,a,b,d){return b*((c=c/d-1)*c*c+1)+a},InOut:function(c,a,b,d){if((c/=d/2)<1)return b/2*c*c*c+
a;return b/2*((c-=2)*c*c+2)+a}},Elastic:{In:function(c,a,b,d,f,h){if(c==0)return a;if((c/=d)==1)return a+b;h||(h=d*0.3);if(!f||f<Math.abs(b)){f=b;b=h/4}else b=h/(2*Math.PI)*Math.asin(b/f);return-(f*Math.pow(2,10*(c-=1))*Math.sin((c*d-b)*2*Math.PI/h))+a},Out:function(c,a,b,d,f,h){var i;if(c==0)return a;if((c/=d)==1)return a+b;h||(h=d*0.3);if(!f||f<Math.abs(b)){f=b;i=h/4}else i=h/(2*Math.PI)*Math.asin(b/f);return f*Math.pow(2,-10*c)*Math.sin((c*d-i)*2*Math.PI/h)+b+a},InOut:function(c,a,b,d,f,h){var i;
if(c==0)return a;if((c/=d/2)==2)return a+b;h||(h=d*0.3*1.5);if(!f||f<Math.abs(b)){f=b;i=h/4}else i=h/(2*Math.PI)*Math.asin(b/f);if(c<1)return-0.5*f*Math.pow(2,10*(c-=1))*Math.sin((c*d-i)*2*Math.PI/h)+a;return f*Math.pow(2,-10*(c-=1))*Math.sin((c*d-i)*2*Math.PI/h)*0.5+b+a}},Quad:{In:function(c,a,b,d){return b*(c/=d)*c+a},Out:function(c,a,b,d){return-b*(c/=d)*(c-2)+a},InOut:function(c,a,b,d){if((c/=d/2)<1)return b/2*c*c+a;return-b/2*(--c*(c-2)-1)+a}},Sine:{In:function(c,a,b,d){return-b*Math.cos(c/d*
(Math.PI/2))+b+a},Out:function(c,a,b,d){return b*Math.sin(c/d*(Math.PI/2))+a},InOut:function(c,a,b,d){return-b/2*(Math.cos(Math.PI*c/d)-1)+a}}}}()};return GRUNT.extend(g,{DEFAULT:g.Easing.Back.Out})}();SLICK.Border={NONE:0,TOP:1,RIGHT:2,BOTTOM:3,LEFT:4};
SLICK.Graphics=function(){var n=0,g={requires:["Resources"],scaleCanvas:function(e,c){var a=document.createElement("canvas");a.width=e.width*c;a.height=e.height*c;a.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,a.width,a.height);return a},drawScaledRect:function(e,c,a,b,d){var f=b.getSize(),h=d.getSize();d.getCenter();var i=f!=0?h/f:1,k=null,l=b.duplicate(),j=d.duplicate(),m=c.width/c.height;if(f>h){k=b.getRequiredDelta(new SLICK.Rect(0,0,c.width,c.height));l.applyDelta(k);j.applyDelta(k,
i,m)}else{k=d.getRequiredDelta(new SLICK.Rect(0,0,c.width,c.height));j.applyDelta(k);l.applyDelta(k,1/i,m)}b&&d&&e.drawImage(a,l.origin.x,l.origin.y,l.dimensions.width,l.dimensions.height,j.origin.x,j.origin.y,j.dimensions.width,j.dimensions.height)},drawRect:function(e,c){e.strokeRect(c.origin.x,c.origin.y,c.dimensions.width,c.dimensions.height)},DisplayState:{NONE:0,ACTIVE:1,ANIMATING:2,INTERACTING:4,FROZEN:8,PINCHZOOM:16},AnyDisplayState:255,ViewLayer:function(e){e=GRUNT.extend({id:"",draw:null,
centerOnScale:true,zindex:0,canCache:false,checkOK:null,validStates:g.DisplayState.ACTIVE|g.DisplayState.INTERACTING|g.DisplayState.PINCHZOOM},e);var c=[],a={getId:function(){return e.id},setId:function(b){e.id=b},getZIndex:function(){return e.zindex},isAnimating:function(){return false},addToView:function(b){b.setLayer(e.id,a)},beginDraw:function(b){e.beginDraw&&e.beginDraw(b)},canDraw:function(b){return b&e.validStates!==0},checkOK:function(b){if(e.checkOK)return e.checkOK(b);return true},draw:function(b){e.draw&&
e.draw(b)},layerChanged:function(){for(var b=0;b<c.length;b++)c[b](a)},notify:function(){},remove:function(){GRUNT.WaterCooler.say("layer.remove",{id:e.id})},registerChangeListener:function(b){c.push(b)},setBufferOffset:function(b,d){bufferOffset.x=b;bufferOffset.y=d},canCache:function(){return e.canCache}};return a},StatusViewLayer:function(){return new g.ViewLayer({validStates:g.AnyDisplayState,zindex:5E3,draw:function(e){e.context.fillStyle="#FF0000";e.context.fillRect(10,10,50,50);e.context.fillStyle=
"#FFFFFF";e.context.font="bold 10px sans";e.context.fillText(e.displayState,20,20)}})},AnimatedPathLayer:function(e){function c(f,h){f.context.fillStyle="#FFFFFF";f.context.strokeStyle="#222222";f.context.beginPath();f.context.arc(h.x,h.y,4,0,Math.PI*2,false);f.context.stroke();f.context.fill()}e=GRUNT.extend({path:[],id:GRUNT.generateObjectID("pathAnimation"),easing:SLICK.Animation.Easing.Sine.InOut,canCache:false,validStates:g.DisplayState.ACTIVE|g.DisplayState.INTERACTING|g.DisplayState.ANIMATING,
drawIndicator:null,duration:2E3},e);var a=SLICK.VectorMath.edges(e.path),b=0;SLICK.Animation.tweenValue(0,a.total,e.easing,function(){d.remove()},e.duration).requestUpdates(function(f,h){b=f;h&&d.remove()});var d=new g.ViewLayer(GRUNT.extend(e,{draw:function(f){for(var h=0;h<a.accrued.length&&a.accrued[h]<b;)h++;if(h<e.path.length-1){var i=b-(h>0?a.accrued[h-1]:0),k=e.path[h],l=e.path[h+1];h=SLICK.VectorMath.theta(k,l,a.edges[h]);i=SLICK.VectorMath.pointOnEdge(k,l,h,i);(e.drawIndicator?e.drawIndicator:
c)(f,new SLICK.Vector(i.x-f.offset.x,i.y-f.offset.y),h)}}}));return d},View:function(e){function c(u,t){for(var v=0;v<s.length;){if(s[v].getZIndex()>=t.getZIndex())break;v++}t.setId(u);t.registerChangeListener(function(){m++});v<s.length?s.splice(v,0,t):s.push(t);D.notifyLayerListeners("add",u,t)}function a(){l=1E3;if(q)if(m>0||!j||!j.offset.matches(q.offset)||!j.dimensions.matches(q.dimensions)){i.clearRect(0,0,h.width,h.height);j=GRUNT.extend({},q);q.context=i;q.offset=q.offset.offset(-e.padding,
-e.padding);q.dimensions=q.dimensions.grow(e.padding*2,e.padding*2);for(var u=0;u<s.length;u++)if(s[u].canCache()&&!s[u].isAnimating()){s[u].draw(q);l=Math.min(l,s[u].getZIndex())}m=0;k=q.offset.duplicate()}}function b(u,t){if(!F){o||(o=D.getDimensions());var v=x?x.getOffset():new SLICK.Vector,B=!q||!q.offset.matches(v),G=!q||!q.dimensions.matches(o);q={context:null,displayState:z,offset:v,offsetChanged:B,animating:t||x.isAnimating(),dimensions:o,dimensionsChanged:G,scaleFactor:D.getScaleFactor(),
scaling:w,ticks:u};try{F=true;v=false;q.scaleFactor!=1&&f.clearRect(0,0,d.width,d.height);for(B=0;B<s.length;B++){s[B].beginDraw(q);q.context=f;if((!t||!s[B].canCache())&&s[B].canDraw(z))s[B].draw(q);if(t&&!v&&l>=s[B].getZIndex()){var H=k.diff(q.offset);if(q.scaleFactor!==1){var I=w.getStartRect(),J=w.getEndRect();g.drawScaledRect(f,o.grow(e.padding*2,e.padding*2),h,I,J);if(e.pinchZoomDebug){f.strokeStyle="#0000FF";f.lineWidth=4;g.drawRect(f,I);f.strokeStyle="#FF0000";g.drawRect(f,J)}}else f.drawImage(h,
H.x,H.y);v=true}}e.onDraw&&e.onDraw(q)}finally{F=false}}}e=GRUNT.extend({id:"view_"+n++,container:"",defineLayers:null,pannable:false,scalable:false,scaleDamping:false,bufferRefresh:100,padding:200,fps:40,onPan:null,onPinchZoom:null,onScale:null,onDraw:null,autoSize:false,pinchZoomDebug:true},e);var d=document.getElementById(e.container),f=null,h=null,i=null,k=new SLICK.Vector,l=0,j=null,m=0,p=0,o=null,q=null,r=false,C=false,z=g.DisplayState.ACTIVE,A=e.fps?1E3/e.fps:40;GRUNT.Log.info("Creating a new view instance, attached to container: "+
e.container+", canvas = ",d);if(d){if(e.autoSize){GRUNT.Log.info("autosizing view: window.height = "+window.innerHeight+", width = "+window.innerWidth);d.height=window.innerHeight-d.offsetTop-49;d.width=window.innerWidth-d.offsetLeft}try{f=d.getContext("2d")}catch(y){GRUNT.Log.exception(y);throw Error("Could not initialise canvas on specified view element");}}h=document.createElement("canvas");h.width=d.width+e.padding*2;h.height=d.height+e.padding*2;i=h.getContext("2d");var s=[];if(e.defineLayers)s=
e.defineLayers();var x=null;if(e.pannable)x=new SLICK.Pannable({container:e.container,onPan:function(u,t){D.invalidate();e.onPan&&e.onPan(u,t)},onPanEnd:function(){}});var w=null;if(e.scalable)w=new SLICK.Scalable({scaleDamping:e.scaleDamping,container:e.container,onPinchZoom:function(u,t){D.invalidate();e.onPinchZoom&&e.onPinchZoom(u,t);z=g.DisplayState.PINCHZOOM},onScale:function(u){for(var t=0;t<s.length;t++)s[t].notify("scale");e.onScale&&e.onScale(u);z=g.DisplayState.ACTIVE}});var E=[],F=false,
D=GRUNT.extend({},x,w,{id:e.id,getContext:function(){return buffer_context},getDimensions:function(){if(d)return new SLICK.Dimensions(d.width,d.height)},getLayer:function(u){for(var t=0;t<s.length;t++)if(s[t].getId()==u){/^grid/i.test(u)||GRUNT.Log.info("found layer: "+u);return s[t]}return null},setLayer:function(u,t){for(var v=0;v<s.length;v++)if(s[v].getId()===u){s.splice(v,1);break}t&&c(u,t);D.notifyLayerListeners("update",u,t)},eachLayer:function(u){for(var t=0;t<s.length;t++)u(s[t])},setDisplayStatus:function(u){z=
u},removeLayer:function(u,t){setTimeout(function(){var v;a:{for(v=0;v<s.length;v++)if(s[v].getId()==u){v=v;break a}v=-1}if(v>=0&&v<s.length){D.notifyLayerListeners("remove",u,s[v]);s.splice(v,1)}},t?t:1)},registerLayerListener:function(u){E.push(u)},notifyLayerListeners:function(u,t,v){for(var B=0;B<E.length;B++)E[B](u,t,v)},invalidate:function(){p=SLICK.Clock.getTime(true)}});o=D.getDimensions();GRUNT.Log.info("setting repaint interval to "+A+" ms");setInterval(function(){try{var u=SLICK.Clock.getTime(),
t=z==g.DisplayState.PINCHZOOM||u-p<e.bufferRefresh;t&&SLICK.Animation.cancel(function(G){return G.cancelOnInteract});SLICK.Animation.update(u);for(var v=0;v<s.length;v++)s[v].checkOK(q);C=C&&!t&&!SLICK.Animation.isTweening();b(u,t);if(!t&&!SLICK.Animation.isTweening()){a();if(!C){C=true;GRUNT.WaterCooler.say("view-idle",{id:D.id})}}r=false}catch(B){GRUNT.Log.exception(B)}},A);GRUNT.WaterCooler.listen("layer.remove",function(u){u.id&&D.removeLayer(u.id)});return D},ImageCache:function(){function e(a){c||
(c=document.createElement("canvas"));c.width=a.width;c.height=a.height;c.getContext("2d").drawImage(a,0,0);return c}var c=null;return{getImage:function(a,b){SLICK.Resources.Cache.getUrlCacheKey(a,b);return null},cacheImage:function(a,b,d){a=SLICK.Resources.Cache.getUrlCacheKey(a,b);d&&SLICK.Resources.Cache.write(a,e(d).toDataURL("image/png"))}}}(),Sprite:function(){var e=[];return{loaded:false,changed:function(c){for(var a=0;a<e.length;a++)e[a](c)},draw:function(){},load:function(){},requestUpdates:function(c){e.push(c)}}}};
return g}();
SLICK.Tiling=function(){TileStore=function(g){g=GRUNT.extend({gridSize:20,center:new SLICK.Vector},g);var e=Array(Math.pow(g.gridSize,2)),c=Math.ceil(g.gridSize*0.5),a=g.center.offset(-c,-c),b=null,d=new SLICK.Vector,f=null;GRUNT.Log.info("created tile store with tl offset = "+a);var h={getGridSize:function(){return g.gridSize},getNormalizedPos:function(i,k){return(new SLICK.Vector(i,k)).add(a.invert()).add(d)},getTileShift:function(){return d.duplicate()},getTile:function(i,k){return i>=0&&i<g.gridSize?
e[k*g.gridSize+i]:null},setTile:function(i,k,l){e[k*g.gridSize+i]=l},populate:function(i,k){var l=SLICK.Clock.getTime(),j=0;GRUNT.Log.info("poulating grid, top left offset = "+a);if(i)for(var m=0;m<g.gridSize;m++)for(var p=0;p<g.gridSize;p++){if(!e[j]){var o=i(p,m,a,g.gridSize);o&&k&&o.requestUpdates(k);e[j]=o}j++}b=i;f=k;GRUNT.Log.info("tile grid populated with "+j+" tiles in "+(SLICK.Clock.getTime()-l)+" ms")},getShiftDelta:function(i,k,l,j){var m=Math.floor(g.gridSize*0.2),p=new SLICK.Vector;if(i<
0||i+l>g.gridSize)p.x=i<0?-m:m;if(k<0||k+j>g.gridSize)p.y=k<0?-m:m;return p},shift:function(i,k){if(!(i.x===0&&i.y===0)){var l=Array(e.length);l.length=e.length;for(var j=0;j<g.gridSize;j++)for(var m=0;m<g.gridSize;m++)l[m*g.gridSize+j]=h.getTile(j+i.x,m+i.y);e=l;if(k)a=k(a,i);else a.add(i);d.x+=-i.x*g.tileSize;d.y+=-i.y*g.tileSize;GRUNT.Log.info("shifting... tile shift = "+d);h.populate(b,f)}},setOrigin:function(i,k){tileOrigin||(a=(new SLICK.Vector(i,k)).offset(-tileHalfWidth,-tileHalfWidth))}};
return h};var n={Config:{TILESIZE:256,TILEBUFFER:1,TILEBUFFER_LOADNEW:0.2,EMPTYTILE:"/public/images/tile.png"},Tile:function(g){g=GRUNT.extend({},g);return GRUNT.extend(new SLICK.Graphics.Sprite(g),{})},ImageTile:function(g){g=GRUNT.extend({url:"",sessionParamRegex:null},g);var e=new n.Tile(g),c=null,a=GRUNT.extend({},e,{draw:function(b,d,f){c&&c.complete&&b.drawImage(c,d,f)},load:function(b){if(!c&&g.url){c=null;if(!c){c=new Image;c.src=g.url;c.onload=function(){b&&b();a.loaded=true;a.changed(a)}}}}});
return a},EmptyGridTile:function(g){g=GRUNT.extend({tileSize:256,gridLineSpacing:16},g);var e=new SLICK.Graphics.Sprite(g),c=null;e=GRUNT.extend({},e,{draw:function(a,b,d){a.drawImage(c,b,d)},getBuffer:function(){return c},getTileSize:function(){return g.tileSize}});(function(){if(!c){c=document.createElement("canvas");c.width=g.tileSize;c.height=g.tileSize}var a=c.getContext("2d");a.fillStyle="rgb(200, 200, 200)";a.fillRect(0,0,c.width,c.height);a.strokeStyle="rgb(180, 180, 180)";a.lineWidth=0.5;
a.beginPath();for(var b=0;b<c.width;b+=g.gridLineSpacing){a.moveTo(b,0);a.lineTo(b,c.height);for(var d=0;d<c.height;d+=g.gridLineSpacing){a.moveTo(0,d);a.lineTo(c.width,d)}}a.stroke()})();return e},TileGridBackground:function(g){g=GRUNT.extend({lineDist:16,lineWidth:1,fillStyle:"rgb(200, 200, 200)",strokeStyle:"rgb(180, 180, 180)",zindex:-1,draw:function(d){var f=g.lineDist-Math.abs(d.offset.x%g.lineDist),h=g.lineDist-Math.abs(d.offset.y%g.lineDist);c.fillRect(0,0,e.width,e.height);c.lineWidth=g.lineWidth;
c.beginPath();c.moveTo(f,0);c.lineTo(f,g.lineDist);c.moveTo(0,h);c.lineTo(g.lineDist,h);c.stroke();b=true;a=d.scaleFactor!==1?d.context.createPattern(SLICK.Graphics.scaleCanvas(e,d.scaleFactor),"repeat"):d.context.createPattern(e,"repeat");d.context.fillStyle=a;d.context.fillRect(0,0,d.dimensions.width,d.dimensions.height)},canCache:false,validStates:SLICK.Graphics.AnyDisplayState});var e=document.createElement("canvas");e.width=g.lineDist;e.height=g.lineDist;var c=e.getContext("2d");c.fillStyle=
g.fillStyle;c.strokeStyle=g.strokeStyle;var a=null,b=false;return new SLICK.Graphics.ViewLayer(g)},TileGrid:function(g){function e(m,p){for(var o=0;o<b.length;o++)b[o](m,p)}function c(m){var p=l.getTileShift(),o=new SLICK.Vector(Math.floor((m.offset.x+p.x)*d),Math.floor((m.offset.y+p.y)*d));p=Math.ceil(m.dimensions.width*d)+1;m=Math.ceil(m.dimensions.height*d)+1;var q=new SLICK.Vector(o.x*g.tileSize,o.y*g.tileSize);h=[];tilesNeeded=false;for(var r=0;r<m;r++)for(var C=r*g.tileSize+q.y,z=0;z<p;z++){var A=
l.getTile(z+o.x,r+o.y),y=z*g.tileSize+q.x;A||(k=l.getShiftDelta(o.x,o.y,p,m));h.push({tile:A,coordinates:new SLICK.Vector(y,C)})}o=[{vector:new SLICK.Vector(1,0)},{vector:new SLICK.Vector(0,1),decrementor:new SLICK.Vector(0,-1)},{vector:new SLICK.Vector(-1,0),decrementor:new SLICK.Vector(-1,0)},{vector:new SLICK.Vector(0,-1),decrementor:new SLICK.Vector(0,-1)}];q=new SLICK.Vector(0,0);r=new SLICK.Vector(p-1,m-1);C=0;z=[];y=A=0;for(var s=[];C<p*m;){var x=q.y*p+q.x;z.push(h[x]);var w=o[A].vector;y++;
q.add(w);q.offset(w.x,w.y);if(w.x&&y>=r.x||w.y&&y>=r.y){o[A].decrementor&&r.add(o[A].decrementor);y=0;A=(A+1)%o.length}s.push(x);C++}h=z.reverse();i=false}g=GRUNT.extend({emptyTileImage:null,tileSize:SLICK.Tiling.Config.TILESIZE,drawGrid:false,center:new SLICK.Vector,beginDraw:function(m){if(m.offsetChanged||m.dimensionsChanged)c(m)},draw:function(m){var p=l.getTileShift();i&&c(m);if(g.drawGrid)m.context.strokeStyle="rgba(50, 50, 50, 0.3)";m.context.beginPath();for(var o=0;o<h.length;o++){var q=h[o].tile,
r=h[o].coordinates.duplicate();r.x-=m.offset.x+p.x;r.y-=m.offset.y+p.y;if(q&&q.loaded)q.draw(m.context,r.x,r.y);else q&&!m.animating&&q.load(function(){f++;j.layerChanged();e("load",q)});g.drawGrid&&m.context.rect(r.x,r.y,g.tileSize,g.tileSize)}m.context.stroke()},checkOK:function(){var m=k.x+k.y!==0;if(m){l.shift(k,g.shiftOrigin);k=new SLICK.Vector}return!m},shiftOrigin:null,canCache:true},g);var a=Math.round(g.tileSize*0.5),b=[],d=g.tileSize?1/g.tileSize:0,f=0,h=[],i=false,k=new SLICK.Vector,l=
new TileStore(g),j=new SLICK.Graphics.ViewLayer(g);GRUNT.extend(j,{addTile:function(m,p,o){l.setTile(m,p,o);if(o){o.setSize(g.tileSize);o.requestUpdates(function(q){e("updated",q)})}},getLoadedTileCount:function(){return f},getVisibleTileCount:function(m){if(g.tileSize!==0)return Math.ceil(m.width/g.tileSize)+Math.ceil(m.height/g.tileSize);return 0},getTileSize:function(){return g.tileSize},getTileVirtualXY:function(m,p,o){m=l.getNormalizedPos(m,p);GRUNT.Log.info("normalised pos = "+m);m=new SLICK.Vector(m.x*
g.tileSize,m.y*g.tileSize);if(o){m.x+=a;m.y+=a}return m},getCenterXY:function(){var m=Math.ceil(l.getGridSize()*0.5);return j.getTileVirtualXY(m,m,true)},getDimensions:function(){var m=l.getGridSize()*g.tileSize;return new SLICK.Dimensions(m,m)},populate:function(m){l.populate(m,function(p){e("created",p)})},requestUpdates:function(m){b.push(m)}});return j},DataLayer:function(){},Tiler:function(g){function e(h,i){i.requestUpdates(function(k){if(k=="load")if(h!=a&&i.getLoadedTileCount()>=b){f.notifyLayerListeners("load",
h,i);a=h}})}g=GRUNT.extend({container:"",drawCenter:false,onPan:null,onPanEnd:null,tapHandler:null,doubleTapHandler:null,zoomHandler:null,onDraw:null,datasources:{},tileLoadThreshold:"first"},g);(new SLICK.Tiling.EmptyGridTile).getTileSize();var c=0,a="",b=0,d={first:function(){return 1},auto:function(h){return h*0.5},all:function(h){return h}};SLICK.Touch.captureTouch(document.getElementById(g.container),g);var f=new SLICK.Graphics.View(GRUNT.extend({},g,{pannable:true,scalable:true,scaleDamping:true,
datasources:g.datasources,fillBackground:function(h,i,k,l,j){i=h.createLinearGradient(i,0,i,j);i.addColorStop(0,"rgb(170, 170, 170)");i.addColorStop(1,"rgb(210, 210, 210)");h.fillStyle=i;h.fillRect(0,0,l,j)},onDraw:function(h){f.getOffset();g.onDraw&&g.onDraw(h)}}));GRUNT.extend(f,{newTileLayer:function(){f.removeLayer("grid"+c);c++},getTileLayer:function(){return f.getLayer("grid"+c)},setTileLayer:function(h){e("grid"+c,h);f.setLayer("grid"+c,h);h=h.getVisibleTileCount(f.getDimensions());b=d[g.tileLoadThreshold]?
d[g.tileLoadThreshold](h):parseInt(g.tileLoadThreshold,10)},gridPixToViewPix:function(h){var i=f.getOffset();return new SLICK.Vector(h.x-i.x,h.y-i.y)},viewPixToGridPix:function(h){var i=f.getOffset();GRUNT.Log.info("Offset = "+i);return new SLICK.Vector(h.x+i.x,h.y+i.y)}});f.setLayer("background",new n.TileGridBackground);return f}};return n}();
SLICK.Geo=function(){function n(a,b){var d=null;for(var f in e)if(b){if(f==b&&e[f][a]){d=e[f];break}}else if(e[f][a]){d=e[f];break}return d}var g=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],e={},c={Engine:function(a){if(!a.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var b=GRUNT.extend({remove:function(){delete e[b.id]}},a);return e[b.id]=b},getEngine:function(a){for(var b=null,d=1;!b&&d<arguments.length;d++)b=n(a,arguments[d]);
b=b?b:n(a);if(!b)throw Error("Unable to find GEO engine with "+a+" capability");return b},Distance:function(a,b){var d=0;if(a&&!a.isEmpty()&&b&&!b.isEmpty()){var f=(b.lat-a.lat).toRad()*0.5,h=(b.lon-a.lon).toRad()*0.5;f=Math.sin(f)*Math.sin(f)+Math.cos(a.lat.toRad())*Math.cos(b.lat.toRad())*Math.sin(h)*Math.sin(h);d=6371*2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f))}return{toM:function(){return d*1E3},toKM:function(){return d},toString:function(){return d+"km"}}},Radius:function(a,b){return{distance:parseInt(a,
10),uom:b}},Position:function(a,b){if(!b&&a&&a.split&&a.indexOf(" ")>=0){var d=a.split(" ");a=d[0];b=d[1]}if(!a)b=a=0;var f={lat:parseFloat(a),lon:parseFloat(b),copy:function(h){f.lat=h.lat;f.lon=h.lon},duplicate:function(){return new c.Position(f.lat,f.lon)},clear:function(){f.lat=0;f.lon=0},isEmpty:function(){return f.lat===0&&f.lon===0},getMercatorPixels:function(h){return new SLICK.Vector(SLICK.Geo.Utilities.lon2pix(f.lon,h),SLICK.Geo.Utilities.lat2pix(f.lat,h))},setMercatorPixels:function(h,
i,k){if(!k)throw"Unable to calculate position from mercator pixels without rads_per_pixel value";f.lat=SLICK.Geo.Utilities.pix2lat(i,k);f.lon=SLICK.Geo.Utilities.normalizeLon(SLICK.Geo.Utilities.pix2lon(h,k))},toString:function(){return f.lat+" "+f.lon}};return f},BoundingBox:function(a,b){if(a){if(a.split)a=new SLICK.Geo.Position(a)}else a=new SLICK.Geo.Position;if(b){if(b.split)b=new SLICK.Geo.Position(b)}else b=new SLICK.Geo.Position;var d={min:a,max:b,copy:function(f){d.min.copy(f.min);d.max.copy(f.max)},
clear:function(){d.min.clear();d.max.clear()},expand:function(f){d.min.lat-=f;d.min.lon-=c.Utilities.normalizeLon(f);d.max.lat+=f;d.max.lon+=c.Utilities.normalizeLon(f)},getDistance:function(){return new c.Distance(d.min,d.max)},getCenter:function(){var f=c.calculateBoundsSize(d.min,d.max);return new SLICK.Geo.Position(d.min.lat+f.y*0.5,d.min.lon+f.x*0.5)},isEmpty:function(){return d.min.isEmpty()||d.max.isEmpty()},transform:function(f){var h=new SLICK.Geo.BoundingBox(d.min,d.max);GRUNT.Log.info("applying "+
f.length+" transformers");for(var i=0;f&&i<f.length;i++)f[i].apply(h);return h},toString:function(){return String.format("({0}, {1})",d.min,d.max)}};return d},Transforms:function(){return{Shrink:function(){return function(){}},Offset:function(){return function(){}}}}(),Address:function(a){a=GRUNT.extend({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},a);return{getPos:function(){return a.pos},toString:function(){return a.streetDetails+" "+a.location}}},Landmark:function(){},
Utilities:function(){var a={lat2pix:function(b,d){var f=parseFloat(b)*2*Math.PI/360;f=Math.sin(f);var h=0.08181919084262157*f;return Math.log((1+f)/(1-f)*Math.pow((1-h)/(1+h),0.08181919084262157))/2/d},lon2pix:function(b,d){return parseFloat(b)/180*Math.PI/d},pix2lon:function(b,d){return a.normalizeLon(b*d*180/Math.PI)},pix2lat:function(b,d){for(var f=Math.pow(Math.E,-b*d),h=a.mercatorUnproject(f),i=a.findRadPhi(h,f),k=0;k<12&&Math.abs(h-i)>1.0E-7;){h=i;i=a.findRadPhi(h,f);k++}return i*180/Math.PI},
mercatorUnproject:function(b){return Math.PI/2-2*Math.atan(b)},findRadPhi:function(b,d){var f=0.08181919084262157*Math.sin(b);return Math.PI/2-2*Math.atan(d*Math.pow((1-f)/(1+f),0.040909595421310785))},normalizeLon:function(b){for(;b<-180;)b+=360;for(;b>180;)b-=360;return b}};return a}(),GeocodingAgent:function(a){a=GRUNT.extend({name:"Geocoding Search Agent",paramTranslator:null,execute:function(b,d){try{if(a.paramTranslator)b=a.paramTranslator(b);if(!b.reverse&&!b.freeform)address=new c.Address(b);
var f=c.getEngine("geocode");if(f)f.geocode({addresses:[b.freeform?b.freeform:address],complete:function(i,k){d&&d(k,a)}})}catch(h){GRUNT.Log.exception(h)}}},a);return SLICK.Dispatcher.createAgent(a)},PointOfInterest:function(a){a=GRUNT.extend({id:0,title:"",pos:null,lat:"",lon:"",group:"",retrieved:0,isNew:true},a);if(!a.pos&&a.lat&&a.lon)a.pos=new SLICK.Geo.Position(a.lat,a.lon);return GRUNT.extend({toString:function(){return a.id+": '"+a.title+"'"}},a)},POIStorage:function(a){function b(k){k=k?
k:"default";f[k]||(f[k]=[]);return f[k]}function d(k){var l=[];for(var j in f)for(var m=0;m<f[j].length;m++)if(!k||k(f[j][m]))l.push(f[j][m]);return l}a=GRUNT.extend({visibilityChange:null,onPOIDeleted:null,onPOIAdded:null},a);var f={},h=true,i={id:GRUNT.generateObjectID(),getPOIs:function(){return d()},getOldPOIs:function(k,l){return d(function(j){return j.group==k&&j.retrieved<l})},getVisible:function(){return h},setVisible:function(k){if(k!=h){h=k;a.visibilityChange&&a.visibilityChange()}},findById:function(k){var l=
d(function(j){return j.id==k});return l.length>0?l[0]:null},findByBounds:function(k){return d(function(l){return SLICK.Geo.posInBounds(l.pos,k)})},addPOIs:function(k,l){if(l)f={};for(var j=0;k&&j<k.length;j++){k[j].retrieved=SLICK.Clock.getTime(true);var m=k[j];b(m.group).push(m)}},update:function(k){var l=[],j=0,m=k.length>0?k[0].group:"",p=SLICK.Clock.getTime(true);for(j=0;j<k.length;j++){var o;a:{if(o=k[j])for(var q=b(o.group),r=0;r<q.length;r++)if(q[r].id==o.id){o=q[r];break a}o=null}if(o){o.retrieved=
p;o.isNew=false}else l.push(k[j])}k=i.getOldPOIs(m,p);i.addPOIs(l);for(j=0;a.onPOIAdded&&j<l.length;j++)a.onPOIAdded(l[j]);for(j=0;j<k.length;j++){a.onPOIDeleted&&a.onPOIDeleted(k[j]);m=k[j];p=b(m.group);for(o=0;o<p.length;o++)if(p[o].id==m.id){p.splice(o,1);break}}l.length+k.length>0&&GRUNT.WaterCooler.say("geo.pois-updated",{srcID:i.id,pois:i.getPOIs()})}};return i},MapProvider:function(){return{zoomLevel:0,checkZoomLevel:function(a){return a},getCopyright:function(){},getMapTiles:function(){},
getPositionForXY:function(){return null}}},posInBounds:function(a,b){var d=!(a.isEmpty()||b.isEmpty());return d=(d=d&&a.lat>=b.min.lat&&a.lat<=b.max.lat)&&a.lon>=b.min.lon&&a.lon<=b.max.lon},calculateBoundsSize:function(a,b,d){var f=new SLICK.Vector(0,b.lat-a.lat);if(typeof d==="undefined")d=true;f.x=d&&a.lon>b.lon?360-a.lon+b.lon:b.lon-a.lon;return f},getBoundingBoxZoomLevel:function(a,b){var d=a.getCenter(),f=Math.min(Math.round(Math.abs(d.lat)*0.05),g.length),h=g[f],i=c.calculateBoundsSize(a.min,
a.max),k=Math.ceil(Math.log(g[3]*b.height/i.y)/Math.log(2));h=Math.ceil(Math.log(h*b.width/i.x)/Math.log(2));GRUNT.Log.info("constant index for bbox: "+a+" (center = "+d+") is "+f);GRUNT.Log.info("distances  = "+i);GRUNT.Log.info("optimal zoom levels: height = "+k+", width = "+h);return Math.min(k,h)},getBoundsForPositions:function(a,b){var d=null;b||(b="auto");for(var f=0;f<a.length;f++)if(d){var h=c.calculateBoundsSize(d.min,a[f],false),i=c.calculateBoundsSize(a[f],d.max,false);if(h.x<0)d.min.lon=
a[f].lon;if(h.y<0)d.min.lat=a[f].lat;if(i.x<0)d.max.lon=a[f].lon;if(i.y<0)d.max.lat=a[f].lat}else d=new SLICK.Geo.BoundingBox(a[f].duplicate(),a[f].duplicate());if(b){if(b=="auto"){f=c.calculateBoundsSize(d.min,d.max);b=Math.max(f.x,f.y)*0.3}d.expand(b)}return d}};return c}();
SLICK.Mapping=function(){var n={AnnotationTween:null,GeoTileGrid:function(g){g=GRUNT.extend({grid:null,centerPos:new SLICK.Geo.Position,centerXY:new SLICK.Vector,radsPerPixel:0},g);var e=g.centerPos.getMercatorPixels(g.radsPerPixel),c=new SLICK.Vector(e.x-g.centerXY.x,e.y-g.centerXY.y),a=GRUNT.extend({},g.grid,{getBoundingBox:function(b,d,f,h){return new SLICK.Geo.BoundingBox(a.pixelsToPos(new SLICK.Vector(b,d+h)),a.pixelsToPos(new SLICK.Vector(b+f,d)))},getCenterOffset:function(){return g.centerXY},
getGridXYForPosition:function(b){var d=b.getMercatorPixels(g.radsPerPixel);b=d.x-c.x;d=a.getDimensions().height-(d.y-c.y);return new SLICK.Vector(b,d)},pixelsToPos:function(b){var d=new SLICK.Geo.Position,f=c.x+b.x;b=c.y+a.getDimensions().height-b.y;d.setMercatorPixels(f,b,g.radsPerPixel);return d}});return a},POIViewLayer:function(g){GRUNT.extend({},g)},Overlay:function(g){GRUNT.extend({},g);return{}},RadarOverlay:function(g){g=GRUNT.extend({radarFill:"rgba(0, 221, 238, 0.1)",radarStroke:"rgba(0, 102, 136, 0.3)"},
g);return new SLICK.Graphics.ViewLayer(GRUNT.extend({zindex:100,draw:function(e){var c=e.dimensions.width*0.5,a=e.dimensions.height*0.5;e.context.fillStyle=g.radarFill;e.context.strokeStyle=g.radarStroke;e.context.beginPath();e.context.arc(c,a,50,0,Math.PI*2,false);e.context.fill();e.context.stroke()}},g))},CrosshairOverlay:function(g){g=GRUNT.extend({lineWidth:1.5,strokeStyle:"rgba(0, 0, 0, 0.5)",size:15,canCache:false},g);return new SLICK.Graphics.ViewLayer(GRUNT.extend({zindex:110,draw:function(e){var c=
e.dimensions.getCenter();e.context.lineWidth=g.lineWidth;e.context.strokeStyle=g.strokeStyle;e=e.context;var a=g.size;e.beginPath();e.moveTo(c.x,c.y-a);e.lineTo(c.x,c.y+a);e.moveTo(c.x-a,c.y);e.lineTo(c.x+a,c.y);e.arc(c.x,c.y,a*0.6666,0,2*Math.PI,false);e.stroke()}},g))},RouteOverlay:function(g){g=GRUNT.extend({strokeStyles:["rgba(0, 51, 119, 0.9)"],waypointFillStyle:"#FFFFFF",lineWidths:[4],data:null,pixelGeneralization:8,canCache:true,zindex:50},g);var e=[],c=[],a=new SLICK.Graphics.ViewLayer(GRUNT.extend({draw:function(b){var d;
if(e.length>0)for(var f=0;f<g.strokeStyles.length;f++){b.context.strokeStyle=g.strokeStyles[f];b.context.lineWidth=g.lineWidths[f];b.context.beginPath();b.context.moveTo(e[0].x-b.offset.x,e[0].y-b.offset.y);for(d=1;d<e.length;d++)b.context.lineTo(e[d].x-b.offset.x,e[d].y-b.offset.y);b.context.stroke()}b.context.fillStyle=g.waypointFillStyle;for(d=0;d<c.length;d++){b.context.beginPath();b.context.arc(c[d].x-b.offset.x,c[d].y-b.offset.y,2,0,Math.PI*2,false);b.context.stroke();b.context.fill()}}},g));
return GRUNT.extend(a,{getAnimation:function(b,d,f){return new SLICK.Graphics.AnimatedPathLayer({path:e,zindex:g.zindex+1,easing:b?b:SLICK.Animation.Easing.Sine.InOut,duration:d?d:5E3,drawIndicator:f})},calcCoordinates:function(b){e=[];c=[];var d,f,h=null,i,k=g.data?g.data.getGeometry():[],l=g.data?g.data.getInstructions():[];for(d=0;d<k.length;d++){f=b.getGridXYForPosition(k[d]);if(i=!h||d==k.length-1||Math.abs(f.x-h.x)+Math.abs(f.y-h.y)>g.pixelGeneralization){e.push(f);h=f}}h=null;for(d=0;d<l.length;d++)if(l[d].position){f=
b.getGridXYForPosition(l[d].position);if(i=!h||d==l.length-1||Math.abs(f.x-h.x)+Math.abs(f.y-h.y)>g.pixelGeneralization){c.push(f);h=f}}GRUNT.Log.info("geometry = "+k.length+", coordinates = "+e.length+", instructions = "+c.length)}})},Annotation:function(g){g=GRUNT.extend({xy:null,pos:null,draw:null,tweenIn:n.AnnotationTween},g);var e=false,c={xy:g.xy,pos:g.pos,isNew:false,isAnimating:function(){return e},draw:function(a){if(c.xy){if(c.isNew&&g.tweenIn){var b=c.xy.y;c.xy.y=a.offset.y-20;e=true;SLICK.Animation.tween(c.xy,
"y",b,g.tweenIn,function(){c.xy.y=b;e=false},250+Math.random()*500)}if(g.draw)g.draw(a,new SLICK.Vector(c.xy.x-a.offset.x,c.xy.y-a.offset.y));else{a.context.beginPath();a.context.arc(c.xy.x-a.offset.x,c.xy.y-a.offset.y,4,0,Math.PI*2,false);a.context.fill()}c.isNew=false}}};return c},ImageAnnotation:function(g){g=GRUNT.extend({imageUrl:null},g);var e=null,c=new SLICK.Vector;g.draw=function(a,b){if(e){var d=b.offset(c.x,c.y);a.context.drawImage(e,d.x,d.y,e.width,e.height)}};SLICK.Resources.loadImage(g.imageUrl,
function(a){if(e=a){c.x=-e.width*0.5;c.y=-e.height*0.5}});return new n.Annotation(g)},AnnotationsOverlay:function(g){function e(h){for(var i=g.map?g.map.getTileLayer():null,k=0;i&&k<h.length;k++)h[k].xy=i.getGridXYForPosition(h[k].pos)}g=GRUNT.extend({pois:null,map:null,createAnnotationForPOI:null,canCache:true},g);var c=[],a=false,b=[],d=new SLICK.Graphics.ViewLayer(GRUNT.extend({zindex:100,draw:function(h){var i;a=false;h.context.fillStyle="rgba(255, 0, 0, 0.75)";for(i=0;i<c.length;i++){c[i].draw(h);
a=a||c[i].isAnimating()}for(i=0;i<b.length;i++){b[i].draw(h);a=a||c[i].isAnimating()}a&&f.layerChanged()}},g)),f=GRUNT.extend(d,{add:function(h){b.push(h);e(b)},calcCoordinates:function(){e(c);e(b)},isAnimating:function(){return a}});GRUNT.WaterCooler.listen("geo.pois-updated",function(h){if(g.pois&&g.pois.id==h.srcID){h=h.pois;try{c=[];for(var i=0;i<h.length;i++)if(h[i].pos){var k;var l=h[i];if(l&&l.pos){var j=null;if(j=g.createAnnotationForPOI?g.createAnnotationForPOI(l):new n.Annotation({pos:l.pos})){j.isNew=
l.isNew;l.isNew=false}k=j}else k=void 0;k&&c.push(k)}e(c)}catch(m){GRUNT.Log.exception(m)}f.layerChanged()}});return f},Tiler:function(g){g=GRUNT.extend({tapExtent:10,provider:null,crosshair:false,zoomLevel:0,boundsChange:null,boundsChangeThreshold:30,pois:new SLICK.Geo.POIStorage,createAnnotationForPOI:null},g);var e=new SLICK.Vector,c=null,a=g.provider?g.provider.getCopyright():"",b=false,d=g.zoomLevel;if(!g.provider)g.provider=new SLICK.Geo.MapProvider;var f=g.panHandler,h=g.tapHandler,i={};g.onPan=
function(j,m){f&&f(j,m)};g.tapHandler=function(j,m){var p=l.getTileLayer(),o=null;if(p){var q=l.viewPixToGridPix(new SLICK.Vector(m.x,m.y));o=p.pixelsToPos(q.offset(-g.tapExtent,g.tapExtent));p=p.pixelsToPos(q.offset(g.tapExtent,-g.tapExtent));o=new SLICK.Geo.BoundingBox(o.toString(),p.toString())}h&&h(j,m,o)};g.doubleTapHandler=function(j,m){var p=l.getTileLayer();if(p){var o=l.viewPixToGridPix(new SLICK.Vector(m.x,m.y));l.gotoPosition(p.pixelsToPos(o),d+1)}};g.onScale=function(j){var m=0;j=Math.sqrt(j);
if(j<1)m=-(1/j);else if(j>1)m=j;var p=l.getDimensions();if(j=l.getTileLayer()){p=l.viewPixToGridPix(new SLICK.Vector(p.width*0.5,p.height*0.5));c=j.pixelsToPos(p)}l.gotoPosition(c,d+Math.round(m))};g.onDraw=function(j){var m=l.getTileLayer();for(var p in i)if(i[p]&&m){var o=l.gridPixToViewPix(m.getGridXYForPosition(i[p].poi.pos));i[p].drawToContext(j.context,o.x,o.y)}};var k=new SLICK.Tiling.Tiler(g);k.registerLayerListener(function(j,m,p){if(p){p.calcCoordinates&&p.calcCoordinates(l.getTileLayer());
if(/grid\d+/.test(m))if(j=="add"||j=="offset-changed")l.eachLayer(function(o){o.calcCoordinates&&o.calcCoordinates(p)});else j=="load"&&l.setDisplayStatus(SLICK.Graphics.DisplayState.ACTIVE)}else l.eachLayer(function(o){o.calcCoordinates&&o.calcCoordinates(l.getTileLayer())})});var l=GRUNT.extend({},k,{pois:g.pois,getBoundingBox:function(){var j=new SLICK.Geo.BoundingBox,m=l.getTileLayer(),p=l.getOffset(),o=l.getDimensions();if(m)j=m.getBoundingBox(p.x,p.y,o.width,o.height);return j},getCenterPosition:function(){return c},
gotoBounds:function(j,m){var p=SLICK.Geo.getBoundingBoxZoomLevel(j,l.getDimensions());GRUNT.Log.info("BOUNDS CHANGE REQUIRED CENTER: "+j.getCenter()+", ZOOM LEVEL: "+p);l.gotoPosition(j.getCenter(),p,m)},gotoPosition:function(j,m,p){var o=d;d=m?m:d;if(!d)throw"Zoom level required to goto a position.";if(g.provider)d=g.provider.checkZoomLevel(d);if(!b||d!=o){SLICK.Animation.cancel();if(b){l.setDisplayStatus(SLICK.Graphics.DisplayState.FROZEN);l.panToPosition(j);l.newTileLayer()}g.provider.zoomLevel=
d;g.provider.getMapTiles(l,j,function(q){l.setTileLayer(q);l.panToPosition(j,p);c=j});b=true}else l.panToPosition(j,p)},panToPosition:function(j,m,p){var o=l.getTileLayer();if(o){j=o.getGridXYForPosition(j);o=l.getDimensions();j.x-=o.width*0.5;j.y-=o.height*0.5;l.updateOffset(j.x,j.y,p);g.boundsChange&&g.boundsChange(l.getBoundingBox());m&&m(l)}},setZoomLevel:function(j){l.gotoPosition(l.getCenterPosition(),j)},zoomIn:function(){l.setZoomLevel(d+1)},zoomOut:function(){l.setZoomLevel(d-1)},addPOI:function(j){var m=
l.getTileLayer();if(m&&j&&j.id&&j.pos)i[j.id]=new SLICK.Geo.POIPin({poi:j});else throw Error("Unable to add POI: "+(m?"Insufficient POI details":"Mapping Grid not defined"));},removePOI:function(j){if(j&&j.id)i[j.id]=null},animateRoute:function(j,m,p){var o=l.getLayer("route");o&&o.getAnimation(j,m,p).addToView(l)}},k);k=new SLICK.Mapping.AnnotationsOverlay({pois:l.pois,map:l,createAnnotationForPOI:g.createAnnotationForPOI});l.setLayer("annotations",k);g.crosshair&&l.setLayer("crosshair",new SLICK.Mapping.CrosshairOverlay);
a&&l.setLayer("copyright",new SLICK.Graphics.ViewLayer({zindex:999,canCache:false,draw:function(j){j.context.lineWidth=2.5;j.context.fillStyle="rgb(50, 50, 50)";j.context.strokeStyle="rgba(255, 255, 255, 0.8)";j.context.font="bold 10px sans";j.context.textBaseline="bottom";j.context.strokeText(a,10,j.dimensions.height-10);j.context.fillText(a,10,j.dimensions.height-10)}}));GRUNT.WaterCooler.listen("view-idle",function(j){if(j.id&&j.id==l.id)if(e.diff(l.getOffset()).getAbsSize()>g.boundsChangeThreshold&&
g.boundsChange){e=l.getOffset();g.boundsChange(l.getBoundingBox())}});return l}};return n}();
SLICK.Geo.Routing=function(){var n={calculate:function(g){g=GRUNT.extend({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null},g);GRUNT.Log.info("attempting to calculate route");var e=SLICK.Geo.getEngine("route");e&&e.route(g,function(c){if(g.map){var a=g.map,b=a.getDimensions();b=new SLICK.Mapping.RouteOverlay({data:c,width:b.width,height:b.height});a.setLayer("route",b);if(g.autoFit){GRUNT.Log.info("AUTOFITTING MAP TO ROUTE: bounds = "+c.getBoundingBox());g.map.gotoBounds(c.getBoundingBox())}}g.success&&
g.success(c)})},Maneuver:{None:0,Continue:1,TurnLeft:100,TurnLeftSlight:101,TurnLeftSharp:102,TurnRight:110,TurnRightSlight:111,TurnRightSharp:112,TurnAround:190,EnterRoundabout:200,ExitRamp:300},Instruction:function(g){g=GRUNT.extend({position:null,description:"",manuever:n.Maneuver.None},g);return{position:g.position,getDescription:function(){return g.description}}},RouteData:function(g){g=GRUNT.extend({geometry:[],instructions:[],boundingBox:null},g);for(var e=Array(g.geometry.length),c=g.boundingBox,
a=0;a<g.geometry.length;a++)e[a]=new SLICK.Geo.Position(g.geometry[a]);c||(c=SLICK.Geo.getBoundsForPositions(e));return{getGeometry:function(){return e},getBoundingBox:function(){return c},getInstructions:function(){return g.instructions}}}};return n}();
