if(!this.JSON)this.JSON={};
(function(){function o(a){return a<10?"0"+a:a}function f(a){k.lastIndex=0;return k.test(a)?'"'+a.replace(k,function(g){var l=b[g];return typeof l==="string"?l:"\\u"+("0000"+g.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function j(a,g){var l,i,m,n,p=d,q,r=g[a];if(r&&typeof r==="object"&&typeof r.toJSON==="function")r=r.toJSON(a);if(typeof h==="function")r=h.call(g,a,r);switch(typeof r){case "string":return f(r);case "number":return isFinite(r)?String(r):"null";case "boolean":case "null":return String(r);
case "object":if(!r)return"null";d+=c;q=[];if(Object.prototype.toString.apply(r)==="[object Array]"){n=r.length;for(l=0;l<n;l+=1)q[l]=j(l,r)||"null";m=q.length===0?"[]":d?"[\n"+d+q.join(",\n"+d)+"\n"+p+"]":"["+q.join(",")+"]";d=p;return m}if(h&&typeof h==="object"){n=h.length;for(l=0;l<n;l+=1){i=h[l];if(typeof i==="string")if(m=j(i,r))q.push(f(i)+(d?": ":":")+m)}}else for(i in r)if(Object.hasOwnProperty.call(r,i))if(m=j(i,r))q.push(f(i)+(d?": ":":")+m);m=q.length===0?"{}":d?"{\n"+d+q.join(",\n"+d)+
"\n"+p+"}":"{"+q.join(",")+"}";d=p;return m}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+o(this.getUTCMonth()+1)+"-"+o(this.getUTCDate())+"T"+o(this.getUTCHours())+":"+o(this.getUTCMinutes())+":"+o(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
k=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,d,c,b={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},h;if(typeof JSON.stringify!=="function")JSON.stringify=function(a,g,l){var i;c=d="";if(typeof l==="number")for(i=0;i<l;i+=1)c+=" ";else if(typeof l==="string")c=l;if((h=g)&&typeof g!=="function"&&(typeof g!=="object"||typeof g.length!=="number"))throw Error("JSON.stringify");return j("",
{"":a})};if(typeof JSON.parse!=="function")JSON.parse=function(a,g){function l(m,n){var p,q,r=m[n];if(r&&typeof r==="object")for(p in r)if(Object.hasOwnProperty.call(r,p)){q=l(r,p);if(q!==undefined)r[p]=q;else delete r[p]}return g.call(m,n,r)}var i;a=String(a);e.lastIndex=0;if(e.test(a))a=a.replace(e,function(m){return"\\u"+("0000"+m.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){i=eval("("+a+")");return typeof g==="function"?l({"":i},""):i}throw new SyntaxError("JSON.parse");}})();if(!String.format)String.format=function(o){if(arguments.length<=1)return o;for(var f=arguments.length-2,j=0;j<=f;j++)o=o.replace(RegExp("\\{"+j+"\\}","gi"),arguments[j+1]);return o};
String.prototype.containsWord=function(o){var f="";if(o.toString)o=o.toString();for(var j=0;j<o.length;j++)f+=!/\w/.test(o[j])?"\\"+o[j]:o[j];return RegExp("(^|\\s|\\,)"+f+"(\\,|\\s|$)","i").test(this)};Number.prototype.toRad=function(){return this*Math.PI/180};Number.prototype.sec=function(){return 1/Math.cos(this)};
GRUNT=function(){var o=Object.prototype.hasOwnProperty,f=0,j={id:"GRUNT.core",extend:function(){var e=arguments[0]||{},k=1,d=arguments.length,c=false,b,h,a,g;if(typeof e==="boolean"){c=e;e=arguments[1]||{};k=2}if(typeof e!=="object"&&!j.isFunction(e))e={};if(d===k){e=this;--k}for(;k<d;k++)if((b=arguments[k])!=null)for(h in b){a=e[h];g=b[h];if(e!==g)if(c&&g&&(j.isPlainObject(g)||j.isArray(g))){a=a&&(j.isPlainObject(a)||j.isArray(a))?a:j.isArray(g)?[]:{};e[h]=j.extend(c,a,g)}else if(g!==undefined)e[h]=
g}return e},isFunction:function(e){return toString.call(e)==="[object Function]"},isArray:function(e){return toString.call(e)==="[object Array]"},isPlainObject:function(e){if(!e||toString.call(e)!=="[object Object]"||e.nodeType||e.setInterval)return false;if(e.constructor&&!o.call(e,"constructor")&&!o.call(e.constructor.prototype,"isPrototypeOf"))return false;var k;for(k in e);return k===undefined||o.call(e,k)},isEmptyObject:function(e){for(var k in e)return false;return true},isXmlDocument:function(e){return toString.call(e)===
"[object Document]"},contains:function(e,k){var d=e,c=arguments,b=1;if(k&&j.isArray(k)){c=k;b=0}for(b=b;b<c;b++)d=d&&typeof foo[c[b]]!=="undefined";return d},newModule:function(e){e=j.extend({id:null,requires:[],parent:null},e);if(e.parent)e=j.extend({},e.parent,e);return e},toID:function(e){return e.replace(/\s/g,"-")},generateObjectID:function(e){return(e?e:"obj")+f++}};return j}();
GRUNT.Log=function(){function o(d,c){var b,h=c&&c.length>0?c[0]:"";for(b=1;c&&b<c.length;b++)h+=" "+(j&&GRUNT.isPlainObject(c[b])?JSON.stringify(c[b]):c[b]);typeof console!=="undefined"&&console[d](h);for(b=0;b<f.length;b++)f[b].call(k,h,d)}var f=[],j=typeof JSON!=="undefined",e=window.console&&window.console.markTimeline,k={id:"GRUNT.log",getTraceTicks:function(){return e?(new Date).getTime():null},trace:function(d,c){if(e)console.markTimeline(d+(c?": "+(k.getTraceTicks()-c)+"ms":""))},debug:function(){o("debug",
arguments)},info:function(){o("info",arguments)},warn:function(){o("warn",arguments)},error:function(){o("error",arguments)},exception:function(d){k.error(arguments);for(var c in d)k.info("ERROR DETAIL: "+c+": "+d[c])},watch:function(d,c){try{c()}catch(b){k.exception(b,d)}},throwError:function(d){k.error(d);throw Error(d);},requestUpdates:function(d){f.push(d)}};return k}();
GRUNT.Data=function(){var o={determineObjectMapping:function(j){if(!j)return null;j=j.split("|");for(var e={},k=0;k<j.length;k++)e[j[k]]=k;return e},mapLineToObject:function(j,e){var k=j.split("|"),d={};for(var c in e){var b=e[c];d[c]=k.length>b?k[b]:null}return d},parse:function(j){var e=null,k=[];j=j.split("\n");for(var d=0;d<j.length;d++){var c=j[d];if(e)k.push(o.mapLineToObject(c,e));else e=o.determineObjectMapping(c)}return k}},f={supportedFormats:{JSON:{parse:function(j){return JSON.parse(j)}},
PDON:{parse:function(j){return o.parse(j)}}},parse:function(j){j=GRUNT.extend({data:"",format:"JSON"},j);if(!f.supportedFormats[j.format])throw Error("Unsupported data format: "+j.format+", cannot parse data in javascript object");try{return f.supportedFormats[j.format].parse(j.data)}catch(e){GRUNT.Log.error("ERROR PARSING DATA FROM FORMAT: "+j.format,j.data);GRUNT.Log.exception(e)}return{}}};return f}();
GRUNT.Template=function(){var o=/\$\{(.*?)\}/ig;return{parse:function(f,j){for(var e=f,k=o.exec(e);k;){e=e.replace(k[0],GRUNT.XPath.first(k[1],j));o.lastIndex=0;k=o.exec(e)}return e}}}();
GRUNT.JSONP=function(){function o(k){var d=document.createElement("script"),c=false;d.src=k;d.async=true;d.onload=d.onreadystatechange=function(){if(!c&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){c=true;d.onload=d.onreadystatechange=null;d&&d.parentNode&&d.parentNode.removeChild(d)}};j||(j=document.getElementsByTagName("head")[0]);j.appendChild(d)}var f=0,j,e=this;return{get:function(k,d){k+=k.indexOf("?")>=0?"&":"?";var c="json"+ ++f;e[c]=function(b){d(b);e[c]=
null;try{delete e[c]}catch(h){}};o(k+"callback="+c);return c}}}();
GRUNT.XHR=function(){var o={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},f={JSON:["json"],PDON:["pdon.txt"]},j=["TEXT","STREAM"],e=/^(\w+:)?\/\/([^\/?#]+)/,k={XML:function(b){return b.responseXML},JSON:function(b){try{return JSON.parse(b.responseText)}catch(h){GRUNT.Log.error("Error parsing JSON data: ",b.responseText);GRUNT.Log.exception(h)}return""},PDON:function(b){return GRUNT.Data.parse({data:b.responseText,format:"PDON"})},DEFAULT:function(b){return b.responseText}},
d={CONTENT_TYPE:"Content-Type"},c=GRUNT.newModule({id:"GRUNT.xhr",ajaxSettings:{xhr:null},ajax:function(b){try{b=GRUNT.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},c.ajaxSettings,b);var h=e.exec(b.url),a=h&&(h[1]&&h[1]!==location.protocol||h[2]!==location.host);if(b.data)b.method="POST";if(b.url){h=null;if(b.xhr)h=b.xhr(b);h||(h=new XMLHttpRequest);h.open(b.method,b.url,b.async);b.data&&h.setRequestHeader("Content-Type",
b.contentType);a||h.setRequestHeader("X-Requested-With","XMLHttpRequest");h.onreadystatechange=function(){if(this.readyState===4){var l=null,i=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(i)if(b.handleResponse)b.handleResponse(this);else{var m=b,n=this.getResponseHeader(d.CONTENT_TYPE),p,q=false;for(p in o)if(n&&n.indexOf(o[p])>=0){q=true;break}n=!q;for(q=0;q<j.length;q++)n=n||j[q]==p;if(n)b:{n=p;for(var r in f)for(q=
0;q<f[r].length;q++)if(RegExp(f[r][q]+"$","i").test(m.url)){p=r;break b}p=n?n:"DEFAULT"}try{l=k[p](this,m)}catch(t){GRUNT.Log.warn("error applying processor '"+p+"' to response type, falling back to default");l=k.DEFAULT(this,m)}}else b.error&&b.error(this)}catch(A){GRUNT.Log.exception(A,"PROCESSING AJAX RESPONSE")}i&&l&&b.success&&b.success.call(this,l)}};h.send(b.method=="POST"?c.param(b.data):null)}else GRUNT.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(g){GRUNT.Log.exception(g)}},
param:function(b){var h=[],a=function(l,i){i=GRUNT.isFunction(i)?i():i;h[h.length]=encodeURIComponent(l)+"="+encodeURIComponent(i)};if(GRUNT.isArray(b))for(var g=0;g<b.length;g++)a(b[g].name,b[g].value);else for(g in b)a(g,b[g]);return h.join("&").replace(/%20/g,"+")}});return c}();
GRUNT.XPath=function(){function o(k){for(var d=null,c=0;c<f.length;c++)if(d=f[c](k))break;return d}var f=[],j=[null,function(k){return k.numberValue},function(k){return k.stringValue},function(k){return k.booleanValue},null,null,null,null,function(k){return k.singleNodeValue?k.singleNodeValue.textContent:null},function(k){return k.singleNodeValue?k.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||GRUNT.Log.warn("No XPATH support, this is going to cause problems");var e={SearchResult:function(k){return{toString:function(){var d=
null;if(k){var c=null;if(k.resultType>=0&&k.resultType<j.length)c=j[k.resultType];if(c){GRUNT.Log.info("invoking match handler for result type: "+k.resultType);d=c(k)}}return d?d:""}}},first:function(k,d){var c=e.SearchResult,b;var h=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!h)h=XPathResult.ANY_TYPE;try{if(GRUNT.isXmlDocument(d))b=d.evaluate(k,d,o,h,null);else{GRUNT.Log.warn("attempted xpath expression: "+k+" on a non-xml document");b=null}}catch(a){GRUNT.Log.warn("attempted to run invalid xpath expression: "+
k+" on node: "+d);b=null}return new c(b)},registerResolver:function(k){f.push(k)}};return e}();GRUNT.WaterCooler=function(){var o={};return{listen:function(f,j){o[f]||(o[f]=[]);j&&o[f].push(j)},say:function(f,j){if(o[f])for(var e=0;e<o[f].length;e++)o[f][e](j)},leave:function(){}}}();
SLICK=function(){function o(){f={base:{name:"Unknown",eventTarget:document,supportsTouch:"createTouch"in document,getScaling:function(){return 1}},iphone:{name:"iPhone",regex:/iphone/i},android:{name:"Android OS <= 2.1",regex:/android/i,eventTarget:document.body,supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio}},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true}};j=[f.iphone,f.froyo,f.android]}var f=null,j=[],e=null,k={getDeviceConfig:function(){f||
o();if(!e){GRUNT.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var d=0;d<j.length;d++){var c=j[d];if(c.regex&&c.regex.test(navigator.userAgent)){e=GRUNT.extend({},f.base,c);GRUNT.Log.info("PLATFORM DETECTED AS: "+e.name);break}}if(!e){GRUNT.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");e=f.base}GRUNT.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return e},Settings:function(){var d={};return{get:function(c){return d[c]},
set:function(c,b){d[c]=b},extend:function(c){GRUNT.extend(d,c)}}}(),Clock:function(){var d=null;return{getTime:function(c){return c&&d?d:d=(new Date).getTime()}}}(),Vector:function(d,c){d||(d=0);c||(c=0);var b={x:d,y:c,add:function(h){b.x+=h.x;b.y+=h.y;return b},diff:function(h){return new SLICK.Vector(b.x-h.x,b.y-h.y)},copy:function(h){b.x=h.x;b.y=h.y},empty:function(){b.x=0;b.y=0},duplicate:function(){return new SLICK.Vector(b.x,b.y)},getAbsSize:function(){return Math.max(Math.abs(b.x),Math.abs(b.y))},
offset:function(h,a){return new SLICK.Vector(b.x+h,b.y+a)},invert:function(){return new SLICK.Vector(-b.x,-b.y)},matches:function(h){return h&&b.x==h.x&&b.y==h.y},toString:function(){return b.x+", "+b.y}};return b},VectorArray:function(d,c){for(var b=Array(d.length),h=d.length;h--;)b[h]=c?d[h].duplicate():d[h];return{applyOffset:function(a){for(var g=b.length;g--;)b[g].add(a)},getRect:function(){return new SLICK.Rect(Math.min(b[0].x,b[1].x),Math.min(b[0].y,b[1].y),Math.abs(b[0].x-b[1].x),Math.abs(b[0].y-
b[1].y))},toString:function(){for(var a="",g=b.length;g--;)a+="["+b[g].toString()+"] ";return a}}},VectorMath:function(){function d(c){if(!c||c.length<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var b={edges:Array(c.length-1),accrued:Array(c.length-1),total:0},h=0;h<c.length-1;h++){var a=c[h].diff(c[h+1]);b.edges[h]=Math.sqrt(a.x*a.x+a.y*a.y);b.accrued[h]=b.total+b.edges[h];b.total+=b.edges[h]}return b}return{edges:d,distance:function(c){return d(c).total},
theta:function(c,b,h){h=Math.asin((c.y-b.y)/h);return c.x>b.x?h:Math.PI-h},pointOnEdge:function(c,b,h,a){b=new SLICK.Vector(Math.cos(h)*a,Math.sin(h)*a);return new SLICK.Vector(c.x-b.x,c.y-b.y)}}}(),Dimensions:function(d,c){var b=c?d/c:1,h={width:d,height:c,aspect_ratio:b,inv_aspect_ratio:1/b,duplicate:function(){return new SLICK.Dimensions(h.width,h.height)},getAspectRatio:function(){return h.height!==0?h.width/h.height:1},getCenter:function(){return new SLICK.Vector(h.width>>1,h.height>>1)},grow:function(a,
g){return new SLICK.Dimensions(h.width+a,h.height+g)},matches:function(a){return a&&h.width==a.width&&h.height==a.height},toString:function(){return h.width+" x "+h.height}};return h},Rect:function(d,c,b,h){var a={origin:new SLICK.Vector(d,c),dimensions:new SLICK.Dimensions(b,h),duplicate:function(){return new SLICK.Rect(a.origin.x,a.origin.y,a.dimensions.width,a.dimensions.height)},getCenter:function(){return new SLICK.Vector(a.origin.x+(a.dimensions.width>>1),a.origin.y+(a.dimensions.height>>1))},
getSize:function(){return Math.sqrt(Math.pow(a.dimensions.width,2)+Math.pow(a.dimensions.height,2))},grow:function(g,l){var i=new SLICK.Dimensions(g-a.dimensions.width,l-a.dimensions.height);a.dimensions.width=g;a.dimensions.height=l;return i},expand:function(g,l){a.origin.x-=g;a.origin.y-=l;a.dimensions.width+=g;a.dimensions.height+=l},offset:function(g){return new k.Rect(a.origin.x+g.x,a.origin.y+g.y,a.dimensions.width,a.dimensions.height)},getRequiredDelta:function(g,l){var i={top:0,left:0,bottom:0,
right:0};i.top=g.origin.y-a.origin.y+(l?l.y:0);i.left=g.origin.x-a.origin.x+(l?l.x:0);i.right=g.origin.x+g.dimensions.width-(a.origin.x+a.dimensions.width)-i.left;i.bottom=g.origin.y+g.dimensions.height-(a.origin.y+a.dimensions.height)-i.top;return i},applyDelta:function(g,l,i){if(!g||!GRUNT.contains(g,["top","left","bottom","right"]))throw Error("Invalid delta - cannot apply to SLICK.Rect");l||(l=1);a.origin.x+=g.left*l;a.origin.y+=g.top*l;a.dimensions.width+=g.right*l;a.dimensions.height+=g.bottom*
l;i&&a.constrainAspectRatio(i)},constrainAspectRatio:function(g){var l=0,i={top:0,left:0,bottom:0,right:0};if(a.dimensions.getAspectRatio()<g){l=Math.abs(a.dimensions.width-a.dimensions.height*g);i.left=-l;i.right=l}else{l=Math.abs(a.dimensions.height-a.dimensions.width/g);i.top=-l;i.bottom=l}a.applyDelta(i)},moveTo:function(g,l){var i=new SLICK.Vector(g-a.origin.x,l-a.origin.y);a.origin.x=g;a.origin.y=l;return i},toString:function(){return String.format("(origin: {0}, dimensions: {1})",a.origin,
a.dimensions)}};return a}};return k}();
SLICK.Resources=function(){function o(){if(d.length>0){var b=d.shift();b.queued=false;b.load()}}var f="",j={},e={},k=0,d=[],c={maxImageLoads:8,loadTimeout:30,Cache:function(){return{read:function(){return null},write:function(){},getUrlCacheKey:function(b,h){for(var a=(b?b.replace(/^.*\?/,""):"").split("&"),g=b?b.replace(/\?.*$/,"?"):"",l=0;l<a.length;l++){var i=a[l].split("=");if(!h||!h.test(i[0]))g+=a[l]+"&"}return g.replace(/\W/g,"")},isValidCacheKey:function(b){GRUNT.Log.info("cache key = "+b);
return false}}}(),getCachedUrl:function(b){return b},getPath:function(b){return/^(https?|\/)/.test(b)?b:f+b},setBasePath:function(b){f=b},loadImage:function(b,h){var a;a=c.getPath(b);e[a]||(e[a]=new c.ImageResource({url:a}));a=e[a];a.hitCount++;if(a.loaded)h&&h(a.get());else{a.load();a.loadListeners.push(h)}},resetImageLoadQueue:function(){d=[]},getStats:function(){return{imageLoadingCount:k,queuedImageCount:d.length}},loadResource:function(b){b=GRUNT.extend({filename:"",cacheable:true,dataType:null,
callback:null},b);var h=function(a){b.callback&&GRUNT.Log.watch("CALLING RESOURCE CALLBACK",function(){b.callback(a)})};b.cacheable&&j[b.filename]?h(j[b.filename]):GRUNT.XHR.ajax({url:c.getPath(b.filename),dataType:b.dataType,success:function(a){if(b.cacheable)j[b.filename]=a;h(a)},error:function(a,g,l){GRUNT.Log.error("error loading resource ["+b.filename+"], error = "+l)}})},loadSnippet:function(b,h){/\.\w+$/.test(b)||(b+=".html");c.loadResource({filename:"snippets/"+b,callback:h,dataType:"html"})},
ImageResource:function(b){function h(){if(!l.loaded){GRUNT.Log.warn("timed out loading image: "+a.src);a.src=null;k--;o()}}b=GRUNT.extend({url:""},b);var a=new Image,g=0,l={loaded:false,queued:false,loadListeners:[],hitCount:0,get:function(){return a},load:function(){if(b.url&&a.src!=b.url)if(!c.maxImageLoads||k<c.maxImageLoads){k++;a.src=b.url;g=setTimeout(h,c.loadTimeout*1E3)}else if(!l.queued){d.push(l);l.queued=true}}};a.onload=function(){l.loaded=true;k--;clearTimeout(g);for(var i=0;i<l.loadListeners.length;i++)l.loadListeners[i]&&
l.loadListeners[i](a);o()};return l}};return c}();
SLICK.Touch=function(){function o(d,c){var b=d.length>0?d[0]:null;if(b&&c.length>0)return b.diff(c[0]);return null}function f(d){d.preventDefault();d.stopPropagation()}var j=0,e={TouchHelper:function(d){function c(u){u=new SLICK.VectorArray(u,true);d.element&&u.applyOffset(new SLICK.Vector(-d.element.offsetLeft,-d.element.offsetTop));return u}d=GRUNT.extend({element:null,inertiaTrigger:20,maxDistDoubleTap:20,panEventThreshhold:0,pinchZoomThreshold:5,touchStartHandler:null,moveHandler:null,moveEndHandler:null,
pinchZoomHandler:null,pinchZoomEndHandler:null,tapHandler:null,doubleTapHandler:null,wheelZoomHandler:null},d);var b={GLOBAL:"touches",TARGET:"targetTouches",CHANGED:"changedTouches"},h=[b.GLOBAL,b.TARGET],a={TAP:0,MOVE:1,PINCHZOOM:2},g=false,l=0,i=null,m=null,n=null,p=null,q=new SLICK.Vector,r=null,t=false,A=[],C={current:0,last:0},x={supportsTouch:SLICK.getDeviceConfig().supportsTouch,THRESHOLD_DOUBLETAP:300,addListeners:function(u){A.push(u)},fireEvent:function(u){var w=[],z=0;for(z=1;z<arguments.length;z++)w.push(arguments[z]);
for(z=0;z<A.length;z++)A[z][u]&&A[z][u].apply(x,w)},firePositionEvent:function(u,w){var z=null;if(d.element)z=w.offset(-d.element.offsetLeft,-d.element.offsetTop);x.fireEvent(u,w,z)},getTouchPoints:function(u,w){function z(O,P){for(var I=u[P],F=0;I&&F<I.length;F++)O.push(new SLICK.Vector(I[F].pageX,I[F].pageY))}w||(w=h);for(var G=[],Q=0;Q<w.length;Q++){z(G,w[Q]);if(G.length>0)break}G.length===0&&G.push(new SLICK.Vector(u.pageX,u.pageY));return G},start:function(u){try{i=x.getTouchPoints(u);n=new SLICK.Vector;
p=new SLICK.Vector;t=true;g=false;f(u);C.current=SLICK.Clock.getTime();var w=i.length>0?i[0]:null;if(w){x.fireEvent("touchStartHandler",w.x,w.y);if(C.current-C.last<x.THRESHOLD_DOUBLETAP){var z=m?i[0].diff(m[0]):null;if(z&&Math.abs(z.x)<d.maxDistDoubleTap&&Math.abs(z.y)<d.maxDistDoubleTap)g=true}r=a.TAP;m=[].concat(i)}else GRUNT.Log.warn("Touch start fired, but no touch vector found")}catch(G){GRUNT.Log.exception(G)}},move:function(u){if(t)try{f(u);var w=x.getTouchPoints(u);u=0;if(w.length>1){if(i.length===
1)i=[].concat(w);u=SLICK.VectorMath.distance(i)-SLICK.VectorMath.distance(m)}if(r===a.TAP){var z=o(w,i);if(z&&(Math.abs(z.x)>=7||Math.abs(z.y)>=7))r=a.MOVE}if(r!==a.TAP)if(!u||Math.abs(u)<d.pinchZoomThreshold){n=o(w,m);p.add(n);q.add(n);if(q.getAbsSize()>d.panEventThreshhold){x.fireEvent("moveHandler",q.x,q.y);q.empty()}r=a.MOVE}else{x.fireEvent("pinchZoomHandler",c(i),c(w));r=a.PINCHZOOM}m=[].concat(w)}catch(G){GRUNT.Log.exception(G)}},end:function(u){try{f(u);SLICK.Clock.getTime();C.last=C.current;
if(r===a.TAP)l||(l=setTimeout(function(){l=0;x.firePositionEvent(g?"doubleTapHandler":"tapHandler",i[0])},x.THRESHOLD_DOUBLETAP+50));else if(r==a.MOVE)x.fireEvent("moveEndHandler",p.x,p.y);else r==a.PINCHZOOM&&x.fireEvent("pinchZoomEndHandler",c(i),c(m));t=false}catch(w){GRUNT.Log.exception(w)}},wheelie:function(u){var w=new SLICK.Vector(u.wheelDeltaX,u.wheelDeltaY);u=new SLICK.Vector(u.clientX,u.clientY);var z=w.y!==0?Math.abs(w.y/120):0;if(z!==0)x.fireEvent("wheelZoomHandler",u,w.y>0?z+0.5:0.5/
z);GRUNT.Log.info("capture mouse wheel event, delta = "+w+", position = "+u)}};return x}},k=[];return{captureTouch:function(d,c){try{if(!d)throw Error("Unable to capture touch of null element");if(!d.id)d.id="touchable_"+j++;var b=k[d.id];if(!b){var h=SLICK.getDeviceConfig().eventTarget;b=e.TouchHelper(GRUNT.extend({element:d},c));k[d.id]=b;GRUNT.Log.info("CREATED TOUCH HELPER. SUPPORTS TOUCH = "+b.supportsTouch);h.addEventListener(b.supportsTouch?"touchstart":"mousedown",function(g){g.target&&g.target===
d&&b.start(g)},false);h.addEventListener(b.supportsTouch?"touchmove":"mousemove",function(g){g.target&&g.target===d&&b.move(g)},false);h.addEventListener(b.supportsTouch?"touchend":"mouseup",function(g){g.target&&g.target===d&&b.end(g)},false);h.addEventListener("mousewheel",function(g){b.wheelie(g)},false)}b.addListeners(c)}catch(a){GRUNT.Log.exception(a)}}}}();
if(typeof jQuery!=="undefined"){jQuery.fn.canTouchThis=function(o){return this.each(function(){SLICK.Touch.captureTouch(this,o)})};jQuery.fn.untouchable=function(){return this.bind("touchmove",function(o){o.preventDefault()})}}
SLICK.Pannable=function(o){o=GRUNT.extend({container:null,onPan:null,onPanEnd:null,onAnimate:null,checkOffset:null},o);var f=false,j=new SLICK.Vector,e={pannable:true,getOffset:function(){return new SLICK.Vector(j.x,j.y)},setOffset:function(d,c){j.x=d;j.y=c},pan:function(d,c,b){if(b)e.updateOffset(j.x+d,j.y+c,b);else{e.updateOffset(j.x+d,j.y+c);o.onPan&&o.onPan(d,c)}},isAnimating:function(){return f},panEnd:function(d,c){o.onPanEnd&&o.onPanEnd(d,c)},updateOffset:function(d,c,b){if(b){d=new SLICK.Vector(d,
c);f=true;b=SLICK.Animation.tweenVector(j,d.x,d.y,b,function(){f=false;e.panEnd(0,0)});for(d=b.length;d--;){b[d].cancelOnInteract=true;b[d].requestUpdates(function(){o.onAnimate&&o.onAnimate(j.x,j.y)})}}else e.setOffset(d,c)}},k=document.getElementById(o.container);k&&SLICK.Touch.captureTouch(k,{moveHandler:function(d,c){e.pan(-d,-c)},moveEndHandler:function(d,c){e.panEnd(d,c)}});return e};
SLICK.Scalable=function(o){function f(i,m){e=i.getRect();k=m.getRect();var n=e.getSize(),p=k.getSize();a=k.getCenter();d=e&&n!==0?p/n:1}o=GRUNT.extend({container:null,onAnimate:null,onPinchZoom:null,onScale:null,scaleDamping:false},o);var j=false,e=null,k=null,d=1,c=null,b=null,h=null,a=null,g={scalable:true,animate:function(i,m,n,p,q){function r(){q&&q();j=false;o.onScale&&o.onScale(d,a);d=1;c=null}j=true;h=m.duplicate();a=n.duplicate();e=null;if(p){b=d;SLICK.Animation.tweenValue(0,i-b,p,r,1E3).requestUpdates(function(t){c=
t/(i-b);d=b+t;o.onAnimate&&o.onAnimate()})}else{d=i;r()}},getScaleInfo:function(){return{factor:d,startRect:e?e.duplicate():null,endRect:k?k.duplicate():null,start:h,center:a,progress:c}},getScaling:function(){return j},getScaleFactor:function(){return d}},l=document.getElementById(o.container);l&&SLICK.Touch.captureTouch(l,{pinchZoomHandler:function(i,m){f(i,m);(j=d!==1)&&o.onPinchZoom&&o.onPinchZoom(i,m)},pinchZoomEndHandler:function(i,m){f(i,m);j=false;o.onScale&&o.onScale(d,a,true);d=1},wheelZoomHandler:function(i){e=
k=null;a=i.duplicate()}});return g};
SLICK.Dispatcher=function(){var o=[],f={execute:function(j){var e=f.findAction(j);GRUNT.Log.info("looking for action id: "+j+", found: "+e);if(e){var k=[].concat(arguments).slice(0,1);GRUNT.Log.watch("EXECUTING ACTION: "+j,function(){e.execute(k)})}},findAction:function(j){for(var e=o.length;e--;)if(o[e].id==j)return o[e];return null},getRegisteredActions:function(){return[].concat(o)},getRegisteredActionIds:function(){for(var j=[],e=o.length;e--;)o[e].id&&j.push(o[e].id);return j},registerAction:function(j){j&&
j.id&&o.push(j)},Action:function(j){j=GRUNT.extend({autoRegister:true,id:"",title:"",icon:"",execute:null},j);var e={id:j.id,execute:function(){j.execute&&j.execute.apply(this,arguments)},getParam:function(k){return j[k]?j[k]:""},toString:function(){return String.format("{0} [title = {1}, icon = {2}]",e.id,j.title,j.icon)}};j.autoRegister&&f.registerAction(e);return e},createAgent:function(j){j=GRUNT.extend({name:"Untitled",trashOrphanedResults:true,translator:null,execute:null},j);var e=null,k={getName:function(){return j.name},
getParam:function(d){return j[d]},getId:function(){return GRUNT.toID(k.getName())},run:function(d,c){if(j.execute){var b=e=SLICK.Clock.getTime(true),h=j.translator?j.translator(d):d;j.execute.call(k,h,function(a,g){if(!j.trashOrphanedResults||b==e)c&&c(a,g,h)})}}};return k},runAgents:function(j,e,k){for(var d=0;d<j.length;d++)j[d].run(e,k)}};return f}();
SLICK.Messaging=function(){var o=[],f=[],j=GRUNT.newModule({id:"slick.messaging",requires:["slick.core"],STATUS:{none:0,created:1,updated:2,handled:3},send:function(e){e=GRUNT.extend({type:"",payload:{},index:0,status:j.STATUS.created,statusChange:null},e);e.index=f.push(e)-1;e=e.index;var k=e>=0&&e<f.length?f[e]:null;GRUNT.Log.info("firing message update, index = "+e+", message = "+k);for(var d=0;k&&d<o.length&&k.status!==j.STATUS.handled;){var c=o[d].processUpdate(f[e]);if(c){c=c;o[d].getId();var b=
e>=0&&e<f.length?f[e]:null;if(b){b.status=c;b.statusChange&&b.statusChange(b)}}d++}},Handler:function(e){e=GRUNT.extend({id:"",processUpdate:null},e);var k={getId:function(){return e.id},processUpdate:function(d){if(e.processUpdate)return e.processUpdate(d);return j.STATUS.none}};o.push(k);return k}});return j}();
SLICK.Animation=function(){function o(){if(e===0)e=setInterval(function(){if(k.update(SLICK.Clock.getTime())===0){clearInterval(e);e=0}},20)}var f=[],j=false,e=0,k={DURATION:2E3,tweenValue:function(d,c,b,h,a){d=new k.Tween({startValue:d,endValue:c,tweenFn:b,complete:h,duration:a});f.push(d);return d},tween:function(d,c,b,h,a,g){d=new k.Tween({target:d,property:c,endValue:b,tweenFn:h,duration:g,complete:a});f.push(d);return d},tweenVector:function(d,c,b,h,a,g){var l=[];if(d){var i=d.x==c,m=d.y==b;
i||l.push(k.tween(d,"x",c,h,function(){(i=true)&&m&&a()},g));m||l.push(k.tween(d,"y",b,h,function(){m=true;i&&m&&a()},g))}return l},cancel:function(d){if(!j){j=true;try{for(var c=0;c<f.length;)if(!d||d(f[c])){GRUNT.Log.info("CANCELLING ANIMATION");f[c].triggerComplete(true);f.splice(c,1)}else c++}finally{j=false}}},isTweening:function(){return f.length>0},update:function(d){if(j)return f.length;j=true;try{for(var c=0;c<f.length;)if(f[c].isComplete()){f[c].triggerComplete(false);f.splice(c,1);GRUNT.WaterCooler.say("animation.complete")}else{f[c].update(d);
c++}}finally{j=false}return f.length},Tween:function(d){d=GRUNT.extend({target:null,property:null,startValue:0,endValue:null,duration:k.DURATION,tweenFn:k.DEFAULT,complete:null,cancelOnInteract:false},d);var c=SLICK.Clock.getTime(),b=[],h=false,a=0,g=0,l={cancelOnInteract:d.cancelOnInteract,isComplete:function(){return h},triggerComplete:function(i){d.complete&&d.complete(i)},update:function(i){try{var m=d.tweenFn(i-c,a,g,d.duration);if(d.target)d.target[d.property]=m;for(var n=b.length;n--;)b[n](m,
void 0);if(h=c+d.duration<=i){if(d.target)d.target[d.property]=d.tweenFn(d.duration,a,g,d.duration);for(var p=b.length;p--;)b[p](m,true)}}catch(q){GRUNT.Log.exception(q)}},requestUpdates:function(i){b.push(i)}};a=d.target&&d.property&&d.target[d.property]?d.target[d.property]:d.startValue;if(typeof d.endValue!=="undefined")g=d.endValue-a;if(g==0)h=true;o();return l},Easing:function(){var d=1.70158;return{Linear:function(c,b,h,a){return h*c/a+b},Back:{In:function(c,b,h,a){return h*(c/=a)*c*((d+1)*
c-d)+b},Out:function(c,b,h,a){return h*((c=c/a-1)*c*((d+1)*c+d)+1)+b},InOut:function(c,b,h,a){return(c/=a/2)<1?h/2*c*c*(((d*=1.525)+1)*c-d)+b:h/2*((c-=2)*c*(((d*=1.525)+1)*c+d)+2)+b}},Bounce:{In:function(c,b,h,a){return h-k.Easing.Bounce.Out(a-c,0,h,a)+b},Out:function(c,b,h,a){return(c/=a)<1/2.75?h*7.5625*c*c+b:c<2/2.75?h*(7.5625*(c-=1.5/2.75)*c+0.75)+b:c<2.5/2.75?h*(7.5625*(c-=2.25/2.75)*c+0.9375)+b:h*(7.5625*(c-=2.625/2.75)*c+0.984375)+b},InOut:function(c,b,h,a){return c<a/2?k.Easing.Bounce.In(c*
2,0,h,a)*0.5+b:k.Easing.Bounce.Out(c*2-a,0,h,a)*0.5+h*0.5+b}},Cubic:{In:function(c,b,h,a){return h*(c/=a)*c*c+b},Out:function(c,b,h,a){return h*((c=c/a-1)*c*c+1)+b},InOut:function(c,b,h,a){if((c/=a/2)<1)return h/2*c*c*c+b;return h/2*((c-=2)*c*c+2)+b}},Elastic:{In:function(c,b,h,a,g,l){if(c==0)return b;if((c/=a)==1)return b+h;l||(l=a*0.3);if(!g||g<Math.abs(h)){g=h;h=l/4}else h=l/(2*Math.PI)*Math.asin(h/g);return-(g*Math.pow(2,10*(c-=1))*Math.sin((c*a-h)*2*Math.PI/l))+b},Out:function(c,b,h,a,g,l){var i;
if(c==0)return b;if((c/=a)==1)return b+h;l||(l=a*0.3);if(!g||g<Math.abs(h)){g=h;i=l/4}else i=l/(2*Math.PI)*Math.asin(h/g);return g*Math.pow(2,-10*c)*Math.sin((c*a-i)*2*Math.PI/l)+h+b},InOut:function(c,b,h,a,g,l){var i;if(c==0)return b;if((c/=a/2)==2)return b+h;l||(l=a*0.3*1.5);if(!g||g<Math.abs(h)){g=h;i=l/4}else i=l/(2*Math.PI)*Math.asin(h/g);if(c<1)return-0.5*g*Math.pow(2,10*(c-=1))*Math.sin((c*a-i)*2*Math.PI/l)+b;return g*Math.pow(2,-10*(c-=1))*Math.sin((c*a-i)*2*Math.PI/l)*0.5+h+b}},Quad:{In:function(c,
b,h,a){return h*(c/=a)*c+b},Out:function(c,b,h,a){return-h*(c/=a)*(c-2)+b},InOut:function(c,b,h,a){if((c/=a/2)<1)return h/2*c*c+b;return-h/2*(--c*(c-2)-1)+b}},Sine:{In:function(c,b,h,a){return-h*Math.cos(c/a*(Math.PI/2))+h+b},Out:function(c,b,h,a){return h*Math.sin(c/a*(Math.PI/2))+b},InOut:function(c,b,h,a){return-h/2*(Math.cos(Math.PI*c/a)-1)+b}}}}()};return GRUNT.extend(k,{DEFAULT:k.Easing.Back.Out})}();SLICK.Border={NONE:0,TOP:1,RIGHT:2,BOTTOM:3,LEFT:4};
SLICK.Graphics=function(){var o={NONE:0,ACTIVE:1,ANIMATING:2,PAN:4,PINCHZOOM:8,GENCACHE:32,SNAPSHOT:64},f=0,j={requires:["Resources"],drawRect:function(e,k){e.strokeRect(k.origin.x,k.origin.y,k.dimensions.width,k.dimensions.height)},DisplayState:o,AnyDisplayState:255,ActiveDisplayStates:o.ACTIVE|o.ANIMATING,ViewLayer:function(e){e=GRUNT.extend({id:"",centerOnScale:true,created:(new Date).getTime(),scalePosition:true,zindex:0,validStates:j.ActiveDisplayStates|o.PAN|o.PINCHZOOM|o.SNAPSHOT},e);var k=
[],d=null,c=GRUNT.extend({isAnimating:function(){return false},addToView:function(b){b.setLayer(e.id,c)},shouldDraw:function(b){return(b&e.validStates)!==0},cycle:function(){return 0},draw:function(){},layerChanged:function(){for(var b=k.length;b--;)k[b](c)},notify:function(){},remove:function(){GRUNT.WaterCooler.say("layer.remove",{id:e.id})},registerChangeListener:function(b){k.push(b)},wakeParent:function(){GRUNT.WaterCooler.say("view.wake",{id:d?d.id:null})},getParent:function(){return d},setParent:function(b){d=
b}},e);return c},StatusViewLayer:function(){return new j.ViewLayer({validStates:j.AnyDisplayState,zindex:5E3,draw:function(e,k,d,c){e.fillStyle="#FF0000";e.fillRect(10,10,50,50);e.fillStyle="#FFFFFF";e.font="bold 10px sans";e.fillText(c.getDisplayState(),20,20)}})},AnimatedPathLayer:function(e){function k(g,l,i){g.fillStyle="#FFFFFF";g.strokeStyle="#222222";g.beginPath();g.arc(i.x,i.y,4,0,Math.PI*2,false);g.stroke();g.fill()}e=GRUNT.extend({path:[],id:GRUNT.generateObjectID("pathAnimation"),easing:SLICK.Animation.Easing.Sine.InOut,
canCache:false,validStates:j.ActiveDisplayStates|o.PAN|o.PINCHZOOM,drawIndicator:null,duration:2E3,autoCenter:false},e);var d=SLICK.VectorMath.edges(e.path),c,b=null,h=0;SLICK.Animation.tweenValue(0,d.total,e.easing,function(){a.remove()},e.duration).requestUpdates(function(g,l){h=g;l&&a.remove()});var a=GRUNT.extend(new j.ViewLayer(e),{cycle:function(){for(var g=0;g<d.accrued.length&&d.accrued[g]<h;)g++;b=null;if(g<e.path.length-1){var l=h-(g>0?d.accrued[g-1]:0),i=e.path[g],m=e.path[g+1];c=SLICK.VectorMath.theta(i,
m,d.edges[g]);b=SLICK.VectorMath.pointOnEdge(i,m,c,l);if(e.autoCenter)(g=a.getParent())&&g.centerOn(b)}return b?1:0},draw:function(g,l){if(b)(e.drawIndicator?e.drawIndicator:k)(g,l,new SLICK.Vector(b.x-l.x,b.y-l.y),c)}});return a},FPSLayer:function(e){e=GRUNT.extend({zindex:1E3,scalePosition:false},e);var k=GRUNT.extend(new j.ViewLayer(e),{fps:null,draw:function(d,c,b){d.save();try{d.font="bold 8pt Arial";d.textAlign="right";d.fillStyle="rgba(0, 0, 0, 0.8)";d.fillText((k.fps?k.fps:"?")+" fps",b.width-
20,20)}finally{d.restore()}}});return k},ResourceStatsLayer:function(e){e=GRUNT.extend({zindex:500,indicatorSize:5,scalePosition:false,validStates:o.ACTIVE|o.PAN},e);return GRUNT.extend(new j.ViewLayer(e),{fps:null,draw:function(k){var d=SLICK.Resources.getStats(),c=e.indicatorSize,b;k.fillStyle="rgba(0, 255, 0, 0.7)";for(b=d.imageLoadingCount;b--;)k.fillRect(10,10+b*(c+2),c,c);k.fillStyle="rgba(255, 0, 0, 0.7)";for(b=d.queuedImageCount;b--;)k.fillRect(10+c+2,10+b*(c+2),c,c)}})},LoadingLayer:function(e){GRUNT.extend({},
e)},View:function(e){function k(s,v){v.id=s;v.registerChangeListener(function(){t++;h()});v.setParent(D);a.push(v);a.sort(function(y,B){var E=B.zindex-y.zindex;if(E===0)E=B.created-y.created;return E});D.notifyLayerListeners("add",s,v)}function d(s,v,y,B){var E=0;if(s.shouldDraw(B?B:J))E=s.draw(v,y,z,D);return E?E:0}function c(s,v,y){var B=0,E=D.getScaleFactor(),R=(D.getDisplayStatus()&o.PINCHZOOM)!==0,W=[];A=D.getScaleFactor();var Y=false,K=0;if(y||!R&&t>0&&Z+ba<=M){B=B;var L=0,H=GRUNT.Log.getTraceTicks();
r=1E3;GRUNT.WaterCooler.say("view.cache",{id:e.id});if(n){m.clearRect(0,0,i.width,i.height);n=false}var ca=p.offset(-e.padding,-e.padding);GRUNT.Log.trace("prepped cached canvas",H);for(var U=a.length;U--;)if(a[U].shouldDraw(y?y:o.GENCACHE)){var $=a[U].draw(m,ca,G,D);L+=$?$:0;r=Math.min(r,a[U].zindex)}t=0;q=p.duplicate();Z=M;GRUNT.Log.trace("cached context",H);B=B+L}if(e.clearOnDraw||R)s.clearRect(0,0,g.width,g.height);if(R){H=N.getScaleInfo();D.getDimensions().getCenter();L=(H.progress?H.progress:
1)*0.5;F=H.center;if(H.startRect){L=H.startRect.getCenter().diff(F);S=new SLICK.Vector(F.x+L.x,F.y+L.y)}else{H=H.start.diff(F);S=new SLICK.Vector(F.x-H.x*L,F.y-H.y*L)}S&&v.add(S)}s.save();try{if(u!==1)s.scale(u,u);else if(R){s.translate(F.x,F.y);s.scale(E,E)}for(K=a.length;K--;){if(!R||a[K].scalePosition)B+=d(a[K],s,v,y);else W.unshift(a[K]);if(!Y&&r<a[K].zindex){var aa=q.diff(v).offset(-e.padding,-e.padding);s.drawImage(i,aa.x,aa.y);Y=true}}}finally{s.restore()}for(K=W.length;K--;)B+=d(W[K],s,v,
y);return B}function b(){var s=0,v=J==j.DisplayState.PINCHZOOM||M-x<e.bufferRefresh;M=SLICK.Clock.getTime();p=T?T.getOffset():new SLICK.Vector;if(I&&C)I.fps=Math.floor(1E3/(M-C));v&&SLICK.Animation.cancel(function(E){return E.cancelOnInteract});for(var y=a.length;y--;){var B=a[y].cycle(M,p);s+=B?B:0}V=V&&!v;s+=c(l,p);if(!v&&!V){V=true;GRUNT.WaterCooler.say("view-idle",{id:D.id})}C=M;X=0;O+s>0&&h()}function h(){O++;if(X===0){O=0;X=setTimeout(b,0)}}e=GRUNT.extend({id:"view_"+f++,container:"",pannable:false,
scalable:false,clearOnDraw:false,displayFPS:true,displayResourceStats:true,scaleDamping:false,fillStyle:"rgb(200, 200, 200)",bufferRefresh:100,snapshotFreezeTime:0,padding:100,fps:25,cacheFPS:5,onPan:null,onPinchZoom:null,onScale:null,onDraw:null,autoSize:false},e);var a=[],g=document.getElementById(e.container),l=null,i=null,m=null,n=false,p=new SLICK.Vector,q=new SLICK.Vector,r=0,t=0,A=1,C=null,x=0,u=1,w=new SLICK.Vector,z=null,G=null,Q=null,O=0,P=[],I=null,F=null,T=null,N=null,V=false,X=0,S=null,
M=0,Z=0,ba=1E3/(e.cacheFPS?e.cacheFPS:1),J=j.DisplayState.ACTIVE;GRUNT.Log.info("Creating a new view instance, attached to container: "+e.container+", canvas = ",g);if(g){if(e.autoSize){GRUNT.Log.info("autosizing view: window.height = "+window.innerHeight+", width = "+window.innerWidth);g.height=window.innerHeight-g.offsetTop-49;g.width=window.innerWidth-g.offsetLeft}try{l=g.getContext("2d")}catch(da){GRUNT.Log.exception(da);throw Error("Could not initialise canvas on specified view element");}}i=
document.createElement("canvas");i.width=g.width+e.padding*2;i.height=g.height+e.padding*2;m=i.getContext("2d");m.globalCompositeOperation="copy";if(e.pannable)T=new SLICK.Pannable({container:e.container,onAnimate:function(){h()},onPan:function(s,v){n=true;x=SLICK.Clock.getTime(true);h();w.add(new SLICK.Vector(s,v));e.onPan&&e.onPan(s,v);J=o.PAN},onPanEnd:function(){t++;h();var s=D.getOffset();s.x%=256;s.y%=256;GRUNT.Log.info("current guide offset = "+s);J=o.ACTIVE}});if(e.scalable)N=new SLICK.Scalable({scaleDamping:e.scaleDamping,
container:e.container,onAnimate:function(){J=j.DisplayState.PINCHZOOM;h()},onPinchZoom:function(s,v){x=SLICK.Clock.getTime(true);h();e.onPinchZoom&&e.onPinchZoom(s,v);J=j.DisplayState.PINCHZOOM},onScale:function(s,v){GRUNT.WaterCooler.say("view.scale",{id:D.id});D.snapshot();for(var y=a.length;y--;)a[y].notify("scale");J=j.DisplayState.ACTIVE;h();e.onScale&&e.onScale(s,v)}});var D=GRUNT.extend({},e,T,N,{id:e.id,deviceScaling:u,centerOn:function(s){T.setOffset(s.x-g.width*0.5,s.y-g.height*0.5)},getDimensions:function(){if(g)return new SLICK.Dimensions(g.width,
g.height)},getZoomCenter:function(){return S},getLayer:function(s){for(var v=0;v<a.length;v++)if(a[v].id==s){/^grid/i.test(s)||GRUNT.Log.info("found layer: "+s);return a[v]}return null},setLayer:function(s,v){for(var y=0;y<a.length;y++)if(a[y].id===s){a.splice(y,1);break}v&&k(s,v);D.notifyLayerListeners("update",s,v);t++;h()},eachLayer:function(s){for(var v=0;v<a.length;v++)s(a[v])},snapshot:function(){var s=GRUNT.Log.getTraceTicks();m.save();try{m.fillStyle="rgba(30, 30, 30)";m.fillRect(e.padding,
e.padding,z.width,z.height);m.globalAlpha=0.5;m.drawImage(g,e.padding,e.padding)}finally{m.restore()}GRUNT.Log.trace("taken snapshot",s)},getDisplayStatus:function(){return J},setDisplayStatus:function(s){J=s},scale:function(s,v,y,B,E){B||(B=D.getDimensions().getCenter());E||(E=D.getDimensions().getCenter());N&&N.animate(s,B,E,v,y);return N},removeLayer:function(s,v){setTimeout(function(){var y;a:{for(y=a.length;y--;)if(a[y].id==s){y=y;break a}y=-1}if(y>=0&&y<a.length){D.notifyLayerListeners("remove",
s,a[y]);a.splice(y,1)}},v?v:1)},registerLayerListener:function(s){P.push(s)},notifyLayerListeners:function(s,v,y){for(var B=0;B<P.length;B++)P[B](s,v,y)}});z=D.getDimensions();Q=z.getCenter();G=z.grow(e.padding,e.padding);GRUNT.WaterCooler.listen("layer.remove",function(s){s.id&&D.removeLayer(s.id)});GRUNT.WaterCooler.listen("view.wake",function(s){t++;if(!s.id||s.id===D.id)h()});u=SLICK.getDeviceConfig().getScaling();if(e.displayFPS){I=new j.FPSLayer;D.setLayer("fps",I)}e.displayResourceStats&&D.setLayer("resourceStats",
new j.ResourceStatsLayer);h();return D},Sprite:function(){var e=[];return{loaded:false,changed:function(k){for(var d=0;d<e.length;d++)e[d](k)},draw:function(){},load:function(){},requestUpdates:function(k){e.push(k)}}}};return j}();
SLICK.Tiling=function(){TileStore=function(f){f=GRUNT.extend({gridSize:20,center:new SLICK.Vector,onPopulate:null},f);var j=Array(Math.pow(f.gridSize,2)),e=Math.ceil(f.gridSize>>1),k=f.center.offset(-e,-e),d=null,c=new SLICK.Vector,b=null;GRUNT.Log.info("created tile store with tl offset = "+k);var h={getGridSize:function(){return f.gridSize},getNormalizedPos:function(a,g){return(new SLICK.Vector(a,g)).add(k.invert()).add(c)},getTileShift:function(){return c.duplicate()},getTile:function(a,g){return a>=
0&&a<f.gridSize?j[g*f.gridSize+a]:null},setTile:function(a,g,l){j[g*f.gridSize+a]=l},populate:function(a,g){var l=GRUNT.Log.getTraceTicks(),i=0;GRUNT.Log.info("poulating grid, top left offset = "+k);if(a)for(var m=0;m<f.gridSize;m++)for(var n=0;n<f.gridSize;n++){if(!j[i]){var p=a(n,m,k,f.gridSize);p&&g&&p.requestUpdates(g);j[i]=p}i++}d=a;b=g;GRUNT.Log.trace("tile grid populated",l);f.onPopulate&&f.onPopulate()},getShiftDelta:function(a,g,l,i){var m=Math.floor(f.gridSize*0.2),n=new SLICK.Vector;if(a<
0||a+l>f.gridSize)n.x=a<0?-m:m;if(g<0||g+i>f.gridSize)n.y=g<0?-m:m;return n},shift:function(a,g){if(!(a.x===0&&a.y===0)){var l=GRUNT.Log.getTraceTicks(),i=Array(j.length);i.length=j.length;for(var m=0;m<f.gridSize;m++)for(var n=0;n<f.gridSize;n++)i[n*f.gridSize+m]=h.getTile(m+a.x,n+a.y);j=i;if(g)k=g(k,a);else k.add(a);c.x+=-a.x*f.tileSize;c.y+=-a.y*f.tileSize;GRUNT.Log.trace("tile storage shifted",l);h.populate(d,b)}},setOrigin:function(a,g){if(tileOrigin)shiftOrigin(a,g);else k=(new SLICK.Vector(a,
g)).offset(-tileHalfWidth,-tileHalfWidth)}};return h};var o={Config:{TILESIZE:256,TILEBUFFER:1,TILEBUFFER_LOADNEW:0.2,EMPTYTILE:"/public/images/tile.png"},Tile:function(f){f=GRUNT.extend({},f);return GRUNT.extend(new SLICK.Graphics.Sprite(f),{})},ImageTile:function(f){f=GRUNT.extend({url:"",sessionParamRegex:null},f);var j=new o.Tile(f),e=null,k=GRUNT.extend({},j,{loaded:false,draw:function(d,c,b){e&&e.complete&&d.drawImage(e,c,b)},load:function(d,c){if(!e&&f.url){e=null;c||SLICK.Resources.loadImage(f.url,
function(b){e=b;d&&d();k.loaded=true;k.changed(k)})}}});return k},EmptyGridTile:function(f){f=GRUNT.extend({tileSize:256,gridLineSpacing:16},f);var j=new SLICK.Graphics.Sprite(f),e=null;j=GRUNT.extend({},j,{draw:function(k,d,c){k.drawImage(e,d,c)},getBuffer:function(){return e},getTileSize:function(){return f.tileSize}});(function(){if(!e){e=document.createElement("canvas");e.width=f.tileSize;e.height=f.tileSize}var k=e.getContext("2d");k.fillStyle="rgb(200, 200, 200)";k.fillRect(0,0,e.width,e.height);
k.strokeStyle="rgb(180, 180, 180)";k.lineWidth=0.5;k.beginPath();for(var d=0;d<e.width;d+=f.gridLineSpacing){k.moveTo(d,0);k.lineTo(d,e.height);for(var c=0;c<e.height;c+=f.gridLineSpacing){k.moveTo(0,c);k.lineTo(e.width,c)}}k.stroke()})();return j},TileGridBackground:function(f){f=GRUNT.extend({lineDist:16,lineWidth:1,fillStyle:"rgb(200, 200, 200)",strokeStyle:"rgb(180, 180, 180)",zindex:-1,validStates:SLICK.Graphics.GENCACHE});var j=document.createElement("canvas"),e=j.getContext("2d"),k=null;j.width=
f.lineDist;j.height=f.lineDist;e.fillStyle=f.fillStyle;e.strokeStyle=f.strokeStyle;e.fillRect(0,0,j.width,j.height);e.lineWidth=f.lineWidth;e.beginPath();e.moveTo(0,0);e.lineTo(0,f.lineDist);e.moveTo(0,0);e.lineTo(f.lineDist,0);e.stroke();return GRUNT.extend(new SLICK.Graphics.ViewLayer(f),{draw:function(d,c,b){var h=GRUNT.Log.getTraceTicks(),a=Math.abs(c.x%f.lineDist);c=Math.abs(c.y%f.lineDist);k||(k=d.createPattern(j,"repeat"));d.save();try{d.translate(-a,-c);d.fillStyle=k;d.fillRect(0,0,b.width+
a,b.height+c)}finally{d.restore()}GRUNT.Log.trace("tile background drawn",h)}})},TileGrid:function(f){function j(n,p){for(var q=0;q<d.length;q++)d[q](n,p)}function e(n,p,q,r){var t;n=i.getTileShift();p=new SLICK.Vector(Math.floor((p.x+n.x)*b),Math.floor((p.y+n.y)*b));n=Math.ceil(q.width*b)+1;q=Math.ceil(q.height*b)+1;var A=new SLICK.Vector(p.x*f.tileSize,p.y*f.tileSize);r=r.isAnimating();a=[];tilesNeeded=false;for(var C=0;C<q;C++)for(var x=C*f.tileSize+A.y,u=0;u<n;u++){t=i.getTile(u+p.x,C+p.y);var w=
u*f.tileSize+A.x;t||(l=i.getShiftDelta(p.x,p.y,n,q));a.push({tile:t,coordinates:new SLICK.Vector(w,x)})}for(p=a.length;p--;)(t=a[p].tile)&&!t.loaded&&t.load(function(){if(c){g++;h=true;m.wakeParent();j("load",t)}},r)}f=GRUNT.extend({emptyTileImage:null,tileSize:SLICK.Tiling.Config.TILESIZE,drawGrid:false,center:new SLICK.Vector,shiftOrigin:null,checkChange:100,validStates:SLICK.Graphics.DisplayState.GENCACHE|SLICK.Graphics.DisplayState.SNAPSHOT},f);var k=Math.round(f.tileSize>>1),d=[],c=true,b=f.tileSize?
1/f.tileSize:0,h=false,a=[],g=0;new o.EmptyGridTile;new SLICK.Vector;var l=new SLICK.Vector,i=new TileStore(GRUNT.extend({onPopulate:function(){h=true;m.wakeParent()}},f)),m=GRUNT.extend(new SLICK.Graphics.ViewLayer(f),{addTile:function(n,p,q){i.setTile(n,p,q);if(q){q.setSize(f.tileSize);q.requestUpdates(function(r){j("updated",r)})}},cycle:function(){var n=0;if(l.x+l.y!==0){i.shift(l,f.shiftOrigin);l=new SLICK.Vector;n++}return n+h?1:0},draw:function(n,p,q,r){if(c){var t=GRUNT.Log.getTraceTicks(),
A=i.getTileShift(),C=p.x+A.x;A=p.y+A.y;e(n,p,q,r);GRUNT.Log.trace("updated draw queue",t);if(f.drawGrid)n.strokeStyle="rgba(50, 50, 50, 0.3)";n.beginPath();for(p=a.length;p--;){q=a[p].tile;r=a[p].coordinates.x-C;var x=a[p].coordinates.y-A;q&&q.loaded&&q.draw(n,r,x);f.drawGrid&&n.rect(r,x,f.tileSize,f.tileSize)}n.stroke();GRUNT.Log.trace("drawn tiles",t)}h=false},getLoadedTileCount:function(){return g},getVisibleTileCount:function(n){if(f.tileSize!==0)return Math.ceil(n.width/f.tileSize)+Math.ceil(n.height/
f.tileSize);return 0},getTileSize:function(){return f.tileSize},getTileVirtualXY:function(n,p,q){n=i.getNormalizedPos(n,p);GRUNT.Log.info("normalised pos = "+n);n=new SLICK.Vector(n.x*f.tileSize,n.y*f.tileSize);if(q){n.x+=k;n.y+=k}return n},getCenterXY:function(){var n=Math.ceil(i.getGridSize()>>1);return m.getTileVirtualXY(n,n,true)},getDimensions:function(){var n=i.getGridSize()*f.tileSize;return new SLICK.Dimensions(n,n)},populate:function(n){i.populate(n,function(p){j("created",p)})},requestUpdates:function(n){d.push(n)}});
GRUNT.WaterCooler.listen("view.scale",function(n){if(n.id==m.getParent().id)c=false});return m},DataLayer:function(){},Tiler:function(f){function j(b,h){h.requestUpdates(function(a){if(a=="load")if(b!=e&&h.getLoadedTileCount()>=k){c.notifyLayerListeners("load",b,h);e=b}})}f=GRUNT.extend({container:"",drawCenter:false,onPan:null,onPanEnd:null,tapHandler:null,doubleTapHandler:null,zoomHandler:null,onDraw:null,datasources:{},tileLoadThreshold:"first"},f);(new SLICK.Tiling.EmptyGridTile).getTileSize();
var e="",k=0,d={first:function(){return 1},auto:function(b){return b>>1},all:function(b){return b}};SLICK.Touch.captureTouch(document.getElementById(f.container),f);var c=new SLICK.Graphics.View(GRUNT.extend({},f,{pannable:true,scalable:true,scaleDamping:true,datasources:f.datasources,fillBackground:function(b,h,a,g,l){h=b.createLinearGradient(h,0,h,l);h.addColorStop(0,"rgb(170, 170, 170)");h.addColorStop(1,"rgb(210, 210, 210)");b.fillStyle=h;b.fillRect(0,0,g,l)},onDraw:function(b){c.getOffset();
f.onDraw&&f.onDraw(b)}}));GRUNT.extend(c,{getTileLayer:function(){return c.getLayer("grid0")},setTileLayer:function(b){j("grid0",b);c.setLayer("grid0",b);b=b.getVisibleTileCount(c.getDimensions());k=d[f.tileLoadThreshold]?d[f.tileLoadThreshold](b):parseInt(f.tileLoadThreshold,10)},gridPixToViewPix:function(b){var h=c.getOffset();return new SLICK.Vector(b.x-h.x,b.y-h.y)},viewPixToGridPix:function(b){var h=c.getOffset();GRUNT.Log.info("Offset = "+h);return new SLICK.Vector(b.x+h.x,b.y+h.y)}});c.setLayer("background",
new o.TileGridBackground);return c}};return o}();
SLICK.Geo=function(){function o(a,g){var l=null;for(var i in b)if(g){if(i==g&&b[i][a]){l=b[i];break}}else if(b[i][a]){l=b[i];break}return l}function f(a,g,l,i){var m=0;a=a.toUpperCase();for(var n in i){var p=g[n];if(p){var q=l[n];p=q?q(a,p):a.containsWord(p)?1:0;m+=p*i[n]}}return m}var j=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],e=/(\d+)\s?\-\s?(\d+)/,k=/^(\d+).*$/,d=null,c={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",
HWY:"HIGHWAY",MWY:"MOTORWAY"},b={},h={Engine:function(a){if(!a.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var g=GRUNT.extend({remove:function(){delete b[g.id]}},a);return b[g.id]=g},getEngine:function(a){for(var g=null,l=1;!g&&l<arguments.length;l++)g=o(a,arguments[l]);g=g?g:o(a);if(!g)throw Error("Unable to find GEO engine with "+a+" capability");return g},Distance:function(a,g){var l=0;if(a&&!a.isEmpty()&&g&&!g.isEmpty()){var i=(g.lat-a.lat).toRad()>>1,m=(g.lon-
a.lon).toRad()>>1;i=Math.sin(i)*Math.sin(i)+Math.cos(a.lat.toRad())*Math.cos(g.lat.toRad())*Math.sin(m)*Math.sin(m);l=6371*2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))}return{toM:function(){return l*1E3},toKM:function(){return l},toString:function(){return l+"km"}}},Radius:function(a,g){return{distance:parseInt(a,10),uom:g}},Position:function(a,g){if(!g&&a&&a.split&&a.indexOf(" ")>=0){var l=a.split(" ");a=l[0];g=l[1]}if(!a)g=a=0;var i={lat:parseFloat(a),lon:parseFloat(g),copy:function(m){i.lat=m.lat;
i.lon=m.lon},duplicate:function(){return new h.Position(i.lat,i.lon)},clear:function(){i.lat=0;i.lon=0},isEmpty:function(){return i.lat===0&&i.lon===0},getMercatorPixels:function(m){return new SLICK.Vector(SLICK.Geo.Utilities.lon2pix(i.lon,m),SLICK.Geo.Utilities.lat2pix(i.lat,m))},setMercatorPixels:function(m,n,p){if(!p)throw"Unable to calculate position from mercator pixels without rads_per_pixel value";i.lat=SLICK.Geo.Utilities.pix2lat(n,p);i.lon=SLICK.Geo.Utilities.normalizeLon(SLICK.Geo.Utilities.pix2lon(m,
p))},toString:function(){return i.lat+" "+i.lon}};return i},BoundingBox:function(a,g){if(a){if(a.split)a=new SLICK.Geo.Position(a)}else a=new SLICK.Geo.Position;if(g){if(g.split)g=new SLICK.Geo.Position(g)}else g=new SLICK.Geo.Position;var l={min:a,max:g,copy:function(i){l.min.copy(i.min);l.max.copy(i.max)},clear:function(){l.min.clear();l.max.clear()},expand:function(i){l.min.lat-=i;l.min.lon-=h.Utilities.normalizeLon(i);l.max.lat+=i;l.max.lon+=h.Utilities.normalizeLon(i)},getDistance:function(){return new h.Distance(l.min,
l.max)},getCenter:function(){var i=h.calculateBoundsSize(l.min,l.max);return new SLICK.Geo.Position(l.min.lat+i.y*0.5,l.min.lon+i.x*0.5)},isEmpty:function(){return l.min.isEmpty()||l.max.isEmpty()},transform:function(i){var m=new SLICK.Geo.BoundingBox(l.min,l.max);GRUNT.Log.info("applying "+i.length+" transformers");for(var n=0;i&&n<i.length;n++)i[n].apply(m);return m},toString:function(){return String.format("({0}, {1})",l.min,l.max)}};return l},Transforms:function(){return{Shrink:function(){return function(){}},
Offset:function(){return function(){}}}}(),Address:function(a){a=GRUNT.extend({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},a);return GRUNT.extend(a,{getPos:function(){return a.pos},toString:function(){return a.streetDetails+" "+a.location}})},GeocodeFieldWeights:{streetDetails:50,location:50},AddressCompareFns:{},Utilities:function(){var a={lat2pix:function(g,l){var i=parseFloat(g)*2*Math.PI/360;i=Math.sin(i);var m=0.08181919084262157*i;return Math.log((1+i)/(1-
i)*Math.pow((1-m)/(1+m),0.08181919084262157))/2/l},lon2pix:function(g,l){return parseFloat(g)/180*Math.PI/l},pix2lon:function(g,l){return a.normalizeLon(g*l*180/Math.PI)},pix2lat:function(g,l){for(var i=Math.pow(Math.E,-g*l),m=a.mercatorUnproject(i),n=a.findRadPhi(m,i),p=0;p<12&&Math.abs(m-n)>1.0E-7;){m=n;n=a.findRadPhi(m,i);p++}return n*180/Math.PI},mercatorUnproject:function(g){return Math.PI/2-2*Math.atan(g)},findRadPhi:function(g,l){var i=0.08181919084262157*Math.sin(g);return Math.PI/2-2*Math.atan(l*
Math.pow((1-i)/(1+i),0.040909595421310785))},normalizeLon:function(g){for(;g<-180;)g+=360;for(;g>180;)g-=360;return g}};return a}(),GeoSearchResult:function(a){a=GRUNT.extend({id:null,caption:"",resultType:"",data:null,pos:null,matchWeight:0},a);return GRUNT.extend(a,{toString:function(){return a.caption+(a.matchWeight?" ("+a.matchWeight+")":"")}})},GeoSearchAgent:function(a){a=GRUNT.extend({},a);return GRUNT.extend({},SLICK.Dispatcher.createAgent(a))},GeocodingAgent:function(a){a=GRUNT.extend({name:"Geocoding Search Agent",
paramTranslator:null,execute:function(g,l){try{if(!g.reverse&&!g.freeform)address=new h.Address(g);var i=h.getEngine("geocode");if(i)i.geocode({addresses:[g.freeform?g.freeform:address],complete:function(n,p){if(l){var q=p;if(g.freeform)q=h.rankGeocodeResponses(g.freeform,q,h.getEngine("geocode"));l(q,a)}}})}catch(m){GRUNT.Log.exception(m)}}},a);return new h.GeoSearchAgent(a)},PointOfInterest:function(a){a=GRUNT.extend({id:0,title:"",pos:null,lat:"",lon:"",group:"",retrieved:0,isNew:true},a);if(!a.pos&&
a.lat&&a.lon)a.pos=new SLICK.Geo.Position(a.lat,a.lon);return GRUNT.extend({toString:function(){return a.id+": '"+a.title+"'"}},a)},POIStorage:function(a){function g(q){q=q?q:"default";m[q]||(m[q]=[]);return m[q]}function l(q){var r=[];for(var t in m)for(var A=0;A<m[t].length;A++)if(!q||q(m[t][A]))r.push(m[t][A]);return r}function i(){GRUNT.WaterCooler.say("geo.pois-updated",{srcID:p.id,pois:p.getPOIs()})}a=GRUNT.extend({visibilityChange:null,onPOIDeleted:null,onPOIAdded:null},a);var m={},n=true,
p={id:GRUNT.generateObjectID(),getPOIs:function(){return l()},getOldPOIs:function(q,r){return l(function(t){return t.group==q&&t.retrieved<r})},getVisible:function(){return n},setVisible:function(q){if(q!=n){n=q;a.visibilityChange&&a.visibilityChange()}},findById:function(q){var r=l(function(t){return t.id==q});return r.length>0?r[0]:null},findByBounds:function(q){return l(function(r){return SLICK.Geo.posInBounds(r.pos,q)})},addPOIs:function(q,r){if(r)m={};for(var t=0;q&&t<q.length;t++){q[t].retrieved=
SLICK.Clock.getTime(true);var A=q[t];g(A.group).push(A)}},removeGroup:function(q){if(m[q]){delete m[q];i()}},update:function(q){var r=[],t=0,A=q.length>0?q[0].group:"",C=SLICK.Clock.getTime(true);for(t=0;t<q.length;t++){var x;a:{if(x=q[t])for(var u=g(x.group),w=0;w<u.length;w++)if(u[w].id==x.id){x=u[w];break a}x=null}if(x){x.retrieved=C;x.isNew=false}else r.push(q[t])}q=p.getOldPOIs(A,C);p.addPOIs(r);for(t=0;a.onPOIAdded&&t<r.length;t++)a.onPOIAdded(r[t]);for(t=0;t<q.length;t++){a.onPOIDeleted&&a.onPOIDeleted(q[t]);
A=q[t];C=g(A.group);for(x=0;x<C.length;x++)if(C[x].id==A.id){C.splice(x,1);break}}r.length+q.length>0&&i()}};return p},MapProvider:function(){return{zoomLevel:0,checkZoomLevel:function(a){return a},getCopyright:function(){},getMapTiles:function(){},getPositionForXY:function(){return null}}},posInBounds:function(a,g){var l=!(a.isEmpty()||g.isEmpty());return l=(l=l&&a.lat>=g.min.lat&&a.lat<=g.max.lat)&&a.lon>=g.min.lon&&a.lon<=g.max.lon},calculateBoundsSize:function(a,g,l){var i=new SLICK.Vector(0,
g.lat-a.lat);if(typeof l==="undefined")l=true;i.x=l&&a.lon>g.lon?360-a.lon+g.lon:g.lon-a.lon;return i},getBoundingBoxZoomLevel:function(a,g){var l=a.getCenter(),i=Math.min(Math.round(Math.abs(l.lat)*0.05),j.length),m=j[i],n=h.calculateBoundsSize(a.min,a.max),p=Math.ceil(Math.log(j[3]*g.height/n.y)/Math.log(2));m=Math.ceil(Math.log(m*g.width/n.x)/Math.log(2));GRUNT.Log.info("constant index for bbox: "+a+" (center = "+l+") is "+i);GRUNT.Log.info("distances  = "+n);GRUNT.Log.info("optimal zoom levels: height = "+
p+", width = "+m);return Math.min(p,m)},getBoundsForPositions:function(a,g){var l=null,i=SLICK.Clock.getTime();g||(g="auto");for(var m=0;m<a.length;m++)if(l){var n=h.calculateBoundsSize(l.min,a[m],false),p=h.calculateBoundsSize(a[m],l.max,false);if(n.x<0)l.min.lon=a[m].lon;if(n.y<0)l.min.lat=a[m].lat;if(p.x<0)l.max.lon=a[m].lon;if(p.y<0)l.max.lat=a[m].lat}else l=new SLICK.Geo.BoundingBox(a[m].duplicate(),a[m].duplicate());if(g){if(g=="auto"){m=h.calculateBoundsSize(l.min,l.max);g=Math.max(m.x,m.y)*
0.3}l.expand(g)}GRUNT.Log.info("bounds calculated in "+(SLICK.Clock.getTime()-i)+" ms");return l},normalizeAddress:function(a){if(!a)return"";a=a.toUpperCase();if(!d){var g=[];for(var l in c)g.push(l);d=RegExp("(\\s)("+g.join("|")+")(\\s|$)","i")}d.lastIndex=-1;if(g=d.exec(a))a=a.replace(d,"$1"+c[g[2]]);return a},buildingMatch:function(a,g){k.lastIndex=-1;if(k.test(a))for(var l=a.replace(k,"$1"),i=g.split(","),m=0;m<i.length;m++){e.lastIndex=-1;if(e.test(i[m])){var n=e.exec(i[m]);if(l>=parseInt(n[1],
10)&&l<=parseInt(n[2],10))return true}else if(l==i[m])return true}return false},rankGeocodeResponses:function(a,g,l){var i=[],m=h.AddressCompareFns;if(l&&l.compareFns)m=GRUNT.extend({},m,l.compareFns);for(l=0;l<g.length;l++)i.push(new h.GeoSearchResult({caption:g[l].toString(),data:g[l],pos:g[l].pos,matchWeight:f(a,g[l],m,h.GeocodeFieldWeights)}));i.sort(function(n,p){return p.matchWeight-n.matchWeight});return i}};return h}();
SLICK.Geo.Search=function(){return{bestResults:function(o,f){f||(f=20);for(var j=o.length>0?o[0]:null,e=[],k=0;k<o.length;k++)if(j.matchWeight-o[k].matchWeight<=f)e.push(o[k]);else break;return e}}}();
SLICK.Mapping=function(){var o={AnnotationTween:null,GeoTileGrid:function(f){f=GRUNT.extend({grid:null,centerPos:new SLICK.Geo.Position,centerXY:new SLICK.Vector,radsPerPixel:0},f);var j=f.centerPos.getMercatorPixels(f.radsPerPixel),e=new SLICK.Vector(j.x-f.centerXY.x,j.y-f.centerXY.y),k=GRUNT.extend({},f.grid,{getBoundingBox:function(d,c,b,h){return new SLICK.Geo.BoundingBox(k.pixelsToPos(new SLICK.Vector(d,c+h)),k.pixelsToPos(new SLICK.Vector(d+b,c)))},getCenterOffset:function(){return f.centerXY},
getGridXYForPosition:function(d){var c=d.getMercatorPixels(f.radsPerPixel);d=c.x-e.x;c=k.getDimensions().height-(c.y-e.y);return new SLICK.Vector(d,c)},getGuideOffset:function(d){var c=k.getTileSize();return new SLICK.Vector(d.x%c,d.y%c)},pixelsToPos:function(d){var c=new SLICK.Geo.Position,b=e.x+d.x;d=e.y+k.getDimensions().height-d.y;c.setMercatorPixels(b,d,f.radsPerPixel);return c}});return k},POIViewLayer:function(f){GRUNT.extend({},f)},Overlay:function(f){GRUNT.extend({},f);return{}},RadarOverlay:function(f){f=
GRUNT.extend({radarFill:"rgba(0, 221, 238, 0.1)",radarStroke:"rgba(0, 102, 136, 0.3)",zindex:100},f);return GRUNT.extend(new SLICK.Graphics.ViewLayer(f),{draw:function(j,e,k){e=k.width>>1;k=k.height>>1;j.fillStyle=f.radarFill;j.strokeStyle=f.radarStroke;j.beginPath();j.arc(e,k,50,0,Math.PI*2,false);j.fill();j.stroke()}})},CrosshairOverlay:function(f){f=GRUNT.extend({lineWidth:1.5,strokeStyle:"rgba(0, 0, 0, 0.5)",size:15,zindex:150,scalePosition:false,validStates:SLICK.Graphics.DisplayState.ACTIVE|
SLICK.Graphics.DisplayState.ANIMATING|SLICK.Graphics.DisplayState.PAN},f);return GRUNT.extend(new SLICK.Graphics.ViewLayer(f),{draw:function(j,e,k){e=k.getCenter();j.lineWidth=f.lineWidth;j.strokeStyle=f.strokeStyle;k=f.size;j.beginPath();j.moveTo(e.x,e.y-k);j.lineTo(e.x,e.y+k);j.moveTo(e.x-k,e.y);j.lineTo(e.x+k,e.y);j.arc(e.x,e.y,k*0.6666,0,2*Math.PI,false);j.stroke()}})},RouteOverlay:function(f){f=GRUNT.extend({strokeStyle:"rgba(0, 51, 119, 0.9)",waypointFillStyle:"#FFFFFF",lineWidth:4,data:null,
pixelGeneralization:8,zindex:50,validStates:SLICK.Graphics.DisplayState.GENCACHE},f);var j=[],e=[],k=GRUNT.extend(new SLICK.Graphics.ViewLayer(f),{draw:function(d,c){var b;b=j.length;d.strokeStyle=f.strokeStyle;d.lineWidth=f.lineWidth;d.beginPath();d.moveTo(j[b-1].x-c.x,j[b-1].y-c.y);for(b=b;b--;)d.lineTo(j[b].x-c.x,j[b].y-c.y);d.stroke();d.fillStyle=f.waypointFillStyle;for(b=e.length;b--;){d.beginPath();d.arc(e[b].x-c.x,e[b].y-c.y,2,0,Math.PI*2,false);d.stroke();d.fill()}}});return GRUNT.extend(k,
{getAnimation:function(d,c,b,h){return new SLICK.Graphics.AnimatedPathLayer({path:j,zindex:f.zindex+1,easing:d?d:SLICK.Animation.Easing.Sine.InOut,duration:c?c:5E3,drawIndicator:b,autoCenter:h?h:false})},calcCoordinates:function(d){j=[];e=[];var c,b,h=null,a,g=f.data?f.data.getGeometry():[],l=f.data?f.data.getInstructions():[];for(c=g.length;c--;){b=d.getGridXYForPosition(g[c]);if(a=!h||c===0||Math.abs(b.x-h.x)+Math.abs(b.y-h.y)>f.pixelGeneralization){j.unshift(b);h=b}}h=null;for(c=l.length;c--;)if(l[c].position){b=
d.getGridXYForPosition(l[c].position);if(a=!h||c===0||Math.abs(b.x-h.x)+Math.abs(b.y-h.y)>f.pixelGeneralization){e.push(b);h=b}}GRUNT.Log.info("geometry = "+g.length+", coordinates = "+j.length+", instructions = "+e.length)}})},Annotation:function(f){f=GRUNT.extend({xy:null,pos:null,draw:null,tweenIn:o.AnnotationTween},f);var j=false,e={xy:f.xy,pos:f.pos,isNew:false,isAnimating:function(){return j},draw:function(k,d){if(e.xy){if(e.isNew&&f.tweenIn){var c=e.xy.y;e.xy.y=d.y-20;j=true;SLICK.Animation.tween(e.xy,
"y",c,f.tweenIn,function(){e.xy.y=c;j=false},250+Math.random()*500)}if(f.draw)f.draw(k,d,new SLICK.Vector(e.xy.x-d.x,e.xy.y-d.y));else{k.beginPath();k.arc(e.xy.x-d.x,e.xy.y-d.y,4,0,Math.PI*2,false);k.fill()}e.isNew=false}}};return e},ImageAnnotation:function(f){f=GRUNT.extend({imageUrl:null},f);var j=null,e=new SLICK.Vector;f.draw=function(k,d,c){if(j){d=c.offset(e.x,e.y);k.drawImage(j,d.x,d.y,j.width,j.height)}};SLICK.Resources.loadImage(f.imageUrl,function(k){if(j=k){e.x=-j.width>>1;e.y=-j.height>>
1}});return new o.Annotation(f)},AnnotationsOverlay:function(f){function j(b){for(var h=f.map?f.map.getTileLayer():null,a=0;h&&a<b.length;a++)b[a].xy=h.getGridXYForPosition(b[a].pos)}f=GRUNT.extend({pois:null,map:null,createAnnotationForPOI:null,validStates:SLICK.Graphics.DisplayState.GENCACHE,zindex:100},f);var e=[],k=false,d=[],c=GRUNT.extend(new SLICK.Graphics.ViewLayer(f),{draw:function(b,h){b.save();try{var a;k=false;b.fillStyle="rgba(255, 0, 0, 0.75)";b.globalCompositeOperation="source-over";
for(a=e.length;a--;){e[a].draw(b,h);k=k||e[a].isAnimating()}for(a=d.length;a--;){d[a].draw(b,h);k=k||e[a].isAnimating()}if(k){c.layerChanged();c.wakeParent()}}finally{b.restore()}},add:function(b){d.push(b);j(d)},calcCoordinates:function(){j(e);j(d)},isAnimating:function(){return k}});GRUNT.WaterCooler.listen("geo.pois-updated",function(b){if(f.pois&&f.pois.id==b.srcID){b=b.pois;try{e=[];for(var h=0;h<b.length;h++)if(b[h].pos){var a;var g=b[h];if(g&&g.pos){var l=null;if(l=f.createAnnotationForPOI?
f.createAnnotationForPOI(g):new o.Annotation({pos:g.pos})){l.isNew=g.isNew;g.isNew=false}a=l}else a=void 0;a&&e.push(a)}j(e)}catch(i){GRUNT.Log.exception(i)}c.layerChanged();c.wakeParent()}});return c},Tiler:function(f){function j(){var m=i.getTileLayer(),n=i.getDimensions();if(m)return m.getGuideOffset(i.getOffset().offset(n.width>>1,n.height>>1));return null}f=GRUNT.extend({tapExtent:10,provider:null,crosshair:true,copyright:undefined,zoomLevel:0,boundsChange:null,tapPOI:null,boundsChangeThreshold:30,
pois:new SLICK.Geo.POIStorage,createAnnotationForPOI:null},f);if(typeof f.copyright==="undefined")f.copyright=f.provider?f.provider.getCopyright():"";var e=new SLICK.Vector,k=f.copyright,d=false,c=[],b=null,h=f.zoomLevel;if(!f.provider)f.provider=new SLICK.Geo.MapProvider;var a=f.panHandler,g=f.tapHandler;f.onPan=function(m,n){a&&a(m,n)};f.tapHandler=function(m,n){var p=i.getTileLayer(),q=null;if(p){var r=i.viewPixToGridPix(new SLICK.Vector(n.x,n.y));q=p.pixelsToPos(r.offset(-f.tapExtent,f.tapExtent));
p=p.pixelsToPos(r.offset(f.tapExtent,-f.tapExtent));q=new SLICK.Geo.BoundingBox(q.toString(),p.toString());c=i.pois.findByBounds(q);GRUNT.Log.info("TAPPED POIS = ",c);f.tapPOI&&f.tapPOI(c)}g&&g(m,n,q)};f.doubleTapHandler=function(m,n){i.animate(2,i.getDimensions().getCenter(),new SLICK.Vector(n.x,n.y),SLICK.Animation.Easing.Sine.Out)};f.onScale=function(m,n){var p=0;m=Math.sqrt(m);if(m<1)p=-(0.5/m);else if(m>1)p=m;i.removeLayer("grid");SLICK.Resources.resetImageLoadQueue();i.gotoPosition(i.getXYPosition(n),
h+Math.floor(p));GRUNT.Log.info("zoom change = "+Math.floor(p)+", new zoom level = "+(h+Math.floor(p)))};var l=new SLICK.Tiling.Tiler(f);l.registerLayerListener(function(m,n,p){if(p){p.calcCoordinates&&p.calcCoordinates(i.getTileLayer());if(/grid\d+/.test(n))if(m=="add"||m=="offset-changed")i.eachLayer(function(r){r.calcCoordinates&&r.calcCoordinates(p)})}else{var q=i.getTileLayer();q&&i.eachLayer(function(r){r.calcCoordinates&&r.calcCoordinates(q)})}});var i=GRUNT.extend({},l,{pois:f.pois,getBoundingBox:function(){var m=
new SLICK.Geo.BoundingBox,n=i.getTileLayer(),p=i.getOffset(),q=i.getDimensions();if(n)m=n.getBoundingBox(p.x,p.y,q.width,q.height);return m},getCenterPosition:function(){return i.getXYPosition(i.getDimensions().getCenter())},getXYPosition:function(m){return i.getTileLayer().pixelsToPos(i.viewPixToGridPix(m))},gotoBounds:function(m,n){var p=SLICK.Geo.getBoundingBoxZoomLevel(m,i.getDimensions());GRUNT.Log.info("BOUNDS CHANGE REQUIRED CENTER: "+m.getCenter()+", ZOOM LEVEL: "+p);i.gotoPosition(m.getCenter(),
p,n)},gotoPosition:function(m,n,p){var q=h,r=2*Math.PI/(1<<h)/(2*Math.PI/(1<<n));h=n?n:h;if(!h)throw"Zoom level required to goto a position.";if(f.provider)h=f.provider.checkZoomLevel(h);if(!d||h!=q){SLICK.Animation.cancel();if(d){b=j(r);GRUNT.Log.info("guide offset calculated as: "+b)}f.provider.zoomLevel=h;f.provider.getMapTiles(i,m,function(t){i.setTileLayer(t);i.panToPosition(m,function(){p&&p()})});d=true}else i.panToPosition(m,p)},panToPosition:function(m,n,p){var q=i.getTileLayer();if(q){m=
q.getGridXYForPosition(m);q=i.getDimensions();m.x-=q.width>>1;m.y-=q.height>>1;if(b)b=null;i.updateOffset(m.x,m.y,p);f.boundsChange&&f.boundsChange(i.getBoundingBox());n&&n(i)}},setZoomLevel:function(m){i.gotoPosition(i.getCenterPosition(),m)},zoomIn:function(){GRUNT.Log.info("scaling needed is "+2*Math.PI/(1<<h)/(2*Math.PI/(1<<h+1)));i.scale(2,SLICK.Animation.Easing.Sine.Out)||i.setZoomLevel(h+1)},zoomOut:function(){GRUNT.Log.info("scaling needed is "+2*Math.PI/(1<<h)/(2*Math.PI/(1<<h-1)));i.scale(0.5,
SLICK.Animation.Easing.Sine.Out)||i.setZoomLevel(h-1)},animateRoute:function(m,n,p,q){var r=i.getLayer("route");r&&r.getAnimation(m,n,p,q).addToView(i)}},l);l=new SLICK.Mapping.AnnotationsOverlay({pois:i.pois,map:i,createAnnotationForPOI:f.createAnnotationForPOI});i.setLayer("annotations",l);f.crosshair&&i.setLayer("crosshair",new SLICK.Mapping.CrosshairOverlay);k&&i.setLayer("copyright",new SLICK.Graphics.ViewLayer({zindex:999,draw:function(m,n,p){m.lineWidth=2.5;m.fillStyle="rgb(50, 50, 50)";m.strokeStyle=
"rgba(255, 255, 255, 0.8)";m.font="bold 10px sans";m.textBaseline="bottom";m.strokeText(k,10,p.height-10);m.fillText(k,10,p.height-10)}}));GRUNT.WaterCooler.listen("view-idle",function(m){if(m.id&&m.id==i.id)if(e.diff(i.getOffset()).getAbsSize()>f.boundsChangeThreshold&&f.boundsChange){e=i.getOffset();f.boundsChange(i.getBoundingBox())}});return i}};return o}();
SLICK.Geo.Routing=function(){var o={calculate:function(f){f=GRUNT.extend({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null},f);GRUNT.Log.info("attempting to calculate route");var j=SLICK.Geo.getEngine("route");j&&j.route(f,function(e){if(f.map){o.createMapOverlay(f.map,e);if(f.autoFit){GRUNT.Log.info("AUTOFITTING MAP TO ROUTE: bounds = "+e.getBoundingBox());f.map.gotoBounds(e.getBoundingBox())}}f.success&&f.success(e)})},createMapOverlay:function(f,j){var e=f.getDimensions();
e=new SLICK.Mapping.RouteOverlay({data:j,width:e.width,height:e.height});f.setLayer("route",e)},Maneuver:{None:0,Continue:1,TurnLeft:100,TurnLeftSlight:101,TurnLeftSharp:102,TurnRight:110,TurnRightSlight:111,TurnRightSharp:112,TurnAround:190,EnterRoundabout:200,ExitRamp:300},Instruction:function(f){f=GRUNT.extend({position:null,description:"",manuever:o.Maneuver.None},f);return GRUNT.extend(f,{})},RouteData:function(f){f=GRUNT.extend({geometry:[],instructions:[],boundingBox:null},f);for(var j=Array(f.geometry.length),
e=f.boundingBox,k=0;k<f.geometry.length;k++)j[k]=new SLICK.Geo.Position(f.geometry[k]);e||(e=SLICK.Geo.getBoundsForPositions(j));return{getGeometry:function(){return j},getBoundingBox:function(){return e},getInstructions:function(){return f.instructions}}}};return o}();
