if(!this.JSON)this.JSON={};
(function(){function c(e){return e<10?"0"+e:e}function m(e){a.lastIndex=0;return a.test(e)?'"'+e.replace(a,function(j){var k=b[j];return typeof k==="string"?k:"\\u"+("0000"+j.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function g(e,j){var k,l,s,n,q=f,v,p=j[e];if(p&&typeof p==="object"&&typeof p.toJSON==="function")p=p.toJSON(e);if(typeof i==="function")p=i.call(j,e,p);switch(typeof p){case "string":return m(p);case "number":return isFinite(p)?String(p):"null";case "boolean":case "null":return String(p);
case "object":if(!p)return"null";f+=h;v=[];if(Object.prototype.toString.apply(p)==="[object Array]"){n=p.length;for(k=0;k<n;k+=1)v[k]=g(k,p)||"null";s=v.length===0?"[]":f?"[\n"+f+v.join(",\n"+f)+"\n"+q+"]":"["+v.join(",")+"]";f=q;return s}if(i&&typeof i==="object"){n=i.length;for(k=0;k<n;k+=1){l=i[k];if(typeof l==="string")if(s=g(l,p))v.push(m(l)+(f?": ":":")+s)}}else for(l in p)if(Object.hasOwnProperty.call(p,l))if(s=g(l,p))v.push(m(l)+(f?": ":":")+s);s=v.length===0?"{}":f?"{\n"+f+v.join(",\n"+f)+
"\n"+q+"}":"{"+v.join(",")+"}";f=q;return s}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+c(this.getUTCMonth()+1)+"-"+c(this.getUTCDate())+"T"+c(this.getUTCHours())+":"+c(this.getUTCMinutes())+":"+c(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
a=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f,h,b={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},i;if(typeof JSON.stringify!=="function")JSON.stringify=function(e,j,k){var l;h=f="";if(typeof k==="number")for(l=0;l<k;l+=1)h+=" ";else if(typeof k==="string")h=k;if((i=j)&&typeof j!=="function"&&(typeof j!=="object"||typeof j.length!=="number"))throw Error("JSON.stringify");return g("",
{"":e})};if(typeof JSON.parse!=="function")JSON.parse=function(e,j){function k(s,n){var q,v,p=s[n];if(p&&typeof p==="object")for(q in p)if(Object.hasOwnProperty.call(p,q)){v=k(p,q);if(v!==undefined)p[q]=v;else delete p[q]}return j.call(s,n,p)}var l;e=String(e);d.lastIndex=0;if(d.test(e))e=e.replace(d,function(s){return"\\u"+("0000"+s.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){l=eval("("+e+")");return typeof j==="function"?k({"":l},""):l}throw new SyntaxError("JSON.parse");}})();
GT=function(){var c=/\$\{(.*?)\}/ig,m=Object.prototype.hasOwnProperty,g=0,d={id:"GRUNT.core",extend:function(){var a=arguments[0]||{},f=1,h=arguments.length,b=false,i,e,j,k;if(typeof a==="boolean"){b=a;a=arguments[1]||{};f=2}if(typeof a!=="object"&&!d.isFunction(a))a={};if(h===f){a=this;--f}for(;f<h;f++)if((i=arguments[f])!=null)for(e in i){j=a[e];k=i[e];if(a!==k)if(b&&k&&(d.isPlainObject(k)||d.isArray(k))){j=j&&(d.isPlainObject(j)||d.isArray(j))?j:d.isArray(k)?[]:{};a[e]=d.extend(b,j,k)}else if(k!==
undefined)a[e]=k}return a},isFunction:function(a){return toString.call(a)==="[object Function]"},isArray:function(a){return toString.call(a)==="[object Array]"},isPlainObject:function(a){if(!a||toString.call(a)!=="[object Object]"||a.nodeType||a.setInterval)return false;if(a.constructor&&!m.call(a,"constructor")&&!m.call(a.constructor.prototype,"isPrototypeOf"))return false;var f;for(f in a);return f===undefined||m.call(a,f)},isEmptyObject:function(a){for(var f in a)return false;return true},isXmlDocument:function(a){return toString.call(a)===
"[object Document]"},contains:function(a,f){var h=a,b=arguments,i=1;if(f&&d.isArray(f)){b=f;i=0}for(i=i;i<b;i++)h=h&&typeof foo[b[i]]!=="undefined";return h},newModule:function(a){a=d.extend({id:null,requires:[],parent:null},a);if(a.parent)a=d.extend({},a.parent,a);return a},toID:function(a){return a.replace(/\s/g,"-")},objId:function(a){return(a?a:"obj")+g++},formatStr:function(a){if(arguments.length<=1)return a;for(var f=arguments.length-2,h=0;h<=f;h++)a=a.replace(RegExp("\\{"+h+"\\}","gi"),arguments[h+
1]);return a},wordExists:function(a,f){var h="";if(f.toString)f=f.toString();for(var b=0;b<f.length;b++)h+=!/\w/.test(f[b])?"\\"+f[b]:f[b];return RegExp("(^|\\s|\\,)"+h+"(\\,|\\s|$)","i").test(a)},parseTemplate:function(a,f){for(var h=c.exec(a);h;){a=a.replace(h[0],GT.XPath.first(h[1],f));c.lastIndex=0;h=c.exec(a)}return a}};return d}();
GT.Log=function(){function c(f,h){var b,i=h&&h.length>0?h[0]:"";for(b=1;h&&b<h.length;b++)i+=" "+(g&&GT.isPlainObject(h[b])?JSON.stringify(h[b]):h[b]);typeof console!=="undefined"&&console[f](i);for(b=0;b<m.length;b++)m[b].call(a,i,f)}var m=[],g=typeof JSON!=="undefined",d=window.console&&window.console.markTimeline,a={id:"GRUNT.log",getTraceTicks:function(){return d?(new Date).getTime():null},trace:function(f,h){if(d)console.markTimeline(f+(h?": "+(a.getTraceTicks()-h)+"ms":""))},debug:function(){c("debug",
arguments)},info:function(){c("info",arguments)},warn:function(){c("warn",arguments)},error:function(){c("error",arguments)},exception:function(f){a.error(arguments);for(var h in f)a.info("ERROR DETAIL: "+h+": "+f[h])},watch:function(f,h){try{h()}catch(b){a.exception(b,f)}},throwError:function(f){a.error(f);throw Error(f);},requestUpdates:function(f){m.push(f)}};return a}();
(function(){function c(g,d){var a=g.split("|"),f={};for(var h in d){var b=d[h];f[h]=a.length>b?a[b]:null}return f}var m={JSON:{parse:function(g){return JSON.parse(g)}},PDON:{parse:function(g){var d=null,a=[];g=g.split("\n");for(var f=0;f<g.length;f++){var h=g[f];if(d)a.push(c(h,d));else if(h){d=h.split("|");h={};for(var b=0;b<d.length;b++)h[d[b]]=b;d=h}else d=null}return a}}};GT.parseData=function(g,d){d=d?d.toUpperCase():"JSON";if(!m[d])throw Error("Unsupported data format: "+d);try{return m[d].parse(g)}catch(a){GT.Log.exception(a)}return{}}})();
(function(){function c(d,a){d[a]||(d[a]=function(f){return d.configure(a,f)})}function m(d){d.gtConfId=GT.objId("configurable");d.gtConfig={};d.gtConfigFns=[];return d.gtConfig}var g={};GT.paramTweaker=function(d,a,f){return function(h,b){if(typeof b!=="undefined"){if(h in d)d[h]=b;f&&h in f&&f[h](h,b)}else return a&&h in a?a[h](h):d[h]}};GT.configurable=function(d,a,f,h){if(d){d.gtConfId||m(d);var b=d.gtConfId,i=d.gtConfig,e=d.gtConfigFns;g[b]=d;e.push(f);for(f=a.length;f--;){i[a[f]]=true;h&&c(d,
a[f])}if(!d.configure)d.configure=function(j,k){if(i[j]){for(var l=e.length;l--;){var s=e[l](j,k);if(typeof s!=="undefined")return s}return g[b]}return null}}}})();
(function(){function c(a){var f=document.createElement("script"),h=false;f.src=a;f.async=true;f.onload=f.onreadystatechange=function(){if(!h&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){h=true;f.onload=f.onreadystatechange=null;f&&f.parentNode&&f.parentNode.removeChild(f)}};g||(g=document.getElementsByTagName("head")[0]);g.appendChild(f)}var m=0,g,d=this;GT.jsonp=function(a,f,h){a+=a.indexOf("?")>=0?"&":"?";var b="json"+ ++m;d[b]=function(i){f(i);d[b]=null;try{delete d[b]}catch(e){}};
c(a+(h?h:"callback")+"="+b);return b}})();
(function(){function c(){if(this.readyState===4){var b=null,i=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(i)if(params.handleResponse)params.handleResponse(this);else{var e=params,j=this.getResponseHeader(h.CONTENT_TYPE),k,l=false;for(k in m)if(j&&j.indexOf(m[k])>=0){l=true;break}j=!l;for(l=0;l<d.length;l++)j=j||d[l]==k;if(j)b:{j=k;for(var s in g)for(l=0;l<g[s].length;l++)if(RegExp(g[s][l]+"$","i").test(e.url)){k=
s;break b}k=j?j:"DEFAULT"}try{b=f[k](this,e)}catch(n){b=f.DEFAULT(this,e)}}else params.error&&params.error(this)}catch(q){GT.Log.exception(q,"PROCESSING AJAX RESPONSE")}i&&b&&params.success&&params.success.call(this,b)}}var m={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},g={JSON:["json"],PDON:["pdon.txt"]},d=["TEXT","STREAM"],a=/^(\w+:)?\/\/([^\/?#]+)/,f={XML:function(b){return b.responseXML},JSON:function(b){return GT.parseData(b.responseText)},PDON:function(b){return GT.parseData(b.responseText,
"PDON")},DEFAULT:function(b){return b.responseText}},h={CONTENT_TYPE:"Content-Type"};GT.xhr=function(b){try{b=GT.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},module.ajaxSettings,b);var i=a.exec(b.url),e=i&&(i[1]&&i[1]!==location.protocol||i[2]!==location.host);if(b.data)b.method="POST";if(b.url){i=null;if(b.xhr)i=b.xhr(b);i||(i=new XMLHttpRequest);i.open(b.method,b.url,b.async);b.data&&i.setRequestHeader("Content-Type",
b.contentType);e||i.setRequestHeader("X-Requested-With","XMLHttpRequest");i.onreadystatechange=c;i.send(b.method=="POST"?module.param(b.data):null)}else GT.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(j){GT.Log.exception(j)}}})();
GT.XPath=function(){function c(a){for(var f=null,h=0;h<m.length;h++)if(f=m[h](a))break;return f}var m=[],g=[null,function(a){return a.numberValue},function(a){return a.stringValue},function(a){return a.booleanValue},null,null,null,null,function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null},function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||GT.Log.warn("No XPATH support");var d={SearchResult:function(a){return{toString:function(){var f=
null;if(a){var h=null;if(a.resultType>=0&&a.resultType<g.length)h=g[a.resultType];if(h)f=h(a)}return f?f:""}}},first:function(a,f){var h=d.SearchResult,b;var i=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!i)i=XPathResult.ANY_TYPE;try{if(GT.isXmlDocument(f))b=f.evaluate(a,f,c,i,null);else{GT.Log.warn("attempted xpath expression: "+a+" on a non-xml document");b=null}}catch(e){GT.Log.warn("invalid xpath expression: "+a+" on node: "+f);b=null}return new h(b)},registerResolver:function(a){m.push(a)}};return d}();
(function(){function c(m,g){var d=m.gtObsHandlers;d[g]||(d[g]=[]);return d[g]}GT.observable=function(m){if(m){if(!m.gtObsHandlers)m.gtObsHandlers={};if(!(m.bind||m.trigger||m.unbind)){m.bind=function(g,d){var a=GT.objId("callback");c(m,g).push({fn:d,id:a});return a};m.trigger=function(g){var d=c(m,g);if(!d)return m;for(var a=d.length;a--;)d[a].fn.apply(self,Array.prototype.slice.call(arguments,1));return m};m.unbind=function(g,d){for(var a=c(m,g),f=0;a&&f<a.length;f++)if(a[f].id===d){a.splice(f,1);
break}return m}}}}})();(function(){var c={},m=[];GT.addPipe=function(g){g("pipe.test",{});m.push(g)};GT.listen=function(g,d){c[g]||(c[g]=[]);d&&c[g].push(d)};GT.say=function(g,d){var a;for(a=m.length;a--;)m[a](g,d);if(c[g])for(a=c[g].length;a--;)c[g][a](d)}})();
GT.Storage=function(){function c(m){if(m&&m=="session")return sessionStorage;return localStorage}return{get:function(m,g){var d=c(g).getItem(m);return/^(\{|\[).*(\}|\])$/.test(d)?JSON.parse(d):d},set:function(m,g,d){g=jQuery.isArray(g)||jQuery.isPlainObject(g)?JSON.stringify(g):g;c(d).setItem(m,g)},remove:function(m,g){c(g).removeItem(m)}}}();
GT.ParseRules=function(){var c=[];return{add:function(m,g){c.push({regex:m,handler:g})},each:function(m,g,d){function a(){f++;d&&f>=c.length&&d(g)}for(var f=0,h=0;h<c.length;h++){var b=c[h].regex,i=c[h].handler,e=false;if(b){b.lastIndex=-1;if((b=b.exec(m))&&i){e=true;i(b,g,a)&&a()}}e||a()}}}};
T5=function(){var c=function(h,b){return{x:h?h:0,y:b?b:0}},m=function(){function h(b){if(!b||b.length<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var i={edges:Array(b.length-1),accrued:Array(b.length-1),total:0},e=m.diff,j=0;j<b.length-1;j++){var k=e(b[j],b[j+1]);i.edges[j]=Math.sqrt(k.x*k.x+k.y*k.y);i.accrued[j]=i.total+i.edges[j];i.total+=i.edges[j]}return i}return{create:function(b,i){return new c(b,i)},add:function(){for(var b=new c,i=arguments.length;i--;){b.x+=
arguments[i].x;b.y+=arguments[i].y}return b},absSize:function(b){return Math.max(Math.abs(b.x),Math.abs(b.y))},diff:function(b,i){return new c(b.x-i.x,b.y-i.y)},copy:function(b){return b?new c(b.x,b.y):null},invert:function(b){return new c(-b.x,-b.y)},offset:function(b,i,e){return new c(b.x+i,b.y+(e?e:i))},edges:h,distance:function(b){return h(b).total},theta:function(b,i,e){e=Math.asin((b.y-i.y)/e);return b.x>i.x?e:Math.PI-e},pointOnEdge:function(b,i,e,j){i=new c(Math.cos(e)*j,Math.sin(e)*j);return new c(b.x-
i.x,b.y-i.y)},getRect:function(b){var i=b.length;if(i>1)return new g(Math.min(b[0].x,b[i-1].x),Math.min(b[0].y,b[i-1].y),Math.abs(b[0].x-b[i-1].x),Math.abs(b[0].y-b[i-1].y))},toString:function(b){return b.x+", "+b.y}}}(),g=function(h,b,i,e){return{origin:new c(h,b),dimensions:new a(i,e)}},d=function(){return{copy:function(h){return h?new g(h.origin.x,h.origin.y,h.dimensions.width,h.dimensions.height):null},getCenter:function(h){return new c(h.origin.x+h.dimensions.width/2,h.origin.y+h.dimensions.height/
2)}}}(),a=function(h,b){return{width:h?h:0,height:b?b:0}},f=function(){return{getAspectRatio:function(h){return h.height!==0?h.width/h.height:1},getCenter:function(h){return new c(h.width/2,h.height/2)},getSize:function(h){return Math.sqrt(Math.pow(h.width,2)+Math.pow(h.height,2))}}}();return{ex:GT.extend,newCanvas:function(h,b){var i=document.createElement("canvas");typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(i);i.width=h?h:0;i.height=b?b:0;return i},time:function(){return(new Date).getTime()},
Vector:c,V:m,Dimensions:a,D:f,Rect:g,R:d}}();
(function(){function c(){for(;j.length>0;){var l=j.shift();document.location=l}e=0}function m(l){for(var s=true,n=k.length;n--;)s=s&&l!=k[n];return s}function g(l,s){var n=[];for(var q in s)q&&n.push(q+"="+escape(s[q]));return"tile5://"+l+"/"+(n.length>0?"?"+n.join("&"):"")}function d(l,s){m(l)&&GT.Log.info("would push url: "+g(l,s))}function a(l,s){if(m(l)){j.push(g(l,s));e||(e=setTimeout(c,100))}}function f(){h={base:{name:"Unknown",eventTarget:document,supportsTouch:"createTouch"in document,imageCacheMaxSize:null,
getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:d,targetFps:null},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:a,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:a},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:a},android:{name:"Android OS <= 2.1",regex:/android/i,eventTarget:document.body,supportsTouch:true,getScaling:function(){return 1/
window.devicePixelRatio},bridgeNotify:a},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:a}};b=[h.froyo,h.android,h.ipod,h.iphone,h.ipad]}var h=null,b=[],i=null,e=0,j=[],k=["view.wake","tile.loaded"];T5.getConfig=function(){h||f();if(!i){GT.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var l=0;l<b.length;l++){var s=b[l];if(s.regex&&s.regex.test(navigator.userAgent)){i=T5.ex({},h.base,s);GT.Log.info("PLATFORM DETECTED AS: "+
i.name);break}}if(!i){GT.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");i=h.base}GT.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return i}})();
T5.Dispatcher=function(){var c=[],m={execute:function(g){var d=m.findAction(g);d&&d.execute.apply(d,Array.prototype.slice.call(arguments,1))},findAction:function(g){for(var d=c.length;d--;)if(c[d].id==g)return c[d];return null},getRegisteredActions:function(){return[].concat(c)},getRegisteredActionIds:function(){for(var g=[],d=c.length;d--;)c[d].id&&g.push(c[d].id);return g},registerAction:function(g){g&&g.id&&c.push(g)},Action:function(g){g=T5.ex({autoRegister:true,id:"",title:"",icon:"",execute:null},
g);var d={id:g.id,execute:function(){g.execute&&g.execute.apply(this,arguments)},getParam:function(a){return g[a]?g[a]:""},toString:function(){return GT.formatStr("{0} [title = {1}, icon = {2}]",d.id,g.title,g.icon)}};g.autoRegister&&m.registerAction(d);return d},Agent:function(g){g=GT.extend({name:"Untitled",translator:null,execute:null},g);var d={getName:function(){return g.name},getParam:function(a){return g[a]},getId:function(){return GT.toID(d.getName())},run:function(a,f){if(g.execute){var h=
g.translator?g.translator(a):a;g.execute.call(d,h,function(b,i){f&&f(b,i,h)})}}};return d},runAgents:function(g,d,a){for(var f=0;f<g.length;f++)g[f].run(d,a)}};return m}();
T5.Resources=function(){var c="",m={},g={getPath:function(d){return/^(file|https?|\/)/.test(d)?d:c+d},setBasePath:function(d){c=d},loadResource:function(d){d=T5.ex({filename:"",cacheable:true,dataType:null,callback:null},d);var a=function(f){d.callback&&GT.Log.watch("CALLING RESOURCE CALLBACK",function(){d.callback(f)})};d.cacheable&&m[d.filename]?a(m[d.filename]):GT.xhr({url:g.getPath(d.filename),dataType:d.dataType,success:function(f){if(d.cacheable)m[d.filename]=f;a(f)},error:function(f,h,b){GT.Log.error("error loading resource ["+
d.filename+"], error = "+b)}})},loadSnippet:function(d,a){/\.\w+$/.test(d)||(d+=".html");g.loadResource({filename:"snippets/"+d,callback:a,dataType:"html"})}};return g}();
T5.Images=function(){function c(){var n=f[this.id];if(n&&n.image.complete&&n.image.width>0){n.loaded=true;n.hitCount=1;for(var q=i.length;q--;)if(i[q].image.src==this.src){i.splice(q,1);break}if(n.background||n.postProcess)if(n.image){q=T5.newCanvas(n.realSize?n.realSize.width:image.width,n.realSize?n.realSize.height:image.height);var v=q.getContext("2d"),p=n.offset?n.offset:new T5.Vector;n.background&&v.drawImage(n.background,0,0);v.drawImage(n.image,p.x,p.y);n.postProcess&&n.postProcess(v,n);n.image=
q}n.loadCallback&&n.loadCallback(this,false);e.push({url:this.src,created:n.requested});delete f[this.id];m()}}function m(){for(var n=T5.getConfig().maxImageLoads;b.length>0&&(!n||i.length<n);){var q=b.shift();if(q.imageLoader){i.push(q);q.imageLoader(q,c)}}}function g(n){for(var q=null,v=j.length;v--&&!q;)q=j[v](n);return q?q:function(p,D){p.image.onload=D;p.image.src=T5.Resources.getPath(p.url);p.requested=T5.time()}}function d(){l=true;try{var n=Math.floor(e.length/2);if(n>0){e.sort(function(v,
p){return v.created-p.created});for(var q=n;q--;)delete a[e[q].url];e.splice(0,n)}}finally{l=false}GT.say("imagecache.cleared")}var a={},f={},h=0,b=[],i=[],e=[],j=[],k=0,l=false,s={avgImageSize:25,loadTimeout:10,addInterceptor:function(n){j.push(n)},cancelLoad:function(){i=[]},get:function(n){var q=null,v=null;l||(q=a[n]);if((v=q?q.image:null)&&(v.getContext||v.complete&&v.width>0))return v},load:function(n,q,v){var p=a[n];if(p){p.hitCount++;p.image.complete&&q&&q(p.image,true)}else{p=T5.ex({url:n,
image:new Image,loaded:false,imageLoader:g(n),created:T5.time(),requested:null,hitCount:0,loadCallback:q},v);p.image.id="resourceLoaderImage"+h++;a[n]=p;f[p.image.id]=p;b.push(p);m()}return p},stats:function(){return{imageLoadingCount:i.length,queuedImageCount:b.length,imageCacheFullness:k}}};setInterval(function(){for(var n=T5.time(),q=false,v=0,p=T5.getConfig();v<i.length;)if(n-i[v].requested>s.loadTimeout*1E3){i.splice(v,1);q=true}else v++;q&&m();if(p&&p.imageCacheMaxSize){k=e.length*s.avgImageSize/
p.imageCacheMaxSize;k>=1&&d()}},1E3);return s}();
(function(){function c(z,E){var I=z&&z.length>0?z[0]:null;if(I&&E&&E.length>0)return v(I,E[0]);return null}function m(z){z.preventDefault();z.stopPropagation()}function g(z){for(var E=Array(z.length),I=z.length;I--;)E[I]=n(z[I].pageX,z[I].pageY);return E}var d=120,a=100,f=250,h=300,b=5,i=2,e=0,j=1,k=7,l=0,s=0,n=T5.V.create,q=T5.V.distance,v=T5.V.diff,p=function(z){function E(t,C,w,o){var r=Math.asin((t.y-C.y)/w);w=Math.min(Math.floor(w*(Z.duration/o)),Z.max);r=C.x>t.x?r:Math.PI-r;t=n(Math.cos(r)*
-w,Math.sin(r)*w);B("inertiaPan",t.x,t.y)}function I(t,C){var w,o;if(G){w=C-$;if(w<f){o=q([O[0],t]);o>z.inertiaTrigger&&E(O[0],t,o,w)}}else{T=t;var r=setInterval(function(){w=T5.time()-C;o=q([t,T]);if(w<a&&o>z.inertiaTrigger){clearInterval(r);E(t,T,o,w)}else w>a&&clearInterval(r)},5)}}function u(t){for(var C=[],w=P?-P.offsetLeft:0,o=P?-P.offsetTop:0,r=t.length;r--;)C.push(T5.V.offset(t[r],w,o));return C}function B(){U&&U.trigger.apply(null,arguments)}function x(t){if(t.target&&t.target===P){O=G?g(t.touches):
[n(t.pageX,t.pageY)];X=n();W=n();L=true;M=false;$=T5.time();m(t);t.target.style.cursor="move";B("inertiaCancel");ba=$;if(t=O.length>0?O[0]:null){B("touchStart",t.x,t.y);if(ba-ea<h)if((t=R?T5.V.diff(O[0],R[0]):null)&&Math.abs(t.x)<z.maxDistDoubleTap&&Math.abs(t.y)<z.maxDistDoubleTap)M=true;V=e;R=[].concat(O)}else GT.Log.warn("Touch start fired, but no touch vector found")}}function F(t){if(t.target&&t.target===P){T=(G?g(t.touches):[n(t.pageX,t.pageY)])[0];if(L){G&&m(t);t=G?g(t.touches):[n(t.pageX,
t.pageY)];var C=0;if(t.length>1){if(O.length===1)O=[].concat(t);C=q(O)-q(t)}if(V===e){var w=c(t,O);if(w&&(Math.abs(w.x)>=k||Math.abs(w.y)>=k))V=j}if(V!==e)if(!C||Math.abs(C)<b){if(X=c(t,R)){W.x-=X.x;W.y-=X.y;S.x-=X.x;S.y-=X.y}if(T5.V.absSize(S)>i){B("pan",S.x,S.y);S=n()}V=j}else{B("pinchZoom",u(O),u(t));V=TOUCH_MODE_PINCH}R=[].concat(t)}}}function y(t){if(t.target&&t.target===P){var C=(G?g(t.changedTouches):[n(t.pageX,t.pageY)])[0];G&&m(t);var w=T5.time();ea=ba;if(V===e)J||(J=setTimeout(function(){J=
0;var o=M?"doubleTap":"tap",r=O[0],A=null;if(P)A=T5.V.offset(r,-P.offsetLeft,-P.offsetTop);B(o,r,A)},h+50));else if(V==j){B("panEnd",W.x,W.y);Z&&I(C,w)}else V==TOUCH_MODE_PINCH&&B("pinchZoomEnd",u(O),u(R),w-$);t.target.style.cursor="default";L=false}}function K(t){if(t.target&&t.target===P){var C;if(t.detail){C=-t.detail*d;C=n(t.axis===1?C:0,t.axis===2?C:0)}else C=n(t.wheelDeltaX,t.wheelDeltaY);var w=C.y!==0?Math.abs(C.y/d):0;if(T&&w!==0){var o=T5.V.offset(T,-P.offsetLeft,-P.offsetTop);B("wheelZoom",
o,Math.pow(2,C.y>0?w:-w))}t.preventDefault()}}z=T5.ex({element:null,observable:null,inertiaTrigger:20,maxDistDoubleTap:20,touchStartHandler:null,moveHandler:null,moveEndHandler:null,pinchZoomHandler:null,pinchZoomEndHandler:null,tapHandler:null,doubleTapHandler:null,wheelZoomHandler:null},z);var M=false,J=0,N=T5.getConfig(),G=T5.getConfig().supportsTouch,O=null,R=null,X=null,W=null,S=n(),V=null,L=false,$=0,Y=[],T=null,Z=null,ba=0,ea=0,P=z.element,U=z.observable,ga={supportsTouch:G,addListeners:function(t){Y.push(t)},
decoupleListeners:function(t){for(var C=0;t&&C<Y.length;C++)if(Y[C].listenerId===t){Y.splice(C,1);break}},release:function(){N.eventTarget.removeEventListener(G?"touchstart":"mousedown",x,false);N.eventTarget.removeEventListener(G?"touchmove":"mousemove",F,false);N.eventTarget.removeEventListener(G?"touchend":"mouseup",y,false);if(!G){window.removeEventListener("mousewheel",K,false);window.removeEventListener("DOMMouseScroll",K,false)}},inertiaEnable:function(t,C){Z={duration:t,max:C?Math.min(C.width,
C.height):500}},inertiaDisable:function(){Z=null}};N.eventTarget.addEventListener(G?"touchstart":"mousedown",x,false);N.eventTarget.addEventListener(G?"touchmove":"mousemove",F,false);N.eventTarget.addEventListener(G?"touchend":"mouseup",y,false);if(!G){window.addEventListener("mousewheel",K,false);window.addEventListener("DOMMouseScroll",K,false)}return ga},D=[];T5.captureTouch=function(z,E){if(!z)throw Error("Unable to capture touch of null element");if(!z.id)z.id="touchable_"+l++;var I=D[z.id];
if(!I){I=new p(T5.ex({element:z},E));D[z.id]=I}E.listenerId&&I.decoupleListeners(E.listenerId);E.listenerId=++s;I.addListeners(E);return I};T5.resetTouch=function(z){if(z&&z.id&&D[z.id]){D[z.id].release();delete D[z.id]}}})();
(function(){var c=Math.PI*2,m=Math.PI/2,g=Math.abs,d=Math.pow,a=Math.sin,f=Math.asin,h=Math.cos,b=1.70158,i={linear:function(e,j,k,l){return k*e/l+j},backin:function(e,j,k,l){return k*(e/=l)*e*((b+1)*e-b)+j},backout:function(e,j,k,l){return k*((e=e/l-1)*e*((b+1)*e+b)+1)+j},backinout:function(e,j,k,l){return(e/=l/2)<1?k/2*e*e*(((b*=1.525)+1)*e-b)+j:k/2*((e-=2)*e*(((b*=1.525)+1)*e+b)+2)+j},bouncein:function(e,j,k,l){return k-i.bounceout(l-e,0,k,l)+j},bounceout:function(e,j,k,l){return(e/=l)<1/2.75?
k*7.5625*e*e+j:e<2/2.75?k*(7.5625*(e-=1.5/2.75)*e+0.75)+j:e<2.5/2.75?k*(7.5625*(e-=2.25/2.75)*e+0.9375)+j:k*(7.5625*(e-=2.625/2.75)*e+0.984375)+j},bounceinout:function(e,j,k,l){return e<l/2?i.bouncein(e*2,0,k,l)/2+j:i.bounceout(e*2-l,0,k,l)/2+k/2+j},cubicin:function(e,j,k,l){return k*(e/=l)*e*e+j},cubicout:function(e,j,k,l){return k*((e=e/l-1)*e*e+1)+j},cubicinout:function(e,j,k,l){if((e/=l/2)<1)return k/2*e*e*e+j;return k/2*((e-=2)*e*e+2)+j},elasticin:function(e,j,k,l,s,n){if(e==0)return j;if((e/=
l)==1)return j+k;n||(n=l*0.3);if(!s||s<g(k)){s=k;k=n/4}else k=n/c*f(k/s);return-(s*d(2,10*(e-=1))*a((e*l-k)*c/n))+j},elasticout:function(e,j,k,l,s,n){var q;if(e==0)return j;if((e/=l)==1)return j+k;n||(n=l*0.3);if(!s||s<g(k)){s=k;q=n/4}else q=n/c*f(k/s);return s*d(2,-10*e)*a((e*l-q)*c/n)+k+j},elasticinout:function(e,j,k,l,s,n){var q;if(e==0)return j;if((e/=l/2)==2)return j+k;n||(n=l*0.3*1.5);if(!s||s<g(k)){s=k;q=n/4}else q=n/c*f(k/s);if(e<1)return-0.5*s*d(2,10*(e-=1))*a((e*l-q)*c/n)+j;return s*d(2,
-10*(e-=1))*a((e*l-q)*c/n)*0.5+k+j},quadin:function(e,j,k,l){return k*(e/=l)*e+j},quadout:function(e,j,k,l){return-k*(e/=l)*(e-2)+j},quadinout:function(e,j,k,l){if((e/=l/2)<1)return k/2*e*e+j;return-k/2*(--e*(e-2)-1)+j},sinein:function(e,j,k,l){return-k*h(e/l*m)+k+j},sineout:function(e,j,k,l){return k*a(e/l*m)+j},sineinout:function(e,j,k,l){return-k/2*(h(Math.PI*e/l)-1)+j}};T5.easing=function(e){return i[e.replace(/[\-\_\s\.]/g,"").toLowerCase()]};T5.registerEasingType=function(e,j){i[e.replace(/[\-\_\s\.]/g,
"").toLowerCase()]=j}})();
T5.Tween=function(c){c=T5.ex({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:T5.easing("sine.out"),complete:null,cancelOnInteract:false},c);var m=T5.time(),g=[],d=false,a=0,f=0,h={cancelOnInteract:c.cancelOnInteract,isComplete:function(){return d},triggerComplete:function(b){c.complete&&c.complete(b)},update:function(b){try{var i=c.tweenFn(b-m,a,f,c.duration);if(c.target)c.target[c.property]=i;for(var e=g.length;e--;)g[e](i,void 0);if(d=m+c.duration<=b){if(c.target)c.target[c.property]=
c.tweenFn(c.duration,a,f,c.duration);for(var j=g.length;j--;)g[j](i,true)}}catch(k){GT.Log.exception(k)}},requestUpdates:function(b){g.push(b)}};a=c.target&&c.property&&c.target[c.property]?c.target[c.property]:c.startValue;if(typeof c.endValue!=="undefined")f=c.endValue-a;if(f==0)d=true;T5.wakeTweens();return h};
(function(){var c=[],m=false,g=0;T5.tweenValue=function(d,a,f,h,b){d=new T5.Tween({startValue:d,endValue:a,tweenFn:f,complete:h,duration:b});c.push(d);return d};T5.tween=function(d,a,f,h,b,i){d=new T5.Tween({target:d,property:a,endValue:f,tweenFn:h,duration:i,complete:b});c.push(d);return d};T5.tweenVector=function(d,a,f,h,b,i){var e=[];if(d){var j=d.x==a,k=d.y==f;j||e.push(T5.tween(d,"x",a,h,function(){(j=true)&&k&&b()},i));k||e.push(T5.tween(d,"y",f,h,function(){k=true;j&&k&&b()},i))}return e};
T5.cancelAnimation=function(d){if(!m){m=true;try{for(var a=0;a<c.length;)if(!d||d(c[a])){c[a].triggerComplete(true);c.splice(a,1)}else a++}finally{m=false}}};T5.isTweening=function(){return c.length>0};T5.wakeTweens=function(){if(g===0)g=setInterval(function(){var d;d=T5.time();if(!m){m=true;try{for(var a=0;a<c.length;)if(c[a].isComplete()){c[a].triggerComplete(false);c.splice(a,1)}else{c[a].update(d);a++}}finally{m=false}}d=c.length;if(d===0){clearInterval(g);g=0}},20)}})();
(function(){var c={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,PINCH:16,FREEZE:128};T5.viewState=function(){for(var m=0,g=arguments.length;g--;){var d=c[arguments[g].toUpperCase()];if(d)m|=d}return m}})();
T5.ViewLayer=function(c){c=T5.ex({id:"",zindex:0,supportFastDraw:false,validStates:T5.viewState("ACTIVE","ANIMATING","PAN","PINCH")},c);var m=null,g=c.id,d=T5.viewState("ACTIVE"),a=T5.ex({addToView:function(f){f.setLayer(g,a)},shouldDraw:function(f){var h=m?m.fastDraw&&f!==d:false;return(f&c.validStates)!==0&&(h?c.supportFastDraw:true)},cycle:function(){return 0},draw:function(){},remove:function(){GT.say("layer.remove",{id:g})},wakeParent:function(){m&&m.trigger("wake")},getId:function(){return g},
setId:function(f){g=f},getParent:function(){return m},setParent:function(f){m=f}},c);GT.observable(a);return a};
T5.View=function(c){function m(o,r,A,H){M=typeof A!=="undefined";U=ea;v();w.updateOffset(E.x+o,E.y+r,A,H)}function g(o,r){c.inertia&&m(o,r,c.panAnimationEasing,c.panAnimationDuration)}function d(){U=ba;M=false;setTimeout(v,50)}function a(o,r){S=ga(o);V=ga(r);var A=t(S.dimensions),H=t(V.dimensions);T=C(S);y=C(V);L=S&&A!==0?H/A:1}function f(o,r){a(o,r);if(W=L!==1){U=P;v()}}function h(o,r,A){a(o,r);if(c.adjustScaleFactor){L=c.adjustScaleFactor(L);GT.Log.info("scale factor adjusted to: "+L)}if(A<c.pinchZoomAnimateTrigger){k($,
L,T,l(),T5.easing("sine.out"),function(){i();L=1},300);L=$}else{i();L=1}}function b(o,r){w.zoom(o,Math.min(Math.pow(2,Math.round(Math.log(r))),8),500)}function i(){W=false;w.trigger("scale",L,S?l():y);U=ba;v()}function e(){if(D){T5.resetTouch(D);if(c.autoSize){D.height=window.innerHeight-D.offsetTop;D.width=window.innerWidth-D.offsetLeft}try{z=D.getContext("2d");z.globalCompositeOperation="source-over";z.clearRect(0,0,D.width,D.height)}catch(o){GT.Log.exception(o);throw Error("Could not initialise canvas on specified view element");
}Z=T5.captureTouch(D,{observable:w});c.inertia&&Z.inertiaEnable(c.panAnimationDuration,x);x=w.getDimensions();for(var r=p.length;r--;)layerContextChange(p[r]);v()}}function j(o,r){r.setId(o);r.added=T5.time();r.trigger("contextChanged",z);r.setParent(w);p.push(r);p.sort(function(A,H){var Q=H.zindex-A.zindex;if(Q===0)Q=H.added-A.added;return Q})}function k(o,r,A,H,Q,aa,ca){function fa(){aa&&aa();i();L=1;Y=null}W=true;T=T5.V.copy(A);y=T5.V.copy(H);S=null;if(Q)T5.tweenValue(0,r-o,Q,fa,ca?ca:1E3).requestUpdates(function(da){Y=
da/(r-o);L=o+da;U=P;v();w.trigger("animate")});else{L=targetScaleFactor;fa()}}function l(){var o=T5.D.getCenter(x),r=T5.V.distance([y,o]),A=T5.V.theta(y,o,r),H=T5.V.diff(T,y);o=T5.V.pointOnEdge(y,o,A,r/L);o.x+=H.x;o.y+=H.y;return o}function s(){w.trigger("idle");K=true;G=0}function n(o,r){var A=0,H=u?T5.viewState("FROZEN"):U,Q=T5.time(),aa=(H&P)!==0,ca=0;if(I||aa){o.clearRect(0,0,D.width,D.height);I=false}if(aa){T5.D.getCenter(x);var fa=(Y?Y:1)/2,da=T5.V.diff(T,y);if(R=S?new T5.Vector(y.x+da.x,y.y+
da.y):new T5.Vector(y.x-da.x*fa,y.y-da.y*fa))r=T5.V.offset(r,R.x,R.y)}o.save();try{$=L;if(B!==1)o.scale(B,B);else if(aa){o.translate(y.x,y.y);o.scale(L,L)}for(ca=p.length;ca--;)if(p[ca].shouldDraw(H)){var ha=p[ca].draw(o,r,x,H,w);A+=ha?ha:0}}finally{o.restore()}GT.Log.trace("draw complete",Q);N=false;return A}function q(){var o=0,r=!M&&(U===P||U===ea);X=T5.time();E.x=Math.floor(E.x);E.y=Math.floor(E.y);if(r){T5.cancelAnimation(function(H){return H.cancelOnInteract});K=false;if(G!==0){clearTimeout(G);
G=0}}for(r=p.length;r--;){var A=p[r].cycle(X,E,U);o+=A?A:0}o+=n(z,E);J=0;if(F+o>0)v();else if(!K&&G===0)G=setTimeout(s,500);GT.Log.trace("Completed draw cycle",X)}function v(){F++;if(!(u||J!==0)){F=0;J=setTimeout(q,0)}}c=T5.ex({id:GT.objId("view"),container:"",fastDraw:false,inertia:true,pannable:true,scalable:true,panAnimationEasing:T5.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:false},c);var p=[],D=document.getElementById(c.container),
z=null,E=new T5.Vector,I=false,u=false,B=1,x=null,F=0,y=null,K=false,M=false,J=0,N=false,G=0,O=0,R=null,X=0,W=false,S=null,V=null,L=1,$=1,Y=null,T=null,Z=null,ba=T5.viewState("ACTIVE"),ea=T5.viewState("PAN"),P=T5.viewState("PINCH"),U=ba,ga=T5.V.getRect,t=T5.D.getSize,C=T5.R.getCenter,w={id:c.id,deviceScaling:B,fastDraw:c.fastDraw||T5.getConfig().requireFastDraw,animate:function(o,r,A,H,Q){k(L,o,r,A,H,Q)},centerOn:function(o){w.setOffset(o.x-D.width/2,o.y-D.height/2)},getDimensions:function(){if(D)return new T5.Dimensions(D.width,
D.height)},getZoomCenter:function(){return R},getLayer:function(o){for(var r=0;r<p.length;r++)if(p[r].getId()==o)return p[r];return null},setLayer:function(o,r){for(var A=0;A<p.length;A++)if(p[A].getId()===o){p.splice(A,1);break}r&&j(o,r);v()},eachLayer:function(o){for(var r=0;r<p.length;r++)o(p[r])},clearBackground:function(){I=true},freeze:function(){u=true},unfreeze:function(){u=false;v()},needRepaint:function(){return N},snapshot:function(){},scale:function(o,r,A,H,Q){H||(H=T5.D.getCenter(x));
Q||(Q=T5.D.getCenter(x));w.animate(o,H,Q,r,A);return w},removeLayer:function(o){a:{for(var r=p.length;r--;)if(p[r].getId()==o){o=r;break a}o=-1}if(o>=0&&o<p.length){GT.say("layer.removed",{layer:p[o]});p.splice(o,1)}},getOffset:function(){return T5.V.copy(E)},setOffset:function(o,r){E.x=o;E.y=r},updateOffset:function(o,r,A,H,Q){function aa(){d(0,0);Q&&Q()}if(A){o=new T5.Vector(o,r);A=T5.tweenVector(E,o.x,o.y,A,aa,H);for(H=A.length;H--;){A[H].cancelOnInteract=true;A[H].requestUpdates(v)}}else w.setOffset(o,
r)},zoom:function(o,r,A){M=false;L=r;W=L!==1;T=T5.D.getCenter(w.getDimensions());y=L>1?T5.V.copy(o):T5.D.getCenter(w.getDimensions());S=null;clearTimeout(O);if(W){U=P;v();if(A)O=setTimeout(function(){i();L=1},parseInt(A,10))}}};GT.listen("layer.remove",function(o){o.id&&w.removeLayer(o.id)});B=T5.getConfig().getScaling();GT.observable(w);w.bind("wake",v);w.bind("invalidate",function(){N=true});if(c.pannable){w.bind("pan",m);w.bind("panEnd",d);w.bind("inertiaPan",g);w.bind("inertiaCancel",function(){M=
false;v()})}if(c.scalable){w.bind("pinchZoom",f);w.bind("pinchZoomEnd",h);w.bind("wheelZoom",b)}GT.configurable(w,["inertia","container"],GT.paramTweaker(c,null,{container:function(o,r){D=document.getElementById(r);e()}}),true);e();return w};
T5.AnimatedPathLayer=function(c){function m(b,i,e){b.fillStyle="#FFFFFF";b.strokeStyle="#222222";b.beginPath();b.arc(e.x,e.y,4,0,Math.PI*2,false);b.stroke();b.fill()}c=T5.ex({path:[],id:GT.objId("pathAni"),easing:T5.easing("sine.inout"),validStates:T5.viewState("ACTIVE","PAN","PINCH"),drawIndicator:null,duration:2E3,autoCenter:false},c);var g=T5.V.edges(c.path),d,a=null,f=0;T5.tweenValue(0,g.total,c.easing,function(){h.remove()},c.duration).requestUpdates(function(b,i){f=b;i&&h.remove()});var h=T5.ex(new T5.ViewLayer(c),
{cycle:function(){for(var b=0;b<g.accrued.length&&g.accrued[b]<f;)b++;a=null;if(b<c.path.length-1){var i=f-(b>0?g.accrued[b-1]:0),e=c.path[b],j=c.path[b+1];d=T5.V.theta(e,j,g.edges[b]);a=T5.V.pointOnEdge(e,j,d,i);if(c.autoCenter)(b=h.getParent())&&b.centerOn(a)}return a?1:0},draw:function(b,i){if(a)(c.drawIndicator?c.drawIndicator:m)(b,i,new T5.Vector(a.x-i.x,a.y-i.y),d)}});return h};
(function(){T5.tileSize=256;T5.Tile=function(c){return c=T5.ex({x:0,y:0,gridX:0,gridY:0,dirty:false},c)};T5.ImageTile=function(c){c=T5.ex({url:"",sessionParamRegex:null,loaded:false},c);return new T5.Tile(c)}})();
T5.TileGrid=function(c){function m(u,B){var x=T5.Vector(u*b-j.x,B*b-j.y);return new T5.ImageTile({gridX:x.x,gridY:x.y})}function g(u,B,x,F){var y=Math.floor(c.gridSize*0.2),K=new T5.Vector;if(u<0||u+x>c.gridSize)K.x=u<0?-y:y;if(B<0||B+F>c.gridSize)K.y=B<0?-y:y;return K}function d(u,B,x){var F=GT.Log.getTraceTicks(),y=0,K=c.gridSize,M=c.tileSize;new T5.Vector(K/2,K/2);if(x)f=[];if(u)for(x=0;x<K;x++)for(var J=0;J<K;J++){if(!f[y]){var N=u(J,x,i,K);N.gridX=J*M-j.x;N.gridY=x*M-j.y;f[y]=N}y++}e=u;k=B;GT.Log.trace("tile grid populated",
F);I.dirty=true;I.wakeParent()}function a(u,B){if(E){var x,F=[],y=new T5.Vector(Math.floor((u.x+j.x)*s),Math.floor((u.y+j.y)*s));tilesNeeded=false;for(var K=z;K--;)for(var M=D;M--;){x=M+y.x>=0&&M+y.x<c.gridSize?f[(K+y.y)*c.gridSize+(M+y.x)]:null;var J=new T5.Vector(M-E.x,K-E.y);if(!x){p=g(y.x,y.y,D,z);x=m(M+y.x,K+y.y)}F.push({tile:x,centerness:T5.V.absSize(J)})}F.sort(function(N,G){return G.centerness-N.centerness});q||(q=Array(F.length));for(x=F.length;x--;){q[x]=F[x].tile;I.prepTile(q[x],B)}}}c=
T5.ex({tileSize:T5.tileSize,drawGrid:false,center:new T5.Vector,gridSize:25,shiftOrigin:null,supportFastDraw:true},c);var f=Array(Math.pow(c.gridSize,2)),h=c.gridSize,b=c.tileSize,i=T5.V.offset(c.center,-Math.ceil(c.gridSize>>1)),e=null,j=new T5.Vector,k=null,l=Math.round(c.tileSize/2),s=c.tileSize?1/c.tileSize:0,n=true,q=null,v=false;new T5.Vector;var p=new T5.Vector;T5.getConfig();h=h*c.tileSize;var D,z,E,I=T5.ex(new T5.ViewLayer(c),{gridDimensions:new T5.Dimensions(h,h),dirty:false,cycle:function(u,
B,x){u=0;if(p.x!==0||p.y!==0){var F=p,y=c.shiftOrigin;if(!(F.x===0&&F.y===0)){var K=GT.Log.getTraceTicks(),M=Array(f.length);M.length=f.length;for(var J=0;J<c.gridSize;J++)for(var N=0;N<c.gridSize;N++)M[N*c.gridSize+J]=J+F.x>=0&&J+F.x<c.gridSize?f[(N+F.y)*c.gridSize+(J+F.x)]:null;f=M;i=y?y(i,F):T5.V.add(i,F);j.x+=-F.x*c.tileSize;j.y+=-F.y*c.tileSize;GT.Log.trace("tile storage shifted",K);d(e,k)}p=new T5.Vector;u++}x!==T5.viewState("PINCH")&&a(B,x);return u+I.dirty?1:0},deactivate:function(){n=false},
find:function(u){if(!u)return null;for(var B=f.length;B--;){var x=f[B];if(x&&u(x))return x}return null},prepTile:function(){},drawTile:function(){return false},getTileSize:function(){return c.tileSize},draw:function(u,B,x,F,y){if(n){var K=T5.time(),M=B.x;B=B.y;var J=true,N=y.needRepaint()||F===T5.viewState("PAN")||F===T5.viewState("PINCH")||T5.isTweening();if(!E){D=Math.ceil(x.width*s)+1;z=Math.ceil(x.height*s)+1;E=new T5.Vector(Math.floor((D-1)/2),Math.floor((z-1)/2))}if(q){if(c.drawGrid)u.strokeStyle=
"rgba(50, 50, 50, 0.3)";u.beginPath();for(x=q.length;x--;){var G=q[x];if(G){var O=G.gridX-M,R=G.gridY-B;if(!(N?false:!G.dirty)){J=I.drawTile(u,G,O,R,F)&&J;G.x=O;G.y=R}}else J=false;c.drawGrid&&u.rect(O,R,c.tileSize,c.tileSize)}u.stroke();GT.Log.trace("drawn tiles",K);J&&!v&&y.trigger("tileDrawComplete");v=J;I.dirty=false}}},getTileAtXY:function(u,B){for(var x=c.tileSize,F=q?q.length:0;F--;){var y=q[F];if(y&&u>=y.x&&B>=y.y)if(u<=y.x+x&&B<=y.y+x)return y}return null},getTileVirtualXY:function(u,B,x){u=
T5.V.add(new T5.Vector(u,B),T5.V.invert(i),j);u=new T5.Vector(u.x*c.tileSize,u.y*c.tileSize);if(x){u.x+=l;u.y+=l}return u},populate:function(u){d(u,null,true)}});GT.listen("imagecache.cleared",function(){for(var u=f.length;u--;)if(f[u])f[u].loaded=false});GT.listen("tiler.repaint",function(){for(var u=f.length;u--;)if(f[u]){f[u].x=null;f[u].y=null}});return I};
T5.ImageTileGrid=function(c){function m(){k.getParent().trigger("invalidate");k.dirty=true;k.wakeParent()}c=T5.ex({emptyTile:function(l){if(!g||l!==g.width){g=T5.newCanvas(l,l);l=g.getContext("2d");l.fillStyle="rgba(150, 150, 150, 0.01)";l.fillRect(0,0,g.width,g.height)}return g}(T5.tileSize),panningTile:function(l){function s(){var n=T5.newCanvas(32,32),q=n.getContext("2d");q.fillStyle="#BBBBBB";q.fillRect(0,0,32,32);q.fillStyle="#C3C3C3";q.fillRect(0,0,16,16);q.fillRect(16,16,16,16);return n}if(!d||
l!==d.width){d=T5.newCanvas(l,l);l=d.getContext("2d");l.fillStyle=l.createPattern(s(),"repeat");l.fillRect(0,0,d.width,d.height)}return d}(T5.tileSize),tileOffset:new T5.Vector,tileDrawArgs:{}},c);var g=c.emptyTile,d=c.panningTile,a=T5.viewState("ACTIVE"),f=T5.viewState("PAN"),h=T5.getConfig().requireFastDraw,b=c.tileSize?c.tileSize:T5.tileSize,i=T5.Images.get,e=T5.Images.load,j=T5.ex({background:null,overlay:null,offset:new T5.Vector,realSize:new T5.Dimensions(b,b)},c.tileDrawArgs),k=T5.ex(new T5.TileGrid(c),
{drawTile:function(l,s,n,q,v){var p=s.url?i(s.url):null,D=false;if(p){l.drawImage(p,n,q);s.dirty=false;D=true}else if(v===f)d&&l.drawImage(d,n,q);else g&&l.drawImage(g,n,q);return D},prepTile:function(l,s){if(l)l.dirty=true;if(l&&(!h||s===a))i(l.url)||e(l.url,m,j)}});return k};
T5.Tiler=function(c){c=T5.ex({container:"",drawCenter:false,datasources:{},tileLoadThreshold:"first"},c);var m=T5.ex(new T5.View(c),{getTileLayer:function(){return m.getLayer("grid0")},setTileLayer:function(g){m.setLayer("grid0",g);GT.say("grid.updated",{id:"grid0"})},viewPixToGridPix:function(g){var d=m.getOffset();return new T5.Vector(g.x+d.x,g.y+d.y)},centerOn:function(g,d,a,f){var h=m.getTileLayer(),b=m.getDimensions();(h=h?h.getTileSize():0)&&m.updateOffset(g.gridX-Math.floor((b.width-h)*0.5),
g.gridY-Math.floor((b.height-h)*0.5),d,a,f)},cleanup:function(){m.removeLayer("grid0")},repaint:function(){GT.say("tiler.repaint");m.trigger("wake")},select:function(g){m.trigger("selectTile",g)}});m.bind("tap",function(g,d){var a=m.getTileLayer();if(a)(a=a.getTileAtXY(d.x,d.y))&&m.trigger("selectTile",a)});return m};
