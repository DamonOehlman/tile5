COG=typeof COG!=="undefined"?COG:{};COG.extend=function(){for(var L=arguments[0]||{},Z,D=1,w=arguments.length;D<w;D++)if((Z=arguments[D])!==null)for(var j in Z){var l=Z[j];if(L!==l)if(l!==undefined)L[j]=l}return L};
(function(){var L=Object.prototype.hasOwnProperty,Z=0,D={};D.toID=function(w){return w.replace(/\s/g,"-")};D.objId=function(w){return(w?w:"obj")+Z++};D.isFunction=function(w){return toString.call(w)==="[object Function]"};D.isArray=function(w){return toString.call(w)==="[object Array]"};D.isPlainObject=function(w){if(!w||toString.call(w)!=="[object Object]"||w.nodeType||w.setInterval)return false;if(w.constructor&&!L.call(w,"constructor")&&!L.call(w.constructor.prototype,"isPrototypeOf"))return false;
var j;for(j in w);return j===undefined||L.call(w,j)};D.isEmptyObject=function(w){for(var j in w)return false;return true};D.isXmlDocument=function(w){return toString.call(w)==="[object Document]"};D.contains=function(w,j){var l=w,x=arguments,A=1;if(j&&module.isArray(j)){x=j;A=0}for(A=A;A<x;A++)l=l&&typeof foo[x[A]]!=="undefined";return l};D.formatStr=function(w){if(arguments.length<=1)return w;for(var j=arguments.length-2,l=0;l<=j;l++)w=w.replace(RegExp("\\{"+l+"\\}","gi"),arguments[l+1]);return w};
D.wordExists=function(w,j){var l="";if(j.toString)j=j.toString();for(var x=0;x<j.length;x++)l+=!/\w/.test(j[x])?"\\"+j[x]:j[x];return RegExp("(^|\\s|\\,)"+l+"(\\,|\\s|$)","i").test(w)};COG.extend(COG,D)})();
(function(){function L(l){return typeof console!=="undefined"?function(){console[l](Array.prototype.slice.call(arguments,0).join(" "));return true}:function(){return false}}var Z=window.console&&window.console.markTimeline,D=L("error"),w=L("info"),j=function(){return Z?function(l,x){console.markTimeline(l+(x?": "+((new Date).getTime()-x)+"ms":""))}:function(){}}();COG.extend(COG,{trace:j,debug:L("debug"),info:w,warn:L("warn"),error:D,exception:function(l){if(D)for(var x in l)w("ERROR DETAIL: "+x+
": "+l[x])}})})();
(function(){function L(D,w){var j=D.obsHandlers;j[w]||(j[w]=[]);return j[w]}var Z=0;COG.observable=function(D){if(!D)return null;if(!D.obsHandlers)D.obsHandlers={};if(!(D.bind||D.trigger||D.unbind)){D.bind=function(w,j){var l="callback"+Z++;L(D,w).unshift({fn:j,id:l});return l};D.triggerCustom=function(w,j){var l=L(D,w),x={cancel:false,name:w},A;j&&COG.extend(x,j);if(!l)return null;A=Array.prototype.slice.call(arguments,2);D.eventInterceptor&&D.eventInterceptor(w,x,A);A.unshift(x);for(var h=l.length;h--&&
!x.cancel;)l[h].fn.apply(this,A);return x};D.trigger=function(w){var j=Array.prototype.slice.call(arguments,1);j.splice(0,0,w,null);return D.triggerCustom.apply(this,j)};D.unbind=function(w,j){if(typeof w==="undefined")D.obsHandlers={};else for(var l=L(D,w),x=0;l&&x<l.length;x++)if(l[x].id===j){l.splice(x,1);break}return D}}return D}})();
(function(){function L(j,l){j[l]||(j[l]=function(x){return j.configure(l,x)})}function Z(j){j.gtConfId="configurable"+w++;j.gtConfig={};j.gtConfigFns=[];return j.gtConfig}var D={},w=0;COG.paramTweaker=function(j,l,x){return function(A,h){if(typeof h!=="undefined"){if(A in j)j[A]=h;x&&A in x&&x[A](A,h)}else return l&&A in l?l[A](A):j[A]}};COG.configurable=function(j,l,x,A){if(j){j.gtConfId||Z(j);var h=j.gtConfId,z=j.gtConfig,u=j.gtConfigFns;D[h]=j;u.push(x);for(x=l.length;x--;){z[l[x]]=true;A&&L(j,
l[x])}if(!j.configure)j.configure=function(C,N){if(z[C]){for(var o=u.length;o--;){var r=u[o](C,N);if(typeof r!=="undefined")return r}return D[h]}return null}}}})();
(function(){function L(j){var l=document.createElement("script"),x=false;l.src=j;l.async=true;l.onload=l.onreadystatechange=function(){if(!x&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){x=true;l.onload=l.onreadystatechange=null;l&&l.parentNode&&l.parentNode.removeChild(l)}};D||(D=document.getElementsByTagName("head")[0]);D.appendChild(l)}var Z=0,D,w=this;COG.jsonp=function(j,l,x){j+=j.indexOf("?")>=0?"&":"?";var A="json"+ ++Z;w[A]=function(h){l(h);w[A]=null;try{delete w[A]}catch(z){}};
L(j+(x?x:"callback")+"="+A);return A}})();
(function(){var L=1.70158,Z=Math.PI/2,D=Math.abs,w=Math.pow,j=Math.sin,l=Math.asin,x=Math.cos,A={linear:function(h,z,u,C){return u*h/C+z},backin:function(h,z,u,C){return u*(h/=C)*h*((L+1)*h-L)+z},backout:function(h,z,u,C){return u*((h=h/C-1)*h*((L+1)*h+L)+1)+z},backinout:function(h,z,u,C){return(h/=C/2)<1?u/2*h*h*(((L*=1.525)+1)*h-L)+z:u/2*((h-=2)*h*(((L*=1.525)+1)*h+L)+2)+z},bouncein:function(h,z,u,C){return u-A.bounceout(C-h,0,u,C)+z},bounceout:function(h,z,u,C){return(h/=C)<1/2.75?u*7.5625*h*h+
z:h<2/2.75?u*(7.5625*(h-=1.5/2.75)*h+0.75)+z:h<2.5/2.75?u*(7.5625*(h-=2.25/2.75)*h+0.9375)+z:u*(7.5625*(h-=2.625/2.75)*h+0.984375)+z},bounceinout:function(h,z,u,C){return h<C/2?A.bouncein(h*2,0,u,C)/2+z:A.bounceout(h*2-C,0,u,C)/2+u/2+z},cubicin:function(h,z,u,C){return u*(h/=C)*h*h+z},cubicout:function(h,z,u,C){return u*((h=h/C-1)*h*h+1)+z},cubicinout:function(h,z,u,C){if((h/=C/2)<1)return u/2*h*h*h+z;return u/2*((h-=2)*h*h+2)+z},elasticin:function(h,z,u,C,N,o){if(h==0)return z;if((h/=C)==1)return z+
u;o||(o=C*0.3);if(!N||N<D(u)){N=u;u=o/4}else u=o/TWO_PI*l(u/N);return-(N*w(2,10*(h-=1))*j((h*C-u)*TWO_PI/o))+z},elasticout:function(h,z,u,C,N,o){var r;if(h==0)return z;if((h/=C)==1)return z+u;o||(o=C*0.3);if(!N||N<D(u)){N=u;r=o/4}else r=o/TWO_PI*l(u/N);return N*w(2,-10*h)*j((h*C-r)*TWO_PI/o)+u+z},elasticinout:function(h,z,u,C,N,o){var r;if(h==0)return z;if((h/=C/2)==2)return z+u;o||(o=C*0.3*1.5);if(!N||N<D(u)){N=u;r=o/4}else r=o/TWO_PI*l(u/N);if(h<1)return-0.5*N*w(2,10*(h-=1))*j((h*C-r)*TWO_PI/o)+
z;return N*w(2,-10*(h-=1))*j((h*C-r)*TWO_PI/o)*0.5+u+z},quadin:function(h,z,u,C){return u*(h/=C)*h+z},quadout:function(h,z,u,C){return-u*(h/=C)*(h-2)+z},quadinout:function(h,z,u,C){if((h/=C/2)<1)return u/2*h*h+z;return-u/2*(--h*(h-2)-1)+z},sinein:function(h,z,u,C){return-u*x(h/C*Z)+u+z},sineout:function(h,z,u,C){return u*j(h/C*Z)+z},sineinout:function(h,z,u,C){return-u/2*(x(Math.PI*h/C)-1)+z}};COG.tweenValue=function(h,z,u,C,N){function o(S){var Q=S-r,da=u(Q,h,B,C),aa=r+C<=S;S=!aa;if(N){Q=N(da,aa,
Q);S=typeof Q!="undefined"?Q&&S:S}S&&animFrame(o)}var r=(new Date).getTime(),B=z-h;animFrame(o);return{}};COG.easing=function(h){return A[h.replace(/[\-\_\s\.]/g,"").toLowerCase()]};COG.registerEasingType=function(h,z){A[h.replace(/[\-\_\s\.]/g,"").toLowerCase()]=z}})();
(function(){var L=/^P(\d+Y)?(\d+M)?(\d+D)?$/,Z=/^(\d+H)?(\d+M)?(\d+S)?$/,D={8601:function(j){j=j.split("T");var l=null;l=null;var x=0,A=0;L.lastIndex=-1;l=L.exec(j[0]);x+=l[3]?parseInt(l[3].slice(0,-1),10):0;Z.lastIndex=-1;l=Z.exec(j[1]);A+=l[1]?parseInt(l[1].slice(0,-1),10)*3600:0;A+=l[2]?parseInt(l[2].slice(0,-1),10)*60:0;A+=l[3]?parseInt(l[3].slice(0,-1),10):0;return new w(x,A)}},w=COG.Duration=function(j,l){return{days:j?j:0,seconds:l?l:0}};COG.addDuration=function(){for(var j=new w,l=arguments.length;l--;){j.days+=
arguments[l].days;j.seconds+=arguments[l].seconds}if(j.seconds>=86400){j.days+=~~(j.seconds/86400);j.seconds%=86400}return j};COG.formatDuration=function(j){var l,x,A="";if(j.days)A=j.days+" days ";if(j.seconds){j=j.seconds;if(j>=3600){l=~~(j/3600);j-=l*3600}if(j>=60){x=Math.round(j/60);j-=x*60}if(l)A=A+l+(l>1?" hrs ":" hr ")+(x?(x>10?x:"0"+x)+" min ":"");else if(x)A=A+x+" min";else if(j>0)A=A+(j>10?j:"0"+j)+" sec"}return A};COG.parseDuration=function(j,l){var x=l?D[l]:null;if(x)return x(j);COG.Log.warn("Could not find duration parser for specified format: "+
l);return new w}})();
INTERACT=function(){function L(o){return function(r,B,S){(S?S:o?document.body:document).addEventListener(r,B,false)}}function Z(o){return function(r,B,S){(S?S:o?document.body:document).removeEventListener(r,B,false)}}function D(o,r,B){(B?B:document).attachEvent("on"+o,r)}function w(o,r,B){(B?B:document).detachEvent("on"+o,r)}function j(o,r){return{x:o?o:0,y:r?r:0,count:1}}function l(o,r){C.push(COG.extend({handler:null,checks:{},type:o},r))}function x(o){var r=0,B=0;if(o.offsetParent){do{r+=o.offsetLeft;
B+=o.offsetTop;o=o.offsetParent}while(o)}return{x:r,y:B}}function A(o,r){return{source:o,target:r.target?r.target:r.srcElement}}function h(o,r){for(var B=o.target?o.target:o.srcElement;B&&B!==r&&B.nodeName&&B.nodeName.toUpperCase()!="CANVAS";)B=B.parentNode;return B&&B===r}function z(o,r){return{x:o.x-(r?r.x:0),y:o.y-(r?r.y:0)}}function u(o){if(o.preventDefault){o.preventDefault();o.stopPropagation()}else o.cancelBubble&&o.cancelBubble()}var C=[],N=function(o,r,B){function S(O,T,R,J){var K=0,$=0,
s=0;COG.tweenValue(0,O,R,J,function(X){s=K;K=X});COG.tweenValue(0,T,R,J,function(X){Q.trigger("pan",K-s,X-$);$=X})}B=COG.extend({binder:null,unbinder:null,observable:null},B);for(var Q=B.observable,da=null,aa=[],V=[],ka,la,H={bind:function(){return Q.bind.apply(null,arguments)},pannable:function(O){da=COG.extend({inertia:true},O);return H},unbind:function(){Q.unbind();for(var O=0;O<aa.length;O++)aa[O].unbind();return H}},va=0;va<r.length;va++)aa.push(r[va](o,Q,B));Q.bind("pointerDown",function(){V=
[];la=ka=0});Q.bind("pointerMove",function(O,T,R,J){if(da){V[V.length]={ticks:(new Date).getTime(),x:J.x,y:J.y};Q.trigger("pan",J.x,J.y)}ka+=J.x?J.x:0;la+=J.y?J.y:0});Q.bind("pointerUp",function(O,T,R){if(Math.abs(ka)>20||Math.abs(la)>20){if(da){R=V.length;var J,K;T=0;for(K=V.length;--K>1&&T<50;)T+=V[K].ticks-V[K-1].ticks;if(R-K>1){O=V[R-1].x-V[K].x;J=V[R-1].y-V[K].y;K=Math.sqrt(O*O+J*J)|0;if(K>15){O=V[R-1].x-V[0].x;J=V[R-1].y-V[0].y;K=Math.sqrt(O*O+J*J)|0;R=Math.asin(J/K);T=K*500/T|0;T=T>300?300:
T;S(Math.cos(O>0?R:Math.PI-R)*T,Math.sin(R)*T,COG.easing("sine.out"),500)}}}}else Q.trigger("tap",T,R)});return H};l("pointer",{handler:function(o,r,B){function S(s){if(h(s,o))if(va=V(s)){o.style.cursor="move";u(s);K=s.pageX?s.pageX:s.screenX;$=s.pageY?s.pageY:s.screenY;O=j(K,$);T=x(o);r.triggerCustom("pointerDown",A("mouse",s),O,z(O,T))}}function Q(s){R=s.pageX?s.pageX:s.screenX;J=s.pageY?s.pageY:s.screenY;if(h(s,o))ka(s,va?"pointerMove":"pointerHover")}function da(s){if(va&&V(s)){va=false;if(h(s,
o)){o.style.cursor="default";ka(s,"pointerUp")}}}function aa(s){if(h(s,o)){var X;s=s||window.event;if(s.detail)X=s.axis===2?-s.detail*la:0;else{X=s.wheelDeltaY?s.wheelDeltaY:s.wheelDelta;if(window.opera)X=-X}if(X!==0){var ea=j(R,J);r.triggerCustom("zoom",A("mouse",s),ea,z(ea,x(o)),X/H,"wheel");u(s);s.returnValue=false}}}function V(s){s=s||window.event;return(s.which||s.button)==1}function ka(s,X,ea,oa,sa){ea=typeof ea!="undefined"?ea:R;oa=typeof oa!="undefined"?oa:J;var F=ea-K,P=oa-$,M=j(ea,oa);T||
(T=x(o));r.triggerCustom(X,A("mouse",s),M,z(M,T),j(F,P));if(typeof sa=="undefined"||sa){K=ea;$=oa}}B=COG.extend({},B);var la=120,H=la*8,va=false,O,T,R,J,K,$;B.binder("mousedown",S,false);B.binder("mousemove",Q,false);B.binder("mouseup",da,false);B.binder("dblclick",function(s){COG.info("captured double click");if(h(s,o)){var X=j(s.pageX?s.pageX:s.screenX,s.pageY?s.pageY:s.screenY);COG.info("captured double click + target matched");r.triggerCustom("doubleTap",A("mouse",s),X,z(X,x(o)))}},false);B.binder("mousewheel",
aa,document);B.binder("DOMMouseScroll",aa,document);return{unbind:function(){B.unbinder("mousedown",S,false);B.unbinder("mousemove",Q,false);B.unbinder("mouseup",da,false);B.unbinder("mousewheel",aa,document);B.unbinder("DOMMouseScroll",aa,document)}}},checks:{touch:false}});l("pointer",{handler:function(o,r,B){function S(F){if(F.count<2)return 0;var P=F.x-F.next.x;F=F.y-F.next.y;return~~Math.sqrt(P*P+F*F)}function Q(F,P,M){P=P?P:0;M=M?M:0;for(var pa={x:F.x-P,y:F.y-M,id:F.id,count:F.count},ta=pa;F.next;){F=
F.next;ta=ta.next={x:F.x-P,y:F.y-M,id:F.id}}return pa}function da(F,P){var M=F[P?P:"touches"],pa,ta;if(M.length===0)return null;ta=pa={x:M[0].pageX,y:M[0].pageY,id:M[0].identifier,count:M.length};for(var wa=1,La=M.length;wa<La;wa++)ta=ta.next={x:M[wa].pageX,y:M[wa].pageY,id:M[wa].identifier};return pa}function aa(F){if(h(F,o)){J=x(o);var P=da(F,"changedTouches"),M=Q(P,J.x,J.y);if(!$){K=O;r.triggerCustom("pointerDown",A("touch",F),P,M)}oa&&r.triggerCustom("pointerDownMulti",A("touch",F),P,M);$=da(F);
if($.count>1)X=S($);sa=1;ea=Q($)}}function V(F){if(h(F,o)){F.preventDefault();s=da(F);if(K==O)K=Math.abs($.x-s.x)>H||Math.abs($.y-s.y)>H?va:O;if(K!=O){K=s.count>1?R:T;if(K==R)if($.count===1){$=Q(s);X=S($)}else{var P=S(s);if(Math.abs(X-P)<la)K=T;else{var M;M=s.x;var pa=s.next.x,ta=s.y,wa=s.next.y,La=ta<wa?ta:wa;M={x:(M<pa?M:pa)+(Math.abs(M-pa)>>1),y:La+(Math.abs(ta-wa)>>1)};P=P/X;pa=P-sa;r.triggerCustom("zoom",A("touch",F),M,z(M,J),pa,"pinch");sa=P}}K==T&&r.triggerCustom("pointerMove",A("touch",F),
s,Q(s,J.x,J.y),j(s.x-ea.x,s.y-ea.y));oa&&r.triggerCustom("pointerMoveMulti",A("touch",F),s,Q(s,J.x,J.y))}ea=Q(s)}}function ka(F){if(h(F,o)){var P=da(F,"changedTouches"),M=Q(P,J.x,J.y);s=da(F);if(!s){K===O&&r.triggerCustom("tap",A("touch",F),P,M);r.triggerCustom("pointerUp",A("touch",F),P,M);$=null}oa&&r.triggerCustom("pointerUpMulti",A("touch",F),P,M)}}B=COG.extend({detailed:false,inertia:false},B);var la=20,H=7,va=0,O=1,T=2,R=3,J,K,$,s,X,ea,oa=B.detailed,sa=1;B.binder("touchstart",aa,false);B.binder("touchmove",
V,false);B.binder("touchend",ka,false);COG.info("initialized touch handler");return{unbind:function(){B.unbinder("touchstart",aa,false);B.unbinder("touchmove",V,false);B.unbinder("touchend",ka,false)}}},checks:{touch:true}});return{register:l,watch:function(o,r,B){r=COG.extend({bindToBody:false,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},r);capabilities=COG.extend({touch:"ontouchstart"in window},B);if(!r.observable){COG.info("creating observable");r.observable=COG.observable({});
globalOpts=r}r.binder=r.isIE?D:L(r.bindToBody);r.unbinder=r.isIE?w:Z(r.bindToBody);B=r.types;for(var S=capabilities,Q=[],da=C.length;da--;){var aa=C[da],V=!B||B.indexOf(aa.type)>=0,ka=true;for(var la in aa.checks){var H=aa.checks[la];COG.info("checking "+la+" capability. require: "+H+", capability = "+S[la]);ka=ka&&H===S[la]}if(V&&ka)Q[Q.length]=aa.handler}return new N(o,Q,r)}}}();
T5=function(){function L(){return(new Date).getTime()}function Z(){for(;s.length>0;){var b=s.shift();document.location=b}$=0}function D(b){for(var m=true,d=X.length;d--;)m=m&&b!=X[d];return m}function w(b,m){var d=[];for(var a in m)a&&d.push(a+"="+escape(m[a]));return"tile5://"+b+"/"+(d.length>0?"?"+d.join("&"):"")}function j(b,m){D(b)&&COG.info("would push url: "+w(b,m))}function l(b,m){if(D(b)){s.push(w(b,m));$||($=setTimeout(Z,100))}}function x(b){return function(m,d,a){(a?a:b?document.body:document).addEventListener(m,
d,false)}}function A(b){return function(m,d,a){(a?a:b?document.body:document).removeEventListener(m,d,false)}}function h(b,m,d){(d?d:document).attachEvent("on"+b,m)}function z(b,m,d){(d?d:document).detachEvent("on"+b,m)}function u(){R={base:{name:"Unknown",bindEvent:x(),unbindEvent:A(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:j,targetFps:null},ie:{name:"MSIE",regex:/msie/i,bindEvent:h,unbindEvent:z,
requireFastDraw:false,targetFps:25},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:l,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:l},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:l},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:x(true),unbindEvent:A(true),supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},bridgeNotify:l},
froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:l}};J=[R.froyo,R.android,R.ipod,R.iphone,R.ipad,R.ie]}function C(){R||u();if(!K){COG.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var b=0;b<J.length;b++){var m=J[b];if(m.regex&&m.regex.test(navigator.userAgent)){K=COG.extend({},R.base,m);COG.info("PLATFORM DETECTED AS: "+K.name);break}}if(!K){COG.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
K=R.base}COG.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return K}function N(){for(var b=0,m=arguments.length;m--;){var d=F[arguments[m].toUpperCase()];if(d)b|=d}return b}window.animFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b){setTimeout(function(){b((new Date).getTime())},1E3/60)}}();var o=Math.abs,r=Math.min,B=Math.max,S=Math.pow,
Q=Math.sqrt,da=Math.log,aa=Math.round,V=Math.sin,ka=Math.asin,la=Math.cos,H=function(){function b(a,c){return d(a.x-c.x,a.y-c.y)}function m(a,c){if(!c)c=a.length;if(c<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var g={edges:Array(c-1),accrued:Array(c-1),total:0},f=0;f<c-1;f++){var n=b(a[f],a[f+1]);g.edges[f]=Q(n.x*n.x+n.y*n.y);g.accrued[f]=g.total+g.edges[f];g.total+=g.edges[f]}return g}function d(a,c){return{x:a?a:0,y:c?c:0}}return{VECTOR_SIMPLIFICATION:3,
SIMPLIFICATION_MIN_VECTORS:25,add:function(){for(var a=0,c=0,g=arguments.length;g--;){a+=arguments[g].x;c+=arguments[g].y}return d(a,c)},absSize:function(a){return B(o(a.x),o(a.y))},copy:function(a){return a?d(a.x,a.y):null},diff:b,distance:function(a,c){return m(a,c).total},edges:m,equals:function(a,c){return a.x===c.x&&a.y===c.y},extendBy:function(a,c,g){var f=la(c)*g;c=V(c)*g;return d(a.x-f,a.y-c)},floor:function(a){for(var c=Array(a.length),g=a.length;g--;)c[g]=d(~~a[g].x,~~a[g].y);return c},
getRect:function(a){for(var c,g,f,n,k=a.length;k--;){var i=a[k];c=typeof c==="undefined"||i.x<c?i.x:c;g=typeof g==="undefined"||i.y<g?i.y:g;f=typeof f==="undefined"||i.x>f?i.x:f;n=typeof n==="undefined"||i.y>n?i.y:n}return O.init(c,g,f,n)},init:d,invert:function(a){return d(-a.x,-a.y)},min:function(a,c){return d(a.x<c.x?a.x:c.x,a.y<c.y?a.y:c.y)},max:function(a,c){return d(a.x>c.x?a.x:c.x,a.y>c.y?a.y:c.y)},offset:function(a,c,g){return d(a.x+c,a.y+(g?g:c))},simplify:function(a,c){if(!a)return null;
c=c?c:H.VECTOR_SIMPLIFICATION;for(var g=[],f=null,n=a.length;n--;){var k=a[n];if(include=!f||n===0||o(k.x-f.x)+o(k.y-f.y)>c){g.unshift(k);f=k}}return g},theta:function(a,c,g){g=ka((a.y-c.y)/g);return a.x>c.x?g:Math.PI-g},toString:function(a){return a?a.x+", "+a.y:""}}}(),va=function(){return{dotProduct:function(b,m){return b.x*m.x+b.y*m.y}}}(),O=function(){function b(d){return m(d.x1,d.y1,d.x2,d.y2)}function m(d,a,c,g){d=d?d:0;a=a?a:0;c=typeof c!=="undefined"?c:d;g=typeof g!=="undefined "?g:g;return{x1:d,
y1:a,x2:c,y2:g,width:c-d,height:g-a}}return{center:function(d){return H.init(d.x1+d.width/2,d.y1+d.height/2)},copy:b,diagonalSize:function(d){return Q(d.width*d.width+d.height*d.height)},fromCenter:function(d,a,c,g){c=c>>1;g=g>>1;return m(d-c,a-g,d+c,a+g)},init:m,intersect:function(d,a){var c=B(d.x1,a.x1),g=B(d.y1,a.y1),f=r(d.x2,a.x2),n=r(d.y2,a.y2);c=m(c,g,f,n);return c.width>0&&c.height>0?c:null},toString:function(d){return"["+d.x1+", "+d.y1+", "+d.x2+", "+d.y2+"]"},union:function(d,a){if(d.width===
0||d.height===0)return b(a);else if(a.width===0||a.height===0)return b(d);else{var c=r(d.x1,a.x1),g=r(d.y1,a.y1),f=B(d.x2,a.x2),n=B(d.y2,a.y2);c=m(c,g,f,n);return c.width>0&&c.height>0?c:null}}}}(),T=function(){return{getAspectRatio:function(b){return b.height!==0?b.width/b.height:1},getCenter:function(b){return H.init(b.width>>1,b.height>>1)},getSize:function(b){return Q(S(b.width,2)+S(b.height,2))},init:function(b,m){b=b?b:0;return{width:b,height:m?m:b}}}}(),R=null,J=[],K=null,$=0,s=[],X=["view.wake",
"tile.loaded"],ea=function(){function b(){var e=C().maxImageLoads;if(!e||k.length<e)if(e=n.shift()){k[k.length]=e;e.image.onload=m;e.image.src=e.url;e.requested=T5.ticks()}}function m(){var e=g[this.id],y;if(e&&e.image.complete&&e.image.width>0){e.loaded=true;e.hitCount=1;for(y=k.length;y--;)if(k[y].image.src==this.src){k.splice(y,1);break}if(e.background||e.postProcess||e.drawBackground||e.customDraw)if(e.image){globalImageData=e;y=a(e.realSize?e.realSize.width:e.image.width,e.realSize?e.realSize.height:
e.image.height);var G=y.getContext("2d"),I=e.offset?e.offset:T5.XY.init();e.background&&G.drawImage(e.background,0,0);e.drawBackground&&e.drawBackground(G);e.customDraw?e.customDraw(G,e):G.drawImage(e.image,I.x,I.y);e.postProcess&&e.postProcess(G,e);e.image=y}for(y=e.callbacks.length;y--;)e.callbacks[y]&&e.callbacks[y](this,false);e.callbacks=[];i[i.length]={url:this.src,created:e.requested};delete g[this.id];b()}}function d(e,y,G){var I=c[e];if(I){I.hitCount++;I.image.complete&&I.image.width>0&&
y?y(I.image,true):I.callbacks.push(y)}else{I=COG.extend({url:e,image:new Image,loaded:false,created:T5.ticks(),requested:null,hitCount:0,callbacks:[y]},G);I.image.id="resourceLoaderImage"+f++;c[e]=I;g[I.image.id]=I;n[n.length]=I;b()}return I}function a(e,y){var G=document.createElement("canvas");COG.info("creating new canvas");G.width=e?e:0;G.height=y?y:0;if(typeof FlashCanvas!="undefined"){document.body.appendChild(G);FlashCanvas.initElement(G)}return G}var c={},g={},f=0,n=[],k=[],i=[],p={avgImageSize:25,
loadTimeout:10,cancelLoad:function(){var e;for(e=k.length;e--;)delete c[k[e].url];k=[];for(e=n.length;e--;)delete c[n[e].url];n=[]},get:function(e,y,G){var I=null;I=null;if((I=(I=c[e])?I.image:null)&&(I.getContext||I.complete&&I.width>0))return I;else y&&d(e,y,G);return null},load:d,newCanvas:a,reset:function(){c={}},stats:function(){return{imageLoadingCount:k.length,queuedImageCount:n.length,imageCacheFullness:0}}};COG.observable(p);return p}(),oa=function(){var b={};return{init:function(m,d){var a=
b[m];if(!a)throw Error("Unable to locate requested generator: "+m);return new a(d)},register:function(m,d){b[m]=d},Template:function(){}}}(),sa=function(){function b(f,n){c[f]=d(n);return f}function m(f){for(var n in f)b(n,f[n])}function d(f){function n(e){var y=f[e];typeof y!=="undefined"&&i.push(function(G){G[e]=y})}function k(){i=[];for(var e in f)n(e)}f=COG.extend({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,
globalCompositeOperation:undefined},f);var i=[],p={applyToContext:function(e){for(var y=i.length;y--;)i[y](e)},update:function(e,y){f[e]=y;k()}};k();return p}var a={},c={},g={apply:function(f,n){var k=c[n]?c[n]:c.basic,i;if(f&&f.canvas){i=a[f.canvas.id];a[f.canvas.id]=n}k.applyToContext(f);return i},define:b,defineMany:m,get:function(f){return c[f]},init:d,load:function(f){COG.jsonp(f,function(n){m(n)})}};m({basic:{lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"},waypoints:{lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",
fillStyle:"#FFF"}});return g}(),F={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,ZOOM:16,FREEZE:128},P=function(b){b=COG.extend({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:N("ACTIVE","ANIMATING","PAN","ZOOM"),style:null,minXY:null,maxXY:null},b);var m=null,d=false,a=false,c=b.id,g=N("ACTIVE"),f=b.validStates,n=0,k=0,i=COG.extend({addToView:function(p){p.setLayer(c,i)},shouldDraw:function(p){return(p&f)!==0},clip:null,cycle:function(){},draw:function(){},remove:function(){i.trigger("remove",
i)},changed:function(){a=true;m&&m.invalidate()},hitTest:null,getId:function(){return c},setId:function(p){c=p},getParent:function(){return m},setParent:function(p){d=(m=p)?m.fastDraw&&displayState!==g:false;i.trigger("parentChange",m)}},b);COG.observable(i);i.bind("drawComplete",function(p,e){a=false;n=e.x1;k=e.y1});i.bind("resync",function(p,e){if(e.syncXY){i.minXY&&e.syncXY(i.minXY);i.maxXY&&e.syncXY(i.maxXY)}});return i},M=function(b){function m(k,i,p,e){a=k;c=i;g=p;f=e}b=COG.extend({xy:H.init(),
offset:true,tweenIn:null,animationSpeed:null,isNew:true},b);var d=false,a=0,c=0,g=0,f=0,n=COG.extend(b,{isAnimating:function(){return d},draw:function(k,i,p,e,y){if(n.isNew&&b.tweenIn)COG.tweenValue(i.y1-20,n.xy.y,b.tweenIn,b.animationSpeed?b.animationSpeed:250+Math.random()*500,function(G,I){n.xy.y=G|0;d=!I;y.invalidate()});n.drawMarker(k,i,n.xy.x,n.xy.y,p,e,y);n.isNew=false},drawMarker:function(k,i,p,e){k.beginPath();k.arc(p,e,4,0,Math.PI*2,false);k.fill();m(p-4,e-4,8,8)},hitTest:function(k,i){return k>=
a&&k<=a+g&&i>=c&&i<=c+f},updateBounds:m});COG.observable(n);return n},pa=function(b){function m(){d();c.changed();c.trigger("markerUpdate",a)}function d(){var g=c.getParent();if(g&&g.syncXY)for(var f=a.length;f--;)g.syncXY([a[f].xy]);a.sort(function(n,k){var i=k.xy.y-n.xy.y;if(i==0)i=k.xy.x-n.xy.x;return i})}b=COG.extend({zindex:100,style:"basic"},b);var a=[],c=COG.extend(new P(b),{draw:function(g,f,n,k){for(var i=a.length;i--;)a[i].draw(g,f,n,c,k)},add:function(g){if(g&&typeof g.length!=="undefined")for(var f=
g.length;f--;){if(g[f])a[a.length]=g[f]}else if(g)a[a.length]=g;m()},clear:function(g){if(g)for(var f=0;f<a.length;)if(g(a[f]))a.splice(f,1);else f+=1;else a=[];m()},each:function(g){if(g)for(var f=a.length;f--;)g(a[f])},find:function(g){for(var f=[],n=a.length;n--;)if(!g||g(a[n]))f[f.length]=a[n];return f},hitTest:function(g,f){for(var n=[],k=a.length;k--;)if(a[k].hitTest(g,f))n[n.length]={type:"marker",data:a[k]};return n}});c.bind("tap",function(g,f,n,k){var i=[],p=k.x;k=k.y;for(var e=a.length;e--;)if(a[e].hitTest(p,
k))i[i.length]=a[e];if(i.length>0)g.cancel=c.trigger("markerTap",f,n,i).cancel});c.bind("parentChange",d);c.bind("resync",d);return c},ta=function(b){function m(k,i,p){k.fillStyle="#FFFFFF";k.strokeStyle="#222222";k.beginPath();k.arc(p.x,p.y,4,0,Math.PI*2,false);k.stroke();k.fill()}b=COG.extend({path:[],id:COG.objId("pathAni"),easing:COG.easing("sine.inout"),validStates:N("ACTIVE","PAN","ZOOM"),drawIndicator:null,duration:2E3},b);var d=H.edges(b.path),a,c=null,g=b.drawIndicator?b.drawIndicator:m,
f=0,n=COG.extend(new P(b),{cycle:function(){for(var k=0;k<d.accrued.length&&d.accrued[k]<f;)k++;c=null;if(k<b.path.length-1){var i=f-(k>0?d.accrued[k-1]:0),p=b.path[k];a=H.theta(p,b.path[k+1],d.edges[k]);c=H.extendBy(p,a,i)}return c},draw:function(k,i){c&&g&&g(k,i,H.init(c.x,c.y),a)}});COG.tweenValue(0,d.total,b.easing,b.duration,function(k,i){f=k;i&&n.remove();n.changed()});return n},wa=function(b){b=COG.extend({style:null,properties:{}},b);return COG.extend(b,{rect:null,draw:function(){},resync:function(){}})},
La=function(){return{tileSize:256,init:function(b,m,d,a,c){return COG.extend({x:b,y:m,width:d,height:a},c)}}}(),Wa={ex:COG.extend,ticks:L,getConfig:C,userMessage:function(b,m,d){Wa.trigger("userMessage",b,m,d)},XY:H,XYRect:O,Dimensions:T,Vector:va,D:T,Images:ea,Generator:oa,tween:COG.tween,tweenValue:COG.tweenValue,easing:COG.easing,Tween:COG.Tween,Style:sa,viewState:N,View:function(b){function m(q,t,v,E){qa=Oa;Pa(fa-t,ga-v,E?b.panAnimationEasing:null,E?b.panAnimationDuration:null);clearTimeout(ib);
ib=setTimeout(d,100)}function d(){qa=jb;ra()}function a(q,t,v,E){Xa(r(B(ha+S(2,E)-1,0.5),2))}function c(){var q=da(ha)/Math.LN2>>0;if(q!==0){ha=S(2,q);kb(Ma+Math.log(ha)/Math.LN2,Qa,Ra)}ra()}function g(q){q||(q=H.init(za,Aa));Ya=H.init(fa,ga);Na=H.offset(q,fa,ga);Qa=Na.x;Ra=Na.y}function f(q,t){var v,E;E=1/ha;if(ha!==1&&xa){v=xa.x1+q*E;E=xa.y1+t*E}else{v=q+fa;E=t+ga}return H.init(v,E)}function n(q,t,v){Ja("doubleTap",t,v,f(v.x,v.y));b.scalable&&Xa(2,v,b.zoomEasing,null,b.zoomDuration)}function k(q,
t,v){Za=null;y(t,v,f(v.x,v.y),"down")}function i(q,t,v){Za=f(v.x,v.y);y(t,v,Za,"hover")}function p(){clearTimeout(lb);lb=setTimeout(G,250)}function e(q,t,v){y(t,v,f(v.x,v.y),"tap");Ja("tap",t,v,f(v.x,v.y))}function y(q,t,v,E){for(var U=[],ba=ua;ba--;)if(W[ba].hitTest)U=U.concat(W[ba].hitTest(v.x,v.y,qa,ia));U.length>0&&ia.triggerCustom(E+"Hit",{hitType:E},U,q,t,v)}function G(q,t){var v;if(ja){if(b.autoSize&&ja.parentNode){q=ja.parentNode.offsetWidth;t=ja.parentNode.offsetHeight}try{if(!ja.id)ja.id=
b.id+"_canvas";Y=ja.getContext("2d")}catch(E){COG.exception(E);throw Error("Could not initialise canvas on specified view element");}if(q&&t&&(ma!==t||na!==q)){$a=true;na=q;ma=t;za=na>>1;Aa=ma>>1;ia.trigger("resize",na,ma);for(v=ua;v--;)W[v].trigger("resize",na,ma)}for(v=ua;v--;)W[v].trigger("contextChanged",Y);ra();ca()}}function I(q,t){t.setId(q);t.added=L();t.bind("remove",function(){ia.removeLayer(q)});t.trigger("contextChanged",Y);t.setParent(ia);W.push(t);W.sort(function(v,E){var U=E.zindex-
v.zindex;if(U===0)U=E.added-v.added;return U});ua=W.length;return t}function ca(){Ba&&Ba.unbind();Ba=INTERACT.watch(ja);b.pannable&&Ba.pannable().bind("pan",m);if(b.scalable){Ba.bind("zoom",a);Ba.bind("doubleTap",n)}if(b.captureHover){Ba.bind("pointerDown",k);Ba.bind("pointerHover",i)}Ba.bind("tap",e)}function Ea(q){var t,v=false;if(ab){if(q-mb>qb){qa=ha!==1?qa|bb:qa&~bb;cb=(t=(qa&(bb|Oa))!==0)&&(qa&db)===0;if($a&&ja){typeof FlashCanvas!="undefined"&&FlashCanvas.initElement(ja);ja.width=na;ja.height=
ma;ja.style.width=na+"px";ja.style.height=ma+"px";$a=false}if(Ca||Da){var E=Sa?fa+za:fa,U=Ta?ga+Aa:ga;if(Ca&&Ca>na)if(E+na>Ca)fa=Sa?E-Ca>0?fa-Ca:fa:Ca-na;else if(E<0)fa=Sa?fa+Ca:0;if(Da&&Da>ma)if(U+ma>Da)ga=Ta?U-Da>0?ga-Da:ga:Da-ma;else if(U<0)ga=Ta?ga+Da:0}Ua=Va();for(E=ua;E--;){if(W[E].animated)qa|=db;W[E].cycle(q,Ua,qa);W[E].shouldDraw(qa,Ua);v=W[E].clip||v}E=qa;U=Ua;t=rb&&v&&!t;var ba;O.center(U);v=0;xa=O.copy(U);xa.scaleFactor=ha;if(!t)if(!eb||q-nb>sb){Y.clearRect(0,0,na,ma);nb=q}Y.save();try{if(ha!==
1){var Fa=xa,ya=1/ha;Qa=Na.x+(fa-Ya.x);Ra=Na.y+(ga-Ya.y);xa=Fa?O.fromCenter(Qa>>0,Ra>>0,Fa.width*ya>>0,Fa.height*ya>>0):void 0;Y.scale(ha,ha)}Y.translate(-xa.x1,-xa.y1);Ha=Ia=null;if(t&&!eb){Y.beginPath();for(v=ua;v--;)W[v].clip&&W[v].clip(Y,xa,E,ia,q);Y.closePath();Y.clip()}for(v=ua;v--;){ba=W[v];Y.globalCompositeOperation=eb&&ba.zIndex<=0?"copy":"source-over";var Ga=ba.style,Ka=Ga?sa.apply(Y,Ga):null;if(ba.minXY)Ia=Ia?H.min(Ia,ba.minXY):H.copy(ba.minXY);if(ba.maxXY)Ha=Ha?H.max(Ha,ba.maxXY):H.copy(ba.maxXY);
ba.draw(Y,xa,E,ia,q);Ka&&sa.apply(Y,Ka)}}finally{Y.restore()}if(tb){Y.globalCompositeOperation="source-over";Y.strokeStyle="#f00";Y.beginPath();Y.moveTo(za,0);Y.lineTo(za,ma);Y.moveTo(0,Aa);Y.lineTo(na,Aa);Y.stroke()}ab=0;Ja("drawComplete",U,q);q-ob>ub&&fb();mb=q}animFrame(Ea)}else gb=false}function ra(){ab+=1;if(!gb){gb=true;animFrame(Ea)}}function Va(){return O.init(fa,ga,fa+na,ga+ma)}function fb(){ob=(new Date).getTime();Ja("refresh",ia,Va());ra()}function Xa(q,t,v,E,U){if(v)COG.tweenValue(ha,
q,v,U,function(ba,Fa){ha=ba;if(Fa){var ya=aa(da(ha)/Math.LN2);ha=S(2,ya);E&&E()}g(t);c()});else{ha=q;g(t);c()}return ia}function kb(q,t,v){q=B(b.minZoom,r(b.maxZoom,q));if(q!==Ma){var E=S(2,q-Ma),U=za/E|0,ba=Aa/E|0;Ma=q;Pa(((t?t:fa+za)-U)*E,((v?v:ga+Aa)-ba)*E);Ja("zoomLevelChange",q);ha=1;fb()}}function Ja(){for(var q=ia.trigger.apply(null,arguments).cancel,t=W.length;t--;)q=W[t].trigger.apply(null,arguments).cancel||q;return!q}function Pa(q,t,v,E,U){function ba(){Fa+=1;if(Fa>=2){d();U&&U()}}var Fa=
0,ya=Ia?H.offset(Ia,-za,-Aa):null,Ga=Ha?H.offset(Ha,-za,-Aa):null;if(ya){q=q<ya.x?ya.x:q;t=t<ya.y?ya.y:t}if(Ga){q=q>Ga.x?Ga.x:q;t=t>Ga.y?Ga.y:t}if(v){if((qa&Oa)===0){COG.tweenValue(fa,q,v,E,function(Ka,hb){fa=Ka|0;(hb?ba:ra)();return!cb});COG.tweenValue(ga,t,v,E,function(Ka,hb){ga=Ka|0;(hb?ba:ra)();return!cb});qa=Oa|db}}else{fa=q|0;ga=t|0;ra();U&&U()}}b=COG.extend({id:COG.objId("view"),container:"",captureHover:true,fastDraw:false,inertia:true,minRefresh:1E3,pannable:true,clipping:true,scalable:true,
panAnimationEasing:COG.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,autoSize:true,tapExtent:10,guides:false,turbo:false,fps:25,minZoom:1,maxZoom:1,zoomEasing:COG.easing("quad.out"),zoomDuration:300,zoomLevel:1},b);var sb=500,W=[],ua=0,ja=document.getElementById(b.container),Y=null,vb=typeof window.attachEvent!="undefined",ub=b.minRefresh,Za=null,fa=0,ga=0,Ca=null,Da=null,Sa=false,Ta=false,rb=b.clipping,Ua=null,gb=false,xa,tb=b.guides,pb=1,za=0,Aa=0,Ya=null,Na=null,cb=false,
ib=0,Ia=null,Ha=null,ob=0,nb=0,lb=0,ha=1,mb=0,$a=false,Ba=null,eb=b.turbo,ma,na,qb=1E3/b.fps|0,ab=0,Qa,Ra,Ma=b.zoomLevel,jb=N("ACTIVE"),Oa=N("PAN"),bb=N("ZOOM"),db=N("ANIMATING"),qa=jb,ia={id:b.id,deviceScaling:pb,fastDraw:b.fastDraw||C().requireFastDraw,getDimensions:function(){return T.init(na,ma)},getLayer:function(q){for(var t=0;t<ua;t++)if(W[t].getId()==q)return W[t];return null},getZoomLevel:function(){return Ma},setLayer:function(q,t){for(var v=0;v<ua;v++)if(W[v].getId()===q){W.splice(v,1);
break}if(t){I(q,t);t.trigger("refresh",ia,Va())}ra();return t},eachLayer:function(q){for(var t=ua;t--;)q(W[t])},invalidate:ra,refresh:fb,resetScale:function(){ha=1},resize:function(q,t){if(ja){b.autoSize=false;if(na!==q||ma!==t)G(q,t)}},scale:Xa,setZoomLevel:kb,triggerAll:Ja,removeLayer:function(q){a:{for(var t=ua;t--;)if(W[t].getId()==q){q=t;break a}q=-1}if(q>=0&&q<ua){ia.trigger("layerRemoved",W[q]);W.splice(q,1);ra()}ua=W.length},getOffset:function(){return H.init(fa,ga)},setMaxOffset:function(q,
t,v,E){Ca=q;Da=t;Sa=typeof v!="undefined"?v:false;Ta=typeof E!="undefined"?E:false},getViewRect:Va,updateOffset:Pa,pan:function(q,t,v,E,U){Pa(fa+q,ga+t,v,E,U)}};pb=C().getScaling();ia.markers=I("markers",new pa);COG.observable(ia);ia.bind("invalidate",function(){ra()});ia.bind("resync",function(){Ha=Ia=null});COG.configurable(ia,["container","scalable","pannable","inertia","minZoom","maxZoom","zoom"],COG.paramTweaker(b,null,{container:function(q,t){ja=document.getElementById(t);G()},inertia:ca,scalable:ca,
pannable:ca}),true);G();if(b.autoSize)vb?window.attachEvent("onresize",p):window.addEventListener("resize",p,false);return ia},ViewLayer:P,ImageLayer:function(b,m){function d(i,p,e){for(p=f.length;p--;){var y=f[p],G=y.x,I=y.y,ca=O.init(y.x,y.y,y.x+y.width,y.y+y.height);if(e&&O.intersect(i,ca))(ca=ea.get(y.url,function(){k.changed()},n))&&e(ca,G,I,y.width,y.height)}}function a(i){var p=++g,e=k.getParent();c&&c.run(e,i,function(y){if(p==g){f=[].concat(y);e.invalidate()}})}m=COG.extend({imageLoadArgs:{}},
m);var c=b?oa.init(b,m):null,g=0,f=[],n=m.imageLoadArgs,k=COG.extend(new P(m),{changeGenerator:function(i,p){c=oa.init(i,COG.extend({},m,p));f=null;a(k.getParent().getViewRect())},clip:function(i,p,e){d(p,e,function(y,G,I,ca,Ea){i.rect(G,I,ca,Ea)})},draw:function(i,p,e){d(p,e,function(y,G,I,ca,Ea){k.drawImage(i,y,G,I,ca,Ea,p,e)})},drawImage:function(i,p,e,y){p&&i.drawImage(p,e,y,p.width,p.height)}});k.bind("refresh",function(i,p,e){a(e)});k.bind("tap",function(i,p,e,y){i=[];var G=y.x,I=y.y,ca,Ea;
if(f)for(var ra=f.length;ra--;){ca=f[ra];if(Ea=G>=ca.x&&G<=ca.x+ca.width&&I>=ca.y&&I<=ca.y+ca.height)i[i.length]=ca}i.length>0&&k.trigger("tapImage",i,p,e,y)});return k},ImageGenerator:function(b){b=COG.extend({relative:false,padding:2},b);b={run:function(){COG.warn("running base generator - this should be overriden")}};COG.observable(b);return b},Marker:M,ImageMarker:function(b){b=COG.extend({image:null,imageUrl:null,animatingImage:null,animatingImageUrl:null,imageAnchor:null,rotation:0,scale:1,
opacity:1},b);var m=b.imageAnchor?T5.XY.invert(b.imageAnchor):null,d=COG.extend(new M(b),{changeImage:function(a){d.image=ea.get(a,function(c){d.image=c})},drawMarker:function(a,c,g,f){if((c=d.isAnimating()&&d.animatingImage?d.animatingImage:d.image)&&c.width>0){m||(m=H.init(-c.width>>1,-c.height>>1));var n=d.scale,k=g+~~(m.x*n),i=f+~~(m.y*n),p=~~(c.width*n),e=~~(c.height*n);d.updateBounds(k,i,p,p);if(d.rotation||d.opacity!==1){a.save();try{a.globalAlpha=d.opacity;a.translate(g,f);a.rotate(d.rotation);
a.drawImage(c,m.x*n,m.y*n,p,e)}finally{a.restore()}}else a.drawImage(c,k,i,p,e)}}});if(!d.image)d.image=ea.get(b.imageUrl,function(a){d.image=a});if(!d.animatingImage)d.animatingImage=ea.get(b.animatingImageUrl,function(a){d.animatingImage=a});return d},MarkerLayer:pa,PathLayer:function(b){function m(){var i=k.getParent();if(i&&i.syncXY){i.syncXY(c);g&&i.syncXY(g);k.trigger("tidy")}}b=COG.extend({style:"waypoints",pixelGeneralization:8,zindex:50},b);var d=[],a=null,c=[],g=null,f=0,n=[],k=COG.extend(new P(b),
{getAnimation:function(i,p,e,y){var G="pathAnimation"+f++;n.push(G);return new ta({id:G,path:d,zindex:b.zindex+1,easing:i?i:COG.easing("sine.inout"),duration:p?p:5E3,drawIndicator:e,autoCenter:y?y:false})},draw:function(i){var p,e=d.length;i.save();try{sa.apply(i,b.style);if(e>0){i.beginPath();i.moveTo(d[e-1].x,d[e-1].y);for(p=e;p--;)i.lineTo(d[p].x,d[p].y);i.stroke();if(a){i.fillStyle=b.waypointFillStyle;for(p=a.length;p--;){i.beginPath();i.arc(a[p].x,a[p].y,2,0,Math.PI*2,false);i.stroke();i.fill()}}}}finally{i.restore()}},
updateCoordinates:function(i,p){c=i;g=p;m()}});k.bind("tidy",function(){d=H.simplify(c,b.pixelGeneralization);a=H.simplify(g,b.pixelGeneralization);k.changed(true)});k.bind("resync",m);return k},AnimatedPathLayer:ta,Shape:wa,Arc:function(b,m){m=COG.extend({size:4},m);var d=H.init(),a=COG.extend(m,{draw:function(c){c.beginPath();c.arc(d.x,d.y,a.size,0,Math.PI*2,false);c.fill();c.stroke()},resync:function(c){c.syncXY([b]);d=H.floor([b])[0]}});COG.info("created arc = ",b);return a},Poly:function(b,m){m=
COG.extend({fill:false,simplify:false},m);var d=false,a=m.fill,c=m.simplify,g=N("ZOOM"),f=[],n=COG.extend(new wa(m),{draw:function(k,i,p,e,y,G){if(d){i=true;p=(G&g)!==0;k.beginPath();for(G=f.length;G--;){p=f[G].x;e=f[G].y;if(i){k.moveTo(p,e);i=false}else k.lineTo(p,e);p=true}if(p){a&&k.fill();k.stroke()}}},resync:function(k){n.xy=k.syncXY(b);f=H.floor(c?H.simplify(b):b)}});d=b&&b.length>=2;return n},ShapeLayer:function(b){function m(g){for(var f=a.length;f--;)a[f].resync(g);a.sort(function(n,k){var i=
k.xy.y-n.xy.y;if(i===0)i=k.xy.x-n.xy.y;return i});c.changed()}function d(g,f){f.syncXY&&m(f)}b=COG.extend({zindex:80},b);var a=[],c=COG.extend(new P(b),{add:function(g){a[a.length]=g},each:function(g){for(var f=a.length;f--;)g(a[f])},draw:function(g,f,n){var k=f.x1,i=f.y1,p=f.width;f=f.height;for(var e=a.length;e--;){var y=a[e].style;y=y?sa.apply(g,y):null;a[e].draw(g,k,i,p,f,n);y&&sa.apply(g,y)}}});c.bind("parentChange",d);c.bind("resync",d);return c},Tiling:La};COG.observable(Wa);return Wa}();
