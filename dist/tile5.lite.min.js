COG=function(){var f=/\$\{(.*?)\}/ig,m=Object.prototype.hasOwnProperty,h=0,d={id:"grunt.core",extend:function(){var a=arguments[0]||{},b=1,g=arguments.length,c=false,k,e,j,i;if(typeof a==="boolean"){c=a;a=arguments[1]||{};b=2}if(typeof a!=="object"&&!d.isFunction(a))a={};if(g===b){a=this;--b}for(;b<g;b++)if((k=arguments[b])!=null)for(e in k){j=a[e];i=k[e];if(a!==i)if(c&&i&&(d.isPlainObject(i)||d.isArray(i))){j=j&&(d.isPlainObject(j)||d.isArray(j))?j:d.isArray(i)?[]:{};a[e]=d.extend(c,j,i)}else if(i!==
undefined)a[e]=i}return a},isFunction:function(a){return toString.call(a)==="[object Function]"},isArray:function(a){return toString.call(a)==="[object Array]"},isPlainObject:function(a){if(!a||toString.call(a)!=="[object Object]"||a.nodeType||a.setInterval)return false;if(a.constructor&&!m.call(a,"constructor")&&!m.call(a.constructor.prototype,"isPrototypeOf"))return false;var b;for(b in a);return b===undefined||m.call(a,b)},isEmptyObject:function(a){for(var b in a)return false;return true},isXmlDocument:function(a){return toString.call(a)===
"[object Document]"},contains:function(a,b){var g=a,c=arguments,k=1;if(b&&d.isArray(b)){c=b;k=0}for(k=k;k<c;k++)g=g&&typeof foo[c[k]]!=="undefined";return g},newModule:function(a){a=d.extend({id:null,requires:[],parent:null},a);if(a.parent)a=d.extend({},a.parent,a);return a},toID:function(a){return a.replace(/\s/g,"-")},objId:function(a){return(a?a:"obj")+h++},formatStr:function(a){if(arguments.length<=1)return a;for(var b=arguments.length-2,g=0;g<=b;g++)a=a.replace(RegExp("\\{"+g+"\\}","gi"),arguments[g+
1]);return a},wordExists:function(a,b){var g="";if(b.toString)b=b.toString();for(var c=0;c<b.length;c++)g+=!/\w/.test(b[c])?"\\"+b[c]:b[c];return RegExp("(^|\\s|\\,)"+g+"(\\,|\\s|$)","i").test(a)},parseTemplate:function(a,b){for(var g=f.exec(a);g;){a=a.replace(g[0],COG.XPath.first(g[1],b));f.lastIndex=0;g=f.exec(a)}return a}};return d}();
COG.Log=function(){function f(b,g){var c,k=g&&g.length>0?g[0]:"";for(c=1;g&&c<g.length;c++)k+=" "+(h&&COG.isPlainObject(g[c])?JSON.stringify(g[c]):g[c]);typeof console!=="undefined"&&console[b](k);for(c=0;c<m.length;c++)m[c].call(a,k,b)}var m=[],h=typeof JSON!=="undefined",d=window.console&&window.console.markTimeline,a={id:"grunt.log",getTraceTicks:function(){return d?(new Date).getTime():null},trace:function(b,g){if(d)console.markTimeline(b+(g?": "+(a.getTraceTicks()-g)+"ms":""))},debug:function(){f("debug",
arguments)},info:function(){f("info",arguments)},warn:function(){f("warn",arguments)},error:function(){f("error",arguments)},exception:function(b){a.error(arguments);for(var g in b)a.info("ERROR DETAIL: "+g+": "+b[g])},watch:function(b,g){try{g()}catch(c){a.exception(c,b)}},throwError:function(b){a.error(b);throw Error(b);},requestUpdates:function(b){m.push(b)}};return a}();
(function(){function f(d,a){d[a]||(d[a]=function(b){return d.configure(a,b)})}function m(d){d.gtConfId=COG.objId("configurable");d.gtConfig={};d.gtConfigFns=[];return d.gtConfig}var h={};COG.paramTweaker=function(d,a,b){return function(g,c){if(typeof c!=="undefined"){if(g in d)d[g]=c;b&&g in b&&b[g](g,c)}else return a&&g in a?a[g](g):d[g]}};COG.configurable=function(d,a,b,g){if(d){d.gtConfId||m(d);var c=d.gtConfId,k=d.gtConfig,e=d.gtConfigFns;h[c]=d;e.push(b);for(b=a.length;b--;){k[a[b]]=true;g&&
f(d,a[b])}if(!d.configure)d.configure=function(j,i){if(k[j]){for(var l=e.length;l--;){var n=e[l](j,i);if(typeof n!=="undefined")return n}return h[c]}return null}}}})();
(function(){function f(m,h){var d=m.gtObsHandlers;d[h]||(d[h]=[]);return d[h]}COG.observable=function(m){if(m){if(!m.gtObsHandlers)m.gtObsHandlers={};if(!(m.bind||m.trigger||m.unbind)){m.bind=function(h,d){var a=COG.objId("callback");f(m,h).unshift({fn:d,id:a});return a};m.trigger=function(h){var d=f(m,h),a={cancel:false,tickCount:(new Date).getTime()},b;if(!d)return null;b=Array.prototype.slice.call(arguments,1);b.unshift(a);for(var g=d.length;g--&&!a.cancel;)d[g].fn.apply(self,b);return a};m.unbind=
function(h,d){for(var a=f(m,h),b=0;a&&b<a.length;b++)if(a[b].id===d){a.splice(b,1);break}return m}}}}})();(function(){var f={},m=[];COG.addPipe=function(h){h("pipe.test",{});m.push(h)};COG.listen=function(h,d){f[h]||(f[h]=[]);d&&f[h].push(d)};COG.say=function(h,d){var a;for(a=m.length;a--;)m[a](h,d);if(f[h])for(a=f[h].length;a--;)f[h][a](d)}})();
COG.Loopage=function(){function f(i){return COG.extend({id:b++,frequency:0,after:0,single:false,lastTick:0,execute:function(){}},i)}function m(i){c.push(i);h()}function h(){k&&clearTimeout(k);k=setTimeout(d,0);j=true}function d(){for(var i,l=(new Date).getTime(),n=g.length;c.length>0;){var x=c.shift();for(i=n;i--;)if(g[i].id===x){g.splice(i,1);break}j=true;n=g.length}if(j){e=a;for(i=n;i--;)e=g[i].frequency<e?g[i].frequency:e}for(i=n;i--;){x=l-g[i].lastTick;if(g[i].lastTick===0||x>=g[i].frequency){g[i].execute(l,
g[i]);g[i].lastTick=l;g[i].single&&g[i].trigger("complete")}}k=n?setTimeout(d,e):0}var a=6E4,b=0,g=[],c=[],k=0,e=a,j=true;return{join:function(i){var l=new f(i);if(l.after>0)l.lastTick=(new Date).getTime()+l.after;COG.observable(l);l.bind("complete",function(){m(l.id)});g.unshift(l);h();return l},leave:m}}();if(!this.JSON)this.JSON={};
(function(){function f(e){return e<10?"0"+e:e}function m(e){a.lastIndex=0;return a.test(e)?'"'+e.replace(a,function(j){var i=c[j];return typeof i==="string"?i:"\\u"+("0000"+j.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function h(e,j){var i,l,n,x,y=b,p,o=j[e];if(o&&typeof o==="object"&&typeof o.toJSON==="function")o=o.toJSON(e);if(typeof k==="function")o=k.call(j,e,o);switch(typeof o){case "string":return m(o);case "number":return isFinite(o)?String(o):"null";case "boolean":case "null":return String(o);
case "object":if(!o)return"null";b+=g;p=[];if(Object.prototype.toString.apply(o)==="[object Array]"){x=o.length;for(i=0;i<x;i+=1)p[i]=h(i,o)||"null";n=p.length===0?"[]":b?"[\n"+b+p.join(",\n"+b)+"\n"+y+"]":"["+p.join(",")+"]";b=y;return n}if(k&&typeof k==="object"){x=k.length;for(i=0;i<x;i+=1){l=k[i];if(typeof l==="string")if(n=h(l,o))p.push(m(l)+(b?": ":":")+n)}}else for(l in o)if(Object.hasOwnProperty.call(o,l))if(n=h(l,o))p.push(m(l)+(b?": ":":")+n);n=p.length===0?"{}":b?"{\n"+b+p.join(",\n"+b)+
"\n"+y+"}":"{"+p.join(",")+"}";b=y;return n}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
a=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,b,g,c={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},k;if(typeof JSON.stringify!=="function")JSON.stringify=function(e,j,i){var l;g=b="";if(typeof i==="number")for(l=0;l<i;l+=1)g+=" ";else if(typeof i==="string")g=i;if((k=j)&&typeof j!=="function"&&(typeof j!=="object"||typeof j.length!=="number"))throw Error("JSON.stringify");return h("",
{"":e})};if(typeof JSON.parse!=="function")JSON.parse=function(e,j){function i(n,x){var y,p,o=n[x];if(o&&typeof o==="object")for(y in o)if(Object.hasOwnProperty.call(o,y)){p=i(o,y);if(p!==undefined)o[y]=p;else delete o[y]}return j.call(n,x,o)}var l;e=String(e);d.lastIndex=0;if(d.test(e))e=e.replace(d,function(n){return"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){l=eval("("+e+")");return typeof j==="function"?i({"":l},""):l}throw new SyntaxError("JSON.parse");}})();
(function(){function f(h,d){var a=h.split("|"),b={};for(var g in d){var c=d[g];b[g]=a.length>c?a[c]:null}return b}var m={JSON:{parse:function(h){return JSON.parse(h)}},PDON:{parse:function(h){var d=null,a=[];h=h.split("\n");for(var b=0;b<h.length;b++){var g=h[b];if(d)a.push(f(g,d));else if(g){d=g.split("|");g={};for(var c=0;c<d.length;c++)g[d[c]]=c;d=g}else d=null}return a}}};COG.parseData=function(h,d){d=d?d.toUpperCase():"JSON";if(!m[d])throw Error("Unsupported data format: "+d);try{return m[d].parse(h)}catch(a){COG.Log.exception(a)}return{}}})();
COG.XPath=function(){function f(a){for(var b=null,g=0;g<m.length;g++)if(b=m[g](a))break;return b}var m=[],h=[null,function(a){return a.numberValue},function(a){return a.stringValue},function(a){return a.booleanValue},null,null,null,null,function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null},function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||COG.Log.warn("No XPATH support");var d={SearchResult:function(a){return{toString:function(){var b=
null;if(a){var g=null;if(a.resultType>=0&&a.resultType<h.length)g=h[a.resultType];if(g)b=g(a)}return b?b:""}}},first:function(a,b){var g=d.SearchResult,c;var k=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!k)k=XPathResult.ANY_TYPE;try{if(COG.isXmlDocument(b))c=b.evaluate(a,b,f,k,null);else{COG.Log.warn("attempted xpath expression: "+a+" on a non-xml document");c=null}}catch(e){COG.Log.warn("invalid xpath expression: "+a+" on node: "+b);c=null}return new g(c)},registerResolver:function(a){m.push(a)}};return d}();
COG.Storage=function(){function f(m){if(m&&m=="session")return sessionStorage;return localStorage}return{get:function(m,h){var d=f(h).getItem(m);return/^(\{|\[).*(\}|\])$/.test(d)?JSON.parse(d):d},set:function(m,h,d){h=jQuery.isArray(h)||jQuery.isPlainObject(h)?JSON.stringify(h):h;f(d).setItem(m,h)},remove:function(m,h){f(h).removeItem(m)}}}();
COG.ParseRules=function(){var f=[];return{add:function(m,h){f.push({regex:m,handler:h})},each:function(m,h,d){function a(){b++;d&&b>=f.length&&d(h)}for(var b=0,g=0;g<f.length;g++){var c=f[g].regex,k=f[g].handler,e=false;if(c){c.lastIndex=-1;if((c=c.exec(m))&&k){e=true;k(c,h,a)&&a()}}e||a()}}}};
(function(){function f(c){var k=[],e=function(i,l){l=COG.isFunction(l)?l():l;k[k.length]=encodeURIComponent(i)+"="+encodeURIComponent(l)};if(COG.isArray(c))for(var j=0;j<c.length;j++)e(c[j].name,c[j].value);else for(j in c)e(j,c[j]);return k.join("&").replace(/%20/g,"+")}var m={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},h={JSON:["json"],PDON:["pdon.txt"]},d=["TEXT","STREAM"],a=/^(\w+:)?\/\/([^\/?#]+)/,b={XML:function(c){return c.responseXML},JSON:function(c){return COG.parseData(c.responseText)},
PDON:function(c){return COG.parseData(c.responseText,"PDON")},DEFAULT:function(c){return c.responseText}},g={CONTENT_TYPE:"Content-Type"};COG.xhr=function(c){function k(){if(this.readyState===4){var l=null,n=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(n)if(c.handleResponse)c.handleResponse(this);else{var x=c,y=this.getResponseHeader(g.CONTENT_TYPE),p,o=false;for(p in m)if(y&&y.indexOf(m[p])>=0){o=true;
break}y=!o;for(o=0;o<d.length;o++)y=y||d[o]==p;if(y)b:{y=p;for(var t in h)for(o=0;o<h[t].length;o++)if(RegExp(h[t][o]+"$","i").test(x.url)){p=t;break b}p=y?y:"DEFAULT"}try{l=b[p](this,x)}catch(r){l=b.DEFAULT(this,x)}}else c.error&&c.error(this)}catch(M){COG.Log.exception(M,"PROCESSING AJAX RESPONSE")}n&&l&&c.success&&c.success.call(this,l)}}try{c=COG.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},c);var e=
a.exec(c.url),j=e&&(e[1]&&e[1]!==location.protocol||e[2]!==location.host);if(c.data)c.method="POST";if(c.url){e=null;if(c.xhr)e=c.xhr(c);e||(e=new XMLHttpRequest);e.open(c.method,c.url,c.async);c.data&&e.setRequestHeader("Content-Type",c.contentType);j||e.setRequestHeader("X-Requested-With","XMLHttpRequest");e.onreadystatechange=k;e.send(c.method=="POST"?f(c.data):null)}else COG.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(i){COG.Log.exception(i)}}})();
(function(){function f(a){var b=document.createElement("script"),g=false;b.src=a;b.async=true;b.onload=b.onreadystatechange=function(){if(!g&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){g=true;b.onload=b.onreadystatechange=null;b&&b.parentNode&&b.parentNode.removeChild(b)}};h||(h=document.getElementsByTagName("head")[0]);h.appendChild(b)}var m=0,h,d=this;COG.jsonp=function(a,b,g){a+=a.indexOf("?")>=0?"&":"?";var c="json"+ ++m;d[c]=function(k){b(k);d[c]=null;try{delete d[c]}catch(e){}};
f(a+(g?g:"callback")+"="+c);return c}})();
COG.Touch=function(){function f(s,A){return{x:s.x-A.x,y:s.y-A.y}}function m(s,A){var E=f(s,A);return Math.sqrt(E.x*E.x+E.y*E.y)}function h(s){if(s.count>1)return m(s.touches[0],s.touches[1]);return 0}function d(s,A){var E=s&&s.count>0?s.touches[0]:null;if(E&&A&&A.count>0)return f(E,A.touches[0]);return null}function a(s,A){s.count=A.count;for(var E=e;E--;){s.touches[E].x=A.touches[E].x;s.touches[E].y=A.touches[E].y}}function b(){for(var s={count:0,touches:Array(e)},A=e;A--;)s.touches[A]=k();return s}
function g(s){if(s.preventDefault){s.preventDefault();s.stopPropagation()}else s.cancelBubble&&s.cancelBubble()}function c(s,A,E){if(C){A=A[E?E:"touches"];E=A.length;for(E=s.count=E;E--;){s.touches[E].x=A[E].pageX;s.touches[E].y=A[E].pageY}}else if(A.button===0){s.count=1;s.touches[0].x=A.pageX?A.pageX:A.screenX;s.touches[0].y=A.pageY?A.pageY:A.screenY}else s.count=0}function k(s,A){return{x:s?s:0,y:A?A:0}}var e=10,j=120,i=100,l=250,n=300,x=5,y=0,p=1,o=2,t=7,r=0,M=0,C=undefined,ka=function(s){function A(v,
z,I,H){var q=Math.asin((v.y-z.y)/I);I=I*(sa/H)>>0;I=I>ra?ra:I;q=z.x>v.x?q:Math.PI-q;aa("pan",Math.cos(q)*-I,Math.sin(q)*I,true)}function E(v,z){var I,H;if(C){I=z-Z;if(I<l){H=m(K.touches[0],v);H>s.inertiaTrigger&&A(K.touches[0],v,H,I)}}else{da.x=v.x;da.y=v.y;COG.Loopage.join({execute:function(q,u){I=q-z;H=m(v,da);if(I<i&&H>s.inertiaTrigger){u.trigger("complete");A(v,da,H,I)}else I>i&&u.trigger("complete")},frequency:10})}}function ga(v){var z=0,I=0;if(v.offsetParent){do{z+=v.offsetLeft;I+=v.offsetTop;
v=v.offsetParent}while(v)}return k(z,I)}function ba(v){var z=v.count,I=Array(z),H=ga(ea);for(z=z;z--;)I[z]=k(v.touches[z].x-H.x,v.touches[z].y-H.y);return I}function aa(){la&&la.trigger.apply(null,arguments)}function ia(v,z){var I=ga(ea);I=k(z.x-I.x,z.y-I.y);aa(v,z,I)}function S(v){var z=v.target?v.target:v.srcElement;if(na||z&&z===ea){c(K,v);if(K.count!==0){U=null;V.x=0;V.y=0;L=true;J=false;Z=(new Date).getTime();g(v);z.style.cursor="move";aa("inertiaCancel");pa=Z;if(v=K.count>0?K.touches[0]:null){aa("touchStart",
v.x,v.y);if(pa-qa<n)if((v=f(K.touches[0],Q.touches[0]))&&Math.abs(v.x)<s.maxDistDoubleTap&&Math.abs(v.y)<s.maxDistDoubleTap)J=true;W=y;a(Q,K)}else COG.Log.warn("Touch start fired, but no touch vector found")}}}function w(v){var z=v.target?v.target:v.srcElement,I=0;if(na||z&&z===ea){c(R,v);if(R.count>0){da.x=R.touches[0].x;da.y=R.touches[0].y}if(L){C&&g(v);if(R.count>1){K.count===1&&a(K,R);I=h(K)-h(R)}if(W===y)if((v=d(R,K))&&(Math.abs(v.x)>=t||Math.abs(v.y)>=t))W=p;if(W!==y)if(!I||Math.abs(I)<x){if(U=
d(R,Q)){V.x-=U.x;V.y-=U.y;T.x-=U.x;T.y-=U.y}aa("pan",T.x,T.y);T.x=0;T.y=0;W=p}else{aa("pinchZoom",ba(K),ba(R));W=o}a(Q,R)}}}function F(v){var z=v.target?v.target:v.srcElement;if(L&&(na||z&&z===ea)){c($,v,"changedTouches");var I=$.touches[0];C&&g(v);v=(new Date).getTime();qa=pa;if(W===y){ia("tap",K.touches[0]);G||(G=setTimeout(function(){G=0;J&&ia("doubleTap",K.touches[0])},n+50))}else if(W==p){aa("panEnd",V.x,V.y);ja&&E(I,v)}else W==o&&aa("pinchZoomEnd",ba(K),ba(Q),v-Z);z.style.cursor="default";L=
false}}function D(v){var z=v.target?v.target:v.srcElement;if(na||z&&z===ea){if(v.detail){z=-v.detail*j;z=k(v.axis===1?z:0,v.axis===2?z:0)}else z=k(v.wheelDeltaX,v.wheelDeltaY);var I=z.y!==0?Math.abs(z.y/j):0;if(da&&I!==0){var H=k(da.x-ea.offsetLeft,da.y-ea.offsetTop);aa("wheelZoom",H,Math.pow(2,z.y>0?I:-I))}g(v)}}s=COG.extend({element:null,observable:null,inertiaTrigger:20,maxDistDoubleTap:20,touchStartHandler:null,moveHandler:null,moveEndHandler:null,pinchZoomHandler:null,pinchZoomEndHandler:null,
tapHandler:null,doubleTapHandler:null,wheelZoomHandler:null},s);var J=false,G=0,N=T5.getConfig(),K=b(),R=b(),Q=b(),$=b(),U=null,V=k(),T=k(),W=null,L=false,Z=0,X=[],da=k(),ja=false,sa,ra,pa=0,qa=0,ea=s.element,la=s.observable,na=typeof FlashCanvas!=="undefined",ha={supportsTouch:C,addListeners:function(v){X.push(v)},decoupleListeners:function(v){for(var z=0;v&&z<X.length;z++)if(X[z].listenerId===v){X.splice(z,1);break}},release:function(){N.unbindEvent(C?"touchstart":"mousedown",S,false);N.unbindEvent(C?
"touchmove":"mousemove",w,false);N.unbindEvent(C?"touchend":"mouseup",F,false);if(!C){window.removeEventListener("mousewheel",D,false);window.removeEventListener("DOMMouseScroll",D,false)}},inertiaEnable:function(v,z){ja=true;sa=v;ra=z?Math.min(z.width,z.height):500},inertiaDisable:function(){ja=false}};if(typeof C==="undefined")C=T5.getConfig().supportsTouch;N.bindEvent(C?"touchstart":"mousedown",S,false);N.bindEvent(C?"touchmove":"mousemove",w,false);N.bindEvent(C?"touchend":"mouseup",F,false);
if(!C){N.bindEvent("mousewheel",D,window);N.bindEvent("DOMMouseScroll",D,window)}return ha},Y=[];return{capture:function(s,A){if(!s)throw Error("Unable to capture touch of null element");if(!s.id)s.id="touchable_"+r++;var E=Y[s.id];if(!E){E=new ka(COG.extend({element:s},A));Y[s.id]=E}if(A){A.listenerId&&E.decoupleListeners(A.listenerId);A.listenerId=++M;E.addListeners(A)}return E},release:function(s){if(s&&s.id&&Y[s.id]){Y[s.id].release();delete Y[s.id]}}}}();
T5=function(){var f=function(){function a(c,k){return g(c.x-k.x,c.y-k.y)}function b(c,k){if(!k)k=c.length;if(k<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var e={edges:Array(k-1),accrued:Array(k-1),total:0},j=0;j<k-1;j++){var i=a(c[j],c[j+1]);e.edges[j]=Math.sqrt(i.x*i.x+i.y*i.y);e.accrued[j]=e.total+e.edges[j];e.total+=e.edges[j]}return e}function g(c,k){return{x:c?c:0,y:k?k:0}}return{VECTOR_SIMPLIFICATION:3,SIMPLIFICATION_MIN_VECTORS:25,add:function(){for(var c=
0,k=0,e=arguments.length;e--;){c+=arguments[e].x;k+=arguments[e].y}return g(c,k)},absSize:function(c){return Math.max(Math.abs(c.x),Math.abs(c.y))},copy:function(c){return c?g(c.x,c.y):null},diff:a,distance:function(c,k){return b(c,k).total},edges:b,equals:function(c,k){return c.x===k.x&&c.y===k.y},extendBy:function(c,k,e){return g(c.x-Math.cos(k)*e,c.y-Math.sin(k)*e)},floor:function(c){for(var k=Array(c.length),e=c.length;e--;)k[e]=g(~~c[e].x,~~c[e].y);return k},getRect:function(c){for(var k,e,j,
i,l=c.length;l--;){var n=c[l];k=typeof k==="undefined"||n.x<k?n.x:k;e=typeof e==="undefined"||n.y<e?n.y:e;j=typeof j==="undefined"||n.x>j?n.x:j;i=typeof i==="undefined"||n.y>i?n.y:i}return h.init(k,e,i,i)},init:g,invert:function(c){return g(-c.x,-c.y)},offset:function(c,k,e){return g(c.x+k,c.y+(e?e:k))},simplify:function(c,k){if(!c)return null;k=k?k:f.VECTOR_SIMPLIFICATION;for(var e=[],j=null,i=c.length;i--;){var l=c[i];if(include=!j||i===0||Math.abs(l.x-j.x)+Math.abs(l.y-j.y)>k){e.unshift(l);j=l}}return e},
theta:function(c,k,e){e=Math.asin((c.y-k.y)/e);return c.x>k.x?e:Math.PI-e}}}(),m=function(){return{dotProduct:function(a,b){return a.x*b.x+a.y*b.y}}}(),h=function(){function a(b,g,c,k){b=b?b:0;g=g?g:0;c=c?c:b;k=k?k:k;return{x1:b,y1:g,x2:c,y2:k,width:c-b,height:k-g}}return{center:function(b){return f.init(b.x1+b.width/2,b.y1+b.height/2)},copy:function(b){return a(b.x1,b.y1,b.x2,b.y2)},diagonalSize:function(b){return Math.sqrt(b.width*b.width+b.height*b.height)},fromCenter:function(b,g,c,k){c=~~(c/
2);k=~~(k/2);return a(b-c,g-k,b+c,g+k)},init:a}}(),d=function(){return{getAspectRatio:function(a){return a.height!==0?a.width/a.height:1},getCenter:function(a){return f.init(a.width/2,a.height/2)},getSize:function(a){return Math.sqrt(Math.pow(a.width,2)+Math.pow(a.height,2))},init:function(a,b){a=a?a:0;return{width:a,height:b?b:a}}}}();return{ex:COG.extend,ticks:function(){return(new Date).getTime()},XY:f,XYRect:h,Vector:function(a,b){COG.Log.warn("The T5.Vector class has been deprecated, please use T5.XY.init instead");
return f.init(a,b)},V:COG.extend(f,m),D:d}}();
(function(){function f(){for(;x.length>0;){var p=x.shift();document.location=p}n=0}function m(p){for(var o=true,t=y.length;t--;)o=o&&p!=y[t];return o}function h(p,o){var t=[];for(var r in o)r&&t.push(r+"="+escape(o[r]));return"tile5://"+p+"/"+(t.length>0?"?"+t.join("&"):"")}function d(p,o){m(p)&&COG.Log.info("would push url: "+h(p,o))}function a(p,o){if(m(p)){x.push(h(p,o));n||(n=setTimeout(f,100))}}function b(p){return function(o,t,r){(r?r:p?document.body:document).addEventListener(o,t,false)}}function g(p){return function(o,
t,r){(r?r:p?document.body:document).removeEventListener(o,t,false)}}function c(p,o,t){(t?t:document).attachEvent("on"+p,o)}function k(p,o,t){(t?t:document).detachEvent("on"+p,o)}function e(){j={base:{name:"Unknown",bindEvent:b(),unbindEvent:g(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:d,targetFps:null},ie:{name:"MSIE",regex:/msie/i,bindEvent:c,unbindEvent:k,requireFastDraw:false,targetFps:25},
ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:a,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:a},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:a},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:b(true),unbindEvent:g(true),supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},bridgeNotify:a},froyo:{name:"Android OS >= 2.2",
regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:a}};i=[j.froyo,j.android,j.ipod,j.iphone,j.ipad,j.ie]}var j=null,i=[],l=null,n=0,x=[],y=["view.wake","tile.loaded"];T5.getConfig=function(){j||e();if(!l){COG.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var p=0;p<i.length;p++){var o=i[p];if(o.regex&&o.regex.test(navigator.userAgent)){l=T5.ex({},j.base,o);COG.Log.info("PLATFORM DETECTED AS: "+l.name);break}}if(!l){COG.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
l=j.base}COG.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return l}})();
T5.Dispatcher=function(){var f=[],m={execute:function(h){var d=m.findAction(h);d&&d.execute.apply(d,Array.prototype.slice.call(arguments,1))},findAction:function(h){for(var d=f.length;d--;)if(f[d].id==h)return f[d];return null},getRegisteredActions:function(){return[].concat(f)},getRegisteredActionIds:function(){for(var h=[],d=f.length;d--;)f[d].id&&h.push(f[d].id);return h},registerAction:function(h){h&&h.id&&f.push(h)},Action:function(h){h=T5.ex({autoRegister:true,id:"",title:"",icon:"",hidden:false,
execute:null},h);var d={id:h.id,execute:function(){h.execute&&h.execute.apply(this,arguments)},getParam:function(a){return h[a]?h[a]:""},toString:function(){return COG.formatStr("{0} [title = {1}, icon = {2}]",d.id,h.title,h.icon)}};h.autoRegister&&m.registerAction(d);return d},Agent:function(h){h=COG.extend({name:"Untitled",translator:null,execute:null},h);var d={getName:function(){return h.name},getParam:function(a){return h[a]},getId:function(){return COG.toID(d.getName())},run:function(a,b){if(h.execute){var g=
h.translator?h.translator(a):a;h.execute.call(d,g,function(c,k){b&&b(c,k,g)})}}};return d},runAgents:function(h,d,a){for(var b=0;b<h.length;b++)h[b].run(d,a)}};return m}();
T5.Resources=function(){var f="",m={},h={getPath:function(d){return/^(file|https?|\/)/.test(d)?d:f+d},setBasePath:function(d){f=d},loadResource:function(d){d=T5.ex({filename:"",cacheable:true,dataType:null,callback:null},d);var a=function(b){d.callback&&COG.Log.watch("CALLING RESOURCE CALLBACK",function(){d.callback(b)})};d.cacheable&&m[d.filename]?a(m[d.filename]):COG.xhr({url:h.getPath(d.filename),dataType:d.dataType,success:function(b){if(d.cacheable)m[d.filename]=b;a(b)},error:function(b,g,c){COG.Log.error("error loading resource ["+
d.filename+"], error = "+c)}})},loadSnippet:function(d,a){/\.\w+$/.test(d)||(d+=".html");h.loadResource({filename:"snippets/"+d,callback:a,dataType:"html"})}};return h}();
T5.Images=function(){function f(){if(!n){var p=T5.getConfig().maxImageLoads;n=COG.Loopage.join({execute:function(o,t){if(!p||j.length<p){var r=e.shift();if(r){j[j.length]=r;r.image.onload=h;r.image.src=T5.Resources.getPath(r.url);r.requested=T5.ticks()}else t.trigger("complete")}},frequency:10});n.bind("complete",function(){n=null})}}function m(){x=true;try{var p=i.length/2>>0;if(p>0){i.sort(function(t,r){return t.created-r.created});for(var o=p;o--;)delete b[i[o].url];i.splice(0,p)}}finally{x=false}COG.say("imagecache.cleared")}
function h(){var p=c[this.id],o;if(p&&p.image.complete&&p.image.width>0){p.loaded=true;p.hitCount=1;for(o=j.length;o--;)if(j[o].image.src==this.src){j.splice(o,1);break}if(p.background||p.postProcess||p.drawBackground||p.customDraw)if(p.image){o=a(p.realSize?p.realSize.width:image.width,p.realSize?p.realSize.height:image.height);var t=o.getContext("2d"),r=p.offset?p.offset:T5.XY.init();p.background&&t.drawImage(p.background,0,0);p.drawBackground&&p.drawBackground(t);p.customDraw?p.customDraw(t,p):
t.drawImage(p.image,r.x,r.y);p.postProcess&&p.postProcess(t,p);p.image=o}for(o=p.callbacks.length;o--;)p.callbacks[o]&&p.callbacks[o](this,false);p.callbacks=[];i[i.length]={url:this.src,created:p.requested};delete c[this.id];f()}}function d(p,o,t){var r=b[p];if(r){r.hitCount++;r.image.complete&&r.image.width>0&&o?o(r.image,true):r.callbacks.push(o)}else{r=T5.ex({url:p,image:new Image,loaded:false,created:T5.ticks(),requested:null,hitCount:0,callbacks:[o]},t);r.image.id="resourceLoaderImage"+k++;
b[p]=r;c[r.image.id]=r;e[e.length]=r;f()}return r}function a(p,o){var t=document.createElement("canvas");t.width=p?p:0;t.height=o?o:0;if(typeof FlashCanvas!=="undefined"){t.id="tmpCanvas"+g++;t.style.cssText="position: absolute; top: -"+(o-1)+"px; left: -"+(p-1)+"px;";document.body.appendChild(t);FlashCanvas.initElement(t)}typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(t);return t}var b={},g=0,c={},k=0,e=[],j=[],i=[],l=0,n=null,x=false,y={avgImageSize:25,loadTimeout:10,cancelLoad:function(){j=
[]},get:function(p,o,t){var r=null,M=null;x||(r=b[p]);if((M=r?r.image:null)&&(M.getContext||M.complete&&M.width>0))return M;else o&&d(p,o,t);return null},load:d,newCanvas:a,reset:function(){b={}},stats:function(){return{imageLoadingCount:j.length,queuedImageCount:e.length,imageCacheFullness:l}}};COG.Loopage.join({execute:function(p){for(var o=false,t=0,r=T5.getConfig();t<j.length;)if(p-j[t].requested>y.loadTimeout*1E3){j.splice(t,1);o=true}else t++;o&&f();if(r&&r.imageCacheMaxSize){l=i.length*y.avgImageSize/
r.imageCacheMaxSize;l>=1&&m()}},frequency:2E4});return y}();T5.Generator=function(){var f={};return{init:function(m,h){var d=f[m];if(!d)throw Error("Unable to locate requested generator: "+m);return new d(h)},register:function(m,h){f[m]=h},Template:function(){}}}();
T5.TimeLord=function(){var f=/^P(\d+Y)?(\d+M)?(\d+D)?$/,m=/^(\d+H)?(\d+M)?(\d+S)?$/,h=function(a,b){return{days:a?a:0,seconds:b?b:0}},d={8601:function(a){a=a.split("T");var b=null;b=null;var g=0,c=0;f.lastIndex=-1;b=f.exec(a[0]);g+=b[3]?parseInt(b[3].slice(0,-1),10):0;m.lastIndex=-1;b=m.exec(a[1]);c+=b[1]?parseInt(b[1].slice(0,-1),10)*3600:0;c+=b[2]?parseInt(b[2].slice(0,-1),10)*60:0;c+=b[3]?parseInt(b[3].slice(0,-1),10):0;return new h(g,c)}};return{Duration:h,addDuration:function(){for(var a=new h,
b=arguments.length;b--;){a.days+=arguments[b].days;a.seconds+=arguments[b].seconds}if(a.seconds>=86400){a.days+=~~(a.seconds/86400);a.seconds%=86400}return a},parseDuration:function(a,b){var g=b?d[b]:null;if(g)return g(a);COG.Log.warn("Could not find duration parser for specified format: "+b);return new h},formatDuration:function(a){var b,g,c="";if(a.days)c=a.days+" days ";if(a.seconds){a=a.seconds;if(a>=3600){b=~~(a/3600);a-=b*3600}if(a>=60){g=Math.round(a/60);a-=g*60}if(b)c=c+b+(b>1?" hrs ":" hr ")+
(g?(g>10?g:"0"+g)+" min ":"");else if(g)c=c+g+" min";else if(a>0)c=c+(a>10?a:"0"+a)+" sec"}return c}}}();
(function(){var f=Math.PI*2,m=Math.PI/2,h=Math.abs,d=Math.pow,a=Math.sin,b=Math.asin,g=Math.cos,c=1.70158,k={linear:function(e,j,i,l){return i*e/l+j},backin:function(e,j,i,l){return i*(e/=l)*e*((c+1)*e-c)+j},backout:function(e,j,i,l){return i*((e=e/l-1)*e*((c+1)*e+c)+1)+j},backinout:function(e,j,i,l){return(e/=l/2)<1?i/2*e*e*(((c*=1.525)+1)*e-c)+j:i/2*((e-=2)*e*(((c*=1.525)+1)*e+c)+2)+j},bouncein:function(e,j,i,l){return i-k.bounceout(l-e,0,i,l)+j},bounceout:function(e,j,i,l){return(e/=l)<1/2.75?
i*7.5625*e*e+j:e<2/2.75?i*(7.5625*(e-=1.5/2.75)*e+0.75)+j:e<2.5/2.75?i*(7.5625*(e-=2.25/2.75)*e+0.9375)+j:i*(7.5625*(e-=2.625/2.75)*e+0.984375)+j},bounceinout:function(e,j,i,l){return e<l/2?k.bouncein(e*2,0,i,l)/2+j:k.bounceout(e*2-l,0,i,l)/2+i/2+j},cubicin:function(e,j,i,l){return i*(e/=l)*e*e+j},cubicout:function(e,j,i,l){return i*((e=e/l-1)*e*e+1)+j},cubicinout:function(e,j,i,l){if((e/=l/2)<1)return i/2*e*e*e+j;return i/2*((e-=2)*e*e+2)+j},elasticin:function(e,j,i,l,n,x){if(e==0)return j;if((e/=
l)==1)return j+i;x||(x=l*0.3);if(!n||n<h(i)){n=i;i=x/4}else i=x/f*b(i/n);return-(n*d(2,10*(e-=1))*a((e*l-i)*f/x))+j},elasticout:function(e,j,i,l,n,x){var y;if(e==0)return j;if((e/=l)==1)return j+i;x||(x=l*0.3);if(!n||n<h(i)){n=i;y=x/4}else y=x/f*b(i/n);return n*d(2,-10*e)*a((e*l-y)*f/x)+i+j},elasticinout:function(e,j,i,l,n,x){var y;if(e==0)return j;if((e/=l/2)==2)return j+i;x||(x=l*0.3*1.5);if(!n||n<h(i)){n=i;y=x/4}else y=x/f*b(i/n);if(e<1)return-0.5*n*d(2,10*(e-=1))*a((e*l-y)*f/x)+j;return n*d(2,
-10*(e-=1))*a((e*l-y)*f/x)*0.5+i+j},quadin:function(e,j,i,l){return i*(e/=l)*e+j},quadout:function(e,j,i,l){return-i*(e/=l)*(e-2)+j},quadinout:function(e,j,i,l){if((e/=l/2)<1)return i/2*e*e+j;return-i/2*(--e*(e-2)-1)+j},sinein:function(e,j,i,l){return-i*g(e/l*m)+i+j},sineout:function(e,j,i,l){return i*a(e/l*m)+j},sineinout:function(e,j,i,l){return-i/2*(g(Math.PI*e/l)-1)+j}};T5.easing=function(e){return k[e.replace(/[\-\_\s\.]/g,"").toLowerCase()]};T5.registerEasingType=function(e,j){k[e.replace(/[\-\_\s\.]/g,
"").toLowerCase()]=j}})();
T5.Tween=function(f){f=T5.ex({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:T5.easing("sine.out"),complete:null,cancelOnInteract:false},f);var m=T5.ticks(),h=[],d=false,a=0,b=0,g={cancelOnInteract:f.cancelOnInteract,isComplete:function(){return d},triggerComplete:function(c){f.complete&&f.complete(c)},update:function(c){try{var k=f.tweenFn(c-m,a,b,f.duration);if(f.target)f.target[f.property]=k;for(var e=h.length;e--;)h[e](k,void 0);if(d=m+f.duration<=c){if(f.target)f.target[f.property]=
f.tweenFn(f.duration,a,b,f.duration);for(var j=h.length;j--;)h[j](k,true)}}catch(i){COG.Log.exception(i)}},requestUpdates:function(c){h.push(c)}};a=f.target&&f.property&&f.target[f.property]?f.target[f.property]:f.startValue;if(typeof f.endValue!=="undefined")b=f.endValue-a;if(b==0)d=true;T5.wakeTweens();return g};
(function(){function f(a){if(d)return m.length;d=true;try{for(var b=0;b<m.length;)if(m[b].isComplete()){m[b].triggerComplete(false);m.splice(b,1)}else{m[b].update(a);b++}}finally{d=false}m.length===0&&h.trigger("complete");return m.length}var m=[],h=null,d=false;T5.tweenValue=function(a,b,g,c,k){a=new T5.Tween({startValue:a,endValue:b,tweenFn:g,complete:c,duration:k});m.push(a);return a};T5.tween=function(a,b,g,c,k,e){a=new T5.Tween({target:a,property:b,endValue:g,tweenFn:c,duration:e,complete:k});
m.push(a);return a};T5.tweenVector=function(a,b,g,c,k,e){var j=[];if(a){var i=a.x==b,l=a.y==g;i||j.push(T5.tween(a,"x",b,c,function(){(i=true)&&l&&k()},e));l||j.push(T5.tween(a,"y",g,c,function(){l=true;i&&l&&k()},e))}return j};T5.cancelAnimation=function(a){if(!d){d=true;try{for(var b=0;b<m.length;)if(!a||a(m[b])){m[b].triggerComplete(true);m.splice(b,1)}else b++}finally{d=false}}};T5.isTweening=function(){return m.length>0};T5.wakeTweens=function(){if(!h){h=COG.Loopage.join({execute:f,frequency:20});
h.bind("complete",function(){h=null})}}})();(function(){var f={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,PINCH:16,FREEZE:128};T5.viewState=function(){for(var m=0,h=arguments.length;h--;){var d=f[arguments[h].toUpperCase()];if(d)m|=d}return m}})();
T5.ViewLayer=function(f){f=T5.ex({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:T5.viewState("ACTIVE","ANIMATING","PAN","PINCH")},f);var m=null,h=false,d=false,a=f.supportFastDraw,b=f.id,g=T5.viewState("ACTIVE"),c=f.validStates,k=0,e=0,j=T5.ex({addToView:function(i){i.setLayer(b,j)},shouldDraw:function(i,l,n){i=(i&c)!==0&&(h?a:true);return i=d||n||k!==l.x||e!==l.y},cycle:function(){},draw:function(){},remove:function(){j.trigger("remove",j)},changed:function(){d=true;j.trigger("changed",
j);m&&m.trigger("invalidate")},getId:function(){return b},setId:function(i){b=i},getParent:function(){return m},setParent:function(i){h=(m=i)?m.fastDraw&&displayState!==g:false;j.trigger("parentChange",m)}},f);COG.observable(j);j.bind("drawComplete",function(i,l){d=false;k=l.x;e=l.y});return j};
T5.View=function(f){function m(q,u,B,O){ha=ea;t();if(O&&f.inertia){J=true;e(Y+u,s+B,f.panAnimationEasing,f.panAnimationDuration)}else O||e(Y+u,s+B)}function h(){ha=qa;J=false;COG.Loopage.join({execute:t,after:50,single:true})}function d(q,u){$=v(q);U=v(u);var B=z($),O=z(U);ja=I($);F=I(U);L=$&&B!==0?O/B:1}function a(q,u,B){d(u,B);if(Q=L!==1){ha=la;t()}}function b(q,u,B,O){d(u,B);if(f.adjustScaleFactor){L=f.adjustScaleFactor(L);COG.Log.info("scale factor adjusted to: "+L)}if(O<f.pinchZoomAnimateTrigger){l(X,
L,ja,n(),T5.easing("sine.out"),function(){c();L=1},300);L=X}else{c();L=1}}function g(q,u,B){H.zoom(u,Math.min(Math.pow(2,Math.round(Math.log(B))),8),500)}function c(){var q=$?n():F;L=Math.round(L*10)/10;Q=false;for(var u=r.length;u--;)r[u].trigger("scale",L,q);H.trigger("scale",L,q);ha=qa;t()}function k(){clearTimeout(W);W=setTimeout(j,50)}function e(q,u,B,O,P){function ca(){fa+=1;if(fa>=2){h(0,0);P&&P()}}var fa=0;if(B){q=T5.tweenValue(Y,q,B,ca,O);u=T5.tweenValue(s,u,B,ca,O);q.cancelOnInteract=true;
q.requestUpdates(function(ma){Y=ma;J=true;t()});u.cancelOnInteract=true;u.requestUpdates(function(ma){s=ma;J=true;t()})}else{Y=q;s=u}}function j(){var q;if(C){COG.Touch.release(C);if(f.autoSize&&C.parentNode){q=C.parentNode.getBoundingClientRect();if(q.height!==0&&q.width!==0){C.height=q.height;C.width=q.width}}try{if(!C.id)C.id=f.id+"_canvas";ka=C.getContext("2d");ka.clearRect(0,0,C.width,C.height)}catch(u){COG.Log.exception(u);throw Error("Could not initialise canvas on specified view element");
}pa=COG.Touch.capture(C,{observable:H});if(S.height!==C.height||S.width!==C.width){S=T5.D.init(C.width,C.height);H.trigger("resize",C.width,C.height);for(q=M;q--;)r[q].trigger("resize",C.width,C.height)}f.inertia&&pa.inertiaEnable(f.panAnimationDuration,S);for(q=M;q--;)r[q].trigger("contextChanged",ka);o()}}function i(q,u){u.setId(q);u.added=T5.ticks();u.bind("remove",function(){H.removeLayer(q)});u.trigger("contextChanged",ka);u.setParent(H);r.push(u);r.sort(function(B,O){var P=O.zindex-B.zindex;
if(P===0)P=O.added-B.added;return P});M=r.length;return u}function l(q,u,B,O,P,ca,fa){function ma(){ca&&ca();c();L=1;da=null}Q=true;ja=T5.XY.copy(B);F=T5.XY.copy(O);$=null;if(P)T5.tweenValue(0,u-q,P,ma,fa?fa:1E3).requestUpdates(function(oa){da=oa/(u-q);L=q+oa;ha=la;t();H.trigger("animate")});else{L=targetScaleFactor;ma()}}function n(){var q=T5.D.getCenter(S),u=T5.XY.distance([F,q]);q=T5.XY.theta(F,q,u);var B=T5.XY.diff(ja,F);q=T5.XY.extendBy(F,q,u/L);q.x+=B.x;q.y+=B.y;return q}function x(){H.trigger("idle",
H);D=true;G=0}function y(q,u,B,O,P){if(aa)u=T5.viewState("FROZEN");var ca=(u&la)!==0,fa=0;if(ga||ca){q.clearRect(0,0,C.width,C.height);ga=false}if(ca){T5.D.getCenter(S);var ma=(da?da:1)/2,oa=T5.XY.diff(ja,F);if($){K.x=F.x+oa.x;K.y=F.y+oa.y}else{K.x=F.x-oa.x*ma;K.y=F.y-oa.y*ma}}q.save();try{X=L;q.translate(-B.x1,-B.y1);if(ia!==1)q.scale(ia,ia);else if(ca){q.translate(F.x,F.y);q.scale(L,L)}for(fa=M;fa--;)if(r[fa].shouldDraw(u,B,O)){r[fa].draw(q,B,u,H,O,P);r[fa].trigger("drawComplete",B,P)}}finally{q.restore()}H.trigger("drawComplete",
B,P);COG.Log.trace("draw complete",P)}function p(q,u){var B=false,O=V?V:J?ea:ha,P=!J&&(O===la||O===ea),ca=T||O===ea||O===la||T5.isTweening();A=T5.XY.init(Y>>0,s>>0);E=T5.XYRect.fromCenter(A.x,A.y,S.width,S.height);if(P){T5.cancelAnimation(function(fa){return fa.cancelOnInteract});D=false;if(G!==0){clearTimeout(G);G=0}}for(P=M;P--;){if(r[P].animated)ha|=na;B=r[P].cycle(q,E,ha,ca)||B}ca=ca||(ha&na)!==0;if(B=B||ca||L!==1&&L!==Z){y(ka,O,E,ca,q);Z=L;T=false}if(!B&&w===0&&!sa){if(!D&&G===0)G=setTimeout(x,
500);u.trigger("complete")}w=0;COG.Log.trace("Completed draw cycle",q)}function o(){T=true;t()}function t(){w+=1;if(!(aa||ba)){ba=COG.Loopage.join({execute:p,frequency:ra});ba.bind("complete",function(){ba=null})}}f=T5.ex({id:COG.objId("view"),container:"",fastDraw:false,inertia:true,pannable:true,scalable:true,panAnimationEasing:T5.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:true,tapExtent:10,fps:25},f);var r=[],M=0,C=document.getElementById(f.container),
ka=null,Y=0,s=0,A=null,E=null,ga=false,ba=null,aa=false,ia=1,S=T5.D.init(),w=0,F=null,D=false,J=false,G=0,N=0,K=T5.XY.init(),R=0,Q=false,$=null,U=null,V=null,T=false,W=0,L=1,Z=0,X=1,da=null,ja=null,sa=typeof FlashCanvas!=="undefined",ra=~~(1E3/f.fps),pa=null,qa=T5.viewState("ACTIVE"),ea=T5.viewState("PAN"),la=T5.viewState("PINCH"),na=T5.viewState("ANIMATING"),ha=qa,v=T5.XY.getRect,z=T5.XYRect.diagonalSize,I=T5.XYRect.center,H={id:f.id,deviceScaling:ia,fastDraw:f.fastDraw||T5.getConfig().requireFastDraw,
animate:function(q,u,B,O,P){l(L,q,u,B,O,P)},centerOn:function(q){Y=q.x-C.width/2;s=q.y-C.height/2},getDimensions:function(){return S},getZoomCenter:function(){return K},getLayer:function(q){for(var u=0;u<M;u++)if(r[u].getId()==q)return r[u];return null},setLayer:function(q,u){for(var B=0;B<M;B++)if(r[B].getId()===q){r.splice(B,1);break}u&&i(q,u);o()},eachLayer:function(q){for(var u=M;u--;)q(r[u])},clearBackground:function(){COG.Log.info("CALL OF DEPRECATED METHOD CLEAR BACKGROUND");ga=true;o()},invalidate:o,
freeze:function(){aa=true},unfreeze:function(){aa=false;t()},resize:function(q,u){if(C){f.autoSize=false;C.width=q;C.height=u;j();H.trigger("resize",C.width,C.height)}},scale:function(q,u,B,O,P){O||(O=T5.D.getCenter(S));P||(P=T5.D.getCenter(S));H.animate(q,O,P,u,B);return H},removeLayer:function(q){a:{for(var u=M;u--;)if(r[u].getId()==q){q=u;break a}q=-1}if(q>=0&&q<M){COG.say("layer.removed",{layer:r[q]});r.splice(q,1);o()}M=r.length},stateOverride:function(q){V=q},getOffset:function(){return A?A:
T5.XY.init(Y,s)},getOffsetRect:function(){return E?E:T5.XYRect.fromCenter(Y,s,S.width,S.height)},updateOffset:e,zoom:function(q,u,B){J=false;L=u;Q=L!==1;ja=T5.D.getCenter(S);F=L>1?T5.XY.copy(q):T5.D.getCenter(S);$=null;clearTimeout(N);if(Q){ha=la;t();if(B)N=setTimeout(function(){c();L=1},parseInt(B,10))}}};ia=T5.getConfig().getScaling();H.markers=i("markers",new T5.MarkerLayer);COG.observable(H);H.bind("wake",t);H.bind("invalidate",o);if(f.pannable){H.bind("pan",m);H.bind("panEnd",h);H.bind("inertiaCancel",
function(){J=false;t()})}if(f.scalable){H.bind("pinchZoom",a);H.bind("pinchZoomEnd",b);H.bind("wheelZoom",g)}H.bind("tap",function(q,u,B){for(var O=T5.XY.offset(B,Y,s),P=r.length;P--;)q.cancel=q.cancel||r[P].trigger("tap",u,B,O).cancel});COG.configurable(H,["inertia","container","rotation","tapExtent","scalable","pannable"],COG.paramTweaker(f,null,{container:function(q,u){C=document.getElementById(u);j()},rotation:function(q,u){R=u}}),true);j();f.autoSize&&window.addEventListener("resize",k,false);
return H};
T5.PathLayer=function(f){function m(j){j.syncVectors(b);g&&j.syncVectors(g);e.trigger("tidy")}f=T5.ex({style:"waypoints",pixelGeneralization:8,zindex:50},f);var h=false,d=[],a=null,b=[],g=null,c=0,k=[],e=T5.ex(new T5.ViewLayer(f),{getAnimation:function(j,i,l,n){var x="pathAnimation"+c++;k.push(x);return new T5.AnimatedPathLayer({id:x,path:d,zindex:f.zindex+1,easing:j?j:T5.easing("sine.inout"),duration:i?i:5E3,drawIndicator:l,autoCenter:n?n:false})},cycle:function(j,i,l,n){return n},draw:function(j,i){var l,
n=d.length;j.save();try{T5.applyStyle(j,f.style);if(n>0){j.beginPath();j.moveTo(d[n-1].x-i.x,d[n-1].y-i.y);for(l=n;l--;)j.lineTo(d[l].x-i.x,d[l].y-i.y);j.stroke();if(a){j.fillStyle=f.waypointFillStyle;for(l=a.length;l--;){j.beginPath();j.arc(a[l].x-i.x,a[l].y-i.y,2,0,Math.PI*2,false);j.stroke();j.fill()}}}}finally{j.restore()}h=false},updateCoordinates:function(j,i){var l=e.getParent();l=l?l.getTileLayer():null;b=j;g=i;COG.Log.info("updating coordinates, grid = "+l);l&&m(l)}});e.bind("gridUpdate",
function(j,i){m(i);for(var l=k.length;l--;)COG.say("layer.remove",{id:k[l]});k=[]});e.bind("tidy",function(){d=T5.XY.simplify(b,f.pixelGeneralization);a=T5.XY.simplify(g,f.pixelGeneralization);h=true;e.changed()});return e};
T5.ShapeLayer=function(f){function m(b){for(var g=h.length;g--;)h[g].resync(b);h.sort(function(c,k){var e=k.xy.y-c.xy.y;if(e===0)e=k.xy.x-c.xy.y;return e});d=true;a.changed()}f=T5.ex({zindex:80,style:null},f);var h=[],d=false,a=T5.ex(new T5.ViewLayer(f),{add:function(b){h[h.length]=b},each:function(b){for(var g=h.length;g--;)b(h[g])},cycle:function(){return d},draw:function(b,g,c){var k=g.x1,e=g.y1,j=g.width;g=g.height;b.save();try{T5.applyStyle(b,f.style);for(var i=h.length;i--;){var l=h[i].style,
n=l?T5.applyStyle(b,l):null;h[i].draw(b,k,e,j,g,c);n&&T5.applyStyle(b,n)}}finally{b.restore()}d=false}});a.bind("parentChange",function(b,g){g.syncVectors&&m(g)});COG.configurable(a,["style"],COG.paramTweaker(f,null,null),true);return a};T5.PolyLayer=T5.ShapeLayer;T5.Shape=function(f){f=T5.ex({style:null,properties:{}},f);return T5.ex(f,{rect:null,draw:function(){},resync:function(){}})};
T5.Arc=function(f,m){m=T5.ex({size:4},m);var h=T5.XY.init(),d=T5.ex(m,{draw:function(a){a.beginPath();a.arc(h.x,h.y,d.size,0,Math.PI*2,false);a.fill();a.stroke()},resync:function(a){a.syncVectors([f]);h=T5.XY.floor([f])[0]}});COG.Log.info("created arc = ",f);return d};
T5.Poly=function(f,m){m=T5.ex({fill:false,simplify:false},m);var h=false,d=m.fill,a=m.simplify,b=T5.viewState("PINCH"),g=[],c=T5.ex(new T5.Shape(m),{draw:function(k,e,j,i,l,n){if(h){e=true;j=(n&b)!==0;k.beginPath();for(n=g.length;n--;){j=g[n].x;i=g[n].y;if(e){k.moveTo(j,i);e=false}else k.lineTo(j,i);j=true}if(j){d&&k.fill();k.stroke()}}},resync:function(k){c.xy=k.syncVectors(f);g=T5.XY.floor(a?T5.XY.simplify(f):f)}});h=f&&f.length>=2;return c};
T5.AnimatedPathLayer=function(f){function m(c,k,e){c.fillStyle="#FFFFFF";c.strokeStyle="#222222";c.beginPath();c.arc(e.x,e.y,4,0,Math.PI*2,false);c.stroke();c.fill()}f=T5.ex({path:[],id:COG.objId("pathAni"),easing:T5.easing("sine.inout"),validStates:T5.viewState("ACTIVE","PAN","PINCH"),drawIndicator:null,duration:2E3,autoCenter:false},f);var h=T5.XY.edges(f.path),d,a=null,b=0;T5.tweenValue(0,h.total,f.easing,function(){g.remove()},f.duration).requestUpdates(function(c,k){b=c;k&&g.remove()});var g=
T5.ex(new T5.ViewLayer(f),{cycle:function(){for(var c=0;c<h.accrued.length&&h.accrued[c]<b;)c++;a=null;if(c<f.path.length-1){var k=b-(c>0?h.accrued[c-1]:0),e=f.path[c];d=T5.XY.theta(e,f.path[c+1],h.edges[c]);a=T5.XY.extendBy(e,d,k);if(f.autoCenter)(c=g.getParent())&&c.centerOn(a)}return a},draw:function(c,k){if(a)(f.drawIndicator?f.drawIndicator:m)(c,k,T5.XY.init(a.x-k.x,a.y-k.y),d)}});return g};
T5.Marker=function(f){function m(k,e,j,i){d=k;a=e;b=j;g=i}f=T5.ex({xy:T5.XY.init(),offset:true,tweenIn:null,animationSpeed:null},f);var h=false,d=0,a=0,b=0,g=0,c=T5.ex(f,{isNew:true,isAnimating:function(){return h},draw:function(k,e,j,i,l){if(c.isNew&&f.tweenIn){var n=c.xy.y;c.xy.y=e.y-20;h=true;T5.tween(c.xy,"y",n,f.tweenIn,function(){c.xy.y=n;h=false},f.animationSpeed?f.animationSpeed:250+Math.random()*500)}c.drawMarker(k,e,c.xy.x,c.xy.y,j,i,l);c.isNew=false},drawMarker:function(k,e,j,i){k.beginPath();
k.arc(j,i,4,0,Math.PI*2,false);k.fill();m(j-4,i-4,8,8)},hitTest:function(k,e){return k>=d&&k<=d+b&&e>=a&&e<=a+g},updateBounds:m});COG.observable(c);return c};
T5.ImageMarker=function(f){f=T5.ex({image:null,imageUrl:null,animatingImage:null,animatingImageUrl:null,imageAnchor:null,rotation:0,scale:1,opacity:1},f);var m=f.imageAnchor?T5.XY.invert(f.imageAnchor):null,h=T5.ex(new T5.Marker(f),{drawMarker:function(d,a,b,g){if((a=h.isAnimating()&&h.animatingImage?h.animatingImage:h.image)&&a.complete&&a.width>0){m||(m=T5.XY.init(-a.width>>1,-a.height>>1));var c=h.scale,k=b+~~(m.x*c),e=g+~~(m.y*c),j=~~(a.width*c),i=~~(a.height*c);h.updateBounds(k,e,j,j);if(h.rotation||
h.opacity!==1){d.save();try{d.globalAlpha=h.opacity;d.translate(b,g);d.rotate(h.rotation);d.drawImage(a,m.x*c,m.y*c,j,i)}finally{d.restore()}}else d.drawImage(a,k,e,j,i)}}});if(!h.image)h.image=T5.Images.get(f.imageUrl,function(d){COG.Log.info("updating marker image to: "+d.src);h.image=d});if(!h.animatingImage)h.animatingImage=T5.Images.get(f.animatingImageUrl,function(d){h.animatingImage=d});return h};T5.Annotation=T5.Marker;T5.ImageAnnotation=T5.ImageMarker;
T5.MarkerLayer=function(f){function m(){b.changed();b.trigger("markerUpdate",d)}function h(){var g=b.getParent();if(g&&g.syncVectors)for(var c=d.length;c--;)g.syncVectors([d[c].xy])}f=T5.ex({zindex:100},f);var d=[],a=false,b=T5.ex(new T5.ViewLayer(f),{cycle:function(){return a},draw:function(g,c,k,e){a=false;for(var j=d.length;j--;){d[j].draw(g,c,k,b,e);a=a||d[j].isAnimating()}return a?1:0},add:function(g){if(g&&typeof g.length!=="undefined")for(var c=g.length;c--;){if(g[c])d[d.length]=g[c]}else if(g)d[d.length]=
g;m()},clear:function(g){if(g)for(var c=0;c<d.length;c++)g(d[c])&&d.splice(c,1);else d=[];m()},find:function(g){for(var c=[],k=d.length;k--;)if(!g||g(d[k]))c[c.length]=d[k];return c}});b.bind("tap",function(g,c,k){for(var e=[],j=k.x,i=k.y,l=d.length;l--;)if(d[l].hitTest(j,i))e[e.length]=d[l];if(e.length>0)g.cancel=b.trigger("markerTap",c,k,e).cancel});b.bind("gridUpdate",function(g,c){for(var k=d.length;k--;)c.syncVectors([d[k].xy])});b.bind("parentChange",h);b.bind("changed",h);return b};
T5.ImageLayer=function(f,m){function h(j){b.run(j,function(i){g=i;(i=e.getParent())&&i.trigger("invalidate")});k=T5.XYRect.copy(j)}function d(){var j=e.getParent();j&&j.trigger("invalidate")}function a(){h(c)}m=T5.ex({},m);var b=T5.Generator.init(f,m),g=null,c=T5.XYRect.init(),k=T5.XYRect.init(),e=T5.ex(new T5.ViewLayer(m),{cycle:function(j,i){(Math.abs(i.x1-k.x1)>i.width||Math.abs(i.y1-k.y1)>i.height)&&h(i)},draw:function(j,i){j.save();try{j.strokeStyle="#555";if(g)for(var l=g.length;l--;){var n=
j,x=g[l],y=T5.Images.get(x.url,d);if(y)n.drawImage(y,x.x,x.y,y.width,y.height);else{n.fillStyle="#777";n.fillRect(x.x,x.y,x.width,x.height)}}}finally{j.restore()}j.strokeStyle="#f00";j.beginPath();j.moveTo(i.x1+i.width/2,i.y1);j.lineTo(i.x1+i.width/2,i.y2);j.moveTo(i.x1,i.y1+i.height/2);j.lineTo(i.x2,i.y1+i.height/2);j.stroke();c=T5.XYRect.copy(i)}});e.bind("parentChange",function(j,i){b.bindToView(i);i.bind("idle",a)});return e};
T5.Style=function(f){function m(b){var g=f[b];typeof g!=="undefined"&&h.push(function(c){c[b]=g})}f=T5.ex({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},f);var h=[],d={applyToContext:function(b){for(var g=h.length;g--;)h[g](b)}};for(var a in f)m(a);return d};
(function(){var f={},m={basic:new T5.Style({lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"}),waypoints:new T5.Style({lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"})};T5.applyStyle=function(h,d){var a=T5.styles[d]?T5.styles[d]:T5.styles.basic,b;if(h&&h.canvas){b=f[h.canvas.id];f[h.canvas.id]=d}a.applyToContext(h);return b};T5.loadStyles=function(h){COG.jsonp(h,function(d){T5.resetStyles(d)})};T5.resetStyles=function(h){var d={};for(var a in h)d[a]=new T5.Style(h[a]);T5.styles=T5.ex({},
m,d)};T5.styles=m})();(function(){T5.tileSize=256;T5.Tile=function(f){return f=T5.ex({x:0,y:0,gridX:0,gridY:0,dirty:true},f)};T5.EmptyTile=function(f){f=new T5.Tile(f);f.empty=true;return f};T5.ImageTile=function(f){f=T5.ex({url:"",sessionParamRegex:null,loading:false,loaded:false},f);return new T5.Tile(f)}})();
T5.TileGrid=function(f){function m(w,F){var D=T5.Vector(w*k-n.x,F*k-n.y);return new T5.EmptyTile({gridX:D.x,gridY:D.y,empty:true})}function h(w,F,D,J){var G=Math.max(g,c)*0.2>>0,N=T5.XY.init();if(w<0||w+D>g)N.x=w<0?-G:G;if(F<0||F+J>c)N.y=F<0?-G:G;return N}function d(w,F,D){var J=COG.Log.getTraceTicks(),G=0;T5.XY.init(g/2,c/2);ka=true;try{if(D)b=[];if(w)for(D=0;D<c;D++)for(var N=0;N<g;N++){if(!b[G]){var K=w(N,D,i,g,c);K.gridX=N*k-n.x;K.gridY=D*k-n.y;b[G]=K}G++}}finally{ka=false}l=w;x=F;COG.Log.trace("tile grid populated",
J);S.changed()}function a(w,F,D,J){var G,N=[],K=false;w=T5.XY.init((w.x+n.x-k*y)*t>>0,(w.y+n.y-k*y)*t>>0);tilesNeeded=false;if(!ga){G=S.getParent().getDimensions();A=Math.ceil(G.width*t)+1+y;E=Math.ceil(G.height*t)+1+y;ga=T5.XY.init((A-1)/2>>0,(E-1)/2>>0)}for(var R=E;R--;)for(var Q=A;Q--;){G=Q+w.x>=0&&Q+w.x<g?b[(R+w.y)*g+(Q+w.x)]:null;var $=T5.XY.init(Q-ga.x,R-ga.y);if(!G){s=h(w.x,w.y,A,E);G=m(Q+w.x,R+w.y)}K=G?(G.dirty=D||G.dirty)||K:K;N[N.length]={tile:G,centerness:T5.XY.absSize($)}}N.sort(function(U,
V){return V.centerness-U.centerness});M||(M=Array(N.length));for(D=N.length;D--;){M[D]=N[D].tile;S.prepTile(M[D],F)}Y=J;return K}f=T5.ex({tileSize:T5.tileSize,bufferSize:1,center:T5.XY.init(),clearBackground:false,gridSize:25,shiftOrigin:null,supportFastDraw:true,allowShift:true},f);var b=Array(Math.pow(f.gridSize,2)),g=f.gridSize,c=f.gridSize,k=f.tileSize,e=c*k,j=g*k,i=T5.XY.offset(f.center,-Math.ceil(g>>1)),l=null,n=T5.XY.init(),x=null,y=f.bufferSize,p=Math.round(k/2),o=false,t=k?1/k:0,r=true,M=
null,C=false,ka=false,Y=0;T5.XY.init();var s=T5.XY.init();T5.getConfig();var A,E,ga,ba=f.clearBackground;T5.viewState("ANIMATING");var aa=T5.viewState("PAN"),ia=T5.viewState("PINCH"),S=T5.ex(new T5.ViewLayer(f),{gridDimensions:T5.D.init(j,e),cycle:function(w,F,D,J){if(s.x!==0||s.y!==0){J=s;var G=f.shiftOrigin;if(!(!f.allowShift||J.x===0&&J.y===0)){var N=COG.Log.getTraceTicks(),K=Array(b.length);K.length=b.length;for(var R=0;R<g;R++)for(var Q=0;Q<c;Q++)K[Q*g+R]=R+J.x>=0&&R+J.x<g?b[(Q+J.y)*g+(R+J.x)]:
null;b=K;i=G?G(i,J):T5.XY.add(i,J);n.x+=-J.x*k;n.y+=-J.y*k;COG.Log.trace("tile storage shifted",N);d(l,x)}s=T5.XY.init();J=true}if(!o&&(D&ia)===0)o=a(F,D,J,w);return o},find:function(w){if(!w)return null;for(var F=b.length;F--;){var D=b[F];if(D&&w(D))return D}return null},prepTile:function(){},drawTile:function(){return false},getTileSize:function(){return k},draw:function(w,F,D,J,G,N,K){var R=F.x;F=F.y;var Q=D.width,$=D.height,U=Q,V=$,T,W=true;if(M){ba&&w.clearRect(0,0,Q,$);w.beginPath();if(r)for(var L=
M.length;L--;){T=M[L];var Z=T.gridX-R,X=T.gridY-F;if((Z>=0||Z+k<=Q)&&(X>=0||X+k<=$)){T.x=Z;T.y=X;if(T.empty){if(!ba){w.clearRect(Z,X,k,k);w.rect(Z,X,k,k);W=false}}else if(N||T.dirty){(T=S.drawTile(w,T,Z,X,J,N,K,ba))&&w.rect(Z,X,k,k);W=W&&T}U=Z<U?Z:U;V=X<V?X:V}}if(!ba&&(J&aa)!==0){if(U>0){w.clearRect(0,0,U,D.height);w.rect(0,0,U,D.height)}if(V>0){w.clearRect(0,0,D.width,V);w.rect(0,0,D.width,V)}}ba||w.clip();W&&!C&&G.trigger("tileDrawComplete");o=false;C=W}},getTileAtXY:function(w,F){for(var D=null,
J=M?M.length:0;J--;){var G=M[J];if(G&&w>=G.x&&F>=G.y)if(w<=G.x+k&&F<=G.y+k){D=G;break}}COG.Log.info("looking for tile @ x: "+w+", y: "+F+", found: "+D);return D},getTileVirtualXY:function(w,F,D){w=T5.XY.add(T5.XY.init(w,F),T5.XY.invert(i),n);w=T5.XY.init(w.x*k,w.y*k);if(D){w.x+=p;w.y+=p}return w},populate:function(w){d(w,null,true)},syncVectors:function(){return T5.XY.init(0,0)}});S.bind("resize",function(){COG.Log.info("captured resize");ga=null});S.bind("scale",function(){r=false});COG.listen("imagecache.cleared",
function(){for(var w=b.length;w--;)if(b[w])b[w].loaded=false});COG.listen("tiler.repaint",function(){for(var w=b.length;w--;)if(b[w]){b[w].x=null;b[w].y=null}});return S};
T5.ImageTileGrid=function(f){function m(l){function n(){var x=T5.Images.newCanvas(32,32),y=x.getContext("2d");y.fillStyle="#BBBBBB";y.fillRect(0,0,32,32);y.fillStyle="#C3C3C3";y.fillRect(0,0,16,16);y.fillRect(16,16,16,16);return x}if(!d||l!==d.width){d=T5.Images.newCanvas(l,l);l=d.getContext("2d");l.fillStyle=typeof FlashCanvas!=="undefined"?"#666666":l.createPattern(n(),"repeat");l.fillRect(0,0,d.width,d.height)}return d}f=T5.ex({emptyTile:function(l){if(!h||l!==h.width){h=T5.Images.newCanvas(l,
l);l=h.getContext("2d");l.fillStyle="rgba(150, 150, 150, 0.1)";l.fillRect(0,0,h.width,h.height)}return h}(T5.tileSize),panningTile:null,tileOffset:T5.XY.init(),tileDrawArgs:{}},f);var h=f.emptyTile,d=f.panningTile?f.panningTile:m(T5.tileSize),a=T5.viewState("ACTIVE"),b=T5.viewState("PAN"),g=T5.getConfig().requireFastDraw,c=f.tileSize?f.tileSize:T5.tileSize,k=T5.Images.get,e=T5.Images.load,j=T5.ex({background:null,overlay:null,offset:T5.XY.init(),realSize:T5.D.init(c)},f.tileDrawArgs),i=T5.ex(new T5.TileGrid(f),
{drawTile:function(l,n,x,y,p,o,t,r){o=n.url?k(n.url):null;t=false;if(o){l.drawImage(o,x,y);n.dirty=false;t=true}else if((p&b)!==0){r||l.drawImage(d,x,y);t=true}return t},initTileUrl:function(){},prepTile:function(l,n){if(l&&!l.loading&&(!g||n===a)){l.url||i.initTileUrl(l);if(!k(l.url)){l.loading=true;e(l.url,function(){l.loadTime=(new Date).getTime();l.loaded=true;l.dirty=true;i.changed()},j)}}}});return i};
T5.Tiler=function(f){f=T5.ex({container:"",drawCenter:false,datasources:{},tileLoadThreshold:"first"},f);var m=T5.ex(new T5.View(f),{getTileLayer:function(){return m.getLayer("grid0")},setTileLayer:function(h){m.setLayer("grid0",h);m.trigger("gridUpdate",h);m.eachLayer(function(d){d.trigger("gridUpdate",h)})},viewPixToGridPix:function(h){var d=m.getOffset();return T5.XY.init(h.x+d.x,h.y+d.y)},centerOn:function(h,d,a,b){var g=m.getTileLayer(),c=m.getDimensions();(g=g?g.getTileSize():0)&&m.updateOffset(h.gridX-
(c.width-g)*0.5>>0,h.gridY-(c.height-g)*0.5>>0,d,a,b)},cleanup:function(){m.removeLayer("grid0")},repaint:function(){COG.say("tiler.repaint");m.trigger("wake")},select:function(h){m.trigger("selectTile",h)}});m.bind("tap",function(h,d,a){if(h=m.getTileLayer())(a=h.getTileAtXY(a.x,a.y))&&m.trigger("selectTile",a)});return m};T5.TileGenerator=function(){};
