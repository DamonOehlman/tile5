COG=typeof COG!=="undefined"?COG:{};COG.extend=function(){for(var I=arguments[0]||{},R,B=1,x=arguments.length;B<x;B++)if((R=arguments[B])!==null)for(var k in R){var i=R[k];if(I!==i)if(i!==undefined)I[k]=i}return I};
(function(){var I=Object.prototype.hasOwnProperty,R=0,B={};B.toID=function(x){return x.replace(/\s/g,"-")};B.objId=function(x){return(x?x:"obj")+R++};B.isFunction=function(x){return toString.call(x)==="[object Function]"};B.isArray=function(x){return toString.call(x)==="[object Array]"};B.isPlainObject=function(x){if(!x||toString.call(x)!=="[object Object]"||x.nodeType||x.setInterval)return false;if(x.constructor&&!I.call(x,"constructor")&&!I.call(x.constructor.prototype,"isPrototypeOf"))return false;
var k;for(k in x);return k===undefined||I.call(x,k)};B.isEmptyObject=function(x){for(var k in x)return false;return true};B.isXmlDocument=function(x){return toString.call(x)==="[object Document]"};B.contains=function(x,k){var i=x,v=arguments,s=1;if(k&&module.isArray(k)){v=k;s=0}for(s=s;s<v;s++)i=i&&typeof foo[v[s]]!=="undefined";return i};B.formatStr=function(x){if(arguments.length<=1)return x;for(var k=arguments.length-2,i=0;i<=k;i++)x=x.replace(RegExp("\\{"+i+"\\}","gi"),arguments[i+1]);return x};
B.wordExists=function(x,k){var i="";if(k.toString)k=k.toString();for(var v=0;v<k.length;v++)i+=!/\w/.test(k[v])?"\\"+k[v]:k[v];return RegExp("(^|\\s|\\,)"+i+"(\\,|\\s|$)","i").test(x)};COG.extend(COG,B)})();
(function(){function I(i){return typeof console!=="undefined"?function(){console[i](Array.prototype.slice.call(arguments,0).join(" "));return true}:function(){return false}}var R=window.console&&window.console.markTimeline,B=I("error"),x=I("info"),k=function(){return R?function(i,v){console.markTimeline(i+(v?": "+((new Date).getTime()-v)+"ms":""))}:function(){}}();COG.extend(COG,{trace:k,debug:I("debug"),info:x,warn:I("warn"),error:B,exception:function(i){if(B)for(var v in i)x("ERROR DETAIL: "+v+
": "+i[v])}})})();var FNS_TIME=["webkitAnimationTime","mozAnimationTime","animationTime","webkitAnimationStartTime","mozAnimationStartTime","animationStartTime"],FNS_FRAME=["webkitRequestAnimationFrame","mozRequestAnimationFrame","requestAnimationFrame"],animTime=function(){return(new Date).getTime()},animFrame=function(I){setTimeout(function(){I(animTime())},1E3/60)};FNS_TIME.forEach(function(I){if(I in window)animTime=function(){return window[I]}});
FNS_FRAME.forEach(function(I){if(I in window)animFrame=function(R){window[I](R)}});COG.animTime=animTime;COG.animFrame=animFrame;
COG.Loopage=function(){function I(s){return COG.extend({id:k++,frequency:0,after:0,single:false,lastTick:0,execute:function(){}},s)}function R(s){v.push(s);x||(x=animFrame(B));recalcSleepFrequency=true}function B(){for(var s,O=animTime(),Q=i.length;v.length>0;){var ca=v.shift();for(s=Q;s--;)if(i[s].id===ca){i.splice(s,1);break}Q=i.length}for(s=Q;s--;){ca=O-i[s].lastTick;if(i[s].lastTick===0||ca>=i[s].frequency){i[s].execute(O,i[s]);i[s].lastTick=O;i[s].single&&i[s].trigger("complete")}}x=Q?animFrame(B):
0}var x=0,k=0,i=[],v=[];return{join:function(s){var O=new I(s);if(O.after>0)O.lastTick=(new Date).getTime()+O.after;COG.observable(O);O.bind("complete",function(){R(O.id)});i.unshift(O);x||(x=animFrame(B));recalcSleepFrequency=true;return O},leave:R}}();
(function(){function I(B,x){var k=B.obsHandlers;k[x]||(k[x]=[]);return k[x]}var R=0;COG.observable=function(B){if(!B)return null;if(!B.obsHandlers)B.obsHandlers={};if(!(B.bind||B.trigger||B.unbind)){B.bind=function(x,k){var i="callback"+R++;I(B,x).unshift({fn:k,id:i});return i};B.trigger=function(x){var k=I(B,x),i={cancel:false,name:x},v;if(!k)return null;v=Array.prototype.slice.call(arguments,1);B.eventInterceptor&&B.eventInterceptor(x,i,v);v.unshift(i);for(var s=k.length;s--&&!i.cancel;)k[s].fn.apply(self,
v);return i};B.unbind=function(x,k){if(typeof x==="undefined")B.obsHandlers={};else for(var i=I(B,x),v=0;i&&v<i.length;v++)if(i[v].id===k){i.splice(v,1);break}return B}}return B}})();
(function(){function I(k,i){k[i]||(k[i]=function(v){return k.configure(i,v)})}function R(k){k.gtConfId="configurable"+x++;k.gtConfig={};k.gtConfigFns=[];return k.gtConfig}var B={},x=0;COG.paramTweaker=function(k,i,v){return function(s,O){if(typeof O!=="undefined"){if(s in k)k[s]=O;v&&s in v&&v[s](s,O)}else return i&&s in i?i[s](s):k[s]}};COG.configurable=function(k,i,v,s){if(k){k.gtConfId||R(k);var O=k.gtConfId,Q=k.gtConfig,ca=k.gtConfigFns;B[O]=k;ca.push(v);for(v=i.length;v--;){Q[i[v]]=true;s&&I(k,
i[v])}if(!k.configure)k.configure=function(ja,y){if(Q[ja]){for(var C=ca.length;C--;){var A=ca[C](ja,y);if(typeof A!=="undefined")return A}return B[O]}return null}}}})();
(function(){function I(k){var i=document.createElement("script"),v=false;i.src=k;i.async=true;i.onload=i.onreadystatechange=function(){if(!v&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){v=true;i.onload=i.onreadystatechange=null;i&&i.parentNode&&i.parentNode.removeChild(i)}};B||(B=document.getElementsByTagName("head")[0]);B.appendChild(i)}var R=0,B,x=this;COG.jsonp=function(k,i,v){k+=k.indexOf("?")>=0?"&":"?";var s="json"+ ++R;x[s]=function(O){i(O);x[s]=null;try{delete x[s]}catch(Q){}};
I(k+(v?v:"callback")+"="+s);return s}})();
(function(){function I(c){if(ja)return Q.length;ja=true;try{for(var n=0;n<Q.length;)if(Q[n].isComplete()){Q[n].triggerComplete(false);Q.splice(n,1)}else{Q[n].update(c);n++}}finally{ja=false}Q.length===0&&ca.trigger("complete");return Q.length}function R(){if(!ca){ca=COG.Loopage.join({execute:I,frequency:20});ca.bind("complete",function(){ca=null})}}var B=1.70158,x=Math.PI/2,k=Math.abs,i=Math.pow,v=Math.sin,s=Math.asin,O=Math.cos,Q=[],ca=null,ja=false,y={linear:function(c,n,o,t){return o*c/t+n},backin:function(c,
n,o,t){return o*(c/=t)*c*((B+1)*c-B)+n},backout:function(c,n,o,t){return o*((c=c/t-1)*c*((B+1)*c+B)+1)+n},backinout:function(c,n,o,t){return(c/=t/2)<1?o/2*c*c*(((B*=1.525)+1)*c-B)+n:o/2*((c-=2)*c*(((B*=1.525)+1)*c+B)+2)+n},bouncein:function(c,n,o,t){return o-y.bounceout(t-c,0,o,t)+n},bounceout:function(c,n,o,t){return(c/=t)<1/2.75?o*7.5625*c*c+n:c<2/2.75?o*(7.5625*(c-=1.5/2.75)*c+0.75)+n:c<2.5/2.75?o*(7.5625*(c-=2.25/2.75)*c+0.9375)+n:o*(7.5625*(c-=2.625/2.75)*c+0.984375)+n},bounceinout:function(c,
n,o,t){return c<t/2?y.bouncein(c*2,0,o,t)/2+n:y.bounceout(c*2-t,0,o,t)/2+o/2+n},cubicin:function(c,n,o,t){return o*(c/=t)*c*c+n},cubicout:function(c,n,o,t){return o*((c=c/t-1)*c*c+1)+n},cubicinout:function(c,n,o,t){if((c/=t/2)<1)return o/2*c*c*c+n;return o/2*((c-=2)*c*c+2)+n},elasticin:function(c,n,o,t,H,G){if(c==0)return n;if((c/=t)==1)return n+o;G||(G=t*0.3);if(!H||H<k(o)){H=o;o=G/4}else o=G/TWO_PI*s(o/H);return-(H*i(2,10*(c-=1))*v((c*t-o)*TWO_PI/G))+n},elasticout:function(c,n,o,t,H,G){var P;if(c==
0)return n;if((c/=t)==1)return n+o;G||(G=t*0.3);if(!H||H<k(o)){H=o;P=G/4}else P=G/TWO_PI*s(o/H);return H*i(2,-10*c)*v((c*t-P)*TWO_PI/G)+o+n},elasticinout:function(c,n,o,t,H,G){var P;if(c==0)return n;if((c/=t/2)==2)return n+o;G||(G=t*0.3*1.5);if(!H||H<k(o)){H=o;P=G/4}else P=G/TWO_PI*s(o/H);if(c<1)return-0.5*H*i(2,10*(c-=1))*v((c*t-P)*TWO_PI/G)+n;return H*i(2,-10*(c-=1))*v((c*t-P)*TWO_PI/G)*0.5+o+n},quadin:function(c,n,o,t){return o*(c/=t)*c+n},quadout:function(c,n,o,t){return-o*(c/=t)*(c-2)+n},quadinout:function(c,
n,o,t){if((c/=t/2)<1)return o/2*c*c+n;return-o/2*(--c*(c-2)-1)+n},sinein:function(c,n,o,t){return-o*O(c/t*x)+o+n},sineout:function(c,n,o,t){return o*v(c/t*x)+n},sineinout:function(c,n,o,t){return-o/2*(O(Math.PI*c/t)-1)+n}},C=COG.Tween=function(c){c=COG.extend({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:A("sine.out"),complete:null},c);var n=(new Date).getTime(),o=[],t=false,H=0,G=0,P={isComplete:function(){return t},triggerComplete:function(S){c.complete&&c.complete(S)},
update:function(S){var D=c.tweenFn(S-n,H,G,c.duration);if(c.target)c.target[c.property]=D;for(var X=o.length;X--;)o[X](D,void 0);if(t=n+c.duration<=S){if(c.target)c.target[c.property]=c.tweenFn(c.duration,H,G,c.duration);for(S=o.length;S--;)o[S](D,true)}},requestUpdates:function(S){o.push(S)}};H=c.target&&c.property&&c.target[c.property]?c.target[c.property]:c.startValue;if(typeof c.endValue!=="undefined")G=c.endValue-H;if(G==0)t=true;R();return P};COG.tweenValue=function(c,n,o,t,H){function G(D){var X=
D-P,Z=o(X,c,S,t),$=P+t<=D;D=!$;if(H){X=H(Z,$,X);D=typeof X!="undefined"?X&&D:D}D&&animFrame(G)}var P=animTime(),S=n-c;animFrame(G);return{}};COG.tween=function(c,n,o,t,H,G){c=new C({target:c,property:n,endValue:o,tweenFn:t,duration:G,complete:H});Q.push(c);return c};COG.endTweens=function(c){if(!ja){ja=true;try{for(var n=0;n<Q.length;)if(!c||c(Q[n])){Q[n].triggerComplete(true);Q.splice(n,1)}else n++}finally{ja=false}}};COG.getTweens=function(){return[].concat(Q)};var A=COG.easing=function(c){return y[c.replace(/[\-\_\s\.]/g,
"").toLowerCase()]};COG.registerEasingType=function(c,n){y[c.replace(/[\-\_\s\.]/g,"").toLowerCase()]=n}})();
(function(){var I=/^P(\d+Y)?(\d+M)?(\d+D)?$/,R=/^(\d+H)?(\d+M)?(\d+S)?$/,B={8601:function(k){k=k.split("T");var i=null;i=null;var v=0,s=0;I.lastIndex=-1;i=I.exec(k[0]);v+=i[3]?parseInt(i[3].slice(0,-1),10):0;R.lastIndex=-1;i=R.exec(k[1]);s+=i[1]?parseInt(i[1].slice(0,-1),10)*3600:0;s+=i[2]?parseInt(i[2].slice(0,-1),10)*60:0;s+=i[3]?parseInt(i[3].slice(0,-1),10):0;return new x(v,s)}},x=COG.Duration=function(k,i){return{days:k?k:0,seconds:i?i:0}};COG.addDuration=function(){for(var k=new x,i=arguments.length;i--;){k.days+=
arguments[i].days;k.seconds+=arguments[i].seconds}if(k.seconds>=86400){k.days+=~~(k.seconds/86400);k.seconds%=86400}return k};COG.formatDuration=function(k){var i,v,s="";if(k.days)s=k.days+" days ";if(k.seconds){k=k.seconds;if(k>=3600){i=~~(k/3600);k-=i*3600}if(k>=60){v=Math.round(k/60);k-=v*60}if(i)s=s+i+(i>1?" hrs ":" hr ")+(v?(v>10?v:"0"+v)+" min ":"");else if(v)s=s+v+" min";else if(k>0)s=s+(k>10?k:"0"+k)+" sec"}return s};COG.parseDuration=function(k,i){var v=i?B[i]:null;if(v)return v(k);COG.Log.warn("Could not find duration parser for specified format: "+
i);return new x}})();
INTERACT=function(){function I(y){return function(C,A,c){(c?c:y?document.body:document).addEventListener(C,A,false)}}function R(y){return function(C,A,c){(c?c:y?document.body:document).removeEventListener(C,A,false)}}function B(y,C,A){(A?A:document).attachEvent("on"+y,C)}function x(y,C,A){(A?A:document).detachEvent("on"+y,C)}function k(y,C){return{x:y?y:0,y:C?C:0,count:1}}function i(y,C){ca.push(COG.extend({handler:null,checks:{},type:y},C))}function v(y){var C=0,A=0;if(y.offsetParent){do{C+=y.offsetLeft;
A+=y.offsetTop;y=y.offsetParent}while(y)}return{x:C,y:A}}function s(y,C){for(var A=y.target?y.target:y.srcElement;A&&A.nodeName&&A.nodeName.toUpperCase()!="CANVAS";)A=A.parentNode;return A&&A===C}function O(y,C){return{x:y.x-(C?C.x:0),y:y.y-(C?C.y:0)}}function Q(y){if(y.preventDefault){y.preventDefault();y.stopPropagation()}else y.cancelBubble&&y.cancelBubble()}var ca=[],ja=function(y,C,A){A=COG.extend({binder:null,unbinder:null,observable:null},A);for(var c=A.observable,n=null,o=[],t=[],H,G,P={bind:function(){return c.bind.apply(null,
arguments)},pannable:function(D){n=COG.extend({inertia:true},D);return P},unbind:function(){c.unbind();for(var D=0;D<o.length;D++)o[D].unbind();return P}},S=0;S<C.length;S++)o.push(C[S](y,c,A));c.bind("pointerDown",function(){COG.info("reset "+t.length+" pan history");t=[];G=H=0});c.bind("pointerMove",function(D,X,Z,$){if(n){t[t.length]={ticks:(new Date).getTime(),x:$.x,y:$.y};c.trigger("pan",$.x,$.y)}H+=$.x?$.x:0;G+=$.y?$.y:0});c.bind("pointerUp",function(D,X,Z){Math.abs(H)>20||Math.abs(G)>20||c.trigger("tap",
X,Z)});return P};i("pointer",{handler:function(y,C,A){function c(w){if(s(w,y))if(D=H(w)){y.style.cursor="move";Q(w);fa=w.pageX?w.pageX:w.screenX;Y=w.pageY?w.pageY:w.screenY;X=k(fa,Y);Z=v(y);C.trigger("pointerDown",X,O(X,Z))}}function n(w){$=w.pageX?w.pageX:w.screenX;T=w.pageY?w.pageY:w.screenY;if(s(w,y))G(D?"pointerMove":"pointerHover")}function o(w){if(D&&H(w)){D=false;if(s(w,y)){y.style.cursor="default";G("pointerUp")}}}function t(w){if(s(w,y)){var aa;w=w||window.event;if(w.detail)aa=w.axis===2?
-w.detail*P:0;else{aa=w.wheelDeltaY?w.wheelDeltaY:w.wheelDelta;if(window.opera)aa=-aa}if(aa!==0){var ha=k($,T);C.trigger("zoom",ha,O(ha,v(y)),aa/S,"wheel");Q(w);w.returnValue=false}}}function H(w){w=w||window.event;return(w.which||w.button)==1}function G(w,aa,ha,ta){aa=typeof aa!="undefined"?aa:$;ha=typeof ha!="undefined"?ha:T;var xa=aa-fa,F=ha-Y,N=k(aa,ha);C.trigger(w,N,O(N,Z),k(xa,F));if(typeof ta=="undefined"||ta){fa=aa;Y=ha}}A=COG.extend({},A);var P=120,S=P*8,D=false,X,Z,$,T,fa,Y;A.binder("mousedown",
c,false);A.binder("mousemove",n,false);A.binder("mouseup",o,false);A.binder("dblclick",function(w){COG.info("captured double click");if(s(w,y)){w=k(w.pageX?w.pageX:w.screenX,w.pageY?w.pageY:w.screenY);COG.info("captured double click + target matched");C.trigger("doubleTap",w,O(w,v(y)))}},false);A.binder("mousewheel",t,document);A.binder("DOMMouseScroll",t,document);return{unbind:function(){A.unbinder("mousedown",c,false);A.unbinder("mousemove",n,false);A.unbinder("mouseup",o,false);A.unbinder("mousewheel",
t,document);A.unbinder("DOMMouseScroll",t,document)}}},checks:{touch:false}});i("pointer",{handler:function(y,C,A){function c(F){if(F.count<2)return 0;var N=F.x-F.next.x;F=F.y-F.next.y;return~~Math.sqrt(N*N+F*F)}function n(F,N,M){N=N?N:0;M=M?M:0;for(var pa={x:F.x-N,y:F.y-M,id:F.id,count:F.count},oa=pa;F.next;){F=F.next;oa=oa.next={x:F.x-N,y:F.y-M,id:F.id}}return pa}function o(F,N){var M=F[N?N:"touches"],pa,oa;if(M.length===0)return null;oa=pa={x:M[0].pageX,y:M[0].pageY,id:M[0].identifier,count:M.length};
for(var va=1,La=M.length;va<La;va++)oa=oa.next={x:M[va].pageX,y:M[va].pageY,id:M[va].identifier};return pa}function t(F){if(s(F,y)){T=v(y);var N=o(F,"changedTouches"),M=n(N,T.x,T.y);if(!Y){fa=X;C.trigger("pointerDown",N,M)}ta&&C.trigger("pointerDownMulti",N,M);Y=o(F);if(Y.count>1)aa=c(Y);xa=1;ha=n(Y)}}function H(F){if(s(F,y)){F.preventDefault();w=o(F);if(fa==X)fa=Math.abs(Y.x-w.x)>S||Math.abs(Y.y-w.y)>S?D:X;if(fa!=X){fa=w.count>1?$:Z;if(fa==$)if(Y.count===1){Y=n(w);aa=c(Y)}else{F=c(w);if(Math.abs(aa-
F)<P)fa=Z;else{var N;N=w.x;var M=w.next.x,pa=w.y,oa=w.next.y,va=pa<oa?pa:oa;N={x:(N<M?N:M)+(Math.abs(N-M)>>1),y:va+(Math.abs(pa-oa)>>1)};F=F/aa;M=F-xa;C.trigger("zoom",N,O(N,T),M,"pinch");xa=F}}fa==Z&&C.trigger("pointerMove",w,n(w,T.x,T.y),k(w.x-ha.x,w.y-ha.y));ta&&C.trigger("pointerMoveMulti",w,n(w,T.x,T.y))}ha=n(w)}}function G(F){if(s(F,y)){var N=o(F,"changedTouches"),M=n(N,T.x,T.y);w=o(F);if(!w){fa===X&&C.trigger("pointerTap",N,M);C.trigger("pointerUp",N,M);Y=null}ta&&C.trigger("pointerUpMulti",
N,M)}}A=COG.extend({detailed:false,inertia:false},A);var P=20,S=7,D=0,X=1,Z=2,$=3,T,fa,Y,w,aa,ha,ta=A.detailed,xa=1;A.binder("touchstart",t,false);A.binder("touchmove",H,false);A.binder("touchend",G,false);COG.info("initialized touch handler");return{unbind:function(){A.unbinder("touchstart",t,false);A.unbinder("touchmove",H,false);A.unbinder("touchend",G,false)}}},checks:{touch:true}});return{register:i,watch:function(y,C,A){C=COG.extend({bindToBody:false,observable:null,isIE:typeof window.attachEvent!=
"undefined",types:null},C);capabilities=COG.extend({touch:"ontouchstart"in window},A);if(!C.observable){COG.info("creating observable");C.observable=COG.observable({});globalOpts=C}C.binder=C.isIE?B:I(C.bindToBody);C.unbinder=C.isIE?x:R(C.bindToBody);A=C.types;for(var c=capabilities,n=[],o=ca.length;o--;){var t=ca[o],H=!A||A.indexOf(t.type)>=0,G=true;for(var P in t.checks){var S=t.checks[P];COG.info("checking "+P+" capability. require: "+S+", capability = "+c[P]);G=G&&S===c[P]}if(H&&G)n[n.length]=
t.handler}return new ja(y,n,C)}}}();
T5=function(){function I(){return(new Date).getTime()}function R(){for(;aa.length>0;){var b=aa.shift();document.location=b}w=0}function B(b){for(var l=true,e=ha.length;e--;)l=l&&b!=ha[e];return l}function x(b,l){var e=[];for(var a in l)a&&e.push(a+"="+escape(l[a]));return"tile5://"+b+"/"+(e.length>0?"?"+e.join("&"):"")}function k(b,l){B(b)&&COG.info("would push url: "+x(b,l))}function i(b,l){if(B(b)){aa.push(x(b,l));w||(w=setTimeout(R,100))}}function v(b){return function(l,e,a){(a?a:b?document.body:
document).addEventListener(l,e,false)}}function s(b){return function(l,e,a){(a?a:b?document.body:document).removeEventListener(l,e,false)}}function O(b,l,e){(e?e:document).attachEvent("on"+b,l)}function Q(b,l,e){(e?e:document).detachEvent("on"+b,l)}function ca(){T={base:{name:"Unknown",bindEvent:v(),unbindEvent:s(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:k,targetFps:null},ie:{name:"MSIE",regex:/msie/i,
bindEvent:O,unbindEvent:Q,requireFastDraw:false,targetFps:25},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:i,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:i},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:i},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:v(true),unbindEvent:s(true),supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},
bridgeNotify:i},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:i}};fa=[T.froyo,T.android,T.ipod,T.iphone,T.ipad,T.ie]}function ja(){T||ca();if(!Y){COG.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var b=0;b<fa.length;b++){var l=fa[b];if(l.regex&&l.regex.test(navigator.userAgent)){Y=COG.extend({},T.base,l);COG.info("PLATFORM DETECTED AS: "+Y.name);break}}if(!Y){COG.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
Y=T.base}COG.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return Y}function y(){for(var b=0,l=arguments.length;l--;){var e=N[arguments[l].toUpperCase()];if(e)b|=e}return b}var C=Math.abs,A=Math.min,c=Math.max,n=Math.pow,o=Math.sqrt,t=Math.log,H=Math.round,G=Math.sin,P=Math.asin,S=Math.cos,D=function(){function b(a,d){return e(a.x-d.x,a.y-d.y)}function l(a,d){if(!d)d=a.length;if(d<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var h={edges:Array(d-
1),accrued:Array(d-1),total:0},g=0;g<d-1;g++){var p=b(a[g],a[g+1]);h.edges[g]=o(p.x*p.x+p.y*p.y);h.accrued[g]=h.total+h.edges[g];h.total+=h.edges[g]}return h}function e(a,d){return{x:a?a:0,y:d?d:0}}return{VECTOR_SIMPLIFICATION:3,SIMPLIFICATION_MIN_VECTORS:25,add:function(){for(var a=0,d=0,h=arguments.length;h--;){a+=arguments[h].x;d+=arguments[h].y}return e(a,d)},absSize:function(a){return c(C(a.x),C(a.y))},copy:function(a){return a?e(a.x,a.y):null},diff:b,distance:function(a,d){return l(a,d).total},
edges:l,equals:function(a,d){return a.x===d.x&&a.y===d.y},extendBy:function(a,d,h){var g=S(d)*h;d=G(d)*h;return e(a.x-g,a.y-d)},floor:function(a){for(var d=Array(a.length),h=a.length;h--;)d[h]=e(~~a[h].x,~~a[h].y);return d},getRect:function(a){for(var d,h,g,p,m=a.length;m--;){var j=a[m];d=typeof d==="undefined"||j.x<d?j.x:d;h=typeof h==="undefined"||j.y<h?j.y:h;g=typeof g==="undefined"||j.x>g?j.x:g;p=typeof p==="undefined"||j.y>p?j.y:p}return Z.init(d,h,g,p)},init:e,invert:function(a){return e(-a.x,
-a.y)},min:function(a,d){return e(a.x<d.x?a.x:d.x,a.y<d.y?a.y:d.y)},max:function(a,d){return e(a.x>d.x?a.x:d.x,a.y>d.y?a.y:d.y)},offset:function(a,d,h){return e(a.x+d,a.y+(h?h:d))},simplify:function(a,d){if(!a)return null;d=d?d:D.VECTOR_SIMPLIFICATION;for(var h=[],g=null,p=a.length;p--;){var m=a[p];if(include=!g||p===0||C(m.x-g.x)+C(m.y-g.y)>d){h.unshift(m);g=m}}return h},theta:function(a,d,h){h=P((a.y-d.y)/h);return a.x>d.x?h:Math.PI-h},toString:function(a){return a.x+", "+a.y}}}(),X=function(){return{dotProduct:function(b,
l){return b.x*l.x+b.y*l.y}}}(),Z=function(){function b(e){return l(e.x1,e.y1,e.x2,e.y2)}function l(e,a,d,h){e=e?e:0;a=a?a:0;d=typeof d!=="undefined"?d:e;h=typeof h!=="undefined "?h:h;return{x1:e,y1:a,x2:d,y2:h,width:d-e,height:h-a}}return{center:function(e){return D.init(e.x1+e.width/2,e.y1+e.height/2)},copy:b,diagonalSize:function(e){return o(e.width*e.width+e.height*e.height)},fromCenter:function(e,a,d,h){d=d>>1;h=h>>1;return l(e-d,a-h,e+d,a+h)},init:l,intersect:function(e,a){var d=c(e.x1,a.x1),
h=c(e.y1,a.y1),g=A(e.x2,a.x2),p=A(e.y2,a.y2);d=l(d,h,g,p);return d.width>0&&d.height>0?d:null},toString:function(e){return"["+e.x1+", "+e.y1+", "+e.x2+", "+e.y2+"]"},union:function(e,a){if(e.width===0||e.height===0)return b(a);else if(a.width===0||a.height===0)return b(e);else{var d=A(e.x1,a.x1),h=A(e.y1,a.y1),g=c(e.x2,a.x2),p=c(e.y2,a.y2);d=l(d,h,g,p);return d.width>0&&d.height>0?d:null}}}}(),$=function(){return{getAspectRatio:function(b){return b.height!==0?b.width/b.height:1},getCenter:function(b){return D.init(b.width>>
1,b.height>>1)},getSize:function(b){return o(n(b.width,2)+n(b.height,2))},init:function(b,l){b=b?b:0;return{width:b,height:l?l:b}}}}(),T=null,fa=[],Y=null,w=0,aa=[],ha=["view.wake","tile.loaded"],ta=function(){function b(){var f=ja().maxImageLoads;if(!f||m.length<f)if(f=p.shift()){m[m.length]=f;f.image.onload=l;f.image.src=f.url;f.requested=T5.ticks()}}function l(){var f=h[this.id],z;if(f&&f.image.complete&&f.image.width>0){f.loaded=true;f.hitCount=1;for(z=m.length;z--;)if(m[z].image.src==this.src){m.splice(z,
1);break}if(f.background||f.postProcess||f.drawBackground||f.customDraw)if(f.image){globalImageData=f;z=a(f.realSize?f.realSize.width:f.image.width,f.realSize?f.realSize.height:f.image.height);var J=z.getContext("2d"),L=f.offset?f.offset:T5.XY.init();f.background&&J.drawImage(f.background,0,0);f.drawBackground&&f.drawBackground(J);f.customDraw?f.customDraw(J,f):J.drawImage(f.image,L.x,L.y);f.postProcess&&f.postProcess(J,f);f.image=z}for(z=f.callbacks.length;z--;)f.callbacks[z]&&f.callbacks[z](this,
false);f.callbacks=[];j[j.length]={url:this.src,created:f.requested};delete h[this.id];b()}}function e(f,z,J){var L=d[f];if(L){L.hitCount++;L.image.complete&&L.image.width>0&&z?z(L.image,true):L.callbacks.push(z)}else{L=COG.extend({url:f,image:new Image,loaded:false,created:T5.ticks(),requested:null,hitCount:0,callbacks:[z]},J);L.image.id="resourceLoaderImage"+g++;d[f]=L;h[L.image.id]=L;p[p.length]=L;b()}return L}function a(f,z){var J=document.createElement("canvas");COG.info("creating new canvas");
J.width=f?f:0;J.height=z?z:0;if(typeof FlashCanvas!="undefined"){document.body.appendChild(J);FlashCanvas.initElement(J)}return J}var d={},h={},g=0,p=[],m=[],j=[],q={avgImageSize:25,loadTimeout:10,cancelLoad:function(){var f;for(f=m.length;f--;)delete d[m[f].url];m=[];for(f=p.length;f--;)delete d[p[f].url];p=[]},get:function(f,z,J){var L=null;L=null;if((L=(L=d[f])?L.image:null)&&(L.getContext||L.complete&&L.width>0))return L;else z&&e(f,z,J);return null},load:e,newCanvas:a,reset:function(){d={}},
stats:function(){return{imageLoadingCount:m.length,queuedImageCount:p.length,imageCacheFullness:0}}};COG.observable(q);return q}(),xa=function(){var b={};return{init:function(l,e){var a=b[l];if(!a)throw Error("Unable to locate requested generator: "+l);return new a(e)},register:function(l,e){b[l]=e},Template:function(){}}}(),F=function(){function b(g,p){d[g]=e(p);return g}function l(g){for(var p in g)b(p,g[p])}function e(g){function p(f){var z=g[f];typeof z!=="undefined"&&j.push(function(J){J[f]=
z})}function m(){j=[];for(var f in g)p(f)}g=COG.extend({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},g);var j=[],q={applyToContext:function(f){for(var z=j.length;z--;)j[z](f)},update:function(f,z){g[f]=z;m()}};m();return q}var a={},d={},h={apply:function(g,p){var m=d[p]?d[p]:d.basic,j;if(g&&g.canvas){j=a[g.canvas.id];a[g.canvas.id]=p}m.applyToContext(g);return j},define:b,
defineMany:l,get:function(g){return d[g]},init:e,load:function(g){COG.jsonp(g,function(p){l(p)})}};l({basic:{lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"},waypoints:{lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"}});return h}(),N={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,ZOOM:16,FREEZE:128},M=function(b){b=COG.extend({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:y("ACTIVE","ANIMATING","PAN","ZOOM"),style:null,minXY:null,maxXY:null},b);var l=null,e=false,a=false,d=
b.id,h=y("ACTIVE"),g=b.validStates,p=0,m=0,j=COG.extend({addToView:function(q){q.setLayer(d,j)},shouldDraw:function(q){return(q&g)!==0},clip:null,cycle:function(){},draw:function(){},remove:function(){j.trigger("remove",j)},changed:function(){a=true;l&&l.invalidate()},getId:function(){return d},setId:function(q){d=q},getParent:function(){return l},setParent:function(q){e=(l=q)?l.fastDraw&&displayState!==h:false;j.trigger("parentChange",l)}},b);COG.observable(j);j.bind("drawComplete",function(q,f){a=
false;p=f.x1;m=f.y1});j.bind("resync",function(q,f){if(f.syncXY){j.minXY&&f.syncXY(j.minXY);j.maxXY&&f.syncXY(j.maxXY)}});return j},pa=function(b){function l(m,j,q,f){a=m;d=j;h=q;g=f}b=COG.extend({xy:D.init(),offset:true,tweenIn:null,animationSpeed:null,isNew:true},b);var e=false,a=0,d=0,h=0,g=0,p=COG.extend(b,{isAnimating:function(){return e},draw:function(m,j,q,f,z){if(p.isNew&&b.tweenIn)COG.tweenValue(j.y1-20,p.xy.y,b.tweenIn,b.animationSpeed?b.animationSpeed:250+Math.random()*500,function(J,L){p.xy.y=
J|0;e=!L;z.invalidate()});p.drawMarker(m,j,p.xy.x,p.xy.y,q,f,z);p.isNew=false},drawMarker:function(m,j,q,f){m.beginPath();m.arc(q,f,4,0,Math.PI*2,false);m.fill();l(q-4,f-4,8,8)},hitTest:function(m,j){return m>=a&&m<=a+h&&j>=d&&j<=d+g},updateBounds:l});COG.observable(p);return p},oa=function(b){function l(){e();d.changed();d.trigger("markerUpdate",a)}function e(){var h=d.getParent();if(h&&h.syncXY)for(var g=a.length;g--;)h.syncXY([a[g].xy])}b=COG.extend({zindex:100,style:"basic"},b);var a=[],d=COG.extend(new M(b),
{draw:function(h,g,p,m){for(var j=a.length;j--;)a[j].draw(h,g,p,d,m)},add:function(h){if(h&&typeof h.length!=="undefined")for(var g=h.length;g--;){if(h[g])a[a.length]=h[g]}else if(h)a[a.length]=h;l()},clear:function(h){if(h)for(var g=0;g<a.length;)if(h(a[g]))a.splice(g,1);else g+=1;else a=[];l()},each:function(h){if(h)for(var g=a.length;g--;)h(a[g])},find:function(h){for(var g=[],p=a.length;p--;)if(!h||h(a[p]))g[g.length]=a[p];return g}});d.bind("tap",function(h,g,p,m){var j=[],q=m.x;m=m.y;for(var f=
a.length;f--;)if(a[f].hitTest(q,m))j[j.length]=a[f];if(j.length>0)h.cancel=d.trigger("markerTap",g,p,j).cancel});d.bind("parentChange",e);d.bind("resync",e);return d},va=function(b){function l(m,j,q){m.fillStyle="#FFFFFF";m.strokeStyle="#222222";m.beginPath();m.arc(q.x,q.y,4,0,Math.PI*2,false);m.stroke();m.fill()}b=COG.extend({path:[],id:COG.objId("pathAni"),easing:COG.easing("sine.inout"),validStates:y("ACTIVE","PAN","ZOOM"),drawIndicator:null,duration:2E3},b);var e=D.edges(b.path),a,d=null,h=b.drawIndicator?
b.drawIndicator:l,g=0,p=COG.extend(new M(b),{cycle:function(){for(var m=0;m<e.accrued.length&&e.accrued[m]<g;)m++;d=null;if(m<b.path.length-1){var j=g-(m>0?e.accrued[m-1]:0),q=b.path[m];a=D.theta(q,b.path[m+1],e.edges[m]);d=D.extendBy(q,a,j)}return d},draw:function(m,j){d&&h&&h(m,j,D.init(d.x,d.y),a)}});COG.tweenValue(0,e.total,b.easing,b.duration,function(m,j){g=m;j&&p.remove();p.changed()});return p},La=function(b){b=COG.extend({style:null,properties:{}},b);return COG.extend(b,{rect:null,draw:function(){},
resync:function(){}})},kb=function(){return{tileSize:256,init:function(b,l,e,a,d){return COG.extend({x:b,y:l,width:e,height:a},d)}}}(),Ua={ex:COG.extend,ticks:I,getConfig:ja,userMessage:function(b,l,e){Ua.trigger("userMessage",b,l,e)},zoomable:function(b,l){function e(g,p){g=g?c(A(g,h),d):d;if(g!=a){a=g;b.triggerAll("zoomLevelChange",g,p)}}l=COG.extend({initial:1,minZoom:1,maxZoom:16},l);var a=null,d=l.minZoom,h=l.maxZoom;COG.extend(b,{getZoomLevel:function(){return a},setZoomLevel:e});b.bind("scale",
function(g,p,m){g=Math.log(p)/Math.LN2;COG.endTweens(function(j){return j.cancelOnInteract});e(a+g,m);b.updateOffset(m.x*p,m.y*p)})},XY:D,XYRect:Z,Dimensions:$,Vector:X,D:$,Images:ta,Generator:xa,tween:COG.tween,tweenValue:COG.tweenValue,easing:COG.easing,Tween:COG.Tween,Style:F,viewState:y,View:function(b){function l(u,r,E,K){qa=Ma;q(da-r,ea-E,K?b.panAnimationEasing:null,K?b.panAnimationDuration:null);clearTimeout(eb);eb=setTimeout(e,100)}function e(){qa=Va;la()}function a(u,r,E,K){Wa(A(c(ba+n(2,
K)-1,0.5),2))}function d(){var u=t(ba)/Math.LN2>>0;if(u!==0){ba=n(2,u);u=D.init(Na-(Ba/ba>>0),Oa-(Ca/ba>>0));if(!ia.trigger("scale",ba,u).cancel){for(var r=U.length;r--;)U[r].trigger("scale",ba,u);ba=1;qa=Va}Xa()}la()}function h(u){u||(u=D.init(Ba,Ca));Ya=D.init(da,ea);Ja=D.offset(u,da,ea);Na=Ja.x;Oa=Ja.y}function g(u,r){var E,K;K=1/ba;if(ba!==1&&ua){E=ua.x1+u*K;K=ua.y1+r*K}else{E=u+da;K=r+ea}return D.init(E,K)}function p(u,r,E){Ka("doubleTap",r,E,g(E.x,E.y));if(b.scalable){COG.endTweens(function(K){return K.cancelOnInteract});
Wa(2,E,b.zoomAnimation,null,b.zoomDuration)}}function m(){clearTimeout(fb);fb=setTimeout(f,250)}function j(u,r,E){Ka("tap",r,E,g(E.x,E.y))}function q(u,r,E,K,V){function ra(){Da+=1;if(Da>=2){e();V&&V()}}var Da=0,wa=Ga?D.offset(Ga,-Ba,-Ca):null,Ea=Ha?D.offset(Ha,-Ba,-Ca):null;if(wa){u=u<wa.x?wa.x:u;r=r<wa.y?wa.y:r}if(Ea){u=u>Ea.x?Ea.x:u;r=r>Ea.y?Ea.y:r}if(E){if((qa&Ma)===0){COG.tweenValue(da,u,E,K,function(Ia,Za){da=Ia|0;(Za?ra:la)();return!Pa});COG.tweenValue(ea,r,E,K,function(Ia,Za){ea=Ia|0;(Za?
ra:la)();return!Pa});qa=Ma|$a}}else{da=u|0;ea=r|0;la();V&&V()}}function f(u,r){var E;if(ka){ya&&ya.unbind();if(b.autoSize&&ka.parentNode){u=ka.parentNode.offsetWidth;r=ka.parentNode.offsetHeight}try{if(!ka.id)ka.id=b.id+"_canvas";W=ka.getContext("2d")}catch(K){COG.exception(K);throw Error("Could not initialise canvas on specified view element");}if(u&&r&&(ma!==r||na!==u)){ab=true;na=u;ma=r;Ba=na>>1;Ca=ma>>1;ia.trigger("resize",na,ma);for(E=sa;E--;)U[E].trigger("resize",na,ma)}if(b.interactive){ya=
INTERACT.watch(ka).pannable();J()}for(E=sa;E--;)U[E].trigger("contextChanged",W);la()}}function z(u,r){r.setId(u);r.added=I();r.bind("remove",function(){ia.removeLayer(u)});r.trigger("contextChanged",W);r.setParent(ia);U.push(r);U.sort(function(E,K){var V=K.zindex-E.zindex;if(V===0)V=K.added-E.added;return V});sa=U.length;return r}function J(){if(ya){if(b.pannable){ya.bind("pan",l);ya.bind("inertiaCancel",function(){la()})}if(b.scalable){ya.bind("zoom",a);ya.bind("doubleTap",p)}ya.bind("tap",j)}}
function L(){var u=Qa?da+Ba:da,r=Ra?ea+Ca:ea;if(za&&za>na)if(u+na>za)da=Qa?u-za>0?da-za:da:za-na;else if(u<0)da=Qa?da+za:0;if(Aa&&Aa>ma)if(r+ma>Aa)ea=Ra?r-Aa>0?ea-Aa:ea:Aa-ma;else if(r<0)ea=Ra?ea+Aa:0}function ga(u,r,E,K){var V;Z.center(r);var ra=0;ua=Z.copy(r);ua.scaleFactor=ba;E||W.clearRect(0,0,na,ma);W.save();try{W.globalCompositeOperation="source-over";if(ba!==1){var Da=ua,wa=1/ba;Na=Ja.x+(da-Ya.x);Oa=Ja.y+(ea-Ya.y);ua=Da?Z.fromCenter(Na>>0,Oa>>0,Da.width*wa>>0,Da.height*wa>>0):void 0;W.scale(ba,
ba)}W.translate(-ua.x1,-ua.y1);Ha=Ga=null;if(E){W.beginPath();for(ra=sa;ra--;)U[ra].clip&&U[ra].clip(W,ua,u,ia,K);W.closePath();W.clip()}for(ra=sa;ra--;){V=U[ra];var Ea=V.style,Ia=Ea?F.apply(W,Ea):null;if(V.minXY)Ga=Ga?D.min(Ga,V.minXY):D.copy(V.minXY);if(V.maxXY)Ha=Ha?D.max(Ha,V.maxXY):D.copy(V.maxXY);V.draw(W,ua,u,ia,K);Ia&&F.apply(W,Ia)}}finally{W.restore()}if(lb){W.globalCompositeOperation="source-over";W.strokeStyle="#f00";W.beginPath();W.moveTo(Ba,0);W.lineTo(Ba,ma);W.moveTo(0,Ca);W.lineTo(na,
Ca);W.stroke()}bb=0;Ka("drawComplete",r,K)}function Fa(u){var r,E=false;if(bb){if(u-gb>mb){if(ba!==1)qa|=hb;Pa=(r=(qa&(hb|Ma))!==0)&&(qa&$a)===0;if(ab&&ka){typeof FlashCanvas!="undefined"&&FlashCanvas.initElement(ka);ka.width=na;ka.height=ma;ka.style.width=na+"px";ka.style.height=ma+"px";ab=false}if(za||Aa)L();Sa=Ta();if(Pa){COG.endTweens(function(V){return V.cancelOnInteract});nb=false;if(cb!==0){clearTimeout(cb);cb=0}}for(var K=sa;K--;){if(U[K].animated)qa|=$a;U[K].cycle(u,Sa,qa);U[K].shouldDraw(qa,
Sa);E=U[K].clip||E}ga(qa,Sa,ob&&E&&!r,u);u-ib>pb&&Xa();gb=u}COG.animFrame(Fa)}else db=false}function la(){bb+=1;if(!db){db=true;COG.animFrame(Fa)}}function Ta(){return Z.init(da,ea,da+na,ea+ma)}function Xa(){ib=(new Date).getTime();Ka("refresh",ia,Ta());la()}function Wa(u,r,E,K,V){if(E)COG.tweenValue(ba,u,E,V,function(ra,Da){ba=ra;if(Da){var wa=H(t(ba)/Math.LN2);ba=n(2,wa);K&&K()}h(r);d()});else{ba=u;h(r);d()}return ia}function Ka(){for(var u=ia.trigger.apply(null,arguments).cancel,r=U.length;r--;)u=
U[r].trigger.apply(null,arguments).cancel||u;return!u}b=COG.extend({id:COG.objId("view"),container:"",fastDraw:false,inertia:true,idleDelay:100,minRefresh:1E3,pannable:true,clipping:true,scalable:true,interactive:true,panAnimationEasing:COG.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:true,tapExtent:10,mask:true,guides:false,fps:25,zoomAnimation:COG.easing("quad.out"),zoomDuration:300},b);var U=[],sa=0,ka=document.getElementById(b.container),
W=null,qb=typeof window.attachEvent!="undefined",pb=b.minRefresh,da=0,ea=0,za=null,Aa=null,Qa=false,Ra=false,ob=b.clipping,Sa=null,db=false,ua,lb=b.guides,jb=1,Ba=0,Ca=0,Ya=null,Ja=null,Pa=false,nb=false,cb=0,eb=0,Ga=null,Ha=null,ib=0,rb=0,fb=0,ba=1,gb=0,ab=false,ya=null,ma,na,mb=1E3/b.fps|0,bb=0,Na,Oa,Va=y("ACTIVE"),Ma=y("PAN"),hb=y("ZOOM"),$a=y("ANIMATING"),qa=Va,ia={id:b.id,deviceScaling:jb,fastDraw:b.fastDraw||ja().requireFastDraw,getDimensions:function(){return $.init(na,ma)},getLayer:function(u){for(var r=
0;r<sa;r++)if(U[r].getId()==u)return U[r];return null},setLayer:function(u,r){for(var E=0;E<sa;E++)if(U[E].getId()===u){U.splice(E,1);break}if(r){z(u,r);r.trigger("refresh",ia,Ta())}la();return r},eachLayer:function(u){for(var r=sa;r--;)u(U[r])},invalidate:la,refresh:Xa,resetScale:function(){ba=1},resize:function(u,r){if(ka){b.autoSize=false;if(na!==u||ma!==r)f(u,r)}},scale:Wa,triggerAll:Ka,removeLayer:function(u){a:{for(var r=sa;r--;)if(U[r].getId()==u){u=r;break a}u=-1}if(u>=0&&u<sa){ia.trigger("layerRemoved",
U[u]);U.splice(u,1);la()}sa=U.length},getOffset:function(){return D.init(da,ea)},setMaxOffset:function(u,r,E,K){za=u;Aa=r;Qa=typeof E!="undefined"?E:false;Ra=typeof K!="undefined"?K:false},getViewRect:Ta,updateOffset:q,pan:function(u,r,E,K,V){q(da+u,ea+r,E,K,V)}};jb=ja().getScaling();ia.markers=z("markers",new oa);COG.observable(ia);ia.bind("invalidate",function(){la()});ia.bind("resync",function(){Ha=Ga=null});COG.configurable(ia,["inertia","container","rotation","tapExtent","scalable","pannable"],
COG.paramTweaker(b,null,{container:function(u,r){ka=document.getElementById(r);f()},rotation:function(u,r){rb=r}}),true);f();if(b.autoSize)qb?window.attachEvent("onresize",m):window.addEventListener("resize",m,false);return ia},ViewLayer:M,ImageLayer:function(b,l){function e(j,q,f){for(q=g.length;q--;){var z=g[q],J=z.x,L=z.y,ga=Z.init(z.x,z.y,z.x+z.width,z.y+z.height);if(f&&Z.intersect(j,ga))(ga=ta.get(z.url,function(){m.changed()},p))&&f(ga,J,L,z.width,z.height)}}function a(j){var q=++h,f=m.getParent();
if(d){COG.info("generating: "+Z.toString(j)+", sequence = "+q);d.run(f,j,function(z){if(q==h){g=[].concat(z);f.invalidate()}})}}l=COG.extend({imageLoadArgs:{}},l);var d=b?xa.init(b,l):null,h=0,g=[],p=l.imageLoadArgs,m=COG.extend(new M(l),{changeGenerator:function(j,q){d=xa.init(j,COG.extend({},l,q));g=null;a(m.getParent().getViewRect())},clip:function(j,q,f){e(q,f,function(z,J,L,ga,Fa){j.rect(J,L,ga,Fa)})},draw:function(j,q,f){e(q,f,function(z,J,L,ga,Fa){m.drawImage(j,z,J,L,ga,Fa,q,f)})},drawImage:function(j,
q,f,z){q&&j.drawImage(q,f,z,q.width,q.height)}});m.bind("refresh",function(j,q,f){a(f)});m.bind("tap",function(j,q,f,z){j=[];var J=z.x,L=z.y,ga,Fa;if(g)for(var la=g.length;la--;){ga=g[la];if(Fa=J>=ga.x&&J<=ga.x+ga.width&&L>=ga.y&&L<=ga.y+ga.height)j[j.length]=ga}j.length>0&&m.trigger("tapImage",j,q,f,z)});return m},ImageGenerator:function(b){b=COG.extend({relative:false,padding:2},b);b={run:function(){COG.warn("running base generator - this should be overriden")}};COG.observable(b);return b},Marker:pa,
ImageMarker:function(b){b=COG.extend({image:null,imageUrl:null,animatingImage:null,animatingImageUrl:null,imageAnchor:null,rotation:0,scale:1,opacity:1},b);var l=b.imageAnchor?T5.XY.invert(b.imageAnchor):null,e=COG.extend(new pa(b),{drawMarker:function(a,d,h,g){if((d=e.isAnimating()&&e.animatingImage?e.animatingImage:e.image)&&d.width>0){l||(l=D.init(-d.width>>1,-d.height>>1));var p=e.scale,m=h+~~(l.x*p),j=g+~~(l.y*p),q=~~(d.width*p),f=~~(d.height*p);e.updateBounds(m,j,q,q);if(e.rotation||e.opacity!==
1){a.save();try{a.globalAlpha=e.opacity;a.translate(h,g);a.rotate(e.rotation);a.drawImage(d,l.x*p,l.y*p,q,f)}finally{a.restore()}}else a.drawImage(d,m,j,q,f)}}});if(!e.image)e.image=ta.get(b.imageUrl,function(a){e.image=a});if(!e.animatingImage)e.animatingImage=ta.get(b.animatingImageUrl,function(a){e.animatingImage=a});return e},MarkerLayer:oa,PathLayer:function(b){function l(){var j=m.getParent();if(j&&j.syncXY){j.syncXY(d);h&&j.syncXY(h);m.trigger("tidy")}}b=COG.extend({style:"waypoints",pixelGeneralization:8,
zindex:50},b);var e=[],a=null,d=[],h=null,g=0,p=[],m=COG.extend(new M(b),{getAnimation:function(j,q,f,z){var J="pathAnimation"+g++;p.push(J);return new va({id:J,path:e,zindex:b.zindex+1,easing:j?j:COG.easing("sine.inout"),duration:q?q:5E3,drawIndicator:f,autoCenter:z?z:false})},draw:function(j){var q,f=e.length;j.save();try{F.apply(j,b.style);if(f>0){j.beginPath();j.moveTo(e[f-1].x,e[f-1].y);for(q=f;q--;)j.lineTo(e[q].x,e[q].y);j.stroke();if(a){j.fillStyle=b.waypointFillStyle;for(q=a.length;q--;){j.beginPath();
j.arc(a[q].x,a[q].y,2,0,Math.PI*2,false);j.stroke();j.fill()}}}}finally{j.restore()}},updateCoordinates:function(j,q){d=j;h=q;l()}});m.bind("tidy",function(){e=D.simplify(d,b.pixelGeneralization);a=D.simplify(h,b.pixelGeneralization);m.changed(true)});m.bind("resync",l);return m},AnimatedPathLayer:va,Shape:La,Arc:function(b,l){l=COG.extend({size:4},l);var e=D.init(),a=COG.extend(l,{draw:function(d){d.beginPath();d.arc(e.x,e.y,a.size,0,Math.PI*2,false);d.fill();d.stroke()},resync:function(d){d.syncXY([b]);
e=D.floor([b])[0]}});COG.info("created arc = ",b);return a},Poly:function(b,l){l=COG.extend({fill:false,simplify:false},l);var e=false,a=l.fill,d=l.simplify,h=y("ZOOM"),g=[],p=COG.extend(new La(l),{draw:function(m,j,q,f,z,J){if(e){j=true;q=(J&h)!==0;m.beginPath();for(J=g.length;J--;){q=g[J].x;f=g[J].y;if(j){m.moveTo(q,f);j=false}else m.lineTo(q,f);q=true}if(q){a&&m.fill();m.stroke()}}},resync:function(m){p.xy=m.syncXY(b);g=D.floor(d?D.simplify(b):b)}});e=b&&b.length>=2;return p},ShapeLayer:function(b){function l(h){for(var g=
a.length;g--;)a[g].resync(h);a.sort(function(p,m){var j=m.xy.y-p.xy.y;if(j===0)j=m.xy.x-p.xy.y;return j});d.changed()}function e(h,g){g.syncXY&&l(g)}b=COG.extend({zindex:80},b);var a=[],d=COG.extend(new M(b),{add:function(h){a[a.length]=h},each:function(h){for(var g=a.length;g--;)h(a[g])},draw:function(h,g,p){var m=g.x1,j=g.y1,q=g.width;g=g.height;for(var f=a.length;f--;){var z=a[f].style;z=z?F.apply(h,z):null;a[f].draw(h,m,j,q,g,p);z&&F.apply(h,z)}}});d.bind("parentChange",e);d.bind("resync",e);
return d},Tiling:kb};COG.observable(Ua);return Ua}();
