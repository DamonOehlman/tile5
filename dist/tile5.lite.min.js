COG=typeof COG!=="undefined"?COG:{};COG.extend=function(){var U=arguments[0]||{},ca=Array.prototype.slice.call(arguments,1),B,x;for(x=ca.length;x--;)if((B=ca[x])!==null)for(var q in B){var s=B[q];if(U!==s)if(s!==undefined)U[q]=s}return U};
(function(){var U=Object.prototype.hasOwnProperty,ca=0,B={};B.toID=function(x){return x.replace(/\s/g,"-")};B.objId=function(x){return(x?x:"obj")+ca++};B.isFunction=function(x){return toString.call(x)==="[object Function]"};B.isArray=function(x){return toString.call(x)==="[object Array]"};B.isPlainObject=function(x){if(!x||toString.call(x)!=="[object Object]"||x.nodeType||x.setInterval)return false;if(x.constructor&&!U.call(x,"constructor")&&!U.call(x.constructor.prototype,"isPrototypeOf"))return false;
var q;for(q in x);return q===undefined||U.call(x,q)};B.isEmptyObject=function(x){for(var q in x)return false;return true};B.isXmlDocument=function(x){return toString.call(x)==="[object Document]"};B.contains=function(x,q){var s=x,v=arguments,O=1;if(q&&module.isArray(q)){v=q;O=0}for(O=O;O<v;O++)s=s&&typeof foo[v[O]]!=="undefined";return s};B.formatStr=function(x){if(arguments.length<=1)return x;for(var q=arguments.length-2,s=0;s<=q;s++)x=x.replace(RegExp("\\{"+s+"\\}","gi"),arguments[s+1]);return x};
B.wordExists=function(x,q){var s="";if(q.toString)q=q.toString();for(var v=0;v<q.length;v++)s+=!/\w/.test(q[v])?"\\"+q[v]:q[v];return RegExp("(^|\\s|\\,)"+s+"(\\,|\\s|$)","i").test(x)};COG.extend(COG,B)})();
(function(){function U(s){return typeof console!=="undefined"?function(){console[s](Array.prototype.slice.call(arguments,0).join(" "));return true}:function(){return false}}var ca=window.console&&window.console.markTimeline,B=U("error"),x=U("info"),q=function(){return ca?function(s,v){console.markTimeline(s+(v?": "+((new Date).getTime()-v)+"ms":""))}:function(){}}();COG.extend(COG,{trace:q,debug:U("debug"),info:x,warn:U("warn"),error:B,exception:function(s){if(B)for(var v in s)x("ERROR DETAIL: "+
v+": "+s[v])}})})();
COG.Loopage=function(){function U(C){return COG.extend({id:s++,frequency:0,after:0,single:false,lastTick:0,execute:function(){}},C)}function ca(C){O.push(C);B()}function B(){H&&clearTimeout(H);H=setTimeout(x,0);D=true}function x(){for(var C,G=(new Date).getTime(),V=v.length;O.length>0;){var S=O.shift();for(C=V;C--;)if(v[C].id===S){v.splice(C,1);break}D=true;V=v.length}if(D){w=q;for(C=V;C--;)w=v[C].frequency<w?v[C].frequency:w}for(C=V;C--;){S=G-v[C].lastTick;if(v[C].lastTick===0||S>=v[C].frequency){v[C].execute(G,
v[C]);v[C].lastTick=G;v[C].single&&v[C].trigger("complete")}}H=V?setTimeout(x,w):0}var q=6E4,s=0,v=[],O=[],H=0,w=q,D=true;return{join:function(C){var G=new U(C);if(G.after>0)G.lastTick=(new Date).getTime()+G.after;COG.observable(G);G.bind("complete",function(){ca(G.id)});v.unshift(G);B();return G},leave:ca}}();
(function(){function U(B,x){var q=B.obsHandlers;q[x]||(q[x]=[]);return q[x]}var ca=0;COG.observable=function(B){if(!B)return null;if(!B.obsHandlers)B.obsHandlers={};if(!(B.bind||B.trigger||B.unbind)){B.bind=function(x,q){var s="callback"+ca++;U(B,x).unshift({fn:q,id:s});return s};B.trigger=function(x){var q=U(B,x),s={cancel:false,tickCount:(new Date).getTime()},v;if(!q)return null;v=Array.prototype.slice.call(arguments,1);v.unshift(s);for(var O=q.length;O--&&!s.cancel;)q[O].fn.apply(self,v);return s};
B.unbind=function(x,q){if(typeof x==="undefined")B.obsHandlers={};else for(var s=U(B,x),v=0;s&&v<s.length;v++)if(s[v].id===q){s.splice(v,1);break}return B}}return B}})();
(function(){function U(q,s){q[s]||(q[s]=function(v){return q.configure(s,v)})}function ca(q){q.gtConfId="configurable"+x++;q.gtConfig={};q.gtConfigFns=[];return q.gtConfig}var B={},x=0;COG.paramTweaker=function(q,s,v){return function(O,H){if(typeof H!=="undefined"){if(O in q)q[O]=H;v&&O in v&&v[O](O,H)}else return s&&O in s?s[O](O):q[O]}};COG.configurable=function(q,s,v,O){if(q){q.gtConfId||ca(q);var H=q.gtConfId,w=q.gtConfig,D=q.gtConfigFns;B[H]=q;D.push(v);for(v=s.length;v--;){w[s[v]]=true;O&&U(q,
s[v])}if(!q.configure)q.configure=function(C,G){if(w[C]){for(var V=D.length;V--;){var S=D[V](C,G);if(typeof S!=="undefined")return S}return B[H]}return null}}}})();
(function(){function U(q){var s=document.createElement("script"),v=false;s.src=q;s.async=true;s.onload=s.onreadystatechange=function(){if(!v&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){v=true;s.onload=s.onreadystatechange=null;s&&s.parentNode&&s.parentNode.removeChild(s)}};B||(B=document.getElementsByTagName("head")[0]);B.appendChild(s)}var ca=0,B,x=this;COG.jsonp=function(q,s,v){q+=q.indexOf("?")>=0?"&":"?";var O="json"+ ++ca;x[O]=function(H){s(H);x[O]=null;try{delete x[O]}catch(w){}};
U(q+(v?v:"callback")+"="+O);return O}})();
(function(){function U(d){if(C)return w.length;C=true;try{for(var l=0;l<w.length;)if(w[l].isComplete()){w[l].triggerComplete(false);w.splice(l,1)}else{w[l].update(d);l++}}finally{C=false}w.length===0&&D.trigger("complete");return w.length}function ca(){if(!D){D=COG.Loopage.join({execute:U,frequency:20});D.bind("complete",function(){D=null})}}var B=1.70158,x=Math.PI/2,q=Math.abs,s=Math.pow,v=Math.sin,O=Math.asin,H=Math.cos,w=[],D=null,C=false,G={linear:function(d,l,o,t){return o*d/t+l},backin:function(d,
l,o,t){return o*(d/=t)*d*((B+1)*d-B)+l},backout:function(d,l,o,t){return o*((d=d/t-1)*d*((B+1)*d+B)+1)+l},backinout:function(d,l,o,t){return(d/=t/2)<1?o/2*d*d*(((B*=1.525)+1)*d-B)+l:o/2*((d-=2)*d*(((B*=1.525)+1)*d+B)+2)+l},bouncein:function(d,l,o,t){return o-G.bounceout(t-d,0,o,t)+l},bounceout:function(d,l,o,t){return(d/=t)<1/2.75?o*7.5625*d*d+l:d<2/2.75?o*(7.5625*(d-=1.5/2.75)*d+0.75)+l:d<2.5/2.75?o*(7.5625*(d-=2.25/2.75)*d+0.9375)+l:o*(7.5625*(d-=2.625/2.75)*d+0.984375)+l},bounceinout:function(d,
l,o,t){return d<t/2?G.bouncein(d*2,0,o,t)/2+l:G.bounceout(d*2-t,0,o,t)/2+o/2+l},cubicin:function(d,l,o,t){return o*(d/=t)*d*d+l},cubicout:function(d,l,o,t){return o*((d=d/t-1)*d*d+1)+l},cubicinout:function(d,l,o,t){if((d/=t/2)<1)return o/2*d*d*d+l;return o/2*((d-=2)*d*d+2)+l},elasticin:function(d,l,o,t,L,P){if(d==0)return l;if((d/=t)==1)return l+o;P||(P=t*0.3);if(!L||L<q(o)){L=o;o=P/4}else o=P/TWO_PI*O(o/L);return-(L*s(2,10*(d-=1))*v((d*t-o)*TWO_PI/P))+l},elasticout:function(d,l,o,t,L,P){var y;if(d==
0)return l;if((d/=t)==1)return l+o;P||(P=t*0.3);if(!L||L<q(o)){L=o;y=P/4}else y=P/TWO_PI*O(o/L);return L*s(2,-10*d)*v((d*t-y)*TWO_PI/P)+o+l},elasticinout:function(d,l,o,t,L,P){var y;if(d==0)return l;if((d/=t/2)==2)return l+o;P||(P=t*0.3*1.5);if(!L||L<q(o)){L=o;y=P/4}else y=P/TWO_PI*O(o/L);if(d<1)return-0.5*L*s(2,10*(d-=1))*v((d*t-y)*TWO_PI/P)+l;return L*s(2,-10*(d-=1))*v((d*t-y)*TWO_PI/P)*0.5+o+l},quadin:function(d,l,o,t){return o*(d/=t)*d+l},quadout:function(d,l,o,t){return-o*(d/=t)*(d-2)+l},quadinout:function(d,
l,o,t){if((d/=t/2)<1)return o/2*d*d+l;return-o/2*(--d*(d-2)-1)+l},sinein:function(d,l,o,t){return-o*H(d/t*x)+o+l},sineout:function(d,l,o,t){return o*v(d/t*x)+l},sineinout:function(d,l,o,t){return-o/2*(H(Math.PI*d/t)-1)+l}},V=COG.Tween=function(d){d=COG.extend({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:S("sine.out"),complete:null},d);var l=(new Date).getTime(),o=[],t=false,L=0,P=0,y={isComplete:function(){return t},triggerComplete:function(W){d.complete&&d.complete(W)},
update:function(W){try{var T=d.tweenFn(W-l,L,P,d.duration);if(d.target)d.target[d.property]=T;for(var da=o.length;da--;)o[da](T,void 0);if(t=l+d.duration<=W){if(d.target)d.target[d.property]=d.tweenFn(d.duration,L,P,d.duration);for(var ea=o.length;ea--;)o[ea](T,true)}}catch(E){COG.exception(E)}},requestUpdates:function(W){o.push(W)}};L=d.target&&d.property&&d.target[d.property]?d.target[d.property]:d.startValue;if(typeof d.endValue!=="undefined")P=d.endValue-L;if(P==0)t=true;ca();return y};COG.tweenValue=
function(d,l,o,t,L){d=new V({startValue:d,endValue:l,tweenFn:o,complete:t,duration:L});w.push(d);return d};COG.tween=function(d,l,o,t,L,P){d=new V({target:d,property:l,endValue:o,tweenFn:t,duration:P,complete:L});w.push(d);return d};COG.endTweens=function(d){if(!C){C=true;try{for(var l=0;l<w.length;)if(!d||d(w[l])){w[l].triggerComplete(true);w.splice(l,1)}else l++}finally{C=false}}};COG.getTweens=function(){return[].concat(w)};var S=COG.easing=function(d){return G[d.replace(/[\-\_\s\.]/g,"").toLowerCase()]};
COG.registerEasingType=function(d,l){G[d.replace(/[\-\_\s\.]/g,"").toLowerCase()]=l}})();
INTERACT=function(){function U(H){return function(w,D,C){(C?C:H?document.body:document).addEventListener(w,D,false)}}function ca(H){return function(w,D,C){(C?C:H?document.body:document).removeEventListener(w,D,false)}}function B(H,w,D){(D?D:document).attachEvent("on"+H,w)}function x(H,w,D){(D?D:document).detachEvent("on"+H,w)}function q(H,w){v.push(COG.extend({handler:null,checks:{},type:H},w))}function s(H,w){return{x:H.x-(w?w.x:0),y:H.y-(w?w.y:0)}}var v=[],O=function(H,w,D){function C(l,o,t,L){G.trigger("pan",
L.x,L.y)}D=COG.extend({binder:null,unbinder:null,observable:null},D);for(var G=D.observable,V=[],S={bind:function(){return G.bind.apply(null,arguments)},pannable:function(l){COG.extend({inertia:true},l);G.bind("pointerMove",C);return S},unbind:function(){G.unbind();for(var l=0;l<V.length;l++)V[l].unbind();return S}},d=0;d<w.length;d++)V.push(w[d](H,G,D));return S};q("pointer",{handler:function(H,w,D){function C(E){var Y=E.target?E.target:E.srcElement;if(t||Y&&Y===H)if(L=E.button===0){da=E.pageX?E.pageX:
E.screenX;ea=E.pageY?E.pageY:E.screenY;P={x:da?da:0,y:ea?ea:0};E=H;var ja=Y=0;if(E.offsetParent){do{Y+=E.offsetLeft;ja+=E.offsetTop;E=E.offsetParent}while(E)}y={x:Y,y:ja};w.trigger("pointerDown",P,s(P,y))}}function G(E){var Y=E.target?E.target:E.srcElement;W=E.pageX?E.pageX:E.screenX;T=E.pageY?E.pageY:E.screenY;if(L&&(t||Y&&Y===H))d("pointerMove")}function V(E){var Y=E.target?E.target:E.srcElement;if(L&&E.button===0){L=false;if(t||Y&&Y===H)d("pointerUp")}}function S(E){var Y=E.target?E.target:E.srcElement;
if(t||Y&&Y===H){Y=E.detail?E.axis===2?-E.detail*l:0:E.wheelDeltaY;if(Y!==0){var ja={x:W?W:0,y:T?T:0};w.trigger("zoom",ja,s(ja,y),Y/o);if(E.preventDefault){E.preventDefault();E.stopPropagation()}else E.cancelBubble&&E.cancelBubble()}}}function d(E){var Y={x:W?W:0,y:T?T:0};w.trigger(E,Y,s(Y,y),{x:da-W?da-W:0,y:ea-T?ea-T:0});da=W;ea=T}var l=120,o=l*8,t=false,L=false,P,y,W,T,da,ea;D.binder("mousedown",C,false);D.binder("mousemove",G,false);D.binder("mouseup",V,false);D.binder("mousewheel",S,window);D.binder("DOMMouseScroll",
S,window);return{unbind:function(){D.unbinder("mousedown",C,false);D.unbinder("mousemove",G,false);D.unbinder("mouseup",V,false);D.unbinder("mousewheel",S,window);D.unbinder("DOMMouseScroll",S,window)}}},checks:{touch:false}});q("pointer",{handler:function(H,w,D){function C(y,W,T){W=W[T?T:"touches"];T=W.length;var da=0;do{y.x=W[da].pageX;y.y=W[da].pageY;da+=1;if(da>=T){y.next=null;break}y=y.next={x:0,y:0}}while(1)}function G(y){var W=y.target?y.target:y.srcElement;if(W&&W===H){C(L,y);t=l}}function V(y){var W=
y.target?y.target:y.srcElement;if(W&&W===H){y.preventDefault();C(P,y);if(t===l)t=Math.abs(L.x-P.x)>d||Math.abs(L.y-P.y)>d?o:l;t===o&&COG.info("moving")}}function S(){}var d=7;w={x:0,y:0};var l=0,o=1,t,L=COG.extend({},w),P=COG.extend({},w);D.binder("touchstart",G,false);D.binder("touchmove",V,false);D.binder("touchend",S,false);COG.info("initialized touch handler");return{unbind:function(){D.unbinder("touchstart",G,false);D.unbinder("touchmove",V,false);D.unbinder("touchend",S,false)}}},checks:{touch:true}});
return{register:q,watch:function(H,w,D){w=COG.extend({bindToBody:false,observable:null,isIE:false,types:null},w);capabilities=COG.extend({touch:"ontouchstart"in window},D);if(!w.observable){COG.info("creating observable");w.observable=COG.observable({});globalOpts=w}w.binder=w.isIE?B:U(w.bindToBody);w.unbinder=w.isIE?x:ca(w.bindToBody);D=w.types;for(var C=capabilities,G=[],V=v.length;V--;){var S=v[V],d=!D||D.indexOf(S.type)>=0,l=true;for(var o in S.checks){var t=S.checks[o];COG.info("checking "+o+
" capability. require: "+t+", capability = "+C[o]);l=l&&t===C[o]}if(d&&l)G[G.length]=S.handler}return new O(H,G,w)}}}();
T5=function(){function U(){return(new Date).getTime()}function ca(){for(;ya.length>0;){var a=ya.shift();document.location=a}ja=0}function B(a){for(var k=true,e=Qa.length;e--;)k=k&&a!=Qa[e];return k}function x(a,k){var e=[];for(var g in k)g&&e.push(g+"="+escape(k[g]));return"tile5://"+a+"/"+(e.length>0?"?"+e.join("&"):"")}function q(a,k){B(a)&&COG.info("would push url: "+x(a,k))}function s(a,k){if(B(a)){ya.push(x(a,k));ja||(ja=setTimeout(ca,100))}}function v(a){return function(k,e,g){(g?g:a?document.body:
document).addEventListener(k,e,false)}}function O(a){return function(k,e,g){(g?g:a?document.body:document).removeEventListener(k,e,false)}}function H(a,k,e){(e?e:document).attachEvent("on"+a,k)}function w(a,k,e){(e?e:document).detachEvent("on"+a,k)}function D(){ea={base:{name:"Unknown",bindEvent:v(),unbindEvent:O(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:q,targetFps:null},ie:{name:"MSIE",regex:/msie/i,
bindEvent:H,unbindEvent:w,requireFastDraw:false,targetFps:25},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:s,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:s},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:s},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:v(true),unbindEvent:O(true),supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},
bridgeNotify:s},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:s}};E=[ea.froyo,ea.android,ea.ipod,ea.iphone,ea.ipad,ea.ie]}function C(){ea||D();if(!Y){COG.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var a=0;a<E.length;a++){var k=E[a];if(k.regex&&k.regex.test(navigator.userAgent)){Y=COG.extend({},ea.base,k);COG.info("PLATFORM DETECTED AS: "+Y.name);break}}if(!Y){COG.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
Y=ea.base}COG.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return Y}function G(){for(var a=0,k=arguments.length;k--;){var e=bb[arguments[k].toUpperCase()];if(e)a|=e}return a}var V=Math.abs,S=Math.min,d=Math.max,l=Math.pow,o=Math.sqrt,t=Math.sin,L=Math.asin,P=Math.cos,y=function(){function a(b,c){return e(b.x-c.x,b.y-c.y)}function k(b,c){if(!c)c=b.length;if(c<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var f={edges:Array(c-1),accrued:Array(c-
1),total:0},h=0;h<c-1;h++){var m=a(b[h],b[h+1]);f.edges[h]=o(m.x*m.x+m.y*m.y);f.accrued[h]=f.total+f.edges[h];f.total+=f.edges[h]}return f}function e(b,c){return{x:b?b:0,y:c?c:0}}function g(b,c){return e(b.x>c.x?b.x:c.x,b.y>c.y?b.y:c.y)}return{VECTOR_SIMPLIFICATION:3,SIMPLIFICATION_MIN_VECTORS:25,add:function(){for(var b=0,c=0,f=arguments.length;f--;){b+=arguments[f].x;c+=arguments[f].y}return e(b,c)},absSize:function(b){return g(V(b.x),V(b.y))},copy:function(b){return b?e(b.x,b.y):null},diff:a,distance:function(b,
c){return k(b,c).total},edges:k,equals:function(b,c){return b.x===c.x&&b.y===c.y},extendBy:function(b,c,f){var h=P(c)*f;c=t(c)*f;return e(b.x-h,b.y-c)},floor:function(b){for(var c=Array(b.length),f=b.length;f--;)c[f]=e(~~b[f].x,~~b[f].y);return c},getRect:function(b){for(var c,f,h,m,j=b.length;j--;){var i=b[j];c=typeof c==="undefined"||i.x<c?i.x:c;f=typeof f==="undefined"||i.y<f?i.y:f;h=typeof h==="undefined"||i.x>h?i.x:h;m=typeof m==="undefined"||i.y>m?i.y:m}return T.init(c,f,h,m)},init:e,invert:function(b){return e(-b.x,
-b.y)},min:function(b,c){return e(b.x<c.x?b.x:c.x,b.y<c.y?b.y:c.y)},max:g,offset:function(b,c,f){return e(b.x+c,b.y+(f?f:c))},simplify:function(b,c){if(!b)return null;c=c?c:y.VECTOR_SIMPLIFICATION;for(var f=[],h=null,m=b.length;m--;){var j=b[m];if(include=!h||m===0||V(j.x-h.x)+V(j.y-h.y)>c){f.unshift(j);h=j}}return f},theta:function(b,c,f){f=L((b.y-c.y)/f);return b.x>c.x?f:Math.PI-f}}}(),W=function(){return{dotProduct:function(a,k){return a.x*k.x+a.y*k.y}}}(),T=function(){function a(e){return k(e.x1,
e.y1,e.x2,e.y2)}function k(e,g,b,c){e=e?e:0;g=g?g:0;b=typeof b!=="undefined"?b:e;c=typeof c!=="undefined "?c:c;return{x1:e,y1:g,x2:b,y2:c,width:b-e,height:c-g}}return{center:function(e){return y.init(e.x1+e.width/2,e.y1+e.height/2)},copy:a,diagonalSize:function(e){return o(e.width*e.width+e.height*e.height)},fromCenter:function(e,g,b,c){b=~~(b/2);c=~~(c/2);return k(e-b,g-c,e+b,g+c)},init:k,intersect:function(e,g){var b=d(e.x1,g.x1),c=d(e.y1,g.y1),f=S(e.x2,g.x2),h=S(e.y2,g.y2);b=k(b,c,f,h);return b.width>
0&&b.height>0?b:null},union:function(e,g){if(e.width===0||e.height===0)return a(g);else if(g.width===0||g.height===0)return a(e);else{var b=S(e.x1,g.x1),c=S(e.y1,g.y1),f=d(e.x2,g.x2),h=d(e.y2,g.y2);b=k(b,c,f,h);return b.width>0&&b.height>0?b:null}}}}(),da=function(){return{getAspectRatio:function(a){return a.height!==0?a.width/a.height:1},getCenter:function(a){return y.init(a.width/2,a.height/2)},getSize:function(a){return o(l(a.width,2)+l(a.height,2))},init:function(a,k){a=a?a:0;return{width:a,height:k?
k:a}}}}(),ea=null,E=[],Y=null,ja=0,ya=[],Qa=["view.wake","tile.loaded"],ua=function(){function a(){if(!I){var u=C().maxImageLoads;I=COG.Loopage.join({execute:function(M,A){if(!u||i.length<u){var F=j.shift();if(F){i[i.length]=F;F.image.onload=e;F.image.src=F.url;F.requested=T5.ticks()}else A.trigger("complete")}},frequency:10});I.bind("complete",function(){I=null})}}function k(){Q=true;try{var u=p.length/2>>0;if(u>0){p.sort(function(A,F){return A.created-F.created});for(var M=u;M--;)delete c[p[M].url];
p.splice(0,u)}}finally{Q=false}J.trigger("cacheCleared")}function e(){var u=h[this.id],M;if(u&&u.image.complete&&u.image.width>0){u.loaded=true;u.hitCount=1;for(M=i.length;M--;)if(i[M].image.src==this.src){i.splice(M,1);break}if(u.background||u.postProcess||u.drawBackground||u.customDraw)if(u.image){globalImageData=u;M=b(u.realSize?u.realSize.width:u.image.width,u.realSize?u.realSize.height:u.image.height);var A=M.getContext("2d"),F=u.offset?u.offset:T5.XY.init();u.background&&A.drawImage(u.background,
0,0);u.drawBackground&&u.drawBackground(A);u.customDraw?u.customDraw(A,u):A.drawImage(u.image,F.x,F.y);u.postProcess&&u.postProcess(A,u);u.image=M}for(M=u.callbacks.length;M--;)u.callbacks[M]&&u.callbacks[M](this,false);u.callbacks=[];p[p.length]={url:this.src,created:u.requested};delete h[this.id];a()}}function g(u,M,A){var F=c[u];if(F){F.hitCount++;F.image.complete&&F.image.width>0&&M?M(F.image,true):F.callbacks.push(M)}else{F=COG.extend({url:u,image:new Image,loaded:false,created:T5.ticks(),requested:null,
hitCount:0,callbacks:[M]},A);F.image.id="resourceLoaderImage"+m++;c[u]=F;h[F.image.id]=F;j[j.length]=F;a()}return F}function b(u,M){var A=document.createElement("canvas");A.width=u?u:0;A.height=M?M:0;if(typeof FlashCanvas!=="undefined"){A.id="tmpCanvas"+f++;A.style.cssText="position: absolute; top: -"+(M-1)+"px; left: -"+(u-1)+"px;";document.body.appendChild(A);FlashCanvas.initElement(A)}typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(A);return A}var c={},f=0,h={},m=0,j=[],
i=[],p=[],z=0,I=null,Q=false,J={avgImageSize:25,loadTimeout:10,cancelLoad:function(){i=[]},get:function(u,M,A){var F=null,N=null;Q||(F=c[u]);if((N=F?F.image:null)&&(N.getContext||N.complete&&N.width>0))return N;else M&&g(u,M,A);return null},load:g,newCanvas:b,reset:function(){c={}},stats:function(){return{imageLoadingCount:i.length,queuedImageCount:j.length,imageCacheFullness:z}}};COG.observable(J);COG.Loopage.join({execute:function(u){for(var M=false,A=0,F=C();A<i.length;)if(u-i[A].requested>J.loadTimeout*
1E3){i.splice(A,1);M=true}else A++;M&&a();if(F&&F.imageCacheMaxSize){z=p.length*J.avgImageSize/F.imageCacheMaxSize;z>=1&&k()}},frequency:2E4});return J}(),za=function(){var a={};return{init:function(k,e){var g=a[k];if(!g)throw Error("Unable to locate requested generator: "+k);return new g(e)},register:function(k,e){a[k]=e},Template:function(){}}}(),qa=function(){function a(f,h){b[f]=e(h);return f}function k(f){for(var h in f)a(h,f[h])}function e(f){function h(p){var z=f[p];typeof z!=="undefined"&&
j.push(function(I){I[p]=z})}function m(){j=[];for(var p in f)h(p)}f=COG.extend({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},f);var j=[],i={applyToContext:function(p){for(var z=j.length;z--;)j[z](p)},update:function(p,z){f[p]=z;m()}};m();return i}var g={},b={},c={apply:function(f,h){var m=b[h]?b[h]:b.basic,j;if(f&&f.canvas){j=g[f.canvas.id];g[f.canvas.id]=h}m.applyToContext(f);
return j},define:a,defineMany:k,get:function(f){return b[f]},init:e,load:function(f){COG.jsonp(f,function(h){k(h)})}};k({basic:{lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"},waypoints:{lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"}});return c}(),bb={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,ZOOM:16,FREEZE:128},ra=function(a){a=COG.extend({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:G("ACTIVE","ANIMATING","PAN","ZOOM"),style:null,minXY:null,maxXY:null},a);var k=null,
e=false,g=false,b=a.supportFastDraw,c=a.id,f=G("ACTIVE"),h=a.validStates,m=0,j=0,i=COG.extend({addToView:function(p){p.setLayer(c,i)},shouldDraw:function(p,z,I){return(g||I||m!==z.x1||j!==z.y1)&&(p&h)!==0&&(e?b:true)},clip:null,cycle:function(){},draw:function(){},remove:function(){i.trigger("remove",i)},changed:function(p){g=true;i.trigger("changed",i);k&&k.trigger("invalidate",p)},getId:function(){return c},setId:function(p){c=p},getParent:function(){return k},setParent:function(p){e=(k=p)?k.fastDraw&&
displayState!==f:false;i.trigger("parentChange",k)}},a);COG.observable(i);i.bind("drawComplete",function(p,z){g=false;m=z.x1;j=z.y1});i.bind("resync",function(p,z){if(z.syncXY){i.minXY&&z.syncXY(i.minXY);i.maxXY&&z.syncXY(i.maxXY)}});return i},Ra=function(a){function k(m,j,i,p){g=m;b=j;c=i;f=p}a=COG.extend({xy:y.init(),offset:true,tweenIn:null,animationSpeed:null,isNew:true},a);var e=false,g=0,b=0,c=0,f=0,h=COG.extend(a,{isAnimating:function(){return e},draw:function(m,j,i,p,z){if(h.isNew&&a.tweenIn){var I=
h.xy.y;h.xy.y=j.y1-20;e=true;COG.tween(h.xy,"y",I,a.tweenIn,function(){h.xy.y=I>>0;e=false},a.animationSpeed?a.animationSpeed:250+Math.random()*500)}h.drawMarker(m,j,h.xy.x,h.xy.y,i,p,z);h.isNew=false},drawMarker:function(m,j,i,p){m.beginPath();m.arc(i,p,4,0,Math.PI*2,false);m.fill();k(i-4,p-4,8,8)},hitTest:function(m,j){return m>=g&&m<=g+c&&j>=b&&j<=b+f},updateBounds:k});COG.observable(h);return h},Sa=function(a){function k(){b.changed();b.trigger("markerUpdate",g)}function e(){var c=b.getParent();
if(c&&c.syncXY)for(var f=g.length;f--;)c.syncXY([g[f].xy])}a=COG.extend({zindex:100,style:"basic"},a);var g=[],b=COG.extend(new ra(a),{draw:function(c,f,h,m){for(var j=g.length;j--;)g[j].draw(c,f,h,b,m)},add:function(c){if(c&&typeof c.length!=="undefined")for(var f=c.length;f--;){if(c[f])g[g.length]=c[f]}else if(c)g[g.length]=c;k()},clear:function(c){if(c)for(var f=0;f<g.length;f++)c(g[f])&&g.splice(f,1);else g=[];k()},each:function(c){if(c)for(var f=g.length;f--;)c(g[f])},find:function(c){for(var f=
[],h=g.length;h--;)if(!c||c(g[h]))f[f.length]=g[h];return f}});b.bind("tap",function(c,f,h){for(var m=[],j=h.x,i=h.y,p=g.length;p--;)if(g[p].hitTest(j,i))m[m.length]=g[p];if(m.length>0)c.cancel=b.trigger("markerTap",f,h,m).cancel});b.bind("parentChange",e);b.bind("resync",e);b.bind("changed",e);return b},Ta=function(a){function k(h,m,j){h.fillStyle="#FFFFFF";h.strokeStyle="#222222";h.beginPath();h.arc(j.x,j.y,4,0,Math.PI*2,false);h.stroke();h.fill()}a=COG.extend({path:[],id:COG.objId("pathAni"),easing:COG.easing("sine.inout"),
validStates:G("ACTIVE","PAN","ZOOM"),drawIndicator:null,duration:2E3},a);var e=y.edges(a.path),g,b=null,c=0;COG.tweenValue(0,e.total,a.easing,function(){f.remove()},a.duration).requestUpdates(function(h,m){c=h;m&&f.remove()});var f=COG.extend(new ra(a),{cycle:function(){for(var h=0;h<e.accrued.length&&e.accrued[h]<c;)h++;b=null;if(h<a.path.length-1){var m=c-(h>0?e.accrued[h-1]:0),j=a.path[h];g=y.theta(j,a.path[h+1],e.edges[h]);b=y.extendBy(j,g,m)}return b},draw:function(h,m){if(b)(a.drawIndicator?
a.drawIndicator:k)(h,m,y.init(b.x,b.y),g)}});return f},Ua=function(a){a=COG.extend({style:null,properties:{}},a);return COG.extend(a,{rect:null,draw:function(){},resync:function(){}})},cb=function(){return{tileSize:256,init:function(a,k,e,g,b){return COG.extend({x:a,y:k,width:e,height:g},b)}}}(),Aa={ex:COG.extend,ticks:U,getConfig:C,userMessage:function(a,k,e){Aa.trigger("userMessage",a,k,e)},XY:y,XYRect:T,Dimensions:da,Vector:W,D:da,Images:ua,Generator:za,tween:COG.tween,tweenValue:COG.tweenValue,
easing:COG.easing,Tween:COG.Tween,Style:qa,viewState:G,View:function(a){function k(n,r,K,R){ka=va;J();if(R&&a.inertia)m(ga+r,ha+K,a.panAnimationEasing,a.panAnimationDuration);else R||m(ga+r,ha+K)}function e(){ka=Ba;la=false;J()}function g(n,r,K){wa||(wa=[].concat(K));n=Va(wa);Wa(n);r=Xa(n);var R=Va(K);K=Wa(R);R=Xa(R);f(K);aa=n&&r!==0?R/r:1;c()}function b(n,r,K,R){$.zoom(da.getCenter(ia),R)}function c(n){z();var r=y.init(Ca-(sa.width/(aa*2)>>0),Da-(sa.height/(aa*2)>>0)),K=Math.log(aa)/Math.LN2>>0;
if(aa!==1)ka=Ea;COG.info("scale factor = "+aa+", exp = "+K);if(K!==0){aa=Math.pow(2,K);if(!$.trigger("scale",aa,r).cancel){COG.info("ok to scale");for(n=A.length;n--;)A[n].trigger("scale",aa,r);aa=1;wa=null;ka=Ba;n=true}}J(n)}function f(n){Fa=y.init(ga,ha);Ga=y.offset(n,ga,ha)}function h(){clearTimeout(Ya);Ya=setTimeout(j,50)}function m(n,r,K,R,X){function ba(){fa+=1;if(fa>=2){e(0,0);X&&X()}}var fa=0,ma=oa?y.offset(oa,-Ha,-Ia):null,na=pa?y.offset(pa,-Ha,-Ia):null;if(ma){n=n<ma.x?ma.x:n;r=r<ma.y?ma.y:
r}if(na){n=n>na.x?na.x:n;r=r>na.y?na.y:r}if(K){if(!la){n=COG.tweenValue(ga,n,K,ba,R);r=COG.tweenValue(ha,r,K,ba,R);n.cancelOnInteract=true;n.requestUpdates(function(Ja){ga=Ja>>0;la=true;J()});r.cancelOnInteract=true;r.requestUpdates(function(Ja){ha=Ja>>0;la=true;J()})}}else{ga=n>>0;ha=r>>0}}function j(){var n;if(N){Ka&&Ka.unbind();if(a.autoSize&&N.parentNode){n=N.parentNode.getBoundingClientRect();if(n.height!==0&&n.width!==0){N.height=n.height;N.width=n.width}}try{if(!N.id)N.id=a.id+"_canvas";Z=
N.getContext("2d")}catch(r){COG.exception(r);throw Error("Could not initialise canvas on specified view element");}if(ia.height!==N.height||ia.width!==N.width){ia=da.init(N.width,N.height);Ha=ia.width/2>>0;Ia=ia.height/2>>0;$.trigger("resize",N.width,N.height);for(n=F;n--;)A[n].trigger("resize",N.width,N.height)}if(a.interactive)Ka=INTERACT.watch(N,{observable:$}).pannable();for(n=F;n--;)A[n].trigger("contextChanged",Z);J()}}function i(n,r){r.setId(n);r.added=U();r.bind("remove",function(){$.removeLayer(n)});
r.trigger("contextChanged",Z);r.setParent($);A.push(r);A.sort(function(K,R){var X=R.zindex-K.zindex;if(X===0)X=R.added-K.added;return X});F=A.length;return r}function p(){M("idle",$);La=true;ta=0}function z(n){var r=1/aa;Ca=Ga.x+(ga-Fa.x);Da=Ga.y+(ha-Fa.y);if(n)return T.fromCenter(Ca>>0,Da>>0,n.width*r>>0,n.height*r>>0)}function I(n,r,K,R){var X=T.copy(r),ba,fa=0;K&&Z.clearRect(0,0,N.width,N.height);Z.save();try{Z.globalCompositeOperation="source-over";if(aa!==1){X=z(X);Z.scale(aa,aa)}Z.translate(-X.x1,
-X.y1);pa=oa=null;Z.beginPath();Ma=false;for(fa=F;fa--;)if(A[fa].clip){A[fa].clip(Z,X,n,$,K,R);Ma=true}Z.closePath();Ma&&Z.clip();for(fa=F;fa--;){ba=A[fa];var ma=ba.style,na=ma?qa.apply(Z,ma):null;if(ba.minXY)oa=oa?y.min(oa,ba.minXY):y.copy(ba.minXY);if(ba.maxXY)pa=pa?y.max(pa,ba.maxXY):y.copy(ba.maxXY);ba.draw(Z,X,n,$,K,R);na&&qa.apply(Z,na)}}finally{Z.restore()}if(db){Z.globalCompositeOperation="source-over";Z.strokeStyle="#f00";Z.beginPath();Z.moveTo(N.width/2,0);Z.lineTo(N.width/2,N.height);Z.moveTo(0,
N.height/2);Z.lineTo(N.width,N.height/2);Z.stroke()}M("drawComplete",r,R);COG.trace("draw complete",R)}function Q(n,r){var K=false,R=Na?Na:la?va:ka,X=!la&&(R===Ea||R===va),ba=Oa||R===va||R===Ea||COG.getTweens().length>0;sa=u();if(X){COG.endTweens(function(fa){return fa.cancelOnInteract});La=false;if(ta!==0){clearTimeout(ta);ta=0}}for(X=F;X--;){if(A[X].animated)ka|=Za;A[X].cycle(n,sa,ka,ba);K=A[X].shouldDraw(ka,sa,ba)||K}ba=ba||(ka&Za)!==0;if(K=K||ba||aa!==1&&aa!==$a){I(R,sa,ba,n);$a=aa;Oa=false}if(!K&&
Pa===0&&!eb){if(!La&&ta===0)ta=setTimeout(p,500);r.trigger("complete")}Pa=0;COG.trace("Completed draw cycle",n)}function J(n){Oa=n?true:false;Pa+=1;if(!xa){xa=COG.Loopage.join({execute:Q,frequency:fb});xa.bind("complete",function(){xa=null})}}function u(){return T.init(ga,ha,ga+ia.width,ha+ia.height)}function M(){for(var n=$.trigger.apply(null,arguments).cancel,r=A.length;r--;)n=A[r].trigger.apply(null,arguments).cancel||n;return!n}a=COG.extend({id:COG.objId("view"),container:"",fastDraw:false,inertia:true,
pannable:true,scalable:true,interactive:true,panAnimationEasing:COG.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:true,tapExtent:10,mask:true,guides:false,fps:25},a);var A=[],F=0,N=document.getElementById(a.container),Z=null,ga=0,ha=0,Ma=false,sa=null,xa=null,db=a.guides,ab=1,ia=da.init(),Pa=0,Ha=0,Ia=0,Fa=null,Ga=null,La=false,la=false,ta=0,oa=null,pa=null,gb=0,Na=null,Oa=false,Ya=0,wa=null,aa=1,$a=0,Ka=null,eb=typeof FlashCanvas!=="undefined",
fb=~~(1E3/a.fps),Ca,Da,Ba=G("ACTIVE"),va=G("PAN"),Ea=G("ZOOM"),Za=G("ANIMATING"),ka=Ba,Va=y.getRect,Xa=T.diagonalSize,Wa=T.center,$={id:a.id,deviceScaling:ab,fastDraw:a.fastDraw||C().requireFastDraw,getDimensions:function(){return ia},getLayer:function(n){for(var r=0;r<F;r++)if(A[r].getId()==n)return A[r];return null},setLayer:function(n,r){for(var K=0;K<F;K++)if(A[K].getId()===n){A.splice(K,1);break}r&&i(n,r);J();return r},eachLayer:function(n){for(var r=F;r--;)n(A[r])},invalidate:J,resize:function(n,
r){if(N){a.autoSize=false;N.width=n;N.height=r;j();$.trigger("resize",N.width,N.height)}},scale:function(n,r,K,R){function X(){aa=Math.pow(2,Math.round(Math.log(aa)/Math.LN2));R&&R();c(true)}var ba=aa;r||(r=da.getCenter(ia));f(r);if(K)COG.tweenValue(0,n-ba,K,X,1E3).requestUpdates(function(fa){aa=ba+fa;c()});else{aa=n;X()}return $},triggerAll:M,removeLayer:function(n){a:{for(var r=F;r--;)if(A[r].getId()==n){n=r;break a}n=-1}if(n>=0&&n<F){$.trigger("layerRemoved",A[n]);A.splice(n,1);J()}F=A.length},
stateOverride:function(n){Na=n},getOffset:function(){return y.init(ga,ha)},getViewRect:u,updateOffset:m,pan:function(n,r,K,R,X){m(ga+n,ha+r,K,R,X)},zoom:function(n,r){f(n);la=false;aa=Math.max(aa+Math.pow(2,r)-1,0.25);COG.info("zooming, scale change = "+r+", targetXY = ",n);c()}};ab=C().getScaling();$.markers=i("markers",new Sa);COG.observable($);$.bind("invalidate",function(n,r){J(r)});if(a.pannable){$.bind("pan",k);$.bind("panEnd",e);$.bind("inertiaCancel",function(){la=false;J()})}if(a.scalable){$.bind("pinchZoom",
g);$.bind("zoom",b)}$.bind("tap",function(n,r,K){for(var R=y.offset(K,ga,ha),X=A.length;X--;)n.cancel=n.cancel||A[X].trigger("tap",r,K,R).cancel});$.bind("resync",function(){pa=oa=null});COG.configurable($,["inertia","container","rotation","tapExtent","scalable","pannable"],COG.paramTweaker(a,null,{container:function(n,r){N=document.getElementById(r);j()},rotation:function(n,r){gb=r}}),true);j();a.autoSize&&window.addEventListener("resize",h,false);return $},ViewLayer:ra,ImageLayer:function(a,k){function e(j,
i,p){for(i=c.length;i--;){var z=c[i],I=z.x,Q=z.y,J=T.init(z.x,z.y,z.x+z.width,z.y+z.height);if(p&&T.intersect(j,J)){J=ua.get(z.url,function(){m.changed()},h);p(J,I,Q,z.width,z.height)}}}function g(j){b&&b.run(j,function(i){c=[].concat(i);m.changed()})}k=COG.extend({imageLoadArgs:{}},k);var b=a?za.init(a,k):null,c=[],f=T.init(),h=k.imageLoadArgs,m=COG.extend(new ra(k),{changeGenerator:function(j,i){b=za.init(j,COG.extend({},k,i));b.bindToView(m.getParent());c=null;g(f)},clip:function(j,i,p){e(i,p,
function(z,I,Q,J,u){z&&j.rect(I,Q,J,u)})},cycle:function(j,i){g(i)},draw:function(j,i,p){e(i,p,function(z,I,Q,J,u){m.drawImage(j,z,I,Q,J,u,i,p)});f=T.copy(i)},drawImage:function(j,i,p,z){i&&j.drawImage(i,p,z,i.width,i.height)}});m.bind("idle",function(){g(f)});m.bind("parentChange",function(j,i){b&&b.bindToView(i)});m.bind("tap",function(j,i,p,z){j=[];var I=z.x,Q=z.y,J,u;if(c)for(var M=c.length;M--;){J=c[M];if(u=I>=J.x&&I<=J.x+J.width&&Q>=J.y&&Q<=J.y+J.height)j[j.length]=J}j.length>0&&m.trigger("tapImage",
j,i,p,z)});return m},Marker:Ra,ImageMarker:function(a){a=COG.extend({image:null,imageUrl:null,animatingImage:null,animatingImageUrl:null,imageAnchor:null,rotation:0,scale:1,opacity:1},a);var k=a.imageAnchor?T5.XY.invert(a.imageAnchor):null,e=COG.extend(new Ra(a),{drawMarker:function(g,b,c,f){if((b=e.isAnimating()&&e.animatingImage?e.animatingImage:e.image)&&b.width>0){k||(k=y.init(-b.width>>1,-b.height>>1));var h=e.scale,m=c+~~(k.x*h),j=f+~~(k.y*h),i=~~(b.width*h),p=~~(b.height*h);e.updateBounds(m,
j,i,i);if(e.rotation||e.opacity!==1){g.save();try{g.globalAlpha=e.opacity;g.translate(c,f);g.rotate(e.rotation);g.drawImage(b,k.x*h,k.y*h,i,p)}finally{g.restore()}}else g.drawImage(b,m,j,i,p)}}});if(!e.image)e.image=ua.get(a.imageUrl,function(g){e.image=g});if(!e.animatingImage)e.animatingImage=ua.get(a.animatingImageUrl,function(g){e.animatingImage=g});return e},MarkerLayer:Sa,PathLayer:function(a){a=COG.extend({style:"waypoints",pixelGeneralization:8,zindex:50},a);var k=false,e=[],g=null,b=[],c=
null,f=0,h=[],m=COG.extend(new ra(a),{getAnimation:function(j,i,p,z){var I="pathAnimation"+f++;h.push(I);return new Ta({id:I,path:e,zindex:a.zindex+1,easing:j?j:COG.easing("sine.inout"),duration:i?i:5E3,drawIndicator:p,autoCenter:z?z:false})},cycle:function(j,i,p,z){return z},draw:function(j){var i,p=e.length;j.save();try{qa.apply(j,a.style);if(p>0){j.beginPath();j.moveTo(e[p-1].x,e[p-1].y);for(i=p;i--;)j.lineTo(e[i].x,e[i].y);j.stroke();if(g){j.fillStyle=a.waypointFillStyle;for(i=g.length;i--;){j.beginPath();
j.arc(g[i].x,g[i].y,2,0,Math.PI*2,false);j.stroke();j.fill()}}}}finally{j.restore()}k=false},updateCoordinates:function(j,i){b=j;c=i;var p=m.getParent();if(p&&p.syncXY){p.syncXY(b);c&&p.syncXY(c);m.trigger("tidy")}}});m.bind("tidy",function(){e=y.simplify(b,a.pixelGeneralization);g=y.simplify(c,a.pixelGeneralization);k=true;m.changed()});return m},AnimatedPathLayer:Ta,Shape:Ua,Arc:function(a,k){k=COG.extend({size:4},k);var e=y.init(),g=COG.extend(k,{draw:function(b){b.beginPath();b.arc(e.x,e.y,g.size,
0,Math.PI*2,false);b.fill();b.stroke()},resync:function(b){b.syncXY([a]);e=y.floor([a])[0]}});COG.info("created arc = ",a);return g},Poly:function(a,k){k=COG.extend({fill:false,simplify:false},k);var e=false,g=k.fill,b=k.simplify,c=G("ZOOM"),f=[],h=COG.extend(new Ua(k),{draw:function(m,j,i,p,z,I){if(e){j=true;i=(I&c)!==0;m.beginPath();for(I=f.length;I--;){i=f[I].x;p=f[I].y;if(j){m.moveTo(i,p);j=false}else m.lineTo(i,p);i=true}if(i){g&&m.fill();m.stroke()}}},resync:function(m){h.xy=m.syncXY(a);f=y.floor(b?
y.simplify(a):a)}});e=a&&a.length>=2;return h},ShapeLayer:function(a){function k(c){for(var f=g.length;f--;)g[f].resync(c);g.sort(function(h,m){var j=m.xy.y-h.xy.y;if(j===0)j=m.xy.x-h.xy.y;return j});b.changed()}function e(c,f){f.syncXY&&k(f)}a=COG.extend({zindex:80},a);var g=[],b=COG.extend(new ra(a),{add:function(c){g[g.length]=c},each:function(c){for(var f=g.length;f--;)c(g[f])},draw:function(c,f,h){var m=f.x1,j=f.y1,i=f.width;f=f.height;for(var p=g.length;p--;){var z=g[p].style;z=z?qa.apply(c,
z):null;g[p].draw(c,m,j,i,f,h);z&&qa.apply(c,z)}}});b.bind("parentChange",e);b.bind("resync",e);return b},Tiling:cb,TileGenerator:function(a){function k(Q,J,u,M){function A(){if(I.initTileCreator){h=true;I.initTileCreator(Q,J,u,M)}}I.prepTileCreator?I.prepTileCreator(Q,J,u,A):A()}function e(Q,J){for(var u=~~((Q.x1-c.x)/m),M=~~((Q.y1-c.y)/j),A=[],F=-f;F<p;F++)for(var N=-f;N<z;N++){var Z=i(u+F,M+N);if(Z)A[A.length]=Z}J&&J(A);b=T.copy(Q)}a=COG.extend({tileWidth:256,tileHeight:256,relative:false,padding:2},
a);var g=null,b=null,c=y.init(),f=a.padding,h=false,m=a.tileWidth,j=a.tileHeight,i=null,p=0,z=0,I={bindToView:function(Q){COG.info("initializing generator");g=Q;I.trigger("bindView",Q)},getTileCreatorArgs:null,initTileCreator:null,prepTileCreator:null,requireRefresh:function(){return false},reset:function(){i=null;h=false;b=null},run:function(Q,J){if(!b||Math.abs(Q.x1-b.x1)>m||Math.abs(Q.y1-b.y1)>j){if(!i&&!h||I.requireRefresh()){c=a.relative?y.init(Q.x1,Q.y1):y.init();p=Math.ceil(Q.width/m)+f;z=
Math.ceil(Q.height/j)+f;k(m,j,I.getTileCreatorArgs?I.getTileCreatorArgs(g):{},function(u){i=u;h=false;e(Q,J)})}i&&e(Q,J)}}};COG.observable(I);I.bind("update",function(){COG.info("captured generator update");b=null});return I}};COG.observable(Aa);return Aa}();
