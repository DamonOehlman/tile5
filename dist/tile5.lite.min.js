COG=typeof COG!=="undefined"?COG:{};COG.extend=function(){for(var G=arguments[0]||{},T,C=1,v=arguments.length;C<v;C++)if((T=arguments[C])!==null)for(var e in T){var f=T[e];if(G!==f)if(f!==undefined)G[e]=f}return G};
(function(){var G=Object.prototype.hasOwnProperty,T=0,C={};C.toID=function(v){return v.replace(/\s/g,"-")};C.objId=function(v){return(v?v:"obj")+T++};C.isFunction=function(v){return toString.call(v)==="[object Function]"};C.isArray=function(v){return toString.call(v)==="[object Array]"};C.isPlainObject=function(v){if(!v||toString.call(v)!=="[object Object]"||v.nodeType||v.setInterval)return false;if(v.constructor&&!G.call(v,"constructor")&&!G.call(v.constructor.prototype,"isPrototypeOf"))return false;
var e;for(e in v);return e===undefined||G.call(v,e)};C.isEmptyObject=function(v){for(var e in v)return false;return true};C.isXmlDocument=function(v){return toString.call(v)==="[object Document]"};C.contains=function(v,e){var f=v,o=arguments,w=1;if(e&&module.isArray(e)){o=e;w=0}for(w=w;w<o;w++)f=f&&typeof foo[o[w]]!=="undefined";return f};C.formatStr=function(v){if(arguments.length<=1)return v;for(var e=arguments.length-2,f=0;f<=e;f++)v=v.replace(RegExp("\\{"+f+"\\}","gi"),arguments[f+1]);return v};
C.wordExists=function(v,e){var f="";if(e.toString)e=e.toString();for(var o=0;o<e.length;o++)f+=!/\w/.test(e[o])?"\\"+e[o]:e[o];return RegExp("(^|\\s|\\,)"+f+"(\\,|\\s|$)","i").test(v)};COG.extend(COG,C)})();
(function(){function G(f){return typeof console!=="undefined"?function(){console[f](Array.prototype.slice.call(arguments,0).join(" "));return true}:function(){return false}}var T=window.console&&window.console.markTimeline,C=G("error"),v=G("info"),e=function(){return T?function(f,o){console.markTimeline(f+(o?": "+((new Date).getTime()-o)+"ms":""))}:function(){}}();COG.extend(COG,{trace:e,debug:G("debug"),info:v,warn:G("warn"),error:C,exception:function(f){if(C)for(var o in f)v("ERROR DETAIL: "+o+
": "+f[o])}})})();
(function(){function G(C,v){var e=C.obsHandlers;e[v]||(e[v]=[]);return e[v]}var T=0;COG.observable=function(C){if(!C)return null;if(!C.obsHandlers)C.obsHandlers={};if(!(C.bind||C.trigger||C.unbind)){C.bind=function(v,e){var f="callback"+T++;G(C,v).unshift({fn:e,id:f});return f};C.triggerCustom=function(v,e){var f=G(C,v),o={cancel:false,name:v,source:this},w;e&&COG.extend(o,e);if(!f)return null;w=Array.prototype.slice.call(arguments,2);C.eventInterceptor&&C.eventInterceptor(v,o,w);w.unshift(o);for(var K=
f.length;K--&&!o.cancel;)f[K].fn.apply(this,w);return o};C.trigger=function(v){var e=Array.prototype.slice.call(arguments,1);e.splice(0,0,v,null);return C.triggerCustom.apply(this,e)};C.unbind=function(v,e){if(typeof v==="undefined")C.obsHandlers={};else for(var f=G(C,v),o=0;f&&o<f.length;o++)if(f[o].id===e){f.splice(o,1);break}return C}}return C}})();
(function(){function G(e,f){e[f]||(e[f]=function(o){return e.configure(f,o)})}function T(e){e.gtConfId="configurable"+v++;e.gtConfig={};e.gtConfigFns=[];return e.gtConfig}var C={},v=0;COG.paramTweaker=function(e,f,o){return function(w,K){if(typeof K!=="undefined"){if(w in e)e[w]=K;o&&w in o&&o[w](w,K)}else return f&&w in f?f[w](w):e[w]}};COG.configurable=function(e,f,o,w){if(e){e.gtConfId||T(e);var K=e.gtConfId,g=e.gtConfig,B=e.gtConfigFns;C[K]=e;B.push(o);for(o=f.length;o--;){g[f[o]]=true;w&&G(e,
f[o])}if(!e.configure)e.configure=function(t,D){if(g[t]){for(var p=B.length;p--;){var r=B[p](t,D);if(typeof r!=="undefined")return r}return C[K]}return null}}}})();
(function(){function G(e){var f=document.createElement("script"),o=false;f.src=e;f.async=true;f.onload=f.onreadystatechange=function(){if(!o&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){o=true;f.onload=f.onreadystatechange=null;f&&f.parentNode&&f.parentNode.removeChild(f)}};C||(C=document.getElementsByTagName("head")[0]);C.appendChild(f)}var T=0,C,v=this;COG.jsonp=function(e,f,o){e+=e.indexOf("?")>=0?"&":"?";var w="json"+ ++T;v[w]=function(K){f(K);v[w]=null;try{delete v[w]}catch(g){}};
G(e+(o?o:"callback")+"="+w);return w}})();
(function(){var G=1.70158,T=Math.PI/2,C=1E3/60|0,v=Math.abs,e=Math.pow,f=Math.sin,o=Math.asin,w=Math.cos,K={linear:function(g,B,t,D){return t*g/D+B},backin:function(g,B,t,D){return t*(g/=D)*g*((G+1)*g-G)+B},backout:function(g,B,t,D){return t*((g=g/D-1)*g*((G+1)*g+G)+1)+B},backinout:function(g,B,t,D){return(g/=D/2)<1?t/2*g*g*(((G*=1.525)+1)*g-G)+B:t/2*((g-=2)*g*(((G*=1.525)+1)*g+G)+2)+B},bouncein:function(g,B,t,D){return t-K.bounceout(D-g,0,t,D)+B},bounceout:function(g,B,t,D){return(g/=D)<1/2.75?t*
7.5625*g*g+B:g<2/2.75?t*(7.5625*(g-=1.5/2.75)*g+0.75)+B:g<2.5/2.75?t*(7.5625*(g-=2.25/2.75)*g+0.9375)+B:t*(7.5625*(g-=2.625/2.75)*g+0.984375)+B},bounceinout:function(g,B,t,D){return g<D/2?K.bouncein(g*2,0,t,D)/2+B:K.bounceout(g*2-D,0,t,D)/2+t/2+B},cubicin:function(g,B,t,D){return t*(g/=D)*g*g+B},cubicout:function(g,B,t,D){return t*((g=g/D-1)*g*g+1)+B},cubicinout:function(g,B,t,D){if((g/=D/2)<1)return t/2*g*g*g+B;return t/2*((g-=2)*g*g+2)+B},elasticin:function(g,B,t,D,p,r){if(g==0)return B;if((g/=
D)==1)return B+t;r||(r=D*0.3);if(!p||p<v(t)){p=t;t=r/4}else t=r/TWO_PI*o(t/p);return-(p*e(2,10*(g-=1))*f((g*D-t)*TWO_PI/r))+B},elasticout:function(g,B,t,D,p,r){var z;if(g==0)return B;if((g/=D)==1)return B+t;r||(r=D*0.3);if(!p||p<v(t)){p=t;z=r/4}else z=r/TWO_PI*o(t/p);return p*e(2,-10*g)*f((g*D-z)*TWO_PI/r)+t+B},elasticinout:function(g,B,t,D,p,r){var z;if(g==0)return B;if((g/=D/2)==2)return B+t;r||(r=D*0.3*1.5);if(!p||p<v(t)){p=t;z=r/4}else z=r/TWO_PI*o(t/p);if(g<1)return-0.5*p*e(2,10*(g-=1))*f((g*
D-z)*TWO_PI/r)+B;return p*e(2,-10*(g-=1))*f((g*D-z)*TWO_PI/r)*0.5+t+B},quadin:function(g,B,t,D){return t*(g/=D)*g+B},quadout:function(g,B,t,D){return-t*(g/=D)*(g-2)+B},quadinout:function(g,B,t,D){if((g/=D/2)<1)return t/2*g*g+B;return-t/2*(--g*(g-2)-1)+B},sinein:function(g,B,t,D){return-t*w(g/D*T)+t+B},sineout:function(g,B,t,D){return t*f(g/D*T)+B},sineinout:function(g,B,t,D){return-t/2*(w(Math.PI*g/D)-1)+B}};COG.tweenValue=function(g,B,t,D,p){function r(Q){Q=Q?Q:(new Date).getTime();if(ea+C<Q){var Y=
Q-z,R=t(Y,g,V,D),ia=z+D<=Q;Q=!ia;if(p){Y=p(R,ia,Y);Q=typeof Y!="undefined"?Y&&Q:Q}Q&&animFrame(r)}}var z=(new Date).getTime(),ea=0,V=B-g;animFrame(r);return{}};COG.easing=function(g){return K[g.replace(/[\-\_\s\.]/g,"").toLowerCase()]};COG.registerEasingType=function(g,B){K[g.replace(/[\-\_\s\.]/g,"").toLowerCase()]=B}})();
(function(){var G=/^P(\d+Y)?(\d+M)?(\d+D)?$/,T=/^(\d+H)?(\d+M)?(\d+S)?$/,C={8601:function(e){e=e.split("T");var f=null;f=null;var o=0,w=0;G.lastIndex=-1;f=G.exec(e[0]);o+=f[3]?parseInt(f[3].slice(0,-1),10):0;T.lastIndex=-1;f=T.exec(e[1]);w+=f[1]?parseInt(f[1].slice(0,-1),10)*3600:0;w+=f[2]?parseInt(f[2].slice(0,-1),10)*60:0;w+=f[3]?parseInt(f[3].slice(0,-1),10):0;return new v(o,w)}},v=COG.Duration=function(e,f){return{days:e?e:0,seconds:f?f:0}};COG.addDuration=function(){for(var e=new v,f=arguments.length;f--;){e.days+=
arguments[f].days;e.seconds+=arguments[f].seconds}if(e.seconds>=86400){e.days+=~~(e.seconds/86400);e.seconds%=86400}return e};COG.formatDuration=function(e){var f,o,w="";if(e.days)w=e.days+" days ";if(e.seconds){e=e.seconds;if(e>=3600){f=~~(e/3600);e-=f*3600}if(e>=60){o=Math.round(e/60);e-=o*60}if(f)w=w+f+(f>1?" hrs ":" hr ")+(o?(o>10?o:"0"+o)+" min ":"");else if(o)w=w+o+" min";else if(e>0)w=w+(e>10?e:"0"+e)+" sec"}return w};COG.parseDuration=function(e,f){var o=f?C[f]:null;if(o)return o(e);COG.Log.warn("Could not find duration parser for specified format: "+
f);return new v}})();COG.ObjectStore=function(){var G={},T={},C="obj_"+(new Date).getTime(),v=0,e=Object.prototype.hasOwnProperty;return{add:function(f,o){var w;o=o?o:"default";if(f&&f.constructor)if(!e.call(f,"id"))f.id=C+ ++v;w=T[o]?T[o]:T[o]=[];G[f.id]=w.length;w[f.length]=f}}};var CANI={};
(function(G){var T=[],C=0,v=false,e=G.register=function(f,o){T.push({section:f,run:o})};G.init=function(f){function o(){if(C<T.length){var K=T[C++];w[K.section]||(w[K.section]={});K.run(w[K.section],o)}else{for(K in w)G[K]=w[K];v=true;f&&f(G)}}var w={};if(v&&f)f(G);else{C=0;o()}};e("canvas",function(f,o){function w(){var B,t=K.getContext("2d");t.save();try{t.translate(50,50);t.beginPath();t.rect(0,0,20,20);B=t.isPointInPath(10,10)}finally{t.restore()}return B}var K=document.createElement("canvas"),
g=typeof FlashCanvas!="undefined";K.width=200;K.height=200;f.pipTransformed=g?false:w();o()})})(CANI);
INTERACT=function(){function G(p){return function(r,z,ea){(ea?ea:p?document.body:document).addEventListener(r,z,false)}}function T(p){return function(r,z,ea){(ea?ea:p?document.body:document).removeEventListener(r,z,false)}}function C(p,r,z){(z?z:document).attachEvent("on"+p,r)}function v(p,r,z){(z?z:document).detachEvent("on"+p,r)}function e(p,r){return{x:p?p:0,y:r?r:0,count:1}}function f(p,r){t.push(COG.extend({handler:null,checks:{},type:p},r))}function o(p){var r=0,z=0;if(p.offsetParent){do{r+=
p.offsetLeft;z+=p.offsetTop;p=p.offsetParent}while(p)}return{left:r,top:z}}function w(p,r){return{source:p,target:r.target?r.target:r.srcElement}}function K(p,r){for(var z=p.target?p.target:p.srcElement;z&&z!==r&&z.nodeName&&z.nodeName.toUpperCase()!="CANVAS";)z=z.parentNode;return z&&z===r}function g(p,r){return{x:p.x-(r?r.left:0),y:p.y-(r?r.top:0)}}function B(p){if(p.preventDefault){p.preventDefault();p.stopPropagation()}else p.cancelBubble&&p.cancelBubble()}var t=[],D=function(p,r,z){function ea(Z,
ca,L,O){var I=0,fa=0,u=0;COG.tweenValue(0,Z,L,O,function(M){u=I;I=M});COG.tweenValue(0,ca,L,O,function(M){V.trigger("pan",I-u,M-fa);fa=M})}z=COG.extend({binder:null,unbinder:null,observable:null},z);for(var V=z.observable,Q=null,Y=[],R=[],ia,oa,ra={bind:function(){return V.bind.apply(null,arguments)},pannable:function(Z){Q=COG.extend({inertia:true},Z);return ra},unbind:function(){V.unbind();for(var Z=0;Z<Y.length;Z++)Y[Z].unbind();return ra}},Ga=0;Ga<r.length;Ga++)Y.push(r[Ga](p,V,z));V.bind("pointerDown",
function(){R=[];oa=ia=0});V.bind("pointerMove",function(Z,ca,L,O){if(Q){R[R.length]={ticks:(new Date).getTime(),x:O.x,y:O.y};V.trigger("pan",O.x,O.y)}ia+=O.x?O.x:0;oa+=O.y?O.y:0});V.bind("pointerUp",function(Z,ca,L){if(Math.abs(ia)>20||Math.abs(oa)>20){if(Q){L=R.length;var O,I;ca=0;for(I=R.length;--I>1&&ca<50;)ca+=R[I].ticks-R[I-1].ticks;if(L-I>1){Z=R[L-1].x-R[I].x;O=R[L-1].y-R[I].y;I=Math.sqrt(Z*Z+O*O)|0;if(I>15){Z=R[L-1].x-R[0].x;O=R[L-1].y-R[0].y;I=Math.sqrt(Z*Z+O*O)|0;L=Math.asin(O/I);ca=I*500/
ca|0;ca=ca>300?300:ca;ea(Math.cos(Z>0?L:Math.PI-L)*ca,Math.sin(L)*ca,COG.easing("sine.out"),500)}}}}else V.trigger("tap",ca,L)});return ra};f("pointer",{handler:function(p,r,z){function ea(u){if(u.pageX&&u.pageY)return e(u.pageX,u.pageY);else{var M=document.documentElement,X=document.body;return e(u.clientX+(M&&M.scrollLeft||X&&X.scrollLeft||0)-(M&&M.clientLeft||X&&X.clientLeft||0),u.clientY+(M&&M.scrollTop||X&&X.scrollTop||0)-(M&&M.clientTop||X&&X.clientTop||0))}}function V(u){if(K(u,p))if(Z=ia(u)){var M=
ea(u);p.style.cursor="move";B(u);I=M.x;fa=M.y;ca=e(I,fa);r.triggerCustom("pointerDown",w("mouse",u),ca,g(ca,o(p)))}}function Q(u){var M=ea(u);L=M.x;O=M.y;if(K(u,p))oa(u,Z?"pointerMove":"pointerHover")}function Y(u){if(Z&&ia(u)){Z=false;if(K(u,p)){p.style.cursor="default";oa(u,"pointerUp")}}}function R(u){if(K(u,p)){var M;u=u||window.event;if(u.detail)M=u.axis===2?-u.detail*ra:0;else{M=u.wheelDeltaY?u.wheelDeltaY:u.wheelDelta;if(window.opera)M=-M}if(M!==0){var X=e(L,O);r.triggerCustom("zoom",w("mouse",
u),X,g(X,o(p)),M/Ga,"wheel");B(u);u.returnValue=false}}}function ia(u){u=u||window.event;return(u.which||u.button)==1}function oa(u,M,X,sa,Ea){X=typeof X!="undefined"?X:L;sa=typeof sa!="undefined"?sa:O;var H=X-I,W=sa-fa,P=e(X,sa);r.triggerCustom(M,w("mouse",u),P,g(P,o(p)),e(H,W));if(typeof Ea=="undefined"||Ea){I=X;fa=sa}}z=COG.extend({},z);var ra=120,Ga=ra*8,Z=false,ca,L,O,I,fa;z.binder("mousedown",V,false);z.binder("mousemove",Q,false);z.binder("mouseup",Y,false);z.binder("dblclick",function(u){COG.info("captured double click");
if(K(u,p)){var M=ea(u);r.triggerCustom("doubleTap",w("mouse",u),M,g(M,o(p)))}},false);z.binder("mousewheel",R,document);z.binder("DOMMouseScroll",R,document);return{unbind:function(){z.unbinder("mousedown",V,false);z.unbinder("mousemove",Q,false);z.unbinder("mouseup",Y,false);z.unbinder("mousewheel",R,document);z.unbinder("DOMMouseScroll",R,document)}}},checks:{touch:false}});f("pointer",{handler:function(p,r,z){function ea(H){if(H.count<2)return 0;var W=H.x-H.next.x;H=H.y-H.next.y;return~~Math.sqrt(W*
W+H*H)}function V(H,W,P){W=W?W:0;P=P?P:0;for(var ma={x:H.x-W,y:H.y-P,id:H.id,count:H.count},Ba=ma;H.next;){H=H.next;Ba=Ba.next={x:H.x-W,y:H.y-P,id:H.id}}return ma}function Q(H,W){var P=H[W?W:"touches"],ma,Ba;if(P.length===0)return null;Ba=ma={x:P[0].pageX,y:P[0].pageY,id:P[0].identifier,count:P.length};for(var ya=1,Ca=P.length;ya<Ca;ya++)Ba=Ba.next={x:P[ya].pageX,y:P[ya].pageY,id:P[ya].identifier};return ma}function Y(H){if(K(H,p)){O=o(p);var W=Q(H,"changedTouches"),P=V(W,O.left,O.top);if(!fa){I=
Z;r.triggerCustom("pointerDown",w("touch",H),W,P)}sa&&r.triggerCustom("pointerDownMulti",w("touch",H),W,P);fa=Q(H);if(fa.count>1)M=ea(fa);Ea=1;X=V(fa)}}function R(H){if(K(H,p)){H.preventDefault();u=Q(H);if(I==Z)I=Math.abs(fa.x-u.x)>ra||Math.abs(fa.y-u.y)>ra?Ga:Z;if(I!=Z){I=u.count>1?L:ca;if(I==L)if(fa.count===1){fa=V(u);M=ea(fa)}else{var W=ea(u);if(Math.abs(M-W)<oa)I=ca;else{var P;P=u.x;var ma=u.next.x,Ba=u.y,ya=u.next.y,Ca=Ba<ya?Ba:ya;P={x:(P<ma?P:ma)+(Math.abs(P-ma)>>1),y:Ca+(Math.abs(Ba-ya)>>1)};
W=W/M;ma=W-Ea;r.triggerCustom("zoom",w("touch",H),P,g(P,O),ma,"pinch");Ea=W}}I==ca&&r.triggerCustom("pointerMove",w("touch",H),u,V(u,O.left,O.top),e(u.x-X.x,u.y-X.y));sa&&r.triggerCustom("pointerMoveMulti",w("touch",H),u,V(u,O.left,O.top))}X=V(u)}}function ia(H){if(K(H,p)){var W=Q(H,"changedTouches"),P=V(W,O.left,O.top);u=Q(H);if(!u){r.triggerCustom("pointerUp",w("touch",H),W,P);fa=null}sa&&r.triggerCustom("pointerUpMulti",w("touch",H),W,P)}}z=COG.extend({detailed:false,inertia:false},z);var oa=20,
ra=7,Ga=0,Z=1,ca=2,L=3,O,I,fa,u,M,X,sa=z.detailed,Ea=1;z.binder("touchstart",Y,false);z.binder("touchmove",R,false);z.binder("touchend",ia,false);COG.info("initialized touch handler");return{unbind:function(){z.unbinder("touchstart",Y,false);z.unbinder("touchmove",R,false);z.unbinder("touchend",ia,false)}}},checks:{touch:true}});return{register:f,watch:function(p,r,z){r=COG.extend({bindToBody:false,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},r);capabilities=COG.extend({touch:"ontouchstart"in
window},z);if(!r.observable){COG.info("creating observable");r.observable=COG.observable({});globalOpts=r}r.binder=r.isIE?C:G(r.bindToBody);r.unbinder=r.isIE?v:T(r.bindToBody);z=r.types;for(var ea=capabilities,V=[],Q=t.length;Q--;){var Y=t[Q],R=!z||z.indexOf(Y.type)>=0,ia=true;for(var oa in Y.checks){var ra=Y.checks[oa];COG.info("checking "+oa+" capability. require: "+ra+", capability = "+ea[oa]);ia=ia&&ra===ea[oa]}if(R&&ia)V[V.length]=Y.handler}return new D(p,V,r)}}}();var T5={};
(function(G){function T(){return(new Date).getTime()}function C(){for(;Ea.length>0;){var a=Ea.shift();document.location=a}sa=0}function v(a){for(var i=true,d=H.length;d--;)i=i&&a!=H[d];return i}function e(a,i){var d=[];for(var b in i)b&&d.push(b+"="+escape(i[b]));return"tile5://"+a+"/"+(d.length>0?"?"+d.join("&"):"")}function f(a,i){v(a)&&COG.info("would push url: "+e(a,i))}function o(a,i){if(v(a)){Ea.push(e(a,i));sa||(sa=setTimeout(C,100))}}function w(a){return function(i,d,b){(b?b:a?document.body:
document).addEventListener(i,d,false)}}function K(a){return function(i,d,b){(b?b:a?document.body:document).removeEventListener(i,d,false)}}function g(a,i,d){(d?d:document).attachEvent("on"+a,i)}function B(a,i,d){(d?d:document).detachEvent("on"+a,i)}function t(){u={base:{name:"Unknown",bindEvent:w(),unbindEvent:K(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:f,targetFps:null},ie:{name:"MSIE",regex:/msie/i,
bindEvent:g,unbindEvent:B,requireFastDraw:false,targetFps:25},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:o,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:o},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:o},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:w(true),unbindEvent:K(true),supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},
bridgeNotify:o},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:o}};M=[u.froyo,u.android,u.ipod,u.iphone,u.ipad,u.ie]}function D(){u||t();if(!X){COG.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var a=0;a<M.length;a++){var i=M[a];if(i.regex&&i.regex.test(navigator.userAgent)){X=COG.extend({},u.base,i);COG.info("PLATFORM DETECTED AS: "+X.name);break}}if(!X){COG.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
X=u.base}COG.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return X}function p(){for(var a=0,i=arguments.length;i--;){var d=Ba[arguments[i].toUpperCase()];if(d)a|=d}return a}function r(a,i){var d,b;if(i&&i.width>0){if(!a.imageOffset)a.imageOffset=L.init(-i.width>>1,-i.height>>1);if(!a.bounds){d=a.xy.x+a.imageOffset.x;b=a.xy.y+a.imageOffset.y;a.bounds=I.init(d,b,d+i.width,b+i.height)}}}function z(a){function i(){a.transformed=c!==1||b%ea!==0||m!==0||h!==0}var d=1E3/60|0,b=0,c=1,m=0,
h=0;COG.extend(a,{animate:function(q,x,j,s,A,J){var aa=(new Date).getTime(),ba=a[q],N=x.length&&j.length&&x.length==j.length?x.length:0,k=Array(N),E=Array(N),S=COG.easing(s?s:"sine.out"),F=function(ja){ja=ja?ja:(new Date).getTime();if(ja-0>d){var Ra=ja-aa;ja=aa+A<=ja;for(var Ka=N;Ka--;)E[Ka]=S(Ra,x[Ka],k[Ka],A);ba.apply(a,E);a.invalidate.call(a);if(ja){ba.apply(a,j);a.invalidate.call(a);J&&J()}else animFrame(F)}};if(ba&&ba.apply&&N>0){A=A?A:1E3;for(q=N;q--;)k[q]=j[q]-x[q];animFrame(F)}},rotate:function(q){b=
q;i()},scale:function(q){c=q;i()},translate:function(q,x){m=q;h=x;i()},transform:function(q,x,j){q.save();q.translate(a.xy.x-x+m,a.xy.y-j+h);b!==0&&q.rotate(b);c!==1&&q.scale(c,c)}})}window.animFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){setTimeout(function(){a((new Date).getTime())},1E3/60)}}();var ea=Math.PI*2,V=Math.abs,Q=Math.min,Y=Math.max,
R=Math.pow,ia=Math.sqrt,oa=Math.log,ra=Math.round,Ga=Math.sin,Z=Math.asin,ca=Math.cos,L=function(){function a(b,c){return d(b.x-c.x,b.y-c.y)}function i(b,c){if(!c)c=b.length;if(c<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var m={edges:Array(c-1),accrued:Array(c-1),total:0},h=0;h<c-1;h++){var q=a(b[h],b[h+1]);m.edges[h]=ia(q.x*q.x+q.y*q.y);m.accrued[h]=m.total+m.edges[h];m.total+=m.edges[h]}return m}function d(b,c){return{x:b?b:0,y:c?c:0}}return{VECTOR_SIMPLIFICATION:3,
SIMPLIFICATION_MIN_VECTORS:25,add:function(){for(var b=0,c=0,m=arguments.length;m--;){b+=arguments[m].x;c+=arguments[m].y}return d(b,c)},absSize:function(b){return Y(V(b.x),V(b.y))},copy:function(b){return b?d(b.x,b.y):null},diff:a,distance:function(b,c){return i(b,c).total},edges:i,equals:function(b,c){return b.x===c.x&&b.y===c.y},extendBy:function(b,c,m){var h=ca(c)*m;c=Ga(c)*m;return d(b.x-h,b.y-c)},floor:function(b){for(var c=Array(b.length),m=b.length;m--;)c[m]=d(~~b[m].x,~~b[m].y);return c},
getRect:function(b){for(var c,m,h,q,x=b.length;x--;){var j=b[x];c=typeof c==="undefined"||j.x<c?j.x:c;m=typeof m==="undefined"||j.y<m?j.y:m;h=typeof h==="undefined"||j.x>h?j.x:h;q=typeof q==="undefined"||j.y>q?j.y:q}return I.init(c,m,h,q)},init:d,invert:function(b){return d(-b.x,-b.y)},min:function(b,c){return d(b.x<c.x?b.x:c.x,b.y<c.y?b.y:c.y)},max:function(b,c){return d(b.x>c.x?b.x:c.x,b.y>c.y?b.y:c.y)},offset:function(b,c,m){return d(b.x+c,b.y+(m?m:c))},scale:function(b,c){return d(b.x/c|0,b.y/
c|0)},simplify:function(b,c){if(!b)return null;c=c?c:L.VECTOR_SIMPLIFICATION;for(var m=[],h=null,q=b.length;q--;){var x=b[q];if(include=!h||q===0||V(x.x-h.x)+V(x.y-h.y)>c){m.unshift(x);h=x}}return m},theta:function(b,c,m){m=Z((b.y-c.y)/m);return b.x>c.x?m:Math.PI-m},toString:function(b){return b?b.x+", "+b.y:""}}}(),O=function(){return{dotProduct:function(a,i){return a.x*i.x+a.y*i.y}}}(),I=function(){function a(d){return i(d.x1,d.y1,d.x2,d.y2)}function i(d,b,c,m){d=d?d:0;b=b?b:0;c=typeof c!=="undefined"?
c:d;m=typeof m!=="undefined "?m:m;return{x1:d,y1:b,x2:c,y2:m,width:c-d,height:m-b}}return{center:function(d){return L.init(d.x1+(d.width>>1),d.y1+(d.height>>1))},copy:a,diagonalSize:function(d){return ia(d.width*d.width+d.height*d.height)},fromCenter:function(d,b,c,m){c=c>>1;m=m>>1;return i(d-c,b-m,d+c,b+m)},init:i,intersect:function(d,b){var c=Y(d.x1,b.x1),m=Y(d.y1,b.y1),h=Q(d.x2,b.x2),q=Q(d.y2,b.y2);c=i(c,m,h,q);return c.width>0&&c.height>0?c:null},toString:function(d){return d?"["+d.x1+", "+d.y1+
", "+d.x2+", "+d.y2+"]":""},union:function(d,b){if(d.width===0||d.height===0)return a(b);else if(b.width===0||b.height===0)return a(d);else{var c=Q(d.x1,b.x1),m=Q(d.y1,b.y1),h=Y(d.x2,b.x2),q=Y(d.y2,b.y2);c=i(c,m,h,q);return c.width>0&&c.height>0?c:null}}}}(),fa=function(){return{getAspectRatio:function(a){return a.height!==0?a.width/a.height:1},getCenter:function(a){return L.init(a.width>>1,a.height>>1)},getSize:function(a){return ia(R(a.width,2)+R(a.height,2))},init:function(a,i){a=a?a:0;return{width:a,
height:i?i:a}}}}();Hits=function(){return{diffHits:function(a,i){var d=[],b={},c;for(c=i.length;c--;)b[i[c].target.id]=true;for(c=a.length;c--;)b[a[c].target.id]||(d[d.length]=a[c]);return d},init:function(a,i,d,b){return{type:a,x:b.x|0,y:b.y|0,elements:[],absXY:i,relXY:d}},initHit:function(a,i,d){return d=COG.extend({type:a,target:i,drag:false},d)},triggerEvent:function(a,i,d,b){i.triggerCustom(a.type+(d?d:"Hit"),{hitType:a.type},b?b:a.elements,a.absXY,a.relXY,L.init(a.x,a.y))}}}();var u=null,M=
[],X=null,sa=0,Ea=[],H=["view.wake","tile.loaded"],W=function(){function a(){var k=D().maxImageLoads;if(!k||s.length<k){var E=j.shift();k=T5.ticks();if(E){s[s.length]=E;E.image.onload=d;E.image.src=E.url;E.requested=k}if(k-aa>m){E=false;for(var S=0,F=D();S<s.length;)if(k-s[S].requested>N.loadTimeout*1E3){s.splice(S,1);E=true}else S++;E&&a();if(F&&F.imageCacheMaxSize){J=A.length*N.avgImageSize/F.imageCacheMaxSize;J>=1&&i()}aa=k}}}function i(){ba=true;try{var k=A.length>>1;if(k>0){A.sort(function(S,
F){return S.created-F.created});for(var E=k;E--;)delete h[A[E].url];A.splice(0,k)}}finally{ba=false}N.trigger("cacheCleared")}function d(){var k=q[this.id],E;if(k&&k.image.complete&&k.image.width>0){k.loaded=true;k.hitCount=1;for(E=s.length;E--;)if(s[E].image.src==this.src){s.splice(E,1);break}if(k.background||k.postProcess||k.drawBackground||k.customDraw)if(k.image){globalImageData=k;E=c(k.realSize?k.realSize.width:k.image.width,k.realSize?k.realSize.height:k.image.height);var S=E.getContext("2d"),
F=k.offset?k.offset:T5.XY.init();k.background&&S.drawImage(k.background,0,0);k.drawBackground&&k.drawBackground(S);k.customDraw?k.customDraw(S,k):S.drawImage(k.image,F.x,F.y);k.postProcess&&k.postProcess(S,k);k.image=E}for(E=k.callbacks.length;E--;)k.callbacks[E]&&k.callbacks[E](this,false);k.callbacks=[];A[A.length]={url:this.src,created:k.requested};delete q[this.id];a()}}function b(k,E,S){var F=h[k];if(F){F.hitCount++;F.image.complete&&F.image.width>0&&E?E(F.image,true):F.callbacks.push(E)}else{F=
COG.extend({url:k,image:new Image,loaded:false,created:T5.ticks(),requested:null,hitCount:0,callbacks:[E]},S);F.image.id="resourceLoaderImage"+x++;h[k]=F;q[F.image.id]=F;j[j.length]=F;a()}return F}function c(k,E){var S=document.createElement("canvas");COG.info("creating new canvas");S.width=k?k:0;S.height=E?E:0;if(typeof FlashCanvas!="undefined"){document.body.appendChild(S);FlashCanvas.initElement(S)}return S}var m=1E4,h={},q={},x=0,j=[],s=[],A=[],J=0,aa=0,ba=false,N={avgImageSize:25,loadTimeout:10,
cancelLoad:function(){var k;for(k=s.length;k--;)delete h[s[k].url];s=[];for(k=j.length;k--;)delete h[j[k].url];j=[]},get:function(k,E,S){var F=null,ja=null;ba||(F=h[k]);if((ja=F?F.image:null)&&(ja.getContext||ja.complete&&ja.width>0))return ja;else E&&b(k,E,S);return null},load:b,newCanvas:c,reset:function(){h={}},stats:function(){return{imageLoadingCount:s.length,queuedImageCount:j.length,imageCacheFullness:J}}};COG.observable(N);return N}(),P=function(){var a={};return{init:function(i,d){var b=
a[i];if(!b)throw Error("Unable to locate requested generator: "+i);return new b(d)},register:function(i,d){a[i]=d},Template:function(){}}}(),ma=function(){function a(h,q){c[h]=d(q);return h}function i(h){for(var q in h)a(q,h[q])}function d(h){function q(A){var J=h[A];typeof J!=="undefined"&&j.push(function(aa){aa[A]=J})}function x(){j=[];for(var A in h)q(A)}h=COG.extend({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,
globalCompositeOperation:undefined},h);var j=[],s={applyToContext:function(A){for(var J=j.length;J--;)j[J](A)},update:function(A,J){h[A]=J;x()}};x();return s}var b={},c={},m={apply:function(h,q){var x=c[q]?c[q]:c.basic,j;if(h&&h.canvas){j=b[h.canvas.id];b[h.canvas.id]=q}x.applyToContext(h);return j},define:a,defineMany:i,get:function(h){return c[h]},init:d,load:function(h){COG.jsonp(h,function(q){i(q)})}};i({basic:{lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"},waypoints:{lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",
fillStyle:"#FFF"},waypointsHover:{lineWidth:4,strokeStyle:"#f00",fillStyle:"#FFF"}});return m}(),Ba={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,ZOOM:16,FREEZE:128},ya=function(a){a=COG.extend({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:p("ACTIVE","ANIMATING","PAN","ZOOM"),style:null,minXY:null,maxXY:null},a);var i=null,d=false,b=false,c=a.id,m=p("ACTIVE"),h=a.validStates,q=0,x=0,j=COG.extend({addToView:function(s){s.setLayer(c,j)},shouldDraw:function(s){return(s&h)!==0},clip:null,cycle:function(){},
draw:function(){},hitGuess:null,remove:function(){j.trigger("remove",j)},changed:function(){b=true;i&&i.invalidate()},hitTest:null,getId:function(){return c},setId:function(s){c=s},getParent:function(){return i},setParent:function(s){d=(i=s)?i.fastDraw&&displayState!==m:false;j.trigger("parentChange",i)}},a);COG.observable(j);j.bind("drawComplete",function(s,A){b=false;q=A.x1;x=A.y1});j.bind("resync",function(s,A){j.minXY&&A.syncXY(j.minXY);j.maxXY&&A.syncXY(j.maxXY)});return j},Ca=function(a){a=
COG.extend({style:null,xy:null,size:null,fill:false,stroke:true,draggable:false,observable:true,properties:{},type:"shape",transformable:false},a);COG.extend(this,a);this.id=COG.objId(this.type);this.bounds=null;this.observable&&COG.observable(this);this.transformable&&z(this);this.transformed=false};Ca.prototype={constructor:Ca,drag:null,draw:function(a){this.fill&&a.fill();this.stroke&&a.stroke()},invalidate:function(){var a=this.layer?this.layer.getParent():null;a&&a.invalidate()},prepPath:function(){},
resync:function(a){if(this.xy){a.syncXY([this.xy]);this.size&&this.updateBounds(I.fromCenter(this.xy.x,this.xy.y,this.size,this.size))}},setTransformable:function(a){a&&!this.transformable&&z(this);this.transformable=a},updateBounds:function(a,i){this.bounds=a;if(i)this.xy=I.center(this.bounds)}};var Sa=function(a,i){i=COG.extend({simplify:false},i);var d=false,b=i.simplify;p("ZOOM");var c=[];i.type=i.fill?"polygon":"line";Ca.call(this,i);COG.extend(this,{animatePath:function(){},prepPath:function(m,
h,q){if(d){var x=true;m.beginPath();for(var j=c.length;j--;){var s=c[j].x-h,A=c[j].y-q;if(x){m.moveTo(s,A);x=false}else m.lineTo(s,A)}}return d},resync:function(m){var h,q,x,j,s;m.syncXY(a);c=L.floor(b?L.simplify(a):a);for(var A=c.length;A--;){m=c[A].x;h=c[A].y;j=typeof j=="undefined"||m<j?m:j;s=typeof s=="undefined"||h<s?h:s;q=typeof q=="undefined"||m>q?m:q;x=typeof x=="undefined"||h>x?h:x}this.updateBounds(I.init(j,s,q,x),true)}});d=a&&a.length>=2};Sa.prototype=COG.extend(Ca.prototype,{constructor:Sa});
var rb=function(a,i){i.fill=false;Sa.call(this,a,i)};rb.prototype=new Sa;var Oa=function(a){function i(x){if(this.imageUrl=x)h=W.get(this.imageUrl,function(j){var s=q.layer?q.layer.getParent():null;h=j;s&&s.invalidate()})}a=COG.extend({image:null,imageUrl:null,imageOffset:null},a);var d=null,b=Ca.prototype.updateBounds,c,m,h=a.image;Ca.call(this,a);var q=COG.extend(this,{changeImage:i,drag:function(x,j,s,A){d||(d=L.init(x.startX-this.xy.x,x.startY-this.xy.y));this.xy.x=j-d.x;this.xy.y=s-d.y;if(A){d=
null;if(this.layer)(x=this.layer.getParent())&&x.syncXY([this.xy],true);this.trigger("dragDrop")}return true},draw:function(x){x.drawImage(h,c,m)},prepPath:function(x,j,s){var A=h&&h.width>0;if(A){r(this,h);c=this.xy.x+this.imageOffset.x-j;m=this.xy.y+this.imageOffset.y-s;x.beginPath();x.rect(c,m,h.width,h.height)}return A},updateBounds:function(x,j){b.call(this,x,j);r(this,h)}});h||i(this.imageUrl)};Oa.prototype=new Ca;Oa.prototype.constructor=Oa;var Wa=function(a){a=COG.extend({imageAnchor:null},
a);if(a.imageAnchor)a.imageOffset=L.invert(a.imageAnchor);Oa.call(this,a)};Wa.prototype=new Oa;Wa.prototype.constructor=Wa;var sb=function(a){function i(h){for(var q=b.length;q--;)b[q].resync(h);b.sort(function(x,j){var s=j.xy.y-x.xy.y;return s!=0?s:j.xy.x-x.xy.y});m.changed()}function d(h,q){i(q)}a=COG.extend({zindex:10},a);var b=[],c=CANI.canvas.pipTransformed,m=COG.extend(new ya(a),{add:function(h,q){if(h){h.layer=m;var x=m.getParent();if(x){h.resync(m.getParent());x.invalidate()}if(q)b.unshift(h);
else b[b.length]=h}},clear:function(){b=[]},draw:function(h,q,x,j,s,A){j=q.x1;s=q.y1;var J=A?c?A.x-j:A.relXY.x:0,aa=A?c?A.y-s:A.relXY.y:0,ba=q.width;q=q.height;for(var N=b.length;N--;){var k=b[N],E=k.style,S,F=k.transformed;if(F){k.transform(h,j,s);if(c){J-=k.xy.x;aa-=k.xy.y}}if(k.prepPath(h,F?k.xy.x:j,F?k.xy.y:s,ba,q,x)){if(A&&h.isPointInPath(J,aa)){A.elements.push(Hits.initHit(k.type,k,{drag:k.draggable?k.drag:null}));S=A.type+"Style";E=k[S]||m[S]||E}E=E?ma.apply(h,E):null;k.draw(h,j,s,ba,q,x);
E&&ma.apply(h,E)}F&&h.restore()}},find:function(){return[].concat(b)},hitGuess:function(h,q){for(var x=false,j=b.length;!x&&j--;){var s=b[j].bounds;x=x||s&&h>=s.x1&&h<=s.x2&&q>=s.y1&&q<=s.y2}return x}});m.bind("parentChange",d);m.bind("resync",d);return m},zb=function(){return{tileSize:256,init:function(a,i,d,b,c){return COG.extend({x:a,y:i,width:d,height:b},c)}}}();COG.extend(G,{ex:COG.extend,ticks:T,getConfig:D,userMessage:function(a,i,d){G.trigger("userMessage",a,i,d)},XY:L,XYRect:I,Dimensions:fa,
Vector:O,Hits:Hits,Images:W,Generator:P,tween:COG.tween,tweenValue:COG.tweenValue,easing:COG.easing,Tween:COG.Tween,Style:ma,viewState:p,View:function(a){function i(l,n,y){Fa||Xa(ga-n,ha-y)}function d(l,n,y,U){Ka(Q(Y(la+R(2,U)-1,0.5),2))}function b(){var l=oa(la)/Math.LN2|0;if(l!==0){la=R(2,l);tb(Ta+l,Ya,Za)}F()}function c(l){l||(l=L.init(Ma,Na));fb=L.init(ga,ha);Ua=L.offset(l,ga,ha);Ya=Ua.x;Za=Ua.y}function m(l,n){var y=1/la;return L.init(Pa.x1+l*y,Pa.y1+n*y)}function h(l,n,y){Qa("doubleTap",n,y,
m(y.x,y.y));a.scalable&&Ka(2,y,a.zoomEasing,null,a.zoomDuration)}function q(l,n,y){Fa=null;S("down",n,y)}function x(l,n,y){S("hover",n,y)}function j(l,n,y){k(n,y,false)}function s(l,n,y){k(n,y,true)}function A(){clearTimeout(ub);ub=setTimeout(aa,250)}function J(l,n,y){S("tap",n,y);Qa("tap",n,y,m(y.x,y.y,true))}function aa(l,n){var y;$a=typeof FlashCanvas!=="undefined";COG.info("is flash = "+$a);if(pa){if(a.autoSize&&pa.parentNode){l=pa.parentNode.offsetWidth;n=pa.parentNode.offsetHeight}try{if(!pa.id)pa.id=
a.id+"_canvas";qa=pa.getContext("2d")}catch(U){COG.exception(U);throw Error("Could not initialise canvas on specified view element");}if(l&&n&&(ta!==n||ua!==l)){gb=true;ua=l;ta=n;Ma=ua>>1;Na=ta>>1;ka.trigger("resize",ua,ta);for(y=za;y--;)da[y].trigger("resize",ua,ta)}for(y=za;y--;)da[y].trigger("contextChanged",qa);F();N()}}function ba(l,n){n.setId(l);n.added=T();n.bind("remove",function(){ka.removeLayer(l)});n.trigger("contextChanged",qa);n.setParent(ka);da.push(n);da.sort(function(y,U){var $=U.zindex-
y.zindex;if($===0)$=U.added-y.added;return $});za=da.length;return n}function N(){Aa&&Aa.unbind();Aa=INTERACT.watch(pa);a.pannable&&Aa.pannable().bind("pan",i);if(a.scalable){Aa.bind("zoom",d);Aa.bind("doubleTap",h)}Aa.bind("pointerDown",q);Aa.bind("pointerMove",j);Aa.bind("pointerUp",s);a.captureHover&&Aa.bind("pointerHover",x);Aa.bind("tap",J)}function k(l,n,y){if(Fa){l=m(n.x,n.y);Fa.drag.call(Fa.target,Fa,l.x,l.y,y)&&F();if(y)Fa=null}}function E(l){var n,y,U=false;if(hb|$a){l=l?l:(new Date).getTime();
y=ga!==ib||ha!==jb;Ha=vb|(la!==1?wb:0)|(y?kb:0)|(lb?mb:0);nb=(n=(Ha&(wb|kb))!==0)&&(Ha&mb)===0;if(gb&&pa){$a&&FlashCanvas.initElement(pa);pa.width=ua;pa.height=ta;pa.style.width=ua+"px";pa.style.height=ta+"px";gb=false}ab=ja();for(y=za;y--;){Ha|=da[y].animated?mb:0;da[y].cycle(l,ab,Ha);U=da[y].clip||U}y=Ha;var $=ab;U=Ab&&U&&!n;n=l;var na;I.center($);var va=0,wa;if(la!==1){wa=1/la;Ya=Ua.x+(ga-fb.x);Za=Ua.y+(ha-fb.y);wa=$?I.fromCenter(Ya>>0,Za>>0,$.width*wa>>0,$.height*wa>>0):void 0}else wa=I.copy($);
Pa=wa;U||qa.clearRect(0,0,ua,ta);Pa.scaleFactor=la;qa.save();try{la!==1&&qa.scale(la,la);bb=cb=null;if(U){qa.beginPath();for(va=za;va--;)da[va].clip&&da[va].clip(qa,Pa,y,ka,n);qa.closePath();qa.clip()}qa.globalCompositeOperation="source-over";for(va=za;va--;){na=da[va];if(na.shouldDraw(Ha,ab)){var xa=na.style,La=xa?ma.apply(qa,xa):null;na.draw(qa,Pa,y,ka,n,Da);La&&ma.apply(qa,La)}}}finally{qa.restore()}hb=0;Qa("drawComplete",$,n);if(Da){na=Da?Da.elements:[];if(Va&&Va.type==="hover"){xa=Hits.diffHits(Va.elements,
na);xa.length>0&&Hits.triggerEvent(Va,ka,"Out",xa)}if(na.length>0){La=Da.x;y=Da.y;for(xa=na.length;xa--;){$=na[xa];U=La;n=y;if(va=$&&$.drag&&(!$.canDrag||$.canDrag($,U,n))){Fa=$;Fa.startX=U;Fa.startY=n}if(va)break}Hits.triggerEvent(Da,ka)}Va=na.length>0?COG.extend({},Da):null;Da=null}l-xb>Bb&&Ra();Cb=l;ib=ga;jb=ha;animFrame(E)}else ob=false}function S(l,n,y){Da=Hits.init(l,n,y,m(y.x,y.y,true));for(l=za;l--;)pb=pb||(da[l].hitGuess?da[l].hitGuess(Da.x,Da.y,Ha,ka):false);pb&&F()}function F(){hb+=1;if(!ob){ob=
true;animFrame(E)}}function ja(){return I.init(ga,ha,ga+ua,ha+ta)}function Ra(){if(Ia||Ja){var l=db?ga+Ma:ga,n=eb?ha+Na:ha;if(Ia&&Ia>ua)if(l+ua>Ia)ga=db?l-Ia>0?ga-Ia:ga:Ia-ua;else if(l<0)ga=db?ga+Ia:0;if(Ja&&Ja>ta)if(n+ta>Ja)ha=eb?n-Ja>0?ha-Ja:ha:Ja-ta;else if(n<0)ha=eb?ha+Ja:0}xb=(new Date).getTime();Qa("refresh",ka,ja());F()}function Ka(l,n,y,U,$){if(y)COG.tweenValue(la,l,y,$,function(na,va){la=na;if(va){var wa=ra(oa(la)/Math.LN2);la=R(2,wa);U&&U()}c(n);b()});else{la=l;c(n);b()}return ka}function tb(l,
n,y){l=Y(a.minZoom,Q(a.maxZoom,l));if(l!==Ta){var U=R(2,l-Ta),$=Ma/U|0,na=Na/U|0;Ta=l;Xa(((n?n:ga+Ma)-$)*U,((y?y:ha+Na)-na)*U);ib=ga;jb=ha;Qa("zoomLevelChange",l);la=1;Ra()}}function Qa(){for(var l=ka.trigger.apply(null,arguments).cancel,n=da.length;n--;)l=da[n].trigger.apply(null,arguments).cancel||l;return!l}function Xa(l,n,y,U,$){function na(){va+=1;if(va>=2){lb=false;$&&$()}}var va=0,wa=cb?L.offset(cb,-Ma,-Na):null,xa=bb?L.offset(bb,-Ma,-Na):null;if(wa){l=l<wa.x?wa.x:l;n=n<wa.y?wa.y:n}if(xa){l=
l>xa.x?xa.x:l;n=n>xa.y?xa.y:n}if(y){if((Ha&kb)===0){COG.tweenValue(ga,l,y,U,function(La,qb){ga=La|0;(qb?na:F)();return!nb});COG.tweenValue(ha,n,y,U,function(La,qb){ha=La|0;(qb?na:F)();return!nb});lb=true}}else{ga=l|0;ha=n|0;F();$&&$()}}a=COG.extend({id:COG.objId("view"),container:"",captureHover:true,captureDrag:false,fastDraw:false,inertia:true,minRefresh:1E3,pannable:false,clipping:true,scalable:false,panAnimationEasing:COG.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,
autoSize:true,tapExtent:10,guides:false,turbo:false,fps:25,minZoom:1,maxZoom:1,zoomEasing:COG.easing("quad.out"),zoomDuration:300,zoomLevel:1},a);var da=[],za=0,pa=document.getElementById(a.container),Fa=null,qa=null,Db=typeof window.attachEvent!="undefined",$a,pb=false,Bb=a.minRefresh,ga=0,ha=0,ib=0,jb=0,Ia=null,Ja=null,db=false,eb=false,Ab=a.clipping,ab=null,ob=false,Pa,yb=1,Ma=0,Na=0,Da=null,fb=null,Ua=null,nb=false,cb=null,bb=null,xb=0,Va=null,ub=0,la=1,Cb=0,gb=false,Aa=null,lb=false,ta,ua,hb=
0,Ya,Za,Ta=a.zoomLevel,vb=p("ACTIVE"),kb=p("PAN"),wb=p("ZOOM"),mb=p("ANIMATING"),Ha=vb,ka={id:a.id,deviceScaling:yb,fastDraw:a.fastDraw||D().requireFastDraw,detach:function(){Aa&&Aa.unbind()},eachLayer:function(l){for(var n=za;n--;)l(da[n])},getDimensions:function(){return fa.init(ua,ta)},getLayer:function(l){for(var n=0;n<za;n++)if(da[n].getId()==l)return da[n];return null},getZoomLevel:function(){return Ta},setLayer:function(l,n){for(var y=0;y<za;y++)if(da[y].getId()===l){da.splice(y,1);break}if(n){ba(l,
n);n.trigger("refresh",ka,ja())}F();return n},invalidate:F,refresh:Ra,resetScale:function(){la=1},resize:function(l,n){if(pa){a.autoSize=false;if(ua!==l||ta!==n)aa(l,n)}},scale:Ka,setZoomLevel:tb,syncXY:function(){},triggerAll:Qa,removeLayer:function(l){a:{for(var n=za;n--;)if(da[n].getId()==l){l=n;break a}l=-1}if(l>=0&&l<za){ka.trigger("layerRemoved",da[l]);da.splice(l,1);F()}za=da.length},getOffset:function(){return L.init(ga,ha)},setMaxOffset:function(l,n,y,U){Ia=l;Ja=n;db=typeof y!="undefined"?
y:false;eb=typeof U!="undefined"?U:false},getViewRect:ja,updateOffset:Xa,pan:function(l,n,y,U,$){Xa(ga+l,ha+n,y,U,$)}};yb=D().getScaling();COG.observable(ka);ka.bind("invalidate",function(){F()});ka.bind("resync",function(){bb=cb=null});COG.configurable(ka,["container","captureHover","captureDrag","scalable","pannable","inertia","minZoom","maxZoom","zoom"],COG.paramTweaker(a,null,{container:function(l,n){pa=document.getElementById(n);aa()},inertia:N,captureHover:N,scalable:N,pannable:N}),true);CANI.init(function(l){ka.markers=
ba("markers",new sb({zindex:20}));canvasCaps=l.canvas;aa();if(a.autoSize)Db?window.attachEvent("onresize",A):window.addEventListener("resize",A,false)});return ka},ViewLayer:ya,ImageLayer:function(a,i){function d(j,s,A){for(s=h.length;s--;){var J=h[s],aa=J.x,ba=J.y,N=I.init(J.x,J.y,J.x+J.width,J.y+J.height);if(A&&I.intersect(j,N))(N=W.get(J.url,function(){x.changed()},q))&&A(N,aa,ba,J.width,J.height)}}function b(j){var s=++m,A=x.getParent();c&&c.run(A,j,function(J){if(s==m){h=[].concat(J);A.invalidate()}})}
i=COG.extend({imageLoadArgs:{}},i);var c=a?P.init(a,i):null,m=0,h=[],q=i.imageLoadArgs,x=COG.extend(new ya(i),{changeGenerator:function(j,s){c=P.init(j,COG.extend({},i,s));h=null;b(x.getParent().getViewRect())},clip:function(j,s,A){var J=s.x1,aa=s.y1;d(s,A,function(ba,N,k,E,S){j.rect(N-J,k-aa,E,S)})},draw:function(j,s,A){var J=s.x1,aa=s.y1;d(s,A,function(ba,N,k){j.drawImage(ba,N-J,k-aa,ba.width,ba.height)})},mask:function(j,s,A){d(s,A,function(J,aa,ba,N,k){COG.info("clearing rect @ x = "+aa+", y = "+
ba+", width = "+N+", height = "+k);j.clearRect(aa,ba,N,k)})}});x.bind("refresh",function(j,s,A){b(A)});x.bind("tap",function(j,s,A,J){j=[];var aa=J.x,ba=J.y,N,k;if(h)for(var E=h.length;E--;){N=h[E];if(k=aa>=N.x&&aa<=N.x+N.width&&ba>=N.y&&ba<=N.y+N.height)j[j.length]=N}j.length>0&&x.trigger("tapImage",j,s,A,J)});return x},ImageGenerator:function(a){a=COG.extend({relative:false,padding:2},a);a={run:function(){COG.warn("running base generator - this should be overriden")}};COG.observable(a);return a},
Drawable:Ca,Poly:Sa,Line:rb,ImageDrawable:Oa,ImageMarker:Wa,ShapeLayer:sb,transformable:z,Tiling:zb});COG.observable(G)})(T5);
