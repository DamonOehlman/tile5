COG=typeof COG!=="undefined"?COG:{};COG.extend=function(){for(var G=arguments[0]||{},Q,C=1,u=arguments.length;C<u;C++)if((Q=arguments[C])!==null)for(var e in Q){var f=Q[e];if(G!==f)if(f!==undefined)G[e]=f}return G};
(function(){var G=Object.prototype.hasOwnProperty,Q=0,C={};C.toID=function(u){return u.replace(/\s/g,"-")};C.objId=function(u){return(u?u:"obj")+Q++};C.isFunction=function(u){return toString.call(u)==="[object Function]"};C.isArray=function(u){return toString.call(u)==="[object Array]"};C.isPlainObject=function(u){if(!u||toString.call(u)!=="[object Object]"||u.nodeType||u.setInterval)return false;if(u.constructor&&!G.call(u,"constructor")&&!G.call(u.constructor.prototype,"isPrototypeOf"))return false;
var e;for(e in u);return e===undefined||G.call(u,e)};C.isEmptyObject=function(u){for(var e in u)return false;return true};C.isXmlDocument=function(u){return toString.call(u)==="[object Document]"};C.contains=function(u,e){var f=u,o=arguments,v=1;if(e&&module.isArray(e)){o=e;v=0}for(v=v;v<o;v++)f=f&&typeof foo[o[v]]!=="undefined";return f};C.formatStr=function(u){if(arguments.length<=1)return u;for(var e=arguments.length-2,f=0;f<=e;f++)u=u.replace(RegExp("\\{"+f+"\\}","gi"),arguments[f+1]);return u};
C.wordExists=function(u,e){var f="";if(e.toString)e=e.toString();for(var o=0;o<e.length;o++)f+=!/\w/.test(e[o])?"\\"+e[o]:e[o];return RegExp("(^|\\s|\\,)"+f+"(\\,|\\s|$)","i").test(u)};COG.extend(COG,C)})();
(function(){function G(f){return typeof console!=="undefined"?function(){console[f](Array.prototype.slice.call(arguments,0).join(" "));return true}:function(){return false}}var Q=window.console&&window.console.markTimeline,C=G("error"),u=G("info"),e=function(){return Q?function(f,o){console.markTimeline(f+(o?": "+((new Date).getTime()-o)+"ms":""))}:function(){}}();COG.extend(COG,{trace:e,debug:G("debug"),info:u,warn:G("warn"),error:C,exception:function(f){if(C)for(var o in f)u("ERROR DETAIL: "+o+
": "+f[o])}})})();
(function(){function G(C,u){var e=C.obsHandlers;e[u]||(e[u]=[]);return e[u]}var Q=0;COG.observable=function(C){if(!C)return null;if(!C.obsHandlers)C.obsHandlers={};if(!(C.bind||C.trigger||C.unbind)){C.bind=function(u,e){var f="callback"+Q++;G(C,u).unshift({fn:e,id:f});return f};C.triggerCustom=function(u,e){var f=G(C,u),o={cancel:false,name:u,source:this},v;e&&COG.extend(o,e);if(!f)return null;v=Array.prototype.slice.call(arguments,2);C.eventInterceptor&&C.eventInterceptor(u,o,v);v.unshift(o);for(var I=
f.length;I--&&!o.cancel;)f[I].fn.apply(this,v);return o};C.trigger=function(u){var e=Array.prototype.slice.call(arguments,1);e.splice(0,0,u,null);return C.triggerCustom.apply(this,e)};C.unbind=function(u,e){if(typeof u==="undefined")C.obsHandlers={};else for(var f=G(C,u),o=0;f&&o<f.length;o++)if(f[o].id===e){f.splice(o,1);break}return C}}return C}})();
(function(){function G(e,f){e[f]||(e[f]=function(o){return e.configure(f,o)})}function Q(e){e.gtConfId="configurable"+u++;e.gtConfig={};e.gtConfigFns=[];return e.gtConfig}var C={},u=0;COG.paramTweaker=function(e,f,o){return function(v,I){if(typeof I!=="undefined"){if(v in e)e[v]=I;o&&v in o&&o[v](v,I)}else return f&&v in f?f[v](v):e[v]}};COG.configurable=function(e,f,o,v){if(e){e.gtConfId||Q(e);var I=e.gtConfId,g=e.gtConfig,B=e.gtConfigFns;C[I]=e;B.push(o);for(o=f.length;o--;){g[f[o]]=true;v&&G(e,
f[o])}if(!e.configure)e.configure=function(x,D){if(g[x]){for(var p=B.length;p--;){var s=B[p](x,D);if(typeof s!=="undefined")return s}return C[I]}return null}}}})();
(function(){function G(e){var f=document.createElement("script"),o=false;f.src=e;f.async=true;f.onload=f.onreadystatechange=function(){if(!o&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){o=true;f.onload=f.onreadystatechange=null;f&&f.parentNode&&f.parentNode.removeChild(f)}};C||(C=document.getElementsByTagName("head")[0]);C.appendChild(f)}var Q=0,C,u=this;COG.jsonp=function(e,f,o){e+=e.indexOf("?")>=0?"&":"?";var v="json"+ ++Q;u[v]=function(I){f(I);u[v]=null;try{delete u[v]}catch(g){}};
G(e+(o?o:"callback")+"="+v);return v}})();
(function(){var G=1.70158,Q=Math.PI/2,C=1E3/60|0,u=Math.abs,e=Math.pow,f=Math.sin,o=Math.asin,v=Math.cos,I={linear:function(g,B,x,D){return x*g/D+B},backin:function(g,B,x,D){return x*(g/=D)*g*((G+1)*g-G)+B},backout:function(g,B,x,D){return x*((g=g/D-1)*g*((G+1)*g+G)+1)+B},backinout:function(g,B,x,D){return(g/=D/2)<1?x/2*g*g*(((G*=1.525)+1)*g-G)+B:x/2*((g-=2)*g*(((G*=1.525)+1)*g+G)+2)+B},bouncein:function(g,B,x,D){return x-I.bounceout(D-g,0,x,D)+B},bounceout:function(g,B,x,D){return(g/=D)<1/2.75?x*
7.5625*g*g+B:g<2/2.75?x*(7.5625*(g-=1.5/2.75)*g+0.75)+B:g<2.5/2.75?x*(7.5625*(g-=2.25/2.75)*g+0.9375)+B:x*(7.5625*(g-=2.625/2.75)*g+0.984375)+B},bounceinout:function(g,B,x,D){return g<D/2?I.bouncein(g*2,0,x,D)/2+B:I.bounceout(g*2-D,0,x,D)/2+x/2+B},cubicin:function(g,B,x,D){return x*(g/=D)*g*g+B},cubicout:function(g,B,x,D){return x*((g=g/D-1)*g*g+1)+B},cubicinout:function(g,B,x,D){if((g/=D/2)<1)return x/2*g*g*g+B;return x/2*((g-=2)*g*g+2)+B},elasticin:function(g,B,x,D,p,s){if(g==0)return B;if((g/=
D)==1)return B+x;s||(s=D*0.3);if(!p||p<u(x)){p=x;x=s/4}else x=s/TWO_PI*o(x/p);return-(p*e(2,10*(g-=1))*f((g*D-x)*TWO_PI/s))+B},elasticout:function(g,B,x,D,p,s){var y;if(g==0)return B;if((g/=D)==1)return B+x;s||(s=D*0.3);if(!p||p<u(x)){p=x;y=s/4}else y=s/TWO_PI*o(x/p);return p*e(2,-10*g)*f((g*D-y)*TWO_PI/s)+x+B},elasticinout:function(g,B,x,D,p,s){var y;if(g==0)return B;if((g/=D/2)==2)return B+x;s||(s=D*0.3*1.5);if(!p||p<u(x)){p=x;y=s/4}else y=s/TWO_PI*o(x/p);if(g<1)return-0.5*p*e(2,10*(g-=1))*f((g*
D-y)*TWO_PI/s)+B;return p*e(2,-10*(g-=1))*f((g*D-y)*TWO_PI/s)*0.5+x+B},quadin:function(g,B,x,D){return x*(g/=D)*g+B},quadout:function(g,B,x,D){return-x*(g/=D)*(g-2)+B},quadinout:function(g,B,x,D){if((g/=D/2)<1)return x/2*g*g+B;return-x/2*(--g*(g-2)-1)+B},sinein:function(g,B,x,D){return-x*v(g/D*Q)+x+B},sineout:function(g,B,x,D){return x*f(g/D*Q)+B},sineinout:function(g,B,x,D){return-x/2*(v(Math.PI*g/D)-1)+B}};COG.tweenValue=function(g,B,x,D,p){function s(T){if(ga+C<T){var W=T-y,R=x(W,g,U,D),ia=y+D<=
T;T=!ia;if(p){W=p(R,ia,W);T=typeof W!="undefined"?W&&T:T}T&&animFrame(s)}}var y=(new Date).getTime(),ga=0,U=B-g;animFrame(s);return{}};COG.easing=function(g){return I[g.replace(/[\-\_\s\.]/g,"").toLowerCase()]};COG.registerEasingType=function(g,B){I[g.replace(/[\-\_\s\.]/g,"").toLowerCase()]=B}})();
(function(){var G=/^P(\d+Y)?(\d+M)?(\d+D)?$/,Q=/^(\d+H)?(\d+M)?(\d+S)?$/,C={8601:function(e){e=e.split("T");var f=null;f=null;var o=0,v=0;G.lastIndex=-1;f=G.exec(e[0]);o+=f[3]?parseInt(f[3].slice(0,-1),10):0;Q.lastIndex=-1;f=Q.exec(e[1]);v+=f[1]?parseInt(f[1].slice(0,-1),10)*3600:0;v+=f[2]?parseInt(f[2].slice(0,-1),10)*60:0;v+=f[3]?parseInt(f[3].slice(0,-1),10):0;return new u(o,v)}},u=COG.Duration=function(e,f){return{days:e?e:0,seconds:f?f:0}};COG.addDuration=function(){for(var e=new u,f=arguments.length;f--;){e.days+=
arguments[f].days;e.seconds+=arguments[f].seconds}if(e.seconds>=86400){e.days+=~~(e.seconds/86400);e.seconds%=86400}return e};COG.formatDuration=function(e){var f,o,v="";if(e.days)v=e.days+" days ";if(e.seconds){e=e.seconds;if(e>=3600){f=~~(e/3600);e-=f*3600}if(e>=60){o=Math.round(e/60);e-=o*60}if(f)v=v+f+(f>1?" hrs ":" hr ")+(o?(o>10?o:"0"+o)+" min ":"");else if(o)v=v+o+" min";else if(e>0)v=v+(e>10?e:"0"+e)+" sec"}return v};COG.parseDuration=function(e,f){var o=f?C[f]:null;if(o)return o(e);COG.Log.warn("Could not find duration parser for specified format: "+
f);return new u}})();COG.ObjectStore=function(){var G={},Q={},C="obj_"+(new Date).getTime(),u=0,e=Object.prototype.hasOwnProperty;return{add:function(f,o){var v;o=o?o:"default";if(f&&f.constructor)if(!e.call(f,"id"))f.id=C+ ++u;v=Q[o]?Q[o]:Q[o]=[];G[f.id]=v.length;v[f.length]=f}}};var CANI={};
(function(G){var Q=[],C=0,u=false,e=G.register=function(f,o){Q.push({section:f,run:o})};G.init=function(f){function o(){if(C<Q.length){var I=Q[C++];v[I.section]||(v[I.section]={});I.run(v[I.section],o)}else{for(I in v)G[I]=v[I];u=true;f&&f(G)}}var v={};if(u&&f)f(G);else{C=0;o()}};e("canvas",function(f,o){var v=document.createElement("canvas"),I=v.getContext("2d");v.width=200;v.height=200;f.pipTransformed=function(){var g;I.save();try{I.translate(50,50);I.beginPath();I.rect(0,0,20,20);g=I.isPointInPath(10,
10)}finally{I.restore()}return g}();o()})})(CANI);
INTERACT=function(){function G(p){return function(s,y,ga){(ga?ga:p?document.body:document).addEventListener(s,y,false)}}function Q(p){return function(s,y,ga){(ga?ga:p?document.body:document).removeEventListener(s,y,false)}}function C(p,s,y){(y?y:document).attachEvent("on"+p,s)}function u(p,s,y){(y?y:document).detachEvent("on"+p,s)}function e(p,s){return{x:p?p:0,y:s?s:0,count:1}}function f(p,s){x.push(COG.extend({handler:null,checks:{},type:p},s))}function o(p){var s=0,y=0;if(p.offsetParent){do{s+=
p.offsetLeft;y+=p.offsetTop;p=p.offsetParent}while(p)}return{x:s,y:y}}function v(p,s){return{source:p,target:s.target?s.target:s.srcElement}}function I(p,s){for(var y=p.target?p.target:p.srcElement;y&&y!==s&&y.nodeName&&y.nodeName.toUpperCase()!="CANVAS";)y=y.parentNode;return y&&y===s}function g(p,s){return{x:p.x-(s?s.x:0),y:p.y-(s?s.y:0)}}function B(p){if(p.preventDefault){p.preventDefault();p.stopPropagation()}else p.cancelBubble&&p.cancelBubble()}var x=[],D=function(p,s,y){function ga(Y,aa,L,
N){var J=0,da=0,r=0;COG.tweenValue(0,Y,L,N,function(ba){r=J;J=ba});COG.tweenValue(0,aa,L,N,function(ba){U.trigger("pan",J-r,ba-da);da=ba})}y=COG.extend({binder:null,unbinder:null,observable:null},y);for(var U=y.observable,T=null,W=[],R=[],ia,na,va={bind:function(){return U.bind.apply(null,arguments)},pannable:function(Y){T=COG.extend({inertia:true},Y);return va},unbind:function(){U.unbind();for(var Y=0;Y<W.length;Y++)W[Y].unbind();return va}},Aa=0;Aa<s.length;Aa++)W.push(s[Aa](p,U,y));U.bind("pointerDown",
function(){R=[];na=ia=0});U.bind("pointerMove",function(Y,aa,L,N){if(T){R[R.length]={ticks:(new Date).getTime(),x:N.x,y:N.y};U.trigger("pan",N.x,N.y)}ia+=N.x?N.x:0;na+=N.y?N.y:0});U.bind("pointerUp",function(Y,aa,L){if(Math.abs(ia)>20||Math.abs(na)>20){if(T){L=R.length;var N,J;aa=0;for(J=R.length;--J>1&&aa<50;)aa+=R[J].ticks-R[J-1].ticks;if(L-J>1){Y=R[L-1].x-R[J].x;N=R[L-1].y-R[J].y;J=Math.sqrt(Y*Y+N*N)|0;if(J>15){Y=R[L-1].x-R[0].x;N=R[L-1].y-R[0].y;J=Math.sqrt(Y*Y+N*N)|0;L=Math.asin(N/J);aa=J*500/
aa|0;aa=aa>300?300:aa;ga(Math.cos(Y>0?L:Math.PI-L)*aa,Math.sin(L)*aa,COG.easing("sine.out"),500)}}}}else U.trigger("tap",aa,L)});return va};f("pointer",{handler:function(p,s,y){function ga(r){if(I(r,p))if(Aa=R(r)){p.style.cursor="move";B(r);J=r.pageX?r.pageX:r.screenX;da=r.pageY?r.pageY:r.screenY;Y=e(J,da);aa=o(p);s.triggerCustom("pointerDown",v("mouse",r),Y,g(Y,aa))}}function U(r){L=r.pageX?r.pageX:r.screenX;N=r.pageY?r.pageY:r.screenY;if(I(r,p))ia(r,Aa?"pointerMove":"pointerHover")}function T(r){if(Aa&&
R(r)){Aa=false;if(I(r,p)){p.style.cursor="default";ia(r,"pointerUp")}}}function W(r){if(I(r,p)){var ba;r=r||window.event;if(r.detail)ba=r.axis===2?-r.detail*na:0;else{ba=r.wheelDeltaY?r.wheelDeltaY:r.wheelDelta;if(window.opera)ba=-ba}if(ba!==0){var ha=e(L,N);s.triggerCustom("zoom",v("mouse",r),ha,g(ha,o(p)),ba/va,"wheel");B(r);r.returnValue=false}}}function R(r){r=r||window.event;return(r.which||r.button)==1}function ia(r,ba,ha,sa,Ea){ha=typeof ha!="undefined"?ha:L;sa=typeof sa!="undefined"?sa:N;
var H=ha-J,V=sa-da,O=e(ha,sa);aa||(aa=o(p));s.triggerCustom(ba,v("mouse",r),O,g(O,aa),e(H,V));if(typeof Ea=="undefined"||Ea){J=ha;da=sa}}y=COG.extend({},y);var na=120,va=na*8,Aa=false,Y,aa,L,N,J,da;y.binder("mousedown",ga,false);y.binder("mousemove",U,false);y.binder("mouseup",T,false);y.binder("dblclick",function(r){COG.info("captured double click");if(I(r,p)){var ba=e(r.pageX?r.pageX:r.screenX,r.pageY?r.pageY:r.screenY);COG.info("captured double click + target matched");s.triggerCustom("doubleTap",
v("mouse",r),ba,g(ba,o(p)))}},false);y.binder("mousewheel",W,document);y.binder("DOMMouseScroll",W,document);return{unbind:function(){y.unbinder("mousedown",ga,false);y.unbinder("mousemove",U,false);y.unbinder("mouseup",T,false);y.unbinder("mousewheel",W,document);y.unbinder("DOMMouseScroll",W,document)}}},checks:{touch:false}});f("pointer",{handler:function(p,s,y){function ga(H){if(H.count<2)return 0;var V=H.x-H.next.x;H=H.y-H.next.y;return~~Math.sqrt(V*V+H*H)}function U(H,V,O){V=V?V:0;O=O?O:0;for(var la=
{x:H.x-V,y:H.y-O,id:H.id,count:H.count},Ba=la;H.next;){H=H.next;Ba=Ba.next={x:H.x-V,y:H.y-O,id:H.id}}return la}function T(H,V){var O=H[V?V:"touches"],la,Ba;if(O.length===0)return null;Ba=la={x:O[0].pageX,y:O[0].pageY,id:O[0].identifier,count:O.length};for(var wa=1,Ca=O.length;wa<Ca;wa++)Ba=Ba.next={x:O[wa].pageX,y:O[wa].pageY,id:O[wa].identifier};return la}function W(H){if(I(H,p)){N=o(p);var V=T(H,"changedTouches"),O=U(V,N.x,N.y);if(!da){J=Y;s.triggerCustom("pointerDown",v("touch",H),V,O)}sa&&s.triggerCustom("pointerDownMulti",
v("touch",H),V,O);da=T(H);if(da.count>1)ba=ga(da);Ea=1;ha=U(da)}}function R(H){if(I(H,p)){H.preventDefault();r=T(H);if(J==Y)J=Math.abs(da.x-r.x)>va||Math.abs(da.y-r.y)>va?Aa:Y;if(J!=Y){J=r.count>1?L:aa;if(J==L)if(da.count===1){da=U(r);ba=ga(da)}else{var V=ga(r);if(Math.abs(ba-V)<na)J=aa;else{var O;O=r.x;var la=r.next.x,Ba=r.y,wa=r.next.y,Ca=Ba<wa?Ba:wa;O={x:(O<la?O:la)+(Math.abs(O-la)>>1),y:Ca+(Math.abs(Ba-wa)>>1)};V=V/ba;la=V-Ea;s.triggerCustom("zoom",v("touch",H),O,g(O,N),la,"pinch");Ea=V}}J==aa&&
s.triggerCustom("pointerMove",v("touch",H),r,U(r,N.x,N.y),e(r.x-ha.x,r.y-ha.y));sa&&s.triggerCustom("pointerMoveMulti",v("touch",H),r,U(r,N.x,N.y))}ha=U(r)}}function ia(H){if(I(H,p)){var V=T(H,"changedTouches"),O=U(V,N.x,N.y);r=T(H);if(!r){s.triggerCustom("pointerUp",v("touch",H),V,O);da=null}sa&&s.triggerCustom("pointerUpMulti",v("touch",H),V,O)}}y=COG.extend({detailed:false,inertia:false},y);var na=20,va=7,Aa=0,Y=1,aa=2,L=3,N,J,da,r,ba,ha,sa=y.detailed,Ea=1;y.binder("touchstart",W,false);y.binder("touchmove",
R,false);y.binder("touchend",ia,false);COG.info("initialized touch handler");return{unbind:function(){y.unbinder("touchstart",W,false);y.unbinder("touchmove",R,false);y.unbinder("touchend",ia,false)}}},checks:{touch:true}});return{register:f,watch:function(p,s,y){s=COG.extend({bindToBody:false,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},s);capabilities=COG.extend({touch:"ontouchstart"in window},y);if(!s.observable){COG.info("creating observable");s.observable=COG.observable({});
globalOpts=s}s.binder=s.isIE?C:G(s.bindToBody);s.unbinder=s.isIE?u:Q(s.bindToBody);y=s.types;for(var ga=capabilities,U=[],T=x.length;T--;){var W=x[T],R=!y||y.indexOf(W.type)>=0,ia=true;for(var na in W.checks){var va=W.checks[na];COG.info("checking "+na+" capability. require: "+va+", capability = "+ga[na]);ia=ia&&va===ga[na]}if(R&&ia)U[U.length]=W.handler}return new D(p,U,s)}}}();var T5={};
(function(G){function Q(){return(new Date).getTime()}function C(){for(;Ea.length>0;){var a=Ea.shift();document.location=a}sa=0}function u(a){for(var i=true,d=H.length;d--;)i=i&&a!=H[d];return i}function e(a,i){var d=[];for(var b in i)b&&d.push(b+"="+escape(i[b]));return"tile5://"+a+"/"+(d.length>0?"?"+d.join("&"):"")}function f(a,i){u(a)&&COG.info("would push url: "+e(a,i))}function o(a,i){if(u(a)){Ea.push(e(a,i));sa||(sa=setTimeout(C,100))}}function v(a){return function(i,d,b){(b?b:a?document.body:
document).addEventListener(i,d,false)}}function I(a){return function(i,d,b){(b?b:a?document.body:document).removeEventListener(i,d,false)}}function g(a,i,d){(d?d:document).attachEvent("on"+a,i)}function B(a,i,d){(d?d:document).detachEvent("on"+a,i)}function x(){r={base:{name:"Unknown",bindEvent:v(),unbindEvent:I(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:f,targetFps:null},ie:{name:"MSIE",regex:/msie/i,
bindEvent:g,unbindEvent:B,requireFastDraw:false,targetFps:25},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:o,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:o},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:o},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:v(true),unbindEvent:I(true),supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},
bridgeNotify:o},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:o}};ba=[r.froyo,r.android,r.ipod,r.iphone,r.ipad,r.ie]}function D(){r||x();if(!ha){COG.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var a=0;a<ba.length;a++){var i=ba[a];if(i.regex&&i.regex.test(navigator.userAgent)){ha=COG.extend({},r.base,i);COG.info("PLATFORM DETECTED AS: "+ha.name);break}}if(!ha){COG.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
ha=r.base}COG.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return ha}function p(){for(var a=0,i=arguments.length;i--;){var d=Ba[arguments[i].toUpperCase()];if(d)a|=d}return a}function s(a,i){var d,b;if(i&&i.width>0){if(!a.imageOffset)a.imageOffset=L.init(-i.width>>1,-i.height>>1);if(!a.bounds){d=a.xy.x+a.imageOffset.x;b=a.xy.y+a.imageOffset.y;a.bounds=J.init(d,b,d+i.width,b+i.height)}}}function y(a){function i(){a.transformed=c!==1||b%ga!==0||m!==0||h!==0}var d=1E3/60|0,b=0,c=1,m=
0,h=0;COG.extend(a,{animate:function(q,z,k,t,A,K){var Z=(new Date).getTime(),$=a[q],M=z.length&&k.length&&z.length==k.length?z.length:0,l=Array(M),E=Array(M),P=COG.easing(t?t:"sine.out"),F=function(oa){if(oa-0>d){var Qa=oa-Z;oa=Z+A<=oa;for(var Ka=M;Ka--;)E[Ka]=P(Qa,z[Ka],l[Ka],A);$.apply(a,E);a.invalidate.call(a);if(oa){$.apply(a,k);a.invalidate.call(a);K&&K()}else animFrame(F)}};if($&&$.apply&&M>0){A=A?A:1E3;for(q=M;q--;)l[q]=k[q]-z[q];animFrame(F)}},rotate:function(q){b=q;i()},scale:function(q){c=
q;i()},translate:function(q,z){m=q;h=z;i()},transform:function(q,z,k){q.save();q.translate(a.xy.x-z+m,a.xy.y-k+h);b!==0&&q.rotate(b);c!==1&&q.scale(c,c)}})}window.animFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){setTimeout(function(){a((new Date).getTime())},1E3/60)}}();var ga=Math.PI*2,U=Math.abs,T=Math.min,W=Math.max,R=Math.pow,ia=Math.sqrt,na=
Math.log,va=Math.round,Aa=Math.sin,Y=Math.asin,aa=Math.cos,L=function(){function a(b,c){return d(b.x-c.x,b.y-c.y)}function i(b,c){if(!c)c=b.length;if(c<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var m={edges:Array(c-1),accrued:Array(c-1),total:0},h=0;h<c-1;h++){var q=a(b[h],b[h+1]);m.edges[h]=ia(q.x*q.x+q.y*q.y);m.accrued[h]=m.total+m.edges[h];m.total+=m.edges[h]}return m}function d(b,c){return{x:b?b:0,y:c?c:0}}return{VECTOR_SIMPLIFICATION:3,SIMPLIFICATION_MIN_VECTORS:25,
add:function(){for(var b=0,c=0,m=arguments.length;m--;){b+=arguments[m].x;c+=arguments[m].y}return d(b,c)},absSize:function(b){return W(U(b.x),U(b.y))},copy:function(b){return b?d(b.x,b.y):null},diff:a,distance:function(b,c){return i(b,c).total},edges:i,equals:function(b,c){return b.x===c.x&&b.y===c.y},extendBy:function(b,c,m){var h=aa(c)*m;c=Aa(c)*m;return d(b.x-h,b.y-c)},floor:function(b){for(var c=Array(b.length),m=b.length;m--;)c[m]=d(~~b[m].x,~~b[m].y);return c},getRect:function(b){for(var c,
m,h,q,z=b.length;z--;){var k=b[z];c=typeof c==="undefined"||k.x<c?k.x:c;m=typeof m==="undefined"||k.y<m?k.y:m;h=typeof h==="undefined"||k.x>h?k.x:h;q=typeof q==="undefined"||k.y>q?k.y:q}return J.init(c,m,h,q)},init:d,invert:function(b){return d(-b.x,-b.y)},min:function(b,c){return d(b.x<c.x?b.x:c.x,b.y<c.y?b.y:c.y)},max:function(b,c){return d(b.x>c.x?b.x:c.x,b.y>c.y?b.y:c.y)},offset:function(b,c,m){return d(b.x+c,b.y+(m?m:c))},scale:function(b,c){return d(b.x/c|0,b.y/c|0)},simplify:function(b,c){if(!b)return null;
c=c?c:L.VECTOR_SIMPLIFICATION;for(var m=[],h=null,q=b.length;q--;){var z=b[q];if(include=!h||q===0||U(z.x-h.x)+U(z.y-h.y)>c){m.unshift(z);h=z}}return m},theta:function(b,c,m){m=Y((b.y-c.y)/m);return b.x>c.x?m:Math.PI-m},toString:function(b){return b?b.x+", "+b.y:""}}}(),N=function(){return{dotProduct:function(a,i){return a.x*i.x+a.y*i.y}}}(),J=function(){function a(d){return i(d.x1,d.y1,d.x2,d.y2)}function i(d,b,c,m){d=d?d:0;b=b?b:0;c=typeof c!=="undefined"?c:d;m=typeof m!=="undefined "?m:m;return{x1:d,
y1:b,x2:c,y2:m,width:c-d,height:m-b}}return{center:function(d){return L.init(d.x1+(d.width>>1),d.y1+(d.height>>1))},copy:a,diagonalSize:function(d){return ia(d.width*d.width+d.height*d.height)},fromCenter:function(d,b,c,m){c=c>>1;m=m>>1;return i(d-c,b-m,d+c,b+m)},init:i,intersect:function(d,b){var c=W(d.x1,b.x1),m=W(d.y1,b.y1),h=T(d.x2,b.x2),q=T(d.y2,b.y2);c=i(c,m,h,q);return c.width>0&&c.height>0?c:null},toString:function(d){return d?"["+d.x1+", "+d.y1+", "+d.x2+", "+d.y2+"]":""},union:function(d,
b){if(d.width===0||d.height===0)return a(b);else if(b.width===0||b.height===0)return a(d);else{var c=T(d.x1,b.x1),m=T(d.y1,b.y1),h=W(d.x2,b.x2),q=W(d.y2,b.y2);c=i(c,m,h,q);return c.width>0&&c.height>0?c:null}}}}(),da=function(){return{getAspectRatio:function(a){return a.height!==0?a.width/a.height:1},getCenter:function(a){return L.init(a.width>>1,a.height>>1)},getSize:function(a){return ia(R(a.width,2)+R(a.height,2))},init:function(a,i){a=a?a:0;return{width:a,height:i?i:a}}}}();Hits=function(){return{diffHits:function(a,
i){var d=[],b={},c;for(c=i.length;c--;)b[i[c].target.id]=true;for(c=a.length;c--;)b[a[c].target.id]||(d[d.length]=a[c]);return d},init:function(a,i,d,b){return{type:a,x:b.x|0,y:b.y|0,elements:[],absXY:i,relXY:d}},initHit:function(a,i,d){return d=COG.extend({type:a,target:i,drag:false},d)},triggerEvent:function(a,i,d,b){i.triggerCustom(a.type+(d?d:"Hit"),{hitType:a.type},b?b:a.elements,a.absXY,a.relXY,L.init(a.x,a.y))}}}();var r=null,ba=[],ha=null,sa=0,Ea=[],H=["view.wake","tile.loaded"],V=function(){function a(){var l=
D().maxImageLoads;if(!l||t.length<l){var E=k.shift();l=T5.ticks();if(E){t[t.length]=E;E.image.onload=d;E.image.src=E.url;E.requested=l}if(l-Z>m){E=false;for(var P=0,F=D();P<t.length;)if(l-t[P].requested>M.loadTimeout*1E3){t.splice(P,1);E=true}else P++;E&&a();if(F&&F.imageCacheMaxSize){K=A.length*M.avgImageSize/F.imageCacheMaxSize;K>=1&&i()}Z=l}}}function i(){$=true;try{var l=A.length>>1;if(l>0){A.sort(function(P,F){return P.created-F.created});for(var E=l;E--;)delete h[A[E].url];A.splice(0,l)}}finally{$=
false}M.trigger("cacheCleared")}function d(){var l=q[this.id],E;if(l&&l.image.complete&&l.image.width>0){l.loaded=true;l.hitCount=1;for(E=t.length;E--;)if(t[E].image.src==this.src){t.splice(E,1);break}if(l.background||l.postProcess||l.drawBackground||l.customDraw)if(l.image){globalImageData=l;E=c(l.realSize?l.realSize.width:l.image.width,l.realSize?l.realSize.height:l.image.height);var P=E.getContext("2d"),F=l.offset?l.offset:T5.XY.init();l.background&&P.drawImage(l.background,0,0);l.drawBackground&&
l.drawBackground(P);l.customDraw?l.customDraw(P,l):P.drawImage(l.image,F.x,F.y);l.postProcess&&l.postProcess(P,l);l.image=E}for(E=l.callbacks.length;E--;)l.callbacks[E]&&l.callbacks[E](this,false);l.callbacks=[];A[A.length]={url:this.src,created:l.requested};delete q[this.id];a()}}function b(l,E,P){var F=h[l];if(F){F.hitCount++;F.image.complete&&F.image.width>0&&E?E(F.image,true):F.callbacks.push(E)}else{F=COG.extend({url:l,image:new Image,loaded:false,created:T5.ticks(),requested:null,hitCount:0,
callbacks:[E]},P);F.image.id="resourceLoaderImage"+z++;h[l]=F;q[F.image.id]=F;k[k.length]=F;a()}return F}function c(l,E){var P=document.createElement("canvas");COG.info("creating new canvas");P.width=l?l:0;P.height=E?E:0;if(typeof FlashCanvas!="undefined"){document.body.appendChild(P);FlashCanvas.initElement(P)}return P}var m=1E4,h={},q={},z=0,k=[],t=[],A=[],K=0,Z=0,$=false,M={avgImageSize:25,loadTimeout:10,cancelLoad:function(){var l;for(l=t.length;l--;)delete h[t[l].url];t=[];for(l=k.length;l--;)delete h[k[l].url];
k=[]},get:function(l,E,P){var F=null,oa=null;$||(F=h[l]);if((oa=F?F.image:null)&&(oa.getContext||oa.complete&&oa.width>0))return oa;else E&&b(l,E,P);return null},load:b,newCanvas:c,reset:function(){h={}},stats:function(){return{imageLoadingCount:t.length,queuedImageCount:k.length,imageCacheFullness:K}}};COG.observable(M);return M}(),O=function(){var a={};return{init:function(i,d){var b=a[i];if(!b)throw Error("Unable to locate requested generator: "+i);return new b(d)},register:function(i,d){a[i]=
d},Template:function(){}}}(),la=function(){function a(h,q){c[h]=d(q);return h}function i(h){for(var q in h)a(q,h[q])}function d(h){function q(A){var K=h[A];typeof K!=="undefined"&&k.push(function(Z){Z[A]=K})}function z(){k=[];for(var A in h)q(A)}h=COG.extend({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},h);var k=[],t={applyToContext:function(A){for(var K=k.length;K--;)k[K](A)},
update:function(A,K){h[A]=K;z()}};z();return t}var b={},c={},m={apply:function(h,q){var z=c[q]?c[q]:c.basic,k;if(h&&h.canvas){k=b[h.canvas.id];b[h.canvas.id]=q}z.applyToContext(h);return k},define:a,defineMany:i,get:function(h){return c[h]},init:d,load:function(h){COG.jsonp(h,function(q){i(q)})}};i({basic:{lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"},waypoints:{lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"},waypointsHover:{lineWidth:4,strokeStyle:"#f00",fillStyle:"#FFF"}});
return m}(),Ba={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,ZOOM:16,FREEZE:128},wa=function(a){a=COG.extend({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:p("ACTIVE","ANIMATING","PAN","ZOOM"),style:null,minXY:null,maxXY:null},a);var i=null,d=false,b=false,c=a.id,m=p("ACTIVE"),h=a.validStates,q=0,z=0,k=COG.extend({addToView:function(t){t.setLayer(c,k)},shouldDraw:function(t){return(t&h)!==0},clip:null,cycle:function(){},draw:function(){},hitGuess:null,remove:function(){k.trigger("remove",k)},
changed:function(){b=true;i&&i.invalidate()},hitTest:null,getId:function(){return c},setId:function(t){c=t},getParent:function(){return i},setParent:function(t){d=(i=t)?i.fastDraw&&displayState!==m:false;k.trigger("parentChange",i)}},a);COG.observable(k);k.bind("drawComplete",function(t,A){b=false;q=A.x1;z=A.y1});k.bind("resync",function(t,A){k.minXY&&A.syncXY(k.minXY);k.maxXY&&A.syncXY(k.maxXY)});return k},Ca=function(a){a=COG.extend({style:null,xy:null,size:null,fill:false,draggable:false,observable:true,
properties:{},type:"shape",transformable:false},a);COG.extend(this,a);this.id=COG.objId(this.type);this.bounds=null;this.observable&&COG.observable(this);this.transformable&&y(this);this.transformed=false};Ca.prototype={constructor:Ca,drag:null,draw:function(a){this.fill&&a.fill();a.stroke()},invalidate:function(){var a=this.layer?this.layer.getParent():null;a&&a.invalidate()},prepPath:function(){},resync:function(a){if(this.xy){a.syncXY([this.xy]);this.size&&this.updateBounds(J.fromCenter(this.xy.x,
this.xy.y,this.size,this.size))}},setTransformable:function(a){a&&!this.transformable&&y(this);this.transformable=a},updateBounds:function(a,i){this.bounds=a;if(i)this.xy=J.center(this.bounds)}};var Ra=function(a,i){i=COG.extend({simplify:false},i);var d=false,b=i.simplify;p("ZOOM");var c=[];i.type=i.fill?"polygon":"line";Ca.call(this,i);COG.extend(this,{animatePath:function(){},prepPath:function(m,h,q){if(d){var z=true;m.beginPath();for(var k=c.length;k--;){var t=c[k].x-h,A=c[k].y-q;if(z){m.moveTo(t,
A);z=false}else m.lineTo(t,A)}}return d},resync:function(m){var h,q,z,k,t;m.syncXY(a);c=L.floor(b?L.simplify(a):a);for(var A=c.length;A--;){m=c[A].x;h=c[A].y;k=typeof k=="undefined"||m<k?m:k;t=typeof t=="undefined"||h<t?h:t;q=typeof q=="undefined"||m>q?m:q;z=typeof z=="undefined"||h>z?h:z}this.updateBounds(J.init(k,t,q,z),true)}});d=a&&a.length>=2};Ra.prototype=COG.extend(Ca.prototype,{constructor:Ra});var rb=function(a,i){i.fill=false;Ra.call(this,a,i)};rb.prototype=new Ra;var Na=function(a){function i(z){if(this.imageUrl=
z)h=V.get(this.imageUrl,function(k){var t=q.layer?q.layer.getParent():null;h=k;t&&t.invalidate()})}a=COG.extend({image:null,imageUrl:null,imageOffset:null},a);var d=null,b=Ca.prototype.updateBounds,c,m,h=a.image;Ca.call(this,a);var q=COG.extend(this,{changeImage:i,drag:function(z,k,t,A){d||(d=L.init(z.startX-this.xy.x,z.startY-this.xy.y));this.xy.x=k-d.x;this.xy.y=t-d.y;if(A){d=null;if(this.layer)(z=this.layer.getParent())&&z.syncXY([this.xy],true);this.trigger("dragDrop")}return true},draw:function(z){z.drawImage(h,
c,m)},prepPath:function(z,k,t){var A=h&&h.width>0;if(A){s(this,h);c=this.xy.x+this.imageOffset.x-k;m=this.xy.y+this.imageOffset.y-t;z.beginPath();z.rect(c,m,h.width,h.height)}return A},updateBounds:function(z,k){b.call(this,z,k);s(this,h)}});h||i(this.imageUrl)};Na.prototype=new Ca;Na.prototype.constructor=Na;var Va=function(a){a=COG.extend({imageAnchor:null},a);if(a.imageAnchor)a.imageOffset=L.invert(a.imageAnchor);Na.call(this,a)};Va.prototype=new Na;Va.prototype.constructor=Va;var sb=function(a){function i(h){for(var q=
b.length;q--;)b[q].resync(h);b.sort(function(z,k){var t=k.xy.y-z.xy.y;return t!=0?t:k.xy.x-z.xy.y});m.changed()}function d(h,q){i(q)}a=COG.extend({zindex:10},a);var b=[],c=CANI.canvas.pipTransformed,m=COG.extend(new wa(a),{add:function(h){if(h){h.layer=m;var q=m.getParent();if(q){h.resync(m.getParent());q.invalidate()}b[b.length]=h}},clear:function(){b=[]},draw:function(h,q,z,k,t,A){k=q.x1;t=q.y1;var K=A?c?A.x-k:A.relXY.x:0,Z=A?c?A.y-t:A.relXY.y:0,$=q.width;q=q.height;for(var M=b.length;M--;){var l=
b[M],E=l.style,P,F=l.transformed;if(F){l.transform(h,k,t);if(c){K-=l.xy.x;Z-=l.xy.y}}if(l.prepPath(h,F?l.xy.x:k,F?l.xy.y:t,$,q,z)){if(A&&h.isPointInPath(K,Z)){A.elements.push(Hits.initHit(l.type,l,{drag:l.draggable?l.drag:null}));P=A.type+"Style";E=l[P]||m[P]||E}E=E?la.apply(h,E):null;l.draw(h,k,t,$,q,z);E&&la.apply(h,E)}F&&h.restore()}},find:function(){return[].concat(b)},hitGuess:function(h,q){for(var z=false,k=b.length;!z&&k--;){var t=b[k].bounds;z=z||t&&h>=t.x1&&h<=t.x2&&q>=t.y1&&q<=t.y2}return z}});
m.bind("parentChange",d);m.bind("resync",d);return m},zb=function(){return{tileSize:256,init:function(a,i,d,b,c){return COG.extend({x:a,y:i,width:d,height:b},c)}}}();COG.extend(G,{ex:COG.extend,ticks:Q,getConfig:D,userMessage:function(a,i,d){G.trigger("userMessage",a,i,d)},XY:L,XYRect:J,Dimensions:da,Vector:N,Hits:Hits,Images:V,Generator:O,tween:COG.tween,tweenValue:COG.tweenValue,easing:COG.easing,Tween:COG.Tween,Style:la,viewState:p,View:function(a){function i(n,j,w){Fa||Wa(ea-j,fa-w)}function d(n,
j,w,S){Ka(T(W(ka+R(2,S)-1,0.5),2))}function b(){var n=na(ka)/Math.LN2|0;if(n!==0){ka=R(2,n);tb(Sa+n,Xa,Ya)}F()}function c(n){n||(n=L.init(La,Ma));eb=L.init(ea,fa);Ta=L.offset(n,ea,fa);Xa=Ta.x;Ya=Ta.y}function m(n,j){var w=1/ka;return L.init(Oa.x1+n*w,Oa.y1+j*w)}function h(n,j,w){Pa("doubleTap",j,w,m(w.x,w.y));a.scalable&&Ka(2,w,a.zoomEasing,null,a.zoomDuration)}function q(n,j,w){Fa=null;P("down",j,w)}function z(n,j,w){P("hover",j,w)}function k(n,j,w){l(j,w,false)}function t(n,j,w){l(j,w,true)}function A(){clearTimeout(ub);
ub=setTimeout(Z,250)}function K(n,j,w){P("tap",j,w);Pa("tap",j,w,m(w.x,w.y,true))}function Z(n,j){var w;Za=typeof FlashCanvas!=="undefined";COG.info("is flash = "+Za);if(pa){if(a.autoSize&&pa.parentNode){n=pa.parentNode.offsetWidth;j=pa.parentNode.offsetHeight}try{if(!pa.id)pa.id=a.id+"_canvas";ra=pa.getContext("2d")}catch(S){COG.exception(S);throw Error("Could not initialise canvas on specified view element");}if(n&&j&&(ta!==j||ua!==n)){fb=true;ua=n;ta=j;La=ua>>1;Ma=ta>>1;ja.trigger("resize",ua,
ta);for(w=xa;w--;)ca[w].trigger("resize",ua,ta)}for(w=xa;w--;)ca[w].trigger("contextChanged",ra);F();M()}}function $(n,j){j.setId(n);j.added=Q();j.bind("remove",function(){ja.removeLayer(n)});j.trigger("contextChanged",ra);j.setParent(ja);ca.push(j);ca.sort(function(w,S){var X=S.zindex-w.zindex;if(X===0)X=S.added-w.added;return X});xa=ca.length;return j}function M(){ya&&ya.unbind();ya=INTERACT.watch(pa);a.pannable&&ya.pannable().bind("pan",i);if(a.scalable){ya.bind("zoom",d);ya.bind("doubleTap",h)}ya.bind("pointerDown",
q);ya.bind("pointerMove",k);ya.bind("pointerUp",t);a.captureHover&&ya.bind("pointerHover",z);ya.bind("tap",K)}function l(n,j,w){if(Fa){n=m(j.x,j.y);Fa.drag.call(Fa.target,Fa,n.x,n.y,w)&&F();if(w)Fa=null}}function E(n){var j,w,S=false;if(gb|Za){w=ea!==hb||fa!==ib;Ha=vb|(ka!==1?wb:0)|(w?jb:0)|(kb?lb:0);mb=(j=(Ha&(wb|jb))!==0)&&(Ha&lb)===0;if(fb&&pa){Za&&FlashCanvas.initElement(pa);pa.width=ua;pa.height=ta;pa.style.width=ua+"px";pa.style.height=ta+"px";fb=false}$a=oa();for(w=xa;w--;){Ha|=ca[w].animated?
lb:0;ca[w].cycle(n,$a,Ha);S=ca[w].clip||S}w=Ha;var X=$a;S=Ab&&S&&!j;var ma;J.center(X);j=0;var za;if(ka!==1){za=1/ka;Xa=Ta.x+(ea-eb.x);Ya=Ta.y+(fa-eb.y);za=X?J.fromCenter(Xa>>0,Ya>>0,X.width*za>>0,X.height*za>>0):void 0}else za=J.copy(X);Oa=za;S||ra.clearRect(0,0,ua,ta);Oa.scaleFactor=ka;ra.save();try{ka!==1&&ra.scale(ka,ka);ab=bb=null;if(S){ra.beginPath();for(j=xa;j--;)ca[j].clip&&ca[j].clip(ra,Oa,w,ja,n);ra.closePath();ra.clip()}ra.globalCompositeOperation="source-over";for(j=xa;j--;){ma=ca[j];
if(ma.shouldDraw(Ha,$a)){var qa=ma.style,Ga=qa?la.apply(ra,qa):null;ma.draw(ra,Oa,w,ja,n,Da);Ga&&la.apply(ra,Ga)}}}finally{ra.restore()}gb=0;Pa("drawComplete",X,n);if(Da){ma=Da?Da.elements:[];if(Ua&&Ua.type==="hover"){qa=Hits.diffHits(Ua.elements,ma);qa.length>0&&Hits.triggerEvent(Ua,ja,"Out",qa)}if(ma.length>0){Ga=Da.x;w=Da.y;for(qa=ma.length;qa--;){X=ma[qa];S=Ga;j=w;if(za=X&&X.drag&&(!X.canDrag||X.canDrag(X,S,j))){Fa=X;Fa.startX=S;Fa.startY=j}if(za)break}Hits.triggerEvent(Da,ja)}Ua=ma.length>0?
COG.extend({},Da):null;Da=null}n-xb>Bb&&Qa();Cb=n;hb=ea;ib=fa;animFrame(E)}else nb=false}function P(n,j,w){Da=Hits.init(n,j,w,m(w.x,w.y,true));for(n=xa;n--;)ob=ob||(ca[n].hitGuess?ca[n].hitGuess(Da.x,Da.y,Ha,ja):false);ob&&F()}function F(){gb+=1;if(!nb){nb=true;animFrame(E)}}function oa(){return J.init(ea,fa,ea+ua,fa+ta)}function Qa(){if(Ia||Ja){var n=cb?ea+La:ea,j=db?fa+Ma:fa;if(Ia&&Ia>ua)if(n+ua>Ia)ea=cb?n-Ia>0?ea-Ia:ea:Ia-ua;else if(n<0)ea=cb?ea+Ia:0;if(Ja&&Ja>ta)if(j+ta>Ja)fa=db?j-Ja>0?fa-Ja:
fa:Ja-ta;else if(j<0)fa=db?fa+Ja:0}xb=(new Date).getTime();Pa("refresh",ja,oa());F()}function Ka(n,j,w,S,X){if(w)COG.tweenValue(ka,n,w,X,function(ma,za){ka=ma;if(za){var qa=va(na(ka)/Math.LN2);ka=R(2,qa);S&&S()}c(j);b()});else{ka=n;c(j);b()}return ja}function tb(n,j,w){n=W(a.minZoom,T(a.maxZoom,n));if(n!==Sa){var S=R(2,n-Sa),X=La/S|0,ma=Ma/S|0;Sa=n;Wa(((j?j:ea+La)-X)*S,((w?w:fa+Ma)-ma)*S);hb=ea;ib=fa;Pa("zoomLevelChange",n);ka=1;Qa()}}function Pa(){for(var n=ja.trigger.apply(null,arguments).cancel,
j=ca.length;j--;)n=ca[j].trigger.apply(null,arguments).cancel||n;return!n}function Wa(n,j,w,S,X){function ma(){za+=1;if(za>=2){kb=false;X&&X()}}var za=0,qa=bb?L.offset(bb,-La,-Ma):null,Ga=ab?L.offset(ab,-La,-Ma):null;if(qa){n=n<qa.x?qa.x:n;j=j<qa.y?qa.y:j}if(Ga){n=n>Ga.x?Ga.x:n;j=j>Ga.y?Ga.y:j}if(w){if((Ha&jb)===0){COG.tweenValue(ea,n,w,S,function(pb,qb){ea=pb|0;(qb?ma:F)();return!mb});COG.tweenValue(fa,j,w,S,function(pb,qb){fa=pb|0;(qb?ma:F)();return!mb});kb=true}}else{ea=n|0;fa=j|0;F();X&&X()}}
a=COG.extend({id:COG.objId("view"),container:"",captureHover:true,captureDrag:false,fastDraw:false,inertia:true,minRefresh:1E3,pannable:false,clipping:true,scalable:false,panAnimationEasing:COG.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,autoSize:true,tapExtent:10,guides:false,turbo:false,fps:25,minZoom:1,maxZoom:1,zoomEasing:COG.easing("quad.out"),zoomDuration:300,zoomLevel:1},a);var ca=[],xa=0,pa=document.getElementById(a.container),Fa=null,ra=null,Db=typeof window.attachEvent!=
"undefined",Za,ob=false,Bb=a.minRefresh,ea=0,fa=0,hb=0,ib=0,Ia=null,Ja=null,cb=false,db=false,Ab=a.clipping,$a=null,nb=false,Oa,yb=1,La=0,Ma=0,Da=null,eb=null,Ta=null,mb=false,bb=null,ab=null,xb=0,Ua=null,ub=0,ka=1,Cb=0,fb=false,ya=null,kb=false,ta,ua,gb=0,Xa,Ya,Sa=a.zoomLevel,vb=p("ACTIVE"),jb=p("PAN"),wb=p("ZOOM"),lb=p("ANIMATING"),Ha=vb,ja={id:a.id,deviceScaling:yb,fastDraw:a.fastDraw||D().requireFastDraw,detach:function(){ya&&ya.unbind()},eachLayer:function(n){for(var j=xa;j--;)n(ca[j])},getDimensions:function(){return da.init(ua,
ta)},getLayer:function(n){for(var j=0;j<xa;j++)if(ca[j].getId()==n)return ca[j];return null},getZoomLevel:function(){return Sa},setLayer:function(n,j){for(var w=0;w<xa;w++)if(ca[w].getId()===n){ca.splice(w,1);break}if(j){$(n,j);j.trigger("refresh",ja,oa())}F();return j},invalidate:F,refresh:Qa,resetScale:function(){ka=1},resize:function(n,j){if(pa){a.autoSize=false;if(ua!==n||ta!==j)Z(n,j)}},scale:Ka,setZoomLevel:tb,syncXY:function(){},triggerAll:Pa,removeLayer:function(n){a:{for(var j=xa;j--;)if(ca[j].getId()==
n){n=j;break a}n=-1}if(n>=0&&n<xa){ja.trigger("layerRemoved",ca[n]);ca.splice(n,1);F()}xa=ca.length},getOffset:function(){return L.init(ea,fa)},setMaxOffset:function(n,j,w,S){Ia=n;Ja=j;cb=typeof w!="undefined"?w:false;db=typeof S!="undefined"?S:false},getViewRect:oa,updateOffset:Wa,pan:function(n,j,w,S,X){Wa(ea+n,fa+j,w,S,X)}};yb=D().getScaling();COG.observable(ja);ja.bind("invalidate",function(){F()});ja.bind("resync",function(){ab=bb=null});COG.configurable(ja,["container","captureHover","captureDrag",
"scalable","pannable","inertia","minZoom","maxZoom","zoom"],COG.paramTweaker(a,null,{container:function(n,j){pa=document.getElementById(j);Z()},inertia:M,captureHover:M,scalable:M,pannable:M}),true);CANI.init(function(n){ja.markers=$("markers",new sb({zindex:20}));canvasCaps=n.canvas;Z();if(a.autoSize)Db?window.attachEvent("onresize",A):window.addEventListener("resize",A,false)});return ja},ViewLayer:wa,ImageLayer:function(a,i){function d(k,t,A){for(t=h.length;t--;){var K=h[t],Z=K.x,$=K.y,M=J.init(K.x,
K.y,K.x+K.width,K.y+K.height);if(A&&J.intersect(k,M))(M=V.get(K.url,function(){z.changed()},q))&&A(M,Z,$,K.width,K.height)}}function b(k){var t=++m,A=z.getParent();c&&c.run(A,k,function(K){if(t==m){h=[].concat(K);A.invalidate()}})}i=COG.extend({imageLoadArgs:{}},i);var c=a?O.init(a,i):null,m=0,h=[],q=i.imageLoadArgs,z=COG.extend(new wa(i),{changeGenerator:function(k,t){c=O.init(k,COG.extend({},i,t));h=null;b(z.getParent().getViewRect())},clip:function(k,t,A){var K=t.x1,Z=t.y1;d(t,A,function($,M,l,
E,P){k.rect(M-K,l-Z,E,P)})},draw:function(k,t,A){var K=t.x1,Z=t.y1;d(t,A,function($,M,l){k.drawImage($,M-K,l-Z,$.width,$.height)})},mask:function(k,t,A){d(t,A,function(K,Z,$,M,l){COG.info("clearing rect @ x = "+Z+", y = "+$+", width = "+M+", height = "+l);k.clearRect(Z,$,M,l)})}});z.bind("refresh",function(k,t,A){b(A)});z.bind("tap",function(k,t,A,K){k=[];var Z=K.x,$=K.y,M,l;if(h)for(var E=h.length;E--;){M=h[E];if(l=Z>=M.x&&Z<=M.x+M.width&&$>=M.y&&$<=M.y+M.height)k[k.length]=M}k.length>0&&z.trigger("tapImage",
k,t,A,K)});return z},ImageGenerator:function(a){a=COG.extend({relative:false,padding:2},a);a={run:function(){COG.warn("running base generator - this should be overriden")}};COG.observable(a);return a},Drawable:Ca,Poly:Ra,Line:rb,ImageDrawable:Na,ImageMarker:Va,ShapeLayer:sb,transformable:y,Tiling:zb});COG.observable(G)})(T5);
