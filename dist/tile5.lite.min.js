if(!this.JSON)this.JSON={};
(function(){function V(M){return M<10?"0"+M:M}function ka(M){la.lastIndex=0;return la.test(M)?'"'+M.replace(la,function(e){var n=pa[e];return typeof n==="string"?n:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+M+'"'}function ca(M,e){var n,t,u,y,x=G,s,r=e[M];if(r&&typeof r==="object"&&typeof r.toJSON==="function")r=r.toJSON(M);if(typeof Y==="function")r=Y.call(e,M,r);switch(typeof r){case "string":return ka(r);case "number":return isFinite(r)?String(r):"null";case "boolean":case "null":return String(r);
case "object":if(!r)return"null";G+=da;s=[];if(Object.prototype.toString.apply(r)==="[object Array]"){y=r.length;for(n=0;n<y;n+=1)s[n]=ca(n,r)||"null";u=s.length===0?"[]":G?"[\n"+G+s.join(",\n"+G)+"\n"+x+"]":"["+s.join(",")+"]";G=x;return u}if(Y&&typeof Y==="object"){y=Y.length;for(n=0;n<y;n+=1){t=Y[n];if(typeof t==="string")if(u=ca(t,r))s.push(ka(t)+(G?": ":":")+u)}}else for(t in r)if(Object.hasOwnProperty.call(r,t))if(u=ca(t,r))s.push(ka(t)+(G?": ":":")+u);u=s.length===0?"{}":G?"{\n"+G+s.join(",\n"+
G)+"\n"+x+"}":"{"+s.join(",")+"}";G=x;return u}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+V(this.getUTCMonth()+1)+"-"+V(this.getUTCDate())+"T"+V(this.getUTCHours())+":"+V(this.getUTCMinutes())+":"+V(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var aa=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
la=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,G,da,pa={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},Y;if(typeof JSON.stringify!=="function")JSON.stringify=function(M,e,n){var t;da=G="";if(typeof n==="number")for(t=0;t<n;t+=1)da+=" ";else if(typeof n==="string")da=n;if((Y=e)&&typeof e!=="function"&&(typeof e!=="object"||typeof e.length!=="number"))throw Error("JSON.stringify");return ca("",
{"":M})};if(typeof JSON.parse!=="function")JSON.parse=function(M,e){function n(u,y){var x,s,r=u[y];if(r&&typeof r==="object")for(x in r)if(Object.hasOwnProperty.call(r,x)){s=n(r,x);if(s!==undefined)r[x]=s;else delete r[x]}return e.call(u,y,r)}var t;M=String(M);aa.lastIndex=0;if(aa.test(M))M=M.replace(aa,function(u){return"\\u"+("0000"+u.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(M.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){t=eval("("+M+")");return typeof e==="function"?n({"":t},""):t}throw new SyntaxError("JSON.parse");}})();
COG=function(){function V(e,n){var t=e.gtObsHandlers;t[n]||(t[n]=[]);return t[n]}function ka(e,n){e[n]||(e[n]=function(t){return e.configure(n,t)})}function ca(e){e.gtConfId=objId("configurable");e.gtConfig={};e.gtConfigFns=[];return e.gtConfig}var aa=Object.prototype.hasOwnProperty,la=0,G={toID:function(e){return e.replace(/\s/g,"-")},objId:function(e){return(e?e:"obj")+la++}};G.Log=function(){function e(x,s){var r,P=s&&s.length>0?s[0]:"";for(r=1;s&&r<s.length;r++)P+=" "+(t&&pa(s[r])?JSON.stringify(s[r]):
s[r]);typeof console!=="undefined"&&console[x](P);for(r=0;r<n.length;r++)n[r].call(y,P,x)}var n=[],t=typeof JSON!=="undefined",u=window.console&&window.console.markTimeline,y={getTraceTicks:function(){return u?(new Date).getTime():null},trace:function(x,s){if(u)console.markTimeline(x+(s?": "+(y.getTraceTicks()-s)+"ms":""))},debug:function(){e("debug",arguments)},info:function(){e("info",arguments)},warn:function(){e("warn",arguments)},error:function(){e("error",arguments)},exception:function(x){y.error(arguments);
for(var s in x)y.info("ERROR DETAIL: "+s+": "+x[s])},watch:function(x,s){try{s()}catch(r){y.exception(r,x)}},throwError:function(x){y.error(x);throw Error(x);},requestUpdates:function(x){n.push(x)}};return y}();G.contains=function(e,n){var t=e,u=arguments,y=1;if(n&&module.isArray(n)){u=n;y=0}for(y=y;y<u;y++)t=t&&typeof foo[u[y]]!=="undefined";return t};var da=G.extend=function(){var e=arguments[0]||{},n=1,t=arguments.length,u=false,y,x,s,r;if(typeof e==="boolean"){u=e;e=arguments[1]||{};n=2}if(typeof e!==
"object"&&!module.isFunction(e))e={};if(t===n){e=this;--n}for(;n<t;n++)if((y=arguments[n])!=null)for(x in y){s=e[x];r=y[x];if(e!==r)if(u&&r&&(module.isPlainObject(r)||module.isArray(r))){s=s&&(module.isPlainObject(s)||module.isArray(s))?s:module.isArray(r)?[]:{};e[x]=module.extend(u,s,r)}else if(r!==undefined)e[x]=r}return e};G.formatStr=function(e){if(arguments.length<=1)return e;for(var n=arguments.length-2,t=0;t<=n;t++)e=e.replace(RegExp("\\{"+t+"\\}","gi"),arguments[t+1]);return e};G.wordExists=
function(e,n){var t="";if(n.toString)n=n.toString();for(var u=0;u<n.length;u++)t+=!/\w/.test(n[u])?"\\"+n[u]:n[u];return RegExp("(^|\\s|\\,)"+t+"(\\,|\\s|$)","i").test(e)};G.isFunction=function(e){return toString.call(e)==="[object Function]"};G.isArray=function(e){return toString.call(e)==="[object Array]"};var pa=G.isPlainObject=function(e){if(!e||toString.call(e)!=="[object Object]"||e.nodeType||e.setInterval)return false;if(e.constructor&&!aa.call(e,"constructor")&&!aa.call(e.constructor.prototype,
"isPrototypeOf"))return false;var n;for(n in e);return n===undefined||aa.call(e,n)};G.isEmptyObject=function(e){for(var n in e)return false;return true};G.isXmlDocument=function(e){return toString.call(e)==="[object Document]"};G.Loopage=function(){function e(J){return da({id:x++,frequency:0,after:0,single:false,lastTick:0,execute:function(){}},J)}function n(J){r.push(J);t()}function t(){P&&clearTimeout(P);P=setTimeout(u,0);ea=true}function u(){for(var J,R=(new Date).getTime(),Z=s.length;r.length>
0;){var ma=r.shift();for(J=Z;J--;)if(s[J].id===ma){s.splice(J,1);break}ea=true;Z=s.length}if(ea){S=y;for(J=Z;J--;)S=s[J].frequency<S?s[J].frequency:S}for(J=Z;J--;){ma=R-s[J].lastTick;if(s[J].lastTick===0||ma>=s[J].frequency){s[J].execute(R,s[J]);s[J].lastTick=R;s[J].single&&s[J].trigger("complete")}}P=Z?setTimeout(u,S):0}var y=6E4,x=0,s=[],r=[],P=0,S=y,ea=true;return{join:function(J){var R=new e(J);if(R.after>0)R.lastTick=(new Date).getTime()+R.after;Y(R);R.bind("complete",function(){n(R.id)});s.unshift(R);
t();return R},leave:n}}();var Y=G.observable=function(e){if(e){if(!e.gtObsHandlers)e.gtObsHandlers={};if(!(e.bind||e.trigger||e.unbind)){e.bind=function(n,t){var u=objId("callback");V(e,n).unshift({fn:t,id:u});return u};e.trigger=function(n){var t=V(e,n),u={cancel:false,tickCount:(new Date).getTime()},y;if(!t)return null;y=Array.prototype.slice.call(arguments,1);y.unshift(u);for(var x=t.length;x--&&!u.cancel;)t[x].fn.apply(self,y);return u};e.unbind=function(n,t){for(var u=V(e,n),y=0;u&&y<u.length;y++)if(u[y].id===
t){u.splice(y,1);break}return e}}}},M={};G.paramTweaker=function(e,n,t){return function(u,y){if(typeof y!=="undefined"){if(u in e)e[u]=y;t&&u in t&&t[u](u,y)}else return n&&u in n?n[u](u):e[u]}};G.configurable=function(e,n,t,u){if(e){e.gtConfId||ca(e);var y=e.gtConfId,x=e.gtConfig,s=e.gtConfigFns;M[y]=e;s.push(t);for(t=n.length;t--;){x[n[t]]=true;u&&ka(e,n[t])}if(!e.configure)e.configure=function(r,P){if(x[r]){for(var S=s.length;S--;){var ea=s[S](r,P);if(typeof ea!=="undefined")return ea}return M[y]}return null}}};
(function(){function e(y){var x=document.createElement("script"),s=false;x.src=y;x.async=true;x.onload=x.onreadystatechange=function(){if(!s&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){s=true;x.onload=x.onreadystatechange=null;x&&x.parentNode&&x.parentNode.removeChild(x)}};t||(t=document.getElementsByTagName("head")[0]);t.appendChild(x)}var n=0,t,u=this;G.jsonp=function(y,x,s){y+=y.indexOf("?")>=0?"&":"?";var r="json"+ ++n;u[r]=function(P){x(P);u[r]=null;try{delete u[r]}catch(S){}};
e(y+(s?s:"callback")+"="+r);return r}})();return G}();
T5=function(){function V(){return(new Date).getTime()}function ka(){for(;Da.length>0;){var a=Da.shift();document.location=a}Ea=0}function ca(a){for(var b=true,c=Wa.length;c--;)b=b&&a!=Wa[c];return b}function aa(a,b){var c=[];for(var d in b)d&&c.push(d+"="+escape(b[d]));return"tile5://"+a+"/"+(c.length>0?"?"+c.join("&"):"")}function la(a,b){ca(a)&&COG.Log.info("would push url: "+aa(a,b))}function G(a,b){if(ca(a)){Da.push(aa(a,b));Ea||(Ea=setTimeout(ka,100))}}function da(a){return function(b,c,d){(d?
d:a?document.body:document).addEventListener(b,c,false)}}function pa(a){return function(b,c,d){(d?d:a?document.body:document).removeEventListener(b,c,false)}}function Y(a,b,c){(c?c:document).attachEvent("on"+a,b)}function M(a,b,c){(c?c:document).detachEvent("on"+a,b)}function e(){ba={base:{name:"Unknown",bindEvent:da(),unbindEvent:pa(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:la,targetFps:null},
ie:{name:"MSIE",regex:/msie/i,bindEvent:Y,unbindEvent:M,requireFastDraw:false,targetFps:25},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:G,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:G},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:G},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:da(true),unbindEvent:pa(true),supportsTouch:true,getScaling:function(){return 1/
window.devicePixelRatio},bridgeNotify:G},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:G}};Fa=[ba.froyo,ba.android,ba.ipod,ba.iphone,ba.ipad,ba.ie]}function n(){ba||e();if(!qa){COG.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var a=0;a<Fa.length;a++){var b=Fa[a];if(b.regex&&b.regex.test(navigator.userAgent)){qa=T5.ex({},ba.base,b);COG.Log.info("PLATFORM DETECTED AS: "+qa.name);break}}if(!qa){COG.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
qa=ba.base}COG.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return qa}function t(a){if(ra)return T.length;ra=true;try{for(var b=0;b<T.length;)if(T[b].isComplete()){T[b].triggerComplete(false);T.splice(b,1)}else{T[b].update(a);b++}}finally{ra=false}T.length===0&&wa.trigger("complete");return T.length}function u(a){if(!ra){ra=true;try{for(var b=0;b<T.length;)if(!a||a(T[b])){T[b].triggerComplete(true);T.splice(b,1)}else b++}finally{ra=false}}}function y(){if(!wa){wa=COG.Loopage.join({execute:t,
frequency:20});wa.bind("complete",function(){wa=null})}}function x(a,b,c,d,g){a=new Ga({startValue:a,endValue:b,tweenFn:c,complete:d,duration:g});T.push(a);return a}function s(a,b,c,d,g,f){a=new Ga({target:a,property:b,endValue:c,tweenFn:d,duration:f,complete:g});T.push(a);return a}function r(a){return xa[a.replace(/[\-\_\s\.]/g,"").toLowerCase()]}function P(){for(var a=0,b=arguments.length;b--;){var c=jb[arguments[b].toUpperCase()];if(c)a|=c}return a}var S=Math.PI*2,ea=Math.PI/2,J=Math.abs,R=Math.pow,
Z=Math.sin,ma=Math.asin,Xa=Math.cos,ya=function(){return{dotProduct:function(a,b){return a.x*b.x+a.y*b.y}}}(),kb=function(){return{getAspectRatio:function(a){return a.height!==0?a.width/a.height:1},getCenter:function(a){return XY.init(a.width/2,a.height/2)},getSize:function(a){return Math.sqrt(Math.pow(a.width,2)+Math.pow(a.height,2))},init:function(a,b){a=a?a:0;return{width:a,height:b?b:a}}}}(),ba=null,Fa=[],qa=null,Ea=0,Da=[],Wa=["view.wake","tile.loaded"],za=function(){function a(){if(!A){var q=
T5.getConfig().maxImageLoads;A=COG.Loopage.join({execute:function(F,w){if(!q||i.length<q){var z=j.shift();if(z){i[i.length]=z;z.image.onload=c;z.image.src=z.url;z.requested=T5.ticks()}else w.trigger("complete")}},frequency:10});A.bind("complete",function(){A=null})}}function b(){H=true;try{var q=m.length/2>>0;if(q>0){m.sort(function(w,z){return w.created-z.created});for(var F=q;F--;)delete f[m[F].url];m.splice(0,q)}}finally{H=false}B.trigger("cacheCleared")}function c(){var q=k[this.id],F;if(q&&q.image.complete&&
q.image.width>0){q.loaded=true;q.hitCount=1;for(F=i.length;F--;)if(i[F].image.src==this.src){i.splice(F,1);break}if(q.background||q.postProcess||q.drawBackground||q.customDraw)if(q.image){globalImageData=q;F=g(q.realSize?q.realSize.width:q.image.width,q.realSize?q.realSize.height:q.image.height);var w=F.getContext("2d"),z=q.offset?q.offset:T5.XY.init();q.background&&w.drawImage(q.background,0,0);q.drawBackground&&q.drawBackground(w);q.customDraw?q.customDraw(w,q):w.drawImage(q.image,z.x,z.y);q.postProcess&&
q.postProcess(w,q);q.image=F}for(F=q.callbacks.length;F--;)q.callbacks[F]&&q.callbacks[F](this,false);q.callbacks=[];m[m.length]={url:this.src,created:q.requested};delete k[this.id];a()}}function d(q,F,w){var z=f[q];if(z){z.hitCount++;z.image.complete&&z.image.width>0&&F?F(z.image,true):z.callbacks.push(F)}else{z=T5.ex({url:q,image:new Image,loaded:false,created:T5.ticks(),requested:null,hitCount:0,callbacks:[F]},w);z.image.id="resourceLoaderImage"+o++;f[q]=z;k[z.image.id]=z;j[j.length]=z;a()}return z}
function g(q,F){var w=document.createElement("canvas");w.width=q?q:0;w.height=F?F:0;if(typeof FlashCanvas!=="undefined"){w.id="tmpCanvas"+h++;w.style.cssText="position: absolute; top: -"+(F-1)+"px; left: -"+(q-1)+"px;";document.body.appendChild(w);FlashCanvas.initElement(w)}typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(w);return w}var f={},h=0,k={},o=0,j=[],i=[],m=[],v=0,A=null,H=false,B={avgImageSize:25,loadTimeout:10,cancelLoad:function(){i=[]},get:function(q,F,w){var z=
null,E=null;H||(z=f[q]);if((E=z?z.image:null)&&(E.getContext||E.complete&&E.width>0))return E;else F&&d(q,F,w);return null},load:d,newCanvas:g,reset:function(){f={}},stats:function(){return{imageLoadingCount:i.length,queuedImageCount:j.length,imageCacheFullness:v}}};COG.observable(B);COG.Loopage.join({execute:function(q){for(var F=false,w=0,z=T5.getConfig();w<i.length;)if(q-i[w].requested>B.loadTimeout*1E3){i.splice(w,1);F=true}else w++;F&&a();if(z&&z.imageCacheMaxSize){v=m.length*B.avgImageSize/
z.imageCacheMaxSize;v>=1&&b()}},frequency:2E4});return B}(),Ha=function(){var a={};return{init:function(b,c){var d=a[b];if(!d)throw Error("Unable to locate requested generator: "+b);return new d(c)},register:function(b,c){a[b]=c},Template:function(){}}}(),T=[],wa=null,ra=false,ga=1.70158,xa={linear:function(a,b,c,d){return c*a/d+b},backin:function(a,b,c,d){return c*(a/=d)*a*((ga+1)*a-ga)+b},backout:function(a,b,c,d){return c*((a=a/d-1)*a*((ga+1)*a+ga)+1)+b},backinout:function(a,b,c,d){return(a/=d/
2)<1?c/2*a*a*(((ga*=1.525)+1)*a-ga)+b:c/2*((a-=2)*a*(((ga*=1.525)+1)*a+ga)+2)+b},bouncein:function(a,b,c,d){return c-xa.bounceout(d-a,0,c,d)+b},bounceout:function(a,b,c,d){return(a/=d)<1/2.75?c*7.5625*a*a+b:a<2/2.75?c*(7.5625*(a-=1.5/2.75)*a+0.75)+b:a<2.5/2.75?c*(7.5625*(a-=2.25/2.75)*a+0.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+0.984375)+b},bounceinout:function(a,b,c,d){return a<d/2?xa.bouncein(a*2,0,c,d)/2+b:xa.bounceout(a*2-d,0,c,d)/2+c/2+b},cubicin:function(a,b,c,d){return c*(a/=d)*a*a+b},cubicout:function(a,
b,c,d){return c*((a=a/d-1)*a*a+1)+b},cubicinout:function(a,b,c,d){if((a/=d/2)<1)return c/2*a*a*a+b;return c/2*((a-=2)*a*a+2)+b},elasticin:function(a,b,c,d,g,f){if(a==0)return b;if((a/=d)==1)return b+c;f||(f=d*0.3);if(!g||g<J(c)){g=c;c=f/4}else c=f/S*ma(c/g);return-(g*R(2,10*(a-=1))*Z((a*d-c)*S/f))+b},elasticout:function(a,b,c,d,g,f){var h;if(a==0)return b;if((a/=d)==1)return b+c;f||(f=d*0.3);if(!g||g<J(c)){g=c;h=f/4}else h=f/S*ma(c/g);return g*R(2,-10*a)*Z((a*d-h)*S/f)+c+b},elasticinout:function(a,
b,c,d,g,f){var h;if(a==0)return b;if((a/=d/2)==2)return b+c;f||(f=d*0.3*1.5);if(!g||g<J(c)){g=c;h=f/4}else h=f/S*ma(c/g);if(a<1)return-0.5*g*R(2,10*(a-=1))*Z((a*d-h)*S/f)+b;return g*R(2,-10*(a-=1))*Z((a*d-h)*S/f)*0.5+c+b},quadin:function(a,b,c,d){return c*(a/=d)*a+b},quadout:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},quadinout:function(a,b,c,d){if((a/=d/2)<1)return c/2*a*a+b;return-c/2*(--a*(a-2)-1)+b},sinein:function(a,b,c,d){return-c*Xa(a/d*ea)+c+b},sineout:function(a,b,c,d){return c*Z(a/d*ea)+
b},sineinout:function(a,b,c,d){return-c/2*(Xa(Math.PI*a/d)-1)+b}},Ga=function(a){a=T5.ex({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:r("sine.out"),complete:null,cancelOnInteract:false},a);var b=V(),c=[],d=false,g=0,f=0,h={cancelOnInteract:a.cancelOnInteract,isComplete:function(){return d},triggerComplete:function(k){a.complete&&a.complete(k)},update:function(k){try{var o=a.tweenFn(k-b,g,f,a.duration);if(a.target)a.target[a.property]=o;for(var j=c.length;j--;)c[j](o,
void 0);if(d=b+a.duration<=k){if(a.target)a.target[a.property]=a.tweenFn(a.duration,g,f,a.duration);for(var i=c.length;i--;)c[i](o,true)}}catch(m){COG.Log.exception(m)}},requestUpdates:function(k){c.push(k)}};g=a.target&&a.property&&a.target[a.property]?a.target[a.property]:a.startValue;if(typeof a.endValue!=="undefined")f=a.endValue-g;if(f==0)d=true;y();return h},sa=function(){function a(h,k){g[h]=c(k);return h}function b(h){for(var k in h)a(k,h[k])}function c(h){function k(m){var v=h[m];typeof v!==
"undefined"&&j.push(function(A){A[m]=v})}function o(){j=[];for(var m in h)k(m)}h=T5.ex({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},h);var j=[],i={applyToContext:function(m){for(var v=j.length;v--;)j[v](m)},update:function(m,v){h[m]=v;o()}};o();return i}var d={},g={},f={apply:function(h,k){var o=g[k]?g[k]:g.basic,j;if(h&&h.canvas){j=d[h.canvas.id];d[h.canvas.id]=k}o.applyToContext(h);
return j},define:a,defineMany:b,get:function(h){return g[h]},init:c,load:function(h){COG.jsonp(h,function(k){b(k)})}};b({basic:{lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"},waypoints:{lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"}});return f}(),jb={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,ZOOM:16,FREEZE:128},ta=function(a){a=T5.ex({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:P("ACTIVE","ANIMATING","PAN","ZOOM"),style:null,minXY:null,maxXY:null},a);var b=null,c=
false,d=false,g=a.supportFastDraw,f=a.id,h=P("ACTIVE"),k=a.validStates,o=0,j=0,i=T5.ex({addToView:function(m){m.setLayer(f,i)},shouldDraw:function(m,v,A){return(d||A||o!==v.x1||j!==v.y1)&&(m&k)!==0&&(c?g:true)},clip:null,cycle:function(){},draw:function(){},remove:function(){i.trigger("remove",i)},changed:function(m){d=true;i.trigger("changed",i);b&&b.trigger("invalidate",m)},getId:function(){return f},setId:function(m){f=m},getParent:function(){return b},setParent:function(m){c=(b=m)?b.fastDraw&&
displayState!==h:false;i.trigger("parentChange",b)}},a);COG.observable(i);i.bind("drawComplete",function(m,v){d=false;o=v.x1;j=v.y1});i.bind("resync",function(m,v){if(v.syncXY){i.minXY&&v.syncXY(i.minXY);i.maxXY&&v.syncXY(i.maxXY)}});return i},Ya=function(a){function b(o,j,i,m){d=o;g=j;f=i;h=m}a=T5.ex({xy:XY.init(),offset:true,tweenIn:null,animationSpeed:null,isNew:true},a);var c=false,d=0,g=0,f=0,h=0,k=T5.ex(a,{isAnimating:function(){return c},draw:function(o,j,i,m,v){if(k.isNew&&a.tweenIn){var A=
k.xy.y;k.xy.y=j.y1-20;c=true;s(k.xy,"y",A,a.tweenIn,function(){k.xy.y=A>>0;c=false},a.animationSpeed?a.animationSpeed:250+Math.random()*500)}k.drawMarker(o,j,k.xy.x,k.xy.y,i,m,v);k.isNew=false},drawMarker:function(o,j,i,m){o.beginPath();o.arc(i,m,4,0,Math.PI*2,false);o.fill();b(i-4,m-4,8,8)},hitTest:function(o,j){return o>=d&&o<=d+f&&j>=g&&j<=g+h},updateBounds:b});COG.observable(k);return k},Za=function(a){function b(){g.changed();g.trigger("markerUpdate",d)}function c(){var f=g.getParent();if(f&&
f.syncXY)for(var h=d.length;h--;)f.syncXY([d[h].xy])}a=T5.ex({zindex:100,style:"basic"},a);var d=[],g=T5.ex(new ta(a),{draw:function(f,h,k,o){for(var j=d.length;j--;)d[j].draw(f,h,k,g,o)},add:function(f){if(f&&typeof f.length!=="undefined")for(var h=f.length;h--;){if(f[h])d[d.length]=f[h]}else if(f)d[d.length]=f;b()},clear:function(f){if(f)for(var h=0;h<d.length;h++)f(d[h])&&d.splice(h,1);else d=[];b()},each:function(f){if(f)for(var h=d.length;h--;)f(d[h])},find:function(f){for(var h=[],k=d.length;k--;)if(!f||
f(d[k]))h[h.length]=d[k];return h}});g.bind("tap",function(f,h,k){for(var o=[],j=k.x,i=k.y,m=d.length;m--;)if(d[m].hitTest(j,i))o[o.length]=d[m];if(o.length>0)f.cancel=g.trigger("markerTap",h,k,o).cancel});g.bind("parentChange",c);g.bind("resync",c);g.bind("changed",c);return g},$a=function(a){function b(k,o,j){k.fillStyle="#FFFFFF";k.strokeStyle="#222222";k.beginPath();k.arc(j.x,j.y,4,0,Math.PI*2,false);k.stroke();k.fill()}a=T5.ex({path:[],id:COG.objId("pathAni"),easing:r("sine.inout"),validStates:P("ACTIVE",
"PAN","ZOOM"),drawIndicator:null,duration:2E3},a);var c=XY.edges(a.path),d,g=null,f=0;x(0,c.total,a.easing,function(){h.remove()},a.duration).requestUpdates(function(k,o){f=k;o&&h.remove()});var h=T5.ex(new ta(a),{cycle:function(){for(var k=0;k<c.accrued.length&&c.accrued[k]<f;)k++;g=null;if(k<a.path.length-1){var o=f-(k>0?c.accrued[k-1]:0),j=a.path[k];d=XY.theta(j,a.path[k+1],c.edges[k]);g=XY.extendBy(j,d,o)}return g},draw:function(k,o){if(g)(a.drawIndicator?a.drawIndicator:b)(k,o,XY.init(g.x,g.y),
d)}});return h},ab=function(a){a=T5.ex({style:null,properties:{}},a);return T5.ex(a,{rect:null,draw:function(){},resync:function(){}})},lb=function(){return{tileSize:256,init:function(a,b,c,d,g){return T5.ex({x:a,y:b,width:c,height:d},g)}}}();ya={ex:COG.extend,ticks:V,getConfig:n,userMessage:function(a,b,c){module.trigger("userMessage",a,b,c)},XY:XY,XYRect:XYRect,Vector:function(a,b){COG.Log.warn("The T5.Vector class has been deprecated, please use T5.XY.init instead");return XY.init(a,b)},V:COG.extend(XY,
ya),D:kb,Images:za,Generator:Ha,tween:s,tweenValue:x,easing:r,registerEasingType:function(a,b){xa[a.replace(/[\-\_\s\.]/g,"").toLowerCase()]=b},Tween:Ga,Style:sa,viewState:P,View:function(a){function b(l,p,C,I){fa=Aa;B();if(I&&a.inertia)o(W+p,X+C,a.panAnimationEasing,a.panAnimationDuration);else I||o(W+p,X+C)}function c(){fa=Ia;ha=false;B()}function d(l,p,C){Ba||(Ba=[].concat(C));l=bb(Ba);cb(l);p=db(l);var I=bb(C);C=cb(I);I=db(I);h(C);O=l&&p!==0?I/p:1;f()}function g(l,p,C){N.zoom(D.getCenter($),C)}
function f(l){v();var p=XY.init(Ja-(ua.width/(O*2)>>0),Ka-(ua.height/(O*2)>>0)),C=Math.log(O)/Math.LN2>>0;if(O!==1)fa=La;COG.Log.info("scale factor = "+O+", exp = "+C);if(C!==0){O=Math.pow(2,C);if(!N.trigger("scale",O,p).cancel){COG.Log.info("ok to scale");for(l=w.length;l--;)w[l].trigger("scale",O,p);O=1;Ba=null;fa=Ia;l=true}}B(l)}function h(l){Ma=XY.init(W,X);Na=XY.offset(l,W,X)}function k(){clearTimeout(eb);eb=setTimeout(j,50)}function o(l,p,C,I,K){function Q(){U+=1;if(U>=2){c(0,0);K&&K()}}var U=
0,ia=na?XY.offset(na,-Oa,-Pa):null,ja=oa?XY.offset(oa,-Oa,-Pa):null;if(ia){l=l<ia.x?ia.x:l;p=p<ia.y?ia.y:p}if(ja){l=l>ja.x?ja.x:l;p=p>ja.y?ja.y:p}if(C){if(!ha){l=x(W,l,C,Q,I);p=x(X,p,C,Q,I);l.cancelOnInteract=true;l.requestUpdates(function(Qa){W=Qa>>0;ha=true;B()});p.cancelOnInteract=true;p.requestUpdates(function(Qa){X=Qa>>0;ha=true;B()})}}else{W=l>>0;X=p>>0}}function j(){var l;if(E){COG.Touch.release(E);if(a.autoSize&&E.parentNode){l=E.parentNode.getBoundingClientRect();if(l.height!==0&&l.width!==
0){E.height=l.height;E.width=l.width}}try{if(!E.id)E.id=a.id+"_canvas";L=E.getContext("2d")}catch(p){COG.Log.exception(p);throw Error("Could not initialise canvas on specified view element");}fb=COG.Touch.capture(E,{observable:N});if($.height!==E.height||$.width!==E.width){$=D.init(E.width,E.height);Oa=$.width/2>>0;Pa=$.height/2>>0;N.trigger("resize",E.width,E.height);for(l=z;l--;)w[l].trigger("resize",E.width,E.height)}a.inertia&&fb.inertiaEnable(a.panAnimationDuration,$);for(l=z;l--;)w[l].trigger("contextChanged",
L);B()}}function i(l,p){p.setId(l);p.added=V();p.bind("remove",function(){N.removeLayer(l)});p.trigger("contextChanged",L);p.setParent(N);w.push(p);w.sort(function(C,I){var K=I.zindex-C.zindex;if(K===0)K=I.added-C.added;return K});z=w.length;return p}function m(){F("idle",N);Ra=true;va=0}function v(l){var p=1/O;Ja=Na.x+(W-Ma.x);Ka=Na.y+(X-Ma.y);if(l)return XYRect.fromCenter(Ja>>0,Ka>>0,l.width*p>>0,l.height*p>>0)}function A(l,p,C,I){var K=XYRect.copy(p),Q,U=0;C&&L.clearRect(0,0,E.width,E.height);
L.save();try{L.globalCompositeOperation="source-over";if(O!==1){K=v(K);L.scale(O,O)}L.translate(-K.x1,-K.y1);oa=na=null;L.beginPath();Sa=false;for(U=z;U--;)if(w[U].clip){w[U].clip(L,K,l,N,C,I);Sa=true}L.closePath();Sa&&L.clip();for(U=z;U--;){Q=w[U];var ia=Q.style,ja=ia?sa.apply(L,ia):null;if(Q.minXY)na=na?XY.min(na,Q.minXY):XY.copy(Q.minXY);if(Q.maxXY)oa=oa?XY.max(oa,Q.maxXY):XY.copy(Q.maxXY);Q.draw(L,K,l,N,C,I);ja&&sa.apply(L,ja)}}finally{L.restore()}if(mb){L.globalCompositeOperation="source-over";
L.strokeStyle="#f00";L.beginPath();L.moveTo(E.width/2,0);L.lineTo(E.width/2,E.height);L.moveTo(0,E.height/2);L.lineTo(E.width,E.height/2);L.stroke()}F("drawComplete",p,I);COG.Log.trace("draw complete",I)}function H(l,p){var C=false,I=Ta?Ta:ha?Aa:fa,K=!ha&&(I===La||I===Aa),Q=Ua||I===Aa||I===La||T.length>0;ua=q();if(K){u(function(U){return U.cancelOnInteract});Ra=false;if(va!==0){clearTimeout(va);va=0}}for(K=z;K--;){if(w[K].animated)fa|=gb;w[K].cycle(l,ua,fa,Q);C=w[K].shouldDraw(fa,ua,Q)||C}Q=Q||(fa&
gb)!==0;if(C=C||Q||O!==1&&O!==hb){A(I,ua,Q,l);hb=O;Ua=false}if(!C&&Va===0&&!nb){if(!Ra&&va===0)va=setTimeout(m,500);p.trigger("complete")}Va=0;COG.Log.trace("Completed draw cycle",l)}function B(l){Ua=l?true:false;Va+=1;if(!Ca){Ca=COG.Loopage.join({execute:H,frequency:ob});Ca.bind("complete",function(){Ca=null})}}function q(){return XYRect.init(W,X,W+$.width,X+$.height)}function F(){for(var l=N.trigger.apply(null,arguments).cancel,p=w.length;p--;)l=w[p].trigger.apply(null,arguments).cancel||l;return!l}
a=T5.ex({id:COG.objId("view"),container:"",fastDraw:false,inertia:true,pannable:true,scalable:true,panAnimationEasing:r("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:true,tapExtent:10,mask:true,guides:false,fps:25},a);var w=[],z=0,E=document.getElementById(a.container),L=null,W=0,X=0,Sa=false,ua=null,Ca=null,mb=a.guides,ib=1,$=D.init(),Va=0,Oa=0,Pa=0,Ma=null,Na=null,Ra=false,ha=false,va=0,na=null,oa=null,pb=0,Ta=null,Ua=false,eb=0,Ba=null,O=1,hb=
0,nb=typeof FlashCanvas!=="undefined",ob=~~(1E3/a.fps),fb=null,Ja,Ka,Ia=P("ACTIVE"),Aa=P("PAN"),La=P("ZOOM"),gb=P("ANIMATING"),fa=Ia,bb=XY.getRect,db=XYRect.diagonalSize,cb=XYRect.center,N={id:a.id,deviceScaling:ib,fastDraw:a.fastDraw||n().requireFastDraw,getDimensions:function(){return $},getLayer:function(l){for(var p=0;p<z;p++)if(w[p].getId()==l)return w[p];return null},setLayer:function(l,p){for(var C=0;C<z;C++)if(w[C].getId()===l){w.splice(C,1);break}p&&i(l,p);B();return p},eachLayer:function(l){for(var p=
z;p--;)l(w[p])},invalidate:B,resize:function(l,p){if(E){a.autoSize=false;E.width=l;E.height=p;j();N.trigger("resize",E.width,E.height)}},scale:function(l,p,C,I){function K(){O=Math.pow(2,Math.round(Math.log(O)/Math.LN2));I&&I();f(true)}var Q=O;p||(p=D.getCenter($));h(p);if(C)x(0,l-Q,C,K,1E3).requestUpdates(function(U){O=Q+U;f()});else{O=l;K()}return N},triggerAll:F,removeLayer:function(l){a:{for(var p=z;p--;)if(w[p].getId()==l){l=p;break a}l=-1}if(l>=0&&l<z){N.trigger("layerRemoved",w[l]);w.splice(l,
1);B()}z=w.length},stateOverride:function(l){Ta=l},getOffset:function(){return XY.init(W,X)},getViewRect:q,updateOffset:o,pan:function(l,p,C,I,K){o(W+l,X+p,C,I,K)},zoom:function(l,p){h(l);ha=false;O=Math.max(O+Math.pow(2,p)-1,0.25);COG.Log.info("zooming, scale change = "+p+", targetXY = ",l);f()}};ib=n().getScaling();N.markers=i("markers",new Za);COG.observable(N);N.bind("invalidate",function(l,p){B(p)});if(a.pannable){N.bind("pan",b);N.bind("panEnd",c);N.bind("inertiaCancel",function(){ha=false;
B()})}if(a.scalable){N.bind("pinchZoom",d);N.bind("wheelZoom",g)}N.bind("tap",function(l,p,C){for(var I=XY.offset(C,W,X),K=w.length;K--;)l.cancel=l.cancel||w[K].trigger("tap",p,C,I).cancel});N.bind("resync",function(){oa=na=null});COG.configurable(N,["inertia","container","rotation","tapExtent","scalable","pannable"],COG.paramTweaker(a,null,{container:function(l,p){E=document.getElementById(p);j()},rotation:function(l,p){pb=p}}),true);j();a.autoSize&&window.addEventListener("resize",k,false);return N},
ViewLayer:ta,ImageLayer:function(a,b){function c(j,i,m){for(i=f.length;i--;){var v=f[i],A=v.x,H=v.y,B=XYRect.init(v.x,v.y,v.x+v.width,v.y+v.height);if(m&&XYRect.intersect(j,B)){B=za.get(v.url,function(){o.changed()},k);m(B,A,H,v.width,v.height)}}}function d(j){g&&g.run(j,function(i){f=[].concat(i);o.changed()})}b=T5.ex({imageLoadArgs:{}},b);var g=a?Ha.init(a,b):null,f=[],h=XYRect.init(),k=b.imageLoadArgs,o=T5.ex(new ta(b),{changeGenerator:function(j,i){g=Ha.init(j,T5.ex({},b,i));g.bindToView(o.getParent());
f=null;d(h)},clip:function(j,i,m){c(i,m,function(v,A,H,B,q){v&&j.rect(A,H,B,q)})},cycle:function(j,i){d(i)},draw:function(j,i,m){c(i,m,function(v,A,H,B,q){o.drawImage(j,v,A,H,B,q,i,m)});h=XYRect.copy(i)},drawImage:function(j,i,m,v){i&&j.drawImage(i,m,v,i.width,i.height)}});o.bind("idle",function(){d(h)});o.bind("parentChange",function(j,i){g&&g.bindToView(i)});o.bind("tap",function(j,i,m,v){j=[];var A=v.x,H=v.y,B,q;if(f)for(var F=f.length;F--;){B=f[F];if(q=A>=B.x&&A<=B.x+B.width&&H>=B.y&&H<=B.y+B.height)j[j.length]=
B}j.length>0&&o.trigger("tapImage",j,i,m,v)});return o},Marker:Ya,ImageMarker:function(a){a=T5.ex({image:null,imageUrl:null,animatingImage:null,animatingImageUrl:null,imageAnchor:null,rotation:0,scale:1,opacity:1},a);var b=a.imageAnchor?T5.XY.invert(a.imageAnchor):null,c=T5.ex(new Ya(a),{drawMarker:function(d,g,f,h){if((g=c.isAnimating()&&c.animatingImage?c.animatingImage:c.image)&&g.width>0){b||(b=XY.init(-g.width>>1,-g.height>>1));var k=c.scale,o=f+~~(b.x*k),j=h+~~(b.y*k),i=~~(g.width*k),m=~~(g.height*
k);c.updateBounds(o,j,i,i);if(c.rotation||c.opacity!==1){d.save();try{d.globalAlpha=c.opacity;d.translate(f,h);d.rotate(c.rotation);d.drawImage(g,b.x*k,b.y*k,i,m)}finally{d.restore()}}else d.drawImage(g,o,j,i,m)}}});if(!c.image)c.image=za.get(a.imageUrl,function(d){c.image=d});if(!c.animatingImage)c.animatingImage=za.get(a.animatingImageUrl,function(d){c.animatingImage=d});return c},MarkerLayer:Za,PathLayer:function(a){a=T5.ex({style:"waypoints",pixelGeneralization:8,zindex:50},a);var b=false,c=[],
d=null,g=[],f=null,h=0,k=[],o=T5.ex(new ta(a),{getAnimation:function(j,i,m,v){var A="pathAnimation"+h++;k.push(A);return new $a({id:A,path:c,zindex:a.zindex+1,easing:j?j:r("sine.inout"),duration:i?i:5E3,drawIndicator:m,autoCenter:v?v:false})},cycle:function(j,i,m,v){return v},draw:function(j){var i,m=c.length;j.save();try{sa.apply(j,a.style);if(m>0){j.beginPath();j.moveTo(c[m-1].x,c[m-1].y);for(i=m;i--;)j.lineTo(c[i].x,c[i].y);j.stroke();if(d){j.fillStyle=a.waypointFillStyle;for(i=d.length;i--;){j.beginPath();
j.arc(d[i].x,d[i].y,2,0,Math.PI*2,false);j.stroke();j.fill()}}}}finally{j.restore()}b=false},updateCoordinates:function(j,i){g=j;f=i;var m=o.getParent();if(m&&m.syncXY){m.syncXY(g);f&&m.syncXY(f);o.trigger("tidy")}}});o.bind("tidy",function(){c=XY.simplify(g,a.pixelGeneralization);d=XY.simplify(f,a.pixelGeneralization);b=true;o.changed()});return o},AnimatedPathLayer:$a,Shape:ab,Arc:function(a,b){b=T5.ex({size:4},b);var c=XY.init(),d=T5.ex(b,{draw:function(g){g.beginPath();g.arc(c.x,c.y,d.size,0,
Math.PI*2,false);g.fill();g.stroke()},resync:function(g){g.syncXY([a]);c=XY.floor([a])[0]}});COG.Log.info("created arc = ",a);return d},Poly:function(a,b){b=T5.ex({fill:false,simplify:false},b);var c=false,d=b.fill,g=b.simplify,f=P("ZOOM"),h=[],k=T5.ex(new ab(b),{draw:function(o,j,i,m,v,A){if(c){j=true;i=(A&f)!==0;o.beginPath();for(A=h.length;A--;){i=h[A].x;m=h[A].y;if(j){o.moveTo(i,m);j=false}else o.lineTo(i,m);i=true}if(i){d&&o.fill();o.stroke()}}},resync:function(o){k.xy=o.syncXY(a);h=XY.floor(g?
XY.simplify(a):a)}});c=a&&a.length>=2;return k},ShapeLayer:function(a){function b(f){for(var h=d.length;h--;)d[h].resync(f);d.sort(function(k,o){var j=o.xy.y-k.xy.y;if(j===0)j=o.xy.x-k.xy.y;return j});g.changed()}function c(f,h){h.syncXY&&b(h)}a=T5.ex({zindex:80},a);var d=[],g=T5.ex(new ta(a),{add:function(f){d[d.length]=f},each:function(f){for(var h=d.length;h--;)f(d[h])},draw:function(f,h,k){var o=h.x1,j=h.y1,i=h.width;h=h.height;for(var m=d.length;m--;){var v=d[m].style;v=v?sa.apply(f,v):null;
d[m].draw(f,o,j,i,h,k);v&&sa.apply(f,v)}}});g.bind("parentChange",c);g.bind("resync",c);return g},Tiling:lb,TileGenerator:function(a){function b(H,B,q,F){function w(){if(A.initTileCreator){k=true;A.initTileCreator(H,B,q,F)}}A.prepTileCreator?A.prepTileCreator(H,B,q,w):w()}function c(H,B){for(var q=~~((H.x1-f.x)/o),F=~~((H.y1-f.y)/j),w=[],z=-h;z<m;z++)for(var E=-h;E<v;E++){var L=i(q+z,F+E);if(L)w[w.length]=L}B&&B(w);g=XYRect.copy(H)}a=T5.ex({tileWidth:256,tileHeight:256,relative:false,padding:2},a);
var d=null,g=null,f=XY.init(),h=a.padding,k=false,o=a.tileWidth,j=a.tileHeight,i=null,m=0,v=0,A={bindToView:function(H){COG.Log.info("initializing generator");d=H;A.trigger("bindView",H)},getTileCreatorArgs:null,initTileCreator:null,prepTileCreator:null,requireRefresh:function(){return false},reset:function(){i=null;k=false;g=null},run:function(H,B){if(!g||Math.abs(H.x1-g.x1)>o||Math.abs(H.y1-g.y1)>j){if(!i&&!k||A.requireRefresh()){f=a.relative?XY.init(H.x1,H.y1):XY.init();m=Math.ceil(H.width/o)+
h;v=Math.ceil(H.height/j)+h;b(o,j,A.getTileCreatorArgs?A.getTileCreatorArgs(d):{},function(q){i=q;k=false;c(H,B)})}i&&c(H,B)}}};COG.observable(A);A.bind("update",function(){COG.Log.info("captured generator update");g=null});return A}};COG.observable(ya);return ya}();
