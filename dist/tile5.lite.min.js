COG=typeof COG!=="undefined"?COG:{};COG.extend=function(){for(var G=arguments[0]||{},R,C=1,u=arguments.length;C<u;C++)if((R=arguments[C])!==null)for(var e in R){var f=R[e];if(G!==f)if(f!==undefined)G[e]=f}return G};
(function(){var G=Object.prototype.hasOwnProperty,R=0,C={};C.toID=function(u){return u.replace(/\s/g,"-")};C.objId=function(u){return(u?u:"obj")+R++};C.isFunction=function(u){return toString.call(u)==="[object Function]"};C.isArray=function(u){return toString.call(u)==="[object Array]"};C.isPlainObject=function(u){if(!u||toString.call(u)!=="[object Object]"||u.nodeType||u.setInterval)return false;if(u.constructor&&!G.call(u,"constructor")&&!G.call(u.constructor.prototype,"isPrototypeOf"))return false;
var e;for(e in u);return e===undefined||G.call(u,e)};C.isEmptyObject=function(u){for(var e in u)return false;return true};C.isXmlDocument=function(u){return toString.call(u)==="[object Document]"};C.contains=function(u,e){var f=u,o=arguments,v=1;if(e&&module.isArray(e)){o=e;v=0}for(v=v;v<o;v++)f=f&&typeof foo[o[v]]!=="undefined";return f};C.formatStr=function(u){if(arguments.length<=1)return u;for(var e=arguments.length-2,f=0;f<=e;f++)u=u.replace(RegExp("\\{"+f+"\\}","gi"),arguments[f+1]);return u};
C.wordExists=function(u,e){var f="";if(e.toString)e=e.toString();for(var o=0;o<e.length;o++)f+=!/\w/.test(e[o])?"\\"+e[o]:e[o];return RegExp("(^|\\s|\\,)"+f+"(\\,|\\s|$)","i").test(u)};COG.extend(COG,C)})();
(function(){function G(f){return typeof console!=="undefined"?function(){console[f](Array.prototype.slice.call(arguments,0).join(" "));return true}:function(){return false}}var R=window.console&&window.console.markTimeline,C=G("error"),u=G("info"),e=function(){return R?function(f,o){console.markTimeline(f+(o?": "+((new Date).getTime()-o)+"ms":""))}:function(){}}();COG.extend(COG,{trace:e,debug:G("debug"),info:u,warn:G("warn"),error:C,exception:function(f){if(C)for(var o in f)u("ERROR DETAIL: "+o+
": "+f[o])}})})();
(function(){function G(C,u){var e=C.obsHandlers;e[u]||(e[u]=[]);return e[u]}var R=0;COG.observable=function(C){if(!C)return null;if(!C.obsHandlers)C.obsHandlers={};if(!(C.bind||C.trigger||C.unbind)){C.bind=function(u,e){var f="callback"+R++;G(C,u).unshift({fn:e,id:f});return f};C.triggerCustom=function(u,e){var f=G(C,u),o={cancel:false,name:u,source:this},v;e&&COG.extend(o,e);if(!f)return null;v=Array.prototype.slice.call(arguments,2);C.eventInterceptor&&C.eventInterceptor(u,o,v);v.unshift(o);for(var I=
f.length;I--&&!o.cancel;)f[I].fn.apply(this,v);return o};C.trigger=function(u){var e=Array.prototype.slice.call(arguments,1);e.splice(0,0,u,null);return C.triggerCustom.apply(this,e)};C.unbind=function(u,e){if(typeof u==="undefined")C.obsHandlers={};else for(var f=G(C,u),o=0;f&&o<f.length;o++)if(f[o].id===e){f.splice(o,1);break}return C}}return C}})();
(function(){function G(e,f){e[f]||(e[f]=function(o){return e.configure(f,o)})}function R(e){e.gtConfId="configurable"+u++;e.gtConfig={};e.gtConfigFns=[];return e.gtConfig}var C={},u=0;COG.paramTweaker=function(e,f,o){return function(v,I){if(typeof I!=="undefined"){if(v in e)e[v]=I;o&&v in o&&o[v](v,I)}else return f&&v in f?f[v](v):e[v]}};COG.configurable=function(e,f,o,v){if(e){e.gtConfId||R(e);var I=e.gtConfId,g=e.gtConfig,B=e.gtConfigFns;C[I]=e;B.push(o);for(o=f.length;o--;){g[f[o]]=true;v&&G(e,
f[o])}if(!e.configure)e.configure=function(y,D){if(g[y]){for(var p=B.length;p--;){var s=B[p](y,D);if(typeof s!=="undefined")return s}return C[I]}return null}}}})();
(function(){function G(e){var f=document.createElement("script"),o=false;f.src=e;f.async=true;f.onload=f.onreadystatechange=function(){if(!o&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){o=true;f.onload=f.onreadystatechange=null;f&&f.parentNode&&f.parentNode.removeChild(f)}};C||(C=document.getElementsByTagName("head")[0]);C.appendChild(f)}var R=0,C,u=this;COG.jsonp=function(e,f,o){e+=e.indexOf("?")>=0?"&":"?";var v="json"+ ++R;u[v]=function(I){f(I);u[v]=null;try{delete u[v]}catch(g){}};
G(e+(o?o:"callback")+"="+v);return v}})();
(function(){var G=1.70158,R=Math.PI/2,C=1E3/60|0,u=Math.abs,e=Math.pow,f=Math.sin,o=Math.asin,v=Math.cos,I={linear:function(g,B,y,D){return y*g/D+B},backin:function(g,B,y,D){return y*(g/=D)*g*((G+1)*g-G)+B},backout:function(g,B,y,D){return y*((g=g/D-1)*g*((G+1)*g+G)+1)+B},backinout:function(g,B,y,D){return(g/=D/2)<1?y/2*g*g*(((G*=1.525)+1)*g-G)+B:y/2*((g-=2)*g*(((G*=1.525)+1)*g+G)+2)+B},bouncein:function(g,B,y,D){return y-I.bounceout(D-g,0,y,D)+B},bounceout:function(g,B,y,D){return(g/=D)<1/2.75?y*
7.5625*g*g+B:g<2/2.75?y*(7.5625*(g-=1.5/2.75)*g+0.75)+B:g<2.5/2.75?y*(7.5625*(g-=2.25/2.75)*g+0.9375)+B:y*(7.5625*(g-=2.625/2.75)*g+0.984375)+B},bounceinout:function(g,B,y,D){return g<D/2?I.bouncein(g*2,0,y,D)/2+B:I.bounceout(g*2-D,0,y,D)/2+y/2+B},cubicin:function(g,B,y,D){return y*(g/=D)*g*g+B},cubicout:function(g,B,y,D){return y*((g=g/D-1)*g*g+1)+B},cubicinout:function(g,B,y,D){if((g/=D/2)<1)return y/2*g*g*g+B;return y/2*((g-=2)*g*g+2)+B},elasticin:function(g,B,y,D,p,s){if(g==0)return B;if((g/=
D)==1)return B+y;s||(s=D*0.3);if(!p||p<u(y)){p=y;y=s/4}else y=s/TWO_PI*o(y/p);return-(p*e(2,10*(g-=1))*f((g*D-y)*TWO_PI/s))+B},elasticout:function(g,B,y,D,p,s){var z;if(g==0)return B;if((g/=D)==1)return B+y;s||(s=D*0.3);if(!p||p<u(y)){p=y;z=s/4}else z=s/TWO_PI*o(y/p);return p*e(2,-10*g)*f((g*D-z)*TWO_PI/s)+y+B},elasticinout:function(g,B,y,D,p,s){var z;if(g==0)return B;if((g/=D/2)==2)return B+y;s||(s=D*0.3*1.5);if(!p||p<u(y)){p=y;z=s/4}else z=s/TWO_PI*o(y/p);if(g<1)return-0.5*p*e(2,10*(g-=1))*f((g*
D-z)*TWO_PI/s)+B;return p*e(2,-10*(g-=1))*f((g*D-z)*TWO_PI/s)*0.5+y+B},quadin:function(g,B,y,D){return y*(g/=D)*g+B},quadout:function(g,B,y,D){return-y*(g/=D)*(g-2)+B},quadinout:function(g,B,y,D){if((g/=D/2)<1)return y/2*g*g+B;return-y/2*(--g*(g-2)-1)+B},sinein:function(g,B,y,D){return-y*v(g/D*R)+y+B},sineout:function(g,B,y,D){return y*f(g/D*R)+B},sineinout:function(g,B,y,D){return-y/2*(v(Math.PI*g/D)-1)+B}};COG.tweenValue=function(g,B,y,D,p){function s(P){P=P?P:(new Date).getTime();if(ga+C<P){var W=
P-z,S=y(W,g,U,D),ia=z+D<=P;P=!ia;if(p){W=p(S,ia,W);P=typeof W!="undefined"?W&&P:P}P&&animFrame(s)}}var z=(new Date).getTime(),ga=0,U=B-g;animFrame(s);return{}};COG.easing=function(g){return I[g.replace(/[\-\_\s\.]/g,"").toLowerCase()]};COG.registerEasingType=function(g,B){I[g.replace(/[\-\_\s\.]/g,"").toLowerCase()]=B}})();
(function(){var G=/^P(\d+Y)?(\d+M)?(\d+D)?$/,R=/^(\d+H)?(\d+M)?(\d+S)?$/,C={8601:function(e){e=e.split("T");var f=null;f=null;var o=0,v=0;G.lastIndex=-1;f=G.exec(e[0]);o+=f[3]?parseInt(f[3].slice(0,-1),10):0;R.lastIndex=-1;f=R.exec(e[1]);v+=f[1]?parseInt(f[1].slice(0,-1),10)*3600:0;v+=f[2]?parseInt(f[2].slice(0,-1),10)*60:0;v+=f[3]?parseInt(f[3].slice(0,-1),10):0;return new u(o,v)}},u=COG.Duration=function(e,f){return{days:e?e:0,seconds:f?f:0}};COG.addDuration=function(){for(var e=new u,f=arguments.length;f--;){e.days+=
arguments[f].days;e.seconds+=arguments[f].seconds}if(e.seconds>=86400){e.days+=~~(e.seconds/86400);e.seconds%=86400}return e};COG.formatDuration=function(e){var f,o,v="";if(e.days)v=e.days+" days ";if(e.seconds){e=e.seconds;if(e>=3600){f=~~(e/3600);e-=f*3600}if(e>=60){o=Math.round(e/60);e-=o*60}if(f)v=v+f+(f>1?" hrs ":" hr ")+(o?(o>10?o:"0"+o)+" min ":"");else if(o)v=v+o+" min";else if(e>0)v=v+(e>10?e:"0"+e)+" sec"}return v};COG.parseDuration=function(e,f){var o=f?C[f]:null;if(o)return o(e);COG.Log.warn("Could not find duration parser for specified format: "+
f);return new u}})();COG.ObjectStore=function(){var G={},R={},C="obj_"+(new Date).getTime(),u=0,e=Object.prototype.hasOwnProperty;return{add:function(f,o){var v;o=o?o:"default";if(f&&f.constructor)if(!e.call(f,"id"))f.id=C+ ++u;v=R[o]?R[o]:R[o]=[];G[f.id]=v.length;v[f.length]=f}}};var CANI={};
(function(G){var R=[],C=0,u=false,e=G.register=function(f,o){R.push({section:f,run:o})};G.init=function(f){function o(){if(C<R.length){var I=R[C++];v[I.section]||(v[I.section]={});I.run(v[I.section],o)}else{for(I in v)G[I]=v[I];u=true;f&&f(G)}}var v={};if(u&&f)f(G);else{C=0;o()}};e("canvas",function(f,o){var v=document.createElement("canvas"),I=v.getContext("2d");v.width=200;v.height=200;f.pipTransformed=function(){var g;I.save();try{I.translate(50,50);I.beginPath();I.rect(0,0,20,20);g=I.isPointInPath(10,
10)}finally{I.restore()}return g}();o()})})(CANI);
INTERACT=function(){function G(p){return function(s,z,ga){(ga?ga:p?document.body:document).addEventListener(s,z,false)}}function R(p){return function(s,z,ga){(ga?ga:p?document.body:document).removeEventListener(s,z,false)}}function C(p,s,z){(z?z:document).attachEvent("on"+p,s)}function u(p,s,z){(z?z:document).detachEvent("on"+p,s)}function e(p,s){return{x:p?p:0,y:s?s:0,count:1}}function f(p,s){y.push(COG.extend({handler:null,checks:{},type:p},s))}function o(p){var s=0,z=0;if(p.offsetParent){do{s+=
p.offsetLeft;z+=p.offsetTop;p=p.offsetParent}while(p)}return{x:s,y:z}}function v(p,s){return{source:p,target:s.target?s.target:s.srcElement}}function I(p,s){for(var z=p.target?p.target:p.srcElement;z&&z!==s&&z.nodeName&&z.nodeName.toUpperCase()!="CANVAS";)z=z.parentNode;return z&&z===s}function g(p,s){return{x:p.x-(s?s.x:0),y:p.y-(s?s.y:0)}}function B(p){if(p.preventDefault){p.preventDefault();p.stopPropagation()}else p.cancelBubble&&p.cancelBubble()}var y=[],D=function(p,s,z){function ga(Y,aa,L,
N){var J=0,da=0,r=0;COG.tweenValue(0,Y,L,N,function(ba){r=J;J=ba});COG.tweenValue(0,aa,L,N,function(ba){U.trigger("pan",J-r,ba-da);da=ba})}z=COG.extend({binder:null,unbinder:null,observable:null},z);for(var U=z.observable,P=null,W=[],S=[],ia,oa,xa={bind:function(){return U.bind.apply(null,arguments)},pannable:function(Y){P=COG.extend({inertia:true},Y);return xa},unbind:function(){U.unbind();for(var Y=0;Y<W.length;Y++)W[Y].unbind();return xa}},Ba=0;Ba<s.length;Ba++)W.push(s[Ba](p,U,z));U.bind("pointerDown",
function(){S=[];oa=ia=0});U.bind("pointerMove",function(Y,aa,L,N){if(P){S[S.length]={ticks:(new Date).getTime(),x:N.x,y:N.y};U.trigger("pan",N.x,N.y)}ia+=N.x?N.x:0;oa+=N.y?N.y:0});U.bind("pointerUp",function(Y,aa,L){if(Math.abs(ia)>20||Math.abs(oa)>20){if(P){L=S.length;var N,J;aa=0;for(J=S.length;--J>1&&aa<50;)aa+=S[J].ticks-S[J-1].ticks;if(L-J>1){Y=S[L-1].x-S[J].x;N=S[L-1].y-S[J].y;J=Math.sqrt(Y*Y+N*N)|0;if(J>15){Y=S[L-1].x-S[0].x;N=S[L-1].y-S[0].y;J=Math.sqrt(Y*Y+N*N)|0;L=Math.asin(N/J);aa=J*500/
aa|0;aa=aa>300?300:aa;ga(Math.cos(Y>0?L:Math.PI-L)*aa,Math.sin(L)*aa,COG.easing("sine.out"),500)}}}}else U.trigger("tap",aa,L)});return xa};f("pointer",{handler:function(p,s,z){function ga(r){if(I(r,p))if(Ba=S(r)){p.style.cursor="move";B(r);J=r.pageX?r.pageX:r.screenX;da=r.pageY?r.pageY:r.screenY;Y=e(J,da);aa=o(p);s.triggerCustom("pointerDown",v("mouse",r),Y,g(Y,aa))}}function U(r){L=r.pageX?r.pageX:r.screenX;N=r.pageY?r.pageY:r.screenY;if(I(r,p))ia(r,Ba?"pointerMove":"pointerHover")}function P(r){if(Ba&&
S(r)){Ba=false;if(I(r,p)){p.style.cursor="default";ia(r,"pointerUp")}}}function W(r){if(I(r,p)){var ba;r=r||window.event;if(r.detail)ba=r.axis===2?-r.detail*oa:0;else{ba=r.wheelDeltaY?r.wheelDeltaY:r.wheelDelta;if(window.opera)ba=-ba}if(ba!==0){var ha=e(L,N);s.triggerCustom("zoom",v("mouse",r),ha,g(ha,o(p)),ba/xa,"wheel");B(r);r.returnValue=false}}}function S(r){r=r||window.event;return(r.which||r.button)==1}function ia(r,ba,ha,ra,Fa){ha=typeof ha!="undefined"?ha:L;ra=typeof ra!="undefined"?ra:N;
var H=ha-J,V=ra-da,O=e(ha,ra);aa||(aa=o(p));s.triggerCustom(ba,v("mouse",r),O,g(O,aa),e(H,V));if(typeof Fa=="undefined"||Fa){J=ha;da=ra}}z=COG.extend({},z);var oa=120,xa=oa*8,Ba=false,Y,aa,L,N,J,da;z.binder("mousedown",ga,false);z.binder("mousemove",U,false);z.binder("mouseup",P,false);z.binder("dblclick",function(r){COG.info("captured double click");if(I(r,p)){var ba=e(r.pageX?r.pageX:r.screenX,r.pageY?r.pageY:r.screenY);COG.info("captured double click + target matched");s.triggerCustom("doubleTap",
v("mouse",r),ba,g(ba,o(p)))}},false);z.binder("mousewheel",W,document);z.binder("DOMMouseScroll",W,document);return{unbind:function(){z.unbinder("mousedown",ga,false);z.unbinder("mousemove",U,false);z.unbinder("mouseup",P,false);z.unbinder("mousewheel",W,document);z.unbinder("DOMMouseScroll",W,document)}}},checks:{touch:false}});f("pointer",{handler:function(p,s,z){function ga(H){if(H.count<2)return 0;var V=H.x-H.next.x;H=H.y-H.next.y;return~~Math.sqrt(V*V+H*H)}function U(H,V,O){V=V?V:0;O=O?O:0;for(var ma=
{x:H.x-V,y:H.y-O,id:H.id,count:H.count},Ca=ma;H.next;){H=H.next;Ca=Ca.next={x:H.x-V,y:H.y-O,id:H.id}}return ma}function P(H,V){var O=H[V?V:"touches"],ma,Ca;if(O.length===0)return null;Ca=ma={x:O[0].pageX,y:O[0].pageY,id:O[0].identifier,count:O.length};for(var ya=1,Da=O.length;ya<Da;ya++)Ca=Ca.next={x:O[ya].pageX,y:O[ya].pageY,id:O[ya].identifier};return ma}function W(H){if(I(H,p)){N=o(p);var V=P(H,"changedTouches"),O=U(V,N.x,N.y);if(!da){J=Y;s.triggerCustom("pointerDown",v("touch",H),V,O)}ra&&s.triggerCustom("pointerDownMulti",
v("touch",H),V,O);da=P(H);if(da.count>1)ba=ga(da);Fa=1;ha=U(da)}}function S(H){if(I(H,p)){H.preventDefault();r=P(H);if(J==Y)J=Math.abs(da.x-r.x)>xa||Math.abs(da.y-r.y)>xa?Ba:Y;if(J!=Y){J=r.count>1?L:aa;if(J==L)if(da.count===1){da=U(r);ba=ga(da)}else{var V=ga(r);if(Math.abs(ba-V)<oa)J=aa;else{var O;O=r.x;var ma=r.next.x,Ca=r.y,ya=r.next.y,Da=Ca<ya?Ca:ya;O={x:(O<ma?O:ma)+(Math.abs(O-ma)>>1),y:Da+(Math.abs(Ca-ya)>>1)};V=V/ba;ma=V-Fa;s.triggerCustom("zoom",v("touch",H),O,g(O,N),ma,"pinch");Fa=V}}J==aa&&
s.triggerCustom("pointerMove",v("touch",H),r,U(r,N.x,N.y),e(r.x-ha.x,r.y-ha.y));ra&&s.triggerCustom("pointerMoveMulti",v("touch",H),r,U(r,N.x,N.y))}ha=U(r)}}function ia(H){if(I(H,p)){var V=P(H,"changedTouches"),O=U(V,N.x,N.y);r=P(H);if(!r){s.triggerCustom("pointerUp",v("touch",H),V,O);da=null}ra&&s.triggerCustom("pointerUpMulti",v("touch",H),V,O)}}z=COG.extend({detailed:false,inertia:false},z);var oa=20,xa=7,Ba=0,Y=1,aa=2,L=3,N,J,da,r,ba,ha,ra=z.detailed,Fa=1;z.binder("touchstart",W,false);z.binder("touchmove",
S,false);z.binder("touchend",ia,false);COG.info("initialized touch handler");return{unbind:function(){z.unbinder("touchstart",W,false);z.unbinder("touchmove",S,false);z.unbinder("touchend",ia,false)}}},checks:{touch:true}});return{register:f,watch:function(p,s,z){s=COG.extend({bindToBody:false,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},s);capabilities=COG.extend({touch:"ontouchstart"in window},z);if(!s.observable){COG.info("creating observable");s.observable=COG.observable({});
globalOpts=s}s.binder=s.isIE?C:G(s.bindToBody);s.unbinder=s.isIE?u:R(s.bindToBody);z=s.types;for(var ga=capabilities,U=[],P=y.length;P--;){var W=y[P],S=!z||z.indexOf(W.type)>=0,ia=true;for(var oa in W.checks){var xa=W.checks[oa];COG.info("checking "+oa+" capability. require: "+xa+", capability = "+ga[oa]);ia=ia&&xa===ga[oa]}if(S&&ia)U[U.length]=W.handler}return new D(p,U,s)}}}();var T5={};
(function(G){function R(){return(new Date).getTime()}function C(){for(;Fa.length>0;){var a=Fa.shift();document.location=a}ra=0}function u(a){for(var i=true,d=H.length;d--;)i=i&&a!=H[d];return i}function e(a,i){var d=[];for(var b in i)b&&d.push(b+"="+escape(i[b]));return"tile5://"+a+"/"+(d.length>0?"?"+d.join("&"):"")}function f(a,i){u(a)&&COG.info("would push url: "+e(a,i))}function o(a,i){if(u(a)){Fa.push(e(a,i));ra||(ra=setTimeout(C,100))}}function v(a){return function(i,d,b){(b?b:a?document.body:
document).addEventListener(i,d,false)}}function I(a){return function(i,d,b){(b?b:a?document.body:document).removeEventListener(i,d,false)}}function g(a,i,d){(d?d:document).attachEvent("on"+a,i)}function B(a,i,d){(d?d:document).detachEvent("on"+a,i)}function y(){r={base:{name:"Unknown",bindEvent:v(),unbindEvent:I(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:f,targetFps:null},ie:{name:"MSIE",regex:/msie/i,
bindEvent:g,unbindEvent:B,requireFastDraw:false,targetFps:25},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:o,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:o},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:o},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:v(true),unbindEvent:I(true),supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},
bridgeNotify:o},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:o}};ba=[r.froyo,r.android,r.ipod,r.iphone,r.ipad,r.ie]}function D(){r||y();if(!ha){COG.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var a=0;a<ba.length;a++){var i=ba[a];if(i.regex&&i.regex.test(navigator.userAgent)){ha=COG.extend({},r.base,i);COG.info("PLATFORM DETECTED AS: "+ha.name);break}}if(!ha){COG.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
ha=r.base}COG.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return ha}function p(){for(var a=0,i=arguments.length;i--;){var d=Ca[arguments[i].toUpperCase()];if(d)a|=d}return a}function s(a,i){var d,b;if(i&&i.width>0){if(!a.imageOffset)a.imageOffset=L.init(-i.width>>1,-i.height>>1);if(!a.bounds){d=a.xy.x+a.imageOffset.x;b=a.xy.y+a.imageOffset.y;a.bounds=J.init(d,b,d+i.width,b+i.height)}}}function z(a){function i(){a.transformed=c!==1||b%ga!==0||m!==0||h!==0}var d=1E3/60|0,b=0,c=1,m=
0,h=0;COG.extend(a,{animate:function(q,w,j,t,A,K){var Z=(new Date).getTime(),$=a[q],M=w.length&&j.length&&w.length==j.length?w.length:0,k=Array(M),E=Array(M),Q=COG.easing(t?t:"sine.out"),F=function(ja){ja=ja?ja:(new Date).getTime();if(ja-0>d){var Ra=ja-Z;ja=Z+A<=ja;for(var Ka=M;Ka--;)E[Ka]=Q(Ra,w[Ka],k[Ka],A);$.apply(a,E);a.invalidate.call(a);if(ja){$.apply(a,j);a.invalidate.call(a);K&&K()}else animFrame(F)}};if($&&$.apply&&M>0){A=A?A:1E3;for(q=M;q--;)k[q]=j[q]-w[q];animFrame(F)}},rotate:function(q){b=
q;i()},scale:function(q){c=q;i()},translate:function(q,w){m=q;h=w;i()},transform:function(q,w,j){q.save();q.translate(a.xy.x-w+m,a.xy.y-j+h);b!==0&&q.rotate(b);c!==1&&q.scale(c,c)}})}window.animFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){setTimeout(function(){a((new Date).getTime())},1E3/60)}}();var ga=Math.PI*2,U=Math.abs,P=Math.min,W=Math.max,
S=Math.pow,ia=Math.sqrt,oa=Math.log,xa=Math.round,Ba=Math.sin,Y=Math.asin,aa=Math.cos,L=function(){function a(b,c){return d(b.x-c.x,b.y-c.y)}function i(b,c){if(!c)c=b.length;if(c<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var m={edges:Array(c-1),accrued:Array(c-1),total:0},h=0;h<c-1;h++){var q=a(b[h],b[h+1]);m.edges[h]=ia(q.x*q.x+q.y*q.y);m.accrued[h]=m.total+m.edges[h];m.total+=m.edges[h]}return m}function d(b,c){return{x:b?b:0,y:c?c:0}}return{VECTOR_SIMPLIFICATION:3,
SIMPLIFICATION_MIN_VECTORS:25,add:function(){for(var b=0,c=0,m=arguments.length;m--;){b+=arguments[m].x;c+=arguments[m].y}return d(b,c)},absSize:function(b){return W(U(b.x),U(b.y))},copy:function(b){return b?d(b.x,b.y):null},diff:a,distance:function(b,c){return i(b,c).total},edges:i,equals:function(b,c){return b.x===c.x&&b.y===c.y},extendBy:function(b,c,m){var h=aa(c)*m;c=Ba(c)*m;return d(b.x-h,b.y-c)},floor:function(b){for(var c=Array(b.length),m=b.length;m--;)c[m]=d(~~b[m].x,~~b[m].y);return c},
getRect:function(b){for(var c,m,h,q,w=b.length;w--;){var j=b[w];c=typeof c==="undefined"||j.x<c?j.x:c;m=typeof m==="undefined"||j.y<m?j.y:m;h=typeof h==="undefined"||j.x>h?j.x:h;q=typeof q==="undefined"||j.y>q?j.y:q}return J.init(c,m,h,q)},init:d,invert:function(b){return d(-b.x,-b.y)},min:function(b,c){return d(b.x<c.x?b.x:c.x,b.y<c.y?b.y:c.y)},max:function(b,c){return d(b.x>c.x?b.x:c.x,b.y>c.y?b.y:c.y)},offset:function(b,c,m){return d(b.x+c,b.y+(m?m:c))},scale:function(b,c){return d(b.x/c|0,b.y/
c|0)},simplify:function(b,c){if(!b)return null;c=c?c:L.VECTOR_SIMPLIFICATION;for(var m=[],h=null,q=b.length;q--;){var w=b[q];if(include=!h||q===0||U(w.x-h.x)+U(w.y-h.y)>c){m.unshift(w);h=w}}return m},theta:function(b,c,m){m=Y((b.y-c.y)/m);return b.x>c.x?m:Math.PI-m},toString:function(b){return b?b.x+", "+b.y:""}}}(),N=function(){return{dotProduct:function(a,i){return a.x*i.x+a.y*i.y}}}(),J=function(){function a(d){return i(d.x1,d.y1,d.x2,d.y2)}function i(d,b,c,m){d=d?d:0;b=b?b:0;c=typeof c!=="undefined"?
c:d;m=typeof m!=="undefined "?m:m;return{x1:d,y1:b,x2:c,y2:m,width:c-d,height:m-b}}return{center:function(d){return L.init(d.x1+(d.width>>1),d.y1+(d.height>>1))},copy:a,diagonalSize:function(d){return ia(d.width*d.width+d.height*d.height)},fromCenter:function(d,b,c,m){c=c>>1;m=m>>1;return i(d-c,b-m,d+c,b+m)},init:i,intersect:function(d,b){var c=W(d.x1,b.x1),m=W(d.y1,b.y1),h=P(d.x2,b.x2),q=P(d.y2,b.y2);c=i(c,m,h,q);return c.width>0&&c.height>0?c:null},toString:function(d){return d?"["+d.x1+", "+d.y1+
", "+d.x2+", "+d.y2+"]":""},union:function(d,b){if(d.width===0||d.height===0)return a(b);else if(b.width===0||b.height===0)return a(d);else{var c=P(d.x1,b.x1),m=P(d.y1,b.y1),h=W(d.x2,b.x2),q=W(d.y2,b.y2);c=i(c,m,h,q);return c.width>0&&c.height>0?c:null}}}}(),da=function(){return{getAspectRatio:function(a){return a.height!==0?a.width/a.height:1},getCenter:function(a){return L.init(a.width>>1,a.height>>1)},getSize:function(a){return ia(S(a.width,2)+S(a.height,2))},init:function(a,i){a=a?a:0;return{width:a,
height:i?i:a}}}}();Hits=function(){return{diffHits:function(a,i){var d=[],b={},c;for(c=i.length;c--;)b[i[c].target.id]=true;for(c=a.length;c--;)b[a[c].target.id]||(d[d.length]=a[c]);return d},init:function(a,i,d,b){return{type:a,x:b.x|0,y:b.y|0,elements:[],absXY:i,relXY:d}},initHit:function(a,i,d){return d=COG.extend({type:a,target:i,drag:false},d)},triggerEvent:function(a,i,d,b){i.triggerCustom(a.type+(d?d:"Hit"),{hitType:a.type},b?b:a.elements,a.absXY,a.relXY,L.init(a.x,a.y))}}}();var r=null,ba=
[],ha=null,ra=0,Fa=[],H=["view.wake","tile.loaded"],V=function(){function a(){var k=D().maxImageLoads;if(!k||t.length<k){var E=j.shift();k=T5.ticks();if(E){t[t.length]=E;E.image.onload=d;E.image.src=E.url;E.requested=k}if(k-Z>m){E=false;for(var Q=0,F=D();Q<t.length;)if(k-t[Q].requested>M.loadTimeout*1E3){t.splice(Q,1);E=true}else Q++;E&&a();if(F&&F.imageCacheMaxSize){K=A.length*M.avgImageSize/F.imageCacheMaxSize;K>=1&&i()}Z=k}}}function i(){$=true;try{var k=A.length>>1;if(k>0){A.sort(function(Q,F){return Q.created-
F.created});for(var E=k;E--;)delete h[A[E].url];A.splice(0,k)}}finally{$=false}M.trigger("cacheCleared")}function d(){var k=q[this.id],E;if(k&&k.image.complete&&k.image.width>0){k.loaded=true;k.hitCount=1;for(E=t.length;E--;)if(t[E].image.src==this.src){t.splice(E,1);break}if(k.background||k.postProcess||k.drawBackground||k.customDraw)if(k.image){globalImageData=k;E=c(k.realSize?k.realSize.width:k.image.width,k.realSize?k.realSize.height:k.image.height);var Q=E.getContext("2d"),F=k.offset?k.offset:
T5.XY.init();k.background&&Q.drawImage(k.background,0,0);k.drawBackground&&k.drawBackground(Q);k.customDraw?k.customDraw(Q,k):Q.drawImage(k.image,F.x,F.y);k.postProcess&&k.postProcess(Q,k);k.image=E}for(E=k.callbacks.length;E--;)k.callbacks[E]&&k.callbacks[E](this,false);k.callbacks=[];A[A.length]={url:this.src,created:k.requested};delete q[this.id];a()}}function b(k,E,Q){var F=h[k];if(F){F.hitCount++;F.image.complete&&F.image.width>0&&E?E(F.image,true):F.callbacks.push(E)}else{F=COG.extend({url:k,
image:new Image,loaded:false,created:T5.ticks(),requested:null,hitCount:0,callbacks:[E]},Q);F.image.id="resourceLoaderImage"+w++;h[k]=F;q[F.image.id]=F;j[j.length]=F;a()}return F}function c(k,E){var Q=document.createElement("canvas");COG.info("creating new canvas");Q.width=k?k:0;Q.height=E?E:0;if(typeof FlashCanvas!="undefined"){document.body.appendChild(Q);FlashCanvas.initElement(Q)}return Q}var m=1E4,h={},q={},w=0,j=[],t=[],A=[],K=0,Z=0,$=false,M={avgImageSize:25,loadTimeout:10,cancelLoad:function(){var k;
for(k=t.length;k--;)delete h[t[k].url];t=[];for(k=j.length;k--;)delete h[j[k].url];j=[]},get:function(k,E,Q){var F=null,ja=null;$||(F=h[k]);if((ja=F?F.image:null)&&(ja.getContext||ja.complete&&ja.width>0))return ja;else E&&b(k,E,Q);return null},load:b,newCanvas:c,reset:function(){h={}},stats:function(){return{imageLoadingCount:t.length,queuedImageCount:j.length,imageCacheFullness:K}}};COG.observable(M);return M}(),O=function(){var a={};return{init:function(i,d){var b=a[i];if(!b)throw Error("Unable to locate requested generator: "+
i);return new b(d)},register:function(i,d){a[i]=d},Template:function(){}}}(),ma=function(){function a(h,q){c[h]=d(q);return h}function i(h){for(var q in h)a(q,h[q])}function d(h){function q(A){var K=h[A];typeof K!=="undefined"&&j.push(function(Z){Z[A]=K})}function w(){j=[];for(var A in h)q(A)}h=COG.extend({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},h);var j=[],t={applyToContext:function(A){for(var K=
j.length;K--;)j[K](A)},update:function(A,K){h[A]=K;w()}};w();return t}var b={},c={},m={apply:function(h,q){var w=c[q]?c[q]:c.basic,j;if(h&&h.canvas){j=b[h.canvas.id];b[h.canvas.id]=q}w.applyToContext(h);return j},define:a,defineMany:i,get:function(h){return c[h]},init:d,load:function(h){COG.jsonp(h,function(q){i(q)})}};i({basic:{lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"},waypoints:{lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"},waypointsHover:{lineWidth:4,strokeStyle:"#f00",
fillStyle:"#FFF"}});return m}(),Ca={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,ZOOM:16,FREEZE:128},ya=function(a){a=COG.extend({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:p("ACTIVE","ANIMATING","PAN","ZOOM"),style:null,minXY:null,maxXY:null},a);var i=null,d=false,b=false,c=a.id,m=p("ACTIVE"),h=a.validStates,q=0,w=0,j=COG.extend({addToView:function(t){t.setLayer(c,j)},shouldDraw:function(t){return(t&h)!==0},clip:null,cycle:function(){},draw:function(){},hitGuess:null,remove:function(){j.trigger("remove",
j)},changed:function(){b=true;i&&i.invalidate()},hitTest:null,getId:function(){return c},setId:function(t){c=t},getParent:function(){return i},setParent:function(t){d=(i=t)?i.fastDraw&&displayState!==m:false;j.trigger("parentChange",i)}},a);COG.observable(j);j.bind("drawComplete",function(t,A){b=false;q=A.x1;w=A.y1});j.bind("resync",function(t,A){j.minXY&&A.syncXY(j.minXY);j.maxXY&&A.syncXY(j.maxXY)});return j},Da=function(a){a=COG.extend({style:null,xy:null,size:null,fill:false,stroke:true,draggable:false,
observable:true,properties:{},type:"shape",transformable:false},a);COG.extend(this,a);this.id=COG.objId(this.type);this.bounds=null;this.observable&&COG.observable(this);this.transformable&&z(this);this.transformed=false};Da.prototype={constructor:Da,drag:null,draw:function(a){this.fill&&a.fill();this.stroke&&a.stroke()},invalidate:function(){var a=this.layer?this.layer.getParent():null;a&&a.invalidate()},prepPath:function(){},resync:function(a){if(this.xy){a.syncXY([this.xy]);this.size&&this.updateBounds(J.fromCenter(this.xy.x,
this.xy.y,this.size,this.size))}},setTransformable:function(a){a&&!this.transformable&&z(this);this.transformable=a},updateBounds:function(a,i){this.bounds=a;if(i)this.xy=J.center(this.bounds)}};var Sa=function(a,i){i=COG.extend({simplify:false},i);var d=false,b=i.simplify;p("ZOOM");var c=[];i.type=i.fill?"polygon":"line";Da.call(this,i);COG.extend(this,{animatePath:function(){},prepPath:function(m,h,q){if(d){var w=true;m.beginPath();for(var j=c.length;j--;){var t=c[j].x-h,A=c[j].y-q;if(w){m.moveTo(t,
A);w=false}else m.lineTo(t,A)}}return d},resync:function(m){var h,q,w,j,t;m.syncXY(a);c=L.floor(b?L.simplify(a):a);for(var A=c.length;A--;){m=c[A].x;h=c[A].y;j=typeof j=="undefined"||m<j?m:j;t=typeof t=="undefined"||h<t?h:t;q=typeof q=="undefined"||m>q?m:q;w=typeof w=="undefined"||h>w?h:w}this.updateBounds(J.init(j,t,q,w),true)}});d=a&&a.length>=2};Sa.prototype=COG.extend(Da.prototype,{constructor:Sa});var rb=function(a,i){i.fill=false;Sa.call(this,a,i)};rb.prototype=new Sa;var Oa=function(a){function i(w){if(this.imageUrl=
w)h=V.get(this.imageUrl,function(j){var t=q.layer?q.layer.getParent():null;h=j;t&&t.invalidate()})}a=COG.extend({image:null,imageUrl:null,imageOffset:null},a);var d=null,b=Da.prototype.updateBounds,c,m,h=a.image;Da.call(this,a);var q=COG.extend(this,{changeImage:i,drag:function(w,j,t,A){d||(d=L.init(w.startX-this.xy.x,w.startY-this.xy.y));this.xy.x=j-d.x;this.xy.y=t-d.y;if(A){d=null;if(this.layer)(w=this.layer.getParent())&&w.syncXY([this.xy],true);this.trigger("dragDrop")}return true},draw:function(w){w.drawImage(h,
c,m)},prepPath:function(w,j,t){var A=h&&h.width>0;if(A){s(this,h);c=this.xy.x+this.imageOffset.x-j;m=this.xy.y+this.imageOffset.y-t;w.beginPath();w.rect(c,m,h.width,h.height)}return A},updateBounds:function(w,j){b.call(this,w,j);s(this,h)}});h||i(this.imageUrl)};Oa.prototype=new Da;Oa.prototype.constructor=Oa;var Wa=function(a){a=COG.extend({imageAnchor:null},a);if(a.imageAnchor)a.imageOffset=L.invert(a.imageAnchor);Oa.call(this,a)};Wa.prototype=new Oa;Wa.prototype.constructor=Wa;var sb=function(a){function i(h){for(var q=
b.length;q--;)b[q].resync(h);b.sort(function(w,j){var t=j.xy.y-w.xy.y;return t!=0?t:j.xy.x-w.xy.y});m.changed()}function d(h,q){i(q)}a=COG.extend({zindex:10},a);var b=[],c=CANI.canvas.pipTransformed,m=COG.extend(new ya(a),{add:function(h,q){if(h){h.layer=m;var w=m.getParent();if(w){h.resync(m.getParent());w.invalidate()}if(q)b.unshift(h);else b[b.length]=h}},clear:function(){b=[]},draw:function(h,q,w,j,t,A){j=q.x1;t=q.y1;var K=A?c?A.x-j:A.relXY.x:0,Z=A?c?A.y-t:A.relXY.y:0,$=q.width;q=q.height;for(var M=
b.length;M--;){var k=b[M],E=k.style,Q,F=k.transformed;if(F){k.transform(h,j,t);if(c){K-=k.xy.x;Z-=k.xy.y}}if(k.prepPath(h,F?k.xy.x:j,F?k.xy.y:t,$,q,w)){if(A&&h.isPointInPath(K,Z)){A.elements.push(Hits.initHit(k.type,k,{drag:k.draggable?k.drag:null}));Q=A.type+"Style";E=k[Q]||m[Q]||E}E=E?ma.apply(h,E):null;k.draw(h,j,t,$,q,w);E&&ma.apply(h,E)}F&&h.restore()}},find:function(){return[].concat(b)},hitGuess:function(h,q){for(var w=false,j=b.length;!w&&j--;){var t=b[j].bounds;w=w||t&&h>=t.x1&&h<=t.x2&&
q>=t.y1&&q<=t.y2}return w}});m.bind("parentChange",d);m.bind("resync",d);return m},zb=function(){return{tileSize:256,init:function(a,i,d,b,c){return COG.extend({x:a,y:i,width:d,height:b},c)}}}();COG.extend(G,{ex:COG.extend,ticks:R,getConfig:D,userMessage:function(a,i,d){G.trigger("userMessage",a,i,d)},XY:L,XYRect:J,Dimensions:da,Vector:N,Hits:Hits,Images:V,Generator:O,tween:COG.tween,tweenValue:COG.tweenValue,easing:COG.easing,Tween:COG.Tween,Style:ma,viewState:p,View:function(a){function i(l,n,x){Ga||
Xa(ea-n,fa-x)}function d(l,n,x,T){Ka(P(W(la+S(2,T)-1,0.5),2))}function b(){var l=oa(la)/Math.LN2|0;if(l!==0){la=S(2,l);tb(Ta+l,Ya,Za)}F()}function c(l){l||(l=L.init(Ma,Na));fb=L.init(ea,fa);Ua=L.offset(l,ea,fa);Ya=Ua.x;Za=Ua.y}function m(l,n){var x=1/la;return L.init(Pa.x1+l*x,Pa.y1+n*x)}function h(l,n,x){Qa("doubleTap",n,x,m(x.x,x.y));a.scalable&&Ka(2,x,a.zoomEasing,null,a.zoomDuration)}function q(l,n,x){Ga=null;Q("down",n,x)}function w(l,n,x){Q("hover",n,x)}function j(l,n,x){k(n,x,false)}function t(l,
n,x){k(n,x,true)}function A(){clearTimeout(ub);ub=setTimeout(Z,250)}function K(l,n,x){Q("tap",n,x);Qa("tap",n,x,m(x.x,x.y,true))}function Z(l,n){var x;$a=typeof FlashCanvas!=="undefined";COG.info("is flash = "+$a);if(pa){if(a.autoSize&&pa.parentNode){l=pa.parentNode.offsetWidth;n=pa.parentNode.offsetHeight}try{if(!pa.id)pa.id=a.id+"_canvas";qa=pa.getContext("2d")}catch(T){COG.exception(T);throw Error("Could not initialise canvas on specified view element");}if(l&&n&&(sa!==n||ta!==l)){gb=true;ta=l;
sa=n;Ma=ta>>1;Na=sa>>1;ka.trigger("resize",ta,sa);for(x=za;x--;)ca[x].trigger("resize",ta,sa)}for(x=za;x--;)ca[x].trigger("contextChanged",qa);F();M()}}function $(l,n){n.setId(l);n.added=R();n.bind("remove",function(){ka.removeLayer(l)});n.trigger("contextChanged",qa);n.setParent(ka);ca.push(n);ca.sort(function(x,T){var X=T.zindex-x.zindex;if(X===0)X=T.added-x.added;return X});za=ca.length;return n}function M(){Aa&&Aa.unbind();Aa=INTERACT.watch(pa);a.pannable&&Aa.pannable().bind("pan",i);if(a.scalable){Aa.bind("zoom",
d);Aa.bind("doubleTap",h)}Aa.bind("pointerDown",q);Aa.bind("pointerMove",j);Aa.bind("pointerUp",t);a.captureHover&&Aa.bind("pointerHover",w);Aa.bind("tap",K)}function k(l,n,x){if(Ga){l=m(n.x,n.y);Ga.drag.call(Ga.target,Ga,l.x,l.y,x)&&F();if(x)Ga=null}}function E(l){var n,x,T=false;if(hb|$a){l=l?l:(new Date).getTime();x=ea!==ib||fa!==jb;Ha=vb|(la!==1?wb:0)|(x?kb:0)|(lb?mb:0);nb=(n=(Ha&(wb|kb))!==0)&&(Ha&mb)===0;if(gb&&pa){$a&&FlashCanvas.initElement(pa);pa.width=ta;pa.height=sa;pa.style.width=ta+"px";
pa.style.height=sa+"px";gb=false}ab=ja();for(x=za;x--;){Ha|=ca[x].animated?mb:0;ca[x].cycle(l,ab,Ha);T=ca[x].clip||T}x=Ha;var X=ab;T=Ab&&T&&!n;n=l;var na;J.center(X);var ua=0,va;if(la!==1){va=1/la;Ya=Ua.x+(ea-fb.x);Za=Ua.y+(fa-fb.y);va=X?J.fromCenter(Ya>>0,Za>>0,X.width*va>>0,X.height*va>>0):void 0}else va=J.copy(X);Pa=va;T||qa.clearRect(0,0,ta,sa);Pa.scaleFactor=la;qa.save();try{la!==1&&qa.scale(la,la);bb=cb=null;if(T){qa.beginPath();for(ua=za;ua--;)ca[ua].clip&&ca[ua].clip(qa,Pa,x,ka,n);qa.closePath();
qa.clip()}qa.globalCompositeOperation="source-over";for(ua=za;ua--;){na=ca[ua];if(na.shouldDraw(Ha,ab)){var wa=na.style,La=wa?ma.apply(qa,wa):null;na.draw(qa,Pa,x,ka,n,Ea);La&&ma.apply(qa,La)}}}finally{qa.restore()}hb=0;Qa("drawComplete",X,n);if(Ea){na=Ea?Ea.elements:[];if(Va&&Va.type==="hover"){wa=Hits.diffHits(Va.elements,na);wa.length>0&&Hits.triggerEvent(Va,ka,"Out",wa)}if(na.length>0){La=Ea.x;x=Ea.y;for(wa=na.length;wa--;){X=na[wa];T=La;n=x;if(ua=X&&X.drag&&(!X.canDrag||X.canDrag(X,T,n))){Ga=
X;Ga.startX=T;Ga.startY=n}if(ua)break}Hits.triggerEvent(Ea,ka)}Va=na.length>0?COG.extend({},Ea):null;Ea=null}l-xb>Bb&&Ra();Cb=l;ib=ea;jb=fa;animFrame(E)}else ob=false}function Q(l,n,x){Ea=Hits.init(l,n,x,m(x.x,x.y,true));for(l=za;l--;)pb=pb||(ca[l].hitGuess?ca[l].hitGuess(Ea.x,Ea.y,Ha,ka):false);pb&&F()}function F(){hb+=1;if(!ob){ob=true;animFrame(E)}}function ja(){return J.init(ea,fa,ea+ta,fa+sa)}function Ra(){if(Ia||Ja){var l=db?ea+Ma:ea,n=eb?fa+Na:fa;if(Ia&&Ia>ta)if(l+ta>Ia)ea=db?l-Ia>0?ea-Ia:
ea:Ia-ta;else if(l<0)ea=db?ea+Ia:0;if(Ja&&Ja>sa)if(n+sa>Ja)fa=eb?n-Ja>0?fa-Ja:fa:Ja-sa;else if(n<0)fa=eb?fa+Ja:0}xb=(new Date).getTime();Qa("refresh",ka,ja());F()}function Ka(l,n,x,T,X){if(x)COG.tweenValue(la,l,x,X,function(na,ua){la=na;if(ua){var va=xa(oa(la)/Math.LN2);la=S(2,va);T&&T()}c(n);b()});else{la=l;c(n);b()}return ka}function tb(l,n,x){l=W(a.minZoom,P(a.maxZoom,l));if(l!==Ta){var T=S(2,l-Ta),X=Ma/T|0,na=Na/T|0;Ta=l;Xa(((n?n:ea+Ma)-X)*T,((x?x:fa+Na)-na)*T);ib=ea;jb=fa;Qa("zoomLevelChange",
l);la=1;Ra()}}function Qa(){for(var l=ka.trigger.apply(null,arguments).cancel,n=ca.length;n--;)l=ca[n].trigger.apply(null,arguments).cancel||l;return!l}function Xa(l,n,x,T,X){function na(){ua+=1;if(ua>=2){lb=false;X&&X()}}var ua=0,va=cb?L.offset(cb,-Ma,-Na):null,wa=bb?L.offset(bb,-Ma,-Na):null;if(va){l=l<va.x?va.x:l;n=n<va.y?va.y:n}if(wa){l=l>wa.x?wa.x:l;n=n>wa.y?wa.y:n}if(x){if((Ha&kb)===0){COG.tweenValue(ea,l,x,T,function(La,qb){ea=La|0;(qb?na:F)();return!nb});COG.tweenValue(fa,n,x,T,function(La,
qb){fa=La|0;(qb?na:F)();return!nb});lb=true}}else{ea=l|0;fa=n|0;F();X&&X()}}a=COG.extend({id:COG.objId("view"),container:"",captureHover:true,captureDrag:false,fastDraw:false,inertia:true,minRefresh:1E3,pannable:false,clipping:true,scalable:false,panAnimationEasing:COG.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,autoSize:true,tapExtent:10,guides:false,turbo:false,fps:25,minZoom:1,maxZoom:1,zoomEasing:COG.easing("quad.out"),zoomDuration:300,zoomLevel:1},a);var ca=[],za=
0,pa=document.getElementById(a.container),Ga=null,qa=null,Db=typeof window.attachEvent!="undefined",$a,pb=false,Bb=a.minRefresh,ea=0,fa=0,ib=0,jb=0,Ia=null,Ja=null,db=false,eb=false,Ab=a.clipping,ab=null,ob=false,Pa,yb=1,Ma=0,Na=0,Ea=null,fb=null,Ua=null,nb=false,cb=null,bb=null,xb=0,Va=null,ub=0,la=1,Cb=0,gb=false,Aa=null,lb=false,sa,ta,hb=0,Ya,Za,Ta=a.zoomLevel,vb=p("ACTIVE"),kb=p("PAN"),wb=p("ZOOM"),mb=p("ANIMATING"),Ha=vb,ka={id:a.id,deviceScaling:yb,fastDraw:a.fastDraw||D().requireFastDraw,detach:function(){Aa&&
Aa.unbind()},eachLayer:function(l){for(var n=za;n--;)l(ca[n])},getDimensions:function(){return da.init(ta,sa)},getLayer:function(l){for(var n=0;n<za;n++)if(ca[n].getId()==l)return ca[n];return null},getZoomLevel:function(){return Ta},setLayer:function(l,n){for(var x=0;x<za;x++)if(ca[x].getId()===l){ca.splice(x,1);break}if(n){$(l,n);n.trigger("refresh",ka,ja())}F();return n},invalidate:F,refresh:Ra,resetScale:function(){la=1},resize:function(l,n){if(pa){a.autoSize=false;if(ta!==l||sa!==n)Z(l,n)}},
scale:Ka,setZoomLevel:tb,syncXY:function(){},triggerAll:Qa,removeLayer:function(l){a:{for(var n=za;n--;)if(ca[n].getId()==l){l=n;break a}l=-1}if(l>=0&&l<za){ka.trigger("layerRemoved",ca[l]);ca.splice(l,1);F()}za=ca.length},getOffset:function(){return L.init(ea,fa)},setMaxOffset:function(l,n,x,T){Ia=l;Ja=n;db=typeof x!="undefined"?x:false;eb=typeof T!="undefined"?T:false},getViewRect:ja,updateOffset:Xa,pan:function(l,n,x,T,X){Xa(ea+l,fa+n,x,T,X)}};yb=D().getScaling();COG.observable(ka);ka.bind("invalidate",
function(){F()});ka.bind("resync",function(){bb=cb=null});COG.configurable(ka,["container","captureHover","captureDrag","scalable","pannable","inertia","minZoom","maxZoom","zoom"],COG.paramTweaker(a,null,{container:function(l,n){pa=document.getElementById(n);Z()},inertia:M,captureHover:M,scalable:M,pannable:M}),true);CANI.init(function(l){ka.markers=$("markers",new sb({zindex:20}));canvasCaps=l.canvas;Z();if(a.autoSize)Db?window.attachEvent("onresize",A):window.addEventListener("resize",A,false)});
return ka},ViewLayer:ya,ImageLayer:function(a,i){function d(j,t,A){for(t=h.length;t--;){var K=h[t],Z=K.x,$=K.y,M=J.init(K.x,K.y,K.x+K.width,K.y+K.height);if(A&&J.intersect(j,M))(M=V.get(K.url,function(){w.changed()},q))&&A(M,Z,$,K.width,K.height)}}function b(j){var t=++m,A=w.getParent();c&&c.run(A,j,function(K){if(t==m){h=[].concat(K);A.invalidate()}})}i=COG.extend({imageLoadArgs:{}},i);var c=a?O.init(a,i):null,m=0,h=[],q=i.imageLoadArgs,w=COG.extend(new ya(i),{changeGenerator:function(j,t){c=O.init(j,
COG.extend({},i,t));h=null;b(w.getParent().getViewRect())},clip:function(j,t,A){var K=t.x1,Z=t.y1;d(t,A,function($,M,k,E,Q){j.rect(M-K,k-Z,E,Q)})},draw:function(j,t,A){var K=t.x1,Z=t.y1;d(t,A,function($,M,k){j.drawImage($,M-K,k-Z,$.width,$.height)})},mask:function(j,t,A){d(t,A,function(K,Z,$,M,k){COG.info("clearing rect @ x = "+Z+", y = "+$+", width = "+M+", height = "+k);j.clearRect(Z,$,M,k)})}});w.bind("refresh",function(j,t,A){b(A)});w.bind("tap",function(j,t,A,K){j=[];var Z=K.x,$=K.y,M,k;if(h)for(var E=
h.length;E--;){M=h[E];if(k=Z>=M.x&&Z<=M.x+M.width&&$>=M.y&&$<=M.y+M.height)j[j.length]=M}j.length>0&&w.trigger("tapImage",j,t,A,K)});return w},ImageGenerator:function(a){a=COG.extend({relative:false,padding:2},a);a={run:function(){COG.warn("running base generator - this should be overriden")}};COG.observable(a);return a},Drawable:Da,Poly:Sa,Line:rb,ImageDrawable:Oa,ImageMarker:Wa,ShapeLayer:sb,transformable:z,Tiling:zb});COG.observable(G)})(T5);
