if(!this.JSON)this.JSON={};
(function(){function f(p){return p<10?"0"+p:p}function c(p){d.lastIndex=0;return d.test(p)?'"'+p.replace(d,function(j){var t=g[j];return typeof t==="string"?t:"\\u"+("0000"+j.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+p+'"'}function b(p,j){var t,o,i,k,n=e,q,m=j[p];if(m&&typeof m==="object"&&typeof m.toJSON==="function")m=m.toJSON(p);if(typeof l==="function")m=l.call(j,p,m);switch(typeof m){case "string":return c(m);case "number":return isFinite(m)?String(m):"null";case "boolean":case "null":return String(m);
case "object":if(!m)return"null";e+=h;q=[];if(Object.prototype.toString.apply(m)==="[object Array]"){k=m.length;for(t=0;t<k;t+=1)q[t]=b(t,m)||"null";i=q.length===0?"[]":e?"[\n"+e+q.join(",\n"+e)+"\n"+n+"]":"["+q.join(",")+"]";e=n;return i}if(l&&typeof l==="object"){k=l.length;for(t=0;t<k;t+=1){o=l[t];if(typeof o==="string")if(i=b(o,m))q.push(c(o)+(e?": ":":")+i)}}else for(o in m)if(Object.hasOwnProperty.call(m,o))if(i=b(o,m))q.push(c(o)+(e?": ":":")+i);i=q.length===0?"{}":e?"{\n"+e+q.join(",\n"+e)+
"\n"+n+"}":"{"+q.join(",")+"}";e=n;return i}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var a=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
d=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e,h,g={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},l;if(typeof JSON.stringify!=="function")JSON.stringify=function(p,j,t){var o;h=e="";if(typeof t==="number")for(o=0;o<t;o+=1)h+=" ";else if(typeof t==="string")h=t;if((l=j)&&typeof j!=="function"&&(typeof j!=="object"||typeof j.length!=="number"))throw Error("JSON.stringify");return b("",
{"":p})};if(typeof JSON.parse!=="function")JSON.parse=function(p,j){function t(i,k){var n,q,m=i[k];if(m&&typeof m==="object")for(n in m)if(Object.hasOwnProperty.call(m,n)){q=t(m,n);if(q!==undefined)m[n]=q;else delete m[n]}return j.call(i,k,m)}var o;p=String(p);a.lastIndex=0;if(a.test(p))p=p.replace(a,function(i){return"\\u"+("0000"+i.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(p.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){o=eval("("+p+")");return typeof j==="function"?t({"":o},""):o}throw new SyntaxError("JSON.parse");}})();if(!String.format)String.format=function(f){if(arguments.length<=1)return f;for(var c=arguments.length-2,b=0;b<=c;b++)f=f.replace(RegExp("\\{"+b+"\\}","gi"),arguments[b+1]);return f};
String.prototype.containsWord=function(f){var c="";if(f.toString)f=f.toString();for(var b=0;b<f.length;b++)c+=!/\w/.test(f[b])?"\\"+f[b]:f[b];return RegExp("(^|\\s|\\,)"+c+"(\\,|\\s|$)","i").test(this)};Number.prototype.toRad=function(){return this*Math.PI/180};Number.prototype.sec=function(){return 1/Math.cos(this)};
GRUNT=function(){var f=Object.prototype.hasOwnProperty,c=0,b={id:"GRUNT.core",extend:function(){var a=arguments[0]||{},d=1,e=arguments.length,h=false,g,l,p,j;if(typeof a==="boolean"){h=a;a=arguments[1]||{};d=2}if(typeof a!=="object"&&!b.isFunction(a))a={};if(e===d){a=this;--d}for(;d<e;d++)if((g=arguments[d])!=null)for(l in g){p=a[l];j=g[l];if(a!==j)if(h&&j&&(b.isPlainObject(j)||b.isArray(j))){p=p&&(b.isPlainObject(p)||b.isArray(p))?p:b.isArray(j)?[]:{};a[l]=b.extend(h,p,j)}else if(j!==undefined)a[l]=
j}return a},isFunction:function(a){return toString.call(a)==="[object Function]"},isArray:function(a){return toString.call(a)==="[object Array]"},isPlainObject:function(a){if(!a||toString.call(a)!=="[object Object]"||a.nodeType||a.setInterval)return false;if(a.constructor&&!f.call(a,"constructor")&&!f.call(a.constructor.prototype,"isPrototypeOf"))return false;var d;for(d in a);return d===undefined||f.call(a,d)},isEmptyObject:function(a){for(var d in a)return false;return true},isXmlDocument:function(a){return toString.call(a)===
"[object Document]"},contains:function(a,d){var e=a,h=arguments,g=1;if(d&&b.isArray(d)){h=d;g=0}for(g=g;g<h;g++)e=e&&typeof foo[h[g]]!=="undefined";return e},newModule:function(a){a=b.extend({id:null,requires:[],parent:null},a);if(a.parent)a=b.extend({},a.parent,a);return a},toID:function(a){return a.replace(/\s/g,"-")},generateObjectID:function(a){return(a?a:"obj")+c++}};return b}();
GRUNT.Log=function(){function f(e,h){var g,l=h&&h.length>0?h[0]:"";for(g=1;h&&g<h.length;g++)l+=" "+(b&&GRUNT.isPlainObject(h[g])?JSON.stringify(h[g]):h[g]);typeof console!=="undefined"&&console[e](l);for(g=0;g<c.length;g++)c[g].call(d,l,e)}var c=[],b=typeof JSON!=="undefined",a=window.console&&window.console.markTimeline,d={id:"GRUNT.log",getTraceTicks:function(){return a?(new Date).getTime():null},trace:function(e,h){if(a)console.markTimeline(e+(h?": "+(d.getTraceTicks()-h)+"ms":""))},debug:function(){f("debug",
arguments)},info:function(){f("info",arguments)},warn:function(){f("warn",arguments)},error:function(){f("error",arguments)},exception:function(e){d.error(arguments);for(var h in e)d.info("ERROR DETAIL: "+h+": "+e[h])},watch:function(e,h){try{h()}catch(g){d.exception(g,e)}},throwError:function(e){d.error(e);throw Error(e);},requestUpdates:function(e){c.push(e)}};return d}();
GRUNT.Data=function(){var f={determineObjectMapping:function(b){if(!b)return null;b=b.split("|");for(var a={},d=0;d<b.length;d++)a[b[d]]=d;return a},mapLineToObject:function(b,a){var d=b.split("|"),e={};for(var h in a){var g=a[h];e[h]=d.length>g?d[g]:null}return e},parse:function(b){var a=null,d=[];b=b.split("\n");for(var e=0;e<b.length;e++){var h=b[e];if(a)d.push(f.mapLineToObject(h,a));else a=f.determineObjectMapping(h)}return d}},c={supportedFormats:{JSON:{parse:function(b){return JSON.parse(b)}},
PDON:{parse:function(b){return f.parse(b)}}},parse:function(b){b=GRUNT.extend({data:"",format:"JSON"},b);if(!c.supportedFormats[b.format])throw Error("Unsupported data format: "+b.format+", cannot parse data in javascript object");try{return c.supportedFormats[b.format].parse(b.data)}catch(a){GRUNT.Log.error("ERROR PARSING DATA FROM FORMAT: "+b.format,b.data);GRUNT.Log.exception(a)}return{}}};return c}();
GRUNT.paramTweaker=function(f,c,b){return function(a,d){if(typeof d!=="undefined"){if(a in f)f[a]=d;b&&a in b&&b[a](a,d)}else return c&&a in c?c[a](a):f[a]}};
GRUNT.configurable=function(f,c,b,a){function d(e){f[e]||(f[e]=function(h){return f.configure(e,h)})}if(f){if(!f.configurableSettings){f.configurableId=GRUNT.generateObjectID("configurable");f.configurableSettings={};f.configCallbacks=[];if(!GRUNT.configurables)GRUNT.configurables={}}GRUNT.configurables[f.configurableId]=f;f.configCallbacks.push(b);for(b=c.length;b--;){f.configurableSettings[c[b]]=true;a&&d(c[b])}if(!f.configure)f.configure=function(e,h){var g=f.configCallbacks;if(f.configurableSettings[e]){for(var l=
g.length;l--;){var p=g[l](e,h);if(typeof p!=="undefined")return p}return GRUNT.configurables[f.configurableId]}return null}}};GRUNT.Template=function(){var f=/\$\{(.*?)\}/ig;return{parse:function(c,b){for(var a=c,d=f.exec(a);d;){a=a.replace(d[0],GRUNT.XPath.first(d[1],b));f.lastIndex=0;d=f.exec(a)}return a}}}();
GRUNT.JSONP=function(){function f(d){var e=document.createElement("script"),h=false;e.src=d;e.async=true;e.onload=e.onreadystatechange=function(){if(!h&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){h=true;e.onload=e.onreadystatechange=null;e&&e.parentNode&&e.parentNode.removeChild(e)}};b||(b=document.getElementsByTagName("head")[0]);b.appendChild(e)}var c=0,b,a=this;return{get:function(d,e,h){d+=d.indexOf("?")>=0?"&":"?";var g="json"+ ++c;a[g]=function(l){e(l);a[g]=
null;try{delete a[g]}catch(p){}};f(d+(h?h:"callback")+"="+g);return g}}}();
GRUNT.XHR=function(){var f={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},c={JSON:["json"],PDON:["pdon.txt"]},b=["TEXT","STREAM"],a=/^(\w+:)?\/\/([^\/?#]+)/,d={XML:function(g){return g.responseXML},JSON:function(g){try{return JSON.parse(g.responseText)}catch(l){GRUNT.Log.error("Error parsing JSON data: ",g.responseText);GRUNT.Log.exception(l)}return""},PDON:function(g){return GRUNT.Data.parse({data:g.responseText,format:"PDON"})},DEFAULT:function(g){return g.responseText}},
e={CONTENT_TYPE:"Content-Type"},h=GRUNT.newModule({id:"GRUNT.xhr",ajaxSettings:{xhr:null},ajax:function(g){try{g=GRUNT.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},h.ajaxSettings,g);var l=a.exec(g.url),p=l&&(l[1]&&l[1]!==location.protocol||l[2]!==location.host);if(g.data)g.method="POST";if(g.url){l=null;if(g.xhr)l=g.xhr(g);l||(l=new XMLHttpRequest);l.open(g.method,g.url,g.async);g.data&&l.setRequestHeader("Content-Type",
g.contentType);p||l.setRequestHeader("X-Requested-With","XMLHttpRequest");l.onreadystatechange=function(){if(this.readyState===4){var t=null,o=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(o)if(g.handleResponse)g.handleResponse(this);else{var i=g,k=this.getResponseHeader(e.CONTENT_TYPE),n,q=false;for(n in f)if(k&&k.indexOf(f[n])>=0){q=true;break}k=!q;for(q=0;q<b.length;q++)k=k||b[q]==n;if(k)b:{k=n;for(var m in c)for(q=
0;q<c[m].length;q++)if(RegExp(c[m][q]+"$","i").test(i.url)){n=m;break b}n=k?k:"DEFAULT"}try{t=d[n](this,i)}catch(x){GRUNT.Log.warn("error applying processor '"+n+"' to response type, falling back to default");t=d.DEFAULT(this,i)}}else g.error&&g.error(this)}catch(v){GRUNT.Log.exception(v,"PROCESSING AJAX RESPONSE")}o&&t&&g.success&&g.success.call(this,t)}};l.send(g.method=="POST"?h.param(g.data):null)}else GRUNT.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(j){GRUNT.Log.exception(j)}},
param:function(g){var l=[],p=function(t,o){o=GRUNT.isFunction(o)?o():o;l[l.length]=encodeURIComponent(t)+"="+encodeURIComponent(o)};if(GRUNT.isArray(g))for(var j=0;j<g.length;j++)p(g[j].name,g[j].value);else for(j in g)p(j,g[j]);return l.join("&").replace(/%20/g,"+")}});return h}();
GRUNT.XPath=function(){function f(d){for(var e=null,h=0;h<c.length;h++)if(e=c[h](d))break;return e}var c=[],b=[null,function(d){return d.numberValue},function(d){return d.stringValue},function(d){return d.booleanValue},null,null,null,null,function(d){return d.singleNodeValue?d.singleNodeValue.textContent:null},function(d){return d.singleNodeValue?d.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||GRUNT.Log.warn("No XPATH support, this is going to cause problems");var a={SearchResult:function(d){return{toString:function(){var e=
null;if(d){var h=null;if(d.resultType>=0&&d.resultType<b.length)h=b[d.resultType];if(h){GRUNT.Log.info("invoking match handler for result type: "+d.resultType);e=h(d)}}return e?e:""}}},first:function(d,e){var h=a.SearchResult,g;var l=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!l)l=XPathResult.ANY_TYPE;try{if(GRUNT.isXmlDocument(e))g=e.evaluate(d,e,f,l,null);else{GRUNT.Log.warn("attempted xpath expression: "+d+" on a non-xml document");g=null}}catch(p){GRUNT.Log.warn("attempted to run invalid xpath expression: "+
d+" on node: "+e);g=null}return new h(g)},registerResolver:function(d){c.push(d)}};return a}();
GRUNT.observable=function(f){if(f){if(!f.observableHandlers)f.observableHandlers={};if(!(f.bind||f.trigger||f.unbind)){f.bind=function(c,b){var a=GRUNT.generateObjectID("callback"),d=f.observableHandlers;d[c]||(d[c]=[]);f.observableHandlers[c].push({callback:b,callbackId:a});return a};f.trigger=function(c){var b=f.observableHandlers[c];if(!b)return f;for(var a=b.length;a--;)b[a].callback.apply(self,Array.prototype.slice.call(arguments,1));return f};f.unbind=function(c,b){for(var a=f.observableHandlers[c],
d=0;a&&d<a.length;d++)if(a[d].callbackId===b){a.splice(d,1);break}return f}}}};GRUNT.WaterCooler=function(){var f={},c=[];return{addPipe:function(b){b("pipe.test",{});c.push(b)},listen:function(b,a){f[b]||(f[b]=[]);a&&f[b].push(a)},say:function(b,a){var d;for(d=c.length;d--;)c[d](b,a);if(f[b])for(d=f[b].length;d--;)f[b][d](a)},leave:function(){}}}();
GRUNT.Storage=function(){function f(c){if(c&&c=="session")return sessionStorage;return localStorage}return{get:function(c,b){var a=f(b).getItem(c);return/^(\{|\[).*(\}|\])$/.test(a)?JSON.parse(a):a},set:function(c,b,a){b=jQuery.isArray(b)||jQuery.isPlainObject(b)?JSON.stringify(b):b;f(a).setItem(c,b)},remove:function(c,b){f(b).removeItem(c)}}}();
GRUNT.ParseRules=function(){var f=[];return{add:function(c,b){f.push({regex:c,handler:b})},each:function(c,b,a){function d(){e++;a&&e>=f.length&&a(b)}for(var e=0,h=0;h<f.length;h++){var g=f[h].regex,l=f[h].handler,p=false;if(g){g.lastIndex=-1;if((g=g.exec(c))&&l){p=true;l(g,b,d)&&d()}}p||d()}}}};
T5=function(){var f={ex:GRUNT.extend,newCanvas:function(c,b){var a=document.createElement("canvas");typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(a);a.width=c?c:0;a.height=b?b:0;return a},time:function(){return(new Date).getTime()},Settings:function(){var c={};return{get:function(b){return c[b]},set:function(b,a){c[b]=a},extend:function(b){T5.ex(c,b)}}}(),Vector:function(c,b){return{x:c?c:0,y:b?b:0}},V:function(){function c(b){if(!b||b.length<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");
for(var a={edges:Array(b.length-1),accrued:Array(b.length-1),total:0},d=T5.V.diff,e=0;e<b.length-1;e++){var h=d(b[e],b[e+1]);a.edges[e]=Math.sqrt(h.x*h.x+h.y*h.y);a.accrued[e]=a.total+a.edges[e];a.total+=a.edges[e]}return a}return{create:function(b,a){return new f.Vector(b,a)},add:function(){for(var b=new f.Vector,a=arguments.length;a--;){b.x+=arguments[a].x;b.y+=arguments[a].y}return b},absSize:function(b){return Math.max(Math.abs(b.x),Math.abs(b.y))},diff:function(b,a){return new f.Vector(b.x-a.x,
b.y-a.y)},copy:function(b){return b?new f.Vector(b.x,b.y):null},invert:function(b){return new T5.Vector(-b.x,-b.y)},offset:function(b,a,d){return new T5.Vector(b.x+a,b.y+(d?d:a))},edges:c,distance:function(b){return c(b).total},theta:function(b,a,d){d=Math.asin((b.y-a.y)/d);return b.x>a.x?d:Math.PI-d},pointOnEdge:function(b,a,d,e){a=new T5.Vector(Math.cos(d)*e,Math.sin(d)*e);return new T5.Vector(b.x-a.x,b.y-a.y)},getRect:function(b){var a=b.length;if(a>1)return new T5.Rect(Math.min(b[0].x,b[a-1].x),
Math.min(b[0].y,b[a-1].y),Math.abs(b[0].x-b[a-1].x),Math.abs(b[0].y-b[a-1].y))},toString:function(b){return b.x+", "+b.y}}}(),Dimensions:function(c,b){return{width:c?c:0,height:b?b:0}},D:function(){return{getAspectRatio:function(c){return c.height!==0?c.width/c.height:1},getCenter:function(c){return new f.Vector(c.width/2,c.height/2)},getSize:function(c){return Math.sqrt(Math.pow(c.width,2)+Math.pow(c.height,2))}}}(),Rect:function(c,b,a,d){return{origin:new f.Vector(c,b),dimensions:new f.Dimensions(a,
d)}},R:function(){return{copy:function(c){return c?new f.Rect(c.origin.x,c.origin.y,c.dimensions.width,c.dimensions.height):null},getCenter:function(c){return new T5.Vector(c.origin.x+c.dimensions.width/2,c.origin.y+c.dimensions.height/2)}}}()};return f}();
T5.Device=function(){function f(){for(;j.length>0;){var o=j.shift();document.location=o}p=0}function c(o){for(var i=true,k=t.length;k--;)i=i&&o!=t[k];return i}function b(o,i){var k=[];for(var n in i)n&&k.push(n+"="+escape(i[n]));return"tile5://"+o+"/"+(k.length>0?"?"+k.join("&"):"")}function a(o,i){c(o)&&GRUNT.Log.info("would push url: "+b(o,i))}function d(o,i){if(c(o)){j.push(b(o,i));p||(p=setTimeout(f,100))}}function e(){h={base:{name:"Unknown",eventTarget:document,supportsTouch:"createTouch"in
document,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:a,targetFps:null},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:d,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:d},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:d},android:{name:"Android OS <= 2.1",regex:/android/i,eventTarget:document.body,
supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},bridgeNotify:d},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:d}};g=[h.froyo,h.android,h.ipod,h.iphone,h.ipad]}var h=null,g=[],l=null,p=0,j=[],t=["view.wake","tile.loaded"];return{getConfig:function(){h||e();if(!l){GRUNT.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var o=0;o<g.length;o++){var i=g[o];if(i.regex&&i.regex.test(navigator.userAgent)){l=
T5.ex({},h.base,i);GRUNT.Log.info("PLATFORM DETECTED AS: "+l.name);break}}if(!l){GRUNT.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");l=h.base}GRUNT.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return l}}}();
T5.Dispatcher=function(){var f=[],c={execute:function(b){var a=c.findAction(b);a&&a.execute.apply(a,Array.prototype.slice.call(arguments,1))},findAction:function(b){for(var a=f.length;a--;)if(f[a].id==b)return f[a];return null},getRegisteredActions:function(){return[].concat(f)},getRegisteredActionIds:function(){for(var b=[],a=f.length;a--;)f[a].id&&b.push(f[a].id);return b},registerAction:function(b){b&&b.id&&f.push(b)},Action:function(b){b=T5.ex({autoRegister:true,id:"",title:"",icon:"",execute:null},
b);var a={id:b.id,execute:function(){b.execute&&b.execute.apply(this,arguments)},getParam:function(d){return b[d]?b[d]:""},toString:function(){return String.format("{0} [title = {1}, icon = {2}]",a.id,b.title,b.icon)}};b.autoRegister&&c.registerAction(a);return a},Agent:function(b){b=GRUNT.extend({name:"Untitled",translator:null,execute:null},b);var a={getName:function(){return b.name},getParam:function(d){return b[d]},getId:function(){return GRUNT.toID(a.getName())},run:function(d,e){if(b.execute){var h=
b.translator?b.translator(d):d;b.execute.call(a,h,function(g,l){e&&e(g,l,h)})}}};return a},runAgents:function(b,a,d){for(var e=0;e<b.length;e++)b[e].run(a,d)}};return c}();
T5.Resources=function(){var f="",c={},b={getPath:function(a){return/^(file|https?|\/)/.test(a)?a:f+a},setBasePath:function(a){f=a},loadResource:function(a){a=T5.ex({filename:"",cacheable:true,dataType:null,callback:null},a);var d=function(e){a.callback&&GRUNT.Log.watch("CALLING RESOURCE CALLBACK",function(){a.callback(e)})};a.cacheable&&c[a.filename]?d(c[a.filename]):GRUNT.XHR.ajax({url:b.getPath(a.filename),dataType:a.dataType,success:function(e){if(a.cacheable)c[a.filename]=e;d(e)},error:function(e,
h,g){GRUNT.Log.error("error loading resource ["+a.filename+"], error = "+g)}})},loadSnippet:function(a,d){/\.\w+$/.test(a)||(a+=".html");b.loadResource({filename:"snippets/"+a,callback:d,dataType:"html"})}};return b}();
T5.Images=function(){function f(){var k=e[this.id];if(k&&k.image.complete&&k.image.width>0){k.loaded=true;k.hitCount=1;for(var n=l.length;n--;)if(l[n].image.src==this.src){l.splice(n,1);break}if(k.background||k.postProcess)if(k.image){n=T5.newCanvas(k.realSize?k.realSize.width:image.width,k.realSize?k.realSize.height:image.height);var q=n.getContext("2d"),m=k.offset?k.offset:new T5.Vector;k.background&&q.drawImage(k.background,0,0);q.drawImage(k.image,m.x,m.y);k.postProcess&&k.postProcess(q,k);k.image=
n}k.loadCallback&&k.loadCallback(this,false);p.push({url:this.src,created:k.requested});delete e[this.id];c()}}function c(){for(var k=T5.Device.getConfig().maxImageLoads;g.length>0&&(!k||l.length<k);){var n=g.shift();if(n.imageLoader){l.push(n);n.imageLoader(n,f)}}}function b(k){for(var n=null,q=j.length;q--&&!n;)n=j[q](k);return n?n:function(m,x){m.image.onload=x;m.image.src=T5.Resources.getPath(m.url);m.requested=T5.time()}}function a(){o=true;try{var k=Math.floor(p.length/2);if(k>0){p.sort(function(q,
m){return q.created-m.created});for(var n=k;n--;)delete d[p[n].url];p.splice(0,k)}}finally{o=false}GRUNT.WaterCooler.say("imagecache.cleared")}var d={},e={},h=0,g=[],l=[],p=[],j=[],t=0,o=false,i={avgImageSize:25,loadTimeout:10,addInterceptor:function(k){j.push(k)},cancelLoad:function(){l=[]},get:function(k){var n=null,q=null;o||(n=d[k]);if((q=n?n.image:null)&&(q.getContext||q.complete&&q.width>0))return q},load:function(k,n,q){var m=d[k];if(m){m.hitCount++;m.image.complete&&n&&n(m.image,true)}else{m=
T5.ex({url:k,image:new Image,loaded:false,imageLoader:b(k),created:T5.time(),requested:null,hitCount:0,loadCallback:n},q);m.image.id="resourceLoaderImage"+h++;d[k]=m;e[m.image.id]=m;g.push(m);c()}return m},stats:function(){return{imageLoadingCount:l.length,queuedImageCount:g.length,imageCacheFullness:t}}};setInterval(function(){for(var k=T5.time(),n=false,q=0,m=T5.Device.getConfig();q<l.length;)if(k-l[q].requested>i.loadTimeout*1E3){l.splice(q,1);n=true}else q++;n&&c();if(m&&m.imageCacheMaxSize){t=
p.length*i.avgImageSize/m.imageCacheMaxSize;t>=1&&a()}},1E3);return i}();
T5.Touch=function(){function f(i,k){var n=i&&i.length>0?i[0]:null;if(n&&k&&k.length>0)return T5.V.diff(n,k[0]);return null}function c(i){i.preventDefault();i.stopPropagation()}function b(i){for(var k=Array(i.length),n=i.length;n--;)k[n]=new T5.Vector(i[n].pageX,i[n].pageY);return k}function a(i){return[new T5.Vector(i.pageX,i.pageY)]}var d=120,e=100,h=250,g={TAP:0,MOVE:1,PINCHZOOM:2},l=7,p=0,j=0,t=function(i){function k(s,w,C,z){var L=Math.asin((s.y-w.y)/C);C=Math.min(Math.floor(C*(V.duration/z)),
V.max);L=w.x>s.x?L:Math.PI-L;s=new T5.Vector(Math.cos(L)*-C,Math.sin(L)*C);m("inertiaPan",s.x,s.y)}function n(s,w){var C,z;if(I){C=w-W;if(C<h){z=T5.V.distance([D[0],s]);z>i.inertiaTrigger&&k(D[0],s,z,C)}}else{R=s;var L=setInterval(function(){C=T5.time()-w;z=T5.V.distance([s,R]);if(C<e&&z>i.inertiaTrigger){clearInterval(L);k(s,R,z,C)}else C>e&&clearInterval(L)},5)}}function q(s){for(var w=[],C=i.element?-i.element.offsetLeft:0,z=i.element?-i.element.offsetTop:0,L=s.length;L--;)w.push(T5.V.offset(s[L],
C,z));return w}function m(){i.observable&&i.observable.trigger.apply(null,arguments)}function x(s){if(s.target&&s.target===i.element){D=I?b(s.touches):a(s);Q=new T5.Vector;M=new T5.Vector;U=true;J=false;W=T5.time();c(s);s.target.style.cursor="move";m("inertiaCancel");S.current=W;if(s=D.length>0?D[0]:null){m("touchStart",s.x,s.y);if(S.current-S.last<ca.THRESHOLD_DOUBLETAP)if((s=P?T5.V.diff(D[0],P[0]):null)&&Math.abs(s.x)<i.maxDistDoubleTap&&Math.abs(s.y)<i.maxDistDoubleTap)J=true;N=g.TAP;P=[].concat(D)}else GRUNT.Log.warn("Touch start fired, but no touch vector found")}}
function v(s){if(s.target&&s.target===i.element){R=(I?b(s.touches):a(s))[0];if(U){I&&c(s);s=I?b(s.touches):a(s);var w=0;if(s.length>1){if(D.length===1)D=[].concat(s);w=T5.V.distance(D)-T5.V.distance(s)}if(N===g.TAP){var C=f(s,D);if(C&&(Math.abs(C.x)>=l||Math.abs(C.y)>=l))N=g.MOVE}if(N!==g.TAP)if(!w||Math.abs(w)<i.pinchZoomThreshold){if(Q=f(s,P)){M.x-=Q.x;M.y-=Q.y;G.x-=Q.x;G.y-=Q.y}if(T5.V.absSize(G)>i.panEventThreshhold){m("pan",G.x,G.y);G=T5.V.create()}N=g.MOVE}else{m("pinchZoom",q(D),q(s));N=g.PINCHZOOM}P=
[].concat(s)}}}function B(s){if(s.target&&s.target===i.element){var w=(I?b(s.changedTouches):a(s))[0];I&&c(s);var C=T5.time();S.last=S.current;if(N===g.TAP)H||(H=setTimeout(function(){H=0;var z=J?"doubleTap":"tap",L=D[0],Z=null;if(i.element)Z=T5.V.offset(L,-i.element.offsetLeft,-i.element.offsetTop);m(z,L,Z)},ca.THRESHOLD_DOUBLETAP+50));else if(N==g.MOVE){m("panEnd",M.x,M.y);V&&n(w,C)}else N==g.PINCHZOOM&&m("pinchZoomEnd",q(D),q(P),C-W);s.target.style.cursor="default";U=false}}function A(s){if(s.target&&
s.target===i.element){var w;if(s.detail){w=-s.detail*d;w=new T5.Vector(s.axis===1?w:0,s.axis===2?w:0)}else w=new T5.Vector(s.wheelDeltaX,s.wheelDeltaY);var C=w.y!==0?Math.abs(w.y/d):0;if(R&&C!==0){var z=T5.V.offset(R,-i.element.offsetLeft,-i.element.offsetTop);m("wheelZoom",z,Math.pow(2,w.y>0?C:-C))}s.preventDefault()}}i=T5.ex({element:null,observable:null,inertiaTrigger:20,maxDistDoubleTap:20,panEventThreshhold:0,pinchZoomThreshold:5,touchStartHandler:null,moveHandler:null,moveEndHandler:null,pinchZoomHandler:null,
pinchZoomEndHandler:null,tapHandler:null,doubleTapHandler:null,wheelZoomHandler:null},i);var J=false,H=0,I=T5.Device.getConfig().supportsTouch,D=null,P=null,Q=null,M=null,G=new T5.Vector,N=null,U=false,W=0,X=[],R=null,V=null,S={current:0,last:0},K=T5.Device.getConfig(),ca={supportsTouch:I,THRESHOLD_DOUBLETAP:300,addListeners:function(s){X.push(s)},decoupleListeners:function(s){for(var w=0;s&&w<X.length;w++)if(X[w].listenerId===s){X.splice(w,1);GRUNT.Log.info("successfully decoupled touch listener: "+
s);break}},release:function(){K.eventTarget.removeEventListener(K.supportsTouch?"touchstart":"mousedown",x,false);K.eventTarget.removeEventListener(K.supportsTouch?"touchmove":"mousemove",v,false);K.eventTarget.removeEventListener(K.supportsTouch?"touchend":"mouseup",B,false);if(!K.supportsTouch){window.removeEventListener("mousewheel",A,false);window.removeEventListener("DOMMouseScroll",A,false)}},inertiaEnable:function(s,w){V={duration:s,max:w?Math.min(w.width,w.height):500}},inertiaDisable:function(){V=
null}};K.eventTarget.addEventListener(K.supportsTouch?"touchstart":"mousedown",x,false);K.eventTarget.addEventListener(K.supportsTouch?"touchmove":"mousemove",v,false);K.eventTarget.addEventListener(K.supportsTouch?"touchend":"mouseup",B,false);if(!K.supportsTouch){window.addEventListener("mousewheel",A,false);window.addEventListener("DOMMouseScroll",A,false)}return ca},o=[];return{capture:function(i,k){if(!i)throw Error("Unable to capture touch of null element");if(!i.id)i.id="touchable_"+p++;var n=
o[i.id];if(!n){n=new t(T5.ex({element:i},k));o[i.id]=n;GRUNT.Log.info("CREATED TOUCH HELPER. SUPPORTS TOUCH = "+n.supportsTouch)}k.listenerId&&n.decoupleListeners(k.listenerId);k.listenerId=++j;n.addListeners(k);return n},resetTouch:function(i){if(i&&i.id&&o[i.id]){o[i.id].release();delete o[i.id]}}}}();if(typeof jQuery!=="undefined"){jQuery.fn.canTouchThis=function(f){return this.each(function(){T5.Touch.capture(this,f)})};jQuery.fn.untouchable=function(){return this.bind("touchmove",function(f){f.preventDefault()})}}
T5.Easing=function(){var f=1.70158;return{Linear:function(c,b,a,d){return a*c/d+b},Back:{In:function(c,b,a,d){return a*(c/=d)*c*((f+1)*c-f)+b},Out:function(c,b,a,d){return a*((c=c/d-1)*c*((f+1)*c+f)+1)+b},InOut:function(c,b,a,d){return(c/=d/2)<1?a/2*c*c*(((f*=1.525)+1)*c-f)+b:a/2*((c-=2)*c*(((f*=1.525)+1)*c+f)+2)+b}},Bounce:{In:function(c,b,a,d){return a-module.Easing.Bounce.Out(d-c,0,a,d)+b},Out:function(c,b,a,d){return(c/=d)<1/2.75?a*7.5625*c*c+b:c<2/2.75?a*(7.5625*(c-=1.5/2.75)*c+0.75)+b:c<2.5/
2.75?a*(7.5625*(c-=2.25/2.75)*c+0.9375)+b:a*(7.5625*(c-=2.625/2.75)*c+0.984375)+b},InOut:function(c,b,a,d){return c<d/2?module.Easing.Bounce.In(c*2,0,a,d)/2+b:module.Easing.Bounce.Out(c*2-d,0,a,d)/2+a/2+b}},Cubic:{In:function(c,b,a,d){return a*(c/=d)*c*c+b},Out:function(c,b,a,d){return a*((c=c/d-1)*c*c+1)+b},InOut:function(c,b,a,d){if((c/=d/2)<1)return a/2*c*c*c+b;return a/2*((c-=2)*c*c+2)+b}},Elastic:{In:function(c,b,a,d,e,h){if(c==0)return b;if((c/=d)==1)return b+a;h||(h=d*0.3);if(!e||e<Math.abs(a)){e=
a;a=h/4}else a=h/(2*Math.PI)*Math.asin(a/e);return-(e*Math.pow(2,10*(c-=1))*Math.sin((c*d-a)*2*Math.PI/h))+b},Out:function(c,b,a,d,e,h){var g;if(c==0)return b;if((c/=d)==1)return b+a;h||(h=d*0.3);if(!e||e<Math.abs(a)){e=a;g=h/4}else g=h/(2*Math.PI)*Math.asin(a/e);return e*Math.pow(2,-10*c)*Math.sin((c*d-g)*2*Math.PI/h)+a+b},InOut:function(c,b,a,d,e,h){var g;if(c==0)return b;if((c/=d/2)==2)return b+a;h||(h=d*0.3*1.5);if(!e||e<Math.abs(a)){e=a;g=h/4}else g=h/(2*Math.PI)*Math.asin(a/e);if(c<1)return-0.5*
e*Math.pow(2,10*(c-=1))*Math.sin((c*d-g)*2*Math.PI/h)+b;return e*Math.pow(2,-10*(c-=1))*Math.sin((c*d-g)*2*Math.PI/h)*0.5+a+b}},Quad:{In:function(c,b,a,d){return a*(c/=d)*c+b},Out:function(c,b,a,d){return-a*(c/=d)*(c-2)+b},InOut:function(c,b,a,d){if((c/=d/2)<1)return a/2*c*c+b;return-a/2*(--c*(c-2)-1)+b}},Sine:{In:function(c,b,a,d){return-a*Math.cos(c/d*(Math.PI/2))+a+b},Out:function(c,b,a,d){return a*Math.sin(c/d*(Math.PI/2))+b},InOut:function(c,b,a,d){return-a/2*(Math.cos(Math.PI*c/d)-1)+b}}}}();
T5.Animation=function(){function f(){if(a===0)a=setInterval(function(){var e;e=T5.time();if(!b){b=true;try{for(var h=0;h<c.length;)if(c[h].isComplete()){c[h].triggerComplete(false);c.splice(h,1)}else{c[h].update(e);h++}}finally{b=false}}e=c.length;if(e===0){clearInterval(a);a=0}},20)}var c=[],b=false,a=0,d={DURATION:2E3,tweenValue:function(e,h,g,l,p){e=new d.Tween({startValue:e,endValue:h,tweenFn:g,complete:l,duration:p});c.push(e);return e},tween:function(e,h,g,l,p,j){e=new d.Tween({target:e,property:h,
endValue:g,tweenFn:l,duration:j,complete:p});c.push(e);return e},tweenVector:function(e,h,g,l,p,j){var t=[];if(e){var o=e.x==h,i=e.y==g;o||t.push(d.tween(e,"x",h,l,function(){(o=true)&&i&&p()},j));i||t.push(d.tween(e,"y",g,l,function(){i=true;o&&i&&p()},j))}return t},cancel:function(e){if(!b){b=true;try{for(var h=0;h<c.length;)if(!e||e(c[h])){c[h].triggerComplete(true);c.splice(h,1)}else h++}finally{b=false}}},isTweening:function(){return c.length>0},Tween:function(e){e=T5.ex({target:null,property:null,
startValue:0,endValue:null,duration:d.DURATION,tweenFn:d.DEFAULT,complete:null,cancelOnInteract:false},e);var h=T5.time(),g=[],l=false,p=0,j=0,t={cancelOnInteract:e.cancelOnInteract,isComplete:function(){return l},triggerComplete:function(o){e.complete&&e.complete(o)},update:function(o){try{var i=e.tweenFn(o-h,p,j,e.duration);if(e.target)e.target[e.property]=i;for(var k=g.length;k--;)g[k](i,void 0);if(l=h+e.duration<=o){if(e.target)e.target[e.property]=e.tweenFn(e.duration,p,j,e.duration);for(var n=
g.length;n--;)g[n](i,true)}}catch(q){GRUNT.Log.exception(q)}},requestUpdates:function(o){g.push(o)}};p=e.target&&e.property&&e.target[e.property]?e.target[e.property]:e.startValue;if(typeof e.endValue!=="undefined")j=e.endValue-p;if(j==0)l=true;f();return t}};return T5.ex(d,{DEFAULT:T5.Easing.Back.Out})}();T5.ViewState=function(){var f={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,PINCHZOOM:16,FREEZE:128,get:function(){for(var c=0,b=arguments.length;b--;){var a=f[arguments[b]];if(a)c|=a}return c}};return f}();
T5.ViewLayer=function(f){f=T5.ex({id:"",centerOnScale:true,created:T5.time(),scalePosition:true,zindex:0,supportFastDraw:false,validStates:T5.ViewState.get("ACTIVE","ANIMATING","PAN","PINCHZOOM")},f);var c=null,b=f.id,a=T5.ViewState.get("ACTIVE"),d=T5.ex({addToView:function(e){e.setLayer(b,d)},shouldDraw:function(e){var h=c?c.fastDraw&&e!==a:false;return(e&f.validStates)!==0&&(h?f.supportFastDraw:true)},cycle:function(){return 0},draw:function(){},remove:function(){GRUNT.WaterCooler.say("layer.remove",
{id:b})},wakeParent:function(){c&&c.trigger("wake")},getId:function(){return b},setId:function(e){b=e},getParent:function(){return c},setParent:function(e){c=e}},f);return d};
T5.View=function(f){function c(r,u,y,F){U=typeof y!=="undefined";E.updateOffset(B.x+r,B.y+u,y,F);q();T=T5.ViewState.PAN}function b(r,u){f.inertia&&c(r,u,f.panAnimationEasing,f.panAnimationDuration)}function a(){T=T5.ViewState.ACTIVE;U=false;setTimeout(q,50)}function d(r,u){w=T5.V.getRect(r);C=T5.V.getRect(u);var y=T5.D.getSize(w.dimensions),F=T5.D.getSize(C.dimensions);ba=T5.R.getCenter(w);G=T5.R.getCenter(C);z=w&&y!==0?F/y:1}function e(r,u){d(r,u);if(s=z!==1){T=T5.ViewState.PINCHZOOM;q()}}function h(r,
u,y){d(r,u);if(f.adjustScaleFactor){z=f.adjustScaleFactor(z);GRUNT.Log.info("scale factor adjusted to: "+z)}if(y<f.pinchZoomAnimateTrigger){t(L,z,ba,o(),T5.Easing.Sine.Out,function(){l();z=1},300);z=L}else{l();z=1}}function g(r,u){E.zoom(r,Math.min(Math.pow(2,Math.round(Math.log(u))),8),500)}function l(){GRUNT.WaterCooler.say("view.scale",{id:E.id});s=false;E.trigger("scale",z,w?o():G);T=T5.ViewState.ACTIVE;q()}function p(){if(x){T5.Touch.resetTouch(x);if(f.autoSize){x.height=window.innerHeight-x.offsetTop;
x.width=window.innerWidth-x.offsetLeft}try{v=x.getContext("2d");v.globalCompositeOperation=f.initialDrawMode;v.clearRect(0,0,x.width,x.height)}catch(r){GRUNT.Log.exception(r);throw Error("Could not initialise canvas on specified view element");}ea=T5.Touch.capture(x,{observable:E});f.inertia&&ea.inertiaEnable(f.panAnimationDuration,D);D=E.getDimensions();P=T5.D.getCenter(D);q()}}function j(r,u){u.setId(r);u.setParent(E);m.push(u);m.sort(function(y,F){var O=F.zindex-y.zindex;if(O===0)O=F.created-y.created;
return O})}function t(r,u,y,F,O,Y,$){function da(){Y&&Y();l();z=1;Z=null}s=true;ba=T5.V.copy(y);G=T5.V.copy(F);w=null;if(O)T5.Animation.tweenValue(0,u-r,O,da,$?$:1E3).requestUpdates(function(aa){Z=aa/(u-r);z=r+aa;T=T5.ViewState.PINCHZOOM;q();E.trigger("animate")});else{z=targetScaleFactor;da()}}function o(){var r=T5.D.getCenter(D),u=T5.V.distance([G,r]),y=T5.V.theta(G,r,u),F=T5.V.diff(ba,G);r=T5.V.pointOnEdge(G,r,y,u/z);r.x+=F.x;r.y+=F.y;return r}function i(){E.trigger("idle");N=true;R=0}function k(r,
u){var y=0,F=E.getDisplayState(),O=T5.time(),Y=(F&T5.ViewState.PINCHZOOM)!==0,$=0;if(A||Y){r.clearRect(0,0,x.width,x.height);A=false}if(Y){T5.D.getCenter(D);var da=(Z?Z:1)/2,aa=T5.V.diff(ba,G);if(S=w?new T5.Vector(G.x+aa.x,G.y+aa.y):new T5.Vector(G.x-aa.x*da,G.y-aa.y*da))u=T5.V.offset(u,S.x,S.y)}r.save();try{L=z;if(I!==1)r.scale(I,I);else if(Y){r.translate(G.x,G.y);r.scale(z,z)}for($=m.length;$--;)if(m[$].shouldDraw(F)){var fa=m[$].draw(r,u,D,F,E);y+=fa?fa:0}}finally{r.restore()}GRUNT.Log.trace("draw complete",
O);X=false;return y}function n(){var r=0,u=!U&&(T===T5.ViewState.PINCHZOOM||T===T5.ViewState.PAN);K=T5.time();B.x=Math.floor(B.x);B.y=Math.floor(B.y);M&&J&&M.delays.push(K-J);if(u){T5.Animation.cancel(function(F){return F.cancelOnInteract});N=false;if(R!==0){clearTimeout(R);R=0}}for(u=m.length;u--;){var y=m[u].cycle(K,B,T);r+=y?y:0}if(J+ca<K){r+=k(v,B);J=K}W=0;if(Q+r>0)q();else if(!N&&R===0)R=setTimeout(i,500);GRUNT.Log.trace("Completed draw cycle",K)}function q(){Q++;if(!(H||W!==0)){Q=0;W=setTimeout(n,
0)}}f=T5.ex({id:GRUNT.generateObjectID("view"),container:"",clearOnDraw:false,scaleDamping:false,fastDraw:false,fillStyle:"rgb(200, 200, 200)",initialDrawMode:"source-over",bufferRefresh:100,defaultFreezeDelay:500,inertia:true,pannable:true,scalable:true,panAnimationEasing:T5.Easing.Sine.Out,panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:false},f);var m=[],x=document.getElementById(f.container),v=null,B=new T5.Vector,A=false,J=null,H=false,I=1,D=null,P=null,Q=
0,M=null,G=null,N=false,U=false,W=0,X=false,R=0,V=0,S=null,K=0;T5.Device.getConfig();var ca=0,s=false,w=null,C=null,z=1,L=1,Z=null,ba=null,ea=null,T=T5.ViewState.ACTIVE,E={id:f.id,deviceScaling:I,fastDraw:f.fastDraw||T5.Device.getConfig().requireFastDraw,animate:function(r,u,y,F,O){t(z,r,u,y,F,O)},centerOn:function(r){E.setOffset(r.x-x.width/2,r.y-x.height/2)},getDimensions:function(){if(x)return new T5.Dimensions(x.width,x.height)},getZoomCenter:function(){return S},getLayer:function(r){for(var u=
0;u<m.length;u++)if(m[u].getId()==r)return m[u];return null},setLayer:function(r,u){for(var y=0;y<m.length;y++)if(m[y].getId()===r){m.splice(y,1);break}u&&j(r,u);GRUNT.WaterCooler.say("layer.update",{id:r});q()},eachLayer:function(r){for(var u=0;u<m.length;u++)r(m[u])},clearBackground:function(){A=true},freeze:function(){H=true},unfreeze:function(){H=false;q()},needRepaint:function(){return X},snapshot:function(){},getDisplayState:function(){return H?T5.ViewState.FROZEN:T},scale:function(r,u,y,F,
O){F||(F=T5.D.getCenter(D));O||(O=T5.D.getCenter(D));E.animate(r,F,O,u,y);return E},removeLayer:function(r){a:{for(var u=m.length;u--;)if(m[u].getId()==r){r=u;break a}r=-1}if(r>=0&&r<m.length){GRUNT.WaterCooler.say("layer.removed",{layer:m[r]});m.splice(r,1)}},getOffset:function(){return T5.V.copy(B)},setOffset:function(r,u){B.x=r;B.y=u},updateOffset:function(r,u,y,F,O){function Y(){a(0,0);O&&O()}if(y){r=new T5.Vector(r,u);y=T5.Animation.tweenVector(B,r.x,r.y,y,Y,F);for(F=y.length;F--;){y[F].cancelOnInteract=
true;y[F].requestUpdates(function(){q();f.onAnimate&&f.onAnimate(B.x,B.y)})}}else E.setOffset(r,u)},zoom:function(r,u,y){U=false;z=u;s=z!==1;ba=T5.D.getCenter(E.getDimensions());G=z>1?T5.V.copy(r):T5.D.getCenter(E.getDimensions());w=null;clearTimeout(V);if(s){T=T5.ViewState.PINCHZOOM;q();if(y)V=setTimeout(function(){l();z=1},parseInt(y,10))}}};GRUNT.WaterCooler.listen("layer.remove",function(r){r.id&&E.removeLayer(r.id)});I=T5.Device.getConfig().getScaling();GRUNT.observable(E);E.bind("wake",q);E.bind("invalidate",
function(){X=true});if(f.pannable){E.bind("pan",c);E.bind("panEnd",a);E.bind("inertiaPan",b);E.bind("inertiaCancel",function(){U=false;q()})}if(f.scalable){E.bind("pinchZoom",e);E.bind("pinchZoomEnd",h);E.bind("wheelZoom",g)}GRUNT.configurable(E,["inertia","container"],GRUNT.paramTweaker(f,null,{container:function(r,u){x=document.getElementById(u);p()}}),true);p();return E};
T5.AnimatedPathLayer=function(f){function c(g,l,p){g.fillStyle="#FFFFFF";g.strokeStyle="#222222";g.beginPath();g.arc(p.x,p.y,4,0,Math.PI*2,false);g.stroke();g.fill()}f=T5.ex({path:[],id:GRUNT.generateObjectID("pathAnimation"),easing:T5.Easing.Sine.InOut,validStates:T5.ViewState.get("ACTIVE","PAN","PINCHZOOM"),drawIndicator:null,duration:2E3,autoCenter:false},f);var b=T5.V.edges(f.path),a,d=null,e=0;T5.Animation.tweenValue(0,b.total,f.easing,function(){h.remove()},f.duration).requestUpdates(function(g,
l){e=g;l&&h.remove()});var h=T5.ex(new T5.ViewLayer(f),{cycle:function(){for(var g=0;g<b.accrued.length&&b.accrued[g]<e;)g++;d=null;if(g<f.path.length-1){var l=e-(g>0?b.accrued[g-1]:0),p=f.path[g],j=f.path[g+1];a=T5.V.theta(p,j,b.edges[g]);d=T5.V.pointOnEdge(p,j,a,l);if(f.autoCenter)(g=h.getParent())&&g.centerOn(d)}return d?1:0},draw:function(g,l){if(d)(f.drawIndicator?f.drawIndicator:c)(g,l,new T5.Vector(d.x-l.x,d.y-l.y),a)}});return h};
T5.Tiling=function(){TileStore=function(a){a=T5.ex({tileSize:null,gridSize:null,center:new T5.Vector,onPopulate:null},a);if(!a.tileSize)throw Error("Cannot create TileStore with an empty tile size");if(!a.gridSize)throw Error("0 grid size for TileStore");var d=Array(Math.pow(a.gridSize,2)),e=T5.V.offset(a.center,-Math.ceil(a.gridSize>>1)),h=null,g=new T5.Vector,l=null,p={find:function(j){if(!j)return null;for(var t=d.length;t--;){var o=d[t];if(o&&j(o))return o}return null},getGridSize:function(){return a.gridSize},
getGridXY:function(j,t){return T5.Vector(j*a.tileSize-g.x,t*a.tileSize-g.y)},getNormalizedPos:function(j,t){return T5.V.add(new T5.Vector(j,t),T5.V.invert(e),g)},getTileShift:function(){return T5.V.copy(g)},getTile:function(j,t){return j>=0&&j<a.gridSize?d[t*a.gridSize+j]:null},setTile:function(j,t,o){d[t*a.gridSize+j]=o},populate:function(j,t,o){var i=GRUNT.Log.getTraceTicks(),k=0,n=a.gridSize,q=a.tileSize;new T5.Vector(n/2,n/2);if(o)d=[];if(j)for(o=0;o<n;o++)for(var m=0;m<n;m++){if(!d[k]){var x=
j(m,o,e,n);x.gridX=m*q-g.x;x.gridY=o*q-g.y;d[k]=x}k++}h=j;l=t;GRUNT.Log.trace("tile grid populated",i);a.onPopulate&&a.onPopulate()},getShiftDelta:function(j,t,o,i){var k=Math.floor(a.gridSize*0.2),n=new T5.Vector;if(j<0||j+o>a.gridSize)n.x=j<0?-k:k;if(t<0||t+i>a.gridSize)n.y=t<0?-k:k;return n},shift:function(j,t){if(!(j.x===0&&j.y===0)){var o=GRUNT.Log.getTraceTicks(),i=Array(d.length);i.length=d.length;for(var k=0;k<a.gridSize;k++)for(var n=0;n<a.gridSize;n++)i[n*a.gridSize+k]=p.getTile(k+j.x,n+
j.y);d=i;e=t?t(e,j):T5.V.add(e,j);g.x+=-j.x*a.tileSize;g.y+=-j.y*a.tileSize;GRUNT.Log.trace("tile storage shifted",o);p.populate(h,l)}},setOrigin:function(j,t){if(tileOrigin)shiftOrigin(j,t);else e=T5.V.offset(new T5.Vector(j,t),-tileHalfWidth)}};GRUNT.WaterCooler.listen("imagecache.cleared",function(){for(var j=d.length;j--;)if(d[j])d[j].loaded=false});GRUNT.WaterCooler.listen("tiler.repaint",function(){for(var j=d.length;j--;)if(d[j]){d[j].x=null;d[j].y=null}});return p};var f=null,c=null,b={Config:{TILESIZE:256,
TILEBUFFER:1,TILEBUFFER_LOADNEW:0.2},getEmptyTile:function(a){if(!f||a!==f.width){f=T5.newCanvas(a,a);a=f.getContext("2d");a.fillStyle="rgba(150, 150, 150, 0.01)";a.fillRect(0,0,f.width,f.height)}return f},getPanningTile:function(a){function d(){var e=T5.newCanvas(32,32),h=e.getContext("2d");h.fillStyle="#BBBBBB";h.fillRect(0,0,32,32);h.fillStyle="#C3C3C3";h.fillRect(0,0,16,16);h.fillRect(16,16,16,16);return e}if(!c||a!==c.width){c=T5.newCanvas(a,a);a=c.getContext("2d");a.fillStyle=a.createPattern(d(),
"repeat");a.fillRect(0,0,c.width,c.height)}return c},Tile:function(a){return a=T5.ex({x:0,y:0,gridX:0,gridY:0,dirty:false},a)},ImageTile:function(a){a=T5.ex({url:"",sessionParamRegex:null,loaded:false},a);return new b.Tile(a)},TileGrid:function(a){function d(v,B){var A=h.getGridXY(v,B);return new b.ImageTile({gridX:A.x,gridY:A.y})}function e(v,B){if(m){var A,J=[],H=new T5.Vector(Math.floor((v.x+i.x)*l),Math.floor((v.y+i.y)*l));tilesNeeded=false;for(var I=q;I--;)for(var D=n;D--;){A=h.getTile(D+H.x,
I+H.y);var P=new T5.Vector(D-m.x,I-m.y);if(!A){o=h.getShiftDelta(H.x,H.y,n,q);A=d(D+H.x,I+H.y)}J.push({tile:A,centerness:T5.V.absSize(P)})}J.sort(function(Q,M){return M.centerness-Q.centerness});j||(j=Array(J.length));for(A=J.length;A--;){j[A]=J[A].tile;x.prepTile(j[A],B)}}}a=T5.ex({tileSize:T5.Tiling.Config.TILESIZE,drawGrid:false,center:new T5.Vector,gridSize:25,shiftOrigin:null,supportFastDraw:true},a);var h=new TileStore(T5.ex({tileSize:a.tileSize,gridSize:a.gridSize,onPopulate:function(){x.dirty=
true;x.wakeParent()}},a)),g=Math.round(a.tileSize/2),l=a.tileSize?1/a.tileSize:0,p=true,j=null,t=false;new T5.Vector;var o=new T5.Vector,i=new T5.Vector;T5.Device.getConfig();var k=h.getGridSize()*a.tileSize,n,q,m,x=T5.ex(new T5.ViewLayer(a),{gridDimensions:new T5.Dimensions(k,k),dirty:false,cycle:function(v,B,A){v=0;if(o.x!==0||o.y!==0){h.shift(o,a.shiftOrigin);i=h.getTileShift();o=new T5.Vector;v++}A!==T5.ViewState.PINCHZOOM&&e(B,A);return v+x.dirty?1:0},deactivate:function(){p=false},find:function(){return h.find.apply(null,
arguments)},prepTile:function(){},drawTile:function(){return false},getTileSize:function(){return a.tileSize},draw:function(v,B,A,J,H){if(p){var I=T5.time(),D=B.x;B=B.y;var P=true,Q=H.needRepaint()||J===T5.ViewState.PANNING||J===T5.ViewState.PINCHZOOM||T5.Animation.isTweening();if(!m){n=Math.ceil(A.width*l)+1;q=Math.ceil(A.height*l)+1;m=new T5.Vector(Math.floor((n-1)/2),Math.floor((q-1)/2))}if(j){if(a.drawGrid)v.strokeStyle="rgba(50, 50, 50, 0.3)";v.beginPath();for(A=j.length;A--;){var M=j[A];if(M){var G=
M.gridX-D,N=M.gridY-B;if(!(Q?false:!M.dirty)){P=x.drawTile(v,M,G,N,J)&&P;M.x=G;M.y=N}}else P=false;a.drawGrid&&v.rect(G,N,a.tileSize,a.tileSize)}v.stroke();GRUNT.Log.trace("drawn tiles",I);P&&!t&&H.trigger("tileDrawComplete");t=P;x.dirty=false}}},getTileAtXY:function(v,B){for(var A=a.tileSize,J=j?j.length:0;J--;){var H=j[J];if(H&&v>=H.x&&B>=H.y)if(v<=H.x+A&&B<=H.y+A)return H}return null},getTileVirtualXY:function(v,B,A){v=h.getNormalizedPos(v,B);v=new T5.Vector(v.x*a.tileSize,v.y*a.tileSize);if(A){v.x+=
g;v.y+=g}return v},populate:function(v){h.populate(v,null,true)}});return x},ImageTileGrid:function(a){function d(){o.getParent().trigger("invalidate");o.dirty=true;o.wakeParent()}a=T5.ex({emptyTile:b.getEmptyTile(b.Config.TILESIZE),panningTile:b.getPanningTile(b.Config.TILESIZE),tileOffset:new T5.Vector,tileDrawArgs:{}},a);var e=a.emptyTile,h=a.panningTile,g=T5.ViewState.ACTIVE,l=T5.ViewState.PAN,p=T5.Device.getConfig().requireFastDraw,j=a.tileSize?a.tileSize:b.Config.TILESIZE,t=T5.ex({background:null,
overlay:null,offset:new T5.Vector,realSize:new T5.Dimensions(j,j)},a.tileDrawArgs),o=T5.ex(new b.TileGrid(a),{drawTile:function(i,k,n,q,m){var x=k.url?T5.Images.get(k.url):null,v=false;if(x){i.drawImage(x,n,q);k.dirty=false;v=true}else if(m===l)h&&i.drawImage(h,n,q);else e&&i.drawImage(e,n,q);return v},prepTile:function(i,k){if(i)i.dirty=true;if(i&&(!p||k===g))T5.Images.get(i.url)||T5.Images.load(i.url,d,t)}});return o}};return b}();
T5.Tiler=function(f){f=T5.ex({container:"",drawCenter:false,datasources:{},tileLoadThreshold:"first"},f);var c=T5.ex(new T5.View(f),{getTileLayer:function(){return c.getLayer("grid0")},setTileLayer:function(b){c.setLayer("grid0",b);GRUNT.WaterCooler.say("grid.updated",{id:"grid0"})},viewPixToGridPix:function(b){var a=c.getOffset();return new T5.Vector(b.x+a.x,b.y+a.y)},centerOn:function(b,a,d,e){var h=c.getTileLayer(),g=c.getDimensions();(h=h?h.getTileSize():0)&&c.updateOffset(b.gridX-Math.floor((g.width-
h)*0.5),b.gridY-Math.floor((g.height-h)*0.5),a,d,e)},cleanup:function(){c.removeLayer("grid0")},repaint:function(){GRUNT.WaterCooler.say("tiler.repaint");c.trigger("wake")},select:function(b){c.trigger("selectTile",b)}});c.bind("tap",function(b,a){var d=c.getTileLayer();if(d)(d=d.getTileAtXY(a.x,a.y))&&c.trigger("selectTile",d)});return c};
