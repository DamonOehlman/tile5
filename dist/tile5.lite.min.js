if(!this.JSON)this.JSON={};
(function(){function c(o){return o<10?"0"+o:o}function g(o){d.lastIndex=0;return d.test(o)?'"'+o.replace(d,function(k){var u=f[k];return typeof u==="string"?u:"\\u"+("0000"+k.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+o+'"'}function a(o,k){var u,r,j,m,n=e,s,l=k[o];if(l&&typeof l==="object"&&typeof l.toJSON==="function")l=l.toJSON(o);if(typeof i==="function")l=i.call(k,o,l);switch(typeof l){case "string":return g(l);case "number":return isFinite(l)?String(l):"null";case "boolean":case "null":return String(l);
case "object":if(!l)return"null";e+=h;s=[];if(Object.prototype.toString.apply(l)==="[object Array]"){m=l.length;for(u=0;u<m;u+=1)s[u]=a(u,l)||"null";j=s.length===0?"[]":e?"[\n"+e+s.join(",\n"+e)+"\n"+n+"]":"["+s.join(",")+"]";e=n;return j}if(i&&typeof i==="object"){m=i.length;for(u=0;u<m;u+=1){r=i[u];if(typeof r==="string")if(j=a(r,l))s.push(g(r)+(e?": ":":")+j)}}else for(r in l)if(Object.hasOwnProperty.call(l,r))if(j=a(r,l))s.push(g(r)+(e?": ":":")+j);j=s.length===0?"{}":e?"{\n"+e+s.join(",\n"+e)+
"\n"+n+"}":"{"+s.join(",")+"}";e=n;return j}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+c(this.getUTCMonth()+1)+"-"+c(this.getUTCDate())+"T"+c(this.getUTCHours())+":"+c(this.getUTCMinutes())+":"+c(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
d=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e,h,f={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},i;if(typeof JSON.stringify!=="function")JSON.stringify=function(o,k,u){var r;h=e="";if(typeof u==="number")for(r=0;r<u;r+=1)h+=" ";else if(typeof u==="string")h=u;if((i=k)&&typeof k!=="function"&&(typeof k!=="object"||typeof k.length!=="number"))throw Error("JSON.stringify");return a("",
{"":o})};if(typeof JSON.parse!=="function")JSON.parse=function(o,k){function u(j,m){var n,s,l=j[m];if(l&&typeof l==="object")for(n in l)if(Object.hasOwnProperty.call(l,n)){s=u(l,n);if(s!==undefined)l[n]=s;else delete l[n]}return k.call(j,m,l)}var r;o=String(o);b.lastIndex=0;if(b.test(o))o=o.replace(b,function(j){return"\\u"+("0000"+j.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(o.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){r=eval("("+o+")");return typeof k==="function"?u({"":r},""):r}throw new SyntaxError("JSON.parse");}})();if(!String.format)String.format=function(c){if(arguments.length<=1)return c;for(var g=arguments.length-2,a=0;a<=g;a++)c=c.replace(RegExp("\\{"+a+"\\}","gi"),arguments[a+1]);return c};
String.prototype.containsWord=function(c){var g="";if(c.toString)c=c.toString();for(var a=0;a<c.length;a++)g+=!/\w/.test(c[a])?"\\"+c[a]:c[a];return RegExp("(^|\\s|\\,)"+g+"(\\,|\\s|$)","i").test(this)};Number.prototype.toRad=function(){return this*Math.PI/180};Number.prototype.sec=function(){return 1/Math.cos(this)};
GT=function(){var c=Object.prototype.hasOwnProperty,g=0,a={id:"GRUNT.core",extend:function(){var b=arguments[0]||{},d=1,e=arguments.length,h=false,f,i,o,k;if(typeof b==="boolean"){h=b;b=arguments[1]||{};d=2}if(typeof b!=="object"&&!a.isFunction(b))b={};if(e===d){b=this;--d}for(;d<e;d++)if((f=arguments[d])!=null)for(i in f){o=b[i];k=f[i];if(b!==k)if(h&&k&&(a.isPlainObject(k)||a.isArray(k))){o=o&&(a.isPlainObject(o)||a.isArray(o))?o:a.isArray(k)?[]:{};b[i]=a.extend(h,o,k)}else if(k!==undefined)b[i]=
k}return b},isFunction:function(b){return toString.call(b)==="[object Function]"},isArray:function(b){return toString.call(b)==="[object Array]"},isPlainObject:function(b){if(!b||toString.call(b)!=="[object Object]"||b.nodeType||b.setInterval)return false;if(b.constructor&&!c.call(b,"constructor")&&!c.call(b.constructor.prototype,"isPrototypeOf"))return false;var d;for(d in b);return d===undefined||c.call(b,d)},isEmptyObject:function(b){for(var d in b)return false;return true},isXmlDocument:function(b){return toString.call(b)===
"[object Document]"},contains:function(b,d){var e=b,h=arguments,f=1;if(d&&a.isArray(d)){h=d;f=0}for(f=f;f<h;f++)e=e&&typeof foo[h[f]]!=="undefined";return e},newModule:function(b){b=a.extend({id:null,requires:[],parent:null},b);if(b.parent)b=a.extend({},b.parent,b);return b},toID:function(b){return b.replace(/\s/g,"-")},objId:function(b){return(b?b:"obj")+g++}};return a}();
GT.Log=function(){function c(e,h){var f,i=h&&h.length>0?h[0]:"";for(f=1;h&&f<h.length;f++)i+=" "+(a&&GT.isPlainObject(h[f])?JSON.stringify(h[f]):h[f]);typeof console!=="undefined"&&console[e](i);for(f=0;f<g.length;f++)g[f].call(d,i,e)}var g=[],a=typeof JSON!=="undefined",b=window.console&&window.console.markTimeline,d={id:"GRUNT.log",getTraceTicks:function(){return b?(new Date).getTime():null},trace:function(e,h){if(b)console.markTimeline(e+(h?": "+(d.getTraceTicks()-h)+"ms":""))},debug:function(){c("debug",
arguments)},info:function(){c("info",arguments)},warn:function(){c("warn",arguments)},error:function(){c("error",arguments)},exception:function(e){d.error(arguments);for(var h in e)d.info("ERROR DETAIL: "+h+": "+e[h])},watch:function(e,h){try{h()}catch(f){d.exception(f,e)}},throwError:function(e){d.error(e);throw Error(e);},requestUpdates:function(e){g.push(e)}};return d}();
GT.Data=function(){var c={determineObjectMapping:function(a){if(!a)return null;a=a.split("|");for(var b={},d=0;d<a.length;d++)b[a[d]]=d;return b},mapLineToObject:function(a,b){var d=a.split("|"),e={};for(var h in b){var f=b[h];e[h]=d.length>f?d[f]:null}return e},parse:function(a){var b=null,d=[];a=a.split("\n");for(var e=0;e<a.length;e++){var h=a[e];if(b)d.push(c.mapLineToObject(h,b));else b=c.determineObjectMapping(h)}return d}},g={supportedFormats:{JSON:{parse:function(a){return JSON.parse(a)}},
PDON:{parse:function(a){return c.parse(a)}}},parse:function(a){a=GT.extend({data:"",format:"JSON"},a);if(!g.supportedFormats[a.format])throw Error("Unsupported data format: "+a.format+", cannot parse data in javascript object");try{return g.supportedFormats[a.format].parse(a.data)}catch(b){GT.Log.error("ERROR PARSING DATA FROM FORMAT: "+a.format,a.data);GT.Log.exception(b)}return{}}};return g}();
GT.paramTweaker=function(c,g,a){return function(b,d){if(typeof d!=="undefined"){if(b in c)c[b]=d;a&&b in a&&a[b](b,d)}else return g&&b in g?g[b](b):c[b]}};
GT.configurable=function(c,g,a,b){function d(e){c[e]||(c[e]=function(h){return c.configure(e,h)})}if(c){if(!c.configurableSettings){c.configurableId=GT.objId("configurable");c.configurableSettings={};c.configCallbacks=[];if(!GT.configurables)GT.configurables={}}GT.configurables[c.configurableId]=c;c.configCallbacks.push(a);for(a=g.length;a--;){c.configurableSettings[g[a]]=true;b&&d(g[a])}if(!c.configure)c.configure=function(e,h){var f=c.configCallbacks;if(c.configurableSettings[e]){for(var i=f.length;i--;){var o=
f[i](e,h);if(typeof o!=="undefined")return o}return GT.configurables[c.configurableId]}return null}}};GT.Template=function(){var c=/\$\{(.*?)\}/ig;return{parse:function(g,a){for(var b=g,d=c.exec(b);d;){b=b.replace(d[0],GT.XPath.first(d[1],a));c.lastIndex=0;d=c.exec(b)}return b}}}();
(function(){function c(d){var e=document.createElement("script"),h=false;e.src=d;e.async=true;e.onload=e.onreadystatechange=function(){if(!h&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){h=true;e.onload=e.onreadystatechange=null;e&&e.parentNode&&e.parentNode.removeChild(e)}};a||(a=document.getElementsByTagName("head")[0]);a.appendChild(e)}var g=0,a,b=this;GT.jsonp=function(d,e,h){d+=d.indexOf("?")>=0?"&":"?";var f="json"+ ++g;b[f]=function(i){e(i);b[f]=null;try{delete b[f]}catch(o){}};
c(d+(h?h:"callback")+"="+f);return f}})();
(function(){function c(){if(this.readyState===4){var f=null,i=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(i)if(params.handleResponse)params.handleResponse(this);else{var o=params,k=this.getResponseHeader(h.CONTENT_TYPE),u,r=false;for(u in g)if(k&&k.indexOf(g[u])>=0){r=true;break}k=!r;for(r=0;r<b.length;r++)k=k||b[r]==u;if(k)b:{k=u;for(var j in a)for(r=0;r<a[j].length;r++)if(RegExp(a[j][r]+"$","i").test(o.url)){u=
j;break b}u=k?k:"DEFAULT"}try{f=e[u](this,o)}catch(m){f=e.DEFAULT(this,o)}}else params.error&&params.error(this)}catch(n){GT.Log.exception(n,"PROCESSING AJAX RESPONSE")}i&&f&&params.success&&params.success.call(this,f)}}var g={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},a={JSON:["json"],PDON:["pdon.txt"]},b=["TEXT","STREAM"],d=/^(\w+:)?\/\/([^\/?#]+)/,e={XML:function(f){return f.responseXML},JSON:function(f){try{return JSON.parse(f.responseText)}catch(i){GT.Log.error("Error parsing JSON data: ",
f.responseText);GT.Log.exception(i)}return""},PDON:function(f){return GT.Data.parse({data:f.responseText,format:"PDON"})},DEFAULT:function(f){return f.responseText}},h={CONTENT_TYPE:"Content-Type"};GT.xhr=function(f){try{f=GT.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},module.ajaxSettings,f);var i=d.exec(f.url),o=i&&(i[1]&&i[1]!==location.protocol||i[2]!==location.host);if(f.data)f.method="POST";if(f.url){i=
null;if(f.xhr)i=f.xhr(f);i||(i=new XMLHttpRequest);i.open(f.method,f.url,f.async);f.data&&i.setRequestHeader("Content-Type",f.contentType);o||i.setRequestHeader("X-Requested-With","XMLHttpRequest");i.onreadystatechange=c;i.send(f.method=="POST"?module.param(f.data):null)}else GT.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(k){GT.Log.exception(k)}}})();
GT.XPath=function(){function c(d){for(var e=null,h=0;h<g.length;h++)if(e=g[h](d))break;return e}var g=[],a=[null,function(d){return d.numberValue},function(d){return d.stringValue},function(d){return d.booleanValue},null,null,null,null,function(d){return d.singleNodeValue?d.singleNodeValue.textContent:null},function(d){return d.singleNodeValue?d.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||GT.Log.warn("No XPATH support, this is going to cause problems");var b={SearchResult:function(d){return{toString:function(){var e=
null;if(d){var h=null;if(d.resultType>=0&&d.resultType<a.length)h=a[d.resultType];if(h)e=h(d)}return e?e:""}}},first:function(d,e){var h=b.SearchResult,f;var i=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!i)i=XPathResult.ANY_TYPE;try{if(GT.isXmlDocument(e))f=e.evaluate(d,e,c,i,null);else{GT.Log.warn("attempted xpath expression: "+d+" on a non-xml document");f=null}}catch(o){GT.Log.warn("attempted to run invalid xpath expression: "+d+" on node: "+e);f=null}return new h(f)},registerResolver:function(d){g.push(d)}};
return b}();
GT.observable=function(c){if(c){if(!c.observableHandlers)c.observableHandlers={};if(!(c.bind||c.trigger||c.unbind)){c.bind=function(g,a){var b=GT.objId("callback"),d=c.observableHandlers;d[g]||(d[g]=[]);c.observableHandlers[g].push({callback:a,callbackId:b});return b};c.trigger=function(g){var a=c.observableHandlers[g];if(!a)return c;for(var b=a.length;b--;)a[b].callback.apply(self,Array.prototype.slice.call(arguments,1));return c};c.unbind=function(g,a){for(var b=c.observableHandlers[g],d=0;b&&d<
b.length;d++)if(b[d].callbackId===a){b.splice(d,1);break}return c}}}};GT.WaterCooler=function(){var c={},g=[];return{addPipe:function(a){a("pipe.test",{});g.push(a)},listen:function(a,b){c[a]||(c[a]=[]);b&&c[a].push(b)},say:function(a,b){var d;for(d=g.length;d--;)g[d](a,b);if(c[a])for(d=c[a].length;d--;)c[a][d](b)},leave:function(){}}}();
GT.Storage=function(){function c(g){if(g&&g=="session")return sessionStorage;return localStorage}return{get:function(g,a){var b=c(a).getItem(g);return/^(\{|\[).*(\}|\])$/.test(b)?JSON.parse(b):b},set:function(g,a,b){a=jQuery.isArray(a)||jQuery.isPlainObject(a)?JSON.stringify(a):a;c(b).setItem(g,a)},remove:function(g,a){c(a).removeItem(g)}}}();
GT.ParseRules=function(){var c=[];return{add:function(g,a){c.push({regex:g,handler:a})},each:function(g,a,b){function d(){e++;b&&e>=c.length&&b(a)}for(var e=0,h=0;h<c.length;h++){var f=c[h].regex,i=c[h].handler,o=false;if(f){f.lastIndex=-1;if((f=f.exec(g))&&i){o=true;i(f,a,d)&&d()}}o||d()}}}};
T5=function(){var c={ex:GT.extend,newCanvas:function(g,a){var b=document.createElement("canvas");typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(b);b.width=g?g:0;b.height=a?a:0;return b},time:function(){return(new Date).getTime()},Vector:function(g,a){return{x:g?g:0,y:a?a:0}},V:function(){function g(a){if(!a||a.length<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var b={edges:Array(a.length-1),accrued:Array(a.length-1),total:0},
d=T5.V.diff,e=0;e<a.length-1;e++){var h=d(a[e],a[e+1]);b.edges[e]=Math.sqrt(h.x*h.x+h.y*h.y);b.accrued[e]=b.total+b.edges[e];b.total+=b.edges[e]}return b}return{create:function(a,b){return new c.Vector(a,b)},add:function(){for(var a=new c.Vector,b=arguments.length;b--;){a.x+=arguments[b].x;a.y+=arguments[b].y}return a},absSize:function(a){return Math.max(Math.abs(a.x),Math.abs(a.y))},diff:function(a,b){return new c.Vector(a.x-b.x,a.y-b.y)},copy:function(a){return a?new c.Vector(a.x,a.y):null},invert:function(a){return new T5.Vector(-a.x,
-a.y)},offset:function(a,b,d){return new T5.Vector(a.x+b,a.y+(d?d:b))},edges:g,distance:function(a){return g(a).total},theta:function(a,b,d){d=Math.asin((a.y-b.y)/d);return a.x>b.x?d:Math.PI-d},pointOnEdge:function(a,b,d,e){b=new T5.Vector(Math.cos(d)*e,Math.sin(d)*e);return new T5.Vector(a.x-b.x,a.y-b.y)},getRect:function(a){var b=a.length;if(b>1)return new T5.Rect(Math.min(a[0].x,a[b-1].x),Math.min(a[0].y,a[b-1].y),Math.abs(a[0].x-a[b-1].x),Math.abs(a[0].y-a[b-1].y))},toString:function(a){return a.x+
", "+a.y}}}(),Dimensions:function(g,a){return{width:g?g:0,height:a?a:0}},D:function(){return{getAspectRatio:function(g){return g.height!==0?g.width/g.height:1},getCenter:function(g){return new c.Vector(g.width/2,g.height/2)},getSize:function(g){return Math.sqrt(Math.pow(g.width,2)+Math.pow(g.height,2))}}}(),Rect:function(g,a,b,d){return{origin:new c.Vector(g,a),dimensions:new c.Dimensions(b,d)}},R:function(){return{copy:function(g){return g?new c.Rect(g.origin.x,g.origin.y,g.dimensions.width,g.dimensions.height):
null},getCenter:function(g){return new T5.Vector(g.origin.x+g.dimensions.width/2,g.origin.y+g.dimensions.height/2)}}}()};return c}();
(function(){function c(){for(;k.length>0;){var r=k.shift();document.location=r}o=0}function g(r){for(var j=true,m=u.length;m--;)j=j&&r!=u[m];return j}function a(r,j){var m=[];for(var n in j)n&&m.push(n+"="+escape(j[n]));return"tile5://"+r+"/"+(m.length>0?"?"+m.join("&"):"")}function b(r,j){g(r)&&GT.Log.info("would push url: "+a(r,j))}function d(r,j){if(g(r)){k.push(a(r,j));o||(o=setTimeout(c,100))}}function e(){h={base:{name:"Unknown",eventTarget:document,supportsTouch:"createTouch"in document,imageCacheMaxSize:null,
getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:b,targetFps:null},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:d,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:d},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:d},android:{name:"Android OS <= 2.1",regex:/android/i,eventTarget:document.body,supportsTouch:true,getScaling:function(){return 1/
window.devicePixelRatio},bridgeNotify:d},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:d}};f=[h.froyo,h.android,h.ipod,h.iphone,h.ipad]}var h=null,f=[],i=null,o=0,k=[],u=["view.wake","tile.loaded"];T5.getConfig=function(){h||e();if(!i){GT.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var r=0;r<f.length;r++){var j=f[r];if(j.regex&&j.regex.test(navigator.userAgent)){i=T5.ex({},h.base,j);GT.Log.info("PLATFORM DETECTED AS: "+
i.name);break}}if(!i){GT.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");i=h.base}GT.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return i}})();
T5.Dispatcher=function(){var c=[],g={execute:function(a){var b=g.findAction(a);b&&b.execute.apply(b,Array.prototype.slice.call(arguments,1))},findAction:function(a){for(var b=c.length;b--;)if(c[b].id==a)return c[b];return null},getRegisteredActions:function(){return[].concat(c)},getRegisteredActionIds:function(){for(var a=[],b=c.length;b--;)c[b].id&&a.push(c[b].id);return a},registerAction:function(a){a&&a.id&&c.push(a)},Action:function(a){a=T5.ex({autoRegister:true,id:"",title:"",icon:"",execute:null},
a);var b={id:a.id,execute:function(){a.execute&&a.execute.apply(this,arguments)},getParam:function(d){return a[d]?a[d]:""},toString:function(){return String.format("{0} [title = {1}, icon = {2}]",b.id,a.title,a.icon)}};a.autoRegister&&g.registerAction(b);return b},Agent:function(a){a=GT.extend({name:"Untitled",translator:null,execute:null},a);var b={getName:function(){return a.name},getParam:function(d){return a[d]},getId:function(){return GT.toID(b.getName())},run:function(d,e){if(a.execute){var h=
a.translator?a.translator(d):d;a.execute.call(b,h,function(f,i){e&&e(f,i,h)})}}};return b},runAgents:function(a,b,d){for(var e=0;e<a.length;e++)a[e].run(b,d)}};return g}();
T5.Resources=function(){var c="",g={},a={getPath:function(b){return/^(file|https?|\/)/.test(b)?b:c+b},setBasePath:function(b){c=b},loadResource:function(b){b=T5.ex({filename:"",cacheable:true,dataType:null,callback:null},b);var d=function(e){b.callback&&GT.Log.watch("CALLING RESOURCE CALLBACK",function(){b.callback(e)})};b.cacheable&&g[b.filename]?d(g[b.filename]):GT.xhr({url:a.getPath(b.filename),dataType:b.dataType,success:function(e){if(b.cacheable)g[b.filename]=e;d(e)},error:function(e,h,f){GT.Log.error("error loading resource ["+
b.filename+"], error = "+f)}})},loadSnippet:function(b,d){/\.\w+$/.test(b)||(b+=".html");a.loadResource({filename:"snippets/"+b,callback:d,dataType:"html"})}};return a}();
T5.Images=function(){function c(){var m=e[this.id];if(m&&m.image.complete&&m.image.width>0){m.loaded=true;m.hitCount=1;for(var n=i.length;n--;)if(i[n].image.src==this.src){i.splice(n,1);break}if(m.background||m.postProcess)if(m.image){n=T5.newCanvas(m.realSize?m.realSize.width:image.width,m.realSize?m.realSize.height:image.height);var s=n.getContext("2d"),l=m.offset?m.offset:new T5.Vector;m.background&&s.drawImage(m.background,0,0);s.drawImage(m.image,l.x,l.y);m.postProcess&&m.postProcess(s,m);m.image=
n}m.loadCallback&&m.loadCallback(this,false);o.push({url:this.src,created:m.requested});delete e[this.id];g()}}function g(){for(var m=T5.getConfig().maxImageLoads;f.length>0&&(!m||i.length<m);){var n=f.shift();if(n.imageLoader){i.push(n);n.imageLoader(n,c)}}}function a(m){for(var n=null,s=k.length;s--&&!n;)n=k[s](m);return n?n:function(l,H){l.image.onload=H;l.image.src=T5.Resources.getPath(l.url);l.requested=T5.time()}}function b(){r=true;try{var m=Math.floor(o.length/2);if(m>0){o.sort(function(s,
l){return s.created-l.created});for(var n=m;n--;)delete d[o[n].url];o.splice(0,m)}}finally{r=false}GT.WaterCooler.say("imagecache.cleared")}var d={},e={},h=0,f=[],i=[],o=[],k=[],u=0,r=false,j={avgImageSize:25,loadTimeout:10,addInterceptor:function(m){k.push(m)},cancelLoad:function(){i=[]},get:function(m){var n=null,s=null;r||(n=d[m]);if((s=n?n.image:null)&&(s.getContext||s.complete&&s.width>0))return s},load:function(m,n,s){var l=d[m];if(l){l.hitCount++;l.image.complete&&n&&n(l.image,true)}else{l=
T5.ex({url:m,image:new Image,loaded:false,imageLoader:a(m),created:T5.time(),requested:null,hitCount:0,loadCallback:n},s);l.image.id="resourceLoaderImage"+h++;d[m]=l;e[l.image.id]=l;f.push(l);g()}return l},stats:function(){return{imageLoadingCount:i.length,queuedImageCount:f.length,imageCacheFullness:u}}};setInterval(function(){for(var m=T5.time(),n=false,s=0,l=T5.getConfig();s<i.length;)if(m-i[s].requested>j.loadTimeout*1E3){i.splice(s,1);n=true}else s++;n&&g();if(l&&l.imageCacheMaxSize){u=o.length*
j.avgImageSize/l.imageCacheMaxSize;u>=1&&b()}},1E3);return j}();
T5.Touch=function(){function c(j,m){var n=j&&j.length>0?j[0]:null;if(n&&m&&m.length>0)return T5.V.diff(n,m[0]);return null}function g(j){j.preventDefault();j.stopPropagation()}function a(j){for(var m=Array(j.length),n=j.length;n--;)m[n]=new T5.Vector(j[n].pageX,j[n].pageY);return m}function b(j){return[new T5.Vector(j.pageX,j.pageY)]}var d=120,e=100,h=250,f={TAP:0,MOVE:1,PINCH:2},i=7,o=0,k=0,u=function(j){function m(q,z,E,C){var O=Math.asin((q.y-z.y)/E);E=Math.min(Math.floor(E*(X.duration/C)),X.max);
O=z.x>q.x?O:Math.PI-O;q=new T5.Vector(Math.cos(O)*-E,Math.sin(O)*E);l("inertiaPan",q.x,q.y)}function n(q,z){var E,C;if(w){E=z-S;if(E<h){C=T5.V.distance([x[0],q]);C>j.inertiaTrigger&&m(x[0],q,C,E)}}else{R=q;var O=setInterval(function(){E=T5.time()-z;C=T5.V.distance([q,R]);if(E<e&&C>j.inertiaTrigger){clearInterval(O);m(q,R,C,E)}else E>e&&clearInterval(O)},5)}}function s(q){for(var z=[],E=j.element?-j.element.offsetLeft:0,C=j.element?-j.element.offsetTop:0,O=q.length;O--;)z.push(T5.V.offset(q[O],E,C));
return z}function l(){j.observable&&j.observable.trigger.apply(null,arguments)}function H(q){if(q.target&&q.target===j.element){x=w?a(q.touches):b(q);F=new T5.Vector;K=new T5.Vector;N=true;v=false;S=T5.time();g(q);q.target.style.cursor="move";l("inertiaCancel");V.current=S;if(q=x.length>0?x[0]:null){l("touchStart",q.x,q.y);if(V.current-V.last<ca.THRESHOLD_DOUBLETAP)if((q=A?T5.V.diff(x[0],A[0]):null)&&Math.abs(q.x)<j.maxDistDoubleTap&&Math.abs(q.y)<j.maxDistDoubleTap)v=true;J=f.TAP;A=[].concat(x)}else GT.Log.warn("Touch start fired, but no touch vector found")}}
function T(q){if(q.target&&q.target===j.element){R=(w?a(q.touches):b(q))[0];if(N){w&&g(q);q=w?a(q.touches):b(q);var z=0;if(q.length>1){if(x.length===1)x=[].concat(q);z=T5.V.distance(x)-T5.V.distance(q)}if(J===f.TAP){var E=c(q,x);if(E&&(Math.abs(E.x)>=i||Math.abs(E.y)>=i))J=f.MOVE}if(J!==f.TAP)if(!z||Math.abs(z)<j.pinchZoomThreshold){if(F=c(q,A)){K.x-=F.x;K.y-=F.y;y.x-=F.x;y.y-=F.y}if(T5.V.absSize(y)>j.panEventThreshhold){l("pan",y.x,y.y);y=T5.V.create()}J=f.MOVE}else{l("pinchZoom",s(x),s(q));J=f.PINCH}A=
[].concat(q)}}}function L(q){if(q.target&&q.target===j.element){var z=(w?a(q.changedTouches):b(q))[0];w&&g(q);var E=T5.time();V.last=V.current;if(J===f.TAP)D||(D=setTimeout(function(){D=0;var C=v?"doubleTap":"tap",O=x[0],Z=null;if(j.element)Z=T5.V.offset(O,-j.element.offsetLeft,-j.element.offsetTop);l(C,O,Z)},ca.THRESHOLD_DOUBLETAP+50));else if(J==f.MOVE){l("panEnd",K.x,K.y);X&&n(z,E)}else J==f.PINCH&&l("pinchZoomEnd",s(x),s(A),E-S);q.target.style.cursor="default";N=false}}function Q(q){if(q.target&&
q.target===j.element){var z;if(q.detail){z=-q.detail*d;z=new T5.Vector(q.axis===1?z:0,q.axis===2?z:0)}else z=new T5.Vector(q.wheelDeltaX,q.wheelDeltaY);var E=z.y!==0?Math.abs(z.y/d):0;if(R&&E!==0){var C=T5.V.offset(R,-j.element.offsetLeft,-j.element.offsetTop);l("wheelZoom",C,Math.pow(2,z.y>0?E:-E))}q.preventDefault()}}j=T5.ex({element:null,observable:null,inertiaTrigger:20,maxDistDoubleTap:20,panEventThreshhold:0,pinchZoomThreshold:5,touchStartHandler:null,moveHandler:null,moveEndHandler:null,pinchZoomHandler:null,
pinchZoomEndHandler:null,tapHandler:null,doubleTapHandler:null,wheelZoomHandler:null},j);var v=false,D=0,w=T5.getConfig().supportsTouch,x=null,A=null,F=null,K=null,y=new T5.Vector,J=null,N=false,S=0,U=[],R=null,X=null,V={current:0,last:0},M=T5.getConfig(),ca={supportsTouch:w,THRESHOLD_DOUBLETAP:300,addListeners:function(q){U.push(q)},decoupleListeners:function(q){for(var z=0;q&&z<U.length;z++)if(U[z].listenerId===q){U.splice(z,1);GT.Log.info("successfully decoupled touch listener: "+q);break}},release:function(){M.eventTarget.removeEventListener(M.supportsTouch?
"touchstart":"mousedown",H,false);M.eventTarget.removeEventListener(M.supportsTouch?"touchmove":"mousemove",T,false);M.eventTarget.removeEventListener(M.supportsTouch?"touchend":"mouseup",L,false);if(!M.supportsTouch){window.removeEventListener("mousewheel",Q,false);window.removeEventListener("DOMMouseScroll",Q,false)}},inertiaEnable:function(q,z){X={duration:q,max:z?Math.min(z.width,z.height):500}},inertiaDisable:function(){X=null}};M.eventTarget.addEventListener(M.supportsTouch?"touchstart":"mousedown",
H,false);M.eventTarget.addEventListener(M.supportsTouch?"touchmove":"mousemove",T,false);M.eventTarget.addEventListener(M.supportsTouch?"touchend":"mouseup",L,false);if(!M.supportsTouch){window.addEventListener("mousewheel",Q,false);window.addEventListener("DOMMouseScroll",Q,false)}return ca},r=[];return{capture:function(j,m){if(!j)throw Error("Unable to capture touch of null element");if(!j.id)j.id="touchable_"+o++;var n=r[j.id];if(!n){n=new u(T5.ex({element:j},m));r[j.id]=n;GT.Log.info("CREATED TOUCH HELPER. SUPPORTS TOUCH = "+
n.supportsTouch)}m.listenerId&&n.decoupleListeners(m.listenerId);m.listenerId=++k;n.addListeners(m);return n},resetTouch:function(j){if(j&&j.id&&r[j.id]){r[j.id].release();delete r[j.id]}}}}();
(function(){var c=1.70158,g={linear:function(a,b,d,e){return d*a/e+b},backin:function(a,b,d,e){return d*(a/=e)*a*((c+1)*a-c)+b},backout:function(a,b,d,e){return d*((a=a/e-1)*a*((c+1)*a+c)+1)+b},backinout:function(a,b,d,e){return(a/=e/2)<1?d/2*a*a*(((c*=1.525)+1)*a-c)+b:d/2*((a-=2)*a*(((c*=1.525)+1)*a+c)+2)+b},bouncein:function(a,b,d,e){return d-g.bounceout(e-a,0,d,e)+b},bounceout:function(a,b,d,e){return(a/=e)<1/2.75?d*7.5625*a*a+b:a<2/2.75?d*(7.5625*(a-=1.5/2.75)*a+0.75)+b:a<2.5/2.75?d*(7.5625*(a-=
2.25/2.75)*a+0.9375)+b:d*(7.5625*(a-=2.625/2.75)*a+0.984375)+b},bounceinout:function(a,b,d,e){return a<e/2?g.bouncein(a*2,0,d,e)/2+b:g.bounceout(a*2-e,0,d,e)/2+d/2+b},cubicin:function(a,b,d,e){return d*(a/=e)*a*a+b},cubicout:function(a,b,d,e){return d*((a=a/e-1)*a*a+1)+b},cubicinout:function(a,b,d,e){if((a/=e/2)<1)return d/2*a*a*a+b;return d/2*((a-=2)*a*a+2)+b},elasticin:function(a,b,d,e,h,f){if(a==0)return b;if((a/=e)==1)return b+d;f||(f=e*0.3);if(!h||h<Math.abs(d)){h=d;d=f/4}else d=f/(2*Math.PI)*
Math.asin(d/h);return-(h*Math.pow(2,10*(a-=1))*Math.sin((a*e-d)*2*Math.PI/f))+b},elasticout:function(a,b,d,e,h,f){var i;if(a==0)return b;if((a/=e)==1)return b+d;f||(f=e*0.3);if(!h||h<Math.abs(d)){h=d;i=f/4}else i=f/(2*Math.PI)*Math.asin(d/h);return h*Math.pow(2,-10*a)*Math.sin((a*e-i)*2*Math.PI/f)+d+b},elasticinout:function(a,b,d,e,h,f){var i;if(a==0)return b;if((a/=e/2)==2)return b+d;f||(f=e*0.3*1.5);if(!h||h<Math.abs(d)){h=d;i=f/4}else i=f/(2*Math.PI)*Math.asin(d/h);if(a<1)return-0.5*h*Math.pow(2,
10*(a-=1))*Math.sin((a*e-i)*2*Math.PI/f)+b;return h*Math.pow(2,-10*(a-=1))*Math.sin((a*e-i)*2*Math.PI/f)*0.5+d+b},quadin:function(a,b,d,e){return d*(a/=e)*a+b},quadout:function(a,b,d,e){return-d*(a/=e)*(a-2)+b},quadinout:function(a,b,d,e){if((a/=e/2)<1)return d/2*a*a+b;return-d/2*(--a*(a-2)-1)+b},sinein:function(a,b,d,e){return-d*Math.cos(a/e*(Math.PI/2))+d+b},sineout:function(a,b,d,e){return d*Math.sin(a/e*(Math.PI/2))+b},sineinout:function(a,b,d,e){return-d/2*(Math.cos(Math.PI*a/e)-1)+b}};T5.easing=
function(a){return g[a.replace(/[\-\_\s\.]/g,"").toLowerCase()]};T5.registerEasingType=function(a,b){g[a.replace(/[\-\_\s\.]/g,"").toLowerCase()]=b}})();
T5.Tween=function(c){c=T5.ex({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:T5.easing("sine.out"),complete:null,cancelOnInteract:false},c);var g=T5.time(),a=[],b=false,d=0,e=0,h={cancelOnInteract:c.cancelOnInteract,isComplete:function(){return b},triggerComplete:function(f){c.complete&&c.complete(f)},update:function(f){try{var i=c.tweenFn(f-g,d,e,c.duration);if(c.target)c.target[c.property]=i;for(var o=a.length;o--;)a[o](i,void 0);if(b=g+c.duration<=f){if(c.target)c.target[c.property]=
c.tweenFn(c.duration,d,e,c.duration);for(var k=a.length;k--;)a[k](i,true)}}catch(u){GT.Log.exception(u)}},requestUpdates:function(f){a.push(f)}};d=c.target&&c.property&&c.target[c.property]?c.target[c.property]:c.startValue;if(typeof c.endValue!=="undefined")e=c.endValue-d;if(e==0)b=true;T5.wakeTweens();return h};
(function(){var c=[],g=false,a=0;T5.tweenValue=function(b,d,e,h,f){b=new T5.Tween({startValue:b,endValue:d,tweenFn:e,complete:h,duration:f});c.push(b);return b};T5.tween=function(b,d,e,h,f,i){b=new T5.Tween({target:b,property:d,endValue:e,tweenFn:h,duration:i,complete:f});c.push(b);return b};T5.tweenVector=function(b,d,e,h,f,i){var o=[];if(b){var k=b.x==d,u=b.y==e;k||o.push(T5.tween(b,"x",d,h,function(){(k=true)&&u&&f()},i));u||o.push(T5.tween(b,"y",e,h,function(){u=true;k&&u&&f()},i))}return o};
T5.cancelAnimation=function(b){if(!g){g=true;try{for(var d=0;d<c.length;)if(!b||b(c[d])){c[d].triggerComplete(true);c.splice(d,1)}else d++}finally{g=false}}};T5.isTweening=function(){return c.length>0};T5.wakeTweens=function(){if(a===0)a=setInterval(function(){var b;b=T5.time();if(!g){g=true;try{for(var d=0;d<c.length;)if(c[d].isComplete()){c[d].triggerComplete(false);c.splice(d,1)}else{c[d].update(b);d++}}finally{g=false}}b=c.length;if(b===0){clearInterval(a);a=0}},20)}})();
(function(){var c={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,PINCH:16,FREEZE:128};T5.viewState=function(){for(var g=0,a=arguments.length;a--;){var b=c[arguments[a].toUpperCase()];if(b)g|=b}return g}})();
T5.ViewLayer=function(c){c=T5.ex({id:"",centerOnScale:true,created:T5.time(),scalePosition:true,zindex:0,supportFastDraw:false,validStates:T5.viewState("ACTIVE","ANIMATING","PAN","PINCH")},c);var g=null,a=c.id,b=T5.viewState("ACTIVE"),d=T5.ex({addToView:function(e){e.setLayer(a,d)},shouldDraw:function(e){var h=g?g.fastDraw&&e!==b:false;return(e&c.validStates)!==0&&(h?c.supportFastDraw:true)},cycle:function(){return 0},draw:function(){},remove:function(){GT.WaterCooler.say("layer.remove",{id:a})},
wakeParent:function(){g&&g.trigger("wake")},getId:function(){return a},setId:function(e){a=e},getParent:function(){return g},setParent:function(e){g=e}},c);GT.observable(d);return d};
T5.View=function(c){function g(p,t,B,G){N=typeof B!=="undefined";W=ga;s();I.updateOffset(L.x+p,L.y+t,B,G)}function a(p,t){c.inertia&&g(p,t,c.panAnimationEasing,c.panAnimationDuration)}function b(){W=fa;N=false;setTimeout(s,50)}function d(p,t){z=T5.V.getRect(p);E=T5.V.getRect(t);var B=T5.D.getSize(z.dimensions),G=T5.D.getSize(E.dimensions);ba=T5.R.getCenter(z);y=T5.R.getCenter(E);C=z&&B!==0?G/B:1}function e(p,t){d(p,t);if(q=C!==1){W=da;s()}}function h(p,t,B){d(p,t);if(c.adjustScaleFactor){C=c.adjustScaleFactor(C);
GT.Log.info("scale factor adjusted to: "+C)}if(B<c.pinchZoomAnimateTrigger){u(O,C,ba,r(),T5.easing("sine.out"),function(){i();C=1},300);C=O}else{i();C=1}}function f(p,t){I.zoom(p,Math.min(Math.pow(2,Math.round(Math.log(t))),8),500)}function i(){q=false;I.trigger("scale",C,z?r():y);W=fa;s()}function o(){if(H){T5.Touch.resetTouch(H);if(c.autoSize){H.height=window.innerHeight-H.offsetTop;H.width=window.innerWidth-H.offsetLeft}try{T=H.getContext("2d");T.globalCompositeOperation=c.initialDrawMode;T.clearRect(0,
0,H.width,H.height)}catch(p){GT.Log.exception(p);throw Error("Could not initialise canvas on specified view element");}ha=T5.Touch.capture(H,{observable:I});c.inertia&&ha.inertiaEnable(c.panAnimationDuration,x);x=I.getDimensions();A=T5.D.getCenter(x);s()}}function k(p,t){t.setId(p);t.setParent(I);l.push(t);l.sort(function(B,G){var P=G.zindex-B.zindex;if(P===0)P=G.created-B.created;return P})}function u(p,t,B,G,P,Y,$){function ea(){Y&&Y();i();C=1;Z=null}q=true;ba=T5.V.copy(B);y=T5.V.copy(G);z=null;
if(P)T5.tweenValue(0,t-p,P,ea,$?$:1E3).requestUpdates(function(aa){Z=aa/(t-p);C=p+aa;W=da;s();I.trigger("animate")});else{C=targetScaleFactor;ea()}}function r(){var p=T5.D.getCenter(x),t=T5.V.distance([y,p]),B=T5.V.theta(y,p,t),G=T5.V.diff(ba,y);p=T5.V.pointOnEdge(y,p,B,t/C);p.x+=G.x;p.y+=G.y;return p}function j(){I.trigger("idle");J=true;R=0}function m(p,t){var B=0,G=D?T5.viewState("FROZEN"):W,P=T5.time(),Y=(G&da)!==0,$=0;if(Q||Y){p.clearRect(0,0,H.width,H.height);Q=false}if(Y){T5.D.getCenter(x);
var ea=(Z?Z:1)/2,aa=T5.V.diff(ba,y);if(V=z?new T5.Vector(y.x+aa.x,y.y+aa.y):new T5.Vector(y.x-aa.x*ea,y.y-aa.y*ea))t=T5.V.offset(t,V.x,V.y)}p.save();try{O=C;if(w!==1)p.scale(w,w);else if(Y){p.translate(y.x,y.y);p.scale(C,C)}for($=l.length;$--;)if(l[$].shouldDraw(G)){var ia=l[$].draw(p,t,x,G,I);B+=ia?ia:0}}finally{p.restore()}GT.Log.trace("draw complete",P);U=false;return B}function n(){var p=0,t=!N&&(W===da||W===ga);M=T5.time();L.x=Math.floor(L.x);L.y=Math.floor(L.y);K&&v&&K.delays.push(M-v);if(t){T5.cancelAnimation(function(G){return G.cancelOnInteract});
J=false;if(R!==0){clearTimeout(R);R=0}}for(t=l.length;t--;){var B=l[t].cycle(M,L,W);p+=B?B:0}if(v+ca<M){p+=m(T,L);v=M}S=0;if(F+p>0)s();else if(!J&&R===0)R=setTimeout(j,500);GT.Log.trace("Completed draw cycle",M)}function s(){F++;if(!(D||S!==0)){F=0;S=setTimeout(n,0)}}c=T5.ex({id:GT.objId("view"),container:"",clearOnDraw:false,scaleDamping:false,fastDraw:false,fillStyle:"rgb(200, 200, 200)",initialDrawMode:"source-over",bufferRefresh:100,defaultFreezeDelay:500,inertia:true,pannable:true,scalable:true,
panAnimationEasing:T5.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:false},c);var l=[],H=document.getElementById(c.container),T=null,L=new T5.Vector,Q=false,v=null,D=false,w=1,x=null,A=null,F=0,K=null,y=null,J=false,N=false,S=0,U=false,R=0,X=0,V=null,M=0;T5.getConfig();var ca=0,q=false,z=null,E=null,C=1,O=1,Z=null,ba=null,ha=null,fa=T5.viewState("ACTIVE"),ga=T5.viewState("PAN"),da=T5.viewState("PINCH"),W=fa,I={id:c.id,deviceScaling:w,fastDraw:c.fastDraw||
T5.getConfig().requireFastDraw,animate:function(p,t,B,G,P){u(C,p,t,B,G,P)},centerOn:function(p){I.setOffset(p.x-H.width/2,p.y-H.height/2)},getDimensions:function(){if(H)return new T5.Dimensions(H.width,H.height)},getZoomCenter:function(){return V},getLayer:function(p){for(var t=0;t<l.length;t++)if(l[t].getId()==p)return l[t];return null},setLayer:function(p,t){for(var B=0;B<l.length;B++)if(l[B].getId()===p){l.splice(B,1);break}t&&k(p,t);s()},eachLayer:function(p){for(var t=0;t<l.length;t++)p(l[t])},
clearBackground:function(){Q=true},freeze:function(){D=true},unfreeze:function(){D=false;s()},needRepaint:function(){return U},snapshot:function(){},scale:function(p,t,B,G,P){G||(G=T5.D.getCenter(x));P||(P=T5.D.getCenter(x));I.animate(p,G,P,t,B);return I},removeLayer:function(p){a:{for(var t=l.length;t--;)if(l[t].getId()==p){p=t;break a}p=-1}if(p>=0&&p<l.length){GT.WaterCooler.say("layer.removed",{layer:l[p]});l.splice(p,1)}},getOffset:function(){return T5.V.copy(L)},setOffset:function(p,t){L.x=p;
L.y=t},updateOffset:function(p,t,B,G,P){function Y(){b(0,0);P&&P()}if(B){p=new T5.Vector(p,t);B=T5.tweenVector(L,p.x,p.y,B,Y,G);for(G=B.length;G--;){B[G].cancelOnInteract=true;B[G].requestUpdates(s)}}else I.setOffset(p,t)},zoom:function(p,t,B){N=false;C=t;q=C!==1;ba=T5.D.getCenter(I.getDimensions());y=C>1?T5.V.copy(p):T5.D.getCenter(I.getDimensions());z=null;clearTimeout(X);if(q){W=da;s();if(B)X=setTimeout(function(){i();C=1},parseInt(B,10))}}};GT.WaterCooler.listen("layer.remove",function(p){p.id&&
I.removeLayer(p.id)});w=T5.getConfig().getScaling();GT.observable(I);I.bind("wake",s);I.bind("invalidate",function(){U=true});if(c.pannable){I.bind("pan",g);I.bind("panEnd",b);I.bind("inertiaPan",a);I.bind("inertiaCancel",function(){N=false;s()})}if(c.scalable){I.bind("pinchZoom",e);I.bind("pinchZoomEnd",h);I.bind("wheelZoom",f)}GT.configurable(I,["inertia","container"],GT.paramTweaker(c,null,{container:function(p,t){H=document.getElementById(t);o()}}),true);o();return I};
T5.AnimatedPathLayer=function(c){function g(f,i,o){f.fillStyle="#FFFFFF";f.strokeStyle="#222222";f.beginPath();f.arc(o.x,o.y,4,0,Math.PI*2,false);f.stroke();f.fill()}c=T5.ex({path:[],id:GT.objId("pathAni"),easing:T5.easing("sine.inout"),validStates:T5.viewState("ACTIVE","PAN","PINCH"),drawIndicator:null,duration:2E3,autoCenter:false},c);var a=T5.V.edges(c.path),b,d=null,e=0;T5.tweenValue(0,a.total,c.easing,function(){h.remove()},c.duration).requestUpdates(function(f,i){e=f;i&&h.remove()});var h=T5.ex(new T5.ViewLayer(c),
{cycle:function(){for(var f=0;f<a.accrued.length&&a.accrued[f]<e;)f++;d=null;if(f<c.path.length-1){var i=e-(f>0?a.accrued[f-1]:0),o=c.path[f],k=c.path[f+1];b=T5.V.theta(o,k,a.edges[f]);d=T5.V.pointOnEdge(o,k,b,i);if(c.autoCenter)(f=h.getParent())&&f.centerOn(d)}return d?1:0},draw:function(f,i){if(d)(c.drawIndicator?c.drawIndicator:g)(f,i,new T5.Vector(d.x-i.x,d.y-i.y),b)}});return h};
(function(){T5.tileSize=256;T5.Tile=function(c){return c=T5.ex({x:0,y:0,gridX:0,gridY:0,dirty:false},c)};T5.ImageTile=function(c){c=T5.ex({url:"",sessionParamRegex:null,loaded:false},c);return new T5.Tile(c)}})();
T5.TileGrid=function(c){function g(v,D){var w=T5.Vector(v*f-k.x,D*f-k.y);return new T5.ImageTile({gridX:w.x,gridY:w.y})}function a(v,D,w,x){var A=Math.floor(c.gridSize*0.2),F=new T5.Vector;if(v<0||v+w>c.gridSize)F.x=v<0?-A:A;if(D<0||D+x>c.gridSize)F.y=D<0?-A:A;return F}function b(v,D,w){var x=GT.Log.getTraceTicks(),A=0,F=c.gridSize,K=c.tileSize;new T5.Vector(F/2,F/2);if(w)e=[];if(v)for(w=0;w<F;w++)for(var y=0;y<F;y++){if(!e[A]){var J=v(y,w,i,F);J.gridX=y*K-k.x;J.gridY=w*K-k.y;e[A]=J}A++}o=v;u=D;GT.Log.trace("tile grid populated",
x);Q.dirty=true;Q.wakeParent()}function d(v,D){if(L){var w,x=[],A=new T5.Vector(Math.floor((v.x+k.x)*j),Math.floor((v.y+k.y)*j));tilesNeeded=false;for(var F=T;F--;)for(var K=H;K--;){w=K+A.x>=0&&K+A.x<c.gridSize?e[(F+A.y)*c.gridSize+(K+A.x)]:null;var y=new T5.Vector(K-L.x,F-L.y);if(!w){l=a(A.x,A.y,H,T);w=g(K+A.x,F+A.y)}x.push({tile:w,centerness:T5.V.absSize(y)})}x.sort(function(J,N){return N.centerness-J.centerness});n||(n=Array(x.length));for(w=x.length;w--;){n[w]=x[w].tile;Q.prepTile(n[w],D)}}}c=
T5.ex({tileSize:T5.tileSize,drawGrid:false,center:new T5.Vector,gridSize:25,shiftOrigin:null,supportFastDraw:true},c);var e=Array(Math.pow(c.gridSize,2)),h=c.gridSize,f=c.tileSize,i=T5.V.offset(c.center,-Math.ceil(c.gridSize>>1)),o=null,k=new T5.Vector,u=null,r=Math.round(c.tileSize/2),j=c.tileSize?1/c.tileSize:0,m=true,n=null,s=false;new T5.Vector;var l=new T5.Vector;T5.getConfig();h=h*c.tileSize;var H,T,L,Q=T5.ex(new T5.ViewLayer(c),{gridDimensions:new T5.Dimensions(h,h),dirty:false,cycle:function(v,
D,w){v=0;if(l.x!==0||l.y!==0){var x=l,A=c.shiftOrigin;if(!(x.x===0&&x.y===0)){var F=GT.Log.getTraceTicks(),K=Array(e.length);K.length=e.length;for(var y=0;y<c.gridSize;y++)for(var J=0;J<c.gridSize;J++)K[J*c.gridSize+y]=y+x.x>=0&&y+x.x<c.gridSize?e[(J+x.y)*c.gridSize+(y+x.x)]:null;e=K;i=A?A(i,x):T5.V.add(i,x);k.x+=-x.x*c.tileSize;k.y+=-x.y*c.tileSize;GT.Log.trace("tile storage shifted",F);b(o,u)}l=new T5.Vector;v++}w!==T5.viewState("PINCH")&&d(D,w);return v+Q.dirty?1:0},deactivate:function(){m=false},
find:function(v){if(!v)return null;for(var D=e.length;D--;){var w=e[D];if(w&&v(w))return w}return null},prepTile:function(){},drawTile:function(){return false},getTileSize:function(){return c.tileSize},draw:function(v,D,w,x,A){if(m){var F=T5.time(),K=D.x;D=D.y;var y=true,J=A.needRepaint()||x===T5.viewState("PAN")||x===T5.viewState("PINCH")||T5.isTweening();if(!L){H=Math.ceil(w.width*j)+1;T=Math.ceil(w.height*j)+1;L=new T5.Vector(Math.floor((H-1)/2),Math.floor((T-1)/2))}if(n){if(c.drawGrid)v.strokeStyle=
"rgba(50, 50, 50, 0.3)";v.beginPath();for(w=n.length;w--;){var N=n[w];if(N){var S=N.gridX-K,U=N.gridY-D;if(!(J?false:!N.dirty)){y=Q.drawTile(v,N,S,U,x)&&y;N.x=S;N.y=U}}else y=false;c.drawGrid&&v.rect(S,U,c.tileSize,c.tileSize)}v.stroke();GT.Log.trace("drawn tiles",F);y&&!s&&A.trigger("tileDrawComplete");s=y;Q.dirty=false}}},getTileAtXY:function(v,D){for(var w=c.tileSize,x=n?n.length:0;x--;){var A=n[x];if(A&&v>=A.x&&D>=A.y)if(v<=A.x+w&&D<=A.y+w)return A}return null},getTileVirtualXY:function(v,D,w){v=
T5.V.add(new T5.Vector(v,D),T5.V.invert(i),k);v=new T5.Vector(v.x*c.tileSize,v.y*c.tileSize);if(w){v.x+=r;v.y+=r}return v},populate:function(v){b(v,null,true)}});GT.WaterCooler.listen("imagecache.cleared",function(){for(var v=e.length;v--;)if(e[v])e[v].loaded=false});GT.WaterCooler.listen("tiler.repaint",function(){for(var v=e.length;v--;)if(e[v]){e[v].x=null;e[v].y=null}});return Q};
T5.ImageTileGrid=function(c){function g(){o.getParent().trigger("invalidate");o.dirty=true;o.wakeParent()}c=T5.ex({emptyTile:function(k){if(!a||k!==a.width){a=T5.newCanvas(k,k);k=a.getContext("2d");k.fillStyle="rgba(150, 150, 150, 0.01)";k.fillRect(0,0,a.width,a.height)}return a}(T5.tileSize),panningTile:function(k){function u(){var r=T5.newCanvas(32,32),j=r.getContext("2d");j.fillStyle="#BBBBBB";j.fillRect(0,0,32,32);j.fillStyle="#C3C3C3";j.fillRect(0,0,16,16);j.fillRect(16,16,16,16);return r}if(!b||
k!==b.width){b=T5.newCanvas(k,k);k=b.getContext("2d");k.fillStyle=k.createPattern(u(),"repeat");k.fillRect(0,0,b.width,b.height)}return b}(T5.tileSize),tileOffset:new T5.Vector,tileDrawArgs:{}},c);var a=c.emptyTile,b=c.panningTile,d=T5.viewState("ACTIVE"),e=T5.viewState("PAN"),h=T5.getConfig().requireFastDraw,f=c.tileSize?c.tileSize:T5.tileSize,i=T5.ex({background:null,overlay:null,offset:new T5.Vector,realSize:new T5.Dimensions(f,f)},c.tileDrawArgs),o=T5.ex(new T5.TileGrid(c),{drawTile:function(k,
u,r,j,m){var n=u.url?T5.Images.get(u.url):null,s=false;if(n){k.drawImage(n,r,j);u.dirty=false;s=true}else if(m===e)b&&k.drawImage(b,r,j);else a&&k.drawImage(a,r,j);return s},prepTile:function(k,u){if(k)k.dirty=true;if(k&&(!h||u===d))T5.Images.get(k.url)||T5.Images.load(k.url,g,i)}});return o};
T5.Tiler=function(c){c=T5.ex({container:"",drawCenter:false,datasources:{},tileLoadThreshold:"first"},c);var g=T5.ex(new T5.View(c),{getTileLayer:function(){return g.getLayer("grid0")},setTileLayer:function(a){g.setLayer("grid0",a);GT.WaterCooler.say("grid.updated",{id:"grid0"})},viewPixToGridPix:function(a){var b=g.getOffset();return new T5.Vector(a.x+b.x,a.y+b.y)},centerOn:function(a,b,d,e){var h=g.getTileLayer(),f=g.getDimensions();(h=h?h.getTileSize():0)&&g.updateOffset(a.gridX-Math.floor((f.width-
h)*0.5),a.gridY-Math.floor((f.height-h)*0.5),b,d,e)},cleanup:function(){g.removeLayer("grid0")},repaint:function(){GT.WaterCooler.say("tiler.repaint");g.trigger("wake")},select:function(a){g.trigger("selectTile",a)}});g.bind("tap",function(a,b){var d=g.getTileLayer();if(d)(d=d.getTileAtXY(b.x,b.y))&&g.trigger("selectTile",d)});return g};
