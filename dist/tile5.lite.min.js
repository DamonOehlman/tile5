if(!this.JSON)this.JSON={};
(function(){function f(n){return n<10?"0"+n:n}function d(n){c.lastIndex=0;return c.test(n)?'"'+n.replace(c,function(j){var q=g[j];return typeof q==="string"?q:"\\u"+("0000"+j.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+n+'"'}function b(n,j){var q,m,i,r,s=e,u,o=j[n];if(o&&typeof o==="object"&&typeof o.toJSON==="function")o=o.toJSON(n);if(typeof k==="function")o=k.call(j,n,o);switch(typeof o){case "string":return d(o);case "number":return isFinite(o)?String(o):"null";case "boolean":case "null":return String(o);
case "object":if(!o)return"null";e+=h;u=[];if(Object.prototype.toString.apply(o)==="[object Array]"){r=o.length;for(q=0;q<r;q+=1)u[q]=b(q,o)||"null";i=u.length===0?"[]":e?"[\n"+e+u.join(",\n"+e)+"\n"+s+"]":"["+u.join(",")+"]";e=s;return i}if(k&&typeof k==="object"){r=k.length;for(q=0;q<r;q+=1){m=k[q];if(typeof m==="string")if(i=b(m,o))u.push(d(m)+(e?": ":":")+i)}}else for(m in o)if(Object.hasOwnProperty.call(o,m))if(i=b(m,o))u.push(d(m)+(e?": ":":")+i);i=u.length===0?"{}":e?"{\n"+e+u.join(",\n"+e)+
"\n"+s+"}":"{"+u.join(",")+"}";e=s;return i}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var a=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
c=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e,h,g={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},k;if(typeof JSON.stringify!=="function")JSON.stringify=function(n,j,q){var m;h=e="";if(typeof q==="number")for(m=0;m<q;m+=1)h+=" ";else if(typeof q==="string")h=q;if((k=j)&&typeof j!=="function"&&(typeof j!=="object"||typeof j.length!=="number"))throw Error("JSON.stringify");return b("",
{"":n})};if(typeof JSON.parse!=="function")JSON.parse=function(n,j){function q(i,r){var s,u,o=i[r];if(o&&typeof o==="object")for(s in o)if(Object.hasOwnProperty.call(o,s)){u=q(o,s);if(u!==undefined)o[s]=u;else delete o[s]}return j.call(i,r,o)}var m;n=String(n);a.lastIndex=0;if(a.test(n))n=n.replace(a,function(i){return"\\u"+("0000"+i.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(n.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){m=eval("("+n+")");return typeof j==="function"?q({"":m},""):m}throw new SyntaxError("JSON.parse");}})();if(!String.format)String.format=function(f){if(arguments.length<=1)return f;for(var d=arguments.length-2,b=0;b<=d;b++)f=f.replace(RegExp("\\{"+b+"\\}","gi"),arguments[b+1]);return f};
String.prototype.containsWord=function(f){var d="";if(f.toString)f=f.toString();for(var b=0;b<f.length;b++)d+=!/\w/.test(f[b])?"\\"+f[b]:f[b];return RegExp("(^|\\s|\\,)"+d+"(\\,|\\s|$)","i").test(this)};Number.prototype.toRad=function(){return this*Math.PI/180};Number.prototype.sec=function(){return 1/Math.cos(this)};
GRUNT=function(){var f=Object.prototype.hasOwnProperty,d=0,b={id:"GRUNT.core",extend:function(){var a=arguments[0]||{},c=1,e=arguments.length,h=false,g,k,n,j;if(typeof a==="boolean"){h=a;a=arguments[1]||{};c=2}if(typeof a!=="object"&&!b.isFunction(a))a={};if(e===c){a=this;--c}for(;c<e;c++)if((g=arguments[c])!=null)for(k in g){n=a[k];j=g[k];if(a!==j)if(h&&j&&(b.isPlainObject(j)||b.isArray(j))){n=n&&(b.isPlainObject(n)||b.isArray(n))?n:b.isArray(j)?[]:{};a[k]=b.extend(h,n,j)}else if(j!==undefined)a[k]=
j}return a},isFunction:function(a){return toString.call(a)==="[object Function]"},isArray:function(a){return toString.call(a)==="[object Array]"},isPlainObject:function(a){if(!a||toString.call(a)!=="[object Object]"||a.nodeType||a.setInterval)return false;if(a.constructor&&!f.call(a,"constructor")&&!f.call(a.constructor.prototype,"isPrototypeOf"))return false;var c;for(c in a);return c===undefined||f.call(a,c)},isEmptyObject:function(a){for(var c in a)return false;return true},isXmlDocument:function(a){return toString.call(a)===
"[object Document]"},contains:function(a,c){var e=a,h=arguments,g=1;if(c&&b.isArray(c)){h=c;g=0}for(g=g;g<h;g++)e=e&&typeof foo[h[g]]!=="undefined";return e},newModule:function(a){a=b.extend({id:null,requires:[],parent:null},a);if(a.parent)a=b.extend({},a.parent,a);return a},toID:function(a){return a.replace(/\s/g,"-")},generateObjectID:function(a){return(a?a:"obj")+d++}};return b}();
GRUNT.Log=function(){function f(e,h){var g,k=h&&h.length>0?h[0]:"";for(g=1;h&&g<h.length;g++)k+=" "+(b&&GRUNT.isPlainObject(h[g])?JSON.stringify(h[g]):h[g]);typeof console!=="undefined"&&console[e](k);for(g=0;g<d.length;g++)d[g].call(c,k,e)}var d=[],b=typeof JSON!=="undefined",a=window.console&&window.console.markTimeline,c={id:"GRUNT.log",getTraceTicks:function(){return a?(new Date).getTime():null},trace:function(e,h){if(a)console.markTimeline(e+(h?": "+(c.getTraceTicks()-h)+"ms":""))},debug:function(){f("debug",
arguments)},info:function(){f("info",arguments)},warn:function(){f("warn",arguments)},error:function(){f("error",arguments)},exception:function(e){c.error(arguments);for(var h in e)c.info("ERROR DETAIL: "+h+": "+e[h])},watch:function(e,h){try{h()}catch(g){c.exception(g,e)}},throwError:function(e){c.error(e);throw Error(e);},requestUpdates:function(e){d.push(e)}};return c}();
GRUNT.Data=function(){var f={determineObjectMapping:function(b){if(!b)return null;b=b.split("|");for(var a={},c=0;c<b.length;c++)a[b[c]]=c;return a},mapLineToObject:function(b,a){var c=b.split("|"),e={};for(var h in a){var g=a[h];e[h]=c.length>g?c[g]:null}return e},parse:function(b){var a=null,c=[];b=b.split("\n");for(var e=0;e<b.length;e++){var h=b[e];if(a)c.push(f.mapLineToObject(h,a));else a=f.determineObjectMapping(h)}return c}},d={supportedFormats:{JSON:{parse:function(b){return JSON.parse(b)}},
PDON:{parse:function(b){return f.parse(b)}}},parse:function(b){b=GRUNT.extend({data:"",format:"JSON"},b);if(!d.supportedFormats[b.format])throw Error("Unsupported data format: "+b.format+", cannot parse data in javascript object");try{return d.supportedFormats[b.format].parse(b.data)}catch(a){GRUNT.Log.error("ERROR PARSING DATA FROM FORMAT: "+b.format,b.data);GRUNT.Log.exception(a)}return{}}};return d}();
GRUNT.paramTweaker=function(f,d,b){return function(a,c){if(typeof c!=="undefined"){if(a in f)f[a]=c;b&&a in b&&b[a](a,c)}else return d&&a in d?d[a](a):f[a]}};
GRUNT.configurable=function(f,d,b,a){function c(e){f[e]||(f[e]=function(h){return f.configure(e,h)})}if(f){if(!f.configurableSettings){f.configurableId=GRUNT.generateObjectID("configurable");f.configurableSettings={};f.configCallbacks=[];if(!GRUNT.configurables)GRUNT.configurables={}}GRUNT.configurables[f.configurableId]=f;f.configCallbacks.push(b);for(b=d.length;b--;){f.configurableSettings[d[b]]=true;a&&c(d[b])}if(!f.configure)f.configure=function(e,h){var g=f.configCallbacks;if(f.configurableSettings[e]){for(var k=
g.length;k--;){var n=g[k](e,h);if(typeof n!=="undefined")return n}return GRUNT.configurables[f.configurableId]}return null}}};GRUNT.Template=function(){var f=/\$\{(.*?)\}/ig;return{parse:function(d,b){for(var a=d,c=f.exec(a);c;){a=a.replace(c[0],GRUNT.XPath.first(c[1],b));f.lastIndex=0;c=f.exec(a)}return a}}}();
GRUNT.JSONP=function(){function f(c){var e=document.createElement("script"),h=false;e.src=c;e.async=true;e.onload=e.onreadystatechange=function(){if(!h&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){h=true;e.onload=e.onreadystatechange=null;e&&e.parentNode&&e.parentNode.removeChild(e)}};b||(b=document.getElementsByTagName("head")[0]);b.appendChild(e)}var d=0,b,a=this;return{get:function(c,e,h){c+=c.indexOf("?")>=0?"&":"?";var g="json"+ ++d;a[g]=function(k){e(k);a[g]=
null;try{delete a[g]}catch(n){}};f(c+(h?h:"callback")+"="+g);return g}}}();
GRUNT.XHR=function(){var f={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},d={JSON:["json"],PDON:["pdon.txt"]},b=["TEXT","STREAM"],a=/^(\w+:)?\/\/([^\/?#]+)/,c={XML:function(g){return g.responseXML},JSON:function(g){try{return JSON.parse(g.responseText)}catch(k){GRUNT.Log.error("Error parsing JSON data: ",g.responseText);GRUNT.Log.exception(k)}return""},PDON:function(g){return GRUNT.Data.parse({data:g.responseText,format:"PDON"})},DEFAULT:function(g){return g.responseText}},
e={CONTENT_TYPE:"Content-Type"},h=GRUNT.newModule({id:"GRUNT.xhr",ajaxSettings:{xhr:null},ajax:function(g){try{g=GRUNT.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},h.ajaxSettings,g);var k=a.exec(g.url),n=k&&(k[1]&&k[1]!==location.protocol||k[2]!==location.host);if(g.data)g.method="POST";if(g.url){k=null;if(g.xhr)k=g.xhr(g);k||(k=new XMLHttpRequest);k.open(g.method,g.url,g.async);g.data&&k.setRequestHeader("Content-Type",
g.contentType);n||k.setRequestHeader("X-Requested-With","XMLHttpRequest");k.onreadystatechange=function(){if(this.readyState===4){var q=null,m=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(m)if(g.handleResponse)g.handleResponse(this);else{var i=g,r=this.getResponseHeader(e.CONTENT_TYPE),s,u=false;for(s in f)if(r&&r.indexOf(f[s])>=0){u=true;break}r=!u;for(u=0;u<b.length;u++)r=r||b[u]==s;if(r)b:{r=s;for(var o in d)for(u=
0;u<d[o].length;u++)if(RegExp(d[o][u]+"$","i").test(i.url)){s=o;break b}s=r?r:"DEFAULT"}try{q=c[s](this,i)}catch(l){GRUNT.Log.warn("error applying processor '"+s+"' to response type, falling back to default");q=c.DEFAULT(this,i)}}else g.error&&g.error(this)}catch(x){GRUNT.Log.exception(x,"PROCESSING AJAX RESPONSE")}m&&q&&g.success&&g.success.call(this,q)}};k.send(g.method=="POST"?h.param(g.data):null)}else GRUNT.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(j){GRUNT.Log.exception(j)}},
param:function(g){var k=[],n=function(q,m){m=GRUNT.isFunction(m)?m():m;k[k.length]=encodeURIComponent(q)+"="+encodeURIComponent(m)};if(GRUNT.isArray(g))for(var j=0;j<g.length;j++)n(g[j].name,g[j].value);else for(j in g)n(j,g[j]);return k.join("&").replace(/%20/g,"+")}});return h}();
GRUNT.XPath=function(){function f(c){for(var e=null,h=0;h<d.length;h++)if(e=d[h](c))break;return e}var d=[],b=[null,function(c){return c.numberValue},function(c){return c.stringValue},function(c){return c.booleanValue},null,null,null,null,function(c){return c.singleNodeValue?c.singleNodeValue.textContent:null},function(c){return c.singleNodeValue?c.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||GRUNT.Log.warn("No XPATH support, this is going to cause problems");var a={SearchResult:function(c){return{toString:function(){var e=
null;if(c){var h=null;if(c.resultType>=0&&c.resultType<b.length)h=b[c.resultType];if(h){GRUNT.Log.info("invoking match handler for result type: "+c.resultType);e=h(c)}}return e?e:""}}},first:function(c,e){var h=a.SearchResult,g;var k=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!k)k=XPathResult.ANY_TYPE;try{if(GRUNT.isXmlDocument(e))g=e.evaluate(c,e,f,k,null);else{GRUNT.Log.warn("attempted xpath expression: "+c+" on a non-xml document");g=null}}catch(n){GRUNT.Log.warn("attempted to run invalid xpath expression: "+
c+" on node: "+e);g=null}return new h(g)},registerResolver:function(c){d.push(c)}};return a}();
GRUNT.observable=function(f){if(f){if(!f.observableHandlers)f.observableHandlers={};if(!(f.bind||f.trigger||f.unbind)){f.bind=function(d,b){var a=GRUNT.generateObjectID("callback"),c=f.observableHandlers;c[d]||(c[d]=[]);f.observableHandlers[d].push({callback:b,callbackId:a});return a};f.trigger=function(d){var b=f.observableHandlers[d];if(!b)return f;for(var a=b.length;a--;)b[a].callback.apply(self,Array.prototype.slice.call(arguments,1));return f};f.unbind=function(d,b){for(var a=f.observableHandlers[d],
c=0;a&&c<a.length;c++)if(a[c].callbackId===b){a.splice(c,1);break}return f}}}};GRUNT.WaterCooler=function(){var f={},d=[];return{addPipe:function(b){b("pipe.test",{});d.push(b)},listen:function(b,a){f[b]||(f[b]=[]);a&&f[b].push(a)},say:function(b,a){var c;for(c=d.length;c--;)d[c](b,a);if(f[b])for(c=f[b].length;c--;)f[b][c](a)},leave:function(){}}}();
GRUNT.Storage=function(){function f(d){if(d&&d=="session")return sessionStorage;return localStorage}return{get:function(d,b){var a=f(b).getItem(d);return/^(\{|\[).*(\}|\])$/.test(a)?JSON.parse(a):a},set:function(d,b,a){b=jQuery.isArray(b)||jQuery.isPlainObject(b)?JSON.stringify(b):b;f(a).setItem(d,b)},remove:function(d,b){f(b).removeItem(d)}}}();
T5=function(){var f={ex:GRUNT.extend,newCanvas:function(d,b){var a=document.createElement("canvas");typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(a);a.width=d?d:0;a.height=b?b:0;return a},time:function(){return(new Date).getTime()},Settings:function(){var d={};return{get:function(b){return d[b]},set:function(b,a){d[b]=a},extend:function(b){T5.ex(d,b)}}}(),Vector:function(d,b){return{x:d?d:0,y:b?b:0}},V:function(){function d(b){if(!b||b.length<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");
for(var a={edges:Array(b.length-1),accrued:Array(b.length-1),total:0},c=T5.V.diff,e=0;e<b.length-1;e++){var h=c(b[e],b[e+1]);a.edges[e]=Math.sqrt(h.x*h.x+h.y*h.y);a.accrued[e]=a.total+a.edges[e];a.total+=a.edges[e]}return a}return{create:function(b,a){return new f.Vector(b,a)},add:function(){for(var b=new f.Vector,a=arguments.length;a--;){b.x+=arguments[a].x;b.y+=arguments[a].y}return b},absSize:function(b){return Math.max(Math.abs(b.x),Math.abs(b.y))},diff:function(b,a){return new f.Vector(b.x-a.x,
b.y-a.y)},copy:function(b){return b?new f.Vector(b.x,b.y):null},invert:function(b){return new T5.Vector(-b.x,-b.y)},offset:function(b,a,c){return new T5.Vector(b.x+a,b.y+(c?c:a))},edges:d,distance:function(b){return d(b).total},theta:function(b,a,c){c=Math.asin((b.y-a.y)/c);return b.x>a.x?c:Math.PI-c},pointOnEdge:function(b,a,c,e){a=new T5.Vector(Math.cos(c)*e,Math.sin(c)*e);return new T5.Vector(b.x-a.x,b.y-a.y)},getRect:function(b){var a=b.length;if(a>1)return new T5.Rect(Math.min(b[0].x,b[a-1].x),
Math.min(b[0].y,b[a-1].y),Math.abs(b[0].x-b[a-1].x),Math.abs(b[0].y-b[a-1].y))},toString:function(b){return b.x+", "+b.y}}}(),Dimensions:function(d,b){return{width:d?d:0,height:b?b:0}},D:function(){return{getAspectRatio:function(d){return d.height!==0?d.width/d.height:1},getCenter:function(d){return new f.Vector(d.width/2,d.height/2)},getSize:function(d){return Math.sqrt(Math.pow(d.width,2)+Math.pow(d.height,2))}}}(),Rect:function(d,b,a,c){return{origin:new f.Vector(d,b),dimensions:new f.Dimensions(a,
c)}},R:function(){return{copy:function(d){return d?new f.Rect(d.origin.x,d.origin.y,d.dimensions.width,d.dimensions.height):null},getCenter:function(d){return new T5.Vector(d.origin.x+d.dimensions.width/2,d.origin.y+d.dimensions.height/2)}}}()};return f}();
T5.Device=function(){function f(){for(;j.length>0;){var m=j.shift();document.location=m}n=0}function d(m){for(var i=true,r=q.length;r--;)i=i&&m!=q[r];return i}function b(m,i){var r=[];for(var s in i)s&&r.push(s+"="+escape(i[s]));return"tile5://"+m+"/"+(r.length>0?"?"+r.join("&"):"")}function a(m,i){d(m)&&GRUNT.Log.info("would push url: "+b(m,i))}function c(m,i){if(d(m)){j.push(b(m,i));n||(n=setTimeout(f,100))}}function e(){h={base:{name:"Unknown",eventTarget:document,supportsTouch:"createTouch"in
document,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:a,targetFps:null},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:c,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:c},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:c},android:{name:"Android OS <= 2.1",regex:/android/i,eventTarget:document.body,
supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},bridgeNotify:c},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:c}};g=[h.froyo,h.android,h.ipod,h.iphone,h.ipad]}var h=null,g=[],k=null,n=0,j=[],q=["view.wake","tile.loaded"];return{getConfig:function(){h||e();if(!k){GRUNT.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var m=0;m<g.length;m++){var i=g[m];if(i.regex&&i.regex.test(navigator.userAgent)){k=
T5.ex({},h.base,i);GRUNT.Log.info("PLATFORM DETECTED AS: "+k.name);break}}if(!k){GRUNT.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");k=h.base}GRUNT.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return k}}}();
T5.Resources=function(){var f="",d={},b=function(){function c(){var l=n[this.id];if(l&&l.image.complete&&l.image.width>0){l.loaded=true;l.hitCount=1;for(var x=m.length;x--;)if(m[x].image.src==this.src){m.splice(x,1);break}if(l.background||l.postProcess)if(l.image){x=T5.newCanvas(l.realSize?l.realSize.width:image.width,l.realSize?l.realSize.height:image.height);var v=x.getContext("2d"),y=l.offset?l.offset:new T5.Vector;l.background&&v.drawImage(l.background,0,0);v.drawImage(l.image,y.x,y.y);l.postProcess&&
l.postProcess(v,l);l.image=x}l.loadCallback&&l.loadCallback(this,false);i.push({url:this.src,created:l.requested});delete n[this.id];e()}}function e(){for(var l=T5.Device.getConfig().maxImageLoads;q.length>0&&(!l||m.length<l);){var x=q.shift();if(x.imageLoader){m.push(x);x.imageLoader(x,c)}}}function h(l){for(var x=null,v=r.length;v--&&!x;)x=r[v](l);return x?x:function(y,H){y.image.onload=H;y.image.src=a.getPath(y.url);y.requested=T5.time()}}function g(){u=true;try{var l=Math.floor(i.length/2);if(l>
0){i.sort(function(v,y){return v.created-y.created});for(var x=l;x--;)delete k[i[x].url];i.splice(0,l)}}finally{u=false}GRUNT.WaterCooler.say("imagecache.cleared")}var k={},n={},j=0,q=[],m=[],i=[],r=[],s=0,u=false,o={loadingImages:m,queuedImages:q,addInterceptor:function(l){r.push(l)},getCacheFullness:function(){return s},getImage:function(l){var x=null,v=null;u||(x=k[l]);if((v=x?x.image:null)&&(v.getContext||v.complete&&v.width>0))return v},loadImage:function(l,x,v){var y=k[l];if(y){y.hitCount++;
y.image.complete&&x&&x(y.image,true)}else{y=T5.ex({url:l,image:new Image,loaded:false,imageLoader:h(l),created:T5.time(),requested:null,hitCount:0,loadCallback:x},v);y.image.id="resourceLoaderImage"+j++;k[l]=y;n[y.image.id]=y;q.push(y);e()}return y},resetLoadingQueue:function(){m=[]}};setInterval(function(){for(var l=T5.time(),x=false,v=0,y=T5.Device.getConfig();v<m.length;)if(l-m[v].requested>a.loadTimeout*1E3){m.splice(v,1);x=true}else v++;x&&e();if(y&&y.imageCacheMaxSize){s=i.length*a.avgImageSize/
y.imageCacheMaxSize;s>=1&&g()}},1E3);return o}(),a={avgImageSize:25,loadTimeout:10,Cache:function(){return{read:function(){return null},write:function(){},getUrlCacheKey:function(c,e){for(var h=(c?c.replace(/^.*\?/,""):"").split("&"),g=c?c.replace(/\?.*$/,"?"):"",k=0;k<h.length;k++){var n=h[k].split("=");if(!e||!e.test(n[0]))g+=h[k]+"&"}return g.replace(/\W/g,"")},isValidCacheKey:function(c){GRUNT.Log.info("cache key = "+c);return false}}}(),addInterceptor:b.addInterceptor,getPath:function(c){return/^(file|https?|\/)/.test(c)?
c:f+c},setBasePath:function(c){f=c},getImage:function(c){return b.getImage(c)},loadImage:function(){b.loadImage.apply(null,arguments)},resetImageLoadQueue:function(){b.resetLoadingQueue()},getStats:function(){return{imageLoadingCount:b.loadingImages.length,queuedImageCount:b.queuedImages.length,imageCacheFullness:b.getCacheFullness()}},loadResource:function(c){c=T5.ex({filename:"",cacheable:true,dataType:null,callback:null},c);var e=function(h){c.callback&&GRUNT.Log.watch("CALLING RESOURCE CALLBACK",
function(){c.callback(h)})};c.cacheable&&d[c.filename]?e(d[c.filename]):GRUNT.XHR.ajax({url:a.getPath(c.filename),dataType:c.dataType,success:function(h){if(c.cacheable)d[c.filename]=h;e(h)},error:function(h,g,k){GRUNT.Log.error("error loading resource ["+c.filename+"], error = "+k)}})},loadSnippet:function(c,e){/\.\w+$/.test(c)||(c+=".html");a.loadResource({filename:"snippets/"+c,callback:e,dataType:"html"})}};return a}();
T5.Touch=function(){function f(i,r){var s=i&&i.length>0?i[0]:null;if(s&&r&&r.length>0)return T5.V.diff(s,r[0]);return null}function d(i){i.preventDefault();i.stopPropagation()}function b(i){for(var r=Array(i.length),s=i.length;s--;)r[s]=new T5.Vector(i[s].pageX,i[s].pageY);return r}function a(i){return[new T5.Vector(i.pageX,i.pageY)]}var c=120,e=100,h=250,g={TAP:0,MOVE:1,PINCHZOOM:2},k=7,n=0,j=0,q=function(i){function r(t,z,D,A){var L=Math.asin((t.y-z.y)/D);D=Math.min(Math.floor(D*(W.duration/A)),
W.max);L=z.x>t.x?L:Math.PI-L;t=new T5.Vector(Math.cos(L)*-D,Math.sin(L)*D);o("inertiaPan",t.x,t.y)}function s(t,z){var D,A;if(I){D=z-X;if(D<h){A=T5.V.distance([C[0],t]);A>i.inertiaTrigger&&r(C[0],t,A,D)}}else{O=t;var L=setInterval(function(){D=T5.time()-z;A=T5.V.distance([t,O]);if(D<e&&A>i.inertiaTrigger){clearInterval(L);r(t,O,A,D)}else D>e&&clearInterval(L)},5)}}function u(t){for(var z=[],D=i.element?-i.element.offsetLeft:0,A=i.element?-i.element.offsetTop:0,L=t.length;L--;)z.push(T5.V.offset(t[L],
D,A));return z}function o(){i.observable&&i.observable.trigger.apply(null,arguments)}function l(t){if(t.target&&t.target===i.element){C=I?b(t.touches):a(t);K=new T5.Vector;Q=new T5.Vector;U=true;H=false;X=T5.time();I&&d(t);o("inertiaCancel");S.current=X;if(t=C.length>0?C[0]:null){o("touchStart",t.x,t.y);if(S.current-S.last<ca.THRESHOLD_DOUBLETAP)if((t=R?T5.V.diff(C[0],R[0]):null)&&Math.abs(t.x)<i.maxDistDoubleTap&&Math.abs(t.y)<i.maxDistDoubleTap)H=true;P=g.TAP;R=[].concat(C)}else GRUNT.Log.warn("Touch start fired, but no touch vector found")}}
function x(t){if(t.target&&t.target===i.element){O=(I?b(t.touches):a(t))[0];if(U)try{I&&d(t);var z=I?b(t.touches):a(t);t=0;if(z.length>1){if(C.length===1)C=[].concat(z);t=T5.V.distance(C)-T5.V.distance(z)}if(P===g.TAP){var D=f(z,C);if(D&&(Math.abs(D.x)>=k||Math.abs(D.y)>=k))P=g.MOVE}if(P!==g.TAP)if(!t||Math.abs(t)<i.pinchZoomThreshold){if(K=f(z,R)){Q.x-=K.x;Q.y-=K.y;G.x-=K.x;G.y-=K.y}if(T5.V.absSize(G)>i.panEventThreshhold){o("pan",G.x,G.y);G=T5.V.create()}P=g.MOVE}else{o("pinchZoom",u(C),u(z));P=
g.PINCHZOOM}R=[].concat(z)}catch(A){GRUNT.Log.exception(A)}}}function v(t){if(t.target&&t.target===i.element){var z=(I?b(t.changedTouches):a(t))[0];try{I&&d(t);var D=T5.time();S.last=S.current;if(P===g.TAP)N||(N=setTimeout(function(){N=0;var L=H?"doubleTap":"tap",Z=C[0],V=null;if(i.element)V=T5.V.offset(Z,-i.element.offsetLeft,-i.element.offsetTop);o(L,Z,V)},ca.THRESHOLD_DOUBLETAP+50));else if(P==g.MOVE){o("panEnd",Q.x,Q.y);W&&s(z,D)}else P==g.PINCHZOOM&&o("pinchZoomEnd",u(C),u(R),D-X)}catch(A){GRUNT.Log.exception(A)}}U=
false}function y(t){if(t.target&&t.target===i.element){var z;if(t.detail){z=-t.detail*c;z=new T5.Vector(t.axis===1?z:0,t.axis===2?z:0)}else z=new T5.Vector(t.wheelDeltaX,t.wheelDeltaY);var D=z.y!==0?Math.abs(z.y/c):0;if(O&&D!==0){var A=T5.V.offset(O,-i.element.offsetLeft,-i.element.offsetTop);o("wheelZoom",A,Math.pow(2,z.y>0?D:-D))}t.preventDefault()}}i=T5.ex({element:null,observable:null,inertiaTrigger:20,maxDistDoubleTap:20,panEventThreshhold:0,pinchZoomThreshold:5,touchStartHandler:null,moveHandler:null,
moveEndHandler:null,pinchZoomHandler:null,pinchZoomEndHandler:null,tapHandler:null,doubleTapHandler:null,wheelZoomHandler:null},i);var H=false,N=0,I=T5.Device.getConfig().supportsTouch,C=null,R=null,K=null,Q=null,G=new T5.Vector,P=null,U=false,X=0,Y=[],O=null,W=null,S={current:0,last:0},J=T5.Device.getConfig(),ca={supportsTouch:I,THRESHOLD_DOUBLETAP:300,addListeners:function(t){Y.push(t)},decoupleListeners:function(t){for(var z=0;t&&z<Y.length;z++)if(Y[z].listenerId===t){Y.splice(z,1);GRUNT.Log.info("successfully decoupled touch listener: "+
t);break}},release:function(){J.eventTarget.removeEventListener(J.supportsTouch?"touchstart":"mousedown",l,false);J.eventTarget.removeEventListener(J.supportsTouch?"touchmove":"mousemove",x,false);J.eventTarget.removeEventListener(J.supportsTouch?"touchend":"mouseup",v,false);if(!J.supportsTouch){window.removeEventListener("mousewheel",y,false);window.removeEventListener("DOMMouseScroll",y,false)}},inertiaEnable:function(t,z){W={duration:t,max:z?Math.min(z.width,z.height):500}},inertiaDisable:function(){W=
null}};J.eventTarget.addEventListener(J.supportsTouch?"touchstart":"mousedown",l,false);J.eventTarget.addEventListener(J.supportsTouch?"touchmove":"mousemove",x,false);J.eventTarget.addEventListener(J.supportsTouch?"touchend":"mouseup",v,false);if(!J.supportsTouch){window.addEventListener("mousewheel",y,false);window.addEventListener("DOMMouseScroll",y,false)}return ca},m=[];return{capture:function(i,r){if(!i)throw Error("Unable to capture touch of null element");if(!i.id)i.id="touchable_"+n++;var s=
m[i.id];if(!s){s=new q(T5.ex({element:i},r));m[i.id]=s;GRUNT.Log.info("CREATED TOUCH HELPER. SUPPORTS TOUCH = "+s.supportsTouch)}r.listenerId&&s.decoupleListeners(r.listenerId);r.listenerId=++j;s.addListeners(r);return s},resetTouch:function(i){if(i&&i.id&&m[i.id]){m[i.id].release();delete m[i.id]}}}}();if(typeof jQuery!=="undefined"){jQuery.fn.canTouchThis=function(f){return this.each(function(){T5.Touch.capture(this,f)})};jQuery.fn.untouchable=function(){return this.bind("touchmove",function(f){f.preventDefault()})}}
T5.Easing=function(){var f=1.70158;return{Linear:function(d,b,a,c){return a*d/c+b},Back:{In:function(d,b,a,c){return a*(d/=c)*d*((f+1)*d-f)+b},Out:function(d,b,a,c){return a*((d=d/c-1)*d*((f+1)*d+f)+1)+b},InOut:function(d,b,a,c){return(d/=c/2)<1?a/2*d*d*(((f*=1.525)+1)*d-f)+b:a/2*((d-=2)*d*(((f*=1.525)+1)*d+f)+2)+b}},Bounce:{In:function(d,b,a,c){return a-module.Easing.Bounce.Out(c-d,0,a,c)+b},Out:function(d,b,a,c){return(d/=c)<1/2.75?a*7.5625*d*d+b:d<2/2.75?a*(7.5625*(d-=1.5/2.75)*d+0.75)+b:d<2.5/
2.75?a*(7.5625*(d-=2.25/2.75)*d+0.9375)+b:a*(7.5625*(d-=2.625/2.75)*d+0.984375)+b},InOut:function(d,b,a,c){return d<c/2?module.Easing.Bounce.In(d*2,0,a,c)/2+b:module.Easing.Bounce.Out(d*2-c,0,a,c)/2+a/2+b}},Cubic:{In:function(d,b,a,c){return a*(d/=c)*d*d+b},Out:function(d,b,a,c){return a*((d=d/c-1)*d*d+1)+b},InOut:function(d,b,a,c){if((d/=c/2)<1)return a/2*d*d*d+b;return a/2*((d-=2)*d*d+2)+b}},Elastic:{In:function(d,b,a,c,e,h){if(d==0)return b;if((d/=c)==1)return b+a;h||(h=c*0.3);if(!e||e<Math.abs(a)){e=
a;a=h/4}else a=h/(2*Math.PI)*Math.asin(a/e);return-(e*Math.pow(2,10*(d-=1))*Math.sin((d*c-a)*2*Math.PI/h))+b},Out:function(d,b,a,c,e,h){var g;if(d==0)return b;if((d/=c)==1)return b+a;h||(h=c*0.3);if(!e||e<Math.abs(a)){e=a;g=h/4}else g=h/(2*Math.PI)*Math.asin(a/e);return e*Math.pow(2,-10*d)*Math.sin((d*c-g)*2*Math.PI/h)+a+b},InOut:function(d,b,a,c,e,h){var g;if(d==0)return b;if((d/=c/2)==2)return b+a;h||(h=c*0.3*1.5);if(!e||e<Math.abs(a)){e=a;g=h/4}else g=h/(2*Math.PI)*Math.asin(a/e);if(d<1)return-0.5*
e*Math.pow(2,10*(d-=1))*Math.sin((d*c-g)*2*Math.PI/h)+b;return e*Math.pow(2,-10*(d-=1))*Math.sin((d*c-g)*2*Math.PI/h)*0.5+a+b}},Quad:{In:function(d,b,a,c){return a*(d/=c)*d+b},Out:function(d,b,a,c){return-a*(d/=c)*(d-2)+b},InOut:function(d,b,a,c){if((d/=c/2)<1)return a/2*d*d+b;return-a/2*(--d*(d-2)-1)+b}},Sine:{In:function(d,b,a,c){return-a*Math.cos(d/c*(Math.PI/2))+a+b},Out:function(d,b,a,c){return a*Math.sin(d/c*(Math.PI/2))+b},InOut:function(d,b,a,c){return-a/2*(Math.cos(Math.PI*d/c)-1)+b}}}}();
T5.Animation=function(){function f(){if(a===0)a=setInterval(function(){var e;e=T5.time();if(!b){b=true;try{for(var h=0;h<d.length;)if(d[h].isComplete()){d[h].triggerComplete(false);d.splice(h,1)}else{d[h].update(e);h++}}finally{b=false}}e=d.length;if(e===0){clearInterval(a);a=0}},20)}var d=[],b=false,a=0,c={DURATION:2E3,tweenValue:function(e,h,g,k,n){e=new c.Tween({startValue:e,endValue:h,tweenFn:g,complete:k,duration:n});d.push(e);return e},tween:function(e,h,g,k,n,j){e=new c.Tween({target:e,property:h,
endValue:g,tweenFn:k,duration:j,complete:n});d.push(e);return e},tweenVector:function(e,h,g,k,n,j){var q=[];if(e){var m=e.x==h,i=e.y==g;m||q.push(c.tween(e,"x",h,k,function(){(m=true)&&i&&n()},j));i||q.push(c.tween(e,"y",g,k,function(){i=true;m&&i&&n()},j))}return q},cancel:function(e){if(!b){b=true;try{for(var h=0;h<d.length;)if(!e||e(d[h])){d[h].triggerComplete(true);d.splice(h,1)}else h++}finally{b=false}}},isTweening:function(){return d.length>0},Tween:function(e){e=T5.ex({target:null,property:null,
startValue:0,endValue:null,duration:c.DURATION,tweenFn:c.DEFAULT,complete:null,cancelOnInteract:false},e);var h=T5.time(),g=[],k=false,n=0,j=0,q={cancelOnInteract:e.cancelOnInteract,isComplete:function(){return k},triggerComplete:function(m){e.complete&&e.complete(m)},update:function(m){try{var i=e.tweenFn(m-h,n,j,e.duration);if(e.target)e.target[e.property]=i;for(var r=g.length;r--;)g[r](i,void 0);if(k=h+e.duration<=m){if(e.target)e.target[e.property]=e.tweenFn(e.duration,n,j,e.duration);for(var s=
g.length;s--;)g[s](i,true)}}catch(u){GRUNT.Log.exception(u)}},requestUpdates:function(m){g.push(m)}};n=e.target&&e.property&&e.target[e.property]?e.target[e.property]:e.startValue;if(typeof e.endValue!=="undefined")j=e.endValue-n;if(j==0)k=true;f();return q}};return T5.ex(c,{DEFAULT:T5.Easing.Back.Out})}();T5.ViewState=function(){var f={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,PINCHZOOM:16,FREEZE:128,get:function(){for(var d=0,b=arguments.length;b--;){var a=f[arguments[b]];if(a)d|=a}return d}};return f}();
T5.ViewLayer=function(f){f=T5.ex({id:"",centerOnScale:true,created:T5.time(),scalePosition:true,zindex:0,supportFastDraw:false,validStates:T5.ViewState.get("ACTIVE","ANIMATING","PAN","PINCHZOOM")},f);var d=null,b=f.id,a=T5.ViewState.get("ACTIVE"),c=T5.ex({addToView:function(e){e.setLayer(b,c)},shouldDraw:function(e){var h=d?d.fastDraw&&e!==a:false;return(e&f.validStates)!==0&&(h?f.supportFastDraw:true)},cycle:function(){return 0},draw:function(){},remove:function(){GRUNT.WaterCooler.say("layer.remove",
{id:b})},wakeParent:function(){d&&d.trigger("wake")},getId:function(){return b},setId:function(e){b=e},getParent:function(){return d},setParent:function(e){d=e}},f);return c};
T5.View=function(f){function d(p,w,B,F){U=typeof B!=="undefined";E.updateOffset(v.x+p,v.y+w,B,F);u();T=T5.ViewState.PAN}function b(p,w){f.inertia&&d(p,w,f.panAnimationEasing,f.panAnimationDuration)}function a(){T=T5.ViewState.ACTIVE;U=false;setTimeout(u,50)}function c(p,w){z=T5.V.getRect(p);D=T5.V.getRect(w);var B=T5.D.getSize(z.dimensions),F=T5.D.getSize(D.dimensions);V=T5.R.getCenter(z);G=T5.R.getCenter(D);A=z&&B!==0?F/B:1}function e(p,w){c(p,w);if(t=A!==1){T=T5.ViewState.PINCHZOOM;u()}}function h(p,
w,B){c(p,w);if(f.adjustScaleFactor){A=f.adjustScaleFactor(A);GRUNT.Log.info("scale factor adjusted to: "+A)}if(B<f.pinchZoomAnimateTrigger){q(L,A,V,m(),T5.Easing.Sine.Out,function(){k();A=1},300);A=L}else{k();A=1}}function g(p,w){E.zoom(p,Math.min(Math.pow(2,Math.round(Math.log(w))),8),500)}function k(){GRUNT.WaterCooler.say("view.scale",{id:E.id});t=false;E.trigger("scale",A,z?m():G);T=T5.ViewState.ACTIVE;u()}function n(){if(l){T5.Touch.resetTouch(l);if(f.autoSize){l.height=window.innerHeight-l.offsetTop;
l.width=window.innerWidth-l.offsetLeft}try{x=l.getContext("2d");x.globalCompositeOperation=f.initialDrawMode;x.clearRect(0,0,l.width,l.height)}catch(p){GRUNT.Log.exception(p);throw Error("Could not initialise canvas on specified view element");}ea=T5.Touch.capture(l,{observable:E});f.inertia&&ea.inertiaEnable(f.panAnimationDuration,C);C=E.getDimensions();R=T5.D.getCenter(C);u()}}function j(p,w){w.setId(p);w.setParent(E);o.push(w);o.sort(function(B,F){var M=F.zindex-B.zindex;if(M===0)M=F.created-B.created;
return M})}function q(p,w,B,F,M,ba,$){function da(){ba&&ba();k();A=1;Z=null}t=true;V=T5.V.copy(B);G=T5.V.copy(F);z=null;if(M)T5.Animation.tweenValue(0,w-p,M,da,$?$:1E3).requestUpdates(function(aa){Z=aa/(w-p);A=p+aa;T=T5.ViewState.PINCHZOOM;u();E.trigger("animate")});else{A=targetScaleFactor;da()}}function m(){var p=T5.D.getCenter(C),w=T5.V.distance([G,p]),B=T5.V.theta(G,p,w),F=T5.V.diff(V,G);p=T5.V.pointOnEdge(G,p,B,w/A);p.x+=F.x;p.y+=F.y;return p}function i(){E.trigger("idle");P=true;O=0}function r(p,
w){var B=0,F=E.getDisplayState(),M=T5.time(),ba=(F&T5.ViewState.PINCHZOOM)!==0,$=0;if(y||ba){p.clearRect(0,0,l.width,l.height);y=false}if(ba){T5.D.getCenter(C);var da=(Z?Z:1)/2,aa=T5.V.diff(V,G);if(S=z?new T5.Vector(G.x+aa.x,G.y+aa.y):new T5.Vector(G.x-aa.x*da,G.y-aa.y*da))w=T5.V.offset(w,S.x,S.y)}p.save();try{L=A;if(I!==1)p.scale(I,I);else if(ba){p.translate(G.x,G.y);p.scale(A,A)}for($=o.length;$--;)if(o[$].shouldDraw(F)){var fa=o[$].draw(p,w,C,F,E);B+=fa?fa:0}}finally{p.restore()}GRUNT.Log.trace("draw complete",
M);Y=false;return B}function s(){var p=0,w=!U&&(T===T5.ViewState.PINCHZOOM||T===T5.ViewState.PAN);J=T5.time();v.x=Math.floor(v.x);v.y=Math.floor(v.y);Q&&H&&Q.delays.push(J-H);if(w){T5.Animation.cancel(function(F){return F.cancelOnInteract});P=false;if(O!==0){clearTimeout(O);O=0}}for(w=o.length;w--;){var B=o[w].cycle(J,v,T);p+=B?B:0}if(H+ca<J){p+=r(x,v);H=J}X=0;if(K+p>0)u();else if(!P&&O===0)O=setTimeout(i,500);GRUNT.Log.trace("Completed draw cycle",J)}function u(){K++;if(!(N||X!==0)){K=0;X=setTimeout(s,
0)}}f=T5.ex({id:GRUNT.generateObjectID("view"),container:"",clearOnDraw:false,scaleDamping:false,fastDraw:false,fillStyle:"rgb(200, 200, 200)",initialDrawMode:"source-over",bufferRefresh:100,defaultFreezeDelay:500,inertia:true,pannable:true,scalable:true,panAnimationEasing:T5.Easing.Sine.Out,panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:false},f);var o=[],l=document.getElementById(f.container),x=null,v=new T5.Vector,y=false,H=null,N=false,I=1,C=null,R=null,K=
0,Q=null,G=null,P=false,U=false,X=0,Y=false,O=0,W=0,S=null,J=0;T5.Device.getConfig();var ca=0,t=false,z=null,D=null,A=1,L=1,Z=null,V=null,ea=null,T=T5.ViewState.ACTIVE,E={id:f.id,deviceScaling:I,fastDraw:f.fastDraw||T5.Device.getConfig().requireFastDraw,animate:function(p,w,B,F,M){q(A,p,w,B,F,M)},centerOn:function(p){E.setOffset(p.x-l.width/2,p.y-l.height/2)},getDimensions:function(){if(l)return new T5.Dimensions(l.width,l.height)},getZoomCenter:function(){return S},getLayer:function(p){for(var w=
0;w<o.length;w++)if(o[w].getId()==p)return o[w];return null},setLayer:function(p,w){for(var B=0;B<o.length;B++)if(o[B].getId()===p){o.splice(B,1);break}w&&j(p,w);GRUNT.WaterCooler.say("layer.update",{id:p});u()},eachLayer:function(p){for(var w=0;w<o.length;w++)p(o[w])},clearBackground:function(){y=true},freeze:function(){N=true},unfreeze:function(){N=false;u()},needRepaint:function(){return Y},snapshot:function(){},getDisplayState:function(){return N?T5.ViewState.FROZEN:T},scale:function(p,w,B,F,
M){F||(F=T5.D.getCenter(C));M||(M=T5.D.getCenter(C));E.animate(p,F,M,w,B);return E},removeLayer:function(p){a:{for(var w=o.length;w--;)if(o[w].getId()==p){p=w;break a}p=-1}if(p>=0&&p<o.length){GRUNT.WaterCooler.say("layer.removed",{layer:o[p]});o.splice(p,1)}},getOffset:function(){return T5.V.copy(v)},setOffset:function(p,w){v.x=p;v.y=w},updateOffset:function(p,w,B,F){function M(){a(0,0)}if(B){p=new T5.Vector(p,w);B=T5.Animation.tweenVector(v,p.x,p.y,B,M,F);for(F=B.length;F--;){B[F].cancelOnInteract=
true;B[F].requestUpdates(function(){u();f.onAnimate&&f.onAnimate(v.x,v.y)})}}else E.setOffset(p,w)},zoom:function(p,w,B){U=false;A=w;t=A!==1;V=T5.D.getCenter(E.getDimensions());G=A>1?T5.V.copy(p):T5.D.getCenter(E.getDimensions());z=null;clearTimeout(W);if(t){T=T5.ViewState.PINCHZOOM;u();if(B)W=setTimeout(function(){k();A=1},parseInt(B,10))}}};GRUNT.WaterCooler.listen("layer.remove",function(p){p.id&&E.removeLayer(p.id)});I=T5.Device.getConfig().getScaling();GRUNT.observable(E);E.bind("wake",u);E.bind("invalidate",
function(){Y=true});if(f.pannable){E.bind("pan",d);E.bind("panEnd",a);E.bind("inertiaPan",b);E.bind("inertiaCancel",function(){U=false;u()})}if(f.scalable){E.bind("pinchZoom",e);E.bind("pinchZoomEnd",h);E.bind("wheelZoom",g)}GRUNT.configurable(E,["inertia","container"],GRUNT.paramTweaker(f,null,{container:function(p,w){l=document.getElementById(w);n()}}),true);n();return E};
T5.AnimatedPathLayer=function(f){function d(g,k,n){g.fillStyle="#FFFFFF";g.strokeStyle="#222222";g.beginPath();g.arc(n.x,n.y,4,0,Math.PI*2,false);g.stroke();g.fill()}f=T5.ex({path:[],id:GRUNT.generateObjectID("pathAnimation"),easing:T5.Easing.Sine.InOut,validStates:T5.ViewState.get("ACTIVE","PAN","PINCHZOOM"),drawIndicator:null,duration:2E3,autoCenter:false},f);var b=T5.V.edges(f.path),a,c=null,e=0;T5.Animation.tweenValue(0,b.total,f.easing,function(){h.remove()},f.duration).requestUpdates(function(g,
k){e=g;k&&h.remove()});var h=T5.ex(new T5.ViewLayer(f),{cycle:function(){for(var g=0;g<b.accrued.length&&b.accrued[g]<e;)g++;c=null;if(g<f.path.length-1){var k=e-(g>0?b.accrued[g-1]:0),n=f.path[g],j=f.path[g+1];a=T5.V.theta(n,j,b.edges[g]);c=T5.V.pointOnEdge(n,j,a,k);if(f.autoCenter)(g=h.getParent())&&g.centerOn(c)}return c?1:0},draw:function(g,k){if(c)(f.drawIndicator?f.drawIndicator:d)(g,k,new T5.Vector(c.x-k.x,c.y-k.y),a)}});return h};
T5.Tiling=function(){TileStore=function(a){a=T5.ex({tileSize:null,gridSize:null,center:new T5.Vector,onPopulate:null},a);if(!a.tileSize)throw Error("Cannot create TileStore with an empty tile size");if(!a.gridSize)throw Error("0 grid size for TileStore");var c=Array(Math.pow(a.gridSize,2)),e=T5.V.offset(a.center,-Math.ceil(a.gridSize>>1)),h=null,g=new T5.Vector,k=null,n={find:function(j){if(!j)return null;for(var q=c.length;q--;){var m=c[q];if(m&&j(m))return m}return null},getGridSize:function(){return a.gridSize},
getNormalizedPos:function(j,q){return T5.V.add(new T5.Vector(j,q),T5.V.invert(e),g)},getTileShift:function(){return T5.V.copy(g)},getTile:function(j,q){return j>=0&&j<a.gridSize?c[q*a.gridSize+j]:null},setTile:function(j,q,m){c[q*a.gridSize+j]=m},populate:function(j,q){var m=GRUNT.Log.getTraceTicks(),i=0,r=a.gridSize,s=a.tileSize;new T5.Vector(r/2,r/2);if(j)for(var u=0;u<r;u++)for(var o=0;o<r;o++){if(!c[i]){var l=j(o,u,e,r);l.gridX=o*s-g.x;l.gridY=u*s-g.y;c[i]=l}i++}h=j;k=q;GRUNT.Log.trace("tile grid populated",
m);a.onPopulate&&a.onPopulate()},getShiftDelta:function(j,q,m,i){var r=Math.floor(a.gridSize*0.2),s=new T5.Vector;if(j<0||j+m>a.gridSize)s.x=j<0?-r:r;if(q<0||q+i>a.gridSize)s.y=q<0?-r:r;return s},shift:function(j,q){if(!(j.x===0&&j.y===0)){var m=GRUNT.Log.getTraceTicks(),i=Array(c.length);i.length=c.length;for(var r=0;r<a.gridSize;r++)for(var s=0;s<a.gridSize;s++)i[s*a.gridSize+r]=n.getTile(r+j.x,s+j.y);c=i;e=q?q(e,j):T5.V.add(e,j);g.x+=-j.x*a.tileSize;g.y+=-j.y*a.tileSize;GRUNT.Log.trace("tile storage shifted",
m);n.populate(h,k)}},setOrigin:function(j,q){if(tileOrigin)shiftOrigin(j,q);else e=T5.V.offset(new T5.Vector(j,q),-tileHalfWidth)}};GRUNT.WaterCooler.listen("imagecache.cleared",function(){for(var j=c.length;j--;)if(c[j])c[j].loaded=false});GRUNT.WaterCooler.listen("tiler.repaint",function(){for(var j=c.length;j--;)if(c[j]){c[j].x=null;c[j].y=null}});return n};var f=null,d=null,b={Config:{TILESIZE:256,TILEBUFFER:1,TILEBUFFER_LOADNEW:0.2},getEmptyTile:function(a){if(!f||a!==f.width){f=T5.newCanvas(a,
a);a=f.getContext("2d");a.fillStyle="rgba(150, 150, 150, 0.01)";a.fillRect(0,0,f.width,f.height)}return f},getPanningTile:function(a){function c(){var e=T5.newCanvas(32,32),h=e.getContext("2d");h.fillStyle="#BBBBBB";h.fillRect(0,0,32,32);h.fillStyle="#C3C3C3";h.fillRect(0,0,16,16);h.fillRect(16,16,16,16);return e}if(!d||a!==d.width){d=T5.newCanvas(a,a);a=d.getContext("2d");a.fillStyle=a.createPattern(c(),"repeat");a.fillRect(0,0,d.width,d.height)}return d},Tile:function(a){return a=T5.ex({x:0,y:0,
gridX:0,gridY:0,dirty:false},a)},ImageTile:function(a){a=T5.ex({url:"",sessionParamRegex:null,loaded:false},a);return new b.Tile(a)},TileGrid:function(a){function c(l,x){if(u){var v,y=[],H=new T5.Vector(Math.floor((l.x+m.x)*g),Math.floor((l.y+m.y)*g));tilesNeeded=false;for(var N=s;N--;)for(var I=r;I--;){v=e.getTile(I+H.x,N+H.y);var C=new T5.Vector(I-u.x,N-u.y);v||(q=e.getShiftDelta(H.x,H.y,r,s));y.push({tile:v,centerness:T5.V.absSize(C)})}y.sort(function(R,K){return K.centerness-R.centerness});n||
(n=Array(y.length));for(v=y.length;v--;){n[v]=y[v].tile;o.prepTile(n[v],x)}}}a=T5.ex({tileSize:T5.Tiling.Config.TILESIZE,drawGrid:false,center:new T5.Vector,gridSize:25,shiftOrigin:null,supportFastDraw:true},a);var e=new TileStore(T5.ex({tileSize:a.tileSize,gridSize:a.gridSize,onPopulate:function(){o.dirty=true;o.wakeParent()}},a)),h=Math.round(a.tileSize/2),g=a.tileSize?1/a.tileSize:0,k=true,n=null,j=false;new T5.Vector;var q=new T5.Vector,m=new T5.Vector;T5.Device.getConfig();var i=e.getGridSize()*
a.tileSize,r,s,u,o=T5.ex(new T5.ViewLayer(a),{gridDimensions:new T5.Dimensions(i,i),dirty:false,cycle:function(l,x,v){l=0;if(q.x+q.y!==0){e.shift(q,a.shiftOrigin);m=e.getTileShift();q=new T5.Vector;l++}v!==T5.ViewState.PINCHZOOM&&c(x,v);return l+o.dirty?1:0},deactivate:function(){k=false},find:function(){return e.find.apply(null,arguments)},prepTile:function(){},drawTile:function(){return false},getTileSize:function(){return a.tileSize},draw:function(l,x,v,y,H){if(k){var N=T5.time(),I=x.x;x=x.y;var C=
true,R=H.needRepaint()||y===T5.ViewState.PANNING||y===T5.ViewState.PINCHZOOM||T5.Animation.isTweening();if(!u){r=Math.ceil(v.width*g)+1;s=Math.ceil(v.height*g)+1;u=new T5.Vector(Math.floor((r-1)/2),Math.floor((s-1)/2))}if(n){if(a.drawGrid)l.strokeStyle="rgba(50, 50, 50, 0.3)";l.beginPath();for(v=n.length;v--;){var K=n[v];if(K){var Q=K.gridX-I,G=K.gridY-x;if(!(R?false:!K.dirty)){C=o.drawTile(l,K,Q,G,y)&&C;K.x=Q;K.y=G}}else C=false;a.drawGrid&&l.rect(Q,G,a.tileSize,a.tileSize)}l.stroke();GRUNT.Log.trace("drawn tiles",
N);C&&!j&&H.trigger("tileDrawComplete");j=C;o.dirty=false}}},getTileAtXY:function(l,x){for(var v=a.tileSize,y=n?n.length:0;y--;){var H=n[y];if(H&&l>=H.x&&x>=H.y)if(l<=H.x+v&&x<=H.y+v)return H}return null},getTileVirtualXY:function(l,x,v){l=e.getNormalizedPos(l,x);l=new T5.Vector(l.x*a.tileSize,l.y*a.tileSize);if(v){l.x+=h;l.y+=h}return l},populate:function(l){e.populate(l,function(){})}});return o},ImageTileGrid:function(a){function c(){m.getParent().trigger("invalidate");m.dirty=true;m.wakeParent()}
a=T5.ex({emptyTile:b.getEmptyTile(b.Config.TILESIZE),panningTile:b.getPanningTile(b.Config.TILESIZE),tileOffset:new T5.Vector,tileDrawArgs:{}},a);var e=a.emptyTile,h=a.panningTile,g=T5.ViewState.ACTIVE,k=T5.ViewState.PAN,n=T5.Device.getConfig().requireFastDraw,j=a.tileSize?a.tileSize:b.Config.TILESIZE,q=T5.ex({background:null,overlay:null,offset:new T5.Vector,realSize:new T5.Dimensions(j,j)},a.tileDrawArgs),m=T5.ex(new b.TileGrid(a),{drawTile:function(i,r,s,u,o){var l=T5.Resources.getImage(r.url),
x=false;if(l){i.drawImage(l,s,u);r.dirty=false;x=true}else if(o===k)h&&i.drawImage(h,s,u);else e&&i.drawImage(e,s,u);return x},prepTile:function(i,r){if(i)i.dirty=true;if(i&&(!n||r===g))T5.Resources.getImage(i.url)||T5.Resources.loadImage(i.url,c,q)}});return m}};return b}();
T5.Tiler=function(f){f=T5.ex({container:"",drawCenter:false,datasources:{},tileLoadThreshold:"first"},f);var d=T5.ex(new T5.View(f),{getTileLayer:function(){return d.getLayer("grid0")},setTileLayer:function(b){d.setLayer("grid0",b);GRUNT.WaterCooler.say("grid.updated",{id:"grid0"})},viewPixToGridPix:function(b){var a=d.getOffset();return new T5.Vector(b.x+a.x,b.y+a.y)},centerOn:function(b,a,c){var e=d.getTileLayer(),h=d.getDimensions();(e=e?e.getTileSize():0)&&d.updateOffset(b.gridX-Math.floor((h.width-
e)*0.5),b.gridY-Math.floor((h.height-e)*0.5),a,c)},cleanup:function(){d.removeLayer("grid0")},repaint:function(){GRUNT.WaterCooler.say("tiler.repaint");d.trigger("wake")}});d.bind("tap",function(b,a){var c=d.getTileLayer();if(c)(c=c.getTileAtXY(a.x,a.y))&&d.trigger("tapTile",c)});return d};
