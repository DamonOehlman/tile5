COG=function(){var f=/\$\{(.*?)\}/ig,m=Object.prototype.hasOwnProperty,h=0,e={id:"grunt.core",extend:function(){var a=arguments[0]||{},c=1,d=arguments.length,b=false,k,g,j,i;if(typeof a==="boolean"){b=a;a=arguments[1]||{};c=2}if(typeof a!=="object"&&!e.isFunction(a))a={};if(d===c){a=this;--c}for(;c<d;c++)if((k=arguments[c])!=null)for(g in k){j=a[g];i=k[g];if(a!==i)if(b&&i&&(e.isPlainObject(i)||e.isArray(i))){j=j&&(e.isPlainObject(j)||e.isArray(j))?j:e.isArray(i)?[]:{};a[g]=e.extend(b,j,i)}else if(i!==
undefined)a[g]=i}return a},isFunction:function(a){return toString.call(a)==="[object Function]"},isArray:function(a){return toString.call(a)==="[object Array]"},isPlainObject:function(a){if(!a||toString.call(a)!=="[object Object]"||a.nodeType||a.setInterval)return false;if(a.constructor&&!m.call(a,"constructor")&&!m.call(a.constructor.prototype,"isPrototypeOf"))return false;var c;for(c in a);return c===undefined||m.call(a,c)},isEmptyObject:function(a){for(var c in a)return false;return true},isXmlDocument:function(a){return toString.call(a)===
"[object Document]"},contains:function(a,c){var d=a,b=arguments,k=1;if(c&&e.isArray(c)){b=c;k=0}for(k=k;k<b;k++)d=d&&typeof foo[b[k]]!=="undefined";return d},newModule:function(a){a=e.extend({id:null,requires:[],parent:null},a);if(a.parent)a=e.extend({},a.parent,a);return a},toID:function(a){return a.replace(/\s/g,"-")},objId:function(a){return(a?a:"obj")+h++},formatStr:function(a){if(arguments.length<=1)return a;for(var c=arguments.length-2,d=0;d<=c;d++)a=a.replace(RegExp("\\{"+d+"\\}","gi"),arguments[d+
1]);return a},wordExists:function(a,c){var d="";if(c.toString)c=c.toString();for(var b=0;b<c.length;b++)d+=!/\w/.test(c[b])?"\\"+c[b]:c[b];return RegExp("(^|\\s|\\,)"+d+"(\\,|\\s|$)","i").test(a)},parseTemplate:function(a,c){for(var d=f.exec(a);d;){a=a.replace(d[0],COG.XPath.first(d[1],c));f.lastIndex=0;d=f.exec(a)}return a}};return e}();
COG.Log=function(){function f(c,d){var b,k=d&&d.length>0?d[0]:"";for(b=1;d&&b<d.length;b++)k+=" "+(h&&COG.isPlainObject(d[b])?JSON.stringify(d[b]):d[b]);typeof console!=="undefined"&&console[c](k);for(b=0;b<m.length;b++)m[b].call(a,k,c)}var m=[],h=typeof JSON!=="undefined",e=window.console&&window.console.markTimeline,a={id:"grunt.log",getTraceTicks:function(){return e?(new Date).getTime():null},trace:function(c,d){if(e)console.markTimeline(c+(d?": "+(a.getTraceTicks()-d)+"ms":""))},debug:function(){f("debug",
arguments)},info:function(){f("info",arguments)},warn:function(){f("warn",arguments)},error:function(){f("error",arguments)},exception:function(c){a.error(arguments);for(var d in c)a.info("ERROR DETAIL: "+d+": "+c[d])},watch:function(c,d){try{d()}catch(b){a.exception(b,c)}},throwError:function(c){a.error(c);throw Error(c);},requestUpdates:function(c){m.push(c)}};return a}();
(function(){function f(e,a){e[a]||(e[a]=function(c){return e.configure(a,c)})}function m(e){e.gtConfId=COG.objId("configurable");e.gtConfig={};e.gtConfigFns=[];return e.gtConfig}var h={};COG.paramTweaker=function(e,a,c){return function(d,b){if(typeof b!=="undefined"){if(d in e)e[d]=b;c&&d in c&&c[d](d,b)}else return a&&d in a?a[d](d):e[d]}};COG.configurable=function(e,a,c,d){if(e){e.gtConfId||m(e);var b=e.gtConfId,k=e.gtConfig,g=e.gtConfigFns;h[b]=e;g.push(c);for(c=a.length;c--;){k[a[c]]=true;d&&
f(e,a[c])}if(!e.configure)e.configure=function(j,i){if(k[j]){for(var l=g.length;l--;){var p=g[l](j,i);if(typeof p!=="undefined")return p}return h[b]}return null}}}})();
(function(){function f(m,h){var e=m.gtObsHandlers;e[h]||(e[h]=[]);return e[h]}COG.observable=function(m){if(m){if(!m.gtObsHandlers)m.gtObsHandlers={};if(!(m.bind||m.trigger||m.unbind)){m.bind=function(h,e){var a=COG.objId("callback");f(m,h).unshift({fn:e,id:a});return a};m.trigger=function(h){var e=f(m,h),a={cancel:false,tickCount:(new Date).getTime()},c;if(!e)return null;c=Array.prototype.slice.call(arguments,1);c.unshift(a);for(var d=e.length;d--&&!a.cancel;)e[d].fn.apply(self,c);return a};m.unbind=
function(h,e){for(var a=f(m,h),c=0;a&&c<a.length;c++)if(a[c].id===e){a.splice(c,1);break}return m}}}}})();(function(){var f={},m=[];COG.addPipe=function(h){h("pipe.test",{});m.push(h)};COG.listen=function(h,e){f[h]||(f[h]=[]);e&&f[h].push(e)};COG.say=function(h,e){var a;for(a=m.length;a--;)m[a](h,e);if(f[h])for(a=f[h].length;a--;)f[h][a](e)}})();
COG.Loopage=function(){function f(i){return COG.extend({id:c++,frequency:0,after:0,single:false,lastTick:0,execute:function(){}},i)}function m(i){b.push(i);h()}function h(){k&&clearTimeout(k);k=setTimeout(e,0);j=true}function e(){for(var i,l=(new Date).getTime(),p=d.length;b.length>0;){var x=b.shift();for(i=p;i--;)if(d[i].id===x){d.splice(i,1);break}j=true;p=d.length}if(j){g=a;for(i=p;i--;)g=d[i].frequency<g?d[i].frequency:g}for(i=p;i--;){x=l-d[i].lastTick;if(d[i].lastTick===0||x>=d[i].frequency){d[i].execute(l,
d[i]);d[i].lastTick=l;d[i].single&&d[i].trigger("complete")}}k=p?setTimeout(e,g):0}var a=6E4,c=0,d=[],b=[],k=0,g=a,j=true;return{join:function(i){var l=new f(i);if(l.after>0)l.lastTick=(new Date).getTime()+l.after;COG.observable(l);l.bind("complete",function(){m(l.id)});d.unshift(l);h();return l},leave:m}}();if(!this.JSON)this.JSON={};
(function(){function f(g){return g<10?"0"+g:g}function m(g){a.lastIndex=0;return a.test(g)?'"'+g.replace(a,function(j){var i=b[j];return typeof i==="string"?i:"\\u"+("0000"+j.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+g+'"'}function h(g,j){var i,l,p,x,z=c,n,o=j[g];if(o&&typeof o==="object"&&typeof o.toJSON==="function")o=o.toJSON(g);if(typeof k==="function")o=k.call(j,g,o);switch(typeof o){case "string":return m(o);case "number":return isFinite(o)?String(o):"null";case "boolean":case "null":return String(o);
case "object":if(!o)return"null";c+=d;n=[];if(Object.prototype.toString.apply(o)==="[object Array]"){x=o.length;for(i=0;i<x;i+=1)n[i]=h(i,o)||"null";p=n.length===0?"[]":c?"[\n"+c+n.join(",\n"+c)+"\n"+z+"]":"["+n.join(",")+"]";c=z;return p}if(k&&typeof k==="object"){x=k.length;for(i=0;i<x;i+=1){l=k[i];if(typeof l==="string")if(p=h(l,o))n.push(m(l)+(c?": ":":")+p)}}else for(l in o)if(Object.hasOwnProperty.call(o,l))if(p=h(l,o))n.push(m(l)+(c?": ":":")+p);p=n.length===0?"{}":c?"{\n"+c+n.join(",\n"+c)+
"\n"+z+"}":"{"+n.join(",")+"}";c=z;return p}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
a=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,c,d,b={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},k;if(typeof JSON.stringify!=="function")JSON.stringify=function(g,j,i){var l;d=c="";if(typeof i==="number")for(l=0;l<i;l+=1)d+=" ";else if(typeof i==="string")d=i;if((k=j)&&typeof j!=="function"&&(typeof j!=="object"||typeof j.length!=="number"))throw Error("JSON.stringify");return h("",
{"":g})};if(typeof JSON.parse!=="function")JSON.parse=function(g,j){function i(p,x){var z,n,o=p[x];if(o&&typeof o==="object")for(z in o)if(Object.hasOwnProperty.call(o,z)){n=i(o,z);if(n!==undefined)o[z]=n;else delete o[z]}return j.call(p,x,o)}var l;g=String(g);e.lastIndex=0;if(e.test(g))g=g.replace(e,function(p){return"\\u"+("0000"+p.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(g.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){l=eval("("+g+")");return typeof j==="function"?i({"":l},""):l}throw new SyntaxError("JSON.parse");}})();
(function(){function f(h,e){var a=h.split("|"),c={};for(var d in e){var b=e[d];c[d]=a.length>b?a[b]:null}return c}var m={JSON:{parse:function(h){return JSON.parse(h)}},PDON:{parse:function(h){var e=null,a=[];h=h.split("\n");for(var c=0;c<h.length;c++){var d=h[c];if(e)a.push(f(d,e));else if(d){e=d.split("|");d={};for(var b=0;b<e.length;b++)d[e[b]]=b;e=d}else e=null}return a}}};COG.parseData=function(h,e){e=e?e.toUpperCase():"JSON";if(!m[e])throw Error("Unsupported data format: "+e);try{return m[e].parse(h)}catch(a){COG.Log.exception(a)}return{}}})();
COG.XPath=function(){function f(a){for(var c=null,d=0;d<m.length;d++)if(c=m[d](a))break;return c}var m=[],h=[null,function(a){return a.numberValue},function(a){return a.stringValue},function(a){return a.booleanValue},null,null,null,null,function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null},function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||COG.Log.warn("No XPATH support");var e={SearchResult:function(a){return{toString:function(){var c=
null;if(a){var d=null;if(a.resultType>=0&&a.resultType<h.length)d=h[a.resultType];if(d)c=d(a)}return c?c:""}}},first:function(a,c){var d=e.SearchResult,b;var k=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!k)k=XPathResult.ANY_TYPE;try{if(COG.isXmlDocument(c))b=c.evaluate(a,c,f,k,null);else{COG.Log.warn("attempted xpath expression: "+a+" on a non-xml document");b=null}}catch(g){COG.Log.warn("invalid xpath expression: "+a+" on node: "+c);b=null}return new d(b)},registerResolver:function(a){m.push(a)}};return e}();
COG.Storage=function(){function f(m){if(m&&m=="session")return sessionStorage;return localStorage}return{get:function(m,h){var e=f(h).getItem(m);return/^(\{|\[).*(\}|\])$/.test(e)?JSON.parse(e):e},set:function(m,h,e){h=jQuery.isArray(h)||jQuery.isPlainObject(h)?JSON.stringify(h):h;f(e).setItem(m,h)},remove:function(m,h){f(h).removeItem(m)}}}();
COG.ParseRules=function(){var f=[];return{add:function(m,h){f.push({regex:m,handler:h})},each:function(m,h,e){function a(){c++;e&&c>=f.length&&e(h)}for(var c=0,d=0;d<f.length;d++){var b=f[d].regex,k=f[d].handler,g=false;if(b){b.lastIndex=-1;if((b=b.exec(m))&&k){g=true;k(b,h,a)&&a()}}g||a()}}}};
(function(){function f(b){var k=[],g=function(i,l){l=COG.isFunction(l)?l():l;k[k.length]=encodeURIComponent(i)+"="+encodeURIComponent(l)};if(COG.isArray(b))for(var j=0;j<b.length;j++)g(b[j].name,b[j].value);else for(j in b)g(j,b[j]);return k.join("&").replace(/%20/g,"+")}var m={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},h={JSON:["json"],PDON:["pdon.txt"]},e=["TEXT","STREAM"],a=/^(\w+:)?\/\/([^\/?#]+)/,c={XML:function(b){return b.responseXML},JSON:function(b){return COG.parseData(b.responseText)},
PDON:function(b){return COG.parseData(b.responseText,"PDON")},DEFAULT:function(b){return b.responseText}},d={CONTENT_TYPE:"Content-Type"};COG.xhr=function(b){function k(){if(this.readyState===4){var l=null,p=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(p)if(b.handleResponse)b.handleResponse(this);else{var x=b,z=this.getResponseHeader(d.CONTENT_TYPE),n,o=false;for(n in m)if(z&&z.indexOf(m[n])>=0){o=true;
break}z=!o;for(o=0;o<e.length;o++)z=z||e[o]==n;if(z)b:{z=n;for(var t in h)for(o=0;o<h[t].length;o++)if(RegExp(h[t][o]+"$","i").test(x.url)){n=t;break b}n=z?z:"DEFAULT"}try{l=c[n](this,x)}catch(u){l=c.DEFAULT(this,x)}}else b.error&&b.error(this)}catch(Q){COG.Log.exception(Q,"PROCESSING AJAX RESPONSE")}p&&l&&b.success&&b.success.call(this,l)}}try{b=COG.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},b);var g=
a.exec(b.url),j=g&&(g[1]&&g[1]!==location.protocol||g[2]!==location.host);if(b.data)b.method="POST";if(b.url){g=null;if(b.xhr)g=b.xhr(b);g||(g=new XMLHttpRequest);g.open(b.method,b.url,b.async);b.data&&g.setRequestHeader("Content-Type",b.contentType);j||g.setRequestHeader("X-Requested-With","XMLHttpRequest");g.onreadystatechange=k;g.send(b.method=="POST"?f(b.data):null)}else COG.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(i){COG.Log.exception(i)}}})();
(function(){function f(a){var c=document.createElement("script"),d=false;c.src=a;c.async=true;c.onload=c.onreadystatechange=function(){if(!d&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){d=true;c.onload=c.onreadystatechange=null;c&&c.parentNode&&c.parentNode.removeChild(c)}};h||(h=document.getElementsByTagName("head")[0]);h.appendChild(c)}var m=0,h,e=this;COG.jsonp=function(a,c,d){a+=a.indexOf("?")>=0?"&":"?";var b="json"+ ++m;e[b]=function(k){c(k);e[b]=null;try{delete e[b]}catch(g){}};
f(a+(d?d:"callback")+"="+b);return b}})();
COG.Touch=function(){function f(w,C){return{x:w.x-C.x,y:w.y-C.y}}function m(w,C){var G=f(w,C);return Math.sqrt(G.x*G.x+G.y*G.y)}function h(w){if(w.count>1)return m(w.touches[0],w.touches[1]);return 0}function e(w,C){var G=w&&w.count>0?w.touches[0]:null;if(G&&C&&C.count>0)return f(G,C.touches[0]);return null}function a(w,C){w.count=C.count;for(var G=g;G--;){w.touches[G].x=C.touches[G].x;w.touches[G].y=C.touches[G].y}}function c(){for(var w={count:0,touches:Array(g)},C=g;C--;)w.touches[C]=k();return w}
function d(w){if(w.preventDefault){w.preventDefault();w.stopPropagation()}else w.cancelBubble&&w.cancelBubble()}function b(w,C,G){if(D){C=C[G?G:"touches"];G=C.length;for(G=w.count=G;G--;){w.touches[G].x=C[G].pageX;w.touches[G].y=C[G].pageY}}else if(C.button===0){w.count=1;w.touches[0].x=C.pageX?C.pageX:C.screenX;w.touches[0].y=C.pageY?C.pageY:C.screenY}else w.count=0}function k(w,C){return{x:w?w:0,y:C?C:0}}var g=10,j=120,i=100,l=250,p=300,x=5,z=0,n=1,o=2,t=7,u=0,Q=0,D=undefined,ga=function(w){function C(v,
B,y,q){var r=Math.asin((v.y-B.y)/y);y=y*(qa/q)>>0;y=y>ma?ma:y;r=B.x>v.x?r:Math.PI-r;R("pan",Math.cos(r)*-y,Math.sin(r)*y,true)}function G(v,B){var y,q;if(D){y=B-ia;if(y<l){q=m(I.touches[0],v);q>w.inertiaTrigger&&C(I.touches[0],v,q,y)}}else{Y.x=v.x;Y.y=v.y;COG.Loopage.join({execute:function(r,E){y=r-B;q=m(v,Y);if(y<i&&q>w.inertiaTrigger){E.trigger("complete");C(v,Y,q,y)}else y>i&&E.trigger("complete")},frequency:10})}}function ea(v){var B=0,y=0;if(v.offsetParent){do{B+=v.offsetLeft;y+=v.offsetTop;
v=v.offsetParent}while(v)}return k(B,y)}function ba(v){var B=v.count,y=Array(B),q=ea(Z);for(B=B;B--;)y[B]=k(v.touches[B].x-q.x,v.touches[B].y-q.y);return y}function R(){oa&&oa.trigger.apply(null,arguments)}function s(v,B){var y=ea(Z);y=k(B.x-y.x,B.y-y.y);R(v,B,y)}function L(v){var B=v.target?v.target:v.srcElement;if(V||B&&B===Z){b(I,v);if(I.count!==0){aa=null;W.x=0;W.y=0;ja=true;M=false;ia=(new Date).getTime();d(v);B.style.cursor="move";R("inertiaCancel");ka=ia;if(v=I.count>0?I.touches[0]:null){R("touchStart",
v.x,v.y);if(ka-na<p)if((v=f(I.touches[0],P.touches[0]))&&Math.abs(v.x)<w.maxDistDoubleTap&&Math.abs(v.y)<w.maxDistDoubleTap)M=true;H=z;a(P,I)}else COG.Log.warn("Touch start fired, but no touch vector found")}}}function A(v){var B=v.target?v.target:v.srcElement,y=0;if(V||B&&B===Z){b(S,v);if(S.count>0){Y.x=S.touches[0].x;Y.y=S.touches[0].y}if(ja){D&&d(v);if(S.count>1){I.count===1&&a(I,S);y=h(I)-h(S)}if(H===z)if((v=e(S,I))&&(Math.abs(v.x)>=t||Math.abs(v.y)>=t))H=n;if(H!==z)if(!y||Math.abs(y)<x){if(aa=
e(S,P)){W.x-=aa.x;W.y-=aa.y;X.x-=aa.x;X.y-=aa.y}R("pan",X.x,X.y);X.x=0;X.y=0;H=n}else{R("pinchZoom",ba(I),ba(S));H=o}a(P,S)}}}function J(v){var B=v.target?v.target:v.srcElement;if(ja&&(V||B&&B===Z)){b($,v,"changedTouches");var y=$.touches[0];D&&d(v);v=(new Date).getTime();na=ka;if(H===z){s("tap",I.touches[0]);T||(T=setTimeout(function(){T=0;M&&s("doubleTap",I.touches[0])},p+50))}else if(H==n){R("panEnd",W.x,W.y);pa&&G(y,v)}else H==o&&R("pinchZoomEnd",ba(I),ba(P),v-ia);B.style.cursor="default";ja=
false}}function F(v){var B=v.target?v.target:v.srcElement;if(V||B&&B===Z){if(v.detail){B=-v.detail*j;B=k(v.axis===1?B:0,v.axis===2?B:0)}else B=k(v.wheelDeltaX,v.wheelDeltaY);var y=B.y!==0?Math.abs(B.y/j):0;if(Y&&y!==0){var q=k(Y.x-Z.offsetLeft,Y.y-Z.offsetTop);R("wheelZoom",q,Math.pow(2,B.y>0?y:-y))}d(v)}}w=COG.extend({element:null,observable:null,inertiaTrigger:20,maxDistDoubleTap:20,touchStartHandler:null,moveHandler:null,moveEndHandler:null,pinchZoomHandler:null,pinchZoomEndHandler:null,tapHandler:null,
doubleTapHandler:null,wheelZoomHandler:null},w);var M=false,T=0,N=T5.getConfig(),I=c(),S=c(),P=c(),$=c(),aa=null,W=k(),X=k(),H=null,ja=false,ia=0,fa=[],Y=k(),pa=false,qa,ma,ka=0,na=0,Z=w.element,oa=w.observable,V=typeof FlashCanvas!=="undefined",ra={supportsTouch:D,addListeners:function(v){fa.push(v)},decoupleListeners:function(v){for(var B=0;v&&B<fa.length;B++)if(fa[B].listenerId===v){fa.splice(B,1);break}},release:function(){N.unbindEvent(D?"touchstart":"mousedown",L,false);N.unbindEvent(D?"touchmove":
"mousemove",A,false);N.unbindEvent(D?"touchend":"mouseup",J,false);if(!D){window.removeEventListener("mousewheel",F,false);window.removeEventListener("DOMMouseScroll",F,false)}},inertiaEnable:function(v,B){pa=true;qa=v;ma=B?Math.min(B.width,B.height):500},inertiaDisable:function(){pa=false}};if(typeof D==="undefined")D=T5.getConfig().supportsTouch;N.bindEvent(D?"touchstart":"mousedown",L,false);N.bindEvent(D?"touchmove":"mousemove",A,false);N.bindEvent(D?"touchend":"mouseup",J,false);if(!D){N.bindEvent("mousewheel",
F,window);N.bindEvent("DOMMouseScroll",F,window)}return ra},U=[];return{capture:function(w,C){if(!w)throw Error("Unable to capture touch of null element");if(!w.id)w.id="touchable_"+u++;var G=U[w.id];if(!G){G=new ga(COG.extend({element:w},C));U[w.id]=G}if(C){C.listenerId&&G.decoupleListeners(C.listenerId);C.listenerId=++Q;G.addListeners(C)}return G},release:function(w){if(w&&w.id&&U[w.id]){U[w.id].release();delete U[w.id]}}}}();
T5=function(){var f=function(d,b){return{x:d?d:0,y:b?b:0}},m=function(){function d(b,k){if(!k)k=b.length;if(k<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var g={edges:Array(k-1),accrued:Array(k-1),total:0},j=m.diff,i=0;i<k-1;i++){var l=j(b[i],b[i+1]);g.edges[i]=Math.sqrt(l.x*l.x+l.y*l.y);g.accrued[i]=g.total+g.edges[i];g.total+=g.edges[i]}return g}return{VECTOR_SIMPLIFICATION:4,create:function(b,k){return new f(b,k)},add:function(){for(var b=new f,k=
arguments.length;k--;){b.x+=arguments[k].x;b.y+=arguments[k].y}return b},absSize:function(b){return Math.max(Math.abs(b.x),Math.abs(b.y))},diff:function(b,k){return new f(b.x-k.x,b.y-k.y)},copy:function(b){return b?new f(b.x,b.y):null},invert:function(b){return new f(-b.x,-b.y)},offset:function(b,k,g){return new f(b.x+k,b.y+(g?g:k))},edges:d,distance:function(b,k){return d(b,k).total},simplify:function(b,k){if(!b)return null;k=k?k:m.VECTOR_SIMPLIFICATION;for(var g=[],j=null,i=b.length;i--;){var l=
b[i];if(include=!j||i===0||Math.abs(l.x-j.x)+Math.abs(l.y-j.y)>k){g.unshift(l);j=l}}return g},theta:function(b,k,g){g=Math.asin((b.y-k.y)/g);return b.x>k.x?g:Math.PI-g},pointOnEdge:function(b,k,g,j){k=new f(Math.cos(g)*j,Math.sin(g)*j);return new f(b.x-k.x,b.y-k.y)},getRect:function(b){var k=b.length;if(k>1)return new h(Math.min(b[0].x,b[k-1].x),Math.min(b[0].y,b[k-1].y),Math.abs(b[0].x-b[k-1].x),Math.abs(b[0].y-b[k-1].y))},toString:function(b){return b.x+", "+b.y}}}(),h=function(d,b,k,g){return{origin:new f(d,
b),dimensions:new a(k,g),invalid:false}},e=function(){return{bottomRight:function(d){return m.offset(d.origin,d.dimensions.width,d.dimensions.height)},empty:function(){return new h(0,0,0,0)},copy:function(d){return d?new h(d.origin.x,d.origin.y,d.dimensions.width,d.dimensions.height):null},getCenter:function(d){return new f(d.origin.x+d.dimensions.width/2,d.origin.y+d.dimensions.height/2)},isEmpty:function(d){return d.dimensions.width===0||d.dimensions.height===0},union:function(){if(!(arguments.length<
2)){for(var d=arguments[0].origin.y,b=arguments[0].origin.x,k=d+arguments[0].dimensions.height,g=b+arguments[0].dimensions.width,j=Array.prototype.slice.call(arguments,1),i=j.length;i--;){var l=j[i].origin.y,p=j[i].origin.x,x=l+j[i].dimensions.height,z=p+j[i].dimensions.width;d=d<l?d:l;b=b<p?b:p;k=k>x?k:x;g=g>z?g:z}arguments[0].origin.x=b;arguments[0].origin.y=d;arguments[0].dimensions.width=g-b;arguments[0].dimensions.height=k-d}}}}(),a=function(d,b){return{width:d?d:0,height:b?b:0}},c=function(){return{getAspectRatio:function(d){return d.height!==
0?d.width/d.height:1},getCenter:function(d){return new f(d.width/2,d.height/2)},getSize:function(d){return Math.sqrt(Math.pow(d.width,2)+Math.pow(d.height,2))}}}();return{ex:COG.extend,ticks:function(){return(new Date).getTime()},Vector:f,V:m,Dimensions:a,D:c,Rect:h,R:e}}();
(function(){function f(){for(;x.length>0;){var n=x.shift();document.location=n}p=0}function m(n){for(var o=true,t=z.length;t--;)o=o&&n!=z[t];return o}function h(n,o){var t=[];for(var u in o)u&&t.push(u+"="+escape(o[u]));return"tile5://"+n+"/"+(t.length>0?"?"+t.join("&"):"")}function e(n,o){m(n)&&COG.Log.info("would push url: "+h(n,o))}function a(n,o){if(m(n)){x.push(h(n,o));p||(p=setTimeout(f,100))}}function c(n){return function(o,t,u){(u?u:n?document.body:document).addEventListener(o,t,false)}}function d(n){return function(o,
t,u){(u?u:n?document.body:document).removeEventListener(o,t,false)}}function b(n,o,t){(t?t:document).attachEvent("on"+n,o)}function k(n,o,t){(t?t:document).detachEvent("on"+n,o)}function g(){j={base:{name:"Unknown",bindEvent:c(),unbindEvent:d(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:e,targetFps:null},ie:{name:"MSIE",regex:/msie/i,bindEvent:b,unbindEvent:k,requireFastDraw:false,targetFps:25},
ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:a,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:a},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:a},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:c(true),unbindEvent:d(true),supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},bridgeNotify:a},froyo:{name:"Android OS >= 2.2",
regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:a}};i=[j.froyo,j.android,j.ipod,j.iphone,j.ipad,j.ie]}var j=null,i=[],l=null,p=0,x=[],z=["view.wake","tile.loaded"];T5.getConfig=function(){j||g();if(!l){COG.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var n=0;n<i.length;n++){var o=i[n];if(o.regex&&o.regex.test(navigator.userAgent)){l=T5.ex({},j.base,o);COG.Log.info("PLATFORM DETECTED AS: "+l.name);break}}if(!l){COG.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
l=j.base}COG.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return l}})();
T5.Dispatcher=function(){var f=[],m={execute:function(h){var e=m.findAction(h);e&&e.execute.apply(e,Array.prototype.slice.call(arguments,1))},findAction:function(h){for(var e=f.length;e--;)if(f[e].id==h)return f[e];return null},getRegisteredActions:function(){return[].concat(f)},getRegisteredActionIds:function(){for(var h=[],e=f.length;e--;)f[e].id&&h.push(f[e].id);return h},registerAction:function(h){h&&h.id&&f.push(h)},Action:function(h){h=T5.ex({autoRegister:true,id:"",title:"",icon:"",hidden:false,
execute:null},h);var e={id:h.id,execute:function(){h.execute&&h.execute.apply(this,arguments)},getParam:function(a){return h[a]?h[a]:""},toString:function(){return COG.formatStr("{0} [title = {1}, icon = {2}]",e.id,h.title,h.icon)}};h.autoRegister&&m.registerAction(e);return e},Agent:function(h){h=COG.extend({name:"Untitled",translator:null,execute:null},h);var e={getName:function(){return h.name},getParam:function(a){return h[a]},getId:function(){return COG.toID(e.getName())},run:function(a,c){if(h.execute){var d=
h.translator?h.translator(a):a;h.execute.call(e,d,function(b,k){c&&c(b,k,d)})}}};return e},runAgents:function(h,e,a){for(var c=0;c<h.length;c++)h[c].run(e,a)}};return m}();
T5.Resources=function(){var f="",m={},h={getPath:function(e){return/^(file|https?|\/)/.test(e)?e:f+e},setBasePath:function(e){f=e},loadResource:function(e){e=T5.ex({filename:"",cacheable:true,dataType:null,callback:null},e);var a=function(c){e.callback&&COG.Log.watch("CALLING RESOURCE CALLBACK",function(){e.callback(c)})};e.cacheable&&m[e.filename]?a(m[e.filename]):COG.xhr({url:h.getPath(e.filename),dataType:e.dataType,success:function(c){if(e.cacheable)m[e.filename]=c;a(c)},error:function(c,d,b){COG.Log.error("error loading resource ["+
e.filename+"], error = "+b)}})},loadSnippet:function(e,a){/\.\w+$/.test(e)||(e+=".html");h.loadResource({filename:"snippets/"+e,callback:a,dataType:"html"})}};return h}();
T5.Images=function(){function f(){if(!p){var n=T5.getConfig().maxImageLoads;p=COG.Loopage.join({execute:function(o,t){if(!n||j.length<n){var u=g.shift();if(u){j[j.length]=u;u.image.onload=h;u.image.src=T5.Resources.getPath(u.url);u.requested=T5.ticks()}else t.trigger("complete")}},frequency:10});p.bind("complete",function(){p=null})}}function m(){x=true;try{var n=i.length/2>>0;if(n>0){i.sort(function(t,u){return t.created-u.created});for(var o=n;o--;)delete c[i[o].url];i.splice(0,n)}}finally{x=false}COG.say("imagecache.cleared")}
function h(){var n=b[this.id];if(n&&n.image.complete&&n.image.width>0){n.loaded=true;n.hitCount=1;for(var o=j.length;o--;)if(j[o].image.src==this.src){j.splice(o,1);break}if(n.background||n.postProcess||n.drawBackground||n.customDraw)if(n.image){o=a(n.realSize?n.realSize.width:image.width,n.realSize?n.realSize.height:image.height);var t=o.getContext("2d"),u=n.offset?n.offset:new T5.Vector;n.background&&t.drawImage(n.background,0,0);n.drawBackground&&n.drawBackground(t);n.customDraw?n.customDraw(t,
n):t.drawImage(n.image,u.x,u.y);n.postProcess&&n.postProcess(t,n);n.image=o}n.loadCallback&&n.loadCallback(this,false);i[i.length]={url:this.src,created:n.requested};delete b[this.id];f()}}function e(n,o,t){var u=c[n];if(u){u.hitCount++;u.image.complete&&o&&o(u.image,true)}else{u=T5.ex({url:n,image:new Image,loaded:false,created:T5.ticks(),requested:null,hitCount:0,loadCallback:o},t);u.image.id="resourceLoaderImage"+k++;c[n]=u;b[u.image.id]=u;g[g.length]=u;f()}return u}function a(n,o){var t=document.createElement("canvas");
t.width=n?n:0;t.height=o?o:0;if(typeof FlashCanvas!=="undefined"){t.id="tmpCanvas"+d++;t.style.cssText="position: absolute; top: -"+(o-1)+"px; left: -"+(n-1)+"px;";document.body.appendChild(t);FlashCanvas.initElement(t)}typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(t);return t}var c={},d=0,b={},k=0,g=[],j=[],i=[],l=0,p=null,x=false,z={avgImageSize:25,loadTimeout:10,cancelLoad:function(){j=[]},get:function(n,o){var t=null,u=null;x||(t=c[n]);if((u=t?t.image:null)&&(u.getContext||
u.complete&&u.width>0))return u;else o&&e(n,o);return null},load:e,newCanvas:a,stats:function(){return{imageLoadingCount:j.length,queuedImageCount:g.length,imageCacheFullness:l}}};COG.Loopage.join({execute:function(n){for(var o=false,t=0,u=T5.getConfig();t<j.length;)if(n-j[t].requested>z.loadTimeout*1E3){j.splice(t,1);o=true}else t++;o&&f();if(u&&u.imageCacheMaxSize){l=i.length*z.avgImageSize/u.imageCacheMaxSize;l>=1&&m()}},frequency:2E4});return z}();
T5.TimeLord=function(){var f=/^P(\d+Y)?(\d+M)?(\d+D)?$/,m=/^(\d+H)?(\d+M)?(\d+S)?$/,h=function(a,c){return{days:a?a:0,seconds:c?c:0}},e={8601:function(a){a=a.split("T");var c=null;c=null;var d=0,b=0;f.lastIndex=-1;c=f.exec(a[0]);d+=c[3]?parseInt(c[3].slice(0,-1),10):0;m.lastIndex=-1;c=m.exec(a[1]);b+=c[1]?parseInt(c[1].slice(0,-1),10)*3600:0;b+=c[2]?parseInt(c[2].slice(0,-1),10)*60:0;b+=c[3]?parseInt(c[3].slice(0,-1),10):0;return new h(d,b)}};return{Duration:h,addDuration:function(){for(var a=new h,
c=arguments.length;c--;){a.days+=arguments[c].days;a.seconds+=arguments[c].seconds}if(a.seconds>=86400){a.days+=~~(a.seconds/86400);a.seconds%=86400}return a},parseDuration:function(a,c){var d=c?e[c]:null;if(d)return d(a);COG.Log.warn("Could not find duration parser for specified format: "+c);return new h},formatDuration:function(a){var c,d,b="";if(a.days)b=a.days+" days ";if(a.seconds){a=a.seconds;if(a>=3600){c=~~(a/3600);a-=c*3600}if(a>=60){d=Math.round(a/60);a-=d*60}if(c)b=b+c+(c>1?" hrs ":" hr ")+
(d?(d>10?d:"0"+d)+" min ":"");else if(d)b=b+d+" min";else if(a>0)b=b+(a>10?a:"0"+a)+" sec"}return b}}}();
(function(){var f=Math.PI*2,m=Math.PI/2,h=Math.abs,e=Math.pow,a=Math.sin,c=Math.asin,d=Math.cos,b=1.70158,k={linear:function(g,j,i,l){return i*g/l+j},backin:function(g,j,i,l){return i*(g/=l)*g*((b+1)*g-b)+j},backout:function(g,j,i,l){return i*((g=g/l-1)*g*((b+1)*g+b)+1)+j},backinout:function(g,j,i,l){return(g/=l/2)<1?i/2*g*g*(((b*=1.525)+1)*g-b)+j:i/2*((g-=2)*g*(((b*=1.525)+1)*g+b)+2)+j},bouncein:function(g,j,i,l){return i-k.bounceout(l-g,0,i,l)+j},bounceout:function(g,j,i,l){return(g/=l)<1/2.75?
i*7.5625*g*g+j:g<2/2.75?i*(7.5625*(g-=1.5/2.75)*g+0.75)+j:g<2.5/2.75?i*(7.5625*(g-=2.25/2.75)*g+0.9375)+j:i*(7.5625*(g-=2.625/2.75)*g+0.984375)+j},bounceinout:function(g,j,i,l){return g<l/2?k.bouncein(g*2,0,i,l)/2+j:k.bounceout(g*2-l,0,i,l)/2+i/2+j},cubicin:function(g,j,i,l){return i*(g/=l)*g*g+j},cubicout:function(g,j,i,l){return i*((g=g/l-1)*g*g+1)+j},cubicinout:function(g,j,i,l){if((g/=l/2)<1)return i/2*g*g*g+j;return i/2*((g-=2)*g*g+2)+j},elasticin:function(g,j,i,l,p,x){if(g==0)return j;if((g/=
l)==1)return j+i;x||(x=l*0.3);if(!p||p<h(i)){p=i;i=x/4}else i=x/f*c(i/p);return-(p*e(2,10*(g-=1))*a((g*l-i)*f/x))+j},elasticout:function(g,j,i,l,p,x){var z;if(g==0)return j;if((g/=l)==1)return j+i;x||(x=l*0.3);if(!p||p<h(i)){p=i;z=x/4}else z=x/f*c(i/p);return p*e(2,-10*g)*a((g*l-z)*f/x)+i+j},elasticinout:function(g,j,i,l,p,x){var z;if(g==0)return j;if((g/=l/2)==2)return j+i;x||(x=l*0.3*1.5);if(!p||p<h(i)){p=i;z=x/4}else z=x/f*c(i/p);if(g<1)return-0.5*p*e(2,10*(g-=1))*a((g*l-z)*f/x)+j;return p*e(2,
-10*(g-=1))*a((g*l-z)*f/x)*0.5+i+j},quadin:function(g,j,i,l){return i*(g/=l)*g+j},quadout:function(g,j,i,l){return-i*(g/=l)*(g-2)+j},quadinout:function(g,j,i,l){if((g/=l/2)<1)return i/2*g*g+j;return-i/2*(--g*(g-2)-1)+j},sinein:function(g,j,i,l){return-i*d(g/l*m)+i+j},sineout:function(g,j,i,l){return i*a(g/l*m)+j},sineinout:function(g,j,i,l){return-i/2*(d(Math.PI*g/l)-1)+j}};T5.easing=function(g){return k[g.replace(/[\-\_\s\.]/g,"").toLowerCase()]};T5.registerEasingType=function(g,j){k[g.replace(/[\-\_\s\.]/g,
"").toLowerCase()]=j}})();
T5.Tween=function(f){f=T5.ex({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:T5.easing("sine.out"),complete:null,cancelOnInteract:false},f);var m=T5.ticks(),h=[],e=false,a=0,c=0,d={cancelOnInteract:f.cancelOnInteract,isComplete:function(){return e},triggerComplete:function(b){f.complete&&f.complete(b)},update:function(b){try{var k=f.tweenFn(b-m,a,c,f.duration);if(f.target)f.target[f.property]=k;for(var g=h.length;g--;)h[g](k,void 0);if(e=m+f.duration<=b){if(f.target)f.target[f.property]=
f.tweenFn(f.duration,a,c,f.duration);for(var j=h.length;j--;)h[j](k,true)}}catch(i){COG.Log.exception(i)}},requestUpdates:function(b){h.push(b)}};a=f.target&&f.property&&f.target[f.property]?f.target[f.property]:f.startValue;if(typeof f.endValue!=="undefined")c=f.endValue-a;if(c==0)e=true;T5.wakeTweens();return d};
(function(){function f(a){if(e)return m.length;e=true;try{for(var c=0;c<m.length;)if(m[c].isComplete()){m[c].triggerComplete(false);m.splice(c,1)}else{m[c].update(a);c++}}finally{e=false}m.length===0&&h.trigger("complete");return m.length}var m=[],h=null,e=false;T5.tweenValue=function(a,c,d,b,k){a=new T5.Tween({startValue:a,endValue:c,tweenFn:d,complete:b,duration:k});m.push(a);return a};T5.tween=function(a,c,d,b,k,g){a=new T5.Tween({target:a,property:c,endValue:d,tweenFn:b,duration:g,complete:k});
m.push(a);return a};T5.tweenVector=function(a,c,d,b,k,g){var j=[];if(a){var i=a.x==c,l=a.y==d;i||j.push(T5.tween(a,"x",c,b,function(){(i=true)&&l&&k()},g));l||j.push(T5.tween(a,"y",d,b,function(){l=true;i&&l&&k()},g))}return j};T5.cancelAnimation=function(a){if(!e){e=true;try{for(var c=0;c<m.length;)if(!a||a(m[c])){m[c].triggerComplete(true);m.splice(c,1)}else c++}finally{e=false}}};T5.isTweening=function(){return m.length>0};T5.wakeTweens=function(){if(!h){h=COG.Loopage.join({execute:f,frequency:20});
h.bind("complete",function(){h=null})}}})();(function(){var f={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,PINCH:16,FREEZE:128};T5.viewState=function(){for(var m=0,h=arguments.length;h--;){var e=f[arguments[h].toUpperCase()];if(e)m|=e}return m}})();
T5.ViewLayer=function(f){f=T5.ex({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:T5.viewState("ACTIVE","ANIMATING","PAN","PINCH")},f);var m=null,h=false,e=false,a=f.supportFastDraw,c=f.id,d=T5.viewState("ACTIVE"),b=f.validStates,k=0,g=0,j=T5.ex({addToView:function(i){i.setLayer(c,j)},shouldDraw:function(i,l,p){i=(i&b)!==0&&(h?a:true);return i=e||p||k!==l.x||g!==l.y},cycle:function(){},draw:function(){},remove:function(){j.trigger("remove",j)},changed:function(){e=true;j.trigger("changed",
j);m&&m.trigger("invalidate")},getId:function(){return c},setId:function(i){c=i},getParent:function(){return m},setParent:function(i){h=(m=i)?m.fastDraw&&displayState!==d:false;j.trigger("parentChange",m)}},f);COG.observable(j);j.bind("drawComplete",function(i,l){e=false;k=l.x;g=l.y});return j};
T5.View=function(f){function m(q,r,E,K){V=na;t();if(K&&f.inertia){F=true;g(U+r,w+E,f.panAnimationEasing,f.panAnimationDuration)}else K||g(U+r,w+E)}function h(){V=ka;F=false;COG.Loopage.join({execute:t,after:50,single:true})}function e(q,r){P=ra(q);$=ra(r);var E=v(P.dimensions),K=v($.dimensions);Y=B(P);A=B($);H=P&&E!==0?K/E:1}function a(q,r,E){e(r,E);if(S=H!==1){V=Z;t()}}function c(q,r,E,K){e(r,E);if(f.adjustScaleFactor){H=f.adjustScaleFactor(H);COG.Log.info("scale factor adjusted to: "+H)}if(K<f.pinchZoomAnimateTrigger){l(ia,
H,Y,p(),T5.easing("sine.out"),function(){b();H=1},300);H=ia}else{b();H=1}}function d(q,r,E){y.zoom(r,Math.min(Math.pow(2,Math.round(Math.log(E))),8),500)}function b(){var q=P?p():A;H=Math.round(H*10)/10;S=false;for(var r=u.length;r--;)u[r].trigger("scale",H,q);y.trigger("scale",H,q);V=ka;t()}function k(){clearTimeout(X);X=setTimeout(j,50)}function g(q,r,E,K,O){function ca(){da+=1;if(da>=2){h(0,0);O&&O()}}var da=0;if(E){q=T5.tweenValue(U,q,E,ca,K);r=T5.tweenValue(w,r,E,ca,K);q.cancelOnInteract=true;
q.requestUpdates(function(ha){U=ha;F=true;t()});r.cancelOnInteract=true;r.requestUpdates(function(ha){w=ha;F=true;t()})}else{U=q;w=r}}function j(){var q;if(D){COG.Touch.release(D);if(f.autoSize&&D.parentNode){q=D.parentNode.getBoundingClientRect();if(q.height!==0&&q.width!==0){D.height=q.height;D.width=q.width}}try{if(!D.id)D.id=f.id+"_canvas";ga=D.getContext("2d");ga.clearRect(0,0,D.width,D.height)}catch(r){COG.Log.exception(r);throw Error("Could not initialise canvas on specified view element");
}ma=COG.Touch.capture(D,{observable:y});if(s.height!==D.height||s.width!==D.width){s=new T5.Dimensions(D.width,D.height);y.trigger("resize",D.width,D.height);for(q=Q;q--;)u[q].trigger("resize",D.width,D.height)}f.inertia&&ma.inertiaEnable(f.panAnimationDuration,s);for(q=Q;q--;)u[q].trigger("contextChanged",ga);o()}}function i(q,r){r.setId(q);r.added=T5.ticks();r.bind("remove",function(){y.removeLayer(q)});r.trigger("contextChanged",ga);r.setParent(y);u.push(r);u.sort(function(E,K){var O=K.zindex-
E.zindex;if(O===0)O=K.added-E.added;return O});Q=u.length;return r}function l(q,r,E,K,O,ca,da){function ha(){ca&&ca();b();H=1;fa=null}S=true;Y=T5.V.copy(E);A=T5.V.copy(K);P=null;if(O)T5.tweenValue(0,r-q,O,ha,da?da:1E3).requestUpdates(function(la){fa=la/(r-q);H=q+la;V=Z;t();y.trigger("animate")});else{H=targetScaleFactor;ha()}}function p(){var q=T5.D.getCenter(s),r=T5.V.distance([A,q]),E=T5.V.theta(A,q,r),K=T5.V.diff(Y,A);q=T5.V.pointOnEdge(A,q,E,r/H);q.x+=K.x;q.y+=K.y;return q}function x(){y.trigger("idle");
J=true;M=0}function z(q,r,E,K){var O=aa?aa:F?na:ba?T5.viewState("FROZEN"):V,ca=(O&Z)!==0,da=0;if(G||ca){q.clearRect(0,0,D.width,D.height);G=false}if(ca){T5.D.getCenter(s);var ha=(fa?fa:1)/2,la=T5.V.diff(Y,A);if(P){N.x=A.x+la.x;N.y=A.y+la.y}else{N.x=A.x-la.x*ha;N.y=A.y-la.y*ha}r=T5.V.offset(r,N.x,N.y)}q.save();try{ia=H;if(R!==1)q.scale(R,R);else if(ca){q.translate(A.x,A.y);q.scale(H,H)}for(da=Q;da--;)if(u[da].shouldDraw(O,r,E)){u[da].draw(q,r,s,O,y,E,K);u[da].trigger("drawComplete",r,K)}}finally{q.restore()}y.trigger("drawComplete",
r,K);COG.Log.trace("draw complete",K)}function n(q,r){var E=false,K=!F&&(V===Z||V===na),O=W||V===T5.viewState("PAN")||V===T5.viewState("PINCH")||T5.isTweening();C.x=U>>0;C.y=w>>0;if(K){T5.cancelAnimation(function(ca){return ca.cancelOnInteract});J=false;if(M!==0){clearTimeout(M);M=0}}for(K=Q;K--;){if(u[K].animated)V|=oa;E=u[K].cycle(q,C,V,O)||E}O=O||(V&oa)!==0;if(E=E||O||H!==1&&H!==ja){z(ga,C,O,q);ja=H;W=false}if(!E&&L===0&&!pa){if(!J&&M===0)M=setTimeout(x,500);r.trigger("complete")}L=0;COG.Log.trace("Completed draw cycle",
q)}function o(){W=true;t()}function t(){L+=1;if(!(ba||ea)){ea=COG.Loopage.join({execute:n,frequency:qa});ea.bind("complete",function(){ea=null})}}f=T5.ex({id:COG.objId("view"),container:"",fastDraw:false,inertia:true,pannable:true,scalable:true,panAnimationEasing:T5.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:true,tapExtent:10,fps:25},f);var u=[],Q=0,D=document.getElementById(f.container),ga=null,U=0,w=0,C=new T5.Vector,G=false,ea=null,ba=
false,R=1,s=new T5.Dimensions,L=0,A=null,J=false,F=false,M=0,T=0,N=new T5.Vector,I=0,S=false,P=null,$=null,aa=null,W=false,X=0,H=1,ja=0,ia=1,fa=null,Y=null,pa=typeof FlashCanvas!=="undefined",qa=~~(1E3/f.fps),ma=null,ka=T5.viewState("ACTIVE"),na=T5.viewState("PAN"),Z=T5.viewState("PINCH"),oa=T5.viewState("ANIMATING"),V=ka,ra=T5.V.getRect,v=T5.D.getSize,B=T5.R.getCenter,y={id:f.id,deviceScaling:R,fastDraw:f.fastDraw||T5.getConfig().requireFastDraw,stateOverride:null,animate:function(q,r,E,K,O){l(H,
q,r,E,K,O)},centerOn:function(q){U=q.x-D.width/2;w=q.y-D.height/2},getDimensions:function(){return s},getZoomCenter:function(){return N},getLayer:function(q){for(var r=0;r<Q;r++)if(u[r].getId()==q)return u[r];return null},setLayer:function(q,r){for(var E=0;E<Q;E++)if(u[E].getId()===q){u.splice(E,1);break}r&&i(q,r);o()},eachLayer:function(q){for(var r=Q;r--;)q(u[r])},clearBackground:function(){COG.Log.info("CALL OF DEPRECATED METHOD CLEAR BACKGROUND");G=true;o()},invalidate:o,freeze:function(){ba=
true},unfreeze:function(){ba=false;t()},resize:function(q,r){if(D){f.autoSize=false;D.width=q;D.height=r;j();y.trigger("resize",D.width,D.height)}},scale:function(q,r,E,K,O){K||(K=T5.D.getCenter(s));O||(O=T5.D.getCenter(s));y.animate(q,K,O,r,E);return y},removeLayer:function(q){a:{for(var r=Q;r--;)if(u[r].getId()==q){q=r;break a}q=-1}if(q>=0&&q<Q){COG.say("layer.removed",{layer:u[q]});u.splice(q,1);o()}Q=u.length},stateOverride:function(q){aa=q},getOffset:function(){return C},updateOffset:g,zoom:function(q,
r,E){F=false;H=r;S=H!==1;Y=T5.D.getCenter(s);A=H>1?T5.V.copy(q):T5.D.getCenter(s);P=null;clearTimeout(T);if(S){V=Z;t();if(E)T=setTimeout(function(){b();H=1},parseInt(E,10))}}};R=T5.getConfig().getScaling();y.markers=i("markers",new T5.MarkerLayer);COG.observable(y);y.bind("wake",t);y.bind("invalidate",o);if(f.pannable){y.bind("pan",m);y.bind("panEnd",h);y.bind("inertiaCancel",function(){F=false;t()})}if(f.scalable){y.bind("pinchZoom",a);y.bind("pinchZoomEnd",c);y.bind("wheelZoom",d)}y.bind("tap",
function(q,r,E){for(var K=T5.V.offset(E,U,w),O=u.length;O--;)q.cancel=q.cancel||u[O].trigger("tap",r,E,K).cancel});COG.configurable(y,["inertia","container","rotation","tapExtent"],COG.paramTweaker(f,null,{container:function(q,r){D=document.getElementById(r);j()},rotation:function(q,r){I=r}}),true);j();f.autoSize&&window.addEventListener("resize",k,false);return y};
T5.PathLayer=function(f){function m(j){j.syncVectors(c);d&&j.syncVectors(d);g.trigger("tidy")}f=T5.ex({style:"waypoints",pixelGeneralization:8,zindex:50},f);var h=false,e=[],a=null,c=[],d=null,b=0,k=[],g=T5.ex(new T5.ViewLayer(f),{getAnimation:function(j,i,l,p){var x="pathAnimation"+b++;k.push(x);return new T5.AnimatedPathLayer({id:x,path:e,zindex:f.zindex+1,easing:j?j:T5.easing("sine.inout"),duration:i?i:5E3,drawIndicator:l,autoCenter:p?p:false})},cycle:function(j,i,l,p){return p},draw:function(j,
i){var l,p=e.length;j.save();try{T5.applyStyle(j,f.style);if(p>0){j.beginPath();j.moveTo(e[p-1].x-i.x,e[p-1].y-i.y);for(l=p;l--;)j.lineTo(e[l].x-i.x,e[l].y-i.y);j.stroke();if(a){j.fillStyle=f.waypointFillStyle;for(l=a.length;l--;){j.beginPath();j.arc(a[l].x-i.x,a[l].y-i.y,2,0,Math.PI*2,false);j.stroke();j.fill()}}}}finally{j.restore()}h=false},updateCoordinates:function(j,i){var l=g.getParent();l=l?l.getTileLayer():null;c=j;d=i;COG.Log.info("updating coordinates, grid = "+l);l&&m(l)}});g.bind("gridUpdate",
function(j,i){m(i);for(var l=k.length;l--;)COG.say("layer.remove",{id:k[l]});k=[]});g.bind("tidy",function(){e=T5.V.simplify(c,f.pixelGeneralization);a=T5.V.simplify(d,f.pixelGeneralization);h=true;g.changed()});return g};
T5.Poly=function(f,m){m=T5.ex({fill:false,style:null},m);var h=false,e=m.fill,a=m.style,c=[],d={draw:function(b,k,g){if(h){var j=true,i=a?T5.applyStyle(b,m.style):null;b.beginPath();for(var l=c.length;l--;){var p=c[l].x-k,x=c[l].y-g;if(j){b.moveTo(p,x);j=false}else b.lineTo(p,x)}e&&b.fill();b.stroke();i&&T5.applyStyle(b,i)}},resync:function(b){b.syncVectors(f);c=f.length<=3?f:T5.V.simplify(f)}};h=f&&f.length>=2;return d};
T5.PolyLayer=function(f){f=T5.ex({zindex:80,style:null},f);var m=[],h=false,e=T5.ex(new T5.ViewLayer(f),{add:function(a){m.unshift(a)},cycle:function(){return h},draw:function(a,c,d,b){d=c.x;c=c.y;a.save();try{T5.applyStyle(a,f.style);for(var k=m.length;k--;)m[k].draw(a,d,c,b)}finally{a.restore()}h=false}});e.bind("gridUpdate",function(a,c){for(var d=m.length;d--;)m[d].resync(c);h=true;e.changed()});e.bind("parentChange",function(a,c){var d=c?c.getTileLayer():null;if(d)for(var b=m.length;b--;)m[b].resync(d)});
COG.configurable(e,["style"],COG.paramTweaker(f,null,null),true);return e};
T5.AnimatedPathLayer=function(f){function m(b,k,g){b.fillStyle="#FFFFFF";b.strokeStyle="#222222";b.beginPath();b.arc(g.x,g.y,4,0,Math.PI*2,false);b.stroke();b.fill()}f=T5.ex({path:[],id:COG.objId("pathAni"),easing:T5.easing("sine.inout"),validStates:T5.viewState("ACTIVE","PAN","PINCH"),drawIndicator:null,duration:2E3,autoCenter:false},f);var h=T5.V.edges(f.path),e,a=null,c=0;T5.tweenValue(0,h.total,f.easing,function(){d.remove()},f.duration).requestUpdates(function(b,k){c=b;k&&d.remove()});var d=
T5.ex(new T5.ViewLayer(f),{cycle:function(){for(var b=0;b<h.accrued.length&&h.accrued[b]<c;)b++;a=null;if(b<f.path.length-1){var k=c-(b>0?h.accrued[b-1]:0),g=f.path[b],j=f.path[b+1];e=T5.V.theta(g,j,h.edges[b]);a=T5.V.pointOnEdge(g,j,e,k);if(f.autoCenter)(b=d.getParent())&&b.centerOn(a)}return a},draw:function(b,k){if(a)(f.drawIndicator?f.drawIndicator:m)(b,k,new T5.Vector(a.x-k.x,a.y-k.y),e)}});return d};
T5.Marker=function(f){function m(g,j,i,l){e=g;a=j;c=i;d=l}f=T5.ex({xy:new T5.Vector,offset:true,tweenIn:null,animationSpeed:null},f);var h=false,e=0,a=0,c=0,d=0,b=f.offset,k=T5.ex(f,{isNew:true,isAnimating:function(){return h},draw:function(g,j,i,l,p){if(k.isNew&&f.tweenIn){var x=k.xy.y;k.xy.y=j.y-20;h=true;T5.tween(k.xy,"y",x,f.tweenIn,function(){k.xy.y=x;h=false},f.animationSpeed?f.animationSpeed:250+Math.random()*500)}k.drawMarker(g,j,k.xy.x-(b?j.x:0),k.xy.y-(b?j.y:0),i,l,p);k.isNew=false},drawMarker:function(g,
j,i,l){g.beginPath();g.arc(i,l,4,0,Math.PI*2,false);g.fill();m(i-4,l-4,8,8)},hitTest:function(g,j){return g>=e&&g<=e+c&&j>=a&&j<=a+d},updateBounds:m});COG.observable(k);return k};
T5.ImageMarker=function(f){f=T5.ex({image:null,imageUrl:null,animatingImage:null,animatingImageUrl:null,imageAnchor:null,rotation:0,scale:1,opacity:1},f);var m=f.imageAnchor?T5.V.invert(f.imageAnchor):null,h=T5.ex(new T5.Marker(f),{drawMarker:function(e,a,c,d){if((a=h.isAnimating()&&h.animatingImage?h.animatingImage:h.image)&&a.complete&&a.width>0){m||(m=new T5.Vector(-a.width>>1,-a.height>>1));var b=h.scale,k=c+~~(m.x*b),g=d+~~(m.y*b),j=~~(a.width*b),i=~~(a.height*b);h.updateBounds(k,g,j,j);if(h.rotation||
h.opacity!==1){e.save();try{e.globalAlpha=h.opacity;e.translate(c,d);e.rotate(h.rotation);e.drawImage(a,m.x*b,m.y*b,j,i)}finally{e.restore()}}else e.drawImage(a,k,g,j,i)}}});if(!h.image)h.image=T5.Images.get(f.imageUrl,function(e){h.image=e});if(!h.animatingImage)h.animatingImage=T5.Images.get(f.imageUrl,function(e){h.animatingImage=e});return h};T5.Annotation=T5.Marker;T5.ImageAnnotation=T5.ImageMarker;
T5.MarkerLayer=function(f){function m(d,b){for(var k=e.length;k--;)b.syncVectors([e[k].xy])}function h(){c.changed();c.trigger("markerUpdate",e)}f=T5.ex({zindex:100},f);var e=[],a=false,c=T5.ex(new T5.ViewLayer(f),{cycle:function(){return a},draw:function(d,b,k,g,j){a=false;for(k=e.length;k--;){e[k].draw(d,b,g,c,j);a=a||e[k].isAnimating()}return a?1:0},add:function(d){if(d&&typeof d.length!=="undefined")for(var b=d.length;b--;){if(d[b])e[e.length]=d[b]}else if(d)e[e.length]=d;h()},clear:function(d){if(d)for(var b=
0;b<e.length;b++)d(e[b])&&e.splice(b,1);else e=[];h()},find:function(d){var b=[];if(d)for(var k=e.length;k--;)if(d(e[k]))b[b.length]=e[k];return b}});c.bind("tap",function(d,b,k){for(var g=[],j=k.x,i=k.y,l=e.length;l--;)if(e[l].hitTest(j,i))g[g.length]=e[l];if(g.length>0)d.cancel=c.trigger("markerTap",b,k,g).cancel});c.bind("gridUpdate",m);c.bind("changed",function(){var d=c.getParent().getTileLayer();d&&m(null,d)});return c};
T5.Style=function(f){function m(c){var d=f[c];typeof d!=="undefined"&&h.push(function(b){b[c]=d})}f=T5.ex({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},f);var h=[],e={applyToContext:function(c){for(var d=h.length;d--;)h[d](c)}};for(var a in f)m(a);return e};
(function(){var f={},m={basic:new T5.Style({lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"}),waypoints:new T5.Style({lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"})};T5.applyStyle=function(h,e){var a=T5.styles[e]?T5.styles[e]:T5.styles.basic,c;if(h&&h.canvas){c=f[h.canvas.id];f[h.canvas.id]=e}a.applyToContext(h);return c};T5.loadStyles=function(h){COG.jsonp(h,function(e){T5.resetStyles(e)})};T5.resetStyles=function(h){var e={};for(var a in h)e[a]=new T5.Style(h[a]);T5.styles=T5.ex({},
m,e)};T5.styles=m})();(function(){T5.tileSize=256;T5.Tile=function(f){return f=T5.ex({x:0,y:0,gridX:0,gridY:0,dirty:true},f)};T5.EmptyTile=function(f){f=new T5.Tile(f);f.empty=true;return f};T5.ImageTile=function(f){f=T5.ex({url:"",sessionParamRegex:null,loading:false,loaded:false},f);return new T5.Tile(f)}})();
T5.TileGrid=function(f){function m(s,L){var A=T5.Vector(s*k-p.x,L*k-p.y);return new T5.EmptyTile({gridX:A.x,gridY:A.y,empty:true})}function h(s,L,A,J){var F=Math.max(d,b)*0.2>>0,M=new T5.Vector;if(s<0||s+A>d)M.x=s<0?-F:F;if(L<0||L+J>b)M.y=L<0?-F:F;return M}function e(s,L,A){var J=COG.Log.getTraceTicks(),F=0;new T5.Vector(d/2,b/2);if(A)c=[];if(s)for(A=0;A<b;A++)for(var M=0;M<d;M++){if(!c[F]){var T=s(M,A,i,d,b);T.gridX=M*k-p.x;T.gridY=A*k-p.y;c[F]=T}F++}l=s;z=L;COG.Log.trace("tile grid populated",J);
R.changed()}function a(s,L,A,J){var F,M=[],T=false;s=new T5.Vector((s.x+p.x)*t>>0,(s.y+p.y)*t>>0);tilesNeeded=false;if(!G){F=R.getParent().getDimensions();w=Math.ceil(F.width*t)+1;C=Math.ceil(F.height*t)+1;G=new T5.Vector((w-1)/2>>0,(C-1)/2>>0)}for(var N=C;N--;)for(var I=w;I--;){F=I+s.x>=0&&I+s.x<d?c[(N+s.y)*d+(I+s.x)]:null;var S=new T5.Vector(I-G.x,N-G.y);if(!F){U=h(s.x,s.y,w,C);F=m(I+s.x,N+s.y)}T=F?(F.dirty=A||F.dirty)||T:T;M[M.length]={tile:F,centerness:T5.V.absSize(S)}}M.sort(function(P,$){return $.centerness-
P.centerness});Q||(Q=Array(M.length));for(A=M.length;A--;){Q[A]=M[A].tile;R.prepTile(Q[A],L)}ga=J;return T}f=T5.ex({tileSize:T5.tileSize,center:new T5.Vector,gridSize:25,shiftOrigin:null,supportFastDraw:true,allowShift:true},f);var c=Array(Math.pow(f.gridSize,2)),d=f.gridSize,b=f.gridSize,k=f.tileSize,g=b*k,j=d*k,i=T5.V.offset(f.center,-Math.ceil(d>>1)),l=null,p=new T5.Vector,x=false,z=null,n=Math.round(k/2),o=false,t=k?1/k:0,u=true,Q=null,D=false,ga=0;new T5.Vector;var U=new T5.Vector;T5.getConfig();
var w,C,G,ea=T5.viewState("ANIMATING"),ba=T5.viewState("PINCH"),R=T5.ex(new T5.ViewLayer(f),{gridDimensions:new T5.Dimensions(j,g),cycle:function(s,L,A,J){if(U.x!==0||U.y!==0){J=U;var F=f.shiftOrigin;if(!(!f.allowShift||J.x===0&&J.y===0)){var M=COG.Log.getTraceTicks(),T=Array(c.length);T.length=c.length;for(var N=0;N<d;N++)for(var I=0;I<b;I++)T[I*d+N]=N+J.x>=0&&N+J.x<d?c[(I+J.y)*d+(N+J.x)]:null;c=T;i=F?F(i,J):T5.V.add(i,J);p.x+=-J.x*k;p.y+=-J.y*k;COG.Log.trace("tile storage shifted",M);e(l,z)}U=new T5.Vector;
J=true}if(!o&&(A&ba)===0)o=a(L,A,J,s);x=(A&ea)!==0||T5.isTweening();return o},find:function(s){if(!s)return null;for(var L=c.length;L--;){var A=c[L];if(A&&s(A))return A}return null},prepTile:function(){},drawTile:function(){return false},getTileSize:function(){return k},clearTileRect:function(s,L,A,J){s.clearRect(L,A,J,J)},draw:function(s,L,A,J,F,M,T){var N=L.x;L=L.y;var I=A.width,S=A.height,P,$=true;if(Q){s.beginPath();if(u)for(var aa=Q.length;aa--;){P=Q[aa];var W=P.gridX-N,X=P.gridY-L;P.x=W;P.y=
X;if(P.empty){COG.Log.info("empty tile @ x: "+W+", y: "+X);R.clearTileRect(s,W,X,k,J);$=false}else if(M||P.dirty){x&&R.clearTileRect(s,W,X,k,J);(P=R.drawTile(s,P,W,X,J,M,T))&&s.rect(W,X,k,k);$=$&&P}I=W<I?W:I;S=X<S?X:S}s.clip();I>0&&s.clearRect(0,0,I,A.height);S>0&&s.clearRect(0,0,A.width,S);$&&!D&&F.trigger("tileDrawComplete");o=false;D=$}},getTileAtXY:function(s,L){for(var A=null,J=Q?Q.length:0;J--;){var F=Q[J];if(F&&s>=F.x&&L>=F.y)if(s<=F.x+k&&L<=F.y+k){A=F;break}}COG.Log.info("looking for tile @ x: "+
s+", y: "+L+", found: "+A);return A},getTileVirtualXY:function(s,L,A){s=T5.V.add(new T5.Vector(s,L),T5.V.invert(i),p);s=new T5.Vector(s.x*k,s.y*k);if(A){s.x+=n;s.y+=n}return s},populate:function(s){e(s,null,true)},syncVectors:function(){}});R.bind("resize",function(){COG.Log.info("captured resize");G=null});R.bind("scale",function(){u=false});COG.listen("imagecache.cleared",function(){for(var s=c.length;s--;)if(c[s])c[s].loaded=false});COG.listen("tiler.repaint",function(){for(var s=c.length;s--;)if(c[s]){c[s].x=
null;c[s].y=null}});return R};
T5.ImageTileGrid=function(f){function m(l){function p(){var x=T5.Images.newCanvas(32,32),z=x.getContext("2d");z.fillStyle="#BBBBBB";z.fillRect(0,0,32,32);z.fillStyle="#C3C3C3";z.fillRect(0,0,16,16);z.fillRect(16,16,16,16);return x}if(!e||l!==e.width){e=T5.Images.newCanvas(l,l);l=e.getContext("2d");l.fillStyle=typeof FlashCanvas!=="undefined"?"#666666":l.createPattern(p(),"repeat");l.fillRect(0,0,e.width,e.height)}return e}f=T5.ex({emptyTile:function(l){if(!h||l!==h.width){h=T5.Images.newCanvas(l,
l);l=h.getContext("2d");l.fillStyle="rgba(150, 150, 150, 0.1)";l.fillRect(0,0,h.width,h.height)}return h}(T5.tileSize),panningTile:null,tileOffset:new T5.Vector,tileDrawArgs:{}},f);var h=f.emptyTile,e=f.panningTile?f.panningTile:m(T5.tileSize),a=T5.viewState("ACTIVE"),c=T5.viewState("PAN"),d=T5.getConfig().requireFastDraw,b=f.tileSize?f.tileSize:T5.tileSize,k=T5.Images.get,g=T5.Images.load,j=T5.ex({background:null,overlay:null,offset:new T5.Vector,realSize:new T5.Dimensions(b,b)},f.tileDrawArgs),
i=T5.ex(new T5.TileGrid(f),{clearTileRect:function(l,p,x,z,n){(n&c)===0&&l.clearRect(p,x,z,z)},drawTile:function(l,p,x,z,n){var o=p.url?k(p.url):null,t=false;if(o){l.drawImage(o,x,z);t=true}else if((n&c)!==0){l.drawImage(e,x,z);t=true}p.dirty=false;return t},initTileUrl:function(){},prepTile:function(l,p){if(l&&!l.loading&&(!d||p===a)){l.url||i.initTileUrl(l);if(!k(l.url)){l.loading=true;g(l.url,function(){l.loaded=true;l.dirty=true;i.changed()},j)}}}});return i};
T5.Tiler=function(f){f=T5.ex({container:"",drawCenter:false,datasources:{},tileLoadThreshold:"first"},f);var m=T5.ex(new T5.View(f),{getTileLayer:function(){return m.getLayer("grid0")},setTileLayer:function(h){m.setLayer("grid0",h);m.trigger("gridUpdate",h);m.eachLayer(function(e){e.trigger("gridUpdate",h)})},viewPixToGridPix:function(h){var e=m.getOffset();return new T5.Vector(h.x+e.x,h.y+e.y)},centerOn:function(h,e,a,c){var d=m.getTileLayer(),b=m.getDimensions();(d=d?d.getTileSize():0)&&m.updateOffset(h.gridX-
(b.width-d)*0.5>>0,h.gridY-(b.height-d)*0.5>>0,e,a,c)},cleanup:function(){m.removeLayer("grid0")},repaint:function(){COG.say("tiler.repaint");m.trigger("wake")},select:function(h){m.trigger("selectTile",h)}});m.bind("tap",function(h,e,a){if(h=m.getTileLayer())(a=h.getTileAtXY(a.x,a.y))&&m.trigger("selectTile",a)});return m};
