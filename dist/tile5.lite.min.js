COG=typeof COG!=="undefined"?COG:{};COG.extend=function(){for(var L=arguments[0]||{},Y,D=1,w=arguments.length;D<w;D++)if((Y=arguments[D])!==null)for(var j in Y){var l=Y[j];if(L!==l)if(l!==undefined)L[j]=l}return L};
(function(){var L=Object.prototype.hasOwnProperty,Y=0,D={};D.toID=function(w){return w.replace(/\s/g,"-")};D.objId=function(w){return(w?w:"obj")+Y++};D.isFunction=function(w){return toString.call(w)==="[object Function]"};D.isArray=function(w){return toString.call(w)==="[object Array]"};D.isPlainObject=function(w){if(!w||toString.call(w)!=="[object Object]"||w.nodeType||w.setInterval)return false;if(w.constructor&&!L.call(w,"constructor")&&!L.call(w.constructor.prototype,"isPrototypeOf"))return false;
var j;for(j in w);return j===undefined||L.call(w,j)};D.isEmptyObject=function(w){for(var j in w)return false;return true};D.isXmlDocument=function(w){return toString.call(w)==="[object Document]"};D.contains=function(w,j){var l=w,x=arguments,A=1;if(j&&module.isArray(j)){x=j;A=0}for(A=A;A<x;A++)l=l&&typeof foo[x[A]]!=="undefined";return l};D.formatStr=function(w){if(arguments.length<=1)return w;for(var j=arguments.length-2,l=0;l<=j;l++)w=w.replace(RegExp("\\{"+l+"\\}","gi"),arguments[l+1]);return w};
D.wordExists=function(w,j){var l="";if(j.toString)j=j.toString();for(var x=0;x<j.length;x++)l+=!/\w/.test(j[x])?"\\"+j[x]:j[x];return RegExp("(^|\\s|\\,)"+l+"(\\,|\\s|$)","i").test(w)};COG.extend(COG,D)})();
(function(){function L(l){return typeof console!=="undefined"?function(){console[l](Array.prototype.slice.call(arguments,0).join(" "));return true}:function(){return false}}var Y=window.console&&window.console.markTimeline,D=L("error"),w=L("info"),j=function(){return Y?function(l,x){console.markTimeline(l+(x?": "+((new Date).getTime()-x)+"ms":""))}:function(){}}();COG.extend(COG,{trace:j,debug:L("debug"),info:w,warn:L("warn"),error:D,exception:function(l){if(D)for(var x in l)w("ERROR DETAIL: "+x+
": "+l[x])}})})();
(function(){function L(D,w){var j=D.obsHandlers;j[w]||(j[w]=[]);return j[w]}var Y=0;COG.observable=function(D){if(!D)return null;if(!D.obsHandlers)D.obsHandlers={};if(!(D.bind||D.trigger||D.unbind)){D.bind=function(w,j){var l="callback"+Y++;L(D,w).unshift({fn:j,id:l});return l};D.triggerCustom=function(w,j){var l=L(D,w),x={cancel:false,name:w},A;j&&COG.extend(x,j);if(!l)return null;A=Array.prototype.slice.call(arguments,2);D.eventInterceptor&&D.eventInterceptor(w,x,A);A.unshift(x);for(var h=l.length;h--&&
!x.cancel;)l[h].fn.apply(this,A);return x};D.trigger=function(w){var j=Array.prototype.slice.call(arguments,1);j.splice(0,0,w,null);return D.triggerCustom.apply(this,j)};D.unbind=function(w,j){if(typeof w==="undefined")D.obsHandlers={};else for(var l=L(D,w),x=0;l&&x<l.length;x++)if(l[x].id===j){l.splice(x,1);break}return D}}return D}})();
(function(){function L(j,l){j[l]||(j[l]=function(x){return j.configure(l,x)})}function Y(j){j.gtConfId="configurable"+w++;j.gtConfig={};j.gtConfigFns=[];return j.gtConfig}var D={},w=0;COG.paramTweaker=function(j,l,x){return function(A,h){if(typeof h!=="undefined"){if(A in j)j[A]=h;x&&A in x&&x[A](A,h)}else return l&&A in l?l[A](A):j[A]}};COG.configurable=function(j,l,x,A){if(j){j.gtConfId||Y(j);var h=j.gtConfId,z=j.gtConfig,v=j.gtConfigFns;D[h]=j;v.push(x);for(x=l.length;x--;){z[l[x]]=true;A&&L(j,
l[x])}if(!j.configure)j.configure=function(C,N){if(z[C]){for(var p=v.length;p--;){var s=v[p](C,N);if(typeof s!=="undefined")return s}return D[h]}return null}}}})();
(function(){function L(j){var l=document.createElement("script"),x=false;l.src=j;l.async=true;l.onload=l.onreadystatechange=function(){if(!x&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){x=true;l.onload=l.onreadystatechange=null;l&&l.parentNode&&l.parentNode.removeChild(l)}};D||(D=document.getElementsByTagName("head")[0]);D.appendChild(l)}var Y=0,D,w=this;COG.jsonp=function(j,l,x){j+=j.indexOf("?")>=0?"&":"?";var A="json"+ ++Y;w[A]=function(h){l(h);w[A]=null;try{delete w[A]}catch(z){}};
L(j+(x?x:"callback")+"="+A);return A}})();
(function(){var L=1.70158,Y=Math.PI/2,D=Math.abs,w=Math.pow,j=Math.sin,l=Math.asin,x=Math.cos,A={linear:function(h,z,v,C){return v*h/C+z},backin:function(h,z,v,C){return v*(h/=C)*h*((L+1)*h-L)+z},backout:function(h,z,v,C){return v*((h=h/C-1)*h*((L+1)*h+L)+1)+z},backinout:function(h,z,v,C){return(h/=C/2)<1?v/2*h*h*(((L*=1.525)+1)*h-L)+z:v/2*((h-=2)*h*(((L*=1.525)+1)*h+L)+2)+z},bouncein:function(h,z,v,C){return v-A.bounceout(C-h,0,v,C)+z},bounceout:function(h,z,v,C){return(h/=C)<1/2.75?v*7.5625*h*h+
z:h<2/2.75?v*(7.5625*(h-=1.5/2.75)*h+0.75)+z:h<2.5/2.75?v*(7.5625*(h-=2.25/2.75)*h+0.9375)+z:v*(7.5625*(h-=2.625/2.75)*h+0.984375)+z},bounceinout:function(h,z,v,C){return h<C/2?A.bouncein(h*2,0,v,C)/2+z:A.bounceout(h*2-C,0,v,C)/2+v/2+z},cubicin:function(h,z,v,C){return v*(h/=C)*h*h+z},cubicout:function(h,z,v,C){return v*((h=h/C-1)*h*h+1)+z},cubicinout:function(h,z,v,C){if((h/=C/2)<1)return v/2*h*h*h+z;return v/2*((h-=2)*h*h+2)+z},elasticin:function(h,z,v,C,N,p){if(h==0)return z;if((h/=C)==1)return z+
v;p||(p=C*0.3);if(!N||N<D(v)){N=v;v=p/4}else v=p/TWO_PI*l(v/N);return-(N*w(2,10*(h-=1))*j((h*C-v)*TWO_PI/p))+z},elasticout:function(h,z,v,C,N,p){var s;if(h==0)return z;if((h/=C)==1)return z+v;p||(p=C*0.3);if(!N||N<D(v)){N=v;s=p/4}else s=p/TWO_PI*l(v/N);return N*w(2,-10*h)*j((h*C-s)*TWO_PI/p)+v+z},elasticinout:function(h,z,v,C,N,p){var s;if(h==0)return z;if((h/=C/2)==2)return z+v;p||(p=C*0.3*1.5);if(!N||N<D(v)){N=v;s=p/4}else s=p/TWO_PI*l(v/N);if(h<1)return-0.5*N*w(2,10*(h-=1))*j((h*C-s)*TWO_PI/p)+
z;return N*w(2,-10*(h-=1))*j((h*C-s)*TWO_PI/p)*0.5+v+z},quadin:function(h,z,v,C){return v*(h/=C)*h+z},quadout:function(h,z,v,C){return-v*(h/=C)*(h-2)+z},quadinout:function(h,z,v,C){if((h/=C/2)<1)return v/2*h*h+z;return-v/2*(--h*(h-2)-1)+z},sinein:function(h,z,v,C){return-v*x(h/C*Y)+v+z},sineout:function(h,z,v,C){return v*j(h/C*Y)+z},sineinout:function(h,z,v,C){return-v/2*(x(Math.PI*h/C)-1)+z}};COG.tweenValue=function(h,z,v,C,N){function p(S){var Q=S-s,fa=v(Q,h,B,C),aa=s+C<=S;S=!aa;if(N){Q=N(fa,aa,
Q);S=typeof Q!="undefined"?Q&&S:S}S&&animFrame(p)}var s=(new Date).getTime(),B=z-h;animFrame(p);return{}};COG.easing=function(h){return A[h.replace(/[\-\_\s\.]/g,"").toLowerCase()]};COG.registerEasingType=function(h,z){A[h.replace(/[\-\_\s\.]/g,"").toLowerCase()]=z}})();
(function(){var L=/^P(\d+Y)?(\d+M)?(\d+D)?$/,Y=/^(\d+H)?(\d+M)?(\d+S)?$/,D={8601:function(j){j=j.split("T");var l=null;l=null;var x=0,A=0;L.lastIndex=-1;l=L.exec(j[0]);x+=l[3]?parseInt(l[3].slice(0,-1),10):0;Y.lastIndex=-1;l=Y.exec(j[1]);A+=l[1]?parseInt(l[1].slice(0,-1),10)*3600:0;A+=l[2]?parseInt(l[2].slice(0,-1),10)*60:0;A+=l[3]?parseInt(l[3].slice(0,-1),10):0;return new w(x,A)}},w=COG.Duration=function(j,l){return{days:j?j:0,seconds:l?l:0}};COG.addDuration=function(){for(var j=new w,l=arguments.length;l--;){j.days+=
arguments[l].days;j.seconds+=arguments[l].seconds}if(j.seconds>=86400){j.days+=~~(j.seconds/86400);j.seconds%=86400}return j};COG.formatDuration=function(j){var l,x,A="";if(j.days)A=j.days+" days ";if(j.seconds){j=j.seconds;if(j>=3600){l=~~(j/3600);j-=l*3600}if(j>=60){x=Math.round(j/60);j-=x*60}if(l)A=A+l+(l>1?" hrs ":" hr ")+(x?(x>10?x:"0"+x)+" min ":"");else if(x)A=A+x+" min";else if(j>0)A=A+(j>10?j:"0"+j)+" sec"}return A};COG.parseDuration=function(j,l){var x=l?D[l]:null;if(x)return x(j);COG.Log.warn("Could not find duration parser for specified format: "+
l);return new w}})();
INTERACT=function(){function L(p){return function(s,B,S){(S?S:p?document.body:document).addEventListener(s,B,false)}}function Y(p){return function(s,B,S){(S?S:p?document.body:document).removeEventListener(s,B,false)}}function D(p,s,B){(B?B:document).attachEvent("on"+p,s)}function w(p,s,B){(B?B:document).detachEvent("on"+p,s)}function j(p,s){return{x:p?p:0,y:s?s:0,count:1}}function l(p,s){C.push(COG.extend({handler:null,checks:{},type:p},s))}function x(p){var s=0,B=0;if(p.offsetParent){do{s+=p.offsetLeft;
B+=p.offsetTop;p=p.offsetParent}while(p)}return{x:s,y:B}}function A(p,s){return{source:p,target:s.target?s.target:s.srcElement}}function h(p,s){for(var B=p.target?p.target:p.srcElement;B&&B!==s&&B.nodeName&&B.nodeName.toUpperCase()!="CANVAS";)B=B.parentNode;return B&&B===s}function z(p,s){return{x:p.x-(s?s.x:0),y:p.y-(s?s.y:0)}}function v(p){if(p.preventDefault){p.preventDefault();p.stopPropagation()}else p.cancelBubble&&p.cancelBubble()}var C=[],N=function(p,s,B){function S(O,T,R,J){var K=0,Z=0,
t=0;COG.tweenValue(0,O,R,J,function(W){t=K;K=W});COG.tweenValue(0,T,R,J,function(W){Q.trigger("pan",K-t,W-Z);Z=W})}B=COG.extend({binder:null,unbinder:null,observable:null},B);for(var Q=B.observable,fa=null,aa=[],U=[],ka,la,H={bind:function(){return Q.bind.apply(null,arguments)},pannable:function(O){fa=COG.extend({inertia:true},O);return H},unbind:function(){Q.unbind();for(var O=0;O<aa.length;O++)aa[O].unbind();return H}},ua=0;ua<s.length;ua++)aa.push(s[ua](p,Q,B));Q.bind("pointerDown",function(){U=
[];la=ka=0});Q.bind("pointerMove",function(O,T,R,J){if(fa){U[U.length]={ticks:(new Date).getTime(),x:J.x,y:J.y};Q.trigger("pan",J.x,J.y)}ka+=J.x?J.x:0;la+=J.y?J.y:0});Q.bind("pointerUp",function(O,T,R){if(Math.abs(ka)>20||Math.abs(la)>20){if(fa){R=U.length;var J,K;T=0;for(K=U.length;--K>1&&T<50;)T+=U[K].ticks-U[K-1].ticks;if(R-K>1){O=U[R-1].x-U[K].x;J=U[R-1].y-U[K].y;K=Math.sqrt(O*O+J*J)|0;if(K>15){O=U[R-1].x-U[0].x;J=U[R-1].y-U[0].y;K=Math.sqrt(O*O+J*J)|0;R=Math.asin(J/K);T=K*500/T|0;T=T>300?300:
T;S(Math.cos(O>0?R:Math.PI-R)*T,Math.sin(R)*T,COG.easing("sine.out"),500)}}}}else Q.trigger("tap",T,R)});return H};l("pointer",{handler:function(p,s,B){function S(t){if(h(t,p))if(ua=U(t)){p.style.cursor="move";v(t);K=t.pageX?t.pageX:t.screenX;Z=t.pageY?t.pageY:t.screenY;O=j(K,Z);T=x(p);s.triggerCustom("pointerDown",A("mouse",t),O,z(O,T))}}function Q(t){R=t.pageX?t.pageX:t.screenX;J=t.pageY?t.pageY:t.screenY;if(h(t,p))ka(t,ua?"pointerMove":"pointerHover")}function fa(t){if(ua&&U(t)){ua=false;if(h(t,
p)){p.style.cursor="default";ka(t,"pointerUp")}}}function aa(t){if(h(t,p)){var W;t=t||window.event;if(t.detail)W=t.axis===2?-t.detail*la:0;else{W=t.wheelDeltaY?t.wheelDeltaY:t.wheelDelta;if(window.opera)W=-W}if(W!==0){var ga=j(R,J);s.triggerCustom("zoom",A("mouse",t),ga,z(ga,x(p)),W/H,"wheel");v(t);t.returnValue=false}}}function U(t){t=t||window.event;return(t.which||t.button)==1}function ka(t,W,ga,oa,ra){ga=typeof ga!="undefined"?ga:R;oa=typeof oa!="undefined"?oa:J;var E=ga-K,P=oa-Z,M=j(ga,oa);T||
(T=x(p));s.triggerCustom(W,A("mouse",t),M,z(M,T),j(E,P));if(typeof ra=="undefined"||ra){K=ga;Z=oa}}B=COG.extend({},B);var la=120,H=la*8,ua=false,O,T,R,J,K,Z;B.binder("mousedown",S,false);B.binder("mousemove",Q,false);B.binder("mouseup",fa,false);B.binder("dblclick",function(t){COG.info("captured double click");if(h(t,p)){var W=j(t.pageX?t.pageX:t.screenX,t.pageY?t.pageY:t.screenY);COG.info("captured double click + target matched");s.triggerCustom("doubleTap",A("mouse",t),W,z(W,x(p)))}},false);B.binder("mousewheel",
aa,document);B.binder("DOMMouseScroll",aa,document);return{unbind:function(){B.unbinder("mousedown",S,false);B.unbinder("mousemove",Q,false);B.unbinder("mouseup",fa,false);B.unbinder("mousewheel",aa,document);B.unbinder("DOMMouseScroll",aa,document)}}},checks:{touch:false}});l("pointer",{handler:function(p,s,B){function S(E){if(E.count<2)return 0;var P=E.x-E.next.x;E=E.y-E.next.y;return~~Math.sqrt(P*P+E*E)}function Q(E,P,M){P=P?P:0;M=M?M:0;for(var pa={x:E.x-P,y:E.y-M,id:E.id,count:E.count},sa=pa;E.next;){E=
E.next;sa=sa.next={x:E.x-P,y:E.y-M,id:E.id}}return pa}function fa(E,P){var M=E[P?P:"touches"],pa,sa;if(M.length===0)return null;sa=pa={x:M[0].pageX,y:M[0].pageY,id:M[0].identifier,count:M.length};for(var va=1,La=M.length;va<La;va++)sa=sa.next={x:M[va].pageX,y:M[va].pageY,id:M[va].identifier};return pa}function aa(E){if(h(E,p)){J=x(p);var P=fa(E,"changedTouches"),M=Q(P,J.x,J.y);if(!Z){K=O;s.triggerCustom("pointerDown",A("touch",E),P,M)}oa&&s.triggerCustom("pointerDownMulti",A("touch",E),P,M);Z=fa(E);
if(Z.count>1)W=S(Z);ra=1;ga=Q(Z)}}function U(E){if(h(E,p)){E.preventDefault();t=fa(E);if(K==O)K=Math.abs(Z.x-t.x)>H||Math.abs(Z.y-t.y)>H?ua:O;if(K!=O){K=t.count>1?R:T;if(K==R)if(Z.count===1){Z=Q(t);W=S(Z)}else{var P=S(t);if(Math.abs(W-P)<la)K=T;else{var M;M=t.x;var pa=t.next.x,sa=t.y,va=t.next.y,La=sa<va?sa:va;M={x:(M<pa?M:pa)+(Math.abs(M-pa)>>1),y:La+(Math.abs(sa-va)>>1)};P=P/W;pa=P-ra;s.triggerCustom("zoom",A("touch",E),M,z(M,J),pa,"pinch");ra=P}}K==T&&s.triggerCustom("pointerMove",A("touch",E),
t,Q(t,J.x,J.y),j(t.x-ga.x,t.y-ga.y));oa&&s.triggerCustom("pointerMoveMulti",A("touch",E),t,Q(t,J.x,J.y))}ga=Q(t)}}function ka(E){if(h(E,p)){var P=fa(E,"changedTouches"),M=Q(P,J.x,J.y);t=fa(E);if(!t){K===O&&s.triggerCustom("tap",A("touch",E),P,M);s.triggerCustom("pointerUp",A("touch",E),P,M);Z=null}oa&&s.triggerCustom("pointerUpMulti",A("touch",E),P,M)}}B=COG.extend({detailed:false,inertia:false},B);var la=20,H=7,ua=0,O=1,T=2,R=3,J,K,Z,t,W,ga,oa=B.detailed,ra=1;B.binder("touchstart",aa,false);B.binder("touchmove",
U,false);B.binder("touchend",ka,false);COG.info("initialized touch handler");return{unbind:function(){B.unbinder("touchstart",aa,false);B.unbinder("touchmove",U,false);B.unbinder("touchend",ka,false)}}},checks:{touch:true}});return{register:l,watch:function(p,s,B){s=COG.extend({bindToBody:false,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},s);capabilities=COG.extend({touch:"ontouchstart"in window},B);if(!s.observable){COG.info("creating observable");s.observable=COG.observable({});
globalOpts=s}s.binder=s.isIE?D:L(s.bindToBody);s.unbinder=s.isIE?w:Y(s.bindToBody);B=s.types;for(var S=capabilities,Q=[],fa=C.length;fa--;){var aa=C[fa],U=!B||B.indexOf(aa.type)>=0,ka=true;for(var la in aa.checks){var H=aa.checks[la];COG.info("checking "+la+" capability. require: "+H+", capability = "+S[la]);ka=ka&&H===S[la]}if(U&&ka)Q[Q.length]=aa.handler}return new N(p,Q,s)}}}();
T5=function(){function L(){return(new Date).getTime()}function Y(){for(;t.length>0;){var b=t.shift();document.location=b}Z=0}function D(b){for(var m=true,d=W.length;d--;)m=m&&b!=W[d];return m}function w(b,m){var d=[];for(var a in m)a&&d.push(a+"="+escape(m[a]));return"tile5://"+b+"/"+(d.length>0?"?"+d.join("&"):"")}function j(b,m){D(b)&&COG.info("would push url: "+w(b,m))}function l(b,m){if(D(b)){t.push(w(b,m));Z||(Z=setTimeout(Y,100))}}function x(b){return function(m,d,a){(a?a:b?document.body:document).addEventListener(m,
d,false)}}function A(b){return function(m,d,a){(a?a:b?document.body:document).removeEventListener(m,d,false)}}function h(b,m,d){(d?d:document).attachEvent("on"+b,m)}function z(b,m,d){(d?d:document).detachEvent("on"+b,m)}function v(){R={base:{name:"Unknown",bindEvent:x(),unbindEvent:A(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:j,targetFps:null},ie:{name:"MSIE",regex:/msie/i,bindEvent:h,unbindEvent:z,
requireFastDraw:false,targetFps:25},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:l,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:l},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:l},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:x(true),unbindEvent:A(true),supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},bridgeNotify:l},
froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:l}};J=[R.froyo,R.android,R.ipod,R.iphone,R.ipad,R.ie]}function C(){R||v();if(!K){COG.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var b=0;b<J.length;b++){var m=J[b];if(m.regex&&m.regex.test(navigator.userAgent)){K=COG.extend({},R.base,m);COG.info("PLATFORM DETECTED AS: "+K.name);break}}if(!K){COG.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
K=R.base}COG.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return K}function N(){for(var b=0,m=arguments.length;m--;){var d=E[arguments[m].toUpperCase()];if(d)b|=d}return b}window.animFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b){setTimeout(function(){b((new Date).getTime())},1E3/60)}}();var p=Math.abs,s=Math.min,B=Math.max,S=Math.pow,
Q=Math.sqrt,fa=Math.log,aa=Math.round,U=Math.sin,ka=Math.asin,la=Math.cos,H=function(){function b(a,c){return d(a.x-c.x,a.y-c.y)}function m(a,c){if(!c)c=a.length;if(c<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var g={edges:Array(c-1),accrued:Array(c-1),total:0},f=0;f<c-1;f++){var n=b(a[f],a[f+1]);g.edges[f]=Q(n.x*n.x+n.y*n.y);g.accrued[f]=g.total+g.edges[f];g.total+=g.edges[f]}return g}function d(a,c){return{x:a?a:0,y:c?c:0}}return{VECTOR_SIMPLIFICATION:3,
SIMPLIFICATION_MIN_VECTORS:25,add:function(){for(var a=0,c=0,g=arguments.length;g--;){a+=arguments[g].x;c+=arguments[g].y}return d(a,c)},absSize:function(a){return B(p(a.x),p(a.y))},copy:function(a){return a?d(a.x,a.y):null},diff:b,distance:function(a,c){return m(a,c).total},edges:m,equals:function(a,c){return a.x===c.x&&a.y===c.y},extendBy:function(a,c,g){var f=la(c)*g;c=U(c)*g;return d(a.x-f,a.y-c)},floor:function(a){for(var c=Array(a.length),g=a.length;g--;)c[g]=d(~~a[g].x,~~a[g].y);return c},
getRect:function(a){for(var c,g,f,n,k=a.length;k--;){var i=a[k];c=typeof c==="undefined"||i.x<c?i.x:c;g=typeof g==="undefined"||i.y<g?i.y:g;f=typeof f==="undefined"||i.x>f?i.x:f;n=typeof n==="undefined"||i.y>n?i.y:n}return O.init(c,g,f,n)},init:d,invert:function(a){return d(-a.x,-a.y)},min:function(a,c){return d(a.x<c.x?a.x:c.x,a.y<c.y?a.y:c.y)},max:function(a,c){return d(a.x>c.x?a.x:c.x,a.y>c.y?a.y:c.y)},offset:function(a,c,g){return d(a.x+c,a.y+(g?g:c))},simplify:function(a,c){if(!a)return null;
c=c?c:H.VECTOR_SIMPLIFICATION;for(var g=[],f=null,n=a.length;n--;){var k=a[n];if(include=!f||n===0||p(k.x-f.x)+p(k.y-f.y)>c){g.unshift(k);f=k}}return g},theta:function(a,c,g){g=ka((a.y-c.y)/g);return a.x>c.x?g:Math.PI-g},toString:function(a){return a?a.x+", "+a.y:""}}}(),ua=function(){return{dotProduct:function(b,m){return b.x*m.x+b.y*m.y}}}(),O=function(){function b(d){return m(d.x1,d.y1,d.x2,d.y2)}function m(d,a,c,g){d=d?d:0;a=a?a:0;c=typeof c!=="undefined"?c:d;g=typeof g!=="undefined "?g:g;return{x1:d,
y1:a,x2:c,y2:g,width:c-d,height:g-a}}return{center:function(d){return H.init(d.x1+d.width/2,d.y1+d.height/2)},copy:b,diagonalSize:function(d){return Q(d.width*d.width+d.height*d.height)},fromCenter:function(d,a,c,g){c=c>>1;g=g>>1;return m(d-c,a-g,d+c,a+g)},init:m,intersect:function(d,a){var c=B(d.x1,a.x1),g=B(d.y1,a.y1),f=s(d.x2,a.x2),n=s(d.y2,a.y2);c=m(c,g,f,n);return c.width>0&&c.height>0?c:null},toString:function(d){return"["+d.x1+", "+d.y1+", "+d.x2+", "+d.y2+"]"},union:function(d,a){if(d.width===
0||d.height===0)return b(a);else if(a.width===0||a.height===0)return b(d);else{var c=s(d.x1,a.x1),g=s(d.y1,a.y1),f=B(d.x2,a.x2),n=B(d.y2,a.y2);c=m(c,g,f,n);return c.width>0&&c.height>0?c:null}}}}(),T=function(){return{getAspectRatio:function(b){return b.height!==0?b.width/b.height:1},getCenter:function(b){return H.init(b.width>>1,b.height>>1)},getSize:function(b){return Q(S(b.width,2)+S(b.height,2))},init:function(b,m){b=b?b:0;return{width:b,height:m?m:b}}}}(),R=null,J=[],K=null,Z=0,t=[],W=["view.wake",
"tile.loaded"],ga=function(){function b(){var e=C().maxImageLoads;if(!e||k.length<e)if(e=n.shift()){k[k.length]=e;e.image.onload=m;e.image.src=e.url;e.requested=T5.ticks()}}function m(){var e=g[this.id],y;if(e&&e.image.complete&&e.image.width>0){e.loaded=true;e.hitCount=1;for(y=k.length;y--;)if(k[y].image.src==this.src){k.splice(y,1);break}if(e.background||e.postProcess||e.drawBackground||e.customDraw)if(e.image){globalImageData=e;y=a(e.realSize?e.realSize.width:e.image.width,e.realSize?e.realSize.height:
e.image.height);var G=y.getContext("2d"),I=e.offset?e.offset:T5.XY.init();e.background&&G.drawImage(e.background,0,0);e.drawBackground&&e.drawBackground(G);e.customDraw?e.customDraw(G,e):G.drawImage(e.image,I.x,I.y);e.postProcess&&e.postProcess(G,e);e.image=y}for(y=e.callbacks.length;y--;)e.callbacks[y]&&e.callbacks[y](this,false);e.callbacks=[];i[i.length]={url:this.src,created:e.requested};delete g[this.id];b()}}function d(e,y,G){var I=c[e];if(I){I.hitCount++;I.image.complete&&I.image.width>0&&
y?y(I.image,true):I.callbacks.push(y)}else{I=COG.extend({url:e,image:new Image,loaded:false,created:T5.ticks(),requested:null,hitCount:0,callbacks:[y]},G);I.image.id="resourceLoaderImage"+f++;c[e]=I;g[I.image.id]=I;n[n.length]=I;b()}return I}function a(e,y){var G=document.createElement("canvas");COG.info("creating new canvas");G.width=e?e:0;G.height=y?y:0;if(typeof FlashCanvas!="undefined"){document.body.appendChild(G);FlashCanvas.initElement(G)}return G}var c={},g={},f=0,n=[],k=[],i=[],r={avgImageSize:25,
loadTimeout:10,cancelLoad:function(){var e;for(e=k.length;e--;)delete c[k[e].url];k=[];for(e=n.length;e--;)delete c[n[e].url];n=[]},get:function(e,y,G){var I=null;I=null;if((I=(I=c[e])?I.image:null)&&(I.getContext||I.complete&&I.width>0))return I;else y&&d(e,y,G);return null},load:d,newCanvas:a,reset:function(){c={}},stats:function(){return{imageLoadingCount:k.length,queuedImageCount:n.length,imageCacheFullness:0}}};COG.observable(r);return r}(),oa=function(){var b={};return{init:function(m,d){var a=
b[m];if(!a)throw Error("Unable to locate requested generator: "+m);return new a(d)},register:function(m,d){b[m]=d},Template:function(){}}}(),ra=function(){function b(f,n){c[f]=d(n);return f}function m(f){for(var n in f)b(n,f[n])}function d(f){function n(e){var y=f[e];typeof y!=="undefined"&&i.push(function(G){G[e]=y})}function k(){i=[];for(var e in f)n(e)}f=COG.extend({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,
globalCompositeOperation:undefined},f);var i=[],r={applyToContext:function(e){for(var y=i.length;y--;)i[y](e)},update:function(e,y){f[e]=y;k()}};k();return r}var a={},c={},g={apply:function(f,n){var k=c[n]?c[n]:c.basic,i;if(f&&f.canvas){i=a[f.canvas.id];a[f.canvas.id]=n}k.applyToContext(f);return i},define:b,defineMany:m,get:function(f){return c[f]},init:d,load:function(f){COG.jsonp(f,function(n){m(n)})}};m({basic:{lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"},waypoints:{lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",
fillStyle:"#FFF"}});return g}(),E={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,ZOOM:16,FREEZE:128},P=function(b){b=COG.extend({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:N("ACTIVE","ANIMATING","PAN","ZOOM"),style:null,minXY:null,maxXY:null},b);var m=null,d=false,a=false,c=b.id,g=N("ACTIVE"),f=b.validStates,n=0,k=0,i=COG.extend({addToView:function(r){r.setLayer(c,i)},shouldDraw:function(r){return(r&f)!==0},clip:null,cycle:function(){},draw:function(){},remove:function(){i.trigger("remove",
i)},changed:function(){a=true;m&&m.invalidate()},hitTest:null,getId:function(){return c},setId:function(r){c=r},getParent:function(){return m},setParent:function(r){d=(m=r)?m.fastDraw&&displayState!==g:false;i.trigger("parentChange",m)}},b);COG.observable(i);i.bind("drawComplete",function(r,e){a=false;n=e.x1;k=e.y1});i.bind("resync",function(r,e){if(e.syncXY){i.minXY&&e.syncXY(i.minXY);i.maxXY&&e.syncXY(i.maxXY)}});return i},M=function(b){function m(k,i,r,e){a=k;c=i;g=r;f=e}b=COG.extend({xy:H.init(),
offset:true,tweenIn:null,animationSpeed:null,isNew:true},b);var d=false,a=0,c=0,g=0,f=0,n=COG.extend(b,{isAnimating:function(){return d},draw:function(k,i,r,e,y){if(n.isNew&&b.tweenIn)COG.tweenValue(i.y1-20,n.xy.y,b.tweenIn,b.animationSpeed?b.animationSpeed:250+Math.random()*500,function(G,I){n.xy.y=G|0;d=!I;y.invalidate()});n.drawMarker(k,i,n.xy.x,n.xy.y,r,e,y);n.isNew=false},drawMarker:function(k,i,r,e){k.beginPath();k.arc(r,e,4,0,Math.PI*2,false);k.fill();m(r-4,e-4,8,8)},hitTest:function(k,i){return k>=
a&&k<=a+g&&i>=c&&i<=c+f},updateBounds:m});COG.observable(n);return n},pa=function(b){function m(){d();c.changed();c.trigger("markerUpdate",a)}function d(){var g=c.getParent();if(g&&g.syncXY)for(var f=a.length;f--;)g.syncXY([a[f].xy]);a.sort(function(n,k){var i=k.xy.y-n.xy.y;if(i==0)i=k.xy.x-n.xy.x;return i})}b=COG.extend({zindex:100,style:"basic"},b);var a=[],c=COG.extend(new P(b),{draw:function(g,f,n,k){for(var i=a.length;i--;)a[i].draw(g,f,n,c,k)},add:function(g){if(g&&typeof g.length!=="undefined")for(var f=
g.length;f--;){if(g[f])a[a.length]=g[f]}else if(g)a[a.length]=g;m()},clear:function(g){if(g)for(var f=0;f<a.length;)if(g(a[f]))a.splice(f,1);else f+=1;else a=[];m()},each:function(g){if(g)for(var f=a.length;f--;)g(a[f])},find:function(g){for(var f=[],n=a.length;n--;)if(!g||g(a[n]))f[f.length]=a[n];return f},hitTest:function(g,f){for(var n=[],k=a.length;k--;)if(a[k].hitTest(g,f))n[n.length]={type:"marker",data:a[k]};return n}});c.bind("tap",function(g,f,n,k){var i=[],r=k.x;k=k.y;for(var e=a.length;e--;)if(a[e].hitTest(r,
k))i[i.length]=a[e];if(i.length>0)g.cancel=c.trigger("markerTap",f,n,i).cancel});c.bind("parentChange",d);c.bind("resync",d);return c},sa=function(b){function m(k,i,r){k.fillStyle="#FFFFFF";k.strokeStyle="#222222";k.beginPath();k.arc(r.x,r.y,4,0,Math.PI*2,false);k.stroke();k.fill()}b=COG.extend({path:[],id:COG.objId("pathAni"),easing:COG.easing("sine.inout"),validStates:N("ACTIVE","PAN","ZOOM"),drawIndicator:null,duration:2E3},b);var d=H.edges(b.path),a,c=null,g=b.drawIndicator?b.drawIndicator:m,
f=0,n=COG.extend(new P(b),{cycle:function(){for(var k=0;k<d.accrued.length&&d.accrued[k]<f;)k++;c=null;if(k<b.path.length-1){var i=f-(k>0?d.accrued[k-1]:0),r=b.path[k];a=H.theta(r,b.path[k+1],d.edges[k]);c=H.extendBy(r,a,i)}return c},draw:function(k,i){c&&g&&g(k,i,H.init(c.x,c.y),a)}});COG.tweenValue(0,d.total,b.easing,b.duration,function(k,i){f=k;i&&n.remove();n.changed()});return n},va=function(b){b=COG.extend({style:null,properties:{}},b);return COG.extend(b,{rect:null,draw:function(){},resync:function(){}})},
La=function(){return{tileSize:256,init:function(b,m,d,a,c){return COG.extend({x:b,y:m,width:d,height:a},c)}}}(),Xa={ex:COG.extend,ticks:L,getConfig:C,userMessage:function(b,m,d){Xa.trigger("userMessage",b,m,d)},XY:H,XYRect:O,Dimensions:T,Vector:ua,D:T,Images:ga,Generator:oa,tween:COG.tween,tweenValue:COG.tweenValue,easing:COG.easing,Tween:COG.Tween,Style:ra,viewState:N,View:function(b){function m(o,q,u,F){qa=Pa;Qa(ba-q,ca-u,F?b.panAnimationEasing:null,F?b.panAnimationDuration:null);clearTimeout(jb);
jb=setTimeout(d,100)}function d(){qa=kb;wa()}function a(o,q,u,F){Ya(s(B(ha+S(2,F)-1,0.5),2))}function c(){var o=fa(ha)/Math.LN2>>0;if(o!==0){ha=S(2,o);lb(Ma+Math.log(ha)/Math.LN2,Ra,Sa)}wa()}function g(o){o||(o=H.init(Ba,Ca));Za=H.init(ba,ca);Na=H.offset(o,ba,ca);Ra=Na.x;Sa=Na.y}function f(o,q){var u,F;F=1/ha;if(ha!==1&&xa){u=xa.x1+o*F;F=xa.y1+q*F}else{u=o+ba;F=q+ca}return H.init(u,F)}function n(o,q,u){Ja("doubleTap",q,u,f(u.x,u.y));b.scalable&&Ya(2,u,b.zoomEasing,null,b.zoomDuration)}function k(o,
q,u){$a=null;y(q,u,f(u.x,u.y),"down")}function i(o,q,u){$a=f(u.x,u.y);y(q,u,$a,"hover")}function r(){clearTimeout(mb);mb=setTimeout(G,250)}function e(o,q,u){y(q,u,f(u.x,u.y),"tap");Ja("tap",q,u,f(u.x,u.y))}function y(o,q,u,F){for(var $=[],da=ta;da--;)if(V[da].hitTest)$=$.concat(V[da].hitTest(u.x,u.y,qa,ia));$.length>0&&ia.triggerCustom(F+"Hit",{hitType:F},$,o,q,u)}function G(o,q){var u;if(ja){if(b.autoSize&&ja.parentNode){o=ja.parentNode.offsetWidth;q=ja.parentNode.offsetHeight}try{if(!ja.id)ja.id=
b.id+"_canvas";X=ja.getContext("2d")}catch(F){COG.exception(F);throw Error("Could not initialise canvas on specified view element");}if(o&&q&&(ma!==q||na!==o)){ab=true;na=o;ma=q;Ba=na>>1;Ca=ma>>1;ia.trigger("resize",na,ma);for(u=ta;u--;)V[u].trigger("resize",na,ma)}for(u=ta;u--;)V[u].trigger("contextChanged",X);wa();ea()}}function I(o,q){q.setId(o);q.added=L();q.bind("remove",function(){ia.removeLayer(o)});q.trigger("contextChanged",X);q.setParent(ia);V.push(q);V.sort(function(u,F){var $=F.zindex-
u.zindex;if($===0)$=F.added-u.added;return $});ta=V.length;return q}function ea(){Da&&Da.unbind();Da=INTERACT.watch(ja);b.pannable&&Da.pannable().bind("pan",m);if(b.scalable){Da.bind("zoom",a);Da.bind("doubleTap",n)}if(b.captureHover){Da.bind("pointerDown",k);Da.bind("pointerHover",i)}Da.bind("tap",e)}function Ea(o){var q=Ta?ba+Ba:ba,u=Ua?ca+Ca:ca;if(ya&&ya>na)if(q+na>ya)ba=Ta?o&&q-ya>0?ba-ya:ba:ya-na;else if(q<0)ba=Ta?o?ba+ya:ba:0;if(za&&za>ma)if(u+ma>za)ca=Ua?o&&u-za>0?ca-za:ca:za-ma;else if(u<
0)ca=Ua?o?ca+za:ca:0}function Oa(o){var q,u=false;if(bb){if(o-nb>rb){qa=ha!==1?qa|cb:qa&~cb;db=(q=(qa&(cb|Pa))!==0)&&(qa&eb)===0;if(ab&&ja){typeof FlashCanvas!="undefined"&&FlashCanvas.initElement(ja);ja.width=na;ja.height=ma;ja.style.width=na+"px";ja.style.height=ma+"px";ab=false}if(ya||za)Ea();Va=Wa();for(var F=ta;F--;){if(V[F].animated)qa|=eb;V[F].cycle(o,Va,qa);V[F].shouldDraw(qa,Va);u=V[F].clip||u}F=qa;var $=Va;q=sb&&u&&!q;var da;O.center($);u=0;xa=O.copy($);xa.scaleFactor=ha;if(!q)if(!fb||o-
ob>tb){X.clearRect(0,0,na,ma);ob=o}X.save();try{if(ha!==1){var Fa=xa,Aa=1/ha;Ra=Na.x+(ba-Za.x);Sa=Na.y+(ca-Za.y);xa=Fa?O.fromCenter(Ra>>0,Sa>>0,Fa.width*Aa>>0,Fa.height*Aa>>0):void 0;X.scale(ha,ha)}X.translate(-xa.x1,-xa.y1);Ha=Ia=null;if(q&&!fb){X.beginPath();for(u=ta;u--;)V[u].clip&&V[u].clip(X,xa,F,ia,o);X.closePath();X.clip()}for(u=ta;u--;){da=V[u];X.globalCompositeOperation=fb&&da.zIndex<=0?"copy":"source-over";var Ga=da.style,Ka=Ga?ra.apply(X,Ga):null;if(da.minXY)Ia=Ia?H.min(Ia,da.minXY):H.copy(da.minXY);
if(da.maxXY)Ha=Ha?H.max(Ha,da.maxXY):H.copy(da.maxXY);da.draw(X,xa,F,ia,o);Ka&&ra.apply(X,Ka)}}finally{X.restore()}if(ub){X.globalCompositeOperation="source-over";X.strokeStyle="#f00";X.beginPath();X.moveTo(Ba,0);X.lineTo(Ba,ma);X.moveTo(0,Ca);X.lineTo(na,Ca);X.stroke()}bb=0;Ja("drawComplete",$,o);o-pb>vb&&gb();nb=o}animFrame(Oa)}else hb=false}function wa(){bb+=1;if(!hb){hb=true;animFrame(Oa)}}function Wa(){return O.init(ba,ca,ba+na,ca+ma)}function gb(){if(ya||za)Ea(true);pb=(new Date).getTime();
Ja("refresh",ia,Wa());wa()}function Ya(o,q,u,F,$){if(u)COG.tweenValue(ha,o,u,$,function(da,Fa){ha=da;if(Fa){var Aa=aa(fa(ha)/Math.LN2);ha=S(2,Aa);F&&F()}g(q);c()});else{ha=o;g(q);c()}return ia}function lb(o,q,u){o=B(b.minZoom,s(b.maxZoom,o));if(o!==Ma){var F=S(2,o-Ma),$=Ba/F|0,da=Ca/F|0;Ma=o;Qa(((q?q:ba+Ba)-$)*F,((u?u:ca+Ca)-da)*F);Ja("zoomLevelChange",o);ha=1;gb()}}function Ja(){for(var o=ia.trigger.apply(null,arguments).cancel,q=V.length;q--;)o=V[q].trigger.apply(null,arguments).cancel||o;return!o}
function Qa(o,q,u,F,$){function da(){Fa+=1;if(Fa>=2){d();$&&$()}}var Fa=0,Aa=Ia?H.offset(Ia,-Ba,-Ca):null,Ga=Ha?H.offset(Ha,-Ba,-Ca):null;if(Aa){o=o<Aa.x?Aa.x:o;q=q<Aa.y?Aa.y:q}if(Ga){o=o>Ga.x?Ga.x:o;q=q>Ga.y?Ga.y:q}if(u){if((qa&Pa)===0){COG.tweenValue(ba,o,u,F,function(Ka,ib){ba=Ka|0;(ib?da:wa)();return!db});COG.tweenValue(ca,q,u,F,function(Ka,ib){ca=Ka|0;(ib?da:wa)();return!db});qa=Pa|eb}}else{ba=o|0;ca=q|0;wa();$&&$()}}b=COG.extend({id:COG.objId("view"),container:"",captureHover:true,fastDraw:false,
inertia:true,minRefresh:1E3,pannable:true,clipping:true,scalable:true,panAnimationEasing:COG.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,autoSize:true,tapExtent:10,guides:false,turbo:false,fps:25,minZoom:1,maxZoom:1,zoomEasing:COG.easing("quad.out"),zoomDuration:300,zoomLevel:1},b);var tb=500,V=[],ta=0,ja=document.getElementById(b.container),X=null,wb=typeof window.attachEvent!="undefined",vb=b.minRefresh,$a=null,ba=0,ca=0,ya=null,za=null,Ta=false,Ua=false,sb=b.clipping,
Va=null,hb=false,xa,ub=b.guides,qb=1,Ba=0,Ca=0,Za=null,Na=null,db=false,jb=0,Ia=null,Ha=null,pb=0,ob=0,mb=0,ha=1,nb=0,ab=false,Da=null,fb=b.turbo,ma,na,rb=1E3/b.fps|0,bb=0,Ra,Sa,Ma=b.zoomLevel,kb=N("ACTIVE"),Pa=N("PAN"),cb=N("ZOOM"),eb=N("ANIMATING"),qa=kb,ia={id:b.id,deviceScaling:qb,fastDraw:b.fastDraw||C().requireFastDraw,getDimensions:function(){return T.init(na,ma)},getLayer:function(o){for(var q=0;q<ta;q++)if(V[q].getId()==o)return V[q];return null},getZoomLevel:function(){return Ma},setLayer:function(o,
q){for(var u=0;u<ta;u++)if(V[u].getId()===o){V.splice(u,1);break}if(q){I(o,q);q.trigger("refresh",ia,Wa())}wa();return q},eachLayer:function(o){for(var q=ta;q--;)o(V[q])},invalidate:wa,refresh:gb,resetScale:function(){ha=1},resize:function(o,q){if(ja){b.autoSize=false;if(na!==o||ma!==q)G(o,q)}},scale:Ya,setZoomLevel:lb,triggerAll:Ja,removeLayer:function(o){a:{for(var q=ta;q--;)if(V[q].getId()==o){o=q;break a}o=-1}if(o>=0&&o<ta){ia.trigger("layerRemoved",V[o]);V.splice(o,1);wa()}ta=V.length},getOffset:function(){return H.init(ba,
ca)},setMaxOffset:function(o,q,u,F){ya=o;za=q;Ta=typeof u!="undefined"?u:false;Ua=typeof F!="undefined"?F:false},getViewRect:Wa,updateOffset:Qa,pan:function(o,q,u,F,$){Qa(ba+o,ca+q,u,F,$)}};qb=C().getScaling();ia.markers=I("markers",new pa);COG.observable(ia);ia.bind("invalidate",function(){wa()});ia.bind("resync",function(){Ha=Ia=null});COG.configurable(ia,["container","scalable","pannable","inertia","minZoom","maxZoom","zoom"],COG.paramTweaker(b,null,{container:function(o,q){ja=document.getElementById(q);
G()},inertia:ea,scalable:ea,pannable:ea}),true);G();if(b.autoSize)wb?window.attachEvent("onresize",r):window.addEventListener("resize",r,false);return ia},ViewLayer:P,ImageLayer:function(b,m){function d(i,r,e){for(r=f.length;r--;){var y=f[r],G=y.x,I=y.y,ea=O.init(y.x,y.y,y.x+y.width,y.y+y.height);if(e&&O.intersect(i,ea))(ea=ga.get(y.url,function(){k.changed()},n))&&e(ea,G,I,y.width,y.height)}}function a(i){var r=++g,e=k.getParent();c&&c.run(e,i,function(y){if(r==g){f=[].concat(y);e.invalidate()}})}
m=COG.extend({imageLoadArgs:{}},m);var c=b?oa.init(b,m):null,g=0,f=[],n=m.imageLoadArgs,k=COG.extend(new P(m),{changeGenerator:function(i,r){c=oa.init(i,COG.extend({},m,r));f=null;a(k.getParent().getViewRect())},clip:function(i,r,e){d(r,e,function(y,G,I,ea,Ea){i.rect(G,I,ea,Ea)})},draw:function(i,r,e){d(r,e,function(y,G,I,ea,Ea){k.drawImage(i,y,G,I,ea,Ea,r,e)})},drawImage:function(i,r,e,y){r&&i.drawImage(r,e,y,r.width,r.height)}});k.bind("refresh",function(i,r,e){a(e)});k.bind("tap",function(i,r,
e,y){i=[];var G=y.x,I=y.y,ea,Ea;if(f)for(var Oa=f.length;Oa--;){ea=f[Oa];if(Ea=G>=ea.x&&G<=ea.x+ea.width&&I>=ea.y&&I<=ea.y+ea.height)i[i.length]=ea}i.length>0&&k.trigger("tapImage",i,r,e,y)});return k},ImageGenerator:function(b){b=COG.extend({relative:false,padding:2},b);b={run:function(){COG.warn("running base generator - this should be overriden")}};COG.observable(b);return b},Marker:M,ImageMarker:function(b){b=COG.extend({image:null,imageUrl:null,animatingImage:null,animatingImageUrl:null,imageAnchor:null,
rotation:0,scale:1,opacity:1},b);var m=b.imageAnchor?T5.XY.invert(b.imageAnchor):null,d=COG.extend(new M(b),{changeImage:function(a){d.image=ga.get(a,function(c){d.image=c})},drawMarker:function(a,c,g,f){if((c=d.isAnimating()&&d.animatingImage?d.animatingImage:d.image)&&c.width>0){m||(m=H.init(-c.width>>1,-c.height>>1));var n=d.scale,k=g+~~(m.x*n),i=f+~~(m.y*n),r=~~(c.width*n),e=~~(c.height*n);d.updateBounds(k,i,r,r);if(d.rotation||d.opacity!==1){a.save();try{a.globalAlpha=d.opacity;a.translate(g,
f);a.rotate(d.rotation);a.drawImage(c,m.x*n,m.y*n,r,e)}finally{a.restore()}}else a.drawImage(c,k,i,r,e)}}});if(!d.image)d.image=ga.get(b.imageUrl,function(a){d.image=a});if(!d.animatingImage)d.animatingImage=ga.get(b.animatingImageUrl,function(a){d.animatingImage=a});return d},MarkerLayer:pa,PathLayer:function(b){function m(){var i=k.getParent();if(i&&i.syncXY){i.syncXY(c);g&&i.syncXY(g);k.trigger("tidy")}}b=COG.extend({style:"waypoints",pixelGeneralization:8,zindex:50},b);var d=[],a=null,c=[],g=
null,f=0,n=[],k=COG.extend(new P(b),{getAnimation:function(i,r,e,y){var G="pathAnimation"+f++;n.push(G);return new sa({id:G,path:d,zindex:b.zindex+1,easing:i?i:COG.easing("sine.inout"),duration:r?r:5E3,drawIndicator:e,autoCenter:y?y:false})},draw:function(i){var r,e=d.length;i.save();try{ra.apply(i,b.style);if(e>0){i.beginPath();i.moveTo(d[e-1].x,d[e-1].y);for(r=e;r--;)i.lineTo(d[r].x,d[r].y);i.stroke();if(a){i.fillStyle=b.waypointFillStyle;for(r=a.length;r--;){i.beginPath();i.arc(a[r].x,a[r].y,2,
0,Math.PI*2,false);i.stroke();i.fill()}}}}finally{i.restore()}},updateCoordinates:function(i,r){c=i;g=r;m()}});k.bind("tidy",function(){d=H.simplify(c,b.pixelGeneralization);a=H.simplify(g,b.pixelGeneralization);k.changed(true)});k.bind("resync",m);return k},AnimatedPathLayer:sa,Shape:va,Arc:function(b,m){m=COG.extend({size:4},m);var d=H.init(),a=COG.extend(m,{draw:function(c){c.beginPath();c.arc(d.x,d.y,a.size,0,Math.PI*2,false);c.fill();c.stroke()},resync:function(c){c.syncXY([b]);d=H.floor([b])[0]}});
COG.info("created arc = ",b);return a},Poly:function(b,m){m=COG.extend({fill:false,simplify:false},m);var d=false,a=m.fill,c=m.simplify,g=N("ZOOM"),f=[],n=COG.extend(new va(m),{draw:function(k,i,r,e,y,G){if(d){i=true;r=(G&g)!==0;k.beginPath();for(G=f.length;G--;){r=f[G].x;e=f[G].y;if(i){k.moveTo(r,e);i=false}else k.lineTo(r,e);r=true}if(r){a&&k.fill();k.stroke()}}},resync:function(k){n.xy=k.syncXY(b);f=H.floor(c?H.simplify(b):b)}});d=b&&b.length>=2;return n},ShapeLayer:function(b){function m(g){for(var f=
a.length;f--;)a[f].resync(g);a.sort(function(n,k){var i=k.xy.y-n.xy.y;if(i===0)i=k.xy.x-n.xy.y;return i});c.changed()}function d(g,f){f.syncXY&&m(f)}b=COG.extend({zindex:80},b);var a=[],c=COG.extend(new P(b),{add:function(g){a[a.length]=g},each:function(g){for(var f=a.length;f--;)g(a[f])},draw:function(g,f,n){var k=f.x1,i=f.y1,r=f.width;f=f.height;for(var e=a.length;e--;){var y=a[e].style;y=y?ra.apply(g,y):null;a[e].draw(g,k,i,r,f,n);y&&ra.apply(g,y)}}});c.bind("parentChange",d);c.bind("resync",d);
return c},Tiling:La};COG.observable(Xa);return Xa}();
