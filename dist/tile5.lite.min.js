COG=function(){var f=/\$\{(.*?)\}/ig,l=Object.prototype.hasOwnProperty,h=0,e={id:"grunt.core",extend:function(){var a=arguments[0]||{},d=1,c=arguments.length,b=false,m,g,j,i;if(typeof a==="boolean"){b=a;a=arguments[1]||{};d=2}if(typeof a!=="object"&&!e.isFunction(a))a={};if(c===d){a=this;--d}for(;d<c;d++)if((m=arguments[d])!=null)for(g in m){j=a[g];i=m[g];if(a!==i)if(b&&i&&(e.isPlainObject(i)||e.isArray(i))){j=j&&(e.isPlainObject(j)||e.isArray(j))?j:e.isArray(i)?[]:{};a[g]=e.extend(b,j,i)}else if(i!==
undefined)a[g]=i}return a},isFunction:function(a){return toString.call(a)==="[object Function]"},isArray:function(a){return toString.call(a)==="[object Array]"},isPlainObject:function(a){if(!a||toString.call(a)!=="[object Object]"||a.nodeType||a.setInterval)return false;if(a.constructor&&!l.call(a,"constructor")&&!l.call(a.constructor.prototype,"isPrototypeOf"))return false;var d;for(d in a);return d===undefined||l.call(a,d)},isEmptyObject:function(a){for(var d in a)return false;return true},isXmlDocument:function(a){return toString.call(a)===
"[object Document]"},contains:function(a,d){var c=a,b=arguments,m=1;if(d&&e.isArray(d)){b=d;m=0}for(m=m;m<b;m++)c=c&&typeof foo[b[m]]!=="undefined";return c},newModule:function(a){a=e.extend({id:null,requires:[],parent:null},a);if(a.parent)a=e.extend({},a.parent,a);return a},toID:function(a){return a.replace(/\s/g,"-")},objId:function(a){return(a?a:"obj")+h++},formatStr:function(a){if(arguments.length<=1)return a;for(var d=arguments.length-2,c=0;c<=d;c++)a=a.replace(RegExp("\\{"+c+"\\}","gi"),arguments[c+
1]);return a},wordExists:function(a,d){var c="";if(d.toString)d=d.toString();for(var b=0;b<d.length;b++)c+=!/\w/.test(d[b])?"\\"+d[b]:d[b];return RegExp("(^|\\s|\\,)"+c+"(\\,|\\s|$)","i").test(a)},parseTemplate:function(a,d){for(var c=f.exec(a);c;){a=a.replace(c[0],COG.XPath.first(c[1],d));f.lastIndex=0;c=f.exec(a)}return a}};return e}();
COG.Log=function(){function f(d,c){var b,m=c&&c.length>0?c[0]:"";for(b=1;c&&b<c.length;b++)m+=" "+(h&&COG.isPlainObject(c[b])?JSON.stringify(c[b]):c[b]);typeof console!=="undefined"&&console[d](m);for(b=0;b<l.length;b++)l[b].call(a,m,d)}var l=[],h=typeof JSON!=="undefined",e=window.console&&window.console.markTimeline,a={id:"grunt.log",getTraceTicks:function(){return e?(new Date).getTime():null},trace:function(d,c){if(e)console.markTimeline(d+(c?": "+(a.getTraceTicks()-c)+"ms":""))},debug:function(){f("debug",
arguments)},info:function(){f("info",arguments)},warn:function(){f("warn",arguments)},error:function(){f("error",arguments)},exception:function(d){a.error(arguments);for(var c in d)a.info("ERROR DETAIL: "+c+": "+d[c])},watch:function(d,c){try{c()}catch(b){a.exception(b,d)}},throwError:function(d){a.error(d);throw Error(d);},requestUpdates:function(d){l.push(d)}};return a}();
(function(){function f(e,a){e[a]||(e[a]=function(d){return e.configure(a,d)})}function l(e){e.gtConfId=COG.objId("configurable");e.gtConfig={};e.gtConfigFns=[];return e.gtConfig}var h={};COG.paramTweaker=function(e,a,d){return function(c,b){if(typeof b!=="undefined"){if(c in e)e[c]=b;d&&c in d&&d[c](c,b)}else return a&&c in a?a[c](c):e[c]}};COG.configurable=function(e,a,d,c){if(e){e.gtConfId||l(e);var b=e.gtConfId,m=e.gtConfig,g=e.gtConfigFns;h[b]=e;g.push(d);for(d=a.length;d--;){m[a[d]]=true;c&&
f(e,a[d])}if(!e.configure)e.configure=function(j,i){if(m[j]){for(var k=g.length;k--;){var t=g[k](j,i);if(typeof t!=="undefined")return t}return h[b]}return null}}}})();
(function(){function f(l,h){var e=l.gtObsHandlers;e[h]||(e[h]=[]);return e[h]}COG.observable=function(l){if(l){if(!l.gtObsHandlers)l.gtObsHandlers={};if(!(l.bind||l.trigger||l.unbind)){l.bind=function(h,e){var a=COG.objId("callback");f(l,h).unshift({fn:e,id:a});return a};l.trigger=function(h){var e=f(l,h),a={cancel:false,tickCount:Date.now()},d;if(!e)return null;d=Array.prototype.slice.call(arguments,1);d.unshift(a);for(var c=e.length;c--&&!a.cancel;)e[c].fn.apply(self,d);return a};l.unbind=function(h,
e){for(var a=f(l,h),d=0;a&&d<a.length;d++)if(a[d].id===e){a.splice(d,1);break}return l}}}}})();(function(){var f={},l=[];COG.addPipe=function(h){h("pipe.test",{});l.push(h)};COG.listen=function(h,e){f[h]||(f[h]=[]);e&&f[h].push(e)};COG.say=function(h,e){var a;for(a=l.length;a--;)l[a](h,e);if(f[h])for(a=f[h].length;a--;)f[h][a](e)}})();
COG.Loopage=function(){function f(i){return COG.extend({id:d++,frequency:0,after:0,single:false,lastTick:0,execute:function(){}},i)}function l(i){b.push(i);h()}function h(){m&&clearTimeout(m);m=setTimeout(e,0);j=true}function e(){for(var i,k=(new Date).getTime(),t=c.length;b.length>0;){var x=b.shift();for(i=t;i--;)if(c[i].id===x){c.splice(i,1);break}j=true;t=c.length}if(j){g=a;for(i=t;i--;)g=c[i].frequency<g?c[i].frequency:g}for(i=t;i--;){x=k-c[i].lastTick;if(c[i].lastTick===0||x>=c[i].frequency){c[i].execute(k,
c[i]);c[i].lastTick=k;c[i].single&&c[i].trigger("complete")}}m=t?setTimeout(e,g):0}var a=6E4,d=0,c=[],b=[],m=0,g=a,j=true;return{join:function(i){var k=new f(i);if(k.after>0)k.lastTick=(new Date).getTime()+k.after;COG.observable(k);k.bind("complete",function(){l(k.id)});c.unshift(k);h();return k},leave:l}}();if(!this.JSON)this.JSON={};
(function(){function f(g){return g<10?"0"+g:g}function l(g){a.lastIndex=0;return a.test(g)?'"'+g.replace(a,function(j){var i=b[j];return typeof i==="string"?i:"\\u"+("0000"+j.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+g+'"'}function h(g,j){var i,k,t,x,p=d,s,q=j[g];if(q&&typeof q==="object"&&typeof q.toJSON==="function")q=q.toJSON(g);if(typeof m==="function")q=m.call(j,g,q);switch(typeof q){case "string":return l(q);case "number":return isFinite(q)?String(q):"null";case "boolean":case "null":return String(q);
case "object":if(!q)return"null";d+=c;s=[];if(Object.prototype.toString.apply(q)==="[object Array]"){x=q.length;for(i=0;i<x;i+=1)s[i]=h(i,q)||"null";t=s.length===0?"[]":d?"[\n"+d+s.join(",\n"+d)+"\n"+p+"]":"["+s.join(",")+"]";d=p;return t}if(m&&typeof m==="object"){x=m.length;for(i=0;i<x;i+=1){k=m[i];if(typeof k==="string")if(t=h(k,q))s.push(l(k)+(d?": ":":")+t)}}else for(k in q)if(Object.hasOwnProperty.call(q,k))if(t=h(k,q))s.push(l(k)+(d?": ":":")+t);t=s.length===0?"{}":d?"{\n"+d+s.join(",\n"+d)+
"\n"+p+"}":"{"+s.join(",")+"}";d=p;return t}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
a=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,d,c,b={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},m;if(typeof JSON.stringify!=="function")JSON.stringify=function(g,j,i){var k;c=d="";if(typeof i==="number")for(k=0;k<i;k+=1)c+=" ";else if(typeof i==="string")c=i;if((m=j)&&typeof j!=="function"&&(typeof j!=="object"||typeof j.length!=="number"))throw Error("JSON.stringify");return h("",
{"":g})};if(typeof JSON.parse!=="function")JSON.parse=function(g,j){function i(t,x){var p,s,q=t[x];if(q&&typeof q==="object")for(p in q)if(Object.hasOwnProperty.call(q,p)){s=i(q,p);if(s!==undefined)q[p]=s;else delete q[p]}return j.call(t,x,q)}var k;g=String(g);e.lastIndex=0;if(e.test(g))g=g.replace(e,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(g.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){k=eval("("+g+")");return typeof j==="function"?i({"":k},""):k}throw new SyntaxError("JSON.parse");}})();
(function(){function f(h,e){var a=h.split("|"),d={};for(var c in e){var b=e[c];d[c]=a.length>b?a[b]:null}return d}var l={JSON:{parse:function(h){return JSON.parse(h)}},PDON:{parse:function(h){var e=null,a=[];h=h.split("\n");for(var d=0;d<h.length;d++){var c=h[d];if(e)a.push(f(c,e));else if(c){e=c.split("|");c={};for(var b=0;b<e.length;b++)c[e[b]]=b;e=c}else e=null}return a}}};COG.parseData=function(h,e){e=e?e.toUpperCase():"JSON";if(!l[e])throw Error("Unsupported data format: "+e);try{return l[e].parse(h)}catch(a){COG.Log.exception(a)}return{}}})();
COG.XPath=function(){function f(a){for(var d=null,c=0;c<l.length;c++)if(d=l[c](a))break;return d}var l=[],h=[null,function(a){return a.numberValue},function(a){return a.stringValue},function(a){return a.booleanValue},null,null,null,null,function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null},function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||COG.Log.warn("No XPATH support");var e={SearchResult:function(a){return{toString:function(){var d=
null;if(a){var c=null;if(a.resultType>=0&&a.resultType<h.length)c=h[a.resultType];if(c)d=c(a)}return d?d:""}}},first:function(a,d){var c=e.SearchResult,b;var m=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!m)m=XPathResult.ANY_TYPE;try{if(COG.isXmlDocument(d))b=d.evaluate(a,d,f,m,null);else{COG.Log.warn("attempted xpath expression: "+a+" on a non-xml document");b=null}}catch(g){COG.Log.warn("invalid xpath expression: "+a+" on node: "+d);b=null}return new c(b)},registerResolver:function(a){l.push(a)}};return e}();
COG.Storage=function(){function f(l){if(l&&l=="session")return sessionStorage;return localStorage}return{get:function(l,h){var e=f(h).getItem(l);return/^(\{|\[).*(\}|\])$/.test(e)?JSON.parse(e):e},set:function(l,h,e){h=jQuery.isArray(h)||jQuery.isPlainObject(h)?JSON.stringify(h):h;f(e).setItem(l,h)},remove:function(l,h){f(h).removeItem(l)}}}();
COG.ParseRules=function(){var f=[];return{add:function(l,h){f.push({regex:l,handler:h})},each:function(l,h,e){function a(){d++;e&&d>=f.length&&e(h)}for(var d=0,c=0;c<f.length;c++){var b=f[c].regex,m=f[c].handler,g=false;if(b){b.lastIndex=-1;if((b=b.exec(l))&&m){g=true;m(b,h,a)&&a()}}g||a()}}}};
(function(){function f(b){var m=[],g=function(i,k){k=COG.isFunction(k)?k():k;m[m.length]=encodeURIComponent(i)+"="+encodeURIComponent(k)};if(COG.isArray(b))for(var j=0;j<b.length;j++)g(b[j].name,b[j].value);else for(j in b)g(j,b[j]);return m.join("&").replace(/%20/g,"+")}var l={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},h={JSON:["json"],PDON:["pdon.txt"]},e=["TEXT","STREAM"],a=/^(\w+:)?\/\/([^\/?#]+)/,d={XML:function(b){return b.responseXML},JSON:function(b){return COG.parseData(b.responseText)},
PDON:function(b){return COG.parseData(b.responseText,"PDON")},DEFAULT:function(b){return b.responseText}},c={CONTENT_TYPE:"Content-Type"};COG.xhr=function(b){function m(){if(this.readyState===4){var k=null,t=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(t)if(b.handleResponse)b.handleResponse(this);else{var x=b,p=this.getResponseHeader(c.CONTENT_TYPE),s,q=false;for(s in l)if(p&&p.indexOf(l[s])>=0){q=true;
break}p=!q;for(q=0;q<e.length;q++)p=p||e[q]==s;if(p)b:{p=s;for(var w in h)for(q=0;q<h[w].length;q++)if(RegExp(h[w][q]+"$","i").test(x.url)){s=w;break b}s=p?p:"DEFAULT"}try{k=d[s](this,x)}catch(E){k=d.DEFAULT(this,x)}}else b.error&&b.error(this)}catch(S){COG.Log.exception(S,"PROCESSING AJAX RESPONSE")}t&&k&&b.success&&b.success.call(this,k)}}try{b=COG.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},b);var g=
a.exec(b.url),j=g&&(g[1]&&g[1]!==location.protocol||g[2]!==location.host);if(b.data)b.method="POST";if(b.url){g=null;if(b.xhr)g=b.xhr(b);g||(g=new XMLHttpRequest);g.open(b.method,b.url,b.async);b.data&&g.setRequestHeader("Content-Type",b.contentType);j||g.setRequestHeader("X-Requested-With","XMLHttpRequest");g.onreadystatechange=m;g.send(b.method=="POST"?f(b.data):null)}else COG.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(i){COG.Log.exception(i)}}})();
(function(){function f(a){var d=document.createElement("script"),c=false;d.src=a;d.async=true;d.onload=d.onreadystatechange=function(){if(!c&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){c=true;d.onload=d.onreadystatechange=null;d&&d.parentNode&&d.parentNode.removeChild(d)}};h||(h=document.getElementsByTagName("head")[0]);h.appendChild(d)}var l=0,h,e=this;COG.jsonp=function(a,d,c){a+=a.indexOf("?")>=0?"&":"?";var b="json"+ ++l;e[b]=function(m){d(m);e[b]=null;try{delete e[b]}catch(g){}};
f(a+(c?c:"callback")+"="+b);return b}})();
COG.Touch=function(){function f(v,r){return{x:v.x-r.x,y:v.y-r.y}}function l(v,r){var y=f(v,r);return Math.sqrt(y.x*y.x+y.y*y.y)}function h(v){if(v.count>1)return l(v.touches[0],v.touches[1]);return 0}function e(v,r){var y=v&&v.count>0?v.touches[0]:null;if(y&&r&&r.count>0)return f(y,r.touches[0]);return null}function a(v,r){v.count=r.count;for(var y=g;y--;){v.touches[y].x=r.touches[y].x;v.touches[y].y=r.touches[y].y}}function d(){for(var v={count:0,touches:Array(g)},r=g;r--;)v.touches[r]=m();return v}
function c(v){if(v.preventDefault){v.preventDefault();v.stopPropagation()}else v.cancelBubble&&v.cancelBubble()}function b(v,r,y){if(C){r=r[y?y:"touches"];y=r.length;for(y=v.count=y;y--;){v.touches[y].x=r[y].pageX;v.touches[y].y=r[y].pageY}}else if(r.button===0){v.count=1;v.touches[0].x=r.pageX?r.pageX:r.screenX;v.touches[0].y=r.pageY?r.pageY:r.screenY}else v.count=0}function m(v,r){return{x:v?v:0,y:r?r:0}}var g=10,j=120,i=100,k=250,t=300,x=5,p=0,s=1,q=2,w=7,E=0,S=0,C=undefined,W=function(v){function r(n,
o,u,z){var G=Math.asin((n.y-o.y)/u);u=u*(ka/z)>>0;u=u>ia?ia:u;G=o.x>n.x?G:Math.PI-G;A("pan",Math.cos(G)*-u,Math.sin(G)*u,true)}function y(n,o){var u,z;if(C){u=o-ea;if(u<k){z=l(I.touches[0],n);z>v.inertiaTrigger&&r(I.touches[0],n,z,u)}}else{X.x=n.x;X.y=n.y;COG.Loopage.join({execute:function(G,P){u=G-o;z=l(n,X);if(u<i&&z>v.inertiaTrigger){P.trigger("complete");r(n,X,z,u)}else u>i&&P.trigger("complete")},frequency:10})}}function B(n){var o=0,u=0;if(n.offsetParent){do{o+=n.offsetLeft;u+=n.offsetTop;n=
n.offsetParent}while(n)}return m(o,u)}function D(n){var o=n.count,u=Array(o),z=B(Y);for(o=o;o--;)u[o]=m(n.touches[o].x-z.x,n.touches[o].y-z.y);return u}function A(){ma&&ma.trigger.apply(null,arguments)}function F(n){var o=n.target?n.target:n.srcElement;if(ja||o&&o===Y){b(I,n);if(I.count!==0){ca=null;da.x=0;da.y=0;ha=true;L=false;ea=(new Date).getTime();c(n);o.style.cursor="move";A("inertiaCancel");fa=ea;if(n=I.count>0?I.touches[0]:null){A("touchStart",n.x,n.y);if(fa-T<t)if((n=f(I.touches[0],Z.touches[0]))&&
Math.abs(n.x)<v.maxDistDoubleTap&&Math.abs(n.y)<v.maxDistDoubleTap)L=true;V=p;a(Z,I)}else COG.Log.warn("Touch start fired, but no touch vector found")}}}function Q(n){var o=n.target?n.target:n.srcElement,u=0;if(ja||o&&o===Y){b(N,n);if(N.count>0){X.x=N.touches[0].x;X.y=N.touches[0].y}if(ha){C&&c(n);if(N.count>1){I.count===1&&a(I,N);u=h(I)-h(N)}if(V===p)if((n=e(N,I))&&(Math.abs(n.x)>=w||Math.abs(n.y)>=w))V=s;if(V!==p)if(!u||Math.abs(u)<x){if(ca=e(N,Z)){da.x-=ca.x;da.y-=ca.y;J.x-=ca.x;J.y-=ca.y}A("pan",
J.x,J.y);J.x=0;J.y=0;V=s}else{A("pinchZoom",D(I),D(N));V=q}a(Z,N)}}}function H(n){var o=n.target?n.target:n.srcElement;if(ha&&(ja||o&&o===Y)){b($,n,"changedTouches");var u=$.touches[0];C&&c(n);n=(new Date).getTime();T=fa;if(V===p)U||(U=setTimeout(function(){U=0;var z=L?"doubleTap":"tap",G=I.touches[0],P=B(Y);P=m(G.x-P.x,G.y-P.y);A(z,G,P)},t+50));else if(V==s){A("panEnd",da.x,da.y);la&&y(u,n)}else V==q&&A("pinchZoomEnd",D(I),D(Z),n-ea);o.style.cursor="default";ha=false}}function K(n){var o=n.target?
n.target:n.srcElement;if(ja||o&&o===Y){if(n.detail){o=-n.detail*j;o=m(n.axis===1?o:0,n.axis===2?o:0)}else o=m(n.wheelDeltaX,n.wheelDeltaY);var u=o.y!==0?Math.abs(o.y/j):0;if(X&&u!==0){var z=m(X.x-Y.offsetLeft,X.y-Y.offsetTop);A("wheelZoom",z,Math.pow(2,o.y>0?u:-u))}c(n)}}v=COG.extend({element:null,observable:null,inertiaTrigger:20,maxDistDoubleTap:20,touchStartHandler:null,moveHandler:null,moveEndHandler:null,pinchZoomHandler:null,pinchZoomEndHandler:null,tapHandler:null,doubleTapHandler:null,wheelZoomHandler:null},
v);var L=false,U=0,O=T5.getConfig(),I=d(),N=d(),Z=d(),$=d(),ca=null,da=m(),J=m(),V=null,ha=false,ea=0,aa=[],X=m(),la=false,ka,ia,fa=0,T=0,Y=v.element,ma=v.observable,ja=typeof FlashCanvas!=="undefined",M={supportsTouch:C,addListeners:function(n){aa.push(n)},decoupleListeners:function(n){for(var o=0;n&&o<aa.length;o++)if(aa[o].listenerId===n){aa.splice(o,1);break}},release:function(){O.unbindEvent(C?"touchstart":"mousedown",F,false);O.unbindEvent(C?"touchmove":"mousemove",Q,false);O.unbindEvent(C?
"touchend":"mouseup",H,false);if(!C){window.removeEventListener("mousewheel",K,false);window.removeEventListener("DOMMouseScroll",K,false)}},inertiaEnable:function(n,o){la=true;ka=n;ia=o?Math.min(o.width,o.height):500},inertiaDisable:function(){la=false}};if(typeof C==="undefined")C=T5.getConfig().supportsTouch;O.bindEvent(C?"touchstart":"mousedown",F,false);O.bindEvent(C?"touchmove":"mousemove",Q,false);O.bindEvent(C?"touchend":"mouseup",H,false);if(!C){O.bindEvent("mousewheel",K,window);O.bindEvent("DOMMouseScroll",
K,window)}return M},R=[];return{capture:function(v,r){if(!v)throw Error("Unable to capture touch of null element");if(!v.id)v.id="touchable_"+E++;var y=R[v.id];if(!y){y=new W(COG.extend({element:v},r));R[v.id]=y}if(r){r.listenerId&&y.decoupleListeners(r.listenerId);r.listenerId=++S;y.addListeners(r)}return y},release:function(v){if(v&&v.id&&R[v.id]){R[v.id].release();delete R[v.id]}}}}();
T5=function(){var f=function(c,b){return{x:c?c:0,y:b?b:0}},l=function(){function c(b,m){if(!m)m=b.length;if(m<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var g={edges:Array(m-1),accrued:Array(m-1),total:0},j=l.diff,i=0;i<m-1;i++){var k=j(b[i],b[i+1]);g.edges[i]=Math.sqrt(k.x*k.x+k.y*k.y);g.accrued[i]=g.total+g.edges[i];g.total+=g.edges[i]}return g}return{VECTOR_SIMPLIFICATION:4,create:function(b,m){return new f(b,m)},add:function(){for(var b=new f,m=
arguments.length;m--;){b.x+=arguments[m].x;b.y+=arguments[m].y}return b},absSize:function(b){return Math.max(Math.abs(b.x),Math.abs(b.y))},diff:function(b,m){return new f(b.x-m.x,b.y-m.y)},copy:function(b){return b?new f(b.x,b.y):null},invert:function(b){return new f(-b.x,-b.y)},offset:function(b,m,g){return new f(b.x+m,b.y+(g?g:m))},edges:c,distance:function(b,m){return c(b,m).total},simplify:function(b,m){if(!b)return null;m=m?m:l.VECTOR_SIMPLIFICATION;for(var g=[],j=null,i=b.length;i--;){var k=
b[i];if(include=!j||i===0||Math.abs(k.x-j.x)+Math.abs(k.y-j.y)>m){g.unshift(k);j=k}}return g},theta:function(b,m,g){g=Math.asin((b.y-m.y)/g);return b.x>m.x?g:Math.PI-g},pointOnEdge:function(b,m,g,j){m=new f(Math.cos(g)*j,Math.sin(g)*j);return new f(b.x-m.x,b.y-m.y)},getRect:function(b){var m=b.length;if(m>1)return new h(Math.min(b[0].x,b[m-1].x),Math.min(b[0].y,b[m-1].y),Math.abs(b[0].x-b[m-1].x),Math.abs(b[0].y-b[m-1].y))},toString:function(b){return b.x+", "+b.y}}}(),h=function(c,b,m,g){return{origin:new f(c,
b),dimensions:new a(m,g),invalid:false}},e=function(){return{bottomRight:function(c){return l.offset(c.origin,c.dimensions.width,c.dimensions.height)},empty:function(){return new h(0,0,0,0)},copy:function(c){return c?new h(c.origin.x,c.origin.y,c.dimensions.width,c.dimensions.height):null},getCenter:function(c){return new f(c.origin.x+c.dimensions.width/2,c.origin.y+c.dimensions.height/2)},isEmpty:function(c){return c.dimensions.width===0||c.dimensions.height===0},union:function(){if(!(arguments.length<
2)){for(var c=arguments[0].origin.y,b=arguments[0].origin.x,m=c+arguments[0].dimensions.height,g=b+arguments[0].dimensions.width,j=Array.prototype.slice.call(arguments,1),i=j.length;i--;){var k=j[i].origin.y,t=j[i].origin.x,x=k+j[i].dimensions.height,p=t+j[i].dimensions.width;c=c<k?c:k;b=b<t?b:t;m=m>x?m:x;g=g>p?g:p}arguments[0].origin.x=b;arguments[0].origin.y=c;arguments[0].dimensions.width=g-b;arguments[0].dimensions.height=m-c}}}}(),a=function(c,b){return{width:c?c:0,height:b?b:0}},d=function(){return{getAspectRatio:function(c){return c.height!==
0?c.width/c.height:1},getCenter:function(c){return new f(c.width/2,c.height/2)},getSize:function(c){return Math.sqrt(Math.pow(c.width,2)+Math.pow(c.height,2))}}}();return{ex:COG.extend,Vector:f,V:l,Dimensions:a,D:d,Rect:h,R:e}}();
(function(){function f(){for(;x.length>0;){var s=x.shift();document.location=s}t=0}function l(s){for(var q=true,w=p.length;w--;)q=q&&s!=p[w];return q}function h(s,q){var w=[];for(var E in q)E&&w.push(E+"="+escape(q[E]));return"tile5://"+s+"/"+(w.length>0?"?"+w.join("&"):"")}function e(s,q){l(s)&&COG.Log.info("would push url: "+h(s,q))}function a(s,q){if(l(s)){x.push(h(s,q));t||(t=setTimeout(f,100))}}function d(s){return function(q,w,E){(E?E:s?document.body:document).addEventListener(q,w,false)}}function c(s){return function(q,
w,E){(E?E:s?document.body:document).removeEventListener(q,w,false)}}function b(s,q,w){(w?w:document).attachEvent("on"+s,q)}function m(s,q,w){(w?w:document).detachEvent("on"+s,q)}function g(){j={base:{name:"Unknown",bindEvent:d(),unbindEvent:c(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:e,targetFps:null},ie:{name:"MSIE",regex:/msie/i,bindEvent:b,unbindEvent:m,requireFastDraw:false,targetFps:25},
ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:a,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:a},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:a},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:d(true),unbindEvent:c(true),supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},bridgeNotify:a},froyo:{name:"Android OS >= 2.2",
regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:a}};i=[j.froyo,j.android,j.ipod,j.iphone,j.ipad,j.ie]}var j=null,i=[],k=null,t=0,x=[],p=["view.wake","tile.loaded"];T5.getConfig=function(){j||g();if(!k){COG.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var s=0;s<i.length;s++){var q=i[s];if(q.regex&&q.regex.test(navigator.userAgent)){k=T5.ex({},j.base,q);COG.Log.info("PLATFORM DETECTED AS: "+k.name);break}}if(!k){COG.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
k=j.base}COG.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return k}})();
T5.Dispatcher=function(){var f=[],l={execute:function(h){var e=l.findAction(h);e&&e.execute.apply(e,Array.prototype.slice.call(arguments,1))},findAction:function(h){for(var e=f.length;e--;)if(f[e].id==h)return f[e];return null},getRegisteredActions:function(){return[].concat(f)},getRegisteredActionIds:function(){for(var h=[],e=f.length;e--;)f[e].id&&h.push(f[e].id);return h},registerAction:function(h){h&&h.id&&f.push(h)},Action:function(h){h=T5.ex({autoRegister:true,id:"",title:"",icon:"",hidden:false,
execute:null},h);var e={id:h.id,execute:function(){h.execute&&h.execute.apply(this,arguments)},getParam:function(a){return h[a]?h[a]:""},toString:function(){return COG.formatStr("{0} [title = {1}, icon = {2}]",e.id,h.title,h.icon)}};h.autoRegister&&l.registerAction(e);return e},Agent:function(h){h=COG.extend({name:"Untitled",translator:null,execute:null},h);var e={getName:function(){return h.name},getParam:function(a){return h[a]},getId:function(){return COG.toID(e.getName())},run:function(a,d){if(h.execute){var c=
h.translator?h.translator(a):a;h.execute.call(e,c,function(b,m){d&&d(b,m,c)})}}};return e},runAgents:function(h,e,a){for(var d=0;d<h.length;d++)h[d].run(e,a)}};return l}();
T5.Resources=function(){var f="",l={},h={getPath:function(e){return/^(file|https?|\/)/.test(e)?e:f+e},setBasePath:function(e){f=e},loadResource:function(e){e=T5.ex({filename:"",cacheable:true,dataType:null,callback:null},e);var a=function(d){e.callback&&COG.Log.watch("CALLING RESOURCE CALLBACK",function(){e.callback(d)})};e.cacheable&&l[e.filename]?a(l[e.filename]):COG.xhr({url:h.getPath(e.filename),dataType:e.dataType,success:function(d){if(e.cacheable)l[e.filename]=d;a(d)},error:function(d,c,b){COG.Log.error("error loading resource ["+
e.filename+"], error = "+b)}})},loadSnippet:function(e,a){/\.\w+$/.test(e)||(e+=".html");h.loadResource({filename:"snippets/"+e,callback:a,dataType:"html"})}};return h}();
T5.Images=function(){function f(p,s){var q=document.createElement("canvas");q.width=p?p:0;q.height=s?s:0;if(typeof FlashCanvas!=="undefined"){q.id="tmpCanvas"+d++;q.style.cssText="position: absolute; top: -"+(s-1)+"px; left: -"+(p-1)+"px;";document.body.appendChild(q);FlashCanvas.initElement(q)}return q}function l(){var p=c[this.id];if(p&&p.image.complete&&p.image.width>0){p.loaded=true;p.hitCount=1;for(var s=g.length;s--;)if(g[s].image.src==this.src){g.splice(s,1);break}if(p.background||p.postProcess||
p.drawBackground||p.customDraw)if(p.image){s=f(p.realSize?p.realSize.width:image.width,p.realSize?p.realSize.height:image.height);var q=s.getContext("2d"),w=p.offset?p.offset:new T5.Vector;p.background&&q.drawImage(p.background,0,0);p.drawBackground&&p.drawBackground(q);p.customDraw?p.customDraw(q,p):q.drawImage(p.image,w.x,w.y);p.postProcess&&p.postProcess(q,p);p.image=s}p.loadCallback&&p.loadCallback(this,false);j[j.length]={url:this.src,created:p.requested};delete c[this.id];h()}}function h(){if(!k){var p=
T5.getConfig().maxImageLoads;k=COG.Loopage.join({execute:function(s,q){if(!p||g.length<p){var w=m.shift();if(w){g[g.length]=w;w.image.onload=l;w.image.src=T5.Resources.getPath(w.url);w.requested=Date.now()}else q.trigger("complete")}},frequency:10});k.bind("complete",function(){k=null})}}function e(){t=true;try{var p=j.length/2>>0;if(p>0){j.sort(function(q,w){return q.created-w.created});for(var s=p;s--;)delete a[j[s].url];j.splice(0,p)}}finally{t=false}COG.say("imagecache.cleared")}var a={},d=0,
c={},b=0,m=[],g=[],j=[],i=0,k=null,t=false,x={avgImageSize:25,loadTimeout:10,cancelLoad:function(){g=[]},get:function(p){var s=null,q=null;t||(s=a[p]);if((q=s?s.image:null)&&(q.getContext||q.complete&&q.width>0))return q},load:function(p,s,q){var w=a[p];if(w){w.hitCount++;w.image.complete&&s&&s(w.image,true)}else{w=T5.ex({url:p,image:new Image,loaded:false,created:Date.now(),requested:null,hitCount:0,loadCallback:s},q);w.image.id="resourceLoaderImage"+b++;a[p]=w;c[w.image.id]=w;m[m.length]=w;h()}return w},
newCanvas:f,stats:function(){return{imageLoadingCount:g.length,queuedImageCount:m.length,imageCacheFullness:i}}};COG.Loopage.join({execute:function(p){for(var s=false,q=0,w=T5.getConfig();q<g.length;)if(p-g[q].requested>x.loadTimeout*1E3){g.splice(q,1);s=true}else q++;s&&h();if(w&&w.imageCacheMaxSize){i=j.length*x.avgImageSize/w.imageCacheMaxSize;i>=1&&e()}},frequency:2E4});return x}();
T5.TimeLord=function(){var f=/^P(\d+Y)?(\d+M)?(\d+D)?$/,l=/^(\d+H)?(\d+M)?(\d+S)?$/,h=function(a,d){return{days:a?a:0,seconds:d?d:0}},e={8601:function(a){a=a.split("T");var d=null;d=null;var c=0,b=0;f.lastIndex=-1;d=f.exec(a[0]);c+=d[3]?parseInt(d[3].slice(0,-1),10):0;l.lastIndex=-1;d=l.exec(a[1]);b+=d[1]?parseInt(d[1].slice(0,-1),10)*3600:0;b+=d[2]?parseInt(d[2].slice(0,-1),10)*60:0;b+=d[3]?parseInt(d[3].slice(0,-1),10):0;return new h(c,b)}};return{Duration:h,addDuration:function(){for(var a=new h,
d=arguments.length;d--;){a.days+=arguments[d].days;a.seconds+=arguments[d].seconds}if(a.seconds>=86400){a.days+=~~(a.seconds/86400);a.seconds%=86400}return a},parseDuration:function(a,d){var c=d?e[d]:null;if(c)return c(a);COG.Log.warn("Could not find duration parser for specified format: "+d);return new h},formatDuration:function(a){var d,c,b="";if(a.days)b=a.days+" days ";if(a.seconds){a=a.seconds;if(a>=3600){d=~~(a/3600);a-=d*3600}if(a>=60){c=Math.round(a/60);a-=c*60}if(d)b=b+d+(d>1?" hrs ":" hr ")+
(c?(c>10?c:"0"+c)+" min ":"");else if(c)b=b+c+" min";else if(a>0)b=b+(a>10?a:"0"+a)+" sec"}return b}}}();
(function(){var f=Math.PI*2,l=Math.PI/2,h=Math.abs,e=Math.pow,a=Math.sin,d=Math.asin,c=Math.cos,b=1.70158,m={linear:function(g,j,i,k){return i*g/k+j},backin:function(g,j,i,k){return i*(g/=k)*g*((b+1)*g-b)+j},backout:function(g,j,i,k){return i*((g=g/k-1)*g*((b+1)*g+b)+1)+j},backinout:function(g,j,i,k){return(g/=k/2)<1?i/2*g*g*(((b*=1.525)+1)*g-b)+j:i/2*((g-=2)*g*(((b*=1.525)+1)*g+b)+2)+j},bouncein:function(g,j,i,k){return i-m.bounceout(k-g,0,i,k)+j},bounceout:function(g,j,i,k){return(g/=k)<1/2.75?
i*7.5625*g*g+j:g<2/2.75?i*(7.5625*(g-=1.5/2.75)*g+0.75)+j:g<2.5/2.75?i*(7.5625*(g-=2.25/2.75)*g+0.9375)+j:i*(7.5625*(g-=2.625/2.75)*g+0.984375)+j},bounceinout:function(g,j,i,k){return g<k/2?m.bouncein(g*2,0,i,k)/2+j:m.bounceout(g*2-k,0,i,k)/2+i/2+j},cubicin:function(g,j,i,k){return i*(g/=k)*g*g+j},cubicout:function(g,j,i,k){return i*((g=g/k-1)*g*g+1)+j},cubicinout:function(g,j,i,k){if((g/=k/2)<1)return i/2*g*g*g+j;return i/2*((g-=2)*g*g+2)+j},elasticin:function(g,j,i,k,t,x){if(g==0)return j;if((g/=
k)==1)return j+i;x||(x=k*0.3);if(!t||t<h(i)){t=i;i=x/4}else i=x/f*d(i/t);return-(t*e(2,10*(g-=1))*a((g*k-i)*f/x))+j},elasticout:function(g,j,i,k,t,x){var p;if(g==0)return j;if((g/=k)==1)return j+i;x||(x=k*0.3);if(!t||t<h(i)){t=i;p=x/4}else p=x/f*d(i/t);return t*e(2,-10*g)*a((g*k-p)*f/x)+i+j},elasticinout:function(g,j,i,k,t,x){var p;if(g==0)return j;if((g/=k/2)==2)return j+i;x||(x=k*0.3*1.5);if(!t||t<h(i)){t=i;p=x/4}else p=x/f*d(i/t);if(g<1)return-0.5*t*e(2,10*(g-=1))*a((g*k-p)*f/x)+j;return t*e(2,
-10*(g-=1))*a((g*k-p)*f/x)*0.5+i+j},quadin:function(g,j,i,k){return i*(g/=k)*g+j},quadout:function(g,j,i,k){return-i*(g/=k)*(g-2)+j},quadinout:function(g,j,i,k){if((g/=k/2)<1)return i/2*g*g+j;return-i/2*(--g*(g-2)-1)+j},sinein:function(g,j,i,k){return-i*c(g/k*l)+i+j},sineout:function(g,j,i,k){return i*a(g/k*l)+j},sineinout:function(g,j,i,k){return-i/2*(c(Math.PI*g/k)-1)+j}};T5.easing=function(g){return m[g.replace(/[\-\_\s\.]/g,"").toLowerCase()]};T5.registerEasingType=function(g,j){m[g.replace(/[\-\_\s\.]/g,
"").toLowerCase()]=j}})();
T5.Tween=function(f){f=T5.ex({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:T5.easing("sine.out"),complete:null,cancelOnInteract:false},f);var l=Date.now(),h=[],e=false,a=0,d=0,c={cancelOnInteract:f.cancelOnInteract,isComplete:function(){return e},triggerComplete:function(b){f.complete&&f.complete(b)},update:function(b){try{var m=f.tweenFn(b-l,a,d,f.duration);if(f.target)f.target[f.property]=m;for(var g=h.length;g--;)h[g](m,void 0);if(e=l+f.duration<=b){if(f.target)f.target[f.property]=
f.tweenFn(f.duration,a,d,f.duration);for(var j=h.length;j--;)h[j](m,true)}}catch(i){COG.Log.exception(i)}},requestUpdates:function(b){h.push(b)}};a=f.target&&f.property&&f.target[f.property]?f.target[f.property]:f.startValue;if(typeof f.endValue!=="undefined")d=f.endValue-a;if(d==0)e=true;T5.wakeTweens();return c};
(function(){function f(a){if(e)return l.length;e=true;try{for(var d=0;d<l.length;)if(l[d].isComplete()){l[d].triggerComplete(false);l.splice(d,1)}else{l[d].update(a);d++}}finally{e=false}l.length===0&&h.trigger("complete");return l.length}var l=[],h=null,e=false;T5.tweenValue=function(a,d,c,b,m){a=new T5.Tween({startValue:a,endValue:d,tweenFn:c,complete:b,duration:m});l.push(a);return a};T5.tween=function(a,d,c,b,m,g){a=new T5.Tween({target:a,property:d,endValue:c,tweenFn:b,duration:g,complete:m});
l.push(a);return a};T5.tweenVector=function(a,d,c,b,m,g){var j=[];if(a){var i=a.x==d,k=a.y==c;i||j.push(T5.tween(a,"x",d,b,function(){(i=true)&&k&&m()},g));k||j.push(T5.tween(a,"y",c,b,function(){k=true;i&&k&&m()},g))}return j};T5.cancelAnimation=function(a){if(!e){e=true;try{for(var d=0;d<l.length;)if(!a||a(l[d])){l[d].triggerComplete(true);l.splice(d,1)}else d++}finally{e=false}}};T5.isTweening=function(){return l.length>0};T5.wakeTweens=function(){if(!h){h=COG.Loopage.join({execute:f,frequency:20});
h.bind("complete",function(){h=null})}}})();(function(){var f={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,PINCH:16,FREEZE:128};T5.viewState=function(){for(var l=0,h=arguments.length;h--;){var e=f[arguments[h].toUpperCase()];if(e)l|=e}return l}})();
T5.ViewLayer=function(f){f=T5.ex({id:"",zindex:0,supportFastDraw:false,transparent:false,validStates:T5.viewState("ACTIVE","ANIMATING","PAN","PINCH")},f);var l=null,h=false,e=f.supportFastDraw,a=f.id,d=T5.viewState("ACTIVE"),c=f.validStates,b=0,m=0,g=f.transparent,j=T5.ex({addToView:function(i){i.setLayer(a,j)},shouldDraw:function(i,k,t){if((i=(i&c)!==0&&(h?e:true))&&g)if(i=t||b!==k.x||m!==k.y){b=k.x;m=k.y}return i},cycle:function(){},draw:function(){},remove:function(){COG.say("layer.remove",{id:a})},
wakeParent:function(i){if(l)l.trigger(i?"invalidate":"wake")},getId:function(){return a},setId:function(i){a=i},getParent:function(){return l},setParent:function(i){h=(l=i)?l.fastDraw&&displayState!==d:false;j.trigger("parentChange",l)}},f);COG.observable(j);return j};
T5.View=function(f){function l(n,o,u,z){T=ia;w();if(z&&f.inertia){L=true;g(R+o,v+u,f.panAnimationEasing,f.panAnimationDuration)}else z||g(R+o,v+u)}function h(){T=ka;L=false;COG.Loopage.join({execute:w,after:50,single:true})}function e(n,o){$=Y(n);ca=Y(o);var u=ma($.dimensions),z=ma(ca.dimensions);aa=ja($);H=ja(ca);J=$&&u!==0?z/u:1}function a(n,o,u){e(o,u);if(Z=J!==1){T=fa;w()}}function d(n,o,u,z){e(o,u);if(f.adjustScaleFactor){J=f.adjustScaleFactor(J);COG.Log.info("scale factor adjusted to: "+J)}if(z<
f.pinchZoomAnimateTrigger){k(ha,J,aa,t(),T5.easing("sine.out"),function(){b();J=1},300);J=ha}else{b();J=1}}function c(n,o,u){M.zoom(o,Math.min(Math.pow(2,Math.round(Math.log(u))),8),500)}function b(){Z=false;M.trigger("scale",J,$?t():H);T=ka;w()}function m(){COG.Log.info("window resized, should adjust the canvas size")}function g(n,o,u,z,G){function P(){ga+=1;if(ga>=2){h(0,0);G&&G()}}var ga=0;if(u){n=T5.tweenValue(R,n,u,P,z);o=T5.tweenValue(v,o,u,P,z);n.cancelOnInteract=true;n.requestUpdates(function(ba){R=
ba;L=true;w()});o.cancelOnInteract=true;o.requestUpdates(function(ba){v=ba;L=true;w()})}else{R=n;v=o}}function j(){if(C){COG.Touch.release(C);if(f.autoSize&&C.parentNode){C.height=C.parentNode.offsetHeight;C.width=C.parentNode.offsetWidth;window.addEventListener("resize",m,false)}try{W=C.getContext("2d");W.clearRect(0,0,C.width,C.height)}catch(n){COG.Log.exception(n);throw Error("Could not initialise canvas on specified view element");}la=COG.Touch.capture(C,{observable:M});F=new T5.Dimensions(C.width,
C.height);f.inertia&&la.inertiaEnable(f.panAnimationDuration,F);for(var o=S;o--;)E[o].trigger("contextChanged",W);w()}}function i(n,o){o.setId(n);o.added=Date.now();o.trigger("contextChanged",W);o.setParent(M);E.push(o);E.sort(function(u,z){var G=z.zindex-u.zindex;if(G===0)G=z.added-u.added;return G});S=E.length;return o}function k(n,o,u,z,G,P,ga){function ba(){P&&P();b();J=1;ea=null}Z=true;aa=T5.V.copy(u);H=T5.V.copy(z);$=null;if(G)T5.tweenValue(0,o-n,G,ba,ga?ga:1E3).requestUpdates(function(na){ea=
na/(o-n);J=n+na;T=fa;w();M.trigger("animate")});else{J=targetScaleFactor;ba()}}function t(){var n=T5.D.getCenter(F),o=T5.V.distance([H,n]),u=T5.V.theta(H,n,o),z=T5.V.diff(aa,H);n=T5.V.pointOnEdge(H,n,u,o/J);n.x+=z.x;n.y+=z.y;return n}function x(){M.trigger("idle");K=true;U=0}function p(n,o,u,z){var G=0,P=L?ia:D?T5.viewState("FROZEN"):T,ga=(P&fa)!==0,ba=0;if(y||ga){n.clearRect(0,0,C.width,C.height);y=false}if(ga){T5.D.getCenter(F);var na=(ea?ea:1)/2,oa=T5.V.diff(aa,H);if($){I.x=H.x+oa.x;I.y=H.y+oa.y}else{I.x=
H.x-oa.x*na;I.y=H.y-oa.y*na}o=T5.V.offset(o,I.x,I.y)}n.save();try{ha=J;if(A!==1)n.scale(A,A);else if(ga){n.translate(H.x,H.y);n.scale(J,J)}for(ba=S;ba--;)if(E[ba].shouldDraw(P,o,u)){var pa=E[ba].draw(n,o,F,P,M,u,z);G+=pa?pa:0}}finally{n.restore()}COG.Log.trace("draw complete",z);return G}function s(n,o){var u=false;u=!L&&(T===fa||T===ia);var z=da||T===T5.viewState("PAN")||T===T5.viewState("PINCH")||T5.isTweening();r.x=R>>0;r.y=v>>0;if(u){T5.cancelAnimation(function(P){return P.cancelOnInteract});
K=false;if(U!==0){clearTimeout(U);U=0}}u=z||J!==1&&J!==V;for(var G=S;G--;)u=E[G].cycle(n,r,T,z)||u;if(u){p(W,r,z,n);V=J;da=false}if(!u&&Q===0&&!X){if(!K&&U===0)U=setTimeout(x,500);o.trigger("complete")}Q=0;COG.Log.trace("Completed draw cycle",n)}function q(){da=true;w()}function w(){Q++;if(!(D||B)){B=COG.Loopage.join({execute:s,frequency:30});B.bind("complete",function(){B=null})}}f=T5.ex({id:COG.objId("view"),container:"",fastDraw:false,inertia:true,pannable:true,scalable:true,panAnimationEasing:T5.easing("sine.out"),
panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:true,tapExtent:10},f);var E=[],S=0,C=document.getElementById(f.container),W=null,R=0,v=0,r=new T5.Vector,y=false,B=null,D=false,A=1,F=new T5.Dimensions,Q=0,H=null,K=false,L=false,U=0,O=0,I=new T5.Vector,N=0,Z=false,$=null,ca=null,da=false,J=1,V=0,ha=1,ea=null,aa=null,X=typeof FlashCanvas!=="undefined",la=null,ka=T5.viewState("ACTIVE"),ia=T5.viewState("PAN"),fa=T5.viewState("PINCH"),T=ka,Y=T5.V.getRect,ma=T5.D.getSize,
ja=T5.R.getCenter,M={id:f.id,deviceScaling:A,fastDraw:f.fastDraw||T5.getConfig().requireFastDraw,animate:function(n,o,u,z,G){k(J,n,o,u,z,G)},centerOn:function(n){R=n.x-C.width/2;v=n.y-C.height/2},getDimensions:function(){return F},getZoomCenter:function(){return I},getLayer:function(n){for(var o=0;o<S;o++)if(E[o].getId()==n)return E[o];return null},setLayer:function(n,o){for(var u=0;u<S;u++)if(E[u].getId()===n){E.splice(u,1);break}o&&i(n,o);q()},eachLayer:function(n){for(var o=S;o--;)n(E[o])},clearBackground:function(){y=
true;q()},freeze:function(){D=true},unfreeze:function(){D=false;w()},resize:function(n,o){if(C){C.width=n;C.height=o;j();q()}},scale:function(n,o,u,z,G){z||(z=T5.D.getCenter(F));G||(G=T5.D.getCenter(F));M.animate(n,z,G,o,u);return M},removeLayer:function(n){a:{for(var o=S;o--;)if(E[o].getId()==n){n=o;break a}n=-1}if(n>=0&&n<S){COG.say("layer.removed",{layer:E[n]});E.splice(n,1);q()}S=E.length},getOffset:function(){return r},updateOffset:g,zoom:function(n,o,u){L=false;J=o;Z=J!==1;aa=T5.D.getCenter(F);
H=J>1?T5.V.copy(n):T5.D.getCenter(F);$=null;clearTimeout(O);if(Z){T=fa;w();if(u)O=setTimeout(function(){b();J=1},parseInt(u,10))}}};COG.listen("layer.remove",function(n){n.id&&M.removeLayer(n.id)});A=T5.getConfig().getScaling();M.markers=i("markers",new T5.MarkerLayer);COG.observable(M);M.bind("wake",w);M.bind("invalidate",q);if(f.pannable){M.bind("pan",l);M.bind("panEnd",h);M.bind("inertiaCancel",function(){L=false;w()})}if(f.scalable){M.bind("pinchZoom",a);M.bind("pinchZoomEnd",d);M.bind("wheelZoom",
c)}M.bind("tap",function(n,o,u){for(var z=T5.V.offset(u,R,v),G=E.length;G--;)n.cancel=n.cancel||E[G].trigger("tap",o,u,z).cancel});COG.configurable(M,["inertia","container","rotation","tapExtent"],COG.paramTweaker(f,null,{container:function(n,o){C=document.getElementById(o);j()},rotation:function(n,o){N=o}}),true);j();return M};
T5.PathLayer=function(f){function l(j){j.syncVectors(d);c&&j.syncVectors(c);g.trigger("tidy")}f=T5.ex({style:"waypoints",pixelGeneralization:8,zindex:50},f);var h=false,e=[],a=null,d=[],c=null,b=0,m=[],g=T5.ex(new T5.ViewLayer(f),{getAnimation:function(j,i,k,t){var x="pathAnimation"+b++;m.push(x);return new T5.AnimatedPathLayer({id:x,path:e,zindex:f.zindex+1,easing:j?j:T5.easing("sine.inout"),duration:i?i:5E3,drawIndicator:k,autoCenter:t?t:false})},cycle:function(j,i,k,t){return t},draw:function(j,
i){var k,t=e.length;j.save();try{T5.applyStyle(j,f.style);if(t>0){j.beginPath();j.moveTo(e[t-1].x-i.x,e[t-1].y-i.y);for(k=t;k--;)j.lineTo(e[k].x-i.x,e[k].y-i.y);j.stroke();if(a){j.fillStyle=f.waypointFillStyle;for(k=a.length;k--;){j.beginPath();j.arc(a[k].x-i.x,a[k].y-i.y,2,0,Math.PI*2,false);j.stroke();j.fill()}}}}finally{j.restore()}h=false},updateCoordinates:function(j,i){var k=g.getParent();k=k?k.getTileLayer():null;d=j;c=i;COG.Log.info("updating coordinates, grid = "+k);k&&l(k)}});g.bind("gridUpdate",
function(j,i){l(i);for(var k=m.length;k--;)COG.say("layer.remove",{id:m[k]});m=[]});g.bind("tidy",function(){e=T5.V.simplify(d,f.pixelGeneralization);a=T5.V.simplify(c,f.pixelGeneralization);h=true;g.wakeParent(true)});return g};
T5.Poly=function(f,l){l=T5.ex({fill:false},l);var h=false,e=l.fill,a=[],d={draw:function(c,b,m){if(h){var g=true;c.beginPath();for(var j=a.length;j--;){var i=a[j].x-b,k=a[j].y-m;if(g){c.moveTo(i,k);g=false}else c.lineTo(i,k)}e&&c.fill();c.stroke()}},resync:function(c){c.syncVectors(f);a=f.length<=3?f:T5.V.simplify(f)}};h=f&&f.length>=2;return d};
T5.PolyLayer=function(f){f=T5.ex({zindex:80,transparent:true,style:null},f);var l=[],h=false,e=T5.ex(new T5.ViewLayer(f),{add:function(a){l.unshift(a)},cycle:function(){return h},draw:function(a,d,c,b){c=d.x;d=d.y;a.save();try{T5.applyStyle(a,f.style);for(var m=l.length;m--;)l[m].draw(a,c,d,b)}finally{a.restore()}h=false}});e.bind("gridUpdate",function(a,d){for(var c=l.length;c--;)l[c].resync(d);h=true;e.wakeParent(true)});e.bind("parentChange",function(a,d){var c=d?d.getTileLayer():null;if(c)for(var b=
l.length;b--;)l[b].resync(c)});COG.configurable(e,["style"],COG.paramTweaker(f,null,null),true);return e};
T5.AnimatedPathLayer=function(f){function l(b,m,g){b.fillStyle="#FFFFFF";b.strokeStyle="#222222";b.beginPath();b.arc(g.x,g.y,4,0,Math.PI*2,false);b.stroke();b.fill()}f=T5.ex({path:[],id:COG.objId("pathAni"),easing:T5.easing("sine.inout"),validStates:T5.viewState("ACTIVE","PAN","PINCH"),drawIndicator:null,duration:2E3,autoCenter:false},f);var h=T5.V.edges(f.path),e,a=null,d=0;T5.tweenValue(0,h.total,f.easing,function(){c.remove()},f.duration).requestUpdates(function(b,m){d=b;m&&c.remove()});var c=
T5.ex(new T5.ViewLayer(f),{cycle:function(){for(var b=0;b<h.accrued.length&&h.accrued[b]<d;)b++;a=null;if(b<f.path.length-1){var m=d-(b>0?h.accrued[b-1]:0),g=f.path[b],j=f.path[b+1];e=T5.V.theta(g,j,h.edges[b]);a=T5.V.pointOnEdge(g,j,e,m);if(f.autoCenter)(b=c.getParent())&&b.centerOn(a)}return a},draw:function(b,m){if(a)(f.drawIndicator?f.drawIndicator:l)(b,m,new T5.Vector(a.x-m.x,a.y-m.y),e)}});return c};
T5.Annotation=function(f){f=T5.ex({xy:null,tweenIn:null,animationSpeed:null},f);var l=false,h=T5.ex(f,{xy:f.xy,isNew:true,isAnimating:function(){return l},draw:function(e,a,d,c,b){if(h.xy){if(h.isNew&&f.tweenIn){var m=h.xy.y;h.xy.y=a.y-20;l=true;T5.tween(h.xy,"y",m,f.tweenIn,function(){h.xy.y=m;l=false},f.animationSpeed?f.animationSpeed:250+Math.random()*500)}h.drawMarker(e,a,new T5.Vector(h.xy.x-a.x,h.xy.y-a.y),d,c,b);h.isNew=false}},drawMarker:function(e,a,d){e.beginPath();e.arc(d.x,d.y,4,0,Math.PI*
2,false);e.fill()},hitTest:function(e){return Math.abs(e.x-h.xy.x)<=4&&Math.abs(e.y-h.xy.y)<=4}});return h};
T5.ImageAnnotation=function(f){f=T5.ex({image:null,imageUrl:null,animatingImage:null,animatingImageUrl:null,imageAnchor:null},f);var l=f.imageAnchor?T5.V.invert(f.imageAnchor):null,h=f.image,e=f.animatingImage;if(!h)(h=T5.Images.get(f.imageUrl))||T5.Images.load(f.imageUrl,function(d){h=d});if(!e)(e=T5.Images.get(f.imageUrl))||T5.Images.load(f.animatingImageUrl,function(d){e=d});var a=T5.ex(new T5.Annotation(f),{drawMarker:function(d,c,b){if((c=a.isAnimating()&&e?e:h)&&c.complete&&c.width>0){l||(l=
new T5.Vector(-c.width>>1,-c.height>>1));b=T5.V.offset(b,l.x,l.y);d.drawImage(c,b.x,b.y,c.width,c.height)}},hitTest:function(d){var c=a.xy.x,b=a.xy.y;return d.x>=c+l.x&&d.x<=c+(h.width+l.x)&&d.y>=b+l.y&&d.y<=b+(h.height+l.y)}});return a};
T5.MarkerLayer=function(f){function l(c,b){for(var m=e.length;m--;)b.syncVectors([e[m].xy])}function h(){var c=d.getParent().getTileLayer();c&&l(null,c);d.trigger("markerUpdate",e);d.wakeParent(true)}f=T5.ex({zindex:100},f);var e=[],a=false,d=T5.ex(new T5.ViewLayer(f),{cycle:function(){return a},draw:function(c,b,m,g,j){a=false;for(m=e.length;m--;){e[m].draw(c,b,g,d,j);a=a||e[m].isAnimating()}return a?1:0},add:function(c){if(c&&typeof c.length!=="undefined")for(var b=c.length;b--;){if(c[b])e[e.length]=
c[b]}else if(c)e[e.length]=c;h()},clear:function(){e=[];h()}});d.bind("tap",function(c,b,m,g){for(var j=[],i=e.length;i--;)if(e[i].hitTest(g))j[j.length]=e[i];if(j.length>0)c.cancel=d.trigger("markerTap",b,m,j).cancel});d.bind("gridUpdate",l);return d};
T5.Style=function(f){function l(d){var c=f[d];typeof c!=="undefined"&&h.push(function(b){b[d]=c})}f=T5.ex({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},f);var h=[],e={applyToContext:function(d){for(var c=h.length;c--;)h[c](d)}};for(var a in f)l(a);return e};
(function(){var f={basic:new T5.Style({lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"}),waypoints:new T5.Style({lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"})};T5.applyStyle=function(l,h){(T5.styles[h]?T5.styles[h]:T5.styles.basic).applyToContext(l)};T5.loadStyles=function(l){COG.jsonp(l,function(h){T5.resetStyles(h)})};T5.resetStyles=function(l){var h={};for(var e in l)h[e]=new T5.Style(l[e]);T5.styles=T5.ex({},f,h)};T5.styles=f})();
(function(){T5.tileSize=256;T5.Tile=function(f){return f=T5.ex({x:0,y:0,gridX:0,gridY:0,dirty:true},f)};T5.EmptyTile=function(f){f=new T5.Tile(f);f.empty=true;return f};T5.ImageTile=function(f){f=T5.ex({url:"",sessionParamRegex:null,loading:false,loaded:false},f);return new T5.Tile(f)}})();
T5.TileGrid=function(f){function l(r,y){var B=T5.Vector(r*b-j.x,y*b-j.y);return new T5.EmptyTile({gridX:B.x,gridY:B.y,empty:true})}function h(r,y,B,D){var A=c*0.2>>0,F=new T5.Vector;if(r<0||r+B>c)F.x=r<0?-A:A;if(y<0||y+D>c)F.y=y<0?-A:A;return F}function e(r,y,B){var D=COG.Log.getTraceTicks(),A=0;new T5.Vector(c/2,c/2);if(B)d=[];if(r)for(B=0;B<c;B++)for(var F=0;F<c;F++){if(!d[A]){var Q=r(F,B,m,c);Q.gridX=F*b-j.x;Q.gridY=B*b-j.y;d[A]=Q}A++}g=r;k=y;COG.Log.trace("tile grid populated",D);v.wakeParent()}
function a(r,y,B,D){var A,F=[],Q=false;r=new T5.Vector((r.x+j.x)*x>>0,(r.y+j.y)*x>>0);if(!R){A=v.getParent().getDimensions();C=Math.ceil(A.width*x)+1;W=Math.ceil(A.height*x)+1;R=new T5.Vector((C-1)/2>>0,(W-1)/2>>0)}tilesNeeded=false;for(var H=W;H--;)for(var K=C;K--;){A=K+r.x>=0&&K+r.x<c?d[(H+r.y)*c+(K+r.x)]:null;var L=new T5.Vector(K-R.x,H-R.y);if(!A){E=h(r.x,r.y,C,W);A=l(K+r.x,H+r.y)}Q=A?(A.dirty=B||A.dirty)||Q:Q;F[F.length]={tile:A,centerness:T5.V.absSize(L)}}F.sort(function(U,O){return O.centerness-
U.centerness});s||(s=Array(F.length));for(B=F.length;B--;){s[B]=F[B].tile;v.prepTile(s[B],y)}w=D;return Q}f=T5.ex({tileSize:T5.tileSize,center:new T5.Vector,gridSize:25,shiftOrigin:null,supportFastDraw:true,allowShift:true},f);var d=Array(Math.pow(f.gridSize,2)),c=f.gridSize,b=f.tileSize,m=T5.V.offset(f.center,-Math.ceil(f.gridSize>>1)),g=null,j=new T5.Vector,i=false,k=null,t=Math.round(b/2),x=b?1/b:0,p=true,s=null,q=false,w=0;new T5.Vector;var E=new T5.Vector;T5.getConfig();var S=c*b,C,W,R,v=T5.ex(new T5.ViewLayer(f),
{gridDimensions:new T5.Dimensions(S,S),cycle:function(r,y,B,D){var A=false;if(E.x!==0||E.y!==0){D=E;var F=f.shiftOrigin;if(!(!f.allowShift||D.x===0&&D.y===0)){var Q=COG.Log.getTraceTicks(),H=Array(d.length);H.length=d.length;for(var K=0;K<c;K++)for(var L=0;L<c;L++)H[L*c+K]=K+D.x>=0&&K+D.x<c?d[(L+D.y)*c+(K+D.x)]:null;d=H;m=F?F(m,D):T5.V.add(m,D);j.x+=-D.x*b;j.y+=-D.y*b;COG.Log.trace("tile storage shifted",Q);e(g,k)}E=new T5.Vector;D=true}if(B!==T5.viewState("PINCH"))A=a(y,B,D,r);i=T5.isTweening();
return A},deactivate:function(){p=false},find:function(r){if(!r)return null;for(var y=d.length;y--;){var B=d[y];if(B&&r(B))return B}return null},prepTile:function(){},drawTile:function(){return false},getTileSize:function(){return b},clearTileRect:function(r,y,B,D){r.clearRect(y,B,D,D)},draw:function(r,y,B,D,A,F){if(p){var Q=y.x;y=y.y;var H=B.width,K=B.height,L=true;if(s){F||r.beginPath();for(var U=s.length;U--;){var O=s[U],I=O.gridX-Q,N=O.gridY-y;F||r.rect(I,N,b,b);O.x=I;O.y=N;if(O.empty){COG.Log.info("empty tile @ x: "+
I+", y: "+N);v.clearTileRect(r,I,N,b,D);L=false}else if(F||O.dirty){i&&v.clearTileRect(r,I,N,b,D);L=v.drawTile(r,O,I,N,D)&&L}H=I<H?I:H;K=N<K?N:K}F||r.clip();H>0&&r.clearRect(0,0,H,B.height);K>0&&r.clearRect(0,0,B.width,K);L&&!q&&A.trigger("tileDrawComplete");q=L}}},getTileAtXY:function(r,y){for(var B=null,D=s?s.length:0;D--;){var A=s[D];if(A&&r>=A.x&&y>=A.y)if(r<=A.x+b&&y<=A.y+b){B=A;break}}COG.Log.info("looking for tile @ x: "+r+", y: "+y+", found: "+B);return B},getTileVirtualXY:function(r,y,B){r=
T5.V.add(new T5.Vector(r,y),T5.V.invert(m),j);r=new T5.Vector(r.x*b,r.y*b);if(B){r.x+=t;r.y+=t}return r},populate:function(r){e(r,null,true)}});COG.listen("imagecache.cleared",function(){for(var r=d.length;r--;)if(d[r])d[r].loaded=false});COG.listen("tiler.repaint",function(){for(var r=d.length;r--;)if(d[r]){d[r].x=null;d[r].y=null}});return v};
T5.ImageTileGrid=function(f){function l(k){function t(){var x=T5.Images.newCanvas(32,32),p=x.getContext("2d");p.fillStyle="#BBBBBB";p.fillRect(0,0,32,32);p.fillStyle="#C3C3C3";p.fillRect(0,0,16,16);p.fillRect(16,16,16,16);return x}if(!e||k!==e.width){e=T5.Images.newCanvas(k,k);k=e.getContext("2d");k.fillStyle=typeof FlashCanvas!=="undefined"?"#666666":k.createPattern(t(),"repeat");k.fillRect(0,0,e.width,e.height)}return e}f=T5.ex({emptyTile:function(k){if(!h||k!==h.width){h=T5.Images.newCanvas(k,
k);k=h.getContext("2d");k.fillStyle="rgba(150, 150, 150, 0.1)";k.fillRect(0,0,h.width,h.height)}return h}(T5.tileSize),panningTile:null,tileOffset:new T5.Vector,tileDrawArgs:{}},f);var h=f.emptyTile,e=f.panningTile?f.panningTile:l(T5.tileSize),a=T5.viewState("ACTIVE"),d=T5.viewState("PAN"),c=T5.getConfig().requireFastDraw,b=f.tileSize?f.tileSize:T5.tileSize,m=T5.Images.get,g=T5.Images.load,j=T5.ex({background:null,overlay:null,offset:new T5.Vector,realSize:new T5.Dimensions(b,b)},f.tileDrawArgs),
i=T5.ex(new T5.TileGrid(f),{clearTileRect:function(k,t,x,p,s){(s&d)===0&&k.clearRect(t,x,p,p)},drawTile:function(k,t,x,p,s){var q=t.url?m(t.url):null,w=false;if(q){k.drawImage(q,x,p);w=true}else if((s&d)!==0)k.drawImage(e,x,p);else if(h&&!t.drawnEmpty){k.drawImage(h,x,p);t.drawnEmpty=true}t.dirty=false;return w},initTileUrl:function(){},prepTile:function(k,t){if(k&&!k.loading&&(!c||t===a)){k.url||i.initTileUrl(k);if(!m(k.url)){k.loading=true;g(k.url,function(){k.loaded=true;k.dirty=true;i.wakeParent()},
j)}}}});return i};
T5.Tiler=function(f){f=T5.ex({container:"",drawCenter:false,datasources:{},tileLoadThreshold:"first"},f);var l=T5.ex(new T5.View(f),{getTileLayer:function(){return l.getLayer("grid0")},setTileLayer:function(h){l.setLayer("grid0",h);l.trigger("gridUpdate",h);l.eachLayer(function(e){e.trigger("gridUpdate",h)})},viewPixToGridPix:function(h){var e=l.getOffset();return new T5.Vector(h.x+e.x,h.y+e.y)},centerOn:function(h,e,a,d){var c=l.getTileLayer(),b=l.getDimensions();(c=c?c.getTileSize():0)&&l.updateOffset(h.gridX-
(b.width-c)*0.5>>0,h.gridY-(b.height-c)*0.5>>0,e,a,d)},cleanup:function(){l.removeLayer("grid0")},repaint:function(){COG.say("tiler.repaint");l.trigger("wake")},select:function(h){l.trigger("selectTile",h)}});l.bind("tap",function(h,e,a){if(h=l.getTileLayer())(a=h.getTileAtXY(a.x,a.y))&&l.trigger("selectTile",a)});return l};
