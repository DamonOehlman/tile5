if(!this.JSON)this.JSON={};
(function(){function c(e){return e<10?"0"+e:e}function m(e){a.lastIndex=0;return a.test(e)?'"'+e.replace(a,function(j){var l=b[j];return typeof l==="string"?l:"\\u"+("0000"+j.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function g(e,j){var l,k,s,q,o=f,v,p=j[e];if(p&&typeof p==="object"&&typeof p.toJSON==="function")p=p.toJSON(e);if(typeof i==="function")p=i.call(j,e,p);switch(typeof p){case "string":return m(p);case "number":return isFinite(p)?String(p):"null";case "boolean":case "null":return String(p);
case "object":if(!p)return"null";f+=h;v=[];if(Object.prototype.toString.apply(p)==="[object Array]"){q=p.length;for(l=0;l<q;l+=1)v[l]=g(l,p)||"null";s=v.length===0?"[]":f?"[\n"+f+v.join(",\n"+f)+"\n"+o+"]":"["+v.join(",")+"]";f=o;return s}if(i&&typeof i==="object"){q=i.length;for(l=0;l<q;l+=1){k=i[l];if(typeof k==="string")if(s=g(k,p))v.push(m(k)+(f?": ":":")+s)}}else for(k in p)if(Object.hasOwnProperty.call(p,k))if(s=g(k,p))v.push(m(k)+(f?": ":":")+s);s=v.length===0?"{}":f?"{\n"+f+v.join(",\n"+f)+
"\n"+o+"}":"{"+v.join(",")+"}";f=o;return s}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+c(this.getUTCMonth()+1)+"-"+c(this.getUTCDate())+"T"+c(this.getUTCHours())+":"+c(this.getUTCMinutes())+":"+c(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
a=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f,h,b={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},i;if(typeof JSON.stringify!=="function")JSON.stringify=function(e,j,l){var k;h=f="";if(typeof l==="number")for(k=0;k<l;k+=1)h+=" ";else if(typeof l==="string")h=l;if((i=j)&&typeof j!=="function"&&(typeof j!=="object"||typeof j.length!=="number"))throw Error("JSON.stringify");return g("",
{"":e})};if(typeof JSON.parse!=="function")JSON.parse=function(e,j){function l(s,q){var o,v,p=s[q];if(p&&typeof p==="object")for(o in p)if(Object.hasOwnProperty.call(p,o)){v=l(p,o);if(v!==undefined)p[o]=v;else delete p[o]}return j.call(s,q,p)}var k;e=String(e);d.lastIndex=0;if(d.test(e))e=e.replace(d,function(s){return"\\u"+("0000"+s.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){k=eval("("+e+")");return typeof j==="function"?l({"":k},""):k}throw new SyntaxError("JSON.parse");}})();
GT=function(){var c=/\$\{(.*?)\}/ig,m=Object.prototype.hasOwnProperty,g=0,d={id:"GRUNT.core",extend:function(){var a=arguments[0]||{},f=1,h=arguments.length,b=false,i,e,j,l;if(typeof a==="boolean"){b=a;a=arguments[1]||{};f=2}if(typeof a!=="object"&&!d.isFunction(a))a={};if(h===f){a=this;--f}for(;f<h;f++)if((i=arguments[f])!=null)for(e in i){j=a[e];l=i[e];if(a!==l)if(b&&l&&(d.isPlainObject(l)||d.isArray(l))){j=j&&(d.isPlainObject(j)||d.isArray(j))?j:d.isArray(l)?[]:{};a[e]=d.extend(b,j,l)}else if(l!==
undefined)a[e]=l}return a},isFunction:function(a){return toString.call(a)==="[object Function]"},isArray:function(a){return toString.call(a)==="[object Array]"},isPlainObject:function(a){if(!a||toString.call(a)!=="[object Object]"||a.nodeType||a.setInterval)return false;if(a.constructor&&!m.call(a,"constructor")&&!m.call(a.constructor.prototype,"isPrototypeOf"))return false;var f;for(f in a);return f===undefined||m.call(a,f)},isEmptyObject:function(a){for(var f in a)return false;return true},isXmlDocument:function(a){return toString.call(a)===
"[object Document]"},contains:function(a,f){var h=a,b=arguments,i=1;if(f&&d.isArray(f)){b=f;i=0}for(i=i;i<b;i++)h=h&&typeof foo[b[i]]!=="undefined";return h},newModule:function(a){a=d.extend({id:null,requires:[],parent:null},a);if(a.parent)a=d.extend({},a.parent,a);return a},toID:function(a){return a.replace(/\s/g,"-")},objId:function(a){return(a?a:"obj")+g++},formatStr:function(a){if(arguments.length<=1)return a;for(var f=arguments.length-2,h=0;h<=f;h++)a=a.replace(RegExp("\\{"+h+"\\}","gi"),arguments[h+
1]);return a},wordExists:function(a,f){var h="";if(f.toString)f=f.toString();for(var b=0;b<f.length;b++)h+=!/\w/.test(f[b])?"\\"+f[b]:f[b];return RegExp("(^|\\s|\\,)"+h+"(\\,|\\s|$)","i").test(a)},parseTemplate:function(a,f){for(var h=c.exec(a);h;){a=a.replace(h[0],COG.XPath.first(h[1],f));c.lastIndex=0;h=c.exec(a)}return a}};return d}();
COG.Log=function(){function c(f,h){var b,i=h&&h.length>0?h[0]:"";for(b=1;h&&b<h.length;b++)i+=" "+(g&&COG.isPlainObject(h[b])?JSON.stringify(h[b]):h[b]);typeof console!=="undefined"&&console[f](i);for(b=0;b<m.length;b++)m[b].call(a,i,f)}var m=[],g=typeof JSON!=="undefined",d=window.console&&window.console.markTimeline,a={id:"GRUNT.log",getTraceTicks:function(){return d?(new Date).getTime():null},trace:function(f,h){if(d)console.markTimeline(f+(h?": "+(a.getTraceTicks()-h)+"ms":""))},debug:function(){c("debug",
arguments)},info:function(){c("info",arguments)},warn:function(){c("warn",arguments)},error:function(){c("error",arguments)},exception:function(f){a.error(arguments);for(var h in f)a.info("ERROR DETAIL: "+h+": "+f[h])},watch:function(f,h){try{h()}catch(b){a.exception(b,f)}},throwError:function(f){a.error(f);throw Error(f);},requestUpdates:function(f){m.push(f)}};return a}();
(function(){function c(g,d){var a=g.split("|"),f={};for(var h in d){var b=d[h];f[h]=a.length>b?a[b]:null}return f}var m={JSON:{parse:function(g){return JSON.parse(g)}},PDON:{parse:function(g){var d=null,a=[];g=g.split("\n");for(var f=0;f<g.length;f++){var h=g[f];if(d)a.push(c(h,d));else if(h){d=h.split("|");h={};for(var b=0;b<d.length;b++)h[d[b]]=b;d=h}else d=null}return a}}};COG.parseData=function(g,d){d=d?d.toUpperCase():"JSON";if(!m[d])throw Error("Unsupported data format: "+d);try{return m[d].parse(g)}catch(a){COG.Log.exception(a)}return{}}})();
(function(){function c(d,a){d[a]||(d[a]=function(f){return d.configure(a,f)})}function m(d){d.gtConfId=COG.objId("configurable");d.gtConfig={};d.gtConfigFns=[];return d.gtConfig}var g={};COG.paramTweaker=function(d,a,f){return function(h,b){if(typeof b!=="undefined"){if(h in d)d[h]=b;f&&h in f&&f[h](h,b)}else return a&&h in a?a[h](h):d[h]}};COG.configurable=function(d,a,f,h){if(d){d.gtConfId||m(d);var b=d.gtConfId,i=d.gtConfig,e=d.gtConfigFns;g[b]=d;e.push(f);for(f=a.length;f--;){i[a[f]]=true;h&&c(d,
a[f])}if(!d.configure)d.configure=function(j,l){if(i[j]){for(var k=e.length;k--;){var s=e[k](j,l);if(typeof s!=="undefined")return s}return g[b]}return null}}}})();
(function(){function c(a){var f=document.createElement("script"),h=false;f.src=a;f.async=true;f.onload=f.onreadystatechange=function(){if(!h&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){h=true;f.onload=f.onreadystatechange=null;f&&f.parentNode&&f.parentNode.removeChild(f)}};g||(g=document.getElementsByTagName("head")[0]);g.appendChild(f)}var m=0,g,d=this;COG.jsonp=function(a,f,h){a+=a.indexOf("?")>=0?"&":"?";var b="json"+ ++m;d[b]=function(i){f(i);d[b]=null;try{delete d[b]}catch(e){}};
c(a+(h?h:"callback")+"="+b);return b}})();
(function(){function c(b){var i=[],e=function(l,k){k=COG.isFunction(k)?k():k;i[i.length]=encodeURIComponent(l)+"="+encodeURIComponent(k)};if(COG.isArray(b))for(var j=0;j<b.length;j++)e(b[j].name,b[j].value);else for(j in b)e(j,b[j]);return i.join("&").replace(/%20/g,"+")}var m={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},g={JSON:["json"],PDON:["pdon.txt"]},d=["TEXT","STREAM"],a=/^(\w+:)?\/\/([^\/?#]+)/,f={XML:function(b){return b.responseXML},JSON:function(b){return COG.parseData(b.responseText)},
PDON:function(b){return COG.parseData(b.responseText,"PDON")},DEFAULT:function(b){return b.responseText}},h={CONTENT_TYPE:"Content-Type"};COG.xhr=function(b){function i(){if(this.readyState===4){var k=null,s=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(s)if(b.handleResponse)b.handleResponse(this);else{var q=b,o=this.getResponseHeader(h.CONTENT_TYPE),v,p=false;for(v in m)if(o&&o.indexOf(m[v])>=0){p=true;break}o=
!p;for(p=0;p<d.length;p++)o=o||d[p]==v;if(o)b:{o=v;for(var C in g)for(p=0;p<g[C].length;p++)if(RegExp(g[C][p]+"$","i").test(q.url)){v=C;break b}v=o?o:"DEFAULT"}try{k=f[v](this,q)}catch(P){k=f.DEFAULT(this,q)}}else b.error&&b.error(this)}catch(y){COG.Log.exception(y,"PROCESSING AJAX RESPONSE")}s&&k&&b.success&&b.success.call(this,k)}}try{b=COG.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},b);var e=a.exec(b.url),
j=e&&(e[1]&&e[1]!==location.protocol||e[2]!==location.host);if(b.data)b.method="POST";if(b.url){e=null;if(b.xhr)e=b.xhr(b);e||(e=new XMLHttpRequest);e.open(b.method,b.url,b.async);b.data&&e.setRequestHeader("Content-Type",b.contentType);j||e.setRequestHeader("X-Requested-With","XMLHttpRequest");e.onreadystatechange=i;e.send(b.method=="POST"?c(b.data):null)}else COG.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(l){COG.Log.exception(l)}}})();
COG.XPath=function(){function c(a){for(var f=null,h=0;h<m.length;h++)if(f=m[h](a))break;return f}var m=[],g=[null,function(a){return a.numberValue},function(a){return a.stringValue},function(a){return a.booleanValue},null,null,null,null,function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null},function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||COG.Log.warn("No XPATH support");var d={SearchResult:function(a){return{toString:function(){var f=
null;if(a){var h=null;if(a.resultType>=0&&a.resultType<g.length)h=g[a.resultType];if(h)f=h(a)}return f?f:""}}},first:function(a,f){var h=d.SearchResult,b;var i=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!i)i=XPathResult.ANY_TYPE;try{if(COG.isXmlDocument(f))b=f.evaluate(a,f,c,i,null);else{COG.Log.warn("attempted xpath expression: "+a+" on a non-xml document");b=null}}catch(e){COG.Log.warn("invalid xpath expression: "+a+" on node: "+f);b=null}return new h(b)},registerResolver:function(a){m.push(a)}};return d}();
(function(){function c(m,g){var d=m.gtObsHandlers;d[g]||(d[g]=[]);return d[g]}COG.observable=function(m){if(m){if(!m.gtObsHandlers)m.gtObsHandlers={};if(!(m.bind||m.trigger||m.unbind)){m.bind=function(g,d){var a=COG.objId("callback");c(m,g).push({fn:d,id:a});return a};m.trigger=function(g){var d=c(m,g);if(!d)return m;for(var a=d.length;a--;)d[a].fn.apply(self,Array.prototype.slice.call(arguments,1));return m};m.unbind=function(g,d){for(var a=c(m,g),f=0;a&&f<a.length;f++)if(a[f].id===d){a.splice(f,1);
break}return m}}}}})();(function(){var c={},m=[];COG.addPipe=function(g){g("pipe.test",{});m.push(g)};COG.listen=function(g,d){c[g]||(c[g]=[]);d&&c[g].push(d)};COG.say=function(g,d){var a;for(a=m.length;a--;)m[a](g,d);if(c[g])for(a=c[g].length;a--;)c[g][a](d)}})();
COG.Storage=function(){function c(m){if(m&&m=="session")return sessionStorage;return localStorage}return{get:function(m,g){var d=c(g).getItem(m);return/^(\{|\[).*(\}|\])$/.test(d)?JSON.parse(d):d},set:function(m,g,d){g=jQuery.isArray(g)||jQuery.isPlainObject(g)?JSON.stringify(g):g;c(d).setItem(m,g)},remove:function(m,g){c(g).removeItem(m)}}}();
COG.ParseRules=function(){var c=[];return{add:function(m,g){c.push({regex:m,handler:g})},each:function(m,g,d){function a(){f++;d&&f>=c.length&&d(g)}for(var f=0,h=0;h<c.length;h++){var b=c[h].regex,i=c[h].handler,e=false;if(b){b.lastIndex=-1;if((b=b.exec(m))&&i){e=true;i(b,g,a)&&a()}}e||a()}}}};
T5=function(){var c=function(h,b){return{x:h?h:0,y:b?b:0}},m=function(){function h(b){if(!b||b.length<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var i={edges:Array(b.length-1),accrued:Array(b.length-1),total:0},e=m.diff,j=0;j<b.length-1;j++){var l=e(b[j],b[j+1]);i.edges[j]=Math.sqrt(l.x*l.x+l.y*l.y);i.accrued[j]=i.total+i.edges[j];i.total+=i.edges[j]}return i}return{create:function(b,i){return new c(b,i)},add:function(){for(var b=new c,i=arguments.length;i--;){b.x+=
arguments[i].x;b.y+=arguments[i].y}return b},absSize:function(b){return Math.max(Math.abs(b.x),Math.abs(b.y))},diff:function(b,i){return new c(b.x-i.x,b.y-i.y)},copy:function(b){return b?new c(b.x,b.y):null},invert:function(b){return new c(-b.x,-b.y)},offset:function(b,i,e){return new c(b.x+i,b.y+(e?e:i))},edges:h,distance:function(b){return h(b).total},theta:function(b,i,e){e=Math.asin((b.y-i.y)/e);return b.x>i.x?e:Math.PI-e},pointOnEdge:function(b,i,e,j){i=new c(Math.cos(e)*j,Math.sin(e)*j);return new c(b.x-
i.x,b.y-i.y)},getRect:function(b){var i=b.length;if(i>1)return new g(Math.min(b[0].x,b[i-1].x),Math.min(b[0].y,b[i-1].y),Math.abs(b[0].x-b[i-1].x),Math.abs(b[0].y-b[i-1].y))},toString:function(b){return b.x+", "+b.y}}}(),g=function(h,b,i,e){return{origin:new c(h,b),dimensions:new a(i,e)}},d=function(){return{copy:function(h){return h?new g(h.origin.x,h.origin.y,h.dimensions.width,h.dimensions.height):null},getCenter:function(h){return new c(h.origin.x+h.dimensions.width/2,h.origin.y+h.dimensions.height/
2)}}}(),a=function(h,b){return{width:h?h:0,height:b?b:0}},f=function(){return{getAspectRatio:function(h){return h.height!==0?h.width/h.height:1},getCenter:function(h){return new c(h.width/2,h.height/2)},getSize:function(h){return Math.sqrt(Math.pow(h.width,2)+Math.pow(h.height,2))}}}();return{ex:COG.extend,newCanvas:function(h,b){var i=document.createElement("canvas");typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(i);i.width=h?h:0;i.height=b?b:0;return i},time:function(){return(new Date).getTime()},
Vector:c,V:m,Dimensions:a,D:f,Rect:g,R:d}}();
(function(){function c(){for(;j.length>0;){var k=j.shift();document.location=k}e=0}function m(k){for(var s=true,q=l.length;q--;)s=s&&k!=l[q];return s}function g(k,s){var q=[];for(var o in s)o&&q.push(o+"="+escape(s[o]));return"tile5://"+k+"/"+(q.length>0?"?"+q.join("&"):"")}function d(k,s){m(k)&&COG.Log.info("would push url: "+g(k,s))}function a(k,s){if(m(k)){j.push(g(k,s));e||(e=setTimeout(c,100))}}function f(){h={base:{name:"Unknown",eventTarget:document,supportsTouch:"createTouch"in document,imageCacheMaxSize:null,
getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:d,targetFps:null},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:a,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:a},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:a},android:{name:"Android OS <= 2.1",regex:/android/i,eventTarget:document.body,supportsTouch:true,getScaling:function(){return 1/
window.devicePixelRatio},bridgeNotify:a},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:a}};b=[h.froyo,h.android,h.ipod,h.iphone,h.ipad]}var h=null,b=[],i=null,e=0,j=[],l=["view.wake","tile.loaded"];T5.getConfig=function(){h||f();if(!i){COG.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var k=0;k<b.length;k++){var s=b[k];if(s.regex&&s.regex.test(navigator.userAgent)){i=T5.ex({},h.base,s);COG.Log.info("PLATFORM DETECTED AS: "+
i.name);break}}if(!i){COG.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");i=h.base}COG.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return i}})();
T5.Dispatcher=function(){var c=[],m={execute:function(g){var d=m.findAction(g);d&&d.execute.apply(d,Array.prototype.slice.call(arguments,1))},findAction:function(g){for(var d=c.length;d--;)if(c[d].id==g)return c[d];return null},getRegisteredActions:function(){return[].concat(c)},getRegisteredActionIds:function(){for(var g=[],d=c.length;d--;)c[d].id&&g.push(c[d].id);return g},registerAction:function(g){g&&g.id&&c.push(g)},Action:function(g){g=T5.ex({autoRegister:true,id:"",title:"",icon:"",execute:null},
g);var d={id:g.id,execute:function(){g.execute&&g.execute.apply(this,arguments)},getParam:function(a){return g[a]?g[a]:""},toString:function(){return COG.formatStr("{0} [title = {1}, icon = {2}]",d.id,g.title,g.icon)}};g.autoRegister&&m.registerAction(d);return d},Agent:function(g){g=COG.extend({name:"Untitled",translator:null,execute:null},g);var d={getName:function(){return g.name},getParam:function(a){return g[a]},getId:function(){return COG.toID(d.getName())},run:function(a,f){if(g.execute){var h=
g.translator?g.translator(a):a;g.execute.call(d,h,function(b,i){f&&f(b,i,h)})}}};return d},runAgents:function(g,d,a){for(var f=0;f<g.length;f++)g[f].run(d,a)}};return m}();
T5.Resources=function(){var c="",m={},g={getPath:function(d){return/^(file|https?|\/)/.test(d)?d:c+d},setBasePath:function(d){c=d},loadResource:function(d){d=T5.ex({filename:"",cacheable:true,dataType:null,callback:null},d);var a=function(f){d.callback&&COG.Log.watch("CALLING RESOURCE CALLBACK",function(){d.callback(f)})};d.cacheable&&m[d.filename]?a(m[d.filename]):COG.xhr({url:g.getPath(d.filename),dataType:d.dataType,success:function(f){if(d.cacheable)m[d.filename]=f;a(f)},error:function(f,h,b){COG.Log.error("error loading resource ["+
d.filename+"], error = "+b)}})},loadSnippet:function(d,a){/\.\w+$/.test(d)||(d+=".html");g.loadResource({filename:"snippets/"+d,callback:a,dataType:"html"})}};return g}();
T5.Images=function(){function c(){var q=f[this.id];if(q&&q.image.complete&&q.image.width>0){q.loaded=true;q.hitCount=1;for(var o=i.length;o--;)if(i[o].image.src==this.src){i.splice(o,1);break}if(q.background||q.postProcess)if(q.image){o=T5.newCanvas(q.realSize?q.realSize.width:image.width,q.realSize?q.realSize.height:image.height);var v=o.getContext("2d"),p=q.offset?q.offset:new T5.Vector;q.background&&v.drawImage(q.background,0,0);v.drawImage(q.image,p.x,p.y);q.postProcess&&q.postProcess(v,q);q.image=
o}q.loadCallback&&q.loadCallback(this,false);e.push({url:this.src,created:q.requested});delete f[this.id];m()}}function m(){for(var q=T5.getConfig().maxImageLoads;b.length>0&&(!q||i.length<q);){var o=b.shift();if(o.imageLoader){i.push(o);o.imageLoader(o,c)}}}function g(q){for(var o=null,v=j.length;v--&&!o;)o=j[v](q);return o?o:function(p,C){p.image.onload=C;p.image.src=T5.Resources.getPath(p.url);p.requested=T5.time()}}function d(){k=true;try{var q=Math.floor(e.length/2);if(q>0){e.sort(function(v,
p){return v.created-p.created});for(var o=q;o--;)delete a[e[o].url];e.splice(0,q)}}finally{k=false}COG.say("imagecache.cleared")}var a={},f={},h=0,b=[],i=[],e=[],j=[],l=0,k=false,s={avgImageSize:25,loadTimeout:10,addInterceptor:function(q){j.push(q)},cancelLoad:function(){i=[]},get:function(q){var o=null,v=null;k||(o=a[q]);if((v=o?o.image:null)&&(v.getContext||v.complete&&v.width>0))return v},load:function(q,o,v){var p=a[q];if(p){p.hitCount++;p.image.complete&&o&&o(p.image,true)}else{p=T5.ex({url:q,
image:new Image,loaded:false,imageLoader:g(q),created:T5.time(),requested:null,hitCount:0,loadCallback:o},v);p.image.id="resourceLoaderImage"+h++;a[q]=p;f[p.image.id]=p;b.push(p);m()}return p},stats:function(){return{imageLoadingCount:i.length,queuedImageCount:b.length,imageCacheFullness:l}}};setInterval(function(){for(var q=T5.time(),o=false,v=0,p=T5.getConfig();v<i.length;)if(q-i[v].requested>s.loadTimeout*1E3){i.splice(v,1);o=true}else v++;o&&m();if(p&&p.imageCacheMaxSize){l=e.length*s.avgImageSize/
p.imageCacheMaxSize;l>=1&&d()}},1E3);return s}();
(function(){function c(y,G){var u=y&&y.length>0?y[0]:null;if(u&&G&&G.length>0)return p(u,G[0]);return null}function m(y){y.preventDefault();y.stopPropagation()}function g(y){for(var G=Array(y.length),u=y.length;u--;)G[u]=o(y[u].pageX,y[u].pageY);return G}var d=120,a=100,f=250,h=300,b=5,i=2,e=0,j=1,l=2,k=7,s=0,q=0,o=T5.V.create,v=T5.V.distance,p=T5.V.diff,C=function(y){function G(t,w,n,r){var z=Math.asin((t.y-w.y)/n);n=Math.min(Math.floor(n*(W.duration/r)),W.max);z=w.x>t.x?z:Math.PI-z;t=o(Math.cos(z)*
-n,Math.sin(z)*n);x("inertiaPan",t.x,t.y)}function u(t,w){var n,r;if(L){n=w-X;if(n<f){r=v([M[0],t]);r>y.inertiaTrigger&&G(M[0],t,r,n)}}else{Y=t;var z=setInterval(function(){n=T5.time()-w;r=v([t,Y]);if(n<a&&r>y.inertiaTrigger){clearInterval(z);G(t,Y,r,n)}else n>a&&clearInterval(z)},5)}}function B(t){for(var w=[],n=K?-K.offsetLeft:0,r=K?-K.offsetTop:0,z=t.length;z--;)w.push(T5.V.offset(t[z],n,r));return w}function x(){ea&&ea.trigger.apply(null,arguments)}function D(t){if(t.target&&t.target===K){M=L?
g(t.touches):[o(t.pageX,t.pageY)];S=o();R=o();aa=true;H=false;X=T5.time();m(t);t.target.style.cursor="move";x("inertiaCancel");da=X;if(t=M.length>0?M[0]:null){x("touchStart",t.x,t.y);if(da-Z<h)if((t=U?T5.V.diff(M[0],U[0]):null)&&Math.abs(t.x)<y.maxDistDoubleTap&&Math.abs(t.y)<y.maxDistDoubleTap)H=true;E=e;U=[].concat(M)}else COG.Log.warn("Touch start fired, but no touch vector found")}}function A(t){if(t.target&&t.target===K){Y=(L?g(t.touches):[o(t.pageX,t.pageY)])[0];if(aa){L&&m(t);t=L?g(t.touches):
[o(t.pageX,t.pageY)];var w=0;if(t.length>1){if(M.length===1)M=[].concat(t);w=v(M)-v(t)}if(E===e){var n=c(t,M);if(n&&(Math.abs(n.x)>=k||Math.abs(n.y)>=k))E=j}if(E!==e)if(!w||Math.abs(w)<b){if(S=c(t,U)){R.x-=S.x;R.y-=S.y;V.x-=S.x;V.y-=S.y}if(T5.V.absSize(V)>i){x("pan",V.x,V.y);V=o()}E=j}else{x("pinchZoom",B(M),B(t));E=l}U=[].concat(t)}}}function J(t){if(t.target&&t.target===K){var w=(L?g(t.changedTouches):[o(t.pageX,t.pageY)])[0];L&&m(t);var n=T5.time();Z=da;if(E===e)O||(O=setTimeout(function(){O=0;
var r=H?"doubleTap":"tap",z=M[0],F=null;if(K)F=T5.V.offset(z,-K.offsetLeft,-K.offsetTop);x(r,z,F)},h+50));else if(E==j){x("panEnd",R.x,R.y);W&&u(w,n)}else E==l&&x("pinchZoomEnd",B(M),B(U),n-X);t.target.style.cursor="default";aa=false}}function I(t){if(t.target&&t.target===K){var w;if(t.detail){w=-t.detail*d;w=o(t.axis===1?w:0,t.axis===2?w:0)}else w=o(t.wheelDeltaX,t.wheelDeltaY);var n=w.y!==0?Math.abs(w.y/d):0;if(Y&&n!==0){var r=T5.V.offset(Y,-K.offsetLeft,-K.offsetTop);x("wheelZoom",r,Math.pow(2,
w.y>0?n:-n))}t.preventDefault()}}y=T5.ex({element:null,observable:null,inertiaTrigger:20,maxDistDoubleTap:20,touchStartHandler:null,moveHandler:null,moveEndHandler:null,pinchZoomHandler:null,pinchZoomEndHandler:null,tapHandler:null,doubleTapHandler:null,wheelZoomHandler:null},y);var H=false,O=0,N=T5.getConfig(),L=T5.getConfig().supportsTouch,M=null,U=null,S=null,R=null,V=o(),E=null,aa=false,X=0,T=[],Y=null,W=null,da=0,Z=0,K=y.element,ea=y.observable,ga={supportsTouch:L,addListeners:function(t){T.push(t)},
decoupleListeners:function(t){for(var w=0;t&&w<T.length;w++)if(T[w].listenerId===t){T.splice(w,1);break}},release:function(){N.eventTarget.removeEventListener(L?"touchstart":"mousedown",D,false);N.eventTarget.removeEventListener(L?"touchmove":"mousemove",A,false);N.eventTarget.removeEventListener(L?"touchend":"mouseup",J,false);if(!L){window.removeEventListener("mousewheel",I,false);window.removeEventListener("DOMMouseScroll",I,false)}},inertiaEnable:function(t,w){W={duration:t,max:w?Math.min(w.width,
w.height):500}},inertiaDisable:function(){W=null}};N.eventTarget.addEventListener(L?"touchstart":"mousedown",D,false);N.eventTarget.addEventListener(L?"touchmove":"mousemove",A,false);N.eventTarget.addEventListener(L?"touchend":"mouseup",J,false);if(!L){window.addEventListener("mousewheel",I,false);window.addEventListener("DOMMouseScroll",I,false)}return ga},P=[];T5.captureTouch=function(y,G){if(!y)throw Error("Unable to capture touch of null element");if(!y.id)y.id="touchable_"+s++;var u=P[y.id];
if(!u){u=new C(T5.ex({element:y},G));P[y.id]=u}G.listenerId&&u.decoupleListeners(G.listenerId);G.listenerId=++q;u.addListeners(G);return u};T5.resetTouch=function(y){if(y&&y.id&&P[y.id]){P[y.id].release();delete P[y.id]}}})();
(function(){var c=Math.PI*2,m=Math.PI/2,g=Math.abs,d=Math.pow,a=Math.sin,f=Math.asin,h=Math.cos,b=1.70158,i={linear:function(e,j,l,k){return l*e/k+j},backin:function(e,j,l,k){return l*(e/=k)*e*((b+1)*e-b)+j},backout:function(e,j,l,k){return l*((e=e/k-1)*e*((b+1)*e+b)+1)+j},backinout:function(e,j,l,k){return(e/=k/2)<1?l/2*e*e*(((b*=1.525)+1)*e-b)+j:l/2*((e-=2)*e*(((b*=1.525)+1)*e+b)+2)+j},bouncein:function(e,j,l,k){return l-i.bounceout(k-e,0,l,k)+j},bounceout:function(e,j,l,k){return(e/=k)<1/2.75?
l*7.5625*e*e+j:e<2/2.75?l*(7.5625*(e-=1.5/2.75)*e+0.75)+j:e<2.5/2.75?l*(7.5625*(e-=2.25/2.75)*e+0.9375)+j:l*(7.5625*(e-=2.625/2.75)*e+0.984375)+j},bounceinout:function(e,j,l,k){return e<k/2?i.bouncein(e*2,0,l,k)/2+j:i.bounceout(e*2-k,0,l,k)/2+l/2+j},cubicin:function(e,j,l,k){return l*(e/=k)*e*e+j},cubicout:function(e,j,l,k){return l*((e=e/k-1)*e*e+1)+j},cubicinout:function(e,j,l,k){if((e/=k/2)<1)return l/2*e*e*e+j;return l/2*((e-=2)*e*e+2)+j},elasticin:function(e,j,l,k,s,q){if(e==0)return j;if((e/=
k)==1)return j+l;q||(q=k*0.3);if(!s||s<g(l)){s=l;l=q/4}else l=q/c*f(l/s);return-(s*d(2,10*(e-=1))*a((e*k-l)*c/q))+j},elasticout:function(e,j,l,k,s,q){var o;if(e==0)return j;if((e/=k)==1)return j+l;q||(q=k*0.3);if(!s||s<g(l)){s=l;o=q/4}else o=q/c*f(l/s);return s*d(2,-10*e)*a((e*k-o)*c/q)+l+j},elasticinout:function(e,j,l,k,s,q){var o;if(e==0)return j;if((e/=k/2)==2)return j+l;q||(q=k*0.3*1.5);if(!s||s<g(l)){s=l;o=q/4}else o=q/c*f(l/s);if(e<1)return-0.5*s*d(2,10*(e-=1))*a((e*k-o)*c/q)+j;return s*d(2,
-10*(e-=1))*a((e*k-o)*c/q)*0.5+l+j},quadin:function(e,j,l,k){return l*(e/=k)*e+j},quadout:function(e,j,l,k){return-l*(e/=k)*(e-2)+j},quadinout:function(e,j,l,k){if((e/=k/2)<1)return l/2*e*e+j;return-l/2*(--e*(e-2)-1)+j},sinein:function(e,j,l,k){return-l*h(e/k*m)+l+j},sineout:function(e,j,l,k){return l*a(e/k*m)+j},sineinout:function(e,j,l,k){return-l/2*(h(Math.PI*e/k)-1)+j}};T5.easing=function(e){return i[e.replace(/[\-\_\s\.]/g,"").toLowerCase()]};T5.registerEasingType=function(e,j){i[e.replace(/[\-\_\s\.]/g,
"").toLowerCase()]=j}})();
T5.Tween=function(c){c=T5.ex({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:T5.easing("sine.out"),complete:null,cancelOnInteract:false},c);var m=T5.time(),g=[],d=false,a=0,f=0,h={cancelOnInteract:c.cancelOnInteract,isComplete:function(){return d},triggerComplete:function(b){c.complete&&c.complete(b)},update:function(b){try{var i=c.tweenFn(b-m,a,f,c.duration);if(c.target)c.target[c.property]=i;for(var e=g.length;e--;)g[e](i,void 0);if(d=m+c.duration<=b){if(c.target)c.target[c.property]=
c.tweenFn(c.duration,a,f,c.duration);for(var j=g.length;j--;)g[j](i,true)}}catch(l){COG.Log.exception(l)}},requestUpdates:function(b){g.push(b)}};a=c.target&&c.property&&c.target[c.property]?c.target[c.property]:c.startValue;if(typeof c.endValue!=="undefined")f=c.endValue-a;if(f==0)d=true;T5.wakeTweens();return h};
(function(){var c=[],m=false,g=0;T5.tweenValue=function(d,a,f,h,b){d=new T5.Tween({startValue:d,endValue:a,tweenFn:f,complete:h,duration:b});c.push(d);return d};T5.tween=function(d,a,f,h,b,i){d=new T5.Tween({target:d,property:a,endValue:f,tweenFn:h,duration:i,complete:b});c.push(d);return d};T5.tweenVector=function(d,a,f,h,b,i){var e=[];if(d){var j=d.x==a,l=d.y==f;j||e.push(T5.tween(d,"x",a,h,function(){(j=true)&&l&&b()},i));l||e.push(T5.tween(d,"y",f,h,function(){l=true;j&&l&&b()},i))}return e};
T5.cancelAnimation=function(d){if(!m){m=true;try{for(var a=0;a<c.length;)if(!d||d(c[a])){c[a].triggerComplete(true);c.splice(a,1)}else a++}finally{m=false}}};T5.isTweening=function(){return c.length>0};T5.wakeTweens=function(){if(g===0)g=setInterval(function(){var d;d=T5.time();if(!m){m=true;try{for(var a=0;a<c.length;)if(c[a].isComplete()){c[a].triggerComplete(false);c.splice(a,1)}else{c[a].update(d);a++}}finally{m=false}}d=c.length;if(d===0){clearInterval(g);g=0}},20)}})();
(function(){var c={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,PINCH:16,FREEZE:128};T5.viewState=function(){for(var m=0,g=arguments.length;g--;){var d=c[arguments[g].toUpperCase()];if(d)m|=d}return m}})();
T5.ViewLayer=function(c){c=T5.ex({id:"",zindex:0,supportFastDraw:false,validStates:T5.viewState("ACTIVE","ANIMATING","PAN","PINCH")},c);var m=null,g=c.id,d=T5.viewState("ACTIVE"),a=T5.ex({addToView:function(f){f.setLayer(g,a)},shouldDraw:function(f){var h=m?m.fastDraw&&f!==d:false;return(f&c.validStates)!==0&&(h?c.supportFastDraw:true)},cycle:function(){return 0},draw:function(){},remove:function(){COG.say("layer.remove",{id:g})},wakeParent:function(){m&&m.trigger("wake")},getId:function(){return g},
setId:function(f){g=f},getParent:function(){return m},setParent:function(f){m=f}},c);COG.observable(a);return a};
T5.View=function(c){function m(n,r,z,F){I=typeof z!=="undefined";K=da;v();w.updateOffset(y.x+n,y.y+r,z,F)}function g(n,r){c.inertia&&m(n,r,c.panAnimationEasing,c.panAnimationDuration)}function d(){K=W;I=false;setTimeout(v,50)}function a(n,r){R=ea(n);V=ea(r);var z=ga(R.dimensions),F=ga(V.dimensions);T=t(R);A=t(V);E=R&&z!==0?F/z:1}function f(n,r){a(n,r);if(S=E!==1){K=Z;v()}}function h(n,r,z){a(n,r);if(c.adjustScaleFactor){E=c.adjustScaleFactor(E);COG.Log.info("scale factor adjusted to: "+E)}if(z<c.pinchZoomAnimateTrigger){l(aa,
E,T,k(),T5.easing("sine.out"),function(){i();E=1},300);E=aa}else{i();E=1}}function b(n,r){w.zoom(n,Math.min(Math.pow(2,Math.round(Math.log(r))),8),500)}function i(){S=false;w.trigger("scale",E,R?k():A);K=W;v()}function e(){if(C){T5.resetTouch(C);if(c.autoSize){C.height=window.innerHeight-C.offsetTop;C.width=window.innerWidth-C.offsetLeft}try{P=C.getContext("2d");P.globalCompositeOperation="source-over";P.clearRect(0,0,C.width,C.height)}catch(n){COG.Log.exception(n);throw Error("Could not initialise canvas on specified view element");
}Y=T5.captureTouch(C,{observable:w});c.inertia&&Y.inertiaEnable(c.panAnimationDuration,x);x=w.getDimensions();for(var r=p.length;r--;)layerContextChange(p[r]);v()}}function j(n,r){r.setId(n);r.added=T5.time();r.trigger("contextChanged",P);r.setParent(w);p.push(r);p.sort(function(z,F){var Q=F.zindex-z.zindex;if(Q===0)Q=F.added-z.added;return Q})}function l(n,r,z,F,Q,$,ba){function fa(){$&&$();i();E=1;X=null}S=true;T=T5.V.copy(z);A=T5.V.copy(F);R=null;if(Q)T5.tweenValue(0,r-n,Q,fa,ba?ba:1E3).requestUpdates(function(ca){X=
ca/(r-n);E=n+ca;K=Z;v();w.trigger("animate")});else{E=targetScaleFactor;fa()}}function k(){var n=T5.D.getCenter(x),r=T5.V.distance([A,n]),z=T5.V.theta(A,n,r),F=T5.V.diff(T,A);n=T5.V.pointOnEdge(A,n,z,r/E);n.x+=F.x;n.y+=F.y;return n}function s(){w.trigger("idle");J=true;N=0}function q(n,r){var z=0,F=u?T5.viewState("FROZEN"):K,Q=T5.time(),$=(F&Z)!==0,ba=0;if(G||$){n.clearRect(0,0,C.width,C.height);G=false}if($){T5.D.getCenter(x);var fa=(X?X:1)/2,ca=T5.V.diff(T,A);if(M=R?new T5.Vector(A.x+ca.x,A.y+ca.y):
new T5.Vector(A.x-ca.x*fa,A.y-ca.y*fa))r=T5.V.offset(r,M.x,M.y)}n.save();try{aa=E;if(B!==1)n.scale(B,B);else if($){n.translate(A.x,A.y);n.scale(E,E)}for(ba=p.length;ba--;)if(p[ba].shouldDraw(F)){var ha=p[ba].draw(n,r,x,F,w);z+=ha?ha:0}}finally{n.restore()}COG.Log.trace("draw complete",Q);O=false;return z}function o(){var n=0,r=!I&&(K===Z||K===da);U=T5.time();y.x=Math.floor(y.x);y.y=Math.floor(y.y);if(r){T5.cancelAnimation(function(F){return F.cancelOnInteract});J=false;if(N!==0){clearTimeout(N);N=
0}}for(r=p.length;r--;){var z=p[r].cycle(U,y,K);n+=z?z:0}n+=q(P,y);H=0;if(D+n>0)v();else if(!J&&N===0)N=setTimeout(s,500);COG.Log.trace("Completed draw cycle",U)}function v(){D++;if(!(u||H!==0)){D=0;H=setTimeout(o,0)}}c=T5.ex({id:COG.objId("view"),container:"",fastDraw:false,inertia:true,pannable:true,scalable:true,panAnimationEasing:T5.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:false},c);var p=[],C=document.getElementById(c.container),P=
null,y=new T5.Vector,G=false,u=false,B=1,x=null,D=0,A=null,J=false,I=false,H=0,O=false,N=0,L=0,M=null,U=0,S=false,R=null,V=null,E=1,aa=1,X=null,T=null,Y=null,W=T5.viewState("ACTIVE"),da=T5.viewState("PAN"),Z=T5.viewState("PINCH"),K=W,ea=T5.V.getRect,ga=T5.D.getSize,t=T5.R.getCenter,w={id:c.id,deviceScaling:B,fastDraw:c.fastDraw||T5.getConfig().requireFastDraw,animate:function(n,r,z,F,Q){l(E,n,r,z,F,Q)},centerOn:function(n){w.setOffset(n.x-C.width/2,n.y-C.height/2)},getDimensions:function(){if(C)return new T5.Dimensions(C.width,
C.height)},getZoomCenter:function(){return M},getLayer:function(n){for(var r=0;r<p.length;r++)if(p[r].getId()==n)return p[r];return null},setLayer:function(n,r){for(var z=0;z<p.length;z++)if(p[z].getId()===n){p.splice(z,1);break}r&&j(n,r);v()},eachLayer:function(n){for(var r=0;r<p.length;r++)n(p[r])},clearBackground:function(){G=true},freeze:function(){u=true},unfreeze:function(){u=false;v()},needRepaint:function(){return O},snapshot:function(){},scale:function(n,r,z,F,Q){F||(F=T5.D.getCenter(x));
Q||(Q=T5.D.getCenter(x));w.animate(n,F,Q,r,z);return w},removeLayer:function(n){a:{for(var r=p.length;r--;)if(p[r].getId()==n){n=r;break a}n=-1}if(n>=0&&n<p.length){COG.say("layer.removed",{layer:p[n]});p.splice(n,1)}},getOffset:function(){return T5.V.copy(y)},setOffset:function(n,r){y.x=n;y.y=r},updateOffset:function(n,r,z,F,Q){function $(){d(0,0);Q&&Q()}if(z){n=new T5.Vector(n,r);z=T5.tweenVector(y,n.x,n.y,z,$,F);for(F=z.length;F--;){z[F].cancelOnInteract=true;z[F].requestUpdates(v)}}else w.setOffset(n,
r)},zoom:function(n,r,z){I=false;E=r;S=E!==1;T=T5.D.getCenter(w.getDimensions());A=E>1?T5.V.copy(n):T5.D.getCenter(w.getDimensions());R=null;clearTimeout(L);if(S){K=Z;v();if(z)L=setTimeout(function(){i();E=1},parseInt(z,10))}}};COG.listen("layer.remove",function(n){n.id&&w.removeLayer(n.id)});B=T5.getConfig().getScaling();COG.observable(w);w.bind("wake",v);w.bind("invalidate",function(){O=true});if(c.pannable){w.bind("pan",m);w.bind("panEnd",d);w.bind("inertiaPan",g);w.bind("inertiaCancel",function(){I=
false;v()})}if(c.scalable){w.bind("pinchZoom",f);w.bind("pinchZoomEnd",h);w.bind("wheelZoom",b)}COG.configurable(w,["inertia","container"],COG.paramTweaker(c,null,{container:function(n,r){C=document.getElementById(r);e()}}),true);e();return w};
T5.AnimatedPathLayer=function(c){function m(b,i,e){b.fillStyle="#FFFFFF";b.strokeStyle="#222222";b.beginPath();b.arc(e.x,e.y,4,0,Math.PI*2,false);b.stroke();b.fill()}c=T5.ex({path:[],id:COG.objId("pathAni"),easing:T5.easing("sine.inout"),validStates:T5.viewState("ACTIVE","PAN","PINCH"),drawIndicator:null,duration:2E3,autoCenter:false},c);var g=T5.V.edges(c.path),d,a=null,f=0;T5.tweenValue(0,g.total,c.easing,function(){h.remove()},c.duration).requestUpdates(function(b,i){f=b;i&&h.remove()});var h=T5.ex(new T5.ViewLayer(c),
{cycle:function(){for(var b=0;b<g.accrued.length&&g.accrued[b]<f;)b++;a=null;if(b<c.path.length-1){var i=f-(b>0?g.accrued[b-1]:0),e=c.path[b],j=c.path[b+1];d=T5.V.theta(e,j,g.edges[b]);a=T5.V.pointOnEdge(e,j,d,i);if(c.autoCenter)(b=h.getParent())&&b.centerOn(a)}return a?1:0},draw:function(b,i){if(a)(c.drawIndicator?c.drawIndicator:m)(b,i,new T5.Vector(a.x-i.x,a.y-i.y),d)}});return h};
(function(){T5.tileSize=256;T5.Tile=function(c){return c=T5.ex({x:0,y:0,gridX:0,gridY:0,dirty:false},c)};T5.ImageTile=function(c){c=T5.ex({url:"",sessionParamRegex:null,loaded:false},c);return new T5.Tile(c)}})();
T5.TileGrid=function(c){function m(u,B){var x=T5.Vector(u*b-j.x,B*b-j.y);return new T5.ImageTile({gridX:x.x,gridY:x.y})}function g(u,B,x,D){var A=Math.floor(c.gridSize*0.2),J=new T5.Vector;if(u<0||u+x>c.gridSize)J.x=u<0?-A:A;if(B<0||B+D>c.gridSize)J.y=B<0?-A:A;return J}function d(u,B,x){var D=COG.Log.getTraceTicks(),A=0,J=c.gridSize,I=c.tileSize;new T5.Vector(J/2,J/2);if(x)f=[];if(u)for(x=0;x<J;x++)for(var H=0;H<J;H++){if(!f[A]){var O=u(H,x,i,J);O.gridX=H*I-j.x;O.gridY=x*I-j.y;f[A]=O}A++}e=u;l=B;COG.Log.trace("tile grid populated",
D);G.dirty=true;G.wakeParent()}function a(u,B){if(y){var x,D=[],A=new T5.Vector(Math.floor((u.x+j.x)*s),Math.floor((u.y+j.y)*s));tilesNeeded=false;for(var J=P;J--;)for(var I=C;I--;){x=I+A.x>=0&&I+A.x<c.gridSize?f[(J+A.y)*c.gridSize+(I+A.x)]:null;var H=new T5.Vector(I-y.x,J-y.y);if(!x){p=g(A.x,A.y,C,P);x=m(I+A.x,J+A.y)}D.push({tile:x,centerness:T5.V.absSize(H)})}D.sort(function(O,N){return N.centerness-O.centerness});o||(o=Array(D.length));for(x=D.length;x--;){o[x]=D[x].tile;G.prepTile(o[x],B)}}}c=
T5.ex({tileSize:T5.tileSize,drawGrid:false,center:new T5.Vector,gridSize:25,shiftOrigin:null,supportFastDraw:true},c);var f=Array(Math.pow(c.gridSize,2)),h=c.gridSize,b=c.tileSize,i=T5.V.offset(c.center,-Math.ceil(c.gridSize>>1)),e=null,j=new T5.Vector,l=null,k=Math.round(c.tileSize/2),s=c.tileSize?1/c.tileSize:0,q=true,o=null,v=false;new T5.Vector;var p=new T5.Vector;T5.getConfig();h=h*c.tileSize;var C,P,y,G=T5.ex(new T5.ViewLayer(c),{gridDimensions:new T5.Dimensions(h,h),dirty:false,cycle:function(u,
B,x){u=0;if(p.x!==0||p.y!==0){var D=p,A=c.shiftOrigin;if(!(D.x===0&&D.y===0)){var J=COG.Log.getTraceTicks(),I=Array(f.length);I.length=f.length;for(var H=0;H<c.gridSize;H++)for(var O=0;O<c.gridSize;O++)I[O*c.gridSize+H]=H+D.x>=0&&H+D.x<c.gridSize?f[(O+D.y)*c.gridSize+(H+D.x)]:null;f=I;i=A?A(i,D):T5.V.add(i,D);j.x+=-D.x*c.tileSize;j.y+=-D.y*c.tileSize;COG.Log.trace("tile storage shifted",J);d(e,l)}p=new T5.Vector;u++}x!==T5.viewState("PINCH")&&a(B,x);return u+G.dirty?1:0},deactivate:function(){q=false},
find:function(u){if(!u)return null;for(var B=f.length;B--;){var x=f[B];if(x&&u(x))return x}return null},prepTile:function(){},drawTile:function(){return false},getTileSize:function(){return c.tileSize},draw:function(u,B,x,D,A){if(q){var J=T5.time(),I=B.x;B=B.y;var H=true,O=A.needRepaint()||D===T5.viewState("PAN")||D===T5.viewState("PINCH")||T5.isTweening();if(!y){C=Math.ceil(x.width*s)+1;P=Math.ceil(x.height*s)+1;y=new T5.Vector(Math.floor((C-1)/2),Math.floor((P-1)/2))}if(o){if(c.drawGrid)u.strokeStyle=
"rgba(50, 50, 50, 0.3)";u.beginPath();for(x=o.length;x--;){var N=o[x];if(N){var L=N.gridX-I,M=N.gridY-B;if(!(O?false:!N.dirty)){H=G.drawTile(u,N,L,M,D)&&H;N.x=L;N.y=M}}else H=false;c.drawGrid&&u.rect(L,M,c.tileSize,c.tileSize)}u.stroke();COG.Log.trace("drawn tiles",J);H&&!v&&A.trigger("tileDrawComplete");v=H;G.dirty=false}}},getTileAtXY:function(u,B){for(var x=c.tileSize,D=o?o.length:0;D--;){var A=o[D];if(A&&u>=A.x&&B>=A.y)if(u<=A.x+x&&B<=A.y+x)return A}return null},getTileVirtualXY:function(u,B,x){u=
T5.V.add(new T5.Vector(u,B),T5.V.invert(i),j);u=new T5.Vector(u.x*c.tileSize,u.y*c.tileSize);if(x){u.x+=k;u.y+=k}return u},populate:function(u){d(u,null,true)}});COG.listen("imagecache.cleared",function(){for(var u=f.length;u--;)if(f[u])f[u].loaded=false});COG.listen("tiler.repaint",function(){for(var u=f.length;u--;)if(f[u]){f[u].x=null;f[u].y=null}});return G};
T5.ImageTileGrid=function(c){function m(){l.getParent().trigger("invalidate");l.dirty=true;l.wakeParent()}c=T5.ex({emptyTile:function(k){if(!g||k!==g.width){g=T5.newCanvas(k,k);k=g.getContext("2d");k.fillStyle="rgba(150, 150, 150, 0.01)";k.fillRect(0,0,g.width,g.height)}return g}(T5.tileSize),panningTile:function(k){function s(){var q=T5.newCanvas(32,32),o=q.getContext("2d");o.fillStyle="#BBBBBB";o.fillRect(0,0,32,32);o.fillStyle="#C3C3C3";o.fillRect(0,0,16,16);o.fillRect(16,16,16,16);return q}if(!d||
k!==d.width){d=T5.newCanvas(k,k);k=d.getContext("2d");k.fillStyle=k.createPattern(s(),"repeat");k.fillRect(0,0,d.width,d.height)}return d}(T5.tileSize),tileOffset:new T5.Vector,tileDrawArgs:{}},c);var g=c.emptyTile,d=c.panningTile,a=T5.viewState("ACTIVE"),f=T5.viewState("PAN"),h=T5.getConfig().requireFastDraw,b=c.tileSize?c.tileSize:T5.tileSize,i=T5.Images.get,e=T5.Images.load,j=T5.ex({background:null,overlay:null,offset:new T5.Vector,realSize:new T5.Dimensions(b,b)},c.tileDrawArgs),l=T5.ex(new T5.TileGrid(c),
{drawTile:function(k,s,q,o,v){var p=s.url?i(s.url):null,C=false;if(p){k.drawImage(p,q,o);s.dirty=false;C=true}else if(v===f)d&&k.drawImage(d,q,o);else g&&k.drawImage(g,q,o);return C},prepTile:function(k,s){if(k)k.dirty=true;if(k&&(!h||s===a))i(k.url)||e(k.url,m,j)}});return l};
T5.Tiler=function(c){c=T5.ex({container:"",drawCenter:false,datasources:{},tileLoadThreshold:"first"},c);var m=T5.ex(new T5.View(c),{getTileLayer:function(){return m.getLayer("grid0")},setTileLayer:function(g){m.setLayer("grid0",g);COG.say("grid.updated",{id:"grid0"})},viewPixToGridPix:function(g){var d=m.getOffset();return new T5.Vector(g.x+d.x,g.y+d.y)},centerOn:function(g,d,a,f){var h=m.getTileLayer(),b=m.getDimensions();(h=h?h.getTileSize():0)&&m.updateOffset(g.gridX-Math.floor((b.width-h)*0.5),
g.gridY-Math.floor((b.height-h)*0.5),d,a,f)},cleanup:function(){m.removeLayer("grid0")},repaint:function(){COG.say("tiler.repaint");m.trigger("wake")},select:function(g){m.trigger("selectTile",g)}});m.bind("tap",function(g,d){var a=m.getTileLayer();if(a)(a=a.getTileAtXY(d.x,d.y))&&m.trigger("selectTile",a)});return m};
