COG=typeof COG!=="undefined"?COG:{};COG.extend=function(){for(var S=arguments[0]||{},Z,C=1,z=arguments.length;C<z;C++)if((Z=arguments[C])!==null)for(var r in Z){var t=Z[r];if(S!==t)if(t!==undefined)S[r]=t}return S};
(function(){var S=Object.prototype.hasOwnProperty,Z=0,C={};C.toID=function(z){return z.replace(/\s/g,"-")};C.objId=function(z){return(z?z:"obj")+Z++};C.isFunction=function(z){return toString.call(z)==="[object Function]"};C.isArray=function(z){return toString.call(z)==="[object Array]"};C.isPlainObject=function(z){if(!z||toString.call(z)!=="[object Object]"||z.nodeType||z.setInterval)return false;if(z.constructor&&!S.call(z,"constructor")&&!S.call(z.constructor.prototype,"isPrototypeOf"))return false;
var r;for(r in z);return r===undefined||S.call(z,r)};C.isEmptyObject=function(z){for(var r in z)return false;return true};C.isXmlDocument=function(z){return toString.call(z)==="[object Document]"};C.contains=function(z,r){var t=z,w=arguments,I=1;if(r&&module.isArray(r)){w=r;I=0}for(I=I;I<w;I++)t=t&&typeof foo[w[I]]!=="undefined";return t};C.formatStr=function(z){if(arguments.length<=1)return z;for(var r=arguments.length-2,t=0;t<=r;t++)z=z.replace(RegExp("\\{"+t+"\\}","gi"),arguments[t+1]);return z};
C.wordExists=function(z,r){var t="";if(r.toString)r=r.toString();for(var w=0;w<r.length;w++)t+=!/\w/.test(r[w])?"\\"+r[w]:r[w];return RegExp("(^|\\s|\\,)"+t+"(\\,|\\s|$)","i").test(z)};COG.extend(COG,C)})();
(function(){function S(t){return typeof console!=="undefined"?function(){console[t](Array.prototype.slice.call(arguments,0).join(" "));return true}:function(){return false}}var Z=window.console&&window.console.markTimeline,C=S("error"),z=S("info"),r=function(){return Z?function(t,w){console.markTimeline(t+(w?": "+((new Date).getTime()-w)+"ms":""))}:function(){}}();COG.extend(COG,{trace:r,debug:S("debug"),info:z,warn:S("warn"),error:C,exception:function(t){if(C)for(var w in t)z("ERROR DETAIL: "+w+
": "+t[w])}})})();
COG.Loopage=function(){function S(n){return COG.extend({id:t++,frequency:0,after:0,single:false,lastTick:0,execute:function(){}},n)}function Z(n){I.push(n);C()}function C(){ba&&clearTimeout(ba);ba=setTimeout(z,0);ha=true}function z(){for(var n,p=(new Date).getTime(),A=w.length;I.length>0;){var P=I.shift();for(n=A;n--;)if(w[n].id===P){w.splice(n,1);break}ha=true;A=w.length}if(ha){Q=r;for(n=A;n--;)Q=w[n].frequency<Q?w[n].frequency:Q}for(n=A;n--;){P=p-w[n].lastTick;if(w[n].lastTick===0||P>=w[n].frequency){w[n].execute(p,
w[n]);w[n].lastTick=p;w[n].single&&w[n].trigger("complete")}}ba=A?setTimeout(z,Q):0}var r=6E4,t=0,w=[],I=[],ba=0,Q=r,ha=true;return{join:function(n){var p=new S(n);if(p.after>0)p.lastTick=(new Date).getTime()+p.after;COG.observable(p);p.bind("complete",function(){Z(p.id)});w.unshift(p);C();return p},leave:Z}}();
(function(){function S(C,z){var r=C.obsHandlers;r[z]||(r[z]=[]);return r[z]}var Z=0;COG.observable=function(C){if(!C)return null;if(!C.obsHandlers)C.obsHandlers={};if(!(C.bind||C.trigger||C.unbind)){C.bind=function(z,r){var t="callback"+Z++;S(C,z).unshift({fn:r,id:t});return t};C.trigger=function(z){var r=S(C,z),t={cancel:false,name:z,tickCount:(new Date).getTime()},w;if(!r)return null;w=Array.prototype.slice.call(arguments,1);C.eventInterceptor&&C.eventInterceptor(z,t,w);w.unshift(t);for(var I=r.length;I--&&
!t.cancel;)r[I].fn.apply(self,w);return t};C.unbind=function(z,r){if(typeof z==="undefined")C.obsHandlers={};else for(var t=S(C,z),w=0;t&&w<t.length;w++)if(t[w].id===r){t.splice(w,1);break}return C}}return C}})();
(function(){function S(r,t){r[t]||(r[t]=function(w){return r.configure(t,w)})}function Z(r){r.gtConfId="configurable"+z++;r.gtConfig={};r.gtConfigFns=[];return r.gtConfig}var C={},z=0;COG.paramTweaker=function(r,t,w){return function(I,ba){if(typeof ba!=="undefined"){if(I in r)r[I]=ba;w&&I in w&&w[I](I,ba)}else return t&&I in t?t[I](I):r[I]}};COG.configurable=function(r,t,w,I){if(r){r.gtConfId||Z(r);var ba=r.gtConfId,Q=r.gtConfig,ha=r.gtConfigFns;C[ba]=r;ha.push(w);for(w=t.length;w--;){Q[t[w]]=true;
I&&S(r,t[w])}if(!r.configure)r.configure=function(n,p){if(Q[n]){for(var A=ha.length;A--;){var P=ha[A](n,p);if(typeof P!=="undefined")return P}return C[ba]}return null}}}})();
(function(){function S(r){var t=document.createElement("script"),w=false;t.src=r;t.async=true;t.onload=t.onreadystatechange=function(){if(!w&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){w=true;t.onload=t.onreadystatechange=null;t&&t.parentNode&&t.parentNode.removeChild(t)}};C||(C=document.getElementsByTagName("head")[0]);C.appendChild(t)}var Z=0,C,z=this;COG.jsonp=function(r,t,w){r+=r.indexOf("?")>=0?"&":"?";var I="json"+ ++Z;z[I]=function(ba){t(ba);z[I]=null;try{delete z[I]}catch(Q){}};
S(r+(w?w:"callback")+"="+I);return I}})();
(function(){function S(d){if(n)return Q.length;n=true;try{for(var l=0;l<Q.length;)if(Q[l].isComplete()){Q[l].triggerComplete(false);Q.splice(l,1)}else{Q[l].update(d);l++}}finally{n=false}Q.length===0&&ha.trigger("complete");return Q.length}function Z(){if(!ha){ha=COG.Loopage.join({execute:S,frequency:20});ha.bind("complete",function(){ha=null})}}var C=1.70158,z=Math.PI/2,r=Math.abs,t=Math.pow,w=Math.sin,I=Math.asin,ba=Math.cos,Q=[],ha=null,n=false,p={linear:function(d,l,m,y){return m*d/y+l},backin:function(d,
l,m,y){return m*(d/=y)*d*((C+1)*d-C)+l},backout:function(d,l,m,y){return m*((d=d/y-1)*d*((C+1)*d+C)+1)+l},backinout:function(d,l,m,y){return(d/=y/2)<1?m/2*d*d*(((C*=1.525)+1)*d-C)+l:m/2*((d-=2)*d*(((C*=1.525)+1)*d+C)+2)+l},bouncein:function(d,l,m,y){return m-p.bounceout(y-d,0,m,y)+l},bounceout:function(d,l,m,y){return(d/=y)<1/2.75?m*7.5625*d*d+l:d<2/2.75?m*(7.5625*(d-=1.5/2.75)*d+0.75)+l:d<2.5/2.75?m*(7.5625*(d-=2.25/2.75)*d+0.9375)+l:m*(7.5625*(d-=2.625/2.75)*d+0.984375)+l},bounceinout:function(d,
l,m,y){return d<y/2?p.bouncein(d*2,0,m,y)/2+l:p.bounceout(d*2-y,0,m,y)/2+m/2+l},cubicin:function(d,l,m,y){return m*(d/=y)*d*d+l},cubicout:function(d,l,m,y){return m*((d=d/y-1)*d*d+1)+l},cubicinout:function(d,l,m,y){if((d/=y/2)<1)return m/2*d*d*d+l;return m/2*((d-=2)*d*d+2)+l},elasticin:function(d,l,m,y,F,M){if(d==0)return l;if((d/=y)==1)return l+m;M||(M=y*0.3);if(!F||F<r(m)){F=m;m=M/4}else m=M/TWO_PI*I(m/F);return-(F*t(2,10*(d-=1))*w((d*y-m)*TWO_PI/M))+l},elasticout:function(d,l,m,y,F,M){var E;if(d==
0)return l;if((d/=y)==1)return l+m;M||(M=y*0.3);if(!F||F<r(m)){F=m;E=M/4}else E=M/TWO_PI*I(m/F);return F*t(2,-10*d)*w((d*y-E)*TWO_PI/M)+m+l},elasticinout:function(d,l,m,y,F,M){var E;if(d==0)return l;if((d/=y/2)==2)return l+m;M||(M=y*0.3*1.5);if(!F||F<r(m)){F=m;E=M/4}else E=M/TWO_PI*I(m/F);if(d<1)return-0.5*F*t(2,10*(d-=1))*w((d*y-E)*TWO_PI/M)+l;return F*t(2,-10*(d-=1))*w((d*y-E)*TWO_PI/M)*0.5+m+l},quadin:function(d,l,m,y){return m*(d/=y)*d+l},quadout:function(d,l,m,y){return-m*(d/=y)*(d-2)+l},quadinout:function(d,
l,m,y){if((d/=y/2)<1)return m/2*d*d+l;return-m/2*(--d*(d-2)-1)+l},sinein:function(d,l,m,y){return-m*ba(d/y*z)+m+l},sineout:function(d,l,m,y){return m*w(d/y*z)+l},sineinout:function(d,l,m,y){return-m/2*(ba(Math.PI*d/y)-1)+l}},A=COG.Tween=function(d){d=COG.extend({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:P("sine.out"),complete:null},d);var l=(new Date).getTime(),m=[],y=false,F=0,M=0,E={isComplete:function(){return y},triggerComplete:function(ja){d.complete&&d.complete(ja)},
update:function(ja){try{var X=d.tweenFn(ja-l,F,M,d.duration);if(d.target)d.target[d.property]=X;for(var na=m.length;na--;)m[na](X,void 0);if(y=l+d.duration<=ja){if(d.target)d.target[d.property]=d.tweenFn(d.duration,F,M,d.duration);for(var da=m.length;da--;)m[da](X,true)}}catch($){COG.exception($)}},requestUpdates:function(ja){m.push(ja)}};F=d.target&&d.property&&d.target[d.property]?d.target[d.property]:d.startValue;if(typeof d.endValue!=="undefined")M=d.endValue-F;if(M==0)y=true;Z();return E};COG.tweenValue=
function(d,l,m,y,F){d=new A({startValue:d,endValue:l,tweenFn:m,complete:y,duration:F});Q.push(d);return d};COG.tween=function(d,l,m,y,F,M){d=new A({target:d,property:l,endValue:m,tweenFn:y,duration:M,complete:F});Q.push(d);return d};COG.endTweens=function(d){if(!n){n=true;try{for(var l=0;l<Q.length;)if(!d||d(Q[l])){Q[l].triggerComplete(true);Q.splice(l,1)}else l++}finally{n=false}}};COG.getTweens=function(){return[].concat(Q)};var P=COG.easing=function(d){return p[d.replace(/[\-\_\s\.]/g,"").toLowerCase()]};
COG.registerEasingType=function(d,l){p[d.replace(/[\-\_\s\.]/g,"").toLowerCase()]=l}})();
INTERACT=function(){function S(n){return function(p,A,P){(P?P:n?document.body:document).addEventListener(p,A,false)}}function Z(n){return function(p,A,P){(P?P:n?document.body:document).removeEventListener(p,A,false)}}function C(n,p,A){(A?A:document).attachEvent("on"+n,p)}function z(n,p,A){(A?A:document).detachEvent("on"+n,p)}function r(n,p){return{x:n?n:0,y:p?p:0,count:1}}function t(n,p){Q.push(COG.extend({handler:null,checks:{},type:n},p))}function w(n){var p=0,A=0;if(n.offsetParent){do{p+=n.offsetLeft;
A+=n.offsetTop;n=n.offsetParent}while(n)}return{x:p,y:A}}function I(n,p){return{x:n.x-(p?p.x:0),y:n.y-(p?p.y:0)}}function ba(n){if(n.preventDefault){n.preventDefault();n.stopPropagation()}else n.cancelBubble&&n.cancelBubble()}var Q=[],ha=function(n,p,A){function P(F,M,E,ja){d.trigger("pan",ja.x,ja.y)}A=COG.extend({binder:null,unbinder:null,observable:null},A);for(var d=A.observable,l=[],m={bind:function(){return d.bind.apply(null,arguments)},pannable:function(F){COG.extend({inertia:true},F);d.bind("pointerMove",
P);return m},unbind:function(){d.unbind();for(var F=0;F<l.length;F++)l[F].unbind();return m}},y=0;y<p.length;y++)l.push(p[y](n,d,A));return m};t("pointer",{handler:function(n,p,A){function P(s){if(F(s))if(X=y(s)){n.style.cursor="move";ba(s);ea=s.pageX?s.pageX:s.screenX;U=s.pageY?s.pageY:s.screenY;na=r(ea,U);da=w(n);p.trigger("pointerDown",na,I(na,da))}}function d(s){$=s.pageX?s.pageX:s.screenX;aa=s.pageY?s.pageY:s.screenY;X&&F(s)&&M("pointerMove")}function l(s){if(X&&y(s)){X=false;if(F(s)){n.style.cursor=
"default";M("pointerUp")}}}function m(s){if(F(s)){var ga;s=s||window.event;if(s.detail)ga=s.axis===2?-s.detail*E:0;else{ga=s.wheelDeltaY?s.wheelDeltaY:s.wheelDelta;if(window.opera)ga=-ga}if(ga!==0){var ua=r($,aa);p.trigger("zoom",ua,I(ua,w(n)),ga/ja);ba(s);s.returnValue=false}}}function y(s){s=s||window.event;return(s.which||s.button)==1}function F(s){for(s=s.target?s.target:s.srcElement;s&&s.nodeName&&s.nodeName.toUpperCase()!="CANVAS";)s=s.parentNode;return s&&s===n}function M(s){var ga=r($,aa);
p.trigger(s,ga,I(ga,da),r($-ea,aa-U));ea=$;U=aa}A=COG.extend({inertia:false},A);var E=120,ja=E*8,X=false,na,da,$,aa,ea,U;A.binder("mousedown",P,false);A.binder("mousemove",d,false);A.binder("mouseup",l,false);A.binder("click",function(s){if(F(s)){s=r(s.pageX?s.pageX:s.screenX,s.pageY?s.pageY:s.screenY);p.trigger("tap",s,I(s,w(n)))}},false);A.binder("dblclick",function(s){COG.info("captured double click");if(F(s)){s=r(s.pageX?s.pageX:s.screenX,s.pageY?s.pageY:s.screenY);COG.info("captured double click + target matched");
p.trigger("doubleTap",s,I(s,w(n)))}},false);A.binder("mousewheel",m,document);A.binder("DOMMouseScroll",m,document);return{unbind:function(){A.unbinder("mousedown",P,false);A.unbinder("mousemove",d,false);A.unbinder("mouseup",l,false);A.unbinder("mousewheel",m,document);A.unbinder("DOMMouseScroll",m,document)}}},checks:{touch:false}});t("pointer",{handler:function(n,p,A){function P(H){if(H.count<2)return 0;var K=H.x-H.next.x;H=H.y-H.next.y;return~~Math.sqrt(K*K+H*H)}function d(H,K,R){K=K?K:0;R=R?
R:0;for(var ra={x:H.x-K,y:H.y-R,id:H.id,count:H.count},qa=ra;H.next;){H=H.next;qa=qa.next={x:H.x-K,y:H.y-R,id:H.id}}return ra}function l(H,K){var R=H[K?K:"touches"],ra,qa;if(R.length===0)return null;qa=ra={x:R[0].pageX,y:R[0].pageY,id:R[0].identifier,count:R.length};for(var va=1,Qa=R.length;va<Qa;va++)qa=qa.next={x:R[va].pageX,y:R[va].pageY,id:R[va].identifier};return ra}function m(H){var K=H.target?H.target:H.srcElement;if(K&&K===n){$=w(n);K=l(H,"changedTouches");var R=d(K,$.x,$.y);if(!ea){aa=X;
p.trigger("pointerDown",K,R)}ua&&p.trigger("pointerDownMulti",K,R);ea=l(H);if(ea.count>1)s=P(ea);wa=1;ga=d(ea)}}function y(H){var K=H.target?H.target:H.srcElement;if(K&&K===n){H.preventDefault();U=l(H);if(aa==X)aa=Math.abs(ea.x-U.x)>E||Math.abs(ea.y-U.y)>E?ja:X;if(aa!=X){aa=U.count>1?da:na;if(aa==da)if(ea.count===1){ea=d(U);s=P(ea)}else{H=P(U);if(Math.abs(s-H)<M)aa=na;else{K=U.x;var R=U.next.x,ra=U.y,qa=U.next.y,va=ra<qa?ra:qa;K={x:(K<R?K:R)+(Math.abs(K-R)>>1),y:va+(Math.abs(ra-qa)>>1)};H=H/s;R=H-
wa;p.trigger("zoom",K,I(K,$),R);wa=H}}aa==na&&p.trigger("pointerMove",U,d(U,$.x,$.y),r(U.x-ga.x,U.y-ga.y));ua&&p.trigger("pointerMoveMulti",U,d(U,$.x,$.y))}ga=d(U)}}function F(H){var K=H.target?H.target:H.srcElement;if(K&&K===n){K=l(H,"changedTouches");var R=d(K,$.x,$.y);U=l(H);if(!U){aa===X&&p.trigger("pointerTap",K,R);p.trigger("pointerUp",K,R);ea=null}ua&&p.trigger("pointerUpMulti",K,R)}}A=COG.extend({detailed:false,inertia:false},A);var M=20,E=7,ja=0,X=1,na=2,da=3,$,aa,ea,U,s,ga,ua=A.detailed,
wa=1;A.binder("touchstart",m,false);A.binder("touchmove",y,false);A.binder("touchend",F,false);COG.info("initialized touch handler");return{unbind:function(){A.unbinder("touchstart",m,false);A.unbinder("touchmove",y,false);A.unbinder("touchend",F,false)}}},checks:{touch:true}});return{register:t,watch:function(n,p,A){p=COG.extend({bindToBody:false,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},p);capabilities=COG.extend({touch:"ontouchstart"in window},A);if(!p.observable){COG.info("creating observable");
p.observable=COG.observable({});globalOpts=p}p.binder=p.isIE?C:S(p.bindToBody);p.unbinder=p.isIE?z:Z(p.bindToBody);A=p.types;for(var P=capabilities,d=[],l=Q.length;l--;){var m=Q[l],y=!A||A.indexOf(m.type)>=0,F=true;for(var M in m.checks){var E=m.checks[M];COG.info("checking "+M+" capability. require: "+E+", capability = "+P[M]);F=F&&E===P[M]}if(y&&F)d[d.length]=m.handler}return new ha(n,d,p)}}}();
T5=function(){function S(){return(new Date).getTime()}function Z(){for(;U.length>0;){var b=U.shift();document.location=b}ea=0}function C(b){for(var i=true,e=s.length;e--;)i=i&&b!=s[e];return i}function z(b,i){var e=[];for(var a in i)a&&e.push(a+"="+escape(i[a]));return"tile5://"+b+"/"+(e.length>0?"?"+e.join("&"):"")}function r(b,i){C(b)&&COG.info("would push url: "+z(b,i))}function t(b,i){if(C(b)){U.push(z(b,i));ea||(ea=setTimeout(Z,100))}}function w(b){return function(i,e,a){(a?a:b?document.body:
document).addEventListener(i,e,false)}}function I(b){return function(i,e,a){(a?a:b?document.body:document).removeEventListener(i,e,false)}}function ba(b,i,e){(e?e:document).attachEvent("on"+b,i)}function Q(b,i,e){(e?e:document).detachEvent("on"+b,i)}function ha(){da={base:{name:"Unknown",bindEvent:w(),unbindEvent:I(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:r,targetFps:null},ie:{name:"MSIE",regex:/msie/i,
bindEvent:ba,unbindEvent:Q,requireFastDraw:false,targetFps:25},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:t,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:t},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:t},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:w(true),unbindEvent:I(true),supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},
bridgeNotify:t},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:t}};$=[da.froyo,da.android,da.ipod,da.iphone,da.ipad,da.ie]}function n(){da||ha();if(!aa){COG.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var b=0;b<$.length;b++){var i=$[b];if(i.regex&&i.regex.test(navigator.userAgent)){aa=COG.extend({},da.base,i);COG.info("PLATFORM DETECTED AS: "+aa.name);break}}if(!aa){COG.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
aa=da.base}COG.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return aa}function p(){for(var b=0,i=arguments.length;i--;){var e=H[arguments[i].toUpperCase()];if(e)b|=e}return b}var A=Math.abs,P=Math.min,d=Math.max,l=Math.pow,m=Math.sqrt,y=Math.sin,F=Math.asin,M=Math.cos,E=function(){function b(a,c){return e(a.x-c.x,a.y-c.y)}function i(a,c){if(!c)c=a.length;if(c<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var f={edges:Array(c-1),accrued:Array(c-
1),total:0},g=0;g<c-1;g++){var j=b(a[g],a[g+1]);f.edges[g]=m(j.x*j.x+j.y*j.y);f.accrued[g]=f.total+f.edges[g];f.total+=f.edges[g]}return f}function e(a,c){return{x:a?a:0,y:c?c:0}}return{VECTOR_SIMPLIFICATION:3,SIMPLIFICATION_MIN_VECTORS:25,add:function(){for(var a=0,c=0,f=arguments.length;f--;){a+=arguments[f].x;c+=arguments[f].y}return e(a,c)},absSize:function(a){return d(A(a.x),A(a.y))},copy:function(a){return a?e(a.x,a.y):null},diff:b,distance:function(a,c){return i(a,c).total},edges:i,equals:function(a,
c){return a.x===c.x&&a.y===c.y},extendBy:function(a,c,f){var g=M(c)*f;c=y(c)*f;return e(a.x-g,a.y-c)},floor:function(a){for(var c=Array(a.length),f=a.length;f--;)c[f]=e(~~a[f].x,~~a[f].y);return c},getRect:function(a){for(var c,f,g,j,o=a.length;o--;){var h=a[o];c=typeof c==="undefined"||h.x<c?h.x:c;f=typeof f==="undefined"||h.y<f?h.y:f;g=typeof g==="undefined"||h.x>g?h.x:g;j=typeof j==="undefined"||h.y>j?h.y:j}return X.init(c,f,g,j)},init:e,invert:function(a){return e(-a.x,-a.y)},min:function(a,c){return e(a.x<
c.x?a.x:c.x,a.y<c.y?a.y:c.y)},max:function(a,c){return e(a.x>c.x?a.x:c.x,a.y>c.y?a.y:c.y)},offset:function(a,c,f){return e(a.x+c,a.y+(f?f:c))},simplify:function(a,c){if(!a)return null;c=c?c:E.VECTOR_SIMPLIFICATION;for(var f=[],g=null,j=a.length;j--;){var o=a[j];if(include=!g||j===0||A(o.x-g.x)+A(o.y-g.y)>c){f.unshift(o);g=o}}return f},theta:function(a,c,f){f=F((a.y-c.y)/f);return a.x>c.x?f:Math.PI-f}}}(),ja=function(){return{dotProduct:function(b,i){return b.x*i.x+b.y*i.y}}}(),X=function(){function b(e){return i(e.x1,
e.y1,e.x2,e.y2)}function i(e,a,c,f){e=e?e:0;a=a?a:0;c=typeof c!=="undefined"?c:e;f=typeof f!=="undefined "?f:f;return{x1:e,y1:a,x2:c,y2:f,width:c-e,height:f-a}}return{center:function(e){return E.init(e.x1+e.width/2,e.y1+e.height/2)},copy:b,diagonalSize:function(e){return m(e.width*e.width+e.height*e.height)},fromCenter:function(e,a,c,f){c=c>>1;f=f>>1;return i(e-c,a-f,e+c,a+f)},init:i,intersect:function(e,a){var c=d(e.x1,a.x1),f=d(e.y1,a.y1),g=P(e.x2,a.x2),j=P(e.y2,a.y2);c=i(c,f,g,j);return c.width>
0&&c.height>0?c:null},union:function(e,a){if(e.width===0||e.height===0)return b(a);else if(a.width===0||a.height===0)return b(e);else{var c=P(e.x1,a.x1),f=P(e.y1,a.y1),g=d(e.x2,a.x2),j=d(e.y2,a.y2);c=i(c,f,g,j);return c.width>0&&c.height>0?c:null}}}}(),na=function(){return{getAspectRatio:function(b){return b.height!==0?b.width/b.height:1},getCenter:function(b){return E.init(b.width>>1,b.height>>1)},getSize:function(b){return m(l(b.width,2)+l(b.height,2))},init:function(b,i){b=b?b:0;return{width:b,
height:i?i:b}}}}(),da=null,$=[],aa=null,ea=0,U=[],s=["view.wake","tile.loaded"],ga=function(){function b(){if(!B){var q=n().maxImageLoads;B=COG.Loopage.join({execute:function(D,O){if(!q||h.length<q){var J=o.shift();if(J){h[h.length]=J;J.image.onload=e;J.image.src=J.url;J.requested=T5.ticks()}else O.trigger("complete")}},frequency:10});B.bind("complete",function(){B=null})}}function i(){L=true;try{var q=k.length>>1;if(q>0){k.sort(function(O,J){return O.created-J.created});for(var D=q;D--;)delete f[k[D].url];
k.splice(0,q)}}finally{L=false}N.trigger("cacheCleared")}function e(){var q=g[this.id],D;if(q&&q.image.complete&&q.image.width>0){q.loaded=true;q.hitCount=1;for(D=h.length;D--;)if(h[D].image.src==this.src){h.splice(D,1);break}if(q.background||q.postProcess||q.drawBackground||q.customDraw)if(q.image){globalImageData=q;D=c(q.realSize?q.realSize.width:q.image.width,q.realSize?q.realSize.height:q.image.height);var O=D.getContext("2d"),J=q.offset?q.offset:T5.XY.init();q.background&&O.drawImage(q.background,
0,0);q.drawBackground&&q.drawBackground(O);q.customDraw?q.customDraw(O,q):O.drawImage(q.image,J.x,J.y);q.postProcess&&q.postProcess(O,q);q.image=D}for(D=q.callbacks.length;D--;)q.callbacks[D]&&q.callbacks[D](this,false);q.callbacks=[];k[k.length]={url:this.src,created:q.requested};delete g[this.id];b()}}function a(q,D,O){var J=f[q];if(J){J.hitCount++;J.image.complete&&J.image.width>0&&D?D(J.image,true):J.callbacks.push(D)}else{J=COG.extend({url:q,image:new Image,loaded:false,created:T5.ticks(),requested:null,
hitCount:0,callbacks:[D]},O);J.image.id="resourceLoaderImage"+j++;f[q]=J;g[J.image.id]=J;o[o.length]=J;b()}return J}function c(q,D){var O=document.createElement("canvas");COG.info("creating new canvas");O.width=q?q:0;O.height=D?D:0;if(typeof FlashCanvas!="undefined"){document.body.appendChild(O);FlashCanvas.initElement(O)}return O}var f={},g={},j=0,o=[],h=[],k=[],u=0,B=null,L=false,N={avgImageSize:25,loadTimeout:10,cancelLoad:function(){h=[]},get:function(q,D,O){var J=null,ka=null;L||(J=f[q]);if((ka=
J?J.image:null)&&(ka.getContext||ka.complete&&ka.width>0))return ka;else D&&a(q,D,O);return null},load:a,newCanvas:c,reset:function(){f={}},stats:function(){return{imageLoadingCount:h.length,queuedImageCount:o.length,imageCacheFullness:u}}};COG.observable(N);COG.Loopage.join({execute:function(q){for(var D=false,O=0,J=n();O<h.length;)if(q-h[O].requested>N.loadTimeout*1E3){h.splice(O,1);D=true}else O++;D&&b();if(J&&J.imageCacheMaxSize){u=k.length*N.avgImageSize/J.imageCacheMaxSize;u>=1&&i()}},frequency:2E4});
return N}(),ua=function(){var b={};return{init:function(i,e){var a=b[i];if(!a)throw Error("Unable to locate requested generator: "+i);return new a(e)},register:function(i,e){b[i]=e},Template:function(){}}}(),wa=function(){function b(g,j){c[g]=e(j);return g}function i(g){for(var j in g)b(j,g[j])}function e(g){function j(u){var B=g[u];typeof B!=="undefined"&&h.push(function(L){L[u]=B})}function o(){h=[];for(var u in g)j(u)}g=COG.extend({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,
lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},g);var h=[],k={applyToContext:function(u){for(var B=h.length;B--;)h[B](u)},update:function(u,B){g[u]=B;o()}};o();return k}var a={},c={},f={apply:function(g,j){var o=c[j]?c[j]:c.basic,h;if(g&&g.canvas){h=a[g.canvas.id];a[g.canvas.id]=j}o.applyToContext(g);return h},define:b,defineMany:i,get:function(g){return c[g]},init:e,load:function(g){COG.jsonp(g,function(j){i(j)})}};i({basic:{lineWidth:1,strokeStyle:"#000",
fillStyle:"#fff"},waypoints:{lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"}});return f}(),H={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,ZOOM:16,FREEZE:128},K=function(b){b=COG.extend({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:p("ACTIVE","ANIMATING","PAN","ZOOM"),style:null,minXY:null,maxXY:null},b);var i=null,e=false,a=false,c=b.supportFastDraw,f=b.id,g=p("ACTIVE"),j=b.validStates,o=0,h=0,k=COG.extend({addToView:function(u){u.setLayer(f,k)},shouldDraw:function(u,B,
L){return(a||L||o!==B.x1||h!==B.y1)&&(u&j)!==0&&(e?c:true)},clip:null,cycle:function(){},draw:function(){},remove:function(){k.trigger("remove",k)},changed:function(u){a=true;k.trigger("changed",k);i&&i.trigger("invalidate",u)},getId:function(){return f},setId:function(u){f=u},getParent:function(){return i},setParent:function(u){e=(i=u)?i.fastDraw&&displayState!==g:false;k.trigger("parentChange",i)}},b);COG.observable(k);k.bind("drawComplete",function(u,B){a=false;o=B.x1;h=B.y1});k.bind("resync",
function(u,B){if(B.syncXY){k.minXY&&B.syncXY(k.minXY);k.maxXY&&B.syncXY(k.maxXY)}});return k},R=function(b){function i(o,h,k,u){a=o;c=h;f=k;g=u}b=COG.extend({xy:E.init(),offset:true,tweenIn:null,animationSpeed:null,isNew:true},b);var e=false,a=0,c=0,f=0,g=0,j=COG.extend(b,{isAnimating:function(){return e},draw:function(o,h,k,u,B){if(j.isNew&&b.tweenIn){var L=j.xy.y;j.xy.y=h.y1-20;e=true;COG.tween(j.xy,"y",L,b.tweenIn,function(){j.xy.y=L>>0;e=false},b.animationSpeed?b.animationSpeed:250+Math.random()*
500)}j.drawMarker(o,h,j.xy.x,j.xy.y,k,u,B);j.isNew=false},drawMarker:function(o,h,k,u){o.beginPath();o.arc(k,u,4,0,Math.PI*2,false);o.fill();i(k-4,u-4,8,8)},hitTest:function(o,h){return o>=a&&o<=a+f&&h>=c&&h<=c+g},updateBounds:i});COG.observable(j);return j},ra=function(b){function i(){c.changed();c.trigger("markerUpdate",a)}function e(){var f=c.getParent();if(f&&f.syncXY)for(var g=a.length;g--;)f.syncXY([a[g].xy])}b=COG.extend({zindex:100,style:"basic"},b);var a=[],c=COG.extend(new K(b),{draw:function(f,
g,j,o){for(var h=a.length;h--;)a[h].draw(f,g,j,c,o)},add:function(f){if(f&&typeof f.length!=="undefined")for(var g=f.length;g--;){if(f[g])a[a.length]=f[g]}else if(f)a[a.length]=f;i()},clear:function(f){if(f)for(var g=0;g<a.length;)if(f(a[g]))a.splice(g,1);else g+=1;else a=[];i()},each:function(f){if(f)for(var g=a.length;g--;)f(a[g])},find:function(f){for(var g=[],j=a.length;j--;)if(!f||f(a[j]))g[g.length]=a[j];return g}});c.bind("tap",function(f,g,j,o){var h=[],k=o.x;o=o.y;for(var u=a.length;u--;)if(a[u].hitTest(k,
o))h[h.length]=a[u];if(h.length>0)f.cancel=c.trigger("markerTap",g,j,h).cancel});c.bind("parentChange",e);c.bind("resync",e);c.bind("changed",e);return c},qa=function(b){function i(j,o,h){j.fillStyle="#FFFFFF";j.strokeStyle="#222222";j.beginPath();j.arc(h.x,h.y,4,0,Math.PI*2,false);j.stroke();j.fill()}b=COG.extend({path:[],id:COG.objId("pathAni"),easing:COG.easing("sine.inout"),validStates:p("ACTIVE","PAN","ZOOM"),drawIndicator:null,duration:2E3},b);var e=E.edges(b.path),a,c=null,f=0;COG.tweenValue(0,
e.total,b.easing,function(){g.remove()},b.duration).requestUpdates(function(j,o){f=j;o&&g.remove()});var g=COG.extend(new K(b),{cycle:function(){for(var j=0;j<e.accrued.length&&e.accrued[j]<f;)j++;c=null;if(j<b.path.length-1){var o=f-(j>0?e.accrued[j-1]:0),h=b.path[j];a=E.theta(h,b.path[j+1],e.edges[j]);c=E.extendBy(h,a,o)}return c},draw:function(j,o){if(c)(b.drawIndicator?b.drawIndicator:i)(j,o,E.init(c.x,c.y),a)}});return g},va=function(b){b=COG.extend({style:null,properties:{}},b);return COG.extend(b,
{rect:null,draw:function(){},resync:function(){}})},Qa=function(){return{tileSize:256,init:function(b,i,e,a,c){return COG.extend({x:b,y:i,width:e,height:a},c)}}}(),Ra={ex:COG.extend,ticks:S,getConfig:n,userMessage:function(b,i,e){Ra.trigger("userMessage",b,i,e)},zoomable:function(b,i){function e(c,f){if(c&&a!==c){var g=b.triggerAll("zoomLevelChange",c,f);if(g)a=c;return g}}i=COG.extend({initial:1,min:0,max:null,zoomAnimation:COG.easing("quad.out")},i);var a=i.initial;COG.extend(b,{getZoomLevel:function(){return a},
setZoomLevel:e});b.bind("scale",function(c,f,g){var j=Math.log(f)/Math.LN2;COG.endTweens(function(o){return o.cancelOnInteract});c.cancel=!e(a+j,g);c.cancel||b.updateOffset(g.x*f,g.y*f)})},XY:E,XYRect:X,Dimensions:na,Vector:ja,D:na,Images:ga,Generator:ua,tween:COG.tween,tweenValue:COG.tweenValue,easing:COG.easing,Tween:COG.Tween,Style:wa,viewState:p,View:function(b){function i(x,v,G,T){ya=La;D();if(T&&b.inertia)h(oa-v,pa-G,b.panAnimationEasing,b.panAnimationDuration);else T||h(oa-v,pa-G);clearTimeout(Za);
Za=setTimeout(e,100)}function e(){ya=Sa;Ca=false;D()}function a(x,v,G,T){J(Math.max(ca+Math.pow(2,T)-1,0.25))}function c(x){var v=Math.log(ca)/Math.LN2>>0;if(ca!==1)ya=$a;if(v!==0){ca=Math.pow(2,v);v=E.init(Ma-(Da/ca>>0),Na-(Ea/ca>>0));if(!ia.trigger("scale",ca,v).cancel){for(x=V.length;x--;)V[x].trigger("scale",ca,v);ca=1;eb=null;ya=Sa;x=true}}D(x)}function f(x){x||(x=E.init(Da,Ea));Ta=E.init(oa,pa);Ka=E.offset(x,oa,pa);Ma=Ka.x;Na=Ka.y}function g(x,v,G){ka("doubleTap",v,G,E.offset(G,oa,pa));if(b.scalable){COG.endTweens(function(T){return T.cancelOnInteract});
J(2,G,b.zoomAnimation)}}function j(){clearTimeout(ab);ab=setTimeout(k,250)}function o(x,v,G){ka("tap",v,G,E.offset(G,oa,pa))}function h(x,v,G,T,W){function fa(){xa+=1;if(xa>=2){e();W&&W()}}var xa=0,Aa=Fa?E.offset(Fa,-Da,-Ea):null,Ba=Ga?E.offset(Ga,-Da,-Ea):null;if(Aa){x=x<Aa.x?Aa.x:x;v=v<Aa.y?Aa.y:v}if(Ba){x=x>Ba.x?Ba.x:x;v=v>Ba.y?Ba.y:v}if(G){if(!Ca){x=COG.tweenValue(oa,x,G,fa,T);v=COG.tweenValue(pa,v,G,fa,T);x.cancelOnInteract=true;x.requestUpdates(function(Ia){oa=Ia>>0;Ca=true;D()});v.cancelOnInteract=
true;v.requestUpdates(function(Ia){pa=Ia>>0;Ca=true;D()})}}else{oa=x>>0;pa=v>>0}}function k(x,v){var G;if(la){za&&za.unbind();if(b.autoSize&&la.parentNode){G=la.parentNode.getBoundingClientRect();x=G.right-G.left;v=G.bottom-G.top}try{if(!la.id)la.id=b.id+"_canvas";Y=la.getContext("2d")}catch(T){COG.exception(T);throw Error("Could not initialise canvas on specified view element");}if(x&&v&&(sa!==v||ta!==x)){Ua=true;ta=x;sa=v;Da=ta>>1;Ea=sa>>1;ia.trigger("resize",ta,sa);for(G=ma;G--;)V[G].trigger("resize",
ta,sa)}if(b.interactive){za=INTERACT.watch(la).pannable();B()}for(G=ma;G--;)V[G].trigger("contextChanged",Y);D(true)}}function u(x,v){v.setId(x);v.added=S();v.bind("remove",function(){ia.removeLayer(x)});v.trigger("contextChanged",Y);v.setParent(ia);V.push(v);V.sort(function(G,T){var W=T.zindex-G.zindex;if(W===0)W=T.added-G.added;return W});ma=V.length;return v}function B(){if(za){if(b.pannable){za.bind("pan",i);za.bind("inertiaCancel",function(){Ca=false;D()})}if(b.scalable){za.bind("zoom",a);za.bind("doubleTap",
g)}za.bind("tap",o)}}function L(){ka("idle",ia);Va=true;Ja=0}function N(x,v,G,T){var W,fa=0;Ha=X.copy(v);G&&Y.clearRect(0,0,ta,sa);Y.save();try{Y.globalCompositeOperation="source-over";if(ca!==1){var xa=Ha,Aa=1/ca;Ma=Ka.x+(oa-Ta.x);Na=Ka.y+(pa-Ta.y);Ha=xa?X.fromCenter(Ma>>0,Na>>0,xa.width*Aa>>0,xa.height*Aa>>0):void 0;Y.scale(ca,ca)}Y.translate(-Ha.x1,-Ha.y1);Ga=Fa=null;if(fb){Y.beginPath();clipped=false;for(fa=ma;fa--;)if(V[fa].clip){V[fa].clip(Y,Ha,x,ia,G,T);clipped=true}Y.closePath();clipped&&
Y.clip()}for(fa=ma;fa--;){W=V[fa];var Ba=W.style,Ia=Ba?wa.apply(Y,Ba):null;if(W.minXY)Fa=Fa?E.min(Fa,W.minXY):E.copy(W.minXY);if(W.maxXY)Ga=Ga?E.max(Ga,W.maxXY):E.copy(W.maxXY);W.draw(Y,Ha,x,ia,G,T);Ia&&wa.apply(Y,Ia)}}finally{Y.restore()}if(gb){Y.globalCompositeOperation="source-over";Y.strokeStyle="#f00";Y.beginPath();Y.moveTo(Da,0);Y.lineTo(Da,sa);Y.moveTo(0,Ea);Y.lineTo(ta,Ea);Y.stroke()}ka("drawComplete",v,T);COG.trace("draw complete",T)}function q(x,v){var G=false,T=Wa?Wa:Ca?La:ya,W=!Ca&&(T===
$a||T===La),fa=Xa||T===La||COG.getTweens().length>0;if(Ua&&la){typeof FlashCanvas!="undefined"&&FlashCanvas.initElement(la);la.width=ta;la.height=sa;la.style.width=ta+"px";la.style.height=sa+"px";Ua=false}Oa=O();if(W){COG.endTweens(function(xa){return xa.cancelOnInteract});Va=false;if(Ja!==0){clearTimeout(Ja);Ja=0}}for(W=ma;W--;){if(V[W].animated)ya|=bb;V[W].cycle(x,Oa,ya,fa);G=V[W].shouldDraw(ya,Oa,fa)||G}fa=fa||(ya&bb)!==0;if(G=G||fa||ca!==1&&ca!==cb){N(T,Oa,fa,x);cb=ca;Xa=false}if(!G&&Ya===0&&
!hb){if(!Va&&Ja===0)Ja=setTimeout(L,500);v.trigger("complete")}Ya=0;COG.trace("Completed draw cycle",x)}function D(x){Xa=x?true:false;Ya+=1;if(!Pa){Pa=COG.Loopage.join({execute:q,frequency:ib});Pa.bind("complete",function(){Pa=null})}}function O(){return X.init(oa,pa,oa+ta,pa+sa)}function J(x,v,G,T){function W(){ca=Math.pow(2,Math.round(Math.log(ca)/Math.LN2));T&&T();c(true)}var fa=ca;f(v);if(G)COG.tweenValue(0,x-fa,G,W,1E3).requestUpdates(function(xa){ca=fa+xa;c()});else{ca=x;c()}return ia}function ka(){for(var x=
ia.trigger.apply(null,arguments).cancel,v=V.length;v--;)x=V[v].trigger.apply(null,arguments).cancel||x;return!x}b=COG.extend({id:COG.objId("view"),container:"",fastDraw:false,inertia:true,pannable:true,clipping:false,scalable:true,interactive:true,panAnimationEasing:COG.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:true,tapExtent:10,mask:true,guides:false,fps:25,zoomAnimation:COG.easing("quad.out")},b);var V=[],ma=0,la=document.getElementById(b.container),
Y=null,jb=typeof window.attachEvent!="undefined",oa=0,pa=0,fb=b.clipping,Oa=null,Pa=null,Ha,gb=b.guides,db=1,Ya=0,Da=0,Ea=0,Ta=null,Ka=null,Va=false,Ca=false,Ja=0,Za=0,Fa=null,Ga=null,kb=0,Wa=null,Xa=false,ab=0,eb=null,ca=1,cb=0,Ua=false,za=null,sa,ta,hb=typeof FlashCanvas!=="undefined",ib=~~(1E3/b.fps),Ma,Na,Sa=p("ACTIVE"),La=p("PAN"),$a=p("ZOOM"),bb=p("ANIMATING"),ya=Sa,ia={id:b.id,deviceScaling:db,fastDraw:b.fastDraw||n().requireFastDraw,getDimensions:function(){return na.init(ta,sa)},getLayer:function(x){for(var v=
0;v<ma;v++)if(V[v].getId()==x)return V[v];return null},setLayer:function(x,v){for(var G=0;G<ma;G++)if(V[G].getId()===x){V.splice(G,1);break}v&&u(x,v);D();return v},eachLayer:function(x){for(var v=ma;v--;)x(V[v])},invalidate:D,resize:function(x,v){if(la){b.autoSize=false;if(ta!==x||sa!==v)k(x,v)}},scale:J,triggerAll:ka,removeLayer:function(x){a:{for(var v=ma;v--;)if(V[v].getId()==x){x=v;break a}x=-1}if(x>=0&&x<ma){ia.trigger("layerRemoved",V[x]);V.splice(x,1);D()}ma=V.length},stateOverride:function(x){Wa=
x},getOffset:function(){return E.init(oa,pa)},getViewRect:O,updateOffset:h,pan:function(x,v,G,T,W){h(oa+x,pa+v,G,T,W)}};db=n().getScaling();ia.markers=u("markers",new ra);COG.observable(ia);ia.bind("invalidate",function(x,v){D(v)});ia.bind("resync",function(){Ga=Fa=null});COG.configurable(ia,["inertia","container","rotation","tapExtent","scalable","pannable"],COG.paramTweaker(b,null,{container:function(x,v){la=document.getElementById(v);k()},rotation:function(x,v){kb=v}}),true);k();if(b.autoSize)jb?
window.attachEvent("onresize",j):window.addEventListener("resize",j,false);return ia},ViewLayer:K,ImageLayer:function(b,i){function e(h,k,u){for(k=f.length;k--;){var B=f[k],L=B.x,N=B.y,q=X.init(B.x,B.y,B.x+B.width,B.y+B.height);if(u&&X.intersect(h,q)){q=ga.get(B.url,function(){o.changed()},j);u(q,L,N,B.width,B.height)}}}function a(h){c&&c.run(h,function(k){f=[].concat(k);o.changed()})}i=COG.extend({imageLoadArgs:{}},i);var c=b?ua.init(b,i):null,f=[],g=X.init(),j=i.imageLoadArgs,o=COG.extend(new K(i),
{changeGenerator:function(h,k){c=ua.init(h,COG.extend({},i,k));c.bindToView(o.getParent());f=null;a(g)},clip:function(h,k,u){e(k,u,function(B,L,N,q,D){B&&h.rect(L,N,q,D)})},cycle:function(h,k){a(k)},draw:function(h,k,u){e(k,u,function(B,L,N,q,D){o.drawImage(h,B,L,N,q,D,k,u)});g=X.copy(k)},drawImage:function(h,k,u,B){k&&h.drawImage(k,u,B,k.width,k.height)}});o.bind("idle",function(){a(g)});o.bind("parentChange",function(h,k){c&&c.bindToView(k)});o.bind("tap",function(h,k,u,B){h=[];var L=B.x,N=B.y,
q,D;if(f)for(var O=f.length;O--;){q=f[O];if(D=L>=q.x&&L<=q.x+q.width&&N>=q.y&&N<=q.y+q.height)h[h.length]=q}h.length>0&&o.trigger("tapImage",h,k,u,B)});return o},Marker:R,ImageMarker:function(b){b=COG.extend({image:null,imageUrl:null,animatingImage:null,animatingImageUrl:null,imageAnchor:null,rotation:0,scale:1,opacity:1},b);var i=b.imageAnchor?T5.XY.invert(b.imageAnchor):null,e=COG.extend(new R(b),{drawMarker:function(a,c,f,g){if((c=e.isAnimating()&&e.animatingImage?e.animatingImage:e.image)&&c.width>
0){i||(i=E.init(-c.width>>1,-c.height>>1));var j=e.scale,o=f+~~(i.x*j),h=g+~~(i.y*j),k=~~(c.width*j),u=~~(c.height*j);e.updateBounds(o,h,k,k);if(e.rotation||e.opacity!==1){a.save();try{a.globalAlpha=e.opacity;a.translate(f,g);a.rotate(e.rotation);a.drawImage(c,i.x*j,i.y*j,k,u)}finally{a.restore()}}else a.drawImage(c,o,h,k,u)}}});if(!e.image)e.image=ga.get(b.imageUrl,function(a){e.image=a});if(!e.animatingImage)e.animatingImage=ga.get(b.animatingImageUrl,function(a){e.animatingImage=a});return e},
MarkerLayer:ra,PathLayer:function(b){b=COG.extend({style:"waypoints",pixelGeneralization:8,zindex:50},b);var i=false,e=[],a=null,c=[],f=null,g=0,j=[],o=COG.extend(new K(b),{getAnimation:function(h,k,u,B){var L="pathAnimation"+g++;j.push(L);return new qa({id:L,path:e,zindex:b.zindex+1,easing:h?h:COG.easing("sine.inout"),duration:k?k:5E3,drawIndicator:u,autoCenter:B?B:false})},cycle:function(h,k,u,B){return B},draw:function(h){var k,u=e.length;h.save();try{wa.apply(h,b.style);if(u>0){h.beginPath();
h.moveTo(e[u-1].x,e[u-1].y);for(k=u;k--;)h.lineTo(e[k].x,e[k].y);h.stroke();if(a){h.fillStyle=b.waypointFillStyle;for(k=a.length;k--;){h.beginPath();h.arc(a[k].x,a[k].y,2,0,Math.PI*2,false);h.stroke();h.fill()}}}}finally{h.restore()}i=false},updateCoordinates:function(h,k){c=h;f=k;var u=o.getParent();if(u&&u.syncXY){u.syncXY(c);f&&u.syncXY(f);o.trigger("tidy")}}});o.bind("tidy",function(){e=E.simplify(c,b.pixelGeneralization);a=E.simplify(f,b.pixelGeneralization);i=true;o.changed()});return o},AnimatedPathLayer:qa,
Shape:va,Arc:function(b,i){i=COG.extend({size:4},i);var e=E.init(),a=COG.extend(i,{draw:function(c){c.beginPath();c.arc(e.x,e.y,a.size,0,Math.PI*2,false);c.fill();c.stroke()},resync:function(c){c.syncXY([b]);e=E.floor([b])[0]}});COG.info("created arc = ",b);return a},Poly:function(b,i){i=COG.extend({fill:false,simplify:false},i);var e=false,a=i.fill,c=i.simplify,f=p("ZOOM"),g=[],j=COG.extend(new va(i),{draw:function(o,h,k,u,B,L){if(e){h=true;k=(L&f)!==0;o.beginPath();for(L=g.length;L--;){k=g[L].x;
u=g[L].y;if(h){o.moveTo(k,u);h=false}else o.lineTo(k,u);k=true}if(k){a&&o.fill();o.stroke()}}},resync:function(o){j.xy=o.syncXY(b);g=E.floor(c?E.simplify(b):b)}});e=b&&b.length>=2;return j},ShapeLayer:function(b){function i(f){for(var g=a.length;g--;)a[g].resync(f);a.sort(function(j,o){var h=o.xy.y-j.xy.y;if(h===0)h=o.xy.x-j.xy.y;return h});c.changed()}function e(f,g){g.syncXY&&i(g)}b=COG.extend({zindex:80},b);var a=[],c=COG.extend(new K(b),{add:function(f){a[a.length]=f},each:function(f){for(var g=
a.length;g--;)f(a[g])},draw:function(f,g,j){var o=g.x1,h=g.y1,k=g.width;g=g.height;for(var u=a.length;u--;){var B=a[u].style;B=B?wa.apply(f,B):null;a[u].draw(f,o,h,k,g,j);B&&wa.apply(f,B)}}});c.bind("parentChange",e);c.bind("resync",e);return c},Tiling:Qa,TileGenerator:function(b){function i(N,q,D,O){function J(){if(L.initTileCreator){j=true;L.initTileCreator(N,q,D,O)}}L.prepTileCreator?L.prepTileCreator(N,q,D,J):J()}function e(N,q){for(var D=~~((N.x1-f.x)/o),O=~~((N.y1-f.y)/h),J=[],ka=-g;ka<u;ka++)for(var V=
-g;V<B;V++){var ma=k(D+ka,O+V);if(ma)J[J.length]=ma}q&&q(J);c=X.copy(N)}b=COG.extend({tileWidth:256,tileHeight:256,relative:false,padding:2},b);var a=null,c=null,f=E.init(),g=b.padding,j=false,o=b.tileWidth,h=b.tileHeight,k=null,u=0,B=0,L={bindToView:function(N){COG.info("initializing generator");a=N;L.trigger("bindView",N)},getTileCreatorArgs:null,initTileCreator:null,prepTileCreator:null,requireRefresh:function(){return false},reset:function(){k=null;j=false;c=null},run:function(N,q){if(!c||Math.abs(N.x1-
c.x1)>o||Math.abs(N.y1-c.y1)>h){if(!k&&!j||L.requireRefresh()){f=b.relative?E.init(N.x1,N.y1):E.init();u=Math.ceil(N.width/o)+g;B=Math.ceil(N.height/h)+g;i(o,h,L.getTileCreatorArgs?L.getTileCreatorArgs(a):{},function(D){k=D;j=false;e(N,q)})}k&&e(N,q)}}};COG.observable(L);L.bind("update",function(){COG.info("captured generator update");c=null});return L}};COG.observable(Ra);return Ra}();
