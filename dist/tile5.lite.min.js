COG=function(){var f=/\$\{(.*?)\}/ig,l=Object.prototype.hasOwnProperty,g=0,e={id:"grunt.core",extend:function(){var a=arguments[0]||{},c=1,d=arguments.length,b=false,m,h,j,i;if(typeof a==="boolean"){b=a;a=arguments[1]||{};c=2}if(typeof a!=="object"&&!e.isFunction(a))a={};if(d===c){a=this;--c}for(;c<d;c++)if((m=arguments[c])!=null)for(h in m){j=a[h];i=m[h];if(a!==i)if(b&&i&&(e.isPlainObject(i)||e.isArray(i))){j=j&&(e.isPlainObject(j)||e.isArray(j))?j:e.isArray(i)?[]:{};a[h]=e.extend(b,j,i)}else if(i!==
undefined)a[h]=i}return a},isFunction:function(a){return toString.call(a)==="[object Function]"},isArray:function(a){return toString.call(a)==="[object Array]"},isPlainObject:function(a){if(!a||toString.call(a)!=="[object Object]"||a.nodeType||a.setInterval)return false;if(a.constructor&&!l.call(a,"constructor")&&!l.call(a.constructor.prototype,"isPrototypeOf"))return false;var c;for(c in a);return c===undefined||l.call(a,c)},isEmptyObject:function(a){for(var c in a)return false;return true},isXmlDocument:function(a){return toString.call(a)===
"[object Document]"},contains:function(a,c){var d=a,b=arguments,m=1;if(c&&e.isArray(c)){b=c;m=0}for(m=m;m<b;m++)d=d&&typeof foo[b[m]]!=="undefined";return d},newModule:function(a){a=e.extend({id:null,requires:[],parent:null},a);if(a.parent)a=e.extend({},a.parent,a);return a},toID:function(a){return a.replace(/\s/g,"-")},objId:function(a){return(a?a:"obj")+g++},formatStr:function(a){if(arguments.length<=1)return a;for(var c=arguments.length-2,d=0;d<=c;d++)a=a.replace(RegExp("\\{"+d+"\\}","gi"),arguments[d+
1]);return a},wordExists:function(a,c){var d="";if(c.toString)c=c.toString();for(var b=0;b<c.length;b++)d+=!/\w/.test(c[b])?"\\"+c[b]:c[b];return RegExp("(^|\\s|\\,)"+d+"(\\,|\\s|$)","i").test(a)},parseTemplate:function(a,c){for(var d=f.exec(a);d;){a=a.replace(d[0],COG.XPath.first(d[1],c));f.lastIndex=0;d=f.exec(a)}return a}};return e}();
COG.Log=function(){function f(c,d){var b,m=d&&d.length>0?d[0]:"";for(b=1;d&&b<d.length;b++)m+=" "+(g&&COG.isPlainObject(d[b])?JSON.stringify(d[b]):d[b]);typeof console!=="undefined"&&console[c](m);for(b=0;b<l.length;b++)l[b].call(a,m,c)}var l=[],g=typeof JSON!=="undefined",e=window.console&&window.console.markTimeline,a={id:"grunt.log",getTraceTicks:function(){return e?(new Date).getTime():null},trace:function(c,d){if(e)console.markTimeline(c+(d?": "+(a.getTraceTicks()-d)+"ms":""))},debug:function(){f("debug",
arguments)},info:function(){f("info",arguments)},warn:function(){f("warn",arguments)},error:function(){f("error",arguments)},exception:function(c){a.error(arguments);for(var d in c)a.info("ERROR DETAIL: "+d+": "+c[d])},watch:function(c,d){try{d()}catch(b){a.exception(b,c)}},throwError:function(c){a.error(c);throw Error(c);},requestUpdates:function(c){l.push(c)}};return a}();
(function(){function f(e,a){e[a]||(e[a]=function(c){return e.configure(a,c)})}function l(e){e.gtConfId=COG.objId("configurable");e.gtConfig={};e.gtConfigFns=[];return e.gtConfig}var g={};COG.paramTweaker=function(e,a,c){return function(d,b){if(typeof b!=="undefined"){if(d in e)e[d]=b;c&&d in c&&c[d](d,b)}else return a&&d in a?a[d](d):e[d]}};COG.configurable=function(e,a,c,d){if(e){e.gtConfId||l(e);var b=e.gtConfId,m=e.gtConfig,h=e.gtConfigFns;g[b]=e;h.push(c);for(c=a.length;c--;){m[a[c]]=true;d&&
f(e,a[c])}if(!e.configure)e.configure=function(j,i){if(m[j]){for(var k=h.length;k--;){var q=h[k](j,i);if(typeof q!=="undefined")return q}return g[b]}return null}}}})();
(function(){function f(l,g){var e=l.gtObsHandlers;e[g]||(e[g]=[]);return e[g]}COG.observable=function(l){if(l){if(!l.gtObsHandlers)l.gtObsHandlers={};if(!(l.bind||l.trigger||l.unbind)){l.bind=function(g,e){var a=COG.objId("callback");f(l,g).unshift({fn:e,id:a});return a};l.trigger=function(g){var e=f(l,g),a={cancel:false,tickCount:(new Date).getTime()},c;if(!e)return null;c=Array.prototype.slice.call(arguments,1);c.unshift(a);for(var d=e.length;d--&&!a.cancel;)e[d].fn.apply(self,c);return a};l.unbind=
function(g,e){for(var a=f(l,g),c=0;a&&c<a.length;c++)if(a[c].id===e){a.splice(c,1);break}return l}}}}})();(function(){var f={},l=[];COG.addPipe=function(g){g("pipe.test",{});l.push(g)};COG.listen=function(g,e){f[g]||(f[g]=[]);e&&f[g].push(e)};COG.say=function(g,e){var a;for(a=l.length;a--;)l[a](g,e);if(f[g])for(a=f[g].length;a--;)f[g][a](e)}})();
COG.Loopage=function(){function f(i){return COG.extend({id:c++,frequency:0,after:0,single:false,lastTick:0,execute:function(){}},i)}function l(i){b.push(i);g()}function g(){m&&clearTimeout(m);m=setTimeout(e,0);j=true}function e(){for(var i,k=(new Date).getTime(),q=d.length;b.length>0;){var w=b.shift();for(i=q;i--;)if(d[i].id===w){d.splice(i,1);break}j=true;q=d.length}if(j){h=a;for(i=q;i--;)h=d[i].frequency<h?d[i].frequency:h}for(i=q;i--;){w=k-d[i].lastTick;if(d[i].lastTick===0||w>=d[i].frequency){d[i].execute(k,
d[i]);d[i].lastTick=k;d[i].single&&d[i].trigger("complete")}}m=q?setTimeout(e,h):0}var a=6E4,c=0,d=[],b=[],m=0,h=a,j=true;return{join:function(i){var k=new f(i);if(k.after>0)k.lastTick=(new Date).getTime()+k.after;COG.observable(k);k.bind("complete",function(){l(k.id)});d.unshift(k);g();return k},leave:l}}();if(!this.JSON)this.JSON={};
(function(){function f(h){return h<10?"0"+h:h}function l(h){a.lastIndex=0;return a.test(h)?'"'+h.replace(a,function(j){var i=b[j];return typeof i==="string"?i:"\\u"+("0000"+j.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+h+'"'}function g(h,j){var i,k,q,w,y=c,n,o=j[h];if(o&&typeof o==="object"&&typeof o.toJSON==="function")o=o.toJSON(h);if(typeof m==="function")o=m.call(j,h,o);switch(typeof o){case "string":return l(o);case "number":return isFinite(o)?String(o):"null";case "boolean":case "null":return String(o);
case "object":if(!o)return"null";c+=d;n=[];if(Object.prototype.toString.apply(o)==="[object Array]"){w=o.length;for(i=0;i<w;i+=1)n[i]=g(i,o)||"null";q=n.length===0?"[]":c?"[\n"+c+n.join(",\n"+c)+"\n"+y+"]":"["+n.join(",")+"]";c=y;return q}if(m&&typeof m==="object"){w=m.length;for(i=0;i<w;i+=1){k=m[i];if(typeof k==="string")if(q=g(k,o))n.push(l(k)+(c?": ":":")+q)}}else for(k in o)if(Object.hasOwnProperty.call(o,k))if(q=g(k,o))n.push(l(k)+(c?": ":":")+q);q=n.length===0?"{}":c?"{\n"+c+n.join(",\n"+c)+
"\n"+y+"}":"{"+n.join(",")+"}";c=y;return q}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
a=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,c,d,b={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},m;if(typeof JSON.stringify!=="function")JSON.stringify=function(h,j,i){var k;d=c="";if(typeof i==="number")for(k=0;k<i;k+=1)d+=" ";else if(typeof i==="string")d=i;if((m=j)&&typeof j!=="function"&&(typeof j!=="object"||typeof j.length!=="number"))throw Error("JSON.stringify");return g("",
{"":h})};if(typeof JSON.parse!=="function")JSON.parse=function(h,j){function i(q,w){var y,n,o=q[w];if(o&&typeof o==="object")for(y in o)if(Object.hasOwnProperty.call(o,y)){n=i(o,y);if(n!==undefined)o[y]=n;else delete o[y]}return j.call(q,w,o)}var k;h=String(h);e.lastIndex=0;if(e.test(h))h=h.replace(e,function(q){return"\\u"+("0000"+q.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(h.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){k=eval("("+h+")");return typeof j==="function"?i({"":k},""):k}throw new SyntaxError("JSON.parse");}})();
(function(){function f(g,e){var a=g.split("|"),c={};for(var d in e){var b=e[d];c[d]=a.length>b?a[b]:null}return c}var l={JSON:{parse:function(g){return JSON.parse(g)}},PDON:{parse:function(g){var e=null,a=[];g=g.split("\n");for(var c=0;c<g.length;c++){var d=g[c];if(e)a.push(f(d,e));else if(d){e=d.split("|");d={};for(var b=0;b<e.length;b++)d[e[b]]=b;e=d}else e=null}return a}}};COG.parseData=function(g,e){e=e?e.toUpperCase():"JSON";if(!l[e])throw Error("Unsupported data format: "+e);try{return l[e].parse(g)}catch(a){COG.Log.exception(a)}return{}}})();
COG.XPath=function(){function f(a){for(var c=null,d=0;d<l.length;d++)if(c=l[d](a))break;return c}var l=[],g=[null,function(a){return a.numberValue},function(a){return a.stringValue},function(a){return a.booleanValue},null,null,null,null,function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null},function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||COG.Log.warn("No XPATH support");var e={SearchResult:function(a){return{toString:function(){var c=
null;if(a){var d=null;if(a.resultType>=0&&a.resultType<g.length)d=g[a.resultType];if(d)c=d(a)}return c?c:""}}},first:function(a,c){var d=e.SearchResult,b;var m=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!m)m=XPathResult.ANY_TYPE;try{if(COG.isXmlDocument(c))b=c.evaluate(a,c,f,m,null);else{COG.Log.warn("attempted xpath expression: "+a+" on a non-xml document");b=null}}catch(h){COG.Log.warn("invalid xpath expression: "+a+" on node: "+c);b=null}return new d(b)},registerResolver:function(a){l.push(a)}};return e}();
COG.Storage=function(){function f(l){if(l&&l=="session")return sessionStorage;return localStorage}return{get:function(l,g){var e=f(g).getItem(l);return/^(\{|\[).*(\}|\])$/.test(e)?JSON.parse(e):e},set:function(l,g,e){g=jQuery.isArray(g)||jQuery.isPlainObject(g)?JSON.stringify(g):g;f(e).setItem(l,g)},remove:function(l,g){f(g).removeItem(l)}}}();
COG.ParseRules=function(){var f=[];return{add:function(l,g){f.push({regex:l,handler:g})},each:function(l,g,e){function a(){c++;e&&c>=f.length&&e(g)}for(var c=0,d=0;d<f.length;d++){var b=f[d].regex,m=f[d].handler,h=false;if(b){b.lastIndex=-1;if((b=b.exec(l))&&m){h=true;m(b,g,a)&&a()}}h||a()}}}};
(function(){function f(b){var m=[],h=function(i,k){k=COG.isFunction(k)?k():k;m[m.length]=encodeURIComponent(i)+"="+encodeURIComponent(k)};if(COG.isArray(b))for(var j=0;j<b.length;j++)h(b[j].name,b[j].value);else for(j in b)h(j,b[j]);return m.join("&").replace(/%20/g,"+")}var l={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},g={JSON:["json"],PDON:["pdon.txt"]},e=["TEXT","STREAM"],a=/^(\w+:)?\/\/([^\/?#]+)/,c={XML:function(b){return b.responseXML},JSON:function(b){return COG.parseData(b.responseText)},
PDON:function(b){return COG.parseData(b.responseText,"PDON")},DEFAULT:function(b){return b.responseText}},d={CONTENT_TYPE:"Content-Type"};COG.xhr=function(b){function m(){if(this.readyState===4){var k=null,q=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(q)if(b.handleResponse)b.handleResponse(this);else{var w=b,y=this.getResponseHeader(d.CONTENT_TYPE),n,o=false;for(n in l)if(y&&y.indexOf(l[n])>=0){o=true;
break}y=!o;for(o=0;o<e.length;o++)y=y||e[o]==n;if(y)b:{y=n;for(var u in g)for(o=0;o<g[u].length;o++)if(RegExp(g[u][o]+"$","i").test(w.url)){n=u;break b}n=y?y:"DEFAULT"}try{k=c[n](this,w)}catch(s){k=c.DEFAULT(this,w)}}else b.error&&b.error(this)}catch(R){COG.Log.exception(R,"PROCESSING AJAX RESPONSE")}q&&k&&b.success&&b.success.call(this,k)}}try{b=COG.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},b);var h=
a.exec(b.url),j=h&&(h[1]&&h[1]!==location.protocol||h[2]!==location.host);if(b.data)b.method="POST";if(b.url){h=null;if(b.xhr)h=b.xhr(b);h||(h=new XMLHttpRequest);h.open(b.method,b.url,b.async);b.data&&h.setRequestHeader("Content-Type",b.contentType);j||h.setRequestHeader("X-Requested-With","XMLHttpRequest");h.onreadystatechange=m;h.send(b.method=="POST"?f(b.data):null)}else COG.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(i){COG.Log.exception(i)}}})();
(function(){function f(a){var c=document.createElement("script"),d=false;c.src=a;c.async=true;c.onload=c.onreadystatechange=function(){if(!d&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){d=true;c.onload=c.onreadystatechange=null;c&&c.parentNode&&c.parentNode.removeChild(c)}};g||(g=document.getElementsByTagName("head")[0]);g.appendChild(c)}var l=0,g,e=this;COG.jsonp=function(a,c,d){a+=a.indexOf("?")>=0?"&":"?";var b="json"+ ++l;e[b]=function(m){c(m);e[b]=null;try{delete e[b]}catch(h){}};
f(a+(d?d:"callback")+"="+b);return b}})();
COG.Touch=function(){function f(t,E){return{x:t.x-E.x,y:t.y-E.y}}function l(t,E){var H=f(t,E);return Math.sqrt(H.x*H.x+H.y*H.y)}function g(t){if(t.count>1)return l(t.touches[0],t.touches[1]);return 0}function e(t,E){var H=t&&t.count>0?t.touches[0]:null;if(H&&E&&E.count>0)return f(H,E.touches[0]);return null}function a(t,E){t.count=E.count;for(var H=h;H--;){t.touches[H].x=E.touches[H].x;t.touches[H].y=E.touches[H].y}}function c(){for(var t={count:0,touches:Array(h)},E=h;E--;)t.touches[E]=m();return t}
function d(t){if(t.preventDefault){t.preventDefault();t.stopPropagation()}else t.cancelBubble&&t.cancelBubble()}function b(t,E,H){if(F){E=E[H?H:"touches"];H=E.length;for(H=t.count=H;H--;){t.touches[H].x=E[H].pageX;t.touches[H].y=E[H].pageY}}else if(E.button===0){t.count=1;t.touches[0].x=E.pageX?E.pageX:E.screenX;t.touches[0].y=E.pageY?E.pageY:E.screenY}else t.count=0}function m(t,E){return{x:t?t:0,y:E?E:0}}var h=10,j=120,i=100,k=250,q=300,w=5,y=0,n=1,o=2,u=7,s=0,R=0,F=undefined,ba=function(t){function E(v,
C,z,p){var r=Math.asin((v.y-C.y)/z);z=z*(pa/p)>>0;z=z>la?la:z;r=C.x>v.x?r:Math.PI-r;G("pan",Math.cos(r)*-z,Math.sin(r)*z,true)}function H(v,C){var z,p;if(F){z=C-ha;if(z<k){p=l(L.touches[0],v);p>t.inertiaTrigger&&E(L.touches[0],v,p,z)}}else{Y.x=v.x;Y.y=v.y;COG.Loopage.join({execute:function(r,B){z=r-C;p=l(v,Y);if(z<i&&p>t.inertiaTrigger){B.trigger("complete");E(v,Y,p,z)}else z>i&&B.trigger("complete")},frequency:10})}}function Z(v){var C=0,z=0;if(v.offsetParent){do{C+=v.offsetLeft;z+=v.offsetTop;v=
v.offsetParent}while(v)}return m(C,z)}function x(v){var C=v.count,z=Array(C),p=Z(aa);for(C=C;C--;)z[C]=m(v.touches[C].x-p.x,v.touches[C].y-p.y);return z}function G(){na&&na.trigger.apply(null,arguments)}function A(v){var C=v.target?v.target:v.srcElement;if(T||C&&C===aa){b(L,v);if(L.count!==0){W=null;X.x=0;X.y=0;ia=true;P=false;ha=(new Date).getTime();d(v);C.style.cursor="move";G("inertiaCancel");ja=ha;if(v=L.count>0?L.touches[0]:null){G("touchStart",v.x,v.y);if(ja-ma<q)if((v=f(L.touches[0],$.touches[0]))&&
Math.abs(v.x)<t.maxDistDoubleTap&&Math.abs(v.y)<t.maxDistDoubleTap)P=true;K=y;a($,L)}else COG.Log.warn("Touch start fired, but no touch vector found")}}}function I(v){var C=v.target?v.target:v.srcElement,z=0;if(T||C&&C===aa){b(S,v);if(S.count>0){Y.x=S.touches[0].x;Y.y=S.touches[0].y}if(ia){F&&d(v);if(S.count>1){L.count===1&&a(L,S);z=g(L)-g(S)}if(K===y)if((v=e(S,L))&&(Math.abs(v.x)>=u||Math.abs(v.y)>=u))K=n;if(K!==y)if(!z||Math.abs(z)<w){if(W=e(S,$)){X.x-=W.x;X.y-=W.y;ea.x-=W.x;ea.y-=W.y}G("pan",ea.x,
ea.y);ea.x=0;ea.y=0;K=n}else{G("pinchZoom",x(L),x(S));K=o}a($,S)}}}function D(v){var C=v.target?v.target:v.srcElement;if(ia&&(T||C&&C===aa)){b(U,v,"changedTouches");var z=U.touches[0];F&&d(v);v=(new Date).getTime();ma=ja;if(K===y)Q||(Q=setTimeout(function(){Q=0;var p=P?"doubleTap":"tap",r=L.touches[0],B=Z(aa);B=m(r.x-B.x,r.y-B.y);G(p,r,B)},q+50));else if(K==n){G("panEnd",X.x,X.y);oa&&H(z,v)}else K==o&&G("pinchZoomEnd",x(L),x($),v-ha);C.style.cursor="default";ia=false}}function M(v){var C=v.target?
v.target:v.srcElement;if(T||C&&C===aa){if(v.detail){C=-v.detail*j;C=m(v.axis===1?C:0,v.axis===2?C:0)}else C=m(v.wheelDeltaX,v.wheelDeltaY);var z=C.y!==0?Math.abs(C.y/j):0;if(Y&&z!==0){var p=m(Y.x-aa.offsetLeft,Y.y-aa.offsetTop);G("wheelZoom",p,Math.pow(2,C.y>0?z:-z))}d(v)}}t=COG.extend({element:null,observable:null,inertiaTrigger:20,maxDistDoubleTap:20,touchStartHandler:null,moveHandler:null,moveEndHandler:null,pinchZoomHandler:null,pinchZoomEndHandler:null,tapHandler:null,doubleTapHandler:null,wheelZoomHandler:null},
t);var P=false,Q=0,N=T5.getConfig(),L=c(),S=c(),$=c(),U=c(),W=null,X=m(),ea=m(),K=null,ia=false,ha=0,fa=[],Y=m(),oa=false,pa,la,ja=0,ma=0,aa=t.element,na=t.observable,T=typeof FlashCanvas!=="undefined",qa={supportsTouch:F,addListeners:function(v){fa.push(v)},decoupleListeners:function(v){for(var C=0;v&&C<fa.length;C++)if(fa[C].listenerId===v){fa.splice(C,1);break}},release:function(){N.unbindEvent(F?"touchstart":"mousedown",A,false);N.unbindEvent(F?"touchmove":"mousemove",I,false);N.unbindEvent(F?
"touchend":"mouseup",D,false);if(!F){window.removeEventListener("mousewheel",M,false);window.removeEventListener("DOMMouseScroll",M,false)}},inertiaEnable:function(v,C){oa=true;pa=v;la=C?Math.min(C.width,C.height):500},inertiaDisable:function(){oa=false}};if(typeof F==="undefined")F=T5.getConfig().supportsTouch;N.bindEvent(F?"touchstart":"mousedown",A,false);N.bindEvent(F?"touchmove":"mousemove",I,false);N.bindEvent(F?"touchend":"mouseup",D,false);if(!F){N.bindEvent("mousewheel",M,window);N.bindEvent("DOMMouseScroll",
M,window)}return qa},V=[];return{capture:function(t,E){if(!t)throw Error("Unable to capture touch of null element");if(!t.id)t.id="touchable_"+s++;var H=V[t.id];if(!H){H=new ba(COG.extend({element:t},E));V[t.id]=H}if(E){E.listenerId&&H.decoupleListeners(E.listenerId);E.listenerId=++R;H.addListeners(E)}return H},release:function(t){if(t&&t.id&&V[t.id]){V[t.id].release();delete V[t.id]}}}}();
T5=function(){var f=function(d,b){return{x:d?d:0,y:b?b:0}},l=function(){function d(b,m){if(!m)m=b.length;if(m<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var h={edges:Array(m-1),accrued:Array(m-1),total:0},j=l.diff,i=0;i<m-1;i++){var k=j(b[i],b[i+1]);h.edges[i]=Math.sqrt(k.x*k.x+k.y*k.y);h.accrued[i]=h.total+h.edges[i];h.total+=h.edges[i]}return h}return{VECTOR_SIMPLIFICATION:4,create:function(b,m){return new f(b,m)},add:function(){for(var b=new f,m=
arguments.length;m--;){b.x+=arguments[m].x;b.y+=arguments[m].y}return b},absSize:function(b){return Math.max(Math.abs(b.x),Math.abs(b.y))},diff:function(b,m){return new f(b.x-m.x,b.y-m.y)},copy:function(b){return b?new f(b.x,b.y):null},invert:function(b){return new f(-b.x,-b.y)},offset:function(b,m,h){return new f(b.x+m,b.y+(h?h:m))},edges:d,distance:function(b,m){return d(b,m).total},simplify:function(b,m){if(!b)return null;m=m?m:l.VECTOR_SIMPLIFICATION;for(var h=[],j=null,i=b.length;i--;){var k=
b[i];if(include=!j||i===0||Math.abs(k.x-j.x)+Math.abs(k.y-j.y)>m){h.unshift(k);j=k}}return h},theta:function(b,m,h){h=Math.asin((b.y-m.y)/h);return b.x>m.x?h:Math.PI-h},pointOnEdge:function(b,m,h,j){m=new f(Math.cos(h)*j,Math.sin(h)*j);return new f(b.x-m.x,b.y-m.y)},getRect:function(b){var m=b.length;if(m>1)return new g(Math.min(b[0].x,b[m-1].x),Math.min(b[0].y,b[m-1].y),Math.abs(b[0].x-b[m-1].x),Math.abs(b[0].y-b[m-1].y))},toString:function(b){return b.x+", "+b.y}}}(),g=function(d,b,m,h){return{origin:new f(d,
b),dimensions:new a(m,h),invalid:false}},e=function(){return{bottomRight:function(d){return l.offset(d.origin,d.dimensions.width,d.dimensions.height)},empty:function(){return new g(0,0,0,0)},copy:function(d){return d?new g(d.origin.x,d.origin.y,d.dimensions.width,d.dimensions.height):null},getCenter:function(d){return new f(d.origin.x+d.dimensions.width/2,d.origin.y+d.dimensions.height/2)},isEmpty:function(d){return d.dimensions.width===0||d.dimensions.height===0},union:function(){if(!(arguments.length<
2)){for(var d=arguments[0].origin.y,b=arguments[0].origin.x,m=d+arguments[0].dimensions.height,h=b+arguments[0].dimensions.width,j=Array.prototype.slice.call(arguments,1),i=j.length;i--;){var k=j[i].origin.y,q=j[i].origin.x,w=k+j[i].dimensions.height,y=q+j[i].dimensions.width;d=d<k?d:k;b=b<q?b:q;m=m>w?m:w;h=h>y?h:y}arguments[0].origin.x=b;arguments[0].origin.y=d;arguments[0].dimensions.width=h-b;arguments[0].dimensions.height=m-d}}}}(),a=function(d,b){return{width:d?d:0,height:b?b:0}},c=function(){return{getAspectRatio:function(d){return d.height!==
0?d.width/d.height:1},getCenter:function(d){return new f(d.width/2,d.height/2)},getSize:function(d){return Math.sqrt(Math.pow(d.width,2)+Math.pow(d.height,2))}}}();return{ex:COG.extend,ticks:function(){return(new Date).getTime()},Vector:f,V:l,Dimensions:a,D:c,Rect:g,R:e}}();
(function(){function f(){for(;w.length>0;){var n=w.shift();document.location=n}q=0}function l(n){for(var o=true,u=y.length;u--;)o=o&&n!=y[u];return o}function g(n,o){var u=[];for(var s in o)s&&u.push(s+"="+escape(o[s]));return"tile5://"+n+"/"+(u.length>0?"?"+u.join("&"):"")}function e(n,o){l(n)&&COG.Log.info("would push url: "+g(n,o))}function a(n,o){if(l(n)){w.push(g(n,o));q||(q=setTimeout(f,100))}}function c(n){return function(o,u,s){(s?s:n?document.body:document).addEventListener(o,u,false)}}function d(n){return function(o,
u,s){(s?s:n?document.body:document).removeEventListener(o,u,false)}}function b(n,o,u){(u?u:document).attachEvent("on"+n,o)}function m(n,o,u){(u?u:document).detachEvent("on"+n,o)}function h(){j={base:{name:"Unknown",bindEvent:c(),unbindEvent:d(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:e,targetFps:null},ie:{name:"MSIE",regex:/msie/i,bindEvent:b,unbindEvent:m,requireFastDraw:false,targetFps:25},
ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:a,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:a},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:a},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:c(true),unbindEvent:d(true),supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},bridgeNotify:a},froyo:{name:"Android OS >= 2.2",
regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:a}};i=[j.froyo,j.android,j.ipod,j.iphone,j.ipad,j.ie]}var j=null,i=[],k=null,q=0,w=[],y=["view.wake","tile.loaded"];T5.getConfig=function(){j||h();if(!k){COG.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var n=0;n<i.length;n++){var o=i[n];if(o.regex&&o.regex.test(navigator.userAgent)){k=T5.ex({},j.base,o);COG.Log.info("PLATFORM DETECTED AS: "+k.name);break}}if(!k){COG.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
k=j.base}COG.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return k}})();
T5.Dispatcher=function(){var f=[],l={execute:function(g){var e=l.findAction(g);e&&e.execute.apply(e,Array.prototype.slice.call(arguments,1))},findAction:function(g){for(var e=f.length;e--;)if(f[e].id==g)return f[e];return null},getRegisteredActions:function(){return[].concat(f)},getRegisteredActionIds:function(){for(var g=[],e=f.length;e--;)f[e].id&&g.push(f[e].id);return g},registerAction:function(g){g&&g.id&&f.push(g)},Action:function(g){g=T5.ex({autoRegister:true,id:"",title:"",icon:"",hidden:false,
execute:null},g);var e={id:g.id,execute:function(){g.execute&&g.execute.apply(this,arguments)},getParam:function(a){return g[a]?g[a]:""},toString:function(){return COG.formatStr("{0} [title = {1}, icon = {2}]",e.id,g.title,g.icon)}};g.autoRegister&&l.registerAction(e);return e},Agent:function(g){g=COG.extend({name:"Untitled",translator:null,execute:null},g);var e={getName:function(){return g.name},getParam:function(a){return g[a]},getId:function(){return COG.toID(e.getName())},run:function(a,c){if(g.execute){var d=
g.translator?g.translator(a):a;g.execute.call(e,d,function(b,m){c&&c(b,m,d)})}}};return e},runAgents:function(g,e,a){for(var c=0;c<g.length;c++)g[c].run(e,a)}};return l}();
T5.Resources=function(){var f="",l={},g={getPath:function(e){return/^(file|https?|\/)/.test(e)?e:f+e},setBasePath:function(e){f=e},loadResource:function(e){e=T5.ex({filename:"",cacheable:true,dataType:null,callback:null},e);var a=function(c){e.callback&&COG.Log.watch("CALLING RESOURCE CALLBACK",function(){e.callback(c)})};e.cacheable&&l[e.filename]?a(l[e.filename]):COG.xhr({url:g.getPath(e.filename),dataType:e.dataType,success:function(c){if(e.cacheable)l[e.filename]=c;a(c)},error:function(c,d,b){COG.Log.error("error loading resource ["+
e.filename+"], error = "+b)}})},loadSnippet:function(e,a){/\.\w+$/.test(e)||(e+=".html");g.loadResource({filename:"snippets/"+e,callback:a,dataType:"html"})}};return g}();
T5.Images=function(){function f(){if(!q){var n=T5.getConfig().maxImageLoads;q=COG.Loopage.join({execute:function(o,u){if(!n||j.length<n){var s=h.shift();if(s){j[j.length]=s;s.image.onload=g;s.image.src=T5.Resources.getPath(s.url);s.requested=T5.ticks()}else u.trigger("complete")}},frequency:10});q.bind("complete",function(){q=null})}}function l(){w=true;try{var n=i.length/2>>0;if(n>0){i.sort(function(u,s){return u.created-s.created});for(var o=n;o--;)delete c[i[o].url];i.splice(0,n)}}finally{w=false}COG.say("imagecache.cleared")}
function g(){var n=b[this.id];if(n&&n.image.complete&&n.image.width>0){n.loaded=true;n.hitCount=1;for(var o=j.length;o--;)if(j[o].image.src==this.src){j.splice(o,1);break}if(n.background||n.postProcess||n.drawBackground||n.customDraw)if(n.image){o=a(n.realSize?n.realSize.width:image.width,n.realSize?n.realSize.height:image.height);var u=o.getContext("2d"),s=n.offset?n.offset:new T5.Vector;n.background&&u.drawImage(n.background,0,0);n.drawBackground&&n.drawBackground(u);n.customDraw?n.customDraw(u,
n):u.drawImage(n.image,s.x,s.y);n.postProcess&&n.postProcess(u,n);n.image=o}n.loadCallback&&n.loadCallback(this,false);i[i.length]={url:this.src,created:n.requested};delete b[this.id];f()}}function e(n,o,u){var s=c[n];if(s){s.hitCount++;s.image.complete&&o&&o(s.image,true)}else{s=T5.ex({url:n,image:new Image,loaded:false,created:T5.ticks(),requested:null,hitCount:0,loadCallback:o},u);s.image.id="resourceLoaderImage"+m++;c[n]=s;b[s.image.id]=s;h[h.length]=s;f()}return s}function a(n,o){var u=document.createElement("canvas");
u.width=n?n:0;u.height=o?o:0;if(typeof FlashCanvas!=="undefined"){u.id="tmpCanvas"+d++;u.style.cssText="position: absolute; top: -"+(o-1)+"px; left: -"+(n-1)+"px;";document.body.appendChild(u);FlashCanvas.initElement(u)}typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(u);return u}var c={},d=0,b={},m=0,h=[],j=[],i=[],k=0,q=null,w=false,y={avgImageSize:25,loadTimeout:10,cancelLoad:function(){j=[]},get:function(n,o){var u=null,s=null;w||(u=c[n]);if((s=u?u.image:null)&&(s.getContext||
s.complete&&s.width>0))return s;else o&&e(n,o);return null},load:e,newCanvas:a,stats:function(){return{imageLoadingCount:j.length,queuedImageCount:h.length,imageCacheFullness:k}}};COG.Loopage.join({execute:function(n){for(var o=false,u=0,s=T5.getConfig();u<j.length;)if(n-j[u].requested>y.loadTimeout*1E3){j.splice(u,1);o=true}else u++;o&&f();if(s&&s.imageCacheMaxSize){k=i.length*y.avgImageSize/s.imageCacheMaxSize;k>=1&&l()}},frequency:2E4});return y}();
T5.TimeLord=function(){var f=/^P(\d+Y)?(\d+M)?(\d+D)?$/,l=/^(\d+H)?(\d+M)?(\d+S)?$/,g=function(a,c){return{days:a?a:0,seconds:c?c:0}},e={8601:function(a){a=a.split("T");var c=null;c=null;var d=0,b=0;f.lastIndex=-1;c=f.exec(a[0]);d+=c[3]?parseInt(c[3].slice(0,-1),10):0;l.lastIndex=-1;c=l.exec(a[1]);b+=c[1]?parseInt(c[1].slice(0,-1),10)*3600:0;b+=c[2]?parseInt(c[2].slice(0,-1),10)*60:0;b+=c[3]?parseInt(c[3].slice(0,-1),10):0;return new g(d,b)}};return{Duration:g,addDuration:function(){for(var a=new g,
c=arguments.length;c--;){a.days+=arguments[c].days;a.seconds+=arguments[c].seconds}if(a.seconds>=86400){a.days+=~~(a.seconds/86400);a.seconds%=86400}return a},parseDuration:function(a,c){var d=c?e[c]:null;if(d)return d(a);COG.Log.warn("Could not find duration parser for specified format: "+c);return new g},formatDuration:function(a){var c,d,b="";if(a.days)b=a.days+" days ";if(a.seconds){a=a.seconds;if(a>=3600){c=~~(a/3600);a-=c*3600}if(a>=60){d=Math.round(a/60);a-=d*60}if(c)b=b+c+(c>1?" hrs ":" hr ")+
(d?(d>10?d:"0"+d)+" min ":"");else if(d)b=b+d+" min";else if(a>0)b=b+(a>10?a:"0"+a)+" sec"}return b}}}();
(function(){var f=Math.PI*2,l=Math.PI/2,g=Math.abs,e=Math.pow,a=Math.sin,c=Math.asin,d=Math.cos,b=1.70158,m={linear:function(h,j,i,k){return i*h/k+j},backin:function(h,j,i,k){return i*(h/=k)*h*((b+1)*h-b)+j},backout:function(h,j,i,k){return i*((h=h/k-1)*h*((b+1)*h+b)+1)+j},backinout:function(h,j,i,k){return(h/=k/2)<1?i/2*h*h*(((b*=1.525)+1)*h-b)+j:i/2*((h-=2)*h*(((b*=1.525)+1)*h+b)+2)+j},bouncein:function(h,j,i,k){return i-m.bounceout(k-h,0,i,k)+j},bounceout:function(h,j,i,k){return(h/=k)<1/2.75?
i*7.5625*h*h+j:h<2/2.75?i*(7.5625*(h-=1.5/2.75)*h+0.75)+j:h<2.5/2.75?i*(7.5625*(h-=2.25/2.75)*h+0.9375)+j:i*(7.5625*(h-=2.625/2.75)*h+0.984375)+j},bounceinout:function(h,j,i,k){return h<k/2?m.bouncein(h*2,0,i,k)/2+j:m.bounceout(h*2-k,0,i,k)/2+i/2+j},cubicin:function(h,j,i,k){return i*(h/=k)*h*h+j},cubicout:function(h,j,i,k){return i*((h=h/k-1)*h*h+1)+j},cubicinout:function(h,j,i,k){if((h/=k/2)<1)return i/2*h*h*h+j;return i/2*((h-=2)*h*h+2)+j},elasticin:function(h,j,i,k,q,w){if(h==0)return j;if((h/=
k)==1)return j+i;w||(w=k*0.3);if(!q||q<g(i)){q=i;i=w/4}else i=w/f*c(i/q);return-(q*e(2,10*(h-=1))*a((h*k-i)*f/w))+j},elasticout:function(h,j,i,k,q,w){var y;if(h==0)return j;if((h/=k)==1)return j+i;w||(w=k*0.3);if(!q||q<g(i)){q=i;y=w/4}else y=w/f*c(i/q);return q*e(2,-10*h)*a((h*k-y)*f/w)+i+j},elasticinout:function(h,j,i,k,q,w){var y;if(h==0)return j;if((h/=k/2)==2)return j+i;w||(w=k*0.3*1.5);if(!q||q<g(i)){q=i;y=w/4}else y=w/f*c(i/q);if(h<1)return-0.5*q*e(2,10*(h-=1))*a((h*k-y)*f/w)+j;return q*e(2,
-10*(h-=1))*a((h*k-y)*f/w)*0.5+i+j},quadin:function(h,j,i,k){return i*(h/=k)*h+j},quadout:function(h,j,i,k){return-i*(h/=k)*(h-2)+j},quadinout:function(h,j,i,k){if((h/=k/2)<1)return i/2*h*h+j;return-i/2*(--h*(h-2)-1)+j},sinein:function(h,j,i,k){return-i*d(h/k*l)+i+j},sineout:function(h,j,i,k){return i*a(h/k*l)+j},sineinout:function(h,j,i,k){return-i/2*(d(Math.PI*h/k)-1)+j}};T5.easing=function(h){return m[h.replace(/[\-\_\s\.]/g,"").toLowerCase()]};T5.registerEasingType=function(h,j){m[h.replace(/[\-\_\s\.]/g,
"").toLowerCase()]=j}})();
T5.Tween=function(f){f=T5.ex({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:T5.easing("sine.out"),complete:null,cancelOnInteract:false},f);var l=T5.ticks(),g=[],e=false,a=0,c=0,d={cancelOnInteract:f.cancelOnInteract,isComplete:function(){return e},triggerComplete:function(b){f.complete&&f.complete(b)},update:function(b){try{var m=f.tweenFn(b-l,a,c,f.duration);if(f.target)f.target[f.property]=m;for(var h=g.length;h--;)g[h](m,void 0);if(e=l+f.duration<=b){if(f.target)f.target[f.property]=
f.tweenFn(f.duration,a,c,f.duration);for(var j=g.length;j--;)g[j](m,true)}}catch(i){COG.Log.exception(i)}},requestUpdates:function(b){g.push(b)}};a=f.target&&f.property&&f.target[f.property]?f.target[f.property]:f.startValue;if(typeof f.endValue!=="undefined")c=f.endValue-a;if(c==0)e=true;T5.wakeTweens();return d};
(function(){function f(a){if(e)return l.length;e=true;try{for(var c=0;c<l.length;)if(l[c].isComplete()){l[c].triggerComplete(false);l.splice(c,1)}else{l[c].update(a);c++}}finally{e=false}l.length===0&&g.trigger("complete");return l.length}var l=[],g=null,e=false;T5.tweenValue=function(a,c,d,b,m){a=new T5.Tween({startValue:a,endValue:c,tweenFn:d,complete:b,duration:m});l.push(a);return a};T5.tween=function(a,c,d,b,m,h){a=new T5.Tween({target:a,property:c,endValue:d,tweenFn:b,duration:h,complete:m});
l.push(a);return a};T5.tweenVector=function(a,c,d,b,m,h){var j=[];if(a){var i=a.x==c,k=a.y==d;i||j.push(T5.tween(a,"x",c,b,function(){(i=true)&&k&&m()},h));k||j.push(T5.tween(a,"y",d,b,function(){k=true;i&&k&&m()},h))}return j};T5.cancelAnimation=function(a){if(!e){e=true;try{for(var c=0;c<l.length;)if(!a||a(l[c])){l[c].triggerComplete(true);l.splice(c,1)}else c++}finally{e=false}}};T5.isTweening=function(){return l.length>0};T5.wakeTweens=function(){if(!g){g=COG.Loopage.join({execute:f,frequency:20});
g.bind("complete",function(){g=null})}}})();(function(){var f={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,PINCH:16,FREEZE:128};T5.viewState=function(){for(var l=0,g=arguments.length;g--;){var e=f[arguments[g].toUpperCase()];if(e)l|=e}return l}})();
T5.ViewLayer=function(f){f=T5.ex({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:T5.viewState("ACTIVE","ANIMATING","PAN","PINCH")},f);var l=null,g=false,e=false,a=f.supportFastDraw,c=f.id,d=T5.viewState("ACTIVE"),b=f.validStates,m=0,h=0,j=T5.ex({addToView:function(i){i.setLayer(c,j)},shouldDraw:function(i,k,q){i=(i&b)!==0&&(g?a:true);return i=e||q||m!==k.x||h!==k.y},cycle:function(){},draw:function(){},remove:function(){COG.say("layer.remove",{id:c})},changed:function(){e=true;j.trigger("changed",
j);l&&l.trigger("invalidate")},getId:function(){return c},setId:function(i){c=i},getParent:function(){return l},setParent:function(i){g=(l=i)?l.fastDraw&&displayState!==d:false;j.trigger("parentChange",l)}},f);COG.observable(j);j.bind("drawComplete",function(i,k){e=false;m=k.x;h=k.y});return j};
T5.View=function(f){function l(p,r,B,J){T=ma;u();if(J&&f.inertia){P=true;h(V+r,t+B,f.panAnimationEasing,f.panAnimationDuration)}else J||h(V+r,t+B)}function g(){T=ja;P=false;COG.Loopage.join({execute:u,after:50,single:true})}function e(p,r){U=qa(p);W=qa(r);var B=v(U.dimensions),J=v(W.dimensions);Y=C(U);D=C(W);K=U&&B!==0?J/B:1}function a(p,r,B){e(r,B);if($=K!==1){T=aa;u()}}function c(p,r,B,J){e(r,B);if(f.adjustScaleFactor){K=f.adjustScaleFactor(K);COG.Log.info("scale factor adjusted to: "+K)}if(J<f.pinchZoomAnimateTrigger){k(ha,
K,Y,q(),T5.easing("sine.out"),function(){b();K=1},300);K=ha}else{b();K=1}}function d(p,r,B){z.zoom(r,Math.min(Math.pow(2,Math.round(Math.log(B))),8),500)}function b(){$=false;z.trigger("scale",K,U?q():D);T=ja;u()}function m(){clearTimeout(ea);ea=setTimeout(j,50)}function h(p,r,B,J,O){function ca(){da+=1;if(da>=2){g(0,0);O&&O()}}var da=0;if(B){p=T5.tweenValue(V,p,B,ca,J);r=T5.tweenValue(t,r,B,ca,J);p.cancelOnInteract=true;p.requestUpdates(function(ga){V=ga;P=true;u()});r.cancelOnInteract=true;r.requestUpdates(function(ga){t=
ga;P=true;u()})}else{V=p;t=r}}function j(){var p;if(F){COG.Touch.release(F);if(f.autoSize&&F.parentNode){p=F.parentNode.getBoundingClientRect();if(p.height!==0&&p.width!==0){F.height=p.height;F.width=p.width}}try{if(!F.id)F.id=f.id+"_canvas";ba=F.getContext("2d");ba.clearRect(0,0,F.width,F.height)}catch(r){COG.Log.exception(r);throw Error("Could not initialise canvas on specified view element");}la=COG.Touch.capture(F,{observable:z});if(A.height!==F.height||A.width!==F.width){A=new T5.Dimensions(F.width,
F.height);z.trigger("resize",F.width,F.height);for(p=R;p--;)s[p].trigger("resize",F.width,F.height)}f.inertia&&la.inertiaEnable(f.panAnimationDuration,A);for(p=R;p--;)s[p].trigger("contextChanged",ba);o()}}function i(p,r){r.setId(p);r.added=T5.ticks();r.trigger("contextChanged",ba);r.setParent(z);s.push(r);s.sort(function(B,J){var O=J.zindex-B.zindex;if(O===0)O=J.added-B.added;return O});R=s.length;return r}function k(p,r,B,J,O,ca,da){function ga(){ca&&ca();b();K=1;fa=null}$=true;Y=T5.V.copy(B);D=
T5.V.copy(J);U=null;if(O)T5.tweenValue(0,r-p,O,ga,da?da:1E3).requestUpdates(function(ka){fa=ka/(r-p);K=p+ka;T=aa;u();z.trigger("animate")});else{K=targetScaleFactor;ga()}}function q(){var p=T5.D.getCenter(A),r=T5.V.distance([D,p]),B=T5.V.theta(D,p,r),J=T5.V.diff(Y,D);p=T5.V.pointOnEdge(D,p,B,r/K);p.x+=J.x;p.y+=J.y;return p}function w(){z.trigger("idle");M=true;Q=0}function y(p,r,B,J){var O=P?ma:x?T5.viewState("FROZEN"):T,ca=(O&aa)!==0,da=0;if(H||ca){p.clearRect(0,0,F.width,F.height);H=false}if(ca){T5.D.getCenter(A);
var ga=(fa?fa:1)/2,ka=T5.V.diff(Y,D);if(U){L.x=D.x+ka.x;L.y=D.y+ka.y}else{L.x=D.x-ka.x*ga;L.y=D.y-ka.y*ga}r=T5.V.offset(r,L.x,L.y)}p.save();try{ha=K;if(G!==1)p.scale(G,G);else if(ca){p.translate(D.x,D.y);p.scale(K,K)}for(da=R;da--;)if(s[da].shouldDraw(O,r,B)){s[da].draw(p,r,A,O,z,B,J);s[da].trigger("drawComplete",r,J)}}finally{p.restore()}z.trigger("drawComplete",r,J);COG.Log.trace("draw complete",J)}function n(p,r){var B=false,J=!P&&(T===aa||T===ma),O=X||T===T5.viewState("PAN")||T===T5.viewState("PINCH")||
T5.isTweening();E.x=V>>0;E.y=t>>0;if(J){T5.cancelAnimation(function(ca){return ca.cancelOnInteract});M=false;if(Q!==0){clearTimeout(Q);Q=0}}for(J=R;J--;){if(s[J].animated)T|=na;B=s[J].cycle(p,E,T,O)||B}O=O||(T&na)!==0;if(B=B||O||K!==1&&K!==ia){y(ba,E,O,p);ia=K;X=false}if(!B&&I===0&&!oa){if(!M&&Q===0)Q=setTimeout(w,500);r.trigger("complete")}I=0;COG.Log.trace("Completed draw cycle",p)}function o(){X=true;u()}function u(){I+=1;if(!(x||Z)){Z=COG.Loopage.join({execute:n,frequency:pa});Z.bind("complete",
function(){Z=null})}}f=T5.ex({id:COG.objId("view"),container:"",fastDraw:false,inertia:true,pannable:true,scalable:true,panAnimationEasing:T5.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:true,tapExtent:10,fps:25},f);var s=[],R=0,F=document.getElementById(f.container),ba=null,V=0,t=0,E=new T5.Vector,H=false,Z=null,x=false,G=1,A=new T5.Dimensions,I=0,D=null,M=false,P=false,Q=0,N=0,L=new T5.Vector,S=0,$=false,U=null,W=null,X=false,ea=0,K=1,ia=
0,ha=1,fa=null,Y=null,oa=typeof FlashCanvas!=="undefined",pa=~~(1E3/f.fps),la=null,ja=T5.viewState("ACTIVE"),ma=T5.viewState("PAN"),aa=T5.viewState("PINCH"),na=T5.viewState("ANIMATING"),T=ja,qa=T5.V.getRect,v=T5.D.getSize,C=T5.R.getCenter,z={id:f.id,deviceScaling:G,fastDraw:f.fastDraw||T5.getConfig().requireFastDraw,animate:function(p,r,B,J,O){k(K,p,r,B,J,O)},centerOn:function(p){V=p.x-F.width/2;t=p.y-F.height/2},getDimensions:function(){return A},getZoomCenter:function(){return L},getLayer:function(p){for(var r=
0;r<R;r++)if(s[r].getId()==p)return s[r];return null},setLayer:function(p,r){for(var B=0;B<R;B++)if(s[B].getId()===p){s.splice(B,1);break}r&&i(p,r);o()},eachLayer:function(p){for(var r=R;r--;)p(s[r])},clearBackground:function(){COG.Log.info("CALL OF DEPRECATED METHOD CLEAR BACKGROUND");H=true;o()},invalidate:o,freeze:function(){x=true},unfreeze:function(){x=false;u()},resize:function(p,r){if(F){f.autoSize=false;F.width=p;F.height=r;j();z.trigger("resize",F.width,F.height)}},scale:function(p,r,B,J,
O){J||(J=T5.D.getCenter(A));O||(O=T5.D.getCenter(A));z.animate(p,J,O,r,B);return z},removeLayer:function(p){a:{for(var r=R;r--;)if(s[r].getId()==p){p=r;break a}p=-1}if(p>=0&&p<R){COG.say("layer.removed",{layer:s[p]});s.splice(p,1);o()}R=s.length},getOffset:function(){return E},updateOffset:h,zoom:function(p,r,B){P=false;K=r;$=K!==1;Y=T5.D.getCenter(A);D=K>1?T5.V.copy(p):T5.D.getCenter(A);U=null;clearTimeout(N);if($){T=aa;u();if(B)N=setTimeout(function(){b();K=1},parseInt(B,10))}}};COG.listen("layer.remove",
function(p){p.id&&z.removeLayer(p.id)});G=T5.getConfig().getScaling();z.markers=i("markers",new T5.MarkerLayer);COG.observable(z);z.bind("wake",u);z.bind("invalidate",o);if(f.pannable){z.bind("pan",l);z.bind("panEnd",g);z.bind("inertiaCancel",function(){P=false;u()})}if(f.scalable){z.bind("pinchZoom",a);z.bind("pinchZoomEnd",c);z.bind("wheelZoom",d)}z.bind("tap",function(p,r,B){for(var J=T5.V.offset(B,V,t),O=s.length;O--;)p.cancel=p.cancel||s[O].trigger("tap",r,B,J).cancel});COG.configurable(z,["inertia",
"container","rotation","tapExtent"],COG.paramTweaker(f,null,{container:function(p,r){F=document.getElementById(r);j()},rotation:function(p,r){S=r}}),true);j();f.autoSize&&window.addEventListener("resize",m,false);return z};
T5.PathLayer=function(f){function l(j){j.syncVectors(c);d&&j.syncVectors(d);h.trigger("tidy")}f=T5.ex({style:"waypoints",pixelGeneralization:8,zindex:50},f);var g=false,e=[],a=null,c=[],d=null,b=0,m=[],h=T5.ex(new T5.ViewLayer(f),{getAnimation:function(j,i,k,q){var w="pathAnimation"+b++;m.push(w);return new T5.AnimatedPathLayer({id:w,path:e,zindex:f.zindex+1,easing:j?j:T5.easing("sine.inout"),duration:i?i:5E3,drawIndicator:k,autoCenter:q?q:false})},cycle:function(j,i,k,q){return q},draw:function(j,
i){var k,q=e.length;j.save();try{T5.applyStyle(j,f.style);if(q>0){j.beginPath();j.moveTo(e[q-1].x-i.x,e[q-1].y-i.y);for(k=q;k--;)j.lineTo(e[k].x-i.x,e[k].y-i.y);j.stroke();if(a){j.fillStyle=f.waypointFillStyle;for(k=a.length;k--;){j.beginPath();j.arc(a[k].x-i.x,a[k].y-i.y,2,0,Math.PI*2,false);j.stroke();j.fill()}}}}finally{j.restore()}g=false},updateCoordinates:function(j,i){var k=h.getParent();k=k?k.getTileLayer():null;c=j;d=i;COG.Log.info("updating coordinates, grid = "+k);k&&l(k)}});h.bind("gridUpdate",
function(j,i){l(i);for(var k=m.length;k--;)COG.say("layer.remove",{id:m[k]});m=[]});h.bind("tidy",function(){e=T5.V.simplify(c,f.pixelGeneralization);a=T5.V.simplify(d,f.pixelGeneralization);g=true;h.changed()});return h};
T5.Poly=function(f,l){l=T5.ex({fill:false,style:null},l);var g=false,e=l.fill,a=l.style,c=[],d={draw:function(b,m,h){if(g){var j=true,i=a?T5.applyStyle(b,l.style):null;b.beginPath();for(var k=c.length;k--;){var q=c[k].x-m,w=c[k].y-h;if(j){b.moveTo(q,w);j=false}else b.lineTo(q,w)}e&&b.fill();b.stroke();i&&T5.applyStyle(b,i)}},resync:function(b){b.syncVectors(f);c=f.length<=3?f:T5.V.simplify(f)}};g=f&&f.length>=2;return d};
T5.PolyLayer=function(f){f=T5.ex({zindex:80,style:null},f);var l=[],g=false,e=T5.ex(new T5.ViewLayer(f),{add:function(a){l.unshift(a)},cycle:function(){return g},draw:function(a,c,d,b){d=c.x;c=c.y;a.save();try{T5.applyStyle(a,f.style);for(var m=l.length;m--;)l[m].draw(a,d,c,b)}finally{a.restore()}g=false}});e.bind("gridUpdate",function(a,c){for(var d=l.length;d--;)l[d].resync(c);g=true;e.changed()});e.bind("parentChange",function(a,c){var d=c?c.getTileLayer():null;if(d)for(var b=l.length;b--;)l[b].resync(d)});
COG.configurable(e,["style"],COG.paramTweaker(f,null,null),true);return e};
T5.AnimatedPathLayer=function(f){function l(b,m,h){b.fillStyle="#FFFFFF";b.strokeStyle="#222222";b.beginPath();b.arc(h.x,h.y,4,0,Math.PI*2,false);b.stroke();b.fill()}f=T5.ex({path:[],id:COG.objId("pathAni"),easing:T5.easing("sine.inout"),validStates:T5.viewState("ACTIVE","PAN","PINCH"),drawIndicator:null,duration:2E3,autoCenter:false},f);var g=T5.V.edges(f.path),e,a=null,c=0;T5.tweenValue(0,g.total,f.easing,function(){d.remove()},f.duration).requestUpdates(function(b,m){c=b;m&&d.remove()});var d=
T5.ex(new T5.ViewLayer(f),{cycle:function(){for(var b=0;b<g.accrued.length&&g.accrued[b]<c;)b++;a=null;if(b<f.path.length-1){var m=c-(b>0?g.accrued[b-1]:0),h=f.path[b],j=f.path[b+1];e=T5.V.theta(h,j,g.edges[b]);a=T5.V.pointOnEdge(h,j,e,m);if(f.autoCenter)(b=d.getParent())&&b.centerOn(a)}return a},draw:function(b,m){if(a)(f.drawIndicator?f.drawIndicator:l)(b,m,new T5.Vector(a.x-m.x,a.y-m.y),e)}});return d};
T5.Marker=function(f){f=T5.ex({xy:new T5.Vector,tweenIn:null,animationSpeed:null},f);var l=false,g=T5.ex(f,{isNew:true,isAnimating:function(){return l},draw:function(e,a,c,d,b){if(g.isNew&&f.tweenIn){var m=g.xy.y;g.xy.y=a.y-20;l=true;T5.tween(g.xy,"y",m,f.tweenIn,function(){g.xy.y=m;l=false},f.animationSpeed?f.animationSpeed:250+Math.random()*500)}g.drawMarker(e,a,g.xy.x-a.x,g.xy.y-a.y,c,d,b);g.isNew=false},drawMarker:function(e,a,c,d){e.beginPath();e.arc(c,d,4,0,Math.PI*2,false);e.fill()},hitTest:function(e,
a){return Math.abs(e-g.xy.x)<=4&&Math.abs(a-g.xy.y)<=4}});COG.observable(g);return g};
T5.ImageMarker=function(f){f=T5.ex({image:null,imageUrl:null,animatingImage:null,animatingImageUrl:null,imageAnchor:null,rotation:0,scale:1,opacity:1},f);var l=f.imageAnchor?T5.V.invert(f.imageAnchor):null,g=f.image,e=f.animatingImage;g||(g=T5.Images.get(f.imageUrl,function(c){g=c}));e||(e=T5.Images.get(f.imageUrl,function(c){e=c}));var a=T5.ex(new T5.Marker(f),{drawMarker:function(c,d,b,m){if((d=a.isAnimating()&&e?e:g)&&d.complete&&d.width>0){l||(l=new T5.Vector(-d.width>>1,-d.height>>1));if(a.rotation||
a.scale!==1||a.opacity!==1){c.save();try{c.globalAlpha=a.opacity;c.translate(b,m);c.rotate(a.rotation);c.drawImage(d,l.x*a.scale,l.y*a.scale,d.width*a.scale,d.height*a.scale)}finally{c.restore()}}else c.drawImage(d,b+l.x,m+l.y,d.width,d.height)}},hitTest:function(c,d){var b=a.xy.x,m=a.xy.y;return c>=b+l.x&&c<=b+(g.width+l.x)&&d>=m+l.y&&d<=m+(g.height+l.y)}});return a};T5.Annotation=T5.Marker;T5.ImageAnnotation=T5.ImageMarker;
T5.MarkerLayer=function(f){function l(d,b){for(var m=e.length;m--;)b.syncVectors([e[m].xy])}function g(){c.changed();c.trigger("markerUpdate",e)}f=T5.ex({zindex:100},f);var e=[],a=false,c=T5.ex(new T5.ViewLayer(f),{cycle:function(){return a},draw:function(d,b,m,h,j){a=false;for(m=e.length;m--;){e[m].draw(d,b,h,c,j);a=a||e[m].isAnimating()}return a?1:0},add:function(d){if(d&&typeof d.length!=="undefined")for(var b=d.length;b--;){if(d[b])e[e.length]=d[b]}else if(d)e[e.length]=d;g()},clear:function(d){if(d)for(var b=
0;b<e.length;b++)d(e[b])&&e.splice(b,1);else e=[];g()},find:function(d){var b=[];if(d)for(var m=e.length;m--;)if(d(e[m]))b[b.length]=e[m];return b}});c.bind("tap",function(d,b,m,h){var j=[],i=h.x;h=h.y;for(var k=e.length;k--;)if(e[k].hitTest(i,h))j[j.length]=e[k];if(j.length>0)d.cancel=c.trigger("markerTap",b,m,j).cancel});c.bind("gridUpdate",l);c.bind("changed",function(){var d=c.getParent().getTileLayer();d&&l(null,d)});return c};
T5.Style=function(f){function l(c){var d=f[c];typeof d!=="undefined"&&g.push(function(b){b[c]=d})}f=T5.ex({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},f);var g=[],e={applyToContext:function(c){for(var d=g.length;d--;)g[d](c)}};for(var a in f)l(a);return e};
(function(){var f={},l={basic:new T5.Style({lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"}),waypoints:new T5.Style({lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"})};T5.applyStyle=function(g,e){var a=T5.styles[e]?T5.styles[e]:T5.styles.basic,c;if(g&&g.canvas){c=f[g.canvas.id];f[g.canvas.id]=e}a.applyToContext(g);return c};T5.loadStyles=function(g){COG.jsonp(g,function(e){T5.resetStyles(e)})};T5.resetStyles=function(g){var e={};for(var a in g)e[a]=new T5.Style(g[a]);T5.styles=T5.ex({},
l,e)};T5.styles=l})();(function(){T5.tileSize=256;T5.Tile=function(f){return f=T5.ex({x:0,y:0,gridX:0,gridY:0,dirty:true},f)};T5.EmptyTile=function(f){f=new T5.Tile(f);f.empty=true;return f};T5.ImageTile=function(f){f=T5.ex({url:"",sessionParamRegex:null,loading:false,loaded:false},f);return new T5.Tile(f)}})();
T5.TileGrid=function(f){function l(x,G){var A=T5.Vector(x*b-j.x,G*b-j.y);return new T5.EmptyTile({gridX:A.x,gridY:A.y,empty:true})}function g(x,G,A,I){var D=d*0.2>>0,M=new T5.Vector;if(x<0||x+A>d)M.x=x<0?-D:D;if(G<0||G+I>d)M.y=G<0?-D:D;return M}function e(x,G,A){var I=COG.Log.getTraceTicks(),D=0;new T5.Vector(d/2,d/2);if(A)c=[];if(x)for(A=0;A<d;A++)for(var M=0;M<d;M++){if(!c[D]){var P=x(M,A,m,d);P.gridX=M*b-j.x;P.gridY=A*b-j.y;c[D]=P}D++}h=x;k=G;COG.Log.trace("tile grid populated",I);Z.changed()}
function a(x,G,A,I){var D,M=[],P=false;x=new T5.Vector((x.x+j.x)*y>>0,(x.y+j.y)*y>>0);tilesNeeded=false;if(!t){D=Z.getParent().getDimensions();ba=Math.ceil(D.width*y)+1;V=Math.ceil(D.height*y)+1;t=new T5.Vector((ba-1)/2>>0,(V-1)/2>>0)}for(var Q=V;Q--;)for(var N=ba;N--;){D=N+x.x>=0&&N+x.x<d?c[(Q+x.y)*d+(N+x.x)]:null;var L=new T5.Vector(N-t.x,Q-t.y);if(!D){R=g(x.x,x.y,ba,V);D=l(N+x.x,Q+x.y)}P=D?(D.dirty=A||D.dirty)||P:P;M[M.length]={tile:D,centerness:T5.V.absSize(L)}}M.sort(function(S,$){return $.centerness-
S.centerness});o||(o=Array(M.length));for(A=M.length;A--;){o[A]=M[A].tile;Z.prepTile(o[A],G)}s=I;return P}f=T5.ex({tileSize:T5.tileSize,center:new T5.Vector,gridSize:25,shiftOrigin:null,supportFastDraw:true,allowShift:true},f);var c=Array(Math.pow(f.gridSize,2)),d=f.gridSize,b=f.tileSize,m=T5.V.offset(f.center,-Math.ceil(f.gridSize>>1)),h=null,j=new T5.Vector,i=false,k=null,q=Math.round(b/2),w=false,y=b?1/b:0,n=true,o=null,u=false,s=0;new T5.Vector;var R=new T5.Vector;T5.getConfig();var F=d*b,ba,
V,t,E=T5.viewState("ANIMATING"),H=T5.viewState("PINCH"),Z=T5.ex(new T5.ViewLayer(f),{gridDimensions:new T5.Dimensions(F,F),cycle:function(x,G,A,I){if(R.x!==0||R.y!==0){I=R;var D=f.shiftOrigin;if(!(!f.allowShift||I.x===0&&I.y===0)){var M=COG.Log.getTraceTicks(),P=Array(c.length);P.length=c.length;for(var Q=0;Q<d;Q++)for(var N=0;N<d;N++)P[N*d+Q]=Q+I.x>=0&&Q+I.x<d?c[(N+I.y)*d+(Q+I.x)]:null;c=P;m=D?D(m,I):T5.V.add(m,I);j.x+=-I.x*b;j.y+=-I.y*b;COG.Log.trace("tile storage shifted",M);e(h,k)}R=new T5.Vector;
I=true}if(!w&&(A&H)===0)w=a(G,A,I,x);i=(A&E)!==0||T5.isTweening();return w},deactivate:function(){n=false},find:function(x){if(!x)return null;for(var G=c.length;G--;){var A=c[G];if(A&&x(A))return A}return null},prepTile:function(){},drawTile:function(){return false},getTileSize:function(){return b},clearTileRect:function(x,G,A,I){x.clearRect(G,A,I,I)},draw:function(x,G,A,I,D,M,P){if(n){var Q=G.x;G=G.y;var N=A.width,L=A.height,S=true;if(o){for(var $=o.length;$--;){var U=o[$],W=U.gridX-Q,X=U.gridY-
G;U.x=W;U.y=X;if(U.empty){COG.Log.info("empty tile @ x: "+W+", y: "+X);Z.clearTileRect(x,W,X,b,I);S=false}else if(M||U.dirty){i&&Z.clearTileRect(x,W,X,b,I);S=Z.drawTile(x,U,W,X,I,M,P)&&S}N=W<N?W:N;L=X<L?X:L}N>0&&x.clearRect(0,0,N,A.height);L>0&&x.clearRect(0,0,A.width,L);S&&!u&&D.trigger("tileDrawComplete");w=false;u=S}}},getTileAtXY:function(x,G){for(var A=null,I=o?o.length:0;I--;){var D=o[I];if(D&&x>=D.x&&G>=D.y)if(x<=D.x+b&&G<=D.y+b){A=D;break}}COG.Log.info("looking for tile @ x: "+x+", y: "+G+
", found: "+A);return A},getTileVirtualXY:function(x,G,A){x=T5.V.add(new T5.Vector(x,G),T5.V.invert(m),j);x=new T5.Vector(x.x*b,x.y*b);if(A){x.x+=q;x.y+=q}return x},populate:function(x){e(x,null,true)},syncVectors:function(){}});Z.bind("resize",function(){COG.Log.info("captured resize");t=null});COG.listen("imagecache.cleared",function(){for(var x=c.length;x--;)if(c[x])c[x].loaded=false});COG.listen("tiler.repaint",function(){for(var x=c.length;x--;)if(c[x]){c[x].x=null;c[x].y=null}});return Z};
T5.ImageTileGrid=function(f){function l(k){function q(){var w=T5.Images.newCanvas(32,32),y=w.getContext("2d");y.fillStyle="#BBBBBB";y.fillRect(0,0,32,32);y.fillStyle="#C3C3C3";y.fillRect(0,0,16,16);y.fillRect(16,16,16,16);return w}if(!e||k!==e.width){e=T5.Images.newCanvas(k,k);k=e.getContext("2d");k.fillStyle=typeof FlashCanvas!=="undefined"?"#666666":k.createPattern(q(),"repeat");k.fillRect(0,0,e.width,e.height)}return e}f=T5.ex({emptyTile:function(k){if(!g||k!==g.width){g=T5.Images.newCanvas(k,
k);k=g.getContext("2d");k.fillStyle="rgba(150, 150, 150, 0.1)";k.fillRect(0,0,g.width,g.height)}return g}(T5.tileSize),panningTile:null,tileOffset:new T5.Vector,tileDrawArgs:{}},f);var g=f.emptyTile,e=f.panningTile?f.panningTile:l(T5.tileSize),a=T5.viewState("ACTIVE"),c=T5.viewState("PAN"),d=T5.getConfig().requireFastDraw,b=f.tileSize?f.tileSize:T5.tileSize,m=T5.Images.get,h=T5.Images.load,j=T5.ex({background:null,overlay:null,offset:new T5.Vector,realSize:new T5.Dimensions(b,b)},f.tileDrawArgs),
i=T5.ex(new T5.TileGrid(f),{clearTileRect:function(k,q,w,y,n){(n&c)===0&&k.clearRect(q,w,y,y)},drawTile:function(k,q,w,y,n,o){var u=q.url?m(q.url):null,s=false;if(u){k.drawImage(u,w,y);s=true}else if(o||(n&c)!==0)k.drawImage(e,w,y);else if(g&&!q.drawnEmpty){k.drawImage(g,w,y);q.drawnEmpty=true}q.dirty=false;return s},initTileUrl:function(){},prepTile:function(k,q){if(k&&!k.loading&&(!d||q===a)){k.url||i.initTileUrl(k);if(!m(k.url)){k.loading=true;h(k.url,function(){k.loaded=true;k.dirty=true;i.changed()},
j)}}}});return i};
T5.Tiler=function(f){f=T5.ex({container:"",drawCenter:false,datasources:{},tileLoadThreshold:"first"},f);var l=T5.ex(new T5.View(f),{getTileLayer:function(){return l.getLayer("grid0")},setTileLayer:function(g){l.setLayer("grid0",g);l.trigger("gridUpdate",g);l.eachLayer(function(e){e.trigger("gridUpdate",g)})},viewPixToGridPix:function(g){var e=l.getOffset();return new T5.Vector(g.x+e.x,g.y+e.y)},centerOn:function(g,e,a,c){var d=l.getTileLayer(),b=l.getDimensions();(d=d?d.getTileSize():0)&&l.updateOffset(g.gridX-
(b.width-d)*0.5>>0,g.gridY-(b.height-d)*0.5>>0,e,a,c)},cleanup:function(){l.removeLayer("grid0")},repaint:function(){COG.say("tiler.repaint");l.trigger("wake")},select:function(g){l.trigger("selectTile",g)}});l.bind("tap",function(g,e,a){if(g=l.getTileLayer())(a=g.getTileAtXY(a.x,a.y))&&l.trigger("selectTile",a)});return l};
