COG=typeof COG!=="undefined"?COG:{};COG.extend=function(){for(var R=arguments[0]||{},$,C=1,B=arguments.length;C<B;C++)if(($=arguments[C])!==null)for(var q in $){var s=$[q];if(R!==s)if(s!==undefined)R[q]=s}return R};
(function(){var R=Object.prototype.hasOwnProperty,$=0,C={};C.toID=function(B){return B.replace(/\s/g,"-")};C.objId=function(B){return(B?B:"obj")+$++};C.isFunction=function(B){return toString.call(B)==="[object Function]"};C.isArray=function(B){return toString.call(B)==="[object Array]"};C.isPlainObject=function(B){if(!B||toString.call(B)!=="[object Object]"||B.nodeType||B.setInterval)return false;if(B.constructor&&!R.call(B,"constructor")&&!R.call(B.constructor.prototype,"isPrototypeOf"))return false;
var q;for(q in B);return q===undefined||R.call(B,q)};C.isEmptyObject=function(B){for(var q in B)return false;return true};C.isXmlDocument=function(B){return toString.call(B)==="[object Document]"};C.contains=function(B,q){var s=B,x=arguments,E=1;if(q&&module.isArray(q)){x=q;E=0}for(E=E;E<x;E++)s=s&&typeof foo[x[E]]!=="undefined";return s};C.formatStr=function(B){if(arguments.length<=1)return B;for(var q=arguments.length-2,s=0;s<=q;s++)B=B.replace(RegExp("\\{"+s+"\\}","gi"),arguments[s+1]);return B};
C.wordExists=function(B,q){var s="";if(q.toString)q=q.toString();for(var x=0;x<q.length;x++)s+=!/\w/.test(q[x])?"\\"+q[x]:q[x];return RegExp("(^|\\s|\\,)"+s+"(\\,|\\s|$)","i").test(B)};COG.extend(COG,C)})();
(function(){function R(s){return typeof console!=="undefined"?function(){console[s](Array.prototype.slice.call(arguments,0).join(" "));return true}:function(){return false}}var $=window.console&&window.console.markTimeline,C=R("error"),B=R("info"),q=function(){return $?function(s,x){console.markTimeline(s+(x?": "+((new Date).getTime()-x)+"ms":""))}:function(){}}();COG.extend(COG,{trace:q,debug:R("debug"),info:B,warn:R("warn"),error:C,exception:function(s){if(C)for(var x in s)B("ERROR DETAIL: "+x+
": "+s[x])}})})();
COG.Loopage=function(){function R(K){return COG.extend({id:s++,frequency:0,after:0,single:false,lastTick:0,execute:function(){}},K)}function $(K){E.push(K);C()}function C(){U&&clearTimeout(U);U=setTimeout(B,0);fa=true}function B(){for(var K,o=(new Date).getTime(),y=x.length;E.length>0;){var A=E.shift();for(K=y;K--;)if(x[K].id===A){x.splice(K,1);break}fa=true;y=x.length}if(fa){Q=q;for(K=y;K--;)Q=x[K].frequency<Q?x[K].frequency:Q}for(K=y;K--;){A=o-x[K].lastTick;if(x[K].lastTick===0||A>=x[K].frequency){x[K].execute(o,
x[K]);x[K].lastTick=o;x[K].single&&x[K].trigger("complete")}}U=y?setTimeout(B,Q):0}var q=6E4,s=0,x=[],E=[],U=0,Q=q,fa=true;return{join:function(K){var o=new R(K);if(o.after>0)o.lastTick=(new Date).getTime()+o.after;COG.observable(o);o.bind("complete",function(){$(o.id)});x.unshift(o);C();return o},leave:$}}();
(function(){function R(C,B){var q=C.obsHandlers;q[B]||(q[B]=[]);return q[B]}var $=0;COG.observable=function(C){if(!C)return null;if(!C.obsHandlers)C.obsHandlers={};if(!(C.bind||C.trigger||C.unbind)){C.bind=function(B,q){var s="callback"+$++;R(C,B).unshift({fn:q,id:s});return s};C.trigger=function(B){var q=R(C,B),s={cancel:false,name:B,tickCount:(new Date).getTime()},x;if(!q)return null;x=Array.prototype.slice.call(arguments,1);C.eventInterceptor&&C.eventInterceptor(B,s,x);x.unshift(s);for(var E=q.length;E--&&
!s.cancel;)q[E].fn.apply(self,x);return s};C.unbind=function(B,q){if(typeof B==="undefined")C.obsHandlers={};else for(var s=R(C,B),x=0;s&&x<s.length;x++)if(s[x].id===q){s.splice(x,1);break}return C}}return C}})();
(function(){function R(q,s){q[s]||(q[s]=function(x){return q.configure(s,x)})}function $(q){q.gtConfId="configurable"+B++;q.gtConfig={};q.gtConfigFns=[];return q.gtConfig}var C={},B=0;COG.paramTweaker=function(q,s,x){return function(E,U){if(typeof U!=="undefined"){if(E in q)q[E]=U;x&&E in x&&x[E](E,U)}else return s&&E in s?s[E](E):q[E]}};COG.configurable=function(q,s,x,E){if(q){q.gtConfId||$(q);var U=q.gtConfId,Q=q.gtConfig,fa=q.gtConfigFns;C[U]=q;fa.push(x);for(x=s.length;x--;){Q[s[x]]=true;E&&R(q,
s[x])}if(!q.configure)q.configure=function(K,o){if(Q[K]){for(var y=fa.length;y--;){var A=fa[y](K,o);if(typeof A!=="undefined")return A}return C[U]}return null}}}})();
(function(){function R(q){var s=document.createElement("script"),x=false;s.src=q;s.async=true;s.onload=s.onreadystatechange=function(){if(!x&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){x=true;s.onload=s.onreadystatechange=null;s&&s.parentNode&&s.parentNode.removeChild(s)}};C||(C=document.getElementsByTagName("head")[0]);C.appendChild(s)}var $=0,C,B=this;COG.jsonp=function(q,s,x){q+=q.indexOf("?")>=0?"&":"?";var E="json"+ ++$;B[E]=function(U){s(U);B[E]=null;try{delete B[E]}catch(Q){}};
R(q+(x?x:"callback")+"="+E);return E}})();
(function(){function R(c){if(K)return Q.length;K=true;try{for(var k=0;k<Q.length;)if(Q[k].isComplete()){Q[k].triggerComplete(false);Q.splice(k,1)}else{Q[k].update(c);k++}}finally{K=false}Q.length===0&&fa.trigger("complete");return Q.length}function $(){if(!fa){fa=COG.Loopage.join({execute:R,frequency:20});fa.bind("complete",function(){fa=null})}}var C=1.70158,B=Math.PI/2,q=Math.abs,s=Math.pow,x=Math.sin,E=Math.asin,U=Math.cos,Q=[],fa=null,K=false,o={linear:function(c,k,m,v){return m*c/v+k},backin:function(c,
k,m,v){return m*(c/=v)*c*((C+1)*c-C)+k},backout:function(c,k,m,v){return m*((c=c/v-1)*c*((C+1)*c+C)+1)+k},backinout:function(c,k,m,v){return(c/=v/2)<1?m/2*c*c*(((C*=1.525)+1)*c-C)+k:m/2*((c-=2)*c*(((C*=1.525)+1)*c+C)+2)+k},bouncein:function(c,k,m,v){return m-o.bounceout(v-c,0,m,v)+k},bounceout:function(c,k,m,v){return(c/=v)<1/2.75?m*7.5625*c*c+k:c<2/2.75?m*(7.5625*(c-=1.5/2.75)*c+0.75)+k:c<2.5/2.75?m*(7.5625*(c-=2.25/2.75)*c+0.9375)+k:m*(7.5625*(c-=2.625/2.75)*c+0.984375)+k},bounceinout:function(c,
k,m,v){return c<v/2?o.bouncein(c*2,0,m,v)/2+k:o.bounceout(c*2-v,0,m,v)/2+m/2+k},cubicin:function(c,k,m,v){return m*(c/=v)*c*c+k},cubicout:function(c,k,m,v){return m*((c=c/v-1)*c*c+1)+k},cubicinout:function(c,k,m,v){if((c/=v/2)<1)return m/2*c*c*c+k;return m/2*((c-=2)*c*c+2)+k},elasticin:function(c,k,m,v,L,H){if(c==0)return k;if((c/=v)==1)return k+m;H||(H=v*0.3);if(!L||L<q(m)){L=m;m=H/4}else m=H/TWO_PI*E(m/L);return-(L*s(2,10*(c-=1))*x((c*v-m)*TWO_PI/H))+k},elasticout:function(c,k,m,v,L,H){var Z;if(c==
0)return k;if((c/=v)==1)return k+m;H||(H=v*0.3);if(!L||L<q(m)){L=m;Z=H/4}else Z=H/TWO_PI*E(m/L);return L*s(2,-10*c)*x((c*v-Z)*TWO_PI/H)+m+k},elasticinout:function(c,k,m,v,L,H){var Z;if(c==0)return k;if((c/=v/2)==2)return k+m;H||(H=v*0.3*1.5);if(!L||L<q(m)){L=m;Z=H/4}else Z=H/TWO_PI*E(m/L);if(c<1)return-0.5*L*s(2,10*(c-=1))*x((c*v-Z)*TWO_PI/H)+k;return L*s(2,-10*(c-=1))*x((c*v-Z)*TWO_PI/H)*0.5+m+k},quadin:function(c,k,m,v){return m*(c/=v)*c+k},quadout:function(c,k,m,v){return-m*(c/=v)*(c-2)+k},quadinout:function(c,
k,m,v){if((c/=v/2)<1)return m/2*c*c+k;return-m/2*(--c*(c-2)-1)+k},sinein:function(c,k,m,v){return-m*U(c/v*B)+m+k},sineout:function(c,k,m,v){return m*x(c/v*B)+k},sineinout:function(c,k,m,v){return-m/2*(U(Math.PI*c/v)-1)+k}},y=COG.Tween=function(c){c=COG.extend({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:A("sine.out"),complete:null},c);var k=(new Date).getTime(),m=[],v=false,L=0,H=0,Z={isComplete:function(){return v},triggerComplete:function(F){c.complete&&c.complete(F)},
update:function(F){try{var ka=c.tweenFn(F-k,L,H,c.duration);if(c.target)c.target[c.property]=ka;for(var W=m.length;W--;)m[W](ka,void 0);if(v=k+c.duration<=F){if(c.target)c.target[c.property]=c.tweenFn(c.duration,L,H,c.duration);for(var la=m.length;la--;)m[la](ka,true)}}catch(ba){COG.exception(ba)}},requestUpdates:function(F){m.push(F)}};L=c.target&&c.property&&c.target[c.property]?c.target[c.property]:c.startValue;if(typeof c.endValue!=="undefined")H=c.endValue-L;if(H==0)v=true;$();return Z};COG.tweenValue=
function(c,k,m,v,L){c=new y({startValue:c,endValue:k,tweenFn:m,complete:v,duration:L});Q.push(c);return c};COG.tween=function(c,k,m,v,L,H){c=new y({target:c,property:k,endValue:m,tweenFn:v,duration:H,complete:L});Q.push(c);return c};COG.endTweens=function(c){if(!K){K=true;try{for(var k=0;k<Q.length;)if(!c||c(Q[k])){Q[k].triggerComplete(true);Q.splice(k,1)}else k++}finally{K=false}}};COG.getTweens=function(){return[].concat(Q)};var A=COG.easing=function(c){return o[c.replace(/[\-\_\s\.]/g,"").toLowerCase()]};
COG.registerEasingType=function(c,k){o[c.replace(/[\-\_\s\.]/g,"").toLowerCase()]=k}})();
INTERACT=function(){function R(o){return function(y,A,c){(c?c:o?document.body:document).addEventListener(y,A,false)}}function $(o){return function(y,A,c){(c?c:o?document.body:document).removeEventListener(y,A,false)}}function C(o,y,A){(A?A:document).attachEvent("on"+o,y)}function B(o,y,A){(A?A:document).detachEvent("on"+o,y)}function q(o,y){return{x:o?o:0,y:y?y:0,count:1}}function s(o,y){fa.push(COG.extend({handler:null,checks:{},type:o},y))}function x(o){var y=0,A=0;if(o.offsetParent){do{y+=o.offsetLeft;
A+=o.offsetTop;o=o.offsetParent}while(o)}return{x:y,y:A}}function E(o,y){for(var A=o.target?o.target:o.srcElement;A&&A.nodeName&&A.nodeName.toUpperCase()!="CANVAS";)A=A.parentNode;return A&&A===y}function U(o,y){return{x:o.x-(y?y.x:0),y:o.y-(y?y.y:0)}}function Q(o){if(o.preventDefault){o.preventDefault();o.stopPropagation()}else o.cancelBubble&&o.cancelBubble()}var fa=[],K=function(o,y,A){function c(H,Z,F,ka){k.trigger("pan",ka.x,ka.y)}A=COG.extend({binder:null,unbinder:null,observable:null},A);for(var k=
A.observable,m=[],v={bind:function(){return k.bind.apply(null,arguments)},pannable:function(H){COG.extend({inertia:true},H);k.bind("pointerMove",c);return v},unbind:function(){k.unbind();for(var H=0;H<m.length;H++)m[H].unbind();return v}},L=0;L<y.length;L++)m.push(y[L](o,k,A));return v};s("pointer",{handler:function(o,y,A){function c(p){if(E(p,o))if(ka=L(p)){o.style.cursor="move";Q(p);ca=p.pageX?p.pageX:p.screenX;da=p.pageY?p.pageY:p.screenY;W=q(ca,da);la=x(o);y.trigger("pointerDown",W,U(W,la))}}
function k(p){ba=p.pageX?p.pageX:p.screenX;ea=p.pageY?p.pageY:p.screenY;ka&&E(p,o)&&H("pointerMove")}function m(p){if(ka&&L(p)){ka=false;if(E(p,o)){o.style.cursor="default";H("pointerUp")}}}function v(p){if(E(p,o)){var ha;p=p||window.event;if(p.detail)ha=p.axis===2?-p.detail*Z:0;else{ha=p.wheelDeltaY?p.wheelDeltaY:p.wheelDelta;if(window.opera)ha=-ha}if(ha!==0){var qa=q(ba,ea);y.trigger("zoom",qa,U(qa,x(o)),ha/F,"wheel");Q(p);p.returnValue=false}}}function L(p){p=p||window.event;return(p.which||p.button)==
1}function H(p){var ha=q(ba,ea);y.trigger(p,ha,U(ha,la),q(ba-ca,ea-da));ca=ba;da=ea}A=COG.extend({inertia:false},A);var Z=120,F=Z*8,ka=false,W,la,ba,ea,ca,da;A.binder("mousedown",c,false);A.binder("mousemove",k,false);A.binder("mouseup",m,false);A.binder("click",function(p){if(E(p,o)){p=q(p.pageX?p.pageX:p.screenX,p.pageY?p.pageY:p.screenY);y.trigger("tap",p,U(p,x(o)))}},false);A.binder("dblclick",function(p){COG.info("captured double click");if(E(p,o)){p=q(p.pageX?p.pageX:p.screenX,p.pageY?p.pageY:
p.screenY);COG.info("captured double click + target matched");y.trigger("doubleTap",p,U(p,x(o)))}},false);A.binder("mousewheel",v,document);A.binder("DOMMouseScroll",v,document);return{unbind:function(){A.unbinder("mousedown",c,false);A.unbinder("mousemove",k,false);A.unbinder("mouseup",m,false);A.unbinder("mousewheel",v,document);A.unbinder("DOMMouseScroll",v,document)}}},checks:{touch:false}});s("pointer",{handler:function(o,y,A){function c(M){if(M.count<2)return 0;var O=M.x-M.next.x;M=M.y-M.next.y;
return~~Math.sqrt(O*O+M*M)}function k(M,O,P){O=O?O:0;P=P?P:0;for(var ra={x:M.x-O,y:M.y-P,id:M.id,count:M.count},oa=ra;M.next;){M=M.next;oa=oa.next={x:M.x-O,y:M.y-P,id:M.id}}return ra}function m(M,O){var P=M[O?O:"touches"],ra,oa;if(P.length===0)return null;oa=ra={x:P[0].pageX,y:P[0].pageY,id:P[0].identifier,count:P.length};for(var wa=1,Sa=P.length;wa<Sa;wa++)oa=oa.next={x:P[wa].pageX,y:P[wa].pageY,id:P[wa].identifier};return ra}function v(M){if(E(M,o)){ea=x(o);var O=m(M,"changedTouches"),P=k(O,ea.x,
ea.y);if(!da){ca=W;y.trigger("pointerDown",O,P)}Ea&&y.trigger("pointerDownMulti",O,P);da=m(M);if(da.count>1)ha=c(da);xa=1;qa=k(da)}}function L(M){if(E(M,o)){M.preventDefault();p=m(M);if(ca==W)ca=Math.abs(da.x-p.x)>F||Math.abs(da.y-p.y)>F?ka:W;if(ca!=W){ca=p.count>1?ba:la;if(ca==ba)if(da.count===1){da=k(p);ha=c(da)}else{M=c(p);if(Math.abs(ha-M)<Z)ca=la;else{var O;O=p.x;var P=p.next.x,ra=p.y,oa=p.next.y,wa=ra<oa?ra:oa;O={x:(O<P?O:P)+(Math.abs(O-P)>>1),y:wa+(Math.abs(ra-oa)>>1)};M=M/ha;P=M-xa;y.trigger("zoom",
O,U(O,ea),P,"pinch");xa=M}}ca==la&&y.trigger("pointerMove",p,k(p,ea.x,ea.y),q(p.x-qa.x,p.y-qa.y));Ea&&y.trigger("pointerMoveMulti",p,k(p,ea.x,ea.y))}qa=k(p)}}function H(M){if(E(M,o)){var O=m(M,"changedTouches"),P=k(O,ea.x,ea.y);p=m(M);if(!p){ca===W&&y.trigger("pointerTap",O,P);y.trigger("pointerUp",O,P);da=null}Ea&&y.trigger("pointerUpMulti",O,P)}}A=COG.extend({detailed:false,inertia:false},A);var Z=20,F=7,ka=0,W=1,la=2,ba=3,ea,ca,da,p,ha,qa,Ea=A.detailed,xa=1;A.binder("touchstart",v,false);A.binder("touchmove",
L,false);A.binder("touchend",H,false);COG.info("initialized touch handler");return{unbind:function(){A.unbinder("touchstart",v,false);A.unbinder("touchmove",L,false);A.unbinder("touchend",H,false)}}},checks:{touch:true}});return{register:s,watch:function(o,y,A){y=COG.extend({bindToBody:false,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},y);capabilities=COG.extend({touch:"ontouchstart"in window},A);if(!y.observable){COG.info("creating observable");y.observable=COG.observable({});
globalOpts=y}y.binder=y.isIE?C:R(y.bindToBody);y.unbinder=y.isIE?B:$(y.bindToBody);A=y.types;for(var c=capabilities,k=[],m=fa.length;m--;){var v=fa[m],L=!A||A.indexOf(v.type)>=0,H=true;for(var Z in v.checks){var F=v.checks[Z];COG.info("checking "+Z+" capability. require: "+F+", capability = "+c[Z]);H=H&&F===c[Z]}if(L&&H)k[k.length]=v.handler}return new K(o,k,y)}}}();
T5=function(){function R(){return(new Date).getTime()}function $(){for(;p.length>0;){var b=p.shift();document.location=b}da=0}function C(b){for(var i=true,e=ha.length;e--;)i=i&&b!=ha[e];return i}function B(b,i){var e=[];for(var a in i)a&&e.push(a+"="+escape(i[a]));return"tile5://"+b+"/"+(e.length>0?"?"+e.join("&"):"")}function q(b,i){C(b)&&COG.info("would push url: "+B(b,i))}function s(b,i){if(C(b)){p.push(B(b,i));da||(da=setTimeout($,100))}}function x(b){return function(i,e,a){(a?a:b?document.body:
document).addEventListener(i,e,false)}}function E(b){return function(i,e,a){(a?a:b?document.body:document).removeEventListener(i,e,false)}}function U(b,i,e){(e?e:document).attachEvent("on"+b,i)}function Q(b,i,e){(e?e:document).detachEvent("on"+b,i)}function fa(){ba={base:{name:"Unknown",bindEvent:x(),unbindEvent:E(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:q,targetFps:null},ie:{name:"MSIE",regex:/msie/i,
bindEvent:U,unbindEvent:Q,requireFastDraw:false,targetFps:25},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:s,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:s},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:s},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:x(true),unbindEvent:E(true),supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},
bridgeNotify:s},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:s}};ea=[ba.froyo,ba.android,ba.ipod,ba.iphone,ba.ipad,ba.ie]}function K(){ba||fa();if(!ca){COG.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var b=0;b<ea.length;b++){var i=ea[b];if(i.regex&&i.regex.test(navigator.userAgent)){ca=COG.extend({},ba.base,i);COG.info("PLATFORM DETECTED AS: "+ca.name);break}}if(!ca){COG.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
ca=ba.base}COG.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return ca}function o(){for(var b=0,i=arguments.length;i--;){var e=M[arguments[i].toUpperCase()];if(e)b|=e}return b}var y=Math.abs,A=Math.min,c=Math.max,k=Math.pow,m=Math.sqrt,v=Math.log,L=Math.sin,H=Math.asin,Z=Math.cos,F=function(){function b(a,d){return e(a.x-d.x,a.y-d.y)}function i(a,d){if(!d)d=a.length;if(d<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var f={edges:Array(d-
1),accrued:Array(d-1),total:0},g=0;g<d-1;g++){var j=b(a[g],a[g+1]);f.edges[g]=m(j.x*j.x+j.y*j.y);f.accrued[g]=f.total+f.edges[g];f.total+=f.edges[g]}return f}function e(a,d){return{x:a?a:0,y:d?d:0}}return{VECTOR_SIMPLIFICATION:3,SIMPLIFICATION_MIN_VECTORS:25,add:function(){for(var a=0,d=0,f=arguments.length;f--;){a+=arguments[f].x;d+=arguments[f].y}return e(a,d)},absSize:function(a){return c(y(a.x),y(a.y))},copy:function(a){return a?e(a.x,a.y):null},diff:b,distance:function(a,d){return i(a,d).total},
edges:i,equals:function(a,d){return a.x===d.x&&a.y===d.y},extendBy:function(a,d,f){var g=Z(d)*f;d=L(d)*f;return e(a.x-g,a.y-d)},floor:function(a){for(var d=Array(a.length),f=a.length;f--;)d[f]=e(~~a[f].x,~~a[f].y);return d},getRect:function(a){for(var d,f,g,j,n=a.length;n--;){var h=a[n];d=typeof d==="undefined"||h.x<d?h.x:d;f=typeof f==="undefined"||h.y<f?h.y:f;g=typeof g==="undefined"||h.x>g?h.x:g;j=typeof j==="undefined"||h.y>j?h.y:j}return W.init(d,f,g,j)},init:e,invert:function(a){return e(-a.x,
-a.y)},min:function(a,d){return e(a.x<d.x?a.x:d.x,a.y<d.y?a.y:d.y)},max:function(a,d){return e(a.x>d.x?a.x:d.x,a.y>d.y?a.y:d.y)},offset:function(a,d,f){return e(a.x+d,a.y+(f?f:d))},simplify:function(a,d){if(!a)return null;d=d?d:F.VECTOR_SIMPLIFICATION;for(var f=[],g=null,j=a.length;j--;){var n=a[j];if(include=!g||j===0||y(n.x-g.x)+y(n.y-g.y)>d){f.unshift(n);g=n}}return f},theta:function(a,d,f){f=H((a.y-d.y)/f);return a.x>d.x?f:Math.PI-f}}}(),ka=function(){return{dotProduct:function(b,i){return b.x*
i.x+b.y*i.y}}}(),W=function(){function b(e){return i(e.x1,e.y1,e.x2,e.y2)}function i(e,a,d,f){e=e?e:0;a=a?a:0;d=typeof d!=="undefined"?d:e;f=typeof f!=="undefined "?f:f;return{x1:e,y1:a,x2:d,y2:f,width:d-e,height:f-a}}return{center:function(e){return F.init(e.x1+e.width/2,e.y1+e.height/2)},copy:b,diagonalSize:function(e){return m(e.width*e.width+e.height*e.height)},fromCenter:function(e,a,d,f){d=d>>1;f=f>>1;return i(e-d,a-f,e+d,a+f)},init:i,intersect:function(e,a){var d=c(e.x1,a.x1),f=c(e.y1,a.y1),
g=A(e.x2,a.x2),j=A(e.y2,a.y2);d=i(d,f,g,j);return d.width>0&&d.height>0?d:null},toString:function(e){return"["+e.x1+", "+e.y1+", "+e.x2+", "+e.y2+"]"},union:function(e,a){if(e.width===0||e.height===0)return b(a);else if(a.width===0||a.height===0)return b(e);else{var d=A(e.x1,a.x1),f=A(e.y1,a.y1),g=c(e.x2,a.x2),j=c(e.y2,a.y2);d=i(d,f,g,j);return d.width>0&&d.height>0?d:null}}}}(),la=function(){return{getAspectRatio:function(b){return b.height!==0?b.width/b.height:1},getCenter:function(b){return F.init(b.width>>
1,b.height>>1)},getSize:function(b){return m(k(b.width,2)+k(b.height,2))},init:function(b,i){b=b?b:0;return{width:b,height:i?i:b}}}}(),ba=null,ea=[],ca=null,da=0,p=[],ha=["view.wake","tile.loaded"],qa=function(){function b(){if(!z){var r=K().maxImageLoads;z=COG.Loopage.join({execute:function(D,N){if(!r||h.length<r){var J=n.shift();if(J){h[h.length]=J;J.image.onload=e;J.image.src=J.url;J.requested=T5.ticks()}else N.trigger("complete")}},frequency:10});z.bind("complete",function(){z=null})}}function i(){G=
true;try{var r=l.length>>1;if(r>0){l.sort(function(N,J){return N.created-J.created});for(var D=r;D--;)delete f[l[D].url];l.splice(0,r)}}finally{G=false}V.trigger("cacheCleared")}function e(){var r=g[this.id],D;if(r&&r.image.complete&&r.image.width>0){r.loaded=true;r.hitCount=1;for(D=h.length;D--;)if(h[D].image.src==this.src){h.splice(D,1);break}if(r.background||r.postProcess||r.drawBackground||r.customDraw)if(r.image){globalImageData=r;D=d(r.realSize?r.realSize.width:r.image.width,r.realSize?r.realSize.height:
r.image.height);var N=D.getContext("2d"),J=r.offset?r.offset:T5.XY.init();r.background&&N.drawImage(r.background,0,0);r.drawBackground&&r.drawBackground(N);r.customDraw?r.customDraw(N,r):N.drawImage(r.image,J.x,J.y);r.postProcess&&r.postProcess(N,r);r.image=D}for(D=r.callbacks.length;D--;)r.callbacks[D]&&r.callbacks[D](this,false);r.callbacks=[];l[l.length]={url:this.src,created:r.requested};delete g[this.id];b()}}function a(r,D,N){var J=f[r];if(J){J.hitCount++;J.image.complete&&J.image.width>0&&
D?D(J.image,true):J.callbacks.push(D)}else{J=COG.extend({url:r,image:new Image,loaded:false,created:T5.ticks(),requested:null,hitCount:0,callbacks:[D]},N);J.image.id="resourceLoaderImage"+j++;f[r]=J;g[J.image.id]=J;n[n.length]=J;b()}return J}function d(r,D){var N=document.createElement("canvas");COG.info("creating new canvas");N.width=r?r:0;N.height=D?D:0;if(typeof FlashCanvas!="undefined"){document.body.appendChild(N);FlashCanvas.initElement(N)}return N}var f={},g={},j=0,n=[],h=[],l=[],t=0,z=null,
G=false,V={avgImageSize:25,loadTimeout:10,cancelLoad:function(){h=[]},get:function(r,D,N){var J=null,pa=null;G||(J=f[r]);if((pa=J?J.image:null)&&(pa.getContext||pa.complete&&pa.width>0))return pa;else D&&a(r,D,N);return null},load:a,newCanvas:d,reset:function(){f={}},stats:function(){return{imageLoadingCount:h.length,queuedImageCount:n.length,imageCacheFullness:t}}};COG.observable(V);COG.Loopage.join({execute:function(r){for(var D=false,N=0,J=K();N<h.length;)if(r-h[N].requested>V.loadTimeout*1E3){h.splice(N,
1);D=true}else N++;D&&b();if(J&&J.imageCacheMaxSize){t=l.length*V.avgImageSize/J.imageCacheMaxSize;t>=1&&i()}},frequency:2E4});return V}(),Ea=function(){var b={};return{init:function(i,e){var a=b[i];if(!a)throw Error("Unable to locate requested generator: "+i);return new a(e)},register:function(i,e){b[i]=e},Template:function(){}}}(),xa=function(){function b(g,j){d[g]=e(j);return g}function i(g){for(var j in g)b(j,g[j])}function e(g){function j(t){var z=g[t];typeof z!=="undefined"&&h.push(function(G){G[t]=
z})}function n(){h=[];for(var t in g)j(t)}g=COG.extend({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},g);var h=[],l={applyToContext:function(t){for(var z=h.length;z--;)h[z](t)},update:function(t,z){g[t]=z;n()}};n();return l}var a={},d={},f={apply:function(g,j){var n=d[j]?d[j]:d.basic,h;if(g&&g.canvas){h=a[g.canvas.id];a[g.canvas.id]=j}n.applyToContext(g);return h},define:b,
defineMany:i,get:function(g){return d[g]},init:e,load:function(g){COG.jsonp(g,function(j){i(j)})}};i({basic:{lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"},waypoints:{lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"}});return f}(),M={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,ZOOM:16,FREEZE:128},O=function(b){b=COG.extend({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:o("ACTIVE","ANIMATING","PAN","ZOOM"),style:null,minXY:null,maxXY:null},b);var i=null,e=false,a=false,d=
b.supportFastDraw,f=b.id,g=o("ACTIVE"),j=b.validStates,n=0,h=0,l=COG.extend({addToView:function(t){t.setLayer(f,l)},shouldDraw:function(t,z,G){return(a||G||n!==z.x1||h!==z.y1)&&(t&j)!==0&&(e?d:true)},clip:null,cycle:function(){},draw:function(){},remove:function(){l.trigger("remove",l)},changed:function(t){a=true;l.trigger("changed",l);i&&i.trigger("invalidate",t)},getId:function(){return f},setId:function(t){f=t},getParent:function(){return i},setParent:function(t){e=(i=t)?i.fastDraw&&displayState!==
g:false;l.trigger("parentChange",i)}},b);COG.observable(l);l.bind("drawComplete",function(t,z){a=false;n=z.x1;h=z.y1});l.bind("resync",function(t,z){if(z.syncXY){l.minXY&&z.syncXY(l.minXY);l.maxXY&&z.syncXY(l.maxXY)}});return l},P=function(b){function i(n,h,l,t){a=n;d=h;f=l;g=t}b=COG.extend({xy:F.init(),offset:true,tweenIn:null,animationSpeed:null,isNew:true},b);var e=false,a=0,d=0,f=0,g=0,j=COG.extend(b,{isAnimating:function(){return e},draw:function(n,h,l,t,z){if(j.isNew&&b.tweenIn){var G=j.xy.y;
j.xy.y=h.y1-20;e=true;COG.tween(j.xy,"y",G,b.tweenIn,function(){j.xy.y=G>>0;e=false},b.animationSpeed?b.animationSpeed:250+Math.random()*500)}j.drawMarker(n,h,j.xy.x,j.xy.y,l,t,z);j.isNew=false},drawMarker:function(n,h,l,t){n.beginPath();n.arc(l,t,4,0,Math.PI*2,false);n.fill();i(l-4,t-4,8,8)},hitTest:function(n,h){return n>=a&&n<=a+f&&h>=d&&h<=d+g},updateBounds:i});COG.observable(j);return j},ra=function(b){function i(){d.changed();d.trigger("markerUpdate",a)}function e(){var f=d.getParent();if(f&&
f.syncXY)for(var g=a.length;g--;)f.syncXY([a[g].xy])}b=COG.extend({zindex:100,style:"basic"},b);var a=[],d=COG.extend(new O(b),{draw:function(f,g,j,n){for(var h=a.length;h--;)a[h].draw(f,g,j,d,n)},add:function(f){if(f&&typeof f.length!=="undefined")for(var g=f.length;g--;){if(f[g])a[a.length]=f[g]}else if(f)a[a.length]=f;i()},clear:function(f){if(f)for(var g=0;g<a.length;)if(f(a[g]))a.splice(g,1);else g+=1;else a=[];i()},each:function(f){if(f)for(var g=a.length;g--;)f(a[g])},find:function(f){for(var g=
[],j=a.length;j--;)if(!f||f(a[j]))g[g.length]=a[j];return g}});d.bind("tap",function(f,g,j,n){var h=[],l=n.x;n=n.y;for(var t=a.length;t--;)if(a[t].hitTest(l,n))h[h.length]=a[t];if(h.length>0)f.cancel=d.trigger("markerTap",g,j,h).cancel});d.bind("parentChange",e);d.bind("resync",e);d.bind("changed",e);return d},oa=function(b){function i(j,n,h){j.fillStyle="#FFFFFF";j.strokeStyle="#222222";j.beginPath();j.arc(h.x,h.y,4,0,Math.PI*2,false);j.stroke();j.fill()}b=COG.extend({path:[],id:COG.objId("pathAni"),
easing:COG.easing("sine.inout"),validStates:o("ACTIVE","PAN","ZOOM"),drawIndicator:null,duration:2E3},b);var e=F.edges(b.path),a,d=null,f=0;COG.tweenValue(0,e.total,b.easing,function(){g.remove()},b.duration).requestUpdates(function(j,n){f=j;n&&g.remove()});var g=COG.extend(new O(b),{cycle:function(){for(var j=0;j<e.accrued.length&&e.accrued[j]<f;)j++;d=null;if(j<b.path.length-1){var n=f-(j>0?e.accrued[j-1]:0),h=b.path[j];a=F.theta(h,b.path[j+1],e.edges[j]);d=F.extendBy(h,a,n)}return d},draw:function(j,
n){if(d)(b.drawIndicator?b.drawIndicator:i)(j,n,F.init(d.x,d.y),a)}});return g},wa=function(b){b=COG.extend({style:null,properties:{}},b);return COG.extend(b,{rect:null,draw:function(){},resync:function(){}})},Sa=function(){return{tileSize:256,init:function(b,i,e,a,d){return COG.extend({x:b,y:i,width:e,height:a},d)}}}(),Ta={ex:COG.extend,ticks:R,getConfig:K,userMessage:function(b,i,e){Ta.trigger("userMessage",b,i,e)},zoomable:function(b,i){function e(g,j){if(g&&a!==g){var n=g>=d&&g<=f&&b.triggerAll("zoomLevelChange",
g,j);if(n)a=g;return n}}i=COG.extend({initial:1,minZoom:1,maxZoom:16},i);var a=i.initial,d=i.minZoom,f=i.maxZoom;COG.extend(b,{getZoomLevel:function(){return a},setZoomLevel:e});b.bind("scale",function(g,j,n){var h=Math.log(j)/Math.LN2;COG.endTweens(function(l){return l.cancelOnInteract});g.cancel=!e(a+h,n);g.cancel||b.updateOffset(n.x*j,n.y*j)})},XY:F,XYRect:W,Dimensions:la,Vector:ka,D:la,Images:qa,Generator:Ea,tween:COG.tween,tweenValue:COG.tweenValue,easing:COG.easing,Tween:COG.Tween,Style:xa,
viewState:o,View:function(b){function i(w,u,I,S){za=Na;D();if(S&&b.inertia)h(ma-u,na-I,b.panAnimationEasing,b.panAnimationDuration);else S||h(ma-u,na-I);clearTimeout(ab);ab=setTimeout(e,100)}function e(){za=Ua;Fa=false;D()}function a(w,u,I,S){pa(c(aa+k(2,S)-1,0.25))}function d(w){var u=v(aa)/Math.LN2>>0;if(aa!==1)za=bb;if(u!==0){aa=k(2,u);u=F.init(Oa-(Ga/aa>>0),Pa-(Ha/aa>>0));if(!ia.trigger("scale",aa,u).cancel){for(w=X.length;w--;)X[w].trigger("scale",aa,u);aa=1;hb=null;za=Ua;w=true}}D(w)}function f(w){w||
(w=F.init(Ga,Ha));Va=F.init(ma,na);Ma=F.offset(w,ma,na);Oa=Ma.x;Pa=Ma.y}function g(w,u,I){Ba("doubleTap",u,I,F.offset(I,ma,na));if(b.scalable){COG.endTweens(function(S){return S.cancelOnInteract});pa(2,I,b.zoomAnimation,null,b.zoomDuration)}}function j(){clearTimeout(cb);cb=setTimeout(l,250)}function n(w,u,I){Ba("tap",u,I,F.offset(I,ma,na))}function h(w,u,I,S,T){function ga(){va+=1;if(va>=2){e();T&&T()}}var va=0,ya=Ia?F.offset(Ia,-Ga,-Ha):null,Ca=Ja?F.offset(Ja,-Ga,-Ha):null;if(ya){w=w<ya.x?ya.x:
w;u=u<ya.y?ya.y:u}if(Ca){w=w>Ca.x?Ca.x:w;u=u>Ca.y?Ca.y:u}if(I){if(!Fa){w=COG.tweenValue(ma,w,I,ga,S);u=COG.tweenValue(na,u,I,ga,S);w.cancelOnInteract=true;w.requestUpdates(function(Ka){ma=Ka>>0;Fa=true;D()});u.cancelOnInteract=true;u.requestUpdates(function(Ka){na=Ka>>0;Fa=true;D()})}}else{ma=w|0;na=u|0}}function l(w,u){var I;if(ja){Aa&&Aa.unbind();if(b.autoSize&&ja.parentNode){w=ja.parentNode.offsetWidth;u=ja.parentNode.offsetHeight}try{if(!ja.id)ja.id=b.id+"_canvas";Y=ja.getContext("2d")}catch(S){COG.exception(S);
throw Error("Could not initialise canvas on specified view element");}if(w&&u&&(sa!==u||ta!==w)){Wa=true;ta=w;sa=u;Ga=ta>>1;Ha=sa>>1;ia.trigger("resize",ta,sa);for(I=ua;I--;)X[I].trigger("resize",ta,sa)}if(b.interactive){Aa=INTERACT.watch(ja).pannable();z()}for(I=ua;I--;)X[I].trigger("contextChanged",Y);D(true)}}function t(w,u){u.setId(w);u.added=R();u.bind("remove",function(){ia.removeLayer(w)});u.trigger("contextChanged",Y);u.setParent(ia);X.push(u);X.sort(function(I,S){var T=S.zindex-I.zindex;
if(T===0)T=S.added-I.added;return T});ua=X.length;return u}function z(){if(Aa){if(b.pannable){Aa.bind("pan",i);Aa.bind("inertiaCancel",function(){Fa=false;D()})}if(b.scalable){Aa.bind("zoom",a);Aa.bind("doubleTap",g)}Aa.bind("tap",n)}}function G(){J();Xa=true;La=0}function V(w,u,I,S){var T;W.center(u);var ga=0;Da=W.copy(u);Da.scaleFactor=aa;I&&Y.clearRect(0,0,ta,sa);Y.save();try{Y.globalCompositeOperation="source-over";if(aa!==1){var va=Da,ya=1/aa;Oa=Ma.x+(ma-Va.x);Pa=Ma.y+(na-Va.y);Da=va?W.fromCenter(Oa>>
0,Pa>>0,va.width*ya>>0,va.height*ya>>0):void 0;Y.scale(aa,aa)}Y.translate(-Da.x1,-Da.y1);Ja=Ia=null;if(ib){Y.beginPath();clipped=false;for(ga=ua;ga--;)if(X[ga].clip){X[ga].clip(Y,Da,w,ia,I,S);clipped=true}Y.closePath();clipped&&Y.clip()}for(ga=ua;ga--;){T=X[ga];var Ca=T.style,Ka=Ca?xa.apply(Y,Ca):null;if(T.minXY)Ia=Ia?F.min(Ia,T.minXY):F.copy(T.minXY);if(T.maxXY)Ja=Ja?F.max(Ja,T.maxXY):F.copy(T.maxXY);T.draw(Y,Da,w,ia,I,S);Ka&&xa.apply(Y,Ka)}}finally{Y.restore()}if(jb){Y.globalCompositeOperation=
"source-over";Y.strokeStyle="#f00";Y.beginPath();Y.moveTo(Ga,0);Y.lineTo(Ga,sa);Y.moveTo(0,Ha);Y.lineTo(ta,Ha);Y.stroke()}Ba("drawComplete",u,S);COG.trace("draw complete",S)}function r(w,u){var I=false,S=Ya?Ya:Fa?Na:za,T=!Fa&&(S===bb||S===Na),ga=Za||S===Na||COG.getTweens().length>0;if(Wa&&ja){typeof FlashCanvas!="undefined"&&FlashCanvas.initElement(ja);ja.width=ta;ja.height=sa;ja.style.width=ta+"px";ja.style.height=sa+"px";Wa=false}Qa=N();if(T){COG.endTweens(function(va){return va.cancelOnInteract});
Xa=false;if(La!==0){clearTimeout(La);La=0}}for(T=ua;T--;){if(X[T].animated)za|=db;X[T].cycle(w,Qa,za,ga);I=X[T].shouldDraw(za,Qa,ga)||I}ga=ga||(za&db)!==0;if(I=I||ga||aa!==1&&aa!==eb){V(S,Qa,ga,w);eb=aa;Za=false}if(!I&&$a===0&&!kb){if(!Xa&&La===0)La=setTimeout(G,lb);u.trigger("complete")}w-fb>mb&&J();$a=0;COG.trace("Completed draw cycle",w)}function D(w){Za=w?true:false;$a+=1;if(!Ra){Ra=COG.Loopage.join({execute:r,frequency:nb});Ra.bind("complete",function(){Ra=null})}}function N(){return W.init(ma,
na,ma+ta,na+sa)}function J(){fb=(new Date).getTime();Ba("refresh",ia);D()}function pa(w,u,I,S,T){function ga(){aa=Math.pow(2,Math.round(Math.log(aa)/Math.LN2));S&&S();d(true)}var va=aa;f(u);if(I)COG.tweenValue(0,w-va,I,ga,T).requestUpdates(function(ya){aa=va+ya;d()});else{aa=w;d()}return ia}function Ba(){for(var w=ia.trigger.apply(null,arguments).cancel,u=X.length;u--;)w=X[u].trigger.apply(null,arguments).cancel||w;return!w}b=COG.extend({id:COG.objId("view"),container:"",fastDraw:false,inertia:true,
idleDelay:100,minRefresh:1E3,pannable:true,clipping:false,scalable:true,interactive:true,panAnimationEasing:COG.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:true,tapExtent:10,mask:true,guides:false,fps:25,zoomAnimation:COG.easing("quad.out"),zoomDuration:300},b);var X=[],ua=0,ja=document.getElementById(b.container),Y=null,ob=typeof window.attachEvent!="undefined",lb=b.idleDelay,mb=b.minRefresh,ma=0,na=0,ib=b.clipping,Qa=null,Ra=null,Da,jb=
b.guides,gb=1,$a=0,Ga=0,Ha=0,Va=null,Ma=null,Xa=false,Fa=false,La=0,ab=0,Ia=null,Ja=null,fb=0,pb=0,Ya=null,Za=false,cb=0,hb=null,aa=1,eb=0,Wa=false,Aa=null,sa,ta,kb=typeof FlashCanvas!=="undefined",nb=~~(1E3/b.fps),Oa,Pa,Ua=o("ACTIVE"),Na=o("PAN"),bb=o("ZOOM"),db=o("ANIMATING"),za=Ua,ia={id:b.id,deviceScaling:gb,fastDraw:b.fastDraw||K().requireFastDraw,getDimensions:function(){return la.init(ta,sa)},getLayer:function(w){for(var u=0;u<ua;u++)if(X[u].getId()==w)return X[u];return null},setLayer:function(w,
u){for(var I=0;I<ua;I++)if(X[I].getId()===w){X.splice(I,1);break}u&&t(w,u);D();return u},eachLayer:function(w){for(var u=ua;u--;)w(X[u])},invalidate:D,resize:function(w,u){if(ja){b.autoSize=false;if(ta!==w||sa!==u)l(w,u)}},refresh:J,scale:pa,triggerAll:Ba,removeLayer:function(w){a:{for(var u=ua;u--;)if(X[u].getId()==w){w=u;break a}w=-1}if(w>=0&&w<ua){ia.trigger("layerRemoved",X[w]);X.splice(w,1);D()}ua=X.length},stateOverride:function(w){Ya=w},getOffset:function(){return F.init(ma,na)},getViewRect:N,
updateOffset:h,pan:function(w,u,I,S,T){h(ma+w,na+u,I,S,T)}};gb=K().getScaling();ia.markers=t("markers",new ra);COG.observable(ia);ia.bind("invalidate",function(w,u){D(u)});ia.bind("resync",function(){Ja=Ia=null});COG.configurable(ia,["inertia","container","rotation","tapExtent","scalable","pannable"],COG.paramTweaker(b,null,{container:function(w,u){ja=document.getElementById(u);l()},rotation:function(w,u){pb=u}}),true);l();if(b.autoSize)ob?window.attachEvent("onresize",j):window.addEventListener("resize",
j,false);return ia},ViewLayer:O,ImageLayer:function(b,i){function e(h,l,t){for(l=f.length;l--;){var z=f[l],G=z.x,V=z.y,r=W.init(z.x,z.y,z.x+z.width,z.y+z.height);if(t&&W.intersect(h,r)){r=qa.get(z.url,function(){n.changed()},j);t(r,G,V,z.width,z.height)}}}function a(h){d&&d.run(h,n.getParent(),function(l){f=[].concat(l);n.changed()})}i=COG.extend({imageLoadArgs:{}},i);var d=b?Ea.init(b,i):null,f=[],g=W.init(),j=i.imageLoadArgs,n=COG.extend(new O(i),{changeGenerator:function(h,l){d=Ea.init(h,COG.extend({},
i,l));f=null;a(g)},clip:function(h,l,t){e(l,t,function(z,G,V,r,D){z&&h.rect(G,V,r,D)})},cycle:function(h,l){a(l)},draw:function(h,l,t){e(l,t,function(z,G,V,r,D){n.drawImage(h,z,G,V,r,D,l,t)});g=W.copy(l)},drawImage:function(h,l,t,z){l&&h.drawImage(l,t,z,l.width,l.height)}});n.bind("refresh",function(){a(g)});n.bind("tap",function(h,l,t,z){h=[];var G=z.x,V=z.y,r,D;if(f)for(var N=f.length;N--;){r=f[N];if(D=G>=r.x&&G<=r.x+r.width&&V>=r.y&&V<=r.y+r.height)h[h.length]=r}h.length>0&&n.trigger("tapImage",
h,l,t,z)});return n},Marker:P,ImageMarker:function(b){b=COG.extend({image:null,imageUrl:null,animatingImage:null,animatingImageUrl:null,imageAnchor:null,rotation:0,scale:1,opacity:1},b);var i=b.imageAnchor?T5.XY.invert(b.imageAnchor):null,e=COG.extend(new P(b),{drawMarker:function(a,d,f,g){if((d=e.isAnimating()&&e.animatingImage?e.animatingImage:e.image)&&d.width>0){i||(i=F.init(-d.width>>1,-d.height>>1));var j=e.scale,n=f+~~(i.x*j),h=g+~~(i.y*j),l=~~(d.width*j),t=~~(d.height*j);e.updateBounds(n,
h,l,l);if(e.rotation||e.opacity!==1){a.save();try{a.globalAlpha=e.opacity;a.translate(f,g);a.rotate(e.rotation);a.drawImage(d,i.x*j,i.y*j,l,t)}finally{a.restore()}}else a.drawImage(d,n,h,l,t)}}});if(!e.image)e.image=qa.get(b.imageUrl,function(a){e.image=a});if(!e.animatingImage)e.animatingImage=qa.get(b.animatingImageUrl,function(a){e.animatingImage=a});return e},MarkerLayer:ra,PathLayer:function(b){b=COG.extend({style:"waypoints",pixelGeneralization:8,zindex:50},b);var i=false,e=[],a=null,d=[],f=
null,g=0,j=[],n=COG.extend(new O(b),{getAnimation:function(h,l,t,z){var G="pathAnimation"+g++;j.push(G);return new oa({id:G,path:e,zindex:b.zindex+1,easing:h?h:COG.easing("sine.inout"),duration:l?l:5E3,drawIndicator:t,autoCenter:z?z:false})},cycle:function(h,l,t,z){return z},draw:function(h){var l,t=e.length;h.save();try{xa.apply(h,b.style);if(t>0){h.beginPath();h.moveTo(e[t-1].x,e[t-1].y);for(l=t;l--;)h.lineTo(e[l].x,e[l].y);h.stroke();if(a){h.fillStyle=b.waypointFillStyle;for(l=a.length;l--;){h.beginPath();
h.arc(a[l].x,a[l].y,2,0,Math.PI*2,false);h.stroke();h.fill()}}}}finally{h.restore()}i=false},updateCoordinates:function(h,l){d=h;f=l;var t=n.getParent();if(t&&t.syncXY){t.syncXY(d);f&&t.syncXY(f);n.trigger("tidy")}}});n.bind("tidy",function(){e=F.simplify(d,b.pixelGeneralization);a=F.simplify(f,b.pixelGeneralization);i=true;n.changed()});return n},AnimatedPathLayer:oa,Shape:wa,Arc:function(b,i){i=COG.extend({size:4},i);var e=F.init(),a=COG.extend(i,{draw:function(d){d.beginPath();d.arc(e.x,e.y,a.size,
0,Math.PI*2,false);d.fill();d.stroke()},resync:function(d){d.syncXY([b]);e=F.floor([b])[0]}});COG.info("created arc = ",b);return a},Poly:function(b,i){i=COG.extend({fill:false,simplify:false},i);var e=false,a=i.fill,d=i.simplify,f=o("ZOOM"),g=[],j=COG.extend(new wa(i),{draw:function(n,h,l,t,z,G){if(e){h=true;l=(G&f)!==0;n.beginPath();for(G=g.length;G--;){l=g[G].x;t=g[G].y;if(h){n.moveTo(l,t);h=false}else n.lineTo(l,t);l=true}if(l){a&&n.fill();n.stroke()}}},resync:function(n){j.xy=n.syncXY(b);g=F.floor(d?
F.simplify(b):b)}});e=b&&b.length>=2;return j},ShapeLayer:function(b){function i(f){for(var g=a.length;g--;)a[g].resync(f);a.sort(function(j,n){var h=n.xy.y-j.xy.y;if(h===0)h=n.xy.x-j.xy.y;return h});d.changed()}function e(f,g){g.syncXY&&i(g)}b=COG.extend({zindex:80},b);var a=[],d=COG.extend(new O(b),{add:function(f){a[a.length]=f},each:function(f){for(var g=a.length;g--;)f(a[g])},draw:function(f,g,j){var n=g.x1,h=g.y1,l=g.width;g=g.height;for(var t=a.length;t--;){var z=a[t].style;z=z?xa.apply(f,
z):null;a[t].draw(f,n,h,l,g,j);z&&xa.apply(f,z)}}});d.bind("parentChange",e);d.bind("resync",e);return d},Tiling:Sa,TileGenerator:function(b){function i(G,V,r,D){function N(){if(z.initTileCreator){g=true;z.initTileCreator(G,V,r,D)}}z.prepTileCreator?z.prepTileCreator(G,V,r,N):N()}function e(G,V){for(var r=~~((G.x1-d.x)/j),D=~~((G.y1-d.y)/n),N=[],J=-f;J<l;J++)for(var pa=-f;pa<t;pa++){var Ba=h(r+J,D+pa);if(Ba)N[N.length]=Ba}V&&V(N);a=W.copy(G)}b=COG.extend({tileWidth:256,tileHeight:256,relative:false,
padding:2},b);var a=null,d=F.init(),f=b.padding,g=false,j=b.tileWidth,n=b.tileHeight,h=null,l=0,t=0,z={getTileCreatorArgs:null,initTileCreator:null,prepTileCreator:null,requireRefresh:function(){return false},reset:function(){h=null;g=false;a=null},run:function(G,V,r){var D=!a||Math.abs(G.x1-a.x1)>j||Math.abs(G.y1-a.y1)>n,N=D?z.requireRefresh(G,V):false;if(D){if(!h&&!g||N){d=b.relative?F.init(G.x1,G.y1):F.init();l=Math.ceil(G.width/j)+f;t=Math.ceil(G.height/n)+f;i(j,n,z.getTileCreatorArgs?z.getTileCreatorArgs(V):
{},function(J){h=J;g=false;e(G,r)})}h&&e(G,r)}}};COG.observable(z);z.bind("update",function(){COG.info("captured generator update");a=null});return z}};COG.observable(Ta);return Ta}();
