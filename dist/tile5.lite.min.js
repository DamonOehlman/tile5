COG=typeof COG!=="undefined"?COG:{};COG.extend=function(){for(var V=arguments[0]||{},ca,B=1,A=arguments.length;B<A;B++)if((ca=arguments[B])!==null)for(var q in ca){var s=ca[q];if(V!==s)if(s!==undefined)V[q]=s}return V};
(function(){var V=Object.prototype.hasOwnProperty,ca=0,B={};B.toID=function(A){return A.replace(/\s/g,"-")};B.objId=function(A){return(A?A:"obj")+ca++};B.isFunction=function(A){return toString.call(A)==="[object Function]"};B.isArray=function(A){return toString.call(A)==="[object Array]"};B.isPlainObject=function(A){if(!A||toString.call(A)!=="[object Object]"||A.nodeType||A.setInterval)return false;if(A.constructor&&!V.call(A,"constructor")&&!V.call(A.constructor.prototype,"isPrototypeOf"))return false;
var q;for(q in A);return q===undefined||V.call(A,q)};B.isEmptyObject=function(A){for(var q in A)return false;return true};B.isXmlDocument=function(A){return toString.call(A)==="[object Document]"};B.contains=function(A,q){var s=A,y=arguments,I=1;if(q&&module.isArray(q)){y=q;I=0}for(I=I;I<y;I++)s=s&&typeof foo[y[I]]!=="undefined";return s};B.formatStr=function(A){if(arguments.length<=1)return A;for(var q=arguments.length-2,s=0;s<=q;s++)A=A.replace(RegExp("\\{"+s+"\\}","gi"),arguments[s+1]);return A};
B.wordExists=function(A,q){var s="";if(q.toString)q=q.toString();for(var y=0;y<q.length;y++)s+=!/\w/.test(q[y])?"\\"+q[y]:q[y];return RegExp("(^|\\s|\\,)"+s+"(\\,|\\s|$)","i").test(A)};COG.extend(COG,B)})();
(function(){function V(s){return typeof console!=="undefined"?function(){console[s](Array.prototype.slice.call(arguments,0).join(" "));return true}:function(){return false}}var ca=window.console&&window.console.markTimeline,B=V("error"),A=V("info"),q=function(){return ca?function(s,y){console.markTimeline(s+(y?": "+((new Date).getTime()-y)+"ms":""))}:function(){}}();COG.extend(COG,{trace:q,debug:V("debug"),info:A,warn:V("warn"),error:B,exception:function(s){if(B)for(var y in s)A("ERROR DETAIL: "+
y+": "+s[y])}})})();
COG.Loopage=function(){function V(m){return COG.extend({id:s++,frequency:0,after:0,single:false,lastTick:0,execute:function(){}},m)}function ca(m){I.push(m);B()}function B(){da&&clearTimeout(da);da=setTimeout(A,0);E=true}function A(){for(var m,t=(new Date).getTime(),Q=y.length;I.length>0;){var R=I.shift();for(m=Q;m--;)if(y[m].id===R){y.splice(m,1);break}E=true;Q=y.length}if(E){W=q;for(m=Q;m--;)W=y[m].frequency<W?y[m].frequency:W}for(m=Q;m--;){R=t-y[m].lastTick;if(y[m].lastTick===0||R>=y[m].frequency){y[m].execute(t,
y[m]);y[m].lastTick=t;y[m].single&&y[m].trigger("complete")}}da=Q?setTimeout(A,W):0}var q=6E4,s=0,y=[],I=[],da=0,W=q,E=true;return{join:function(m){var t=new V(m);if(t.after>0)t.lastTick=(new Date).getTime()+t.after;COG.observable(t);t.bind("complete",function(){ca(t.id)});y.unshift(t);B();return t},leave:ca}}();
(function(){function V(B,A){var q=B.obsHandlers;q[A]||(q[A]=[]);return q[A]}var ca=0;COG.observable=function(B){if(!B)return null;if(!B.obsHandlers)B.obsHandlers={};if(!(B.bind||B.trigger||B.unbind)){B.bind=function(A,q){var s="callback"+ca++;V(B,A).unshift({fn:q,id:s});return s};B.trigger=function(A){var q=V(B,A),s={cancel:false,name:A,tickCount:(new Date).getTime()},y;if(!q)return null;y=Array.prototype.slice.call(arguments,1);B.eventInterceptor&&B.eventInterceptor(A,s,y);y.unshift(s);for(var I=
q.length;I--&&!s.cancel;)q[I].fn.apply(self,y);return s};B.unbind=function(A,q){if(typeof A==="undefined")B.obsHandlers={};else for(var s=V(B,A),y=0;s&&y<s.length;y++)if(s[y].id===q){s.splice(y,1);break}return B}}return B}})();
(function(){function V(q,s){q[s]||(q[s]=function(y){return q.configure(s,y)})}function ca(q){q.gtConfId="configurable"+A++;q.gtConfig={};q.gtConfigFns=[];return q.gtConfig}var B={},A=0;COG.paramTweaker=function(q,s,y){return function(I,da){if(typeof da!=="undefined"){if(I in q)q[I]=da;y&&I in y&&y[I](I,da)}else return s&&I in s?s[I](I):q[I]}};COG.configurable=function(q,s,y,I){if(q){q.gtConfId||ca(q);var da=q.gtConfId,W=q.gtConfig,E=q.gtConfigFns;B[da]=q;E.push(y);for(y=s.length;y--;){W[s[y]]=true;
I&&V(q,s[y])}if(!q.configure)q.configure=function(m,t){if(W[m]){for(var Q=E.length;Q--;){var R=E[Q](m,t);if(typeof R!=="undefined")return R}return B[da]}return null}}}})();
(function(){function V(q){var s=document.createElement("script"),y=false;s.src=q;s.async=true;s.onload=s.onreadystatechange=function(){if(!y&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){y=true;s.onload=s.onreadystatechange=null;s&&s.parentNode&&s.parentNode.removeChild(s)}};B||(B=document.getElementsByTagName("head")[0]);B.appendChild(s)}var ca=0,B,A=this;COG.jsonp=function(q,s,y){q+=q.indexOf("?")>=0?"&":"?";var I="json"+ ++ca;A[I]=function(da){s(da);A[I]=null;try{delete A[I]}catch(W){}};
V(q+(y?y:"callback")+"="+I);return I}})();
(function(){function V(d){if(m)return W.length;m=true;try{for(var l=0;l<W.length;)if(W[l].isComplete()){W[l].triggerComplete(false);W.splice(l,1)}else{W[l].update(d);l++}}finally{m=false}W.length===0&&E.trigger("complete");return W.length}function ca(){if(!E){E=COG.Loopage.join({execute:V,frequency:20});E.bind("complete",function(){E=null})}}var B=1.70158,A=Math.PI/2,q=Math.abs,s=Math.pow,y=Math.sin,I=Math.asin,da=Math.cos,W=[],E=null,m=false,t={linear:function(d,l,n,v){return n*d/v+l},backin:function(d,
l,n,v){return n*(d/=v)*d*((B+1)*d-B)+l},backout:function(d,l,n,v){return n*((d=d/v-1)*d*((B+1)*d+B)+1)+l},backinout:function(d,l,n,v){return(d/=v/2)<1?n/2*d*d*(((B*=1.525)+1)*d-B)+l:n/2*((d-=2)*d*(((B*=1.525)+1)*d+B)+2)+l},bouncein:function(d,l,n,v){return n-t.bounceout(v-d,0,n,v)+l},bounceout:function(d,l,n,v){return(d/=v)<1/2.75?n*7.5625*d*d+l:d<2/2.75?n*(7.5625*(d-=1.5/2.75)*d+0.75)+l:d<2.5/2.75?n*(7.5625*(d-=2.25/2.75)*d+0.9375)+l:n*(7.5625*(d-=2.625/2.75)*d+0.984375)+l},bounceinout:function(d,
l,n,v){return d<v/2?t.bouncein(d*2,0,n,v)/2+l:t.bounceout(d*2-v,0,n,v)/2+n/2+l},cubicin:function(d,l,n,v){return n*(d/=v)*d*d+l},cubicout:function(d,l,n,v){return n*((d=d/v-1)*d*d+1)+l},cubicinout:function(d,l,n,v){if((d/=v/2)<1)return n/2*d*d*d+l;return n/2*((d-=2)*d*d+2)+l},elasticin:function(d,l,n,v,M,L){if(d==0)return l;if((d/=v)==1)return l+n;L||(L=v*0.3);if(!M||M<q(n)){M=n;n=L/4}else n=L/TWO_PI*I(n/M);return-(M*s(2,10*(d-=1))*y((d*v-n)*TWO_PI/L))+l},elasticout:function(d,l,n,v,M,L){var G;if(d==
0)return l;if((d/=v)==1)return l+n;L||(L=v*0.3);if(!M||M<q(n)){M=n;G=L/4}else G=L/TWO_PI*I(n/M);return M*s(2,-10*d)*y((d*v-G)*TWO_PI/L)+n+l},elasticinout:function(d,l,n,v,M,L){var G;if(d==0)return l;if((d/=v/2)==2)return l+n;L||(L=v*0.3*1.5);if(!M||M<q(n)){M=n;G=L/4}else G=L/TWO_PI*I(n/M);if(d<1)return-0.5*M*s(2,10*(d-=1))*y((d*v-G)*TWO_PI/L)+l;return M*s(2,-10*(d-=1))*y((d*v-G)*TWO_PI/L)*0.5+n+l},quadin:function(d,l,n,v){return n*(d/=v)*d+l},quadout:function(d,l,n,v){return-n*(d/=v)*(d-2)+l},quadinout:function(d,
l,n,v){if((d/=v/2)<1)return n/2*d*d+l;return-n/2*(--d*(d-2)-1)+l},sinein:function(d,l,n,v){return-n*da(d/v*A)+n+l},sineout:function(d,l,n,v){return n*y(d/v*A)+l},sineinout:function(d,l,n,v){return-n/2*(da(Math.PI*d/v)-1)+l}},Q=COG.Tween=function(d){d=COG.extend({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:R("sine.out"),complete:null},d);var l=(new Date).getTime(),n=[],v=false,M=0,L=0,G={isComplete:function(){return v},triggerComplete:function(ha){d.complete&&d.complete(ha)},
update:function(ha){try{var $=d.tweenFn(ha-l,M,L,d.duration);if(d.target)d.target[d.property]=$;for(var ia=n.length;ia--;)n[ia]($,void 0);if(v=l+d.duration<=ha){if(d.target)d.target[d.property]=d.tweenFn(d.duration,M,L,d.duration);for(var U=n.length;U--;)n[U]($,true)}}catch(ga){COG.exception(ga)}},requestUpdates:function(ha){n.push(ha)}};M=d.target&&d.property&&d.target[d.property]?d.target[d.property]:d.startValue;if(typeof d.endValue!=="undefined")L=d.endValue-M;if(L==0)v=true;ca();return G};COG.tweenValue=
function(d,l,n,v,M){d=new Q({startValue:d,endValue:l,tweenFn:n,complete:v,duration:M});W.push(d);return d};COG.tween=function(d,l,n,v,M,L){d=new Q({target:d,property:l,endValue:n,tweenFn:v,duration:L,complete:M});W.push(d);return d};COG.endTweens=function(d){if(!m){m=true;try{for(var l=0;l<W.length;)if(!d||d(W[l])){W[l].triggerComplete(true);W.splice(l,1)}else l++}finally{m=false}}};COG.getTweens=function(){return[].concat(W)};var R=COG.easing=function(d){return t[d.replace(/[\-\_\s\.]/g,"").toLowerCase()]};
COG.registerEasingType=function(d,l){t[d.replace(/[\-\_\s\.]/g,"").toLowerCase()]=l}})();
INTERACT=function(){function V(E){return function(m,t,Q){(Q?Q:E?document.body:document).addEventListener(m,t,false)}}function ca(E){return function(m,t,Q){(Q?Q:E?document.body:document).removeEventListener(m,t,false)}}function B(E,m,t){(t?t:document).attachEvent("on"+E,m)}function A(E,m,t){(t?t:document).detachEvent("on"+E,m)}function q(E,m){return{x:E?E:0,y:m?m:0,count:1}}function s(E,m){da.push(COG.extend({handler:null,checks:{},type:E},m))}function y(E){var m=0,t=0;if(E.offsetParent){do{m+=E.offsetLeft;
t+=E.offsetTop;E=E.offsetParent}while(E)}return{x:m,y:t}}function I(E,m){return{x:E.x-(m?m.x:0),y:E.y-(m?m.y:0)}}var da=[],W=function(E,m,t){function Q(v,M,L,G){R.trigger("pan",G.x,G.y)}t=COG.extend({binder:null,unbinder:null,observable:null},t);for(var R=t.observable,d=[],l={bind:function(){return R.bind.apply(null,arguments)},pannable:function(v){COG.extend({inertia:true},v);R.bind("pointerMove",Q);return l},unbind:function(){R.unbind();for(var v=0;v<d.length;v++)d[v].unbind();return l}},n=0;n<
m.length;n++)d.push(m[n](E,R,t));return l};s("pointer",{handler:function(E,m,t){function Q(u){var X=u.target?u.target:u.srcElement;if(L||X&&X===E)if(G=u.button===0){ga=u.pageX?u.pageX:u.screenX;aa=u.pageY?u.pageY:u.screenY;ha=q(ga,aa);$=y(E);m.trigger("pointerDown",ha,I(ha,$))}}function R(u){var X=u.target?u.target:u.srcElement;ia=u.pageX?u.pageX:u.screenX;U=u.pageY?u.pageY:u.screenY;if(G&&(L||X&&X===E))n("pointerMove")}function d(u){var X=u.target?u.target:u.srcElement;if(G&&u.button===0){G=false;
if(L||X&&X===E)n("pointerUp")}}function l(u){var X=u.target?u.target:u.srcElement;if(L||X&&X===E){X=u.detail?u.axis===2?-u.detail*v:0:u.wheelDeltaY;if(X!==0){var oa=q(ia,U);m.trigger("zoom",oa,I(oa,$),X/M);if(u.preventDefault){u.preventDefault();u.stopPropagation()}else u.cancelBubble&&u.cancelBubble()}}}function n(u){var X=q(ia,U);m.trigger(u,X,I(X,$),q(ia-ga,U-aa));ga=ia;aa=U}t=COG.extend({inertia:false},t);var v=120,M=v*8,L=false,G=false,ha,$,ia,U,ga,aa;t.binder("mousedown",Q,false);t.binder("mousemove",
R,false);t.binder("mouseup",d,false);t.binder("click",function(u){var X=u.target?u.target:u.srcElement;if(L||X&&X===E){u=q(u.pageX?u.pageX:u.screenX,u.pageY?u.pageY:u.screenY);m.trigger("pointerTap",u,I(u,y(E)))}},false);t.binder("mousewheel",l,window);t.binder("DOMMouseScroll",l,window);return{unbind:function(){t.unbinder("mousedown",Q,false);t.unbinder("mousemove",R,false);t.unbinder("mouseup",d,false);t.unbinder("mousewheel",l,window);t.unbinder("DOMMouseScroll",l,window)}}},checks:{touch:false}});
s("pointer",{handler:function(E,m,t){function Q(F){if(F.count<2)return 0;var N=F.x-F.next.x;F=F.y-F.next.y;return~~Math.sqrt(N*N+F*F)}function R(F,N,P){N=N?N:0;P=P?P:0;for(var na={x:F.x-N,y:F.y-P,id:F.id,count:F.count},la=na;F.next;){F=F.next;la=la.next={x:F.x-N,y:F.y-P,id:F.id}}return na}function d(F,N){var P=F[N?N:"touches"],na,la;if(P.length===0)return null;la=na={x:P[0].pageX,y:P[0].pageY,id:P[0].identifier,count:P.length};for(var pa=1,Ba=P.length;pa<Ba;pa++)la=la.next={x:P[pa].pageX,y:P[pa].pageY,
id:P[pa].identifier};return na}function l(F){var N=F.target?F.target:F.srcElement;if(N&&N===E){U=y(E);N=d(F,"changedTouches");var P=R(N,U.x,U.y);if(!aa){ga=ha;m.trigger("pointerDown",N,P)}sa&&m.trigger("pointerDownMulti",N,P);aa=d(F);if(aa.count>1)X=Q(aa);wa=1;oa=R(aa)}}function n(F){var N=F.target?F.target:F.srcElement;if(N&&N===E){F.preventDefault();u=d(F);if(ga==ha)ga=Math.abs(aa.x-u.x)>L||Math.abs(aa.y-u.y)>L?G:ha;if(ga!=ha){ga=u.count>1?ia:$;if(ga==ia)if(aa.count===1){aa=R(u);X=Q(aa)}else{F=
Q(u);if(Math.abs(X-F)<M)ga=$;else{N=u.x;var P=u.next.x,na=u.y,la=u.next.y,pa=na<la?na:la;N={x:(N<P?N:P)+(Math.abs(N-P)>>1),y:pa+(Math.abs(na-la)>>1)};F=F/X;P=F-wa;m.trigger("zoom",N,I(N,U),P);wa=F}}ga==$&&m.trigger("pointerMove",u,R(u,U.x,U.y),q(u.x-oa.x,u.y-oa.y));sa&&m.trigger("pointerMoveMulti",u,R(u,U.x,U.y))}oa=R(u)}}function v(F){var N=F.target?F.target:F.srcElement;if(N&&N===E){N=d(F,"changedTouches");var P=R(N,U.x,U.y);u=d(F);if(!u){ga===ha&&m.trigger("pointerTap",N,P);m.trigger("pointerUp",
N,P);aa=null}sa&&m.trigger("pointerUpMulti",N,P)}}t=COG.extend({detailed:false,inertia:false},t);var M=20,L=7,G=0,ha=1,$=2,ia=3,U,ga,aa,u,X,oa,sa=t.detailed,wa=1;t.binder("touchstart",l,false);t.binder("touchmove",n,false);t.binder("touchend",v,false);COG.info("initialized touch handler");return{unbind:function(){t.unbinder("touchstart",l,false);t.unbinder("touchmove",n,false);t.unbinder("touchend",v,false)}}},checks:{touch:true}});return{register:s,watch:function(E,m,t){m=COG.extend({bindToBody:false,
observable:null,isIE:false,types:null},m);capabilities=COG.extend({touch:"ontouchstart"in window},t);if(!m.observable){COG.info("creating observable");m.observable=COG.observable({});globalOpts=m}m.binder=m.isIE?B:V(m.bindToBody);m.unbinder=m.isIE?A:ca(m.bindToBody);t=m.types;for(var Q=capabilities,R=[],d=da.length;d--;){var l=da[d],n=!t||t.indexOf(l.type)>=0,v=true;for(var M in l.checks){var L=l.checks[M];COG.info("checking "+M+" capability. require: "+L+", capability = "+Q[M]);v=v&&L===Q[M]}if(n&&
v)R[R.length]=l.handler}return new W(E,R,m)}}}();
T5=function(){function V(){return(new Date).getTime()}function ca(){for(;X.length>0;){var b=X.shift();document.location=b}u=0}function B(b){for(var j=true,e=oa.length;e--;)j=j&&b!=oa[e];return j}function A(b,j){var e=[];for(var a in j)a&&e.push(a+"="+escape(j[a]));return"tile5://"+b+"/"+(e.length>0?"?"+e.join("&"):"")}function q(b,j){B(b)&&COG.info("would push url: "+A(b,j))}function s(b,j){if(B(b)){X.push(A(b,j));u||(u=setTimeout(ca,100))}}function y(b){return function(j,e,a){(a?a:b?document.body:
document).addEventListener(j,e,false)}}function I(b){return function(j,e,a){(a?a:b?document.body:document).removeEventListener(j,e,false)}}function da(b,j,e){(e?e:document).attachEvent("on"+b,j)}function W(b,j,e){(e?e:document).detachEvent("on"+b,j)}function E(){U={base:{name:"Unknown",bindEvent:y(),unbindEvent:I(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:q,targetFps:null},ie:{name:"MSIE",regex:/msie/i,
bindEvent:da,unbindEvent:W,requireFastDraw:false,targetFps:25},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:s,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:s},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:s},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:y(true),unbindEvent:I(true),supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},
bridgeNotify:s},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:s}};ga=[U.froyo,U.android,U.ipod,U.iphone,U.ipad,U.ie]}function m(){U||E();if(!aa){COG.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var b=0;b<ga.length;b++){var j=ga[b];if(j.regex&&j.regex.test(navigator.userAgent)){aa=COG.extend({},U.base,j);COG.info("PLATFORM DETECTED AS: "+aa.name);break}}if(!aa){COG.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
aa=U.base}COG.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return aa}function t(){for(var b=0,j=arguments.length;j--;){var e=N[arguments[j].toUpperCase()];if(e)b|=e}return b}var Q=Math.abs,R=Math.min,d=Math.max,l=Math.pow,n=Math.sqrt,v=Math.sin,M=Math.asin,L=Math.cos,G=function(){function b(a,c){return e(a.x-c.x,a.y-c.y)}function j(a,c){if(!c)c=a.length;if(c<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var f={edges:Array(c-1),accrued:Array(c-
1),total:0},g=0;g<c-1;g++){var h=b(a[g],a[g+1]);f.edges[g]=n(h.x*h.x+h.y*h.y);f.accrued[g]=f.total+f.edges[g];f.total+=f.edges[g]}return f}function e(a,c){return{x:a?a:0,y:c?c:0}}return{VECTOR_SIMPLIFICATION:3,SIMPLIFICATION_MIN_VECTORS:25,add:function(){for(var a=0,c=0,f=arguments.length;f--;){a+=arguments[f].x;c+=arguments[f].y}return e(a,c)},absSize:function(a){return d(Q(a.x),Q(a.y))},copy:function(a){return a?e(a.x,a.y):null},diff:b,distance:function(a,c){return j(a,c).total},edges:j,equals:function(a,
c){return a.x===c.x&&a.y===c.y},extendBy:function(a,c,f){var g=L(c)*f;c=v(c)*f;return e(a.x-g,a.y-c)},floor:function(a){for(var c=Array(a.length),f=a.length;f--;)c[f]=e(~~a[f].x,~~a[f].y);return c},getRect:function(a){for(var c,f,g,h,o=a.length;o--;){var i=a[o];c=typeof c==="undefined"||i.x<c?i.x:c;f=typeof f==="undefined"||i.y<f?i.y:f;g=typeof g==="undefined"||i.x>g?i.x:g;h=typeof h==="undefined"||i.y>h?i.y:h}return $.init(c,f,g,h)},init:e,invert:function(a){return e(-a.x,-a.y)},min:function(a,c){return e(a.x<
c.x?a.x:c.x,a.y<c.y?a.y:c.y)},max:function(a,c){return e(a.x>c.x?a.x:c.x,a.y>c.y?a.y:c.y)},offset:function(a,c,f){return e(a.x+c,a.y+(f?f:c))},simplify:function(a,c){if(!a)return null;c=c?c:G.VECTOR_SIMPLIFICATION;for(var f=[],g=null,h=a.length;h--;){var o=a[h];if(include=!g||h===0||Q(o.x-g.x)+Q(o.y-g.y)>c){f.unshift(o);g=o}}return f},theta:function(a,c,f){f=M((a.y-c.y)/f);return a.x>c.x?f:Math.PI-f}}}(),ha=function(){return{dotProduct:function(b,j){return b.x*j.x+b.y*j.y}}}(),$=function(){function b(e){return j(e.x1,
e.y1,e.x2,e.y2)}function j(e,a,c,f){e=e?e:0;a=a?a:0;c=typeof c!=="undefined"?c:e;f=typeof f!=="undefined "?f:f;return{x1:e,y1:a,x2:c,y2:f,width:c-e,height:f-a}}return{center:function(e){return G.init(e.x1+e.width/2,e.y1+e.height/2)},copy:b,diagonalSize:function(e){return n(e.width*e.width+e.height*e.height)},fromCenter:function(e,a,c,f){c=c>>1;f=f>>1;return j(e-c,a-f,e+c,a+f)},init:j,intersect:function(e,a){var c=d(e.x1,a.x1),f=d(e.y1,a.y1),g=R(e.x2,a.x2),h=R(e.y2,a.y2);c=j(c,f,g,h);return c.width>
0&&c.height>0?c:null},union:function(e,a){if(e.width===0||e.height===0)return b(a);else if(a.width===0||a.height===0)return b(e);else{var c=R(e.x1,a.x1),f=R(e.y1,a.y1),g=d(e.x2,a.x2),h=d(e.y2,a.y2);c=j(c,f,g,h);return c.width>0&&c.height>0?c:null}}}}(),ia=function(){return{getAspectRatio:function(b){return b.height!==0?b.width/b.height:1},getCenter:function(b){return G.init(b.width>>1,b.height>>1)},getSize:function(b){return n(l(b.width,2)+l(b.height,2))},init:function(b,j){b=b?b:0;return{width:b,
height:j?j:b}}}}(),U=null,ga=[],aa=null,u=0,X=[],oa=["view.wake","tile.loaded"],sa=function(){function b(){if(!J){var w=m().maxImageLoads;J=COG.Loopage.join({execute:function(C,H){if(!w||k.length<w){var z=i.shift();if(z){k[k.length]=z;z.image.onload=e;z.image.src=z.url;z.requested=T5.ticks()}else H.trigger("complete")}},frequency:10});J.bind("complete",function(){J=null})}}function j(){K=true;try{var w=r.length>>1;if(w>0){r.sort(function(H,z){return H.created-z.created});for(var C=w;C--;)delete f[r[C].url];
r.splice(0,w)}}finally{K=false}S.trigger("cacheCleared")}function e(){var w=h[this.id],C;if(w&&w.image.complete&&w.image.width>0){w.loaded=true;w.hitCount=1;for(C=k.length;C--;)if(k[C].image.src==this.src){k.splice(C,1);break}if(w.background||w.postProcess||w.drawBackground||w.customDraw)if(w.image){globalImageData=w;C=c(w.realSize?w.realSize.width:w.image.width,w.realSize?w.realSize.height:w.image.height);var H=C.getContext("2d"),z=w.offset?w.offset:T5.XY.init();w.background&&H.drawImage(w.background,
0,0);w.drawBackground&&w.drawBackground(H);w.customDraw?w.customDraw(H,w):H.drawImage(w.image,z.x,z.y);w.postProcess&&w.postProcess(H,w);w.image=C}for(C=w.callbacks.length;C--;)w.callbacks[C]&&w.callbacks[C](this,false);w.callbacks=[];r[r.length]={url:this.src,created:w.requested};delete h[this.id];b()}}function a(w,C,H){var z=f[w];if(z){z.hitCount++;z.image.complete&&z.image.width>0&&C?C(z.image,true):z.callbacks.push(C)}else{z=COG.extend({url:w,image:new Image,loaded:false,created:T5.ticks(),requested:null,
hitCount:0,callbacks:[C]},H);z.image.id="resourceLoaderImage"+o++;f[w]=z;h[z.image.id]=z;i[i.length]=z;b()}return z}function c(w,C){var H=document.createElement("canvas");H.width=w?w:0;H.height=C?C:0;if(typeof FlashCanvas!=="undefined"){H.id="tmpCanvas"+g++;H.style.cssText="position: absolute; top: -"+(C-1)+"px; left: -"+(w-1)+"px;";document.body.appendChild(H);FlashCanvas.initElement(H)}typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(H);return H}var f={},g=0,h={},o=0,i=[],
k=[],r=[],D=0,J=null,K=false,S={avgImageSize:25,loadTimeout:10,cancelLoad:function(){k=[]},get:function(w,C,H){var z=null,T=null;K||(z=f[w]);if((T=z?z.image:null)&&(T.getContext||T.complete&&T.width>0))return T;else C&&a(w,C,H);return null},load:a,newCanvas:c,reset:function(){f={}},stats:function(){return{imageLoadingCount:k.length,queuedImageCount:i.length,imageCacheFullness:D}}};COG.observable(S);COG.Loopage.join({execute:function(w){for(var C=false,H=0,z=m();H<k.length;)if(w-k[H].requested>S.loadTimeout*
1E3){k.splice(H,1);C=true}else H++;C&&b();if(z&&z.imageCacheMaxSize){D=r.length*S.avgImageSize/z.imageCacheMaxSize;D>=1&&j()}},frequency:2E4});return S}(),wa=function(){var b={};return{init:function(j,e){var a=b[j];if(!a)throw Error("Unable to locate requested generator: "+j);return new a(e)},register:function(j,e){b[j]=e},Template:function(){}}}(),F=function(){function b(g,h){c[g]=e(h);return g}function j(g){for(var h in g)b(h,g[h])}function e(g){function h(r){var D=g[r];typeof D!=="undefined"&&
i.push(function(J){J[r]=D})}function o(){i=[];for(var r in g)h(r)}g=COG.extend({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},g);var i=[],k={applyToContext:function(r){for(var D=i.length;D--;)i[D](r)},update:function(r,D){g[r]=D;o()}};o();return k}var a={},c={},f={apply:function(g,h){var o=c[h]?c[h]:c.basic,i;if(g&&g.canvas){i=a[g.canvas.id];a[g.canvas.id]=h}o.applyToContext(g);
return i},define:b,defineMany:j,get:function(g){return c[g]},init:e,load:function(g){COG.jsonp(g,function(h){j(h)})}};j({basic:{lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"},waypoints:{lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"}});return f}(),N={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,ZOOM:16,FREEZE:128},P=function(b){b=COG.extend({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:t("ACTIVE","ANIMATING","PAN","ZOOM"),style:null,minXY:null,maxXY:null},b);var j=null,
e=false,a=false,c=b.supportFastDraw,f=b.id,g=t("ACTIVE"),h=b.validStates,o=0,i=0,k=COG.extend({addToView:function(r){r.setLayer(f,k)},shouldDraw:function(r,D,J){return(a||J||o!==D.x1||i!==D.y1)&&(r&h)!==0&&(e?c:true)},clip:null,cycle:function(){},draw:function(){},remove:function(){k.trigger("remove",k)},changed:function(r){a=true;k.trigger("changed",k);j&&j.trigger("invalidate",r)},getId:function(){return f},setId:function(r){f=r},getParent:function(){return j},setParent:function(r){e=(j=r)?j.fastDraw&&
displayState!==g:false;k.trigger("parentChange",j)}},b);COG.observable(k);k.bind("drawComplete",function(r,D){a=false;o=D.x1;i=D.y1});k.bind("resync",function(r,D){if(D.syncXY){k.minXY&&D.syncXY(k.minXY);k.maxXY&&D.syncXY(k.maxXY)}});return k},na=function(b){function j(o,i,k,r){a=o;c=i;f=k;g=r}b=COG.extend({xy:G.init(),offset:true,tweenIn:null,animationSpeed:null,isNew:true},b);var e=false,a=0,c=0,f=0,g=0,h=COG.extend(b,{isAnimating:function(){return e},draw:function(o,i,k,r,D){if(h.isNew&&b.tweenIn){var J=
h.xy.y;h.xy.y=i.y1-20;e=true;COG.tween(h.xy,"y",J,b.tweenIn,function(){h.xy.y=J>>0;e=false},b.animationSpeed?b.animationSpeed:250+Math.random()*500)}h.drawMarker(o,i,h.xy.x,h.xy.y,k,r,D);h.isNew=false},drawMarker:function(o,i,k,r){o.beginPath();o.arc(k,r,4,0,Math.PI*2,false);o.fill();j(k-4,r-4,8,8)},hitTest:function(o,i){return o>=a&&o<=a+f&&i>=c&&i<=c+g},updateBounds:j});COG.observable(h);return h},la=function(b){function j(){c.changed();c.trigger("markerUpdate",a)}function e(){var f=c.getParent();
if(f&&f.syncXY)for(var g=a.length;g--;)f.syncXY([a[g].xy])}b=COG.extend({zindex:100,style:"basic"},b);var a=[],c=COG.extend(new P(b),{draw:function(f,g,h,o){for(var i=a.length;i--;)a[i].draw(f,g,h,c,o)},add:function(f){if(f&&typeof f.length!=="undefined")for(var g=f.length;g--;){if(f[g])a[a.length]=f[g]}else if(f)a[a.length]=f;j()},clear:function(f){if(f)for(var g=0;g<a.length;g++)f(a[g])&&a.splice(g,1);else a=[];j()},each:function(f){if(f)for(var g=a.length;g--;)f(a[g])},find:function(f){for(var g=
[],h=a.length;h--;)if(!f||f(a[h]))g[g.length]=a[h];return g}});c.bind("tap",function(f,g,h,o){var i=[],k=o.x;o=o.y;for(var r=a.length;r--;)if(a[r].hitTest(k,o))i[i.length]=a[r];if(i.length>0)f.cancel=c.trigger("markerTap",g,h,i).cancel});c.bind("parentChange",e);c.bind("resync",e);c.bind("changed",e);return c},pa=function(b){function j(h,o,i){h.fillStyle="#FFFFFF";h.strokeStyle="#222222";h.beginPath();h.arc(i.x,i.y,4,0,Math.PI*2,false);h.stroke();h.fill()}b=COG.extend({path:[],id:COG.objId("pathAni"),
easing:COG.easing("sine.inout"),validStates:t("ACTIVE","PAN","ZOOM"),drawIndicator:null,duration:2E3},b);var e=G.edges(b.path),a,c=null,f=0;COG.tweenValue(0,e.total,b.easing,function(){g.remove()},b.duration).requestUpdates(function(h,o){f=h;o&&g.remove()});var g=COG.extend(new P(b),{cycle:function(){for(var h=0;h<e.accrued.length&&e.accrued[h]<f;)h++;c=null;if(h<b.path.length-1){var o=f-(h>0?e.accrued[h-1]:0),i=b.path[h];a=G.theta(i,b.path[h+1],e.edges[h]);c=G.extendBy(i,a,o)}return c},draw:function(h,
o){if(c)(b.drawIndicator?b.drawIndicator:j)(h,o,G.init(c.x,c.y),a)}});return g},Ba=function(b){b=COG.extend({style:null,properties:{}},b);return COG.extend(b,{rect:null,draw:function(){},resync:function(){}})},Za=function(){return{tileSize:256,init:function(b,j,e,a,c){return COG.extend({x:b,y:j,width:e,height:a},c)}}}(),Ea={ex:COG.extend,ticks:V,getConfig:m,userMessage:function(b,j,e){Ea.trigger("userMessage",b,j,e)},XY:G,XYRect:$,Dimensions:ia,Vector:ha,D:ia,Images:sa,Generator:wa,tween:COG.tween,
tweenValue:COG.tweenValue,easing:COG.easing,Tween:COG.Tween,Style:F,viewState:t,View:function(b){function j(p,x,O,Y){qa=Ca;K();if(Y&&b.inertia)h(ja-x,ma-O,b.panAnimationEasing,b.panAnimationDuration);else Y||h(ja-x,ma-O);clearTimeout(Ua);Ua=setTimeout(e,100)}function e(){qa=Fa;ta=false;K()}function a(p,x,O,Y){ba.zoom(O,Y)}function c(p){r();var x=G.init(Ga-(za.width/(ea*2)>>0),Ha-(za.height/(ea*2)>>0)),O=Math.log(ea)/Math.LN2>>0;if(ea!==1)qa=Ia;if(O!==0){ea=Math.pow(2,O);if(!ba.trigger("scale",ea,
x).cancel){for(p=C.length;p--;)C[p].trigger("scale",ea,x);ea=1;$a=null;qa=Fa;p=true}}K(p)}function f(p){Ja=G.init(ja,ma);Ka=G.offset(p,ja,ma)}function g(){clearTimeout(Va);Va=setTimeout(o,50)}function h(p,x,O,Y,Z){function fa(){ka+=1;if(ka>=2){e();Z&&Z()}}var ka=0,ua=xa?G.offset(xa,-La,-Ma):null,va=ya?G.offset(ya,-La,-Ma):null;if(ua){p=p<ua.x?ua.x:p;x=x<ua.y?ua.y:x}if(va){p=p>va.x?va.x:p;x=x>va.y?va.y:x}if(O){if(!ta){p=COG.tweenValue(ja,p,O,fa,Y);x=COG.tweenValue(ma,x,O,fa,Y);p.cancelOnInteract=true;
p.requestUpdates(function(Na){ja=Na>>0;ta=true;K()});x.cancelOnInteract=true;x.requestUpdates(function(Na){ma=Na>>0;ta=true;K()})}}else{ja=p>>0;ma=x>>0}}function o(){var p;if(z){Oa&&Oa.unbind();if(b.autoSize&&z.parentNode){p=z.parentNode.getBoundingClientRect();if(p.height!==0&&p.width!==0){z.height=p.height;z.width=p.width}}try{if(!z.id)z.id=b.id+"_canvas";T=z.getContext("2d")}catch(x){COG.exception(x);throw Error("Could not initialise canvas on specified view element");}if(ra.height!==z.height||
ra.width!==z.width){ra=ia.init(z.width,z.height);La=ra.width>>1;Ma=ra.height>>1;ba.trigger("resize",z.width,z.height);for(p=H;p--;)C[p].trigger("resize",z.width,z.height)}if(b.interactive)Oa=INTERACT.watch(z,{observable:ba}).pannable();for(p=H;p--;)C[p].trigger("contextChanged",T);K()}}function i(p,x){x.setId(p);x.added=V();x.bind("remove",function(){ba.removeLayer(p)});x.trigger("contextChanged",T);x.setParent(ba);C.push(x);C.sort(function(O,Y){var Z=Y.zindex-O.zindex;if(Z===0)Z=Y.added-O.added;
return Z});H=C.length;return x}function k(){w("idle",ba);Pa=true;Aa=0}function r(p){var x=1/ea;Ga=Ka.x+(ja-Ja.x);Ha=Ka.y+(ma-Ja.y);if(p)return $.fromCenter(Ga>>0,Ha>>0,p.width*x>>0,p.height*x>>0)}function D(p,x,O,Y){var Z=$.copy(x),fa,ka=0;O&&T.clearRect(0,0,z.width,z.height);T.save();try{T.globalCompositeOperation="source-over";if(ea!==1){Z=r(Z);T.scale(ea,ea)}T.translate(-Z.x1,-Z.y1);ya=xa=null;T.beginPath();Qa=false;for(ka=H;ka--;)if(C[ka].clip){C[ka].clip(T,Z,p,ba,O,Y);Qa=true}T.closePath();Qa&&
T.clip();for(ka=H;ka--;){fa=C[ka];var ua=fa.style,va=ua?F.apply(T,ua):null;if(fa.minXY)xa=xa?G.min(xa,fa.minXY):G.copy(fa.minXY);if(fa.maxXY)ya=ya?G.max(ya,fa.maxXY):G.copy(fa.maxXY);fa.draw(T,Z,p,ba,O,Y);va&&F.apply(T,va)}}finally{T.restore()}if(ab){T.globalCompositeOperation="source-over";T.strokeStyle="#f00";T.beginPath();T.moveTo(z.width>>1,0);T.lineTo(z.width>>1,z.height);T.moveTo(0,z.height>>1);T.lineTo(z.width,z.height>>1);T.stroke()}w("drawComplete",x,Y);COG.trace("draw complete",Y)}function J(p,
x){var O=false,Y=Ra?Ra:ta?Ca:qa,Z=!ta&&(Y===Ia||Y===Ca),fa=Sa||Y===Ca||Y===Ia||COG.getTweens().length>0;za=S();if(Z){COG.endTweens(function(ka){return ka.cancelOnInteract});Pa=false;if(Aa!==0){clearTimeout(Aa);Aa=0}}for(Z=H;Z--;){if(C[Z].animated)qa|=Wa;C[Z].cycle(p,za,qa,fa);O=C[Z].shouldDraw(qa,za,fa)||O}fa=fa||(qa&Wa)!==0;if(O=O||fa||ea!==1&&ea!==Xa){D(Y,za,fa,p);Xa=ea;Sa=false}if(!O&&Ta===0&&!bb){if(!Pa&&Aa===0)Aa=setTimeout(k,500);x.trigger("complete")}Ta=0;COG.trace("Completed draw cycle",p)}
function K(p){Sa=p?true:false;Ta+=1;if(!Da){Da=COG.Loopage.join({execute:J,frequency:cb});Da.bind("complete",function(){Da=null})}}function S(){return $.init(ja,ma,ja+ra.width,ma+ra.height)}function w(){for(var p=ba.trigger.apply(null,arguments).cancel,x=C.length;x--;)p=C[x].trigger.apply(null,arguments).cancel||p;return!p}b=COG.extend({id:COG.objId("view"),container:"",fastDraw:false,inertia:true,pannable:true,scalable:true,interactive:true,panAnimationEasing:COG.easing("sine.out"),panAnimationDuration:750,
pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:true,tapExtent:10,mask:true,guides:false,fps:25},b);var C=[],H=0,z=document.getElementById(b.container),T=null,ja=0,ma=0,Qa=false,za=null,Da=null,ab=b.guides,Ya=1,ra=ia.init(),Ta=0,La=0,Ma=0,Ja=null,Ka=null,Pa=false,ta=false,Aa=0,Ua=0,xa=null,ya=null,db=0,Ra=null,Sa=false,Va=0,$a=null,ea=1,Xa=0,Oa=null,bb=typeof FlashCanvas!=="undefined",cb=~~(1E3/b.fps),Ga,Ha,Fa=t("ACTIVE"),Ca=t("PAN"),Ia=t("ZOOM"),Wa=t("ANIMATING"),qa=Fa,ba={id:b.id,deviceScaling:Ya,
fastDraw:b.fastDraw||m().requireFastDraw,getDimensions:function(){return ra},getLayer:function(p){for(var x=0;x<H;x++)if(C[x].getId()==p)return C[x];return null},setLayer:function(p,x){for(var O=0;O<H;O++)if(C[O].getId()===p){C.splice(O,1);break}x&&i(p,x);K();return x},eachLayer:function(p){for(var x=H;x--;)p(C[x])},invalidate:K,resize:function(p,x){if(z){b.autoSize=false;z.width=p;z.height=x;o();ba.trigger("resize",z.width,z.height)}},scale:function(p,x,O,Y){function Z(){ea=Math.pow(2,Math.round(Math.log(ea)/
Math.LN2));Y&&Y();c(true)}var fa=ea;x||(x=ia.getCenter(ra));f(x);if(O)COG.tweenValue(0,p-fa,O,Z,1E3).requestUpdates(function(ka){ea=fa+ka;c()});else{ea=p;Z()}return ba},triggerAll:w,removeLayer:function(p){a:{for(var x=H;x--;)if(C[x].getId()==p){p=x;break a}p=-1}if(p>=0&&p<H){ba.trigger("layerRemoved",C[p]);C.splice(p,1);K()}H=C.length},stateOverride:function(p){Ra=p},getOffset:function(){return G.init(ja,ma)},getViewRect:S,updateOffset:h,pan:function(p,x,O,Y,Z){h(ja+p,ma+x,O,Y,Z)},zoom:function(p,
x){f(p);ta=false;ea=Math.max(ea+Math.pow(2,x)-1,0.25);c()}};Ya=m().getScaling();ba.markers=i("markers",new la);COG.observable(ba);ba.bind("invalidate",function(p,x){K(x)});if(b.pannable){ba.bind("pan",j);ba.bind("inertiaCancel",function(){ta=false;K()})}b.scalable&&ba.bind("zoom",a);ba.bind("pointerTap",function(p,x,O){w("tap",x,O,G.offset(O,ja,ma))});ba.bind("resync",function(){ya=xa=null});COG.configurable(ba,["inertia","container","rotation","tapExtent","scalable","pannable"],COG.paramTweaker(b,
null,{container:function(p,x){z=document.getElementById(x);o()},rotation:function(p,x){db=x}}),true);o();b.autoSize&&window.addEventListener("resize",g,false);return ba},ViewLayer:P,ImageLayer:function(b,j){function e(i,k,r){for(k=f.length;k--;){var D=f[k],J=D.x,K=D.y,S=$.init(D.x,D.y,D.x+D.width,D.y+D.height);if(r&&$.intersect(i,S)){S=sa.get(D.url,function(){o.changed()},h);r(S,J,K,D.width,D.height)}}}function a(i){c&&c.run(i,function(k){f=[].concat(k);o.changed()})}j=COG.extend({imageLoadArgs:{}},
j);var c=b?wa.init(b,j):null,f=[],g=$.init(),h=j.imageLoadArgs,o=COG.extend(new P(j),{changeGenerator:function(i,k){c=wa.init(i,COG.extend({},j,k));c.bindToView(o.getParent());f=null;a(g)},clip:function(i,k,r){e(k,r,function(D,J,K,S,w){D&&i.rect(J,K,S,w)})},cycle:function(i,k){a(k)},draw:function(i,k,r){e(k,r,function(D,J,K,S,w){o.drawImage(i,D,J,K,S,w,k,r)});g=$.copy(k)},drawImage:function(i,k,r,D){k&&i.drawImage(k,r,D,k.width,k.height)}});o.bind("idle",function(){a(g)});o.bind("parentChange",function(i,
k){c&&c.bindToView(k)});o.bind("tap",function(i,k,r,D){i=[];var J=D.x,K=D.y,S,w;if(f)for(var C=f.length;C--;){S=f[C];if(w=J>=S.x&&J<=S.x+S.width&&K>=S.y&&K<=S.y+S.height)i[i.length]=S}i.length>0&&o.trigger("tapImage",i,k,r,D)});return o},Marker:na,ImageMarker:function(b){b=COG.extend({image:null,imageUrl:null,animatingImage:null,animatingImageUrl:null,imageAnchor:null,rotation:0,scale:1,opacity:1},b);var j=b.imageAnchor?T5.XY.invert(b.imageAnchor):null,e=COG.extend(new na(b),{drawMarker:function(a,
c,f,g){if((c=e.isAnimating()&&e.animatingImage?e.animatingImage:e.image)&&c.width>0){j||(j=G.init(-c.width>>1,-c.height>>1));var h=e.scale,o=f+~~(j.x*h),i=g+~~(j.y*h),k=~~(c.width*h),r=~~(c.height*h);e.updateBounds(o,i,k,k);if(e.rotation||e.opacity!==1){a.save();try{a.globalAlpha=e.opacity;a.translate(f,g);a.rotate(e.rotation);a.drawImage(c,j.x*h,j.y*h,k,r)}finally{a.restore()}}else a.drawImage(c,o,i,k,r)}}});if(!e.image)e.image=sa.get(b.imageUrl,function(a){e.image=a});if(!e.animatingImage)e.animatingImage=
sa.get(b.animatingImageUrl,function(a){e.animatingImage=a});return e},MarkerLayer:la,PathLayer:function(b){b=COG.extend({style:"waypoints",pixelGeneralization:8,zindex:50},b);var j=false,e=[],a=null,c=[],f=null,g=0,h=[],o=COG.extend(new P(b),{getAnimation:function(i,k,r,D){var J="pathAnimation"+g++;h.push(J);return new pa({id:J,path:e,zindex:b.zindex+1,easing:i?i:COG.easing("sine.inout"),duration:k?k:5E3,drawIndicator:r,autoCenter:D?D:false})},cycle:function(i,k,r,D){return D},draw:function(i){var k,
r=e.length;i.save();try{F.apply(i,b.style);if(r>0){i.beginPath();i.moveTo(e[r-1].x,e[r-1].y);for(k=r;k--;)i.lineTo(e[k].x,e[k].y);i.stroke();if(a){i.fillStyle=b.waypointFillStyle;for(k=a.length;k--;){i.beginPath();i.arc(a[k].x,a[k].y,2,0,Math.PI*2,false);i.stroke();i.fill()}}}}finally{i.restore()}j=false},updateCoordinates:function(i,k){c=i;f=k;var r=o.getParent();if(r&&r.syncXY){r.syncXY(c);f&&r.syncXY(f);o.trigger("tidy")}}});o.bind("tidy",function(){e=G.simplify(c,b.pixelGeneralization);a=G.simplify(f,
b.pixelGeneralization);j=true;o.changed()});return o},AnimatedPathLayer:pa,Shape:Ba,Arc:function(b,j){j=COG.extend({size:4},j);var e=G.init(),a=COG.extend(j,{draw:function(c){c.beginPath();c.arc(e.x,e.y,a.size,0,Math.PI*2,false);c.fill();c.stroke()},resync:function(c){c.syncXY([b]);e=G.floor([b])[0]}});COG.info("created arc = ",b);return a},Poly:function(b,j){j=COG.extend({fill:false,simplify:false},j);var e=false,a=j.fill,c=j.simplify,f=t("ZOOM"),g=[],h=COG.extend(new Ba(j),{draw:function(o,i,k,
r,D,J){if(e){i=true;k=(J&f)!==0;o.beginPath();for(J=g.length;J--;){k=g[J].x;r=g[J].y;if(i){o.moveTo(k,r);i=false}else o.lineTo(k,r);k=true}if(k){a&&o.fill();o.stroke()}}},resync:function(o){h.xy=o.syncXY(b);g=G.floor(c?G.simplify(b):b)}});e=b&&b.length>=2;return h},ShapeLayer:function(b){function j(f){for(var g=a.length;g--;)a[g].resync(f);a.sort(function(h,o){var i=o.xy.y-h.xy.y;if(i===0)i=o.xy.x-h.xy.y;return i});c.changed()}function e(f,g){g.syncXY&&j(g)}b=COG.extend({zindex:80},b);var a=[],c=
COG.extend(new P(b),{add:function(f){a[a.length]=f},each:function(f){for(var g=a.length;g--;)f(a[g])},draw:function(f,g,h){var o=g.x1,i=g.y1,k=g.width;g=g.height;for(var r=a.length;r--;){var D=a[r].style;D=D?F.apply(f,D):null;a[r].draw(f,o,i,k,g,h);D&&F.apply(f,D)}}});c.bind("parentChange",e);c.bind("resync",e);return c},Tiling:Za,TileGenerator:function(b){function j(K,S,w,C){function H(){if(J.initTileCreator){h=true;J.initTileCreator(K,S,w,C)}}J.prepTileCreator?J.prepTileCreator(K,S,w,H):H()}function e(K,
S){for(var w=~~((K.x1-f.x)/o),C=~~((K.y1-f.y)/i),H=[],z=-g;z<r;z++)for(var T=-g;T<D;T++){var ja=k(w+z,C+T);if(ja)H[H.length]=ja}S&&S(H);c=$.copy(K)}b=COG.extend({tileWidth:256,tileHeight:256,relative:false,padding:2},b);var a=null,c=null,f=G.init(),g=b.padding,h=false,o=b.tileWidth,i=b.tileHeight,k=null,r=0,D=0,J={bindToView:function(K){COG.info("initializing generator");a=K;J.trigger("bindView",K)},getTileCreatorArgs:null,initTileCreator:null,prepTileCreator:null,requireRefresh:function(){return false},
reset:function(){k=null;h=false;c=null},run:function(K,S){if(!c||Math.abs(K.x1-c.x1)>o||Math.abs(K.y1-c.y1)>i){if(!k&&!h||J.requireRefresh()){f=b.relative?G.init(K.x1,K.y1):G.init();r=Math.ceil(K.width/o)+g;D=Math.ceil(K.height/i)+g;j(o,i,J.getTileCreatorArgs?J.getTileCreatorArgs(a):{},function(w){k=w;h=false;e(K,S)})}k&&e(K,S)}}};COG.observable(J);J.bind("update",function(){COG.info("captured generator update");c=null});return J}};COG.observable(Ea);return Ea}();
