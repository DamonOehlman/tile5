COG=typeof COG!=="undefined"?COG:{};COG.extend=function(){for(var I=arguments[0]||{},S,B=1,x=arguments.length;B<x;B++)if((S=arguments[B])!==null)for(var j in S){var i=S[j];if(I!==i)if(i!==undefined)I[j]=i}return I};
(function(){var I=Object.prototype.hasOwnProperty,S=0,B={};B.toID=function(x){return x.replace(/\s/g,"-")};B.objId=function(x){return(x?x:"obj")+S++};B.isFunction=function(x){return toString.call(x)==="[object Function]"};B.isArray=function(x){return toString.call(x)==="[object Array]"};B.isPlainObject=function(x){if(!x||toString.call(x)!=="[object Object]"||x.nodeType||x.setInterval)return false;if(x.constructor&&!I.call(x,"constructor")&&!I.call(x.constructor.prototype,"isPrototypeOf"))return false;
var j;for(j in x);return j===undefined||I.call(x,j)};B.isEmptyObject=function(x){for(var j in x)return false;return true};B.isXmlDocument=function(x){return toString.call(x)==="[object Document]"};B.contains=function(x,j){var i=x,t=arguments,r=1;if(j&&module.isArray(j)){t=j;r=0}for(r=r;r<t;r++)i=i&&typeof foo[t[r]]!=="undefined";return i};B.formatStr=function(x){if(arguments.length<=1)return x;for(var j=arguments.length-2,i=0;i<=j;i++)x=x.replace(RegExp("\\{"+i+"\\}","gi"),arguments[i+1]);return x};
B.wordExists=function(x,j){var i="";if(j.toString)j=j.toString();for(var t=0;t<j.length;t++)i+=!/\w/.test(j[t])?"\\"+j[t]:j[t];return RegExp("(^|\\s|\\,)"+i+"(\\,|\\s|$)","i").test(x)};COG.extend(COG,B)})();
(function(){function I(i){return typeof console!=="undefined"?function(){console[i](Array.prototype.slice.call(arguments,0).join(" "));return true}:function(){return false}}var S=window.console&&window.console.markTimeline,B=I("error"),x=I("info"),j=function(){return S?function(i,t){console.markTimeline(i+(t?": "+((new Date).getTime()-t)+"ms":""))}:function(){}}();COG.extend(COG,{trace:j,debug:I("debug"),info:x,warn:I("warn"),error:B,exception:function(i){if(B)for(var t in i)x("ERROR DETAIL: "+t+
": "+i[t])}})})();var FNS_TIME=["webkitAnimationTime","mozAnimationTime","animationTime","webkitAnimationStartTime","mozAnimationStartTime","animationStartTime"],FNS_FRAME=["webkitRequestAnimationFrame","mozRequestAnimationFrame","requestAnimationFrame"],animTime=function(){return(new Date).getTime()},animFrame=function(I){setTimeout(function(){I(animTime())},1E3/60)};FNS_TIME.forEach(function(I){if(I in window)animTime=function(){return window[I]}});
FNS_FRAME.forEach(function(I){if(I in window)animFrame=function(S){window[I](S)}});COG.animTime=animTime;COG.animFrame=animFrame;
COG.Loopage=function(){function I(r){return COG.extend({id:j++,frequency:0,after:0,single:false,lastTick:0,execute:function(){}},r)}function S(r){t.push(r);x||(x=animFrame(B));recalcSleepFrequency=true}function B(){for(var r,N=animTime(),Q=i.length;t.length>0;){var ba=t.shift();for(r=Q;r--;)if(i[r].id===ba){i.splice(r,1);break}Q=i.length}for(r=Q;r--;){ba=N-i[r].lastTick;if(i[r].lastTick===0||ba>=i[r].frequency){i[r].execute(N,i[r]);i[r].lastTick=N;i[r].single&&i[r].trigger("complete")}}x=Q?animFrame(B):
0}var x=0,j=0,i=[],t=[];return{join:function(r){var N=new I(r);if(N.after>0)N.lastTick=(new Date).getTime()+N.after;COG.observable(N);N.bind("complete",function(){S(N.id)});i.unshift(N);x||(x=animFrame(B));recalcSleepFrequency=true;return N},leave:S}}();
(function(){function I(B,x){var j=B.obsHandlers;j[x]||(j[x]=[]);return j[x]}var S=0;COG.observable=function(B){if(!B)return null;if(!B.obsHandlers)B.obsHandlers={};if(!(B.bind||B.trigger||B.unbind)){B.bind=function(x,j){var i="callback"+S++;I(B,x).unshift({fn:j,id:i});return i};B.trigger=function(x){var j=I(B,x),i={cancel:false,name:x},t;if(!j)return null;t=Array.prototype.slice.call(arguments,1);B.eventInterceptor&&B.eventInterceptor(x,i,t);t.unshift(i);for(var r=j.length;r--&&!i.cancel;)j[r].fn.apply(self,
t);return i};B.unbind=function(x,j){if(typeof x==="undefined")B.obsHandlers={};else for(var i=I(B,x),t=0;i&&t<i.length;t++)if(i[t].id===j){i.splice(t,1);break}return B}}return B}})();
(function(){function I(j,i){j[i]||(j[i]=function(t){return j.configure(i,t)})}function S(j){j.gtConfId="configurable"+x++;j.gtConfig={};j.gtConfigFns=[];return j.gtConfig}var B={},x=0;COG.paramTweaker=function(j,i,t){return function(r,N){if(typeof N!=="undefined"){if(r in j)j[r]=N;t&&r in t&&t[r](r,N)}else return i&&r in i?i[r](r):j[r]}};COG.configurable=function(j,i,t,r){if(j){j.gtConfId||S(j);var N=j.gtConfId,Q=j.gtConfig,ba=j.gtConfigFns;B[N]=j;ba.push(t);for(t=i.length;t--;){Q[i[t]]=true;r&&I(j,
i[t])}if(!j.configure)j.configure=function(ia,y){if(Q[ia]){for(var C=ba.length;C--;){var A=ba[C](ia,y);if(typeof A!=="undefined")return A}return B[N]}return null}}}})();
(function(){function I(j){var i=document.createElement("script"),t=false;i.src=j;i.async=true;i.onload=i.onreadystatechange=function(){if(!t&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){t=true;i.onload=i.onreadystatechange=null;i&&i.parentNode&&i.parentNode.removeChild(i)}};B||(B=document.getElementsByTagName("head")[0]);B.appendChild(i)}var S=0,B,x=this;COG.jsonp=function(j,i,t){j+=j.indexOf("?")>=0?"&":"?";var r="json"+ ++S;x[r]=function(N){i(N);x[r]=null;try{delete x[r]}catch(Q){}};
I(j+(t?t:"callback")+"="+r);return r}})();
(function(){function I(c){if(ia)return Q.length;ia=true;try{for(var n=0;n<Q.length;)if(Q[n].isComplete()){Q[n].triggerComplete(false);Q.splice(n,1)}else{Q[n].update(c);n++}}finally{ia=false}Q.length===0&&ba.trigger("complete");return Q.length}function S(){if(!ba){ba=COG.Loopage.join({execute:I,frequency:20});ba.bind("complete",function(){ba=null})}}var B=1.70158,x=Math.PI/2,j=Math.abs,i=Math.pow,t=Math.sin,r=Math.asin,N=Math.cos,Q=[],ba=null,ia=false,y={linear:function(c,n,o,u){return o*c/u+n},backin:function(c,
n,o,u){return o*(c/=u)*c*((B+1)*c-B)+n},backout:function(c,n,o,u){return o*((c=c/u-1)*c*((B+1)*c+B)+1)+n},backinout:function(c,n,o,u){return(c/=u/2)<1?o/2*c*c*(((B*=1.525)+1)*c-B)+n:o/2*((c-=2)*c*(((B*=1.525)+1)*c+B)+2)+n},bouncein:function(c,n,o,u){return o-y.bounceout(u-c,0,o,u)+n},bounceout:function(c,n,o,u){return(c/=u)<1/2.75?o*7.5625*c*c+n:c<2/2.75?o*(7.5625*(c-=1.5/2.75)*c+0.75)+n:c<2.5/2.75?o*(7.5625*(c-=2.25/2.75)*c+0.9375)+n:o*(7.5625*(c-=2.625/2.75)*c+0.984375)+n},bounceinout:function(c,
n,o,u){return c<u/2?y.bouncein(c*2,0,o,u)/2+n:y.bounceout(c*2-u,0,o,u)/2+o/2+n},cubicin:function(c,n,o,u){return o*(c/=u)*c*c+n},cubicout:function(c,n,o,u){return o*((c=c/u-1)*c*c+1)+n},cubicinout:function(c,n,o,u){if((c/=u/2)<1)return o/2*c*c*c+n;return o/2*((c-=2)*c*c+2)+n},elasticin:function(c,n,o,u,H,G){if(c==0)return n;if((c/=u)==1)return n+o;G||(G=u*0.3);if(!H||H<j(o)){H=o;o=G/4}else o=G/TWO_PI*r(o/H);return-(H*i(2,10*(c-=1))*t((c*u-o)*TWO_PI/G))+n},elasticout:function(c,n,o,u,H,G){var P;if(c==
0)return n;if((c/=u)==1)return n+o;G||(G=u*0.3);if(!H||H<j(o)){H=o;P=G/4}else P=G/TWO_PI*r(o/H);return H*i(2,-10*c)*t((c*u-P)*TWO_PI/G)+o+n},elasticinout:function(c,n,o,u,H,G){var P;if(c==0)return n;if((c/=u/2)==2)return n+o;G||(G=u*0.3*1.5);if(!H||H<j(o)){H=o;P=G/4}else P=G/TWO_PI*r(o/H);if(c<1)return-0.5*H*i(2,10*(c-=1))*t((c*u-P)*TWO_PI/G)+n;return H*i(2,-10*(c-=1))*t((c*u-P)*TWO_PI/G)*0.5+o+n},quadin:function(c,n,o,u){return o*(c/=u)*c+n},quadout:function(c,n,o,u){return-o*(c/=u)*(c-2)+n},quadinout:function(c,
n,o,u){if((c/=u/2)<1)return o/2*c*c+n;return-o/2*(--c*(c-2)-1)+n},sinein:function(c,n,o,u){return-o*N(c/u*x)+o+n},sineout:function(c,n,o,u){return o*t(c/u*x)+n},sineinout:function(c,n,o,u){return-o/2*(N(Math.PI*c/u)-1)+n}},C=COG.Tween=function(c){c=COG.extend({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:A("sine.out"),complete:null},c);var n=(new Date).getTime(),o=[],u=false,H=0,G=0,P={isComplete:function(){return u},triggerComplete:function(R){c.complete&&c.complete(R)},
update:function(R){var E=c.tweenFn(R-n,H,G,c.duration);if(c.target)c.target[c.property]=E;for(var aa=o.length;aa--;)o[aa](E,void 0);if(u=n+c.duration<=R){if(c.target)c.target[c.property]=c.tweenFn(c.duration,H,G,c.duration);for(R=o.length;R--;)o[R](E,true)}},requestUpdates:function(R){o.push(R)}};H=c.target&&c.property&&c.target[c.property]?c.target[c.property]:c.startValue;if(typeof c.endValue!=="undefined")G=c.endValue-H;if(G==0)u=true;S();return P};COG.tweenValue=function(c,n,o,u,H){function G(E){var aa=
E-P,V=o(aa,c,R,u),na=P+u<=E;E=!na;if(H){aa=H(V,na,aa);E=typeof aa!="undefined"?aa&&E:E}E&&animFrame(G)}var P=animTime(),R=n-c;animFrame(G);return{}};COG.tween=function(c,n,o,u,H,G){c=new C({target:c,property:n,endValue:o,tweenFn:u,duration:G,complete:H});Q.push(c);return c};COG.endTweens=function(c){if(!ia){ia=true;try{for(var n=0;n<Q.length;)if(!c||c(Q[n])){Q[n].triggerComplete(true);Q.splice(n,1)}else n++}finally{ia=false}}};COG.getTweens=function(){return[].concat(Q)};var A=COG.easing=function(c){return y[c.replace(/[\-\_\s\.]/g,
"").toLowerCase()]};COG.registerEasingType=function(c,n){y[c.replace(/[\-\_\s\.]/g,"").toLowerCase()]=n}})();
(function(){var I=/^P(\d+Y)?(\d+M)?(\d+D)?$/,S=/^(\d+H)?(\d+M)?(\d+S)?$/,B={8601:function(j){j=j.split("T");var i=null;i=null;var t=0,r=0;I.lastIndex=-1;i=I.exec(j[0]);t+=i[3]?parseInt(i[3].slice(0,-1),10):0;S.lastIndex=-1;i=S.exec(j[1]);r+=i[1]?parseInt(i[1].slice(0,-1),10)*3600:0;r+=i[2]?parseInt(i[2].slice(0,-1),10)*60:0;r+=i[3]?parseInt(i[3].slice(0,-1),10):0;return new x(t,r)}},x=COG.Duration=function(j,i){return{days:j?j:0,seconds:i?i:0}};COG.addDuration=function(){for(var j=new x,i=arguments.length;i--;){j.days+=
arguments[i].days;j.seconds+=arguments[i].seconds}if(j.seconds>=86400){j.days+=~~(j.seconds/86400);j.seconds%=86400}return j};COG.formatDuration=function(j){var i,t,r="";if(j.days)r=j.days+" days ";if(j.seconds){j=j.seconds;if(j>=3600){i=~~(j/3600);j-=i*3600}if(j>=60){t=Math.round(j/60);j-=t*60}if(i)r=r+i+(i>1?" hrs ":" hr ")+(t?(t>10?t:"0"+t)+" min ":"");else if(t)r=r+t+" min";else if(j>0)r=r+(j>10?j:"0"+j)+" sec"}return r};COG.parseDuration=function(j,i){var t=i?B[i]:null;if(t)return t(j);COG.Log.warn("Could not find duration parser for specified format: "+
i);return new x}})();
INTERACT=function(){function I(y){return function(C,A,c){(c?c:y?document.body:document).addEventListener(C,A,false)}}function S(y){return function(C,A,c){(c?c:y?document.body:document).removeEventListener(C,A,false)}}function B(y,C,A){(A?A:document).attachEvent("on"+y,C)}function x(y,C,A){(A?A:document).detachEvent("on"+y,C)}function j(y,C){return{x:y?y:0,y:C?C:0,count:1}}function i(y,C){ba.push(COG.extend({handler:null,checks:{},type:y},C))}function t(y){var C=0,A=0;if(y.offsetParent){do{C+=y.offsetLeft;
A+=y.offsetTop;y=y.offsetParent}while(y)}return{x:C,y:A}}function r(y,C){for(var A=y.target?y.target:y.srcElement;A&&A.nodeName&&A.nodeName.toUpperCase()!="CANVAS";)A=A.parentNode;return A&&A===C}function N(y,C){return{x:y.x-(C?C.x:0),y:y.y-(C?C.y:0)}}function Q(y){if(y.preventDefault){y.preventDefault();y.stopPropagation()}else y.cancelBubble&&y.cancelBubble()}var ba=[],ia=function(y,C,A){function c(R,E,aa,V){H[H.length]={ticks:(new Date).getTime(),x:V.x,y:V.y};o.trigger("pan",V.x,V.y)}function n(){COG.info("reset "+
H.length+" pan history");H=[]}A=COG.extend({binder:null,unbinder:null,observable:null},A);for(var o=A.observable,u=[],H=[],G={bind:function(){return o.bind.apply(null,arguments)},pannable:function(R){COG.extend({inertia:true},R);o.bind("pointerDown",n);o.bind("pointerMove",c);return G},unbind:function(){o.unbind();for(var R=0;R<u.length;R++)u[R].unbind();return G}},P=0;P<C.length;P++)u.push(C[P](y,o,A));return G};i("pointer",{handler:function(y,C,A){function c(q){if(r(q,y))if(E=H(q)){y.style.cursor=
"move";Q(q);ea=q.pageX?q.pageX:q.screenX;Y=q.pageY?q.pageY:q.screenY;aa=j(ea,Y);V=t(y);C.trigger("pointerDown",aa,N(aa,V))}}function n(q){na=q.pageX?q.pageX:q.screenX;T=q.pageY?q.pageY:q.screenY;if(r(q,y))G(E?"pointerMove":"pointerHover")}function o(q){if(E&&H(q)){E=false;if(r(q,y)){y.style.cursor="default";G("pointerUp")}}}function u(q){if(r(q,y)){var Z;q=q||window.event;if(q.detail)Z=q.axis===2?-q.detail*P:0;else{Z=q.wheelDeltaY?q.wheelDeltaY:q.wheelDelta;if(window.opera)Z=-Z}if(Z!==0){var ga=j(na,
T);C.trigger("zoom",ga,N(ga,t(y)),Z/R,"wheel");Q(q);q.returnValue=false}}}function H(q){q=q||window.event;return(q.which||q.button)==1}function G(q,Z,ga,ta){Z=typeof Z!="undefined"?Z:na;ga=typeof ga!="undefined"?ga:T;var va=j(Z,ga);C.trigger(q,va,N(va,V),j(Z-ea,ga-Y));if(typeof ta=="undefined"||ta){ea=Z;Y=ga}}A=COG.extend({},A);var P=120,R=P*8,E=false,aa,V,na,T,ea,Y;A.binder("mousedown",c,false);A.binder("mousemove",n,false);A.binder("mouseup",o,false);A.binder("click",function(q){if(r(q,y)){q=j(q.pageX?
q.pageX:q.screenX,q.pageY?q.pageY:q.screenY);C.trigger("tap",q,N(q,t(y)))}},false);A.binder("dblclick",function(q){COG.info("captured double click");if(r(q,y)){q=j(q.pageX?q.pageX:q.screenX,q.pageY?q.pageY:q.screenY);COG.info("captured double click + target matched");C.trigger("doubleTap",q,N(q,t(y)))}},false);A.binder("mousewheel",u,document);A.binder("DOMMouseScroll",u,document);return{unbind:function(){A.unbinder("mousedown",c,false);A.unbinder("mousemove",n,false);A.unbinder("mouseup",o,false);
A.unbinder("mousewheel",u,document);A.unbinder("DOMMouseScroll",u,document)}}},checks:{touch:false}});i("pointer",{handler:function(y,C,A){function c(F){if(F.count<2)return 0;var O=F.x-F.next.x;F=F.y-F.next.y;return~~Math.sqrt(O*O+F*F)}function n(F,O,M){O=O?O:0;M=M?M:0;for(var pa={x:F.x-O,y:F.y-M,id:F.id,count:F.count},oa=pa;F.next;){F=F.next;oa=oa.next={x:F.x-O,y:F.y-M,id:F.id}}return pa}function o(F,O){var M=F[O?O:"touches"],pa,oa;if(M.length===0)return null;oa=pa={x:M[0].pageX,y:M[0].pageY,id:M[0].identifier,
count:M.length};for(var wa=1,La=M.length;wa<La;wa++)oa=oa.next={x:M[wa].pageX,y:M[wa].pageY,id:M[wa].identifier};return pa}function u(F){if(r(F,y)){T=t(y);var O=o(F,"changedTouches"),M=n(O,T.x,T.y);if(!Y){ea=aa;C.trigger("pointerDown",O,M)}ta&&C.trigger("pointerDownMulti",O,M);Y=o(F);if(Y.count>1)Z=c(Y);va=1;ga=n(Y)}}function H(F){if(r(F,y)){F.preventDefault();q=o(F);if(ea==aa)ea=Math.abs(Y.x-q.x)>R||Math.abs(Y.y-q.y)>R?E:aa;if(ea!=aa){ea=q.count>1?na:V;if(ea==na)if(Y.count===1){Y=n(q);Z=c(Y)}else{F=
c(q);if(Math.abs(Z-F)<P)ea=V;else{var O;O=q.x;var M=q.next.x,pa=q.y,oa=q.next.y,wa=pa<oa?pa:oa;O={x:(O<M?O:M)+(Math.abs(O-M)>>1),y:wa+(Math.abs(pa-oa)>>1)};F=F/Z;M=F-va;C.trigger("zoom",O,N(O,T),M,"pinch");va=F}}ea==V&&C.trigger("pointerMove",q,n(q,T.x,T.y),j(q.x-ga.x,q.y-ga.y));ta&&C.trigger("pointerMoveMulti",q,n(q,T.x,T.y))}ga=n(q)}}function G(F){if(r(F,y)){var O=o(F,"changedTouches"),M=n(O,T.x,T.y);q=o(F);if(!q){ea===aa&&C.trigger("pointerTap",O,M);C.trigger("pointerUp",O,M);Y=null}ta&&C.trigger("pointerUpMulti",
O,M)}}A=COG.extend({detailed:false,inertia:false},A);var P=20,R=7,E=0,aa=1,V=2,na=3,T,ea,Y,q,Z,ga,ta=A.detailed,va=1;A.binder("touchstart",u,false);A.binder("touchmove",H,false);A.binder("touchend",G,false);COG.info("initialized touch handler");return{unbind:function(){A.unbinder("touchstart",u,false);A.unbinder("touchmove",H,false);A.unbinder("touchend",G,false)}}},checks:{touch:true}});return{register:i,watch:function(y,C,A){C=COG.extend({bindToBody:false,observable:null,isIE:typeof window.attachEvent!=
"undefined",types:null},C);capabilities=COG.extend({touch:"ontouchstart"in window},A);if(!C.observable){COG.info("creating observable");C.observable=COG.observable({});globalOpts=C}C.binder=C.isIE?B:I(C.bindToBody);C.unbinder=C.isIE?x:S(C.bindToBody);A=C.types;for(var c=capabilities,n=[],o=ba.length;o--;){var u=ba[o],H=!A||A.indexOf(u.type)>=0,G=true;for(var P in u.checks){var R=u.checks[P];COG.info("checking "+P+" capability. require: "+R+", capability = "+c[P]);G=G&&R===c[P]}if(H&&G)n[n.length]=
u.handler}return new ia(y,n,C)}}}();
T5=function(){function I(){return(new Date).getTime()}function S(){for(;Z.length>0;){var b=Z.shift();document.location=b}q=0}function B(b){for(var m=true,e=ga.length;e--;)m=m&&b!=ga[e];return m}function x(b,m){var e=[];for(var a in m)a&&e.push(a+"="+escape(m[a]));return"tile5://"+b+"/"+(e.length>0?"?"+e.join("&"):"")}function j(b,m){B(b)&&COG.info("would push url: "+x(b,m))}function i(b,m){if(B(b)){Z.push(x(b,m));q||(q=setTimeout(S,100))}}function t(b){return function(m,e,a){(a?a:b?document.body:
document).addEventListener(m,e,false)}}function r(b){return function(m,e,a){(a?a:b?document.body:document).removeEventListener(m,e,false)}}function N(b,m,e){(e?e:document).attachEvent("on"+b,m)}function Q(b,m,e){(e?e:document).detachEvent("on"+b,m)}function ba(){T={base:{name:"Unknown",bindEvent:t(),unbindEvent:r(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:j,targetFps:null},ie:{name:"MSIE",regex:/msie/i,
bindEvent:N,unbindEvent:Q,requireFastDraw:false,targetFps:25},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:i,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:i},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:i},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:t(true),unbindEvent:r(true),supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},
bridgeNotify:i},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:i}};ea=[T.froyo,T.android,T.ipod,T.iphone,T.ipad,T.ie]}function ia(){T||ba();if(!Y){COG.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var b=0;b<ea.length;b++){var m=ea[b];if(m.regex&&m.regex.test(navigator.userAgent)){Y=COG.extend({},T.base,m);COG.info("PLATFORM DETECTED AS: "+Y.name);break}}if(!Y){COG.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
Y=T.base}COG.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return Y}function y(){for(var b=0,m=arguments.length;m--;){var e=O[arguments[m].toUpperCase()];if(e)b|=e}return b}var C=Math.abs,A=Math.min,c=Math.max,n=Math.pow,o=Math.sqrt,u=Math.log,H=Math.round,G=Math.sin,P=Math.asin,R=Math.cos,E=function(){function b(a,d){return e(a.x-d.x,a.y-d.y)}function m(a,d){if(!d)d=a.length;if(d<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var h={edges:Array(d-
1),accrued:Array(d-1),total:0},g=0;g<d-1;g++){var l=b(a[g],a[g+1]);h.edges[g]=o(l.x*l.x+l.y*l.y);h.accrued[g]=h.total+h.edges[g];h.total+=h.edges[g]}return h}function e(a,d){return{x:a?a:0,y:d?d:0}}return{VECTOR_SIMPLIFICATION:3,SIMPLIFICATION_MIN_VECTORS:25,add:function(){for(var a=0,d=0,h=arguments.length;h--;){a+=arguments[h].x;d+=arguments[h].y}return e(a,d)},absSize:function(a){return c(C(a.x),C(a.y))},copy:function(a){return a?e(a.x,a.y):null},diff:b,distance:function(a,d){return m(a,d).total},
edges:m,equals:function(a,d){return a.x===d.x&&a.y===d.y},extendBy:function(a,d,h){var g=R(d)*h;d=G(d)*h;return e(a.x-g,a.y-d)},floor:function(a){for(var d=Array(a.length),h=a.length;h--;)d[h]=e(~~a[h].x,~~a[h].y);return d},getRect:function(a){for(var d,h,g,l,p=a.length;p--;){var k=a[p];d=typeof d==="undefined"||k.x<d?k.x:d;h=typeof h==="undefined"||k.y<h?k.y:h;g=typeof g==="undefined"||k.x>g?k.x:g;l=typeof l==="undefined"||k.y>l?k.y:l}return V.init(d,h,g,l)},init:e,invert:function(a){return e(-a.x,
-a.y)},min:function(a,d){return e(a.x<d.x?a.x:d.x,a.y<d.y?a.y:d.y)},max:function(a,d){return e(a.x>d.x?a.x:d.x,a.y>d.y?a.y:d.y)},offset:function(a,d,h){return e(a.x+d,a.y+(h?h:d))},simplify:function(a,d){if(!a)return null;d=d?d:E.VECTOR_SIMPLIFICATION;for(var h=[],g=null,l=a.length;l--;){var p=a[l];if(include=!g||l===0||C(p.x-g.x)+C(p.y-g.y)>d){h.unshift(p);g=p}}return h},theta:function(a,d,h){h=P((a.y-d.y)/h);return a.x>d.x?h:Math.PI-h},toString:function(a){return a.x+", "+a.y}}}(),aa=function(){return{dotProduct:function(b,
m){return b.x*m.x+b.y*m.y}}}(),V=function(){function b(e){return m(e.x1,e.y1,e.x2,e.y2)}function m(e,a,d,h){e=e?e:0;a=a?a:0;d=typeof d!=="undefined"?d:e;h=typeof h!=="undefined "?h:h;return{x1:e,y1:a,x2:d,y2:h,width:d-e,height:h-a}}return{center:function(e){return E.init(e.x1+e.width/2,e.y1+e.height/2)},copy:b,diagonalSize:function(e){return o(e.width*e.width+e.height*e.height)},fromCenter:function(e,a,d,h){d=d>>1;h=h>>1;return m(e-d,a-h,e+d,a+h)},init:m,intersect:function(e,a){var d=c(e.x1,a.x1),
h=c(e.y1,a.y1),g=A(e.x2,a.x2),l=A(e.y2,a.y2);d=m(d,h,g,l);return d.width>0&&d.height>0?d:null},toString:function(e){return"["+e.x1+", "+e.y1+", "+e.x2+", "+e.y2+"]"},union:function(e,a){if(e.width===0||e.height===0)return b(a);else if(a.width===0||a.height===0)return b(e);else{var d=A(e.x1,a.x1),h=A(e.y1,a.y1),g=c(e.x2,a.x2),l=c(e.y2,a.y2);d=m(d,h,g,l);return d.width>0&&d.height>0?d:null}}}}(),na=function(){return{getAspectRatio:function(b){return b.height!==0?b.width/b.height:1},getCenter:function(b){return E.init(b.width>>
1,b.height>>1)},getSize:function(b){return o(n(b.width,2)+n(b.height,2))},init:function(b,m){b=b?b:0;return{width:b,height:m?m:b}}}}(),T=null,ea=[],Y=null,q=0,Z=[],ga=["view.wake","tile.loaded"],ta=function(){function b(){var f=ia().maxImageLoads;if(!f||p.length<f)if(f=l.shift()){p[p.length]=f;f.image.onload=m;f.image.src=f.url;f.requested=T5.ticks()}}function m(){var f=h[this.id],z;if(f&&f.image.complete&&f.image.width>0){f.loaded=true;f.hitCount=1;for(z=p.length;z--;)if(p[z].image.src==this.src){p.splice(z,
1);break}if(f.background||f.postProcess||f.drawBackground||f.customDraw)if(f.image){globalImageData=f;z=a(f.realSize?f.realSize.width:f.image.width,f.realSize?f.realSize.height:f.image.height);var J=z.getContext("2d"),L=f.offset?f.offset:T5.XY.init();f.background&&J.drawImage(f.background,0,0);f.drawBackground&&f.drawBackground(J);f.customDraw?f.customDraw(J,f):J.drawImage(f.image,L.x,L.y);f.postProcess&&f.postProcess(J,f);f.image=z}for(z=f.callbacks.length;z--;)f.callbacks[z]&&f.callbacks[z](this,
false);f.callbacks=[];k[k.length]={url:this.src,created:f.requested};delete h[this.id];b()}}function e(f,z,J){var L=d[f];if(L){L.hitCount++;L.image.complete&&L.image.width>0&&z?z(L.image,true):L.callbacks.push(z)}else{L=COG.extend({url:f,image:new Image,loaded:false,created:T5.ticks(),requested:null,hitCount:0,callbacks:[z]},J);L.image.id="resourceLoaderImage"+g++;d[f]=L;h[L.image.id]=L;l[l.length]=L;b()}return L}function a(f,z){var J=document.createElement("canvas");COG.info("creating new canvas");
J.width=f?f:0;J.height=z?z:0;if(typeof FlashCanvas!="undefined"){document.body.appendChild(J);FlashCanvas.initElement(J)}return J}var d={},h={},g=0,l=[],p=[],k=[],v={avgImageSize:25,loadTimeout:10,cancelLoad:function(){var f;for(f=p.length;f--;)delete d[p[f].url];p=[];for(f=l.length;f--;)delete d[l[f].url];l=[]},get:function(f,z,J){var L=null;L=null;if((L=(L=d[f])?L.image:null)&&(L.getContext||L.complete&&L.width>0))return L;else z&&e(f,z,J);return null},load:e,newCanvas:a,reset:function(){d={}},
stats:function(){return{imageLoadingCount:p.length,queuedImageCount:l.length,imageCacheFullness:0}}};COG.observable(v);return v}(),va=function(){var b={};return{init:function(m,e){var a=b[m];if(!a)throw Error("Unable to locate requested generator: "+m);return new a(e)},register:function(m,e){b[m]=e},Template:function(){}}}(),F=function(){function b(g,l){d[g]=e(l);return g}function m(g){for(var l in g)b(l,g[l])}function e(g){function l(f){var z=g[f];typeof z!=="undefined"&&k.push(function(J){J[f]=
z})}function p(){k=[];for(var f in g)l(f)}g=COG.extend({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},g);var k=[],v={applyToContext:function(f){for(var z=k.length;z--;)k[z](f)},update:function(f,z){g[f]=z;p()}};p();return v}var a={},d={},h={apply:function(g,l){var p=d[l]?d[l]:d.basic,k;if(g&&g.canvas){k=a[g.canvas.id];a[g.canvas.id]=l}p.applyToContext(g);return k},define:b,
defineMany:m,get:function(g){return d[g]},init:e,load:function(g){COG.jsonp(g,function(l){m(l)})}};m({basic:{lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"},waypoints:{lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"}});return h}(),O={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,ZOOM:16,FREEZE:128},M=function(b){b=COG.extend({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:y("ACTIVE","ANIMATING","PAN","ZOOM"),style:null,minXY:null,maxXY:null},b);var m=null,e=false,a=false,d=
b.id,h=y("ACTIVE"),g=b.validStates,l=0,p=0,k=COG.extend({addToView:function(v){v.setLayer(d,k)},shouldDraw:function(v){return(v&g)!==0},clip:null,cycle:function(){},draw:function(){},remove:function(){k.trigger("remove",k)},changed:function(){a=true;m&&m.invalidate()},getId:function(){return d},setId:function(v){d=v},getParent:function(){return m},setParent:function(v){e=(m=v)?m.fastDraw&&displayState!==h:false;k.trigger("parentChange",m)}},b);COG.observable(k);k.bind("drawComplete",function(v,f){a=
false;l=f.x1;p=f.y1});k.bind("resync",function(v,f){if(f.syncXY){k.minXY&&f.syncXY(k.minXY);k.maxXY&&f.syncXY(k.maxXY)}});return k},pa=function(b){function m(p,k,v,f){a=p;d=k;h=v;g=f}b=COG.extend({xy:E.init(),offset:true,tweenIn:null,animationSpeed:null,isNew:true},b);var e=false,a=0,d=0,h=0,g=0,l=COG.extend(b,{isAnimating:function(){return e},draw:function(p,k,v,f,z){if(l.isNew&&b.tweenIn)COG.tweenValue(k.y1-20,l.xy.y,b.tweenIn,b.animationSpeed?b.animationSpeed:250+Math.random()*500,function(J,L){l.xy.y=
J|0;e=!L;z.invalidate()});l.drawMarker(p,k,l.xy.x,l.xy.y,v,f,z);l.isNew=false},drawMarker:function(p,k,v,f){p.beginPath();p.arc(v,f,4,0,Math.PI*2,false);p.fill();m(v-4,f-4,8,8)},hitTest:function(p,k){return p>=a&&p<=a+h&&k>=d&&k<=d+g},updateBounds:m});COG.observable(l);return l},oa=function(b){function m(){e();d.changed();d.trigger("markerUpdate",a)}function e(){var h=d.getParent();if(h&&h.syncXY)for(var g=a.length;g--;)h.syncXY([a[g].xy])}b=COG.extend({zindex:100,style:"basic"},b);var a=[],d=COG.extend(new M(b),
{draw:function(h,g,l,p){for(var k=a.length;k--;)a[k].draw(h,g,l,d,p)},add:function(h){if(h&&typeof h.length!=="undefined")for(var g=h.length;g--;){if(h[g])a[a.length]=h[g]}else if(h)a[a.length]=h;m()},clear:function(h){if(h)for(var g=0;g<a.length;)if(h(a[g]))a.splice(g,1);else g+=1;else a=[];m()},each:function(h){if(h)for(var g=a.length;g--;)h(a[g])},find:function(h){for(var g=[],l=a.length;l--;)if(!h||h(a[l]))g[g.length]=a[l];return g}});d.bind("tap",function(h,g,l,p){var k=[],v=p.x;p=p.y;for(var f=
a.length;f--;)if(a[f].hitTest(v,p))k[k.length]=a[f];if(k.length>0)h.cancel=d.trigger("markerTap",g,l,k).cancel});d.bind("parentChange",e);d.bind("resync",e);return d},wa=function(b){function m(l,p,k){l.fillStyle="#FFFFFF";l.strokeStyle="#222222";l.beginPath();l.arc(k.x,k.y,4,0,Math.PI*2,false);l.stroke();l.fill()}b=COG.extend({path:[],id:COG.objId("pathAni"),easing:COG.easing("sine.inout"),validStates:y("ACTIVE","PAN","ZOOM"),drawIndicator:null,duration:2E3},b);var e=E.edges(b.path),a,d=null,h=0;
COG.tweenValue(0,e.total,b.easing,function(){g.remove()},b.duration).requestUpdates(function(l,p){h=l;p&&g.remove()});var g=COG.extend(new M(b),{cycle:function(){for(var l=0;l<e.accrued.length&&e.accrued[l]<h;)l++;d=null;if(l<b.path.length-1){var p=h-(l>0?e.accrued[l-1]:0),k=b.path[l];a=E.theta(k,b.path[l+1],e.edges[l]);d=E.extendBy(k,a,p)}return d},draw:function(l,p){if(d)(b.drawIndicator?b.drawIndicator:m)(l,p,E.init(d.x,d.y),a)}});return g},La=function(b){b=COG.extend({style:null,properties:{}},
b);return COG.extend(b,{rect:null,draw:function(){},resync:function(){}})},kb=function(){return{tileSize:256,init:function(b,m,e,a,d){return COG.extend({x:b,y:m,width:e,height:a},d)}}}(),Ua={ex:COG.extend,ticks:I,getConfig:ia,userMessage:function(b,m,e){Ua.trigger("userMessage",b,m,e)},zoomable:function(b,m){function e(g,l){g=g?c(A(g,h),d):d;if(g!=a){a=g;b.triggerAll("zoomLevelChange",g,l)}}m=COG.extend({initial:1,minZoom:1,maxZoom:16},m);var a=null,d=m.minZoom,h=m.maxZoom;COG.extend(b,{getZoomLevel:function(){return a},
setZoomLevel:e});b.bind("scale",function(g,l,p){g=Math.log(l)/Math.LN2;COG.endTweens(function(k){return k.cancelOnInteract});e(a+g,p);b.updateOffset(p.x*l,p.y*l)})},XY:E,XYRect:V,Dimensions:na,Vector:aa,D:na,Images:ta,Generator:va,tween:COG.tween,tweenValue:COG.tweenValue,easing:COG.easing,Tween:COG.Tween,Style:F,viewState:y,View:function(b){function m(w,s,D,K){qa=Ma;v(ca-s,da-D,K?b.panAnimationEasing:null,K?b.panAnimationDuration:null);clearTimeout(eb);eb=setTimeout(e,100)}function e(){qa=Va;ka()}
function a(w,s,D,K){Wa(A(c($+n(2,K)-1,0.5),2))}function d(){var w=u($)/Math.LN2>>0;if(w!==0){$=n(2,w);w=E.init(Na-(Ba/$>>0),Oa-(Ca/$>>0));if(!ha.trigger("scale",$,w).cancel){for(var s=U.length;s--;)U[s].trigger("scale",$,w);$=1;qa=Va}Xa()}ka()}function h(w){w||(w=E.init(Ba,Ca));Ya=E.init(ca,da);Ja=E.offset(w,ca,da);Na=Ja.x;Oa=Ja.y}function g(w,s){var D,K;K=1/$;if($!==1&&ua){D=ua.x1+w*K;K=ua.y1+s*K}else{D=w+ca;K=s+da}return E.init(D,K)}function l(w,s,D){Ka("doubleTap",s,D,g(D.x,D.y));if(b.scalable){COG.endTweens(function(K){return K.cancelOnInteract});
Wa(2,D,b.zoomAnimation,null,b.zoomDuration)}}function p(){clearTimeout(fb);fb=setTimeout(f,250)}function k(w,s,D){Ka("tap",s,D,g(D.x,D.y))}function v(w,s,D,K,W){function ra(){Da+=1;if(Da>=2){e();W&&W()}}var Da=0,xa=Ga?E.offset(Ga,-Ba,-Ca):null,Ea=Ha?E.offset(Ha,-Ba,-Ca):null;if(xa){w=w<xa.x?xa.x:w;s=s<xa.y?xa.y:s}if(Ea){w=w>Ea.x?Ea.x:w;s=s>Ea.y?Ea.y:s}if(D){if((qa&Ma)===0){COG.tweenValue(ca,w,D,K,function(Ia,Za){ca=Ia|0;(Za?ra:ka)();return!Pa});COG.tweenValue(da,s,D,K,function(Ia,Za){da=Ia|0;(Za?
ra:ka)();return!Pa});qa=Ma|$a}}else{ca=w|0;da=s|0;ka();W&&W()}}function f(w,s){var D;if(ja){ya&&ya.unbind();if(b.autoSize&&ja.parentNode){w=ja.parentNode.offsetWidth;s=ja.parentNode.offsetHeight}try{if(!ja.id)ja.id=b.id+"_canvas";X=ja.getContext("2d")}catch(K){COG.exception(K);throw Error("Could not initialise canvas on specified view element");}if(w&&s&&(la!==s||ma!==w)){ab=true;ma=w;la=s;Ba=ma>>1;Ca=la>>1;ha.trigger("resize",ma,la);for(D=sa;D--;)U[D].trigger("resize",ma,la)}if(b.interactive){ya=
INTERACT.watch(ja).pannable();J()}for(D=sa;D--;)U[D].trigger("contextChanged",X);ka()}}function z(w,s){s.setId(w);s.added=I();s.bind("remove",function(){ha.removeLayer(w)});s.trigger("contextChanged",X);s.setParent(ha);U.push(s);U.sort(function(D,K){var W=K.zindex-D.zindex;if(W===0)W=K.added-D.added;return W});sa=U.length;return s}function J(){if(ya){if(b.pannable){ya.bind("pan",m);ya.bind("inertiaCancel",function(){ka()})}if(b.scalable){ya.bind("zoom",a);ya.bind("doubleTap",l)}ya.bind("tap",k)}}
function L(){var w=Qa?ca+Ba:ca,s=Ra?da+Ca:da;if(za&&za>ma)if(w+ma>za)ca=Qa?w-za>0?ca-za:ca:za-ma;else if(w<0)ca=Qa?ca+za:0;if(Aa&&Aa>la)if(s+la>Aa)da=Ra?s-Aa>0?da-Aa:da:Aa-la;else if(s<0)da=Ra?da+Aa:0}function fa(w,s,D,K){var W;V.center(s);var ra=0;ua=V.copy(s);ua.scaleFactor=$;D||X.clearRect(0,0,ma,la);X.save();try{X.globalCompositeOperation="source-over";if($!==1){var Da=ua,xa=1/$;Na=Ja.x+(ca-Ya.x);Oa=Ja.y+(da-Ya.y);ua=Da?V.fromCenter(Na>>0,Oa>>0,Da.width*xa>>0,Da.height*xa>>0):void 0;X.scale($,
$)}X.translate(-ua.x1,-ua.y1);Ha=Ga=null;if(D){X.beginPath();for(ra=sa;ra--;)U[ra].clip&&U[ra].clip(X,ua,w,ha,K);X.closePath();X.clip()}for(ra=sa;ra--;){W=U[ra];var Ea=W.style,Ia=Ea?F.apply(X,Ea):null;if(W.minXY)Ga=Ga?E.min(Ga,W.minXY):E.copy(W.minXY);if(W.maxXY)Ha=Ha?E.max(Ha,W.maxXY):E.copy(W.maxXY);W.draw(X,ua,w,ha,K);Ia&&F.apply(X,Ia)}}finally{X.restore()}if(lb){X.globalCompositeOperation="source-over";X.strokeStyle="#f00";X.beginPath();X.moveTo(Ba,0);X.lineTo(Ba,la);X.moveTo(0,Ca);X.lineTo(ma,
Ca);X.stroke()}bb=0;Ka("drawComplete",s,K)}function Fa(w){var s,D=false;if(bb){if(w-gb>mb){if($!==1)qa|=hb;Pa=(s=(qa&(hb|Ma))!==0)&&(qa&$a)===0;if(ab&&ja){typeof FlashCanvas!="undefined"&&FlashCanvas.initElement(ja);ja.width=ma;ja.height=la;ja.style.width=ma+"px";ja.style.height=la+"px";ab=false}if(za||Aa)L();Sa=Ta();if(Pa){COG.endTweens(function(W){return W.cancelOnInteract});nb=false;if(cb!==0){clearTimeout(cb);cb=0}}for(var K=sa;K--;){if(U[K].animated)qa|=$a;U[K].cycle(w,Sa,qa);U[K].shouldDraw(qa,
Sa);D=U[K].clip||D}fa(qa,Sa,ob&&D&&!s,w);w-ib>pb&&Xa();gb=w}COG.animFrame(Fa)}else db=false}function ka(){bb+=1;if(!db){db=true;COG.animFrame(Fa)}}function Ta(){return V.init(ca,da,ca+ma,da+la)}function Xa(){ib=(new Date).getTime();Ka("refresh",ha,Ta());ka()}function Wa(w,s,D,K,W){if(D)COG.tweenValue($,w,D,W,function(ra,Da){$=ra;if(Da){var xa=H(u($)/Math.LN2);$=n(2,xa);K&&K()}h(s);d()});else{$=w;h(s);d()}return ha}function Ka(){for(var w=ha.trigger.apply(null,arguments).cancel,s=U.length;s--;)w=U[s].trigger.apply(null,
arguments).cancel||w;return!w}b=COG.extend({id:COG.objId("view"),container:"",fastDraw:false,inertia:true,idleDelay:100,minRefresh:1E3,pannable:true,clipping:true,scalable:true,interactive:true,panAnimationEasing:COG.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:true,tapExtent:10,mask:true,guides:false,fps:25,zoomAnimation:COG.easing("quad.out"),zoomDuration:300},b);var U=[],sa=0,ja=document.getElementById(b.container),X=null,qb=typeof window.attachEvent!=
"undefined",pb=b.minRefresh,ca=0,da=0,za=null,Aa=null,Qa=false,Ra=false,ob=b.clipping,Sa=null,db=false,ua,lb=b.guides,jb=1,Ba=0,Ca=0,Ya=null,Ja=null,Pa=false,nb=false,cb=0,eb=0,Ga=null,Ha=null,ib=0,rb=0,fb=0,$=1,gb=0,ab=false,ya=null,la,ma,mb=1E3/b.fps|0,bb=0,Na,Oa,Va=y("ACTIVE"),Ma=y("PAN"),hb=y("ZOOM"),$a=y("ANIMATING"),qa=Va,ha={id:b.id,deviceScaling:jb,fastDraw:b.fastDraw||ia().requireFastDraw,getDimensions:function(){return na.init(ma,la)},getLayer:function(w){for(var s=0;s<sa;s++)if(U[s].getId()==
w)return U[s];return null},setLayer:function(w,s){for(var D=0;D<sa;D++)if(U[D].getId()===w){U.splice(D,1);break}if(s){z(w,s);s.trigger("refresh",ha,Ta())}ka();return s},eachLayer:function(w){for(var s=sa;s--;)w(U[s])},invalidate:ka,refresh:Xa,resetScale:function(){$=1},resize:function(w,s){if(ja){b.autoSize=false;if(ma!==w||la!==s)f(w,s)}},scale:Wa,triggerAll:Ka,removeLayer:function(w){a:{for(var s=sa;s--;)if(U[s].getId()==w){w=s;break a}w=-1}if(w>=0&&w<sa){ha.trigger("layerRemoved",U[w]);U.splice(w,
1);ka()}sa=U.length},getOffset:function(){return E.init(ca,da)},setMaxOffset:function(w,s,D,K){za=w;Aa=s;Qa=typeof D!="undefined"?D:false;Ra=typeof K!="undefined"?K:false},getViewRect:Ta,updateOffset:v,pan:function(w,s,D,K,W){v(ca+w,da+s,D,K,W)}};jb=ia().getScaling();ha.markers=z("markers",new oa);COG.observable(ha);ha.bind("invalidate",function(){ka()});ha.bind("resync",function(){Ha=Ga=null});COG.configurable(ha,["inertia","container","rotation","tapExtent","scalable","pannable"],COG.paramTweaker(b,
null,{container:function(w,s){ja=document.getElementById(s);f()},rotation:function(w,s){rb=s}}),true);f();if(b.autoSize)qb?window.attachEvent("onresize",p):window.addEventListener("resize",p,false);return ha},ViewLayer:M,ImageLayer:function(b,m){function e(k,v,f){for(v=g.length;v--;){var z=g[v],J=z.x,L=z.y,fa=V.init(z.x,z.y,z.x+z.width,z.y+z.height);if(f&&V.intersect(k,fa))(fa=ta.get(z.url,function(){p.changed()},l))&&f(fa,J,L,z.width,z.height)}}function a(k){var v=++h,f=p.getParent();if(d){COG.info("generating: "+
V.toString(k)+", sequence = "+v);d.run(f,k,function(z){if(v==h){g=[].concat(z);f.invalidate()}})}}m=COG.extend({imageLoadArgs:{}},m);var d=b?va.init(b,m):null,h=0,g=[],l=m.imageLoadArgs,p=COG.extend(new M(m),{changeGenerator:function(k,v){d=va.init(k,COG.extend({},m,v));g=null;a(p.getParent().getViewRect())},clip:function(k,v,f){e(v,f,function(z,J,L,fa,Fa){k.rect(J,L,fa,Fa)})},draw:function(k,v,f){e(v,f,function(z,J,L,fa,Fa){p.drawImage(k,z,J,L,fa,Fa,v,f)})},drawImage:function(k,v,f,z){v&&k.drawImage(v,
f,z,v.width,v.height)}});p.bind("refresh",function(k,v,f){a(f)});p.bind("tap",function(k,v,f,z){k=[];var J=z.x,L=z.y,fa,Fa;if(g)for(var ka=g.length;ka--;){fa=g[ka];if(Fa=J>=fa.x&&J<=fa.x+fa.width&&L>=fa.y&&L<=fa.y+fa.height)k[k.length]=fa}k.length>0&&p.trigger("tapImage",k,v,f,z)});return p},ImageGenerator:function(b){b=COG.extend({relative:false,padding:2},b);b={run:function(){COG.warn("running base generator - this should be overriden")}};COG.observable(b);return b},Marker:pa,ImageMarker:function(b){b=
COG.extend({image:null,imageUrl:null,animatingImage:null,animatingImageUrl:null,imageAnchor:null,rotation:0,scale:1,opacity:1},b);var m=b.imageAnchor?T5.XY.invert(b.imageAnchor):null,e=COG.extend(new pa(b),{drawMarker:function(a,d,h,g){if((d=e.isAnimating()&&e.animatingImage?e.animatingImage:e.image)&&d.width>0){m||(m=E.init(-d.width>>1,-d.height>>1));var l=e.scale,p=h+~~(m.x*l),k=g+~~(m.y*l),v=~~(d.width*l),f=~~(d.height*l);e.updateBounds(p,k,v,v);if(e.rotation||e.opacity!==1){a.save();try{a.globalAlpha=
e.opacity;a.translate(h,g);a.rotate(e.rotation);a.drawImage(d,m.x*l,m.y*l,v,f)}finally{a.restore()}}else a.drawImage(d,p,k,v,f)}}});if(!e.image)e.image=ta.get(b.imageUrl,function(a){e.image=a});if(!e.animatingImage)e.animatingImage=ta.get(b.animatingImageUrl,function(a){e.animatingImage=a});return e},MarkerLayer:oa,PathLayer:function(b){function m(){var k=p.getParent();if(k&&k.syncXY){k.syncXY(d);h&&k.syncXY(h);p.trigger("tidy")}}b=COG.extend({style:"waypoints",pixelGeneralization:8,zindex:50},b);
var e=[],a=null,d=[],h=null,g=0,l=[],p=COG.extend(new M(b),{getAnimation:function(k,v,f,z){var J="pathAnimation"+g++;l.push(J);return new wa({id:J,path:e,zindex:b.zindex+1,easing:k?k:COG.easing("sine.inout"),duration:v?v:5E3,drawIndicator:f,autoCenter:z?z:false})},draw:function(k){var v,f=e.length;k.save();try{F.apply(k,b.style);if(f>0){k.beginPath();k.moveTo(e[f-1].x,e[f-1].y);for(v=f;v--;)k.lineTo(e[v].x,e[v].y);k.stroke();if(a){k.fillStyle=b.waypointFillStyle;for(v=a.length;v--;){k.beginPath();
k.arc(a[v].x,a[v].y,2,0,Math.PI*2,false);k.stroke();k.fill()}}}}finally{k.restore()}},updateCoordinates:function(k,v){d=k;h=v;m()}});p.bind("tidy",function(){e=E.simplify(d,b.pixelGeneralization);a=E.simplify(h,b.pixelGeneralization);p.changed(true)});p.bind("resync",m);return p},AnimatedPathLayer:wa,Shape:La,Arc:function(b,m){m=COG.extend({size:4},m);var e=E.init(),a=COG.extend(m,{draw:function(d){d.beginPath();d.arc(e.x,e.y,a.size,0,Math.PI*2,false);d.fill();d.stroke()},resync:function(d){d.syncXY([b]);
e=E.floor([b])[0]}});COG.info("created arc = ",b);return a},Poly:function(b,m){m=COG.extend({fill:false,simplify:false},m);var e=false,a=m.fill,d=m.simplify,h=y("ZOOM"),g=[],l=COG.extend(new La(m),{draw:function(p,k,v,f,z,J){if(e){k=true;v=(J&h)!==0;p.beginPath();for(J=g.length;J--;){v=g[J].x;f=g[J].y;if(k){p.moveTo(v,f);k=false}else p.lineTo(v,f);v=true}if(v){a&&p.fill();p.stroke()}}},resync:function(p){l.xy=p.syncXY(b);g=E.floor(d?E.simplify(b):b)}});e=b&&b.length>=2;return l},ShapeLayer:function(b){function m(h){for(var g=
a.length;g--;)a[g].resync(h);a.sort(function(l,p){var k=p.xy.y-l.xy.y;if(k===0)k=p.xy.x-l.xy.y;return k});d.changed()}function e(h,g){g.syncXY&&m(g)}b=COG.extend({zindex:80},b);var a=[],d=COG.extend(new M(b),{add:function(h){a[a.length]=h},each:function(h){for(var g=a.length;g--;)h(a[g])},draw:function(h,g,l){var p=g.x1,k=g.y1,v=g.width;g=g.height;for(var f=a.length;f--;){var z=a[f].style;z=z?F.apply(h,z):null;a[f].draw(h,p,k,v,g,l);z&&F.apply(h,z)}}});d.bind("parentChange",e);d.bind("resync",e);
return d},Tiling:kb};COG.observable(Ua);return Ua}();
