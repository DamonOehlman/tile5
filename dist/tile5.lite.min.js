COG=typeof COG!=="undefined"?COG:{};COG.extend=function(){for(var S=arguments[0]||{},$,C=1,A=arguments.length;C<A;C++)if(($=arguments[C])!==null)for(var r in $){var s=$[r];if(S!==s)if(s!==undefined)S[r]=s}return S};
(function(){var S=Object.prototype.hasOwnProperty,$=0,C={};C.toID=function(A){return A.replace(/\s/g,"-")};C.objId=function(A){return(A?A:"obj")+$++};C.isFunction=function(A){return toString.call(A)==="[object Function]"};C.isArray=function(A){return toString.call(A)==="[object Array]"};C.isPlainObject=function(A){if(!A||toString.call(A)!=="[object Object]"||A.nodeType||A.setInterval)return false;if(A.constructor&&!S.call(A,"constructor")&&!S.call(A.constructor.prototype,"isPrototypeOf"))return false;
var r;for(r in A);return r===undefined||S.call(A,r)};C.isEmptyObject=function(A){for(var r in A)return false;return true};C.isXmlDocument=function(A){return toString.call(A)==="[object Document]"};C.contains=function(A,r){var s=A,x=arguments,E=1;if(r&&module.isArray(r)){x=r;E=0}for(E=E;E<x;E++)s=s&&typeof foo[x[E]]!=="undefined";return s};C.formatStr=function(A){if(arguments.length<=1)return A;for(var r=arguments.length-2,s=0;s<=r;s++)A=A.replace(RegExp("\\{"+s+"\\}","gi"),arguments[s+1]);return A};
C.wordExists=function(A,r){var s="";if(r.toString)r=r.toString();for(var x=0;x<r.length;x++)s+=!/\w/.test(r[x])?"\\"+r[x]:r[x];return RegExp("(^|\\s|\\,)"+s+"(\\,|\\s|$)","i").test(A)};COG.extend(COG,C)})();
(function(){function S(s){return typeof console!=="undefined"?function(){console[s](Array.prototype.slice.call(arguments,0).join(" "));return true}:function(){return false}}var $=window.console&&window.console.markTimeline,C=S("error"),A=S("info"),r=function(){return $?function(s,x){console.markTimeline(s+(x?": "+((new Date).getTime()-x)+"ms":""))}:function(){}}();COG.extend(COG,{trace:r,debug:S("debug"),info:A,warn:S("warn"),error:C,exception:function(s){if(C)for(var x in s)A("ERROR DETAIL: "+x+
": "+s[x])}})})();
COG.Loopage=function(){function S(J){return COG.extend({id:s++,frequency:0,after:0,single:false,lastTick:0,execute:function(){}},J)}function $(J){E.push(J);C()}function C(){W&&clearTimeout(W);W=setTimeout(A,0);fa=true}function A(){for(var J,o=(new Date).getTime(),y=x.length;E.length>0;){var z=E.shift();for(J=y;J--;)if(x[J].id===z){x.splice(J,1);break}fa=true;y=x.length}if(fa){R=r;for(J=y;J--;)R=x[J].frequency<R?x[J].frequency:R}for(J=y;J--;){z=o-x[J].lastTick;if(x[J].lastTick===0||z>=x[J].frequency){x[J].execute(o,
x[J]);x[J].lastTick=o;x[J].single&&x[J].trigger("complete")}}W=y?setTimeout(A,R):0}var r=6E4,s=0,x=[],E=[],W=0,R=r,fa=true;return{join:function(J){var o=new S(J);if(o.after>0)o.lastTick=(new Date).getTime()+o.after;COG.observable(o);o.bind("complete",function(){$(o.id)});x.unshift(o);C();return o},leave:$}}();
(function(){function S(C,A){var r=C.obsHandlers;r[A]||(r[A]=[]);return r[A]}var $=0;COG.observable=function(C){if(!C)return null;if(!C.obsHandlers)C.obsHandlers={};if(!(C.bind||C.trigger||C.unbind)){C.bind=function(A,r){var s="callback"+$++;S(C,A).unshift({fn:r,id:s});return s};C.trigger=function(A){var r=S(C,A),s={cancel:false,name:A,tickCount:(new Date).getTime()},x;if(!r)return null;x=Array.prototype.slice.call(arguments,1);C.eventInterceptor&&C.eventInterceptor(A,s,x);x.unshift(s);for(var E=r.length;E--&&
!s.cancel;)r[E].fn.apply(self,x);return s};C.unbind=function(A,r){if(typeof A==="undefined")C.obsHandlers={};else for(var s=S(C,A),x=0;s&&x<s.length;x++)if(s[x].id===r){s.splice(x,1);break}return C}}return C}})();
(function(){function S(r,s){r[s]||(r[s]=function(x){return r.configure(s,x)})}function $(r){r.gtConfId="configurable"+A++;r.gtConfig={};r.gtConfigFns=[];return r.gtConfig}var C={},A=0;COG.paramTweaker=function(r,s,x){return function(E,W){if(typeof W!=="undefined"){if(E in r)r[E]=W;x&&E in x&&x[E](E,W)}else return s&&E in s?s[E](E):r[E]}};COG.configurable=function(r,s,x,E){if(r){r.gtConfId||$(r);var W=r.gtConfId,R=r.gtConfig,fa=r.gtConfigFns;C[W]=r;fa.push(x);for(x=s.length;x--;){R[s[x]]=true;E&&S(r,
s[x])}if(!r.configure)r.configure=function(J,o){if(R[J]){for(var y=fa.length;y--;){var z=fa[y](J,o);if(typeof z!=="undefined")return z}return C[W]}return null}}}})();
(function(){function S(r){var s=document.createElement("script"),x=false;s.src=r;s.async=true;s.onload=s.onreadystatechange=function(){if(!x&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){x=true;s.onload=s.onreadystatechange=null;s&&s.parentNode&&s.parentNode.removeChild(s)}};C||(C=document.getElementsByTagName("head")[0]);C.appendChild(s)}var $=0,C,A=this;COG.jsonp=function(r,s,x){r+=r.indexOf("?")>=0?"&":"?";var E="json"+ ++$;A[E]=function(W){s(W);A[E]=null;try{delete A[E]}catch(R){}};
S(r+(x?x:"callback")+"="+E);return E}})();
(function(){function S(d){if(J)return R.length;J=true;try{for(var k=0;k<R.length;)if(R[k].isComplete()){R[k].triggerComplete(false);R.splice(k,1)}else{R[k].update(d);k++}}finally{J=false}R.length===0&&fa.trigger("complete");return R.length}function $(){if(!fa){fa=COG.Loopage.join({execute:S,frequency:20});fa.bind("complete",function(){fa=null})}}var C=1.70158,A=Math.PI/2,r=Math.abs,s=Math.pow,x=Math.sin,E=Math.asin,W=Math.cos,R=[],fa=null,J=false,o={linear:function(d,k,m,v){return m*d/v+k},backin:function(d,
k,m,v){return m*(d/=v)*d*((C+1)*d-C)+k},backout:function(d,k,m,v){return m*((d=d/v-1)*d*((C+1)*d+C)+1)+k},backinout:function(d,k,m,v){return(d/=v/2)<1?m/2*d*d*(((C*=1.525)+1)*d-C)+k:m/2*((d-=2)*d*(((C*=1.525)+1)*d+C)+2)+k},bouncein:function(d,k,m,v){return m-o.bounceout(v-d,0,m,v)+k},bounceout:function(d,k,m,v){return(d/=v)<1/2.75?m*7.5625*d*d+k:d<2/2.75?m*(7.5625*(d-=1.5/2.75)*d+0.75)+k:d<2.5/2.75?m*(7.5625*(d-=2.25/2.75)*d+0.9375)+k:m*(7.5625*(d-=2.625/2.75)*d+0.984375)+k},bounceinout:function(d,
k,m,v){return d<v/2?o.bouncein(d*2,0,m,v)/2+k:o.bounceout(d*2-v,0,m,v)/2+m/2+k},cubicin:function(d,k,m,v){return m*(d/=v)*d*d+k},cubicout:function(d,k,m,v){return m*((d=d/v-1)*d*d+1)+k},cubicinout:function(d,k,m,v){if((d/=v/2)<1)return m/2*d*d*d+k;return m/2*((d-=2)*d*d+2)+k},elasticin:function(d,k,m,v,L,G){if(d==0)return k;if((d/=v)==1)return k+m;G||(G=v*0.3);if(!L||L<r(m)){L=m;m=G/4}else m=G/TWO_PI*E(m/L);return-(L*s(2,10*(d-=1))*x((d*v-m)*TWO_PI/G))+k},elasticout:function(d,k,m,v,L,G){var Z;if(d==
0)return k;if((d/=v)==1)return k+m;G||(G=v*0.3);if(!L||L<r(m)){L=m;Z=G/4}else Z=G/TWO_PI*E(m/L);return L*s(2,-10*d)*x((d*v-Z)*TWO_PI/G)+m+k},elasticinout:function(d,k,m,v,L,G){var Z;if(d==0)return k;if((d/=v/2)==2)return k+m;G||(G=v*0.3*1.5);if(!L||L<r(m)){L=m;Z=G/4}else Z=G/TWO_PI*E(m/L);if(d<1)return-0.5*L*s(2,10*(d-=1))*x((d*v-Z)*TWO_PI/G)+k;return L*s(2,-10*(d-=1))*x((d*v-Z)*TWO_PI/G)*0.5+m+k},quadin:function(d,k,m,v){return m*(d/=v)*d+k},quadout:function(d,k,m,v){return-m*(d/=v)*(d-2)+k},quadinout:function(d,
k,m,v){if((d/=v/2)<1)return m/2*d*d+k;return-m/2*(--d*(d-2)-1)+k},sinein:function(d,k,m,v){return-m*W(d/v*A)+m+k},sineout:function(d,k,m,v){return m*x(d/v*A)+k},sineinout:function(d,k,m,v){return-m/2*(W(Math.PI*d/v)-1)+k}},y=COG.Tween=function(d){d=COG.extend({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:z("sine.out"),complete:null},d);var k=(new Date).getTime(),m=[],v=false,L=0,G=0,Z={isComplete:function(){return v},triggerComplete:function(F){d.complete&&d.complete(F)},
update:function(F){try{var ka=d.tweenFn(F-k,L,G,d.duration);if(d.target)d.target[d.property]=ka;for(var X=m.length;X--;)m[X](ka,void 0);if(v=k+d.duration<=F){if(d.target)d.target[d.property]=d.tweenFn(d.duration,L,G,d.duration);for(var na=m.length;na--;)m[na](ka,true)}}catch(ba){COG.exception(ba)}},requestUpdates:function(F){m.push(F)}};L=d.target&&d.property&&d.target[d.property]?d.target[d.property]:d.startValue;if(typeof d.endValue!=="undefined")G=d.endValue-L;if(G==0)v=true;$();return Z};COG.tweenValue=
function(d,k,m,v,L){d=new y({startValue:d,endValue:k,tweenFn:m,complete:v,duration:L});R.push(d);return d};COG.tween=function(d,k,m,v,L,G){d=new y({target:d,property:k,endValue:m,tweenFn:v,duration:G,complete:L});R.push(d);return d};COG.endTweens=function(d){if(!J){J=true;try{for(var k=0;k<R.length;)if(!d||d(R[k])){R[k].triggerComplete(true);R.splice(k,1)}else k++}finally{J=false}}};COG.getTweens=function(){return[].concat(R)};var z=COG.easing=function(d){return o[d.replace(/[\-\_\s\.]/g,"").toLowerCase()]};
COG.registerEasingType=function(d,k){o[d.replace(/[\-\_\s\.]/g,"").toLowerCase()]=k}})();
INTERACT=function(){function S(o){return function(y,z,d){(d?d:o?document.body:document).addEventListener(y,z,false)}}function $(o){return function(y,z,d){(d?d:o?document.body:document).removeEventListener(y,z,false)}}function C(o,y,z){(z?z:document).attachEvent("on"+o,y)}function A(o,y,z){(z?z:document).detachEvent("on"+o,y)}function r(o,y){return{x:o?o:0,y:y?y:0,count:1}}function s(o,y){fa.push(COG.extend({handler:null,checks:{},type:o},y))}function x(o){var y=0,z=0;if(o.offsetParent){do{y+=o.offsetLeft;
z+=o.offsetTop;o=o.offsetParent}while(o)}return{x:y,y:z}}function E(o,y){for(var z=o.target?o.target:o.srcElement;z&&z.nodeName&&z.nodeName.toUpperCase()!="CANVAS";)z=z.parentNode;return z&&z===y}function W(o,y){return{x:o.x-(y?y.x:0),y:o.y-(y?y.y:0)}}function R(o){if(o.preventDefault){o.preventDefault();o.stopPropagation()}else o.cancelBubble&&o.cancelBubble()}var fa=[],J=function(o,y,z){function d(G,Z,F,ka){k.trigger("pan",ka.x,ka.y)}z=COG.extend({binder:null,unbinder:null,observable:null},z);for(var k=
z.observable,m=[],v={bind:function(){return k.bind.apply(null,arguments)},pannable:function(G){COG.extend({inertia:true},G);k.bind("pointerMove",d);return v},unbind:function(){k.unbind();for(var G=0;G<m.length;G++)m[G].unbind();return v}},L=0;L<y.length;L++)m.push(y[L](o,k,z));return v};s("pointer",{handler:function(o,y,z){function d(p){if(E(p,o))if(ka=L(p)){o.style.cursor="move";R(p);ca=p.pageX?p.pageX:p.screenX;da=p.pageY?p.pageY:p.screenY;X=r(ca,da);na=x(o);y.trigger("pointerDown",X,W(X,na))}}
function k(p){ba=p.pageX?p.pageX:p.screenX;ea=p.pageY?p.pageY:p.screenY;ka&&E(p,o)&&G("pointerMove")}function m(p){if(ka&&L(p)){ka=false;if(E(p,o)){o.style.cursor="default";G("pointerUp")}}}function v(p){if(E(p,o)){var ha;p=p||window.event;if(p.detail)ha=p.axis===2?-p.detail*Z:0;else{ha=p.wheelDeltaY?p.wheelDeltaY:p.wheelDelta;if(window.opera)ha=-ha}if(ha!==0){var qa=r(ba,ea);y.trigger("zoom",qa,W(qa,x(o)),ha/F,"wheel");R(p);p.returnValue=false}}}function L(p){p=p||window.event;return(p.which||p.button)==
1}function G(p){var ha=r(ba,ea);y.trigger(p,ha,W(ha,na),r(ba-ca,ea-da));ca=ba;da=ea}z=COG.extend({inertia:false},z);var Z=120,F=Z*8,ka=false,X,na,ba,ea,ca,da;z.binder("mousedown",d,false);z.binder("mousemove",k,false);z.binder("mouseup",m,false);z.binder("click",function(p){if(E(p,o)){p=r(p.pageX?p.pageX:p.screenX,p.pageY?p.pageY:p.screenY);y.trigger("tap",p,W(p,x(o)))}},false);z.binder("dblclick",function(p){COG.info("captured double click");if(E(p,o)){p=r(p.pageX?p.pageX:p.screenX,p.pageY?p.pageY:
p.screenY);COG.info("captured double click + target matched");y.trigger("doubleTap",p,W(p,x(o)))}},false);z.binder("mousewheel",v,document);z.binder("DOMMouseScroll",v,document);return{unbind:function(){z.unbinder("mousedown",d,false);z.unbinder("mousemove",k,false);z.unbinder("mouseup",m,false);z.unbinder("mousewheel",v,document);z.unbinder("DOMMouseScroll",v,document)}}},checks:{touch:false}});s("pointer",{handler:function(o,y,z){function d(M){if(M.count<2)return 0;var N=M.x-M.next.x;M=M.y-M.next.y;
return~~Math.sqrt(N*N+M*M)}function k(M,N,Q){N=N?N:0;Q=Q?Q:0;for(var ra={x:M.x-N,y:M.y-Q,id:M.id,count:M.count},oa=ra;M.next;){M=M.next;oa=oa.next={x:M.x-N,y:M.y-Q,id:M.id}}return ra}function m(M,N){var Q=M[N?N:"touches"],ra,oa;if(Q.length===0)return null;oa=ra={x:Q[0].pageX,y:Q[0].pageY,id:Q[0].identifier,count:Q.length};for(var wa=1,Sa=Q.length;wa<Sa;wa++)oa=oa.next={x:Q[wa].pageX,y:Q[wa].pageY,id:Q[wa].identifier};return ra}function v(M){if(E(M,o)){ea=x(o);var N=m(M,"changedTouches"),Q=k(N,ea.x,
ea.y);if(!da){ca=X;y.trigger("pointerDown",N,Q)}Ea&&y.trigger("pointerDownMulti",N,Q);da=m(M);if(da.count>1)ha=d(da);xa=1;qa=k(da)}}function L(M){if(E(M,o)){M.preventDefault();p=m(M);if(ca==X)ca=Math.abs(da.x-p.x)>F||Math.abs(da.y-p.y)>F?ka:X;if(ca!=X){ca=p.count>1?ba:na;if(ca==ba)if(da.count===1){da=k(p);ha=d(da)}else{M=d(p);if(Math.abs(ha-M)<Z)ca=na;else{var N;N=p.x;var Q=p.next.x,ra=p.y,oa=p.next.y,wa=ra<oa?ra:oa;N={x:(N<Q?N:Q)+(Math.abs(N-Q)>>1),y:wa+(Math.abs(ra-oa)>>1)};M=M/ha;Q=M-xa;y.trigger("zoom",
N,W(N,ea),Q,"pinch");xa=M}}ca==na&&y.trigger("pointerMove",p,k(p,ea.x,ea.y),r(p.x-qa.x,p.y-qa.y));Ea&&y.trigger("pointerMoveMulti",p,k(p,ea.x,ea.y))}qa=k(p)}}function G(M){if(E(M,o)){var N=m(M,"changedTouches"),Q=k(N,ea.x,ea.y);p=m(M);if(!p){ca===X&&y.trigger("pointerTap",N,Q);y.trigger("pointerUp",N,Q);da=null}Ea&&y.trigger("pointerUpMulti",N,Q)}}z=COG.extend({detailed:false,inertia:false},z);var Z=20,F=7,ka=0,X=1,na=2,ba=3,ea,ca,da,p,ha,qa,Ea=z.detailed,xa=1;z.binder("touchstart",v,false);z.binder("touchmove",
L,false);z.binder("touchend",G,false);COG.info("initialized touch handler");return{unbind:function(){z.unbinder("touchstart",v,false);z.unbinder("touchmove",L,false);z.unbinder("touchend",G,false)}}},checks:{touch:true}});return{register:s,watch:function(o,y,z){y=COG.extend({bindToBody:false,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},y);capabilities=COG.extend({touch:"ontouchstart"in window},z);if(!y.observable){COG.info("creating observable");y.observable=COG.observable({});
globalOpts=y}y.binder=y.isIE?C:S(y.bindToBody);y.unbinder=y.isIE?A:$(y.bindToBody);z=y.types;for(var d=capabilities,k=[],m=fa.length;m--;){var v=fa[m],L=!z||z.indexOf(v.type)>=0,G=true;for(var Z in v.checks){var F=v.checks[Z];COG.info("checking "+Z+" capability. require: "+F+", capability = "+d[Z]);G=G&&F===d[Z]}if(L&&G)k[k.length]=v.handler}return new J(o,k,y)}}}();
T5=function(){function S(){return(new Date).getTime()}function $(){for(;p.length>0;){var b=p.shift();document.location=b}da=0}function C(b){for(var i=true,e=ha.length;e--;)i=i&&b!=ha[e];return i}function A(b,i){var e=[];for(var a in i)a&&e.push(a+"="+escape(i[a]));return"tile5://"+b+"/"+(e.length>0?"?"+e.join("&"):"")}function r(b,i){C(b)&&COG.info("would push url: "+A(b,i))}function s(b,i){if(C(b)){p.push(A(b,i));da||(da=setTimeout($,100))}}function x(b){return function(i,e,a){(a?a:b?document.body:
document).addEventListener(i,e,false)}}function E(b){return function(i,e,a){(a?a:b?document.body:document).removeEventListener(i,e,false)}}function W(b,i,e){(e?e:document).attachEvent("on"+b,i)}function R(b,i,e){(e?e:document).detachEvent("on"+b,i)}function fa(){ba={base:{name:"Unknown",bindEvent:x(),unbindEvent:E(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:r,targetFps:null},ie:{name:"MSIE",regex:/msie/i,
bindEvent:W,unbindEvent:R,requireFastDraw:false,targetFps:25},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:s,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:s},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:s},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:x(true),unbindEvent:E(true),supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},
bridgeNotify:s},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:s}};ea=[ba.froyo,ba.android,ba.ipod,ba.iphone,ba.ipad,ba.ie]}function J(){ba||fa();if(!ca){COG.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var b=0;b<ea.length;b++){var i=ea[b];if(i.regex&&i.regex.test(navigator.userAgent)){ca=COG.extend({},ba.base,i);COG.info("PLATFORM DETECTED AS: "+ca.name);break}}if(!ca){COG.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
ca=ba.base}COG.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return ca}function o(){for(var b=0,i=arguments.length;i--;){var e=M[arguments[i].toUpperCase()];if(e)b|=e}return b}var y=Math.abs,z=Math.min,d=Math.max,k=Math.pow,m=Math.sqrt,v=Math.log,L=Math.sin,G=Math.asin,Z=Math.cos,F=function(){function b(a,c){return e(a.x-c.x,a.y-c.y)}function i(a,c){if(!c)c=a.length;if(c<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var f={edges:Array(c-
1),accrued:Array(c-1),total:0},g=0;g<c-1;g++){var j=b(a[g],a[g+1]);f.edges[g]=m(j.x*j.x+j.y*j.y);f.accrued[g]=f.total+f.edges[g];f.total+=f.edges[g]}return f}function e(a,c){return{x:a?a:0,y:c?c:0}}return{VECTOR_SIMPLIFICATION:3,SIMPLIFICATION_MIN_VECTORS:25,add:function(){for(var a=0,c=0,f=arguments.length;f--;){a+=arguments[f].x;c+=arguments[f].y}return e(a,c)},absSize:function(a){return d(y(a.x),y(a.y))},copy:function(a){return a?e(a.x,a.y):null},diff:b,distance:function(a,c){return i(a,c).total},
edges:i,equals:function(a,c){return a.x===c.x&&a.y===c.y},extendBy:function(a,c,f){var g=Z(c)*f;c=L(c)*f;return e(a.x-g,a.y-c)},floor:function(a){for(var c=Array(a.length),f=a.length;f--;)c[f]=e(~~a[f].x,~~a[f].y);return c},getRect:function(a){for(var c,f,g,j,n=a.length;n--;){var h=a[n];c=typeof c==="undefined"||h.x<c?h.x:c;f=typeof f==="undefined"||h.y<f?h.y:f;g=typeof g==="undefined"||h.x>g?h.x:g;j=typeof j==="undefined"||h.y>j?h.y:j}return X.init(c,f,g,j)},init:e,invert:function(a){return e(-a.x,
-a.y)},min:function(a,c){return e(a.x<c.x?a.x:c.x,a.y<c.y?a.y:c.y)},max:function(a,c){return e(a.x>c.x?a.x:c.x,a.y>c.y?a.y:c.y)},offset:function(a,c,f){return e(a.x+c,a.y+(f?f:c))},simplify:function(a,c){if(!a)return null;c=c?c:F.VECTOR_SIMPLIFICATION;for(var f=[],g=null,j=a.length;j--;){var n=a[j];if(include=!g||j===0||y(n.x-g.x)+y(n.y-g.y)>c){f.unshift(n);g=n}}return f},theta:function(a,c,f){f=G((a.y-c.y)/f);return a.x>c.x?f:Math.PI-f}}}(),ka=function(){return{dotProduct:function(b,i){return b.x*
i.x+b.y*i.y}}}(),X=function(){function b(e){return i(e.x1,e.y1,e.x2,e.y2)}function i(e,a,c,f){e=e?e:0;a=a?a:0;c=typeof c!=="undefined"?c:e;f=typeof f!=="undefined "?f:f;return{x1:e,y1:a,x2:c,y2:f,width:c-e,height:f-a}}return{center:function(e){return F.init(e.x1+e.width/2,e.y1+e.height/2)},copy:b,diagonalSize:function(e){return m(e.width*e.width+e.height*e.height)},fromCenter:function(e,a,c,f){c=c>>1;f=f>>1;return i(e-c,a-f,e+c,a+f)},init:i,intersect:function(e,a){var c=d(e.x1,a.x1),f=d(e.y1,a.y1),
g=z(e.x2,a.x2),j=z(e.y2,a.y2);c=i(c,f,g,j);return c.width>0&&c.height>0?c:null},toString:function(e){return"["+e.x1+", "+e.y1+", "+e.x2+", "+e.y2+"]"},union:function(e,a){if(e.width===0||e.height===0)return b(a);else if(a.width===0||a.height===0)return b(e);else{var c=z(e.x1,a.x1),f=z(e.y1,a.y1),g=d(e.x2,a.x2),j=d(e.y2,a.y2);c=i(c,f,g,j);return c.width>0&&c.height>0?c:null}}}}(),na=function(){return{getAspectRatio:function(b){return b.height!==0?b.width/b.height:1},getCenter:function(b){return F.init(b.width>>
1,b.height>>1)},getSize:function(b){return m(k(b.width,2)+k(b.height,2))},init:function(b,i){b=b?b:0;return{width:b,height:i?i:b}}}}(),ba=null,ea=[],ca=null,da=0,p=[],ha=["view.wake","tile.loaded"],qa=function(){function b(){if(!B){var q=J().maxImageLoads;B=COG.Loopage.join({execute:function(D,P){if(!q||h.length<q){var H=n.shift();if(H){h[h.length]=H;H.image.onload=e;H.image.src=H.url;H.requested=T5.ticks()}else P.trigger("complete")}},frequency:10});B.bind("complete",function(){B=null})}}function i(){K=
true;try{var q=l.length>>1;if(q>0){l.sort(function(P,H){return P.created-H.created});for(var D=q;D--;)delete f[l[D].url];l.splice(0,q)}}finally{K=false}O.trigger("cacheCleared")}function e(){var q=g[this.id],D;if(q&&q.image.complete&&q.image.width>0){q.loaded=true;q.hitCount=1;for(D=h.length;D--;)if(h[D].image.src==this.src){h.splice(D,1);break}if(q.background||q.postProcess||q.drawBackground||q.customDraw)if(q.image){globalImageData=q;D=c(q.realSize?q.realSize.width:q.image.width,q.realSize?q.realSize.height:
q.image.height);var P=D.getContext("2d"),H=q.offset?q.offset:T5.XY.init();q.background&&P.drawImage(q.background,0,0);q.drawBackground&&q.drawBackground(P);q.customDraw?q.customDraw(P,q):P.drawImage(q.image,H.x,H.y);q.postProcess&&q.postProcess(P,q);q.image=D}for(D=q.callbacks.length;D--;)q.callbacks[D]&&q.callbacks[D](this,false);q.callbacks=[];l[l.length]={url:this.src,created:q.requested};delete g[this.id];b()}}function a(q,D,P){var H=f[q];if(H){H.hitCount++;H.image.complete&&H.image.width>0&&
D?D(H.image,true):H.callbacks.push(D)}else{H=COG.extend({url:q,image:new Image,loaded:false,created:T5.ticks(),requested:null,hitCount:0,callbacks:[D]},P);H.image.id="resourceLoaderImage"+j++;f[q]=H;g[H.image.id]=H;n[n.length]=H;b()}return H}function c(q,D){var P=document.createElement("canvas");COG.info("creating new canvas");P.width=q?q:0;P.height=D?D:0;if(typeof FlashCanvas!="undefined"){document.body.appendChild(P);FlashCanvas.initElement(P)}return P}var f={},g={},j=0,n=[],h=[],l=[],t=0,B=null,
K=false,O={avgImageSize:25,loadTimeout:10,cancelLoad:function(){h=[]},get:function(q,D,P){var H=null,pa=null;K||(H=f[q]);if((pa=H?H.image:null)&&(pa.getContext||pa.complete&&pa.width>0))return pa;else D&&a(q,D,P);return null},load:a,newCanvas:c,reset:function(){f={}},stats:function(){return{imageLoadingCount:h.length,queuedImageCount:n.length,imageCacheFullness:t}}};COG.observable(O);COG.Loopage.join({execute:function(q){for(var D=false,P=0,H=J();P<h.length;)if(q-h[P].requested>O.loadTimeout*1E3){h.splice(P,
1);D=true}else P++;D&&b();if(H&&H.imageCacheMaxSize){t=l.length*O.avgImageSize/H.imageCacheMaxSize;t>=1&&i()}},frequency:2E4});return O}(),Ea=function(){var b={};return{init:function(i,e){var a=b[i];if(!a)throw Error("Unable to locate requested generator: "+i);return new a(e)},register:function(i,e){b[i]=e},Template:function(){}}}(),xa=function(){function b(g,j){c[g]=e(j);return g}function i(g){for(var j in g)b(j,g[j])}function e(g){function j(t){var B=g[t];typeof B!=="undefined"&&h.push(function(K){K[t]=
B})}function n(){h=[];for(var t in g)j(t)}g=COG.extend({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},g);var h=[],l={applyToContext:function(t){for(var B=h.length;B--;)h[B](t)},update:function(t,B){g[t]=B;n()}};n();return l}var a={},c={},f={apply:function(g,j){var n=c[j]?c[j]:c.basic,h;if(g&&g.canvas){h=a[g.canvas.id];a[g.canvas.id]=j}n.applyToContext(g);return h},define:b,
defineMany:i,get:function(g){return c[g]},init:e,load:function(g){COG.jsonp(g,function(j){i(j)})}};i({basic:{lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"},waypoints:{lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"}});return f}(),M={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,ZOOM:16,FREEZE:128},N=function(b){b=COG.extend({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:o("ACTIVE","ANIMATING","PAN","ZOOM"),style:null,minXY:null,maxXY:null},b);var i=null,e=false,a=false,c=
b.supportFastDraw,f=b.id,g=o("ACTIVE"),j=b.validStates,n=0,h=0,l=COG.extend({addToView:function(t){t.setLayer(f,l)},shouldDraw:function(t,B,K){return(a||K||n!==B.x1||h!==B.y1)&&(t&j)!==0&&(e?c:true)},clip:null,cycle:function(){},draw:function(){},remove:function(){l.trigger("remove",l)},changed:function(t){a=true;l.trigger("changed",l);i&&i.trigger("invalidate",t)},getId:function(){return f},setId:function(t){f=t},getParent:function(){return i},setParent:function(t){e=(i=t)?i.fastDraw&&displayState!==
g:false;l.trigger("parentChange",i)}},b);COG.observable(l);l.bind("drawComplete",function(t,B){a=false;n=B.x1;h=B.y1});l.bind("resync",function(t,B){if(B.syncXY){l.minXY&&B.syncXY(l.minXY);l.maxXY&&B.syncXY(l.maxXY)}});return l},Q=function(b){function i(n,h,l,t){a=n;c=h;f=l;g=t}b=COG.extend({xy:F.init(),offset:true,tweenIn:null,animationSpeed:null,isNew:true},b);var e=false,a=0,c=0,f=0,g=0,j=COG.extend(b,{isAnimating:function(){return e},draw:function(n,h,l,t,B){if(j.isNew&&b.tweenIn){var K=j.xy.y;
j.xy.y=h.y1-20;e=true;COG.tween(j.xy,"y",K,b.tweenIn,function(){j.xy.y=K>>0;e=false},b.animationSpeed?b.animationSpeed:250+Math.random()*500)}j.drawMarker(n,h,j.xy.x,j.xy.y,l,t,B);j.isNew=false},drawMarker:function(n,h,l,t){n.beginPath();n.arc(l,t,4,0,Math.PI*2,false);n.fill();i(l-4,t-4,8,8)},hitTest:function(n,h){return n>=a&&n<=a+f&&h>=c&&h<=c+g},updateBounds:i});COG.observable(j);return j},ra=function(b){function i(){c.changed();c.trigger("markerUpdate",a)}function e(){var f=c.getParent();if(f&&
f.syncXY)for(var g=a.length;g--;)f.syncXY([a[g].xy])}b=COG.extend({zindex:100,style:"basic"},b);var a=[],c=COG.extend(new N(b),{draw:function(f,g,j,n){for(var h=a.length;h--;)a[h].draw(f,g,j,c,n)},add:function(f){if(f&&typeof f.length!=="undefined")for(var g=f.length;g--;){if(f[g])a[a.length]=f[g]}else if(f)a[a.length]=f;i()},clear:function(f){if(f)for(var g=0;g<a.length;)if(f(a[g]))a.splice(g,1);else g+=1;else a=[];i()},each:function(f){if(f)for(var g=a.length;g--;)f(a[g])},find:function(f){for(var g=
[],j=a.length;j--;)if(!f||f(a[j]))g[g.length]=a[j];return g}});c.bind("tap",function(f,g,j,n){var h=[],l=n.x;n=n.y;for(var t=a.length;t--;)if(a[t].hitTest(l,n))h[h.length]=a[t];if(h.length>0)f.cancel=c.trigger("markerTap",g,j,h).cancel});c.bind("parentChange",e);c.bind("resync",e);c.bind("changed",e);return c},oa=function(b){function i(j,n,h){j.fillStyle="#FFFFFF";j.strokeStyle="#222222";j.beginPath();j.arc(h.x,h.y,4,0,Math.PI*2,false);j.stroke();j.fill()}b=COG.extend({path:[],id:COG.objId("pathAni"),
easing:COG.easing("sine.inout"),validStates:o("ACTIVE","PAN","ZOOM"),drawIndicator:null,duration:2E3},b);var e=F.edges(b.path),a,c=null,f=0;COG.tweenValue(0,e.total,b.easing,function(){g.remove()},b.duration).requestUpdates(function(j,n){f=j;n&&g.remove()});var g=COG.extend(new N(b),{cycle:function(){for(var j=0;j<e.accrued.length&&e.accrued[j]<f;)j++;c=null;if(j<b.path.length-1){var n=f-(j>0?e.accrued[j-1]:0),h=b.path[j];a=F.theta(h,b.path[j+1],e.edges[j]);c=F.extendBy(h,a,n)}return c},draw:function(j,
n){if(c)(b.drawIndicator?b.drawIndicator:i)(j,n,F.init(c.x,c.y),a)}});return g},wa=function(b){b=COG.extend({style:null,properties:{}},b);return COG.extend(b,{rect:null,draw:function(){},resync:function(){}})},Sa=function(){return{tileSize:256,init:function(b,i,e,a,c){return COG.extend({x:b,y:i,width:e,height:a},c)}}}(),Ta={ex:COG.extend,ticks:S,getConfig:J,userMessage:function(b,i,e){Ta.trigger("userMessage",b,i,e)},zoomable:function(b,i){function e(c,f){if(c&&a!==c){var g=b.triggerAll("zoomLevelChange",
c,f);if(g)a=c;return g}}i=COG.extend({initial:1,min:0,max:null},i);var a=i.initial;COG.extend(b,{getZoomLevel:function(){return a},setZoomLevel:e});b.bind("scale",function(c,f,g){var j=Math.log(f)/Math.LN2;COG.endTweens(function(n){return n.cancelOnInteract});c.cancel=!e(a+j,g);c.cancel||b.updateOffset(g.x*f,g.y*f)})},XY:F,XYRect:X,Dimensions:na,Vector:ka,D:na,Images:qa,Generator:Ea,tween:COG.tween,tweenValue:COG.tweenValue,easing:COG.easing,Tween:COG.Tween,Style:xa,viewState:o,View:function(b){function i(w,
u,I,T){za=Na;D();if(T&&b.inertia)h(la-u,ma-I,b.panAnimationEasing,b.panAnimationDuration);else T||h(la-u,ma-I);clearTimeout(ab);ab=setTimeout(e,100)}function e(){za=Ua;Fa=false;D()}function a(w,u,I,T){pa(d(aa+k(2,T)-1,0.25))}function c(w){var u=v(aa)/Math.LN2>>0;if(aa!==1)za=bb;if(u!==0){aa=k(2,u);u=F.init(Oa-(Ga/aa>>0),Pa-(Ha/aa>>0));if(!ia.trigger("scale",aa,u).cancel){for(w=U.length;w--;)U[w].trigger("scale",aa,u);aa=1;hb=null;za=Ua;w=true}}D(w)}function f(w){w||(w=F.init(Ga,Ha));Va=F.init(la,
ma);Ma=F.offset(w,la,ma);Oa=Ma.x;Pa=Ma.y}function g(w,u,I){Aa("doubleTap",u,I,F.offset(I,la,ma));if(b.scalable){COG.endTweens(function(T){return T.cancelOnInteract});pa(2,I,b.zoomAnimation,null,b.zoomDuration)}}function j(){clearTimeout(cb);cb=setTimeout(l,250)}function n(w,u,I){Aa("tap",u,I,F.offset(I,la,ma))}function h(w,u,I,T,V){function ga(){va+=1;if(va>=2){e();V&&V()}}var va=0,ya=Ia?F.offset(Ia,-Ga,-Ha):null,Ca=Ja?F.offset(Ja,-Ga,-Ha):null;if(ya){w=w<ya.x?ya.x:w;u=u<ya.y?ya.y:u}if(Ca){w=w>Ca.x?
Ca.x:w;u=u>Ca.y?Ca.y:u}if(I){if(!Fa){w=COG.tweenValue(la,w,I,ga,T);u=COG.tweenValue(ma,u,I,ga,T);w.cancelOnInteract=true;w.requestUpdates(function(Ka){la=Ka>>0;Fa=true;D()});u.cancelOnInteract=true;u.requestUpdates(function(Ka){ma=Ka>>0;Fa=true;D()})}}else{la=w|0;ma=u|0;COG.info("offset updated: x = "+la+", y = "+ma)}}function l(w,u){var I;if(ja){Ba&&Ba.unbind();if(b.autoSize&&ja.parentNode){w=ja.parentNode.offsetWidth;u=ja.parentNode.offsetHeight}try{if(!ja.id)ja.id=b.id+"_canvas";Y=ja.getContext("2d")}catch(T){COG.exception(T);
throw Error("Could not initialise canvas on specified view element");}if(w&&u&&(sa!==u||ta!==w)){Wa=true;ta=w;sa=u;Ga=ta>>1;Ha=sa>>1;ia.trigger("resize",ta,sa);for(I=ua;I--;)U[I].trigger("resize",ta,sa)}if(b.interactive){Ba=INTERACT.watch(ja).pannable();B()}for(I=ua;I--;)U[I].trigger("contextChanged",Y);D(true)}}function t(w,u){u.setId(w);u.added=S();u.bind("remove",function(){ia.removeLayer(w)});u.trigger("contextChanged",Y);u.setParent(ia);U.push(u);U.sort(function(I,T){var V=T.zindex-I.zindex;
if(V===0)V=T.added-I.added;return V});ua=U.length;return u}function B(){if(Ba){if(b.pannable){Ba.bind("pan",i);Ba.bind("inertiaCancel",function(){Fa=false;D()})}if(b.scalable){Ba.bind("zoom",a);Ba.bind("doubleTap",g)}Ba.bind("tap",n)}}function K(){H();Xa=true;La=0}function O(w,u,I,T){var V;X.center(u);var ga=0;Da=X.copy(u);Da.scaleFactor=aa;I&&Y.clearRect(0,0,ta,sa);Y.save();try{Y.globalCompositeOperation="source-over";if(aa!==1){var va=Da,ya=1/aa;Oa=Ma.x+(la-Va.x);Pa=Ma.y+(ma-Va.y);Da=va?X.fromCenter(Oa>>
0,Pa>>0,va.width*ya>>0,va.height*ya>>0):void 0;Y.scale(aa,aa)}Y.translate(-Da.x1,-Da.y1);Ja=Ia=null;if(ib){Y.beginPath();clipped=false;for(ga=ua;ga--;)if(U[ga].clip){U[ga].clip(Y,Da,w,ia,I,T);clipped=true}Y.closePath();clipped&&Y.clip()}for(ga=ua;ga--;){V=U[ga];var Ca=V.style,Ka=Ca?xa.apply(Y,Ca):null;if(V.minXY)Ia=Ia?F.min(Ia,V.minXY):F.copy(V.minXY);if(V.maxXY)Ja=Ja?F.max(Ja,V.maxXY):F.copy(V.maxXY);V.draw(Y,Da,w,ia,I,T);Ka&&xa.apply(Y,Ka)}}finally{Y.restore()}if(jb){Y.globalCompositeOperation=
"source-over";Y.strokeStyle="#f00";Y.beginPath();Y.moveTo(Ga,0);Y.lineTo(Ga,sa);Y.moveTo(0,Ha);Y.lineTo(ta,Ha);Y.stroke()}Aa("drawComplete",u,T);COG.trace("draw complete",T)}function q(w,u){var I=false,T=Ya?Ya:Fa?Na:za,V=!Fa&&(T===bb||T===Na),ga=Za||T===Na||COG.getTweens().length>0;if(Wa&&ja){typeof FlashCanvas!="undefined"&&FlashCanvas.initElement(ja);ja.width=ta;ja.height=sa;ja.style.width=ta+"px";ja.style.height=sa+"px";Wa=false}Qa=P();if(V){COG.endTweens(function(va){return va.cancelOnInteract});
Xa=false;if(La!==0){clearTimeout(La);La=0}}for(V=ua;V--;){if(U[V].animated)za|=db;U[V].cycle(w,Qa,za,ga);I=U[V].shouldDraw(za,Qa,ga)||I}ga=ga||(za&db)!==0;if(I=I||ga||aa!==1&&aa!==eb){O(T,Qa,ga,w);eb=aa;Za=false}if(!I&&$a===0&&!kb){if(!Xa&&La===0)La=setTimeout(K,lb);u.trigger("complete")}w-fb>mb&&H();$a=0;COG.trace("Completed draw cycle",w)}function D(w){Za=w?true:false;$a+=1;if(!Ra){Ra=COG.Loopage.join({execute:q,frequency:nb});Ra.bind("complete",function(){Ra=null})}}function P(){return X.init(la,
ma,la+ta,ma+sa)}function H(){fb=(new Date).getTime();Aa("refresh",ia);D()}function pa(w,u,I,T,V){function ga(){aa=Math.pow(2,Math.round(Math.log(aa)/Math.LN2));T&&T();c(true)}var va=aa;f(u);if(I)COG.tweenValue(0,w-va,I,ga,V).requestUpdates(function(ya){aa=va+ya;c()});else{aa=w;c()}return ia}function Aa(){for(var w=ia.trigger.apply(null,arguments).cancel,u=U.length;u--;)w=U[u].trigger.apply(null,arguments).cancel||w;return!w}b=COG.extend({id:COG.objId("view"),container:"",fastDraw:false,inertia:true,
idleDelay:100,minRefresh:1E3,pannable:true,clipping:false,scalable:true,interactive:true,panAnimationEasing:COG.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:true,tapExtent:10,mask:true,guides:false,fps:25,zoomAnimation:COG.easing("quad.out"),zoomDuration:300},b);var U=[],ua=0,ja=document.getElementById(b.container),Y=null,ob=typeof window.attachEvent!="undefined",lb=b.idleDelay,mb=b.minRefresh,la=0,ma=0,ib=b.clipping,Qa=null,Ra=null,Da,jb=
b.guides,gb=1,$a=0,Ga=0,Ha=0,Va=null,Ma=null,Xa=false,Fa=false,La=0,ab=0,Ia=null,Ja=null,fb=0,pb=0,Ya=null,Za=false,cb=0,hb=null,aa=1,eb=0,Wa=false,Ba=null,sa,ta,kb=typeof FlashCanvas!=="undefined",nb=~~(1E3/b.fps),Oa,Pa,Ua=o("ACTIVE"),Na=o("PAN"),bb=o("ZOOM"),db=o("ANIMATING"),za=Ua,ia={id:b.id,deviceScaling:gb,fastDraw:b.fastDraw||J().requireFastDraw,getDimensions:function(){return na.init(ta,sa)},getLayer:function(w){for(var u=0;u<ua;u++)if(U[u].getId()==w)return U[u];return null},setLayer:function(w,
u){for(var I=0;I<ua;I++)if(U[I].getId()===w){U.splice(I,1);break}u&&t(w,u);D();return u},eachLayer:function(w){for(var u=ua;u--;)w(U[u])},invalidate:D,resize:function(w,u){if(ja){b.autoSize=false;if(ta!==w||sa!==u)l(w,u)}},refresh:H,scale:pa,triggerAll:Aa,removeLayer:function(w){a:{for(var u=ua;u--;)if(U[u].getId()==w){w=u;break a}w=-1}if(w>=0&&w<ua){ia.trigger("layerRemoved",U[w]);U.splice(w,1);D()}ua=U.length},stateOverride:function(w){Ya=w},getOffset:function(){return F.init(la,ma)},getViewRect:P,
updateOffset:h,pan:function(w,u,I,T,V){h(la+w,ma+u,I,T,V)}};gb=J().getScaling();ia.markers=t("markers",new ra);COG.observable(ia);ia.bind("invalidate",function(w,u){D(u)});ia.bind("resync",function(){Ja=Ia=null});COG.configurable(ia,["inertia","container","rotation","tapExtent","scalable","pannable"],COG.paramTweaker(b,null,{container:function(w,u){ja=document.getElementById(u);l()},rotation:function(w,u){pb=u}}),true);l();if(b.autoSize)ob?window.attachEvent("onresize",j):window.addEventListener("resize",
j,false);return ia},ViewLayer:N,ImageLayer:function(b,i){function e(h,l,t){for(l=f.length;l--;){var B=f[l],K=B.x,O=B.y,q=X.init(B.x,B.y,B.x+B.width,B.y+B.height);if(t&&X.intersect(h,q)){q=qa.get(B.url,function(){n.changed()},j);t(q,K,O,B.width,B.height)}}}function a(h){c&&c.run(h,function(l){f=[].concat(l);n.changed()})}i=COG.extend({imageLoadArgs:{}},i);var c=b?Ea.init(b,i):null,f=[],g=X.init(),j=i.imageLoadArgs,n=COG.extend(new N(i),{changeGenerator:function(h,l){c=Ea.init(h,COG.extend({},i,l));
c.bindToView(n.getParent());f=null;a(g)},clip:function(h,l,t){e(l,t,function(B,K,O,q,D){B&&h.rect(K,O,q,D)})},cycle:function(h,l){a(l)},draw:function(h,l,t){e(l,t,function(B,K,O,q,D){n.drawImage(h,B,K,O,q,D,l,t)});g=X.copy(l)},drawImage:function(h,l,t,B){l&&h.drawImage(l,t,B,l.width,l.height)}});n.bind("idle",function(){a(g)});n.bind("parentChange",function(h,l){c&&c.bindToView(l)});n.bind("tap",function(h,l,t,B){h=[];var K=B.x,O=B.y,q,D;if(f)for(var P=f.length;P--;){q=f[P];if(D=K>=q.x&&K<=q.x+q.width&&
O>=q.y&&O<=q.y+q.height)h[h.length]=q}h.length>0&&n.trigger("tapImage",h,l,t,B)});return n},Marker:Q,ImageMarker:function(b){b=COG.extend({image:null,imageUrl:null,animatingImage:null,animatingImageUrl:null,imageAnchor:null,rotation:0,scale:1,opacity:1},b);var i=b.imageAnchor?T5.XY.invert(b.imageAnchor):null,e=COG.extend(new Q(b),{drawMarker:function(a,c,f,g){if((c=e.isAnimating()&&e.animatingImage?e.animatingImage:e.image)&&c.width>0){i||(i=F.init(-c.width>>1,-c.height>>1));var j=e.scale,n=f+~~(i.x*
j),h=g+~~(i.y*j),l=~~(c.width*j),t=~~(c.height*j);e.updateBounds(n,h,l,l);if(e.rotation||e.opacity!==1){a.save();try{a.globalAlpha=e.opacity;a.translate(f,g);a.rotate(e.rotation);a.drawImage(c,i.x*j,i.y*j,l,t)}finally{a.restore()}}else a.drawImage(c,n,h,l,t)}}});if(!e.image)e.image=qa.get(b.imageUrl,function(a){e.image=a});if(!e.animatingImage)e.animatingImage=qa.get(b.animatingImageUrl,function(a){e.animatingImage=a});return e},MarkerLayer:ra,PathLayer:function(b){b=COG.extend({style:"waypoints",
pixelGeneralization:8,zindex:50},b);var i=false,e=[],a=null,c=[],f=null,g=0,j=[],n=COG.extend(new N(b),{getAnimation:function(h,l,t,B){var K="pathAnimation"+g++;j.push(K);return new oa({id:K,path:e,zindex:b.zindex+1,easing:h?h:COG.easing("sine.inout"),duration:l?l:5E3,drawIndicator:t,autoCenter:B?B:false})},cycle:function(h,l,t,B){return B},draw:function(h){var l,t=e.length;h.save();try{xa.apply(h,b.style);if(t>0){h.beginPath();h.moveTo(e[t-1].x,e[t-1].y);for(l=t;l--;)h.lineTo(e[l].x,e[l].y);h.stroke();
if(a){h.fillStyle=b.waypointFillStyle;for(l=a.length;l--;){h.beginPath();h.arc(a[l].x,a[l].y,2,0,Math.PI*2,false);h.stroke();h.fill()}}}}finally{h.restore()}i=false},updateCoordinates:function(h,l){c=h;f=l;var t=n.getParent();if(t&&t.syncXY){t.syncXY(c);f&&t.syncXY(f);n.trigger("tidy")}}});n.bind("tidy",function(){e=F.simplify(c,b.pixelGeneralization);a=F.simplify(f,b.pixelGeneralization);i=true;n.changed()});return n},AnimatedPathLayer:oa,Shape:wa,Arc:function(b,i){i=COG.extend({size:4},i);var e=
F.init(),a=COG.extend(i,{draw:function(c){c.beginPath();c.arc(e.x,e.y,a.size,0,Math.PI*2,false);c.fill();c.stroke()},resync:function(c){c.syncXY([b]);e=F.floor([b])[0]}});COG.info("created arc = ",b);return a},Poly:function(b,i){i=COG.extend({fill:false,simplify:false},i);var e=false,a=i.fill,c=i.simplify,f=o("ZOOM"),g=[],j=COG.extend(new wa(i),{draw:function(n,h,l,t,B,K){if(e){h=true;l=(K&f)!==0;n.beginPath();for(K=g.length;K--;){l=g[K].x;t=g[K].y;if(h){n.moveTo(l,t);h=false}else n.lineTo(l,t);l=
true}if(l){a&&n.fill();n.stroke()}}},resync:function(n){j.xy=n.syncXY(b);g=F.floor(c?F.simplify(b):b)}});e=b&&b.length>=2;return j},ShapeLayer:function(b){function i(f){for(var g=a.length;g--;)a[g].resync(f);a.sort(function(j,n){var h=n.xy.y-j.xy.y;if(h===0)h=n.xy.x-j.xy.y;return h});c.changed()}function e(f,g){g.syncXY&&i(g)}b=COG.extend({zindex:80},b);var a=[],c=COG.extend(new N(b),{add:function(f){a[a.length]=f},each:function(f){for(var g=a.length;g--;)f(a[g])},draw:function(f,g,j){var n=g.x1,
h=g.y1,l=g.width;g=g.height;for(var t=a.length;t--;){var B=a[t].style;B=B?xa.apply(f,B):null;a[t].draw(f,n,h,l,g,j);B&&xa.apply(f,B)}}});c.bind("parentChange",e);c.bind("resync",e);return c},Tiling:Sa,TileGenerator:function(b){function i(O,q,D,P){function H(){if(K.initTileCreator){j=true;K.initTileCreator(O,q,D,P)}}K.prepTileCreator?K.prepTileCreator(O,q,D,H):H()}function e(O,q){for(var D=~~((O.x1-f.x)/n),P=~~((O.y1-f.y)/h),H=[],pa=-g;pa<t;pa++)for(var Aa=-g;Aa<B;Aa++){var U=l(D+pa,P+Aa);if(U)H[H.length]=
U}q&&q(H);c=X.copy(O)}b=COG.extend({tileWidth:256,tileHeight:256,relative:false,padding:2},b);var a=null,c=null,f=F.init(),g=b.padding,j=false,n=b.tileWidth,h=b.tileHeight,l=null,t=0,B=0,K={bindToView:function(O){COG.info("initializing generator");a=O;K.trigger("bindView",O)},getTileCreatorArgs:null,initTileCreator:null,prepTileCreator:null,requireRefresh:function(){return false},reset:function(){l=null;j=false;c=null},run:function(O,q){if(!c||Math.abs(O.x1-c.x1)>n||Math.abs(O.y1-c.y1)>h){if(!l&&
!j||K.requireRefresh()){f=b.relative?F.init(O.x1,O.y1):F.init();t=Math.ceil(O.width/n)+g;B=Math.ceil(O.height/h)+g;i(n,h,K.getTileCreatorArgs?K.getTileCreatorArgs(a):{},function(D){l=D;j=false;e(O,q)})}l&&e(O,q)}}};COG.observable(K);K.bind("update",function(){COG.info("captured generator update");c=null});return K}};COG.observable(Ta);return Ta}();
