COG=function(){var f=/\$\{(.*?)\}/ig,m=Object.prototype.hasOwnProperty,h=0,e={id:"grunt.core",extend:function(){var b=arguments[0]||{},c=1,d=arguments.length,a=false,j,g,k,i;if(typeof b==="boolean"){a=b;b=arguments[1]||{};c=2}if(typeof b!=="object"&&!e.isFunction(b))b={};if(d===c){b=this;--c}for(;c<d;c++)if((j=arguments[c])!=null)for(g in j){k=b[g];i=j[g];if(b!==i)if(a&&i&&(e.isPlainObject(i)||e.isArray(i))){k=k&&(e.isPlainObject(k)||e.isArray(k))?k:e.isArray(i)?[]:{};b[g]=e.extend(a,k,i)}else if(i!==
undefined)b[g]=i}return b},isFunction:function(b){return toString.call(b)==="[object Function]"},isArray:function(b){return toString.call(b)==="[object Array]"},isPlainObject:function(b){if(!b||toString.call(b)!=="[object Object]"||b.nodeType||b.setInterval)return false;if(b.constructor&&!m.call(b,"constructor")&&!m.call(b.constructor.prototype,"isPrototypeOf"))return false;var c;for(c in b);return c===undefined||m.call(b,c)},isEmptyObject:function(b){for(var c in b)return false;return true},isXmlDocument:function(b){return toString.call(b)===
"[object Document]"},contains:function(b,c){var d=b,a=arguments,j=1;if(c&&e.isArray(c)){a=c;j=0}for(j=j;j<a;j++)d=d&&typeof foo[a[j]]!=="undefined";return d},newModule:function(b){b=e.extend({id:null,requires:[],parent:null},b);if(b.parent)b=e.extend({},b.parent,b);return b},toID:function(b){return b.replace(/\s/g,"-")},objId:function(b){return(b?b:"obj")+h++},formatStr:function(b){if(arguments.length<=1)return b;for(var c=arguments.length-2,d=0;d<=c;d++)b=b.replace(RegExp("\\{"+d+"\\}","gi"),arguments[d+
1]);return b},wordExists:function(b,c){var d="";if(c.toString)c=c.toString();for(var a=0;a<c.length;a++)d+=!/\w/.test(c[a])?"\\"+c[a]:c[a];return RegExp("(^|\\s|\\,)"+d+"(\\,|\\s|$)","i").test(b)},parseTemplate:function(b,c){for(var d=f.exec(b);d;){b=b.replace(d[0],COG.XPath.first(d[1],c));f.lastIndex=0;d=f.exec(b)}return b}};return e}();
COG.Log=function(){function f(c,d){var a,j=d&&d.length>0?d[0]:"";for(a=1;d&&a<d.length;a++)j+=" "+(h&&COG.isPlainObject(d[a])?JSON.stringify(d[a]):d[a]);typeof console!=="undefined"&&console[c](j);for(a=0;a<m.length;a++)m[a].call(b,j,c)}var m=[],h=typeof JSON!=="undefined",e=window.console&&window.console.markTimeline,b={id:"grunt.log",getTraceTicks:function(){return e?(new Date).getTime():null},trace:function(c,d){if(e)console.markTimeline(c+(d?": "+(b.getTraceTicks()-d)+"ms":""))},debug:function(){f("debug",
arguments)},info:function(){f("info",arguments)},warn:function(){f("warn",arguments)},error:function(){f("error",arguments)},exception:function(c){b.error(arguments);for(var d in c)b.info("ERROR DETAIL: "+d+": "+c[d])},watch:function(c,d){try{d()}catch(a){b.exception(a,c)}},throwError:function(c){b.error(c);throw Error(c);},requestUpdates:function(c){m.push(c)}};return b}();
(function(){function f(e,b){e[b]||(e[b]=function(c){return e.configure(b,c)})}function m(e){e.gtConfId=COG.objId("configurable");e.gtConfig={};e.gtConfigFns=[];return e.gtConfig}var h={};COG.paramTweaker=function(e,b,c){return function(d,a){if(typeof a!=="undefined"){if(d in e)e[d]=a;c&&d in c&&c[d](d,a)}else return b&&d in b?b[d](d):e[d]}};COG.configurable=function(e,b,c,d){if(e){e.gtConfId||m(e);var a=e.gtConfId,j=e.gtConfig,g=e.gtConfigFns;h[a]=e;g.push(c);for(c=b.length;c--;){j[b[c]]=true;d&&
f(e,b[c])}if(!e.configure)e.configure=function(k,i){if(j[k]){for(var l=g.length;l--;){var q=g[l](k,i);if(typeof q!=="undefined")return q}return h[a]}return null}}}})();
(function(){function f(m,h){var e=m.gtObsHandlers;e[h]||(e[h]=[]);return e[h]}COG.observable=function(m){if(m){if(!m.gtObsHandlers)m.gtObsHandlers={};if(!(m.bind||m.trigger||m.unbind)){m.bind=function(h,e){var b=COG.objId("callback");f(m,h).unshift({fn:e,id:b});return b};m.trigger=function(h){var e=f(m,h),b={cancel:false,tickCount:(new Date).getTime()},c;if(!e)return null;c=Array.prototype.slice.call(arguments,1);c.unshift(b);for(var d=e.length;d--&&!b.cancel;)e[d].fn.apply(self,c);return b};m.unbind=
function(h,e){for(var b=f(m,h),c=0;b&&c<b.length;c++)if(b[c].id===e){b.splice(c,1);break}return m}}}}})();(function(){var f={},m=[];COG.addPipe=function(h){h("pipe.test",{});m.push(h)};COG.listen=function(h,e){f[h]||(f[h]=[]);e&&f[h].push(e)};COG.say=function(h,e){var b;for(b=m.length;b--;)m[b](h,e);if(f[h])for(b=f[h].length;b--;)f[h][b](e)}})();
COG.Loopage=function(){function f(i){return COG.extend({id:c++,frequency:0,after:0,single:false,lastTick:0,execute:function(){}},i)}function m(i){a.push(i);h()}function h(){j&&clearTimeout(j);j=setTimeout(e,0);k=true}function e(){for(var i,l=(new Date).getTime(),q=d.length;a.length>0;){var y=a.shift();for(i=q;i--;)if(d[i].id===y){d.splice(i,1);break}k=true;q=d.length}if(k){g=b;for(i=q;i--;)g=d[i].frequency<g?d[i].frequency:g}for(i=q;i--;){y=l-d[i].lastTick;if(d[i].lastTick===0||y>=d[i].frequency){d[i].execute(l,
d[i]);d[i].lastTick=l;d[i].single&&d[i].trigger("complete")}}j=q?setTimeout(e,g):0}var b=6E4,c=0,d=[],a=[],j=0,g=b,k=true;return{join:function(i){var l=new f(i);if(l.after>0)l.lastTick=(new Date).getTime()+l.after;COG.observable(l);l.bind("complete",function(){m(l.id)});d.unshift(l);h();return l},leave:m}}();if(!this.JSON)this.JSON={};
(function(){function f(g){return g<10?"0"+g:g}function m(g){b.lastIndex=0;return b.test(g)?'"'+g.replace(b,function(k){var i=a[k];return typeof i==="string"?i:"\\u"+("0000"+k.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+g+'"'}function h(g,k){var i,l,q,y,z=c,o,p=k[g];if(p&&typeof p==="object"&&typeof p.toJSON==="function")p=p.toJSON(g);if(typeof j==="function")p=j.call(k,g,p);switch(typeof p){case "string":return m(p);case "number":return isFinite(p)?String(p):"null";case "boolean":case "null":return String(p);
case "object":if(!p)return"null";c+=d;o=[];if(Object.prototype.toString.apply(p)==="[object Array]"){y=p.length;for(i=0;i<y;i+=1)o[i]=h(i,p)||"null";q=o.length===0?"[]":c?"[\n"+c+o.join(",\n"+c)+"\n"+z+"]":"["+o.join(",")+"]";c=z;return q}if(j&&typeof j==="object"){y=j.length;for(i=0;i<y;i+=1){l=j[i];if(typeof l==="string")if(q=h(l,p))o.push(m(l)+(c?": ":":")+q)}}else for(l in p)if(Object.hasOwnProperty.call(p,l))if(q=h(l,p))o.push(m(l)+(c?": ":":")+q);q=o.length===0?"{}":c?"{\n"+c+o.join(",\n"+c)+
"\n"+z+"}":"{"+o.join(",")+"}";c=z;return q}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
b=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,c,d,a={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},j;if(typeof JSON.stringify!=="function")JSON.stringify=function(g,k,i){var l;d=c="";if(typeof i==="number")for(l=0;l<i;l+=1)d+=" ";else if(typeof i==="string")d=i;if((j=k)&&typeof k!=="function"&&(typeof k!=="object"||typeof k.length!=="number"))throw Error("JSON.stringify");return h("",
{"":g})};if(typeof JSON.parse!=="function")JSON.parse=function(g,k){function i(q,y){var z,o,p=q[y];if(p&&typeof p==="object")for(z in p)if(Object.hasOwnProperty.call(p,z)){o=i(p,z);if(o!==undefined)p[z]=o;else delete p[z]}return k.call(q,y,p)}var l;g=String(g);e.lastIndex=0;if(e.test(g))g=g.replace(e,function(q){return"\\u"+("0000"+q.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(g.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){l=eval("("+g+")");return typeof k==="function"?i({"":l},""):l}throw new SyntaxError("JSON.parse");}})();
(function(){function f(h,e){var b=h.split("|"),c={};for(var d in e){var a=e[d];c[d]=b.length>a?b[a]:null}return c}var m={JSON:{parse:function(h){return JSON.parse(h)}},PDON:{parse:function(h){var e=null,b=[];h=h.split("\n");for(var c=0;c<h.length;c++){var d=h[c];if(e)b.push(f(d,e));else if(d){e=d.split("|");d={};for(var a=0;a<e.length;a++)d[e[a]]=a;e=d}else e=null}return b}}};COG.parseData=function(h,e){e=e?e.toUpperCase():"JSON";if(!m[e])throw Error("Unsupported data format: "+e);try{return m[e].parse(h)}catch(b){COG.Log.exception(b)}return{}}})();
COG.XPath=function(){function f(b){for(var c=null,d=0;d<m.length;d++)if(c=m[d](b))break;return c}var m=[],h=[null,function(b){return b.numberValue},function(b){return b.stringValue},function(b){return b.booleanValue},null,null,null,null,function(b){return b.singleNodeValue?b.singleNodeValue.textContent:null},function(b){return b.singleNodeValue?b.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||COG.Log.warn("No XPATH support");var e={SearchResult:function(b){return{toString:function(){var c=
null;if(b){var d=null;if(b.resultType>=0&&b.resultType<h.length)d=h[b.resultType];if(d)c=d(b)}return c?c:""}}},first:function(b,c){var d=e.SearchResult,a;var j=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!j)j=XPathResult.ANY_TYPE;try{if(COG.isXmlDocument(c))a=c.evaluate(b,c,f,j,null);else{COG.Log.warn("attempted xpath expression: "+b+" on a non-xml document");a=null}}catch(g){COG.Log.warn("invalid xpath expression: "+b+" on node: "+c);a=null}return new d(a)},registerResolver:function(b){m.push(b)}};return e}();
COG.Storage=function(){function f(m){if(m&&m=="session")return sessionStorage;return localStorage}return{get:function(m,h){var e=f(h).getItem(m);return/^(\{|\[).*(\}|\])$/.test(e)?JSON.parse(e):e},set:function(m,h,e){h=jQuery.isArray(h)||jQuery.isPlainObject(h)?JSON.stringify(h):h;f(e).setItem(m,h)},remove:function(m,h){f(h).removeItem(m)}}}();
COG.ParseRules=function(){var f=[];return{add:function(m,h){f.push({regex:m,handler:h})},each:function(m,h,e){function b(){c++;e&&c>=f.length&&e(h)}for(var c=0,d=0;d<f.length;d++){var a=f[d].regex,j=f[d].handler,g=false;if(a){a.lastIndex=-1;if((a=a.exec(m))&&j){g=true;j(a,h,b)&&b()}}g||b()}}}};
(function(){function f(a){var j=[],g=function(i,l){l=COG.isFunction(l)?l():l;j[j.length]=encodeURIComponent(i)+"="+encodeURIComponent(l)};if(COG.isArray(a))for(var k=0;k<a.length;k++)g(a[k].name,a[k].value);else for(k in a)g(k,a[k]);return j.join("&").replace(/%20/g,"+")}var m={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},h={JSON:["json"],PDON:["pdon.txt"]},e=["TEXT","STREAM"],b=/^(\w+:)?\/\/([^\/?#]+)/,c={XML:function(a){return a.responseXML},JSON:function(a){return COG.parseData(a.responseText)},
PDON:function(a){return COG.parseData(a.responseText,"PDON")},DEFAULT:function(a){return a.responseText}},d={CONTENT_TYPE:"Content-Type"};COG.xhr=function(a){function j(){if(this.readyState===4){var l=null,q=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(q)if(a.handleResponse)a.handleResponse(this);else{var y=a,z=this.getResponseHeader(d.CONTENT_TYPE),o,p=false;for(o in m)if(z&&z.indexOf(m[o])>=0){p=true;
break}z=!p;for(p=0;p<e.length;p++)z=z||e[p]==o;if(z)b:{z=o;for(var u in h)for(p=0;p<h[u].length;p++)if(RegExp(h[u][p]+"$","i").test(y.url)){o=u;break b}o=z?z:"DEFAULT"}try{l=c[o](this,y)}catch(v){l=c.DEFAULT(this,y)}}else a.error&&a.error(this)}catch(P){COG.Log.exception(P,"PROCESSING AJAX RESPONSE")}q&&l&&a.success&&a.success.call(this,l)}}try{a=COG.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},a);var g=
b.exec(a.url),k=g&&(g[1]&&g[1]!==location.protocol||g[2]!==location.host);if(a.data)a.method="POST";if(a.url){g=null;if(a.xhr)g=a.xhr(a);g||(g=new XMLHttpRequest);g.open(a.method,a.url,a.async);a.data&&g.setRequestHeader("Content-Type",a.contentType);k||g.setRequestHeader("X-Requested-With","XMLHttpRequest");g.onreadystatechange=j;g.send(a.method=="POST"?f(a.data):null)}else COG.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(i){COG.Log.exception(i)}}})();
(function(){function f(b){var c=document.createElement("script"),d=false;c.src=b;c.async=true;c.onload=c.onreadystatechange=function(){if(!d&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){d=true;c.onload=c.onreadystatechange=null;c&&c.parentNode&&c.parentNode.removeChild(c)}};h||(h=document.getElementsByTagName("head")[0]);h.appendChild(c)}var m=0,h,e=this;COG.jsonp=function(b,c,d){b+=b.indexOf("?")>=0?"&":"?";var a="json"+ ++m;e[a]=function(j){c(j);e[a]=null;try{delete e[a]}catch(g){}};
f(b+(d?d:"callback")+"="+a);return a}})();
COG.Touch=function(){function f(x,C){return{x:x.x-C.x,y:x.y-C.y}}function m(x,C){var G=f(x,C);return Math.sqrt(G.x*G.x+G.y*G.y)}function h(x){if(x.count>1)return m(x.touches[0],x.touches[1]);return 0}function e(x,C){var G=x&&x.count>0?x.touches[0]:null;if(G&&C&&C.count>0)return f(G,C.touches[0]);return null}function b(x,C){x.count=C.count;for(var G=g;G--;){x.touches[G].x=C.touches[G].x;x.touches[G].y=C.touches[G].y}}function c(){for(var x={count:0,touches:Array(g)},C=g;C--;)x.touches[C]=j();return x}
function d(x){if(x.preventDefault){x.preventDefault();x.stopPropagation()}else x.cancelBubble&&x.cancelBubble()}function a(x,C,G){if(D){C=C[G?G:"touches"];G=C.length;for(G=x.count=G;G--;){x.touches[G].x=C[G].pageX;x.touches[G].y=C[G].pageY}}else if(C.button===0){x.count=1;x.touches[0].x=C.pageX?C.pageX:C.screenX;x.touches[0].y=C.pageY?C.pageY:C.screenY}else x.count=0}function j(x,C){return{x:x?x:0,y:C?C:0}}var g=10,k=120,i=100,l=250,q=300,y=5,z=0,o=1,p=2,u=7,v=0,P=0,D=undefined,ga=function(x){function C(w,
s,n,r){var B=Math.asin((w.y-s.y)/n);n=n*(oa/r)>>0;n=n>ka?ka:n;B=s.x>w.x?B:Math.PI-B;Q("pan",Math.cos(B)*-n,Math.sin(B)*n,true)}function G(w,s){var n,r;if(D){n=s-ea;if(n<l){r=m(I.touches[0],w);r>x.inertiaTrigger&&C(I.touches[0],w,r,n)}}else{Z.x=w.x;Z.y=w.y;COG.Loopage.join({execute:function(B,H){n=B-s;r=m(w,Z);if(n<i&&r>x.inertiaTrigger){H.trigger("complete");C(w,Z,r,n)}else n>i&&H.trigger("complete")},frequency:10})}}function fa(w){var s=0,n=0;if(w.offsetParent){do{s+=w.offsetLeft;n+=w.offsetTop;
w=w.offsetParent}while(w)}return j(s,n)}function $(w){var s=w.count,n=Array(s),r=fa(aa);for(s=s;s--;)n[s]=j(w.touches[s].x-r.x,w.touches[s].y-r.y);return n}function Q(){V&&V.trigger.apply(null,arguments)}function t(w,s){var n=fa(aa);n=j(s.x-n.x,s.y-n.y);Q(w,s,n)}function K(w){var s=w.target?w.target:w.srcElement;if(la||s&&s===aa){a(I,w);if(I.count!==0){X=null;U.x=0;U.y=0;ia=true;L=false;ea=(new Date).getTime();d(w);s.style.cursor="move";Q("inertiaCancel");ma=ea;if(w=I.count>0?I.touches[0]:null){Q("touchStart",
w.x,w.y);if(ma-ja<q)if((w=f(I.touches[0],O.touches[0]))&&Math.abs(w.x)<x.maxDistDoubleTap&&Math.abs(w.y)<x.maxDistDoubleTap)L=true;Y=z;b(O,I)}else COG.Log.warn("Touch start fired, but no touch vector found")}}}function A(w){var s=w.target?w.target:w.srcElement,n=0;if(la||s&&s===aa){a(R,w);if(R.count>0){Z.x=R.touches[0].x;Z.y=R.touches[0].y}if(ia){D&&d(w);if(R.count>1){I.count===1&&b(I,R);n=h(I)-h(R)}if(Y===z)if((w=e(R,I))&&(Math.abs(w.x)>=u||Math.abs(w.y)>=u))Y=o;if(Y!==z)if(!n||Math.abs(n)<y){if(X=
e(R,O)){U.x-=X.x;U.y-=X.y;F.x-=X.x;F.y-=X.y}Q("pan",F.x,F.y);F.x=0;F.y=0;Y=o}else{Q("pinchZoom",$(I),$(R));Y=p}b(O,R)}}}function J(w){var s=w.target?w.target:w.srcElement;if(ia&&(la||s&&s===aa)){a(W,w,"changedTouches");var n=W.touches[0];D&&d(w);w=(new Date).getTime();ja=ma;if(Y===z){t("tap",I.touches[0]);S||(S=setTimeout(function(){S=0;L&&t("doubleTap",I.touches[0])},q+50))}else if(Y==o){Q("panEnd",U.x,U.y);pa&&G(n,w)}else Y==p&&Q("pinchZoomEnd",$(I),$(O),w-ea);s.style.cursor="default";ia=false}}
function E(w){var s=w.target?w.target:w.srcElement;if(la||s&&s===aa){if(w.detail){s=-w.detail*k;s=j(w.axis===1?s:0,w.axis===2?s:0)}else s=j(w.wheelDeltaX,w.wheelDeltaY);var n=s.y!==0?Math.abs(s.y/k):0;if(Z&&n!==0){var r=j(Z.x-aa.offsetLeft,Z.y-aa.offsetTop);Q("wheelZoom",r,Math.pow(2,s.y>0?n:-n))}d(w)}}x=COG.extend({element:null,observable:null,inertiaTrigger:20,maxDistDoubleTap:20,touchStartHandler:null,moveHandler:null,moveEndHandler:null,pinchZoomHandler:null,pinchZoomEndHandler:null,tapHandler:null,
doubleTapHandler:null,wheelZoomHandler:null},x);var L=false,S=0,M=T5.getConfig(),I=c(),R=c(),O=c(),W=c(),X=null,U=j(),F=j(),Y=null,ia=false,ea=0,ba=[],Z=j(),pa=false,oa,ka,ma=0,ja=0,aa=x.element,V=x.observable,la=typeof FlashCanvas!=="undefined",qa={supportsTouch:D,addListeners:function(w){ba.push(w)},decoupleListeners:function(w){for(var s=0;w&&s<ba.length;s++)if(ba[s].listenerId===w){ba.splice(s,1);break}},release:function(){M.unbindEvent(D?"touchstart":"mousedown",K,false);M.unbindEvent(D?"touchmove":
"mousemove",A,false);M.unbindEvent(D?"touchend":"mouseup",J,false);if(!D){window.removeEventListener("mousewheel",E,false);window.removeEventListener("DOMMouseScroll",E,false)}},inertiaEnable:function(w,s){pa=true;oa=w;ka=s?Math.min(s.width,s.height):500},inertiaDisable:function(){pa=false}};if(typeof D==="undefined")D=T5.getConfig().supportsTouch;M.bindEvent(D?"touchstart":"mousedown",K,false);M.bindEvent(D?"touchmove":"mousemove",A,false);M.bindEvent(D?"touchend":"mouseup",J,false);if(!D){M.bindEvent("mousewheel",
E,window);M.bindEvent("DOMMouseScroll",E,window)}return qa},T=[];return{capture:function(x,C){if(!x)throw Error("Unable to capture touch of null element");if(!x.id)x.id="touchable_"+v++;var G=T[x.id];if(!G){G=new ga(COG.extend({element:x},C));T[x.id]=G}if(C){C.listenerId&&G.decoupleListeners(C.listenerId);C.listenerId=++P;G.addListeners(C)}return G},release:function(x){if(x&&x.id&&T[x.id]){T[x.id].release();delete T[x.id]}}}}();
T5=function(){var f=function(d,a){return{x:d?d:0,y:a?a:0}},m=function(){function d(a,j){if(!j)j=a.length;if(j<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var g={edges:Array(j-1),accrued:Array(j-1),total:0},k=m.diff,i=0;i<j-1;i++){var l=k(a[i],a[i+1]);g.edges[i]=Math.sqrt(l.x*l.x+l.y*l.y);g.accrued[i]=g.total+g.edges[i];g.total+=g.edges[i]}return g}return{VECTOR_SIMPLIFICATION:4,create:function(a,j){return new f(a,j)},add:function(){for(var a=new f,j=
arguments.length;j--;){a.x+=arguments[j].x;a.y+=arguments[j].y}return a},absSize:function(a){return Math.max(Math.abs(a.x),Math.abs(a.y))},diff:function(a,j){return new f(a.x-j.x,a.y-j.y)},copy:function(a){return a?new f(a.x,a.y):null},invert:function(a){return new f(-a.x,-a.y)},offset:function(a,j,g){return new f(a.x+j,a.y+(g?g:j))},edges:d,distance:function(a,j){return d(a,j).total},simplify:function(a,j){if(!a)return null;j=j?j:m.VECTOR_SIMPLIFICATION;for(var g=[],k=null,i=a.length;i--;){var l=
a[i];if(include=!k||i===0||Math.abs(l.x-k.x)+Math.abs(l.y-k.y)>j){g.unshift(l);k=l}}return g},theta:function(a,j,g){g=Math.asin((a.y-j.y)/g);return a.x>j.x?g:Math.PI-g},pointOnEdge:function(a,j,g,k){j=new f(Math.cos(g)*k,Math.sin(g)*k);return new f(a.x-j.x,a.y-j.y)},getRect:function(a){var j=a.length;if(j>1)return new h(Math.min(a[0].x,a[j-1].x),Math.min(a[0].y,a[j-1].y),Math.abs(a[0].x-a[j-1].x),Math.abs(a[0].y-a[j-1].y))},toString:function(a){return a.x+", "+a.y}}}(),h=function(d,a,j,g){return{origin:new f(d,
a),dimensions:new b(j,g),invalid:false}},e=function(){return{bottomRight:function(d){return m.offset(d.origin,d.dimensions.width,d.dimensions.height)},empty:function(){return new h(0,0,0,0)},copy:function(d){return d?new h(d.origin.x,d.origin.y,d.dimensions.width,d.dimensions.height):null},getCenter:function(d){return new f(d.origin.x+d.dimensions.width/2,d.origin.y+d.dimensions.height/2)},isEmpty:function(d){return d.dimensions.width===0||d.dimensions.height===0},union:function(){if(!(arguments.length<
2)){for(var d=arguments[0].origin.y,a=arguments[0].origin.x,j=d+arguments[0].dimensions.height,g=a+arguments[0].dimensions.width,k=Array.prototype.slice.call(arguments,1),i=k.length;i--;){var l=k[i].origin.y,q=k[i].origin.x,y=l+k[i].dimensions.height,z=q+k[i].dimensions.width;d=d<l?d:l;a=a<q?a:q;j=j>y?j:y;g=g>z?g:z}arguments[0].origin.x=a;arguments[0].origin.y=d;arguments[0].dimensions.width=g-a;arguments[0].dimensions.height=j-d}}}}(),b=function(d,a){return{width:d?d:0,height:a?a:0}},c=function(){return{getAspectRatio:function(d){return d.height!==
0?d.width/d.height:1},getCenter:function(d){return new f(d.width/2,d.height/2)},getSize:function(d){return Math.sqrt(Math.pow(d.width,2)+Math.pow(d.height,2))}}}();return{ex:COG.extend,ticks:function(){return(new Date).getTime()},Vector:f,V:m,Dimensions:b,D:c,Rect:h,R:e}}();
(function(){function f(){for(;y.length>0;){var o=y.shift();document.location=o}q=0}function m(o){for(var p=true,u=z.length;u--;)p=p&&o!=z[u];return p}function h(o,p){var u=[];for(var v in p)v&&u.push(v+"="+escape(p[v]));return"tile5://"+o+"/"+(u.length>0?"?"+u.join("&"):"")}function e(o,p){m(o)&&COG.Log.info("would push url: "+h(o,p))}function b(o,p){if(m(o)){y.push(h(o,p));q||(q=setTimeout(f,100))}}function c(o){return function(p,u,v){(v?v:o?document.body:document).addEventListener(p,u,false)}}function d(o){return function(p,
u,v){(v?v:o?document.body:document).removeEventListener(p,u,false)}}function a(o,p,u){(u?u:document).attachEvent("on"+o,p)}function j(o,p,u){(u?u:document).detachEvent("on"+o,p)}function g(){k={base:{name:"Unknown",bindEvent:c(),unbindEvent:d(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:e,targetFps:null},ie:{name:"MSIE",regex:/msie/i,bindEvent:a,unbindEvent:j,requireFastDraw:false,targetFps:25},
ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:b,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:b},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:b},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:c(true),unbindEvent:d(true),supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},bridgeNotify:b},froyo:{name:"Android OS >= 2.2",
regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:b}};i=[k.froyo,k.android,k.ipod,k.iphone,k.ipad,k.ie]}var k=null,i=[],l=null,q=0,y=[],z=["view.wake","tile.loaded"];T5.getConfig=function(){k||g();if(!l){COG.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var o=0;o<i.length;o++){var p=i[o];if(p.regex&&p.regex.test(navigator.userAgent)){l=T5.ex({},k.base,p);COG.Log.info("PLATFORM DETECTED AS: "+l.name);break}}if(!l){COG.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
l=k.base}COG.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return l}})();
T5.Dispatcher=function(){var f=[],m={execute:function(h){var e=m.findAction(h);e&&e.execute.apply(e,Array.prototype.slice.call(arguments,1))},findAction:function(h){for(var e=f.length;e--;)if(f[e].id==h)return f[e];return null},getRegisteredActions:function(){return[].concat(f)},getRegisteredActionIds:function(){for(var h=[],e=f.length;e--;)f[e].id&&h.push(f[e].id);return h},registerAction:function(h){h&&h.id&&f.push(h)},Action:function(h){h=T5.ex({autoRegister:true,id:"",title:"",icon:"",hidden:false,
execute:null},h);var e={id:h.id,execute:function(){h.execute&&h.execute.apply(this,arguments)},getParam:function(b){return h[b]?h[b]:""},toString:function(){return COG.formatStr("{0} [title = {1}, icon = {2}]",e.id,h.title,h.icon)}};h.autoRegister&&m.registerAction(e);return e},Agent:function(h){h=COG.extend({name:"Untitled",translator:null,execute:null},h);var e={getName:function(){return h.name},getParam:function(b){return h[b]},getId:function(){return COG.toID(e.getName())},run:function(b,c){if(h.execute){var d=
h.translator?h.translator(b):b;h.execute.call(e,d,function(a,j){c&&c(a,j,d)})}}};return e},runAgents:function(h,e,b){for(var c=0;c<h.length;c++)h[c].run(e,b)}};return m}();
T5.Resources=function(){var f="",m={},h={getPath:function(e){return/^(file|https?|\/)/.test(e)?e:f+e},setBasePath:function(e){f=e},loadResource:function(e){e=T5.ex({filename:"",cacheable:true,dataType:null,callback:null},e);var b=function(c){e.callback&&COG.Log.watch("CALLING RESOURCE CALLBACK",function(){e.callback(c)})};e.cacheable&&m[e.filename]?b(m[e.filename]):COG.xhr({url:h.getPath(e.filename),dataType:e.dataType,success:function(c){if(e.cacheable)m[e.filename]=c;b(c)},error:function(c,d,a){COG.Log.error("error loading resource ["+
e.filename+"], error = "+a)}})},loadSnippet:function(e,b){/\.\w+$/.test(e)||(e+=".html");h.loadResource({filename:"snippets/"+e,callback:b,dataType:"html"})}};return h}();
T5.Images=function(){function f(){if(!q){var o=T5.getConfig().maxImageLoads;q=COG.Loopage.join({execute:function(p,u){if(!o||k.length<o){var v=g.shift();if(v){k[k.length]=v;v.image.onload=h;v.image.src=T5.Resources.getPath(v.url);v.requested=T5.ticks()}else u.trigger("complete")}},frequency:10});q.bind("complete",function(){q=null})}}function m(){y=true;try{var o=i.length/2>>0;if(o>0){i.sort(function(u,v){return u.created-v.created});for(var p=o;p--;)delete c[i[p].url];i.splice(0,o)}}finally{y=false}COG.say("imagecache.cleared")}
function h(){var o=a[this.id];if(o&&o.image.complete&&o.image.width>0){o.loaded=true;o.hitCount=1;for(var p=k.length;p--;)if(k[p].image.src==this.src){k.splice(p,1);break}if(o.background||o.postProcess||o.drawBackground||o.customDraw)if(o.image){p=b(o.realSize?o.realSize.width:image.width,o.realSize?o.realSize.height:image.height);var u=p.getContext("2d"),v=o.offset?o.offset:new T5.Vector;o.background&&u.drawImage(o.background,0,0);o.drawBackground&&o.drawBackground(u);o.customDraw?o.customDraw(u,
o):u.drawImage(o.image,v.x,v.y);o.postProcess&&o.postProcess(u,o);o.image=p}o.loadCallback&&o.loadCallback(this,false);i[i.length]={url:this.src,created:o.requested};delete a[this.id];f()}}function e(o,p,u){var v=c[o];if(v){v.hitCount++;v.image.complete&&p&&p(v.image,true)}else{v=T5.ex({url:o,image:new Image,loaded:false,created:T5.ticks(),requested:null,hitCount:0,loadCallback:p},u);v.image.id="resourceLoaderImage"+j++;c[o]=v;a[v.image.id]=v;g[g.length]=v;f()}return v}function b(o,p){var u=document.createElement("canvas");
u.width=o?o:0;u.height=p?p:0;if(typeof FlashCanvas!=="undefined"){u.id="tmpCanvas"+d++;u.style.cssText="position: absolute; top: -"+(p-1)+"px; left: -"+(o-1)+"px;";document.body.appendChild(u);FlashCanvas.initElement(u)}typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(u);return u}var c={},d=0,a={},j=0,g=[],k=[],i=[],l=0,q=null,y=false,z={avgImageSize:25,loadTimeout:10,cancelLoad:function(){k=[]},get:function(o,p){var u=null,v=null;y||(u=c[o]);if((v=u?u.image:null)&&(v.getContext||
v.complete&&v.width>0))return v;else p&&e(o,p);return null},load:e,newCanvas:b,stats:function(){return{imageLoadingCount:k.length,queuedImageCount:g.length,imageCacheFullness:l}}};COG.Loopage.join({execute:function(o){for(var p=false,u=0,v=T5.getConfig();u<k.length;)if(o-k[u].requested>z.loadTimeout*1E3){k.splice(u,1);p=true}else u++;p&&f();if(v&&v.imageCacheMaxSize){l=i.length*z.avgImageSize/v.imageCacheMaxSize;l>=1&&m()}},frequency:2E4});return z}();
T5.TimeLord=function(){var f=/^P(\d+Y)?(\d+M)?(\d+D)?$/,m=/^(\d+H)?(\d+M)?(\d+S)?$/,h=function(b,c){return{days:b?b:0,seconds:c?c:0}},e={8601:function(b){b=b.split("T");var c=null;c=null;var d=0,a=0;f.lastIndex=-1;c=f.exec(b[0]);d+=c[3]?parseInt(c[3].slice(0,-1),10):0;m.lastIndex=-1;c=m.exec(b[1]);a+=c[1]?parseInt(c[1].slice(0,-1),10)*3600:0;a+=c[2]?parseInt(c[2].slice(0,-1),10)*60:0;a+=c[3]?parseInt(c[3].slice(0,-1),10):0;return new h(d,a)}};return{Duration:h,addDuration:function(){for(var b=new h,
c=arguments.length;c--;){b.days+=arguments[c].days;b.seconds+=arguments[c].seconds}if(b.seconds>=86400){b.days+=~~(b.seconds/86400);b.seconds%=86400}return b},parseDuration:function(b,c){var d=c?e[c]:null;if(d)return d(b);COG.Log.warn("Could not find duration parser for specified format: "+c);return new h},formatDuration:function(b){var c,d,a="";if(b.days)a=b.days+" days ";if(b.seconds){b=b.seconds;if(b>=3600){c=~~(b/3600);b-=c*3600}if(b>=60){d=Math.round(b/60);b-=d*60}if(c)a=a+c+(c>1?" hrs ":" hr ")+
(d?(d>10?d:"0"+d)+" min ":"");else if(d)a=a+d+" min";else if(b>0)a=a+(b>10?b:"0"+b)+" sec"}return a}}}();
(function(){var f=Math.PI*2,m=Math.PI/2,h=Math.abs,e=Math.pow,b=Math.sin,c=Math.asin,d=Math.cos,a=1.70158,j={linear:function(g,k,i,l){return i*g/l+k},backin:function(g,k,i,l){return i*(g/=l)*g*((a+1)*g-a)+k},backout:function(g,k,i,l){return i*((g=g/l-1)*g*((a+1)*g+a)+1)+k},backinout:function(g,k,i,l){return(g/=l/2)<1?i/2*g*g*(((a*=1.525)+1)*g-a)+k:i/2*((g-=2)*g*(((a*=1.525)+1)*g+a)+2)+k},bouncein:function(g,k,i,l){return i-j.bounceout(l-g,0,i,l)+k},bounceout:function(g,k,i,l){return(g/=l)<1/2.75?
i*7.5625*g*g+k:g<2/2.75?i*(7.5625*(g-=1.5/2.75)*g+0.75)+k:g<2.5/2.75?i*(7.5625*(g-=2.25/2.75)*g+0.9375)+k:i*(7.5625*(g-=2.625/2.75)*g+0.984375)+k},bounceinout:function(g,k,i,l){return g<l/2?j.bouncein(g*2,0,i,l)/2+k:j.bounceout(g*2-l,0,i,l)/2+i/2+k},cubicin:function(g,k,i,l){return i*(g/=l)*g*g+k},cubicout:function(g,k,i,l){return i*((g=g/l-1)*g*g+1)+k},cubicinout:function(g,k,i,l){if((g/=l/2)<1)return i/2*g*g*g+k;return i/2*((g-=2)*g*g+2)+k},elasticin:function(g,k,i,l,q,y){if(g==0)return k;if((g/=
l)==1)return k+i;y||(y=l*0.3);if(!q||q<h(i)){q=i;i=y/4}else i=y/f*c(i/q);return-(q*e(2,10*(g-=1))*b((g*l-i)*f/y))+k},elasticout:function(g,k,i,l,q,y){var z;if(g==0)return k;if((g/=l)==1)return k+i;y||(y=l*0.3);if(!q||q<h(i)){q=i;z=y/4}else z=y/f*c(i/q);return q*e(2,-10*g)*b((g*l-z)*f/y)+i+k},elasticinout:function(g,k,i,l,q,y){var z;if(g==0)return k;if((g/=l/2)==2)return k+i;y||(y=l*0.3*1.5);if(!q||q<h(i)){q=i;z=y/4}else z=y/f*c(i/q);if(g<1)return-0.5*q*e(2,10*(g-=1))*b((g*l-z)*f/y)+k;return q*e(2,
-10*(g-=1))*b((g*l-z)*f/y)*0.5+i+k},quadin:function(g,k,i,l){return i*(g/=l)*g+k},quadout:function(g,k,i,l){return-i*(g/=l)*(g-2)+k},quadinout:function(g,k,i,l){if((g/=l/2)<1)return i/2*g*g+k;return-i/2*(--g*(g-2)-1)+k},sinein:function(g,k,i,l){return-i*d(g/l*m)+i+k},sineout:function(g,k,i,l){return i*b(g/l*m)+k},sineinout:function(g,k,i,l){return-i/2*(d(Math.PI*g/l)-1)+k}};T5.easing=function(g){return j[g.replace(/[\-\_\s\.]/g,"").toLowerCase()]};T5.registerEasingType=function(g,k){j[g.replace(/[\-\_\s\.]/g,
"").toLowerCase()]=k}})();
T5.Tween=function(f){f=T5.ex({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:T5.easing("sine.out"),complete:null,cancelOnInteract:false},f);var m=T5.ticks(),h=[],e=false,b=0,c=0,d={cancelOnInteract:f.cancelOnInteract,isComplete:function(){return e},triggerComplete:function(a){f.complete&&f.complete(a)},update:function(a){try{var j=f.tweenFn(a-m,b,c,f.duration);if(f.target)f.target[f.property]=j;for(var g=h.length;g--;)h[g](j,void 0);if(e=m+f.duration<=a){if(f.target)f.target[f.property]=
f.tweenFn(f.duration,b,c,f.duration);for(var k=h.length;k--;)h[k](j,true)}}catch(i){COG.Log.exception(i)}},requestUpdates:function(a){h.push(a)}};b=f.target&&f.property&&f.target[f.property]?f.target[f.property]:f.startValue;if(typeof f.endValue!=="undefined")c=f.endValue-b;if(c==0)e=true;T5.wakeTweens();return d};
(function(){function f(b){if(e)return m.length;e=true;try{for(var c=0;c<m.length;)if(m[c].isComplete()){m[c].triggerComplete(false);m.splice(c,1)}else{m[c].update(b);c++}}finally{e=false}m.length===0&&h.trigger("complete");return m.length}var m=[],h=null,e=false;T5.tweenValue=function(b,c,d,a,j){b=new T5.Tween({startValue:b,endValue:c,tweenFn:d,complete:a,duration:j});m.push(b);return b};T5.tween=function(b,c,d,a,j,g){b=new T5.Tween({target:b,property:c,endValue:d,tweenFn:a,duration:g,complete:j});
m.push(b);return b};T5.tweenVector=function(b,c,d,a,j,g){var k=[];if(b){var i=b.x==c,l=b.y==d;i||k.push(T5.tween(b,"x",c,a,function(){(i=true)&&l&&j()},g));l||k.push(T5.tween(b,"y",d,a,function(){l=true;i&&l&&j()},g))}return k};T5.cancelAnimation=function(b){if(!e){e=true;try{for(var c=0;c<m.length;)if(!b||b(m[c])){m[c].triggerComplete(true);m.splice(c,1)}else c++}finally{e=false}}};T5.isTweening=function(){return m.length>0};T5.wakeTweens=function(){if(!h){h=COG.Loopage.join({execute:f,frequency:20});
h.bind("complete",function(){h=null})}}})();(function(){var f={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,PINCH:16,FREEZE:128};T5.viewState=function(){for(var m=0,h=arguments.length;h--;){var e=f[arguments[h].toUpperCase()];if(e)m|=e}return m}})();
T5.ViewLayer=function(f){f=T5.ex({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:T5.viewState("ACTIVE","ANIMATING","PAN","PINCH")},f);var m=null,h=false,e=false,b=f.supportFastDraw,c=f.id,d=T5.viewState("ACTIVE"),a=f.validStates,j=0,g=0,k=T5.ex({addToView:function(i){i.setLayer(c,k)},shouldDraw:function(i,l,q){i=(i&a)!==0&&(h?b:true);return i=e||q||j!==l.x||g!==l.y},cycle:function(){},draw:function(){},remove:function(){k.trigger("remove",k)},changed:function(){e=true;k.trigger("changed",
k);m&&m.trigger("invalidate")},getId:function(){return c},setId:function(i){c=i},getParent:function(){return m},setParent:function(i){h=(m=i)?m.fastDraw&&displayState!==d:false;k.trigger("parentChange",m)}},f);COG.observable(k);k.bind("drawComplete",function(i,l){e=false;j=l.x;g=l.y});return k};
T5.View=function(f){function m(n,r,B,H){V=ma;u();if(H&&f.inertia){E=true;g(T+r,x+B,f.panAnimationEasing,f.panAnimationDuration)}else H||g(T+r,x+B)}function h(){V=ka;E=false;COG.Loopage.join({execute:u,after:50,single:true})}function e(n,r){O=la(n);W=la(r);var B=qa(O.dimensions),H=qa(W.dimensions);ba=w(O);A=w(W);F=O&&B!==0?H/B:1}function b(n,r,B){e(r,B);if(R=F!==1){V=ja;u()}}function c(n,r,B,H){e(r,B);if(f.adjustScaleFactor){F=f.adjustScaleFactor(F);COG.Log.info("scale factor adjusted to: "+F)}if(H<
f.pinchZoomAnimateTrigger){l(ia,F,ba,q(),T5.easing("sine.out"),function(){a();F=1},300);F=ia}else{a();F=1}}function d(n,r,B){s.zoom(r,Math.min(Math.pow(2,Math.round(Math.log(B))),8),500)}function a(){var n=O?q():A;F=Math.round(F*10)/10;R=false;for(var r=v.length;r--;)v[r].trigger("scale",F,n);s.trigger("scale",F,n);V=ka;u()}function j(){clearTimeout(U);U=setTimeout(k,50)}function g(n,r,B,H,N){function ca(){da+=1;if(da>=2){h(0,0);N&&N()}}var da=0;if(B){n=T5.tweenValue(T,n,B,ca,H);r=T5.tweenValue(x,
r,B,ca,H);n.cancelOnInteract=true;n.requestUpdates(function(ha){T=ha;E=true;u()});r.cancelOnInteract=true;r.requestUpdates(function(ha){x=ha;E=true;u()})}else{T=n;x=r}}function k(){var n;if(D){COG.Touch.release(D);if(f.autoSize&&D.parentNode){n=D.parentNode.getBoundingClientRect();if(n.height!==0&&n.width!==0){D.height=n.height;D.width=n.width}}try{if(!D.id)D.id=f.id+"_canvas";ga=D.getContext("2d");ga.clearRect(0,0,D.width,D.height)}catch(r){COG.Log.exception(r);throw Error("Could not initialise canvas on specified view element");
}oa=COG.Touch.capture(D,{observable:s});if(t.height!==D.height||t.width!==D.width){t=new T5.Dimensions(D.width,D.height);s.trigger("resize",D.width,D.height);for(n=P;n--;)v[n].trigger("resize",D.width,D.height)}f.inertia&&oa.inertiaEnable(f.panAnimationDuration,t);for(n=P;n--;)v[n].trigger("contextChanged",ga);p()}}function i(n,r){r.setId(n);r.added=T5.ticks();r.bind("remove",function(){s.removeLayer(n)});r.trigger("contextChanged",ga);r.setParent(s);v.push(r);v.sort(function(B,H){var N=H.zindex-
B.zindex;if(N===0)N=H.added-B.added;return N});P=v.length;return r}function l(n,r,B,H,N,ca,da){function ha(){ca&&ca();a();F=1;ea=null}R=true;ba=T5.V.copy(B);A=T5.V.copy(H);O=null;if(N)T5.tweenValue(0,r-n,N,ha,da?da:1E3).requestUpdates(function(na){ea=na/(r-n);F=n+na;V=ja;u();s.trigger("animate")});else{F=targetScaleFactor;ha()}}function q(){var n=T5.D.getCenter(t),r=T5.V.distance([A,n]),B=T5.V.theta(A,n,r),H=T5.V.diff(ba,A);n=T5.V.pointOnEdge(A,n,B,r/F);n.x+=H.x;n.y+=H.y;return n}function y(){s.trigger("idle");
J=true;L=0}function z(n,r,B,H){var N=E?ma:$?T5.viewState("FROZEN"):V,ca=(N&ja)!==0,da=0;if(G||ca){n.clearRect(0,0,D.width,D.height);G=false}if(ca){T5.D.getCenter(t);var ha=(ea?ea:1)/2,na=T5.V.diff(ba,A);if(O){M.x=A.x+na.x;M.y=A.y+na.y}else{M.x=A.x-na.x*ha;M.y=A.y-na.y*ha}r=T5.V.offset(r,M.x,M.y)}n.save();try{ia=F;if(Q!==1)n.scale(Q,Q);else if(ca){n.translate(A.x,A.y);n.scale(F,F)}for(da=P;da--;)if(v[da].shouldDraw(N,r,B)){v[da].draw(n,r,t,N,s,B,H);v[da].trigger("drawComplete",r,H)}}finally{n.restore()}s.trigger("drawComplete",
r,H);COG.Log.trace("draw complete",H)}function o(n,r){var B=false,H=!E&&(V===ja||V===ma),N=X||V===T5.viewState("PAN")||V===T5.viewState("PINCH")||T5.isTweening();C.x=T>>0;C.y=x>>0;if(H){T5.cancelAnimation(function(ca){return ca.cancelOnInteract});J=false;if(L!==0){clearTimeout(L);L=0}}for(H=P;H--;){if(v[H].animated)V|=aa;B=v[H].cycle(n,C,V,N)||B}N=N||(V&aa)!==0;if(B=B||N||F!==1&&F!==Y){z(ga,C,N,n);Y=F;X=false}if(!B&&K===0&&!Z){if(!J&&L===0)L=setTimeout(y,500);r.trigger("complete")}K=0;COG.Log.trace("Completed draw cycle",
n)}function p(){X=true;u()}function u(){K+=1;if(!($||fa)){fa=COG.Loopage.join({execute:o,frequency:pa});fa.bind("complete",function(){fa=null})}}f=T5.ex({id:COG.objId("view"),container:"",fastDraw:false,inertia:true,pannable:true,scalable:true,panAnimationEasing:T5.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:true,tapExtent:10,fps:25},f);var v=[],P=0,D=document.getElementById(f.container),ga=null,T=0,x=0,C=new T5.Vector,G=false,fa=null,$=
false,Q=1,t=new T5.Dimensions,K=0,A=null,J=false,E=false,L=0,S=0,M=new T5.Vector,I=0,R=false,O=null,W=null,X=false,U=0,F=1,Y=0,ia=1,ea=null,ba=null,Z=typeof FlashCanvas!=="undefined",pa=~~(1E3/f.fps),oa=null,ka=T5.viewState("ACTIVE"),ma=T5.viewState("PAN"),ja=T5.viewState("PINCH"),aa=T5.viewState("ANIMATING"),V=ka,la=T5.V.getRect,qa=T5.D.getSize,w=T5.R.getCenter,s={id:f.id,deviceScaling:Q,fastDraw:f.fastDraw||T5.getConfig().requireFastDraw,animate:function(n,r,B,H,N){l(F,n,r,B,H,N)},centerOn:function(n){T=
n.x-D.width/2;x=n.y-D.height/2},getDimensions:function(){return t},getZoomCenter:function(){return M},getLayer:function(n){for(var r=0;r<P;r++)if(v[r].getId()==n)return v[r];return null},setLayer:function(n,r){for(var B=0;B<P;B++)if(v[B].getId()===n){v.splice(B,1);break}r&&i(n,r);p()},eachLayer:function(n){for(var r=P;r--;)n(v[r])},clearBackground:function(){COG.Log.info("CALL OF DEPRECATED METHOD CLEAR BACKGROUND");G=true;p()},invalidate:p,freeze:function(){$=true},unfreeze:function(){$=false;u()},
resize:function(n,r){if(D){f.autoSize=false;D.width=n;D.height=r;k();s.trigger("resize",D.width,D.height)}},scale:function(n,r,B,H,N){H||(H=T5.D.getCenter(t));N||(N=T5.D.getCenter(t));s.animate(n,H,N,r,B);return s},removeLayer:function(n){a:{for(var r=P;r--;)if(v[r].getId()==n){n=r;break a}n=-1}if(n>=0&&n<P){COG.say("layer.removed",{layer:v[n]});v.splice(n,1);p()}P=v.length},getOffset:function(){return C},updateOffset:g,zoom:function(n,r,B){E=false;F=r;R=F!==1;ba=T5.D.getCenter(t);A=F>1?T5.V.copy(n):
T5.D.getCenter(t);O=null;clearTimeout(S);if(R){V=ja;u();if(B)S=setTimeout(function(){a();F=1},parseInt(B,10))}}};Q=T5.getConfig().getScaling();s.markers=i("markers",new T5.MarkerLayer);COG.observable(s);s.bind("wake",u);s.bind("invalidate",p);if(f.pannable){s.bind("pan",m);s.bind("panEnd",h);s.bind("inertiaCancel",function(){E=false;u()})}if(f.scalable){s.bind("pinchZoom",b);s.bind("pinchZoomEnd",c);s.bind("wheelZoom",d)}s.bind("tap",function(n,r,B){for(var H=T5.V.offset(B,T,x),N=v.length;N--;)n.cancel=
n.cancel||v[N].trigger("tap",r,B,H).cancel});COG.configurable(s,["inertia","container","rotation","tapExtent"],COG.paramTweaker(f,null,{container:function(n,r){D=document.getElementById(r);k()},rotation:function(n,r){I=r}}),true);k();f.autoSize&&window.addEventListener("resize",j,false);return s};
T5.PathLayer=function(f){function m(k){k.syncVectors(c);d&&k.syncVectors(d);g.trigger("tidy")}f=T5.ex({style:"waypoints",pixelGeneralization:8,zindex:50},f);var h=false,e=[],b=null,c=[],d=null,a=0,j=[],g=T5.ex(new T5.ViewLayer(f),{getAnimation:function(k,i,l,q){var y="pathAnimation"+a++;j.push(y);return new T5.AnimatedPathLayer({id:y,path:e,zindex:f.zindex+1,easing:k?k:T5.easing("sine.inout"),duration:i?i:5E3,drawIndicator:l,autoCenter:q?q:false})},cycle:function(k,i,l,q){return q},draw:function(k,
i){var l,q=e.length;k.save();try{T5.applyStyle(k,f.style);if(q>0){k.beginPath();k.moveTo(e[q-1].x-i.x,e[q-1].y-i.y);for(l=q;l--;)k.lineTo(e[l].x-i.x,e[l].y-i.y);k.stroke();if(b){k.fillStyle=f.waypointFillStyle;for(l=b.length;l--;){k.beginPath();k.arc(b[l].x-i.x,b[l].y-i.y,2,0,Math.PI*2,false);k.stroke();k.fill()}}}}finally{k.restore()}h=false},updateCoordinates:function(k,i){var l=g.getParent();l=l?l.getTileLayer():null;c=k;d=i;COG.Log.info("updating coordinates, grid = "+l);l&&m(l)}});g.bind("gridUpdate",
function(k,i){m(i);for(var l=j.length;l--;)COG.say("layer.remove",{id:j[l]});j=[]});g.bind("tidy",function(){e=T5.V.simplify(c,f.pixelGeneralization);b=T5.V.simplify(d,f.pixelGeneralization);h=true;g.changed()});return g};
T5.Poly=function(f,m){m=T5.ex({fill:false,style:null},m);var h=false,e=m.fill,b=m.style,c=[],d={draw:function(a,j,g){if(h){var k=true,i=b?T5.applyStyle(a,m.style):null;a.beginPath();for(var l=c.length;l--;){var q=c[l].x-j,y=c[l].y-g;if(k){a.moveTo(q,y);k=false}else a.lineTo(q,y)}e&&a.fill();a.stroke();i&&T5.applyStyle(a,i)}},resync:function(a){a.syncVectors(f);c=f.length<=3?f:T5.V.simplify(f)}};h=f&&f.length>=2;return d};
T5.PolyLayer=function(f){f=T5.ex({zindex:80,style:null},f);var m=[],h=false,e=T5.ex(new T5.ViewLayer(f),{add:function(b){m.unshift(b)},cycle:function(){return h},draw:function(b,c,d,a){d=c.x;c=c.y;b.save();try{T5.applyStyle(b,f.style);for(var j=m.length;j--;)m[j].draw(b,d,c,a)}finally{b.restore()}h=false}});e.bind("gridUpdate",function(b,c){for(var d=m.length;d--;)m[d].resync(c);h=true;e.changed()});e.bind("parentChange",function(b,c){var d=c?c.getTileLayer():null;if(d)for(var a=m.length;a--;)m[a].resync(d)});
COG.configurable(e,["style"],COG.paramTweaker(f,null,null),true);return e};
T5.AnimatedPathLayer=function(f){function m(a,j,g){a.fillStyle="#FFFFFF";a.strokeStyle="#222222";a.beginPath();a.arc(g.x,g.y,4,0,Math.PI*2,false);a.stroke();a.fill()}f=T5.ex({path:[],id:COG.objId("pathAni"),easing:T5.easing("sine.inout"),validStates:T5.viewState("ACTIVE","PAN","PINCH"),drawIndicator:null,duration:2E3,autoCenter:false},f);var h=T5.V.edges(f.path),e,b=null,c=0;T5.tweenValue(0,h.total,f.easing,function(){d.remove()},f.duration).requestUpdates(function(a,j){c=a;j&&d.remove()});var d=
T5.ex(new T5.ViewLayer(f),{cycle:function(){for(var a=0;a<h.accrued.length&&h.accrued[a]<c;)a++;b=null;if(a<f.path.length-1){var j=c-(a>0?h.accrued[a-1]:0),g=f.path[a],k=f.path[a+1];e=T5.V.theta(g,k,h.edges[a]);b=T5.V.pointOnEdge(g,k,e,j);if(f.autoCenter)(a=d.getParent())&&a.centerOn(b)}return b},draw:function(a,j){if(b)(f.drawIndicator?f.drawIndicator:m)(a,j,new T5.Vector(b.x-j.x,b.y-j.y),e)}});return d};
T5.Marker=function(f){function m(j,g,k,i){e=j;b=g;c=k;d=i}f=T5.ex({xy:new T5.Vector,tweenIn:null,animationSpeed:null},f);var h=false,e=0,b=0,c=0,d=0,a=T5.ex(f,{isNew:true,isAnimating:function(){return h},draw:function(j,g,k,i,l){if(a.isNew&&f.tweenIn){var q=a.xy.y;a.xy.y=g.y-20;h=true;T5.tween(a.xy,"y",q,f.tweenIn,function(){a.xy.y=q;h=false},f.animationSpeed?f.animationSpeed:250+Math.random()*500)}a.drawMarker(j,g,a.xy.x-g.x,a.xy.y-g.y,k,i,l);a.isNew=false},drawMarker:function(j,g,k,i){j.beginPath();
j.arc(k,i,4,0,Math.PI*2,false);j.fill();m(k-4,i-4,8,8)},hitTest:function(j,g){return j>=e&&j<=e+c&&g>=b&&g<=b+d},updateBounds:m});COG.observable(a);return a};
T5.ImageMarker=function(f){f=T5.ex({image:null,imageUrl:null,animatingImage:null,animatingImageUrl:null,imageAnchor:null,rotation:0,scale:1,opacity:1},f);var m=f.imageAnchor?T5.V.invert(f.imageAnchor):null,h=f.image,e=f.animatingImage;h||(h=T5.Images.get(f.imageUrl,function(c){h=c}));e||(e=T5.Images.get(f.imageUrl,function(c){e=c}));var b=T5.ex(new T5.Marker(f),{drawMarker:function(c,d,a,j){if((d=b.isAnimating()&&e?e:h)&&d.complete&&d.width>0){m||(m=new T5.Vector(-d.width>>1,-d.height>>1));var g=
b.scale,k=a+~~(m.x*g),i=j+~~(m.y*g),l=~~(d.width*g),q=~~(d.height*g);b.updateBounds(k,i,l,l);if(b.rotation||b.opacity!==1){c.save();try{c.globalAlpha=b.opacity;c.translate(a,j);c.rotate(b.rotation);c.drawImage(d,m.x*g,m.y*g,l,q)}finally{c.restore()}}else c.drawImage(d,k,i,l,q)}}});return b};T5.Annotation=T5.Marker;T5.ImageAnnotation=T5.ImageMarker;
T5.MarkerLayer=function(f){function m(d,a){for(var j=e.length;j--;)a.syncVectors([e[j].xy])}function h(){c.changed();c.trigger("markerUpdate",e)}f=T5.ex({zindex:100},f);var e=[],b=false,c=T5.ex(new T5.ViewLayer(f),{cycle:function(){return b},draw:function(d,a,j,g,k){b=false;for(j=e.length;j--;){e[j].draw(d,a,g,c,k);b=b||e[j].isAnimating()}return b?1:0},add:function(d){if(d&&typeof d.length!=="undefined")for(var a=d.length;a--;){if(d[a])e[e.length]=d[a]}else if(d)e[e.length]=d;h()},clear:function(d){if(d)for(var a=
0;a<e.length;a++)d(e[a])&&e.splice(a,1);else e=[];h()},find:function(d){var a=[];if(d)for(var j=e.length;j--;)if(d(e[j]))a[a.length]=e[j];return a}});c.bind("tap",function(d,a,j){for(var g=[],k=j.x,i=j.y,l=e.length;l--;)if(e[l].hitTest(k,i))g[g.length]=e[l];if(g.length>0)d.cancel=c.trigger("markerTap",a,j,g).cancel});c.bind("gridUpdate",m);c.bind("changed",function(){var d=c.getParent().getTileLayer();d&&m(null,d)});return c};
T5.Style=function(f){function m(c){var d=f[c];typeof d!=="undefined"&&h.push(function(a){a[c]=d})}f=T5.ex({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},f);var h=[],e={applyToContext:function(c){for(var d=h.length;d--;)h[d](c)}};for(var b in f)m(b);return e};
(function(){var f={},m={basic:new T5.Style({lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"}),waypoints:new T5.Style({lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"})};T5.applyStyle=function(h,e){var b=T5.styles[e]?T5.styles[e]:T5.styles.basic,c;if(h&&h.canvas){c=f[h.canvas.id];f[h.canvas.id]=e}b.applyToContext(h);return c};T5.loadStyles=function(h){COG.jsonp(h,function(e){T5.resetStyles(e)})};T5.resetStyles=function(h){var e={};for(var b in h)e[b]=new T5.Style(h[b]);T5.styles=T5.ex({},
m,e)};T5.styles=m})();(function(){T5.tileSize=256;T5.Tile=function(f){return f=T5.ex({x:0,y:0,gridX:0,gridY:0,dirty:true},f)};T5.EmptyTile=function(f){f=new T5.Tile(f);f.empty=true;return f};T5.ImageTile=function(f){f=T5.ex({url:"",sessionParamRegex:null,loading:false,loaded:false},f);return new T5.Tile(f)}})();
T5.TileGrid=function(f){function m(t,K){var A=T5.Vector(t*j-q.x,K*j-q.y);return new T5.EmptyTile({gridX:A.x,gridY:A.y,empty:true})}function h(t,K,A,J){var E=Math.max(d,a)*0.2>>0,L=new T5.Vector;if(t<0||t+A>d)L.x=t<0?-E:E;if(K<0||K+J>a)L.y=K<0?-E:E;return L}function e(t,K,A){var J=COG.Log.getTraceTicks(),E=0;new T5.Vector(d/2,a/2);if(A)c=[];if(t)for(A=0;A<a;A++)for(var L=0;L<d;L++){if(!c[E]){var S=t(L,A,i,d,a);S.gridX=L*j-q.x;S.gridY=A*j-q.y;c[E]=S}E++}l=t;z=K;COG.Log.trace("tile grid populated",J);
Q.changed()}function b(t,K,A,J){var E,L=[],S=false;t=new T5.Vector((t.x+q.x)*u>>0,(t.y+q.y)*u>>0);tilesNeeded=false;if(!G){E=Q.getParent().getDimensions();x=Math.ceil(E.width*u)+1;C=Math.ceil(E.height*u)+1;G=new T5.Vector((x-1)/2>>0,(C-1)/2>>0)}for(var M=C;M--;)for(var I=x;I--;){E=I+t.x>=0&&I+t.x<d?c[(M+t.y)*d+(I+t.x)]:null;var R=new T5.Vector(I-G.x,M-G.y);if(!E){T=h(t.x,t.y,x,C);E=m(I+t.x,M+t.y)}S=E?(E.dirty=A||E.dirty)||S:S;L[L.length]={tile:E,centerness:T5.V.absSize(R)}}L.sort(function(O,W){return W.centerness-
O.centerness});P||(P=Array(L.length));for(A=L.length;A--;){P[A]=L[A].tile;Q.prepTile(P[A],K)}ga=J;return S}f=T5.ex({tileSize:T5.tileSize,center:new T5.Vector,gridSize:25,shiftOrigin:null,supportFastDraw:true,allowShift:true},f);var c=Array(Math.pow(f.gridSize,2)),d=f.gridSize,a=f.gridSize,j=f.tileSize,g=a*j,k=d*j,i=T5.V.offset(f.center,-Math.ceil(d>>1)),l=null,q=new T5.Vector,y=false,z=null,o=Math.round(j/2),p=false,u=j?1/j:0,v=true,P=null,D=false,ga=0;new T5.Vector;var T=new T5.Vector;T5.getConfig();
var x,C,G,fa=T5.viewState("ANIMATING"),$=T5.viewState("PINCH"),Q=T5.ex(new T5.ViewLayer(f),{gridDimensions:new T5.Dimensions(k,g),cycle:function(t,K,A,J){if(T.x!==0||T.y!==0){J=T;var E=f.shiftOrigin;if(!(!f.allowShift||J.x===0&&J.y===0)){var L=COG.Log.getTraceTicks(),S=Array(c.length);S.length=c.length;for(var M=0;M<d;M++)for(var I=0;I<a;I++)S[I*d+M]=M+J.x>=0&&M+J.x<d?c[(I+J.y)*d+(M+J.x)]:null;c=S;i=E?E(i,J):T5.V.add(i,J);q.x+=-J.x*j;q.y+=-J.y*j;COG.Log.trace("tile storage shifted",L);e(l,z)}T=new T5.Vector;
J=true}if(!p&&(A&$)===0)p=b(K,A,J,t);y=(A&fa)!==0||T5.isTweening();return p},find:function(t){if(!t)return null;for(var K=c.length;K--;){var A=c[K];if(A&&t(A))return A}return null},prepTile:function(){},drawTile:function(){return false},getTileSize:function(){return j},clearTileRect:function(t,K,A,J){t.clearRect(K,A,J,J)},draw:function(t,K,A,J,E,L,S){var M=K.x;K=K.y;var I=A.width,R=A.height,O,W=true;if(P){t.beginPath();if(v)for(var X=P.length;X--;){O=P[X];var U=O.gridX-M,F=O.gridY-K;O.x=U;O.y=F;if(O.empty){COG.Log.info("empty tile @ x: "+
U+", y: "+F);Q.clearTileRect(t,U,F,j,J);W=false}else if(L||O.dirty){y&&Q.clearTileRect(t,U,F,j,J);(O=Q.drawTile(t,O,U,F,J,L,S))&&t.rect(U,F,j,j);W=W&&O}I=U<I?U:I;R=F<R?F:R}t.clip();I>0&&t.clearRect(0,0,I,A.height);R>0&&t.clearRect(0,0,A.width,R);W&&!D&&E.trigger("tileDrawComplete");p=false;D=W}},getTileAtXY:function(t,K){for(var A=null,J=P?P.length:0;J--;){var E=P[J];if(E&&t>=E.x&&K>=E.y)if(t<=E.x+j&&K<=E.y+j){A=E;break}}COG.Log.info("looking for tile @ x: "+t+", y: "+K+", found: "+A);return A},getTileVirtualXY:function(t,
K,A){t=T5.V.add(new T5.Vector(t,K),T5.V.invert(i),q);t=new T5.Vector(t.x*j,t.y*j);if(A){t.x+=o;t.y+=o}return t},populate:function(t){e(t,null,true)},syncVectors:function(){}});Q.bind("resize",function(){COG.Log.info("captured resize");G=null});Q.bind("scale",function(){v=false});COG.listen("imagecache.cleared",function(){for(var t=c.length;t--;)if(c[t])c[t].loaded=false});COG.listen("tiler.repaint",function(){for(var t=c.length;t--;)if(c[t]){c[t].x=null;c[t].y=null}});return Q};
T5.ImageTileGrid=function(f){function m(l){function q(){var y=T5.Images.newCanvas(32,32),z=y.getContext("2d");z.fillStyle="#BBBBBB";z.fillRect(0,0,32,32);z.fillStyle="#C3C3C3";z.fillRect(0,0,16,16);z.fillRect(16,16,16,16);return y}if(!e||l!==e.width){e=T5.Images.newCanvas(l,l);l=e.getContext("2d");l.fillStyle=typeof FlashCanvas!=="undefined"?"#666666":l.createPattern(q(),"repeat");l.fillRect(0,0,e.width,e.height)}return e}f=T5.ex({emptyTile:function(l){if(!h||l!==h.width){h=T5.Images.newCanvas(l,
l);l=h.getContext("2d");l.fillStyle="rgba(150, 150, 150, 0.1)";l.fillRect(0,0,h.width,h.height)}return h}(T5.tileSize),panningTile:null,tileOffset:new T5.Vector,tileDrawArgs:{}},f);var h=f.emptyTile,e=f.panningTile?f.panningTile:m(T5.tileSize),b=T5.viewState("ACTIVE"),c=T5.viewState("PAN"),d=T5.getConfig().requireFastDraw,a=f.tileSize?f.tileSize:T5.tileSize,j=T5.Images.get,g=T5.Images.load,k=T5.ex({background:null,overlay:null,offset:new T5.Vector,realSize:new T5.Dimensions(a,a)},f.tileDrawArgs),
i=T5.ex(new T5.TileGrid(f),{clearTileRect:function(l,q,y,z,o){(o&c)===0&&l.clearRect(q,y,z,z)},drawTile:function(l,q,y,z,o){var p=q.url?j(q.url):null,u=false;if(p){l.drawImage(p,y,z);u=true}else if((o&c)!==0){l.drawImage(e,y,z);u=true}q.dirty=false;return u},initTileUrl:function(){},prepTile:function(l,q){if(l&&!l.loading&&(!d||q===b)){l.url||i.initTileUrl(l);if(!j(l.url)){l.loading=true;g(l.url,function(){l.loaded=true;l.dirty=true;i.changed()},k)}}}});return i};
T5.Tiler=function(f){f=T5.ex({container:"",drawCenter:false,datasources:{},tileLoadThreshold:"first"},f);var m=T5.ex(new T5.View(f),{getTileLayer:function(){return m.getLayer("grid0")},setTileLayer:function(h){m.setLayer("grid0",h);m.trigger("gridUpdate",h);m.eachLayer(function(e){e.trigger("gridUpdate",h)})},viewPixToGridPix:function(h){var e=m.getOffset();return new T5.Vector(h.x+e.x,h.y+e.y)},centerOn:function(h,e,b,c){var d=m.getTileLayer(),a=m.getDimensions();(d=d?d.getTileSize():0)&&m.updateOffset(h.gridX-
(a.width-d)*0.5>>0,h.gridY-(a.height-d)*0.5>>0,e,b,c)},cleanup:function(){m.removeLayer("grid0")},repaint:function(){COG.say("tiler.repaint");m.trigger("wake")},select:function(h){m.trigger("selectTile",h)}});m.bind("tap",function(h,e,b){if(h=m.getTileLayer())(b=h.getTileAtXY(b.x,b.y))&&m.trigger("selectTile",b)});return m};
