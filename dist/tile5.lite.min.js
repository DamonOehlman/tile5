COG=typeof COG!=="undefined"?COG:{};COG.extend=function(){for(var V=arguments[0]||{},ba,A=1,z=arguments.length;A<z;A++)if((ba=arguments[A])!==null)for(var p in ba){var s=ba[p];if(V!==s)if(s!==undefined)V[p]=s}return V};
(function(){var V=Object.prototype.hasOwnProperty,ba=0,A={};A.toID=function(z){return z.replace(/\s/g,"-")};A.objId=function(z){return(z?z:"obj")+ba++};A.isFunction=function(z){return toString.call(z)==="[object Function]"};A.isArray=function(z){return toString.call(z)==="[object Array]"};A.isPlainObject=function(z){if(!z||toString.call(z)!=="[object Object]"||z.nodeType||z.setInterval)return false;if(z.constructor&&!V.call(z,"constructor")&&!V.call(z.constructor.prototype,"isPrototypeOf"))return false;
var p;for(p in z);return p===undefined||V.call(z,p)};A.isEmptyObject=function(z){for(var p in z)return false;return true};A.isXmlDocument=function(z){return toString.call(z)==="[object Document]"};A.contains=function(z,p){var s=z,y=arguments,G=1;if(p&&module.isArray(p)){y=p;G=0}for(G=G;G<y;G++)s=s&&typeof foo[y[G]]!=="undefined";return s};A.formatStr=function(z){if(arguments.length<=1)return z;for(var p=arguments.length-2,s=0;s<=p;s++)z=z.replace(RegExp("\\{"+s+"\\}","gi"),arguments[s+1]);return z};
A.wordExists=function(z,p){var s="";if(p.toString)p=p.toString();for(var y=0;y<p.length;y++)s+=!/\w/.test(p[y])?"\\"+p[y]:p[y];return RegExp("(^|\\s|\\,)"+s+"(\\,|\\s|$)","i").test(z)};COG.extend(COG,A)})();
(function(){function V(s){return typeof console!=="undefined"?function(){console[s](Array.prototype.slice.call(arguments,0).join(" "));return true}:function(){return false}}var ba=window.console&&window.console.markTimeline,A=V("error"),z=V("info"),p=function(){return ba?function(s,y){console.markTimeline(s+(y?": "+((new Date).getTime()-y)+"ms":""))}:function(){}}();COG.extend(COG,{trace:p,debug:V("debug"),info:z,warn:V("warn"),error:A,exception:function(s){if(A)for(var y in s)z("ERROR DETAIL: "+
y+": "+s[y])}})})();
COG.Loopage=function(){function V(m){return COG.extend({id:s++,frequency:0,after:0,single:false,lastTick:0,execute:function(){}},m)}function ba(m){G.push(m);A()}function A(){ca&&clearTimeout(ca);ca=setTimeout(z,0);C=true}function z(){for(var m,t=(new Date).getTime(),P=y.length;G.length>0;){var Q=G.shift();for(m=P;m--;)if(y[m].id===Q){y.splice(m,1);break}C=true;P=y.length}if(C){W=p;for(m=P;m--;)W=y[m].frequency<W?y[m].frequency:W}for(m=P;m--;){Q=t-y[m].lastTick;if(y[m].lastTick===0||Q>=y[m].frequency){y[m].execute(t,
y[m]);y[m].lastTick=t;y[m].single&&y[m].trigger("complete")}}ca=P?setTimeout(z,W):0}var p=6E4,s=0,y=[],G=[],ca=0,W=p,C=true;return{join:function(m){var t=new V(m);if(t.after>0)t.lastTick=(new Date).getTime()+t.after;COG.observable(t);t.bind("complete",function(){ba(t.id)});y.unshift(t);A();return t},leave:ba}}();
(function(){function V(A,z){var p=A.obsHandlers;p[z]||(p[z]=[]);return p[z]}var ba=0;COG.observable=function(A){if(!A)return null;if(!A.obsHandlers)A.obsHandlers={};if(!(A.bind||A.trigger||A.unbind)){A.bind=function(z,p){var s="callback"+ba++;V(A,z).unshift({fn:p,id:s});return s};A.trigger=function(z){var p=V(A,z),s={cancel:false,name:z,tickCount:(new Date).getTime()},y;if(!p)return null;y=Array.prototype.slice.call(arguments,1);A.eventInterceptor&&A.eventInterceptor(z,s,y);y.unshift(s);for(var G=
p.length;G--&&!s.cancel;)p[G].fn.apply(self,y);return s};A.unbind=function(z,p){if(typeof z==="undefined")A.obsHandlers={};else for(var s=V(A,z),y=0;s&&y<s.length;y++)if(s[y].id===p){s.splice(y,1);break}return A}}return A}})();
(function(){function V(p,s){p[s]||(p[s]=function(y){return p.configure(s,y)})}function ba(p){p.gtConfId="configurable"+z++;p.gtConfig={};p.gtConfigFns=[];return p.gtConfig}var A={},z=0;COG.paramTweaker=function(p,s,y){return function(G,ca){if(typeof ca!=="undefined"){if(G in p)p[G]=ca;y&&G in y&&y[G](G,ca)}else return s&&G in s?s[G](G):p[G]}};COG.configurable=function(p,s,y,G){if(p){p.gtConfId||ba(p);var ca=p.gtConfId,W=p.gtConfig,C=p.gtConfigFns;A[ca]=p;C.push(y);for(y=s.length;y--;){W[s[y]]=true;
G&&V(p,s[y])}if(!p.configure)p.configure=function(m,t){if(W[m]){for(var P=C.length;P--;){var Q=C[P](m,t);if(typeof Q!=="undefined")return Q}return A[ca]}return null}}}})();
(function(){function V(p){var s=document.createElement("script"),y=false;s.src=p;s.async=true;s.onload=s.onreadystatechange=function(){if(!y&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){y=true;s.onload=s.onreadystatechange=null;s&&s.parentNode&&s.parentNode.removeChild(s)}};A||(A=document.getElementsByTagName("head")[0]);A.appendChild(s)}var ba=0,A,z=this;COG.jsonp=function(p,s,y){p+=p.indexOf("?")>=0?"&":"?";var G="json"+ ++ba;z[G]=function(ca){s(ca);z[G]=null;try{delete z[G]}catch(W){}};
V(p+(y?y:"callback")+"="+G);return G}})();
(function(){function V(d){if(m)return W.length;m=true;try{for(var l=0;l<W.length;)if(W[l].isComplete()){W[l].triggerComplete(false);W.splice(l,1)}else{W[l].update(d);l++}}finally{m=false}W.length===0&&C.trigger("complete");return W.length}function ba(){if(!C){C=COG.Loopage.join({execute:V,frequency:20});C.bind("complete",function(){C=null})}}var A=1.70158,z=Math.PI/2,p=Math.abs,s=Math.pow,y=Math.sin,G=Math.asin,ca=Math.cos,W=[],C=null,m=false,t={linear:function(d,l,n,x){return n*d/x+l},backin:function(d,
l,n,x){return n*(d/=x)*d*((A+1)*d-A)+l},backout:function(d,l,n,x){return n*((d=d/x-1)*d*((A+1)*d+A)+1)+l},backinout:function(d,l,n,x){return(d/=x/2)<1?n/2*d*d*(((A*=1.525)+1)*d-A)+l:n/2*((d-=2)*d*(((A*=1.525)+1)*d+A)+2)+l},bouncein:function(d,l,n,x){return n-t.bounceout(x-d,0,n,x)+l},bounceout:function(d,l,n,x){return(d/=x)<1/2.75?n*7.5625*d*d+l:d<2/2.75?n*(7.5625*(d-=1.5/2.75)*d+0.75)+l:d<2.5/2.75?n*(7.5625*(d-=2.25/2.75)*d+0.9375)+l:n*(7.5625*(d-=2.625/2.75)*d+0.984375)+l},bounceinout:function(d,
l,n,x){return d<x/2?t.bouncein(d*2,0,n,x)/2+l:t.bounceout(d*2-x,0,n,x)/2+n/2+l},cubicin:function(d,l,n,x){return n*(d/=x)*d*d+l},cubicout:function(d,l,n,x){return n*((d=d/x-1)*d*d+1)+l},cubicinout:function(d,l,n,x){if((d/=x/2)<1)return n/2*d*d*d+l;return n/2*((d-=2)*d*d+2)+l},elasticin:function(d,l,n,x,L,J){if(d==0)return l;if((d/=x)==1)return l+n;J||(J=x*0.3);if(!L||L<p(n)){L=n;n=J/4}else n=J/TWO_PI*G(n/L);return-(L*s(2,10*(d-=1))*y((d*x-n)*TWO_PI/J))+l},elasticout:function(d,l,n,x,L,J){var E;if(d==
0)return l;if((d/=x)==1)return l+n;J||(J=x*0.3);if(!L||L<p(n)){L=n;E=J/4}else E=J/TWO_PI*G(n/L);return L*s(2,-10*d)*y((d*x-E)*TWO_PI/J)+n+l},elasticinout:function(d,l,n,x,L,J){var E;if(d==0)return l;if((d/=x/2)==2)return l+n;J||(J=x*0.3*1.5);if(!L||L<p(n)){L=n;E=J/4}else E=J/TWO_PI*G(n/L);if(d<1)return-0.5*L*s(2,10*(d-=1))*y((d*x-E)*TWO_PI/J)+l;return L*s(2,-10*(d-=1))*y((d*x-E)*TWO_PI/J)*0.5+n+l},quadin:function(d,l,n,x){return n*(d/=x)*d+l},quadout:function(d,l,n,x){return-n*(d/=x)*(d-2)+l},quadinout:function(d,
l,n,x){if((d/=x/2)<1)return n/2*d*d+l;return-n/2*(--d*(d-2)-1)+l},sinein:function(d,l,n,x){return-n*ca(d/x*z)+n+l},sineout:function(d,l,n,x){return n*y(d/x*z)+l},sineinout:function(d,l,n,x){return-n/2*(ca(Math.PI*d/x)-1)+l}},P=COG.Tween=function(d){d=COG.extend({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:Q("sine.out"),complete:null},d);var l=(new Date).getTime(),n=[],x=false,L=0,J=0,E={isComplete:function(){return x},triggerComplete:function(ha){d.complete&&d.complete(ha)},
update:function(ha){try{var da=d.tweenFn(ha-l,L,J,d.duration);if(d.target)d.target[d.property]=da;for(var ja=n.length;ja--;)n[ja](da,void 0);if(x=l+d.duration<=ha){if(d.target)d.target[d.property]=d.tweenFn(d.duration,L,J,d.duration);for(var U=n.length;U--;)n[U](da,true)}}catch(fa){COG.exception(fa)}},requestUpdates:function(ha){n.push(ha)}};L=d.target&&d.property&&d.target[d.property]?d.target[d.property]:d.startValue;if(typeof d.endValue!=="undefined")J=d.endValue-L;if(J==0)x=true;ba();return E};
COG.tweenValue=function(d,l,n,x,L){d=new P({startValue:d,endValue:l,tweenFn:n,complete:x,duration:L});W.push(d);return d};COG.tween=function(d,l,n,x,L,J){d=new P({target:d,property:l,endValue:n,tweenFn:x,duration:J,complete:L});W.push(d);return d};COG.endTweens=function(d){if(!m){m=true;try{for(var l=0;l<W.length;)if(!d||d(W[l])){W[l].triggerComplete(true);W.splice(l,1)}else l++}finally{m=false}}};COG.getTweens=function(){return[].concat(W)};var Q=COG.easing=function(d){return t[d.replace(/[\-\_\s\.]/g,
"").toLowerCase()]};COG.registerEasingType=function(d,l){t[d.replace(/[\-\_\s\.]/g,"").toLowerCase()]=l}})();
INTERACT=function(){function V(C){return function(m,t,P){(P?P:C?document.body:document).addEventListener(m,t,false)}}function ba(C){return function(m,t,P){(P?P:C?document.body:document).removeEventListener(m,t,false)}}function A(C,m,t){(t?t:document).attachEvent("on"+C,m)}function z(C,m,t){(t?t:document).detachEvent("on"+C,m)}function p(C,m){return{x:C?C:0,y:m?m:0,count:1}}function s(C,m){ca.push(COG.extend({handler:null,checks:{},type:C},m))}function y(C){var m=0,t=0;if(C.offsetParent){do{m+=C.offsetLeft;
t+=C.offsetTop;C=C.offsetParent}while(C)}return{x:m,y:t}}function G(C,m){return{x:C.x-(m?m.x:0),y:C.y-(m?m.y:0)}}var ca=[],W=function(C,m,t){function P(x,L,J,E){Q.trigger("pan",E.x,E.y)}t=COG.extend({binder:null,unbinder:null,observable:null},t);for(var Q=t.observable,d=[],l={bind:function(){return Q.bind.apply(null,arguments)},pannable:function(x){COG.extend({inertia:true},x);Q.bind("pointerMove",P);return l},unbind:function(){Q.unbind();for(var x=0;x<d.length;x++)d[x].unbind();return l}},n=0;n<
m.length;n++)d.push(m[n](C,Q,t));return l};s("pointer",{handler:function(C,m,t){function P(u){var X=u.target?u.target:u.srcElement;if(J||X&&X===C)if(E=u.button===0){fa=u.pageX?u.pageX:u.screenX;aa=u.pageY?u.pageY:u.screenY;ha=p(fa,aa);da=y(C);m.trigger("pointerDown",ha,G(ha,da))}}function Q(u){var X=u.target?u.target:u.srcElement;ja=u.pageX?u.pageX:u.screenX;U=u.pageY?u.pageY:u.screenY;if(E&&(J||X&&X===C))n("pointerMove")}function d(u){var X=u.target?u.target:u.srcElement;if(E&&u.button===0){E=false;
if(J||X&&X===C)n("pointerUp")}}function l(u){var X=u.target?u.target:u.srcElement;if(J||X&&X===C){X=u.detail?u.axis===2?-u.detail*x:0:u.wheelDeltaY;if(X!==0){var ta=p(ja,U);m.trigger("zoom",ta,G(ta,y(C)),X/L);if(u.preventDefault){u.preventDefault();u.stopPropagation()}else u.cancelBubble&&u.cancelBubble()}}}function n(u){var X=p(ja,U);m.trigger(u,X,G(X,da),p(ja-fa,U-aa));fa=ja;aa=U}t=COG.extend({inertia:false},t);var x=120,L=x*8,J=false,E=false,ha,da,ja,U,fa,aa;t.binder("mousedown",P,false);t.binder("mousemove",
Q,false);t.binder("mouseup",d,false);t.binder("click",function(u){var X=u.target?u.target:u.srcElement;if(J||X&&X===C){u=p(u.pageX?u.pageX:u.screenX,u.pageY?u.pageY:u.screenY);m.trigger("pointerTap",u,G(u,y(C)))}},false);t.binder("mousewheel",l,window);t.binder("DOMMouseScroll",l,window);return{unbind:function(){t.unbinder("mousedown",P,false);t.unbinder("mousemove",Q,false);t.unbinder("mouseup",d,false);t.unbinder("mousewheel",l,window);t.unbinder("DOMMouseScroll",l,window)}}},checks:{touch:false}});
s("pointer",{handler:function(C,m,t){function P(D){if(D.count<2)return 0;var M=D.x-D.next.x;D=D.y-D.next.y;return~~Math.sqrt(M*M+D*D)}function Q(D,M,O){M=M?M:0;O=O?O:0;for(var ma={x:D.x-M,y:D.y-O,id:D.id,count:D.count},la=ma;D.next;){D=D.next;la=la.next={x:D.x-M,y:D.y-O,id:D.id}}return ma}function d(D,M){var O=D[M?M:"touches"],ma,la;if(O.length===0)return null;la=ma={x:O[0].pageX,y:O[0].pageY,id:O[0].identifier,count:O.length};for(var ua=1,Ja=O.length;ua<Ja;ua++)la=la.next={x:O[ua].pageX,y:O[ua].pageY,
id:O[ua].identifier};return ma}function l(D){var M=D.target?D.target:D.srcElement;if(M&&M===C){U=y(C);M=d(D,"changedTouches");var O=Q(M,U.x,U.y);if(!aa){fa=ha;m.trigger("pointerDown",M,O)}xa&&m.trigger("pointerDownMulti",M,O);aa=d(D);if(aa.count>1)X=P(aa);Ba=1;ta=Q(aa)}}function n(D){var M=D.target?D.target:D.srcElement;if(M&&M===C){D.preventDefault();u=d(D);if(fa==ha)fa=Math.abs(aa.x-u.x)>J||Math.abs(aa.y-u.y)>J?E:ha;if(fa!=ha){fa=u.count>1?ja:da;if(fa==ja)if(aa.count===1){aa=Q(u);X=P(aa)}else{D=
P(u);if(Math.abs(X-D)<L)fa=da;else{M=u.x;var O=u.next.x,ma=u.y,la=u.next.y,ua=ma<la?ma:la;M={x:(M<O?M:O)+(Math.abs(M-O)>>1),y:ua+(Math.abs(ma-la)>>1)};D=D/X;O=D-Ba;m.trigger("zoom",M,G(M,U),O);Ba=D}}fa==da&&m.trigger("pointerMove",u,Q(u,U.x,U.y),p(u.x-ta.x,u.y-ta.y));xa&&m.trigger("pointerMoveMulti",u,Q(u,U.x,U.y))}ta=Q(u)}}function x(D){var M=D.target?D.target:D.srcElement;if(M&&M===C){M=d(D,"changedTouches");var O=Q(M,U.x,U.y);u=d(D);if(!u){fa===ha&&m.trigger("pointerTap",M,O);m.trigger("pointerUp",
M,O);aa=null}xa&&m.trigger("pointerUpMulti",M,O)}}t=COG.extend({detailed:false,inertia:false},t);var L=20,J=7,E=0,ha=1,da=2,ja=3,U,fa,aa,u,X,ta,xa=t.detailed,Ba=1;t.binder("touchstart",l,false);t.binder("touchmove",n,false);t.binder("touchend",x,false);COG.info("initialized touch handler");return{unbind:function(){t.unbinder("touchstart",l,false);t.unbinder("touchmove",n,false);t.unbinder("touchend",x,false)}}},checks:{touch:true}});return{register:s,watch:function(C,m,t){m=COG.extend({bindToBody:false,
observable:null,isIE:false,types:null},m);capabilities=COG.extend({touch:"ontouchstart"in window},t);if(!m.observable){COG.info("creating observable");m.observable=COG.observable({});globalOpts=m}m.binder=m.isIE?A:V(m.bindToBody);m.unbinder=m.isIE?z:ba(m.bindToBody);t=m.types;for(var P=capabilities,Q=[],d=ca.length;d--;){var l=ca[d],n=!t||t.indexOf(l.type)>=0,x=true;for(var L in l.checks){var J=l.checks[L];COG.info("checking "+L+" capability. require: "+J+", capability = "+P[L]);x=x&&J===P[L]}if(n&&
x)Q[Q.length]=l.handler}return new W(C,Q,m)}}}();
T5=function(){function V(){return(new Date).getTime()}function ba(){for(;X.length>0;){var b=X.shift();document.location=b}u=0}function A(b){for(var j=true,e=ta.length;e--;)j=j&&b!=ta[e];return j}function z(b,j){var e=[];for(var a in j)a&&e.push(a+"="+escape(j[a]));return"tile5://"+b+"/"+(e.length>0?"?"+e.join("&"):"")}function p(b,j){A(b)&&COG.info("would push url: "+z(b,j))}function s(b,j){if(A(b)){X.push(z(b,j));u||(u=setTimeout(ba,100))}}function y(b){return function(j,e,a){(a?a:b?document.body:
document).addEventListener(j,e,false)}}function G(b){return function(j,e,a){(a?a:b?document.body:document).removeEventListener(j,e,false)}}function ca(b,j,e){(e?e:document).attachEvent("on"+b,j)}function W(b,j,e){(e?e:document).detachEvent("on"+b,j)}function C(){U={base:{name:"Unknown",bindEvent:y(),unbindEvent:G(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:p,targetFps:null},ie:{name:"MSIE",regex:/msie/i,
bindEvent:ca,unbindEvent:W,requireFastDraw:false,targetFps:25},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:s,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:s},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:s},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:y(true),unbindEvent:G(true),supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},
bridgeNotify:s},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:s}};fa=[U.froyo,U.android,U.ipod,U.iphone,U.ipad,U.ie]}function m(){U||C();if(!aa){COG.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var b=0;b<fa.length;b++){var j=fa[b];if(j.regex&&j.regex.test(navigator.userAgent)){aa=COG.extend({},U.base,j);COG.info("PLATFORM DETECTED AS: "+aa.name);break}}if(!aa){COG.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
aa=U.base}COG.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return aa}function t(){for(var b=0,j=arguments.length;j--;){var e=M[arguments[j].toUpperCase()];if(e)b|=e}return b}var P=Math.abs,Q=Math.min,d=Math.max,l=Math.pow,n=Math.sqrt,x=Math.sin,L=Math.asin,J=Math.cos,E=function(){function b(a,c){return e(a.x-c.x,a.y-c.y)}function j(a,c){if(!c)c=a.length;if(c<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var f={edges:Array(c-1),accrued:Array(c-
1),total:0},g=0;g<c-1;g++){var i=b(a[g],a[g+1]);f.edges[g]=n(i.x*i.x+i.y*i.y);f.accrued[g]=f.total+f.edges[g];f.total+=f.edges[g]}return f}function e(a,c){return{x:a?a:0,y:c?c:0}}return{VECTOR_SIMPLIFICATION:3,SIMPLIFICATION_MIN_VECTORS:25,add:function(){for(var a=0,c=0,f=arguments.length;f--;){a+=arguments[f].x;c+=arguments[f].y}return e(a,c)},absSize:function(a){return d(P(a.x),P(a.y))},copy:function(a){return a?e(a.x,a.y):null},diff:b,distance:function(a,c){return j(a,c).total},edges:j,equals:function(a,
c){return a.x===c.x&&a.y===c.y},extendBy:function(a,c,f){var g=J(c)*f;c=x(c)*f;return e(a.x-g,a.y-c)},floor:function(a){for(var c=Array(a.length),f=a.length;f--;)c[f]=e(~~a[f].x,~~a[f].y);return c},getRect:function(a){for(var c,f,g,i,o=a.length;o--;){var h=a[o];c=typeof c==="undefined"||h.x<c?h.x:c;f=typeof f==="undefined"||h.y<f?h.y:f;g=typeof g==="undefined"||h.x>g?h.x:g;i=typeof i==="undefined"||h.y>i?h.y:i}return da.init(c,f,g,i)},init:e,invert:function(a){return e(-a.x,-a.y)},min:function(a,
c){return e(a.x<c.x?a.x:c.x,a.y<c.y?a.y:c.y)},max:function(a,c){return e(a.x>c.x?a.x:c.x,a.y>c.y?a.y:c.y)},offset:function(a,c,f){return e(a.x+c,a.y+(f?f:c))},simplify:function(a,c){if(!a)return null;c=c?c:E.VECTOR_SIMPLIFICATION;for(var f=[],g=null,i=a.length;i--;){var o=a[i];if(include=!g||i===0||P(o.x-g.x)+P(o.y-g.y)>c){f.unshift(o);g=o}}return f},theta:function(a,c,f){f=L((a.y-c.y)/f);return a.x>c.x?f:Math.PI-f}}}(),ha=function(){return{dotProduct:function(b,j){return b.x*j.x+b.y*j.y}}}(),da=
function(){function b(e){return j(e.x1,e.y1,e.x2,e.y2)}function j(e,a,c,f){e=e?e:0;a=a?a:0;c=typeof c!=="undefined"?c:e;f=typeof f!=="undefined "?f:f;return{x1:e,y1:a,x2:c,y2:f,width:c-e,height:f-a}}return{center:function(e){return E.init(e.x1+e.width/2,e.y1+e.height/2)},copy:b,diagonalSize:function(e){return n(e.width*e.width+e.height*e.height)},fromCenter:function(e,a,c,f){c=c>>1;f=f>>1;return j(e-c,a-f,e+c,a+f)},init:j,intersect:function(e,a){var c=d(e.x1,a.x1),f=d(e.y1,a.y1),g=Q(e.x2,a.x2),i=
Q(e.y2,a.y2);c=j(c,f,g,i);return c.width>0&&c.height>0?c:null},union:function(e,a){if(e.width===0||e.height===0)return b(a);else if(a.width===0||a.height===0)return b(e);else{var c=Q(e.x1,a.x1),f=Q(e.y1,a.y1),g=d(e.x2,a.x2),i=d(e.y2,a.y2);c=j(c,f,g,i);return c.width>0&&c.height>0?c:null}}}}(),ja=function(){return{getAspectRatio:function(b){return b.height!==0?b.width/b.height:1},getCenter:function(b){return E.init(b.width>>1,b.height>>1)},getSize:function(b){return n(l(b.width,2)+l(b.height,2))},
init:function(b,j){b=b?b:0;return{width:b,height:j?j:b}}}}(),U=null,fa=[],aa=null,u=0,X=[],ta=["view.wake","tile.loaded"],xa=function(){function b(){if(!H){var q=m().maxImageLoads;H=COG.Loopage.join({execute:function(K,N){if(!q||k.length<q){var I=h.shift();if(I){k[k.length]=I;I.image.onload=e;I.image.src=I.url;I.requested=T5.ticks()}else N.trigger("complete")}},frequency:10});H.bind("complete",function(){H=null})}}function j(){S=true;try{var q=r.length>>1;if(q>0){r.sort(function(N,I){return N.created-
I.created});for(var K=q;K--;)delete f[r[K].url];r.splice(0,q)}}finally{S=false}T.trigger("cacheCleared")}function e(){var q=i[this.id],K;if(q&&q.image.complete&&q.image.width>0){q.loaded=true;q.hitCount=1;for(K=k.length;K--;)if(k[K].image.src==this.src){k.splice(K,1);break}if(q.background||q.postProcess||q.drawBackground||q.customDraw)if(q.image){globalImageData=q;K=c(q.realSize?q.realSize.width:q.image.width,q.realSize?q.realSize.height:q.image.height);var N=K.getContext("2d"),I=q.offset?q.offset:
T5.XY.init();q.background&&N.drawImage(q.background,0,0);q.drawBackground&&q.drawBackground(N);q.customDraw?q.customDraw(N,q):N.drawImage(q.image,I.x,I.y);q.postProcess&&q.postProcess(N,q);q.image=K}for(K=q.callbacks.length;K--;)q.callbacks[K]&&q.callbacks[K](this,false);q.callbacks=[];r[r.length]={url:this.src,created:q.requested};delete i[this.id];b()}}function a(q,K,N){var I=f[q];if(I){I.hitCount++;I.image.complete&&I.image.width>0&&K?K(I.image,true):I.callbacks.push(K)}else{I=COG.extend({url:q,
image:new Image,loaded:false,created:T5.ticks(),requested:null,hitCount:0,callbacks:[K]},N);I.image.id="resourceLoaderImage"+o++;f[q]=I;i[I.image.id]=I;h[h.length]=I;b()}return I}function c(q,K){var N=document.createElement("canvas");N.width=q?q:0;N.height=K?K:0;if(typeof FlashCanvas!=="undefined"){N.id="tmpCanvas"+g++;N.style.cssText="position: absolute; top: -"+(K-1)+"px; left: -"+(q-1)+"px;";document.body.appendChild(N);FlashCanvas.initElement(N)}typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(N);
return N}var f={},g=0,i={},o=0,h=[],k=[],r=[],B=0,H=null,S=false,T={avgImageSize:25,loadTimeout:10,cancelLoad:function(){k=[]},get:function(q,K,N){var I=null,R=null;S||(I=f[q]);if((R=I?I.image:null)&&(R.getContext||R.complete&&R.width>0))return R;else K&&a(q,K,N);return null},load:a,newCanvas:c,reset:function(){f={}},stats:function(){return{imageLoadingCount:k.length,queuedImageCount:h.length,imageCacheFullness:B}}};COG.observable(T);COG.Loopage.join({execute:function(q){for(var K=false,N=0,I=m();N<
k.length;)if(q-k[N].requested>T.loadTimeout*1E3){k.splice(N,1);K=true}else N++;K&&b();if(I&&I.imageCacheMaxSize){B=r.length*T.avgImageSize/I.imageCacheMaxSize;B>=1&&j()}},frequency:2E4});return T}(),Ba=function(){var b={};return{init:function(j,e){var a=b[j];if(!a)throw Error("Unable to locate requested generator: "+j);return new a(e)},register:function(j,e){b[j]=e},Template:function(){}}}(),D=function(){function b(g,i){c[g]=e(i);return g}function j(g){for(var i in g)b(i,g[i])}function e(g){function i(r){var B=
g[r];typeof B!=="undefined"&&h.push(function(H){H[r]=B})}function o(){h=[];for(var r in g)i(r)}g=COG.extend({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},g);var h=[],k={applyToContext:function(r){for(var B=h.length;B--;)h[B](r)},update:function(r,B){g[r]=B;o()}};o();return k}var a={},c={},f={apply:function(g,i){var o=c[i]?c[i]:c.basic,h;if(g&&g.canvas){h=a[g.canvas.id];
a[g.canvas.id]=i}o.applyToContext(g);return h},define:b,defineMany:j,get:function(g){return c[g]},init:e,load:function(g){COG.jsonp(g,function(i){j(i)})}};j({basic:{lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"},waypoints:{lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"}});return f}(),M={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,ZOOM:16,FREEZE:128},O=function(b){b=COG.extend({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:t("ACTIVE","ANIMATING","PAN","ZOOM"),style:null,
minXY:null,maxXY:null},b);var j=null,e=false,a=false,c=b.supportFastDraw,f=b.id,g=t("ACTIVE"),i=b.validStates,o=0,h=0,k=COG.extend({addToView:function(r){r.setLayer(f,k)},shouldDraw:function(r,B,H){return(a||H||o!==B.x1||h!==B.y1)&&(r&i)!==0&&(e?c:true)},clip:null,cycle:function(){},draw:function(){},remove:function(){k.trigger("remove",k)},changed:function(r){a=true;k.trigger("changed",k);j&&j.trigger("invalidate",r)},getId:function(){return f},setId:function(r){f=r},getParent:function(){return j},
setParent:function(r){e=(j=r)?j.fastDraw&&displayState!==g:false;k.trigger("parentChange",j)}},b);COG.observable(k);k.bind("drawComplete",function(r,B){a=false;o=B.x1;h=B.y1});k.bind("resync",function(r,B){if(B.syncXY){k.minXY&&B.syncXY(k.minXY);k.maxXY&&B.syncXY(k.maxXY)}});return k},ma=function(b){function j(o,h,k,r){a=o;c=h;f=k;g=r}b=COG.extend({xy:E.init(),offset:true,tweenIn:null,animationSpeed:null,isNew:true},b);var e=false,a=0,c=0,f=0,g=0,i=COG.extend(b,{isAnimating:function(){return e},draw:function(o,
h,k,r,B){if(i.isNew&&b.tweenIn){var H=i.xy.y;i.xy.y=h.y1-20;e=true;COG.tween(i.xy,"y",H,b.tweenIn,function(){i.xy.y=H>>0;e=false},b.animationSpeed?b.animationSpeed:250+Math.random()*500)}i.drawMarker(o,h,i.xy.x,i.xy.y,k,r,B);i.isNew=false},drawMarker:function(o,h,k,r){o.beginPath();o.arc(k,r,4,0,Math.PI*2,false);o.fill();j(k-4,r-4,8,8)},hitTest:function(o,h){return o>=a&&o<=a+f&&h>=c&&h<=c+g},updateBounds:j});COG.observable(i);return i},la=function(b){function j(){c.changed();c.trigger("markerUpdate",
a)}function e(){var f=c.getParent();if(f&&f.syncXY)for(var g=a.length;g--;)f.syncXY([a[g].xy])}b=COG.extend({zindex:100,style:"basic"},b);var a=[],c=COG.extend(new O(b),{draw:function(f,g,i,o){for(var h=a.length;h--;)a[h].draw(f,g,i,c,o)},add:function(f){if(f&&typeof f.length!=="undefined")for(var g=f.length;g--;){if(f[g])a[a.length]=f[g]}else if(f)a[a.length]=f;j()},clear:function(f){if(f)for(var g=0;g<a.length;g++)f(a[g])&&a.splice(g,1);else a=[];j()},each:function(f){if(f)for(var g=a.length;g--;)f(a[g])},
find:function(f){for(var g=[],i=a.length;i--;)if(!f||f(a[i]))g[g.length]=a[i];return g}});c.bind("tap",function(f,g,i,o){var h=[],k=o.x;o=o.y;for(var r=a.length;r--;)if(a[r].hitTest(k,o))h[h.length]=a[r];if(h.length>0)f.cancel=c.trigger("markerTap",g,i,h).cancel});c.bind("parentChange",e);c.bind("resync",e);c.bind("changed",e);return c},ua=function(b){function j(i,o,h){i.fillStyle="#FFFFFF";i.strokeStyle="#222222";i.beginPath();i.arc(h.x,h.y,4,0,Math.PI*2,false);i.stroke();i.fill()}b=COG.extend({path:[],
id:COG.objId("pathAni"),easing:COG.easing("sine.inout"),validStates:t("ACTIVE","PAN","ZOOM"),drawIndicator:null,duration:2E3},b);var e=E.edges(b.path),a,c=null,f=0;COG.tweenValue(0,e.total,b.easing,function(){g.remove()},b.duration).requestUpdates(function(i,o){f=i;o&&g.remove()});var g=COG.extend(new O(b),{cycle:function(){for(var i=0;i<e.accrued.length&&e.accrued[i]<f;)i++;c=null;if(i<b.path.length-1){var o=f-(i>0?e.accrued[i-1]:0),h=b.path[i];a=E.theta(h,b.path[i+1],e.edges[i]);c=E.extendBy(h,
a,o)}return c},draw:function(i,o){if(c)(b.drawIndicator?b.drawIndicator:j)(i,o,E.init(c.x,c.y),a)}});return g},Ja=function(b){b=COG.extend({style:null,properties:{}},b);return COG.extend(b,{rect:null,draw:function(){},resync:function(){}})},db=function(){return{tileSize:256,init:function(b,j,e,a,c){return COG.extend({x:b,y:j,width:e,height:a},c)}}}(),Ma={ex:COG.extend,ticks:V,getConfig:m,userMessage:function(b,j,e){Ma.trigger("userMessage",b,j,e)},XY:E,XYRect:da,Dimensions:ja,Vector:ha,D:ja,Images:xa,
Generator:Ba,tween:COG.tween,tweenValue:COG.tweenValue,easing:COG.easing,Tween:COG.Tween,Style:D,viewState:t,View:function(b){function j(v,w,F,Z){va=Ka;q();if(Z&&b.inertia)o(oa-w,pa-F,b.panAnimationEasing,b.panAnimationDuration);else Z||o(oa-w,pa-F);clearTimeout(Ya);Ya=setTimeout(e,100)}function e(){va=Na;ya=false;q()}function a(v,w,F,Z){ia.zoom(F,Z)}function c(v){H();var w=E.init(Oa-(Ea.width/(ea*2)>>0),Pa-(Ea.height/(ea*2)>>0)),F=Math.log(ea)/Math.LN2>>0;if(ea!==1)va=Za;if(F!==0){ea=Math.pow(2,
F);if(!ia.trigger("scale",ea,w).cancel){for(v=R.length;v--;)R[v].trigger("scale",ea,w);ea=1;eb=null;va=Na;v=true}}q(v)}function f(v){Qa=E.init(qa.x1,qa.y1);Ra=E.offset(v,qa.x1,qa.y1)}function g(){clearTimeout($a);$a=setTimeout(h,250)}function i(v,w,F){I("tap",w,F,E.offset(F,oa,pa))}function o(v,w,F,Z,Y){function ga(){wa+=1;if(wa>=2){e();Y&&Y()}}var wa=0,za=Ca?E.offset(Ca,-Ga,-Ha):null,Ia=Da?E.offset(Da,-Ga,-Ha):null;if(za){v=v<za.x?za.x:v;w=w<za.y?za.y:w}if(Ia){v=v>Ia.x?Ia.x:v;w=w>Ia.y?Ia.y:w}if(F){if(!ya){v=
COG.tweenValue(oa,v,F,ga,Z);w=COG.tweenValue(pa,w,F,ga,Z);v.cancelOnInteract=true;v.requestUpdates(function(Sa){oa=Sa>>0;ya=true;q()});w.cancelOnInteract=true;w.requestUpdates(function(Sa){pa=Sa>>0;ya=true;q()})}}else{oa=v>>0;pa=w>>0}}function h(v,w){var F;if(na){Aa&&Aa.unbind();if(b.autoSize&&na.parentNode){F=na.parentNode.getBoundingClientRect();if(F.height!==0&&F.width!==0){v=F.width;w=F.height}}try{if(!na.id)na.id=b.id+"_canvas";$=na.getContext("2d")}catch(Z){COG.exception(Z);throw Error("Could not initialise canvas on specified view element");
}if(v&&w&&(ra!==w||sa!==v)){Ta=true;sa=v;ra=w;Ga=sa>>1;Ha=ra>>1;ia.trigger("resize",sa,ra);for(F=ka;F--;)R[F].trigger("resize",sa,ra)}if(b.interactive){Aa=INTERACT.watch(na).pannable();r()}for(F=ka;F--;)R[F].trigger("contextChanged",$);q(true)}}function k(v,w){w.setId(v);w.added=V();w.bind("remove",function(){ia.removeLayer(v)});w.trigger("contextChanged",$);w.setParent(ia);R.push(w);R.sort(function(F,Z){var Y=Z.zindex-F.zindex;if(Y===0)Y=Z.added-F.added;return Y});ka=R.length;return w}function r(){if(Aa){if(b.pannable){Aa.bind("pan",
j);Aa.bind("inertiaCancel",function(){ya=false;q()})}b.scalable&&Aa.bind("zoom",a);Aa.bind("pointerTap",i)}}function B(){I("idle",ia);Ua=true;Fa=0}function H(v){var w=1/ea;Oa=Ra.x+(oa-Qa.x);Pa=Ra.y+(pa-Qa.y);if(v)return da.fromCenter(Oa>>0,Pa>>0,v.width*w>>0,v.height*w>>0)}function S(v,w,F,Z){var Y,ga=0;qa=da.copy(w);F&&$.clearRect(0,0,sa,ra);$.save();try{$.globalCompositeOperation="source-over";if(ea!==1){qa=H(qa);$.scale(ea,ea)}$.translate(-qa.x1,-qa.y1);Da=Ca=null;if(fb){$.beginPath();clipped=
false;for(ga=ka;ga--;)if(R[ga].clip){R[ga].clip($,qa,v,ia,F,Z);clipped=true}$.closePath();clipped&&$.clip()}for(ga=ka;ga--;){Y=R[ga];var wa=Y.style,za=wa?D.apply($,wa):null;if(Y.minXY)Ca=Ca?E.min(Ca,Y.minXY):E.copy(Y.minXY);if(Y.maxXY)Da=Da?E.max(Da,Y.maxXY):E.copy(Y.maxXY);Y.draw($,qa,v,ia,F,Z);za&&D.apply($,za)}}finally{$.restore()}if(gb){$.globalCompositeOperation="source-over";$.strokeStyle="#f00";$.beginPath();$.moveTo(Ga,0);$.lineTo(Ga,ra);$.moveTo(0,Ha);$.lineTo(sa,Ha);$.stroke()}I("drawComplete",
w,Z);COG.trace("draw complete",Z)}function T(v,w){var F=false,Z=Va?Va:ya?Ka:va,Y=!ya&&(Z===Za||Z===Ka),ga=Wa||Z===Ka||COG.getTweens().length>0;if(Ta&&na){na.width=sa;na.height=ra;Ta=false}Ea=N();if(Y){COG.endTweens(function(wa){return wa.cancelOnInteract});Ua=false;if(Fa!==0){clearTimeout(Fa);Fa=0}}for(Y=ka;Y--;){if(R[Y].animated)va|=ab;R[Y].cycle(v,Ea,va,ga);F=R[Y].shouldDraw(va,Ea,ga)||F}ga=ga||(va&ab)!==0;if(F=F||ga||ea!==1&&ea!==bb){S(Z,Ea,ga,v);bb=ea;Wa=false}if(!F&&Xa===0&&!hb){if(!Ua&&Fa===
0)Fa=setTimeout(B,500);w.trigger("complete")}Xa=0;COG.trace("Completed draw cycle",v)}function q(v){Wa=v?true:false;Xa+=1;if(!La){La=COG.Loopage.join({execute:T,frequency:ib});La.bind("complete",function(){La=null})}}function K(){return ja.init(sa,ra)}function N(){return da.init(oa,pa,oa+sa,pa+ra)}function I(){for(var v=ia.trigger.apply(null,arguments).cancel,w=R.length;w--;)v=R[w].trigger.apply(null,arguments).cancel||v;return!v}b=COG.extend({id:COG.objId("view"),container:"",fastDraw:false,inertia:true,
pannable:true,clipping:false,scalable:true,interactive:true,panAnimationEasing:COG.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:true,tapExtent:10,mask:true,guides:false,fps:25},b);var R=[],ka=0,na=document.getElementById(b.container),$=null,oa=0,pa=0,fb=b.clipping,Ea=null,La=null,qa,gb=b.guides,cb=1,Xa=0,Ga=0,Ha=0,Qa=null,Ra=null,Ua=false,ya=false,Fa=0,Ya=0,Ca=null,Da=null,jb=0,Va=null,Wa=false,$a=0,eb=null,ea=1,bb=0,Ta=false,Aa=null,ra,sa,
hb=typeof FlashCanvas!=="undefined",ib=~~(1E3/b.fps),Oa,Pa,Na=t("ACTIVE"),Ka=t("PAN"),Za=t("ZOOM"),ab=t("ANIMATING"),va=Na,ia={id:b.id,deviceScaling:cb,fastDraw:b.fastDraw||m().requireFastDraw,getDimensions:K,getLayer:function(v){for(var w=0;w<ka;w++)if(R[w].getId()==v)return R[w];return null},setLayer:function(v,w){for(var F=0;F<ka;F++)if(R[F].getId()===v){R.splice(F,1);break}w&&k(v,w);q();return w},eachLayer:function(v){for(var w=ka;w--;)v(R[w])},invalidate:q,resize:function(v,w){if(na){b.autoSize=
false;if(sa!==v||ra!==w)h(v,w)}},scale:function(v,w,F,Z){function Y(){ea=Math.pow(2,Math.round(Math.log(ea)/Math.LN2));Z&&Z();c(true)}var ga=ea;w||(w=ja.getCenter(K()));f(w);if(F)COG.tweenValue(0,v-ga,F,Y,1E3).requestUpdates(function(wa){ea=ga+wa;c()});else{ea=v;Y()}return ia},triggerAll:I,removeLayer:function(v){a:{for(var w=ka;w--;)if(R[w].getId()==v){v=w;break a}v=-1}if(v>=0&&v<ka){ia.trigger("layerRemoved",R[v]);R.splice(v,1);q()}ka=R.length},stateOverride:function(v){Va=v},getOffset:function(){return E.init(oa,
pa)},getViewRect:N,updateOffset:o,pan:function(v,w,F,Z,Y){o(oa+v,pa+w,F,Z,Y)},zoom:function(v,w){f(v);ya=false;ea=Math.max(ea+Math.pow(2,w)-1,0.25);c()}};cb=m().getScaling();ia.markers=k("markers",new la);COG.observable(ia);ia.bind("invalidate",function(v,w){q(w)});ia.bind("resync",function(){Da=Ca=null});COG.configurable(ia,["inertia","container","rotation","tapExtent","scalable","pannable"],COG.paramTweaker(b,null,{container:function(v,w){na=document.getElementById(w);h()},rotation:function(v,w){jb=
w}}),true);h();b.autoSize&&window.addEventListener("resize",g,false);return ia},ViewLayer:O,ImageLayer:function(b,j){function e(h,k,r){for(k=f.length;k--;){var B=f[k],H=B.x,S=B.y,T=da.init(B.x,B.y,B.x+B.width,B.y+B.height);if(r&&da.intersect(h,T)){T=xa.get(B.url,function(){o.changed()},i);r(T,H,S,B.width,B.height)}}}function a(h){c&&c.run(h,function(k){f=[].concat(k);o.changed()})}j=COG.extend({imageLoadArgs:{}},j);var c=b?Ba.init(b,j):null,f=[],g=da.init(),i=j.imageLoadArgs,o=COG.extend(new O(j),
{changeGenerator:function(h,k){c=Ba.init(h,COG.extend({},j,k));c.bindToView(o.getParent());f=null;a(g)},clip:function(h,k,r){e(k,r,function(B,H,S,T,q){B&&h.rect(H,S,T,q)})},cycle:function(h,k){a(k)},draw:function(h,k,r){e(k,r,function(B,H,S,T,q){o.drawImage(h,B,H,S,T,q,k,r)});g=da.copy(k)},drawImage:function(h,k,r,B){k&&h.drawImage(k,r,B,k.width,k.height)}});o.bind("idle",function(){a(g)});o.bind("parentChange",function(h,k){c&&c.bindToView(k)});o.bind("tap",function(h,k,r,B){h=[];var H=B.x,S=B.y,
T,q;if(f)for(var K=f.length;K--;){T=f[K];if(q=H>=T.x&&H<=T.x+T.width&&S>=T.y&&S<=T.y+T.height)h[h.length]=T}h.length>0&&o.trigger("tapImage",h,k,r,B)});return o},Marker:ma,ImageMarker:function(b){b=COG.extend({image:null,imageUrl:null,animatingImage:null,animatingImageUrl:null,imageAnchor:null,rotation:0,scale:1,opacity:1},b);var j=b.imageAnchor?T5.XY.invert(b.imageAnchor):null,e=COG.extend(new ma(b),{drawMarker:function(a,c,f,g){if((c=e.isAnimating()&&e.animatingImage?e.animatingImage:e.image)&&
c.width>0){j||(j=E.init(-c.width>>1,-c.height>>1));var i=e.scale,o=f+~~(j.x*i),h=g+~~(j.y*i),k=~~(c.width*i),r=~~(c.height*i);e.updateBounds(o,h,k,k);if(e.rotation||e.opacity!==1){a.save();try{a.globalAlpha=e.opacity;a.translate(f,g);a.rotate(e.rotation);a.drawImage(c,j.x*i,j.y*i,k,r)}finally{a.restore()}}else a.drawImage(c,o,h,k,r)}}});if(!e.image)e.image=xa.get(b.imageUrl,function(a){e.image=a});if(!e.animatingImage)e.animatingImage=xa.get(b.animatingImageUrl,function(a){e.animatingImage=a});return e},
MarkerLayer:la,PathLayer:function(b){b=COG.extend({style:"waypoints",pixelGeneralization:8,zindex:50},b);var j=false,e=[],a=null,c=[],f=null,g=0,i=[],o=COG.extend(new O(b),{getAnimation:function(h,k,r,B){var H="pathAnimation"+g++;i.push(H);return new ua({id:H,path:e,zindex:b.zindex+1,easing:h?h:COG.easing("sine.inout"),duration:k?k:5E3,drawIndicator:r,autoCenter:B?B:false})},cycle:function(h,k,r,B){return B},draw:function(h){var k,r=e.length;h.save();try{D.apply(h,b.style);if(r>0){h.beginPath();h.moveTo(e[r-
1].x,e[r-1].y);for(k=r;k--;)h.lineTo(e[k].x,e[k].y);h.stroke();if(a){h.fillStyle=b.waypointFillStyle;for(k=a.length;k--;){h.beginPath();h.arc(a[k].x,a[k].y,2,0,Math.PI*2,false);h.stroke();h.fill()}}}}finally{h.restore()}j=false},updateCoordinates:function(h,k){c=h;f=k;var r=o.getParent();if(r&&r.syncXY){r.syncXY(c);f&&r.syncXY(f);o.trigger("tidy")}}});o.bind("tidy",function(){e=E.simplify(c,b.pixelGeneralization);a=E.simplify(f,b.pixelGeneralization);j=true;o.changed()});return o},AnimatedPathLayer:ua,
Shape:Ja,Arc:function(b,j){j=COG.extend({size:4},j);var e=E.init(),a=COG.extend(j,{draw:function(c){c.beginPath();c.arc(e.x,e.y,a.size,0,Math.PI*2,false);c.fill();c.stroke()},resync:function(c){c.syncXY([b]);e=E.floor([b])[0]}});COG.info("created arc = ",b);return a},Poly:function(b,j){j=COG.extend({fill:false,simplify:false},j);var e=false,a=j.fill,c=j.simplify,f=t("ZOOM"),g=[],i=COG.extend(new Ja(j),{draw:function(o,h,k,r,B,H){if(e){h=true;k=(H&f)!==0;o.beginPath();for(H=g.length;H--;){k=g[H].x;
r=g[H].y;if(h){o.moveTo(k,r);h=false}else o.lineTo(k,r);k=true}if(k){a&&o.fill();o.stroke()}}},resync:function(o){i.xy=o.syncXY(b);g=E.floor(c?E.simplify(b):b)}});e=b&&b.length>=2;return i},ShapeLayer:function(b){function j(f){for(var g=a.length;g--;)a[g].resync(f);a.sort(function(i,o){var h=o.xy.y-i.xy.y;if(h===0)h=o.xy.x-i.xy.y;return h});c.changed()}function e(f,g){g.syncXY&&j(g)}b=COG.extend({zindex:80},b);var a=[],c=COG.extend(new O(b),{add:function(f){a[a.length]=f},each:function(f){for(var g=
a.length;g--;)f(a[g])},draw:function(f,g,i){var o=g.x1,h=g.y1,k=g.width;g=g.height;for(var r=a.length;r--;){var B=a[r].style;B=B?D.apply(f,B):null;a[r].draw(f,o,h,k,g,i);B&&D.apply(f,B)}}});c.bind("parentChange",e);c.bind("resync",e);return c},Tiling:db,TileGenerator:function(b){function j(S,T,q,K){function N(){if(H.initTileCreator){i=true;H.initTileCreator(S,T,q,K)}}H.prepTileCreator?H.prepTileCreator(S,T,q,N):N()}function e(S,T){for(var q=~~((S.x1-f.x)/o),K=~~((S.y1-f.y)/h),N=[],I=-g;I<r;I++)for(var R=
-g;R<B;R++){var ka=k(q+I,K+R);if(ka)N[N.length]=ka}T&&T(N);c=da.copy(S)}b=COG.extend({tileWidth:256,tileHeight:256,relative:false,padding:2},b);var a=null,c=null,f=E.init(),g=b.padding,i=false,o=b.tileWidth,h=b.tileHeight,k=null,r=0,B=0,H={bindToView:function(S){COG.info("initializing generator");a=S;H.trigger("bindView",S)},getTileCreatorArgs:null,initTileCreator:null,prepTileCreator:null,requireRefresh:function(){return false},reset:function(){k=null;i=false;c=null},run:function(S,T){if(!c||Math.abs(S.x1-
c.x1)>o||Math.abs(S.y1-c.y1)>h){if(!k&&!i||H.requireRefresh()){f=b.relative?E.init(S.x1,S.y1):E.init();r=Math.ceil(S.width/o)+g;B=Math.ceil(S.height/h)+g;j(o,h,H.getTileCreatorArgs?H.getTileCreatorArgs(a):{},function(q){k=q;i=false;e(S,T)})}k&&e(S,T)}}};COG.observable(H);H.bind("update",function(){COG.info("captured generator update");c=null});return H}};COG.observable(Ma);return Ma}();
