COG=typeof COG!=="undefined"?COG:{};COG.extend=function(){for(var I=arguments[0]||{},S,B=1,y=arguments.length;B<y;B++)if((S=arguments[B])!==null)for(var j in S){var i=S[j];if(I!==i)if(i!==undefined)I[j]=i}return I};
(function(){var I=Object.prototype.hasOwnProperty,S=0,B={};B.toID=function(y){return y.replace(/\s/g,"-")};B.objId=function(y){return(y?y:"obj")+S++};B.isFunction=function(y){return toString.call(y)==="[object Function]"};B.isArray=function(y){return toString.call(y)==="[object Array]"};B.isPlainObject=function(y){if(!y||toString.call(y)!=="[object Object]"||y.nodeType||y.setInterval)return false;if(y.constructor&&!I.call(y,"constructor")&&!I.call(y.constructor.prototype,"isPrototypeOf"))return false;
var j;for(j in y);return j===undefined||I.call(y,j)};B.isEmptyObject=function(y){for(var j in y)return false;return true};B.isXmlDocument=function(y){return toString.call(y)==="[object Document]"};B.contains=function(y,j){var i=y,v=arguments,s=1;if(j&&module.isArray(j)){v=j;s=0}for(s=s;s<v;s++)i=i&&typeof foo[v[s]]!=="undefined";return i};B.formatStr=function(y){if(arguments.length<=1)return y;for(var j=arguments.length-2,i=0;i<=j;i++)y=y.replace(RegExp("\\{"+i+"\\}","gi"),arguments[i+1]);return y};
B.wordExists=function(y,j){var i="";if(j.toString)j=j.toString();for(var v=0;v<j.length;v++)i+=!/\w/.test(j[v])?"\\"+j[v]:j[v];return RegExp("(^|\\s|\\,)"+i+"(\\,|\\s|$)","i").test(y)};COG.extend(COG,B)})();
(function(){function I(i){return typeof console!=="undefined"?function(){console[i](Array.prototype.slice.call(arguments,0).join(" "));return true}:function(){return false}}var S=window.console&&window.console.markTimeline,B=I("error"),y=I("info"),j=function(){return S?function(i,v){console.markTimeline(i+(v?": "+((new Date).getTime()-v)+"ms":""))}:function(){}}();COG.extend(COG,{trace:j,debug:I("debug"),info:y,warn:I("warn"),error:B,exception:function(i){if(B)for(var v in i)y("ERROR DETAIL: "+v+
": "+i[v])}})})();var FNS_TIME=["webkitAnimationTime","mozAnimationTime","animationTime","webkitAnimationStartTime","mozAnimationStartTime","animationStartTime"],FNS_FRAME=["webkitRequestAnimationFrame","mozRequestAnimationFrame","requestAnimationFrame"],animTime=function(){return(new Date).getTime()},animFrame=function(I){setTimeout(function(){I(animTime())},1E3/60)};FNS_TIME.forEach(function(I){if(I in window)animTime=function(){return window[I]}});
FNS_FRAME.forEach(function(I){if(I in window)animFrame=function(S){window[I](S)}});COG.animTime=animTime;COG.animFrame=animFrame;
COG.Loopage=function(){function I(s){return COG.extend({id:j++,frequency:0,after:0,single:false,lastTick:0,execute:function(){}},s)}function S(s){v.push(s);y||(y=animFrame(B));recalcSleepFrequency=true}function B(){for(var s,N=animTime(),Q=i.length;v.length>0;){var ba=v.shift();for(s=Q;s--;)if(i[s].id===ba){i.splice(s,1);break}Q=i.length}for(s=Q;s--;){ba=N-i[s].lastTick;if(i[s].lastTick===0||ba>=i[s].frequency){i[s].execute(N,i[s]);i[s].lastTick=N;i[s].single&&i[s].trigger("complete")}}y=Q?animFrame(B):
0}var y=0,j=0,i=[],v=[];return{join:function(s){var N=new I(s);if(N.after>0)N.lastTick=(new Date).getTime()+N.after;COG.observable(N);N.bind("complete",function(){S(N.id)});i.unshift(N);y||(y=animFrame(B));recalcSleepFrequency=true;return N},leave:S}}();
(function(){function I(B,y){var j=B.obsHandlers;j[y]||(j[y]=[]);return j[y]}var S=0;COG.observable=function(B){if(!B)return null;if(!B.obsHandlers)B.obsHandlers={};if(!(B.bind||B.trigger||B.unbind)){B.bind=function(y,j){var i="callback"+S++;I(B,y).unshift({fn:j,id:i});return i};B.trigger=function(y){var j=I(B,y),i={cancel:false,name:y},v;if(!j)return null;v=Array.prototype.slice.call(arguments,1);B.eventInterceptor&&B.eventInterceptor(y,i,v);v.unshift(i);for(var s=j.length;s--&&!i.cancel;)j[s].fn.apply(self,
v);return i};B.unbind=function(y,j){if(typeof y==="undefined")B.obsHandlers={};else for(var i=I(B,y),v=0;i&&v<i.length;v++)if(i[v].id===j){i.splice(v,1);break}return B}}return B}})();
(function(){function I(j,i){j[i]||(j[i]=function(v){return j.configure(i,v)})}function S(j){j.gtConfId="configurable"+y++;j.gtConfig={};j.gtConfigFns=[];return j.gtConfig}var B={},y=0;COG.paramTweaker=function(j,i,v){return function(s,N){if(typeof N!=="undefined"){if(s in j)j[s]=N;v&&s in v&&v[s](s,N)}else return i&&s in i?i[s](s):j[s]}};COG.configurable=function(j,i,v,s){if(j){j.gtConfId||S(j);var N=j.gtConfId,Q=j.gtConfig,ba=j.gtConfigFns;B[N]=j;ba.push(v);for(v=i.length;v--;){Q[i[v]]=true;s&&I(j,
i[v])}if(!j.configure)j.configure=function(ia,z){if(Q[ia]){for(var C=ba.length;C--;){var A=ba[C](ia,z);if(typeof A!=="undefined")return A}return B[N]}return null}}}})();
(function(){function I(j){var i=document.createElement("script"),v=false;i.src=j;i.async=true;i.onload=i.onreadystatechange=function(){if(!v&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){v=true;i.onload=i.onreadystatechange=null;i&&i.parentNode&&i.parentNode.removeChild(i)}};B||(B=document.getElementsByTagName("head")[0]);B.appendChild(i)}var S=0,B,y=this;COG.jsonp=function(j,i,v){j+=j.indexOf("?")>=0?"&":"?";var s="json"+ ++S;y[s]=function(N){i(N);y[s]=null;try{delete y[s]}catch(Q){}};
I(j+(v?v:"callback")+"="+s);return s}})();
(function(){function I(c){if(ia)return Q.length;ia=true;try{for(var n=0;n<Q.length;)if(Q[n].isComplete()){Q[n].triggerComplete(false);Q.splice(n,1)}else{Q[n].update(c);n++}}finally{ia=false}Q.length===0&&ba.trigger("complete");return Q.length}function S(){if(!ba){ba=COG.Loopage.join({execute:I,frequency:20});ba.bind("complete",function(){ba=null})}}var B=1.70158,y=Math.PI/2,j=Math.abs,i=Math.pow,v=Math.sin,s=Math.asin,N=Math.cos,Q=[],ba=null,ia=false,z={linear:function(c,n,o,w){return o*c/w+n},backin:function(c,
n,o,w){return o*(c/=w)*c*((B+1)*c-B)+n},backout:function(c,n,o,w){return o*((c=c/w-1)*c*((B+1)*c+B)+1)+n},backinout:function(c,n,o,w){return(c/=w/2)<1?o/2*c*c*(((B*=1.525)+1)*c-B)+n:o/2*((c-=2)*c*(((B*=1.525)+1)*c+B)+2)+n},bouncein:function(c,n,o,w){return o-z.bounceout(w-c,0,o,w)+n},bounceout:function(c,n,o,w){return(c/=w)<1/2.75?o*7.5625*c*c+n:c<2/2.75?o*(7.5625*(c-=1.5/2.75)*c+0.75)+n:c<2.5/2.75?o*(7.5625*(c-=2.25/2.75)*c+0.9375)+n:o*(7.5625*(c-=2.625/2.75)*c+0.984375)+n},bounceinout:function(c,
n,o,w){return c<w/2?z.bouncein(c*2,0,o,w)/2+n:z.bounceout(c*2-w,0,o,w)/2+o/2+n},cubicin:function(c,n,o,w){return o*(c/=w)*c*c+n},cubicout:function(c,n,o,w){return o*((c=c/w-1)*c*c+1)+n},cubicinout:function(c,n,o,w){if((c/=w/2)<1)return o/2*c*c*c+n;return o/2*((c-=2)*c*c+2)+n},elasticin:function(c,n,o,w,H,G){if(c==0)return n;if((c/=w)==1)return n+o;G||(G=w*0.3);if(!H||H<j(o)){H=o;o=G/4}else o=G/TWO_PI*s(o/H);return-(H*i(2,10*(c-=1))*v((c*w-o)*TWO_PI/G))+n},elasticout:function(c,n,o,w,H,G){var P;if(c==
0)return n;if((c/=w)==1)return n+o;G||(G=w*0.3);if(!H||H<j(o)){H=o;P=G/4}else P=G/TWO_PI*s(o/H);return H*i(2,-10*c)*v((c*w-P)*TWO_PI/G)+o+n},elasticinout:function(c,n,o,w,H,G){var P;if(c==0)return n;if((c/=w/2)==2)return n+o;G||(G=w*0.3*1.5);if(!H||H<j(o)){H=o;P=G/4}else P=G/TWO_PI*s(o/H);if(c<1)return-0.5*H*i(2,10*(c-=1))*v((c*w-P)*TWO_PI/G)+n;return H*i(2,-10*(c-=1))*v((c*w-P)*TWO_PI/G)*0.5+o+n},quadin:function(c,n,o,w){return o*(c/=w)*c+n},quadout:function(c,n,o,w){return-o*(c/=w)*(c-2)+n},quadinout:function(c,
n,o,w){if((c/=w/2)<1)return o/2*c*c+n;return-o/2*(--c*(c-2)-1)+n},sinein:function(c,n,o,w){return-o*N(c/w*y)+o+n},sineout:function(c,n,o,w){return o*v(c/w*y)+n},sineinout:function(c,n,o,w){return-o/2*(N(Math.PI*c/w)-1)+n}},C=COG.Tween=function(c){c=COG.extend({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:A("sine.out"),complete:null},c);var n=(new Date).getTime(),o=[],w=false,H=0,G=0,P={isComplete:function(){return w},triggerComplete:function(R){c.complete&&c.complete(R)},
update:function(R){var E=c.tweenFn(R-n,H,G,c.duration);if(c.target)c.target[c.property]=E;for(var aa=o.length;aa--;)o[aa](E,void 0);if(w=n+c.duration<=R){if(c.target)c.target[c.property]=c.tweenFn(c.duration,H,G,c.duration);for(R=o.length;R--;)o[R](E,true)}},requestUpdates:function(R){o.push(R)}};H=c.target&&c.property&&c.target[c.property]?c.target[c.property]:c.startValue;if(typeof c.endValue!=="undefined")G=c.endValue-H;if(G==0)w=true;S();return P};COG.tweenValue=function(c,n,o,w,H){function G(E){var aa=
E-P,V=o(aa,c,R,w),na=P+w<=E;E=!na;if(H){aa=H(V,na,aa);E=typeof aa!="undefined"?aa&&E:E}E&&animFrame(G)}var P=animTime(),R=n-c;animFrame(G);return{}};COG.tween=function(c,n,o,w,H,G){c=new C({target:c,property:n,endValue:o,tweenFn:w,duration:G,complete:H});Q.push(c);return c};COG.endTweens=function(c){if(!ia){ia=true;try{for(var n=0;n<Q.length;)if(!c||c(Q[n])){Q[n].triggerComplete(true);Q.splice(n,1)}else n++}finally{ia=false}}};COG.getTweens=function(){return[].concat(Q)};var A=COG.easing=function(c){return z[c.replace(/[\-\_\s\.]/g,
"").toLowerCase()]};COG.registerEasingType=function(c,n){z[c.replace(/[\-\_\s\.]/g,"").toLowerCase()]=n}})();
(function(){var I=/^P(\d+Y)?(\d+M)?(\d+D)?$/,S=/^(\d+H)?(\d+M)?(\d+S)?$/,B={8601:function(j){j=j.split("T");var i=null;i=null;var v=0,s=0;I.lastIndex=-1;i=I.exec(j[0]);v+=i[3]?parseInt(i[3].slice(0,-1),10):0;S.lastIndex=-1;i=S.exec(j[1]);s+=i[1]?parseInt(i[1].slice(0,-1),10)*3600:0;s+=i[2]?parseInt(i[2].slice(0,-1),10)*60:0;s+=i[3]?parseInt(i[3].slice(0,-1),10):0;return new y(v,s)}},y=COG.Duration=function(j,i){return{days:j?j:0,seconds:i?i:0}};COG.addDuration=function(){for(var j=new y,i=arguments.length;i--;){j.days+=
arguments[i].days;j.seconds+=arguments[i].seconds}if(j.seconds>=86400){j.days+=~~(j.seconds/86400);j.seconds%=86400}return j};COG.formatDuration=function(j){var i,v,s="";if(j.days)s=j.days+" days ";if(j.seconds){j=j.seconds;if(j>=3600){i=~~(j/3600);j-=i*3600}if(j>=60){v=Math.round(j/60);j-=v*60}if(i)s=s+i+(i>1?" hrs ":" hr ")+(v?(v>10?v:"0"+v)+" min ":"");else if(v)s=s+v+" min";else if(j>0)s=s+(j>10?j:"0"+j)+" sec"}return s};COG.parseDuration=function(j,i){var v=i?B[i]:null;if(v)return v(j);COG.Log.warn("Could not find duration parser for specified format: "+
i);return new y}})();
INTERACT=function(){function I(z){return function(C,A,c){(c?c:z?document.body:document).addEventListener(C,A,false)}}function S(z){return function(C,A,c){(c?c:z?document.body:document).removeEventListener(C,A,false)}}function B(z,C,A){(A?A:document).attachEvent("on"+z,C)}function y(z,C,A){(A?A:document).detachEvent("on"+z,C)}function j(z,C){return{x:z?z:0,y:C?C:0,count:1}}function i(z,C){ba.push(COG.extend({handler:null,checks:{},type:z},C))}function v(z){var C=0,A=0;if(z.offsetParent){do{C+=z.offsetLeft;
A+=z.offsetTop;z=z.offsetParent}while(z)}return{x:C,y:A}}function s(z,C){for(var A=z.target?z.target:z.srcElement;A&&A.nodeName&&A.nodeName.toUpperCase()!="CANVAS";)A=A.parentNode;return A&&A===C}function N(z,C){return{x:z.x-(C?C.x:0),y:z.y-(C?C.y:0)}}function Q(z){if(z.preventDefault){z.preventDefault();z.stopPropagation()}else z.cancelBubble&&z.cancelBubble()}var ba=[],ia=function(z,C,A){function c(R,E,aa,V){H[H.length]={ticks:(new Date).getTime(),x:V.x,y:V.y};o.trigger("pan",V.x,V.y)}function n(){COG.info("reset "+
H.length+" pan history");H=[]}A=COG.extend({binder:null,unbinder:null,observable:null},A);for(var o=A.observable,w=[],H=[],G={bind:function(){return o.bind.apply(null,arguments)},pannable:function(R){COG.extend({inertia:true},R);o.bind("pointerDown",n);o.bind("pointerMove",c);return G},unbind:function(){o.unbind();for(var R=0;R<w.length;R++)w[R].unbind();return G}},P=0;P<C.length;P++)w.push(C[P](z,o,A));return G};i("pointer",{handler:function(z,C,A){function c(q){if(s(q,z))if(E=H(q)){z.style.cursor=
"move";Q(q);ea=q.pageX?q.pageX:q.screenX;Y=q.pageY?q.pageY:q.screenY;aa=j(ea,Y);V=v(z);C.trigger("pointerDown",aa,N(aa,V))}}function n(q){na=q.pageX?q.pageX:q.screenX;T=q.pageY?q.pageY:q.screenY;if(s(q,z))G(E?"pointerMove":"pointerHover")}function o(q){if(E&&H(q)){E=false;if(s(q,z)){z.style.cursor="default";G("pointerUp")}}}function w(q){if(s(q,z)){var Z;q=q||window.event;if(q.detail)Z=q.axis===2?-q.detail*P:0;else{Z=q.wheelDeltaY?q.wheelDeltaY:q.wheelDelta;if(window.opera)Z=-Z}if(Z!==0){var ga=j(na,
T);C.trigger("zoom",ga,N(ga,v(z)),Z/R,"wheel");Q(q);q.returnValue=false}}}function H(q){q=q||window.event;return(q.which||q.button)==1}function G(q,Z,ga,ta){Z=typeof Z!="undefined"?Z:na;ga=typeof ga!="undefined"?ga:T;var va=j(Z,ga);C.trigger(q,va,N(va,V),j(Z-ea,ga-Y));if(typeof ta=="undefined"||ta){ea=Z;Y=ga}}A=COG.extend({},A);var P=120,R=P*8,E=false,aa,V,na,T,ea,Y;A.binder("mousedown",c,false);A.binder("mousemove",n,false);A.binder("mouseup",o,false);A.binder("click",function(q){if(s(q,z)){q=j(q.pageX?
q.pageX:q.screenX,q.pageY?q.pageY:q.screenY);C.trigger("tap",q,N(q,v(z)))}},false);A.binder("dblclick",function(q){COG.info("captured double click");if(s(q,z)){q=j(q.pageX?q.pageX:q.screenX,q.pageY?q.pageY:q.screenY);COG.info("captured double click + target matched");C.trigger("doubleTap",q,N(q,v(z)))}},false);A.binder("mousewheel",w,document);A.binder("DOMMouseScroll",w,document);return{unbind:function(){A.unbinder("mousedown",c,false);A.unbinder("mousemove",n,false);A.unbinder("mouseup",o,false);
A.unbinder("mousewheel",w,document);A.unbinder("DOMMouseScroll",w,document)}}},checks:{touch:false}});i("pointer",{handler:function(z,C,A){function c(F){if(F.count<2)return 0;var O=F.x-F.next.x;F=F.y-F.next.y;return~~Math.sqrt(O*O+F*F)}function n(F,O,M){O=O?O:0;M=M?M:0;for(var pa={x:F.x-O,y:F.y-M,id:F.id,count:F.count},oa=pa;F.next;){F=F.next;oa=oa.next={x:F.x-O,y:F.y-M,id:F.id}}return pa}function o(F,O){var M=F[O?O:"touches"],pa,oa;if(M.length===0)return null;oa=pa={x:M[0].pageX,y:M[0].pageY,id:M[0].identifier,
count:M.length};for(var wa=1,La=M.length;wa<La;wa++)oa=oa.next={x:M[wa].pageX,y:M[wa].pageY,id:M[wa].identifier};return pa}function w(F){if(s(F,z)){T=v(z);var O=o(F,"changedTouches"),M=n(O,T.x,T.y);if(!Y){ea=aa;C.trigger("pointerDown",O,M)}ta&&C.trigger("pointerDownMulti",O,M);Y=o(F);if(Y.count>1)Z=c(Y);va=1;ga=n(Y)}}function H(F){if(s(F,z)){F.preventDefault();q=o(F);if(ea==aa)ea=Math.abs(Y.x-q.x)>R||Math.abs(Y.y-q.y)>R?E:aa;if(ea!=aa){ea=q.count>1?na:V;if(ea==na)if(Y.count===1){Y=n(q);Z=c(Y)}else{F=
c(q);if(Math.abs(Z-F)<P)ea=V;else{var O;O=q.x;var M=q.next.x,pa=q.y,oa=q.next.y,wa=pa<oa?pa:oa;O={x:(O<M?O:M)+(Math.abs(O-M)>>1),y:wa+(Math.abs(pa-oa)>>1)};F=F/Z;M=F-va;C.trigger("zoom",O,N(O,T),M,"pinch");va=F}}ea==V&&C.trigger("pointerMove",q,n(q,T.x,T.y),j(q.x-ga.x,q.y-ga.y));ta&&C.trigger("pointerMoveMulti",q,n(q,T.x,T.y))}ga=n(q)}}function G(F){if(s(F,z)){var O=o(F,"changedTouches"),M=n(O,T.x,T.y);q=o(F);if(!q){ea===aa&&C.trigger("pointerTap",O,M);C.trigger("pointerUp",O,M);Y=null}ta&&C.trigger("pointerUpMulti",
O,M)}}A=COG.extend({detailed:false,inertia:false},A);var P=20,R=7,E=0,aa=1,V=2,na=3,T,ea,Y,q,Z,ga,ta=A.detailed,va=1;A.binder("touchstart",w,false);A.binder("touchmove",H,false);A.binder("touchend",G,false);COG.info("initialized touch handler");return{unbind:function(){A.unbinder("touchstart",w,false);A.unbinder("touchmove",H,false);A.unbinder("touchend",G,false)}}},checks:{touch:true}});return{register:i,watch:function(z,C,A){C=COG.extend({bindToBody:false,observable:null,isIE:typeof window.attachEvent!=
"undefined",types:null},C);capabilities=COG.extend({touch:"ontouchstart"in window},A);if(!C.observable){COG.info("creating observable");C.observable=COG.observable({});globalOpts=C}C.binder=C.isIE?B:I(C.bindToBody);C.unbinder=C.isIE?y:S(C.bindToBody);A=C.types;for(var c=capabilities,n=[],o=ba.length;o--;){var w=ba[o],H=!A||A.indexOf(w.type)>=0,G=true;for(var P in w.checks){var R=w.checks[P];COG.info("checking "+P+" capability. require: "+R+", capability = "+c[P]);G=G&&R===c[P]}if(H&&G)n[n.length]=
w.handler}return new ia(z,n,C)}}}();
T5=function(){function I(){return(new Date).getTime()}function S(){for(;Z.length>0;){var b=Z.shift();document.location=b}q=0}function B(b){for(var l=true,e=ga.length;e--;)l=l&&b!=ga[e];return l}function y(b,l){var e=[];for(var a in l)a&&e.push(a+"="+escape(l[a]));return"tile5://"+b+"/"+(e.length>0?"?"+e.join("&"):"")}function j(b,l){B(b)&&COG.info("would push url: "+y(b,l))}function i(b,l){if(B(b)){Z.push(y(b,l));q||(q=setTimeout(S,100))}}function v(b){return function(l,e,a){(a?a:b?document.body:
document).addEventListener(l,e,false)}}function s(b){return function(l,e,a){(a?a:b?document.body:document).removeEventListener(l,e,false)}}function N(b,l,e){(e?e:document).attachEvent("on"+b,l)}function Q(b,l,e){(e?e:document).detachEvent("on"+b,l)}function ba(){T={base:{name:"Unknown",bindEvent:v(),unbindEvent:s(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:j,targetFps:null},ie:{name:"MSIE",regex:/msie/i,
bindEvent:N,unbindEvent:Q,requireFastDraw:false,targetFps:25},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:i,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:i},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:i},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:v(true),unbindEvent:s(true),supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},
bridgeNotify:i},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:i}};ea=[T.froyo,T.android,T.ipod,T.iphone,T.ipad,T.ie]}function ia(){T||ba();if(!Y){COG.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var b=0;b<ea.length;b++){var l=ea[b];if(l.regex&&l.regex.test(navigator.userAgent)){Y=COG.extend({},T.base,l);COG.info("PLATFORM DETECTED AS: "+Y.name);break}}if(!Y){COG.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
Y=T.base}COG.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return Y}function z(){for(var b=0,l=arguments.length;l--;){var e=O[arguments[l].toUpperCase()];if(e)b|=e}return b}var C=Math.abs,A=Math.min,c=Math.max,n=Math.pow,o=Math.sqrt,w=Math.log,H=Math.round,G=Math.sin,P=Math.asin,R=Math.cos,E=function(){function b(a,d){return e(a.x-d.x,a.y-d.y)}function l(a,d){if(!d)d=a.length;if(d<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var h={edges:Array(d-
1),accrued:Array(d-1),total:0},g=0;g<d-1;g++){var k=b(a[g],a[g+1]);h.edges[g]=o(k.x*k.x+k.y*k.y);h.accrued[g]=h.total+h.edges[g];h.total+=h.edges[g]}return h}function e(a,d){return{x:a?a:0,y:d?d:0}}return{VECTOR_SIMPLIFICATION:3,SIMPLIFICATION_MIN_VECTORS:25,add:function(){for(var a=0,d=0,h=arguments.length;h--;){a+=arguments[h].x;d+=arguments[h].y}return e(a,d)},absSize:function(a){return c(C(a.x),C(a.y))},copy:function(a){return a?e(a.x,a.y):null},diff:b,distance:function(a,d){return l(a,d).total},
edges:l,equals:function(a,d){return a.x===d.x&&a.y===d.y},extendBy:function(a,d,h){var g=R(d)*h;d=G(d)*h;return e(a.x-g,a.y-d)},floor:function(a){for(var d=Array(a.length),h=a.length;h--;)d[h]=e(~~a[h].x,~~a[h].y);return d},getRect:function(a){for(var d,h,g,k,p=a.length;p--;){var m=a[p];d=typeof d==="undefined"||m.x<d?m.x:d;h=typeof h==="undefined"||m.y<h?m.y:h;g=typeof g==="undefined"||m.x>g?m.x:g;k=typeof k==="undefined"||m.y>k?m.y:k}return V.init(d,h,g,k)},init:e,invert:function(a){return e(-a.x,
-a.y)},min:function(a,d){return e(a.x<d.x?a.x:d.x,a.y<d.y?a.y:d.y)},max:function(a,d){return e(a.x>d.x?a.x:d.x,a.y>d.y?a.y:d.y)},offset:function(a,d,h){return e(a.x+d,a.y+(h?h:d))},simplify:function(a,d){if(!a)return null;d=d?d:E.VECTOR_SIMPLIFICATION;for(var h=[],g=null,k=a.length;k--;){var p=a[k];if(include=!g||k===0||C(p.x-g.x)+C(p.y-g.y)>d){h.unshift(p);g=p}}return h},theta:function(a,d,h){h=P((a.y-d.y)/h);return a.x>d.x?h:Math.PI-h},toString:function(a){return a.x+", "+a.y}}}(),aa=function(){return{dotProduct:function(b,
l){return b.x*l.x+b.y*l.y}}}(),V=function(){function b(e){return l(e.x1,e.y1,e.x2,e.y2)}function l(e,a,d,h){e=e?e:0;a=a?a:0;d=typeof d!=="undefined"?d:e;h=typeof h!=="undefined "?h:h;return{x1:e,y1:a,x2:d,y2:h,width:d-e,height:h-a}}return{center:function(e){return E.init(e.x1+e.width/2,e.y1+e.height/2)},copy:b,diagonalSize:function(e){return o(e.width*e.width+e.height*e.height)},fromCenter:function(e,a,d,h){d=d>>1;h=h>>1;return l(e-d,a-h,e+d,a+h)},init:l,intersect:function(e,a){var d=c(e.x1,a.x1),
h=c(e.y1,a.y1),g=A(e.x2,a.x2),k=A(e.y2,a.y2);d=l(d,h,g,k);return d.width>0&&d.height>0?d:null},toString:function(e){return"["+e.x1+", "+e.y1+", "+e.x2+", "+e.y2+"]"},union:function(e,a){if(e.width===0||e.height===0)return b(a);else if(a.width===0||a.height===0)return b(e);else{var d=A(e.x1,a.x1),h=A(e.y1,a.y1),g=c(e.x2,a.x2),k=c(e.y2,a.y2);d=l(d,h,g,k);return d.width>0&&d.height>0?d:null}}}}(),na=function(){return{getAspectRatio:function(b){return b.height!==0?b.width/b.height:1},getCenter:function(b){return E.init(b.width>>
1,b.height>>1)},getSize:function(b){return o(n(b.width,2)+n(b.height,2))},init:function(b,l){b=b?b:0;return{width:b,height:l?l:b}}}}(),T=null,ea=[],Y=null,q=0,Z=[],ga=["view.wake","tile.loaded"],ta=function(){function b(){var f=ia().maxImageLoads;if(!f||p.length<f)if(f=k.shift()){p[p.length]=f;f.image.onload=l;f.image.src=f.url;f.requested=T5.ticks()}}function l(){var f=h[this.id],t;if(f&&f.image.complete&&f.image.width>0){f.loaded=true;f.hitCount=1;for(t=p.length;t--;)if(p[t].image.src==this.src){p.splice(t,
1);break}if(f.background||f.postProcess||f.drawBackground||f.customDraw)if(f.image){globalImageData=f;t=a(f.realSize?f.realSize.width:f.image.width,f.realSize?f.realSize.height:f.image.height);var J=t.getContext("2d"),L=f.offset?f.offset:T5.XY.init();f.background&&J.drawImage(f.background,0,0);f.drawBackground&&f.drawBackground(J);f.customDraw?f.customDraw(J,f):J.drawImage(f.image,L.x,L.y);f.postProcess&&f.postProcess(J,f);f.image=t}for(t=f.callbacks.length;t--;)f.callbacks[t]&&f.callbacks[t](this,
false);f.callbacks=[];m[m.length]={url:this.src,created:f.requested};delete h[this.id];b()}}function e(f,t,J){var L=d[f];if(L){L.hitCount++;L.image.complete&&L.image.width>0&&t?t(L.image,true):L.callbacks.push(t)}else{L=COG.extend({url:f,image:new Image,loaded:false,created:T5.ticks(),requested:null,hitCount:0,callbacks:[t]},J);L.image.id="resourceLoaderImage"+g++;d[f]=L;h[L.image.id]=L;k[k.length]=L;b()}return L}function a(f,t){var J=document.createElement("canvas");COG.info("creating new canvas");
J.width=f?f:0;J.height=t?t:0;if(typeof FlashCanvas!="undefined"){document.body.appendChild(J);FlashCanvas.initElement(J)}return J}var d={},h={},g=0,k=[],p=[],m=[],r={avgImageSize:25,loadTimeout:10,cancelLoad:function(){var f;for(f=p.length;f--;)delete d[p[f].url];p=[];for(f=k.length;f--;)delete d[k[f].url];k=[]},get:function(f,t,J){var L=null;L=null;if((L=(L=d[f])?L.image:null)&&(L.getContext||L.complete&&L.width>0))return L;else t&&e(f,t,J);return null},load:e,newCanvas:a,reset:function(){d={}},
stats:function(){return{imageLoadingCount:p.length,queuedImageCount:k.length,imageCacheFullness:0}}};COG.observable(r);return r}(),va=function(){var b={};return{init:function(l,e){var a=b[l];if(!a)throw Error("Unable to locate requested generator: "+l);return new a(e)},register:function(l,e){b[l]=e},Template:function(){}}}(),F=function(){function b(g,k){d[g]=e(k);return g}function l(g){for(var k in g)b(k,g[k])}function e(g){function k(f){var t=g[f];typeof t!=="undefined"&&m.push(function(J){J[f]=
t})}function p(){m=[];for(var f in g)k(f)}g=COG.extend({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},g);var m=[],r={applyToContext:function(f){for(var t=m.length;t--;)m[t](f)},update:function(f,t){g[f]=t;p()}};p();return r}var a={},d={},h={apply:function(g,k){var p=d[k]?d[k]:d.basic,m;if(g&&g.canvas){m=a[g.canvas.id];a[g.canvas.id]=k}p.applyToContext(g);return m},define:b,
defineMany:l,get:function(g){return d[g]},init:e,load:function(g){COG.jsonp(g,function(k){l(k)})}};l({basic:{lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"},waypoints:{lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"}});return h}(),O={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,ZOOM:16,FREEZE:128},M=function(b){b=COG.extend({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:z("ACTIVE","ANIMATING","PAN","ZOOM"),style:null,minXY:null,maxXY:null},b);var l=null,e=false,a=false,d=
b.supportFastDraw,h=b.id,g=z("ACTIVE"),k=b.validStates,p=0,m=0,r=COG.extend({addToView:function(f){f.setLayer(h,r)},shouldDraw:function(f,t){return(a||p!==t.x1||m!==t.y1)&&(f&k)!==0&&(e?d:true)},clip:null,cycle:function(){},draw:function(){},remove:function(){r.trigger("remove",r)},changed:function(){a=true;r.trigger("changed",r);l&&l.invalidate()},getId:function(){return h},setId:function(f){h=f},getParent:function(){return l},setParent:function(f){e=(l=f)?l.fastDraw&&displayState!==g:false;r.trigger("parentChange",
l)}},b);COG.observable(r);r.bind("drawComplete",function(f,t){a=false;p=t.x1;m=t.y1});r.bind("resync",function(f,t){if(t.syncXY){r.minXY&&t.syncXY(r.minXY);r.maxXY&&t.syncXY(r.maxXY)}});return r},pa=function(b){function l(p,m,r,f){a=p;d=m;h=r;g=f}b=COG.extend({xy:E.init(),offset:true,tweenIn:null,animationSpeed:null,isNew:true},b);var e=false,a=0,d=0,h=0,g=0,k=COG.extend(b,{isAnimating:function(){return e},draw:function(p,m,r,f,t){if(k.isNew&&b.tweenIn)COG.tweenValue(m.y1-20,k.xy.y,b.tweenIn,b.animationSpeed?
b.animationSpeed:250+Math.random()*500,function(J,L){k.xy.y=J|0;e=!L;t.invalidate()});k.drawMarker(p,m,k.xy.x,k.xy.y,r,f,t);k.isNew=false},drawMarker:function(p,m,r,f){p.beginPath();p.arc(r,f,4,0,Math.PI*2,false);p.fill();l(r-4,f-4,8,8)},hitTest:function(p,m){return p>=a&&p<=a+h&&m>=d&&m<=d+g},updateBounds:l});COG.observable(k);return k},oa=function(b){function l(){d.changed(true);d.trigger("markerUpdate",a)}function e(){var h=d.getParent();if(h&&h.syncXY)for(var g=a.length;g--;)h.syncXY([a[g].xy])}
b=COG.extend({zindex:100,style:"basic"},b);var a=[],d=COG.extend(new M(b),{draw:function(h,g,k,p){for(var m=a.length;m--;)a[m].draw(h,g,k,d,p)},add:function(h){if(h&&typeof h.length!=="undefined")for(var g=h.length;g--;){if(h[g])a[a.length]=h[g]}else if(h)a[a.length]=h;l()},clear:function(h){if(h)for(var g=0;g<a.length;)if(h(a[g]))a.splice(g,1);else g+=1;else a=[];l()},each:function(h){if(h)for(var g=a.length;g--;)h(a[g])},find:function(h){for(var g=[],k=a.length;k--;)if(!h||h(a[k]))g[g.length]=a[k];
return g}});d.bind("tap",function(h,g,k,p){var m=[],r=p.x;p=p.y;for(var f=a.length;f--;)if(a[f].hitTest(r,p))m[m.length]=a[f];if(m.length>0)h.cancel=d.trigger("markerTap",g,k,m).cancel});d.bind("parentChange",e);d.bind("resync",e);d.bind("changed",e);return d},wa=function(b){function l(k,p,m){k.fillStyle="#FFFFFF";k.strokeStyle="#222222";k.beginPath();k.arc(m.x,m.y,4,0,Math.PI*2,false);k.stroke();k.fill()}b=COG.extend({path:[],id:COG.objId("pathAni"),easing:COG.easing("sine.inout"),validStates:z("ACTIVE",
"PAN","ZOOM"),drawIndicator:null,duration:2E3},b);var e=E.edges(b.path),a,d=null,h=0;COG.tweenValue(0,e.total,b.easing,function(){g.remove()},b.duration).requestUpdates(function(k,p){h=k;p&&g.remove()});var g=COG.extend(new M(b),{cycle:function(){for(var k=0;k<e.accrued.length&&e.accrued[k]<h;)k++;d=null;if(k<b.path.length-1){var p=h-(k>0?e.accrued[k-1]:0),m=b.path[k];a=E.theta(m,b.path[k+1],e.edges[k]);d=E.extendBy(m,a,p)}return d},draw:function(k,p){if(d)(b.drawIndicator?b.drawIndicator:l)(k,p,
E.init(d.x,d.y),a)}});return g},La=function(b){b=COG.extend({style:null,properties:{}},b);return COG.extend(b,{rect:null,draw:function(){},resync:function(){}})},kb=function(){return{tileSize:256,init:function(b,l,e,a,d){return COG.extend({x:b,y:l,width:e,height:a},d)}}}(),Ua={ex:COG.extend,ticks:I,getConfig:ia,userMessage:function(b,l,e){Ua.trigger("userMessage",b,l,e)},zoomable:function(b,l){function e(g,k){g=g?c(A(g,h),d):d;if(g!=a){a=g;b.triggerAll("zoomLevelChange",g,k)}}l=COG.extend({initial:1,
minZoom:1,maxZoom:16},l);var a=null,d=l.minZoom,h=l.maxZoom;COG.extend(b,{getZoomLevel:function(){return a},setZoomLevel:e});b.bind("scale",function(g,k,p){g=Math.log(k)/Math.LN2;COG.endTweens(function(m){return m.cancelOnInteract});e(a+g,p);b.updateOffset(p.x*k,p.y*k)})},XY:E,XYRect:V,Dimensions:na,Vector:aa,D:na,Images:ta,Generator:va,tween:COG.tween,tweenValue:COG.tweenValue,easing:COG.easing,Tween:COG.Tween,Style:F,viewState:z,View:function(b){function l(x,u,D,K){qa=Ma;r(ca-u,da-D,K?b.panAnimationEasing:
null,K?b.panAnimationDuration:null);clearTimeout(db);db=setTimeout(e,100)}function e(){qa=Va;ka()}function a(x,u,D,K){Wa(A(c($+n(2,K)-1,0.5),2))}function d(){var x=w($)/Math.LN2>>0;if(x!==0){$=n(2,x);x=E.init(Na-(Ba/$>>0),Oa-(Ca/$>>0));if(!ha.trigger("scale",$,x).cancel){for(var u=U.length;u--;)U[u].trigger("scale",$,x);$=1;qa=Va}}ka()}function h(x){x||(x=E.init(Ba,Ca));Xa=E.init(ca,da);Ja=E.offset(x,ca,da);Na=Ja.x;Oa=Ja.y}function g(x,u){var D,K;K=1/$;if($!==1&&ua){D=ua.x1+x*K;K=ua.y1+u*K}else{D=
x+ca;K=u+da}return E.init(D,K)}function k(x,u,D){Ka("doubleTap",u,D,g(D.x,D.y));if(b.scalable){COG.endTweens(function(K){return K.cancelOnInteract});Wa(2,D,b.zoomAnimation,null,b.zoomDuration)}}function p(){clearTimeout(eb);eb=setTimeout(f,250)}function m(x,u,D){Ka("tap",u,D,g(D.x,D.y))}function r(x,u,D,K,W){function ra(){Da+=1;if(Da>=2){e();W&&W()}}var Da=0,xa=Ga?E.offset(Ga,-Ba,-Ca):null,Ea=Ha?E.offset(Ha,-Ba,-Ca):null;if(xa){x=x<xa.x?xa.x:x;u=u<xa.y?xa.y:u}if(Ea){x=x>Ea.x?Ea.x:x;u=u>Ea.y?Ea.y:
u}if(D){if((qa&Ma)===0){COG.tweenValue(ca,x,D,K,function(Ia,Ya){ca=Ia|0;(Ya?ra:ka)();return!Pa});COG.tweenValue(da,u,D,K,function(Ia,Ya){da=Ia|0;(Ya?ra:ka)();return!Pa});qa=Ma|Za}}else{ca=x|0;da=u|0;ka();W&&W()}}function f(x,u){var D;if(ja){ya&&ya.unbind();if(b.autoSize&&ja.parentNode){x=ja.parentNode.offsetWidth;u=ja.parentNode.offsetHeight}try{if(!ja.id)ja.id=b.id+"_canvas";X=ja.getContext("2d")}catch(K){COG.exception(K);throw Error("Could not initialise canvas on specified view element");}if(x&&
u&&(la!==u||ma!==x)){$a=true;ma=x;la=u;Ba=ma>>1;Ca=la>>1;ha.trigger("resize",ma,la);for(D=sa;D--;)U[D].trigger("resize",ma,la)}if(b.interactive){ya=INTERACT.watch(ja).pannable();J()}for(D=sa;D--;)U[D].trigger("contextChanged",X);ka()}}function t(x,u){u.setId(x);u.added=I();u.bind("remove",function(){ha.removeLayer(x)});u.trigger("contextChanged",X);u.setParent(ha);U.push(u);U.sort(function(D,K){var W=K.zindex-D.zindex;if(W===0)W=K.added-D.added;return W});sa=U.length;return u}function J(){if(ya){if(b.pannable){ya.bind("pan",
l);ya.bind("inertiaCancel",function(){ka()})}if(b.scalable){ya.bind("zoom",a);ya.bind("doubleTap",k)}ya.bind("tap",m)}}function L(){var x=Qa?ca+Ba:ca,u=Ra?da+Ca:da;if(za&&za>ma)if(x+ma>za)ca=Qa?x-za>0?ca-za:ca:za-ma;else if(x<0)ca=Qa?ca+za:0;if(Aa&&Aa>la)if(u+la>Aa)da=Ra?u-Aa>0?da-Aa:da:Aa-la;else if(u<0)da=Ra?da+Aa:0}function fa(x,u,D,K){var W;V.center(u);var ra=0;ua=V.copy(u);ua.scaleFactor=$;D||X.clearRect(0,0,ma,la);X.save();try{X.globalCompositeOperation="source-over";if($!==1){var Da=ua,xa=
1/$;Na=Ja.x+(ca-Xa.x);Oa=Ja.y+(da-Xa.y);ua=Da?V.fromCenter(Na>>0,Oa>>0,Da.width*xa>>0,Da.height*xa>>0):void 0;X.scale($,$)}X.translate(-ua.x1,-ua.y1);Ha=Ga=null;if(D){X.beginPath();for(ra=sa;ra--;)U[ra].clip&&U[ra].clip(X,ua,x,ha,K);X.closePath();X.clip()}for(ra=sa;ra--;){W=U[ra];var Ea=W.style,Ia=Ea?F.apply(X,Ea):null;if(W.minXY)Ga=Ga?E.min(Ga,W.minXY):E.copy(W.minXY);if(W.maxXY)Ha=Ha?E.max(Ha,W.maxXY):E.copy(W.maxXY);W.draw(X,ua,x,ha,K);Ia&&F.apply(X,Ia)}}finally{X.restore()}if(lb){X.globalCompositeOperation=
"source-over";X.strokeStyle="#f00";X.beginPath();X.moveTo(Ba,0);X.lineTo(Ba,la);X.moveTo(0,Ca);X.lineTo(ma,Ca);X.stroke()}ab=0;Ka("drawComplete",u,K)}function Fa(x){var u,D=false;if(ab){if(x-fb>mb){if($!==1)qa|=gb;Pa=(u=(qa&(gb|Ma))!==0)&&(qa&Za)===0;if($a&&ja){typeof FlashCanvas!="undefined"&&FlashCanvas.initElement(ja);ja.width=ma;ja.height=la;ja.style.width=ma+"px";ja.style.height=la+"px";$a=false}if(za||Aa)L();Sa=Ta();if(Pa){COG.endTweens(function(W){return W.cancelOnInteract});nb=false;if(bb!==
0){clearTimeout(bb);bb=0}}for(var K=sa;K--;){if(U[K].animated)qa|=Za;U[K].cycle(x,Sa,qa);U[K].shouldDraw(qa,Sa);D=U[K].clip||D}fa(qa,Sa,ob&&D&&!u,x);x-hb>pb&&ib();fb=x}COG.animFrame(Fa)}else cb=false}function ka(){ab+=1;if(!cb){cb=true;COG.animFrame(Fa)}}function Ta(){return V.init(ca,da,ca+ma,da+la)}function ib(){hb=(new Date).getTime();Ka("refresh",ha,Ta());ka()}function Wa(x,u,D,K,W){if(D)COG.tweenValue($,x,D,W,function(ra,Da){$=ra;if(Da){var xa=H(w($)/Math.LN2);$=n(2,xa);K&&K()}h(u);d()});else{$=
x;h(u);d()}return ha}function Ka(){for(var x=ha.trigger.apply(null,arguments).cancel,u=U.length;u--;)x=U[u].trigger.apply(null,arguments).cancel||x;return!x}b=COG.extend({id:COG.objId("view"),container:"",fastDraw:false,inertia:true,idleDelay:100,minRefresh:1E3,pannable:true,clipping:true,scalable:true,interactive:true,panAnimationEasing:COG.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:true,tapExtent:10,mask:true,guides:false,fps:25,zoomAnimation:COG.easing("quad.out"),
zoomDuration:300},b);var U=[],sa=0,ja=document.getElementById(b.container),X=null,qb=typeof window.attachEvent!="undefined",pb=b.minRefresh,ca=0,da=0,za=null,Aa=null,Qa=false,Ra=false,ob=b.clipping,Sa=null,cb=false,ua,lb=b.guides,jb=1,Ba=0,Ca=0,Xa=null,Ja=null,Pa=false,nb=false,bb=0,db=0,Ga=null,Ha=null,hb=0,rb=0,eb=0,$=1,fb=0,$a=false,ya=null,la,ma,mb=1E3/b.fps|0,ab=0,Na,Oa,Va=z("ACTIVE"),Ma=z("PAN"),gb=z("ZOOM"),Za=z("ANIMATING"),qa=Va,ha={id:b.id,deviceScaling:jb,fastDraw:b.fastDraw||ia().requireFastDraw,
getDimensions:function(){return na.init(ma,la)},getLayer:function(x){for(var u=0;u<sa;u++)if(U[u].getId()==x)return U[u];return null},setLayer:function(x,u){for(var D=0;D<sa;D++)if(U[D].getId()===x){U.splice(D,1);break}if(u){t(x,u);u.trigger("refresh",ha,Ta())}ka();return u},eachLayer:function(x){for(var u=sa;u--;)x(U[u])},invalidate:ka,refresh:ib,resetScale:function(){$=1},resize:function(x,u){if(ja){b.autoSize=false;if(ma!==x||la!==u)f(x,u)}},scale:Wa,triggerAll:Ka,removeLayer:function(x){a:{for(var u=
sa;u--;)if(U[u].getId()==x){x=u;break a}x=-1}if(x>=0&&x<sa){ha.trigger("layerRemoved",U[x]);U.splice(x,1);ka()}sa=U.length},getOffset:function(){return E.init(ca,da)},setMaxOffset:function(x,u,D,K){za=x;Aa=u;Qa=typeof D!="undefined"?D:false;Ra=typeof K!="undefined"?K:false},getViewRect:Ta,updateOffset:r,pan:function(x,u,D,K,W){r(ca+x,da+u,D,K,W)}};jb=ia().getScaling();ha.markers=t("markers",new oa);COG.observable(ha);ha.bind("invalidate",function(){ka()});ha.bind("resync",function(){Ha=Ga=null});
COG.configurable(ha,["inertia","container","rotation","tapExtent","scalable","pannable"],COG.paramTweaker(b,null,{container:function(x,u){ja=document.getElementById(u);f()},rotation:function(x,u){rb=u}}),true);f();if(b.autoSize)qb?window.attachEvent("onresize",p):window.addEventListener("resize",p,false);return ha},ViewLayer:M,ImageLayer:function(b,l){function e(m,r,f){for(r=g.length;r--;){var t=g[r],J=t.x,L=t.y,fa=V.init(t.x,t.y,t.x+t.width,t.y+t.height);if(f&&V.intersect(m,fa))(fa=ta.get(t.url,
function(){p.changed()},k))&&f(fa,J,L,t.width,t.height)}}function a(m){var r=++h,f=p.getParent();if(d){COG.info("generating: "+V.toString(m)+", sequence = "+r);d.run(f,m,function(t){if(r==h){g=[].concat(t);p.changed()}})}}l=COG.extend({imageLoadArgs:{}},l);var d=b?va.init(b,l):null,h=0,g=[],k=l.imageLoadArgs,p=COG.extend(new M(l),{changeGenerator:function(m,r){d=va.init(m,COG.extend({},l,r));g=null;a(p.getParent().getViewRect())},clip:function(m,r,f){e(r,f,function(t,J,L,fa,Fa){m.rect(J,L,fa,Fa)})},
draw:function(m,r,f){e(r,f,function(t,J,L,fa,Fa){p.drawImage(m,t,J,L,fa,Fa,r,f)})},drawImage:function(m,r,f,t){r&&m.drawImage(r,f,t,r.width,r.height)}});p.bind("refresh",function(m,r,f){a(f)});p.bind("tap",function(m,r,f,t){m=[];var J=t.x,L=t.y,fa,Fa;if(g)for(var ka=g.length;ka--;){fa=g[ka];if(Fa=J>=fa.x&&J<=fa.x+fa.width&&L>=fa.y&&L<=fa.y+fa.height)m[m.length]=fa}m.length>0&&p.trigger("tapImage",m,r,f,t)});return p},ImageGenerator:function(b){b=COG.extend({relative:false,padding:2},b);b={run:function(){COG.warn("running base generator - this should be overriden")}};
COG.observable(b);return b},Marker:pa,ImageMarker:function(b){b=COG.extend({image:null,imageUrl:null,animatingImage:null,animatingImageUrl:null,imageAnchor:null,rotation:0,scale:1,opacity:1},b);var l=b.imageAnchor?T5.XY.invert(b.imageAnchor):null,e=COG.extend(new pa(b),{drawMarker:function(a,d,h,g){if((d=e.isAnimating()&&e.animatingImage?e.animatingImage:e.image)&&d.width>0){l||(l=E.init(-d.width>>1,-d.height>>1));var k=e.scale,p=h+~~(l.x*k),m=g+~~(l.y*k),r=~~(d.width*k),f=~~(d.height*k);e.updateBounds(p,
m,r,r);if(e.rotation||e.opacity!==1){a.save();try{a.globalAlpha=e.opacity;a.translate(h,g);a.rotate(e.rotation);a.drawImage(d,l.x*k,l.y*k,r,f)}finally{a.restore()}}else a.drawImage(d,p,m,r,f)}}});if(!e.image)e.image=ta.get(b.imageUrl,function(a){e.image=a});if(!e.animatingImage)e.animatingImage=ta.get(b.animatingImageUrl,function(a){e.animatingImage=a});return e},MarkerLayer:oa,PathLayer:function(b){function l(){var m=p.getParent();if(m&&m.syncXY){m.syncXY(d);h&&m.syncXY(h);p.trigger("tidy")}}b=COG.extend({style:"waypoints",
pixelGeneralization:8,zindex:50},b);var e=[],a=null,d=[],h=null,g=0,k=[],p=COG.extend(new M(b),{getAnimation:function(m,r,f,t){var J="pathAnimation"+g++;k.push(J);return new wa({id:J,path:e,zindex:b.zindex+1,easing:m?m:COG.easing("sine.inout"),duration:r?r:5E3,drawIndicator:f,autoCenter:t?t:false})},draw:function(m){var r,f=e.length;m.save();try{F.apply(m,b.style);if(f>0){m.beginPath();m.moveTo(e[f-1].x,e[f-1].y);for(r=f;r--;)m.lineTo(e[r].x,e[r].y);m.stroke();if(a){m.fillStyle=b.waypointFillStyle;
for(r=a.length;r--;){m.beginPath();m.arc(a[r].x,a[r].y,2,0,Math.PI*2,false);m.stroke();m.fill()}}}}finally{m.restore()}},updateCoordinates:function(m,r){d=m;h=r;l()}});p.bind("tidy",function(){e=E.simplify(d,b.pixelGeneralization);a=E.simplify(h,b.pixelGeneralization);p.changed(true)});p.bind("resync",l);return p},AnimatedPathLayer:wa,Shape:La,Arc:function(b,l){l=COG.extend({size:4},l);var e=E.init(),a=COG.extend(l,{draw:function(d){d.beginPath();d.arc(e.x,e.y,a.size,0,Math.PI*2,false);d.fill();d.stroke()},
resync:function(d){d.syncXY([b]);e=E.floor([b])[0]}});COG.info("created arc = ",b);return a},Poly:function(b,l){l=COG.extend({fill:false,simplify:false},l);var e=false,a=l.fill,d=l.simplify,h=z("ZOOM"),g=[],k=COG.extend(new La(l),{draw:function(p,m,r,f,t,J){if(e){m=true;r=(J&h)!==0;p.beginPath();for(J=g.length;J--;){r=g[J].x;f=g[J].y;if(m){p.moveTo(r,f);m=false}else p.lineTo(r,f);r=true}if(r){a&&p.fill();p.stroke()}}},resync:function(p){k.xy=p.syncXY(b);g=E.floor(d?E.simplify(b):b)}});e=b&&b.length>=
2;return k},ShapeLayer:function(b){function l(h){for(var g=a.length;g--;)a[g].resync(h);a.sort(function(k,p){var m=p.xy.y-k.xy.y;if(m===0)m=p.xy.x-k.xy.y;return m});d.changed()}function e(h,g){g.syncXY&&l(g)}b=COG.extend({zindex:80},b);var a=[],d=COG.extend(new M(b),{add:function(h){a[a.length]=h},each:function(h){for(var g=a.length;g--;)h(a[g])},draw:function(h,g,k){var p=g.x1,m=g.y1,r=g.width;g=g.height;for(var f=a.length;f--;){var t=a[f].style;t=t?F.apply(h,t):null;a[f].draw(h,p,m,r,g,k);t&&F.apply(h,
t)}}});d.bind("parentChange",e);d.bind("resync",e);return d},Tiling:kb};COG.observable(Ua);return Ua}();
