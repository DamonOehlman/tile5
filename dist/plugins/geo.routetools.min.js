T5.RouteTools=function(){function f(a,c){var b=new T5.ShapeLayer;c.geometry&&T5.Geo.Position.vectorize(c.geometry,{callback:function(e){b.add(new T5.Line(e,{style:"waypoints",simplify:true}));a.setLayer("route",b)}})}function g(a){for(var c=d.Unknown,b=j||k,e=0;e<b.length;e++){b[e].regex.lastIndex=-1;var h=b[e].regex.exec(a);if(h){c=b[e].customCheck?b[e].customCheck(a,h):b[e].turnType;break}}return c}var j=undefined,d={Unknown:"turn-unknown",Start:"turn-none-start",Continue:"turn-none",Arrive:"turn-none-arrive",
TurnLeft:"turn-left",TurnLeftSlight:"turn-left-slight",TurnLeftSharp:"turn-left-sharp",TurnRight:"turn-right",TurnRightSlight:"turn-right-slight",TurnRightSharp:"turn-right-sharp",Merge:"merge",UTurnLeft:"uturn-left",UTurnRight:"uturn-right",EnterRoundabout:"roundabout-enter",Ramp:"ramp",RampExit:"ramp-exit"},k=function(){var a=[];a.push({regex:/continue/i,turnType:d.Continue});a.push({regex:/(take|bear|turn)(.*?)left/i,customCheck:function(c,b){return/bear/i.test(b[1])?d.TurnLeftSlight:d.TurnLeft}});
a.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(c,b){return/bear/i.test(b[1])?d.TurnRightSlight:d.TurnRight}});a.push({regex:/enter\s(roundabout|rotaty)/i,turnType:d.EnterRoundabout});a.push({regex:/take.*?ramp/i,turnType:d.Ramp});a.push({regex:/take.*?exit/i,turnType:d.RampExit});a.push({regex:/make(.*?)u\-turn/i,customCheck:function(c,b){return/right/i.test(b[1])?d.UTurnRight:d.UTurnLeft}});a.push({regex:/proceed/i,turnType:d.Start});a.push({regex:/arrive/i,turnType:d.Arrive});
a.push({regex:/fell\sthrough/i,turnType:d.Merge});return a}(),i={calculate:function(a){a=COG.extend({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},a);var c=T5.Geo.getEngine("route");c&&c.route(a,function(b){if(a.generalize)b.geometry=T5.Geo.Position.generalize(b.geometry,b.getInstructionPositions());if(a.map){f(a.map,b);a.autoFit&&a.map.gotoBounds(b.boundingBox)}a.success&&a.success(b)})},createMapOverlay:f,parseTurnType:g,TurnType:d,Instruction:function(a){var c=
a=COG.extend({position:null,description:"",distance:0,distanceTotal:0,time:0,timeTotal:0,turnType:null},a),b=a.description;b=b.replace(/(\w)(\/)(\w)/g,"$1 $2 $3");c.description=b;if(!a.turnType)a.turnType=g(a.description);return a},RouteData:function(a){a=COG.extend({geometry:[],instructions:[],boundingBox:null},a);if(!a.boundingBox)a.boundingBox=T5.Geo.BoundingBox.forPositions(a.geometry);return COG.extend({getInstructionPositions:function(){for(var c=[],b=0;b<a.instructions.length;b++)a.instructions[b].position&&
c.push(a.instructions[b].position);return c}},a)}};COG.observable(i);return i}();
