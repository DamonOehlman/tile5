T5.registerRenderer("three:webgl",function(r,p,q,z){function t(a,b,c,d){a.position.x=c||b.xy.x;a.position.y=(d||b.xy.y)*-1;if(b.scaling!==1)a.scale=new THREE.Vector3(b.scaling,b.scaling,b.scaling);l[b.id]=b}function A(a){a.loading=true;T5.getImage(a.url,function(b){if(g[a.id]){b=new THREE.Texture(b);var c=a.mesh=new THREE.Mesh(u,new THREE.MeshBasicMaterial({map:b}));c.id=a.id;a.loading=false;l[a.id]=a;b.needsUpdate=true;c.position.x=a.x+a.w/2;c.position.y=-(a.y+a.h/2);e.addObject(c);r.invalidate()}})}
function v(){var a=[];for(var b in l){var c=l[b];if(!g[b]){e.removeChild(c.mesh);c.mesh=null;a[a.length]=b}}for(b=a.length;b--;)delete l[a[b]]}q=COG.extend({},q);var h,e,m,l={},g={},i,u,j,k,w=0,x=0,s=null,y=function(){};(function(){var a,b;if(p){j=r.width=p.offsetWidth;k=r.height=p.offsetHeight;a=(j/256|0)+1;b=(k/256|0)+1;e=new THREE.Scene;var c;c=new THREE.DirectionalLight(43775,2);c.position.z=1;e.addLight(c);c=new THREE.DirectionalLight(64,0.5);c.position.z=-1;e.addLight(c);i=new THREE.Mesh(new Plane(a*
256,b*256,a,b),new THREE.MeshBasicMaterial({color:16777215,wireframe:true}));e.addObject(i);h=new THREE.Camera(45,j/k,1,1500,i);h.position.z=150;u=new Plane(256,256,4,4);m=new THREE.WebGLRenderer;m.setSize(j,k);p.appendChild(m.domElement)}})();q=COG.extend(z,{interactTarget:m.domElement,applyStyle:function(){},applyTransform:function(a){if((a.translateX!==0||a.translateY!==0||a.scaling!==1||a.rotation!==0)&&a.mesh){var b=a.mesh.scale;b.x=b.y=b.z=a.scaling;s={undo:function(){s=null},x:a.xy.x,y:a.xy.y}}return s},
drawTiles:function(a,b){var c,d;for(d=b.length;d--;){c=b[d];g[c.id]=c;!c.mesh&&!c.loading&&A(c)}},prepare:function(a,b){w=b.x;x=b.y;h.position.x=i.position.x=w+j/2;i.position.y=-x-k/2;h.position.y=i.position.y-200/b.scaleFactor;h.position.z=150/b.scaleFactor;g={};return true},prepArc:function(a,b,c,d){if(!a.mesh){c=new Sphere(a.size,15,15);c=a.mesh=new THREE.Mesh(c,new THREE.MeshLambertMaterial({color:14540253,shading:THREE.FlatShading}));t(c,a);c.rotation.x=Math.PI/2;e.addObject(c)}g[a.id]=a;return{draw:y,
viewport:b,state:d,hit:false,vpX:b.x,vpY:b.y}},prepImage:function(a,b,c,d,n){var f=n.image||a.image;if(f&&!a.mesh){var o=new Plane(f.width,f.height);c=(n.x||a.xy.x)+f.width/2;n=(n.y||a.xy.y)+f.height/2;f=new THREE.Texture(f);o=a.mesh=new THREE.Mesh(o,new THREE.MeshBasicMaterial({map:f}));f.needsUpdate=true;t(o,a,c,n);o.position.z=1;e.addObject(o)}g[a.id]=a;return{draw:y,viewport:b,state:d,hit:false,vpX:b.x,vpY:b.y}},render:function(){v();m.render(e,h)},reset:function(){g={};v()},getCamera:function(){return h},
getContext:function(){},getDimensions:function(){return{width:j,height:k}}});COG.info("created three:webgl renderer");return q});
