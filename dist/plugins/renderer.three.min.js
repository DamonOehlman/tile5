T5.registerRenderer("three:webgl",function(q,o,p,B){function r(a,b,c,e){return{draw:e||C,viewport:a,state:c,hit:false,vpX:a.x,vpY:a.y}}function s(a,b,c,e,d){a.position.x=(c||b.xy.x)+b.translateX;a.position.y=(e||b.xy.y)*-1;a.position.z=(d||0)-b.translateY;if(b.scaling!==1)a.scale=new THREE.Vector3(b.scaling,b.scaling,b.scaling);m[b.id]=b;g.addObject(a)}function D(a){a.loading=true;T5.getImage(a.url,function(b){if(h[a.id]){b=new THREE.Texture(b);var c=a.mesh=new THREE.Mesh(w,new THREE.MeshBasicMaterial({map:b}));
c.id=a.id;a.loading=false;m[a.id]=a;b.needsUpdate=true;c.position.x=a.x+a.w/2;c.position.y=-(a.y+a.h/2);g.addObject(c);q.invalidate()}})}function x(){var a=[];for(var b in m){var c=m[b];if(!h[b]){g.removeChild(c.mesh);c.mesh=null;a[a.length]=b}}for(b=a.length;b--;)delete m[a[b]]}p=COG.extend({},p);var i,g,n,m={},h={},j,w,k,l,y,E={},t,z=0,A=0,u=null,C=function(){};(function(){var a,b;if(o){k=q.width=o.offsetWidth;l=q.height=o.offsetHeight;a=(k/256|0)+1;b=(l/256|0)+1;g=new THREE.Scene;var c;c=new THREE.DirectionalLight(43775,
2);c.position.z=1;g.addLight(c);c=new THREE.DirectionalLight(64,0.5);c.position.z=-1;g.addLight(c);j=new THREE.Mesh(new Plane(a*256,b*256,a,b),new THREE.MeshBasicMaterial({color:16777215,wireframe:true}));j.position.z=-1;g.addObject(j);i=new THREE.Camera(45,k/l,1,1500,j);i.position.z=150;w=new Plane(256,256,4,4);n=new THREE.WebGLRenderer;n.setSize(k,l);o.appendChild(n.domElement)}y=new Cube(5,5,5);t=[new THREE.MeshLambertMaterial({color:14540253,shading:THREE.FlatShading})]})();p=COG.extend(B,{interactTarget:n.domElement,
applyStyle:function(){},applyTransform:function(a){var b=a.mesh,c=a.translateX!==0||a.translateY!==0||a.scaling!==1||a.rotation!==0;if(b&&(c||a.transformed)){b.scale.x=b.scale.y=b.scale.z=a.scaling;b.rotation.z=a.rotation;b.position.x=a.xy.x+a.translateX;b.position.z=-a.translateY;u={undo:function(){u=null},x:a.xy.x,y:a.xy.y}}a.transformed=c;return u},drawTiles:function(a,b){var c,e;for(e=b.length;e--;){c=b[e];h[c.id]=c;!c.mesh&&!c.loading&&D(c)}},prepare:function(a,b){z=b.x;A=b.y;i.position.x=j.position.x=
z+k/2;j.position.y=-A-l/2;i.position.y=j.position.y-200/b.scaleFactor;i.position.z=150/b.scaleFactor;h={};return true},prepArc:function(a,b,c,e){if(!a.mesh){var d=new Sphere(a.size,15,15);d=a.mesh=new THREE.Mesh(d,t);s(d,a);d.rotation.x=Math.PI/2}h[a.id]=a;return r(b,c,e)},prepImage:function(a,b,c,e,d){var f=d.image||a.image;if(f&&!a.mesh){var v=new Plane(f.width,f.height),F=(d.x||a.xy.x)+f.width/2;d=(d.y||a.xy.y)+f.height/2;f=new THREE.Texture(f);v=a.mesh=new THREE.Mesh(v,new THREE.MeshBasicMaterial({map:f,
blending:THREE.BillboardBlending}));f.needsUpdate=true;s(v,a,F,d,1)}h[a.id]=a;return r(b,c,e)},prepMarker:function(a,b,c,e){if(!a.mesh){var d;switch(a.markerStyle.toLowerCase()){case "simple":d=a.mesh=new THREE.Mesh(E[a.markerStyle]||y,t);break}s(d,a)}h[a.id]=a;return r(b,c,e)},render:function(){x();n.render(g,i)},reset:function(){h={};x()},getCamera:function(){return i},getContext:function(){return context},getDimensions:function(){return{width:k,height:l}}});COG.info("created three:webgl renderer");
return p});
