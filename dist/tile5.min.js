(function(){function A(r,D){if(r&&r.split){var B=r.split(Q);if(B.length>1){r=B[0];D=B[1]}}else if(r&&r.lat){D=r.lon;r=r.lat}this.lat=parseFloat(r||0);this.lon=parseFloat(D||0)}function ja(r,D){if(r&&r.splice){for(var B=D,z=new A(Ea,ta),X=new A(Ja,Za),ia=r.length;ia--;){var fa=typeof r[ia]=="string"?new A(r[ia]):r[ia];if(fa.lat<z.lat)z.lat=fa.lat;if(fa.lat>X.lat)X.lat=fa.lat;if(fa.lon<z.lon)z.lon=fa.lon;if(fa.lon>X.lon)X.lon=fa.lon}this.min=z;this.max=X;if(typeof B=="undefined"){B=this.size();B=Math.max(B.x,
B.y)*0.3}this.min=new A(z.lat-B,(z.lon-B)%360);this.max=new A(X.lat+B,(X.lon+B)%360)}else{this.min=r;this.max=D}}function qa(r){if(typeof r=="string"){var D=(r.replace(/\d|\.|\s/g,"")||"m").toLowerCase();r=parseFloat(r)*({km:1E3}[D]||1)}this.meters=r||0}var Ka=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],aa=typeof module!="undefined"&&module.exports,ua=Math.PI*2,oa=Math.PI/2,ba=Math.PI/180,va=180/Math.PI,Ea=90,Ja=-Ea,ta=180,Za=-ta,Qa=Ea*ba,pa=-Qa,Ra=
ta*ba,Sa=-Ra,Q=/[\,\s]+/;A.prototype={constructor:A,copy:function(){return new A(this.lat,this.lon)},distanceTo:function(r){if(!r||this.empty()||r.empty())return 0;var D=(r.lat-this.lat)*ba/2,B=(r.lon-this.lon)*ba/2;r=Math.sin(D)*Math.sin(D)+Math.cos(this.lat*ba)*Math.cos(r.lat*ba)*Math.sin(B)*Math.sin(B);return 6371*2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))},equalTo:function(r){return pos&&this.lat===r.lat&&this.lon===r.lon},empty:function(){return this.lat===0&&this.lon===0},inArray:function(r){if(r)for(var D=
r.length;D--;)if(this.equal(r[D]))return true;return false},offset:function(r,D){var B=this.lat*ba,z=B+r/6371;B=this.lon*ba+Math.asin(Math.sin(D/6371)/Math.cos(B));z=(z+oa)%Math.PI-oa;B%=ua;return new A(z*va,B*va)},toBounds:function(r){var D=r.radians(),B=this.lat*ba,z=this.lon*ba;r=B-D;var X=B+D;if(r>pa&&X<Qa){B=Math.asin(Math.sin(D)/Math.cos(B));D=z-B;if(D<Sa)D+=ua;z=z+B;if(z>Ra)z-=ua}else{r=Math.max(r,pa);X=Math.min(X,Qa);D=Za;z=ta}return new ja(new A(r*va,D*va),new A(X*va,z*va))},toString:function(r){return this.lat+
(r||" ")+this.lon},valid:function(){return!(isNaN(this.lat)||isNaN(this.lon))}};ja.prototype={constructor:ja,bestZoomLevel:function(r,D){var B=this.center(),z=Ka[Math.min(Math.round(Math.abs(B.lat)*0.05),Ka.length)],X=this.size();B=Math.ceil(Math.log(Ka[3]*D/X.y)/Math.LN2);z=Math.ceil(Math.log(z*r/X.x)/Math.LN2);return Math.min(isNaN(B)?1E3:B,isNaN(z)?1E3:z)},center:function(){var r=this.size();return new A(this.min.lat+r.y/2,this.min.lon+r.x/2)},expand:function(r){return new ja(new A(this.min.lat-
r,(this.min.lon-r)%360),new A(this.max.lat+r,(this.max.lon+r)%360))},size:function(r){var D={x:0,y:this.max.lat-this.min.lat};D.x=typeof r!="undefined"&&r&&this.min.lon>this.max.lon?360-this.min.lon+this.max.lon:this.max.lon-this.min.lon;return D},toString:function(){return"min: "+this.min+", max: "+this.max},union:function(){for(var r=this.min.copy(),D=this.max.copy(),B=arguments.length;B--;)if(arguments[B]){var z=arguments[B].min,X=arguments[B].max;r.lat=Math.min(r.lat,z.lat);r.lon=Math.min(r.lon,
z.lon);D.lat=Math.max(D.lat,X.lat);D.lon=Math.max(D.lon,X.lon)}return new ja(r,D)}};qa.prototype={add:function(){for(var r=this.meters,D=arguments.length;D--;){var B=typeof arguments[D]=="string"?new qa(arguments[D]):arguments[D];r+=B.meters}return new qa(r)},radians:function(r){if(typeof r!="undefined"){this.meters=r*6371E3;return this}else return this.meters/6371E3},toString:function(){if(this.meters>1E3)return(this.meters/10|0)/100+"km";return this.meters+"m"}};var wa=this.GeoJS={Pos:A,BBox:ja,
Distance:qa,generalize:function(r,D,B){var z=r.length,X=[],ia=null;B=(B||250)/1E3;for(z=z;z--;)if(z===0)X.unshift(r[z]);else{var fa=!ia||r[z].inArray(D)?B:ia.distanceTo(r[z]);if(r[z]&&fa>=B){X.unshift(r[z]);ia=r[z]}}return X},include:function(r){if(aa){r=r.split(",");for(var D=0;D<r.length;D++){var B=require("./plugins/"+r[D].trim()),z;for(z in B)wa[z]=B[z]}}return wa}};if(aa)module.exports=wa})();
(function(){function A(){var a=arguments[0]||{},d=Array.prototype.slice.call(arguments,1),b=d.length,e,h;for(h=0;h<b;h++)if((e=d[h])!==null)for(var k in e){var f=e[k];if(a!==f)if(f!==undefined)a[k]=f}return a}function ja(a,d){if(typeof console!=="undefined")console[d||"log"](a)}function qa(a){var d=a.match(Za),b=[],e=0,h;for(h=d?d.length:0;h--;){var k=d[h].slice(1);b[k]||(b[k]=RegExp("\\{"+k+"\\}","g"))}e=b.length;return function(){var f=a;for(h=0;h<e;h++){var i=arguments[h];if(typeof i=="undefined")i=
"";f=f.replace(b[h],i)}return f}}function Ka(a,d){var b=$a*La(a);return X-2*pb(d*Fa((1-b)/(1+b),$a/2))}function aa(a,d){if(Q(a,Ca)){var b=a.split(qb);this.x=parseFloat(b[0]);this.y=parseFloat(b[1])}else if(a&&a.x){this.x=a.x;this.y=a.y}else{this.x=a||0;this.y=d||0}}function ua(a){this.allowCull=a}function oa(a,d,b,e){this.mercX=b;this.mercY=e;if(Q(a,Ca))A(this,Bb.parseXY(a));else a&&a.toBounds?A(this,ab(a.lon,a.lat)):aa.call(this,a,d)}function ba(a,d,b,e){this.x=a||0;this.y=d||0;this.w=b||0;this.h=
e||0;this.x2=this.x+this.w;this.y2=this.y+this.h}function va(a,d){var b=new rb(Math.sqrt(256<<a)|0);d&&d.zoomLevel===a&&d.copyInto(b);b.zoomLevel=a;return b}function Ea(a,d,b,e,h,k){this.x=a;this.y=d;this.w=e||256;this.h=e||256;this.x2=this.x+this.w;this.y2=this.y+this.h;this.url=b;this.id=k||a+"_"+d;this.loaded=false;this.image=null}function Ja(a,d){d=A({id:"layer_"+Cb++,zindex:0,animated:false,style:null,minXY:null,maxXY:null,visible:true},d);this.visible=d.visible;this.view=a;pa(A(this,d))}function ta(){pa(this)}
var Za=/\{(\d+)(?=\})/g,Qa=function(){var a=1.70158,d=Math.PI/2,b=Math.abs,e=Math.pow,h=Math.sin,k=Math.asin,f=Math.cos,i={linear:function(c,l,j,g){return j*c/g+l},backin:function(c,l,j,g){return j*(c/=g)*c*((a+1)*c-a)+l},backout:function(c,l,j,g){return j*((c=c/g-1)*c*((a+1)*c+a)+1)+l},backinout:function(c,l,j,g){return(c/=g/2)<1?j/2*c*c*(((a*=1.525)+1)*c-a)+l:j/2*((c-=2)*c*(((a*=1.525)+1)*c+a)+2)+l},bouncein:function(c,l,j,g){return j-i.bounceout(g-c,0,j,g)+l},bounceout:function(c,l,j,g){return(c/=
g)<1/2.75?j*7.5625*c*c+l:c<2/2.75?j*(7.5625*(c-=1.5/2.75)*c+0.75)+l:c<2.5/2.75?j*(7.5625*(c-=2.25/2.75)*c+0.9375)+l:j*(7.5625*(c-=2.625/2.75)*c+0.984375)+l},bounceinout:function(c,l,j,g){return c<g/2?i.bouncein(c*2,0,j,g)/2+l:i.bounceout(c*2-g,0,j,g)/2+j/2+l},cubicin:function(c,l,j,g){return j*(c/=g)*c*c+l},cubicout:function(c,l,j,g){return j*((c=c/g-1)*c*c+1)+l},cubicinout:function(c,l,j,g){if((c/=g/2)<1)return j/2*c*c*c+l;return j/2*((c-=2)*c*c+2)+l},elasticin:function(c,l,j,g,n,m){if(c==0)return l;
if((c/=g)==1)return l+j;m||(m=g*0.3);if(!n||n<b(j)){n=j;j=m/4}else j=m/z*k(j/n);return-(n*e(2,10*(c-=1))*h((c*g-j)*z/m))+l},elasticout:function(c,l,j,g,n,m){var p;if(c==0)return l;if((c/=g)==1)return l+j;m||(m=g*0.3);if(!n||n<b(j)){n=j;p=m/4}else p=m/z*k(j/n);return n*e(2,-10*c)*h((c*g-p)*z/m)+j+l},elasticinout:function(c,l,j,g,n,m){var p;if(c==0)return l;if((c/=g/2)==2)return l+j;m||(m=g*0.3*1.5);if(!n||n<b(j)){n=j;p=m/4}else p=m/z*k(j/n);if(c<1)return-0.5*n*e(2,10*(c-=1))*h((c*g-p)*z/m)+l;return n*
e(2,-10*(c-=1))*h((c*g-p)*z/m)*0.5+j+l},quadin:function(c,l,j,g){return j*(c/=g)*c+l},quadout:function(c,l,j,g){return-j*(c/=g)*(c-2)+l},quadinout:function(c,l,j,g){if((c/=g/2)<1)return j/2*c*c+l;return-j/2*(--c*(c-2)-1)+l},sinein:function(c,l,j,g){return-j*f(c/g*d)+j+l},sineout:function(c,l,j,g){return j*h(c/g*d)+l},sineinout:function(c,l,j,g){return-j/2*(f(Math.PI*c/g)-1)+l}};return function(c){c=c.replace(/[\-\_\s\.]/g,"").toLowerCase();return i[c]||i.linear}}(),pa=function(){function a(b,e){var h=
b.hasOwnProperty("obsHandlers")?b.obsHandlers:null;h[e]||(h[e]=[]);return h[e]}var d=0;return function(b){if(!b)return null;if(!(b.hasOwnProperty("obsHandlers")?b.obsHandlers:null))b.obsHandlers={};if(!b.hasOwnProperty("bind")){b.bind=function(e,h){var k="callback"+d++;a(b,e).unshift({fn:h,id:k});return k};b.triggerCustom=function(e,h){var k=a(b,e),f={cancel:false,name:e,source:this},i;for(i in h)f[i]=h[i];if(!k)return null;i=Array.prototype.slice.call(arguments,2);b.eventInterceptor&&b.eventInterceptor(e,
f,i);i.unshift(f);for(var c=k.length;c--&&!f.cancel;)k[c].fn.apply(this,i);return f};b.trigger=function(e){var h=Array.prototype.slice.call(arguments,1);h.splice(0,0,e,null);return b.triggerCustom.apply(this,h)};b.unbind=function(e,h){if(typeof e==="undefined")b.obsHandlers={};else for(var k=a(b,e),f=0;k&&f<k.length;f++)if(k[f].id===h){k.splice(f,1);break}return b}}return b}}(),Ra=function(){function a(d,b,e,h){if(typeof d[h]=="undefined")d[h]=function(k){if(typeof k!="undefined"){b[h]=k;e[h]&&e[h](k);
return d}else return b[h]}}return function(d,b,e){b=b||d;for(var h in b)typeof b[h]!="function"&&a(d,b,e,h);return d}}(),Sa=Array.prototype.indexOf||function(a){for(var d=0;d<this.length;d++)if(this[d]===a)return d;return-1},Q=function(){var a={NaN:1,Infinity:1,"-Infinity":1},d=String.prototype.toLowerCase,b=Object.prototype.toString;return function(e,h){h=d.call(h);if(h=="finite")return!a.hasOwnProperty(+e);return h=="null"&&e===null||h==typeof e||h=="object"&&e===Object(e)||h=="array"&&Array.isArray&&
Array.isArray(e)||b.call(e).slice(8,-1).toLowerCase()==h}}();(function(){function a(k){var f=document.createElement("script"),i=false;f.src=k;f.async=true;f.onload=f.onreadystatechange=function(){if(!i&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){i=true;f.onload=f.onreadystatechange=null;f&&f.parentNode&&f.parentNode.removeChild(f)}};h||(h=document.getElementsByTagName("head")[0]);h.appendChild(f)}function d(k,f,i){k+=k.indexOf("?")>=0?"&":"?";var c="json"+ ++e;window[c]=
function(l){f(l);window[c]=null;try{delete window[c]}catch(j){}};a(k+(i?i:"callback")+"="+c);return c}function b(k,f,i){var c=require("request");k=k+(k.indexOf("?")>=0?"&":"?")+(i?i:"callback")+"=cb";c({uri:k},function(l,j,g){if(l)f({error:l});else{l=g.replace(/^.*\(/,"").replace(/\).*$/,"");f(JSON.parse(l))}})}var e=0,h;return typeof window!="undefined"?d:b})();INTERACT=function(){function a(n){return function(m,p){n.addEventListener(m,p,false)}}function d(n){return function(m,p){n.removeEventListener(m,
p,false)}}function b(n){return function(m,p){n.attachEvent("on"+m,p)}}function e(n,m){return{x:n?n:0,y:m?m:0,count:1}}function h(n,m){j.push(A({handler:null,checks:{},type:n},m))}function k(n){var m=0,p=0;if(n.offsetParent){do{m+=n.offsetLeft;p+=n.offsetTop;n=n.offsetParent}while(n)}return{left:m,top:p}}function f(n,m){return{source:n,target:m.target?m.target:m.srcElement}}function i(n,m){for(var p=n.target?n.target:n.srcElement;p&&p!==m;)p=p.parentNode;return p&&p===m}function c(n,m){return{x:n.x-
(m?m.left:0),y:n.y-(m?m.top:0)}}function l(n,m){if(n.preventDefault){n.preventDefault();n.stopPropagation()}else if(typeof n.cancelBubble!="undefined")n.cancelBubble=true;m&&n.stopImmediatePropagation&&n.stopImmediatePropagation()}var j=[],g=function(n,m,p){p=A({binder:null,unbinder:null,observable:null},p);for(var u=p.observable,y=[],N,Y,$={bind:function(){return u.bind.apply(null,arguments)},unbind:function(){u.unbind();for(O=0;O<y.length;O++)y[O].unbind();return $}},O=0;O<m.length;O++)y.push(m[O](n,
u,p));u.bind("pointerDown",function(){Y=N=0});u.bind("pointerMove",function(s,E,w,x){N+=x.x||0;Y+=x.y||0});u.bind("pointerUp",function(s,E,w){Math.abs(N)>20||Math.abs(Y)>20||u.triggerCustom("tap",s,E,w)});return $};h("pointer",{handler:function(n,m,p){function u(v){if(v.pageX&&v.pageY)return e(v.pageX,v.pageY);else{var I=document.documentElement,R=document.body;return e(v.clientX+(I&&I.scrollLeft||R&&R.scrollLeft||0)-(I&&I.clientLeft||R&&R.clientLeft||0),v.clientY+(I&&I.scrollTop||R&&R.scrollTop||
0)-(I&&I.clientTop||R&&R.clientTop||0))}}function y(v){if(i(v,n))if(L=O(v)){var I=u(v);n.style.cursor="move";l(v,true);W=I.x;P=I.y;F=e(W,P);m.triggerCustom("pointerDown",f("mouse",v),F,c(F,k(n)))}}function N(v){var I=u(v);G=I.x;U=I.y;if(i(v,n))E(v,L?"pointerMove":"pointerHover")}function Y(v){if(L&&O(v)){L=false;if(i(v,n)){n.style.cursor="default";E(v,"pointerUp")}}}function $(v){if(i(v,n)){var I;v=v||window.event;if(v.detail){if(typeof v.axis=="undefined"||v.axis===2)I=-v.detail*w}else{I=v.wheelDeltaY?
v.wheelDeltaY:v.wheelDelta;if(window.opera)I=-I}if(I){var R=e(G,U);m.triggerCustom("zoom",f("mouse",v),R,c(R,k(n)),I/x,"wheel");l(v);v.returnValue=false}}}function O(v){v=v||window.event;return(v.which||v.button)==1}function s(){return false}function E(v,I,R,ka,C){R=typeof R!="undefined"?R:G;ka=typeof ka!="undefined"?ka:U;var M=R-W,J=ka-P,ea=e(R,ka);m.triggerCustom(I,f("mouse",v),ea,c(ea,k(n)),e(M,J));if(typeof C=="undefined"||C){W=R;P=ka}}p=A({},p);var w=120,x=w*8,L=false,F,G,U,W,P;p.binder("mousedown",
y);p.binder("mousemove",N);p.binder("mouseup",Y);p.binder("dblclick",function(v){if(i(v,n)){var I=u(v);m.triggerCustom("doubleTap",f("mouse",v),I,c(I,k(n)))}});p.binder("selectstart",s);p.binder("dragstart",s);p.binder("mousewheel",$);p.binder("DOMMouseScroll",$);return{unbind:function(){p.unbinder("mousedown",y);p.unbinder("mousemove",N);p.unbinder("mouseup",Y);p.unbinder("mousewheel",$);p.unbinder("DOMMouseScroll",$)}}},checks:{touch:false}});h("pointer",{handler:function(n,m,p){function u(C){if(C.count<
2)return 0;var M=C.x-C.next.x;C=C.y-C.next.y;return~~Math.sqrt(M*M+C*C)}function y(C,M,J){M=M?M:0;J=J?J:0;for(var ea={x:C.x-M,y:C.y-J,id:C.id,count:C.count},S=ea;C.next;){C=C.next;S=S.next={x:C.x-M,y:C.y-J,id:C.id}}return ea}function N(C,M){var J=C[M?M:"touches"],ea,S;if(J.length===0)return null;S=ea={x:J[0].pageX,y:J[0].pageY,id:J[0].identifier,count:J.length};for(var V=1,xa=J.length;V<xa;V++)S=S.next={x:J[V].pageX,y:J[V].pageY,id:J[V].identifier};return ea}function Y(C){if(i(C,n)){G=k(n);var M=
N(C,"changedTouches"),J=y(M,G.left,G.top);if(!W){U=x;m.triggerCustom("pointerDown",f("touch",C),M,J)}R&&m.triggerCustom("pointerDownMulti",f("touch",C),M,J);W=N(C);if(W.count>1)v=u(W);ka=1;I=y(W)}}function $(C){if(i(C,n)){l(C);P=N(C);if(U==x)U=Math.abs(W.x-P.x)>E||Math.abs(W.y-P.y)>E?w:x;if(U!=x){U=P.count>1?F:L;if(U==F)if(W.count===1){W=y(P);v=u(W)}else{var M=u(P);if(Math.abs(v-M)<s)U=L;else{var J;J=P.x;var ea=P.next.x,S=P.y,V=P.next.y;J={x:(J<ea?J:ea)+(Math.abs(J-ea)>>1),y:(S<V?S:V)+(Math.abs(S-
V)>>1)};M=M/v;ea=M-ka;m.triggerCustom("zoom",f("touch",C),J,c(J,G),ea,"pinch");ka=M}}U==L&&m.triggerCustom("pointerMove",f("touch",C),P,y(P,G.left,G.top),e(P.x-I.x,P.y-I.y));R&&m.triggerCustom("pointerMoveMulti",f("touch",C),P,y(P,G.left,G.top))}I=y(P)}}function O(C){if(i(C,n)){var M=N(C,"changedTouches"),J=y(M,G.left,G.top);P=N(C);if(!P){m.triggerCustom("pointerUp",f("touch",C),M,J);W=null}R&&m.triggerCustom("pointerUpMulti",f("touch",C),M,J)}}p=A({detailed:false,inertia:false},p);var s=20,E=7,w=
0,x=1,L=2,F=3,G,U,W,P,v,I,R=p.detailed,ka=1;p.binder("touchstart",Y);p.binder("touchmove",$);p.binder("touchend",O);ja("initialized touch handler");return{unbind:function(){p.unbinder("touchstart",Y);p.unbinder("touchmove",$);p.unbinder("touchend",O)}}},checks:{touch:true}});return{register:h,watch:function(n,m,p){m=A({bindTarget:null,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},m);capabilities=A({touch:"ontouchstart"in window},p);if(!m.observable){ja("creating observable");
m.observable=pa({});globalOpts=m}m.binder=(m.isIE?b:a)(m.bindTarget||document);m.unbinder=(m.isIE?b:d)(m.bindTarget||document);p=m.types;for(var u=capabilities,y=[],N=j.length;N--;){var Y=j[N],$=!p||p.indexOf(Y.type)>=0,O=true,s;for(s in Y.checks){var E=Y.checks[s];ja("checking "+s+" capability. require: "+E+", capability = "+u[s]);O=O&&E===u[s]}if($&&O)y[y.length]=Y.handler}return new g(n,y,m)}}}();var wa=this.T5=pa({}),r=function(){var a={};return{create:function(d,b){if(a[d][b])return a[d][b].apply(null,
Array.prototype.slice.call(arguments,2));throw B(d,b);},get:function(d,b){return a[d]?a[d][b]:null},register:function(d,b,e){a[d]||(a[d]={});a[d][b]&&ja(D(d,b),"warn");a[d][b]=e}}}(),D=qa("Registration of {0}: {1} will override existing definition"),B=qa("Could not create {0} of type: {1}");qa("Could not create drawable of type: {0}");var z=Math.PI*2,X=Math.PI/2,ia=Math.PI/180,fa=180/Math.PI,$a=0.08181919084262157,ya=Math.abs,bb=Math.round,sb=Math.min,cb=Math.max,Fa=Math.pow,Db=Math.sqrt,jb=Math.log,
La=Math.sin,db=Math.cos,pb=Math.atan,Ga="undefined",Ca="string",Da="number",ra=r.register,Ma=r.create,Eb=r.get,Fb=0,Cb=0,qb=/[\,\s]+/,Na=function(){function a(f){h++;f=T?window.mozAnimationStartTime||f||(new Date).getTime():(new Date).getTime();for(var i=e.length;i--;){var c=e[i];h%c.every===0&&c.cb(f)}k&&animFrame(a)}var d=1E3/60,b=["r","webkitR","mozR","oR","msR"],e=[],h=0,k=T&&function(){for(var f=0;f<b.length;f++)window.animFrame=window.animFrame||window[b[f]+"equestAnimationFrame"];return animFrame}();
k?animFrame(a):setInterval(a,1E3/60);return{attach:function(f,i){e[e.length]={cb:f,every:i?bb(i/d):1}},detach:function(f){for(var i=e.length;i--;)if(e[i].cb===f){e.splice(i,1);break}}}}(),Bb=function(){var a=/^xy\((.*)\).*$/i;return{parseXY:function(d){if(!a.test(d)){d=d.split(qb);return ab(d[1],d[0])}}}}(),T=typeof window!="undefined"?function(){function a(h){for(var k=0;k<h.length;k++){var f=h[k];if(typeof document.body.style[f]!="undefined")return f}}var d={"-webkit-user-select":"none",position:"absolute"},
b,e;b=a(["-webkit-transform","MozTransform"]);css3DTransformProp=a(["WebkitPerspective","MozPerspective"]);e=a(["-webkit-transform-origin","MozTransformOrigin"]);return{transforms:Q(b,Ca),create:function(h,k,f){h=document.createElement(h);var i=[];f=f||{};h.className=k||"";for(var c in f)i[i.length]=c+": "+f[c];h.style.cssText=i.join(";");return h},move:function(h,k,f,i,c){if(b){h.style[b]="translate("+k+"px, "+f+"px) "+(i||[]).join(" ");if(c&&e)h.style[e]=c.x+"px "+c.y+"px"}else{h.style.left=k+"px";
h.style.top=f+"px"}},styles:function(h){return A({},d,h)}}}():null,tb=function(){function a(){for(var h=e.length,k=h;k--;)try{e[k](h)}catch(f){ja(f.toString(),"error")}}var d=20,b=50,e=[];return{process:function(h,k,f,i){function c(g){g=(l||b)/g;if(j<h.length){var n=h.slice(j,j+g);g=n.length;var m=l?0:(new Date).getTime();k(n,g);if(!l)l=(n=((new Date).getTime()-m)/g)?d/n|0:h.length;j+=g}else{for(g=e.length;g--;)if(e[g]===c){e.splice(g,1);break}e.length===0&&Na.detach(a);f&&f()}}var l,j=0;if(T&&h.length>
(i||0))e.push(c)===1&&Na.attach(a);else{k(h,h.length);f&&f()}}}}(),ab=ab||function(a,d){var b=parseFloat(d)*ia;b=La(b);var e=$a*b;b=jb((1+b)/(1-b)*Fa((1-e)/(1+e),$a))/2;return new oa(0,0,parseFloat(a)*ia,b)},kb=kb||function(a,d){for(var b=Fa(Math.E,-d),e=X-2*pb(b),h=Ka(e,b),k=0;k<12&&ya(e-h)>1.0E-7;){e=h;h=Ka(e,b);k++}return new GeoJS.Pos(h*fa,a%360*fa)};aa.prototype={constructor:aa,add:function(){for(var a=this.x,d=this.y,b=arguments.length;b--;){a+=arguments[b].x;d+=arguments[b].y}return this.copy(a,
d)},copy:function(a,d){var b=A({},this);b.x=a||b.x;b.y=d||b.y;return b},equals:function(a){return this.x===a.x&&this.y===a.y},offset:function(a,d){return this.copy(this.x+a,this.y+d)},relative:function(a){a=a.viewport();return this.copy(this.x-a.x-a.padding.x,this.y-a.y-a.padding.y)},rotate:function(a,d){d=d||new aa(0,0);var b=this.x-d.x,e=this.y-d.y;return new aa(d.x+db(a)*b+-La(a)*e,d.y+La(a)*b+db(a)*e)},scale:function(a,d){d=d||new aa(0,0);return new aa(d.x+(this.x-d.x)*a,d.y+(this.y-d.y)*a)},
sync:function(){return this},toString:function(){return this.x+", "+this.y}};ua.prototype=A([],{cull:function(a){if(this.allowCull){var d=a.x,b=a.y,e=a.x+a.w;a=a.y+a.h;for(var h=Infinity,k=0,f,i=this.length;i--;)if(f=this[i].x>=d&&this[i].x<=e&&this[i].y>=b&&this[i].y<=a){h=i<h?i:h;k=i>k?i:k}return this.slice(cb(h-1,0),sb(k+1,this.length))}return this},simplify:function(a){a=a||3;for(var d=new ua(this.allowCull),b=null,e=this.length;e--;){var h=this[e];if(include=!b||e===0||ya(h.x-b.x)+ya(h.y-b.y)>
a){d.unshift(h);b=h}}return d}});oa.prototype=A(new aa,{constructor:oa,pos:function(){return kb(this.mercX,this.mercY)},sync:function(a,d){var b;if(!(b=a.rpp)){b=a.zoom();b=z/(256<<b)}b=b;if(d){this.mercX=this.x*b-Math.PI;this.mercY=Math.PI-this.y*b}else{this.x=bb(((this.mercX||0)+Math.PI)/b);this.y=bb((Math.PI-(this.mercY||0))/b)}return this}});ba.prototype={constructor:ba,buffer:function(a,d){return new ba(this.x-a,this.y-(d||a),this.w+a*2,this.h+(d||a)*2)},center:function(){return new aa(this.x+
(this.w>>1),this.y+(this.h>>1))}};Hits=function(){return{diffHits:function(a,d){var b=[],e={},h;for(h=d.length;h--;)e[d[h].target.id]=true;for(h=a.length;h--;)e[a[h].target.id]||(b[b.length]=a[h]);return b},init:function(a,d,b,e,h){return{type:a,x:h.x,y:h.y,gridX:e.x|0,gridY:e.y|0,elements:[],absXY:d,relXY:b}},initHit:function(a,d,b){return{type:a,target:d,drag:b}},triggerEvent:function(a,d,b,e){d.triggerCustom(a.type+(b?b:"Hit"),{hitType:a.type},e?e:a.elements,a.absXY,a.relXY,new oa(a.gridX,a.gridY))}}}();
var rb=function(a){function d(k,f){var i=b[k],c;i||(i=b[k]=[]);(c=i[f])||(c=i[f]=[]);return c}a=a||128;var b=[],e={},h=0;return{copyInto:function(k){for(var f in e){var i=e[f];k.insert(i.bounds||i,i,f)}},insert:function(k,f,i){var c=k.x/a|0,l=k.y/a|0,j=(k.x+k.w)/a|0;k=(k.y+k.h)/a|0;i=i||f.id||"obj_"+h++;e[i]=f;for(f=c;f<=j;f++)for(c=l;c<=k;c++)d(f,c).push(i)},remove:function(k,f,i){i=i||f.id;if(e[i]){var c=k.x/a|0;f=k.y/a|0;var l=(k.x+k.w)/a|0;k=(k.y+k.h)/a|0;delete e[i];for(c=c;c<=l;c++)for(var j=
f;j<=k;j++){var g=d(c,j),n=Sa.call(g,i);n>=0&&g.splice(n,1)}}},search:function(k){var f=k.y/a|0,i=(k.x+k.w)/a|0,c=(k.y+k.h)/a|0,l=[],j=[];for(k=k.x/a|0;k<=i;k++)for(var g=f;g<=c;g++)l=l.concat(d(k,g));l.sort();for(f=l.length;f--;){i=l[f];if(c=e[i])j[j.length]=c;for(;f>0&&l[f-1]==i;)f--}return j}}},eb=function(){var a={},d=0;(new Date).getTime();var b={},e=[];Na.attach(function(h){h=h||(new Date).getTime();for(var k=0;k<e.length;){var f=e[k],i=b[f],c=b[f].image&&b[f].image.complete&&b[f].image.width>
0,l=h-i.start;l=c||l>=3E4;if(c){c=i.callbacks;a[f]=i.image;for(var j=0;j<c.length;j++)c[j](i.image,true)}if(l){e.splice(k,1);delete b[f]}else k++}},250);return function(h,k){var f=h&&k?a[h]:null;if(f&&f&&f.complete&&f.width>0)k(f);else if(f=b[h])f.callbacks.push(k);else{f=new Image;f.id="_ldimg"+ ++d;b[h]={start:(new Date).getTime(),image:f,callbacks:[k]};f.src=h;e[e.length]=h}}}();Ea.prototype={constructor:Ea,load:function(a){var d=this;eb(this.url,function(b){d.loaded=true;d.image=b;a&&a()})}};
var Gb=function(){return pa({fastpan:true,applyStyle:function(){},applyTransform:function(a,d,b){return{restore:null,x:d,y:b}},getDimensions:function(){return{width:0,height:0}},getViewport:function(){},hitTest:function(){return false},prepare:function(){},projectXY:null,reset:function(){}})};ra("renderer","canvas",function(a,d,b,e,h){function k(){function s(x,L){this.save();this.setTransform(1,0,0,1,0,0);var F=this.isPointInPath_old(x,L);this.restore();return F}var E=CanvasRenderingContext2D.prototype,
w=document.createElement("canvas").getContext("2d");w.translate(50,0);w.moveTo(125,50);w.arc(100,50,25,0,360,false);if(!w.isPointInPath(150,50)){E.isPointInPath_old=E.isPointInPath;E.isPointInPath=s}}function f(s,E,w){var x,L;p[E]=function(F){for(x=$.length;x--;)if(L=w[$[x]])F[O[x]]=L}}function i(s,E,w){return{draw:w||Y,viewport:s,hit:E&&g.isPointInPath(E.x,E.y),vpX:n,vpY:m,context:g}}e=A({},e);var c,l,j,g,n=0,m=0,p={},u=null,y={},N=function(){},Y=function(){this.fill&&g.fill();this.stroke&&g.stroke()},
$=["fill","stroke","lineWidth","opacity"],O=["fillStyle","strokeStyle","lineWidth","globalAlpha"];T&&k();if(d){c=d.offsetWidth;l=d.offsetHeight;j=T?T.create("canvas",null,{position:"absolute","z-index":1}):new Canvas;j.width=c;j.height=l;a.attachFrame(j,true);g=null}b=A(h,{applyStyle:function(s){var E=p[s],w=g&&g.canvas?g.canvas.id:"default",x;y[w]||(y[w]=[]);x=y[w].pop()||"reset";if(E){y[w].push(s);E(g);return x}},applyTransform:function(s){if(s.translateX!==0||s.translateY!==0||s.scaling!==1||s.rotation!==
0){g.save();u={undo:function(){g.restore();u=null},x:s.xy.x,y:s.xy.y};g.translate(s.xy.x-n+s.translateX,s.xy.y-m+s.translateY);s.rotation!==0&&g.rotate(s.rotation);s.scaling!==1&&g.scale(s.scaling,s.scaling)}return u},drawTiles:function(s,E,w){for(var x=E.length;x--;){s=E[x];if(!s.loaded&&w)s.load(a.invalidate);else s.image&&g.drawImage(s.image,s.x-n,s.y-m)}},prepare:function(s,E){var w,x=false;if(g)g.restore();else if(j)g=j.getContext("2d");for(w=s.length;w--;)x=x||s[w].clip;n=E.x;m=E.y;if(g){x||
g.clearRect(0,0,c,l);g.save();g.globalCompositeOperation="source-over"}return g},prepArc:function(s,E,w){g.beginPath();g.arc(s.xy.x-(u?u.x:n),s.xy.y-(u?u.y:m),s.size>>1,s.startAngle,s.endAngle,false);return i(E,w)},prepImage:function(s,E,w,x){var L=(x.x||s.xy.x)-(u?u.x:n),F=(x.y||s.xy.y)-(u?u.y:m),G=x.image||s.image;if(G){g.beginPath();g.rect(L,F,x.width||G.width,x.height||G.height);return i(E,w,function(){g.drawImage(G,L,F,x.width||G.width,x.height||G.height)})}},prepMarker:function(s,E,w){var x=
s.xy.x-(u?u.x:n),L=s.xy.y-(u?u.y:m),F=s.size,G=undefined;g.beginPath();switch(s.markerType.toLowerCase()){case "image":G=N;g.rect(x-(F>>1),L-(F>>1),F,F);if(s.reset&&s.image){s.image=null;s.reset=false}s.image?g.drawImage(s.image,x-(F>>1),L-(F>>1),F,F):eb(s.imageUrl,function(U){s.image=U;g.drawImage(s.image,x-(F>>1),L-(F>>1),F,F)});break;default:g.moveTo(x,L);g.lineTo(x-(F>>1),L-F);g.lineTo(x+(F>>1),L-F);g.lineTo(x,L)}return i(E,w,G)},prepPoly:function(s,E,w,x){var L=true;s=x.points||s.points().cull(E);
x=u?u.x:n;var F=u?u.y:m;g.beginPath();for(var G=s.length;G--;){var U=s[G].x-x,W=s[G].y-F;if(L){g.moveTo(U,W);L=false}else g.lineTo(U,W)}return i(E,w)},getContext:function(){return g}});(function(){ub.each(function(s,E){f(null,s,E)});wa.bind("styleDefined",f)})();b.bind("detach",function(){d.removeChild(j)});b.bind("resize",function(){});return b});ra("renderer","dom",function(a,d,b,e,h){function k(j){var g=j.image=new Image;c[j.id]=j;g.src=j.url;g.onload=function(){if(l[j.id])i.appendChild(this);
else j.image=null};g.style.cssText="-webkit-user-select: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute;";return g}function f(j,g,n){var m=[],p;for(p in j){var u=
j[p];if(n?u[n]:!g[p]){if(u.image&&u.image.parentNode){i.removeChild(u.image);u.image=null}m[m.length]=p}}for(g=m.length;g--;)delete j[m[g]]}var i=null,c={},l={};i=T.create("div","",T.styles({width:d.offsetWidth+"px",height:d.offsetHeight+"px"}));d.childNodes.length>0?d.insertBefore(i,d.childNodes[0]):d.appendChild(i);a.attachFrame(i);b=A(h,{drawTiles:function(j,g,n){for(var m,p=j.x,u=j.y,y=g.length;y--;){j=g[y];if(j.url){(m=j.image||(n?k(j):null))&&T.move(m,j.x-p,j.y-u);l[j.id]=j}}}});b.bind("predraw",
function(){f(c,l);l={}});b.bind("detach",function(){d.removeChild(i)});a.bind("reset",function(){for(f(c,l={});i.childNodes.length>0;)i.removeChild(i.childNodes[0])});return b});var ub=function(){function a(b,e){if(Q(b,Ca)){wa.trigger("styleDefined",b,d[b]=e);return b}else{var h=[],k;for(k in b)h[h.length]=a(k,b[k]);return h}}var d={};a({reset:{fill:"#ffffff",opacity:1},highlight:{fill:"#ff0000"},waypoints:{lineWidth:4,stroke:"#003377",fill:"#ffffff"},waypointsHover:{lineWidth:4,stroke:"#ff0000",
fill:"#ffffff"}});return{resetStyle:"reset",each:function(b){for(var e in d)b(e,d[e])},get:function(b){return d[b]},define:a}}(),Ab=function(a,d){function b(o,q,t,H){o=x?cb(ca+Fa(2,H)-1,0.125):H>0?2:0.5;s(o,false,true)}function e(o,q){var t=da&&da.projectXY?da.projectXY(o,q):null;if(!t){t=Y();var H=1/ca;t=new K.XY(t?t.x+(o+t.padding.x)*H:o,t?t.y+(q+t.padding.y)*H:q)}return t.sync(K,true)}function h(o,q,t){o=e(t.x,t.y);K.trigger("doubleTap",q,t,o);d.scalable&&s(2,{easing:"sine.inout",duration:700},
true,o)}function k(o,q,t){I=null;C=true;y("down",q,t)}function f(o,q,t){y("hover",q,t)}function i(o,q,t,H){m(q,t,false);if(!I){M+=H.x;J+=H.y}}function c(o,q,t){m(q,t,true);C=false}function l(){clearTimeout(vb);vb=setTimeout(function(){if(v)if(v.offsetWidth!==Ta*2||v.offsetHeight!==Ua*2){var o=N();u(a);N(o.x,o.y)}},250)}function j(o,q,t){y("tap",q,t);K.trigger("tap",q,t,e(t.x,t.y,true))}function g(){ma&&ma.unbind();if(T&&da){ma=INTERACT.watch(da.interactTarget||v);if(d.scalable){ma.bind("zoom",b);
ma.bind("doubleTap",h)}ma.bind("pointerDown",k);ma.bind("pointerMove",i);ma.bind("pointerUp",c);d.captureHover&&ma.bind("pointerHover",f);ma.bind("tap",j)}}function n(o){if(da){da.trigger("detach");da=null}var q=K,t=W,H=v,Z=d;o=o.split("/");for(var ga=new Gb(q,t,H,Z),za=0;za<o.length;za++)ga=Ma("renderer",o[za],q,t,H,Z,ga);da=ga;ka=T&&da.fastpan&&T.transforms;x=T&&T.transforms&&d.useTransforms;g();K.trigger("reset");O()}function m(o,q,t){if(I){o=e(q.x,q.y);I.drag.call(I.target,I,o.x,o.y,t)&&ha++;
if(t)I=null}}function p(o){for(var q=U;q--;)if(G[q].id===o)return q;return U}function u(o){if(T){v=document.getElementById(o);v.appendChild(P=T.create("div","",T.styles({overflow:"hidden",width:v.offsetWidth+"px",height:v.offsetHeight+"px"})));o=d.padding;if(o===w){o=v.offsetWidth;var q=v.offsetHeight,t=Db(o*o+q*q);na=new aa(t-o>>1,t-q>>1)}else na=new aa(o,o);fb=P.offsetWidth+na.x*2;gb=P.offsetHeight+na.y*2;lb=fb/2;mb=gb/2;Ta=v.offsetWidth/2;Ua=v.offsetHeight/2;Va=new aa(lb,mb);P.appendChild(W=T.create("div",
"",T.styles({width:fb+"px",height:gb+"px","z-index":2,margin:-na.y+"px 0 0 "+-na.x+"px"})));n(d.renderer);o=d.controls;for(q=0;q<F.length;q++)F[q].trigger("detach");F=[];for(q=0;q<o.length;q++)F[F.length]=Ma("control",o[q],K,P,v,d[o[q]])}else n("canvas")}function y(o,q,t){var H=(new aa(t.x-Ta+lb,t.y-Ua+mb)).rotate(-sa*ia,Va).scale(1/ca,Va);la=Hits.init(o,q,t,e(t.x,t.y,true),H);R=false;for(o=U;o--;)if(G[o].visible)R=R||(G[o].hitGuess?G[o].hitGuess(la.gridX,la.gridY,K):false);R&&ha++}function N(o,q,
t){if(typeof o!="undefined"&&(Q(o,Ca)||Q(o,"object"))){q=new K.XY(o);q.sync(K);o=q.x;q=q.y}if(Q(o,Da)){E(o-Ta-na.x,q-Ua-na.y,t);return K}else return E().offset(Ta+na.x|0,Ua+na.y|0).sync(K,true)}function Y(){var o=new ba(S,V,fb,gb);o.scaleFactor=ca;o.padding=na?na.copy():new aa;return o}function $(o,q,t){if(Q(o,Ca)&&Q(q,Ga))for(q=0;q<U;q++){if(G[q].id===o)return G[q]}else if(Q(o,Ca)){q=Ma("layer",q,K,t);t=p(o);t!==U&&K.trigger("layerRemove",G[t]);q.added=(new Date).getTime();q.id=o;G[t]=q;G.sort(function(H,
Z){return Z.zindex-H.zindex||Z.added-H.added});U=G.length;K.trigger("resync");O();K.trigger("layerChange",K,q);ha++;return q}else return[].concat(G)}function O(){var o=Y();if(o){if(Oa||Pa)if(o){var q=hb?S+(o.w>>1):S,t=ib?V+(o.h>>1):V,H=o.w,Z=o.h;if(Oa&&Oa>H)if(q+H>Oa)S=hb?S:Oa-H;else if(q<0)S=hb?S:0;if(Pa&&Pa>Z)if(t+Z>Pa)V=ib?V:Pa-Z;else if(t<0)V=ib?V:0}wb=S;xb=V;K.trigger("refresh",K,o);ha++}}function s(o,q,t,H){if(Q(o,Da)){var Z=t?o:ca*o;if(!x){q=undefined;o=bb(jb(Z)/Math.LN2);Z=Fa(2,o)}if(H){o=
K.center();K.pan(H.x-o.x,H.y-o.y,q)}if(q)Wa=Aa.tween([ca],[Z],q,function(){ca=Z;Wa=null;ha++});else{ca=Z;ha++}return K}else return ca}function E(o,q,t){if(Q(o,Da)){if(t)Ba=Aa.tween([S,V],[o,q],t,function(){S=o|0;V=q|0;xa=Ha=0;Ba=null;ha++});else{S=o|0;V=q|0;ha++}return K}else return(new K.XY(S,V)).sync(K,true)}d=A({captureHover:true,controls:[],drawOnScale:true,padding:128,inertia:true,refreshDistance:128,pannable:true,scalable:true,renderer:"canvas",useTransforms:true},d);var w="auto",x=true,L=false,
F=[],G=[],U=0,W=null,P=null,v,I=null,R=false,ka,C=false,M=0,J=0,ea=d.refreshDistance,S=0,V=0,xa=0,Ha=0,wb=0,xb=0,Oa=null,Pa=null,hb=false,ib=false,Ba=null,na,la=null,Xa=null,da,vb=0,Va=new aa,sa=0,Ya=null,ca=1,Wa=null,nb=1,ma=null,ob={index:0,draw:false},ha=0,fb,gb,lb,mb,Ta,Ua,K={XY:aa,id:d.id,panSpeed:0,attachFrame:function(o,q){q&&W.appendChild(o)},center:N,detach:function(){da&&da.trigger("detach");ma&&ma.unbind();if(P){v.removeChild(P);W=P=null}},frozen:function(o){if(Q(o,Ga))return L;else{L=
o;return K}},layer:$,invalidate:function(){ha++},pan:function(o,q,t){E(S+o,V+q,t)},refresh:O,rotate:function(o,q,t){if(Q(o,Da)){var H=t?o:sa+o;if(q)Ya=Aa.tween([sa],[H],q,function(){sa=H%360;Ya=null;ha++});else{sa=H%360;ha++}return K}else return sa},scale:s,setMaxOffset:function(o,q,t,H){Oa=o;Pa=q;hb=t;ib=H},offset:E,viewport:Y};pa(K);K.bind("resize",l);K.bind("layerRemove",function(o,q){var t=Sa(G,q.id);if(t>=0&&t<U){G.splice(t,1);ha++}U=G.length});Ra(K,d,{container:u,captureHover:g,scalable:g,pannable:g,
renderer:n});$("markers","draw",{zindex:20});u(a);if(T&&!Q(window.attachEvent,Ga))window.attachEvent("onresize",l);else T&&window.addEventListener("resize",l,false);Na.attach(function(o){var q=[],t,H,Z;if(!L){K.panSpeed=panSpeed=ya(M)+ya(J);(t=ca!==nb)&&K.trigger("scale");if(panSpeed>0||t||Ba||Wa||Ya){ha++;if(Ba&&panSpeed>0){Ba(true);Ba=null}}if(!C&&panSpeed<=0&&(ya(S-wb)>=ea||ya(V-xb)>=ea))O();ob.index++;ob.draw=ha||panSpeed||0;if(da&&ob.draw){if(Wa)ca=Wa()[0];if(Ya)sa=Ya()[0];xa+=M;Ha+=J;if(M||
J)K.trigger("pan");if(x){if(ca!==1)q[q.length]="scale("+ca+")";if(sa!==0)q[q.length]="rotate("+sa+"deg)"}t=R||!ka||!C&&!Ba&&(d.drawOnScale||ca===1)&&panSpeed<=2;if(Ba){H=Ba();xa=S-H[0]|0;Ha=V-H[1]|0}if(t){H=-sa*ia;t=db(H)*xa+-La(H)*Ha;H=La(H)*xa+db(H)*Ha;S=S-t/ca|0;V=V-H/ca|0;Z=Y();da.trigger("predraw",Z);if(da.prepare(G,Z,o,la)){H=Ha=t=xa=ha=0;for(ii=U;ii--;){var ga=G[ii];if(ga.visible){var za=ga.style?da.applyStyle(ga.style,true):null;ga.draw(da,Z,K,o,la);za&&da.applyStyle(za)}}da.trigger("render",
Z);K.trigger("drawComplete",Z,o);T.move(W,t,H,q,Va)}}else T.move(W,xa,Ha,q,Va);if(C||!d.inertia)J=M=0;else if(M!=0||J!=0){M*=0.8;J*=0.8;if(ya(M)<0.5)M=0;if(ya(J)<0.5)J=0}if(la){o=true;q=la?la.elements:[];if(Xa&&Xa.type==="hover"){diffElements=Hits.diffHits(Xa.elements,q);if(diffElements.length>0)Hits.triggerEvent(Xa,K,"Out",diffElements);else o=false}if(q.length>0){H=la.gridX;Z=la.gridY;for(t=q.length;C&&t--;){ga=q[t];za=H;var yb=Z,zb=ga&&ga.drag&&(!ga.canDrag||ga.canDrag(ga,za,yb));if(zb){I=ga;I.startX=
za;I.startY=yb}if(zb)break}o&&Hits.triggerEvent(la,K)}Xa=q.length>0?A({},la):null;la=null}if(nb!==ca){K.trigger("scaleChanged",ca);nb=ca}}}});return K},Aa=function(){return{tween:function(a,d,b,e,h){function k(p){var u=p-m;p=m+n<=p;for(var y=f;y--;)i[y]=l(u,a[y],j[y],n);h&&h.invalidate();if(p||g){Na.detach(k);for(y=0;y<c.length;y++)c[y]&&c[y](i,u,g)}}b=A({easing:"sine.out",duration:1E3,complete:null},b);var f=a.length,i=[].concat(a),c=[e,b.complete],l=Qa(b.easing),j=[],g=false,n=b.duration,m=(new Date).getTime();
for(b=f;b--;)j[b]=d[b]-a[b];Na.attach(k);return function(p){g=p;return i}},tweenDrawable:function(a,d,b,e,h){var k=Aa.tween([b],[e],h,function(){a[d]=e;for(var i=a.tweens.length;i--;)if(a.tweens[i]===f){a.tweens.splice(i,1);break}},a.view),f=function(){a[d]=k()[0]};return f}}}(),Ia=function(a,d,b){b=A({style:null,xy:null,size:20,fill:false,stroke:true,draggable:false,observable:true,properties:{},typeName:"Shape",zindex:0},b);A(this,b);if(Q(this.xy,Ca))this.xy=new a.XY(this.xy);this.id="drawable_"+
Fb++;this.bounds=null;this.view=a;this.layer=d;this.tweens=[];this.rotation=this.animations=0;this.scaling=1;this.translateY=this.translateX=0;this.observable&&pa(this)};Ia.prototype={constructor:Ia,applyTweens:function(){for(var a=this.tweens.length;a--;)this.tweens[a]()},drag:null,draw:null,getProps:null,resync:function(){if(this.xy){this.xy.sync(this.view);if(this.size){var a=this.size>>1;this.updateBounds(new ba(this.xy.x-a,this.xy.y-a,this.size,this.size))}}},rotate:function(a,d,b){if(Q(a,Da)){a=
(b?a:this.rotation*fa+a)*ia;if(d)this.tweens.push(Aa.tweenDrawable(this,"rotation",this.rotation,a,d));else{this.rotation=a;this.view.invalidate()}return this}else return this.rotation*fa},scale:function(a,d,b){if(Q(a,Da)){a=b?a:this.scaling*a;if(d)this.tweens.push(Aa.tweenDrawable(this,"scaling",this.scaling,a,d));else{this.scaling=a;this.view.invalidate()}return this}else return this.scaling},translate:function(a,d,b,e){if(Q(a,Da)){a=e?a:this.translateX+a;d=e?d:this.translateY+d;if(b){this.tweens.push(Aa.tweenDrawable(this,
"translateX",this.translateX,a,b));this.tweens.push(Aa.tweenDrawable(this,"translateY",this.translateY,d,b))}else{this.translateX=a;this.translateY=d;this.view.invalidate()}return this}else return new aa(this.translateX,this.translateY)},updateBounds:function(a,d){a&&(!this.bounds||a.x!=this.bounds.x||a.y!=this.bounds.y)&&this.trigger("move",this,a,this.bounds);this.bounds=a;if(d)this.xy=this.bounds.center()}};ra("drawable","marker",function(a,d,b){b=A({fill:true,stroke:false,markerType:"simple",
hoverStyle:"highlight",typeName:"Marker"},b);return new Ia(a,d,b)});ra("drawable","poly",function(a,d,b){function e(){var j,g,n,m,p,u,y;c=b.simplify?i.simplify():i;for(j=c.length;j--;){g=c[j].x;n=c[j].y;u=Q(u,Ga)||g<u?g:u;y=Q(y,Ga)||n<y?n:y;m=Q(m,Ga)||g>m?g:m;p=Q(p,Ga)||n>p?n:p}l.updateBounds(new ba(u,y,m-u,p-y),true);a.invalidate()}function h(j){if(Q(j,"array")){i=new ua(b.allowCull);tb.process(j,function(g,n){for(var m=0;m<n;m++)i.push(new a.XY(g[m]))},k,f);return l}else return c}function k(){i.length&&
tb.process(i,function(j,g){for(var n=g;n--;)j[n].sync(a)},e,f)}b=A({allowCull:false,simplify:false,fill:true,points:[],typeName:"Poly"},b);var f=500,i=new ua(b.allowCull),c=[],l=A(new Ia(a,d,b),{points:h,resync:k});h(b.points);return l});ra("drawable","line",function(a,d,b){b.fill=false;b.allowCull=true;return Ma("drawable","poly",a,d,b)});ra("drawable","image",function(a,d,b){function e(){if(c&&c.width>0){if(!this.centerOffset)this.centerOffset=new aa(-c.width>>1,-c.height>>1);this.updateBounds(new ba(this.xy.x+
this.centerOffset.x,this.xy.y+this.centerOffset.y,c.width,c.height),false)}}function h(j){if(this.imageUrl=j){var g=this;eb(this.imageUrl,function(n,m){c=n;if(m){var p=l.layer?l.layer.view:null;p&&p.invalidate()}e.apply(g)})}}b=A({image:null,imageUrl:null,centerOffset:null,typeName:"Image"},b);var k=Ia.prototype.resync,f=0,i=0,c=b.image,l=A(new Ia(a,d,b),{changeImage:h,getProps:function(){this.bounds||e(this,c);return{image:c,x:this.xy.x+f,y:this.xy.y+i}},resync:function(j){k.call(this,j);e.call(this)}});
c||h.call(this,this.imageUrl);if(this.centerOffset){f=this.centerOffset.x;i=this.centerOffset.y}});ra("drawable","arc",function(a,d,b){b=A({startAngle:0,endAngle:Math.PI*2,typeName:"Arc"},b);return new Ia(a,d,b)});Ja.prototype={constructor:Ja,clip:null,cycle:function(){},draw:function(){},hitGuess:null,remove:function(){this.view.trigger("layerRemove",this)}};ra("layer","tile",function(a,d){d=A({generator:"osm",imageLoadArgs:{}},d);var b=Ma("generator",d.generator,d).run,e=null,h=[],k=A(new Ja(a,
d),{draw:function(f,i,c){f.drawTiles&&f.drawTiles(i,e.search(i.buffer(128)),c.panSpeed<2)}});a.bind("resync",function(){var f=a&&a.zoom?a.zoom():0;h[f]||(h[f]=va(f));e=h[f]});a.bind("refresh",function(f,i,c){e&&b(i,c,e,function(){i.invalidate()})});return k});ra("layer","draw",function(a,d){function b(i,c,l,j){var g=this.dragOffset;if(!g)g=this.dragOffset=new a.XY(i.startX-this.xy.x,i.startY-this.xy.y);this.xy.x=c-g.x;this.xy.y=l-g.y;if(j){delete this.dragOffset;a.invalidate();this.xy.sync(a,true);
this.trigger("dragDrop")}return true}function e(i,c,l,j){j&&k.remove(j,c);k.insert(l,c)}d=A({zindex:10},d);var h=[],k,f=A(new Ja(a,d),{itemCount:0,clear:function(){k=new rb;h=[];f.trigger("cleared");f.itemCount=0;a.invalidate()},create:function(i,c,l){c=Ma("drawable",i,a,f,c);if(l)h.unshift(c);else h[h.length]=c;c.resync();k&&c.bounds&&k.insert(c.bounds,c);c.bind("move",e);f.itemCount=h.length;f.trigger(i+"Added",c);return c},draw:function(i,c,l,j,g){l={};j=k&&c?k.search(c):[];for(var n=j.length;n--;){var m=
j[n],p=m.style||f.style,u,y,N=m.getProps?m.getProps(i):l;u=i["prep"+m.typeName];m.tweens.length>0&&m.applyTweens();y=i.applyTransform(m);if(N=u?u.call(i,m,c,g,N):null){if(g&&N.hit){g.elements.push(Hits.initHit(m.type,m,m.draggable?b:null));u=g.type+"Style";p=m[u]||f[u]||p}p=p?i.applyStyle(p,true):null;(u=m.draw||N.draw)&&u.call(m,N);p&&i.applyStyle(p)}y&&y.undo&&y.undo()}},find:function(){return[].concat(h)},hitGuess:function(i,c){return k&&k.search({x:i-10,y:c-10,w:20,h:20}).length>0}});a.bind("resync",
function(){k=va(a.zoom(),k);for(var i=h.length;i--;)h[i].resync()});return f});ta.prototype={constructor:ta};ra("control","zoombar",function(a,d,b,e){function h(w,x){var L=$[w]=T.create("div","t5-zoombar-button",{position:"absolute",background:k(w),"z-index":51,width:e.width+"px",height:e.buttonHeight+"px","margin-top":(x||0)+"px"});O.appendChild(L)}function k(w,x){return"url("+e.images+") 0 -"+(g+m*3+(w||0)*l*3+(x||0)*l)+"px"}function f(w){return"url("+e.images+") 0 -"+(g+(w||0)*m)+"px"}function i(w,
x){var L;if(w===n){n.style.background=f(x);L="thumb"}else for(var F=0;F<$.length;F++)if(w===$[F]){L="button"+F;$[F].style.background=k(F,x);break}return L}function c(w){if(w!==N){N=w;y=u-N/Y*(u-p)|0;T.move(n,0,y-p);clearTimeout(s);s=setTimeout(function(){a.zoom(N)},500)}}e=A({width:24,height:200,images:"img/zoom.png",align:"right",marginTop:10,spacing:10,thumbHeight:16,buttonHeight:16},e);var l=e.buttonHeight,j,g=e.height,n,m=e.thumbHeight,p=e.spacing+l-(m>>1),u=e.height-l-(m>>1),y=p,N=-1;d=a.minZoom();
var Y=a.maxZoom()-d+1,$=[],O,s=0,E={button0:function(){a.zoom(a.zoom()+1)},button1:function(){a.zoom(a.zoom()-1)}};O=T.create("div","t5-zoombar",{position:"absolute",background:"url("+e.images+")","z-index":50,overflow:"hidden",width:e.width+"px",height:e.height+"px",margin:function(){var w=e.spacing,x=qa("{0}px 0 0 {1}px");if(e.align==="right")w=b.offsetWidth-e.width-e.spacing;return x(e.marginTop,w)}()});b.childNodes[0]?b.insertBefore(O,b.childNodes[0]):b.appendChild(O);O.appendChild(n=T.create("div",
"t5-zoombar-thumb",{position:"absolute",background:f(),"z-index":51,width:e.width+"px",height:e.thumbHeight+"px",margin:"10px 0 0 0",top:y-p+"px"}));h(0);h(1,e.height-e.buttonHeight);j=INTERACT.watch(O,{bindTarget:O});j.bind("pointerMove",function(w,x,L){y=Math.min(Math.max(p,L.y-(m>>1)),u);c(Y-(y-p)/u*Y|0)});j.bind("pointerDown",function(w){i(w.target,2)});j.bind("pointerUp",function(w){i(w.target,0)});j.bind("tap",function(w){(w=E[i(w.target,2)])&&w()});d=new ta(a);d.bind("detach",function(){j.unbind();
b.removeChild(O)});a.bind("zoom",function(w,x){c(x)});c(a.zoom());return d});A(wa,{ex:A,log:ja,observable:pa,configurable:Ra,formatter:qa,wordExists:function(a,d){for(var b=a.split(/\s|\,/).length;b--;)if(a.toLowerCase()==d.toLowerCase())return true;return false},is:Q,indexOf:Sa,fn:function(a){return Eb("fn",a)},project:ab,unproject:kb,getImage:eb,userMessage:function(a,d,b){wa.trigger("userMessage",a,d,b)},Registry:r,Style:ub,DOM:T,Rect:ba,XY:aa,Line:ua,Hits:Hits,Control:ta,Tile:Ea,Tweener:Aa,View:Ab,
Map:function(a,d){function b(l,j){var g=c.viewport();if(l){g=cb(l.bestZoomLevel(g.w,g.h),j||0);return e(g).center(l.center())}else return new GeoJS.BBox((new oa(g.x,g.y2)).sync(c,true).pos(),(new oa(g.x2,g.y)).sync(c,true).pos())}function e(l,j,g){if(Q(l,Da)){l=cb(d.minZoom,sb(d.maxZoom,l|0));if(l!==f){var n=c.viewport(),m=c.offset(),p=n.w/2;n=n.h/2;var u=Fa(2,l-f),y=p/u|0,N=n/u|0;f=l;c.offset(((j||m.x+p)-y)*u,((g||m.y+n)-N)*u);c.trigger("zoom",l);c.trigger("reset");k=c.rpp=z/(256<<f);c.setMaxOffset(z/
k|0,z/k|0,true,false);c.scale(1,false,true);c.trigger("resync");c.refresh()}return c}else return f}d=A({controls:["zoombar"],minZoom:1,maxZoom:18,renderer:"canvas/dom",zoom:1,zoombar:{}},d);var h=new oa,k,f=d.zoom||d.zoomLevel,i=0,c=A(new Ab(a,d),{XY:oa,bounds:b,zoom:e});k=c.rpp=z/(256<<f);c.bind("refresh",function(){var l=c.viewport();if(h.x!=l.x||h.y!=l.y){c.trigger("boundsChange",b());h.x=l.x;h.y=l.y}});c.bind("scaleChanged",function(l,j){var g=jb(j)/Math.LN2|0;if(g!==0){j=Fa(2,g);clearTimeout(i);
i=setTimeout(function(){e(f+g)},500)}});return c}});if(typeof module!="undefined"&&module.exports)module.exports=wa})();
