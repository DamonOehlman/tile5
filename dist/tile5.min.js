COG=function(){var g=/\$\{(.*?)\}/ig,m=Object.prototype.hasOwnProperty,h=0,d={id:"grunt.core",extend:function(){var b=arguments[0]||{},f=1,e=arguments.length,a=false,l,k,p,o;if(typeof b==="boolean"){a=b;b=arguments[1]||{};f=2}if(typeof b!=="object"&&!d.isFunction(b))b={};if(e===f){b=this;--f}for(;f<e;f++)if((l=arguments[f])!=null)for(k in l){p=b[k];o=l[k];if(b!==o)if(a&&o&&(d.isPlainObject(o)||d.isArray(o))){p=p&&(d.isPlainObject(p)||d.isArray(p))?p:d.isArray(o)?[]:{};b[k]=d.extend(a,p,o)}else if(o!==
undefined)b[k]=o}return b},isFunction:function(b){return toString.call(b)==="[object Function]"},isArray:function(b){return toString.call(b)==="[object Array]"},isPlainObject:function(b){if(!b||toString.call(b)!=="[object Object]"||b.nodeType||b.setInterval)return false;if(b.constructor&&!m.call(b,"constructor")&&!m.call(b.constructor.prototype,"isPrototypeOf"))return false;var f;for(f in b);return f===undefined||m.call(b,f)},isEmptyObject:function(b){for(var f in b)return false;return true},isXmlDocument:function(b){return toString.call(b)===
"[object Document]"},contains:function(b,f){var e=b,a=arguments,l=1;if(f&&d.isArray(f)){a=f;l=0}for(l=l;l<a;l++)e=e&&typeof foo[a[l]]!=="undefined";return e},newModule:function(b){b=d.extend({id:null,requires:[],parent:null},b);if(b.parent)b=d.extend({},b.parent,b);return b},toID:function(b){return b.replace(/\s/g,"-")},objId:function(b){return(b?b:"obj")+h++},formatStr:function(b){if(arguments.length<=1)return b;for(var f=arguments.length-2,e=0;e<=f;e++)b=b.replace(RegExp("\\{"+e+"\\}","gi"),arguments[e+
1]);return b},wordExists:function(b,f){var e="";if(f.toString)f=f.toString();for(var a=0;a<f.length;a++)e+=!/\w/.test(f[a])?"\\"+f[a]:f[a];return RegExp("(^|\\s|\\,)"+e+"(\\,|\\s|$)","i").test(b)},parseTemplate:function(b,f){for(var e=g.exec(b);e;){b=b.replace(e[0],COG.XPath.first(e[1],f));g.lastIndex=0;e=g.exec(b)}return b}};return d}();
COG.Log=function(){function g(f,e){var a,l=e&&e.length>0?e[0]:"";for(a=1;e&&a<e.length;a++)l+=" "+(h&&COG.isPlainObject(e[a])?JSON.stringify(e[a]):e[a]);typeof console!=="undefined"&&console[f](l);for(a=0;a<m.length;a++)m[a].call(b,l,f)}var m=[],h=typeof JSON!=="undefined",d=window.console&&window.console.markTimeline,b={id:"grunt.log",getTraceTicks:function(){return d?(new Date).getTime():null},trace:function(f,e){if(d)console.markTimeline(f+(e?": "+(b.getTraceTicks()-e)+"ms":""))},debug:function(){g("debug",
arguments)},info:function(){g("info",arguments)},warn:function(){g("warn",arguments)},error:function(){g("error",arguments)},exception:function(f){b.error(arguments);for(var e in f)b.info("ERROR DETAIL: "+e+": "+f[e])},watch:function(f,e){try{e()}catch(a){b.exception(a,f)}},throwError:function(f){b.error(f);throw Error(f);},requestUpdates:function(f){m.push(f)}};return b}();
(function(){function g(d,b){d[b]||(d[b]=function(f){return d.configure(b,f)})}function m(d){d.gtConfId=COG.objId("configurable");d.gtConfig={};d.gtConfigFns=[];return d.gtConfig}var h={};COG.paramTweaker=function(d,b,f){return function(e,a){if(typeof a!=="undefined"){if(e in d)d[e]=a;f&&e in f&&f[e](e,a)}else return b&&e in b?b[e](e):d[e]}};COG.configurable=function(d,b,f,e){if(d){d.gtConfId||m(d);var a=d.gtConfId,l=d.gtConfig,k=d.gtConfigFns;h[a]=d;k.push(f);for(f=b.length;f--;){l[b[f]]=true;e&&
g(d,b[f])}if(!d.configure)d.configure=function(p,o){if(l[p]){for(var n=k.length;n--;){var t=k[n](p,o);if(typeof t!=="undefined")return t}return h[a]}return null}}}})();
(function(){function g(m,h){var d=m.gtObsHandlers;d[h]||(d[h]=[]);return d[h]}COG.observable=function(m){if(m){if(!m.gtObsHandlers)m.gtObsHandlers={};if(!(m.bind||m.trigger||m.unbind)){m.bind=function(h,d){var b=COG.objId("callback");g(m,h).unshift({fn:d,id:b});return b};m.trigger=function(h){var d=g(m,h),b={cancel:false,tickCount:(new Date).getTime()},f;if(!d)return null;f=Array.prototype.slice.call(arguments,1);f.unshift(b);for(var e=d.length;e--&&!b.cancel;)d[e].fn.apply(self,f);return b};m.unbind=
function(h,d){for(var b=g(m,h),f=0;b&&f<b.length;f++)if(b[f].id===d){b.splice(f,1);break}return m}}}}})();(function(){var g={},m=[];COG.addPipe=function(h){h("pipe.test",{});m.push(h)};COG.listen=function(h,d){g[h]||(g[h]=[]);d&&g[h].push(d)};COG.say=function(h,d){var b;for(b=m.length;b--;)m[b](h,d);if(g[h])for(b=g[h].length;b--;)g[h][b](d)}})();
COG.Loopage=function(){function g(o){return COG.extend({id:f++,frequency:0,after:0,single:false,lastTick:0,execute:function(){}},o)}function m(o){a.push(o);h()}function h(){l&&clearTimeout(l);l=setTimeout(d,0);p=true}function d(){for(var o,n=(new Date).getTime(),t=e.length;a.length>0;){var z=a.shift();for(o=t;o--;)if(e[o].id===z){e.splice(o,1);break}p=true;t=e.length}if(p){k=b;for(o=t;o--;)k=e[o].frequency<k?e[o].frequency:k}for(o=t;o--;){z=n-e[o].lastTick;if(e[o].lastTick===0||z>=e[o].frequency){e[o].execute(n,
e[o]);e[o].lastTick=n;e[o].single&&e[o].trigger("complete")}}l=t?setTimeout(d,k):0}var b=6E4,f=0,e=[],a=[],l=0,k=b,p=true;return{join:function(o){var n=new g(o);if(n.after>0)n.lastTick=(new Date).getTime()+n.after;COG.observable(n);n.bind("complete",function(){m(n.id)});e.unshift(n);h();return n},leave:m}}();if(!this.JSON)this.JSON={};
(function(){function g(k){return k<10?"0"+k:k}function m(k){b.lastIndex=0;return b.test(k)?'"'+k.replace(b,function(p){var o=a[p];return typeof o==="string"?o:"\\u"+("0000"+p.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+k+'"'}function h(k,p){var o,n,t,z,B=f,u,v=p[k];if(v&&typeof v==="object"&&typeof v.toJSON==="function")v=v.toJSON(k);if(typeof l==="function")v=l.call(p,k,v);switch(typeof v){case "string":return m(v);case "number":return isFinite(v)?String(v):"null";case "boolean":case "null":return String(v);
case "object":if(!v)return"null";f+=e;u=[];if(Object.prototype.toString.apply(v)==="[object Array]"){z=v.length;for(o=0;o<z;o+=1)u[o]=h(o,v)||"null";t=u.length===0?"[]":f?"[\n"+f+u.join(",\n"+f)+"\n"+B+"]":"["+u.join(",")+"]";f=B;return t}if(l&&typeof l==="object"){z=l.length;for(o=0;o<z;o+=1){n=l[o];if(typeof n==="string")if(t=h(n,v))u.push(m(n)+(f?": ":":")+t)}}else for(n in v)if(Object.hasOwnProperty.call(v,n))if(t=h(n,v))u.push(m(n)+(f?": ":":")+t);t=u.length===0?"{}":f?"{\n"+f+u.join(",\n"+f)+
"\n"+B+"}":"{"+u.join(",")+"}";f=B;return t}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+g(this.getUTCMonth()+1)+"-"+g(this.getUTCDate())+"T"+g(this.getUTCHours())+":"+g(this.getUTCMinutes())+":"+g(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
b=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f,e,a={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},l;if(typeof JSON.stringify!=="function")JSON.stringify=function(k,p,o){var n;e=f="";if(typeof o==="number")for(n=0;n<o;n+=1)e+=" ";else if(typeof o==="string")e=o;if((l=p)&&typeof p!=="function"&&(typeof p!=="object"||typeof p.length!=="number"))throw Error("JSON.stringify");return h("",
{"":k})};if(typeof JSON.parse!=="function")JSON.parse=function(k,p){function o(t,z){var B,u,v=t[z];if(v&&typeof v==="object")for(B in v)if(Object.hasOwnProperty.call(v,B)){u=o(v,B);if(u!==undefined)v[B]=u;else delete v[B]}return p.call(t,z,v)}var n;k=String(k);d.lastIndex=0;if(d.test(k))k=k.replace(d,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(k.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){n=eval("("+k+")");return typeof p==="function"?o({"":n},""):n}throw new SyntaxError("JSON.parse");}})();
(function(){function g(h,d){var b=h.split("|"),f={};for(var e in d){var a=d[e];f[e]=b.length>a?b[a]:null}return f}var m={JSON:{parse:function(h){return JSON.parse(h)}},PDON:{parse:function(h){var d=null,b=[];h=h.split("\n");for(var f=0;f<h.length;f++){var e=h[f];if(d)b.push(g(e,d));else if(e){d=e.split("|");e={};for(var a=0;a<d.length;a++)e[d[a]]=a;d=e}else d=null}return b}}};COG.parseData=function(h,d){d=d?d.toUpperCase():"JSON";if(!m[d])throw Error("Unsupported data format: "+d);try{return m[d].parse(h)}catch(b){COG.Log.exception(b)}return{}}})();
COG.XPath=function(){function g(b){for(var f=null,e=0;e<m.length;e++)if(f=m[e](b))break;return f}var m=[],h=[null,function(b){return b.numberValue},function(b){return b.stringValue},function(b){return b.booleanValue},null,null,null,null,function(b){return b.singleNodeValue?b.singleNodeValue.textContent:null},function(b){return b.singleNodeValue?b.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||COG.Log.warn("No XPATH support");var d={SearchResult:function(b){return{toString:function(){var f=
null;if(b){var e=null;if(b.resultType>=0&&b.resultType<h.length)e=h[b.resultType];if(e)f=e(b)}return f?f:""}}},first:function(b,f){var e=d.SearchResult,a;var l=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!l)l=XPathResult.ANY_TYPE;try{if(COG.isXmlDocument(f))a=f.evaluate(b,f,g,l,null);else{COG.Log.warn("attempted xpath expression: "+b+" on a non-xml document");a=null}}catch(k){COG.Log.warn("invalid xpath expression: "+b+" on node: "+f);a=null}return new e(a)},registerResolver:function(b){m.push(b)}};return d}();
COG.Storage=function(){function g(m){if(m&&m=="session")return sessionStorage;return localStorage}return{get:function(m,h){var d=g(h).getItem(m);return/^(\{|\[).*(\}|\])$/.test(d)?JSON.parse(d):d},set:function(m,h,d){h=jQuery.isArray(h)||jQuery.isPlainObject(h)?JSON.stringify(h):h;g(d).setItem(m,h)},remove:function(m,h){g(h).removeItem(m)}}}();
COG.ParseRules=function(){var g=[];return{add:function(m,h){g.push({regex:m,handler:h})},each:function(m,h,d){function b(){f++;d&&f>=g.length&&d(h)}for(var f=0,e=0;e<g.length;e++){var a=g[e].regex,l=g[e].handler,k=false;if(a){a.lastIndex=-1;if((a=a.exec(m))&&l){k=true;l(a,h,b)&&b()}}k||b()}}}};
(function(){function g(a){var l=[],k=function(o,n){n=COG.isFunction(n)?n():n;l[l.length]=encodeURIComponent(o)+"="+encodeURIComponent(n)};if(COG.isArray(a))for(var p=0;p<a.length;p++)k(a[p].name,a[p].value);else for(p in a)k(p,a[p]);return l.join("&").replace(/%20/g,"+")}var m={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},h={JSON:["json"],PDON:["pdon.txt"]},d=["TEXT","STREAM"],b=/^(\w+:)?\/\/([^\/?#]+)/,f={XML:function(a){return a.responseXML},JSON:function(a){return COG.parseData(a.responseText)},
PDON:function(a){return COG.parseData(a.responseText,"PDON")},DEFAULT:function(a){return a.responseText}},e={CONTENT_TYPE:"Content-Type"};COG.xhr=function(a){function l(){if(this.readyState===4){var n=null,t=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(t)if(a.handleResponse)a.handleResponse(this);else{var z=a,B=this.getResponseHeader(e.CONTENT_TYPE),u,v=false;for(u in m)if(B&&B.indexOf(m[u])>=0){v=true;
break}B=!v;for(v=0;v<d.length;v++)B=B||d[v]==u;if(B)b:{B=u;for(var C in h)for(v=0;v<h[C].length;v++)if(RegExp(h[C][v]+"$","i").test(z.url)){u=C;break b}u=B?B:"DEFAULT"}try{n=f[u](this,z)}catch(x){n=f.DEFAULT(this,z)}}else a.error&&a.error(this)}catch(X){COG.Log.exception(X,"PROCESSING AJAX RESPONSE")}t&&n&&a.success&&a.success.call(this,n)}}try{a=COG.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},a);var k=
b.exec(a.url),p=k&&(k[1]&&k[1]!==location.protocol||k[2]!==location.host);if(a.data)a.method="POST";if(a.url){k=null;if(a.xhr)k=a.xhr(a);k||(k=new XMLHttpRequest);k.open(a.method,a.url,a.async);a.data&&k.setRequestHeader("Content-Type",a.contentType);p||k.setRequestHeader("X-Requested-With","XMLHttpRequest");k.onreadystatechange=l;k.send(a.method=="POST"?g(a.data):null)}else COG.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(o){COG.Log.exception(o)}}})();
(function(){function g(b){var f=document.createElement("script"),e=false;f.src=b;f.async=true;f.onload=f.onreadystatechange=function(){if(!e&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){e=true;f.onload=f.onreadystatechange=null;f&&f.parentNode&&f.parentNode.removeChild(f)}};h||(h=document.getElementsByTagName("head")[0]);h.appendChild(f)}var m=0,h,d=this;COG.jsonp=function(b,f,e){b+=b.indexOf("?")>=0?"&":"?";var a="json"+ ++m;d[a]=function(l){f(l);d[a]=null;try{delete d[a]}catch(k){}};
g(b+(e?e:"callback")+"="+a);return a}})();
COG.Touch=function(){function g(s,q){return{x:s.x-q.x,y:s.y-q.y}}function m(s,q){var r=g(s,q);return Math.sqrt(r.x*r.x+r.y*r.y)}function h(s){if(s.count>1)return m(s.touches[0],s.touches[1]);return 0}function d(s,q){var r=s&&s.count>0?s.touches[0]:null;if(r&&q&&q.count>0)return g(r,q.touches[0]);return null}function b(s,q){s.count=q.count;for(var r=k;r--;){s.touches[r].x=q.touches[r].x;s.touches[r].y=q.touches[r].y}}function f(){for(var s={count:0,touches:Array(k)},q=k;q--;)s.touches[q]=l();return s}
function e(s){if(s.preventDefault){s.preventDefault();s.stopPropagation()}else s.cancelBubble&&s.cancelBubble()}function a(s,q,r){if(L){q=q[r?r:"touches"];r=q.length;for(r=s.count=r;r--;){s.touches[r].x=q[r].pageX;s.touches[r].y=q[r].pageY}}else if(q.button===0){s.count=1;s.touches[0].x=q.pageX?q.pageX:q.screenX;s.touches[0].y=q.pageY?q.pageY:q.screenY}else s.count=0}function l(s,q){return{x:s?s:0,y:q?q:0}}var k=10,p=120,o=100,n=250,t=300,z=5,B=0,u=1,v=2,C=7,x=0,X=0,L=undefined,ca=function(s){function q(E,
J,H,y){var D=Math.asin((E.y-J.y)/H);H=H*(ta/y)>>0;H=H>qa?qa:H;D=J.x>E.x?D:Math.PI-D;G("pan",Math.cos(D)*-H,Math.sin(D)*H,true)}function r(E,J){var H,y;if(L){H=J-la;if(H<n){y=m(T.touches[0],E);y>s.inertiaTrigger&&q(T.touches[0],E,y,H)}}else{da.x=E.x;da.y=E.y;COG.Loopage.join({execute:function(D,K){H=D-J;y=m(E,da);if(H<o&&y>s.inertiaTrigger){K.trigger("complete");q(E,da,y,H)}else H>o&&K.trigger("complete")},frequency:10})}}function w(E){var J=0,H=0;if(E.offsetParent){do{J+=E.offsetLeft;H+=E.offsetTop;
E=E.offsetParent}while(E)}return l(J,H)}function F(E){var J=E.count,H=Array(J),y=w(ea);for(J=J;J--;)H[J]=l(E.touches[J].x-y.x,E.touches[J].y-y.y);return H}function G(){ra&&ra.trigger.apply(null,arguments)}function I(E,J){var H=w(ea);H=l(J.x-H.x,J.y-H.y);G(E,J,H)}function A(E){var J=E.target?E.target:E.srcElement;if(fa||J&&J===ea){a(T,E);if(T.count!==0){aa=null;ha.x=0;ha.y=0;ma=true;Q=false;la=(new Date).getTime();e(E);J.style.cursor="move";G("inertiaCancel");na=la;if(E=T.count>0?T.touches[0]:null){G("touchStart",
E.x,E.y);if(na-oa<t)if((E=g(T.touches[0],Z.touches[0]))&&Math.abs(E.x)<s.maxDistDoubleTap&&Math.abs(E.y)<s.maxDistDoubleTap)Q=true;O=B;b(Z,T)}else COG.Log.warn("Touch start fired, but no touch vector found")}}}function M(E){var J=E.target?E.target:E.srcElement,H=0;if(fa||J&&J===ea){a(R,E);if(R.count>0){da.x=R.touches[0].x;da.y=R.touches[0].y}if(ma){L&&e(E);if(R.count>1){T.count===1&&b(T,R);H=h(T)-h(R)}if(O===B)if((E=d(R,T))&&(Math.abs(E.x)>=C||Math.abs(E.y)>=C))O=u;if(O!==B)if(!H||Math.abs(H)<z){if(aa=
d(R,Z)){ha.x-=aa.x;ha.y-=aa.y;ba.x-=aa.x;ba.y-=aa.y}G("pan",ba.x,ba.y);ba.x=0;ba.y=0;O=u}else{G("pinchZoom",F(T),F(R));O=v}b(Z,R)}}}function N(E){var J=E.target?E.target:E.srcElement;if(ma&&(fa||J&&J===ea)){a($,E,"changedTouches");var H=$.touches[0];L&&e(E);E=(new Date).getTime();oa=na;if(O===B){I("tap",T.touches[0]);Y||(Y=setTimeout(function(){Y=0;Q&&I("doubleTap",T.touches[0])},t+50))}else if(O==u){G("panEnd",ha.x,ha.y);sa&&r(H,E)}else O==v&&G("pinchZoomEnd",F(T),F(Z),E-la);J.style.cursor="default";
ma=false}}function P(E){var J=E.target?E.target:E.srcElement;if(fa||J&&J===ea){if(E.detail){J=-E.detail*p;J=l(E.axis===1?J:0,E.axis===2?J:0)}else J=l(E.wheelDeltaX,E.wheelDeltaY);var H=J.y!==0?Math.abs(J.y/p):0;if(da&&H!==0){var y=l(da.x-ea.offsetLeft,da.y-ea.offsetTop);G("wheelZoom",y,Math.pow(2,J.y>0?H:-H))}e(E)}}s=COG.extend({element:null,observable:null,inertiaTrigger:20,maxDistDoubleTap:20,touchStartHandler:null,moveHandler:null,moveEndHandler:null,pinchZoomHandler:null,pinchZoomEndHandler:null,
tapHandler:null,doubleTapHandler:null,wheelZoomHandler:null},s);var Q=false,Y=0,V=T5.getConfig(),T=f(),R=f(),Z=f(),$=f(),aa=null,ha=l(),ba=l(),O=null,ma=false,la=0,ja=[],da=l(),sa=false,ta,qa,na=0,oa=0,ea=s.element,ra=s.observable,fa=typeof FlashCanvas!=="undefined",ua={supportsTouch:L,addListeners:function(E){ja.push(E)},decoupleListeners:function(E){for(var J=0;E&&J<ja.length;J++)if(ja[J].listenerId===E){ja.splice(J,1);break}},release:function(){V.unbindEvent(L?"touchstart":"mousedown",A,false);
V.unbindEvent(L?"touchmove":"mousemove",M,false);V.unbindEvent(L?"touchend":"mouseup",N,false);if(!L){window.removeEventListener("mousewheel",P,false);window.removeEventListener("DOMMouseScroll",P,false)}},inertiaEnable:function(E,J){sa=true;ta=E;qa=J?Math.min(J.width,J.height):500},inertiaDisable:function(){sa=false}};if(typeof L==="undefined")L=T5.getConfig().supportsTouch;V.bindEvent(L?"touchstart":"mousedown",A,false);V.bindEvent(L?"touchmove":"mousemove",M,false);V.bindEvent(L?"touchend":"mouseup",
N,false);if(!L){V.bindEvent("mousewheel",P,window);V.bindEvent("DOMMouseScroll",P,window)}return ua},U=[];return{capture:function(s,q){if(!s)throw Error("Unable to capture touch of null element");if(!s.id)s.id="touchable_"+x++;var r=U[s.id];if(!r){r=new ca(COG.extend({element:s},q));U[s.id]=r}if(q){q.listenerId&&r.decoupleListeners(q.listenerId);q.listenerId=++X;r.addListeners(q)}return r},release:function(s){if(s&&s.id&&U[s.id]){U[s.id].release();delete U[s.id]}}}}();
T5=function(){var g=function(e,a){return{x:e?e:0,y:a?a:0}},m=function(){function e(a,l){if(!l)l=a.length;if(l<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var k={edges:Array(l-1),accrued:Array(l-1),total:0},p=m.diff,o=0;o<l-1;o++){var n=p(a[o],a[o+1]);k.edges[o]=Math.sqrt(n.x*n.x+n.y*n.y);k.accrued[o]=k.total+k.edges[o];k.total+=k.edges[o]}return k}return{VECTOR_SIMPLIFICATION:4,create:function(a,l){return new g(a,l)},add:function(){for(var a=new g,l=
arguments.length;l--;){a.x+=arguments[l].x;a.y+=arguments[l].y}return a},absSize:function(a){return Math.max(Math.abs(a.x),Math.abs(a.y))},diff:function(a,l){return new g(a.x-l.x,a.y-l.y)},copy:function(a){return a?new g(a.x,a.y):null},invert:function(a){return new g(-a.x,-a.y)},offset:function(a,l,k){return new g(a.x+l,a.y+(k?k:l))},edges:e,distance:function(a,l){return e(a,l).total},simplify:function(a,l){if(!a)return null;l=l?l:m.VECTOR_SIMPLIFICATION;for(var k=[],p=null,o=a.length;o--;){var n=
a[o];if(include=!p||o===0||Math.abs(n.x-p.x)+Math.abs(n.y-p.y)>l){k.unshift(n);p=n}}return k},theta:function(a,l,k){k=Math.asin((a.y-l.y)/k);return a.x>l.x?k:Math.PI-k},pointOnEdge:function(a,l,k,p){l=new g(Math.cos(k)*p,Math.sin(k)*p);return new g(a.x-l.x,a.y-l.y)},getRect:function(a){var l=a.length;if(l>1)return new h(Math.min(a[0].x,a[l-1].x),Math.min(a[0].y,a[l-1].y),Math.abs(a[0].x-a[l-1].x),Math.abs(a[0].y-a[l-1].y))},toString:function(a){return a.x+", "+a.y}}}(),h=function(e,a,l,k){return{origin:new g(e,
a),dimensions:new b(l,k),invalid:false}},d=function(){return{bottomRight:function(e){return m.offset(e.origin,e.dimensions.width,e.dimensions.height)},empty:function(){return new h(0,0,0,0)},copy:function(e){return e?new h(e.origin.x,e.origin.y,e.dimensions.width,e.dimensions.height):null},getCenter:function(e){return new g(e.origin.x+e.dimensions.width/2,e.origin.y+e.dimensions.height/2)},isEmpty:function(e){return e.dimensions.width===0||e.dimensions.height===0},union:function(){if(!(arguments.length<
2)){for(var e=arguments[0].origin.y,a=arguments[0].origin.x,l=e+arguments[0].dimensions.height,k=a+arguments[0].dimensions.width,p=Array.prototype.slice.call(arguments,1),o=p.length;o--;){var n=p[o].origin.y,t=p[o].origin.x,z=n+p[o].dimensions.height,B=t+p[o].dimensions.width;e=e<n?e:n;a=a<t?a:t;l=l>z?l:z;k=k>B?k:B}arguments[0].origin.x=a;arguments[0].origin.y=e;arguments[0].dimensions.width=k-a;arguments[0].dimensions.height=l-e}}}}(),b=function(e,a){return{width:e?e:0,height:a?a:0}},f=function(){return{getAspectRatio:function(e){return e.height!==
0?e.width/e.height:1},getCenter:function(e){return new g(e.width/2,e.height/2)},getSize:function(e){return Math.sqrt(Math.pow(e.width,2)+Math.pow(e.height,2))}}}();return{ex:COG.extend,ticks:function(){return(new Date).getTime()},Vector:g,V:m,Dimensions:b,D:f,Rect:h,R:d}}();
(function(){function g(){for(;z.length>0;){var u=z.shift();document.location=u}t=0}function m(u){for(var v=true,C=B.length;C--;)v=v&&u!=B[C];return v}function h(u,v){var C=[];for(var x in v)x&&C.push(x+"="+escape(v[x]));return"tile5://"+u+"/"+(C.length>0?"?"+C.join("&"):"")}function d(u,v){m(u)&&COG.Log.info("would push url: "+h(u,v))}function b(u,v){if(m(u)){z.push(h(u,v));t||(t=setTimeout(g,100))}}function f(u){return function(v,C,x){(x?x:u?document.body:document).addEventListener(v,C,false)}}function e(u){return function(v,
C,x){(x?x:u?document.body:document).removeEventListener(v,C,false)}}function a(u,v,C){(C?C:document).attachEvent("on"+u,v)}function l(u,v,C){(C?C:document).detachEvent("on"+u,v)}function k(){p={base:{name:"Unknown",bindEvent:f(),unbindEvent:e(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:d,targetFps:null},ie:{name:"MSIE",regex:/msie/i,bindEvent:a,unbindEvent:l,requireFastDraw:false,targetFps:25},
ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:b,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:b},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:b},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:f(true),unbindEvent:e(true),supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},bridgeNotify:b},froyo:{name:"Android OS >= 2.2",
regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:b}};o=[p.froyo,p.android,p.ipod,p.iphone,p.ipad,p.ie]}var p=null,o=[],n=null,t=0,z=[],B=["view.wake","tile.loaded"];T5.getConfig=function(){p||k();if(!n){COG.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var u=0;u<o.length;u++){var v=o[u];if(v.regex&&v.regex.test(navigator.userAgent)){n=T5.ex({},p.base,v);COG.Log.info("PLATFORM DETECTED AS: "+n.name);break}}if(!n){COG.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
n=p.base}COG.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return n}})();
T5.Dispatcher=function(){var g=[],m={execute:function(h){var d=m.findAction(h);d&&d.execute.apply(d,Array.prototype.slice.call(arguments,1))},findAction:function(h){for(var d=g.length;d--;)if(g[d].id==h)return g[d];return null},getRegisteredActions:function(){return[].concat(g)},getRegisteredActionIds:function(){for(var h=[],d=g.length;d--;)g[d].id&&h.push(g[d].id);return h},registerAction:function(h){h&&h.id&&g.push(h)},Action:function(h){h=T5.ex({autoRegister:true,id:"",title:"",icon:"",hidden:false,
execute:null},h);var d={id:h.id,execute:function(){h.execute&&h.execute.apply(this,arguments)},getParam:function(b){return h[b]?h[b]:""},toString:function(){return COG.formatStr("{0} [title = {1}, icon = {2}]",d.id,h.title,h.icon)}};h.autoRegister&&m.registerAction(d);return d},Agent:function(h){h=COG.extend({name:"Untitled",translator:null,execute:null},h);var d={getName:function(){return h.name},getParam:function(b){return h[b]},getId:function(){return COG.toID(d.getName())},run:function(b,f){if(h.execute){var e=
h.translator?h.translator(b):b;h.execute.call(d,e,function(a,l){f&&f(a,l,e)})}}};return d},runAgents:function(h,d,b){for(var f=0;f<h.length;f++)h[f].run(d,b)}};return m}();
T5.Resources=function(){var g="",m={},h={getPath:function(d){return/^(file|https?|\/)/.test(d)?d:g+d},setBasePath:function(d){g=d},loadResource:function(d){d=T5.ex({filename:"",cacheable:true,dataType:null,callback:null},d);var b=function(f){d.callback&&COG.Log.watch("CALLING RESOURCE CALLBACK",function(){d.callback(f)})};d.cacheable&&m[d.filename]?b(m[d.filename]):COG.xhr({url:h.getPath(d.filename),dataType:d.dataType,success:function(f){if(d.cacheable)m[d.filename]=f;b(f)},error:function(f,e,a){COG.Log.error("error loading resource ["+
d.filename+"], error = "+a)}})},loadSnippet:function(d,b){/\.\w+$/.test(d)||(d+=".html");h.loadResource({filename:"snippets/"+d,callback:b,dataType:"html"})}};return h}();
T5.Images=function(){function g(){if(!t){var u=T5.getConfig().maxImageLoads;t=COG.Loopage.join({execute:function(v,C){if(!u||p.length<u){var x=k.shift();if(x){p[p.length]=x;x.image.onload=h;x.image.src=T5.Resources.getPath(x.url);x.requested=T5.ticks()}else C.trigger("complete")}},frequency:10});t.bind("complete",function(){t=null})}}function m(){z=true;try{var u=o.length/2>>0;if(u>0){o.sort(function(C,x){return C.created-x.created});for(var v=u;v--;)delete f[o[v].url];o.splice(0,u)}}finally{z=false}COG.say("imagecache.cleared")}
function h(){var u=a[this.id];if(u&&u.image.complete&&u.image.width>0){u.loaded=true;u.hitCount=1;for(var v=p.length;v--;)if(p[v].image.src==this.src){p.splice(v,1);break}if(u.background||u.postProcess||u.drawBackground||u.customDraw)if(u.image){v=b(u.realSize?u.realSize.width:image.width,u.realSize?u.realSize.height:image.height);var C=v.getContext("2d"),x=u.offset?u.offset:new T5.Vector;u.background&&C.drawImage(u.background,0,0);u.drawBackground&&u.drawBackground(C);u.customDraw?u.customDraw(C,
u):C.drawImage(u.image,x.x,x.y);u.postProcess&&u.postProcess(C,u);u.image=v}u.loadCallback&&u.loadCallback(this,false);o[o.length]={url:this.src,created:u.requested};delete a[this.id];g()}}function d(u,v,C){var x=f[u];if(x){x.hitCount++;x.image.complete&&v&&v(x.image,true)}else{x=T5.ex({url:u,image:new Image,loaded:false,created:T5.ticks(),requested:null,hitCount:0,loadCallback:v},C);x.image.id="resourceLoaderImage"+l++;f[u]=x;a[x.image.id]=x;k[k.length]=x;g()}return x}function b(u,v){var C=document.createElement("canvas");
C.width=u?u:0;C.height=v?v:0;if(typeof FlashCanvas!=="undefined"){C.id="tmpCanvas"+e++;C.style.cssText="position: absolute; top: -"+(v-1)+"px; left: -"+(u-1)+"px;";document.body.appendChild(C);FlashCanvas.initElement(C)}typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(C);return C}var f={},e=0,a={},l=0,k=[],p=[],o=[],n=0,t=null,z=false,B={avgImageSize:25,loadTimeout:10,cancelLoad:function(){p=[]},get:function(u,v){var C=null,x=null;z||(C=f[u]);if((x=C?C.image:null)&&(x.getContext||
x.complete&&x.width>0))return x;else v&&d(u,v);return null},load:d,newCanvas:b,stats:function(){return{imageLoadingCount:p.length,queuedImageCount:k.length,imageCacheFullness:n}}};COG.Loopage.join({execute:function(u){for(var v=false,C=0,x=T5.getConfig();C<p.length;)if(u-p[C].requested>B.loadTimeout*1E3){p.splice(C,1);v=true}else C++;v&&g();if(x&&x.imageCacheMaxSize){n=o.length*B.avgImageSize/x.imageCacheMaxSize;n>=1&&m()}},frequency:2E4});return B}();
T5.TimeLord=function(){var g=/^P(\d+Y)?(\d+M)?(\d+D)?$/,m=/^(\d+H)?(\d+M)?(\d+S)?$/,h=function(b,f){return{days:b?b:0,seconds:f?f:0}},d={8601:function(b){b=b.split("T");var f=null;f=null;var e=0,a=0;g.lastIndex=-1;f=g.exec(b[0]);e+=f[3]?parseInt(f[3].slice(0,-1),10):0;m.lastIndex=-1;f=m.exec(b[1]);a+=f[1]?parseInt(f[1].slice(0,-1),10)*3600:0;a+=f[2]?parseInt(f[2].slice(0,-1),10)*60:0;a+=f[3]?parseInt(f[3].slice(0,-1),10):0;return new h(e,a)}};return{Duration:h,addDuration:function(){for(var b=new h,
f=arguments.length;f--;){b.days+=arguments[f].days;b.seconds+=arguments[f].seconds}if(b.seconds>=86400){b.days+=~~(b.seconds/86400);b.seconds%=86400}return b},parseDuration:function(b,f){var e=f?d[f]:null;if(e)return e(b);COG.Log.warn("Could not find duration parser for specified format: "+f);return new h},formatDuration:function(b){var f,e,a="";if(b.days)a=b.days+" days ";if(b.seconds){b=b.seconds;if(b>=3600){f=~~(b/3600);b-=f*3600}if(b>=60){e=Math.round(b/60);b-=e*60}if(f)a=a+f+(f>1?" hrs ":" hr ")+
(e?(e>10?e:"0"+e)+" min ":"");else if(e)a=a+e+" min";else if(b>0)a=a+(b>10?b:"0"+b)+" sec"}return a}}}();
(function(){var g=Math.PI*2,m=Math.PI/2,h=Math.abs,d=Math.pow,b=Math.sin,f=Math.asin,e=Math.cos,a=1.70158,l={linear:function(k,p,o,n){return o*k/n+p},backin:function(k,p,o,n){return o*(k/=n)*k*((a+1)*k-a)+p},backout:function(k,p,o,n){return o*((k=k/n-1)*k*((a+1)*k+a)+1)+p},backinout:function(k,p,o,n){return(k/=n/2)<1?o/2*k*k*(((a*=1.525)+1)*k-a)+p:o/2*((k-=2)*k*(((a*=1.525)+1)*k+a)+2)+p},bouncein:function(k,p,o,n){return o-l.bounceout(n-k,0,o,n)+p},bounceout:function(k,p,o,n){return(k/=n)<1/2.75?
o*7.5625*k*k+p:k<2/2.75?o*(7.5625*(k-=1.5/2.75)*k+0.75)+p:k<2.5/2.75?o*(7.5625*(k-=2.25/2.75)*k+0.9375)+p:o*(7.5625*(k-=2.625/2.75)*k+0.984375)+p},bounceinout:function(k,p,o,n){return k<n/2?l.bouncein(k*2,0,o,n)/2+p:l.bounceout(k*2-n,0,o,n)/2+o/2+p},cubicin:function(k,p,o,n){return o*(k/=n)*k*k+p},cubicout:function(k,p,o,n){return o*((k=k/n-1)*k*k+1)+p},cubicinout:function(k,p,o,n){if((k/=n/2)<1)return o/2*k*k*k+p;return o/2*((k-=2)*k*k+2)+p},elasticin:function(k,p,o,n,t,z){if(k==0)return p;if((k/=
n)==1)return p+o;z||(z=n*0.3);if(!t||t<h(o)){t=o;o=z/4}else o=z/g*f(o/t);return-(t*d(2,10*(k-=1))*b((k*n-o)*g/z))+p},elasticout:function(k,p,o,n,t,z){var B;if(k==0)return p;if((k/=n)==1)return p+o;z||(z=n*0.3);if(!t||t<h(o)){t=o;B=z/4}else B=z/g*f(o/t);return t*d(2,-10*k)*b((k*n-B)*g/z)+o+p},elasticinout:function(k,p,o,n,t,z){var B;if(k==0)return p;if((k/=n/2)==2)return p+o;z||(z=n*0.3*1.5);if(!t||t<h(o)){t=o;B=z/4}else B=z/g*f(o/t);if(k<1)return-0.5*t*d(2,10*(k-=1))*b((k*n-B)*g/z)+p;return t*d(2,
-10*(k-=1))*b((k*n-B)*g/z)*0.5+o+p},quadin:function(k,p,o,n){return o*(k/=n)*k+p},quadout:function(k,p,o,n){return-o*(k/=n)*(k-2)+p},quadinout:function(k,p,o,n){if((k/=n/2)<1)return o/2*k*k+p;return-o/2*(--k*(k-2)-1)+p},sinein:function(k,p,o,n){return-o*e(k/n*m)+o+p},sineout:function(k,p,o,n){return o*b(k/n*m)+p},sineinout:function(k,p,o,n){return-o/2*(e(Math.PI*k/n)-1)+p}};T5.easing=function(k){return l[k.replace(/[\-\_\s\.]/g,"").toLowerCase()]};T5.registerEasingType=function(k,p){l[k.replace(/[\-\_\s\.]/g,
"").toLowerCase()]=p}})();
T5.Tween=function(g){g=T5.ex({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:T5.easing("sine.out"),complete:null,cancelOnInteract:false},g);var m=T5.ticks(),h=[],d=false,b=0,f=0,e={cancelOnInteract:g.cancelOnInteract,isComplete:function(){return d},triggerComplete:function(a){g.complete&&g.complete(a)},update:function(a){try{var l=g.tweenFn(a-m,b,f,g.duration);if(g.target)g.target[g.property]=l;for(var k=h.length;k--;)h[k](l,void 0);if(d=m+g.duration<=a){if(g.target)g.target[g.property]=
g.tweenFn(g.duration,b,f,g.duration);for(var p=h.length;p--;)h[p](l,true)}}catch(o){COG.Log.exception(o)}},requestUpdates:function(a){h.push(a)}};b=g.target&&g.property&&g.target[g.property]?g.target[g.property]:g.startValue;if(typeof g.endValue!=="undefined")f=g.endValue-b;if(f==0)d=true;T5.wakeTweens();return e};
(function(){function g(b){if(d)return m.length;d=true;try{for(var f=0;f<m.length;)if(m[f].isComplete()){m[f].triggerComplete(false);m.splice(f,1)}else{m[f].update(b);f++}}finally{d=false}m.length===0&&h.trigger("complete");return m.length}var m=[],h=null,d=false;T5.tweenValue=function(b,f,e,a,l){b=new T5.Tween({startValue:b,endValue:f,tweenFn:e,complete:a,duration:l});m.push(b);return b};T5.tween=function(b,f,e,a,l,k){b=new T5.Tween({target:b,property:f,endValue:e,tweenFn:a,duration:k,complete:l});
m.push(b);return b};T5.tweenVector=function(b,f,e,a,l,k){var p=[];if(b){var o=b.x==f,n=b.y==e;o||p.push(T5.tween(b,"x",f,a,function(){(o=true)&&n&&l()},k));n||p.push(T5.tween(b,"y",e,a,function(){n=true;o&&n&&l()},k))}return p};T5.cancelAnimation=function(b){if(!d){d=true;try{for(var f=0;f<m.length;)if(!b||b(m[f])){m[f].triggerComplete(true);m.splice(f,1)}else f++}finally{d=false}}};T5.isTweening=function(){return m.length>0};T5.wakeTweens=function(){if(!h){h=COG.Loopage.join({execute:g,frequency:20});
h.bind("complete",function(){h=null})}}})();(function(){var g={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,PINCH:16,FREEZE:128};T5.viewState=function(){for(var m=0,h=arguments.length;h--;){var d=g[arguments[h].toUpperCase()];if(d)m|=d}return m}})();
T5.ViewLayer=function(g){g=T5.ex({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:T5.viewState("ACTIVE","ANIMATING","PAN","PINCH")},g);var m=null,h=false,d=false,b=g.supportFastDraw,f=g.id,e=T5.viewState("ACTIVE"),a=g.validStates,l=0,k=0,p=T5.ex({addToView:function(o){o.setLayer(f,p)},shouldDraw:function(o,n,t){o=(o&a)!==0&&(h?b:true);return o=d||t||l!==n.x||k!==n.y},cycle:function(){},draw:function(){},remove:function(){p.trigger("remove",p)},changed:function(){d=true;p.trigger("changed",
p);m&&m.trigger("invalidate")},getId:function(){return f},setId:function(o){f=o},getParent:function(){return m},setParent:function(o){h=(m=o)?m.fastDraw&&displayState!==e:false;p.trigger("parentChange",m)}},g);COG.observable(p);p.bind("drawComplete",function(o,n){d=false;l=n.x;k=n.y});return p};
T5.View=function(g){function m(y,D,K,S){fa=oa;C();if(S&&g.inertia){P=true;k(U+D,s+K,g.panAnimationEasing,g.panAnimationDuration)}else S||k(U+D,s+K)}function h(){fa=na;P=false;COG.Loopage.join({execute:C,after:50,single:true})}function d(y,D){Z=ua(y);$=ua(D);var K=E(Z.dimensions),S=E($.dimensions);da=J(Z);M=J($);O=Z&&K!==0?S/K:1}function b(y,D,K){d(D,K);if(R=O!==1){fa=ea;C()}}function f(y,D,K,S){d(D,K);if(g.adjustScaleFactor){O=g.adjustScaleFactor(O);COG.Log.info("scale factor adjusted to: "+O)}if(S<
g.pinchZoomAnimateTrigger){n(la,O,da,t(),T5.easing("sine.out"),function(){a();O=1},300);O=la}else{a();O=1}}function e(y,D,K){H.zoom(D,Math.min(Math.pow(2,Math.round(Math.log(K))),8),500)}function a(){var y=Z?t():M;O=Math.round(O*10)/10;R=false;for(var D=x.length;D--;)x[D].trigger("scale",O,y);H.trigger("scale",O,y);fa=na;C()}function l(){clearTimeout(ba);ba=setTimeout(p,50)}function k(y,D,K,S,W){function ga(){ia+=1;if(ia>=2){h(0,0);W&&W()}}var ia=0;if(K){y=T5.tweenValue(U,y,K,ga,S);D=T5.tweenValue(s,
D,K,ga,S);y.cancelOnInteract=true;y.requestUpdates(function(ka){U=ka;P=true;C()});D.cancelOnInteract=true;D.requestUpdates(function(ka){s=ka;P=true;C()})}else{U=y;s=D}}function p(){var y;if(L){COG.Touch.release(L);if(g.autoSize&&L.parentNode){y=L.parentNode.getBoundingClientRect();if(y.height!==0&&y.width!==0){L.height=y.height;L.width=y.width}}try{if(!L.id)L.id=g.id+"_canvas";ca=L.getContext("2d");ca.clearRect(0,0,L.width,L.height)}catch(D){COG.Log.exception(D);throw Error("Could not initialise canvas on specified view element");
}qa=COG.Touch.capture(L,{observable:H});if(I.height!==L.height||I.width!==L.width){I=new T5.Dimensions(L.width,L.height);H.trigger("resize",L.width,L.height);for(y=X;y--;)x[y].trigger("resize",L.width,L.height)}g.inertia&&qa.inertiaEnable(g.panAnimationDuration,I);for(y=X;y--;)x[y].trigger("contextChanged",ca);v()}}function o(y,D){D.setId(y);D.added=T5.ticks();D.bind("remove",function(){H.removeLayer(y)});D.trigger("contextChanged",ca);D.setParent(H);x.push(D);x.sort(function(K,S){var W=S.zindex-
K.zindex;if(W===0)W=S.added-K.added;return W});X=x.length;return D}function n(y,D,K,S,W,ga,ia){function ka(){ga&&ga();a();O=1;ja=null}R=true;da=T5.V.copy(K);M=T5.V.copy(S);Z=null;if(W)T5.tweenValue(0,D-y,W,ka,ia?ia:1E3).requestUpdates(function(pa){ja=pa/(D-y);O=y+pa;fa=ea;C();H.trigger("animate")});else{O=targetScaleFactor;ka()}}function t(){var y=T5.D.getCenter(I),D=T5.V.distance([M,y]),K=T5.V.theta(M,y,D),S=T5.V.diff(da,M);y=T5.V.pointOnEdge(M,y,K,D/O);y.x+=S.x;y.y+=S.y;return y}function z(){H.trigger("idle");
N=true;Q=0}function B(y,D,K,S,W){if(F)D=T5.viewState("FROZEN");var ga=(D&ea)!==0,ia=0;if(r||ga){y.clearRect(0,0,L.width,L.height);r=false}if(ga){T5.D.getCenter(I);var ka=(ja?ja:1)/2,pa=T5.V.diff(da,M);if(Z){V.x=M.x+pa.x;V.y=M.y+pa.y}else{V.x=M.x-pa.x*ka;V.y=M.y-pa.y*ka}K=T5.V.offset(K,V.x,V.y)}y.save();try{la=O;if(G!==1)y.scale(G,G);else if(ga){y.translate(M.x,M.y);y.scale(O,O)}for(ia=X;ia--;)if(x[ia].shouldDraw(D,K,S)){x[ia].draw(y,K,I,D,H,S,W);x[ia].trigger("drawComplete",K,W)}}finally{y.restore()}H.trigger("drawComplete",
K,W);COG.Log.trace("draw complete",W)}function u(y,D){var K=false,S=aa?aa:P?oa:fa,W=!P&&(S===ea||S===oa),ga=ha||S===oa||S===ea||T5.isTweening();q.x=U>>0;q.y=s>>0;if(W){T5.cancelAnimation(function(ia){return ia.cancelOnInteract});N=false;if(Q!==0){clearTimeout(Q);Q=0}}for(W=X;W--;){if(x[W].animated)fa|=ra;K=x[W].cycle(y,q,fa,ga)||K}ga=ga||(fa&ra)!==0;if(K=K||ga||O!==1&&O!==ma){B(ca,S,q,ga,y);ma=O;ha=false}if(!K&&A===0&&!sa){if(!N&&Q===0)Q=setTimeout(z,500);D.trigger("complete")}A=0;COG.Log.trace("Completed draw cycle",
y)}function v(){ha=true;C()}function C(){A+=1;if(!(F||w)){w=COG.Loopage.join({execute:u,frequency:ta});w.bind("complete",function(){w=null})}}g=T5.ex({id:COG.objId("view"),container:"",fastDraw:false,inertia:true,pannable:true,scalable:true,panAnimationEasing:T5.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:true,tapExtent:10,fps:25},g);var x=[],X=0,L=document.getElementById(g.container),ca=null,U=0,s=0,q=new T5.Vector,r=false,w=null,F=false,
G=1,I=new T5.Dimensions,A=0,M=null,N=false,P=false,Q=0,Y=0,V=new T5.Vector,T=0,R=false,Z=null,$=null,aa=null,ha=false,ba=0,O=1,ma=0,la=1,ja=null,da=null,sa=typeof FlashCanvas!=="undefined",ta=~~(1E3/g.fps),qa=null,na=T5.viewState("ACTIVE"),oa=T5.viewState("PAN"),ea=T5.viewState("PINCH"),ra=T5.viewState("ANIMATING"),fa=na,ua=T5.V.getRect,E=T5.D.getSize,J=T5.R.getCenter,H={id:g.id,deviceScaling:G,fastDraw:g.fastDraw||T5.getConfig().requireFastDraw,animate:function(y,D,K,S,W){n(O,y,D,K,S,W)},centerOn:function(y){U=
y.x-L.width/2;s=y.y-L.height/2},getDimensions:function(){return I},getZoomCenter:function(){return V},getLayer:function(y){for(var D=0;D<X;D++)if(x[D].getId()==y)return x[D];return null},setLayer:function(y,D){for(var K=0;K<X;K++)if(x[K].getId()===y){x.splice(K,1);break}D&&o(y,D);v()},eachLayer:function(y){for(var D=X;D--;)y(x[D])},clearBackground:function(){COG.Log.info("CALL OF DEPRECATED METHOD CLEAR BACKGROUND");r=true;v()},invalidate:v,freeze:function(){F=true},unfreeze:function(){F=false;C()},
resize:function(y,D){if(L){g.autoSize=false;L.width=y;L.height=D;p();H.trigger("resize",L.width,L.height)}},scale:function(y,D,K,S,W){S||(S=T5.D.getCenter(I));W||(W=T5.D.getCenter(I));H.animate(y,S,W,D,K);return H},removeLayer:function(y){a:{for(var D=X;D--;)if(x[D].getId()==y){y=D;break a}y=-1}if(y>=0&&y<X){COG.say("layer.removed",{layer:x[y]});x.splice(y,1);v()}X=x.length},stateOverride:function(y){aa=y},getOffset:function(){return q},updateOffset:k,zoom:function(y,D,K){P=false;O=D;R=O!==1;da=T5.D.getCenter(I);
M=O>1?T5.V.copy(y):T5.D.getCenter(I);Z=null;clearTimeout(Y);if(R){fa=ea;C();if(K)Y=setTimeout(function(){a();O=1},parseInt(K,10))}}};G=T5.getConfig().getScaling();H.markers=o("markers",new T5.MarkerLayer);COG.observable(H);H.bind("wake",C);H.bind("invalidate",v);if(g.pannable){H.bind("pan",m);H.bind("panEnd",h);H.bind("inertiaCancel",function(){P=false;C()})}if(g.scalable){H.bind("pinchZoom",b);H.bind("pinchZoomEnd",f);H.bind("wheelZoom",e)}H.bind("tap",function(y,D,K){for(var S=T5.V.offset(K,U,s),
W=x.length;W--;)y.cancel=y.cancel||x[W].trigger("tap",D,K,S).cancel});COG.configurable(H,["inertia","container","rotation","tapExtent","scalable","pannable"],COG.paramTweaker(g,null,{container:function(y,D){L=document.getElementById(D);p()},rotation:function(y,D){T=D}}),true);p();g.autoSize&&window.addEventListener("resize",l,false);return H};
T5.PathLayer=function(g){function m(p){p.syncVectors(f);e&&p.syncVectors(e);k.trigger("tidy")}g=T5.ex({style:"waypoints",pixelGeneralization:8,zindex:50},g);var h=false,d=[],b=null,f=[],e=null,a=0,l=[],k=T5.ex(new T5.ViewLayer(g),{getAnimation:function(p,o,n,t){var z="pathAnimation"+a++;l.push(z);return new T5.AnimatedPathLayer({id:z,path:d,zindex:g.zindex+1,easing:p?p:T5.easing("sine.inout"),duration:o?o:5E3,drawIndicator:n,autoCenter:t?t:false})},cycle:function(p,o,n,t){return t},draw:function(p,
o){var n,t=d.length;p.save();try{T5.applyStyle(p,g.style);if(t>0){p.beginPath();p.moveTo(d[t-1].x-o.x,d[t-1].y-o.y);for(n=t;n--;)p.lineTo(d[n].x-o.x,d[n].y-o.y);p.stroke();if(b){p.fillStyle=g.waypointFillStyle;for(n=b.length;n--;){p.beginPath();p.arc(b[n].x-o.x,b[n].y-o.y,2,0,Math.PI*2,false);p.stroke();p.fill()}}}}finally{p.restore()}h=false},updateCoordinates:function(p,o){var n=k.getParent();n=n?n.getTileLayer():null;f=p;e=o;COG.Log.info("updating coordinates, grid = "+n);n&&m(n)}});k.bind("gridUpdate",
function(p,o){m(o);for(var n=l.length;n--;)COG.say("layer.remove",{id:l[n]});l=[]});k.bind("tidy",function(){d=T5.V.simplify(f,g.pixelGeneralization);b=T5.V.simplify(e,g.pixelGeneralization);h=true;k.changed()});return k};
T5.ShapeLayer=function(g){g=T5.ex({zindex:80,style:null},g);var m=[],h=false,d=T5.ex(new T5.ViewLayer(g),{add:function(b){m.unshift(b)},cycle:function(){return h},draw:function(b,f,e,a){e=f.x;f=f.y;b.save();try{T5.applyStyle(b,g.style);for(var l=m.length;l--;){var k=m[l].style,p=k?T5.applyStyle(b,k):null;m[l].draw(b,e,f,a);p&&T5.applyStyle(b,p)}}finally{b.restore()}h=false}});d.bind("gridUpdate",function(b,f){for(var e=m.length;e--;)m[e].resync(f);h=true;d.changed()});d.bind("parentChange",function(b,
f){var e=f?f.getTileLayer():null;if(e)for(var a=m.length;a--;)m[a].resync(e)});COG.configurable(d,["style"],COG.paramTweaker(g,null,null),true);return d};T5.PolyLayer=T5.ShapeLayer;T5.Shape=function(g){g=T5.ex({style:null},g);return T5.ex(g,{draw:function(){},resync:function(){}})};
T5.Poly=function(g,m){m=T5.ex({fill:false},m);var h=false,d=m.fill,b=[],f=T5.ex(new T5.Shape(m),{draw:function(e,a,l){if(h){var k=true;e.beginPath();for(var p=b.length;p--;){var o=b[p].x-a,n=b[p].y-l;if(k){e.moveTo(o,n);k=false}else e.lineTo(o,n)}d&&e.fill();e.stroke()}},resync:function(e){e.syncVectors(g);b=g.length<=3?g:T5.V.simplify(g)}});h=g&&g.length>=2;return f};
T5.AnimatedPathLayer=function(g){function m(a,l,k){a.fillStyle="#FFFFFF";a.strokeStyle="#222222";a.beginPath();a.arc(k.x,k.y,4,0,Math.PI*2,false);a.stroke();a.fill()}g=T5.ex({path:[],id:COG.objId("pathAni"),easing:T5.easing("sine.inout"),validStates:T5.viewState("ACTIVE","PAN","PINCH"),drawIndicator:null,duration:2E3,autoCenter:false},g);var h=T5.V.edges(g.path),d,b=null,f=0;T5.tweenValue(0,h.total,g.easing,function(){e.remove()},g.duration).requestUpdates(function(a,l){f=a;l&&e.remove()});var e=
T5.ex(new T5.ViewLayer(g),{cycle:function(){for(var a=0;a<h.accrued.length&&h.accrued[a]<f;)a++;b=null;if(a<g.path.length-1){var l=f-(a>0?h.accrued[a-1]:0),k=g.path[a],p=g.path[a+1];d=T5.V.theta(k,p,h.edges[a]);b=T5.V.pointOnEdge(k,p,d,l);if(g.autoCenter)(a=e.getParent())&&a.centerOn(b)}return b},draw:function(a,l){if(b)(g.drawIndicator?g.drawIndicator:m)(a,l,new T5.Vector(b.x-l.x,b.y-l.y),d)}});return e};
T5.Marker=function(g){function m(k,p,o,n){d=k;b=p;f=o;e=n}g=T5.ex({xy:new T5.Vector,offset:true,tweenIn:null,animationSpeed:null},g);var h=false,d=0,b=0,f=0,e=0,a=g.offset,l=T5.ex(g,{isNew:true,isAnimating:function(){return h},draw:function(k,p,o,n,t){if(l.isNew&&g.tweenIn){var z=l.xy.y;l.xy.y=p.y-20;h=true;T5.tween(l.xy,"y",z,g.tweenIn,function(){l.xy.y=z;h=false},g.animationSpeed?g.animationSpeed:250+Math.random()*500)}l.drawMarker(k,p,l.xy.x-(a?p.x:0),l.xy.y-(a?p.y:0),o,n,t);l.isNew=false},drawMarker:function(k,
p,o,n){k.beginPath();k.arc(o,n,4,0,Math.PI*2,false);k.fill();m(o-4,n-4,8,8)},hitTest:function(k,p){return k>=d&&k<=d+f&&p>=b&&p<=b+e},updateBounds:m});COG.observable(l);return l};
T5.ImageMarker=function(g){g=T5.ex({image:null,imageUrl:null,animatingImage:null,animatingImageUrl:null,imageAnchor:null,rotation:0,scale:1,opacity:1},g);var m=g.imageAnchor?T5.V.invert(g.imageAnchor):null,h=T5.ex(new T5.Marker(g),{drawMarker:function(d,b,f,e){if((b=h.isAnimating()&&h.animatingImage?h.animatingImage:h.image)&&b.complete&&b.width>0){m||(m=new T5.Vector(-b.width>>1,-b.height>>1));var a=h.scale,l=f+~~(m.x*a),k=e+~~(m.y*a),p=~~(b.width*a),o=~~(b.height*a);h.updateBounds(l,k,p,p);if(h.rotation||
h.opacity!==1){d.save();try{d.globalAlpha=h.opacity;d.translate(f,e);d.rotate(h.rotation);d.drawImage(b,m.x*a,m.y*a,p,o)}finally{d.restore()}}else d.drawImage(b,l,k,p,o)}}});if(!h.image)h.image=T5.Images.get(g.imageUrl,function(d){h.image=d});if(!h.animatingImage)h.animatingImage=T5.Images.get(g.imageUrl,function(d){h.animatingImage=d});return h};T5.Annotation=T5.Marker;T5.ImageAnnotation=T5.ImageMarker;
T5.MarkerLayer=function(g){function m(e,a){for(var l=d.length;l--;)a.syncVectors([d[l].xy])}function h(){f.changed();f.trigger("markerUpdate",d)}g=T5.ex({zindex:100},g);var d=[],b=false,f=T5.ex(new T5.ViewLayer(g),{cycle:function(){return b},draw:function(e,a,l,k,p){b=false;for(l=d.length;l--;){d[l].draw(e,a,k,f,p);b=b||d[l].isAnimating()}return b?1:0},add:function(e){if(e&&typeof e.length!=="undefined")for(var a=e.length;a--;){if(e[a])d[d.length]=e[a]}else if(e)d[d.length]=e;h()},clear:function(e){if(e)for(var a=
0;a<d.length;a++)e(d[a])&&d.splice(a,1);else d=[];h()},find:function(e){var a=[];if(e)for(var l=d.length;l--;)if(e(d[l]))a[a.length]=d[l];return a}});f.bind("tap",function(e,a,l){for(var k=[],p=l.x,o=l.y,n=d.length;n--;)if(d[n].hitTest(p,o))k[k.length]=d[n];if(k.length>0)e.cancel=f.trigger("markerTap",a,l,k).cancel});f.bind("gridUpdate",m);f.bind("changed",function(){var e=f.getParent().getTileLayer();e&&m(null,e)});return f};
T5.Style=function(g){function m(f){var e=g[f];typeof e!=="undefined"&&h.push(function(a){a[f]=e})}g=T5.ex({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},g);var h=[],d={applyToContext:function(f){for(var e=h.length;e--;)h[e](f)}};for(var b in g)m(b);return d};
(function(){var g={},m={basic:new T5.Style({lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"}),waypoints:new T5.Style({lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"})};T5.applyStyle=function(h,d){var b=T5.styles[d]?T5.styles[d]:T5.styles.basic,f;if(h&&h.canvas){f=g[h.canvas.id];g[h.canvas.id]=d}b.applyToContext(h);return f};T5.loadStyles=function(h){COG.jsonp(h,function(d){T5.resetStyles(d)})};T5.resetStyles=function(h){var d={};for(var b in h)d[b]=new T5.Style(h[b]);T5.styles=T5.ex({},
m,d)};T5.styles=m})();(function(){T5.tileSize=256;T5.Tile=function(g){return g=T5.ex({x:0,y:0,gridX:0,gridY:0,dirty:true},g)};T5.EmptyTile=function(g){g=new T5.Tile(g);g.empty=true;return g};T5.ImageTile=function(g){g=T5.ex({url:"",sessionParamRegex:null,loading:false,loaded:false},g);return new T5.Tile(g)}})();
T5.TileGrid=function(g){function m(A,M){var N=T5.Vector(A*l-t.x,M*l-t.y);return new T5.EmptyTile({gridX:N.x,gridY:N.y,empty:true})}function h(A,M,N,P){var Q=Math.max(e,a)*0.2>>0,Y=new T5.Vector;if(A<0||A+N>e)Y.x=A<0?-Q:Q;if(M<0||M+P>a)Y.y=M<0?-Q:Q;return Y}function d(A,M,N){var P=COG.Log.getTraceTicks(),Q=0;new T5.Vector(e/2,a/2);L=true;try{if(N)f=[];if(A)for(N=0;N<a;N++)for(var Y=0;Y<e;Y++){if(!f[Q]){var V=A(Y,N,o,e,a);V.gridX=Y*l-t.x;V.gridY=N*l-t.y;f[Q]=V}Q++}}finally{L=false}n=A;z=M;COG.Log.trace("tile grid populated",
P);I.changed()}function b(A,M,N,P){var Q,Y=[],V=false;A=new T5.Vector((A.x+t.x)*v>>0,(A.y+t.y)*v>>0);tilesNeeded=false;if(!r){Q=I.getParent().getDimensions();s=Math.ceil(Q.width*v)+1;q=Math.ceil(Q.height*v)+1;r=new T5.Vector((s-1)/2>>0,(q-1)/2>>0)}for(var T=q;T--;)for(var R=s;R--;){Q=R+A.x>=0&&R+A.x<e?f[(T+A.y)*e+(R+A.x)]:null;var Z=new T5.Vector(R-r.x,T-r.y);if(!Q){U=h(A.x,A.y,s,q);Q=m(R+A.x,T+A.y)}V=Q?(Q.dirty=N||Q.dirty)||V:V;Y[Y.length]={tile:Q,centerness:T5.V.absSize(Z)}}Y.sort(function($,aa){return aa.centerness-
$.centerness});x||(x=Array(Y.length));for(N=Y.length;N--;){x[N]=Y[N].tile;I.prepTile(x[N],M)}ca=P;return V}g=T5.ex({tileSize:T5.tileSize,center:new T5.Vector,clearBackground:false,gridSize:25,shiftOrigin:null,supportFastDraw:true,allowShift:true},g);var f=Array(Math.pow(g.gridSize,2)),e=g.gridSize,a=g.gridSize,l=g.tileSize,k=a*l,p=e*l,o=T5.V.offset(g.center,-Math.ceil(e>>1)),n=null,t=new T5.Vector,z=null,B=Math.round(l/2),u=false,v=l?1/l:0,C=true,x=null,X=false,L=false,ca=0;new T5.Vector;var U=new T5.Vector;
T5.getConfig();var s,q,r,w=g.clearBackground;T5.viewState("ANIMATING");var F=T5.viewState("PAN"),G=T5.viewState("PINCH"),I=T5.ex(new T5.ViewLayer(g),{gridDimensions:new T5.Dimensions(p,k),cycle:function(A,M,N,P){if(U.x!==0||U.y!==0){P=U;var Q=g.shiftOrigin;if(!(!g.allowShift||P.x===0&&P.y===0)){var Y=COG.Log.getTraceTicks(),V=Array(f.length);V.length=f.length;for(var T=0;T<e;T++)for(var R=0;R<a;R++)V[R*e+T]=T+P.x>=0&&T+P.x<e?f[(R+P.y)*e+(T+P.x)]:null;f=V;o=Q?Q(o,P):T5.V.add(o,P);t.x+=-P.x*l;t.y+=
-P.y*l;COG.Log.trace("tile storage shifted",Y);d(n,z)}U=new T5.Vector;P=true}if(!u&&(N&G)===0)u=b(M,N,P,A);return u},find:function(A){if(!A)return null;for(var M=f.length;M--;){var N=f[M];if(N&&A(N))return N}return null},prepTile:function(){},drawTile:function(){return false},getTileSize:function(){return l},draw:function(A,M,N,P,Q,Y,V){var T=M.x;M=M.y;var R=N.width,Z=N.height,$,aa=true;if(x){w&&A.clearRect(0,0,N.width,N.height);A.beginPath();if(C)for(var ha=x.length;ha--;){$=x[ha];var ba=$.gridX-
T,O=$.gridY-M;$.x=ba;$.y=O;if($.empty){if(!w){A.clearRect(ba,O,l,l);A.rect(ba,O,l,l);aa=false}}else if(Y||$.dirty){($=I.drawTile(A,$,ba,O,P,Y,V,w))&&A.rect(ba,O,l,l);aa=aa&&$}R=ba<R?ba:R;Z=O<Z?O:Z}if(!w&&(P&F)!==0){if(R>0){A.clearRect(0,0,R,N.height);A.rect(0,0,R,N.height)}if(Z>0){A.clearRect(0,0,N.width,Z);A.rect(0,0,N.width,Z)}}w||A.clip();aa&&!X&&Q.trigger("tileDrawComplete");u=false;X=aa}},getTileAtXY:function(A,M){for(var N=null,P=x?x.length:0;P--;){var Q=x[P];if(Q&&A>=Q.x&&M>=Q.y)if(A<=Q.x+
l&&M<=Q.y+l){N=Q;break}}COG.Log.info("looking for tile @ x: "+A+", y: "+M+", found: "+N);return N},getTileVirtualXY:function(A,M,N){A=T5.V.add(new T5.Vector(A,M),T5.V.invert(o),t);A=new T5.Vector(A.x*l,A.y*l);if(N){A.x+=B;A.y+=B}return A},populate:function(A){d(A,null,true)},syncVectors:function(){}});I.bind("resize",function(){COG.Log.info("captured resize");r=null});I.bind("scale",function(){C=false});COG.listen("imagecache.cleared",function(){for(var A=f.length;A--;)if(f[A])f[A].loaded=false});
COG.listen("tiler.repaint",function(){for(var A=f.length;A--;)if(f[A]){f[A].x=null;f[A].y=null}});return I};
T5.ImageTileGrid=function(g){function m(n){function t(){var z=T5.Images.newCanvas(32,32),B=z.getContext("2d");B.fillStyle="#BBBBBB";B.fillRect(0,0,32,32);B.fillStyle="#C3C3C3";B.fillRect(0,0,16,16);B.fillRect(16,16,16,16);return z}if(!d||n!==d.width){d=T5.Images.newCanvas(n,n);n=d.getContext("2d");n.fillStyle=typeof FlashCanvas!=="undefined"?"#666666":n.createPattern(t(),"repeat");n.fillRect(0,0,d.width,d.height)}return d}g=T5.ex({emptyTile:function(n){if(!h||n!==h.width){h=T5.Images.newCanvas(n,
n);n=h.getContext("2d");n.fillStyle="rgba(150, 150, 150, 0.1)";n.fillRect(0,0,h.width,h.height)}return h}(T5.tileSize),panningTile:null,tileOffset:new T5.Vector,tileDrawArgs:{}},g);var h=g.emptyTile,d=g.panningTile?g.panningTile:m(T5.tileSize),b=T5.viewState("ACTIVE"),f=T5.viewState("PAN"),e=T5.getConfig().requireFastDraw,a=g.tileSize?g.tileSize:T5.tileSize,l=T5.Images.get,k=T5.Images.load,p=T5.ex({background:null,overlay:null,offset:new T5.Vector,realSize:new T5.Dimensions(a,a)},g.tileDrawArgs),
o=T5.ex(new T5.TileGrid(g),{drawTile:function(n,t,z,B,u,v,C,x){v=t.url?l(t.url):null;C=false;if(v){n.drawImage(v,z,B);t.dirty=false;C=true}else if((u&f)!==0){x||n.drawImage(d,z,B);C=true}return C},initTileUrl:function(){},prepTile:function(n,t){if(n&&!n.loading&&(!e||t===b)){n.url||o.initTileUrl(n);if(!l(n.url)){n.loading=true;k(n.url,function(){n.loadTime=(new Date).getTime();n.loaded=true;n.dirty=true;o.changed()},p)}}}});return o};
T5.Tiler=function(g){g=T5.ex({container:"",drawCenter:false,datasources:{},tileLoadThreshold:"first"},g);var m=T5.ex(new T5.View(g),{getTileLayer:function(){return m.getLayer("grid0")},setTileLayer:function(h){m.setLayer("grid0",h);m.trigger("gridUpdate",h);m.eachLayer(function(d){d.trigger("gridUpdate",h)})},viewPixToGridPix:function(h){var d=m.getOffset();return new T5.Vector(h.x+d.x,h.y+d.y)},centerOn:function(h,d,b,f){var e=m.getTileLayer(),a=m.getDimensions();(e=e?e.getTileSize():0)&&m.updateOffset(h.gridX-
(a.width-e)*0.5>>0,h.gridY-(a.height-e)*0.5>>0,d,b,f)},cleanup:function(){m.removeLayer("grid0")},repaint:function(){COG.say("tiler.repaint");m.trigger("wake")},select:function(h){m.trigger("selectTile",h)}});m.bind("tap",function(h,d,b){if(h=m.getTileLayer())(b=h.getTileAtXY(b.x,b.y))&&m.trigger("selectTile",b)});return m};
T5.Geo=function(){function g(s,q){var r=null;for(var w in ca)if(q){if(w==q&&ca[w][s]){r=ca[w];break}}else if(ca[w][s]){r=ca[w];break}return r}function m(s,q){var r=o*Math.sin(s);return b-2*Math.atan(q*Math.pow((1-r)/(1+r),o/2))}function h(s,q,r,w){var F=0;s=s.toUpperCase();for(var G in w){var I=q[G];if(I){var A=r[G];I=A?A(s,I):COG.wordExists(s,I)?1:0;F+=I*w[G]}}return F}var d=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],b=Math.PI/2,f=Math.PI*2,e=-b,a=
b,l=-f,k=Math.PI/180,p=180/Math.PI,o=0.08181919084262157,n=null,t={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",HWY:"HIGHWAY",MWY:"MOTORWAY"},z={VECTORIZE_PER_CYCLE:500},B={getEngine:function(s){for(var q=null,r=1;!q&&r<arguments.length;r++)q=g(s,arguments[r]);q=q?q:g(s);if(!q)throw Error("Unable to find GEO engine with "+s+" capability");return q},rankGeocodeResponses:function(s,q,r){var w=[],F=U.AddressCompareFns;if(r&&r.compareFns)F=T5.ex({},F,r.compareFns);for(r=0;r<
q.length;r++)w.push(new U.GeoSearchResult({caption:L.toString(q[r]),data:q[r],pos:q[r].pos,matchWeight:h(s,q[r],F,U.GeocodeFieldWeights)}));w.sort(function(G,I){return I.matchWeight-G.matchWeight});return w},distanceToString:function(s){if(s>1E3)return~~(s/10)/100+" km";return s?s+" m":""},dist2rad:function(s){return s/6371},lat2pix:function(s){s=parseFloat(s)*k;s=Math.sin(s);var q=o*s;return Math.log((1+s)/(1-s)*Math.pow((1-q)/(1+q),o))/2},lon2pix:function(s){return parseFloat(s)*k},pix2lon:function(s){return U.normalizeLon(s)*
p},pix2lat:function(s){s=Math.pow(Math.E,-s);for(var q=b-2*Math.atan(s),r=m(q,s),w=0;w<12&&Math.abs(q-r)>1.0E-7;){q=r;r=m(q,s);w++}return r*p},normalizeLon:function(s){for(;s<-180;)s+=360;for(;s>180;)s-=360;return s}},u=function(s,q){return{lat:parseFloat(s?s:0),lon:parseFloat(q?q:0)}},v=function(s,q){return{min:x.parse(s),max:x.parse(q)}},C=function(s){return s=T5.ex({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},s)},x=function(){var s={calcDistance:function(q,
r){if(s.empty(q)||s.empty(r))return 0;var w=(r.lat-q.lat)*k/2,F=(r.lon-q.lon)*k/2;w=Math.sin(w)*Math.sin(w)+Math.cos(q.lat*k)*Math.cos(r.lat*k)*Math.sin(F)*Math.sin(F);return 6371*2*Math.atan2(Math.sqrt(w),Math.sqrt(1-w))},copy:function(q){return q?new u(q.lat,q.lon):null},empty:function(q){return!q||q.lat===0&&q.lon===0},equal:function(q,r){return q&&r&&q.lat==r.lat&&q.lon==r.lon},inArray:function(q,r){for(var w=x.equal,F=r.length;F--;)if(w(q,r[F]))return true;return false},inBounds:function(q,r){var w=
!(x.empty(q)||x.empty(r));return w=(w=w&&q.lat>=r.min.lat&&q.lat<=r.max.lat)&&q.lon>=r.min.lon&&q.lon<=r.max.lon},offset:function(q,r,w){var F=q.lat*k;r=F+r/6371;for(q=q.lon*k+Math.asin(Math.sin(w/6371)/Math.cos(F));r<e;)r+=Math.PI;for(;r>a;)r-=Math.PI;for(;q>f;)q-=2*Math.PI;return new u(r*p,q*p)},parse:function(q){if(q)if(typeof q.lat!=="undefined")return s.copy(q);else{if(q.split)for(var r=[" ",","],w=0;w<r.length;w++){var F=q.split(r[w]);if(F.length===2)return new u(F[0],F[1])}}else return new u;
return null},parseArray:function(q){var r=q.length,w=Array(r);for(r=r;r--;)w[r]=s.parse(q[r]);return w},fromMercatorPixels:function(q,r){return new u(T5.Geo.pix2lat(r),T5.Geo.normalizeLon(T5.Geo.pix2lon(q)))},toMercatorPixels:function(q){return new T5.Vector(T5.Geo.lon2pix(q.lon),T5.Geo.lat2pix(q.lat))},generalize:function(q,r,w){var F=q.length,G=[],I=null;w||(w=250);w/=1E3;COG.Log.info("generalizing positions, must include "+r.length+" positions");for(var A=F;A--;)if(A===0)G.unshift(q[A]);else{var M=
!I||x.inArray(q[A],r)?w:x.calcDistance(I,q[A]);if(q[A]&&M>=w){G.unshift(q[A]);I=q[A]}}COG.Log.info("generalized "+F+" positions into "+G.length+" positions");return G},vectorize:function(q,r){var w=q.length,F=Array(w);r=T5.ex({chunkSize:z.VECTORIZE_PER_CYCLE,async:true},r);if(!r.async){for(var G=w;G--;)F[G]=new T5.Geo.GeoVector(q[G]);return F}return COG.Loopage.join({frequency:10,execute:function(I,A){for(var M=0,N=r.chunkSize,P=w;P--;){F[P]=new T5.Geo.GeoVector(q[P]);M+=1;if(M>N)break}w=P;w<=0&&
A.trigger("complete",F)}})},toString:function(q){return q?q.lat+" "+q.lon:""}};return s}(),X=function(){var s={calcSize:function(q,r,w){var F=new T5.Vector(0,r.lat-q.lat);if(typeof w==="undefined")w=true;F.x=w&&q.lon>r.lon?360-q.lon+r.lon:r.lon-q.lon;return F},createBoundsFromCenter:function(q,r){var w=r/6371,F=q.lat*k,G=q.lon*k,I=F-w,A=F+w;if(I>e&&A<a){F=Math.asin(Math.sin(w)/Math.cos(F));w=G-F;if(w<l)w+=2*Math.PI;G=G+F;if(G>f)G-=2*Math.PI}else{I=Math.max(I,e);A=Math.min(A,a);w=l;G=f}return new v(new u(I*
p,w*p),new u(A*p,G*p))},expand:function(q,r){return new v(new u(q.min.lat-r,q.min.lon-U.normalizeLon(r)),new u(q.max.lat+r,q.max.lon+U.normalizeLon(r)))},forPositions:function(q,r){var w=null,F=T5.ticks();r||(r="auto");for(var G=q.length;G--;)if(w){var I=s.calcSize(w.min,q[G],false),A=s.calcSize(q[G],w.max,false);if(I.x<0)w.min.lon=q[G].lon;if(I.y<0)w.min.lat=q[G].lat;if(A.x<0)w.max.lon=q[G].lon;if(A.y<0)w.max.lat=q[G].lat}else w=new T5.Geo.BoundingBox(q[G],q[G]);if(r){if(r=="auto"){G=s.calcSize(w.min,
w.max);r=Math.max(G.x,G.y)*0.3}w=s.expand(w,r)}COG.Log.trace("calculated bounds for "+q.length+" positions",F);return w},getCenter:function(q){var r=X.calcSize(q.min,q.max);return new T5.Geo.Position(q.min.lat+r.y/2,q.min.lon+r.x/2)},getGeoHash:function(q){var r=T5.Geo.GeoHash.encode(q.min.lat,q.min.lon);q=T5.Geo.GeoHash.encode(q.max.lat,q.max.lon);COG.Log.info("min hash = "+r+", max hash = "+q)},getZoomLevel:function(q,r){var w=s.getCenter(q),F=d[Math.min(Math.round(Math.abs(w.lat)*0.05),d.length)],
G=s.calcSize(q.min,q.max);w=Math.ceil(Math.log(d[3]*r.height/G.y)/Math.log(2));F=Math.ceil(Math.log(F*r.width/G.x)/Math.log(2));return Math.min(isNaN(w)?1E3:w,isNaN(F)?1E3:F)},isEmpty:function(q){return!q||x.empty(q.min)||x.empty(q.max)},toString:function(q){return"min: "+x.toString(q.min)+", max: "+x.toString(q.max)}};return s}(),L=function(){var s=/^(\d+).*$/,q=/(\d+)\s?\-\s?(\d+)/;return{buildingMatch:function(r,w){s.lastIndex=-1;if(s.test(r))for(var F=r.replace(s,"$1"),G=w.split(","),I=0;I<G.length;I++){q.lastIndex=
-1;if(q.test(G[I])){var A=q.exec(G[I]);if(F>=parseInt(A[1],10)&&F<=parseInt(A[2],10))return true}else if(F==G[I])return true}return false},normalize:function(r){if(!r)return"";r=r.toUpperCase();if(!n){var w=[];for(var F in t)w.push(F);n=RegExp("(\\s)("+w.join("|")+")(\\s|$)","i")}n.lastIndex=-1;if(w=n.exec(r))r=r.replace(n,"$1"+t[w[2]]);return r},toString:function(r){return r.streetDetails+" "+r.location}}}(),ca={},U={P:x,B:X,A:L,Radius:function(s,q){return{distance:parseInt(s,10),uom:q}},Position:u,
BoundingBox:v,GeoVector:function(s){function q(w){r.pos=w;r.mercXY=x.toMercatorPixels(w)}var r=new T5.Vector;T5.ex(r,{radsPerPixel:null,setRadsPerPixel:function(w,F,G){var I=r.mercXY;r.x=Math.abs((I.x/w>>0)+(F?F:0));r.y=Math.abs((I.y/w>>0)+(G?G:0));r.radsPerPixel=w},updatePos:q});q(s);return r},Address:C,GeocodeFieldWeights:{streetDetails:50,location:50},AddressCompareFns:{},Engine:function(s){if(!s.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var q=T5.ex({remove:function(){delete ca[q.id]}},
s);return ca[q.id]=q},GeoSearchResult:function(s){s=T5.ex({id:null,caption:"",resultType:"",data:null,pos:null,matchWeight:0},s);return T5.ex(s,{toString:function(){return s.caption+(s.matchWeight?" ("+s.matchWeight+")":"")}})},GeoSearchAgent:function(s){return new T5.Dispatcher.Agent(s)},GeocodingAgent:function(s){s=T5.ex({name:"Geocoding Search Agent",paramTranslator:null,execute:function(q,r){try{if(!q.reverse&&!q.freeform)address=new C(q);var w=U.getEngine("geocode");if(w)w.geocode({addresses:[q.freeform?
q.freeform:address],complete:function(G,I){if(r){var A=I;if(q.freeform)A=U.rankGeocodeResponses(q.freeform,A,U.getEngine("geocode"));r(A,s)}}})}catch(F){COG.Log.exception(F)}}},s);return new U.GeoSearchAgent(s)}};return T5.ex(U,z,B)}();
T5.Geo.GeoHash=function(){function g(m,h,d){if(h&d)m[0]=(m[0]+m[1])/2;else m[1]=(m[0]+m[1])/2}BITS=[16,8,4,2,1];BASE32="0123456789bcdefghjkmnpqrstuvwxyz";NEIGHBORS={right:{even:"bc01fg45238967deuvhjyznpkmstqrwx"},left:{even:"238967debc01fg45kmstqrwxuvhjyznp"},top:{even:"p0r21436x8zb9dcf5h7kjnmqesgutwvy"},bottom:{even:"14365h7k9dcfesgujnmqp0r2twvyx8zb"}};BORDERS={right:{even:"bcfguvyz"},left:{even:"0145hjnp"},top:{even:"prxz"},bottom:{even:"028b"}};NEIGHBORS.bottom.odd=NEIGHBORS.left.even;NEIGHBORS.top.odd=
NEIGHBORS.right.even;NEIGHBORS.left.odd=NEIGHBORS.bottom.even;NEIGHBORS.right.odd=NEIGHBORS.top.even;BORDERS.bottom.odd=BORDERS.left.even;BORDERS.top.odd=BORDERS.right.even;BORDERS.left.odd=BORDERS.bottom.even;BORDERS.right.odd=BORDERS.top.even;return{decode:function(m){var h=1,d=[],b=[];d[0]=-90;d[1]=90;b[0]=-180;b[1]=180;lat_err=90;lon_err=180;for(i=0;i<m.length;i++){c=m[i];cd=BASE32.indexOf(c);for(j=0;j<5;j++){mask=BITS[j];if(h){lon_err/=2;g(b,cd,mask)}else{lat_err/=2;g(d,cd,mask)}h=!h}}d[2]=(d[0]+
d[1])/2;b[2]=(b[0]+b[1])/2;return{latitude:d,longitude:b}},encode:function(m,h,d){var b=1,f=[],e=[],a=0,l=0;d=d?d:12;geohash="";f[0]=-90;f[1]=90;e[0]=-180;for(e[1]=180;geohash.length<d;){if(b){mid=(e[0]+e[1])/2;if(h>mid){l|=BITS[a];e[0]=mid}else e[1]=mid}else{mid=(f[0]+f[1])/2;if(m>mid){l|=BITS[a];f[0]=mid}else f[1]=mid}b=!b;if(a<4)a++;else{geohash+=BASE32[l];l=a=0}}return geohash}}}();
T5.Geo.JSON=function(){function g(e,a){var l=h(a);e.add(new T5.Poly(l))}function m(e,a){var l=h(a[0]);e.add(new T5.Poly(l,{fill:true}))}function h(e){var a=e.length,l=Array(a);for(a=a;a--;)l[a]=new T5.Geo.Position(e[a][1],e[a][0]);return T5.Geo.P.vectorize(l,d)}var d={async:false},b={linestring:g,multilinestring:function(e,a){for(var l=0;l<a.length;l++)g(e,a[l])},polygon:m,multipolygon:function(e,a){for(var l=0;l<a.length;l++)m(e,a[l])}},f=function(e,a,l){l=T5.ex({vectorsPerCycle:T5.Geo.VECTORIZE_PER_CYCLE,
rowPreParse:null,targetLayer:null},l);var k=l.vectorsPerCycle,p=l.targetLayer,o=l.rowPreParse,n=0,t=0;if(!e)return null;if(typeof e.length==="undefined")e=[e];t=e.length;p||(p=new T5.PolyLayer);l=COG.Loopage.join({frequency:10,execute:function(z,B){for(var u=0,v=n;v<t;v++){var C=o?o(e[v]):e[v],x=C.type?C.type.toLowerCase():null;x=b[x];var X=null;if(x)X=x(p,C.coordinates);u+=X?X:1;if(u>=k)break}n=v+1;n>=t&&B.trigger("complete")}});l.bind("complete",function(){a&&a(p)});return l};return{parse:function(e,
a,l){return new f(e,a,l)}}}();
T5.Geo.LocationSearch=function(g){function m(e,a){navigator.geolocation.clearWatch(d);d=0;if(b){clearTimeout(b);b=0}a&&a([e],g)}function h(e){COG.Log.info("caught location tracking error:",e)}g=T5.ex({name:"Geolocation Search",requiredAccuracy:null,searchTimeout:5E3,watch:false},g);var d=0,b=0,f=null;return new T5.Geo.GeoSearchAgent(T5.ex({execute:function(e,a){if(navigator.geolocation&&!d){d=navigator.geolocation.watchPosition(function(l){var k=new T5.Geo.Position(l.coords.latitude,l.coords.longitude);
l=new T5.Geo.GeoSearchResult({id:1,caption:"Current Location",pos:k,accuracy:l.coords.accuracy/1E3,matchWeight:100});if(!f||l.accuracy<f.accuracy)f=l;if(!g.requiredAccuracy||f.accuracy<g.requiredAccuracy)m(f,a)},h,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3});if(g.searchTimeout)b=setTimeout(function(){f&&m(f,a)},g.searchTimeout)}}},g))};
T5.Map=function(g){function m(t){try{var z=new T5.Geo.Position(t.coords.latitude,t.coords.longitude),B=t.coords.accuracy/1E3;n.trigger("locationUpdate",t,B);if(p){if(!l){l=new T5.Geo.UI.LocationOverlay({pos:z,accuracy:B});l.update(n.getTileLayer());n.setLayer("location",l)}var u=T5.Geo.B.createBoundsFromCenter(z,Math.max(B,1));n.gotoBounds(u)}else{l.pos=z;l.accuracy=B;l.update(n.getTileLayer());n.panToPosition(z,null,T5.easing("sine.out"))}p=false}catch(v){COG.Log.exception(v)}}function h(t){COG.Log.info("caught location tracking error:",
t)}g=T5.ex({tapExtent:10,provider:null,crosshair:false,zoomLevel:0,boundsChangeThreshold:30,zoomAnimation:T5.easing("quad.out")},g);var d={NONE:0,SINGLE:1,WATCH:2},b=new T5.Vector,f=d.NONE,e=false,a=null,l=null,k=0,p=true,o=g.zoomLevel;if(!g.provider)g.provider=new T5.Geo.MapProvider;g.adjustScaleFactor=function(t){return Math.pow(2,(t<1?Math.floor:Math.ceil)(Math.log(t)))};var n=T5.ex({},new T5.Tiler(g),{annotations:null,getBoundingBox:function(){var t=n.getTileLayer(),z=n.getOffset(),B=n.getDimensions();
if(t)return t.getBoundingBox(z.x,z.y,B.width,B.height);return null},getCenterPosition:function(){return n.getXYPosition(T5.D.getCenter(n.getDimensions()))},getXYPosition:function(t){return n.getTileLayer().pixelsToPos(n.viewPixToGridPix(t))},gotoBounds:function(t,z){var B=T5.Geo.B.getZoomLevel(t,n.getDimensions());n.gotoPosition(T5.Geo.B.getCenter(t),B,z)},gotoPosition:function(t,z,B){function u(X){n.setTileLayer(X);n.panToPosition(t,function(){n.unfreeze();n.trigger("zoomLevelChange",o);B&&B()});
e=true}var v=o,C=!e,x=n.getBoundingBox();if(x)C=C||!T5.Geo.P.inBounds(t,x);o=z?z:o;if(!o)throw Error("Zoom level required to goto a position.");if(g.provider)o=g.provider.checkZoomLevel(o);if(C||o!==v){T5.Images.cancelLoad();T5.cancelAnimation();e&&n.freeze();g.provider.zoomLevel=o;g.provider.getMapTiles(n,t,u)}else n.panToPosition(t,B)},panToPosition:function(t,z,B,u){var v=n.getTileLayer();if(v){t=v.getGridXYForPosition(t);v=n.getDimensions();t.x-=v.width/2;t.y-=v.height/2;if(a)a=null;n.updateOffset(t.x,
t.y,B,u,z);n.trigger("wake");n.trigger("boundsChange",n.getBoundingBox());z&&typeof B==="undefined"&&z(n)}},locate:function(){n.trackStart(d.SINGLE);setTimeout(n.trackCancel,1E4)},trackStart:function(t){if(navigator.geolocation&&!k){f=t?t:d.WATCH;p=true;k=navigator.geolocation.watchPosition(m,h,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3})}},trackCancel:function(){k&&navigator.geolocation&&navigator.geolocation.clearWatch(k);n.removeLayer("location");l=null;f=d.NONE;k=0},getZoomLevel:function(){return o},
setZoomLevel:function(t){try{n.gotoPosition(n.getCenterPosition(),t)}catch(z){COG.Log.exception(z)}},zoomIn:function(){n.scale(2,T5.easing("sine.out"))||n.setZoomLevel(o+1)},zoomOut:function(){n.scale(0.5,T5.easing("sine.out"))||n.setZoomLevel(o-1)},animateRoute:function(t,z,B,u){var v=n.getLayer("route");if(v)(t=v.getAnimation(t,z,B,u))&&t.addToView(n)}});n.bind("pan",function(){f===d.SINGLE&&n.trackCancel()});n.bind("tap",function(t,z,B){var u=n.getTileLayer(),v=null;if(u){var C=n.viewPixToGridPix(new T5.Vector(B.x,
B.y));t=u.pixelsToPos(C);v=u.pixelsToPos(T5.V.offset(C,-g.tapExtent,g.tapExtent));u=u.pixelsToPos(T5.V.offset(C,g.tapExtent,-g.tapExtent));v=new T5.Geo.BoundingBox(v,u);n.trigger("geotap",z,B,t,v)}});n.bind("doubleTap",function(t,z,B){n.scalable()&&n.animate(2,T5.D.getCenter(n.getDimensions()),new T5.Vector(B.x,B.y),g.zoomAnimation)});n.bind("scale",function(t,z,B){t=0;z=Math.sqrt(z);if(z<1)t=-(0.5/z);else if(z>1)t=z;n.gotoPosition(n.getXYPosition(B),o+t>>0)});g.crosshair&&n.setLayer("crosshair",
new CrosshairOverlay);n.bind("idle",function(){if(T5.V.absSize(T5.V.diff(b,n.getOffset()))>g.boundsChangeThreshold){b=T5.V.copy(n.getOffset());n.trigger("boundsChange",n.getBoundingBox())}});COG.configurable(n,["provider"],COG.paramTweaker(g,null,{provider:function(){n.cleanup();e=false}}),true);return n};
T5.Geo.MapProvider=function(){var g=1,m=20;return{zoomLevel:0,checkZoomLevel:function(h){return Math.min(Math.max(h,g),m)},getCopyright:function(){},getLogoUrl:function(){},getMapTiles:function(){},getZoomRange:function(){return{min:g,max:m}},prepTileGridArgs:function(h,d,b,f,e){var a=null;if(e.tileBackgroundColor){a=T5.Images.newCanvas(b,b);var l=a.getContext("2d");l.fillStyle=e.tileBackgroundColor;l.fillRect(0,0,b,b)}return T5.ex({tileSize:b,width:h,height:d,center:f,tileDrawArgs:{background:a}},
e)},setZoomRange:function(h,d){g=h;m=d}}};
T5.Geo.Routing=function(){var g={calculate:function(m){m=T5.ex({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},m);var h=T5.Geo.getEngine("route");h&&h.route(m,function(d){if(m.generalize)d.geometry=T5.Geo.P.generalize(d.geometry,d.getInstructionPositions());if(m.map){g.createMapOverlay(m.map,d);m.autoFit&&m.map.gotoBounds(d.boundingBox)}m.success&&m.success(d)})},createMapOverlay:function(m,h){var d=m.getDimensions();d=new T5.Geo.UI.RouteOverlay({data:h,width:d.width,
height:d.height});m.setLayer("route",d)},parseTurnType:function(m){for(var h=g.TurnType.Unknown,d=T5.Geo.Routing.TurnTypeRules,b=0;b<d.length;b++){d[b].regex.lastIndex=-1;var f=d[b].regex.exec(m);if(f){h=d[b].customCheck?d[b].customCheck(m,f):d[b].turnType;break}}return h},TurnType:{Unknown:"turn-unknown",Start:"turn-none-start",Continue:"turn-none",Arrive:"turn-none-arrive",TurnLeft:"turn-left",TurnLeftSlight:"turn-left-slight",TurnLeftSharp:"turn-left-sharp",TurnRight:"turn-right",TurnRightSlight:"turn-right-slight",
TurnRightSharp:"turn-right-sharp",Merge:"merge",UTurnLeft:"uturn-left",UTurnRight:"uturn-right",EnterRoundabout:"roundabout-enter",Ramp:"ramp",RampExit:"ramp-exit"},Instruction:function(m){var h=m=T5.ex({position:null,description:"",distance:0,distanceTotal:0,time:0,timeTotal:0,turnType:null},m),d=m.description;d=d.replace(/(\w)(\/)(\w)/g,"$1 $2 $3");h.description=d;if(!m.turnType)m.turnType=g.parseTurnType(m.description);return m},RouteData:function(m){m=T5.ex({geometry:[],instructions:[],boundingBox:null},
m);if(!m.boundingBox)m.boundingBox=T5.Geo.B.forPositions(m.geometry);return T5.ex({getInstructionPositions:function(){for(var h=[],d=0;d<m.instructions.length;d++)m.instructions[d].position&&h.push(m.instructions[d].position);return h}},m)}};return g}();T5.Geo.Search=function(){return{bestResults:function(g,m){m||(m=20);for(var h=g.length>0?g[0]:null,d=[],b=0;b<g.length;b++)if(h&&g[b]&&h.matchWeight-g[b].matchWeight<=m)d.push(g[b]);else break;return d}}}();
T5.Geo.UI=function(){var g={AnnotationTween:null,GeoTileGrid:function(m){m=T5.ex({grid:null,centerPos:new T5.Geo.Position,centerXY:new T5.Vector,radsPerPixel:0},m);var h=m.radsPerPixel,d=T5.Geo.P.toMercatorPixels(m.centerPos),b=d.x/h-m.centerXY.x>>0,f=d.y/h-m.centerXY.y>>0,e=null,a=T5.ex({},m.grid,{getBoundingBox:function(l,k,p,o){return new T5.Geo.BoundingBox(a.pixelsToPos(new T5.Vector(l,k+o)),a.pixelsToPos(new T5.Vector(l+p,k)))},getGridXYForPosition:function(l){l=new T5.Geo.GeoVector(l);a.syncVectors([l]);
return l},syncVectors:function(l){for(var k=l.length;k--;)l[k]&&l[k].setRadsPerPixel&&l[k].setRadsPerPixel(h,-b,-e)},getPixelDistance:function(l){return T5.Geo.dist2rad(l)/h>>0},pixelsToPos:function(l){return T5.Geo.P.fromMercatorPixels((b+l.x)*h,(f+a.gridDimensions.height-l.y)*h)}});e=f+a.gridDimensions.height;return a},RouteOverlay:function(m){m=T5.ex({data:null,pixelGeneralization:8,partialDraw:false,strokeStyle:"rgba(0, 51, 119, 0.9)",waypointFillStyle:"#FFFFFF",lineWidth:4,zindex:50},m);var h=
[],d=[],b=new T5.PathLayer(m);(function(){if(m.data&&m.data.instructions){for(var f=m.data.instructions,e=Array(f.length),a=f.length;a--;)e[a]=f[a].position;T5.Geo.P.vectorize(e).bind("complete",function(l,k){d=k})}m.data&&m.data.geometry&&T5.Geo.P.vectorize(m.data.geometry).bind("complete",function(l,k){h=k;b.updateCoordinates(h,d,true)})})();return b},Poly:function(m,h){h=T5.ex({autoParse:true},h);for(var d=Array(m.length),b=h.autoParse,f=T5.Geo.GeoVector,e=T5.Geo.P.parse,a=m.length;a--;)d[a]=new f(b?
e(m[a]):m[a]);return new T5.Poly(d,h)},Annotation:function(m){m=T5.ex({pos:null},m);m.xy=new T5.Geo.GeoVector(m.pos);return new T5.ImageAnnotation(m)},LocationOverlay:function(m){m=T5.ex({pos:null,accuracy:null,zindex:90},m);var h=new Image,d=new T5.Vector,b=new T5.Vector,f=null;h.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAACIQAAAiEBPhEQkwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAG+SURBVCiRlZHNahNRAIW/O7mTTJPahLZBA1YUyriINRAE3bQIKm40m8K8gLj0CRQkO32ELHUlKbgoIu4EqeJPgtCaoBuNtjXt5LeTMZk0mbmuWiuuPLsD3+HAOUIpxf9IHjWmaUbEyWv5ROrsVULhcHP761rUfnN3Y2Otc8CIg4YT85lzuVsPP+Qupw1vpPjRCvhS9ymvV0e77x7nNj+uvADQAIQQ+uLyvdfLV9JGZi7EdEwQlqBpEJ019f0z1mo2u5Q8DMydv25lshemmj1FueZTawbs7inarqLbV7Qjab1upB9YlhWSAHLavLHZCvg1VEhN0PMU9W7At4bPVidg7CtkLLXkut+lBPD6/Ub155jJiADAHSpaLmx3ApyBQoYEUd0PBoOBkAC6+3llvda/YxgGgYL+UNHf/zN3KiExGlsvTdP0NYDkhPdWrz35ZDsBzV5wCMuQwEyFmXFeeadjzfuFQmGkAZRKpdGC/n7x+M6jqvA9Zo6FWDhlcHE+wqT93J1tP7vpOE7rrx8ALMuasPf8S12St4WmJ6bYWTUC52k8Hm8Vi0X/nwBAPp/XKpWKdF1X2LYdlMvlsToC/QYTls7DLFr/PAAAAABJRU5ErkJggg%3D%3D";
h.onload=function(){d=new T5.Vector(h.width/2,h.height/2)};var e=T5.ex(new T5.ViewLayer(m),{pos:m.pos,accuracy:m.accuracy,drawAccuracyIndicator:false,draw:function(a,l){var k=b.x-l.x,p=b.y-l.y;if(f){a.fillStyle="rgba(30, 30, 30, 0.2)";a.beginPath();a.arc(k,p,f,0,Math.PI*2,false);a.fill()}h.complete&&h.width>0&&a.drawImage(h,k-d.x,p-d.y,h.width,h.height);e.changed()},update:function(a){if(a){f=Math.floor(a.getPixelDistance(e.accuracy)*0.5);b=a.getGridXYForPosition(e.pos);e.changed()}}});e.bind("gridUpdate",
function(a,l){e.update(l)});return e},AnnotationsOverlay:function(m){function h(a,l){var k=a.length,p=e.getParent();if(l=l?l:p?p.getTileLayer():null)for(k=k;k--;)l.syncVectors([a[k].xy]);a.sort(function(o,n){var t=n.xy.y-o.xy.y;if(t===0)t=n.xy.x-o.xy.x;return t})}m=T5.ex({pois:null,map:null,zindex:100},m);var d=[],b=false,f=[],e=T5.ex(new T5.ViewLayer(m),{cycle:function(){return b},draw:function(a,l,k,p,o){b=false;a.fillStyle="rgba(255, 0, 0, 0.75)";a.globalCompositeOperation="source-over";for(k=
d.length;k--;){d[k].draw(a,l,p,e,o);b=b||d[k].isAnimating()}for(k=f.length;k--;){f[k].draw(a,l,p,e,o);b=b||f[k].isAnimating()}return b?1:0},add:function(a){if(a&&a.length)for(var l=a.length;l--;)f[f.length]=a[l];else if(a)f[f.length]=a;h(f);e.changed()},clear:function(a){f=[];h(f);if(a){d=[];h(d)}e.changed()}});COG.listen("geo.pois-updated",function(a){if(m.pois&&m.pois.id==a.srcID){a=a.pois;try{d=[];for(var l=0;l<a.length;l++)if(a[l].pos){var k;var p=a[l];if(p&&p.pos){var o={poi:p,annotation:null};
m.map&&m.map.trigger("getAnnotationForPOI",o);if(!o.annotation)o.annotation=new T5.Annotation({xy:new T5.Geo.GeoVector(p.pos)});if(o.annotation){o.annotation.isNew=p.isNew;p.isNew=false}k=o.annotation}else k=void 0;k&&d.push(k)}h(d)}catch(n){COG.Log.exception(n)}e.changed()}});e.bind("gridUpdate",function(a,l){h(d,l);h(f,l);e.changed()});return e}};g.ImageAnnotation=g.Annotation;return g}();
T5.Geo.Routing.TurnTypeRules=function(){var g=T5.Geo.Routing.TurnType,m=[];m.push({regex:/continue/i,turnType:g.Continue});m.push({regex:/(take|bear|turn)(.*?)left/i,customCheck:function(h,d){return/bear/i.test(d[1])?g.TurnLeftSlight:g.TurnLeft}});m.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(h,d){return/bear/i.test(d[1])?g.TurnRightSlight:g.TurnRight}});m.push({regex:/enter\s(roundabout|rotaty)/i,turnType:g.EnterRoundabout});m.push({regex:/take.*?ramp/i,turnType:g.Ramp});m.push({regex:/take.*?exit/i,
turnType:g.RampExit});m.push({regex:/make(.*?)u\-turn/i,customCheck:function(h,d){return/right/i.test(d[1])?g.UTurnRight:g.UTurnLeft}});m.push({regex:/proceed/i,turnType:g.Start});m.push({regex:/arrive/i,turnType:g.Arrive});m.push({regex:/fell\sthrough/i,turnType:g.Merge});return m}();
