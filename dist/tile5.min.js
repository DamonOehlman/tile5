COG=typeof COG!=="undefined"?COG:{};COG.extend=function(){for(var Y=arguments[0]||{},ma,J=1,F=arguments.length;J<F;J++)if((ma=arguments[J])!==null)for(var q in ma){var p=ma[q];if(Y!==p)if(p!==undefined)Y[q]=p}return Y};
(function(){var Y=Object.prototype.hasOwnProperty,ma=0,J={};J.toID=function(F){return F.replace(/\s/g,"-")};J.objId=function(F){return(F?F:"obj")+ma++};J.isFunction=function(F){return toString.call(F)==="[object Function]"};J.isArray=function(F){return toString.call(F)==="[object Array]"};J.isPlainObject=function(F){if(!F||toString.call(F)!=="[object Object]"||F.nodeType||F.setInterval)return false;if(F.constructor&&!Y.call(F,"constructor")&&!Y.call(F.constructor.prototype,"isPrototypeOf"))return false;
var q;for(q in F);return q===undefined||Y.call(F,q)};J.isEmptyObject=function(F){for(var q in F)return false;return true};J.isXmlDocument=function(F){return toString.call(F)==="[object Document]"};J.contains=function(F,q){var p=F,E=arguments,C=1;if(q&&module.isArray(q)){E=q;C=0}for(C=C;C<E;C++)p=p&&typeof foo[E[C]]!=="undefined";return p};J.formatStr=function(F){if(arguments.length<=1)return F;for(var q=arguments.length-2,p=0;p<=q;p++)F=F.replace(RegExp("\\{"+p+"\\}","gi"),arguments[p+1]);return F};
J.wordExists=function(F,q){var p="";if(q.toString)q=q.toString();for(var E=0;E<q.length;E++)p+=!/\w/.test(q[E])?"\\"+q[E]:q[E];return RegExp("(^|\\s|\\,)"+p+"(\\,|\\s|$)","i").test(F)};COG.extend(COG,J)})();
(function(){function Y(p){return typeof console!=="undefined"?function(){console[p](Array.prototype.slice.call(arguments,0).join(" "));return true}:function(){return false}}var ma=window.console&&window.console.markTimeline,J=Y("error"),F=Y("info"),q=function(){return ma?function(p,E){console.markTimeline(p+(E?": "+((new Date).getTime()-E)+"ms":""))}:function(){}}();COG.extend(COG,{trace:q,debug:Y("debug"),info:F,warn:Y("warn"),error:J,exception:function(p){if(J)for(var E in p)F("ERROR DETAIL: "+
E+": "+p[E])}})})();var FNS_TIME=["webkitAnimationTime","mozAnimationTime","animationTime","webkitAnimationStartTime","mozAnimationStartTime","animationStartTime"],FNS_FRAME=["webkitRequestAnimationFrame","mozRequestAnimationFrame","requestAnimationFrame"],animTime=function(){return(new Date).getTime()},animFrame=function(Y){setTimeout(function(){Y(animTime())},1E3/60)};FNS_TIME.forEach(function(Y){if(Y in window)animTime=function(){return window[Y]}});
FNS_FRAME.forEach(function(Y){if(Y in window)animFrame=function(ma){window[Y](ma)}});COG.animTime=animTime;COG.animFrame=animFrame;
COG.Loopage=function(){function Y(C){return COG.extend({id:q++,frequency:0,after:0,single:false,lastTick:0,execute:function(){}},C)}function ma(C){E.push(C);F||(F=animFrame(J));recalcSleepFrequency=true}function J(){for(var C,da=animTime(),la=p.length;E.length>0;){var xa=E.shift();for(C=la;C--;)if(p[C].id===xa){p.splice(C,1);break}la=p.length}for(C=la;C--;){xa=da-p[C].lastTick;if(p[C].lastTick===0||xa>=p[C].frequency){p[C].execute(da,p[C]);p[C].lastTick=da;p[C].single&&p[C].trigger("complete")}}F=
la?animFrame(J):0}var F=0,q=0,p=[],E=[];return{join:function(C){var da=new Y(C);if(da.after>0)da.lastTick=(new Date).getTime()+da.after;COG.observable(da);da.bind("complete",function(){ma(da.id)});p.unshift(da);F||(F=animFrame(J));recalcSleepFrequency=true;return da},leave:ma}}();
(function(){function Y(J,F){var q=J.obsHandlers;q[F]||(q[F]=[]);return q[F]}var ma=0;COG.observable=function(J){if(!J)return null;if(!J.obsHandlers)J.obsHandlers={};if(!(J.bind||J.trigger||J.unbind)){J.bind=function(F,q){var p="callback"+ma++;Y(J,F).unshift({fn:q,id:p});return p};J.trigger=function(F){var q=Y(J,F),p={cancel:false,name:F},E;if(!q)return null;E=Array.prototype.slice.call(arguments,1);J.eventInterceptor&&J.eventInterceptor(F,p,E);E.unshift(p);for(var C=q.length;C--&&!p.cancel;)q[C].fn.apply(self,
E);return p};J.unbind=function(F,q){if(typeof F==="undefined")J.obsHandlers={};else for(var p=Y(J,F),E=0;p&&E<p.length;E++)if(p[E].id===q){p.splice(E,1);break}return J}}return J}})();
(function(){function Y(q,p){q[p]||(q[p]=function(E){return q.configure(p,E)})}function ma(q){q.gtConfId="configurable"+F++;q.gtConfig={};q.gtConfigFns=[];return q.gtConfig}var J={},F=0;COG.paramTweaker=function(q,p,E){return function(C,da){if(typeof da!=="undefined"){if(C in q)q[C]=da;E&&C in E&&E[C](C,da)}else return p&&C in p?p[C](C):q[C]}};COG.configurable=function(q,p,E,C){if(q){q.gtConfId||ma(q);var da=q.gtConfId,la=q.gtConfig,xa=q.gtConfigFns;J[da]=q;xa.push(E);for(E=p.length;E--;){la[p[E]]=
true;C&&Y(q,p[E])}if(!q.configure)q.configure=function(Ea,K){if(la[Ea]){for(var H=xa.length;H--;){var I=xa[H](Ea,K);if(typeof I!=="undefined")return I}return J[da]}return null}}}})();
(function(){function Y(q){var p=document.createElement("script"),E=false;p.src=q;p.async=true;p.onload=p.onreadystatechange=function(){if(!E&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){E=true;p.onload=p.onreadystatechange=null;p&&p.parentNode&&p.parentNode.removeChild(p)}};J||(J=document.getElementsByTagName("head")[0]);J.appendChild(p)}var ma=0,J,F=this;COG.jsonp=function(q,p,E){q+=q.indexOf("?")>=0?"&":"?";var C="json"+ ++ma;F[C]=function(da){p(da);F[C]=null;try{delete F[C]}catch(la){}};
Y(q+(E?E:"callback")+"="+C);return C}})();
(function(){function Y(d){if(Ea)return la.length;Ea=true;try{for(var t=0;t<la.length;)if(la[t].isComplete()){la[t].triggerComplete(false);la.splice(t,1)}else{la[t].update(d);t++}}finally{Ea=false}la.length===0&&xa.trigger("complete");return la.length}function ma(){if(!xa){xa=COG.Loopage.join({execute:Y,frequency:20});xa.bind("complete",function(){xa=null})}}var J=1.70158,F=Math.PI/2,q=Math.abs,p=Math.pow,E=Math.sin,C=Math.asin,da=Math.cos,la=[],xa=null,Ea=false,K={linear:function(d,t,v,y){return v*
d/y+t},backin:function(d,t,v,y){return v*(d/=y)*d*((J+1)*d-J)+t},backout:function(d,t,v,y){return v*((d=d/y-1)*d*((J+1)*d+J)+1)+t},backinout:function(d,t,v,y){return(d/=y/2)<1?v/2*d*d*(((J*=1.525)+1)*d-J)+t:v/2*((d-=2)*d*(((J*=1.525)+1)*d+J)+2)+t},bouncein:function(d,t,v,y){return v-K.bounceout(y-d,0,v,y)+t},bounceout:function(d,t,v,y){return(d/=y)<1/2.75?v*7.5625*d*d+t:d<2/2.75?v*(7.5625*(d-=1.5/2.75)*d+0.75)+t:d<2.5/2.75?v*(7.5625*(d-=2.25/2.75)*d+0.9375)+t:v*(7.5625*(d-=2.625/2.75)*d+0.984375)+
t},bounceinout:function(d,t,v,y){return d<y/2?K.bouncein(d*2,0,v,y)/2+t:K.bounceout(d*2-y,0,v,y)/2+v/2+t},cubicin:function(d,t,v,y){return v*(d/=y)*d*d+t},cubicout:function(d,t,v,y){return v*((d=d/y-1)*d*d+1)+t},cubicinout:function(d,t,v,y){if((d/=y/2)<1)return v/2*d*d*d+t;return v/2*((d-=2)*d*d+2)+t},elasticin:function(d,t,v,y,Q,P){if(d==0)return t;if((d/=y)==1)return t+v;P||(P=y*0.3);if(!Q||Q<q(v)){Q=v;v=P/4}else v=P/TWO_PI*C(v/Q);return-(Q*p(2,10*(d-=1))*E((d*y-v)*TWO_PI/P))+t},elasticout:function(d,
t,v,y,Q,P){var aa;if(d==0)return t;if((d/=y)==1)return t+v;P||(P=y*0.3);if(!Q||Q<q(v)){Q=v;aa=P/4}else aa=P/TWO_PI*C(v/Q);return Q*p(2,-10*d)*E((d*y-aa)*TWO_PI/P)+v+t},elasticinout:function(d,t,v,y,Q,P){var aa;if(d==0)return t;if((d/=y/2)==2)return t+v;P||(P=y*0.3*1.5);if(!Q||Q<q(v)){Q=v;aa=P/4}else aa=P/TWO_PI*C(v/Q);if(d<1)return-0.5*Q*p(2,10*(d-=1))*E((d*y-aa)*TWO_PI/P)+t;return Q*p(2,-10*(d-=1))*E((d*y-aa)*TWO_PI/P)*0.5+v+t},quadin:function(d,t,v,y){return v*(d/=y)*d+t},quadout:function(d,t,v,
y){return-v*(d/=y)*(d-2)+t},quadinout:function(d,t,v,y){if((d/=y/2)<1)return v/2*d*d+t;return-v/2*(--d*(d-2)-1)+t},sinein:function(d,t,v,y){return-v*da(d/y*F)+v+t},sineout:function(d,t,v,y){return v*E(d/y*F)+t},sineinout:function(d,t,v,y){return-v/2*(da(Math.PI*d/y)-1)+t}},H=COG.Tween=function(d){d=COG.extend({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:I("sine.out"),complete:null},d);var t=(new Date).getTime(),v=[],y=false,Q=0,P=0,aa={isComplete:function(){return y},
triggerComplete:function(fa){d.complete&&d.complete(fa)},update:function(fa){var ja=d.tweenFn(fa-t,Q,P,d.duration);if(d.target)d.target[d.property]=ja;for(var ga=v.length;ga--;)v[ga](ja,void 0);if(y=t+d.duration<=fa){if(d.target)d.target[d.property]=d.tweenFn(d.duration,Q,P,d.duration);for(fa=v.length;fa--;)v[fa](ja,true)}},requestUpdates:function(fa){v.push(fa)}};Q=d.target&&d.property&&d.target[d.property]?d.target[d.property]:d.startValue;if(typeof d.endValue!=="undefined")P=d.endValue-Q;if(P==
0)y=true;ma();return aa};COG.tweenValue=function(d,t,v,y,Q){function P(ja){var ga=ja-aa,Fa=v(ga,d,fa,y),na=aa+y<=ja;ja=!na;if(Q){ga=Q(Fa,na,ga);ja=typeof ga!="undefined"?ga&&ja:ja}ja&&animFrame(P)}var aa=animTime(),fa=t-d;animFrame(P);return{}};COG.tween=function(d,t,v,y,Q,P){d=new H({target:d,property:t,endValue:v,tweenFn:y,duration:P,complete:Q});la.push(d);return d};COG.endTweens=function(d){if(!Ea){Ea=true;try{for(var t=0;t<la.length;)if(!d||d(la[t])){la[t].triggerComplete(true);la.splice(t,1)}else t++}finally{Ea=
false}}};COG.getTweens=function(){return[].concat(la)};var I=COG.easing=function(d){return K[d.replace(/[\-\_\s\.]/g,"").toLowerCase()]};COG.registerEasingType=function(d,t){K[d.replace(/[\-\_\s\.]/g,"").toLowerCase()]=t}})();
(function(){var Y=/^P(\d+Y)?(\d+M)?(\d+D)?$/,ma=/^(\d+H)?(\d+M)?(\d+S)?$/,J={8601:function(q){q=q.split("T");var p=null;p=null;var E=0,C=0;Y.lastIndex=-1;p=Y.exec(q[0]);E+=p[3]?parseInt(p[3].slice(0,-1),10):0;ma.lastIndex=-1;p=ma.exec(q[1]);C+=p[1]?parseInt(p[1].slice(0,-1),10)*3600:0;C+=p[2]?parseInt(p[2].slice(0,-1),10)*60:0;C+=p[3]?parseInt(p[3].slice(0,-1),10):0;return new F(E,C)}},F=COG.Duration=function(q,p){return{days:q?q:0,seconds:p?p:0}};COG.addDuration=function(){for(var q=new F,p=arguments.length;p--;){q.days+=
arguments[p].days;q.seconds+=arguments[p].seconds}if(q.seconds>=86400){q.days+=~~(q.seconds/86400);q.seconds%=86400}return q};COG.formatDuration=function(q){var p,E,C="";if(q.days)C=q.days+" days ";if(q.seconds){q=q.seconds;if(q>=3600){p=~~(q/3600);q-=p*3600}if(q>=60){E=Math.round(q/60);q-=E*60}if(p)C=C+p+(p>1?" hrs ":" hr ")+(E?(E>10?E:"0"+E)+" min ":"");else if(E)C=C+E+" min";else if(q>0)C=C+(q>10?q:"0"+q)+" sec"}return C};COG.parseDuration=function(q,p){var E=p?J[p]:null;if(E)return E(q);COG.Log.warn("Could not find duration parser for specified format: "+
p);return new F}})();
INTERACT=function(){function Y(K){return function(H,I,d){(d?d:K?document.body:document).addEventListener(H,I,false)}}function ma(K){return function(H,I,d){(d?d:K?document.body:document).removeEventListener(H,I,false)}}function J(K,H,I){(I?I:document).attachEvent("on"+K,H)}function F(K,H,I){(I?I:document).detachEvent("on"+K,H)}function q(K,H){return{x:K?K:0,y:H?H:0,count:1}}function p(K,H){xa.push(COG.extend({handler:null,checks:{},type:K},H))}function E(K){var H=0,I=0;if(K.offsetParent){do{H+=K.offsetLeft;
I+=K.offsetTop;K=K.offsetParent}while(K)}return{x:H,y:I}}function C(K,H){for(var I=K.target?K.target:K.srcElement;I&&I.nodeName&&I.nodeName.toUpperCase()!="CANVAS";)I=I.parentNode;return I&&I===H}function da(K,H){return{x:K.x-(H?H.x:0),y:K.y-(H?H.y:0)}}function la(K){if(K.preventDefault){K.preventDefault();K.stopPropagation()}else K.cancelBubble&&K.cancelBubble()}var xa=[],Ea=function(K,H,I){I=COG.extend({binder:null,unbinder:null,observable:null},I);for(var d=I.observable,t=null,v=[],y=[],Q,P,aa=
{bind:function(){return d.bind.apply(null,arguments)},pannable:function(ja){t=COG.extend({inertia:true},ja);return aa},unbind:function(){d.unbind();for(var ja=0;ja<v.length;ja++)v[ja].unbind();return aa}},fa=0;fa<H.length;fa++)v.push(H[fa](K,d,I));d.bind("pointerDown",function(){COG.info("reset "+y.length+" pan history");y=[];P=Q=0});d.bind("pointerMove",function(ja,ga,Fa,na){if(t){y[y.length]={ticks:(new Date).getTime(),x:na.x,y:na.y};d.trigger("pan",na.x,na.y)}Q+=na.x?na.x:0;P+=na.y?na.y:0});d.bind("pointerUp",
function(ja,ga,Fa){Math.abs(Q)>20||Math.abs(P)>20||d.trigger("tap",ga,Fa)});return aa};p("pointer",{handler:function(K,H,I){function d(G){if(C(G,K))if(ja=Q(G)){K.style.cursor="move";la(G);Ga=G.pageX?G.pageX:G.screenX;N=G.pageY?G.pageY:G.screenY;ga=q(Ga,N);Fa=E(K);H.trigger("pointerDown",ga,da(ga,Fa))}}function t(G){na=G.pageX?G.pageX:G.screenX;Ba=G.pageY?G.pageY:G.screenY;if(C(G,K))P(ja?"pointerMove":"pointerHover")}function v(G){if(ja&&Q(G)){ja=false;if(C(G,K)){K.style.cursor="default";P("pointerUp")}}}
function y(G){if(C(G,K)){var ka;G=G||window.event;if(G.detail)ka=G.axis===2?-G.detail*aa:0;else{ka=G.wheelDeltaY?G.wheelDeltaY:G.wheelDelta;if(window.opera)ka=-ka}if(ka!==0){var ya=q(na,Ba);H.trigger("zoom",ya,da(ya,E(K)),ka/fa,"wheel");la(G);G.returnValue=false}}}function Q(G){G=G||window.event;return(G.which||G.button)==1}function P(G,ka,ya,Ca){ka=typeof ka!="undefined"?ka:na;ya=typeof ya!="undefined"?ya:Ba;var Va=ka-Ga,T=ya-N,$=q(ka,ya);H.trigger(G,$,da($,Fa),q(Va,T));if(typeof Ca=="undefined"||
Ca){Ga=ka;N=ya}}I=COG.extend({},I);var aa=120,fa=aa*8,ja=false,ga,Fa,na,Ba,Ga,N;I.binder("mousedown",d,false);I.binder("mousemove",t,false);I.binder("mouseup",v,false);I.binder("dblclick",function(G){COG.info("captured double click");if(C(G,K)){G=q(G.pageX?G.pageX:G.screenX,G.pageY?G.pageY:G.screenY);COG.info("captured double click + target matched");H.trigger("doubleTap",G,da(G,E(K)))}},false);I.binder("mousewheel",y,document);I.binder("DOMMouseScroll",y,document);return{unbind:function(){I.unbinder("mousedown",
d,false);I.unbinder("mousemove",t,false);I.unbinder("mouseup",v,false);I.unbinder("mousewheel",y,document);I.unbinder("DOMMouseScroll",y,document)}}},checks:{touch:false}});p("pointer",{handler:function(K,H,I){function d(T){if(T.count<2)return 0;var $=T.x-T.next.x;T=T.y-T.next.y;return~~Math.sqrt($*$+T*T)}function t(T,$,ea){$=$?$:0;ea=ea?ea:0;for(var Ka={x:T.x-$,y:T.y-ea,id:T.id,count:T.count},Ha=Ka;T.next;){T=T.next;Ha=Ha.next={x:T.x-$,y:T.y-ea,id:T.id}}return Ka}function v(T,$){var ea=T[$?$:"touches"],
Ka,Ha;if(ea.length===0)return null;Ha=Ka={x:ea[0].pageX,y:ea[0].pageY,id:ea[0].identifier,count:ea.length};for(var Oa=1,Ya=ea.length;Oa<Ya;Oa++)Ha=Ha.next={x:ea[Oa].pageX,y:ea[Oa].pageY,id:ea[Oa].identifier};return Ka}function y(T){if(C(T,K)){Ba=E(K);var $=v(T,"changedTouches"),ea=t($,Ba.x,Ba.y);if(!N){Ga=ga;H.trigger("pointerDown",$,ea)}Ca&&H.trigger("pointerDownMulti",$,ea);N=v(T);if(N.count>1)ka=d(N);Va=1;ya=t(N)}}function Q(T){if(C(T,K)){T.preventDefault();G=v(T);if(Ga==ga)Ga=Math.abs(N.x-G.x)>
fa||Math.abs(N.y-G.y)>fa?ja:ga;if(Ga!=ga){Ga=G.count>1?na:Fa;if(Ga==na)if(N.count===1){N=t(G);ka=d(N)}else{T=d(G);if(Math.abs(ka-T)<aa)Ga=Fa;else{var $;$=G.x;var ea=G.next.x,Ka=G.y,Ha=G.next.y,Oa=Ka<Ha?Ka:Ha;$={x:($<ea?$:ea)+(Math.abs($-ea)>>1),y:Oa+(Math.abs(Ka-Ha)>>1)};T=T/ka;ea=T-Va;H.trigger("zoom",$,da($,Ba),ea,"pinch");Va=T}}Ga==Fa&&H.trigger("pointerMove",G,t(G,Ba.x,Ba.y),q(G.x-ya.x,G.y-ya.y));Ca&&H.trigger("pointerMoveMulti",G,t(G,Ba.x,Ba.y))}ya=t(G)}}function P(T){if(C(T,K)){var $=v(T,"changedTouches"),
ea=t($,Ba.x,Ba.y);G=v(T);if(!G){Ga===ga&&H.trigger("pointerTap",$,ea);H.trigger("pointerUp",$,ea);N=null}Ca&&H.trigger("pointerUpMulti",$,ea)}}I=COG.extend({detailed:false,inertia:false},I);var aa=20,fa=7,ja=0,ga=1,Fa=2,na=3,Ba,Ga,N,G,ka,ya,Ca=I.detailed,Va=1;I.binder("touchstart",y,false);I.binder("touchmove",Q,false);I.binder("touchend",P,false);COG.info("initialized touch handler");return{unbind:function(){I.unbinder("touchstart",y,false);I.unbinder("touchmove",Q,false);I.unbinder("touchend",P,
false)}}},checks:{touch:true}});return{register:p,watch:function(K,H,I){H=COG.extend({bindToBody:false,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},H);capabilities=COG.extend({touch:"ontouchstart"in window},I);if(!H.observable){COG.info("creating observable");H.observable=COG.observable({});globalOpts=H}H.binder=H.isIE?J:Y(H.bindToBody);H.unbinder=H.isIE?F:ma(H.bindToBody);I=H.types;for(var d=capabilities,t=[],v=xa.length;v--;){var y=xa[v],Q=!I||I.indexOf(y.type)>=0,P=true;
for(var aa in y.checks){var fa=y.checks[aa];COG.info("checking "+aa+" capability. require: "+fa+", capability = "+d[aa]);P=P&&fa===d[aa]}if(Q&&P)t[t.length]=y.handler}return new Ea(K,t,H)}}}();
T5=function(){function Y(){return(new Date).getTime()}function ma(){for(;ea.length>0;){var c=ea.shift();document.location=c}$=0}function J(c){for(var r=true,g=Ka.length;g--;)r=r&&c!=Ka[g];return r}function F(c,r){var g=[];for(var b in r)b&&g.push(b+"="+escape(r[b]));return"tile5://"+c+"/"+(g.length>0?"?"+g.join("&"):"")}function q(c,r){J(c)&&COG.info("would push url: "+F(c,r))}function p(c,r){if(J(c)){ea.push(F(c,r));$||($=setTimeout(ma,100))}}function E(c){return function(r,g,b){(b?b:c?document.body:
document).addEventListener(r,g,false)}}function C(c){return function(r,g,b){(b?b:c?document.body:document).removeEventListener(r,g,false)}}function da(c,r,g){(g?g:document).attachEvent("on"+c,r)}function la(c,r,g){(g?g:document).detachEvent("on"+c,r)}function xa(){Ca={base:{name:"Unknown",bindEvent:E(),unbindEvent:C(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:q,targetFps:null},ie:{name:"MSIE",
regex:/msie/i,bindEvent:da,unbindEvent:la,requireFastDraw:false,targetFps:25},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:p,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:p},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:p},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:E(true),unbindEvent:C(true),supportsTouch:true,getScaling:function(){return 1/
window.devicePixelRatio},bridgeNotify:p},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:p}};Va=[Ca.froyo,Ca.android,Ca.ipod,Ca.iphone,Ca.ipad,Ca.ie]}function Ea(){Ca||xa();if(!T){COG.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var c=0;c<Va.length;c++){var r=Va[c];if(r.regex&&r.regex.test(navigator.userAgent)){T=COG.extend({},Ca.base,r);COG.info("PLATFORM DETECTED AS: "+T.name);break}}if(!T){COG.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
T=Ca.base}COG.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return T}function K(c,r){function g(k,u){k=k?Q(y(k,n),e):e;if(k!=b){b=k;c.triggerAll("zoomLevelChange",k,u)}}r=COG.extend({initial:1,minZoom:1,maxZoom:16},r);var b=null,e=r.minZoom,n=r.maxZoom;COG.extend(c,{getZoomLevel:function(){return b},setZoomLevel:g});c.bind("scale",function(k,u,s){k=Math.log(u)/Math.LN2;COG.endTweens(function(o){return o.cancelOnInteract});g(b+k,s);c.updateOffset(s.x*u,s.y*u)})}function H(){for(var c=
0,r=arguments.length;r--;){var g=zb[arguments[r].toUpperCase()];if(g)c|=g}return c}var I=Math.PI*2,d=Math.PI/2,t=Math.abs,v=Math.ceil,y=Math.min,Q=Math.max,P=Math.pow,aa=Math.sqrt,fa=Math.log,ja=Math.round,ga=Math.sin,Fa=Math.asin,na=Math.cos,Ba=Math.atan,Ga=Math.atan2,N=function(){function c(b,e){return g(b.x-e.x,b.y-e.y)}function r(b,e){if(!e)e=b.length;if(e<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var n={edges:Array(e-1),accrued:Array(e-1),total:0},
k=0;k<e-1;k++){var u=c(b[k],b[k+1]);n.edges[k]=aa(u.x*u.x+u.y*u.y);n.accrued[k]=n.total+n.edges[k];n.total+=n.edges[k]}return n}function g(b,e){return{x:b?b:0,y:e?e:0}}return{VECTOR_SIMPLIFICATION:3,SIMPLIFICATION_MIN_VECTORS:25,add:function(){for(var b=0,e=0,n=arguments.length;n--;){b+=arguments[n].x;e+=arguments[n].y}return g(b,e)},absSize:function(b){return Q(t(b.x),t(b.y))},copy:function(b){return b?g(b.x,b.y):null},diff:c,distance:function(b,e){return r(b,e).total},edges:r,equals:function(b,
e){return b.x===e.x&&b.y===e.y},extendBy:function(b,e,n){var k=na(e)*n;e=ga(e)*n;return g(b.x-k,b.y-e)},floor:function(b){for(var e=Array(b.length),n=b.length;n--;)e[n]=g(~~b[n].x,~~b[n].y);return e},getRect:function(b){for(var e,n,k,u,s=b.length;s--;){var o=b[s];e=typeof e==="undefined"||o.x<e?o.x:e;n=typeof n==="undefined"||o.y<n?o.y:n;k=typeof k==="undefined"||o.x>k?o.x:k;u=typeof u==="undefined"||o.y>u?o.y:u}return ka.init(e,n,k,u)},init:g,invert:function(b){return g(-b.x,-b.y)},min:function(b,
e){return g(b.x<e.x?b.x:e.x,b.y<e.y?b.y:e.y)},max:function(b,e){return g(b.x>e.x?b.x:e.x,b.y>e.y?b.y:e.y)},offset:function(b,e,n){return g(b.x+e,b.y+(n?n:e))},simplify:function(b,e){if(!b)return null;e=e?e:N.VECTOR_SIMPLIFICATION;for(var n=[],k=null,u=b.length;u--;){var s=b[u];if(include=!k||u===0||t(s.x-k.x)+t(s.y-k.y)>e){n.unshift(s);k=s}}return n},theta:function(b,e,n){n=Fa((b.y-e.y)/n);return b.x>e.x?n:Math.PI-n},toString:function(b){return b.x+", "+b.y}}}(),G=function(){return{dotProduct:function(c,
r){return c.x*r.x+c.y*r.y}}}(),ka=function(){function c(g){return r(g.x1,g.y1,g.x2,g.y2)}function r(g,b,e,n){g=g?g:0;b=b?b:0;e=typeof e!=="undefined"?e:g;n=typeof n!=="undefined "?n:n;return{x1:g,y1:b,x2:e,y2:n,width:e-g,height:n-b}}return{center:function(g){return N.init(g.x1+g.width/2,g.y1+g.height/2)},copy:c,diagonalSize:function(g){return aa(g.width*g.width+g.height*g.height)},fromCenter:function(g,b,e,n){e=e>>1;n=n>>1;return r(g-e,b-n,g+e,b+n)},init:r,intersect:function(g,b){var e=Q(g.x1,b.x1),
n=Q(g.y1,b.y1),k=y(g.x2,b.x2),u=y(g.y2,b.y2);e=r(e,n,k,u);return e.width>0&&e.height>0?e:null},toString:function(g){return"["+g.x1+", "+g.y1+", "+g.x2+", "+g.y2+"]"},union:function(g,b){if(g.width===0||g.height===0)return c(b);else if(b.width===0||b.height===0)return c(g);else{var e=y(g.x1,b.x1),n=y(g.y1,b.y1),k=Q(g.x2,b.x2),u=Q(g.y2,b.y2);e=r(e,n,k,u);return e.width>0&&e.height>0?e:null}}}}(),ya=function(){return{getAspectRatio:function(c){return c.height!==0?c.width/c.height:1},getCenter:function(c){return N.init(c.width>>
1,c.height>>1)},getSize:function(c){return aa(P(c.width,2)+P(c.height,2))},init:function(c,r){c=c?c:0;return{width:c,height:r?r:c}}}}(),Ca=null,Va=[],T=null,$=0,ea=[],Ka=["view.wake","tile.loaded"],Ha=function(){function c(){var j=Ea().maxImageLoads;if(!j||s.length<j)if(j=u.shift()){s[s.length]=j;j.image.onload=r;j.image.src=j.url;j.requested=T5.ticks()}}function r(){var j=n[this.id],A;if(j&&j.image.complete&&j.image.width>0){j.loaded=true;j.hitCount=1;for(A=s.length;A--;)if(s[A].image.src==this.src){s.splice(A,
1);break}if(j.background||j.postProcess||j.drawBackground||j.customDraw)if(j.image){globalImageData=j;A=b(j.realSize?j.realSize.width:j.image.width,j.realSize?j.realSize.height:j.image.height);var U=A.getContext("2d"),W=j.offset?j.offset:T5.XY.init();j.background&&U.drawImage(j.background,0,0);j.drawBackground&&j.drawBackground(U);j.customDraw?j.customDraw(U,j):U.drawImage(j.image,W.x,W.y);j.postProcess&&j.postProcess(U,j);j.image=A}for(A=j.callbacks.length;A--;)j.callbacks[A]&&j.callbacks[A](this,
false);j.callbacks=[];o[o.length]={url:this.src,created:j.requested};delete n[this.id];c()}}function g(j,A,U){var W=e[j];if(W){W.hitCount++;W.image.complete&&W.image.width>0&&A?A(W.image,true):W.callbacks.push(A)}else{W=COG.extend({url:j,image:new Image,loaded:false,created:T5.ticks(),requested:null,hitCount:0,callbacks:[A]},U);W.image.id="resourceLoaderImage"+k++;e[j]=W;n[W.image.id]=W;u[u.length]=W;c()}return W}function b(j,A){var U=document.createElement("canvas");COG.info("creating new canvas");
U.width=j?j:0;U.height=A?A:0;if(typeof FlashCanvas!="undefined"){document.body.appendChild(U);FlashCanvas.initElement(U)}return U}var e={},n={},k=0,u=[],s=[],o=[],w={avgImageSize:25,loadTimeout:10,cancelLoad:function(){var j;for(j=s.length;j--;)delete e[s[j].url];s=[];for(j=u.length;j--;)delete e[u[j].url];u=[]},get:function(j,A,U){var W=null;W=null;if((W=(W=e[j])?W.image:null)&&(W.getContext||W.complete&&W.width>0))return W;else A&&g(j,A,U);return null},load:g,newCanvas:b,reset:function(){e={}},
stats:function(){return{imageLoadingCount:s.length,queuedImageCount:u.length,imageCacheFullness:0}}};COG.observable(w);return w}(),Oa=function(){var c={};return{init:function(r,g){var b=c[r];if(!b)throw Error("Unable to locate requested generator: "+r);return new b(g)},register:function(r,g){c[r]=g},Template:function(){}}}(),Ya=function(){function c(k,u){e[k]=g(u);return k}function r(k){for(var u in k)c(u,k[u])}function g(k){function u(j){var A=k[j];typeof A!=="undefined"&&o.push(function(U){U[j]=
A})}function s(){o=[];for(var j in k)u(j)}k=COG.extend({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},k);var o=[],w={applyToContext:function(j){for(var A=o.length;A--;)o[A](j)},update:function(j,A){k[j]=A;s()}};s();return w}var b={},e={},n={apply:function(k,u){var s=e[u]?e[u]:e.basic,o;if(k&&k.canvas){o=b[k.canvas.id];b[k.canvas.id]=u}s.applyToContext(k);return o},define:c,
defineMany:r,get:function(k){return e[k]},init:g,load:function(k){COG.jsonp(k,function(u){r(u)})}};r({basic:{lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"},waypoints:{lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"}});return n}(),zb={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,ZOOM:16,FREEZE:128},vb=function(c){function r(D,B,R,Z){La=ib;w(ra-B,ua-R,Z?c.panAnimationEasing:null,Z?c.panAnimationDuration:null);clearTimeout(ha);ha=setTimeout(g,100)}function g(){La=lb;wa()}function b(D,B,R,Z){Wa(y(Q(M+
P(2,Z)-1,0.5),2))}function e(){var D=fa(M)/Math.LN2>>0;if(D!==0){M=P(2,D);D=N.init(jb-(x/M>>0),kb-(a/M>>0));if(!Da.trigger("scale",M,D).cancel){for(var B=S.length;B--;)S[B].trigger("scale",M,D);M=1;La=lb}gb()}wa()}function n(D){D||(D=N.init(x,a));h=N.init(ra,ua);i=N.offset(D,ra,ua);jb=i.x;kb=i.y}function k(D,B){var R,Z;Z=1/M;if(M!==1&&f){R=f.x1+D*Z;Z=f.y1+B*Z}else{R=D+ra;Z=B+ua}return N.init(R,Z)}function u(D,B,R){Za("doubleTap",B,R,k(R.x,R.y));if(c.scalable){COG.endTweens(function(Z){return Z.cancelOnInteract});
Wa(2,R,c.zoomAnimation,null,c.zoomDuration)}}function s(){clearTimeout(X);X=setTimeout(j,250)}function o(D,B,R){Za("tap",B,R,k(R.x,R.y))}function w(D,B,R,Z,oa){function Ma(){$a+=1;if($a>=2){g();oa&&oa()}}var $a=0,Ra=sa?N.offset(sa,-x,-a):null,ab=ta?N.offset(ta,-x,-a):null;if(Ra){D=D<Ra.x?Ra.x:D;B=B<Ra.y?Ra.y:B}if(ab){D=D>ab.x?ab.x:D;B=B>ab.y?ab.y:B}if(R){if((La&ib)===0){COG.tweenValue(ra,D,R,Z,function(cb,mb){ra=cb|0;(mb?Ma:wa)();return!z});COG.tweenValue(ua,B,R,Z,function(cb,mb){ua=cb|0;(mb?Ma:wa)();
return!z});La=ib|nb}}else{ra=D|0;ua=B|0;wa();oa&&oa()}}function j(D,B){var R;if(za){Ia&&Ia.unbind();if(c.autoSize&&za.parentNode){D=za.parentNode.offsetWidth;B=za.parentNode.offsetHeight}try{if(!za.id)za.id=c.id+"_canvas";ba=za.getContext("2d")}catch(Z){COG.exception(Z);throw Error("Could not initialise canvas on specified view element");}if(D&&B&&(qa!==B||Ja!==D)){pa=true;Ja=D;qa=B;x=Ja>>1;a=qa>>1;Da.trigger("resize",Ja,qa);for(R=Aa;R--;)S[R].trigger("resize",Ja,qa)}if(c.interactive){Ia=INTERACT.watch(za).pannable();
U()}for(R=Aa;R--;)S[R].trigger("contextChanged",ba);wa()}}function A(D,B){B.setId(D);B.added=Y();B.bind("remove",function(){Da.removeLayer(D)});B.trigger("contextChanged",ba);B.setParent(Da);S.push(B);S.sort(function(R,Z){var oa=Z.zindex-R.zindex;if(oa===0)oa=Z.added-R.added;return oa});Aa=S.length;return B}function U(){if(Ia){if(c.pannable){Ia.bind("pan",r);Ia.bind("inertiaCancel",function(){wa()})}if(c.scalable){Ia.bind("zoom",b);Ia.bind("doubleTap",u)}Ia.bind("tap",o)}}function W(){var D=bb?ra+
x:ra,B=Sa?ua+a:ua;if(Pa&&Pa>Ja)if(D+Ja>Pa)ra=bb?D-Pa>0?ra-Pa:ra:Pa-Ja;else if(D<0)ra=bb?ra+Pa:0;if(Qa&&Qa>qa)if(B+qa>Qa)ua=Sa?B-Qa>0?ua-Qa:ua:Qa-qa;else if(B<0)ua=Sa?ua+Qa:0}function va(D,B,R,Z){var oa;ka.center(B);var Ma=0;f=ka.copy(B);f.scaleFactor=M;R||ba.clearRect(0,0,Ja,qa);ba.save();try{ba.globalCompositeOperation="source-over";if(M!==1){var $a=f,Ra=1/M;jb=i.x+(ra-h.x);kb=i.y+(ua-h.y);f=$a?ka.fromCenter(jb>>0,kb>>0,$a.width*Ra>>0,$a.height*Ra>>0):void 0;ba.scale(M,M)}ba.translate(-f.x1,-f.y1);
ta=sa=null;if(R){ba.beginPath();for(Ma=Aa;Ma--;)S[Ma].clip&&S[Ma].clip(ba,f,D,Da,Z);ba.closePath();ba.clip()}for(Ma=Aa;Ma--;){oa=S[Ma];var ab=oa.style,cb=ab?Ya.apply(ba,ab):null;if(oa.minXY)sa=sa?N.min(sa,oa.minXY):N.copy(oa.minXY);if(oa.maxXY)ta=ta?N.max(ta,oa.maxXY):N.copy(oa.maxXY);oa.draw(ba,f,D,Da,Z);cb&&Ya.apply(ba,cb)}}finally{ba.restore()}if(m){ba.globalCompositeOperation="source-over";ba.strokeStyle="#f00";ba.beginPath();ba.moveTo(x,0);ba.lineTo(x,qa);ba.moveTo(0,a);ba.lineTo(Ja,a);ba.stroke()}ob=
0;Za("drawComplete",B,Z)}function Ta(D){var B,R=false;if(ob){if(D-ia>Ab){if(M!==1)La|=ub;z=(B=(La&(ub|ib))!==0)&&(La&nb)===0;if(pa&&za){typeof FlashCanvas!="undefined"&&FlashCanvas.initElement(za);za.width=Ja;za.height=qa;za.style.width=Ja+"px";za.style.height=qa+"px";pa=false}if(Pa||Qa)W();db=eb();if(z){COG.endTweens(function(oa){return oa.cancelOnInteract});L=false;if(ca!==0){clearTimeout(ca);ca=0}}for(var Z=Aa;Z--;){if(S[Z].animated)La|=nb;S[Z].cycle(D,db,La);S[Z].shouldDraw(La,db);R=S[Z].clip||
R}va(La,db,pb&&R&&!B,D);D-V>qb&&gb();ia=D}COG.animFrame(Ta)}else hb=false}function wa(){ob+=1;if(!hb){hb=true;COG.animFrame(Ta)}}function eb(){return ka.init(ra,ua,ra+Ja,ua+qa)}function gb(){V=(new Date).getTime();Za("refresh",Da,eb());wa()}function Wa(D,B,R,Z,oa){if(R)COG.tweenValue(M,D,R,oa,function(Ma,$a){M=Ma;if($a){var Ra=ja(fa(M)/Math.LN2);M=P(2,Ra);Z&&Z()}n(B);e()});else{M=D;n(B);e()}return Da}function Za(){for(var D=Da.trigger.apply(null,arguments).cancel,B=S.length;B--;)D=S[B].trigger.apply(null,
arguments).cancel||D;return!D}c=COG.extend({id:COG.objId("view"),container:"",fastDraw:false,inertia:true,idleDelay:100,minRefresh:1E3,pannable:true,clipping:true,scalable:true,interactive:true,panAnimationEasing:COG.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:true,tapExtent:10,mask:true,guides:false,fps:25,zoomAnimation:COG.easing("quad.out"),zoomDuration:300},c);var S=[],Aa=0,za=document.getElementById(c.container),ba=null,Xa=typeof window.attachEvent!=
"undefined",qb=c.minRefresh,ra=0,ua=0,Pa=null,Qa=null,bb=false,Sa=false,pb=c.clipping,db=null,hb=false,f,m=c.guides,l=1,x=0,a=0,h=null,i=null,z=false,L=false,ca=0,ha=0,sa=null,ta=null,V=0,O=0,X=0,M=1,ia=0,pa=false,Ia=null,qa,Ja,Ab=1E3/c.fps|0,ob=0,jb,kb,lb=H("ACTIVE"),ib=H("PAN"),ub=H("ZOOM"),nb=H("ANIMATING"),La=lb,Da={id:c.id,deviceScaling:l,fastDraw:c.fastDraw||Ea().requireFastDraw,getDimensions:function(){return ya.init(Ja,qa)},getLayer:function(D){for(var B=0;B<Aa;B++)if(S[B].getId()==D)return S[B];
return null},setLayer:function(D,B){for(var R=0;R<Aa;R++)if(S[R].getId()===D){S.splice(R,1);break}if(B){A(D,B);B.trigger("refresh",Da,eb())}wa();return B},eachLayer:function(D){for(var B=Aa;B--;)D(S[B])},invalidate:wa,refresh:gb,resetScale:function(){M=1},resize:function(D,B){if(za){c.autoSize=false;if(Ja!==D||qa!==B)j(D,B)}},scale:Wa,triggerAll:Za,removeLayer:function(D){a:{for(var B=Aa;B--;)if(S[B].getId()==D){D=B;break a}D=-1}if(D>=0&&D<Aa){Da.trigger("layerRemoved",S[D]);S.splice(D,1);wa()}Aa=
S.length},getOffset:function(){return N.init(ra,ua)},setMaxOffset:function(D,B,R,Z){Pa=D;Qa=B;bb=typeof R!="undefined"?R:false;Sa=typeof Z!="undefined"?Z:false},getViewRect:eb,updateOffset:w,pan:function(D,B,R,Z,oa){w(ra+D,ua+B,R,Z,oa)}};l=Ea().getScaling();Da.markers=A("markers",new rb);COG.observable(Da);Da.bind("invalidate",function(){wa()});Da.bind("resync",function(){ta=sa=null});COG.configurable(Da,["inertia","container","rotation","tapExtent","scalable","pannable"],COG.paramTweaker(c,null,
{container:function(D,B){za=document.getElementById(B);j()},rotation:function(D,B){O=B}}),true);j();if(c.autoSize)Xa?window.attachEvent("onresize",s):window.addEventListener("resize",s,false);return Da},fb=function(c){c=COG.extend({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:H("ACTIVE","ANIMATING","PAN","ZOOM"),style:null,minXY:null,maxXY:null},c);var r=null,g=false,b=false,e=c.id,n=H("ACTIVE"),k=c.validStates,u=0,s=0,o=COG.extend({addToView:function(w){w.setLayer(e,o)},shouldDraw:function(w){return(w&
k)!==0},clip:null,cycle:function(){},draw:function(){},remove:function(){o.trigger("remove",o)},changed:function(){b=true;r&&r.invalidate()},getId:function(){return e},setId:function(w){e=w},getParent:function(){return r},setParent:function(w){g=(r=w)?r.fastDraw&&displayState!==n:false;o.trigger("parentChange",r)}},c);COG.observable(o);o.bind("drawComplete",function(w,j){b=false;u=j.x1;s=j.y1});o.bind("resync",function(w,j){if(j.syncXY){o.minXY&&j.syncXY(o.minXY);o.maxXY&&j.syncXY(o.maxXY)}});return o},
sb=function(c){function r(s,o,w,j){b=s;e=o;n=w;k=j}c=COG.extend({xy:N.init(),offset:true,tweenIn:null,animationSpeed:null,isNew:true},c);var g=false,b=0,e=0,n=0,k=0,u=COG.extend(c,{isAnimating:function(){return g},draw:function(s,o,w,j,A){if(u.isNew&&c.tweenIn)COG.tweenValue(o.y1-20,u.xy.y,c.tweenIn,c.animationSpeed?c.animationSpeed:250+Math.random()*500,function(U,W){u.xy.y=U|0;g=!W;A.invalidate()});u.drawMarker(s,o,u.xy.x,u.xy.y,w,j,A);u.isNew=false},drawMarker:function(s,o,w,j){s.beginPath();s.arc(w,
j,4,0,Math.PI*2,false);s.fill();r(w-4,j-4,8,8)},hitTest:function(s,o){return s>=b&&s<=b+n&&o>=e&&o<=e+k},updateBounds:r});COG.observable(u);return u},rb=function(c){function r(){g();e.changed();e.trigger("markerUpdate",b)}function g(){var n=e.getParent();if(n&&n.syncXY)for(var k=b.length;k--;)n.syncXY([b[k].xy])}c=COG.extend({zindex:100,style:"basic"},c);var b=[],e=COG.extend(new fb(c),{draw:function(n,k,u,s){for(var o=b.length;o--;)b[o].draw(n,k,u,e,s)},add:function(n){if(n&&typeof n.length!=="undefined")for(var k=
n.length;k--;){if(n[k])b[b.length]=n[k]}else if(n)b[b.length]=n;r()},clear:function(n){if(n)for(var k=0;k<b.length;)if(n(b[k]))b.splice(k,1);else k+=1;else b=[];r()},each:function(n){if(n)for(var k=b.length;k--;)n(b[k])},find:function(n){for(var k=[],u=b.length;u--;)if(!n||n(b[u]))k[k.length]=b[u];return k}});e.bind("tap",function(n,k,u,s){var o=[],w=s.x;s=s.y;for(var j=b.length;j--;)if(b[j].hitTest(w,s))o[o.length]=b[j];if(o.length>0)n.cancel=e.trigger("markerTap",k,u,o).cancel});e.bind("parentChange",
g);e.bind("resync",g);return e},wb=function(c){function r(s,o,w){s.fillStyle="#FFFFFF";s.strokeStyle="#222222";s.beginPath();s.arc(w.x,w.y,4,0,Math.PI*2,false);s.stroke();s.fill()}c=COG.extend({path:[],id:COG.objId("pathAni"),easing:COG.easing("sine.inout"),validStates:H("ACTIVE","PAN","ZOOM"),drawIndicator:null,duration:2E3},c);var g=N.edges(c.path),b,e=null,n=c.drawIndicator?c.drawIndicator:r,k=0,u=COG.extend(new fb(c),{cycle:function(){for(var s=0;s<g.accrued.length&&g.accrued[s]<k;)s++;e=null;
if(s<c.path.length-1){var o=k-(s>0?g.accrued[s-1]:0),w=c.path[s];b=N.theta(w,c.path[s+1],g.edges[s]);e=N.extendBy(w,b,o)}return e},draw:function(s,o){e&&n&&n(s,o,N.init(e.x,e.y),b)}});COG.tweenValue(0,g.total,c.easing,c.duration,function(s,o){k=s;o&&u.remove();u.changed()});return u},xb=function(c){c=COG.extend({style:null,properties:{}},c);return COG.extend(c,{rect:null,draw:function(){},resync:function(){}})},tb=function(c,r){r=COG.extend({fill:false,simplify:false},r);var g=false,b=r.fill,e=r.simplify,
n=H("ZOOM"),k=[],u=COG.extend(new xb(r),{draw:function(s,o,w,j,A,U){if(g){o=true;w=(U&n)!==0;s.beginPath();for(U=k.length;U--;){w=k[U].x;j=k[U].y;if(o){s.moveTo(w,j);o=false}else s.lineTo(w,j);w=true}if(w){b&&s.fill();s.stroke()}}},resync:function(s){u.xy=s.syncXY(c);k=N.floor(e?N.simplify(c):c)}});g=c&&c.length>=2;return u},yb=function(c){function r(n){for(var k=b.length;k--;)b[k].resync(n);b.sort(function(u,s){var o=s.xy.y-u.xy.y;if(o===0)o=s.xy.x-u.xy.y;return o});e.changed()}function g(n,k){k.syncXY&&
r(k)}c=COG.extend({zindex:80},c);var b=[],e=COG.extend(new fb(c),{add:function(n){b[b.length]=n},each:function(n){for(var k=b.length;k--;)n(b[k])},draw:function(n,k,u){var s=k.x1,o=k.y1,w=k.width;k=k.height;for(var j=b.length;j--;){var A=b[j].style;A=A?Ya.apply(n,A):null;b[j].draw(n,s,o,w,k,u);A&&Ya.apply(n,A)}}});e.bind("parentChange",g);e.bind("resync",g);return e},Bb=function(){return{tileSize:256,init:function(c,r,g,b,e){return COG.extend({x:c,y:r,width:g,height:b},e)}}}(),Ua={ex:COG.extend,ticks:Y,
getConfig:Ea,userMessage:function(c,r,g){Ua.trigger("userMessage",c,r,g)},zoomable:K,XY:N,XYRect:ka,Dimensions:ya,Vector:G,D:ya,Images:Ha,Generator:Oa,tween:COG.tween,tweenValue:COG.tweenValue,easing:COG.easing,Tween:COG.Tween,Style:Ya,viewState:H,View:vb,ViewLayer:fb,ImageLayer:function(c,r){function g(o,w,j){for(w=k.length;w--;){var A=k[w],U=A.x,W=A.y,va=ka.init(A.x,A.y,A.x+A.width,A.y+A.height);if(j&&ka.intersect(o,va))(va=Ha.get(A.url,function(){s.changed()},u))&&j(va,U,W,A.width,A.height)}}function b(o){var w=
++n,j=s.getParent();if(e){COG.info("generating: "+ka.toString(o)+", sequence = "+w);e.run(j,o,function(A){if(w==n){k=[].concat(A);j.invalidate()}})}}r=COG.extend({imageLoadArgs:{}},r);var e=c?Oa.init(c,r):null,n=0,k=[],u=r.imageLoadArgs,s=COG.extend(new fb(r),{changeGenerator:function(o,w){e=Oa.init(o,COG.extend({},r,w));k=null;b(s.getParent().getViewRect())},clip:function(o,w,j){g(w,j,function(A,U,W,va,Ta){o.rect(U,W,va,Ta)})},draw:function(o,w,j){g(w,j,function(A,U,W,va,Ta){s.drawImage(o,A,U,W,
va,Ta,w,j)})},drawImage:function(o,w,j,A){w&&o.drawImage(w,j,A,w.width,w.height)}});s.bind("refresh",function(o,w,j){b(j)});s.bind("tap",function(o,w,j,A){o=[];var U=A.x,W=A.y,va,Ta;if(k)for(var wa=k.length;wa--;){va=k[wa];if(Ta=U>=va.x&&U<=va.x+va.width&&W>=va.y&&W<=va.y+va.height)o[o.length]=va}o.length>0&&s.trigger("tapImage",o,w,j,A)});return s},ImageGenerator:function(c){c=COG.extend({relative:false,padding:2},c);c={run:function(){COG.warn("running base generator - this should be overriden")}};
COG.observable(c);return c},Marker:sb,ImageMarker:function(c){c=COG.extend({image:null,imageUrl:null,animatingImage:null,animatingImageUrl:null,imageAnchor:null,rotation:0,scale:1,opacity:1},c);var r=c.imageAnchor?T5.XY.invert(c.imageAnchor):null,g=COG.extend(new sb(c),{drawMarker:function(b,e,n,k){if((e=g.isAnimating()&&g.animatingImage?g.animatingImage:g.image)&&e.width>0){r||(r=N.init(-e.width>>1,-e.height>>1));var u=g.scale,s=n+~~(r.x*u),o=k+~~(r.y*u),w=~~(e.width*u),j=~~(e.height*u);g.updateBounds(s,
o,w,w);if(g.rotation||g.opacity!==1){b.save();try{b.globalAlpha=g.opacity;b.translate(n,k);b.rotate(g.rotation);b.drawImage(e,r.x*u,r.y*u,w,j)}finally{b.restore()}}else b.drawImage(e,s,o,w,j)}}});if(!g.image)g.image=Ha.get(c.imageUrl,function(b){g.image=b});if(!g.animatingImage)g.animatingImage=Ha.get(c.animatingImageUrl,function(b){g.animatingImage=b});return g},MarkerLayer:rb,PathLayer:function(c){function r(){var o=s.getParent();if(o&&o.syncXY){o.syncXY(e);n&&o.syncXY(n);s.trigger("tidy")}}c=COG.extend({style:"waypoints",
pixelGeneralization:8,zindex:50},c);var g=[],b=null,e=[],n=null,k=0,u=[],s=COG.extend(new fb(c),{getAnimation:function(o,w,j,A){var U="pathAnimation"+k++;u.push(U);return new wb({id:U,path:g,zindex:c.zindex+1,easing:o?o:COG.easing("sine.inout"),duration:w?w:5E3,drawIndicator:j,autoCenter:A?A:false})},draw:function(o){var w,j=g.length;o.save();try{Ya.apply(o,c.style);if(j>0){o.beginPath();o.moveTo(g[j-1].x,g[j-1].y);for(w=j;w--;)o.lineTo(g[w].x,g[w].y);o.stroke();if(b){o.fillStyle=c.waypointFillStyle;
for(w=b.length;w--;){o.beginPath();o.arc(b[w].x,b[w].y,2,0,Math.PI*2,false);o.stroke();o.fill()}}}}finally{o.restore()}},updateCoordinates:function(o,w){e=o;n=w;r()}});s.bind("tidy",function(){g=N.simplify(e,c.pixelGeneralization);b=N.simplify(n,c.pixelGeneralization);s.changed(true)});s.bind("resync",r);return s},AnimatedPathLayer:wb,Shape:xb,Arc:function(c,r){r=COG.extend({size:4},r);var g=N.init(),b=COG.extend(r,{draw:function(e){e.beginPath();e.arc(g.x,g.y,b.size,0,Math.PI*2,false);e.fill();e.stroke()},
resync:function(e){e.syncXY([c]);g=N.floor([c])[0]}});COG.info("created arc = ",c);return b},Poly:tb,ShapeLayer:yb,Tiling:Bb};COG.observable(Ua);var Na=Ua.Geo=function(){function c(f){for(var m=null,l=1;!m&&l<arguments.length;l++)m=n(f,arguments[l]);m=m?m:n(f);if(!m)throw Error("Unable to find GEO engine with "+f+" capability");return m}function r(f){f=parseFloat(f)*A;f=ga(f);var m=wa*f;return fa((1+f)/(1-f)*P((1-m)/(1+m),wa))/2}function g(f){return parseFloat(f)*A}function b(f){f=P(Math.E,-f);for(var m=
d-2*Ba(f),l=k(m,f),x=0;x<gb&&t(m-l)>eb;){m=l;l=k(m,f);x++}return l*U}function e(f){return f%360*U}function n(f,m){var l=null;for(var x in Xa)if(m){if(x==m&&Xa[x][f]){l=Xa[x];break}}else if(Xa[x][f]){l=Xa[x];break}return l}function k(f,m){var l=wa*ga(f);return d-2*Ba(m*P((1-l)/(1+l),wa/2))}function u(f,m,l,x){m=o(m);f.add(x.line(m,l));return m.length}function s(f,m,l,x){m=o(m);f.add(x.poly(m,l));return m.length}function o(f){var m=f?f.length:0,l=Array(m);for(m=m;m--;)l[m]=Na.Position.init(f[m][1],
f[m][0]);return Na.Position.vectorize(l,bb)}function w(f,m,l){return new db(f,m,l)}var j=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],A=Math.PI/180,U=180/Math.PI,W=d,va=-W,Ta=-I,wa=0.08181919084262157,eb=1.0E-7,gb=12,Wa=null,Za={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",HWY:"HIGHWAY",MWY:"MOTORWAY"},S=function(){function f(a){return a?l(a.lat,a.lon):null}function m(a){return!a||a.lat===0&&a.lon===0}function l(a,h){return{lat:parseFloat(a?
a:0),lon:parseFloat(h?h:0)}}function x(a){if(a)if(typeof a.lat!=="undefined")return f(a);else{if(a.split)for(var h=[" ",","],i=0;i<h.length;i++){var z=a.split(h[i]);if(z.length===2)return l(z[0],z[1])}}else return l();return null}return{calcDistance:function(a,h){if(m(a)||m(h))return 0;var i=(h.lat-a.lat)*A>>1,z=(h.lon-a.lon)*A>>1;i=ga(i)*ga(i)+na(a.lat*A)*na(h.lat*A)*ga(z)*ga(z);return 6371*2*Ga(aa(i),aa(1-i))},copy:f,empty:m,equal:function(a,h){return a&&h&&a.lat==h.lat&&a.lon==h.lon},fromMercatorPixels:function(a,
h){return l(b(h),e(a))},generalize:function(a,h,i){var z=a.length,L=[],ca=null;i||(i=250);i/=1E3;COG.info("generalizing positions, must include "+h.length+" positions");for(var ha=z;ha--;)if(ha===0)L.unshift(a[ha]);else{var sa=!ca||S.inArray(a[ha],h)?i:S.calcDistance(ca,a[ha]);if(a[ha]&&sa>=i){L.unshift(a[ha]);ca=a[ha]}}COG.info("generalized "+z+" positions into "+L.length+" positions");return L},inArray:function(a,h){for(var i=S.equal,z=h.length;z--;)if(i(a,h[z]))return true;return false},inBounds:function(a,
h){var i=!(S.empty(a)||S.empty(h));return i=(i=i&&a.lat>=h.min.lat&&a.lat<=h.max.lat)&&a.lon>=h.min.lon&&a.lon<=h.max.lon},init:l,offset:function(a,h,i){var z=a.lat*A;a=a.lon*A;h=z+h/6371;i=Fa(ga(i/6371)/na(z));i=a+i;h=(h+d)%Math.PI-d;i%=I;return l(h*U,i*U)},parse:x,parseArray:function(a){var h=a.length,i=Array(h);for(h=h;h--;)i[h]=x(a[h]);return i},toMercatorPixels:function(a){return T5.XY.init(g(a.lon),r(a.lat))},toString:function(a){return a?a.lat+" "+a.lon:""},vectorize:function(a,h){function i(){for(var ha=
0,sa=h.chunkSize,ta=z;ta--;){L[ta]=T5.GeoXY.init(a[ta]);ha+=1;if(ha>sa)break}z=ta;if(z<=0)h.callback&&h.callback(L);else COG.animFrame(i)}var z=a.length,L=Array(z);h=COG.extend({chunkSize:500,async:true,callback:null},h);if(!h.async){for(var ca=z;ca--;)L[ca]=T5.GeoXY.init(a[ca]);return L}COG.animFrame(i);return null}}}(),Aa=function(){function f(a,h,i){var z=T5.XY.init(0,h.lat-a.lat);if(typeof i==="undefined")i=true;z.x=i&&a.lon>h.lon?360-a.lon+h.lon:h.lon-a.lon;return z}function m(a,h){return Aa.init(S.init(a.min.lat-
h,a.min.lon-h%360),S.init(a.max.lat+h,a.max.lon+h%360))}function l(a){var h=f(a.min,a.max);return S.init(a.min.lat+(h.y>>1),a.min.lon+(h.x>>1))}function x(a,h){return{min:S.parse(a),max:S.parse(h)}}return{calcSize:f,createBoundsFromCenter:function(a,h){var i=h/6371,z=a.lat*A,L=a.lon*A,ca=z-i,ha=z+i;if(ca>va&&ha<W){z=Fa(ga(i)/na(z));i=(L-z)%I;L=(L+z)%I}else{ca=Q(ca,va);ha=y(ha,W);i=Ta;L=I}return Aa.init(S.init(ca*U,i*U),S.init(ha*U,L*U))},expand:m,forPositions:function(a,h){var i=null,z=T5.ticks();
h||(h="auto");for(var L=a.length;L--;)if(i){var ca=f(i.min,a[L],false),ha=f(a[L],i.max,false);if(ca.x<0)i.min.lon=a[L].lon;if(ca.y<0)i.min.lat=a[L].lat;if(ha.x<0)i.max.lon=a[L].lon;if(ha.y<0)i.max.lat=a[L].lat}else i=x(a[L],a[L]);if(h){if(h=="auto"){L=f(i.min,i.max);h=Q(L.x,L.y)*0.3}i=m(i,h)}COG.trace("calculated bounds for "+a.length+" positions",z);return i},getCenter:l,getGeoHash:function(a){var h=T5.Geo.GeoHash.encode(a.min.lat,a.min.lon);a=T5.Geo.GeoHash.encode(a.max.lat,a.max.lon);COG.info("min hash = "+
h+", max hash = "+a)},getZoomLevel:function(a,h){var i=l(a);i=y(ja(t(i.lat)*0.05),j.length);var z=j[i],L=f(a.min,a.max);i=v(fa(j[3]*h.height/L.y)/fa(2));z=v(fa(z*h.width/L.x)/fa(2));return y(isNaN(i)?1E3:i,isNaN(z)?1E3:z)},init:x,isEmpty:function(a){return!a||S.empty(a.min)||S.empty(a.max)},toString:function(a){return"min: "+S.toString(a.min)+", max: "+S.toString(a.max)}}}(),za=function(){var f=/^(\d+).*$/,m=/(\d+)\s?\-\s?(\d+)/;return{buildingMatch:function(l,x){f.lastIndex=-1;if(f.test(l))for(var a=
l.replace(f,"$1"),h=x.split(","),i=0;i<h.length;i++){m.lastIndex=-1;if(m.test(h[i])){var z=m.exec(h[i]);if(a>=parseInt(z[1],10)&&a<=parseInt(z[2],10))return true}else if(a==h[i])return true}return false},normalize:function(l){if(!l)return"";l=l.toUpperCase();if(!Wa){var x=[];for(var a in Za)x.push(a);Wa=RegExp("(\\s)("+x.join("|")+")(\\s|$)","i")}Wa.lastIndex=-1;if(x=Wa.exec(l))l=l.replace(Wa,"$1"+Za[x[2]]);return l},toString:function(l){return l.streetDetails+" "+l.location}}}(),ba=Ua.GeoXY=function(){function f(l,
x){if(l.length){for(var a,h,i,z,L=l.length;L--;){f(l[L],x);a=typeof a==="undefined"||l.x<a?l.x:a;h=typeof h==="undefined"||l.y<h?l.y:h;i=typeof i==="undefined"||l.x>i?l.x:i;z=typeof z==="undefined"||l.y>z?l.y:z}return ka.init(a,h,z,z)}else if(l.mercXY){a=l.mercXY;l.x=(a.x+Math.PI)/x|0;l.y=(Math.PI-a.y)/x|0;l.rpp=x}else COG.warn("Attempted to sync an XY composite, not a GeoXY");return l}function m(l,x,a){l.pos=x;l.mercXY=S.toMercatorPixels(x);(a=typeof a!=="undefined"?a:l.rpp)&&f(l,a)}return{init:function(l,
x){var a=N.init();m(a,l,x);return a},sync:f,toPos:function(l,x){x=x?x:self.rpp;return S.fromMercatorPixels(l.x*x-Math.PI,Math.PI-l.y*x)},updatePos:m}}(),Xa={},qb=function(){return{bestResults:function(f,m){m||(m=20);for(var l=f.length>0?f[0]:null,x=[],a=0;a<f.length;a++)if(l&&f[a]&&l.matchWeight-f[a].matchWeight<=m)x.push(f[a]);else break;return x}}}(),ra=function(f){f=COG.extend({id:null,caption:"",resultType:"",data:null,pos:null,matchWeight:0},f);return COG.extend(f,{toString:function(){return f.caption+
(f.matchWeight?" ("+f.matchWeight+")":"")}})},ua=function(){function f(a,h){var i=a.getDimensions();i=new hb({data:h,width:i.width,height:i.height});a.setLayer("route",i)}function m(a){for(var h=l.Unknown,i=x,z=0;z<i.length;z++){i[z].regex.lastIndex=-1;var L=i[z].regex.exec(a);if(L){h=i[z].customCheck?i[z].customCheck(a,L):i[z].turnType;break}}return h}var l={Unknown:"turn-unknown",Start:"turn-none-start",Continue:"turn-none",Arrive:"turn-none-arrive",TurnLeft:"turn-left",TurnLeftSlight:"turn-left-slight",
TurnLeftSharp:"turn-left-sharp",TurnRight:"turn-right",TurnRightSlight:"turn-right-slight",TurnRightSharp:"turn-right-sharp",Merge:"merge",UTurnLeft:"uturn-left",UTurnRight:"uturn-right",EnterRoundabout:"roundabout-enter",Ramp:"ramp",RampExit:"ramp-exit"},x=function(){var a=[];a.push({regex:/continue/i,turnType:l.Continue});a.push({regex:/(take|bear|turn)(.*?)left/i,customCheck:function(h,i){return/bear/i.test(i[1])?l.TurnLeftSlight:l.TurnLeft}});a.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(h,
i){return/bear/i.test(i[1])?l.TurnRightSlight:l.TurnRight}});a.push({regex:/enter\s(roundabout|rotaty)/i,turnType:l.EnterRoundabout});a.push({regex:/take.*?ramp/i,turnType:l.Ramp});a.push({regex:/take.*?exit/i,turnType:l.RampExit});a.push({regex:/make(.*?)u\-turn/i,customCheck:function(h,i){return/right/i.test(i[1])?l.UTurnRight:l.UTurnLeft}});a.push({regex:/proceed/i,turnType:l.Start});a.push({regex:/arrive/i,turnType:l.Arrive});a.push({regex:/fell\sthrough/i,turnType:l.Merge});return a}();return{calculate:function(a){a=
COG.extend({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},a);var h=c("route");h&&h.route(a,function(i){if(a.generalize)i.geometry=S.generalize(i.geometry,i.getInstructionPositions());if(a.map){f(a.map,i);a.autoFit&&a.map.gotoBounds(i.boundingBox)}a.success&&a.success(i)})},createMapOverlay:f,parseTurnType:m,TurnType:l,Instruction:function(a){var h=a=COG.extend({position:null,description:"",distance:0,distanceTotal:0,time:0,timeTotal:0,turnType:null},a),i=
a.description;i=i.replace(/(\w)(\/)(\w)/g,"$1 $2 $3");h.description=i;if(!a.turnType)a.turnType=m(a.description);return a},RouteData:function(a){a=COG.extend({geometry:[],instructions:[],boundingBox:null},a);if(!a.boundingBox)a.boundingBox=Aa.forPositions(a.geometry);return COG.extend({getInstructionPositions:function(){for(var h=[],i=0;i<a.instructions.length;i++)a.instructions[i].position&&h.push(a.instructions[i].position);return h}},a)}}}(),Pa="featurecollection",Qa="feature",bb={async:false},
Sa={processor:null,group:"shapes",layerClass:yb},pb={point:COG.extend({},Sa,{processor:function(f,m,l,x){m=o([m.coordinates],bb);if(m.length>0)if(l=x.marker(m[0],l)){f.add(l);return m.length}},group:"markers",layerClass:rb}),linestring:COG.extend({},Sa,{processor:function(f,m,l,x){m=o(m&&m.coordinates?m.coordinates:[]);return u(f,m,l,x)}}),multilinestring:COG.extend({},Sa,{processor:function(f,m,l,x){m=m&&m.coordinates?m.coordinates:[];for(var a=0,h=m.length;h--;)a+=u(f,m[h],l,x);return a}}),polygon:COG.extend({},
Sa,{processor:function(f,m,l,x){m=m&&m.coordinates?m.coordinates:[];if(m.length>0)return s(f,m[0],l,x);return 0}}),multipolygon:COG.extend({},Sa,{processor:function(f,m,l,x){m=m&&m.coordinates?m.coordinates:[];for(var a=0,h=0;h<m.length;h++)a+=s(f,m[h][0],l,x);return a}})},db=function(f,m,l,x){function a(X,M){var ia=X.processor,pa=ca+X.group,Ia=COG.extend({},X,l,{properties:M.properties});if(ia){var qa=O[pa];if(!qa){qa=new X.layerClass({id:pa});O[pa]=qa}globalLayers=O;return ia(qa,M.data,Ia,x)}return 0}
function h(X,M){var ia=X&&X.type?X.type.toLowerCase():null;return ia&&ia===Qa?h(X.geometry,X.properties):{type:ia,isCollection:ia?ia===Pa:false,definition:pb[ia],data:X,properties:M?M:X.properties}}function i(){var X=0,M=ha;if(!ta){for(;M<sa;M++){var ia=h(L?L(f[M]):f[M]),pa=null;if(ia.isCollection){V+=1;ta=w(ia.data.features,function(Ia){ta=null;for(var qa in Ia)O[qa]=Ia[qa]},{layerPrefix:ca+V+"-"});pa+=1}else if(ia.definition)pa=a(ia.definition,ia);X+=pa?pa:1;if(X>=z)break}ha=M+1;if(ta||ha<sa)COG.animFrame(i);
else m&&m(O)}}l=COG.extend({vectorsPerCycle:Na.VECTORIZE_PER_CYCLE,rowPreParse:null,simplify:false,layerPrefix:"geojson-"},l);x=COG.extend({marker:function(X){return new sb({xy:X})},line:function(X,M){return new tb(X,M)},poly:function(X,M){return new tb(X,COG.extend({fill:true},M))}},x);var z=l.vectorsPerCycle,L=l.rowPreParse,ca=l.layerPrefix,ha=0,sa=0,ta=null,V=0,O={};if(f){if(typeof f.length==="undefined")f=[f];sa=f.length;COG.animFrame(i)}};Ua.GeoJSON={parse:w};Ua.Map=function(f){function m(O){try{var X=
Na.Position.init(O.coords.latitude,O.coords.longitude),M=O.coords.accuracy/1E3;V.trigger("locationUpdate",O,M);if(ha){if(!L){L=new Na.UI.LocationOverlay({pos:X,accuracy:M});L.update(V.getTileLayer());V.setLayer("location",L)}var ia=Na.BoundingBox.createBoundsFromCenter(X,Math.max(M,1));V.gotoBounds(ia)}else{L.pos=X;L.accuracy=M;L.update(V.getTileLayer());a(X,null,COG.easing("sine.out"))}ha=false}catch(pa){COG.exception(pa)}}function l(O){COG.info("caught location tracking error:",O)}function x(O,
X,M){COG.endTweens();V.setZoomLevel(X);a(O,M)}function a(O,X,M,ia){O=ba.init(O,Na.radsPerPixel(V.getZoomLevel()));var pa=V.getDimensions();V.updateOffset(O.x-(pa.width>>1),O.y-(pa.height>>1),M,ia,function(){V.refresh();V.trigger("boundsChange",V.getBoundingBox());X&&X(V)})}f=COG.extend({tapExtent:10,crosshair:false,zoomLevel:0,boundsChangeThreshold:30},f);var h={NONE:0,SINGLE:1,WATCH:2},i=N.init(),z=h.NONE,L=null,ca=0,ha=true,sa=0,ta=f.tapExtent;f.adjustScaleFactor=function(O){return Math.pow(2,(O<
1?Math.floor:Math.ceil)(Math.log(O)))};var V=COG.extend(new vb(f),{getBoundingBox:function(){var O=V.getViewRect();return Na.BoundingBox.init(ba.toPos(N.init(O.x1,O.y2),sa),ba.toPos(N.init(O.x2,O.y1),sa))},getCenterPosition:function(){var O=V.getViewRect();if(O){O=N.init(O.x1+(O.width>>1),O.y1+(O.height>>1));return ba.toPos(O,sa)}return null},gotoBounds:function(O,X){var M=Na.BoundingBox.getZoomLevel(O,V.getDimensions());x(Na.BoundingBox.getCenter(O),M,X)},gotoPosition:x,panToPosition:a,syncXY:function(O){return ba.sync(O,
sa)},locate:function(){V.trackStart(h.SINGLE);setTimeout(V.trackCancel,1E4)},trackStart:function(O){if(navigator.geolocation&&!ca){z=O?O:h.WATCH;ha=true;ca=navigator.geolocation.watchPosition(m,l,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3})}},trackCancel:function(){ca&&navigator.geolocation&&navigator.geolocation.clearWatch(ca);V.removeLayer("location");L=null;z=h.NONE;ca=0},animateRoute:function(O,X,M,ia){var pa=V.getLayer("route");if(pa)(O=pa.getAnimation(O,X,M,ia))&&O.addToView(V)}});
V.bind("pan",function(){z===h.SINGLE&&V.trackCancel()});V.bind("tap",function(O,X,M,ia){var pa=Na.radsPerPixel(V.getZoomLevel());O=ba.toPos(ia,pa);var Ia=ba.toPos(N.offset(ia,-ta,ta),pa);ia=ba.toPos(N.offset(ia,ta,-ta),pa);V.trigger("geotap",X,M,O,Aa.init(Ia,ia))});V.bind("refresh",function(){if(N.absSize(N.diff(i,V.getOffset()))>f.boundsChangeThreshold){i=N.copy(V.getOffset());V.trigger("boundsChange",V.getBoundingBox())}});K(V,f);V.bind("zoomLevelChange",function(O,X){var M;sa=Na.radsPerPixel(X);
M=I/sa|0;V.setMaxOffset(M,M,true,false);Ha.cancelLoad();V.resetScale();V.triggerAll("resync",V);V.refresh()});return V};Ua.GeoShape=function(f,m){m=COG.extend({autoParse:true},m);for(var l=Array(f.length),x=m.autoParse,a=T5.Geo.Position.parse,h=f.length;h--;)l[h]=T5.GeoXY.init(x?a(f[h]):f[h]);return new T5.Poly(l,m)};var hb=Ua.RouteOverlay=function(f){f=COG.extend({data:null,pixelGeneralization:8,partialDraw:false,strokeStyle:"rgba(0, 51, 119, 0.9)",waypointFillStyle:"#FFFFFF",lineWidth:4,zindex:50},
f);var m=[],l=[],x=new T5.PathLayer(f);(function(){if(f.data&&f.data.instructions){for(var a=f.data.instructions,h=Array(a.length),i=a.length;i--;)h[i]=a[i].position;S.vectorize(h,{callback:function(z){l=z}})}f.data&&f.data.geometry&&S.vectorize(f.data.geometry,{callback:function(z){m=z;x.updateCoordinates(m,l,true)}})})();return x};Ua.LocationOverlay=function(f){f=COG.extend({pos:null,accuracy:null,zindex:90},f);var m=new Image,l=T5.XY.init(),x=T5.XY.init(),a=null;m.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAACIQAAAiEBPhEQkwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAG+SURBVCiRlZHNahNRAIW/O7mTTJPahLZBA1YUyriINRAE3bQIKm40m8K8gLj0CRQkO32ELHUlKbgoIu4EqeJPgtCaoBuNtjXt5LeTMZk0mbmuWiuuPLsD3+HAOUIpxf9IHjWmaUbEyWv5ROrsVULhcHP761rUfnN3Y2Otc8CIg4YT85lzuVsPP+Qupw1vpPjRCvhS9ymvV0e77x7nNj+uvADQAIQQ+uLyvdfLV9JGZi7EdEwQlqBpEJ019f0z1mo2u5Q8DMydv25lshemmj1FueZTawbs7inarqLbV7Qjab1upB9YlhWSAHLavLHZCvg1VEhN0PMU9W7At4bPVidg7CtkLLXkut+lBPD6/Ub155jJiADAHSpaLmx3ApyBQoYEUd0PBoOBkAC6+3llvda/YxgGgYL+UNHf/zN3KiExGlsvTdP0NYDkhPdWrz35ZDsBzV5wCMuQwEyFmXFeeadjzfuFQmGkAZRKpdGC/n7x+M6jqvA9Zo6FWDhlcHE+wqT93J1tP7vpOE7rrx8ALMuasPf8S12St4WmJ6bYWTUC52k8Hm8Vi0X/nwBAPp/XKpWKdF1X2LYdlMvlsToC/QYTls7DLFr/PAAAAABJRU5ErkJggg%3D%3D";
m.onload=function(){l=T5.XY.init(m.width>>1,m.height>>1)};var h=COG.extend(new T5.ViewLayer(f),{pos:f.pos,accuracy:f.accuracy,drawAccuracyIndicator:false,draw:function(i,z){var L=x.x-z.x,ca=x.y-z.y;if(a){i.fillStyle="rgba(30, 30, 30, 0.2)";i.beginPath();i.arc(L,ca,a,0,Math.PI*2,false);i.fill()}m.complete&&m.width>0&&i.drawImage(m,L-l.x,ca-l.y,m.width,m.height);h.changed()},update:function(i){if(i){a=i.getPixelDistance(h.accuracy)>>1;x=i.getGridXYForPosition(h.pos);h.changed()}}});h.bind("gridUpdate",
function(i,z){h.update(z)});return h};return{distanceToString:function(f){if(f>1E3)return~~(f/10)/100+" km";return f?f+" m":""},dist2rad:function(f){return f/6371},getEngine:c,lat2pix:r,lon2pix:g,pix2lat:b,pix2lon:e,radsPerPixel:function(f){return I/(256<<f)},Position:S,BoundingBox:Aa,Radius:function(f,m){return{distance:parseInt(f,10),uom:m}},Address:function(f){return f=COG.extend({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},f)},A:za,GeocodeFieldWeights:{streetDetails:50,
location:50},AddressCompareFns:{},Engine:function(f){if(!f.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var m=COG.extend({remove:function(){delete Xa[m.id]}},f);return Xa[m.id]=m},Search:qb,GeoSearchResult:ra,LocationSearch:function(f){function m(i,z){navigator.geolocation.clearWatch(x);x=0;if(a){clearTimeout(a);a=0}z&&z([i],f)}function l(i){COG.info("caught location tracking error:",i)}f=COG.extend({name:"Geolocation Search",requiredAccuracy:null,searchTimeout:5E3,
watch:false},f);var x=0,a=0,h=null;return new T5.Geo.GeoSearchAgent(COG.extend({execute:function(i,z){if(navigator.geolocation&&!x){x=navigator.geolocation.watchPosition(function(L){var ca=S.init(L.coords.latitude,L.coords.longitude);L=new ra({id:1,caption:"Current Location",pos:ca,accuracy:L.coords.accuracy/1E3,matchWeight:100});if(!h||L.accuracy<h.accuracy)h=L;if(!f.requiredAccuracy||h.accuracy<f.requiredAccuracy)m(h,z)},l,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3});if(f.searchTimeout)a=
setTimeout(function(){h&&m(h,z)},f.searchTimeout)}}},f))},Routing:ua}}();return Ua}();
