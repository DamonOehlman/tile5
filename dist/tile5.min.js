if(!this.JSON)this.JSON={};
(function(){function e(k){return k<10?"0"+k:k}function l(k){a.lastIndex=0;return a.test(k)?'"'+k.replace(a,function(n){var p=d[n];return typeof p==="string"?p:"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+k+'"'}function f(k,n){var p,r,B,t,z=g,u,s=n[k];if(s&&typeof s==="object"&&typeof s.toJSON==="function")s=s.toJSON(k);if(typeof m==="function")s=m.call(n,k,s);switch(typeof s){case "string":return l(s);case "number":return isFinite(s)?String(s):"null";case "boolean":case "null":return String(s);
case "object":if(!s)return"null";g+=h;u=[];if(Object.prototype.toString.apply(s)==="[object Array]"){t=s.length;for(p=0;p<t;p+=1)u[p]=f(p,s)||"null";B=u.length===0?"[]":g?"[\n"+g+u.join(",\n"+g)+"\n"+z+"]":"["+u.join(",")+"]";g=z;return B}if(m&&typeof m==="object"){t=m.length;for(p=0;p<t;p+=1){r=m[p];if(typeof r==="string")if(B=f(r,s))u.push(l(r)+(g?": ":":")+B)}}else for(r in s)if(Object.hasOwnProperty.call(s,r))if(B=f(r,s))u.push(l(r)+(g?": ":":")+B);B=u.length===0?"{}":g?"{\n"+g+u.join(",\n"+g)+
"\n"+z+"}":"{"+u.join(",")+"}";g=z;return B}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
a=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,g,h,d={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},m;if(typeof JSON.stringify!=="function")JSON.stringify=function(k,n,p){var r;h=g="";if(typeof p==="number")for(r=0;r<p;r+=1)h+=" ";else if(typeof p==="string")h=p;if((m=n)&&typeof n!=="function"&&(typeof n!=="object"||typeof n.length!=="number"))throw Error("JSON.stringify");return f("",
{"":k})};if(typeof JSON.parse!=="function")JSON.parse=function(k,n){function p(B,t){var z,u,s=B[t];if(s&&typeof s==="object")for(z in s)if(Object.hasOwnProperty.call(s,z)){u=p(s,z);if(u!==undefined)s[z]=u;else delete s[z]}return n.call(B,t,s)}var r;k=String(k);b.lastIndex=0;if(b.test(k))k=k.replace(b,function(B){return"\\u"+("0000"+B.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(k.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){r=eval("("+k+")");return typeof n==="function"?p({"":r},""):r}throw new SyntaxError("JSON.parse");}})();
GT=function(){var e=/\$\{(.*?)\}/ig,l=Object.prototype.hasOwnProperty,f=0,b={id:"GRUNT.core",extend:function(){var a=arguments[0]||{},g=1,h=arguments.length,d=false,m,k,n,p;if(typeof a==="boolean"){d=a;a=arguments[1]||{};g=2}if(typeof a!=="object"&&!b.isFunction(a))a={};if(h===g){a=this;--g}for(;g<h;g++)if((m=arguments[g])!=null)for(k in m){n=a[k];p=m[k];if(a!==p)if(d&&p&&(b.isPlainObject(p)||b.isArray(p))){n=n&&(b.isPlainObject(n)||b.isArray(n))?n:b.isArray(p)?[]:{};a[k]=b.extend(d,n,p)}else if(p!==
undefined)a[k]=p}return a},isFunction:function(a){return toString.call(a)==="[object Function]"},isArray:function(a){return toString.call(a)==="[object Array]"},isPlainObject:function(a){if(!a||toString.call(a)!=="[object Object]"||a.nodeType||a.setInterval)return false;if(a.constructor&&!l.call(a,"constructor")&&!l.call(a.constructor.prototype,"isPrototypeOf"))return false;var g;for(g in a);return g===undefined||l.call(a,g)},isEmptyObject:function(a){for(var g in a)return false;return true},isXmlDocument:function(a){return toString.call(a)===
"[object Document]"},contains:function(a,g){var h=a,d=arguments,m=1;if(g&&b.isArray(g)){d=g;m=0}for(m=m;m<d;m++)h=h&&typeof foo[d[m]]!=="undefined";return h},newModule:function(a){a=b.extend({id:null,requires:[],parent:null},a);if(a.parent)a=b.extend({},a.parent,a);return a},toID:function(a){return a.replace(/\s/g,"-")},objId:function(a){return(a?a:"obj")+f++},formatStr:function(a){if(arguments.length<=1)return a;for(var g=arguments.length-2,h=0;h<=g;h++)a=a.replace(RegExp("\\{"+h+"\\}","gi"),arguments[h+
1]);return a},wordExists:function(a,g){var h="";if(g.toString)g=g.toString();for(var d=0;d<g.length;d++)h+=!/\w/.test(g[d])?"\\"+g[d]:g[d];return RegExp("(^|\\s|\\,)"+h+"(\\,|\\s|$)","i").test(a)},parseTemplate:function(a,g){for(var h=e.exec(a);h;){a=a.replace(h[0],GT.XPath.first(h[1],g));e.lastIndex=0;h=e.exec(a)}return a}};return b}();
GT.Log=function(){function e(g,h){var d,m=h&&h.length>0?h[0]:"";for(d=1;h&&d<h.length;d++)m+=" "+(f&&GT.isPlainObject(h[d])?JSON.stringify(h[d]):h[d]);typeof console!=="undefined"&&console[g](m);for(d=0;d<l.length;d++)l[d].call(a,m,g)}var l=[],f=typeof JSON!=="undefined",b=window.console&&window.console.markTimeline,a={id:"GRUNT.log",getTraceTicks:function(){return b?(new Date).getTime():null},trace:function(g,h){if(b)console.markTimeline(g+(h?": "+(a.getTraceTicks()-h)+"ms":""))},debug:function(){e("debug",
arguments)},info:function(){e("info",arguments)},warn:function(){e("warn",arguments)},error:function(){e("error",arguments)},exception:function(g){a.error(arguments);for(var h in g)a.info("ERROR DETAIL: "+h+": "+g[h])},watch:function(g,h){try{h()}catch(d){a.exception(d,g)}},throwError:function(g){a.error(g);throw Error(g);},requestUpdates:function(g){l.push(g)}};return a}();
(function(){function e(f,b){var a=f.split("|"),g={};for(var h in b){var d=b[h];g[h]=a.length>d?a[d]:null}return g}var l={JSON:{parse:function(f){return JSON.parse(f)}},PDON:{parse:function(f){var b=null,a=[];f=f.split("\n");for(var g=0;g<f.length;g++){var h=f[g];if(b)a.push(e(h,b));else if(h){b=h.split("|");h={};for(var d=0;d<b.length;d++)h[b[d]]=d;b=h}else b=null}return a}}};GT.parseData=function(f,b){b=b?b.toUpperCase():"JSON";if(!l[b])throw Error("Unsupported data format: "+b);try{return l[b].parse(f)}catch(a){GT.Log.exception(a)}return{}}})();
(function(){function e(b,a){b[a]||(b[a]=function(g){return b.configure(a,g)})}function l(b){b.gtConfId=GT.objId("configurable");b.gtConfig={};b.gtConfigFns=[];return b.gtConfig}var f={};GT.paramTweaker=function(b,a,g){return function(h,d){if(typeof d!=="undefined"){if(h in b)b[h]=d;g&&h in g&&g[h](h,d)}else return a&&h in a?a[h](h):b[h]}};GT.configurable=function(b,a,g,h){if(b){b.gtConfId||l(b);var d=b.gtConfId,m=b.gtConfig,k=b.gtConfigFns;f[d]=b;k.push(g);for(g=a.length;g--;){m[a[g]]=true;h&&e(b,
a[g])}if(!b.configure)b.configure=function(n,p){if(m[n]){for(var r=k.length;r--;){var B=k[r](n,p);if(typeof B!=="undefined")return B}return f[d]}return null}}}})();
(function(){function e(a){var g=document.createElement("script"),h=false;g.src=a;g.async=true;g.onload=g.onreadystatechange=function(){if(!h&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){h=true;g.onload=g.onreadystatechange=null;g&&g.parentNode&&g.parentNode.removeChild(g)}};f||(f=document.getElementsByTagName("head")[0]);f.appendChild(g)}var l=0,f,b=this;GT.jsonp=function(a,g,h){a+=a.indexOf("?")>=0?"&":"?";var d="json"+ ++l;b[d]=function(m){g(m);b[d]=null;try{delete b[d]}catch(k){}};
e(a+(h?h:"callback")+"="+d);return d}})();
(function(){function e(d){var m=[],k=function(p,r){r=GT.isFunction(r)?r():r;m[m.length]=encodeURIComponent(p)+"="+encodeURIComponent(r)};if(GT.isArray(d))for(var n=0;n<d.length;n++)k(d[n].name,d[n].value);else for(n in d)k(n,d[n]);return m.join("&").replace(/%20/g,"+")}var l={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},f={JSON:["json"],PDON:["pdon.txt"]},b=["TEXT","STREAM"],a=/^(\w+:)?\/\/([^\/?#]+)/,g={XML:function(d){return d.responseXML},JSON:function(d){return GT.parseData(d.responseText)},
PDON:function(d){return GT.parseData(d.responseText,"PDON")},DEFAULT:function(d){return d.responseText}},h={CONTENT_TYPE:"Content-Type"};GT.xhr=function(d){function m(){if(this.readyState===4){var r=null,B=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(B)if(d.handleResponse)d.handleResponse(this);else{var t=d,z=this.getResponseHeader(h.CONTENT_TYPE),u,s=false;for(u in l)if(z&&z.indexOf(l[u])>=0){s=true;break}z=
!s;for(s=0;s<b.length;s++)z=z||b[s]==u;if(z)b:{z=u;for(var E in f)for(s=0;s<f[E].length;s++)if(RegExp(f[E][s]+"$","i").test(t.url)){u=E;break b}u=z?z:"DEFAULT"}try{r=g[u](this,t)}catch(q){r=g.DEFAULT(this,t)}}else d.error&&d.error(this)}catch(o){GT.Log.exception(o,"PROCESSING AJAX RESPONSE")}B&&r&&d.success&&d.success.call(this,r)}}try{d=GT.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},d);var k=a.exec(d.url),
n=k&&(k[1]&&k[1]!==location.protocol||k[2]!==location.host);if(d.data)d.method="POST";if(d.url){k=null;if(d.xhr)k=d.xhr(d);k||(k=new XMLHttpRequest);k.open(d.method,d.url,d.async);d.data&&k.setRequestHeader("Content-Type",d.contentType);n||k.setRequestHeader("X-Requested-With","XMLHttpRequest");k.onreadystatechange=m;k.send(d.method=="POST"?e(d.data):null)}else GT.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(p){GT.Log.exception(p)}}})();
GT.XPath=function(){function e(a){for(var g=null,h=0;h<l.length;h++)if(g=l[h](a))break;return g}var l=[],f=[null,function(a){return a.numberValue},function(a){return a.stringValue},function(a){return a.booleanValue},null,null,null,null,function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null},function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||GT.Log.warn("No XPATH support");var b={SearchResult:function(a){return{toString:function(){var g=
null;if(a){var h=null;if(a.resultType>=0&&a.resultType<f.length)h=f[a.resultType];if(h)g=h(a)}return g?g:""}}},first:function(a,g){var h=b.SearchResult,d;var m=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!m)m=XPathResult.ANY_TYPE;try{if(GT.isXmlDocument(g))d=g.evaluate(a,g,e,m,null);else{GT.Log.warn("attempted xpath expression: "+a+" on a non-xml document");d=null}}catch(k){GT.Log.warn("invalid xpath expression: "+a+" on node: "+g);d=null}return new h(d)},registerResolver:function(a){l.push(a)}};return b}();
(function(){function e(l,f){var b=l.gtObsHandlers;b[f]||(b[f]=[]);return b[f]}GT.observable=function(l){if(l){if(!l.gtObsHandlers)l.gtObsHandlers={};if(!(l.bind||l.trigger||l.unbind)){l.bind=function(f,b){var a=GT.objId("callback");e(l,f).push({fn:b,id:a});return a};l.trigger=function(f){var b=e(l,f);if(!b)return l;for(var a=b.length;a--;)b[a].fn.apply(self,Array.prototype.slice.call(arguments,1));return l};l.unbind=function(f,b){for(var a=e(l,f),g=0;a&&g<a.length;g++)if(a[g].id===b){a.splice(g,1);
break}return l}}}}})();(function(){var e={},l=[];GT.addPipe=function(f){f("pipe.test",{});l.push(f)};GT.listen=function(f,b){e[f]||(e[f]=[]);b&&e[f].push(b)};GT.say=function(f,b){var a;for(a=l.length;a--;)l[a](f,b);if(e[f])for(a=e[f].length;a--;)e[f][a](b)}})();
GT.Storage=function(){function e(l){if(l&&l=="session")return sessionStorage;return localStorage}return{get:function(l,f){var b=e(f).getItem(l);return/^(\{|\[).*(\}|\])$/.test(b)?JSON.parse(b):b},set:function(l,f,b){f=jQuery.isArray(f)||jQuery.isPlainObject(f)?JSON.stringify(f):f;e(b).setItem(l,f)},remove:function(l,f){e(f).removeItem(l)}}}();
GT.ParseRules=function(){var e=[];return{add:function(l,f){e.push({regex:l,handler:f})},each:function(l,f,b){function a(){g++;b&&g>=e.length&&b(f)}for(var g=0,h=0;h<e.length;h++){var d=e[h].regex,m=e[h].handler,k=false;if(d){d.lastIndex=-1;if((d=d.exec(l))&&m){k=true;m(d,f,a)&&a()}}k||a()}}}};
T5=function(){var e=function(h,d){return{x:h?h:0,y:d?d:0}},l=function(){function h(d){if(!d||d.length<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var m={edges:Array(d.length-1),accrued:Array(d.length-1),total:0},k=l.diff,n=0;n<d.length-1;n++){var p=k(d[n],d[n+1]);m.edges[n]=Math.sqrt(p.x*p.x+p.y*p.y);m.accrued[n]=m.total+m.edges[n];m.total+=m.edges[n]}return m}return{create:function(d,m){return new e(d,m)},add:function(){for(var d=new e,m=arguments.length;m--;){d.x+=
arguments[m].x;d.y+=arguments[m].y}return d},absSize:function(d){return Math.max(Math.abs(d.x),Math.abs(d.y))},diff:function(d,m){return new e(d.x-m.x,d.y-m.y)},copy:function(d){return d?new e(d.x,d.y):null},invert:function(d){return new e(-d.x,-d.y)},offset:function(d,m,k){return new e(d.x+m,d.y+(k?k:m))},edges:h,distance:function(d){return h(d).total},theta:function(d,m,k){k=Math.asin((d.y-m.y)/k);return d.x>m.x?k:Math.PI-k},pointOnEdge:function(d,m,k,n){m=new e(Math.cos(k)*n,Math.sin(k)*n);return new e(d.x-
m.x,d.y-m.y)},getRect:function(d){var m=d.length;if(m>1)return new f(Math.min(d[0].x,d[m-1].x),Math.min(d[0].y,d[m-1].y),Math.abs(d[0].x-d[m-1].x),Math.abs(d[0].y-d[m-1].y))},toString:function(d){return d.x+", "+d.y}}}(),f=function(h,d,m,k){return{origin:new e(h,d),dimensions:new a(m,k)}},b=function(){return{copy:function(h){return h?new f(h.origin.x,h.origin.y,h.dimensions.width,h.dimensions.height):null},getCenter:function(h){return new e(h.origin.x+h.dimensions.width/2,h.origin.y+h.dimensions.height/
2)}}}(),a=function(h,d){return{width:h?h:0,height:d?d:0}},g=function(){return{getAspectRatio:function(h){return h.height!==0?h.width/h.height:1},getCenter:function(h){return new e(h.width/2,h.height/2)},getSize:function(h){return Math.sqrt(Math.pow(h.width,2)+Math.pow(h.height,2))}}}();return{ex:GT.extend,newCanvas:function(h,d){var m=document.createElement("canvas");typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(m);m.width=h?h:0;m.height=d?d:0;return m},time:function(){return(new Date).getTime()},
Vector:e,V:l,Dimensions:a,D:g,Rect:f,R:b}}();
(function(){function e(){for(;n.length>0;){var r=n.shift();document.location=r}k=0}function l(r){for(var B=true,t=p.length;t--;)B=B&&r!=p[t];return B}function f(r,B){var t=[];for(var z in B)z&&t.push(z+"="+escape(B[z]));return"tile5://"+r+"/"+(t.length>0?"?"+t.join("&"):"")}function b(r,B){l(r)&&GT.Log.info("would push url: "+f(r,B))}function a(r,B){if(l(r)){n.push(f(r,B));k||(k=setTimeout(e,100))}}function g(){h={base:{name:"Unknown",eventTarget:document,supportsTouch:"createTouch"in document,imageCacheMaxSize:null,
getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:b,targetFps:null},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:a,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:a},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:a},android:{name:"Android OS <= 2.1",regex:/android/i,eventTarget:document.body,supportsTouch:true,getScaling:function(){return 1/
window.devicePixelRatio},bridgeNotify:a},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:a}};d=[h.froyo,h.android,h.ipod,h.iphone,h.ipad]}var h=null,d=[],m=null,k=0,n=[],p=["view.wake","tile.loaded"];T5.getConfig=function(){h||g();if(!m){GT.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var r=0;r<d.length;r++){var B=d[r];if(B.regex&&B.regex.test(navigator.userAgent)){m=T5.ex({},h.base,B);GT.Log.info("PLATFORM DETECTED AS: "+
m.name);break}}if(!m){GT.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");m=h.base}GT.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return m}})();
T5.Resources=function(){var e="",l={},f={getPath:function(b){return/^(file|https?|\/)/.test(b)?b:e+b},setBasePath:function(b){e=b},loadResource:function(b){b=T5.ex({filename:"",cacheable:true,dataType:null,callback:null},b);var a=function(g){b.callback&&GT.Log.watch("CALLING RESOURCE CALLBACK",function(){b.callback(g)})};b.cacheable&&l[b.filename]?a(l[b.filename]):GT.xhr({url:f.getPath(b.filename),dataType:b.dataType,success:function(g){if(b.cacheable)l[b.filename]=g;a(g)},error:function(g,h,d){GT.Log.error("error loading resource ["+
b.filename+"], error = "+d)}})},loadSnippet:function(b,a){/\.\w+$/.test(b)||(b+=".html");f.loadResource({filename:"snippets/"+b,callback:a,dataType:"html"})}};return f}();
T5.Images=function(){function e(){var t=g[this.id];if(t&&t.image.complete&&t.image.width>0){t.loaded=true;t.hitCount=1;for(var z=m.length;z--;)if(m[z].image.src==this.src){m.splice(z,1);break}if(t.background||t.postProcess)if(t.image){z=T5.newCanvas(t.realSize?t.realSize.width:image.width,t.realSize?t.realSize.height:image.height);var u=z.getContext("2d"),s=t.offset?t.offset:new T5.Vector;t.background&&u.drawImage(t.background,0,0);u.drawImage(t.image,s.x,s.y);t.postProcess&&t.postProcess(u,t);t.image=
z}t.loadCallback&&t.loadCallback(this,false);k.push({url:this.src,created:t.requested});delete g[this.id];l()}}function l(){for(var t=T5.getConfig().maxImageLoads;d.length>0&&(!t||m.length<t);){var z=d.shift();if(z.imageLoader){m.push(z);z.imageLoader(z,e)}}}function f(t){for(var z=null,u=n.length;u--&&!z;)z=n[u](t);return z?z:function(s,E){s.image.onload=E;s.image.src=T5.Resources.getPath(s.url);s.requested=T5.time()}}function b(){r=true;try{var t=Math.floor(k.length/2);if(t>0){k.sort(function(u,
s){return u.created-s.created});for(var z=t;z--;)delete a[k[z].url];k.splice(0,t)}}finally{r=false}GT.say("imagecache.cleared")}var a={},g={},h=0,d=[],m=[],k=[],n=[],p=0,r=false,B={avgImageSize:25,loadTimeout:10,addInterceptor:function(t){n.push(t)},cancelLoad:function(){m=[]},get:function(t){var z=null,u=null;r||(z=a[t]);if((u=z?z.image:null)&&(u.getContext||u.complete&&u.width>0))return u},load:function(t,z,u){var s=a[t];if(s){s.hitCount++;s.image.complete&&z&&z(s.image,true)}else{s=T5.ex({url:t,
image:new Image,loaded:false,imageLoader:f(t),created:T5.time(),requested:null,hitCount:0,loadCallback:z},u);s.image.id="resourceLoaderImage"+h++;a[t]=s;g[s.image.id]=s;d.push(s);l()}return s},stats:function(){return{imageLoadingCount:m.length,queuedImageCount:d.length,imageCacheFullness:p}}};setInterval(function(){for(var t=T5.time(),z=false,u=0,s=T5.getConfig();u<m.length;)if(t-m[u].requested>B.loadTimeout*1E3){m.splice(u,1);z=true}else u++;z&&l();if(s&&s.imageCacheMaxSize){p=k.length*B.avgImageSize/
s.imageCacheMaxSize;p>=1&&b()}},1E3);return B}();
(function(){function e(q,o){var v=q&&q.length>0?q[0]:null;if(v&&o&&o.length>0)return u(v,o[0]);return null}function l(q){q.preventDefault();q.stopPropagation()}function f(q){for(var o=Array(q.length),v=q.length;v--;)o[v]=t(q[v].pageX,q[v].pageY);return o}var b=120,a=100,g=250,h=300,d=5,m=2,k=0,n=1,p=7,r=0,B=0,t=T5.V.create,z=T5.V.distance,u=T5.V.diff,s=function(q){function o(G,N,J,D){var F=Math.asin((G.y-N.y)/J);J=Math.min(Math.floor(J*(ba.duration/D)),ba.max);F=N.x>G.x?F:Math.PI-F;G=t(Math.cos(F)*
-J,Math.sin(F)*J);x("inertiaPan",G.x,G.y)}function v(G,N){var J,D;if(L){J=N-ca;if(J<g){D=z([R[0],G]);D>q.inertiaTrigger&&o(R[0],G,D,J)}}else{W=G;var F=setInterval(function(){J=T5.time()-N;D=z([G,W]);if(J<a&&D>q.inertiaTrigger){clearInterval(F);o(G,W,D,J)}else J>a&&clearInterval(F)},5)}}function w(G){for(var N=[],J=T?-T.offsetLeft:0,D=T?-T.offsetTop:0,F=G.length;F--;)N.push(T5.V.offset(G[F],J,D));return N}function x(){X&&X.trigger.apply(null,arguments)}function A(G){if(G.target&&G.target===T){R=L?
f(G.touches):[t(G.pageX,G.pageY)];$=t();Z=t();Q=true;I=false;ca=T5.time();l(G);G.target.style.cursor="move";x("inertiaCancel");ea=ca;if(G=R.length>0?R[0]:null){x("touchStart",G.x,G.y);if(ea-ha<h)if((G=S?T5.V.diff(R[0],S[0]):null)&&Math.abs(G.x)<q.maxDistDoubleTap&&Math.abs(G.y)<q.maxDistDoubleTap)I=true;Y=k;S=[].concat(R)}else GT.Log.warn("Touch start fired, but no touch vector found")}}function C(G){if(G.target&&G.target===T){W=(L?f(G.touches):[t(G.pageX,G.pageY)])[0];if(Q){L&&l(G);G=L?f(G.touches):
[t(G.pageX,G.pageY)];var N=0;if(G.length>1){if(R.length===1)R=[].concat(G);N=z(R)-z(G)}if(Y===k){var J=e(G,R);if(J&&(Math.abs(J.x)>=p||Math.abs(J.y)>=p))Y=n}if(Y!==k)if(!N||Math.abs(N)<d){if($=e(G,S)){Z.x-=$.x;Z.y-=$.y;V.x-=$.x;V.y-=$.y}if(T5.V.absSize(V)>m){x("pan",V.x,V.y);V=t()}Y=n}else{x("pinchZoom",w(R),w(G));Y=TOUCH_MODE_PINCH}S=[].concat(G)}}}function y(G){if(G.target&&G.target===T){var N=(L?f(G.changedTouches):[t(G.pageX,G.pageY)])[0];L&&l(G);var J=T5.time();ha=ea;if(Y===k)K||(K=setTimeout(function(){K=
0;var D=I?"doubleTap":"tap",F=R[0],M=null;if(T)M=T5.V.offset(F,-T.offsetLeft,-T.offsetTop);x(D,F,M)},h+50));else if(Y==n){x("panEnd",Z.x,Z.y);ba&&v(N,J)}else Y==TOUCH_MODE_PINCH&&x("pinchZoomEnd",w(R),w(S),J-ca);G.target.style.cursor="default";Q=false}}function H(G){if(G.target&&G.target===T){var N;if(G.detail){N=-G.detail*b;N=t(G.axis===1?N:0,G.axis===2?N:0)}else N=t(G.wheelDeltaX,G.wheelDeltaY);var J=N.y!==0?Math.abs(N.y/b):0;if(W&&J!==0){var D=T5.V.offset(W,-T.offsetLeft,-T.offsetTop);x("wheelZoom",
D,Math.pow(2,N.y>0?J:-J))}G.preventDefault()}}q=T5.ex({element:null,observable:null,inertiaTrigger:20,maxDistDoubleTap:20,touchStartHandler:null,moveHandler:null,moveEndHandler:null,pinchZoomHandler:null,pinchZoomEndHandler:null,tapHandler:null,doubleTapHandler:null,wheelZoomHandler:null},q);var I=false,K=0,O=T5.getConfig(),L=T5.getConfig().supportsTouch,R=null,S=null,$=null,Z=null,V=t(),Y=null,Q=false,ca=0,aa=[],W=null,ba=null,ea=0,ha=0,T=q.element,X=q.observable,ja={supportsTouch:L,addListeners:function(G){aa.push(G)},
decoupleListeners:function(G){for(var N=0;G&&N<aa.length;N++)if(aa[N].listenerId===G){aa.splice(N,1);break}},release:function(){O.eventTarget.removeEventListener(L?"touchstart":"mousedown",A,false);O.eventTarget.removeEventListener(L?"touchmove":"mousemove",C,false);O.eventTarget.removeEventListener(L?"touchend":"mouseup",y,false);if(!L){window.removeEventListener("mousewheel",H,false);window.removeEventListener("DOMMouseScroll",H,false)}},inertiaEnable:function(G,N){ba={duration:G,max:N?Math.min(N.width,
N.height):500}},inertiaDisable:function(){ba=null}};O.eventTarget.addEventListener(L?"touchstart":"mousedown",A,false);O.eventTarget.addEventListener(L?"touchmove":"mousemove",C,false);O.eventTarget.addEventListener(L?"touchend":"mouseup",y,false);if(!L){window.addEventListener("mousewheel",H,false);window.addEventListener("DOMMouseScroll",H,false)}return ja},E=[];T5.captureTouch=function(q,o){if(!q)throw Error("Unable to capture touch of null element");if(!q.id)q.id="touchable_"+r++;var v=E[q.id];
if(!v){v=new s(T5.ex({element:q},o));E[q.id]=v}o.listenerId&&v.decoupleListeners(o.listenerId);o.listenerId=++B;v.addListeners(o);return v};T5.resetTouch=function(q){if(q&&q.id&&E[q.id]){E[q.id].release();delete E[q.id]}}})();
T5.Dispatcher=function(){var e=[],l={execute:function(f){var b=l.findAction(f);b&&b.execute.apply(b,Array.prototype.slice.call(arguments,1))},findAction:function(f){for(var b=e.length;b--;)if(e[b].id==f)return e[b];return null},getRegisteredActions:function(){return[].concat(e)},getRegisteredActionIds:function(){for(var f=[],b=e.length;b--;)e[b].id&&f.push(e[b].id);return f},registerAction:function(f){f&&f.id&&e.push(f)},Action:function(f){f=T5.ex({autoRegister:true,id:"",title:"",icon:"",execute:null},
f);var b={id:f.id,execute:function(){f.execute&&f.execute.apply(this,arguments)},getParam:function(a){return f[a]?f[a]:""},toString:function(){return GT.formatStr("{0} [title = {1}, icon = {2}]",b.id,f.title,f.icon)}};f.autoRegister&&l.registerAction(b);return b},Agent:function(f){f=GT.extend({name:"Untitled",translator:null,execute:null},f);var b={getName:function(){return f.name},getParam:function(a){return f[a]},getId:function(){return GT.toID(b.getName())},run:function(a,g){if(f.execute){var h=
f.translator?f.translator(a):a;f.execute.call(b,h,function(d,m){g&&g(d,m,h)})}}};return b},runAgents:function(f,b,a){for(var g=0;g<f.length;g++)f[g].run(b,a)}};return l}();
(function(){var e=Math.PI*2,l=Math.PI/2,f=Math.abs,b=Math.pow,a=Math.sin,g=Math.asin,h=Math.cos,d=1.70158,m={linear:function(k,n,p,r){return p*k/r+n},backin:function(k,n,p,r){return p*(k/=r)*k*((d+1)*k-d)+n},backout:function(k,n,p,r){return p*((k=k/r-1)*k*((d+1)*k+d)+1)+n},backinout:function(k,n,p,r){return(k/=r/2)<1?p/2*k*k*(((d*=1.525)+1)*k-d)+n:p/2*((k-=2)*k*(((d*=1.525)+1)*k+d)+2)+n},bouncein:function(k,n,p,r){return p-m.bounceout(r-k,0,p,r)+n},bounceout:function(k,n,p,r){return(k/=r)<1/2.75?
p*7.5625*k*k+n:k<2/2.75?p*(7.5625*(k-=1.5/2.75)*k+0.75)+n:k<2.5/2.75?p*(7.5625*(k-=2.25/2.75)*k+0.9375)+n:p*(7.5625*(k-=2.625/2.75)*k+0.984375)+n},bounceinout:function(k,n,p,r){return k<r/2?m.bouncein(k*2,0,p,r)/2+n:m.bounceout(k*2-r,0,p,r)/2+p/2+n},cubicin:function(k,n,p,r){return p*(k/=r)*k*k+n},cubicout:function(k,n,p,r){return p*((k=k/r-1)*k*k+1)+n},cubicinout:function(k,n,p,r){if((k/=r/2)<1)return p/2*k*k*k+n;return p/2*((k-=2)*k*k+2)+n},elasticin:function(k,n,p,r,B,t){if(k==0)return n;if((k/=
r)==1)return n+p;t||(t=r*0.3);if(!B||B<f(p)){B=p;p=t/4}else p=t/e*g(p/B);return-(B*b(2,10*(k-=1))*a((k*r-p)*e/t))+n},elasticout:function(k,n,p,r,B,t){var z;if(k==0)return n;if((k/=r)==1)return n+p;t||(t=r*0.3);if(!B||B<f(p)){B=p;z=t/4}else z=t/e*g(p/B);return B*b(2,-10*k)*a((k*r-z)*e/t)+p+n},elasticinout:function(k,n,p,r,B,t){var z;if(k==0)return n;if((k/=r/2)==2)return n+p;t||(t=r*0.3*1.5);if(!B||B<f(p)){B=p;z=t/4}else z=t/e*g(p/B);if(k<1)return-0.5*B*b(2,10*(k-=1))*a((k*r-z)*e/t)+n;return B*b(2,
-10*(k-=1))*a((k*r-z)*e/t)*0.5+p+n},quadin:function(k,n,p,r){return p*(k/=r)*k+n},quadout:function(k,n,p,r){return-p*(k/=r)*(k-2)+n},quadinout:function(k,n,p,r){if((k/=r/2)<1)return p/2*k*k+n;return-p/2*(--k*(k-2)-1)+n},sinein:function(k,n,p,r){return-p*h(k/r*l)+p+n},sineout:function(k,n,p,r){return p*a(k/r*l)+n},sineinout:function(k,n,p,r){return-p/2*(h(Math.PI*k/r)-1)+n}};T5.easing=function(k){return m[k.replace(/[\-\_\s\.]/g,"").toLowerCase()]};T5.registerEasingType=function(k,n){m[k.replace(/[\-\_\s\.]/g,
"").toLowerCase()]=n}})();
T5.Tween=function(e){e=T5.ex({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:T5.easing("sine.out"),complete:null,cancelOnInteract:false},e);var l=T5.time(),f=[],b=false,a=0,g=0,h={cancelOnInteract:e.cancelOnInteract,isComplete:function(){return b},triggerComplete:function(d){e.complete&&e.complete(d)},update:function(d){try{var m=e.tweenFn(d-l,a,g,e.duration);if(e.target)e.target[e.property]=m;for(var k=f.length;k--;)f[k](m,void 0);if(b=l+e.duration<=d){if(e.target)e.target[e.property]=
e.tweenFn(e.duration,a,g,e.duration);for(var n=f.length;n--;)f[n](m,true)}}catch(p){GT.Log.exception(p)}},requestUpdates:function(d){f.push(d)}};a=e.target&&e.property&&e.target[e.property]?e.target[e.property]:e.startValue;if(typeof e.endValue!=="undefined")g=e.endValue-a;if(g==0)b=true;T5.wakeTweens();return h};
(function(){var e=[],l=false,f=0;T5.tweenValue=function(b,a,g,h,d){b=new T5.Tween({startValue:b,endValue:a,tweenFn:g,complete:h,duration:d});e.push(b);return b};T5.tween=function(b,a,g,h,d,m){b=new T5.Tween({target:b,property:a,endValue:g,tweenFn:h,duration:m,complete:d});e.push(b);return b};T5.tweenVector=function(b,a,g,h,d,m){var k=[];if(b){var n=b.x==a,p=b.y==g;n||k.push(T5.tween(b,"x",a,h,function(){(n=true)&&p&&d()},m));p||k.push(T5.tween(b,"y",g,h,function(){p=true;n&&p&&d()},m))}return k};
T5.cancelAnimation=function(b){if(!l){l=true;try{for(var a=0;a<e.length;)if(!b||b(e[a])){e[a].triggerComplete(true);e.splice(a,1)}else a++}finally{l=false}}};T5.isTweening=function(){return e.length>0};T5.wakeTweens=function(){if(f===0)f=setInterval(function(){var b;b=T5.time();if(!l){l=true;try{for(var a=0;a<e.length;)if(e[a].isComplete()){e[a].triggerComplete(false);e.splice(a,1)}else{e[a].update(b);a++}}finally{l=false}}b=e.length;if(b===0){clearInterval(f);f=0}},20)}})();
(function(){var e={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,PINCH:16,FREEZE:128};T5.viewState=function(){for(var l=0,f=arguments.length;f--;){var b=e[arguments[f].toUpperCase()];if(b)l|=b}return l}})();
T5.ViewLayer=function(e){e=T5.ex({id:"",zindex:0,supportFastDraw:false,validStates:T5.viewState("ACTIVE","ANIMATING","PAN","PINCH")},e);var l=null,f=e.id,b=T5.viewState("ACTIVE"),a=T5.ex({addToView:function(g){g.setLayer(f,a)},shouldDraw:function(g){var h=l?l.fastDraw&&g!==b:false;return(g&e.validStates)!==0&&(h?e.supportFastDraw:true)},cycle:function(){return 0},draw:function(){},remove:function(){GT.say("layer.remove",{id:f})},wakeParent:function(){l&&l.trigger("wake")},getId:function(){return f},
setId:function(g){f=g},getParent:function(){return l},setParent:function(g){l=g}},e);GT.observable(a);return a};
T5.View=function(e){function l(D,F,M,P){I=typeof M!=="undefined";X=ha;u();J.updateOffset(o.x+D,o.y+F,M,P)}function f(D,F){e.inertia&&l(D,F,e.panAnimationEasing,e.panAnimationDuration)}function b(){X=ea;I=false;setTimeout(u,50)}function a(D,F){V=ja(D);Y=ja(F);var M=G(V.dimensions),P=G(Y.dimensions);W=N(V);y=N(Y);Q=V&&M!==0?P/M:1}function g(D,F){a(D,F);if(Z=Q!==1){X=T;u()}}function h(D,F,M){a(D,F);if(e.adjustScaleFactor){Q=e.adjustScaleFactor(Q);GT.Log.info("scale factor adjusted to: "+Q)}if(M<e.pinchZoomAnimateTrigger){p(ca,
Q,W,r(),T5.easing("sine.out"),function(){m();Q=1},300);Q=ca}else{m();Q=1}}function d(D,F){J.zoom(D,Math.min(Math.pow(2,Math.round(Math.log(F))),8),500)}function m(){Z=false;J.trigger("scale",Q,V?r():y);X=ea;u()}function k(){if(E){T5.resetTouch(E);if(e.autoSize){E.height=window.innerHeight-E.offsetTop;E.width=window.innerWidth-E.offsetLeft}try{q=E.getContext("2d");q.globalCompositeOperation="source-over";q.clearRect(0,0,E.width,E.height)}catch(D){GT.Log.exception(D);throw Error("Could not initialise canvas on specified view element");
}ba=T5.captureTouch(E,{observable:J});e.inertia&&ba.inertiaEnable(e.panAnimationDuration,A);A=J.getDimensions();for(var F=s.length;F--;)layerContextChange(s[F]);u()}}function n(D,F){F.setId(D);F.added=T5.time();F.trigger("contextChanged",q);F.setParent(J);s.push(F);s.sort(function(M,P){var U=P.zindex-M.zindex;if(U===0)U=P.added-M.added;return U})}function p(D,F,M,P,U,da,fa){function ia(){da&&da();m();Q=1;aa=null}Z=true;W=T5.V.copy(M);y=T5.V.copy(P);V=null;if(U)T5.tweenValue(0,F-D,U,ia,fa?fa:1E3).requestUpdates(function(ga){aa=
ga/(F-D);Q=D+ga;X=T;u();J.trigger("animate")});else{Q=targetScaleFactor;ia()}}function r(){var D=T5.D.getCenter(A),F=T5.V.distance([y,D]),M=T5.V.theta(y,D,F),P=T5.V.diff(W,y);D=T5.V.pointOnEdge(y,D,M,F/Q);D.x+=P.x;D.y+=P.y;return D}function B(){J.trigger("idle");H=true;L=0}function t(D,F){var M=0,P=w?T5.viewState("FROZEN"):X,U=T5.time(),da=(P&T)!==0,fa=0;if(v||da){D.clearRect(0,0,E.width,E.height);v=false}if(da){T5.D.getCenter(A);var ia=(aa?aa:1)/2,ga=T5.V.diff(W,y);if(S=V?new T5.Vector(y.x+ga.x,
y.y+ga.y):new T5.Vector(y.x-ga.x*ia,y.y-ga.y*ia))F=T5.V.offset(F,S.x,S.y)}D.save();try{ca=Q;if(x!==1)D.scale(x,x);else if(da){D.translate(y.x,y.y);D.scale(Q,Q)}for(fa=s.length;fa--;)if(s[fa].shouldDraw(P)){var ka=s[fa].draw(D,F,A,P,J);M+=ka?ka:0}}finally{D.restore()}GT.Log.trace("draw complete",U);O=false;return M}function z(){var D=0,F=!I&&(X===T||X===ha);$=T5.time();o.x=Math.floor(o.x);o.y=Math.floor(o.y);if(F){T5.cancelAnimation(function(P){return P.cancelOnInteract});H=false;if(L!==0){clearTimeout(L);
L=0}}for(F=s.length;F--;){var M=s[F].cycle($,o,X);D+=M?M:0}D+=t(q,o);K=0;if(C+D>0)u();else if(!H&&L===0)L=setTimeout(B,500);GT.Log.trace("Completed draw cycle",$)}function u(){C++;if(!(w||K!==0)){C=0;K=setTimeout(z,0)}}e=T5.ex({id:GT.objId("view"),container:"",fastDraw:false,inertia:true,pannable:true,scalable:true,panAnimationEasing:T5.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:false},e);var s=[],E=document.getElementById(e.container),
q=null,o=new T5.Vector,v=false,w=false,x=1,A=null,C=0,y=null,H=false,I=false,K=0,O=false,L=0,R=0,S=null,$=0,Z=false,V=null,Y=null,Q=1,ca=1,aa=null,W=null,ba=null,ea=T5.viewState("ACTIVE"),ha=T5.viewState("PAN"),T=T5.viewState("PINCH"),X=ea,ja=T5.V.getRect,G=T5.D.getSize,N=T5.R.getCenter,J={id:e.id,deviceScaling:x,fastDraw:e.fastDraw||T5.getConfig().requireFastDraw,animate:function(D,F,M,P,U){p(Q,D,F,M,P,U)},centerOn:function(D){J.setOffset(D.x-E.width/2,D.y-E.height/2)},getDimensions:function(){if(E)return new T5.Dimensions(E.width,
E.height)},getZoomCenter:function(){return S},getLayer:function(D){for(var F=0;F<s.length;F++)if(s[F].getId()==D)return s[F];return null},setLayer:function(D,F){for(var M=0;M<s.length;M++)if(s[M].getId()===D){s.splice(M,1);break}F&&n(D,F);u()},eachLayer:function(D){for(var F=0;F<s.length;F++)D(s[F])},clearBackground:function(){v=true},freeze:function(){w=true},unfreeze:function(){w=false;u()},needRepaint:function(){return O},snapshot:function(){},scale:function(D,F,M,P,U){P||(P=T5.D.getCenter(A));
U||(U=T5.D.getCenter(A));J.animate(D,P,U,F,M);return J},removeLayer:function(D){a:{for(var F=s.length;F--;)if(s[F].getId()==D){D=F;break a}D=-1}if(D>=0&&D<s.length){GT.say("layer.removed",{layer:s[D]});s.splice(D,1)}},getOffset:function(){return T5.V.copy(o)},setOffset:function(D,F){o.x=D;o.y=F},updateOffset:function(D,F,M,P,U){function da(){b(0,0);U&&U()}if(M){D=new T5.Vector(D,F);M=T5.tweenVector(o,D.x,D.y,M,da,P);for(P=M.length;P--;){M[P].cancelOnInteract=true;M[P].requestUpdates(u)}}else J.setOffset(D,
F)},zoom:function(D,F,M){I=false;Q=F;Z=Q!==1;W=T5.D.getCenter(J.getDimensions());y=Q>1?T5.V.copy(D):T5.D.getCenter(J.getDimensions());V=null;clearTimeout(R);if(Z){X=T;u();if(M)R=setTimeout(function(){m();Q=1},parseInt(M,10))}}};GT.listen("layer.remove",function(D){D.id&&J.removeLayer(D.id)});x=T5.getConfig().getScaling();GT.observable(J);J.bind("wake",u);J.bind("invalidate",function(){O=true});if(e.pannable){J.bind("pan",l);J.bind("panEnd",b);J.bind("inertiaPan",f);J.bind("inertiaCancel",function(){I=
false;u()})}if(e.scalable){J.bind("pinchZoom",g);J.bind("pinchZoomEnd",h);J.bind("wheelZoom",d)}GT.configurable(J,["inertia","container"],GT.paramTweaker(e,null,{container:function(D,F){E=document.getElementById(F);k()}}),true);k();return J};
T5.AnimatedPathLayer=function(e){function l(d,m,k){d.fillStyle="#FFFFFF";d.strokeStyle="#222222";d.beginPath();d.arc(k.x,k.y,4,0,Math.PI*2,false);d.stroke();d.fill()}e=T5.ex({path:[],id:GT.objId("pathAni"),easing:T5.easing("sine.inout"),validStates:T5.viewState("ACTIVE","PAN","PINCH"),drawIndicator:null,duration:2E3,autoCenter:false},e);var f=T5.V.edges(e.path),b,a=null,g=0;T5.tweenValue(0,f.total,e.easing,function(){h.remove()},e.duration).requestUpdates(function(d,m){g=d;m&&h.remove()});var h=T5.ex(new T5.ViewLayer(e),
{cycle:function(){for(var d=0;d<f.accrued.length&&f.accrued[d]<g;)d++;a=null;if(d<e.path.length-1){var m=g-(d>0?f.accrued[d-1]:0),k=e.path[d],n=e.path[d+1];b=T5.V.theta(k,n,f.edges[d]);a=T5.V.pointOnEdge(k,n,b,m);if(e.autoCenter)(d=h.getParent())&&d.centerOn(a)}return a?1:0},draw:function(d,m){if(a)(e.drawIndicator?e.drawIndicator:l)(d,m,new T5.Vector(a.x-m.x,a.y-m.y),b)}});return h};
(function(){T5.tileSize=256;T5.Tile=function(e){return e=T5.ex({x:0,y:0,gridX:0,gridY:0,dirty:false},e)};T5.ImageTile=function(e){e=T5.ex({url:"",sessionParamRegex:null,loaded:false},e);return new T5.Tile(e)}})();
T5.TileGrid=function(e){function l(w,x){var A=T5.Vector(w*d-n.x,x*d-n.y);return new T5.ImageTile({gridX:A.x,gridY:A.y})}function f(w,x,A,C){var y=Math.floor(e.gridSize*0.2),H=new T5.Vector;if(w<0||w+A>e.gridSize)H.x=w<0?-y:y;if(x<0||x+C>e.gridSize)H.y=x<0?-y:y;return H}function b(w,x,A){var C=GT.Log.getTraceTicks(),y=0,H=e.gridSize,I=e.tileSize;new T5.Vector(H/2,H/2);if(A)g=[];if(w)for(A=0;A<H;A++)for(var K=0;K<H;K++){if(!g[y]){var O=w(K,A,m,H);O.gridX=K*I-n.x;O.gridY=A*I-n.y;g[y]=O}y++}k=w;p=x;GT.Log.trace("tile grid populated",
C);v.dirty=true;v.wakeParent()}function a(w,x){if(o){var A,C=[],y=new T5.Vector(Math.floor((w.x+n.x)*B),Math.floor((w.y+n.y)*B));tilesNeeded=false;for(var H=q;H--;)for(var I=E;I--;){A=I+y.x>=0&&I+y.x<e.gridSize?g[(H+y.y)*e.gridSize+(I+y.x)]:null;var K=new T5.Vector(I-o.x,H-o.y);if(!A){s=f(y.x,y.y,E,q);A=l(I+y.x,H+y.y)}C.push({tile:A,centerness:T5.V.absSize(K)})}C.sort(function(O,L){return L.centerness-O.centerness});z||(z=Array(C.length));for(A=C.length;A--;){z[A]=C[A].tile;v.prepTile(z[A],x)}}}e=
T5.ex({tileSize:T5.tileSize,drawGrid:false,center:new T5.Vector,gridSize:25,shiftOrigin:null,supportFastDraw:true},e);var g=Array(Math.pow(e.gridSize,2)),h=e.gridSize,d=e.tileSize,m=T5.V.offset(e.center,-Math.ceil(e.gridSize>>1)),k=null,n=new T5.Vector,p=null,r=Math.round(e.tileSize/2),B=e.tileSize?1/e.tileSize:0,t=true,z=null,u=false;new T5.Vector;var s=new T5.Vector;T5.getConfig();h=h*e.tileSize;var E,q,o,v=T5.ex(new T5.ViewLayer(e),{gridDimensions:new T5.Dimensions(h,h),dirty:false,cycle:function(w,
x,A){w=0;if(s.x!==0||s.y!==0){var C=s,y=e.shiftOrigin;if(!(C.x===0&&C.y===0)){var H=GT.Log.getTraceTicks(),I=Array(g.length);I.length=g.length;for(var K=0;K<e.gridSize;K++)for(var O=0;O<e.gridSize;O++)I[O*e.gridSize+K]=K+C.x>=0&&K+C.x<e.gridSize?g[(O+C.y)*e.gridSize+(K+C.x)]:null;g=I;m=y?y(m,C):T5.V.add(m,C);n.x+=-C.x*e.tileSize;n.y+=-C.y*e.tileSize;GT.Log.trace("tile storage shifted",H);b(k,p)}s=new T5.Vector;w++}A!==T5.viewState("PINCH")&&a(x,A);return w+v.dirty?1:0},deactivate:function(){t=false},
find:function(w){if(!w)return null;for(var x=g.length;x--;){var A=g[x];if(A&&w(A))return A}return null},prepTile:function(){},drawTile:function(){return false},getTileSize:function(){return e.tileSize},draw:function(w,x,A,C,y){if(t){var H=T5.time(),I=x.x;x=x.y;var K=true,O=y.needRepaint()||C===T5.viewState("PAN")||C===T5.viewState("PINCH")||T5.isTweening();if(!o){E=Math.ceil(A.width*B)+1;q=Math.ceil(A.height*B)+1;o=new T5.Vector(Math.floor((E-1)/2),Math.floor((q-1)/2))}if(z){if(e.drawGrid)w.strokeStyle=
"rgba(50, 50, 50, 0.3)";w.beginPath();for(A=z.length;A--;){var L=z[A];if(L){var R=L.gridX-I,S=L.gridY-x;if(!(O?false:!L.dirty)){K=v.drawTile(w,L,R,S,C)&&K;L.x=R;L.y=S}}else K=false;e.drawGrid&&w.rect(R,S,e.tileSize,e.tileSize)}w.stroke();GT.Log.trace("drawn tiles",H);K&&!u&&y.trigger("tileDrawComplete");u=K;v.dirty=false}}},getTileAtXY:function(w,x){for(var A=e.tileSize,C=z?z.length:0;C--;){var y=z[C];if(y&&w>=y.x&&x>=y.y)if(w<=y.x+A&&x<=y.y+A)return y}return null},getTileVirtualXY:function(w,x,A){w=
T5.V.add(new T5.Vector(w,x),T5.V.invert(m),n);w=new T5.Vector(w.x*e.tileSize,w.y*e.tileSize);if(A){w.x+=r;w.y+=r}return w},populate:function(w){b(w,null,true)}});GT.listen("imagecache.cleared",function(){for(var w=g.length;w--;)if(g[w])g[w].loaded=false});GT.listen("tiler.repaint",function(){for(var w=g.length;w--;)if(g[w]){g[w].x=null;g[w].y=null}});return v};
T5.ImageTileGrid=function(e){function l(){p.getParent().trigger("invalidate");p.dirty=true;p.wakeParent()}e=T5.ex({emptyTile:function(r){if(!f||r!==f.width){f=T5.newCanvas(r,r);r=f.getContext("2d");r.fillStyle="rgba(150, 150, 150, 0.01)";r.fillRect(0,0,f.width,f.height)}return f}(T5.tileSize),panningTile:function(r){function B(){var t=T5.newCanvas(32,32),z=t.getContext("2d");z.fillStyle="#BBBBBB";z.fillRect(0,0,32,32);z.fillStyle="#C3C3C3";z.fillRect(0,0,16,16);z.fillRect(16,16,16,16);return t}if(!b||
r!==b.width){b=T5.newCanvas(r,r);r=b.getContext("2d");r.fillStyle=r.createPattern(B(),"repeat");r.fillRect(0,0,b.width,b.height)}return b}(T5.tileSize),tileOffset:new T5.Vector,tileDrawArgs:{}},e);var f=e.emptyTile,b=e.panningTile,a=T5.viewState("ACTIVE"),g=T5.viewState("PAN"),h=T5.getConfig().requireFastDraw,d=e.tileSize?e.tileSize:T5.tileSize,m=T5.Images.get,k=T5.Images.load,n=T5.ex({background:null,overlay:null,offset:new T5.Vector,realSize:new T5.Dimensions(d,d)},e.tileDrawArgs),p=T5.ex(new T5.TileGrid(e),
{drawTile:function(r,B,t,z,u){var s=B.url?m(B.url):null,E=false;if(s){r.drawImage(s,t,z);B.dirty=false;E=true}else if(u===g)b&&r.drawImage(b,t,z);else f&&r.drawImage(f,t,z);return E},prepTile:function(r,B){if(r)r.dirty=true;if(r&&(!h||B===a))m(r.url)||k(r.url,l,n)}});return p};
T5.Tiler=function(e){e=T5.ex({container:"",drawCenter:false,datasources:{},tileLoadThreshold:"first"},e);var l=T5.ex(new T5.View(e),{getTileLayer:function(){return l.getLayer("grid0")},setTileLayer:function(f){l.setLayer("grid0",f);GT.say("grid.updated",{id:"grid0"})},viewPixToGridPix:function(f){var b=l.getOffset();return new T5.Vector(f.x+b.x,f.y+b.y)},centerOn:function(f,b,a,g){var h=l.getTileLayer(),d=l.getDimensions();(h=h?h.getTileSize():0)&&l.updateOffset(f.gridX-Math.floor((d.width-h)*0.5),
f.gridY-Math.floor((d.height-h)*0.5),b,a,g)},cleanup:function(){l.removeLayer("grid0")},repaint:function(){GT.say("tiler.repaint");l.trigger("wake")},select:function(f){l.trigger("selectTile",f)}});l.bind("tap",function(f,b){var a=l.getTileLayer();if(a)(a=a.getTileAtXY(b.x,b.y))&&l.trigger("selectTile",a)});return l};
T5.Geo=function(){function e(q,o){var v=null;for(var w in s)if(o){if(w==o&&s[w][q]){v=s[w];break}}else if(s[w][q]){v=s[w];break}return v}function l(q,o){var v=m*Math.sin(q);return h-2*Math.atan(o*Math.pow((1-v)/(1+v),m/2))}function f(q,o,v,w){var x=0;q=q.toUpperCase();for(var A in w){var C=o[A];if(C){var y=v[A];C=y?y(q,C):GT.wordExists(q,C)?1:0;x+=C*w[A]}}return x}var b=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],a=Math.PI/180,g=180/Math.PI,h=Math.PI/
2,d=Math.PI*2,m=0.08181919084262157,k=null,n={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",HWY:"HIGHWAY",MWY:"MOTORWAY"},p=function(q,o){return{lat:parseFloat(q?q:0),lon:parseFloat(o?o:0)}},r=function(q,o){return{min:t.parse(q),max:t.parse(o)}},B=function(q){return q=T5.ex({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},q)},t=function(){var q={calcDistance:function(o,v){if(q.empty(o)||q.empty(v))return 0;var w=(v.lat-o.lat)*a/2,x=(v.lon-
o.lon)*a/2;w=Math.sin(w)*Math.sin(w)+Math.cos(o.lat*a)*Math.cos(v.lat*a)*Math.sin(x)*Math.sin(x);return 6371*2*Math.atan2(Math.sqrt(w),Math.sqrt(1-w))},copy:function(o){return o?new p(o.lat,o.lon):null},empty:function(o){return!o||o.lat===0&&o.lon===0},equal:function(o,v){return o&&v&&o.lat==v.lat&&o.lon==v.lon},almostEqual:function(o,v){return o&&v&&Math.floor(o.lat*1E3)===Math.floor(v.lat*1E3)&&Math.floor(o.lon*1E3)===Math.floor(v.lon*1E3)},inArray:function(o,v){for(var w=t.equal,x=v.length;x--;)if(w(o,
v[x]))return true;return false},inBounds:function(o,v){var w=!(t.empty(o)||t.empty(v));return w=(w=w&&o.lat>=v.min.lat&&o.lat<=v.max.lat)&&o.lon>=v.min.lon&&o.lon<=v.max.lon},parse:function(o){if(o)if(typeof o.lat!=="undefined")return q.copy(o);else{if(o.split)for(var v=[" ",","],w=0;w<v.length;w++){var x=o.split(v[w]);if(x.length===2)return new p(x[0],x[1])}}else return new p;return null},parseArray:function(o){var v=o.length,w=Array(v);for(v=v;v--;)w[v]=q.parse(o[v]);GT.Log.info("parsed "+w.length+
" positions");return w},fromMercatorPixels:function(o,v,w){return new p(T5.Geo.pix2lat(v,w),T5.Geo.normalizeLon(T5.Geo.pix2lon(o,w)))},toMercatorPixels:function(o,v){return new T5.Vector(T5.Geo.lon2pix(o.lon,v),T5.Geo.lat2pix(o.lat,v))},generalize:function(o,v,w){var x=o.length,A=[],C=null;w||(w=250);w/=1E3;GT.Log.info("generalizing positions, must include "+v.length+" positions");for(var y=x;y--;)if(y===0)A.unshift(o[y]);else{var H=!C||t.inArray(o[y],v)?w:t.calcDistance(C,o[y]);if(o[y]&&H>=w){A.unshift(o[y]);
C=o[y]}}GT.Log.info("generalized "+x+" positions into "+A.length+" positions");return A},toString:function(o){return o?o.lat+" "+o.lon:""}};return q}(),z=function(){var q=-h,o=h,v=-d,w={calcSize:function(x,A,C){var y=new T5.Vector(0,A.lat-x.lat);if(typeof C==="undefined")C=true;y.x=C&&x.lon>A.lon?360-x.lon+A.lon:A.lon-x.lon;return y},createBoundsFromCenter:function(x,A){var C=A/6371,y=x.lat*a,H=x.lon*a,I=y-C,K=y+C;if(I>q&&K<o){y=Math.asin(Math.sin(C)/Math.cos(y));C=H-y;if(C<v)C+=2*Math.PI;H=H+y;if(H>
d)H-=2*Math.PI}else{I=Math.max(I,q);K=Math.min(K,o);C=v;H=d}return new r(new p(I*g,C*g),new p(K*g,H*g))},expand:function(x,A){return new r(new p(x.min.lat-A,x.min.lon-E.normalizeLon(A)),new p(x.max.lat+A,x.max.lon+E.normalizeLon(A)))},forPositions:function(x,A){var C=null,y=T5.time();A||(A="auto");for(var H=x.length;H--;)if(C){var I=w.calcSize(C.min,x[H],false),K=w.calcSize(x[H],C.max,false);if(I.x<0)C.min.lon=x[H].lon;if(I.y<0)C.min.lat=x[H].lat;if(K.x<0)C.max.lon=x[H].lon;if(K.y<0)C.max.lat=x[H].lat}else C=
new T5.Geo.BoundingBox(x[H],x[H]);if(A){if(A=="auto"){H=w.calcSize(C.min,C.max);A=Math.max(H.x,H.y)*0.3}C=w.expand(C,A)}GT.Log.trace("calculated bounds for "+x.length+" positions",y);return C},getCenter:function(x){var A=z.calcSize(x.min,x.max);return new T5.Geo.Position(x.min.lat+A.y/2,x.min.lon+A.x/2)},getGeoHash:function(x){var A=T5.Geo.GeoHash.encode(x.min.lat,x.min.lon);x=T5.Geo.GeoHash.encode(x.max.lat,x.max.lon);GT.Log.info("min hash = "+A+", max hash = "+x)},getZoomLevel:function(x,A){var C=
w.getCenter(x),y=b[Math.min(Math.round(Math.abs(C.lat)*0.05),b.length)],H=w.calcSize(x.min,x.max);C=Math.ceil(Math.log(b[3]*A.height/H.y)/Math.log(2));y=Math.ceil(Math.log(y*A.width/H.x)/Math.log(2));return Math.min(isNaN(C)?1E3:C,isNaN(y)?1E3:y)},isEmpty:function(x){return!x||t.empty(x.min)||t.empty(x.max)},toString:function(x){return"min: "+t.toString(x.min)+", max: "+t.toString(x.max)}};return w}(),u=function(){var q=/^(\d+).*$/,o=/(\d+)\s?\-\s?(\d+)/;return{buildingMatch:function(v,w){q.lastIndex=
-1;if(q.test(v))for(var x=v.replace(q,"$1"),A=w.split(","),C=0;C<A.length;C++){o.lastIndex=-1;if(o.test(A[C])){var y=o.exec(A[C]);if(x>=parseInt(y[1],10)&&x<=parseInt(y[2],10))return true}else if(x==A[C])return true}return false},normalize:function(v){if(!v)return"";v=v.toUpperCase();if(!k){var w=[];for(var x in n)w.push(x);k=RegExp("(\\s)("+w.join("|")+")(\\s|$)","i")}k.lastIndex=-1;if(w=k.exec(v))v=v.replace(k,"$1"+n[w[2]]);return v},toString:function(v){return v.streetDetails+" "+v.location}}}(),
s={},E={Engine:function(q){if(!q.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var o=T5.ex({remove:function(){delete s[o.id]}},q);return s[o.id]=o},Radius:function(q,o){return{distance:parseInt(q,10),uom:o}},Position:p,BoundingBox:r,Address:B,GeocodeFieldWeights:{streetDetails:50,location:50},AddressCompareFns:{},GeoSearchResult:function(q){q=T5.ex({id:null,caption:"",resultType:"",data:null,pos:null,matchWeight:0},q);return T5.ex(q,{toString:function(){return q.caption+
(q.matchWeight?" ("+q.matchWeight+")":"")}})},GeoSearchAgent:function(q){return new T5.Dispatcher.Agent(q)},GeocodingAgent:function(q){q=T5.ex({name:"Geocoding Search Agent",paramTranslator:null,execute:function(o,v){try{if(!o.reverse&&!o.freeform)address=new B(o);var w=E.getEngine("geocode");if(w)w.geocode({addresses:[o.freeform?o.freeform:address],complete:function(A,C){if(v){var y=C;if(o.freeform)y=E.rankGeocodeResponses(o.freeform,y,E.getEngine("geocode"));v(y,q)}}})}catch(x){GT.Log.exception(x)}}},
q);return new E.GeoSearchAgent(q)},PointOfInterest:function(q){q=T5.ex({id:0,title:"",pos:null,lat:"",lon:"",group:"",retrieved:0,isNew:true},q);if(!q.pos&&q.lat&&q.lon)q.pos=new T5.Geo.Position(q.lat,q.lon);return T5.ex({toString:function(){return q.id+": '"+q.title+"'"}},q)},POIStorage:function(q){function o(y){y=y?y:"default";x[y]||(x[y]=[]);return x[y]}function v(y){var H=[];for(var I in x)for(var K=0;K<x[I].length;K++)if(!y||y(x[I][K]))H.push(x[I][K]);return H}function w(){GT.say("geo.pois-updated",
{srcID:C.id,pois:C.getPOIs()})}q=T5.ex({visibilityChange:null,onPOIDeleted:null,onPOIAdded:null},q);var x={},A=true,C={id:GT.objId(),getPOIs:function(){return v()},getOldPOIs:function(y,H){return v(function(I){return I.group==y&&I.retrieved<H})},getVisible:function(){return A},setVisible:function(y){if(y!=A){A=y;q.visibilityChange&&q.visibilityChange()}},findById:function(y){var H=v(function(I){return I.id==y});return H.length>0?H[0]:null},findByBounds:function(y){return v(function(H){return T5.Geo.P.inBounds(H.pos,
y)})},addPOIs:function(y,H){if(H)x={};for(var I=0;y&&I<y.length;I++){y[I].retrieved=T5.time();var K=y[I];o(K.group).push(K)}},removeGroup:function(y){if(x[y]){delete x[y];w()}},update:function(y){var H=[],I=0,K=y.length>0?y[0].group:"",O=T5.time();for(I=0;I<y.length;I++){var L;a:{if(L=y[I])for(var R=o(L.group),S=0;S<R.length;S++)if(R[S].id==L.id){L=R[S];break a}L=null}if(L){L.retrieved=O;L.isNew=false}else H.push(y[I])}y=C.getOldPOIs(K,O);C.addPOIs(H);for(I=0;q.onPOIAdded&&I<H.length;I++)q.onPOIAdded(H[I]);
for(I=0;I<y.length;I++){q.onPOIDeleted&&q.onPOIDeleted(y[I]);K=y[I];O=o(K.group);for(L=0;L<O.length;L++)if(O[L].id==K.id){O.splice(L,1);break}}H.length+y.length>0&&w()}};return C},MapProvider:function(){var q=1,o=20;return{zoomLevel:0,checkZoomLevel:function(v){return Math.min(Math.max(v,q),o)},getCopyright:function(){},getLogoUrl:function(){},getMapTiles:function(){},getZoomRange:function(){return{min:q,max:o}},setZoomRange:function(v,w){q=v;o=w}}},getEngine:function(q){for(var o=null,v=1;!o&&v<
arguments.length;v++)o=e(q,arguments[v]);o=o?o:e(q);if(!o)throw Error("Unable to find GEO engine with "+q+" capability");return o},rankGeocodeResponses:function(q,o,v){var w=[],x=E.AddressCompareFns;if(v&&v.compareFns)x=T5.ex({},x,v.compareFns);for(v=0;v<o.length;v++)w.push(new E.GeoSearchResult({caption:u.toString(o[v]),data:o[v],pos:o[v].pos,matchWeight:f(q,o[v],x,E.GeocodeFieldWeights)}));w.sort(function(A,C){return C.matchWeight-A.matchWeight});return w},P:t,B:z,A:u,dist2rad:function(q){return q/
6371},lat2pix:function(q,o){var v=parseFloat(q)*2*Math.PI/360;v=Math.sin(v);var w=m*v;return Math.log((1+v)/(1-v)*Math.pow((1-w)/(1+w),m))/2/o},lon2pix:function(q,o){return parseFloat(q)/180*Math.PI/o},pix2lon:function(q,o){return E.normalizeLon(q*o*180/Math.PI)},pix2lat:function(q,o){for(var v=Math.pow(Math.E,-q*o),w=h-2*Math.atan(v),x=l(w,v),A=0;A<12&&Math.abs(w-x)>1.0E-7;){w=x;x=l(w,v);A++}return x*180/Math.PI},normalizeLon:function(q){for(;q<-180;)q+=360;for(;q>180;)q-=360;return q}};return E}();
T5.Geo.GeoHash=function(){function e(l,f,b){if(f&b)l[0]=(l[0]+l[1])/2;else l[1]=(l[0]+l[1])/2}BITS=[16,8,4,2,1];BASE32="0123456789bcdefghjkmnpqrstuvwxyz";NEIGHBORS={right:{even:"bc01fg45238967deuvhjyznpkmstqrwx"},left:{even:"238967debc01fg45kmstqrwxuvhjyznp"},top:{even:"p0r21436x8zb9dcf5h7kjnmqesgutwvy"},bottom:{even:"14365h7k9dcfesgujnmqp0r2twvyx8zb"}};BORDERS={right:{even:"bcfguvyz"},left:{even:"0145hjnp"},top:{even:"prxz"},bottom:{even:"028b"}};NEIGHBORS.bottom.odd=NEIGHBORS.left.even;NEIGHBORS.top.odd=
NEIGHBORS.right.even;NEIGHBORS.left.odd=NEIGHBORS.bottom.even;NEIGHBORS.right.odd=NEIGHBORS.top.even;BORDERS.bottom.odd=BORDERS.left.even;BORDERS.top.odd=BORDERS.right.even;BORDERS.left.odd=BORDERS.bottom.even;BORDERS.right.odd=BORDERS.top.even;return{decode:function(l){var f=1,b=[],a=[];b[0]=-90;b[1]=90;a[0]=-180;a[1]=180;lat_err=90;lon_err=180;for(i=0;i<l.length;i++){c=l[i];cd=BASE32.indexOf(c);for(j=0;j<5;j++){mask=BITS[j];if(f){lon_err/=2;e(a,cd,mask)}else{lat_err/=2;e(b,cd,mask)}f=!f}}b[2]=(b[0]+
b[1])/2;a[2]=(a[0]+a[1])/2;return{latitude:b,longitude:a}},encode:function(l,f,b){var a=1,g=[],h=[],d=0,m=0;b=b?b:12;geohash="";g[0]=-90;g[1]=90;h[0]=-180;for(h[1]=180;geohash.length<b;){if(a){mid=(h[0]+h[1])/2;if(f>mid){m|=BITS[d];h[0]=mid}else h[1]=mid}else{mid=(g[0]+g[1])/2;if(l>mid){m|=BITS[d];g[0]=mid}else g[1]=mid}a=!a;if(d<4)d++;else{geohash+=BASE32[m];m=d=0}}return geohash}}}();
T5.Geo.Search=function(){return{bestResults:function(e,l){l||(l=20);for(var f=e.length>0?e[0]:null,b=[],a=0;a<e.length;a++)if(f&&e[a]&&f.matchWeight-e[a].matchWeight<=l)b.push(e[a]);else break;return b}}}();
T5.Geo.Routing=function(){var e={calculate:function(l){l=T5.ex({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},l);GT.Log.info("attempting to calculate route");var f=T5.Geo.getEngine("route");f&&f.route(l,function(b){if(l.generalize)b.geometry=T5.Geo.P.generalize(b.geometry,b.getInstructionPositions());if(l.map){e.createMapOverlay(l.map,b);if(l.autoFit){GT.Log.info("AUTOFITTING MAP TO ROUTE: bounds = "+b.boundingBox);l.map.gotoBounds(b.boundingBox)}}l.success&&
l.success(b)})},createMapOverlay:function(l,f){var b=l.getDimensions();b=new T5.Geo.UI.RouteOverlay({data:f,width:b.width,height:b.height});l.setLayer("route",b)},parseTurnType:function(l){for(var f=e.TurnType.Unknown,b=T5.Geo.Routing.TurnTypeRules,a=0;a<b.length;a++){b[a].regex.lastIndex=-1;var g=b[a].regex.exec(l);if(g){f=b[a].customCheck?b[a].customCheck(l,g):b[a].turnType;break}}return f},TurnType:{Unknown:"turn-unknown",Start:"turn-none-start",Continue:"turn-none",Arrive:"turn-none-arrive",TurnLeft:"turn-left",
TurnLeftSlight:"turn-left-slight",TurnLeftSharp:"turn-left-sharp",TurnRight:"turn-right",TurnRightSlight:"turn-right-slight",TurnRightSharp:"turn-right-sharp",Merge:"merge",UTurnLeft:"uturn-left",UTurnRight:"uturn-right",EnterRoundabout:"roundabout-enter",Ramp:"ramp",RampExit:"ramp-exit"},Instruction:function(l){l=T5.ex({position:null,description:"",turnType:null},l);if(!l.turnType)l.turnType=e.parseTurnType(l.description);return l},RouteData:function(l){l=T5.ex({geometry:[],instructions:[],boundingBox:null},
l);if(!l.boundingBox)l.boundingBox=T5.Geo.B.forPositions(l.geometry);return T5.ex({getInstructionPositions:function(){for(var f=[],b=0;b<l.instructions.length;b++)l.instructions[b].position&&f.push(l.instructions[b].position);return f}},l)}};return e}();
T5.Geo.Routing.TurnTypeRules=function(){var e=T5.Geo.Routing.TurnType,l=[];l.push({regex:/continue/i,turnType:e.Continue});l.push({regex:/(take|bear|turn)(.*?)left/i,customCheck:function(f,b){return/bear/i.test(b[1])?e.TurnLeftSlight:e.TurnLeft}});l.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(f,b){return/bear/i.test(b[1])?e.TurnRightSlight:e.TurnRight}});l.push({regex:/enter\s(roundabout|rotaty)/i,turnType:e.EnterRoundabout});l.push({regex:/take.*?ramp/i,turnType:e.Ramp});l.push({regex:/take.*?exit/i,
turnType:e.RampExit});l.push({regex:/make(.*?)u\-turn/i,customCheck:function(f,b){return/right/i.test(b[1])?e.UTurnRight:e.UTurnLeft}});l.push({regex:/proceed/i,turnType:e.Start});l.push({regex:/arrive/i,turnType:e.Arrive});l.push({regex:/fell\sthrough/i,turnType:e.Merge});return l}();
T5.Geo.UI=function(){var e=0,l={AnnotationTween:null,GeoTileGrid:function(f){f=T5.ex({grid:null,centerPos:new T5.Geo.Position,centerXY:new T5.Vector,radsPerPixel:0},f);var b=T5.Geo.P.toMercatorPixels(f.centerPos,f.radsPerPixel),a=b.x-f.centerXY.x,g=b.y-f.centerXY.y,h=T5.ex({},f.grid,{getBoundingBox:function(d,m,k,n){return new T5.Geo.BoundingBox(h.pixelsToPos(new T5.Vector(d,m+n)),h.pixelsToPos(new T5.Vector(d+k,m)))},getGridXYForPosition:function(d){d=T5.Geo.P.toMercatorPixels(d,f.radsPerPixel);
return new T5.Vector(d.x-a,h.gridDimensions.height-(d.y-g))},getPixelDistance:function(d){d=T5.Geo.dist2rad(d);return Math.floor(d/f.radsPerPixel)},pixelsToPos:function(d){return T5.Geo.P.fromMercatorPixels(a+d.x,g+h.gridDimensions.height-d.y,f.radsPerPixel)}});return h},RouteOverlay:function(f){f=T5.ex({data:null,pixelGeneralization:8,calculationsPerCycle:250,partialDraw:false,strokeStyle:"rgba(0, 51, 119, 0.9)",waypointFillStyle:"#FFFFFF",lineWidth:4,zindex:50},f);var b=true,a=null,g=[],h=0,d=[],
m=[],k=T5.ex(new T5.ViewLayer(f),{getAnimation:function(n,p,r,B){if(b)return null;var t="routeAnimation"+e++;m.push(t);return new T5.AnimatedPathLayer({id:t,path:g,zindex:f.zindex+1,easing:n?n:T5.T5.easing("sine.inout"),duration:p?p:5E3,drawIndicator:r,autoCenter:B?B:false})},draw:function(n,p,r,B,t){r=0;B=f.data?f.data.geometry:null;if(b){b=false;a=null;g=[];h=0}if(B&&h<B.length){a:{t=t.getTileLayer();d=[];if(t){B=GT.Log.getTraceTicks();var z,u,s,E=f.data?f.data.geometry:[],q=E.length,o=f.data?f.data.instructions:
[],v=o.length,w=f.calculationsPerCycle,x=0;for(z=h;z<q;z++){u=t.getGridXYForPosition(E[z]);if(s=!a||z===0||Math.abs(u.x-a.x)+Math.abs(u.y-a.y)>f.pixelGeneralization){g.push(u);a=u}x++;if(x>=w){h=z;break a}}h=q;GT.Log.trace(q+" geometry points generalized to "+g.length+" coordinates",B);a=null;for(z=v;z--;)if(o[z].position){u=t.getGridXYForPosition(o[z].position);if(s=!a||z===0||Math.abs(u.x-a.x)+Math.abs(u.y-a.y)>f.pixelGeneralization){d.push(u);a=u}}}}r++}t=g.length;if(t>0&&(!r||f.partialDraw)){n.strokeStyle=
f.strokeStyle;n.lineWidth=f.lineWidth;n.beginPath();n.moveTo(g[t-1].x-p.x,g[t-1].y-p.y);for(t=t;t--;)n.lineTo(g[t].x-p.x,g[t].y-p.y);n.stroke();n.fillStyle=f.waypointFillStyle;for(t=d.length;t--;){n.beginPath();n.arc(d[t].x-p.x,d[t].y-p.y,2,0,Math.PI*2,false);n.stroke();n.fill()}}return r}});GT.listen("grid.updated",function(){for(var n=m.length;n--;)GT.say("layer.remove",{id:m[n]});m=[];b=true;k.wakeParent()});return k},Annotation:function(f){f=T5.ex({xy:null,pos:null,draw:null,calcXY:null,tweenIn:l.AnnotationTween,
animationSpeed:null},f);var b=false,a={xy:f.xy,pos:f.pos,isNew:true,isAnimating:function(){return b},calcXY:function(g){a.xy=g.getGridXYForPosition(a.pos);f.calcXY&&f.calcXY(g)},draw:function(g,h,d,m,k){if(a.xy){if(a.isNew&&f.tweenIn){var n=a.xy.y;a.xy.y=h.y-20;b=true;T5.tween(a.xy,"y",n,f.tweenIn,function(){a.xy.y=n;b=false},f.animationSpeed?f.animationSpeed:250+Math.random()*500)}if(f.draw)f.draw(g,h,new T5.Vector(a.xy.x-h.x,a.xy.y-h.y),d,m,k);else{g.beginPath();g.arc(a.xy.x-h.x,a.xy.y-h.y,4,0,
Math.PI*2,false);g.fill()}a.isNew=false}}};return a},ImageAnnotation:function(f){f=T5.ex({imageUrl:null,animatingImageUrl:null,imageAnchor:null},f);var b=f.imageAnchor?T5.V.invert(f.imageAnchor):null;f.draw=function(g,h,d,m,k){if(f.animatingImageUrl&&a.isAnimating()){T5.Images.load(f.imageUrl);m=f.animatingImageUrl}else m=f.imageUrl;if(h=T5.Images.get(m)){if(h.complete&&h.width>0){b||(b=new T5.Vector(-h.width>>1,-h.height>>1));d=T5.V.offset(d,b.x,b.y);g.drawImage(h,d.x,d.y,h.width,h.height)}}else T5.Images.load(m,
function(){k.wakeParent()})};var a=new l.Annotation(f);return a},LocationAnnotation:function(f){f=T5.ex({accuracy:null},f);var b=new Image,a=new T5.Vector,g=null;b.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAACIQAAAiEBPhEQkwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAG+SURBVCiRlZHNahNRAIW/O7mTTJPahLZBA1YUyriINRAE3bQIKm40m8K8gLj0CRQkO32ELHUlKbgoIu4EqeJPgtCaoBuNtjXt5LeTMZk0mbmuWiuuPLsD3+HAOUIpxf9IHjWmaUbEyWv5ROrsVULhcHP761rUfnN3Y2Otc8CIg4YT85lzuVsPP+Qupw1vpPjRCvhS9ymvV0e77x7nNj+uvADQAIQQ+uLyvdfLV9JGZi7EdEwQlqBpEJ019f0z1mo2u5Q8DMydv25lshemmj1FueZTawbs7inarqLbV7Qjab1upB9YlhWSAHLavLHZCvg1VEhN0PMU9W7At4bPVidg7CtkLLXkut+lBPD6/Ub155jJiADAHSpaLmx3ApyBQoYEUd0PBoOBkAC6+3llvda/YxgGgYL+UNHf/zN3KiExGlsvTdP0NYDkhPdWrz35ZDsBzV5wCMuQwEyFmXFeeadjzfuFQmGkAZRKpdGC/n7x+M6jqvA9Zo6FWDhlcHE+wqT93J1tP7vpOE7rrx8ALMuasPf8S12St4WmJ6bYWTUC52k8Hm8Vi0X/nwBAPp/XKpWKdF1X2LYdlMvlsToC/QYTls7DLFr/PAAAAABJRU5ErkJggg%3D%3D";
b.onload=function(){a=new T5.Vector(b.width/2,b.height/2)};var h=new l.Annotation(T5.ex({calcXY:function(d){g=Math.floor(d.getPixelDistance(h.accuracy)*0.5)},draw:function(d,m,k,n,p,r){m=k.x-a.x;n=k.y-a.y;if(g&&h.drawAccuracyIndicator){d.fillStyle="rgba(30, 30, 30, 0.2)";d.beginPath();d.arc(k.x,k.y,g,0,Math.PI*2,false);d.fill()}b.complete&&b.width>0&&d.drawImage(b,m,n,b.width,b.height);r.trigger("invalidate")}},f));h.accuracy=f.accuracy;h.drawAccuracyIndicator=false;return h},AnnotationsOverlay:function(f){function b(m){var k=
f.map?f.map.getTileLayer():null,n=m.length;if(k)for(n=n;n--;)m[n].calcXY(k);m.sort(function(p,r){var B=r.xy.y-p.xy.y;if(B===0)B=r.xy.x-p.xy.x;return B})}f=T5.ex({pois:null,map:null,zindex:100},f);var a=[],g=false,h=[],d=T5.ex(new T5.ViewLayer(f),{cycle:function(){return g?1:0},draw:function(m,k,n,p,r){g=false;m.fillStyle="rgba(255, 0, 0, 0.75)";m.globalCompositeOperation="source-over";for(n=a.length;n--;){a[n].draw(m,k,p,d,r);g=g||a[n].isAnimating()}for(n=h.length;n--;){h[n].draw(m,k,p,d,r);g=g||
h[n].isAnimating()}return g?1:0},add:function(m){h.push(m);b(h);d.wakeParent()},clear:function(m){h=[];b(h);if(m){a=[];b(a)}d.wakeParent()}});GT.listen("geo.pois-updated",function(m){if(f.pois&&f.pois.id==m.srcID){m=m.pois;try{a=[];for(var k=0;k<m.length;k++)if(m[k].pos){var n;var p=m[k];if(p&&p.pos){var r={poi:p,annotation:null};f.map&&f.map.trigger("getAnnotationForPOI",r);if(!r.annotation)r.annotation=new l.Annotation({pos:p.pos});if(r.annotation){r.annotation.isNew=p.isNew;p.isNew=false}n=r.annotation}else n=
void 0;n&&a.push(n)}b(a)}catch(B){GT.Log.exception(B)}d.wakeParent()}});GT.listen("grid.updated",function(){b(a);b(h);d.wakeParent()});return d}};return l}();
T5.Map=function(e){function l(s){try{var E=new T5.Geo.Position(s.coords.latitude,s.coords.longitude),q=s.coords.accuracy/1E3;u.trigger("locationUpdate",s,q);if(t){if(!p){p=new T5.Geo.UI.LocationAnnotation({pos:E,accuracy:q});u.bind("tileDrawComplete",function(){p.drawAccuracyIndicator=true})}e.displayLocationAnnotation&&m.add(p);var o=T5.Geo.B.createBoundsFromCenter(E,Math.max(q,1));u.gotoBounds(o)}else{p.pos=E;p.accuracy=q;p.calcXY(u.getTileLayer());u.panToPosition(E,null,T5.easing("sine.out"))}t=
false}catch(v){GT.Log.exception(v)}}function f(s){GT.Log.info("caught location tracking error:",s)}e=T5.ex({tapExtent:10,provider:null,crosshair:false,zoomLevel:0,boundsChangeThreshold:30,pois:new T5.Geo.POIStorage,displayLocationAnnotation:true,zoomAnimation:T5.easing("quad.out")},e);var b={NONE:0,SINGLE:1,WATCH:2},a=new T5.Vector,g=b.NONE,h=false,d=[],m=null,k=null,n=null,p=null,r=0,B=false,t=true,z=e.zoomLevel;if(!e.provider)e.provider=new T5.Geo.MapProvider;e.adjustScaleFactor=function(s){return Math.pow(2,
(s<1?Math.floor:Math.ceil)(Math.log(s)))};var u=T5.ex({},new T5.Tiler(e),{pois:e.pois,annotations:null,getBoundingBox:function(){var s=u.getTileLayer(),E=u.getOffset(),q=u.getDimensions();if(s)return s.getBoundingBox(E.x,E.y,q.width,q.height);return null},getCenterPosition:function(){return u.getXYPosition(T5.D.getCenter(u.getDimensions()))},getXYPosition:function(s){return u.getTileLayer().pixelsToPos(u.viewPixToGridPix(s))},gotoBounds:function(s,E){var q=T5.Geo.B.getZoomLevel(s,u.getDimensions());
u.gotoPosition(T5.Geo.B.getCenter(s),q,E)},gotoPosition:function(s,E,q){function o(A){u.setTileLayer(A);n=A.getId();u.panToPosition(s,function(){u.unfreeze();u.trigger("zoomLevelChange",z);q&&q()});h=true;B=false}var v=z,w=!h,x=u.getBoundingBox();if(x)w=w||!T5.Geo.P.inBounds(s,x);z=E?E:z;if(!z)throw Error("Zoom level required to goto a position.");if(e.provider)z=e.provider.checkZoomLevel(z);if(w||z!==v)if(B)GT.Log.warn("Tile request in progress, aborting");else{T5.Images.cancelLoad();if(p)p.drawAccuracyIndicator=
false;(E=u.getTileLayer())&&E.deactivate();T5.cancelAnimation();h&&u.freeze();B=true;e.provider.zoomLevel=z;e.provider.getMapTiles(u,s,o)}else u.panToPosition(s,q)},panToPosition:function(s,E,q){var o=u.getTileLayer();if(o){s=o.getGridXYForPosition(s);o=u.getDimensions();s.x-=o.width/2;s.y-=o.height/2;if(k)k=null;u.updateOffset(s.x,s.y,q);u.trigger("wake");e.boundsChange&&e.boundsChange(u.getBoundingBox());E&&E(u)}},locate:function(){u.trackStart(b.SINGLE);setTimeout(u.trackCancel,1E4)},trackStart:function(s){if(navigator.geolocation&&
!r){g=s?s:b.WATCH;t=true;r=navigator.geolocation.watchPosition(l,f,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3})}},trackCancel:function(){r&&navigator.geolocation&&navigator.geolocation.clearWatch(r);g===b.WATCH&&m.clear();g=b.NONE;r=0},getZoomLevel:function(){return z},setZoomLevel:function(s){try{u.gotoPosition(u.getCenterPosition(),s)}catch(E){GT.Log.exception(E)}},zoomIn:function(){u.scale(2,T5.easing("sine.out"))||u.setZoomLevel(z+1)},zoomOut:function(){u.scale(0.5,T5.easing("sine.out"))||
u.setZoomLevel(z-1)},animateRoute:function(s,E,q,o){var v=u.getLayer("route");if(v)(s=v.getAnimation(s,E,q,o))&&s.addToView(u)}});u.bind("pan",function(){g===b.SINGLE&&u.trackCancel()});u.bind("tap",function(s,E){var q=u.getTileLayer(),o=null;if(q){var v=u.viewPixToGridPix(new T5.Vector(E.x,E.y)),w=q.pixelsToPos(v);o=q.pixelsToPos(T5.V.offset(v,-e.tapExtent,e.tapExtent));q=q.pixelsToPos(T5.V.offset(v,e.tapExtent,-e.tapExtent));o=new T5.Geo.BoundingBox(o,q);d=u.pois.findByBounds(o);u.trigger("geotap",
s,E,w,o);u.trigger("tapPOI",d)}});u.bind("doubleTap",function(s,E){u.animate(2,T5.D.getCenter(u.getDimensions()),new T5.Vector(E.x,E.y),e.zoomAnimation)});u.bind("scale",function(s,E){var q=0;s=Math.sqrt(s);if(s<1)q=-(0.5/s);else if(s>1)q=s;u.gotoPosition(u.getXYPosition(E),z+Math.floor(q))});m=new T5.Geo.UI.AnnotationsOverlay({pois:u.pois,map:u});u.annotations=m;u.setLayer("annotations",m);e.crosshair&&u.setLayer("crosshair",new CrosshairOverlay);u.bind("idle",function(){if(T5.V.absSize(T5.V.diff(a,
u.getOffset()))>e.boundsChangeThreshold){a=u.getOffset();u.trigger("boundsChange",u.getBoundingBox())}});GT.configurable(u,["provider"],GT.paramTweaker(e,null,{provider:function(){u.cleanup();h=false}}),true);return u};
