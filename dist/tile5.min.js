var RTree=function(s){var F=3,y=6;if(!isNaN(s)){F=Math.floor(s/2);y=s}var w={x:0,y:0,w:0,h:0,id:"root",nodes:[]},m=function(){var r={};return function(h){var j=0;if(h in r)j=r[h]++;else r[h]=0;return h+"_"+j}}();RTree.Rectangle.squarified_ratio=function(r,h,j){var n=(r+h)/2;r=r*h;return r*j/(r/(n*n))};var q=function(r,h,j){var n=[],x=[],l=[],p=1;if(!r||!RTree.Rectangle.overlap_rectangle(r,j))return l;r={x:r.x,y:r.y,w:r.w,h:r.h,target:h};x.push(j.nodes.length);n.push(j);do{j=n.pop();h=x.pop()-1;if("target"in
r)for(;h>=0;){var o=j.nodes[h];if(RTree.Rectangle.overlap_rectangle(r,o))if(r.target&&"leaf"in o&&o.leaf===r.target||!r.target&&("leaf"in o||RTree.Rectangle.contains_rectangle(o,r))){if("nodes"in o){l=v(o,true,[],o);j.nodes.splice(h,1)}else l=j.nodes.splice(h,1);RTree.Rectangle.make_MBR(j.nodes,j);delete r.target;if(j.nodes.length<F)r.nodes=v(j,true,[],j);break}else if("nodes"in o){p+=1;x.push(h);n.push(j);j=o;h=o.nodes.length}h-=1}else if("nodes"in r){j.nodes.splice(h+1,1);j.nodes.length>0&&RTree.Rectangle.make_MBR(j.nodes,
j);for(h=0;h<r.nodes.length;h++)B(r.nodes[h],j);r.nodes.length=0;if(n.length==0&&j.nodes.length<=1){r.nodes=v(j,true,r.nodes,j);j.nodes.length=0;n.push(j);x.push(1)}else if(n.length>0&&j.nodes.length<F){r.nodes=v(j,true,r.nodes,j);j.nodes.length=0}else delete r.nodes}else RTree.Rectangle.make_MBR(j.nodes,j);p-=1}while(n.length>0);return l},v=function(r,h,j,n){var x=[];if(!RTree.Rectangle.overlap_rectangle(r,n))return j;x.push(n.nodes);do{n=x.pop();for(var l=n.length-1;l>=0;l--){var p=n[l];if(RTree.Rectangle.overlap_rectangle(r,
p))if("nodes"in p)x.push(p.nodes);else if("leaf"in p)h?j.push(p):j.push(p.leaf)}}while(x.length>0);return j},B=function(r,h){var j;if(h.nodes.length==0){h.x=r.x;h.y=r.y;h.w=r.w;h.h=r.h;h.nodes.push(r)}else{var n=-1,x=[],l;x.push(h);var p=h.nodes;do{if(n!=-1){x.push(p[n]);p=p[n].nodes;n=-1}for(var o=p.length-1;o>=0;o--){var M=p[o];if("leaf"in M){n=-1;break}var G=RTree.Rectangle.squarified_ratio(M.w,M.h,M.nodes.length+1);M=RTree.Rectangle.squarified_ratio(Math.max(M.x+M.w,r.x+r.w)-Math.min(M.x,r.x),
Math.max(M.y+M.h,r.y+r.h)-Math.min(M.y,r.y),M.nodes.length+2);if(n<0||Math.abs(M-G)<l){l=Math.abs(M-G);n=o}}}while(n!=-1);n=r;do{if(j&&"nodes"in j&&j.nodes.length==0){l=j;j=x.pop();for(p=0;p<j.nodes.length;p++)if(j.nodes[p]===l||j.nodes[p].nodes.length==0){j.nodes.splice(p,1);break}}else j=x.pop();if("leaf"in n||"nodes"in n||Object.prototype.toString.call(n)==="[object Array]"){if(Object.prototype.toString.call(n)==="[object Array]"){for(l=0;l<n.length;l++)RTree.Rectangle.expand_rectangle(j,n[l]);
j.nodes=j.nodes.concat(n)}else{RTree.Rectangle.expand_rectangle(j,n);j.nodes.push(n)}if(j.nodes.length<=y)n={x:j.x,y:j.y,w:j.w,h:j.h};else{l=n=j.nodes;p=l.length-1;o=0;G=l.length-1;M=0;var A=void 0,P=void 0;for(A=l.length-2;A>=0;A--){P=l[A];if(P.x>l[o].x)o=A;else if(P.x+P.w<l[p].x+l[p].w)p=A;if(P.y>l[M].y)M=A;else if(P.y+P.h<l[G].y+l[G].h)G=A}if(Math.abs(l[p].x+l[p].w-l[o].x)>Math.abs(l[G].y+l[G].h-l[M].y))if(p>o){A=l.splice(p,1)[0];P=l.splice(o,1)[0]}else{P=l.splice(o,1)[0];A=l.splice(p,1)[0]}else if(G>
M){A=l.splice(G,1)[0];P=l.splice(M,1)[0]}else{P=l.splice(M,1)[0];A=l.splice(G,1)[0]}for(l=[{x:A.x,y:A.y,w:A.w,h:A.h,nodes:[A]},{x:P.x,y:P.y,w:P.w,h:P.h,nodes:[P]}];n.length>0;){p=n;o=l[0];G=l[1];A=RTree.Rectangle.squarified_ratio(o.w,o.h,o.nodes.length+1);P=RTree.Rectangle.squarified_ratio(G.w,G.h,G.nodes.length+1);var W=void 0,ja=void 0;M=void 0;for(var ma=p.length-1;ma>=0;ma--){var $=p[ma],ia={};ia.x=Math.min(o.x,$.x);ia.y=Math.min(o.y,$.y);ia.w=Math.max(o.x+o.w,$.x+$.w)-ia.x;ia.h=Math.max(o.y+
o.h,$.y+$.h)-ia.y;ia=Math.abs(RTree.Rectangle.squarified_ratio(ia.w,ia.h,o.nodes.length+2)-A);var T={};T.x=Math.min(G.x,$.x);T.y=Math.min(G.y,$.y);T.w=Math.max(G.x+G.w,$.x+$.w)-T.x;T.h=Math.max(G.y+G.h,$.y+$.h)-T.y;$=Math.abs(RTree.Rectangle.squarified_ratio(T.w,T.h,G.nodes.length+2)-P);if(!ja||!W||Math.abs($-ia)<W){ja=ma;W=Math.abs($-ia);M=$<ia?G:o}}A=p.splice(ja,1)[0];if(o.nodes.length+p.length+1<=F){o.nodes.push(A);RTree.Rectangle.expand_rectangle(o,A)}else if(G.nodes.length+p.length+1<=F){G.nodes.push(A);
RTree.Rectangle.expand_rectangle(G,A)}else{M.nodes.push(A);RTree.Rectangle.expand_rectangle(M,A)}}n=l=l;if(x.length<1){j.nodes.push(l[0]);x.push(j);n=l[1]}}}else{RTree.Rectangle.expand_rectangle(j,n);n={x:j.x,y:j.y,w:j.w,h:j.h}}}while(x.length>0)}};this.get_tree=function(){return w};this.set_tree=function(r,h){h||(h=w);var j=h;j.nodes=r.nodes;j.x=r.x;j.y=r.y;j.w=r.w;j.h=r.h;return j};this.search=function(){if(arguments.length<1)throw"Wrong number of arguments. RT.Search requires at least a bounding rectangle.";
switch(arguments.length){case 1:arguments[1]=false;case 2:arguments[2]=[];case 3:arguments[3]=w;default:arguments.length=4}return v.apply(this,arguments)};this.toJSON=function(r,h){var j=[],n=[],x={},l=3,p=1,o="";if(r&&!RTree.Rectangle.overlap_rectangle(r,w))return"";if(h){l+=4;n.push(h.nodes.length);j.push(h.nodes);o+="var main_tree = {x:"+h.x.toFixed()+",y:"+h.y.toFixed()+",w:"+h.w.toFixed()+",h:"+h.h.toFixed()+",nodes:["}else{n.push(w.nodes.length);j.push(w.nodes);o+="var main_tree = {x:"+w.x.toFixed()+
",y:"+w.y.toFixed()+",w:"+w.w.toFixed()+",h:"+w.h.toFixed()+",nodes:["}do{var M=j.pop(),G=n.pop()-1;if(G>=0&&G<M.length-1)o+=",";for(;G>=0;){var A=M[G];if(!r||RTree.Rectangle.overlap_rectangle(r,A))if(A.nodes)if(p>=l){var P=m("saved_subtree");o+="{x:"+A.x.toFixed()+",y:"+A.y.toFixed()+",w:"+A.w.toFixed()+",h:"+A.h.toFixed()+",load:'"+P+".js'}";x[P]=this.toJSON(r,A);if(G>0)o+=","}else{o+="{x:"+A.x.toFixed()+",y:"+A.y.toFixed()+",w:"+A.w.toFixed()+",h:"+A.h.toFixed()+",nodes:[";p+=1;n.push(G);j.push(M);
M=A.nodes;G=A.nodes.length}else if(A.leaf){P=A.leaf.toJSON?A.leaf.toJSON():JSON.stringify(A.leaf);o+="{x:"+A.x.toFixed()+",y:"+A.y.toFixed()+",w:"+A.w.toFixed()+",h:"+A.h.toFixed()+",leaf:"+P+"}";if(G>0)o+=","}else if(A.load){o+="{x:"+A.x.toFixed()+",y:"+A.y.toFixed()+",w:"+A.w.toFixed()+",h:"+A.h.toFixed()+",load:'"+A.load+"'}";if(G>0)o+=","}G-=1}if(G<0){o+="]}";p-=1}}while(j.length>0);o+=";";for(var W in x)o+="\nvar "+W+" = function(){"+x[W]+" return(main_tree);};";return o};this.remove=function(){if(arguments.length<
1)throw"Wrong number of arguments. RT.remove requires at least a bounding rectangle.";switch(arguments.length){case 1:arguments[1]=false;case 2:arguments[2]=w;default:arguments.length=3}if(arguments[1]===false){var r=0,h=[];do{r=h.length;h=h.concat(q.apply(this,arguments))}while(r!=h.length);return h}else return q.apply(this,arguments)};this.insert=function(r,h){if(arguments.length<2)throw"Wrong number of arguments. RT.Insert requires at least a bounding rectangle and an object.";return B({x:r.x,
y:r.y,w:r.w,h:r.h,leaf:h},w)}};
RTree.Rectangle=function(s,F,y,w){var m,q,v,B,r,h;if(s.x){m=s.x;v=s.y;if(s.w!==0&&!s.w&&s.x2){r=s.x2-s.x;h=s.y2-s.y}else{r=s.w;h=s.h}}else{m=s;v=F;r=y;h=w}q=m+r;B=v+h;this.x1=this.x=function(){return m};this.y1=this.y=function(){return v};this.x2=function(){return q};this.y2=function(){return B};this.w=function(){return r};this.h=function(){return h};this.toJSON=function(){return'{"x":'+m.toString()+', "y":'+v.toString()+', "w":'+r.toString()+', "h":'+h.toString()+"}"};this.overlap=function(j){return this.x()<
j.x2()&&this.x2()>j.x()&&this.y()<j.y2()&&this.y2()>j.y()};this.expand=function(j){var n=Math.min(this.x(),j.x()),x=Math.min(this.y(),j.y());r=Math.max(this.x2(),j.x2())-n;h=Math.max(this.y2(),j.y2())-x;m=n;v=x;return this};this.setRect=function(){}};RTree.Rectangle.overlap_rectangle=function(s,F){return s.x<F.x+F.w&&s.x+s.w>F.x&&s.y<F.y+F.h&&s.y+s.h>F.y};RTree.Rectangle.contains_rectangle=function(s,F){return s.x+s.w<=F.x+F.w&&s.x>=F.x&&s.y+s.h<=F.y+F.h&&s.y>=F.y};
RTree.Rectangle.expand_rectangle=function(s,F){var y=Math.min(s.x,F.x),w=Math.min(s.y,F.y);s.w=Math.max(s.x+s.w,F.x+F.w)-y;s.h=Math.max(s.y+s.h,F.y+F.h)-w;s.x=y;s.y=w;return s};RTree.Rectangle.make_MBR=function(s,F){if(s.length<1)return{x:0,y:0,w:0,h:0};if(F)F.x=s[0].x;else F={x:s[0].x,y:s[0].y,w:s[0].w,h:s[0].h};F.y=s[0].y;F.w=s[0].w;F.h=s[0].h;for(var y=s.length-1;y>0;y--)RTree.Rectangle.expand_rectangle(F,s[y]);return F};COG=typeof COG!=="undefined"?COG:{};
COG.extend=function(){for(var s=arguments[0]||{},F,y=1,w=arguments.length;y<w;y++)if((F=arguments[y])!==null)for(var m in F){var q=F[m];if(s!==q)if(q!==undefined)s[m]=q}return s};
(function(){var s=Object.prototype.hasOwnProperty,F=0,y={};y.toID=function(w){return w.replace(/\s/g,"-")};y.objId=function(w){return(w?w:"obj")+F++};y.isFunction=function(w){return toString.call(w)==="[object Function]"};y.isArray=function(w){return toString.call(w)==="[object Array]"};y.isPlainObject=function(w){if(!w||toString.call(w)!=="[object Object]"||w.nodeType||w.setInterval)return false;if(w.constructor&&!s.call(w,"constructor")&&!s.call(w.constructor.prototype,"isPrototypeOf"))return false;
var m;for(m in w);return m===undefined||s.call(w,m)};y.isEmptyObject=function(w){for(var m in w)return false;return true};y.isXmlDocument=function(w){return toString.call(w)==="[object Document]"};y.contains=function(w,m){var q=w,v=arguments,B=1;if(m&&module.isArray(m)){v=m;B=0}for(B=B;B<v;B++)q=q&&typeof foo[v[B]]!=="undefined";return q};y.formatStr=function(w){if(arguments.length<=1)return w;for(var m=arguments.length-2,q=0;q<=m;q++)w=w.replace(RegExp("\\{"+q+"\\}","gi"),arguments[q+1]);return w};
y.wordExists=function(w,m){var q="";if(m.toString)m=m.toString();for(var v=0;v<m.length;v++)q+=!/\w/.test(m[v])?"\\"+m[v]:m[v];return RegExp("(^|\\s|\\,)"+q+"(\\,|\\s|$)","i").test(w)};COG.extend(COG,y)})();
(function(){function s(q){return typeof console!=="undefined"?function(){console[q](Array.prototype.slice.call(arguments,0).join(" "));return true}:function(){return false}}var F=window.console&&window.console.markTimeline,y=s("error"),w=s("info"),m=function(){return F?function(q,v){console.markTimeline(q+(v?": "+((new Date).getTime()-v)+"ms":""))}:function(){}}();COG.extend(COG,{trace:m,debug:s("debug"),info:w,warn:s("warn"),error:y,exception:function(q){if(y)for(var v in q)w("ERROR DETAIL: "+v+
": "+q[v])}})})();
(function(){function s(y,w){var m=y.hasOwnProperty("obsHandlers")?y.obsHandlers:null;m[w]||(m[w]=[]);return m[w]}var F=0;COG.observable=function(y){if(!y)return null;if(!(y.hasOwnProperty("obsHandlers")?y.obsHandlers:null))y.obsHandlers={};if(!y.hasOwnProperty("bind")){y.bind=function(w,m){var q="callback"+F++;s(y,w).unshift({fn:m,id:q});return q};y.triggerCustom=function(w,m){var q=s(y,w),v={cancel:false,name:w,source:this},B;m&&COG.extend(v,m);if(!q)return null;B=Array.prototype.slice.call(arguments,2);
y.eventInterceptor&&y.eventInterceptor(w,v,B);B.unshift(v);for(var r=q.length;r--&&!v.cancel;)q[r].fn.apply(this,B);return v};y.trigger=function(w){var m=Array.prototype.slice.call(arguments,1);m.splice(0,0,w,null);return y.triggerCustom.apply(this,m)};y.unbind=function(w,m){if(typeof w==="undefined")y.obsHandlers={};else for(var q=s(y,w),v=0;q&&v<q.length;v++)if(q[v].id===m){q.splice(v,1);break}return y}}return y}})();
(function(){function s(m,q){m[q]||(m[q]=function(v){return m.configure(q,v)})}function F(m){m.gtConfId="configurable"+w++;m.gtConfig={};m.gtConfigFns=[];return m.gtConfig}var y={},w=0;COG.paramTweaker=function(m,q,v){return function(B,r){if(typeof r!=="undefined"){if(B in m)m[B]=r;v&&B in v&&v[B](B,r)}else return q&&B in q?q[B](B):m[B]}};COG.configurable=function(m,q,v,B){if(m){m.gtConfId||F(m);var r=m.gtConfId,h=m.gtConfig,j=m.gtConfigFns;y[r]=m;j.push(v);for(v=q.length;v--;){h[q[v]]=true;B&&s(m,
q[v])}if(!m.configure)m.configure=function(n,x){if(h[n]){for(var l=j.length;l--;){var p=j[l](n,x);if(typeof p!=="undefined")return p}return y[r]}return null}}}})();
(function(){function s(m){var q=document.createElement("script"),v=false;q.src=m;q.async=true;q.onload=q.onreadystatechange=function(){if(!v&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){v=true;q.onload=q.onreadystatechange=null;q&&q.parentNode&&q.parentNode.removeChild(q)}};y||(y=document.getElementsByTagName("head")[0]);y.appendChild(q)}var F=0,y,w=this;COG.jsonp=function(m,q,v){m+=m.indexOf("?")>=0?"&":"?";var B="json"+ ++F;w[B]=function(r){q(r);w[B]=null;try{delete w[B]}catch(h){}};
s(m+(v?v:"callback")+"="+B);return B}})();
(function(){var s=1.70158,F=Math.PI/2,y=1E3/60|0,w=Math.abs,m=Math.pow,q=Math.sin,v=Math.asin,B=Math.cos,r={linear:function(h,j,n,x){return n*h/x+j},backin:function(h,j,n,x){return n*(h/=x)*h*((s+1)*h-s)+j},backout:function(h,j,n,x){return n*((h=h/x-1)*h*((s+1)*h+s)+1)+j},backinout:function(h,j,n,x){return(h/=x/2)<1?n/2*h*h*(((s*=1.525)+1)*h-s)+j:n/2*((h-=2)*h*(((s*=1.525)+1)*h+s)+2)+j},bouncein:function(h,j,n,x){return n-r.bounceout(x-h,0,n,x)+j},bounceout:function(h,j,n,x){return(h/=x)<1/2.75?n*
7.5625*h*h+j:h<2/2.75?n*(7.5625*(h-=1.5/2.75)*h+0.75)+j:h<2.5/2.75?n*(7.5625*(h-=2.25/2.75)*h+0.9375)+j:n*(7.5625*(h-=2.625/2.75)*h+0.984375)+j},bounceinout:function(h,j,n,x){return h<x/2?r.bouncein(h*2,0,n,x)/2+j:r.bounceout(h*2-x,0,n,x)/2+n/2+j},cubicin:function(h,j,n,x){return n*(h/=x)*h*h+j},cubicout:function(h,j,n,x){return n*((h=h/x-1)*h*h+1)+j},cubicinout:function(h,j,n,x){if((h/=x/2)<1)return n/2*h*h*h+j;return n/2*((h-=2)*h*h+2)+j},elasticin:function(h,j,n,x,l,p){if(h==0)return j;if((h/=
x)==1)return j+n;p||(p=x*0.3);if(!l||l<w(n)){l=n;n=p/4}else n=p/TWO_PI*v(n/l);return-(l*m(2,10*(h-=1))*q((h*x-n)*TWO_PI/p))+j},elasticout:function(h,j,n,x,l,p){var o;if(h==0)return j;if((h/=x)==1)return j+n;p||(p=x*0.3);if(!l||l<w(n)){l=n;o=p/4}else o=p/TWO_PI*v(n/l);return l*m(2,-10*h)*q((h*x-o)*TWO_PI/p)+n+j},elasticinout:function(h,j,n,x,l,p){var o;if(h==0)return j;if((h/=x/2)==2)return j+n;p||(p=x*0.3*1.5);if(!l||l<w(n)){l=n;o=p/4}else o=p/TWO_PI*v(n/l);if(h<1)return-0.5*l*m(2,10*(h-=1))*q((h*
x-o)*TWO_PI/p)+j;return l*m(2,-10*(h-=1))*q((h*x-o)*TWO_PI/p)*0.5+n+j},quadin:function(h,j,n,x){return n*(h/=x)*h+j},quadout:function(h,j,n,x){return-n*(h/=x)*(h-2)+j},quadinout:function(h,j,n,x){if((h/=x/2)<1)return n/2*h*h+j;return-n/2*(--h*(h-2)-1)+j},sinein:function(h,j,n,x){return-n*B(h/x*F)+n+j},sineout:function(h,j,n,x){return n*q(h/x*F)+j},sineinout:function(h,j,n,x){return-n/2*(B(Math.PI*h/x)-1)+j}};COG.tweenValue=function(h,j,n,x,l){function p(A){A=A?A:(new Date).getTime();if(M+y<A){var P=
A-o,W=n(P,h,G,x),ja=o+x<=A;A=!ja;if(l){P=l(W,ja,P);A=typeof P!="undefined"?P&&A:A}A&&animFrame(p)}}var o=(new Date).getTime(),M=0,G=j-h;animFrame(p);return{}};COG.easing=function(h){return r[h.replace(/[\-\_\s\.]/g,"").toLowerCase()]};COG.registerEasingType=function(h,j){r[h.replace(/[\-\_\s\.]/g,"").toLowerCase()]=j}})();
(function(){var s=/^P(\d+Y)?(\d+M)?(\d+D)?$/,F=/^(\d+H)?(\d+M)?(\d+S)?$/,y={8601:function(m){m=m.split("T");var q=null;q=null;var v=0,B=0;s.lastIndex=-1;q=s.exec(m[0]);v+=q[3]?parseInt(q[3].slice(0,-1),10):0;F.lastIndex=-1;q=F.exec(m[1]);B+=q[1]?parseInt(q[1].slice(0,-1),10)*3600:0;B+=q[2]?parseInt(q[2].slice(0,-1),10)*60:0;B+=q[3]?parseInt(q[3].slice(0,-1),10):0;return new w(v,B)}},w=COG.Duration=function(m,q){return{days:m?m:0,seconds:q?q:0}};COG.addDuration=function(){for(var m=new w,q=arguments.length;q--;){m.days+=
arguments[q].days;m.seconds+=arguments[q].seconds}if(m.seconds>=86400){m.days+=~~(m.seconds/86400);m.seconds%=86400}return m};COG.formatDuration=function(m){var q,v,B="";if(m.days)B=m.days+" days ";if(m.seconds){m=m.seconds;if(m>=3600){q=~~(m/3600);m-=q*3600}if(m>=60){v=Math.round(m/60);m-=v*60}if(q)B=B+q+(q>1?" hrs ":" hr ")+(v?(v>10?v:"0"+v)+" min ":"");else if(v)B=B+v+" min";else if(m>0)B=B+(m>10?m:"0"+m)+" sec"}return B};COG.parseDuration=function(m,q){var v=q?y[q]:null;if(v)return v(m);COG.Log.warn("Could not find duration parser for specified format: "+
q);return new w}})();COG.ObjectStore=function(){var s={},F={},y="obj_"+(new Date).getTime(),w=0,m=Object.prototype.hasOwnProperty;return{add:function(q,v){var B;v=v?v:"default";if(q&&q.constructor)if(!m.call(q,"id"))q.id=y+ ++w;B=F[v]?F[v]:F[v]=[];s[q.id]=B.length;B[q.length]=q}}};var CANI={};
(function(s){var F=[],y=0,w=false,m=s.register=function(q,v){F.push({section:q,run:v})};s.init=function(q){function v(){if(y<F.length){var r=F[y++];B[r.section]||(B[r.section]={});r.run(B[r.section],v)}else{for(r in B)s[r]=B[r];w=true;q&&q(s)}}var B={};if(w&&q)q(s);else{y=0;v()}};m("canvas",function(q,v){function B(){var n,x=r.getContext("2d");x.save();try{x.translate(50,50);x.beginPath();x.rect(0,0,20,20);n=x.isPointInPath(10,10)}finally{x.restore()}return n}var r=document.createElement("canvas"),
h=typeof FlashCanvas!="undefined",j=typeof G_vmlCanvasManager!="undefnined";r.width=200;r.height=200;q.pipTransformed=h||j?false:B();v()})})(CANI);
INTERACT=function(){function s(l){return function(p,o,M){(M?M:l?document.body:document).addEventListener(p,o,false)}}function F(l){return function(p,o,M){(M?M:l?document.body:document).removeEventListener(p,o,false)}}function y(l,p,o){(o?o:document).attachEvent("on"+l,p)}function w(l,p,o){(o?o:document).detachEvent("on"+l,p)}function m(l,p){return{x:l?l:0,y:p?p:0,count:1}}function q(l,p){n.push(COG.extend({handler:null,checks:{},type:l},p))}function v(l){var p=0,o=0;if(l.offsetParent){do{p+=l.offsetLeft;
o+=l.offsetTop;l=l.offsetParent}while(l)}return{left:p,top:o}}function B(l,p){return{source:l,target:p.target?p.target:p.srcElement}}function r(l,p){for(var o=l.target?l.target:l.srcElement;o&&o!==p&&o.nodeName&&o.nodeName.toUpperCase()!="CANVAS";)o=o.parentNode;return o&&o===p}function h(l,p){return{x:l.x-(p?p.left:0),y:l.y-(p?p.top:0)}}function j(l){if(l.preventDefault){l.preventDefault();l.stopPropagation()}else l.cancelBubble&&l.cancelBubble()}var n=[],x=function(l,p,o){function M(T,ba,ea,R){var Z=
0,ca=0,E=0;COG.tweenValue(0,T,ea,R,function(Q){E=Z;Z=Q});COG.tweenValue(0,ba,ea,R,function(Q){G.trigger("pan",Z-E,Q-ca);ca=Q})}o=COG.extend({binder:null,unbinder:null,observable:null},o);for(var G=o.observable,A=null,P=[],W=[],ja,ma,$={bind:function(){return G.bind.apply(null,arguments)},pannable:function(T){A=COG.extend({inertia:true},T);return $},unbind:function(){G.unbind();for(var T=0;T<P.length;T++)P[T].unbind();return $}},ia=0;ia<p.length;ia++)P.push(p[ia](l,G,o));G.bind("pointerDown",function(){W=
[];ma=ja=0});G.bind("pointerMove",function(T,ba,ea,R){if(A){W[W.length]={ticks:(new Date).getTime(),x:R.x,y:R.y};G.trigger("pan",R.x,R.y)}ja+=R.x?R.x:0;ma+=R.y?R.y:0});G.bind("pointerUp",function(T,ba,ea){if(Math.abs(ja)>20||Math.abs(ma)>20){if(A){ea=W.length;var R,Z;ba=0;for(Z=W.length;--Z>1&&ba<50;)ba+=W[Z].ticks-W[Z-1].ticks;if(ea-Z>1){T=W[ea-1].x-W[Z].x;R=W[ea-1].y-W[Z].y;Z=Math.sqrt(T*T+R*R)|0;if(Z>15){T=W[ea-1].x-W[0].x;R=W[ea-1].y-W[0].y;Z=Math.sqrt(T*T+R*R)|0;ea=Math.asin(R/Z);ba=Z*500/ba|
0;ba=ba>300?300:ba;M(Math.cos(T>0?ea:Math.PI-ea)*ba,Math.sin(ea)*ba,COG.easing("sine.out"),500)}}}}else G.trigger("tap",ba,ea)});return $};q("pointer",{handler:function(l,p,o){function M(E){if(E.pageX&&E.pageY)return m(E.pageX,E.pageY);else{var Q=document.documentElement,da=document.body;return m(E.clientX+(Q&&Q.scrollLeft||da&&da.scrollLeft||0)-(Q&&Q.clientLeft||da&&da.clientLeft||0),E.clientY+(Q&&Q.scrollTop||da&&da.scrollTop||0)-(Q&&Q.clientTop||da&&da.clientTop||0))}}function G(E){if(r(E,l))if(T=
ja(E)){var Q=M(E);l.style.cursor="move";j(E);Z=Q.x;ca=Q.y;ba=m(Z,ca);p.triggerCustom("pointerDown",B("mouse",E),ba,h(ba,v(l)))}}function A(E){var Q=M(E);ea=Q.x;R=Q.y;if(r(E,l))ma(E,T?"pointerMove":"pointerHover")}function P(E){if(T&&ja(E)){T=false;if(r(E,l)){l.style.cursor="default";ma(E,"pointerUp")}}}function W(E){if(r(E,l)){var Q;E=E||window.event;if(E.detail)Q=E.axis===2?-E.detail*$:0;else{Q=E.wheelDeltaY?E.wheelDeltaY:E.wheelDelta;if(window.opera)Q=-Q}if(Q!==0){var da=m(ea,R);p.triggerCustom("zoom",
B("mouse",E),da,h(da,v(l)),Q/ia,"wheel");j(E);E.returnValue=false}}}function ja(E){E=E||window.event;return(E.which||E.button)==1}function ma(E,Q,da,qa,Ga){da=typeof da!="undefined"?da:ea;qa=typeof qa!="undefined"?qa:R;var N=da-Z,aa=qa-ca,U=m(da,qa);p.triggerCustom(Q,B("mouse",E),U,h(U,v(l)),m(N,aa));if(typeof Ga=="undefined"||Ga){Z=da;ca=qa}}o=COG.extend({},o);var $=120,ia=$*8,T=false,ba,ea,R,Z,ca;o.binder("mousedown",G,false);o.binder("mousemove",A,false);o.binder("mouseup",P,false);o.binder("dblclick",
function(E){COG.info("captured double click");if(r(E,l)){var Q=M(E);p.triggerCustom("doubleTap",B("mouse",E),Q,h(Q,v(l)))}},false);o.binder("mousewheel",W,document);o.binder("DOMMouseScroll",W,document);return{unbind:function(){o.unbinder("mousedown",G,false);o.unbinder("mousemove",A,false);o.unbinder("mouseup",P,false);o.unbinder("mousewheel",W,document);o.unbinder("DOMMouseScroll",W,document)}}},checks:{touch:false}});q("pointer",{handler:function(l,p,o){function M(N){if(N.count<2)return 0;var aa=
N.x-N.next.x;N=N.y-N.next.y;return~~Math.sqrt(aa*aa+N*N)}function G(N,aa,U){aa=aa?aa:0;U=U?U:0;for(var ua={x:N.x-aa,y:N.y-U,id:N.id,count:N.count},xa=ua;N.next;){N=N.next;xa=xa.next={x:N.x-aa,y:N.y-U,id:N.id}}return ua}function A(N,aa){var U=N[aa?aa:"touches"],ua,xa;if(U.length===0)return null;xa=ua={x:U[0].pageX,y:U[0].pageY,id:U[0].identifier,count:U.length};for(var Ba=1,Wa=U.length;Ba<Wa;Ba++)xa=xa.next={x:U[Ba].pageX,y:U[Ba].pageY,id:U[Ba].identifier};return ua}function P(N){if(r(N,l)){R=v(l);
var aa=A(N,"changedTouches"),U=G(aa,R.left,R.top);if(!ca){Z=T;p.triggerCustom("pointerDown",B("touch",N),aa,U)}qa&&p.triggerCustom("pointerDownMulti",B("touch",N),aa,U);ca=A(N);if(ca.count>1)Q=M(ca);Ga=1;da=G(ca)}}function W(N){if(r(N,l)){N.preventDefault();E=A(N);if(Z==T)Z=Math.abs(ca.x-E.x)>$||Math.abs(ca.y-E.y)>$?ia:T;if(Z!=T){Z=E.count>1?ea:ba;if(Z==ea)if(ca.count===1){ca=G(E);Q=M(ca)}else{var aa=M(E);if(Math.abs(Q-aa)<ma)Z=ba;else{var U;U=E.x;var ua=E.next.x,xa=E.y,Ba=E.next.y,Wa=xa<Ba?xa:Ba;
U={x:(U<ua?U:ua)+(Math.abs(U-ua)>>1),y:Wa+(Math.abs(xa-Ba)>>1)};aa=aa/Q;ua=aa-Ga;p.triggerCustom("zoom",B("touch",N),U,h(U,R),ua,"pinch");Ga=aa}}Z==ba&&p.triggerCustom("pointerMove",B("touch",N),E,G(E,R.left,R.top),m(E.x-da.x,E.y-da.y));qa&&p.triggerCustom("pointerMoveMulti",B("touch",N),E,G(E,R.left,R.top))}da=G(E)}}function ja(N){if(r(N,l)){var aa=A(N,"changedTouches"),U=G(aa,R.left,R.top);E=A(N);if(!E){p.triggerCustom("pointerUp",B("touch",N),aa,U);ca=null}qa&&p.triggerCustom("pointerUpMulti",
B("touch",N),aa,U)}}o=COG.extend({detailed:false,inertia:false},o);var ma=20,$=7,ia=0,T=1,ba=2,ea=3,R,Z,ca,E,Q,da,qa=o.detailed,Ga=1;o.binder("touchstart",P,false);o.binder("touchmove",W,false);o.binder("touchend",ja,false);COG.info("initialized touch handler");return{unbind:function(){o.unbinder("touchstart",P,false);o.unbinder("touchmove",W,false);o.unbinder("touchend",ja,false)}}},checks:{touch:true}});return{register:q,watch:function(l,p,o){p=COG.extend({bindToBody:false,observable:null,isIE:typeof window.attachEvent!=
"undefined",types:null},p);capabilities=COG.extend({touch:"ontouchstart"in window},o);if(!p.observable){COG.info("creating observable");p.observable=COG.observable({});globalOpts=p}p.binder=p.isIE?y:s(p.bindToBody);p.unbinder=p.isIE?w:F(p.bindToBody);o=p.types;for(var M=capabilities,G=[],A=n.length;A--;){var P=n[A],W=!o||o.indexOf(P.type)>=0,ja=true;for(var ma in P.checks){var $=P.checks[ma];COG.info("checking "+ma+" capability. require: "+$+", capability = "+M[ma]);ja=ja&&$===M[ma]}if(W&&ja)G[G.length]=
P.handler}return new x(l,G,p)}}}();var T5={};
(function(s){function F(){return(new Date).getTime()}function y(b,e){e=Rb.call(e);if(e=="finite")return!Wa[Ba](+b);return e=="null"&&b===null||e==typeof b||e=="object"&&b===Object(b)||e=="array"&&Array.isArray&&Array.isArray(b)||Sb.call(b).slice(8,-1).toLowerCase()==e}function w(b){b=b||(new Date).getTime();for(var e=0;e<Ta.length;){var f=Ta[e],c=Oa[f],a=Oa[f].image&&(ab||Oa[f].image.complete&&Oa[f].image.width>0),d=b-c.start;d=a||d>=Tb;if(a){a=c.callbacks;ub[f]=c.image;for(var g=0;g<a.length;g++)a[g](c.image,
true)}if(d){Ta.splice(e,1);delete Oa[f]}else e++}Ta.length>0&&animFrame(w)}function m(b,e){var f=b&&e?ub[b]:null;if(f&&f&&(ab||f.complete&&f.width>0))e(f);else{if(f=Oa[b])f.callbacks.push(e);else{f=new Image;f.id="_ldimg"+ ++Ub;Oa[b]={start:(new Date).getTime(),image:f,callbacks:[e]};f.src=b;Ta[Ta.length]=b}animFrame(w)}}function q(b,e,f,c){this.x=b;this.y=e;this.w=c||256;this.h=c||256;this.x2=this.x+this.w;this.y2=this.y+this.h;this.url=f;this.id=this.x+"_"+this.y;this.loaded=false;this.image=null}
function v(b){function e(d){var g=b[d];y(g,ta)||c.push(function(k){k[d]=g})}function f(){c=[];for(var d in b)e(d)}b=COG.extend({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},b);var c=[],a={applyToContext:function(d){for(var g=c.length;g--;)c[g](d)},update:function(d,g){b[d]=g;f()}};f();return a}function B(){for(var b=0,e=arguments.length;e--;){var f=Vb[arguments[e].toUpperCase()];
if(f)b|=f}return b}function r(b){b=b?b:(new Date).getTime();if(b-vb>Wb){for(var e=Xa.splice(0),f=e.length;f--;)e[f](b);vb=b}Xa.length&&animFrame(r)}function h(b){var e=Xa.length==0;Xa[Xa.length]=b;e&&animFrame(r)}function j(b,e,f,c,a){a=COG.extend({easing:"sine.out",duration:1E3,progress:null,complete:null,autoInvalidate:true},a);var d=(new Date).getTime(),g=b[e],k=e=="translate",i=a.autoInvalidate,u=f.length&&c.length&&f.length==c.length?f.length:0,H=Array(u),O=Array(u),L=COG.easing(a.easing),C=
a.duration,S=a.progress,t=function(I){var K=I-d;I=d+C<=I;for(var X=b.layer?b.layer.view:null,V,ka=u;ka--;){V=L(K,f[ka],H[ka],C);O[ka]=k?V|0:V}g.apply(b,O);i&&X&&X.invalidate();if(S){K=[].concat(I?c:O);K.unshift(I);S.apply(b,K)}if(I){b.animations--;g.apply(b,c);a.complete&&a.complete.apply(b,c)}else h(t)};if(g&&g.apply&&u>0){C=C?C:DEFAULT_DURATION;for(e=u;e--;)H[e]=c[e]-f[e];b.animations++;h(t)}}function n(b,e){var f,c;if(e&&e.width>0){if(!b.imageOffset)b.imageOffset=la.init(-e.width>>1,-e.height>>
1);if(!b.bounds){f=b.xy.x+b.imageOffset.x;c=b.xy.y+b.imageOffset.y;b.bounds=Ha.init(f,c,f+e.width,c+e.height)}}}function x(b){ya.call(this,b)}function l(b,e){e=COG.extend({simplify:false,typeName:"Poly"},e);var f=e.simplify;ya.call(this,e);COG.extend(this,{resync:function(c){var a,d,g,k,i,u;c.syncXY(b);u=this.points=la.floor(f?la.simplify(b):b);for(var H=u.length;H--;){c=u[H].x;a=u[H].y;k=y(k,ta)||c<k?c:k;i=y(i,ta)||a<i?a:i;d=y(d,ta)||c>d?c:d;g=y(g,ta)||a>g?a:g}this.updateBounds(Ha.init(k,i,d,g),
true)}});this.haveData=b&&b.length>=2}function p(b,e){e.fill=false;l.call(this,b,e)}function o(b){function e(i){(this.imageUrl=i)&&m(this.imageUrl,function(u,H){g=u;if(H){var O=k.layer?k.layer.view:null;O&&O.invalidate()}})}b=COG.extend({image:null,imageUrl:null,imageOffset:null,typeName:"Image"},b);var f=null,c=ya.prototype.updateBounds,a=0,d=0,g=b.image;ya.call(this,b);var k=COG.extend(this,{changeImage:e,drag:function(i,u,H,O){f||(f=la.init(i.startX-this.xy.x,i.startY-this.xy.y));this.xy.x=u-f.x;
this.xy.y=H-f.y;if(O){f=null;if(this.layer)if(i=this.layer.view){i.syncXY([this.xy],true);i.invalidate()}this.trigger("dragDrop")}return true},getProps:function(){this.bounds||n(this,g);return{image:g,x:this.xy.x+a,y:this.xy.y+d}},updateBounds:function(i,u){c.call(this,i,u);n(this,g)}});g||e(this.imageUrl);if(this.imageOffset){a=this.imageOffset.x;d=this.imageOffset.y}}function M(b){b=COG.extend({imageAnchor:null},b);if(b.imageAnchor)b.imageOffset=la.invert(b.imageAnchor);o.call(this,b)}function G(b){b=
COG.extend({startAngle:0,endAngle:Math.PI*2,typeName:"Arc"},b);ya.call(this,b)}function A(b){b=COG.extend({id:COG.objId("layer"),zindex:0,animated:false,validStates:B("ACTIVE","ANIMATING","PAN","ZOOM"),style:null,minXY:null,maxXY:null},b);this.view=null;COG.observable(COG.extend(this,b))}function P(b){for(var e=null,f=1;!e&&f<arguments.length;f++)e=ma(b,arguments[f]);e=e?e:ma(b);if(!e)throw Error("Unable to find GEO engine with "+b+" capability");return e}function W(b){b=parseFloat(b)*Ca;b=N(b);var e=
bb*b;return qa((1+b)/(1-b)*Q((1-e)/(1+e),bb))/2}function ja(b){return ba/(256<<b)}function ma(b,e){var f=null;for(var c in Pa)if(e){if(c==e&&Pa[c][b]){f=Pa[c];break}}else if(Pa[c][b]){f=Pa[c];break}return f}function $(b,e){var f=bb*N(b);return ea-2*ua(e*Q((1-f)/(1+f),bb/2))}function ia(b,e,f,c){e=T(e);b.add(c(e,f));return e.length}function T(b){var e=b?b.length:0,f=Array(e);for(e=e;e--;)f[e]=ha.init(b[e][1],b[e][0]);return ha.vectorize(f,wb)}window.animFrame=function(){return window.requestAnimationFrame||
window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b){setTimeout(function(){b((new Date).getTime())},1E3/60)}}();var ba=Math.PI*2,ea=Math.PI/2,R=Math.abs,Z=Math.ceil,ca=Math.min,E=Math.max,Q=Math.pow,da=Math.sqrt,qa=Math.log,Ga=Math.round,N=Math.sin,aa=Math.asin,U=Math.cos,ua=Math.atan,xa=Math.atan2,Ba="hasOwnProperty",Wa={NaN:1,Infinity:1,"-Infinity":1},Rb=String.prototype.toLowerCase,Sb=Object.prototype.toString,
ta="undefined",xb="number",Xb=typeof G_vmlCanvasManager!=ta,ab=typeof FlashCanvas!=ta,la=function(){function b(c,a){return f(c.x-a.x,c.y-a.y)}function e(c,a){a=a||c.length;if(a<=1)return null;for(var d=Array(a-1),g=Array(a-1),k=0,i,u=0;u<a-1;u++){i=b(c[u],c[u+1]);d[u]=da(i.x*i.x+i.y*i.y);g[u]=k+=d[u]}return{edges:d,accrued:g,tota:k}}function f(c,a){return{x:c||0,y:a||0}}return{VECTOR_SIMPLIFICATION:3,SIMPLIFICATION_MIN_VECTORS:25,add:function(){for(var c=0,a=0,d=arguments.length;d--;){c+=arguments[d].x;
a+=arguments[d].y}return f(c,a)},absSize:function(c){return E(R(c.x),R(c.y))},copy:function(c){return c?f(c.x,c.y):null},diff:b,distance:function(c,a){return e(c,a).total},edges:e,equals:function(c,a){return c.x===a.x&&c.y===a.y},extendBy:function(c,a,d){var g=U(a)*d|0;a=N(a)*d|0;return f(c.x-g,c.y-a)},floor:function(c){for(var a=Array(c.length),d=c.length;d--;)a[d]=f(~~c[d].x,~~c[d].y);return a},getRect:function(c){for(var a,d,g,k,i=c.length;i--;){var u=c[i];a=y(a,ta)||u.x<a?u.x:a;d=y(d,ta)||u.y<
d?u.y:d;g=y(g,ta)||u.x>g?u.x:g;k=y(k,ta)||u.y>k?u.y:k}return Ha.init(a,d,g,k)},init:f,invert:function(c){return f(-c.x,-c.y)},min:function(c,a){return f(c.x<a.x?c.x:a.x,c.y<a.y?c.y:a.y)},max:function(c,a){return f(c.x>a.x?c.x:a.x,c.y>a.y?c.y:a.y)},offset:function(c,a,d){return f(c.x+a,c.y+(d||a))},scale:function(c,a){return f(c.x/a|0,c.y/a|0)},simplify:function(c,a){if(!c)return null;a=a?a:la.VECTOR_SIMPLIFICATION;for(var d=[],g=null,k=c.length;k--;){var i=c[k];if(include=!g||k===0||R(i.x-g.x)+R(i.y-
g.y)>a){d.unshift(i);g=i}}return d},theta:function(c,a,d){d=aa((c.y-a.y)/d);return c.x>a.x?d:Math.PI-d},toString:function(c){return c?c.x+", "+c.y:""}}}(),hb=function(){return{dotProduct:function(b,e){return b.x*e.x+b.y*e.y}}}(),Ha=function(){function b(f){return e(f.x,f.y,f.x2,f.y2)}function e(f,c,a,d){f=f||0;c=c||0;a=a||f;d=d||c;return{x:f,y:c,x2:a,y2:d,w:a-f,h:d-c}}return{buffer:function(f,c,a){return la.init(f.x-c,f.y-(a||c),f.x+c,f.y+(a||c))},center:function(f){return la.init(f.x+(f.w>>1),f.y+
(f.h>>1))},copy:b,diagonalSize:function(f){return da(f.w*f.w+f.h*f.h)},fromCenter:function(f,c,a,d){a=a>>1;d=d>>1;return e(f-a,c-d,f+a,c+d)},init:e,intersect:function(f,c){var a=E(f.x,c.x),d=E(f.y,c.y),g=ca(f.x2,c.x2),k=ca(f.y2,c.y2);a=e(a,d,g,k);return a.w>0&&a.h>0?a:null},toString:function(f){return f?"["+f.x+", "+f.y+", "+f.x2+", "+f.y2+"]":""},union:function(f,c){if(f.w===0||f.h===0)return b(c);else if(c.w===0||c.h===0)return b(f);else{var a=ca(f.x,c.x),d=ca(f.y,c.y),g=E(f.x2,c.x2),k=E(f.y2,c.y2);
a=e(a,d,g,k);return a.w>0&&a.h>0?a:null}}}}(),ib=function(){return{getAspectRatio:function(b){return b.height!==0?b.width/b.height:1},getCenter:function(b){return la.init(b.width>>1,b.height>>1)},getSize:function(b){return da(Q(b.width,2)+Q(b.height,2))},init:function(b,e){b=b?b:0;return{width:b,height:e?e:b}}}}();Hits=function(){return{diffHits:function(b,e){var f=[],c={},a;for(a=e.length;a--;)c[e[a].target.id]=true;for(a=b.length;a--;)c[b[a].target.id]||(f[f.length]=b[a]);return f},init:function(b,
e,f,c){return{type:b,x:c.x|0,y:c.y|0,elements:[],absXY:e,relXY:f}},initHit:function(b,e,f){return{type:b,target:e,drag:f}},triggerEvent:function(b,e,f,c){e.triggerCustom(b.type+(f?f:"Hit"),{hitType:b.type},c?c:b.elements,b.absXY,b.relXY,la.init(b.x,b.y))}}}();var Yb=T5.newCanvas=function(b,e){var f=document.createElement("canvas");f.width=b?b:0;f.height=e?e:0;if(ab){document.body.appendChild(f);FlashCanvas.initElement(f)}Xb&&G_vmlCanvasManager.initElement(f);return f},yb=function(){var b={};return{init:function(e,
f){var c=b[e];if(!c)throw Error("Unable to locate requested generator: "+e);return new c(f)},register:function(e,f){b[e]=f}}}(),Tb=3E4,ub={},Ub=0;(new Date).getTime();var Oa={},Ta=[];q.prototype={constructor:q,load:function(b){var e=this;m(this.url,function(f){e.loaded=true;e.image=f;b&&b()})}};var Zb=function(){return{applyStyle:function(){},applyTransform:function(b,e,f){return{restore:null,x:e,y:f}},checkSize:function(){},getDimensions:function(){return{width:0,height:0}},getOffset:function(){return la.init(0,
0)},getViewport:function(){},hitTest:function(){return false},prepare:function(){},render:function(){},reset:function(){}}},zb={},Qa=s.registerRenderer=function(b,e){zb[b]=e},Ab=s.attachRenderer=function(b,e,f,c){b=b.split("/");for(var a=new Zb(e,f,c),d=0;d<b.length;d++){var g=zb[b[d]];if(g)a=new g(e,f,c,a)}return a};Qa("canvas",function(b,e,f,c){function a(t,I,K,X){var V=false;if(I)V=i.isPointInPath(L?I.x-u:I.relXY.x,L?I.y-H:I.relXY.y);return{draw:X||S,viewport:t,state:K,hit:V,vpX:u,vpY:H,context:i}}
f=COG.extend({},f);var d,g,k,i,u=0,H=0,O=null,L=CANI.canvas.pipTransformed,C={},S=function(){this.fill&&i.fill();this.stroke&&i.stroke()};(function(){if(e){var t=e.tagName=="CANVAS",I=t?e.parentNode:e;d=b.width=I.offsetWidth;g=b.height=I.offsetHeight;if(t){k=e;k.width=d;k.height=g;ab&&FlashCanvas.initElement(k)}else{k=Yb(d,g);k.style.cssText="position: absolute; z-index: 1;";e.appendChild(k)}i=null}})();return COG.extend(c,{interactTarget:k,applyStyle:function(t){var I=$b(t),K=I&&i&&i.canvas?C[i.canvas.id]:
null;if(I){C[i.canvas.id]=t;I.applyToContext(i);return K}},applyTransform:function(t){if(t.translateX!==0||t.translateY!==0||t.scaling!==1||t.rotation!==0){i.save();O={undo:function(){i.restore();O=null},x:t.xy.x,y:t.xy.y};i.translate(t.xy.x-u+t.translateX,t.xy.y-H+t.translateY);t.rotation!==0&&i.rotate(t.rotation);t.scaling!==1&&i.scale(t.scaling,t.scaling)}return O},drawTiles:function(t,I){for(var K,X,V=u-256,ka=H-256,za=t.x2,ra=t.y2,Da=I.length;Da--;){K=I[Da];if(X=K.x>=V&&K.x<=za&&K.y>=ka&&K.y<=
ra)K.loaded?i.drawImage(K.image,K.x-u,K.y-H):K.load(b.invalidate)}},hitTest:function(t,I,K){return i.isPointInPath(I,K)},prepare:function(t,I){var K,X=false;b.getOffset();var V=b.getScaleFactor();if(i)i.restore();else i=k.getContext("2d");for(K=t.length;K--;)X=X||t[K].clip;u=I.x;H=I.y;if(i){X||i.clearRect(0,0,d,g);i.save();i.scale(V,V)}i.globalCompositeOperation="source-over";return i},prepArc:function(t,I,K,X){i.beginPath();i.arc(t.xy.x-(O?O.x:u),t.xy.y-(O?O.y:H),t.size>>1,t.startAngle,t.endAngle,
false);return a(I,K,X)},prepImage:function(t,I,K,X,V){var ka=(V.x||t.xy.x)-(O?O.x:u),za=(V.y||t.xy.y)-(O?O.y:H),ra=V.image||t.image;if(ra){i.beginPath();i.rect(ka,za,V.width||ra.width,V.height||ra.height);return a(I,K,X,function(){i.drawImage(ra,ka,za,V.width||ra.width,V.height||ra.height)})}},prepPoly:function(t,I,K,X,V){var ka=true;t=V.points||t.points;V=O?O.x:u;var za=O?O.y:H;i.beginPath();for(var ra=t.length;ra--;){var Da=t[ra].x-V,cb=t[ra].y-za;if(ka){i.moveTo(Da,cb);ka=false}else i.lineTo(Da,
cb)}return a(I,K,X)},getContext:function(){return i},getDimensions:function(){return{width:d,height:g}},getOffset:function(){return la.init(u,H)}})});Qa("dom",function(b,e,f,c){var a=typeof e.style["-webkit-transform"]!="undefined",d=null;d=document.createElement("div");d.id=COG.objId("domImages");d.style.cssText=COG.formatStr("position: absolute; overflow: hidden; width: {0}px; height: {1}px;",e.offsetWidth,e.offsetHeight);e.insertBefore(d,c.interactTarget);return COG.extend(c,{drawTiles:function(g,
k){for(var i,u,H,O=g.x,L=g.y,C=O-256,S=L-256,t=O+g.w,I=L+g.h,K,X,V=k.length;V--;){i=k[V];u=i.image;H=i.x>=C&&i.x<=t&&i.y>=S&&i.y<=I;K=i.x-O;X=i.y-L;if(!u){u=i.image=new Image;u.src=i.url;d.appendChild(u);u.style.cssText="-webkit-user-select: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute;"}if(a)u.style["-webkit-transform"]=
"translate3d("+K+"px, "+X+"px, 0px)";else{u.style.left=K+"px";u.style.top=X+"px"}u.style.display=H?"block":"none"}},reset:function(){d.innerHTML=""}})});var Bb={},ac=s.defineStyle=function(b,e){Bb[b]=v(e);return b},Cb=s.defineStyles=function(b){for(var e in b)ac(e,b[e])},$b=s.getStyle=function(b){return Bb[b]};s.loadStyles=function(b){COG.jsonp(b,function(e){Cb(e)})};Cb({basic:{lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"},waypoints:{lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"},
waypointsHover:{lineWidth:4,strokeStyle:"#f00",fillStyle:"#FFF"}});var Vb={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,ZOOM:16,FREEZE:128},Kb=function(b){function e(z,D,J){Ea||Da(na-D,oa-J)}function f(z,D,J,Y){ka(ca(E(pa+Q(2,Y)-1,0.5),2))}function c(){var z=qa(pa)/Math.LN2|0;if(z!==0){pa=Q(2,z);za(Ya+z,bc,cc)}redraw=true}function a(z,D){var J=ga.getViewport(),Y=1/pa;return la.init(J?J.x+z*Y:z,J?J.y+D*Y:D)}function d(z,D,J){ra("doubleTap",D,J,a(J.x,J.y));b.scalable&&ka(2,a(J.x,J.y),b.zoomEasing,null,b.zoomDuration)}
function g(z,D,J){Ea=null;I("down",D,J)}function k(z,D,J){I("hover",D,J)}function i(z,D,J){S(D,J,false)}function u(z,D,J){S(D,J,true)}function H(){clearTimeout(Db);Db=setTimeout(function(){renderer.checkSize()},250)}function O(z,D,J){I("tap",D,J);ra("tap",D,J,a(J.x,J.y,true))}function L(z,D){D.id=z;D.added=F();D.view=ga;D.trigger("parentChange",ga,db,dc);sa.push(D);sa.sort(function(J,Y){var fa=Y.zindex-J.zindex;if(fa===0)fa=Y.added-J.added;return fa});Ia=sa.length;return D}function C(){va&&va.unbind();
if(renderer){va=INTERACT.watch(renderer.interactTarget);b.pannable&&va.pannable().bind("pan",e);if(b.scalable){va.bind("zoom",f);va.bind("doubleTap",d)}va.bind("pointerDown",g);va.bind("pointerMove",i);va.bind("pointerUp",u);b.captureHover&&va.bind("pointerHover",k);va.bind("tap",O)}}function S(z,D,J){if(Ea){z=a(D.x,D.y);if(Ea.drag.call(Ea.target,Ea,z.x,z.y,J))redraw=true;if(J)Ea=null}}function t(z){var D,J,Y=false;z=z||(new Date).getTime();if(Y=z-Eb>ec){var fa=R(na-jb),Aa=R(oa-kb);D=na!==lb||oa!==
mb;J=pa!==Fb;if(D||J)Ra++;if(fa>=Gb||Aa>=Gb)V();ga.trigger("enterFrame",z,fc++);Eb=z}if(Y&&Ra){Ma=Hb|(pa!==1?Ib:0)|(D?nb:0)|(ob?Jb:0);pb=(D=(Ma&(Ib|nb))!==0)&&(Ma&Jb)===0;D=X();if(renderer.prepare(sa,D,Ma,z,wa)){Ra=0;for(ii=Ia;ii--;){J=sa[ii];if((Ma&J.validStates)!==0){Y=J.style?renderer.applyStyle(J.style):null;J.draw(renderer,D,Ma,ga,z,wa);Y&&renderer.applyStyle(Y)}}renderer.render();lb=na;mb=oa;Fb=pa}if(wa){z=wa?wa.elements:[];if(Za&&Za.type==="hover"){D=Hits.diffHits(Za.elements,z);D.length>0&&
Hits.triggerEvent(Za,ga,"Out",D)}if(z.length>0){J=wa.x;Y=wa.y;for(D=z.length;D--;){fa=z[D];Aa=J;var Ja=Y,Fa=fa&&fa.drag&&(!fa.canDrag||fa.canDrag(fa,Aa,Ja));if(Fa){Ea=fa;Ea.startX=Aa;Ea.startY=Ja}if(Fa)break}Hits.triggerEvent(wa,ga)}Za=z.length>0?COG.extend({},wa):null;wa=null}}animFrame(t)}function I(z,D,J){wa=Hits.init(z,D,J,a(J.x,J.y,true));for(z=Ia;z--;)qb=qb||(sa[z].hitGuess?sa[z].hitGuess(wa.x,wa.y,Ma,ga):false);qb&&Ra++}function K(){Ra++}function X(){var z=Ha.init(na,oa,na+ga.width,oa+ga.height);
z.scaleFactor=pa;if(pa!==1)z=Ha.fromCenter(na+(ga.width>>1),oa+(ga.height>>1),ga.width/pa|0,ga.height/pa|0);return z}function V(){var z=X();if(z){if(Ua||Va)if(z){var D=eb?na+(z.w>>1):na,J=fb?oa+(z.h>>1):oa,Y=z.w,fa=z.h;if(Ua&&Ua>Y)if(D+Y>Ua)na=eb?na:Ua-Y;else if(D<0)na=eb?na:0;if(Va&&Va>fa)if(J+fa>Va)oa=fb?oa:Va-fa;else if(J<0)oa=fb?oa:0}jb=na;kb=oa;ra("refresh",ga,z);Ra++}}function ka(z,D,J,Y,fa){if(J)COG.tweenValue(pa,z,J,fa,function(Aa,Ja){pa=Aa;if(Ja){var Fa=Ga(qa(pa)/Math.LN2);pa=Q(2,Fa);Y&&
Y()}c()});else{pa=z;c()}return ga}function za(z,D,J){z=E(b.minZoom,ca(b.maxZoom,z));if(z!==Ya){var Y=Q(2,z-Ya),fa=ga.width>>1,Aa=ga.height>>1,Ja=fa/Y|0,Fa=Aa/Y|0;Ya=z;Da(((D?D:na+fa)-Ja)*Y,((J?J:oa+Aa)-Fa)*Y);lb=na;mb=oa;kb=jb=0;ra("zoomLevelChange",z);pa=1;renderer.reset();V()}}function ra(){for(var z=ga.trigger.apply(null,arguments).cancel,D=sa.length;D--;)z=sa[D].trigger.apply(null,arguments).cancel||z;return!z}function Da(z,D,J,Y,fa){function Aa(){Ja+=1;if(Ja>=2){ob=false;fa&&fa()}}var Ja=0;if(J){if((Ma&
nb)===0){COG.tweenValue(na,z,J,Y,function(Fa,rb){na=Fa|0;(rb?Aa:K)();return!pb});COG.tweenValue(oa,D,J,Y,function(Fa,rb){oa=Fa|0;(rb?Aa:K)();return!pb});ob=true}}else{na=z|0;oa=D|0;fa&&fa()}}b=COG.extend({id:COG.objId("view"),container:"",captureHover:true,captureDrag:false,inertia:true,refreshDistance:256,pannable:false,clipping:true,scalable:false,panAnimationEasing:COG.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,autoSize:true,tapExtent:10,guides:false,turbo:false,fps:25,
minZoom:1,maxZoom:1,renderer:"canvas",zoomEasing:COG.easing("quad.out"),zoomDuration:300,zoomLevel:1},b);var cb={},sa=[],Ia=0,db=document.getElementById(b.container),Ea=null,fc=0,dc=null,gc=y(window.attachEvent,"function"),qb=false,Gb=b.refreshDistance,na=0,oa=0,jb=0,kb=0,lb=0,mb=0,Ua=null,Va=null,eb=false,fb=false,wa=null,pb=false,Za=null,Db=0,pa=1,Fb=1,Eb=0,va=null,ob=false,ec=1E3/b.fps|0,Ra=0,bc,cc,Ya=b.zoomLevel,Hb=B("ACTIVE"),nb=B("PAN"),Ib=B("ZOOM"),Jb=B("ANIMATING"),Ma=Hb,ga={id:b.id,detach:function(){va&&
va.unbind()},eachLayer:function(z){for(var D=Ia;D--;)z(sa[D])},getLayer:function(z){for(var D=0;D<Ia;D++)if(sa[D].id===z)return sa[D];return null},getZoomLevel:function(){return Ya},setLayer:function(z,D){for(var J=0;J<Ia;J++)if(sa[J].id===z){sa.splice(J,1);break}D&&L(z,D);V();return D},invalidate:K,refresh:V,resetScale:function(){pa=1},scale:ka,setZoomLevel:za,syncXY:function(){},triggerAll:ra,removeLayer:function(z){a:{for(var D=Ia;D--;)if(sa[D].id===z){z=D;break a}z=-1}if(z>=0&&z<Ia){ga.trigger("layerRemoved",
sa[z]);sa.splice(z,1);Ra++}Ia=sa.length},getOffset:function(){return la.init(na,oa)},getRenderer:function(){return renderer},getScaleFactor:function(){return pa},setMaxOffset:function(z,D,J,Y){Ua=z;Va=D;eb=J;fb=Y},getViewport:X,updateOffset:Da,pan:function(z,D,J,Y,fa){Da(na+z,oa+D,J,Y,fa)}};COG.observable(ga);ga.bind("resync",function(){});COG.configurable(ga,["container","captureHover","captureDrag","scalable","pannable","inertia","minZoom","maxZoom","zoom"],COG.paramTweaker(b,null,{container:function(z,
D){db=document.getElementById(D);renderer=Ab(b.renderer,ga,db);C()},inertia:C,captureHover:C,scalable:C,pannable:C}),true);CANI.init(function(z){ga.markers=L("markers",new gb({zindex:20}));cb=z;renderer=Ab(b.renderer,ga,db);C();gc?window.attachEvent("onresize",H):window.addEventListener("resize",H,false)});animFrame(t);return ga},ya=function(b){b=COG.extend({style:null,xy:null,size:null,fill:false,stroke:true,draggable:false,observable:true,properties:{},typeName:"Shape"},b);COG.extend(this,b);this.id=
COG.objId(this.typeName);this.view=this.bounds=null;this.rotation=this.animations=0;this.scaling=1;this.translateY=this.translateX=0;this.observable&&COG.observable(this)};ya.prototype={constructor:ya,addToTree:function(b){b&&this.bounds&&b.insert(this.bounds,this)},animate:function(b,e,f,c){j(this,b,e,f,c)},drag:null,draw:null,getProps:null,resync:function(b){if(this.xy){b.syncXY([this.xy]);this.size&&this.updateBounds(Ha.fromCenter(this.xy.x,this.xy.y,this.size,this.size))}},rotate:function(b){this.rotation=
b},scale:function(b){this.scaling=b},translate:function(b,e){this.translateX=b;this.translateY=e},updateBounds:function(b,e){this.bounds=b;if(e)this.xy=Ha.center(this.bounds)}};var Wb=1E3/60|0,Xa=[],vb=0;x.prototype=COG.extend(ya.prototype,{constructor:x,prep:function(b){return b.arc(this.xy.x,this.xy.y,this.size>>1,0,Math.PI*2)}});l.prototype=COG.extend({},ya.prototype,{constructor:l});p.prototype=COG.extend({},l.prototype);o.prototype=COG.extend({},ya.prototype,{constructor:o});M.prototype=COG.extend({},
o.prototype,{constructor:M});G.prototype=COG.extend(ya.prototype,{constructor:G});A.prototype={constructor:A,clip:null,cycle:function(){},draw:function(){},hitGuess:null};Qa=function(b,e){function f(){a=new RTree}e=COG.extend({imageLoadArgs:{}},e);var c=b?yb.init(b,e).run:null,a=null,d=COG.extend(new A(e),{draw:function(g,k){var i=a?a.search(k):[];g.drawTiles(k,i)}});d.bind("refresh",function(g,k,i){var u=(new Date).getTime();a&&c(k,i,a,function(){k.invalidate();COG.info("GEN COMPLETED IN "+((new Date).getTime()-
u)+" ms")})});d.bind("parentChange",f);d.bind("resync",f);return d};var Lb=function(b){function e(k){clearTimeout(d);d=setTimeout(function(){c.sort(function(i,u){if(u.xy&&i.xy){var H=u.xy.y-i.xy.y;return H!=0?H:u.xy.x-i.xy.x}});k&&k.invalidate()},50)}function f(k,i){a=new RTree;for(var u=c.length;u--;){c[u].resync(i);c[u].addToTree(a)}e(i)}b=COG.extend({zindex:10},b);var c=[],a=null,d=0,g=COG.extend(new A(b),{add:function(k,i){if(k){k.layer=g;if(i)c.unshift(k);else c[c.length]=k;var u=g.view;if(u){k.resync(u);
k.addToTree(a);e(u)}}},clear:function(){c=[]},draw:function(k,i,u,H,O,L){H={};for(O=(a&&i?a.search(i):[]).length;O--;){var C=c[O],S=C.style||g.style,t,I=k.applyTransform(C),K=C.getProps?C.getProps(k,u):H;if(K=(t=k["prep"+C.typeName])?t.call(k,C,i,L,u,K):null){if(K.hit){L.elements.push(Hits.initHit(C.type,C,C.draggable?C.drag:null));t=L.type+"Style";S=C[t]||g[t]||S}S=S?k.applyStyle(S):null;(t=C.draw||K.draw)&&t.call(C,K);S&&k.applyStyle(S)}I&&I.undo&&I.undo()}},find:function(){return[].concat(c)},
hitGuess:function(k,i){return a&&a.search({x:k-10,y:i-10,w:20,h:20}).length>0}});g.bind("parentChange",f);g.bind("resync",f);return g},gb=function(b){return new Lb(b)};COG.extend(s,{ex:COG.extend,is:y,ticks:F,userMessage:function(b,e,f){s.trigger("userMessage",b,e,f)},XY:la,XYRect:Ha,Dimensions:ib,Vector:hb,Hits:Hits,Generator:yb,tweenValue:COG.tweenValue,easing:COG.easing,Tile:q,TileLayer:Qa,getImage:m,viewState:B,View:Kb,ViewLayer:A,ImageLayer:Qa,Drawable:ya,Marker:x,Poly:l,Line:p,Arc:G,ImageDrawable:o,
ImageMarker:M,DrawLayer:Lb,ShapeLayer:gb});COG.observable(s);var sb=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],Ca=Math.PI/180,Na=180/Math.PI,tb=ea,Mb=-tb,Nb=ba,hc=-Nb,bb=0.08181919084262157,$a=null,Ob={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",HWY:"HIGHWAY",MWY:"MOTORWAY"},ha=function(){function b(a){return a?f(a.lat,a.lon):null}function e(a){return!a||a.lat===0&&a.lon===0}function f(a,d){return{lat:parseFloat(a?a:0),
lon:parseFloat(d?d:0)}}function c(a){if(a)if(y(a.lat,xb))return b(a);else{if(a.split)for(var d=[" ",","],g=0;g<d.length;g++){var k=a.split(d[g]);if(k.length===2)return f(k[0],k[1])}}else return f();return null}return{calcDistance:function(a,d){if(e(a)||e(d))return 0;var g=(d.lat-a.lat)*Ca>>1,k=(d.lon-a.lon)*Ca>>1;g=N(g)*N(g)+U(a.lat*Ca)*U(d.lat*Ca)*N(k)*N(k);return 6371*2*xa(da(g),da(1-g))},copy:b,empty:e,equal:function(a,d){return a&&d&&a.lat==d.lat&&a.lon==d.lon},fromMercatorPixels:function(a,d){for(var g=
Q(Math.E,-d),k=ea-2*ua(g),i=$(k,g),u=0;u<12&&R(k-i)>1.0E-7;){k=i;i=$(k,g);u++}return f(i*Na,a%360*Na)},generalize:function(a,d,g){var k=a.length,i=[],u=null;g||(g=250);g/=1E3;COG.info("generalizing positions, must include "+d.length+" positions");for(var H=k;H--;)if(H===0)i.unshift(a[H]);else{var O=!u||ha.inArray(a[H],d)?g:ha.calcDistance(u,a[H]);if(a[H]&&O>=g){i.unshift(a[H]);u=a[H]}}COG.info("generalized "+k+" positions into "+i.length+" positions");return i},inArray:function(a,d){for(var g=ha.equal,
k=d.length;k--;)if(g(a,d[k]))return true;return false},inBounds:function(a,d){var g=!(ha.empty(a)||ha.empty(d));return g=(g=g&&a.lat>=d.min.lat&&a.lat<=d.max.lat)&&a.lon>=d.min.lon&&a.lon<=d.max.lon},init:f,offset:function(a,d,g){var k=a.lat*Ca;a=a.lon*Ca;d=k+d/6371;g=aa(N(g/6371)/U(k));g=a+g;d=(d+ea)%Math.PI-ea;g%=ba;return f(d*Na,g*Na)},parse:c,parseArray:function(a){var d=a.length,g=Array(d);for(d=d;d--;)g[d]=c(a[d]);return g},toMercatorPixels:function(a){return T5.XY.init(parseFloat(a.lon)*Ca,
W(a.lat))},toString:function(a){return a?a.lat+" "+a.lon:""},vectorize:function(a,d){function g(){for(var H=0,O=d.chunkSize,L=k;L--;){i[L]=T5.GeoXY.init(a[L]);H+=1;if(H>O)break}k=L;if(k<=0)d.callback&&d.callback(i);else animFrame(g)}var k=a.length,i=Array(k);d=COG.extend({chunkSize:500,async:true,callback:null},d);if(!d.async){for(var u=k;u--;)i[u]=T5.GeoXY.init(a[u]);return i}animFrame(g);return null}}}(),Ka=function(){function b(a,d,g){var k=T5.XY.init(0,d.lat-a.lat);k.x=(g||y(g,ta))&&a.lon>d.lon?
360-a.lon+d.lon:d.lon-a.lon;return k}function e(a,d){return Ka.init(ha.init(a.min.lat-d,a.min.lon-d%360),ha.init(a.max.lat+d,a.max.lon+d%360))}function f(a){var d=b(a.min,a.max);return ha.init(a.min.lat+(d.y>>1),a.min.lon+(d.x>>1))}function c(a,d){return{min:ha.parse(a),max:ha.parse(d)}}return{calcSize:b,createBoundsFromCenter:function(a,d){var g=d/6371,k=a.lat*Ca,i=a.lon*Ca,u=k-g,H=k+g;if(u>Mb&&H<tb){k=aa(N(g)/U(k));g=(i-k)%ba;i=(i+k)%ba}else{u=E(u,Mb);H=ca(H,tb);g=hc;i=Nb}return Ka.init(ha.init(u*
Na,g*Na),ha.init(H*Na,i*Na))},expand:e,forPositions:function(a,d){var g=null,k=T5.ticks();d||(d="auto");for(var i=a.length;i--;)if(g){var u=b(g.min,a[i],false),H=b(a[i],g.max,false);if(u.x<0)g.min.lon=a[i].lon;if(u.y<0)g.min.lat=a[i].lat;if(H.x<0)g.max.lon=a[i].lon;if(H.y<0)g.max.lat=a[i].lat}else g=c(a[i],a[i]);if(d){if(d=="auto"){i=b(g.min,g.max);d=E(i.x,i.y)*0.3}g=e(g,d)}COG.trace("calculated bounds for "+a.length+" positions",k);return g},getCenter:f,getGeoHash:function(a){var d=T5.Geo.GeoHash.encode(a.min.lat,
a.min.lon);a=T5.Geo.GeoHash.encode(a.max.lat,a.max.lon);COG.info("min hash = "+d+", max hash = "+a)},getZoomLevel:function(a,d){var g=f(a);g=ca(Ga(R(g.lat)*0.05),sb.length);var k=sb[g],i=b(a.min,a.max);g=Z(qa(sb[3]*d.h/i.y)/qa(2));k=Z(qa(k*d.w/i.x)/qa(2));return ca(isNaN(g)?1E3:g,isNaN(k)?1E3:k)},init:c,isEmpty:function(a){return!a||ha.empty(a.min)||ha.empty(a.max)},toString:function(a){return"min: "+ha.toString(a.min)+", max: "+ha.toString(a.max)}}}();hb=function(){var b=/^(\d+).*$/,e=/(\d+)\s?\-\s?(\d+)/;
return{buildingMatch:function(f,c){b.lastIndex=-1;if(b.test(f))for(var a=f.replace(b,"$1"),d=c.split(","),g=0;g<d.length;g++){e.lastIndex=-1;if(e.test(d[g])){var k=e.exec(d[g]);if(a>=parseInt(k[1],10)&&a<=parseInt(k[2],10))return true}else if(a==d[g])return true}return false},normalize:function(f){if(!f)return"";f=f.toUpperCase();if(!$a){var c=[];for(var a in Ob)c.push(a);$a=RegExp("(\\s)("+c.join("|")+")(\\s|$)","i")}$a.lastIndex=-1;if(c=$a.exec(f))f=f.replace($a,"$1"+Ob[c[2]]);return f},toString:function(f){return f.streetDetails+
" "+f.location}}}();var La=s.GeoXY=function(){function b(c,a){if(c.length){for(var d,g,k,i,u=c.length;u--;){b(c[u],a);d=y(d,ta)||c.x<d?c.x:d;g=y(g,ta)||c.y<g?c.y:g;k=y(k,ta)||c.x>k?c.x:k;i=y(i,ta)||c.y>i?c.y:i}return Ha.init(d,g,i,i)}else if(c.mercXY){d=c.mercXY;c.x=(d.x+Math.PI)/a|0;c.y=(Math.PI-d.y)/a|0;c.rpp=a}else COG.warn("Attempted to sync an XY composite, not a GeoXY");return c}function e(c,a){if(c.length)for(var d=c.length;d--;)e(c[d],a);else{c.mercXY=la.init(c.x*a-Math.PI,Math.PI-c.y*a);
c.pos=ha.fromMercatorPixels(c.mercXY.x,c.mercXY.y)}return c}function f(c,a,d){c.pos=a;c.mercXY=ha.toMercatorPixels(a);(d=y(d,xb)?d:c.rpp)&&b(c,d)}return{init:function(c,a){var d=la.init();f(d,c,a);return d},sync:b,syncPos:e,toPos:function(c,a){a=a||c.rpp;return ha.fromMercatorPixels(c.x*a-Math.PI,Math.PI-c.y*a)},updatePos:f}}(),Pa={};ib=function(){return{bestResults:function(b,e){e||(e=20);for(var f=b.length>0?b[0]:null,c=[],a=0;a<b.length;a++)if(f&&b[a]&&f.matchWeight-b[a].matchWeight<=e)c.push(b[a]);
else break;return c}}}();var Pb=function(b){b=COG.extend({id:null,caption:"",resultType:"",data:null,pos:null,matchWeight:0},b);return COG.extend(b,{toString:function(){return b.caption+(b.matchWeight?" ("+b.matchWeight+")":"")}})};Qa=function(){function b(a,d){var g=new T5.ShapeLayer;d.geometry&&ha.vectorize(d.geometry,{callback:function(k){g.add(new T5.Line(k,{style:"waypoints",simplify:true}));a.setLayer("route",g)}})}function e(a){for(var d=f.Unknown,g=c,k=0;k<g.length;k++){g[k].regex.lastIndex=
-1;var i=g[k].regex.exec(a);if(i){d=g[k].customCheck?g[k].customCheck(a,i):g[k].turnType;break}}return d}var f={Unknown:"turn-unknown",Start:"turn-none-start",Continue:"turn-none",Arrive:"turn-none-arrive",TurnLeft:"turn-left",TurnLeftSlight:"turn-left-slight",TurnLeftSharp:"turn-left-sharp",TurnRight:"turn-right",TurnRightSlight:"turn-right-slight",TurnRightSharp:"turn-right-sharp",Merge:"merge",UTurnLeft:"uturn-left",UTurnRight:"uturn-right",EnterRoundabout:"roundabout-enter",Ramp:"ramp",RampExit:"ramp-exit"},
c=function(){var a=[];a.push({regex:/continue/i,turnType:f.Continue});a.push({regex:/(take|bear|turn)(.*?)left/i,customCheck:function(d,g){return/bear/i.test(g[1])?f.TurnLeftSlight:f.TurnLeft}});a.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(d,g){return/bear/i.test(g[1])?f.TurnRightSlight:f.TurnRight}});a.push({regex:/enter\s(roundabout|rotaty)/i,turnType:f.EnterRoundabout});a.push({regex:/take.*?ramp/i,turnType:f.Ramp});a.push({regex:/take.*?exit/i,turnType:f.RampExit});a.push({regex:/make(.*?)u\-turn/i,
customCheck:function(d,g){return/right/i.test(g[1])?f.UTurnRight:f.UTurnLeft}});a.push({regex:/proceed/i,turnType:f.Start});a.push({regex:/arrive/i,turnType:f.Arrive});a.push({regex:/fell\sthrough/i,turnType:f.Merge});return a}();return{calculate:function(a){a=COG.extend({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},a);var d=P("route");d&&d.route(a,function(g){if(a.generalize)g.geometry=ha.generalize(g.geometry,g.getInstructionPositions());if(a.map){b(a.map,
g);a.autoFit&&a.map.gotoBounds(g.boundingBox)}a.success&&a.success(g)})},createMapOverlay:b,parseTurnType:e,TurnType:f,Instruction:function(a){var d=a=COG.extend({position:null,description:"",distance:0,distanceTotal:0,time:0,timeTotal:0,turnType:null},a),g=a.description;g=g.replace(/(\w)(\/)(\w)/g,"$1 $2 $3");d.description=g;if(!a.turnType)a.turnType=e(a.description);return a},RouteData:function(a){a=COG.extend({geometry:[],instructions:[],boundingBox:null},a);if(!a.boundingBox)a.boundingBox=Ka.forPositions(a.geometry);
return COG.extend({getInstructionPositions:function(){for(var d=[],g=0;g<a.instructions.length;g++)a.instructions[g].position&&d.push(a.instructions[g].position);return d}},a)}}}();var ic="featurecollection",jc="feature",wb={async:false},Sa={processor:null,group:"shapes",layerClass:gb},kc={point:COG.extend({},Sa,{processor:function(b,e,f,c){e=T([e.coordinates],wb);if(e.length>0)if(f=c.marker(e[0],f)){b.add(f);return e.length}},group:"markers",layerClass:gb}),linestring:COG.extend({},Sa,{processor:function(b,
e,f,c){e=T(e&&e.coordinates?e.coordinates:[]);return ia(b,e,f,c.line)}}),multilinestring:COG.extend({},Sa,{processor:function(b,e,f,c){e=e&&e.coordinates?e.coordinates:[];for(var a=0,d=e.length;d--;)a+=ia(b,e[d],f,c.line);return a}}),polygon:COG.extend({},Sa,{processor:function(b,e,f,c){e=e&&e.coordinates?e.coordinates:[];if(e.length>0)return ia(b,e[0],f,c.poly);return 0}}),multipolygon:COG.extend({},Sa,{processor:function(b,e,f,c){e=e&&e.coordinates?e.coordinates:[];for(var a=0,d=0;d<e.length;d++)a+=
ia(b,e[d][0],f,c.poly);return a}})},Qb=function(b,e,f,c){function a(t,I){var K=t.processor,X=u+t.group,V=COG.extend({},t,f,{properties:I.properties});if(K){var ka=S[X];if(!ka){ka=new t.layerClass({id:X});S[X]=ka}return K(ka,I.data,V,c)}return 0}function d(t,I){var K=t&&t.type?t.type.toLowerCase():null;return K&&K===jc?d(t.geometry,t.properties):{type:K,isCollection:K?K===ic:false,definition:kc[K],data:t,properties:I?I:t.properties}}function g(t){var I=0,K=COG.extend({},f),X=H;t=t?t:(new Date).getTime();
if(!L){for(;X<O;X++){t=d(i?i(b[X]):b[X]);var V=null;if(t.isCollection){K.layerPrefix=u+C++ +"-";L=new Qb(t.data.features,function(ka){L=null;for(var za in ka)S[za]=ka[za];H>=O&&e&&e(S)},K);V+=1}else if(t.definition)V=a(t.definition,t);I+=V?V:1;if(I>=k)break}H=X+1;if(L||H<O)animFrame(g);else e&&e(S)}}f=COG.extend({rowPreParse:null,simplify:false,layerPrefix:"geojson-"},f);c=COG.extend({marker:function(t){return new x({xy:t})},line:function(t,I){return new l(t,COG.extend({},f,I))},poly:function(t,I){return new l(t,
COG.extend({fill:true},f,I))}},c);var k=500,i=f.rowPreParse,u=f.layerPrefix,H=0,O=0,L=null,C=0,S={};if(b){y(b,"array")||(b=[b]);O=b.length;animFrame(g)}};Sa=s.GeoJSON={parse:function(b,e,f){return new Qb(b,e,f)}};s.Map=function(b){function e(C){try{var S=ha.init(C.coords.latitude,C.coords.longitude),t=C.coords.accuracy/1E3;L.trigger("locationUpdate",C,t);if(u){if(!k){k=new UI.LocationOverlay({pos:S,accuracy:t});k.update(L.getTileLayer());L.setLayer("location",k)}var I=Ka.createBoundsFromCenter(S,
Math.max(t,1));L.gotoBounds(I)}else{k.pos=S;k.accuracy=t;k.update(L.getTileLayer());a(S,null,COG.easing("sine.out"))}u=false}catch(K){COG.exception(K)}}function f(C){COG.info("caught location tracking error:",C)}function c(C,S,t){L.setZoomLevel(S);a(C,t)}function a(C,S,t,I){C=La.init(C,ja(L.getZoomLevel()));L.updateOffset(C.x-(L.width>>1),C.y-(L.height>>1),t,I,function(){S&&S(L)})}b=COG.extend({tapExtent:10,crosshair:false,zoomLevel:0,minZoom:1,maxZoom:18,pannable:true,scalable:true},b);var d={NONE:0,
SINGLE:1,WATCH:2};la.init();var g=d.NONE,k=null,i=0,u=true,H=0,O=b.tapExtent;b.adjustScaleFactor=function(C){return Math.pow(2,(C<1?Math.floor:Math.ceil)(Math.log(C)))};var L=COG.extend(new Kb(b),{getBoundingBox:function(){var C=L.getViewport();return C?Ka.init(La.toPos(la.init(C.x,C.y2),H),La.toPos(la.init(C.x2,C.y),H)):null},getCenterPosition:function(){var C=L.getViewport();if(C){C=la.init(C.x+(C.w>>1),C.y+(C.h>>1));return La.toPos(C,H)}return null},gotoBounds:function(C,S){var t=Ka.getZoomLevel(C,
L.getViewport());c(Ka.getCenter(C),t,S)},gotoPosition:c,panToPosition:a,syncXY:function(C,S){return(S?La.syncPos:La.sync)(C,H)},locate:function(){L.trackStart(d.SINGLE);setTimeout(L.trackCancel,1E4)},trackStart:function(C){if(navigator.geolocation&&!i){g=C?C:d.WATCH;u=true;i=navigator.geolocation.watchPosition(e,f,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3})}},trackCancel:function(){i&&navigator.geolocation&&navigator.geolocation.clearWatch(i);L.removeLayer("location");k=null;g=d.NONE;i=
0},animateRoute:function(C,S,t,I){var K=L.getLayer("route");if(K)(C=K.getAnimation(C,S,t,I))&&C.addToView(L)}});L.bind("pan",function(){g===d.SINGLE&&L.trackCancel()});L.bind("tap",function(C,S,t,I){C=La.toPos(I,H);var K=La.toPos(la.offset(I,-O,O),H);I=La.toPos(la.offset(I,O,-O),H);L.trigger("geotap",S,t,C,Ka.init(K,I))});L.bind("refresh",function(){L.trigger("boundsChange",L.getBoundingBox())});L.bind("zoomLevelChange",function(C,S){var t;H=ja(S);t=ba/H|0;L.setMaxOffset(t,t,true,false);L.resetScale();
L.triggerAll("resync",L)});return L};s.GeoShape=function(b,e){e=COG.extend({autoParse:true},e);for(var f=Array(b.length),c=e.autoParse,a=T5.Geo.Position.parse,d=b.length;d--;)f[d]=T5.GeoXY.init(c?a(b[d]):b[d]);return new T5.Poly(f,e)};s.LocationOverlay=function(b){b=COG.extend({pos:null,accuracy:null,zindex:90},b);var e=new Image,f=T5.XY.init(),c=T5.XY.init(),a=null;e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAACIQAAAiEBPhEQkwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAG+SURBVCiRlZHNahNRAIW/O7mTTJPahLZBA1YUyriINRAE3bQIKm40m8K8gLj0CRQkO32ELHUlKbgoIu4EqeJPgtCaoBuNtjXt5LeTMZk0mbmuWiuuPLsD3+HAOUIpxf9IHjWmaUbEyWv5ROrsVULhcHP761rUfnN3Y2Otc8CIg4YT85lzuVsPP+Qupw1vpPjRCvhS9ymvV0e77x7nNj+uvADQAIQQ+uLyvdfLV9JGZi7EdEwQlqBpEJ019f0z1mo2u5Q8DMydv25lshemmj1FueZTawbs7inarqLbV7Qjab1upB9YlhWSAHLavLHZCvg1VEhN0PMU9W7At4bPVidg7CtkLLXkut+lBPD6/Ub155jJiADAHSpaLmx3ApyBQoYEUd0PBoOBkAC6+3llvda/YxgGgYL+UNHf/zN3KiExGlsvTdP0NYDkhPdWrz35ZDsBzV5wCMuQwEyFmXFeeadjzfuFQmGkAZRKpdGC/n7x+M6jqvA9Zo6FWDhlcHE+wqT93J1tP7vpOE7rrx8ALMuasPf8S12St4WmJ6bYWTUC52k8Hm8Vi0X/nwBAPp/XKpWKdF1X2LYdlMvlsToC/QYTls7DLFr/PAAAAABJRU5ErkJggg%3D%3D";
e.onload=function(){f=T5.XY.init(e.width>>1,e.height>>1)};var d=COG.extend(new T5.ViewLayer(b),{pos:b.pos,accuracy:b.accuracy,drawAccuracyIndicator:false,draw:function(g,k){var i=c.x-k.x,u=c.y-k.y;if(a){g.fillStyle="rgba(30, 30, 30, 0.2)";g.beginPath();g.arc(i,u,a,0,Math.PI*2,false);g.fill()}e.complete&&e.width>0&&g.drawImage(e,i-f.x,u-f.y,e.width,e.height)},update:function(g){if(g){a=g.getPixelDistance(d.accuracy)>>1;c=g.getGridXYForPosition(d.pos)}}});d.bind("gridUpdate",function(g,k){d.update(k)});
return d};s.Geo={distanceToString:function(b){if(b>1E3)return~~(b/10)/100+" km";return b?b+" m":""},dist2rad:function(b){return b/6371},getEngine:P,radsPerPixel:ja,Position:ha,BoundingBox:Ka,Radius:function(b,e){return{distance:parseInt(b,10),uom:e}},Address:function(b){return b=COG.extend({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},b)},A:hb,GeocodeFieldWeights:{streetDetails:50,location:50},AddressCompareFns:{},Engine:function(b){if(!b.id)throw Error("A GEO.Engine cannot be registered without providing an id.");
var e=COG.extend({remove:function(){delete Pa[e.id]}},b);return Pa[e.id]=e},Search:ib,GeoSearchResult:Pb,LocationSearch:function(b){function e(g,k){navigator.geolocation.clearWatch(c);c=0;if(a){clearTimeout(a);a=0}k&&k([g],b)}function f(g){COG.info("caught location tracking error:",g)}b=COG.extend({name:"Geolocation Search",requiredAccuracy:null,searchTimeout:5E3,watch:false},b);var c=0,a=0,d=null;return new T5.Geo.GeoSearchAgent(COG.extend({execute:function(g,k){if(navigator.geolocation&&!c){c=navigator.geolocation.watchPosition(function(i){var u=
ha.init(i.coords.latitude,i.coords.longitude);i=new Pb({id:1,caption:"Current Location",pos:u,accuracy:i.coords.accuracy/1E3,matchWeight:100});if(!d||i.accuracy<d.accuracy)d=i;if(!b.requiredAccuracy||d.accuracy<b.requiredAccuracy)e(d,k)},f,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3});if(b.searchTimeout)a=setTimeout(function(){d&&e(d,k)},b.searchTimeout)}}},b))},Routing:Qa,GeoJSON:Sa}})(T5);
