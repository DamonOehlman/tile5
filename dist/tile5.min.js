(function(ob){function H(){var a=arguments[0]||{},c=Array.prototype.slice.call(arguments,1),b,e;for(e=c.length;e--;)if((b=c[e])!==null)for(var k in b){var f=b[k];if(a!==f)if(f!==undefined)a[k]=f}return a}function na(a,c){if(typeof console!=="undefined")console[c||"debug"](a)}function Za(a){var c=a.match(Fb),b=[],e=0,k;for(k=c?c.length:0;k--;){var f=c[k].slice(1);b[f]||(b[f]=RegExp("\\{"+f+"\\}","g"))}e=b.length;return function(){var h=a;for(k=0;k<e;k++)h=h.replace(b[k],arguments[k]||"");return h}}
function Gb(a){a=a.replace(/[\-\_\s\.]/g,"").toLowerCase();return Ga[a]||Ga.linear}function Hb(a,c,b,e,k){function f(i){i=i?i:(new Date).getTime();var j=i-h,g=b(j,a,d,e),q=h+e<=i;i=!q;if(k){j=k(g,q,j);i=typeof j!="undefined"?j&&i:i}i&&animFrame(f)}var h=(new Date).getTime(),d=c-a;animFrame(f);return{}}function pb(a,c){var b=Na*ta(a);return Ha-2*qb(c*ua((1-b)/(1+b),Na/2))}function fa(a,c){this.x=a||0;this.y=c||0}function Y(a,c){this.mercY=this.mercX=null;if(T(a,za))rb.parseXY(a,this);else if(a&&a.toPixels){var b=
a.toPixels();this.mercX=b.x;this.mercY=b.y}else fa.call(this,a,c)}function oa(a,c,b,e){this.x=a||0;this.y=c||0;this.w=b||0;this.h=e||0;this.x2=this.x+this.w;this.y2=this.y+this.h}function sb(a,c){var b=new tb(Math.sqrt(256<<a)|0);c&&c.zoomLevel===a&&c.copyInto(b);b.zoomLevel=a;return b}function ub(a){a=a||(new Date).getTime();for(var c=0;c<Aa.length;){var b=Aa[c],e=va[b],k=va[b].image&&va[b].image.complete&&va[b].image.width>0,f=a-e.start;f=k||f>=Ib;if(k){k=e.callbacks;vb[b]=e.image;for(var h=0;h<
k.length;h++)k[h](e.image,true)}if(f){Aa.splice(c,1);delete va[b]}else c++}Aa.length>0&&animFrame(ub)}function Oa(a,c){var b=a&&c?vb[a]:null;if(b&&b&&b.complete&&b.width>0)c(b);else{if(b=va[a])b.callbacks.push(c);else{b=new Image;b.id="_ldimg"+ ++Jb;va[a]={start:(new Date).getTime(),image:b,callbacks:[c]};b.src=a;Aa[Aa.length]=a}animFrame(ub)}}function $a(a,c,b,e,k,f){this.x=a;this.y=c;this.w=e||256;this.h=e||256;this.x2=this.x+this.w;this.y2=this.y+this.h;this.url=b;this.id=f||a+"_"+c;this.loaded=
false;this.image=null}function Pa(a,c){c=H({id:"layer_"+Kb++,zindex:0,animated:false,style:null,minXY:null,maxXY:null},c);this.visible=true;ga(H(this,c))}function Qa(){ga(this)}function ha(a,c){if(a&&a.split){var b=a.split(wb);if(b.length>1){a=b[0];c=b[1]}}else if(a&&a.lat){c=a.lon;a=a.lat}this.lat=parseFloat(a||0);this.lon=parseFloat(c||0)}function Ra(a,c){if(T(a,Lb)){for(var b=c,e=this.min=new ha(xb,yb),k=this.max=new ha(Mb,Nb),f=a.length;f--;){var h=a[f];if(h.lat<e.lat)e.lat=h.lat;if(h.lat>k.lat)k.lat=
h.lat;if(h.lon<e.lon)e.lon=h.lon;if(h.lon>k.lon)k.lon=h.lon}if(T(b,ia)){b=calcSize(bounds.min,bounds.max);b=ab(b.x,b.y)*0.3}this.expand(b)}else{this.min=a;this.max=c}}var bb={};(function(a){var c=[],b=0,e=false,k=a.register=function(f,h){c.push({section:f,run:h})};a.init=function(f){function h(){if(b<c.length){var i=c[b++];d[i.section]||(d[i.section]={});i.run(d[i.section],h)}else{for(i in d)a[i]=d[i];e=true;f&&f(a)}}var d={};if(e&&f)f(a);else{b=0;h()}};k("canvas",function(f,h){function d(){var q,
l=i.getContext("2d");l.save();try{l.translate(50,50);l.beginPath();l.rect(0,0,20,20);q=l.isPointInPath(10,10)}finally{l.restore()}return q}var i=document.createElement("canvas"),j=typeof FlashCanvas!="undefined",g=typeof G_vmlCanvasManager!="undefnined";i.width=200;i.height=200;f.pipTransformed=j||g?false:d();h()})})(bb);window.animFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||
function(a){setTimeout(function(){a((new Date).getTime())},1E3/60)}}();var Fb=/\{(\d+)(?=\})/g,Ga=function(){var a=1.70158,c=Math.PI/2,b=Math.abs,e=Math.pow,k=Math.sin,f=Math.asin,h=Math.cos;return{linear:function(d,i,j,g){return j*d/g+i},backin:function(d,i,j,g){return j*(d/=g)*d*((a+1)*d-a)+i},backout:function(d,i,j,g){return j*((d=d/g-1)*d*((a+1)*d+a)+1)+i},backinout:function(d,i,j,g){return(d/=g/2)<1?j/2*d*d*(((a*=1.525)+1)*d-a)+i:j/2*((d-=2)*d*(((a*=1.525)+1)*d+a)+2)+i},bouncein:function(d,i,
j,g){return j-Ga.bounceout(g-d,0,j,g)+i},bounceout:function(d,i,j,g){return(d/=g)<1/2.75?j*7.5625*d*d+i:d<2/2.75?j*(7.5625*(d-=1.5/2.75)*d+0.75)+i:d<2.5/2.75?j*(7.5625*(d-=2.25/2.75)*d+0.9375)+i:j*(7.5625*(d-=2.625/2.75)*d+0.984375)+i},bounceinout:function(d,i,j,g){return d<g/2?Ga.bouncein(d*2,0,j,g)/2+i:Ga.bounceout(d*2-g,0,j,g)/2+j/2+i},cubicin:function(d,i,j,g){return j*(d/=g)*d*d+i},cubicout:function(d,i,j,g){return j*((d=d/g-1)*d*d+1)+i},cubicinout:function(d,i,j,g){if((d/=g/2)<1)return j/2*
d*d*d+i;return j/2*((d-=2)*d*d+2)+i},elasticin:function(d,i,j,g,q,l){if(d==0)return i;if((d/=g)==1)return i+j;l||(l=g*0.3);if(!q||q<b(j)){q=j;j=l/4}else j=l/Z*f(j/q);return-(q*e(2,10*(d-=1))*k((d*g-j)*Z/l))+i},elasticout:function(d,i,j,g,q,l){var n;if(d==0)return i;if((d/=g)==1)return i+j;l||(l=g*0.3);if(!q||q<b(j)){q=j;n=l/4}else n=l/Z*f(j/q);return q*e(2,-10*d)*k((d*g-n)*Z/l)+j+i},elasticinout:function(d,i,j,g,q,l){var n;if(d==0)return i;if((d/=g/2)==2)return i+j;l||(l=g*0.3*1.5);if(!q||q<b(j)){q=
j;n=l/4}else n=l/Z*f(j/q);if(d<1)return-0.5*q*e(2,10*(d-=1))*k((d*g-n)*Z/l)+i;return q*e(2,-10*(d-=1))*k((d*g-n)*Z/l)*0.5+j+i},quadin:function(d,i,j,g){return j*(d/=g)*d+i},quadout:function(d,i,j,g){return-j*(d/=g)*(d-2)+i},quadinout:function(d,i,j,g){if((d/=g/2)<1)return j/2*d*d+i;return-j/2*(--d*(d-2)-1)+i},sinein:function(d,i,j,g){return-j*h(d/g*c)+j+i},sineout:function(d,i,j,g){return j*k(d/g*c)+i},sineinout:function(d,i,j,g){return-j/2*(h(Math.PI*d/g)-1)+i}}}();if(typeof animFrame==="undefined")throw Error("animFrame COG required for tweening support");
var ga=function(){function a(b,e){var k=b.hasOwnProperty("obsHandlers")?b.obsHandlers:null;k[e]||(k[e]=[]);return k[e]}var c=0;return function(b){if(!b)return null;if(!(b.hasOwnProperty("obsHandlers")?b.obsHandlers:null))b.obsHandlers={};if(!b.hasOwnProperty("bind")){b.bind=function(e,k){var f="callback"+c++;a(b,e).unshift({fn:k,id:f});return f};b.triggerCustom=function(e,k){var f=a(b,e),h={cancel:false,name:e,source:this},d;for(d in k)h[d]=k[d];if(!f)return null;d=Array.prototype.slice.call(arguments,
2);b.eventInterceptor&&b.eventInterceptor(e,h,d);d.unshift(h);for(var i=f.length;i--&&!h.cancel;)f[i].fn.apply(this,d);return h};b.trigger=function(e){var k=Array.prototype.slice.call(arguments,1);k.splice(0,0,e,null);return b.triggerCustom.apply(this,k)};b.unbind=function(e,k){if(typeof e==="undefined")b.obsHandlers={};else for(var f=a(b,e),h=0;f&&h<f.length;h++)if(f[h].id===k){f.splice(h,1);break}return b}}return b}}(),Ob=function(){function a(c,b,e,k){if(typeof c[k]=="undefined")c[k]=function(f){if(typeof f!=
"undefined"){b[k]=f;e[k]&&e[k](f);return c}else return b[k]}}return function(c,b,e){for(var k in b)a(c,b,e,k)}}(),cb=Array.prototype.indexOf||function(a){for(var c=0;c<this.length;c++)if(this[c]===a)return c;return-1},T=function(){return function(a,c){c=Pb.call(c);if(c=="finite")return!Qb[Rb](+a);return c=="null"&&a===null||c==typeof a||c=="object"&&a===Object(a)||c=="array"&&Array.isArray&&Array.isArray(a)||Sb.call(a).slice(8,-1).toLowerCase()==c}}();(function(){function a(k){var f=document.createElement("script"),
h=false;f.src=k;f.async=true;f.onload=f.onreadystatechange=function(){if(!h&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){h=true;f.onload=f.onreadystatechange=null;f&&f.parentNode&&f.parentNode.removeChild(f)}};b||(b=document.getElementsByTagName("head")[0]);b.appendChild(f)}var c=0,b,e=this;return function(k,f,h){k+=k.indexOf("?")>=0?"&":"?";var d="json"+ ++c;e[d]=function(i){f(i);e[d]=null;try{delete e[d]}catch(j){}};a(k+(h?h:"callback")+"="+d);return d}})();INTERACT=
function(){function a(l){return function(n,p){l.addEventListener(n,p,false)}}function c(l){return function(n,p){l.removeEventListener(n,p,false)}}function b(l){return function(n,p){l.attachEvent("on"+n,p)}}function e(l,n){return{x:l?l:0,y:n?n:0,count:1}}function k(l,n){g.push(H({handler:null,checks:{},type:l},n))}function f(l){var n=0,p=0;if(l.offsetParent){do{n+=l.offsetLeft;p+=l.offsetTop;l=l.offsetParent}while(l)}return{left:n,top:p}}function h(l,n){return{source:l,target:n.target?n.target:n.srcElement}}
function d(l,n){for(var p=l.target?l.target:l.srcElement;p&&p!==n;)p=p.parentNode;return p&&p===n}function i(l,n){return{x:l.x-(n?n.left:0),y:l.y-(n?n.top:0)}}function j(l,n){if(l.preventDefault){l.preventDefault();l.stopPropagation()}else if(typeof l.cancelBubble!="undefined")l.cancelBubble=true;n&&l.stopImmediatePropagation&&l.stopImmediatePropagation()}var g=[],q=function(l,n,p){p=H({binder:null,unbinder:null,observable:null},p);for(var x=p.observable,B=[],G,M,N={bind:function(){return x.bind.apply(null,
arguments)},unbind:function(){x.unbind();for(L=0;L<B.length;L++)B[L].unbind();return N}},L=0;L<n.length;L++)B.push(n[L](l,x,p));x.bind("pointerDown",function(){M=G=0});x.bind("pointerMove",function(r,A,v,u){G+=u.x||0;M+=u.y||0});x.bind("pointerUp",function(r,A,v){Math.abs(G)>20||Math.abs(M)>20||x.triggerCustom("tap",r,A,v)});return N};k("pointer",{handler:function(l,n,p){function x(s){if(s.pageX&&s.pageY)return e(s.pageX,s.pageY);else{var I=document.documentElement,R=document.body;return e(s.clientX+
(I&&I.scrollLeft||R&&R.scrollLeft||0)-(I&&I.clientLeft||R&&R.clientLeft||0),s.clientY+(I&&I.scrollTop||R&&R.scrollTop||0)-(I&&I.clientTop||R&&R.clientTop||0))}}function B(s){if(d(s,l))if(u=L(s)){var I=x(s);l.style.cursor="move";j(s,true);O=I.x;J=I.y;w=e(O,J);n.triggerCustom("pointerDown",h("mouse",s),w,i(w,f(l)))}}function G(s){var I=x(s);z=I.x;D=I.y;if(d(s,l))r(s,u?"pointerMove":"pointerHover")}function M(s){if(u&&L(s)){u=false;if(d(s,l)){l.style.cursor="default";r(s,"pointerUp")}}}function N(s){if(d(s,
l)){var I;s=s||window.event;if(s.detail)I=s.axis===2?-s.detail*A:0;else{I=s.wheelDeltaY?s.wheelDeltaY:s.wheelDelta;if(window.opera)I=-I}if(I!==0){var R=e(z,D);n.triggerCustom("zoom",h("mouse",s),R,i(R,f(l)),I/v,"wheel");j(s);s.returnValue=false}}}function L(s){s=s||window.event;return(s.which||s.button)==1}function r(s,I,R,$,ea){R=typeof R!="undefined"?R:z;$=typeof $!="undefined"?$:D;var y=R-O,E=$-J,F=e(R,$);n.triggerCustom(I,h("mouse",s),F,i(F,f(l)),e(y,E));if(typeof ea=="undefined"||ea){O=R;J=$}}
p=H({},p);var A=120,v=A*8,u=false,w,z,D,O,J;p.binder("mousedown",B);p.binder("mousemove",G);p.binder("mouseup",M);p.binder("dblclick",function(s){na("captured double click");if(d(s,l)){var I=x(s);n.triggerCustom("doubleTap",h("mouse",s),I,i(I,f(l)))}});p.binder("mousewheel",N);p.binder("DOMMouseScroll",N);return{unbind:function(){p.unbinder("mousedown",B);p.unbinder("mousemove",G);p.unbinder("mouseup",M);p.unbinder("mousewheel",N);p.unbinder("DOMMouseScroll",N)}}},checks:{touch:false}});k("pointer",
{handler:function(l,n,p){function x(y){if(y.count<2)return 0;var E=y.x-y.next.x;y=y.y-y.next.y;return~~Math.sqrt(E*E+y*y)}function B(y,E,F){E=E?E:0;F=F?F:0;for(var P={x:y.x-E,y:y.y-F,id:y.id,count:y.count},Q=P;y.next;){y=y.next;Q=Q.next={x:y.x-E,y:y.y-F,id:y.id}}return P}function G(y,E){var F=y[E?E:"touches"],P,Q;if(F.length===0)return null;Q=P={x:F[0].pageX,y:F[0].pageY,id:F[0].identifier,count:F.length};for(var W=1,Ba=F.length;W<Ba;W++)Q=Q.next={x:F[W].pageX,y:F[W].pageY,id:F[W].identifier};return P}
function M(y){if(d(y,l)){D=f(l);var E=G(y,"changedTouches"),F=B(E,D.left,D.top);if(!J){O=u;n.triggerCustom("pointerDown",h("touch",y),E,F)}$&&n.triggerCustom("pointerDownMulti",h("touch",y),E,F);J=G(y);if(J.count>1)I=x(J);ea=1;R=B(J)}}function N(y){if(d(y,l)){j(y);s=G(y);if(O==u)O=Math.abs(J.x-s.x)>A||Math.abs(J.y-s.y)>A?v:u;if(O!=u){O=s.count>1?z:w;if(O==z)if(J.count===1){J=B(s);I=x(J)}else{var E=x(s);if(Math.abs(I-E)<r)O=w;else{var F;F=s.x;var P=s.next.x,Q=s.y,W=s.next.y;F={x:(F<P?F:P)+(Math.abs(F-
P)>>1),y:(Q<W?Q:W)+(Math.abs(Q-W)>>1)};E=E/I;P=E-ea;n.triggerCustom("zoom",h("touch",y),F,i(F,D),P,"pinch");ea=E}}O==w&&n.triggerCustom("pointerMove",h("touch",y),s,B(s,D.left,D.top),e(s.x-R.x,s.y-R.y));$&&n.triggerCustom("pointerMoveMulti",h("touch",y),s,B(s,D.left,D.top))}R=B(s)}}function L(y){if(d(y,l)){var E=G(y,"changedTouches"),F=B(E,D.left,D.top);s=G(y);if(!s){n.triggerCustom("pointerUp",h("touch",y),E,F);J=null}$&&n.triggerCustom("pointerUpMulti",h("touch",y),E,F)}}p=H({detailed:false,inertia:false},
p);var r=20,A=7,v=0,u=1,w=2,z=3,D,O,J,s,I,R,$=p.detailed,ea=1;p.binder("touchstart",M);p.binder("touchmove",N);p.binder("touchend",L);na("initialized touch handler");return{unbind:function(){p.unbinder("touchstart",M);p.unbinder("touchmove",N);p.unbinder("touchend",L)}}},checks:{touch:true}});return{register:k,watch:function(l,n,p){n=H({bindTarget:null,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},n);capabilities=H({touch:"ontouchstart"in window},p);if(!n.observable){na("creating observable");
n.observable=ga({});globalOpts=n}n.binder=(n.isIE?b:a)(n.bindTarget||document);n.unbinder=(n.isIE?b:c)(n.bindTarget||document);p=n.types;for(var x=capabilities,B=[],G=g.length;G--;){var M=g[G],N=!p||p.indexOf(M.type)>=0,L=true,r;for(r in M.checks){var A=M.checks[r];na("checking "+r+" capability. require: "+A+", capability = "+x[r]);L=L&&A===x[r]}if(N&&L)B[B.length]=M.handler}return new q(l,B,n)}}}();var db=function(){var a={};return{create:function(c,b){if(a[c][b])return a[c][b].apply(null,Array.prototype.slice.call(arguments,
2))},register:function(c,b,e){a[c]||(a[c]={});a[c][b]&&na(Tb(c,b),"warn");a[c][b]=e}}}(),Tb=Za("Registration of {0}: {1} will override existing definition"),eb=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],Z=Math.PI*2,Ha=Math.PI/2,ja=Math.PI/180,Ca=180/Math.PI,xb=Ha,Mb=-xb,yb=Z,Nb=-yb,Na=0.08181919084262157,pa=Math.abs,zb=Math.ceil,Ia=Math.round,Sa=Math.min,ab=Math.max,ua=Math.pow,Ab=Math.sqrt,wa=Math.log,ta=Math.sin,Ub=Math.asin,fb=Math.cos,qb=Math.atan,
Vb=Math.atan2,Rb="hasOwnProperty",Qb={NaN:1,Infinity:1,"-Infinity":1},Pb=String.prototype.toLowerCase,Sb=Object.prototype.toString,ia="undefined",za="string",qa="number",Lb="array",aa=db.register,xa=db.create,Wb=0,Kb=0,wb=/[\,\s]+/,Xb=function(){function a(k){e++;k=k||(new Date).getTime();for(var f=b.length;f--;){var h=b[f];e%h.every===0&&h.cb(k)}animFrame(a)}var c=1E3/60,b=[],e=0;animFrame(a);return{attach:function(k,f){b[b.length]={cb:k,every:f?Ia(f/c):1}},detact:function(){}}}(),rb=function(){var a=
/^xy\((.*)\).*$/i;return{parseXY:function(c,b){b=b||new Y;if(!a.test(c)){var e=c.split(wb);e=Ta(e[1],e[0]);b.mercX=e.x;b.mercY=e.y}return b}}}(),V=function(){function a(e){for(var k=0;k<e.length;k++){var f=e[k];if(typeof document.body.style[f]!="undefined")return f}}var c={"-webkit-user-select":"none",position:"absolute"},b;b=a(["-webkit-transform","MozTransform"]);css3DTransformProp=a(["WebkitPerspective","MozPerspective"]);return{transforms:T(b,za),create:function(e,k,f){e=document.createElement(e);
var h=[];f=f||{};e.className=k||"";for(var d in f)h[h.length]=d+": "+f[d];e.style.cssText=h.join(";");return e},move:function(e,k,f,h){if(b)e.style[b]="translate("+k+"px, "+f+"px) "+(h||[]).join(" ");else{e.style.left=k+"px";e.style.top=f+"px"}},styles:function(e){return H({},c,e)}}}(),Ta=Ta||function(a,c){var b=parseFloat(c)*ja;b=ta(b);var e=Na*b;b=wa((1+b)/(1-b)*ua((1-e)/(1+e),Na))/2;return new Y(parseFloat(a)*ja,b)},gb=gb||function(a,c){for(var b=ua(Math.E,-c),e=Ha-2*qb(b),k=pb(e,b),f=0;f<12&&
pa(e-k)>1.0E-7;){e=k;k=pb(e,b);f++}return new ha(k*Ca,a%360*Ca)};fa.prototype={constructor:fa,add:function(){for(var a=this.x,c=this.y,b=arguments.length;b--;){a+=arguments[b].x;c+=arguments[b].y}return this.copy(a,c)},copy:function(a,c){var b=H({},this);b.x=a||b.x;b.y=c||b.y;return b},equals:function(a){return this.x===a.x&&this.y===a.y},offset:function(a,c){return this.copy(this.x+a,this.y+c)},sync:function(){return this},toString:function(){return this.x+", "+this.y}};Y.prototype=H(new fa,{constructor:Y,
pos:function(){return gb(this.mercX,this.mercY)},sync:function(a,c){var b;if(!(b=a.rpp)){b=a.zoom();b=Z/(256<<b)}b=b;if(c){this.mercX=this.x*b-Math.PI;this.mercY=Math.PI-this.y*b}else if(this.mercX||this.mercY){this.x=Ia((this.mercX+Math.PI)/b);this.y=Ia((Math.PI-this.mercY)/b)}return this}});oa.prototype={constructor:oa,buffer:function(a,c){return new oa(this.x-a,this.y-(c||a),this.w+a*2,this.h+(c||a)*2)},center:function(){return new fa(this.x+(this.w>>1),this.y+(this.h>>1))}};Hits=function(){return{diffHits:function(a,
c){var b=[],e={},k;for(k=c.length;k--;)e[c[k].target.id]=true;for(k=a.length;k--;)e[a[k].target.id]||(b[b.length]=a[k]);return b},init:function(a,c,b,e){return{type:a,x:e.x|0,y:e.y|0,elements:[],absXY:c,relXY:b}},initHit:function(a,c,b){return{type:a,target:c,drag:b}},triggerEvent:function(a,c,b,e){c.triggerCustom(a.type+(b?b:"Hit"),{hitType:a.type},e?e:a.elements,a.absXY,a.relXY,new Y(a.x,a.y))}}}();var tb=function(a){function c(f,h){var d=b[f],i;d||(d=b[f]=[]);(i=d[h])||(i=d[h]=[]);return i}a=a||
128;var b=[],e={},k=0;return{copyInto:function(f){for(var h in e){var d=e[h];f.insert(d.bounds||d,d,h)}},insert:function(f,h,d){var i=f.x/a|0,j=f.y/a|0,g=(f.x+f.w)/a|0;f=(f.y+f.h)/a|0;d=d||h.id||"obj_"+k++;e[d]=h;for(h=i;h<=g;h++)for(i=j;i<=f;i++)c(h,i).push(d)},remove:function(f,h,d){d=d||h.id;if(e[d]){var i=f.x/a|0;h=f.y/a|0;var j=(f.x+f.w)/a|0;f=(f.y+f.h)/a|0;delete e[d];for(i=i;i<=j;i++)for(var g=h;g<=f;g++){var q=c(i,g),l=cb.call(q,d);l>=0&&q.splice(l,1)}}},search:function(f){var h=f.y/a|0,d=
(f.x+f.w)/a|0,i=(f.y+f.h)/a|0,j=[],g=[];for(f=f.x/a|0;f<=d;f++)for(var q=h;q<=i;q++)j=j.concat(c(f,q));j.sort();for(h=j.length;h--;){d=j[h];if(i=e[d])g[g.length]=i;for(;h>0&&j[h-1]==d;)h--}return g}}},Ib=3E4,vb={},Jb=0;(new Date).getTime();var va={},Aa=[];$a.prototype={constructor:$a,load:function(a){var c=this;Oa(this.url,function(b){c.loaded=true;c.image=b;a&&a()})}};var Yb=function(){return ga({fastpan:true,applyStyle:function(){},applyTransform:function(a,c,b){return{restore:null,x:c,y:b}},checkSize:function(){},
getDimensions:function(){return{width:0,height:0}},getViewport:function(){},hitTest:function(){return false},prepare:function(){},projectXY:null,reset:function(){}})};aa("renderer","canvas",function(a,c,b,e,k){function f(r,A,v){var u,w;n[A]=function(z){for(u=N.length;u--;)if(w=v[N[u]])z[L[u]]=w}}function h(r,A,v){var u=false;if(A)u=g.isPointInPath(x?A.x-q:A.relXY.x,x?A.y-l:A.relXY.y);return{draw:v||M,viewport:r,hit:u,vpX:q,vpY:l,context:g}}e=H({},e);var d,i,j,g,q=0,l=0,n={},p=null,x=bb.canvas.pipTransformed,
B={},G=function(){},M=function(){this.fill&&g.fill();this.stroke&&g.stroke()},N=["fill","stroke","lineWidth","opacity"],L=["fillStyle","strokeStyle","lineWidth","globalAlpha"];if(c){d=c.offsetWidth;i=c.offsetHeight;j=V.create("canvas",null,{position:"absolute","z-index":1});j.width=d;j.height=i;a.attachFrame(j,true);g=null}b=H(k,{applyStyle:function(r){var A=n[r],v=g&&g.canvas?g.canvas.id:"default",u;B[v]||(B[v]=[]);u=B[v].pop()||"basic";if(A){B[v].push(r);A(g);return u}},applyTransform:function(r){if(r.translateX!==
0||r.translateY!==0||r.scaling!==1||r.rotation!==0){g.save();p={undo:function(){g.restore();p=null},x:r.xy.x,y:r.xy.y};g.translate(r.xy.x-q+r.translateX,r.xy.y-l+r.translateY);r.rotation!==0&&g.rotate(r.rotation);r.scaling!==1&&g.scale(r.scaling,r.scaling)}return p},drawTiles:function(r,A,v){for(var u,w=q-256,z=l-256,D=r.x2,O=r.y2,J=A.length;J--;){r=A[J];if(u=r.x>=w&&r.x<=D&&r.y>=z&&r.y<=O)if(!r.loaded&&v)r.load(a.invalidate);else r.image&&g.drawImage(r.image,r.x-q,r.y-l)}},prepare:function(r,A){var v,
u=false,w=A.scaled||A;if(g)g.restore();else g=j.getContext("2d");for(v=r.length;v--;)u=u||r[v].clip;q=w.x;l=w.y;if(g){u||g.clearRect(0,0,d,i);g.save()}g.globalCompositeOperation="source-over";return g},prepArc:function(r,A,v){g.beginPath();g.arc(r.xy.x-(p?p.x:q),r.xy.y-(p?p.y:l),r.size>>1,r.startAngle,r.endAngle,false);return h(A,v)},prepImage:function(r,A,v,u){var w=(u.x||r.xy.x)-(p?p.x:q),z=(u.y||r.xy.y)-(p?p.y:l),D=u.image||r.image;if(D){g.beginPath();g.rect(w,z,u.width||D.width,u.height||D.height);
return h(A,v,function(){g.drawImage(D,w,z,u.width||D.width,u.height||D.height)})}},prepMarker:function(r,A,v){var u=r.xy.x-(p?p.x:q),w=r.xy.y-(p?p.y:l),z=r.size,D=undefined;g.beginPath();switch(r.markerStyle.toLowerCase()){case "image":D=G;g.rect(u-(z>>1),w-(z>>1),z,z);if(r.reset&&r.image){r.image=null;r.reset=false}r.image?g.drawImage(r.image,u-(z>>1),w-(z>>1),z,z):Oa(r.imageUrl,function(O){r.image=O;g.drawImage(r.image,u-(z>>1),w-(z>>1),z,z)});break;default:g.moveTo(u,w);g.lineTo(u-(z>>1),w-z);
g.lineTo(u+(z>>1),w-z);g.lineTo(u,w)}return h(A,v,D)},prepPoly:function(r,A,v,u){var w=true;r=u.points||r.points;u=p?p.x:q;var z=p?p.y:l;g.beginPath();for(var D=r.length;D--;){var O=r[D].x-u,J=r[D].y-z;if(w){g.moveTo(O,J);w=false}else g.lineTo(O,J)}return h(A,v)},getContext:function(){return g}});(function(){for(var r in Ja.styles)f(null,r,Ja.styles[r]);Bb.bind("defined",f)})();b.bind("detach",function(){c.removeChild(j)});return b});aa("renderer","dom",function(a,c,b,e,k){function f(g){var q=g.image=
new Image;i[g.id]=g;q.src=g.url;q.onload=function(){if(j[g.id])d.appendChild(this);else g.image=null};q.style.cssText="-webkit-user-select: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute;";
return q}function h(g,q,l){var n=[],p;for(p in g){var x=g[p];if(l?x[l]:!q[p]){if(x.image&&x.image.parentNode){d.removeChild(x.image);x.image=null}n[n.length]=p}}for(q=n.length;q--;)delete g[n[q]]}var d=null,i={},j={};d=V.create("div","",V.styles({width:c.offsetWidth+"px",height:c.offsetHeight+"px"}));c.childNodes.length>0?c.insertBefore(d,c.childNodes[0]):c.appendChild(d);a.attachFrame(d);a=H(k,{drawTiles:function(g,q,l){for(var n,p=g.x,x=g.y,B=q.length;B--;){g=q[B];if(g.url){(n=g.image||(l?f(g):
null))&&V.move(n,g.x-p,g.y-x);j[g.id]=g}}}});a.bind("predraw",function(){h(i,j);j={}});a.bind("detach",function(){c.removeChild(d)});a.bind("reset",function(){for(h(i,j={});d.childNodes.length>0;)d.removeChild(d.childNodes[0])});return a});var Bb=function(){function a(e,k){if(T(e,za)){b.trigger("defined",e,c[e]=k);return e}else{var f=[],h;for(h in e)f[f.length]=a(h,e[h]);return f}}var c={},b=ga({get:function(e){return c[e]},define:a});a({basic:{fill:"#ffffff"},highlight:{fill:"#ff0000"},waypoints:{lineWidth:4,
stroke:"#003377",fill:"#ffffff"},waypointsHover:{lineWidth:4,stroke:"#ff0000",fill:"#ffffff"}});return b}();aa("view","map",function(a){function c(m,o,t,C){r(Sa(ab(U+ua(2,C)-1,0.5),2),false,true)}function b(m,o){var t=renderer&&renderer.projectXY?renderer.projectXY(m,o):null;if(!t){t=K.getViewport();var C=1/U;t=new Y(t?t.x+m*C:m,t?t.y+o*C:o)}return t.sync(K,true)}function e(m,o,t){A("doubleTap",o,t,b(t.x,t.y));a.scalable&&r(2,{easing:"quad.out",duration:300},true)}function k(m,o,t){s=null;ea=true;
p("down",o,t)}function f(m,o,t){p("hover",o,t)}function h(m,o,t,C){l(o,t,false);if(!s){y=C.x;E=C.y}}function d(m,o,t){l(o,t,true);ea=false}function i(){clearTimeout(Cb);Cb=setTimeout(function(){renderer.checkSize()},250)}function j(m,o,t){p("tap",o,t);A("tap",o,t,b(t.x,t.y,true))}function g(m){var o=K,t=D,C=J,S=a;m=(m||a.renderer).split("/");for(var ba=new Yb(o,t,C,S),ka=0;ka<m.length;ka++)ba=xa("renderer",m[ka],o,t,C,S,ba);renderer=ba;$=renderer.fastpan&&V.transforms;q()}function q(){da&&da.unbind();
if(renderer){da=INTERACT.watch(renderer.interactTarget||J);if(a.scalable){da.bind("zoom",c);da.bind("doubleTap",e)}da.bind("pointerDown",k);da.bind("pointerMove",h);da.bind("pointerUp",d);a.captureHover&&da.bind("pointerHover",f);da.bind("tap",j)}}function l(m,o,t){if(s){m=b(o.x,o.y);s.drag.call(s.target,s,m.x,m.y,t)&&X++;if(t)s=null}}function n(m){J=document.getElementById(m);J.appendChild(O=V.create("div","",V.styles({overflow:"hidden",width:J.offsetWidth+"px",height:J.offsetHeight+"px"})));Ua=
O.offsetWidth+la*2;Va=O.offsetHeight+la*2;hb=Ua/2;ib=Va/2;jb=J.offsetWidth/2;kb=J.offsetHeight/2;O.appendChild(D=V.create("div","",V.styles({width:Ua+"px",height:Va+"px","z-index":2,margin:-la+"px 0 0 "+-la+"px"})));g()}function p(m,o,t){ca=Hits.init(m,o,t,b(t.x,t.y,true));for(m=z;m--;)R=R||(w[m].hitGuess?w[m].hitGuess(ca.x,ca.y,K):false);R&&X++}function x(m){var o=M();return m?B(m.bestZoomLevel(o)).center(m.center()):new Ra((new Y(o.x,o.y2)).sync(K,true).pos(),(new Y(o.x2,o.y)).sync(K,true).pos())}
function B(m,o,t){if(T(m,qa)){m=ab(a.minZoom,Sa(a.maxZoom,m|0));if(m!==Da){var C=ua(2,m-Da),S=hb/C|0,ba=ib/C|0;Da=m;v(((o||P+hb)-S)*C,((t||Q+ib)-ba)*C);lb=mb=0;A("zoom",m);rpp=K.rpp=Z/(256<<Da);G(Z/rpp|0,Z/rpp|0,true,false);U=1;A("resync");renderer.trigger("reset");L()}return K}else return Da}function G(m,o,t,C){Ea=m;Fa=o;Wa=t;Xa=C}function M(){var m=new oa(P,Q,Ua,Va);m.scaleFactor=U;return m}function N(m,o,t){if(T(o,ia))for(o=0;o<z;o++){if(w[o].id===m)return w[o]}else if(T(m,za)){o=xa("layer",o,
K,t);o.added=(new Date).getTime();o.id=m;w[w.length]=o;w.sort(function(C,S){return S.zindex-C.zindex||S.added-C.added});z=w.length;o.trigger("resync");o.trigger("refresh",K,M());K.trigger("layerChange",K,o);X++;return o}else return[].concat(w)}function L(){var m=M();if(m){if(Ea||Fa)if(m){var o=Wa?P+(m.w>>1):P,t=Xa?Q+(m.h>>1):Q,C=m.w,S=m.h;if(Ea&&Ea>C)if(o+C>Ea)P=Wa?P:Ea-C;else if(o<0)P=Wa?P:0;if(Fa&&Fa>S)if(t+S>Fa)Q=Xa?Q:Fa-S;else if(t<0)Q=Xa?Q:0}mb=P;lb=Q;if(Ya.x!=m.x||Ya.y!=m.y){K.trigger("boundsChange",
x());Ya.x=m.x;Ya.y=m.y}A("refresh",K,m);X++}}function r(m,o,t){if(T(m,qa)){var C=t?m:U*m;if(!Zb){o=null;m=Ia(wa(C)/Math.LN2);C=ua(2,m)}if(o)Ka=ma.tween([U],[C],o,function(){U=C;Ka=null;X++});else{U=C;X++}return K}else return U}function A(){for(var m=K.trigger.apply(null,arguments).cancel,o=w.length;o--;)m=w[o].trigger.apply(null,arguments).cancel||m;return!m}function v(m,o,t){if(T(m,qa)){if(t)ra=ma.tween([P,Q],[m,o],t,function(){ra=null});else{P=m|0;Q=o|0}return K}else return(new Y(P,Q)).sync(K,true)}
a=H({container:"",captureHover:true,controls:["zoombar"],drawOnScale:true,padding:50,inertia:true,refreshDistance:256,pannable:true,scalable:true,minZoom:1,maxZoom:18,renderer:"canvas/dom",zoom:1,zoombar:{}},a);var u=[],w=[],z=0,D=null,O=null,J,s=null,I=!T(window.attachEvent,ia),R=false,$=true,ea=false,y=0,E=0,F=a.refreshDistance,P=0,Q=0,W=0,Ba=0,mb=0,lb=0,Ea=null,Fa=null,Wa=false,Xa=false,ra=null,la=a.padding,ca=null,La=null,Cb=0,sa=0,Ma=null,U=1,Ka=null,Db=1,Ya=new Y,da=null,nb={index:0,draw:false},
Zb=true,X=0,Ua,Va,hb,ib,jb,kb,Da=a.zoom||a.zoomLevel,K={XY:Y,id:a.id,padding:la,panSpeed:0,attachFrame:function(m,o){o&&D.appendChild(m)},bounds:x,center:function(m,o,t){if(T(m,za)){o=rb.parseXY(m).sync(K);m=o.x;o=o.y}if(T(m,qa)){v(m-jb-la,o-kb-la,t);return K}else return v().offset(jb+la|0,kb+la|0).sync(K,true)},detach:function(){renderer&&renderer.trigger("detach");da&&da.unbind();if(O){J.removeChild(O);D=O=null}},layer:N,invalidate:function(){X++},pan:function(m,o,t){v(P+m,Q+o,t)},refresh:L,rotate:function(m,
o,t){if(T(m,qa)){var C=t?m:sa+m;if(o)Ma=ma.tween([sa],[C],o,function(){sa=C%360;Ma=null;X++});else{sa=C%360;X++}return K}else return sa},scale:r,triggerAll:A,setMaxOffset:G,getViewport:M,offset:v,zoom:B};ga(K);K.bind("resize",function(){renderer.checkSize()});K.bind("layerRemove",function(m,o){var t=cb(w,o.id);if(t>=0&&t<z){w.splice(t,1);X++}z=w.length});Ob(K,a,{container:n,captureHover:q,scalable:q,pannable:q,renderer:function(m){if(renderer){renderer.trigger("detach");renderer=null}g(m);X++}});
bb.init(function(){N("markers","draw",{zindex:20});n(a.container);I?window.attachEvent("onresize",i):window.addEventListener("resize",i,false)});Xb.attach(function(m){var o=[],t,C,S;self.panSpeed=panSpeed=pa(y)+pa(E);t=U!==Db;if(panSpeed>0||t||ra||Ka||Ma){X++;if(ra&&panSpeed>0){ra(true);ra=null}}if(panSpeed<2&&(pa(P-mb)>=F||pa(Q-lb)>=F))L();nb.index++;nb.draw=X||panSpeed||0;if(renderer&&nb.draw){if(Ka)U=Ka()[0];if(Ma)sa=Ma()[0];W+=y;Ba+=E;if(y||E)K.trigger("pan");if(V.transforms){if(U!==1)o[o.length]=
"scale("+U+")";if(sa!==0)o[o.length]="rotate("+sa+"deg)"}if(t=!$||(a.drawOnScale||U===1)&&panSpeed<5){if(ra){t=ra();P=t[0]|0;Q=t[1]|0}else{P=P-W/U|0;Q=Q-Ba/U|0}S=M();renderer.trigger("predraw",S);if(renderer.prepare(w,S,m,ca)){C=Ba=t=W=X=0;for(ii=z;ii--;){var ba=w[ii];if(ba.visible){var ka=ba.style?renderer.applyStyle(ba.style,true):null;ba.draw(renderer,S,K,m,ca);ka&&renderer.applyStyle(ka)}}renderer.trigger("render",S);K.trigger("drawComplete",S,m);Db=U;V.move(D,t,C,o)}}else V.move(D,W,Ba,o);if(ea||
!a.inertia)E=y=0;else if(y!=0||E!=0){y*=0.8;E*=0.8;if(pa(y)<0.5)y=0;if(pa(E)<0.5)E=0}if(ca){m=ca?ca.elements:[];if(La&&La.type==="hover"){o=Hits.diffHits(La.elements,m);o.length>0&&Hits.triggerEvent(La,K,"Out",o)}if(m.length>0){t=ca.x;C=ca.y;for(o=m.length;o--;){S=m[o];ba=t;ka=C;var Eb=S&&S.drag&&(!S.canDrag||S.canDrag(S,ba,ka));if(Eb){s=S;s.startX=ba;s.startY=ka}if(Eb)break}Hits.triggerEvent(ca,K)}La=m.length>0?H({},ca):null;ca=null}m=wa(U)/Math.LN2|0;if(m!==0){U=ua(2,m);B(Da+m,void 0,void 0)}}});
(function(m){u=[];for(var o=0;o<m.length;o++)u[u.length]=xa("control",m[o],K,O,J,a[m[o]])})(a.controls);return K});var ma=function(){return{tween:function(a,c,b,e,k){function f(q){Hb(a[q],c[q],Gb(b.easing),b.duration,function(l,n){d[q]=l;if(n){i++;if(j&&i>=h){var p=e?e():true;if(b.callback&&(T(p,ia)||p))b.callback()}}k&&k.invalidate();return j})}b=H({easing:"sine.out",duration:1E3,callback:e},b);var h=a.length,d=[].concat(a),i=0,j=true,g;for(g=h;g--;)f(g);return function(q){j=!q;return d}},tweenDrawable:function(a,
c,b,e,k){var f=ma.tween([b],[e],k,function(){a[c]=e;for(var d=a.tweens.length;d--;)if(a.tweens[d]===h){a.tweens.splice(d,1);break}},a.view),h=function(){a[c]=f()[0]};return h}}}(),ya=function(a,c,b){b=H({style:null,xy:null,size:20,fill:false,stroke:true,draggable:false,observable:true,properties:{},typeName:"Shape"},b);H(this,b);if(T(this.xy,za))this.xy=new a.XY(this.xy);this.id="drawable_"+Wb++;this.bounds=null;this.view=a;this.layer=c;this.tweens=[];this.rotation=this.animations=0;this.scaling=
1;this.translateY=this.translateX=0;this.observable&&ga(this)};ya.prototype={constructor:ya,applyTweens:function(){for(var a=this.tweens.length;a--;)this.tweens[a]()},drag:null,draw:null,getProps:null,resync:function(){if(this.xy){this.xy.sync(this.view);if(this.size){var a=this.size>>1;this.updateBounds(new oa(this.xy.x-a,this.xy.y-a,this.size,this.size))}}},rotate:function(a,c,b){if(T(a,qa)){a=(b?a:this.rotation*Ca+a)*ja;if(c)this.tweens.push(ma.tweenDrawable(this,"rotation",this.rotation,a,c));
else{this.rotation=a;this.view.invalidate()}return this}else return this.rotation*Ca},scale:function(a,c,b){if(T(a,qa)){a=b?a:this.scaling*a;if(c)this.tweens.push(ma.tweenDrawable(this,"scaling",this.scaling,a,c));else this.scaling=a;return this}else return this.scaling},translate:function(a,c,b,e){if(T(a,qa)){a=e?a:this.translateX+a;c=e?c:this.translateY+c;if(b){this.tweens.push(ma.tweenDrawable(this,"translateX",this.translateX,a,b));this.tweens.push(ma.tweenDrawable(this,"translateY",this.translateY,
c,b))}else{this.translateX=a;this.translateY=c}return this}else return new fa(this.translateX,this.translateY)},updateBounds:function(a,c){a&&(!this.bounds||a.x!=this.bounds.x||a.y!=this.bounds.y)&&this.trigger("move",this,a,this.bounds);this.bounds=a;if(c)this.xy=this.bounds.center()}};aa("drawable","marker",function(a,c,b){b=H({fill:true,stroke:false,markerStyle:"simple",hoverStyle:"highlight",typeName:"Marker"},b);return new ya(a,c,b)});aa("drawable","poly",function(a,c,b){b=H({simplify:false,
fill:true,points:[],typeName:"Poly"},b);var e=b.points,k=b.simplify;ya.call(this,b);H(this,{getPoints:function(){return[].concat(e)},resync:function(){var f,h,d,i,j,g,q,l;for(f=e.length;f--;)e[f].sync(a);l=this.points=k?k(e):e;for(f=l.length;f--;){h=l[f].x;d=l[f].y;g=T(g,ia)||h<g?h:g;q=T(q,ia)||d<q?d:q;i=T(i,ia)||h>i?h:i;j=T(j,ia)||d>j?d:j}this.updateBounds(new oa(g,q,i-g,j-q),true)}});this.haveData=e&&e.length>=2});aa("drawable","line",function(a,c,b){b.fill=false;return xa("drawable","poly",a,c,
b)});aa("drawable","image",function(a,c,b){function e(){if(i&&i.width>0){if(!this.centerOffset)this.centerOffset=new fa(-i.width>>1,-i.height>>1);this.updateBounds(new oa(this.xy.x+this.centerOffset.x,this.xy.y+this.centerOffset.y,i.width,i.height),false)}}function k(g){if(this.imageUrl=g){var q=this;Oa(this.imageUrl,function(l,n){i=l;if(n){var p=j.layer?j.layer.view:null;p&&p.invalidate()}e.apply(q)})}}b=H({image:null,imageUrl:null,centerOffset:null,typeName:"Image"},b);var f=ya.prototype.resync,
h=0,d=0,i=b.image,j=H(new ya(a,c,b),{changeImage:k,getProps:function(){this.bounds||e(this,i);return{image:i,x:this.xy.x+h,y:this.xy.y+d}},resync:function(g){f.call(this,g);e.call(this)}});i||k.call(this,this.imageUrl);if(this.centerOffset){h=this.centerOffset.x;d=this.centerOffset.y}});aa("drawable","arc",function(a,c,b){b=H({startAngle:0,endAngle:Math.PI*2,typeName:"Arc"},b);return new ya(a,c,b)});Pa.prototype={constructor:Pa,clip:null,cycle:function(){},draw:function(){},hitGuess:null,remove:function(){this.view.trigger("layerRemove",
this)}};aa("layer","tile",function(a,c){c=H({generator:"osm",imageLoadArgs:{}},c);var b=xa("generator",c.generator,c).run,e=null,k=[],f=H(new Pa(a,c),{draw:function(h,d,i){h.drawTiles&&h.drawTiles(d,e.search(d.buffer(128)),i.panSpeed<2)}});f.bind("refresh",function(h,d,i){(new Date).getTime();e&&b(d,i,e,function(){d.invalidate()})});f.bind("resync",function(){var h=a&&a.zoom?a.zoom():0;k[h]||(k[h]=sb(h));e=k[h]});return f});aa("layer","draw",function(a,c){function b(j,g,q,l){var n=this.dragOffset;
if(!n)n=this.dragOffset=new a.XY(j.startX-this.xy.x,j.startY-this.xy.y);this.xy.x=g-n.x;this.xy.y=q-n.y;if(l){delete this.dragOffset;a.invalidate();this.trigger("dragDrop")}return true}function e(j){clearTimeout(d);d=setTimeout(function(){f.sort(function(g,q){if(q.xy&&g.xy){var l=q.xy.y-g.xy.y;return l!=0?l:q.xy.x-g.xy.x}});j&&j.invalidate()},50)}function k(j,g,q,l){l&&h.remove(l,g);h.insert(q,g)}c=H({zindex:10},c);var f=[],h,d=0,i=H(new Pa(a,c),{itemCount:0,clear:function(){h=new tb;f=[];i.itemCount=
0},create:function(j,g,q){j=xa("drawable",j,a,i,g);if(q)f.unshift(j);else f[f.length]=j;j.resync();h&&j.bounds&&h.insert(j.bounds,j);e(a);j.bind("move",k);i.itemCount=f.length;return j},draw:function(j,g,q,l,n){q={};l=h&&g?h.search(g):[];for(var p=l.length;p--;){var x=l[p],B=x.style||i.style,G,M,N=x.getProps?x.getProps(j):q;G=j["prep"+x.typeName];x.tweens.length>0&&x.applyTweens();M=j.applyTransform(x);if(N=G?G.call(j,x,g,n,N):null){if(n&&N.hit){n.elements.push(Hits.initHit(x.type,x,x.draggable?b:
null));G=n.type+"Style";B=x[G]||i[G]||B}B=B?j.applyStyle(B,true):null;(G=x.draw||N.draw)&&G.call(x,N);B&&j.applyStyle(B)}M&&M.undo&&M.undo()}},find:function(){return[].concat(f)},hitGuess:function(j,g){return h&&h.search({x:j-10,y:g-10,w:20,h:20}).length>0}});i.bind("resync",function(){h=sb(a.zoom(),h);for(var j=f.length;j--;)f[j].resync()});return i});Qa.prototype={constructor:Qa};aa("control","zoombar",function(a,c,b,e){function k(v,u){var w=N[v]=V.create("div","t5-zoombar-button",{position:"absolute",
background:f(v),"z-index":51,width:e.width+"px",height:e.buttonHeight+"px","margin-top":(u||0)+"px"});L.appendChild(w)}function f(v,u){return"url("+e.images+") 0 -"+(q+n*3+(v||0)*j*3+(u||0)*j)+"px"}function h(v){return"url("+e.images+") 0 -"+(q+(v||0)*n)+"px"}function d(v,u){var w;if(v===l){l.style.background=h(u);w="thumb"}else for(var z=0;z<N.length;z++)if(v===N[z]){w="button"+z;N[z].style.background=f(z,u);break}return w}function i(v){if(v!==G){G=v;B=x-G/M*(x-p)|0;V.move(l,0,B-p);clearTimeout(r);
r=setTimeout(function(){a.zoom(G)},500)}}e=H({width:24,height:200,images:"img/zoom.png",align:"right",marginTop:10,spacing:10,thumbHeight:16,buttonHeight:16},e.zoombar);var j=e.buttonHeight,g,q=e.height,l,n=e.thumbHeight,p=e.spacing+j-(n>>1),x=e.height-j-(n>>1),B=p,G=-1;c=a.minZoom();var M=a.maxZoom()-c+1,N=[],L,r=0,A={button0:function(){a.zoom(a.zoom()+1)},button1:function(){a.zoom(a.zoom()-1)}};L=V.create("div","t5-zoombar",{position:"absolute",background:"url("+e.images+")","z-index":50,overflow:"hidden",
width:e.width+"px",height:e.height+"px",margin:function(){var v=e.spacing,u=Za("{0}px 0 0 {1}px");if(e.align==="right")v=b.offsetWidth-e.width-e.spacing;return u(e.marginTop,v)}()});b.childNodes[0]?b.insertBefore(L,b.childNodes[0]):b.appendChild(L);L.appendChild(l=V.create("div","t5-zoombar-thumb",{position:"absolute",background:h(),"z-index":51,width:e.width+"px",height:e.thumbHeight+"px",margin:"10px 0 0 0",top:B-p+"px"}));k(0);k(1,e.height-e.buttonHeight);g=INTERACT.watch(L,{bindTarget:L});g.bind("pointerMove",
function(v,u,w){B=Math.min(Math.max(p,w.y-(n>>1)),x);i(M-(B-p)/x*M|0)});g.bind("pointerDown",function(v){d(v.target,2)});g.bind("pointerUp",function(v){d(v.target,0)});g.bind("tap",function(v){(v=A[d(v.target,2)])&&v()});c=new Qa(a);c.bind("detach",function(){g.unbind();b.removeChild(L)});a.bind("zoom",function(v,u){i(u)});i(a.zoom());return c});ha.prototype={constructor:ha,distanceTo:function(){if(!targetPos||this.empty()||targetPos.empty())return 0;var a=(targetPos.lat-this.lat)*ja>>1,c=(targetPos.lon-
this.lon)*ja>>1;a=ta(a)*ta(a)+fb(this.lat*ja)*fb(targetPos.lat*ja)*ta(c)*ta(c);return 6371*2*Vb(Ab(a),Ab(1-a))},equalTo:function(a){return pos&&this.lat===a.lat&&this.lon===a.lon},empty:function(){return this.lat===0&&this.lon===0},inArray:function(a){for(var c=a.length;c--;)if(this.equal(a[c]))return true;return false},offset:function(a,c){var b=this.lat*ja,e=this.lon*ja,k=b+a/6371;b=Ub(ta(c/6371)/fb(b));e=e+b;k=(k+Ha)%Math.PI-Ha;e%=Z;return new ha(k*Ca,e*Ca)},toPixels:function(){return Ta(this.lon,
this.lat)},toString:function(a){return this.lat+(a||" ")+this.lon}};aa=function(){return{generalize:function(a,c,b){var e=a.length,k=[],f=null;b||(b=250);b/=1E3;na("generalizing positions, must include "+c.length+" positions");for(var h=e;h--;)if(h===0)k.unshift(a[h]);else{var d=!f||a[h].inArray(c)?b:f.distanceTo(a[h]);if(a[h]&&d>=b){k.unshift(a[h]);f=a[h]}}na("generalized "+e+" positions into "+k.length+" positions");return k},parseArray:function(a){var c=a.length,b=Array(c);for(c=c;c--;)b[c]=new ha(a[c]);
return b},vectorize:function(a,c){function b(){for(var h=0,d=c.chunkSize,i=e;i--;){k[i]=new Y(a[i]);h+=1;if(h>d)break}e=i;if(e<=0)c.callback&&c.callback(k);else animFrame(b)}var e=a.length,k=Array(e);c=H({chunkSize:500,async:true,callback:null},c);if(!c.async){for(var f=e;f--;)k[f]=new Y(a[f]);return k}animFrame(b);return null}}}();Ra.prototype={constructor:Ra,bestZoomLevel:function(a){var c=this.center();c=Sa(Ia(pa(c.lat)*0.05),eb.length);var b=eb[c],e=this.size();c=zb(wa(eb[3]*a.h/e.y)/wa(2));a=
zb(wa(b*a.w/e.x)/wa(2));return Sa(isNaN(c)?1E3:c,isNaN(a)?1E3:a)},center:function(){var a=this.size();return new ha(this.min.lat+(a.y>>1),this.min.lon+(a.x>>1))},expand:function(a){this.min.lat-=a;this.max.lat+=a;this.min.lon-=a%360;this.max.lon+=a%360},size:function(a){var c=new fa(0,this.max.lat-this.min.lat);c.x=(a||isType(a,ia))&&this.min.lon>this.max.lon?360-this.min.lon+this.max.lon:this.max.lon-this.min.lon;return c},toString:function(){return"min: "+this.min+", max: "+this.max}};var Ja={ex:H,
log:na,observable:ga,formatter:Za,wordExists:function(a,c){for(var b=a.split(/\s|\,/).length;b--;)if(a.toLowerCase()==c.toLowerCase())return true;return false},is:T,indexOf:cb,project:Ta,unproject:gb,userMessage:function(a,c,b){Ja.trigger("userMessage",a,c,b)},Registry:db,Style:Bb,DOM:V,Rect:oa,XY:fa,Hits:Hits,Control:Qa,Tile:$a,Tweener:ma,getImage:Oa,Pos:ha,PosFns:aa,BBox:Ra};ga(Ja);ob.T5=Ja;ob.Tile5=function(a,c){c=H({container:a,type:"map",renderer:"canvas",starpos:null,zoom:1,fastpan:false,drawOnScale:true,
zoombar:{}},c);return xa("view",c.type,c)}})(window);
