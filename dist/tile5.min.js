(function(pb){function B(){var c=arguments[0]||{},f=Array.prototype.slice.call(arguments,1),a,b;for(b=f.length;b--;)if((a=f[b])!==null)for(var d in a){var e=a[d];if(c!==e)if(e!==undefined)c[d]=e}return c}function na(c,f){if(typeof console!=="undefined")console[f||"debug"](c)}function qb(c){var f=c.match(Pb),a=[],b=0,d;for(d=f?f.length:0;d--;){var e=f[d].slice(1);a[e]||(a[e]=RegExp("\\{"+e+"\\}","g"))}b=a.length;return function(){var h=c;for(d=0;d<b;d++)h=h.replace(a[d],arguments[d]||"");return h}}
function bb(c){c=c.replace(/[\-\_\s\.]/g,"").toLowerCase();return Ea[c]||Ea.linear}function Na(c,f,a,b,d){function e(i){i=i?i:(new Date).getTime();if(g+rb<i){var k=i-h,p=a(k,c,j,b),l=h+b<=i;i=!l;if(d){k=d(p,l,k);i=typeof k!="undefined"?k&&i:i}i&&animFrame(e)}}var h=(new Date).getTime(),g=0,j=f-c;animFrame(e);return{}}function sb(){return(new Date).getTime()}function Y(c,f){this.x=c||0;this.y=f||0}function oa(c,f,a,b){this.x=c||0;this.y=f||0;this.w=a||0;this.h=b||0;this.x2=this.x+this.w;this.y2=this.y+
this.h}function tb(c,f){var a=new ub(Math.sqrt(256<<c)|0);f&&f.zoomLevel===c&&f.copyInto(a);a.zoomLevel=c;return a}function vb(c){c=c||(new Date).getTime();for(var f=0;f<Aa.length;){var a=Aa[f],b=xa[a],d=xa[a].image&&xa[a].image.complete&&xa[a].image.width>0,e=c-b.start;e=d||e>=Qb;if(d){d=b.callbacks;wb[a]=b.image;for(var h=0;h<d.length;h++)d[h](b.image,true)}if(e){Aa.splice(f,1);delete xa[a]}else f++}Aa.length>0&&animFrame(vb)}function Oa(c,f){var a=c&&f?wb[c]:null;if(a&&a&&a.complete&&a.width>0)f(a);
else{if(a=xa[c])a.callbacks.push(f);else{a=new Image;a.id="_ldimg"+ ++Rb;xa[c]={start:(new Date).getTime(),image:a,callbacks:[f]};a.src=c;Aa[Aa.length]=c}animFrame(vb)}}function cb(c,f,a,b,d,e){this.x=c;this.y=f;this.w=b||256;this.h=b||256;this.x2=this.x+this.w;this.y2=this.y+this.h;this.url=a;this.id=e||c+"_"+f;this.loaded=false;this.image=null}function xb(c){c=c?c:(new Date).getTime();if(c-yb>rb){for(var f=Fa.splice(0),a=f.length;a--;)f[a](c);yb=c}Fa.length&&animFrame(xb)}function zb(c){var f=Fa.length==
0;Fa[Fa.length]=c;f&&animFrame(xb)}function Sb(c,f,a,b,d){d=B({easing:"sine.out",duration:1E3,progress:null,complete:null,autoInvalidate:true},d);var e=(new Date).getTime(),h=c[f],g=f=="translate",j=d.autoInvalidate,i=a.length&&b.length&&a.length==b.length?a.length:0,k=Array(i),p=Array(i),l=bb(d.easing),m=d.duration,o=d.progress,r=function(v){var w=v-e;v=e+m<=v;for(var D=c.layer?c.layer.view:null,C,z=i;z--;){C=l(w,a[z],k[z],m);p[z]=g?C|0:C}h.apply(c,p);j&&D&&D.invalidate();if(o){w=[].concat(v?b:p);
w.unshift(v);o.apply(c,w)}if(v){c.animations--;h.apply(c,b);d.complete&&d.complete.apply(c,b)}else zb(r)};if(h&&h.apply&&i>0){m=m?m:DEFAULT_DURATION;for(f=i;f--;)k[f]=b[f]-a[f];c.animations++;zb(r)}}function Pa(c,f){f=B({id:"layer_"+Tb++,zindex:0,animated:false,style:null,minXY:null,maxXY:null},f);this.visible=true;ya(B(this,f))}function Z(c,f){if(c&&c.split){var a=c.split(Ub);if(a.length>1){c=a[0];f=a[1]}}else if(c&&c.lat){f=c.lon;c=c.lat}this.lat=parseFloat(c||0);this.lon=parseFloat(f||0)}function Ab(c,
f){var a=Qa*pa(c);return Ga-2*Bb(f*sa((1-a)/(1+a),Qa/2))}function Ra(c,f,a,b){f=db(f);c.add(b(f,a));return f.length}function db(c){var f=c?c.length:0,a=Array(f);for(f=f;f--;)a[f]=new Z(c[f][1],c[f][0]);return aa.vectorize(a,Cb)}var eb={};(function(c){var f=[],a=0,b=false,d=c.register=function(e,h){f.push({section:e,run:h})};c.init=function(e){function h(){if(a<f.length){var j=f[a++];g[j.section]||(g[j.section]={});j.run(g[j.section],h)}else{for(j in g)c[j]=g[j];b=true;e&&e(c)}}var g={};if(b&&e)e(c);
else{a=0;h()}};d("canvas",function(e,h){function g(){var p,l=j.getContext("2d");l.save();try{l.translate(50,50);l.beginPath();l.rect(0,0,20,20);p=l.isPointInPath(10,10)}finally{l.restore()}return p}var j=document.createElement("canvas"),i=typeof FlashCanvas!="undefined",k=typeof G_vmlCanvasManager!="undefnined";j.width=200;j.height=200;e.pipTransformed=i||k?false:g();h()})})(eb);window.animFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||
window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(c){setTimeout(function(){c((new Date).getTime())},1E3/60)}}();var Pb=/\{(\d+)(?=\})/g,Ea=function(){var c=1.70158,f=Math.PI/2,a=Math.abs,b=Math.pow,d=Math.sin,e=Math.asin,h=Math.cos;return{linear:function(g,j,i,k){return i*g/k+j},backin:function(g,j,i,k){return i*(g/=k)*g*((c+1)*g-c)+j},backout:function(g,j,i,k){return i*((g=g/k-1)*g*((c+1)*g+c)+1)+j},backinout:function(g,j,i,k){return(g/=k/2)<1?i/2*g*g*(((c*=1.525)+1)*g-c)+j:
i/2*((g-=2)*g*(((c*=1.525)+1)*g+c)+2)+j},bouncein:function(g,j,i,k){return i-Ea.bounceout(k-g,0,i,k)+j},bounceout:function(g,j,i,k){return(g/=k)<1/2.75?i*7.5625*g*g+j:g<2/2.75?i*(7.5625*(g-=1.5/2.75)*g+0.75)+j:g<2.5/2.75?i*(7.5625*(g-=2.25/2.75)*g+0.9375)+j:i*(7.5625*(g-=2.625/2.75)*g+0.984375)+j},bounceinout:function(g,j,i,k){return g<k/2?Ea.bouncein(g*2,0,i,k)/2+j:Ea.bounceout(g*2-k,0,i,k)/2+i/2+j},cubicin:function(g,j,i,k){return i*(g/=k)*g*g+j},cubicout:function(g,j,i,k){return i*((g=g/k-1)*g*
g+1)+j},cubicinout:function(g,j,i,k){if((g/=k/2)<1)return i/2*g*g*g+j;return i/2*((g-=2)*g*g+2)+j},elasticin:function(g,j,i,k,p,l){if(g==0)return j;if((g/=k)==1)return j+i;l||(l=k*0.3);if(!p||p<a(i)){p=i;i=l/4}else i=l/ha*e(i/p);return-(p*b(2,10*(g-=1))*d((g*k-i)*ha/l))+j},elasticout:function(g,j,i,k,p,l){var m;if(g==0)return j;if((g/=k)==1)return j+i;l||(l=k*0.3);if(!p||p<a(i)){p=i;m=l/4}else m=l/ha*e(i/p);return p*b(2,-10*g)*d((g*k-m)*ha/l)+i+j},elasticinout:function(g,j,i,k,p,l){var m;if(g==0)return j;
if((g/=k/2)==2)return j+i;l||(l=k*0.3*1.5);if(!p||p<a(i)){p=i;m=l/4}else m=l/ha*e(i/p);if(g<1)return-0.5*p*b(2,10*(g-=1))*d((g*k-m)*ha/l)+j;return p*b(2,-10*(g-=1))*d((g*k-m)*ha/l)*0.5+i+j},quadin:function(g,j,i,k){return i*(g/=k)*g+j},quadout:function(g,j,i,k){return-i*(g/=k)*(g-2)+j},quadinout:function(g,j,i,k){if((g/=k/2)<1)return i/2*g*g+j;return-i/2*(--g*(g-2)-1)+j},sinein:function(g,j,i,k){return-i*h(g/k*f)+i+j},sineout:function(g,j,i,k){return i*d(g/k*f)+j},sineinout:function(g,j,i,k){return-i/
2*(h(Math.PI*g/k)-1)+j}}}();if(typeof animFrame==="undefined")throw Error("animFrame COG required for tweening support");var ya=function(){function c(a,b){var d=a.hasOwnProperty("obsHandlers")?a.obsHandlers:null;d[b]||(d[b]=[]);return d[b]}var f=0;return function(a){if(!a)return null;if(!(a.hasOwnProperty("obsHandlers")?a.obsHandlers:null))a.obsHandlers={};if(!a.hasOwnProperty("bind")){a.bind=function(b,d){var e="callback"+f++;c(a,b).unshift({fn:d,id:e});return e};a.triggerCustom=function(b,d){var e=
c(a,b),h={cancel:false,name:b,source:this},g;for(g in d)h[g]=d[g];if(!e)return null;g=Array.prototype.slice.call(arguments,2);a.eventInterceptor&&a.eventInterceptor(b,h,g);g.unshift(h);for(var j=e.length;j--&&!h.cancel;)e[j].fn.apply(this,g);return h};a.trigger=function(b){var d=Array.prototype.slice.call(arguments,1);d.splice(0,0,b,null);return a.triggerCustom.apply(this,d)};a.unbind=function(b,d){if(typeof b==="undefined")a.obsHandlers={};else for(var e=c(a,b),h=0;e&&h<e.length;h++)if(e[h].id===
d){e.splice(h,1);break}return a}}return a}}(),Db=Array.prototype.indexOf||function(c){for(var f=0;f<this.length;f++)if(this[f]===c)return f;return-1},V=function(){return function(c,f){f=Vb.call(f);if(f=="finite")return!Wb[Xb](+c);return f=="null"&&c===null||f==typeof c||f=="object"&&c===Object(c)||f=="array"&&Array.isArray&&Array.isArray(c)||Yb.call(c).slice(8,-1).toLowerCase()==f}}(),Zb=function(){function c(d){var e=document.createElement("script"),h=false;e.src=d;e.async=true;e.onload=e.onreadystatechange=
function(){if(!h&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){h=true;e.onload=e.onreadystatechange=null;e&&e.parentNode&&e.parentNode.removeChild(e)}};a||(a=document.getElementsByTagName("head")[0]);a.appendChild(e)}var f=0,a,b=this;return function(d,e,h){d+=d.indexOf("?")>=0?"&":"?";var g="json"+ ++f;b[g]=function(j){e(j);b[g]=null;try{delete b[g]}catch(i){}};c(d+(h?h:"callback")+"="+g);return g}}();INTERACT=function(){function c(l){return function(m,o){l.addEventListener(m,
o,false)}}function f(l){return function(m,o){l.removeEventListener(m,o,false)}}function a(l){return function(m,o){l.attachEvent("on"+m,o)}}function b(l,m){return{x:l?l:0,y:m?m:0,count:1}}function d(l,m){k.push(B({handler:null,checks:{},type:l},m))}function e(l){var m=0,o=0;if(l.offsetParent){do{m+=l.offsetLeft;o+=l.offsetTop;l=l.offsetParent}while(l)}return{left:m,top:o}}function h(l,m){return{source:l,target:m.target?m.target:m.srcElement}}function g(l,m){for(var o=l.target?l.target:l.srcElement;o&&
o!==m;)o=o.parentNode;return o&&o===m}function j(l,m){return{x:l.x-(m?m.left:0),y:l.y-(m?m.top:0)}}function i(l,m){if(l.preventDefault){l.preventDefault();l.stopPropagation()}else if(typeof l.cancelBubble!="undefined")l.cancelBubble=true;m&&l.stopImmediatePropagation&&l.stopImmediatePropagation()}var k=[],p=function(l,m,o){o=B({binder:null,unbinder:null,observable:null},o);for(var r=o.observable,v=[],w,D,C={bind:function(){return r.bind.apply(null,arguments)},unbind:function(){r.unbind();for(z=0;z<
v.length;z++)v[z].unbind();return C}},z=0;z<m.length;z++)v.push(m[z](l,r,o));r.bind("pointerDown",function(){D=w=0});r.bind("pointerMove",function(q,E,I,y){w+=y.x||0;D+=y.y||0});r.bind("pointerUp",function(q,E,I){Math.abs(w)>20||Math.abs(D)>20||r.triggerCustom("tap",q,E,I)});return C};d("pointer",{handler:function(l,m,o){function r(s){if(s.pageX&&s.pageY)return b(s.pageX,s.pageY);else{var L=document.documentElement,Q=document.body;return b(s.clientX+(L&&L.scrollLeft||Q&&Q.scrollLeft||0)-(L&&L.clientLeft||
Q&&Q.clientLeft||0),s.clientY+(L&&L.scrollTop||Q&&Q.scrollTop||0)-(L&&L.clientTop||Q&&Q.clientTop||0))}}function v(s){if(g(s,l))if(y=z(s)){var L=r(s);l.style.cursor="move";i(s,true);P=L.x;O=L.y;A=b(P,O);m.triggerCustom("pointerDown",h("mouse",s),A,j(A,e(l)))}}function w(s){var L=r(s);F=L.x;H=L.y;if(g(s,l))q(s,y?"pointerMove":"pointerHover")}function D(s){if(y&&z(s)){y=false;if(g(s,l)){l.style.cursor="default";q(s,"pointerUp")}}}function C(s){if(g(s,l)){var L;s=s||window.event;if(s.detail)L=s.axis===
2?-s.detail*E:0;else{L=s.wheelDeltaY?s.wheelDeltaY:s.wheelDelta;if(window.opera)L=-L}if(L!==0){var Q=b(F,H);m.triggerCustom("zoom",h("mouse",s),Q,j(Q,e(l)),L/I,"wheel");i(s);s.returnValue=false}}}function z(s){s=s||window.event;return(s.which||s.button)==1}function q(s,L,Q,ba,ka){Q=typeof Q!="undefined"?Q:F;ba=typeof ba!="undefined"?ba:H;var x=Q-P,G=ba-O,J=b(Q,ba);m.triggerCustom(L,h("mouse",s),J,j(J,e(l)),b(x,G));if(typeof ka=="undefined"||ka){P=Q;O=ba}}o=B({},o);var E=120,I=E*8,y=false,A,F,H,P,
O;o.binder("mousedown",v);o.binder("mousemove",w);o.binder("mouseup",D);o.binder("dblclick",function(s){na("captured double click");if(g(s,l)){var L=r(s);m.triggerCustom("doubleTap",h("mouse",s),L,j(L,e(l)))}});o.binder("mousewheel",C);o.binder("DOMMouseScroll",C);return{unbind:function(){o.unbinder("mousedown",v);o.unbinder("mousemove",w);o.unbinder("mouseup",D);o.unbinder("mousewheel",C);o.unbinder("DOMMouseScroll",C)}}},checks:{touch:false}});d("pointer",{handler:function(l,m,o){function r(x){if(x.count<
2)return 0;var G=x.x-x.next.x;x=x.y-x.next.y;return~~Math.sqrt(G*G+x*x)}function v(x,G,J){G=G?G:0;J=J?J:0;for(var ca={x:x.x-G,y:x.y-J,id:x.id,count:x.count},da=ca;x.next;){x=x.next;da=da.next={x:x.x-G,y:x.y-J,id:x.id}}return ca}function w(x,G){var J=x[G?G:"touches"],ca,da;if(J.length===0)return null;da=ca={x:J[0].pageX,y:J[0].pageY,id:J[0].identifier,count:J.length};for(var R=1,T=J.length;R<T;R++)da=da.next={x:J[R].pageX,y:J[R].pageY,id:J[R].identifier};return ca}function D(x){if(g(x,l)){H=e(l);var G=
w(x,"changedTouches"),J=v(G,H.left,H.top);if(!O){P=y;m.triggerCustom("pointerDown",h("touch",x),G,J)}ba&&m.triggerCustom("pointerDownMulti",h("touch",x),G,J);O=w(x);if(O.count>1)L=r(O);ka=1;Q=v(O)}}function C(x){if(g(x,l)){i(x);s=w(x);if(P==y)P=Math.abs(O.x-s.x)>E||Math.abs(O.y-s.y)>E?I:y;if(P!=y){P=s.count>1?F:A;if(P==F)if(O.count===1){O=v(s);L=r(O)}else{var G=r(s);if(Math.abs(L-G)<q)P=A;else{var J;J=s.x;var ca=s.next.x,da=s.y,R=s.next.y,T=da<R?da:R;J={x:(J<ca?J:ca)+(Math.abs(J-ca)>>1),y:T+(Math.abs(da-
R)>>1)};G=G/L;ca=G-ka;m.triggerCustom("zoom",h("touch",x),J,j(J,H),ca,"pinch");ka=G}}P==A&&m.triggerCustom("pointerMove",h("touch",x),s,v(s,H.left,H.top),b(s.x-Q.x,s.y-Q.y));ba&&m.triggerCustom("pointerMoveMulti",h("touch",x),s,v(s,H.left,H.top))}Q=v(s)}}function z(x){if(g(x,l)){var G=w(x,"changedTouches"),J=v(G,H.left,H.top);s=w(x);if(!s){m.triggerCustom("pointerUp",h("touch",x),G,J);O=null}ba&&m.triggerCustom("pointerUpMulti",h("touch",x),G,J)}}o=B({detailed:false,inertia:false},o);var q=20,E=7,
I=0,y=1,A=2,F=3,H,P,O,s,L,Q,ba=o.detailed,ka=1;o.binder("touchstart",D);o.binder("touchmove",C);o.binder("touchend",z);na("initialized touch handler");return{unbind:function(){o.unbinder("touchstart",D);o.unbinder("touchmove",C);o.unbinder("touchend",z)}}},checks:{touch:true}});return{register:d,watch:function(l,m,o){m=B({bindTarget:null,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},m);capabilities=B({touch:"ontouchstart"in window},o);if(!m.observable){na("creating observable");
m.observable=ya({});globalOpts=m}m.binder=(m.isIE?a:c)(m.bindTarget||document);m.unbinder=(m.isIE?a:f)(m.bindTarget||document);o=m.types;for(var r=capabilities,v=[],w=k.length;w--;){var D=k[w],C=!o||o.indexOf(D.type)>=0,z=true;for(var q in D.checks){var E=D.checks[q];na("checking "+q+" capability. require: "+E+", capability = "+r[q]);z=z&&E===r[q]}if(C&&z)v[v.length]=D.handler}return new p(l,v,m)}}}();var M={ex:B,log:na,observable:ya,formatter:qb,wordExists:function(c,f){for(var a=c.split(/\s|\,/).length;a--;)if(c.toLowerCase()==
f.toLowerCase())return true;return false},is:V,indexOf:Db};ya(M);var Ba=function(){var c={};return{create:function(f,a){c[f][a]&&c[f][a].apply(null,Array.prototype.slice.call(arguments,2))},register:function(f,a,b){c[f]||(c[f]={});c[f][a]&&na($b(f,a),"warn");c[f][a]=b}}}(),$b=qb("Registration of {0}: {1} will override existing definition"),ha=Math.PI*2,Ga=Math.PI/2,fa=Math.abs,Eb=Math.ceil,Ha=Math.round,qa=Math.min,ra=Math.max,sa=Math.pow,Sa=Math.sqrt,ta=Math.log,pa=Math.sin,fb=Math.asin,Ia=Math.cos,
Bb=Math.atan,ac=Math.atan2,Xb="hasOwnProperty",Wb={NaN:1,Infinity:1,"-Infinity":1},Vb=String.prototype.toLowerCase,Yb=Object.prototype.toString,$="undefined",bc="number",U=Ba.register,ua=Ba.create,cc=0,Tb=0,Ub=/[\,\s]/,dc=M.newCanvas=function(c,f){var a=document.createElement("canvas");a.width=c?c:0;a.height=f?f:0;M.trigger("createCanvas",a);return a};Ba=function(){var c={};return{find:function(f){return(c[f]||[])[0]},register:function(f,a){c[f]||(c[f]=[]);c[f].push(a())}}}();var ia=function(){function c(b){for(var d=
0;d<b.length;d++){var e=b[d];if(typeof document.body.style[e]!="undefined")return e}}var f={"-webkit-user-select":"none",position:"absolute",overflow:"hidden"},a;a=c(["-webkit-transform","MozTransform"]);css3DTransformProp=c(["WebkitPerspective","MozPerspective"]);return{supportTransforms:a,create:function(b,d,e){b=document.createElement(b);var h=[];e=e||{};b.className=d||"";for(var g in e)h[h.length]=g+": "+e[g];b.style.cssText=h.join(";");return b},move:function(b,d,e,h){if(a)b.style[a]="translate("+
d+"px, "+e+"px) "+(h||[]).join(" ");else{b.style.left=d+"px";b.style.top=e+"px"}},styles:function(b){return B({},f,b)}}}();Y.prototype={constructor:Y,add:function(){for(var c=this.x,f=this.y,a=arguments.length;a--;){c+=arguments[a].x;f+=arguments[a].y}return new Y(c,f)},equals:function(c){return this.x===c.x&&this.y===c.y}};oa.prototype={constructor:oa};var Ta=function(){function c(b,d){return a(b.x-d.x,b.y-d.y)}function f(b,d){d=d||b.length;if(d<=1)return null;for(var e=Array(d-1),h=Array(d-1),g=
0,j,i=0;i<d-1;i++){j=c(b[i],b[i+1]);e[i]=Sa(j.x*j.x+j.y*j.y);h[i]=g+=e[i]}return{edges:e,accrued:h,tota:g}}function a(b,d){return new Y(b,d)}return{VECTOR_SIMPLIFICATION:3,SIMPLIFICATION_MIN_VECTORS:25,add:function(){for(var b=0,d=0,e=arguments.length;e--;){b+=arguments[e].x;d+=arguments[e].y}return a(b,d)},absSize:function(b){return ra(fa(b.x),fa(b.y))},copy:function(b){return b?a(b.x,b.y):null},diff:c,distance:function(b,d){return f(b,d).total},edges:f,equals:function(b,d){return b.equals(d)},extendBy:function(b,
d,e){var h=Ia(d)*e|0;d=pa(d)*e|0;return a(b.x-h,b.y-d)},floor:function(b){for(var d=Array(b.length),e=b.length;e--;)d[e]=a(b[e].x|0,b[e].y|0);return d},getRect:function(b){for(var d,e,h,g,j=b.length;j--;){var i=b[j];d=V(d,$)||i.x<d?i.x:d;e=V(e,$)||i.y<e?i.y:e;h=V(h,$)||i.x>h?i.x:h;g=V(g,$)||i.y>g?i.y:g}return new oa(d,e,h-d,g-e)},init:a,invert:function(b){return a(-b.x,-b.y)},min:function(b,d){return a(b.x<d.x?b.x:d.x,b.y<d.y?b.y:d.y)},max:function(b,d){return a(b.x>d.x?b.x:d.x,b.y>d.y?b.y:d.y)},
offset:function(b,d,e){return a(b.x+d,b.y+(e||d))},scale:function(b,d){return a(b.x/d|0,b.y/d|0)},simplify:function(b,d){if(!b)return null;d=d||Ta.VECTOR_SIMPLIFICATION;for(var e=[],h=null,g=b.length;g--;){var j=b[g];if(include=!h||g===0||fa(j.x-h.x)+fa(j.y-h.y)>d){e.unshift(j);h=j}}return e},theta:function(b,d,e){e=fb((b.y-d.y)/e);return b.x>d.x?e:Math.PI-e},toString:function(b){return b?b.x+", "+b.y:""}}}(),ec=function(){return{dotProduct:function(c,f){return c.x*f.x+c.y*f.y}}}(),Ja=function(){function c(a){return f(a.x,
a.y,a.x2,a.y2)}function f(a,b,d,e){return new oa(a,b,(d||a)-a,(e||b)-b)}return{buffer:function(a,b,d){return Ja.init(a.x-b,a.y-(d||b),a.x2+b,a.y2+(d||b))},center:function(a){return new Y(a.x+(a.w>>1),a.y+(a.h>>1))},copy:c,diagonalSize:function(a){return Sa(a.w*a.w+a.h*a.h)},fromCenter:function(a,b,d,e){d=d>>1;e=e>>1;return f(a-d,b-e,a+d,b+e)},init:f,intersect:function(a,b){var d=ra(a.x,b.x),e=ra(a.y,b.y),h=qa(a.x2,b.x2),g=qa(a.y2,b.y2);d=f(d,e,h,g);return d.w>0&&d.h>0?d:null},toString:function(a){return a?
"["+a.x+", "+a.y+", "+a.x2+", "+a.y2+"]":""},union:function(a,b){if(a.w===0||a.h===0)return c(b);else if(b.w===0||b.h===0)return c(a);else{var d=qa(a.x,b.x),e=qa(a.y,b.y),h=ra(a.x2,b.x2),g=ra(a.y2,b.y2);d=f(d,e,h,g);return d.w>0&&d.h>0?d:null}}}}();Hits=function(){return{diffHits:function(c,f){var a=[],b={},d;for(d=f.length;d--;)b[f[d].target.id]=true;for(d=c.length;d--;)b[c[d].target.id]||(a[a.length]=c[d]);return a},init:function(c,f,a,b){return{type:c,x:b.x|0,y:b.y|0,elements:[],absXY:f,relXY:a}},
initHit:function(c,f,a){return{type:c,target:f,drag:a}},triggerEvent:function(c,f,a,b){f.triggerCustom(c.type+(a?a:"Hit"),{hitType:c.type},b?b:c.elements,c.absXY,c.relXY,new Y(c.x,c.y))}}}();var ub=function(c){function f(e,h){var g=a[e],j;g||(g=a[e]=[]);(j=g[h])||(j=g[h]=[]);return j}c=c||128;var a=[],b={},d=0;return{copyInto:function(e){for(var h in b){var g=b[h];e.insert(g.bounds||g,g,h)}},insert:function(e,h,g){var j=e.x/c|0,i=e.y/c|0,k=(e.x+e.w)/c|0;e=(e.y+e.h)/c|0;g=g||h.id||"obj_"+d++;b[g]=
h;for(h=j;h<=k;h++)for(j=i;j<=e;j++)f(h,j).push(g)},remove:function(e,h,g){g=g||h.id;if(b[g]){var j=e.x/c|0;h=e.y/c|0;var i=(e.x+e.w)/c|0;e=(e.y+e.h)/c|0;delete b[g];for(j=j;j<=i;j++)for(var k=h;k<=e;k++){var p=f(j,k),l=Db.call(p,g);l>=0&&p.splice(l,1)}}},search:function(e){var h=e.y/c|0,g=(e.x+e.w)/c|0,j=(e.y+e.h)/c|0,i=[],k=[];for(e=e.x/c|0;e<=g;e++)for(var p=h;p<=j;p++)i=i.concat(f(e,p));i.sort();for(h=i.length;h--;){g=i[h];if(j=b[g])k[k.length]=j;for(;h>0&&i[h-1]==g;)h--}return k}}},Qb=3E4,wb=
{},Rb=0;(new Date).getTime();var xa={},Aa=[];cb.prototype={constructor:cb,load:function(c){var f=this;Oa(this.url,function(a){f.loaded=true;f.image=a;c&&c()})}};var fc=function(){return ya({fastpan:true,applyStyle:function(){},applyTransform:function(c,f,a){return{restore:null,x:f,y:a}},checkSize:function(){},getDimensions:function(){return{width:0,height:0}},getOffset:function(){return new Y},getViewport:function(){},hitTest:function(){return false},prepare:function(){},projectXY:null,reset:function(){}})},
gc=M.attachRenderer=function(c,f,a,b,d){c=c.split("/");for(var e=new fc(f,a,b,d),h=0;h<c.length;h++)e=ua("renderer",c[h],f,a,b,d,e);return e};U("renderer","canvas",function(c,f,a,b,d){function e(q,E,I){var y,A;m[E]=function(F){for(y=C.length;y--;)if(A=I[C[y]])F[z[y]]=A}}function h(q,E,I){var y=false;if(E)y=k.isPointInPath(r?E.x-p:E.relXY.x,r?E.y-l:E.relXY.y);return{draw:I||D,viewport:q,hit:y,vpX:p,vpY:l,context:k}}b=B({},b);var g,j,i,k,p=0,l=0,m={},o=null,r=eb.canvas.pipTransformed,v={},w=function(){},
D=function(){this.fill&&k.fill();this.stroke&&k.stroke()},C=["fill","stroke","lineWidth","opacity"],z=["fillStyle","strokeStyle","lineWidth","globalAlpha"];if(f){g=f.offsetWidth;j=f.offsetHeight;i=dc(g,j);i.style.cssText="position: absolute; z-index: 1;";c.attachFrame(i,true);k=null}a=B(d,{applyStyle:function(q){var E=m[q],I=k&&k.canvas?k.canvas.id:"default",y;v[I]||(v[I]=[]);y=v[I].pop()||"basic";if(E){v[I].push(q);E(k);return y}},applyTransform:function(q){if(q.translateX!==0||q.translateY!==0||
q.scaling!==1||q.rotation!==0){k.save();o={undo:function(){k.restore();o=null},x:q.xy.x,y:q.xy.y};k.translate(q.xy.x-p+q.translateX,q.xy.y-l+q.translateY);q.rotation!==0&&k.rotate(q.rotation);q.scaling!==1&&k.scale(q.scaling,q.scaling)}return o},drawTiles:function(q,E,I){for(var y,A=p-256,F=l-256,H=q.x2,P=q.y2,O=E.length;O--;){q=E[O];if(y=q.x>=A&&q.x<=H&&q.y>=F&&q.y<=P)if(!q.loaded&&I)q.load(c.invalidate);else q.image&&k.drawImage(q.image,q.x-p,q.y-l)}},prepare:function(q,E){var I,y=false,A=E.scaled||
E;if(k)k.restore();else k=i.getContext("2d");for(I=q.length;I--;)y=y||q[I].clip;p=A.x;l=A.y;if(k){y||k.clearRect(0,0,g,j);k.save()}k.globalCompositeOperation="source-over";return k},prepArc:function(q,E,I){k.beginPath();k.arc(q.xy.x-(o?o.x:p),q.xy.y-(o?o.y:l),q.size>>1,q.startAngle,q.endAngle,false);return h(E,I)},prepImage:function(q,E,I,y){var A=(y.x||q.xy.x)-(o?o.x:p),F=(y.y||q.xy.y)-(o?o.y:l),H=y.image||q.image;if(H){k.beginPath();k.rect(A,F,y.width||H.width,y.height||H.height);return h(E,I,function(){k.drawImage(H,
A,F,y.width||H.width,y.height||H.height)})}},prepMarker:function(q,E,I){var y=q.xy.x-(o?o.x:p),A=q.xy.y-(o?o.y:l),F=q.size,H=undefined;k.beginPath();switch(q.markerStyle.toLowerCase()){case "image":H=w;k.rect(y-(F>>1),A-(F>>1),F,F);if(q.reset&&q.image){q.image=null;q.reset=false}q.image?k.drawImage(q.image,y-(F>>1),A-(F>>1),F,F):Oa(q.imageUrl,function(P){q.image=P;k.drawImage(q.image,y-(F>>1),A-(F>>1),F,F)});break;default:k.moveTo(y,A);k.lineTo(y-(F>>1),A-F);k.lineTo(y+(F>>1),A-F);k.lineTo(y,A);break}return h(E,
I,H)},prepPoly:function(q,E,I,y){var A=true;q=y.points||q.points;y=o?o.x:p;var F=o?o.y:l;k.beginPath();for(var H=q.length;H--;){var P=q[H].x-y,O=q[H].y-F;if(A){k.moveTo(P,O);A=false}else k.lineTo(P,O)}return h(E,I)},getContext:function(){return k}});(function(){for(var q in M.styles)e(null,q,M.styles[q]);M.bind("styleDefined",e)})();a.bind("detach",function(){f.removeChild(i)});return a});U("renderer","dom",function(c,f,a,b,d){function e(k){var p=k.image=new Image;j[k.id]=k;p.src=k.url;p.onload=function(){if(i[k.id])g.appendChild(this);
else k.image=null};p.style.cssText="-webkit-user-select: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute;";return p}function h(k,p,l){var m=[];for(var o in k){var r=
k[o];if(l?r[l]:!p[o]){if(r.image&&r.image.parentNode){g.removeChild(r.image);r.image=null}m[m.length]=o}}for(p=m.length;p--;)delete k[m[p]]}var g=null,j={},i={};g=ia.create("div","",ia.styles({width:f.offsetWidth+"px",height:f.offsetHeight+"px"}));f.childNodes.length>0?f.insertBefore(g,f.childNodes[0]):f.appendChild(g);c.attachFrame(g);c=B(d,{drawTiles:function(k,p,l){for(var m,o=k.x,r=k.y,v=p.length;v--;){k=p[v];if(k.url){(m=k.image||(l?e(k):null))&&ia.move(m,k.x-o,k.y-r);i[k.id]=k}}}});c.bind("predraw",
function(){h(j,i);i={}});c.bind("detach",function(){f.removeChild(g)});c.bind("reset",function(){for(h(j,i={});g.childNodes.length>0;)g.removeChild(g.childNodes[0])});return c});var gb=M.styles={},hc=M.defineStyle=function(c,f){gb[c]=f;M.trigger("styleDefined",c,gb[c]);return c},Fb=M.defineStyles=function(c){for(var f in c)hc(f,c[f])};M.getStyle=function(c){return gb[c]};M.loadStyles=function(c){Zb(c,function(f){Fb(f)})};Fb({basic:{fill:"#ffffff"},highlight:{fill:"#ff0000"},waypoints:{lineWidth:4,
stroke:"#003377",fill:"#ffffff"},waypointsHover:{lineWidth:4,stroke:"#ff0000",fill:"#ffffff"}});U("view","view",function(c){function f(n,t,u,K){D(qa(ra(W+sa(2,K)-1,0.5),2))}function a(n){var t=n|0;n=t+Math.round((n-t)*50)/50;if(n!==W){W=n;n=ta(W)/Math.LN2|0;if(n!==0){W=sa(2,n);C(Ka+n,ic,jc)}ja++}}function b(n,t){var u=renderer&&renderer.projectXY?renderer.projectXY(n,t):null;if(!u){u=S.getViewport();var K=1/W;u=new Y(u?u.x+n*K:n,u?u.y+t*K:t)}return u}function d(n,t,u){z("doubleTap",t,u,b(u.x,u.y));
c.scalable&&D(2,b(u.x,u.y),kc,null,lc)}function e(n,t,u){s=null;ka=true;m("down",t,u)}function h(n,t,u){m("hover",t,u)}function g(n,t,u,K){p(t,u,false);if(!s){x=K.x;G=K.y}}function j(n,t,u){p(t,u,true);ka=false}function i(){clearTimeout(Gb);Gb=setTimeout(function(){renderer.checkSize()},250)}function k(n,t,u){m("tap",t,u);z("tap",t,u,b(u.x,u.y,true))}function p(n,t,u){if(s){n=b(t.x,t.y);s.drag.call(s.target,s,n.x,n.y,u)&&ja++;if(u)s=null}}function l(n){var t=[],u,K=false,N;n=n||(new Date).getTime();
if(K=n-Hb>mc){self.panSpeed=panSpeed=fa(x)+fa(G);N=fa(R-hb)>=da||fa(T-ib)>=da;u=W!==Ib;if(panSpeed>0||u)ja++;N&&panSpeed<E&&w();Ua.index++;Ua.draw=ja||panSpeed||J||ca;S.trigger("enterFrame",n,Ua);Hb=n}if(renderer&&K&&Ua.draw){Va+=x;Wa+=G;if(x||G)S.trigger("pan");if(W!==1&&ia.supportTransforms)t[t.length]="scale("+W+")";if(u=!ba||(c.drawOnScale||W===1)&&panSpeed<I){R=R-Va/W|0;T=T-Wa/W|0;N=r();renderer.trigger("predraw",N);if(renderer.prepare(A,N,n,ea)){K=Wa=u=Va=ja=0;for(ii=F;ii--;){var X=A[ii];if(X.visible){var la=
X.style?renderer.applyStyle(X.style,true):null;X.draw(renderer,N,S,n,ea);la&&renderer.applyStyle(la)}}renderer.trigger("render",N);S.trigger("drawComplete",N,n);Ib=W;ia.move(H,u,K,t)}}else ia.move(H,Va,Wa,t);if(ka||!c.inertia)G=x=0;else if(x!=0||G!=0){x*=0.8;G*=0.8;if(fa(x)<0.5)x=0;if(fa(G)<0.5)G=0}if(ea){n=ea?ea.elements:[];if(La&&La.type==="hover"){t=Hits.diffHits(La.elements,n);t.length>0&&Hits.triggerEvent(La,S,"Out",t)}if(n.length>0){u=ea.x;K=ea.y;for(t=n.length;t--;){N=n[t];X=u;la=K;var va=
N&&N.drag&&(!N.canDrag||N.canDrag(N,X,la));if(va){s=N;s.startX=X;s.startY=la}if(va)break}Hits.triggerEvent(ea,S)}La=n.length>0?B({},ea):null;ea=null}}animFrame(l)}function m(n,t,u){ea=Hits.init(n,t,u,b(u.x,u.y,true));for(n=F;n--;)Q=Q||(A[n].hitGuess?A[n].hitGuess(ea.x,ea.y,S):false);Q&&ja++}function o(){ja++}function r(){var n=new oa(R,T,Xa,Ya);n.scaleFactor=W;return n}function v(n,t,u){if(V(t,$))for(t=0;t<F;t++){if(A[t].id===n)return A[t]}else{n=ua("layer",t,u);n.added=sb();A[A.length]=n;A.sort(function(K,
N){return N.zindex-K.zindex||N.added-K.added});F=A.length;value.trigger("refresh",S,r());S.trigger("layerChange",S,value);ja++;return n}}function w(){var n=r();if(n){if(Ca||Da)if(n){var t=Za?R+(n.w>>1):R,u=$a?T+(n.h>>1):T,K=n.w,N=n.h;if(Ca&&Ca>K)if(t+K>Ca)R=Za?R:Ca-K;else if(t<0)R=Za?R:0;if(Da&&Da>N)if(u+N>Da)T=$a?T:Da-N;else if(u<0)T=$a?T:0}hb=R;ib=T;z("refresh",S,n);ja++}}function D(n,t,u,K,N){var X;if(!nc){u=false;X=Ha(ta(n)/Math.LN2);n=sa(2,X)}u?Na(W,n,u,N,function(la,va){n=la;if(va){X=Ha(ta(n)/
Math.LN2);n=sa(2,X);K&&K()}a(n)}):a(n);return S}function C(n,t,u){n=ra(c.minZoom,qa(c.maxZoom,n));if(n!==Ka){var K=sa(2,n-Ka),N=jb/K|0,X=kb/K|0;Ka=n;q(((t?t:R+jb)-N)*K,((u?u:T+kb)-X)*K);ib=hb=0;z("zoomLevelChange",n);W=1;renderer.trigger("reset");w()}}function z(){for(var n=S.trigger.apply(null,arguments).cancel,t=A.length;t--;)n=A[t].trigger.apply(null,arguments).cancel||n;return!n}function q(n,t,u,K,N){function X(){la+=1;if(la>=2){Jb=false;N&&N()}}var la=0;if(u&&panSpeed===0){Na(R,n,u,K,function(va,
lb){R=va|0;(lb?X:o)();return panSpeed===0});Na(T,t,u,K,function(va,lb){T=va|0;(lb?X:o)();return panSpeed===0});Jb=true}else{R=n|0;T=t|0;N&&N()}}c=B({container:"",captureHover:true,drawOnScale:true,fastpan:false,fastpanPadding:128,inertia:true,refreshDistance:256,pannable:false,scalable:false,fps:60,minZoom:1,maxZoom:1,renderer:"canvas",zoomLevel:1},c);var E=2,I=5,y={},A=[],F=0,H=null,P=null,O,s=null,L=!V(window.attachEvent,$),Q=false,ba=true,ka=false,x=0,G=0,J=0,ca=0,da=c.refreshDistance,R=0,T=0,
Va=0,Wa=0,hb=0,ib=0,Ca=null,Da=null,Za=false,$a=false,mb=[],ea=null,La=null,Gb=0,W=1,Ib=1,Hb=0,ga=null,Ua={index:0,draw:false},nc=true,Jb=false,mc=1E3/c.fps|0,ja=0,Xa,Ya,jb,kb,ic,jc,Ka=c.zoomLevel,kc=bb("quad.out"),lc=300,S={id:c.id,padding:0,panSpeed:0,attachFrame:function(n,t){mb[mb.length]=n;t&&H.appendChild(n)},detach:function(){renderer&&renderer.trigger("detach");ga&&ga.unbind();if(P){O.removeChild(P);H=P=null}mb=[]},eachLayer:function(n){for(var t=F;t--;)n(A[t])},getZoomLevel:function(){return Ka},
invalidate:o,refresh:w,resetScale:function(){W=1},scale:D,setZoomLevel:C,syncXY:function(){},triggerAll:z,removeLayer:function(n){a:{for(var t=F;t--;)if(A[t].id===n){n=t;break a}n=-1}if(n>=0&&n<F){S.trigger("layerRemove",S,A[n]);A.splice(n,1);ja++}F=A.length},getOffset:function(){return new Y(R,T)},getRenderer:function(){return renderer},getScaleFactor:function(){return W},setMaxOffset:function(n,t,u,K){Ca=n;Da=t;Za=u;$a=K},getViewport:r,updateOffset:q,pan:function(n,t){x=n;G=t;ja++}};ya(S);S.bind("resync",
function(){});S.bind("resize",function(){renderer.checkSize()});eb.init(function(n){S.markers=v("markers","draw",{zindex:20});y=n;O=document.getElementById(c.container);O.appendChild(P=ia.create("div","",ia.styles({width:O.offsetWidth+"px",height:O.offsetHeight+"px"})));Xa=P.offsetWidth+0;Ya=P.offsetHeight+0;jb=Xa/2;kb=Ya/2;P.appendChild(H=ia.create("div","",ia.styles({width:Xa+"px",height:Ya+"px","z-index":2,margin:"0px 0 0 0px"})));renderer=gc(c.renderer,S,H,O,c);ba=c.fastpan&&renderer.fastpan;
ga&&ga.unbind();if(renderer){ga=INTERACT.watch(renderer.interactTarget||O);if(c.scalable){ga.bind("zoom",f);ga.bind("doubleTap",d)}ga.bind("pointerDown",e);ga.bind("pointerMove",g);ga.bind("pointerUp",j);c.captureHover&&ga.bind("pointerHover",h);ga.bind("tap",k)}L?window.attachEvent("onresize",i):window.addEventListener("resize",i,false)});animFrame(l);return S});var za=function(c,f,a){a=B({style:null,xy:null,size:10,fill:false,stroke:true,draggable:false,observable:true,properties:{},typeName:"Shape"},
a);B(this,a);this.id="drawable_"+cc++;this.bounds=null;this.view=c;this.layer=f;this.rotation=this.animations=0;this.scaling=1;this.translateY=this.translateX=0;this.observable&&ya(this)};za.prototype={constructor:za,animate:function(c,f,a,b){Sb(this,c,f,a,b)},drag:null,draw:null,getProps:null,resync:function(c){if(this.xy){c.syncXY([this.xy]);this.size&&this.updateBounds(Ja.fromCenter(this.xy.x,this.xy.y,this.size,this.size))}},rotate:function(c){this.rotation=c},scale:function(c){this.scaling=c},
translate:function(c,f){this.translateX=c;this.translateY=f},updateBounds:function(c,f){c&&(!this.bounds||c.x!=this.bounds.x||c.y!=this.bounds.y)&&this.trigger("move",this,c,this.bounds);this.bounds=c;if(f)this.xy=Ja.center(this.bounds)}};var rb=1E3/60|0,Fa=[],yb=0;U("drawable","marker",function(c,f,a){a=B({fill:true,stroke:false,markerStyle:"simple",hoverStyle:"highlight",typeName:"Marker"},a);return new za(c,f,a)});U("drawable","poly",function(c,f,a){a=B({simplify:false,fill:true,points:[],typeName:"Poly"},
a);var b=a.points,d=a.simplify;za.call(this,a);B(this,{getPoints:function(){return[].concat(b)},resync:function(e){var h,g,j,i,k,p;e.syncXY(b);p=this.points=Ta.floor(d?Ta.simplify(b):b);for(var l=p.length;l--;){e=p[l].x;h=p[l].y;i=V(i,$)||e<i?e:i;k=V(k,$)||h<k?h:k;g=V(g,$)||e>g?e:g;j=V(j,$)||h>j?h:j}this.updateBounds(new oa(i,k,g-i,j-k),true)}});this.haveData=b&&b.length>=2});U("drawable","line",function(c,f,a){a.fill=false;return ua("drawable","poly",c,f,a)});U("drawable","image",function(c,f,a){function b(){if(j&&
j.width>0){if(!this.centerOffset)this.centerOffset=new Y(-j.width>>1,-j.height>>1);this.updateBounds(new oa(this.xy.x+this.centerOffset.x,this.xy.y+this.centerOffset.y,j.width,j.height),false)}}function d(k){if(this.imageUrl=k){var p=this;Oa(this.imageUrl,function(l,m){j=l;if(m){var o=i.layer?i.layer.view:null;o&&o.invalidate()}b.apply(p)})}}a=B({image:null,imageUrl:null,centerOffset:null,typeName:"Image"},a);var e=za.prototype.resync,h=0,g=0,j=a.image,i=B(new za(c,f,a),{changeImage:d,getProps:function(){this.bounds||
b(this,j);return{image:j,x:this.xy.x+h,y:this.xy.y+g}},resync:function(k){e.call(this,k);b.call(this)}});j||d.call(this,this.imageUrl);if(this.centerOffset){h=this.centerOffset.x;g=this.centerOffset.y}});U("drawable","arc",function(c,f,a){a=B({startAngle:0,endAngle:Math.PI*2,typeName:"Arc"},a);return new za(c,f,a)});Pa.prototype={constructor:Pa,clip:null,cycle:function(){},draw:function(){},hitGuess:null};U("layer","tile",function(c,f){f=B({imageLoadArgs:{}},f);var a=genId?Generator.init(genId,f).run:
null,b=null,d=[],e=B(new Pa(f),{draw:function(h,g,j){h.drawTiles&&h.drawTiles(g,b.search(Ja.buffer(g,128)),j.panSpeed<2)}});e.bind("refresh",function(h,g,j){var i=(new Date).getTime();b&&a(g,j,b,function(){g.invalidate();na("GEN COMPLETED IN "+((new Date).getTime()-i)+" ms")})});e.bind("resync",function(h,g){var j=g&&g.getZoomLevel?g.getZoomLevel():0;d[j]||(d[j]=tb(j));b=d[j]});return e});U("layer","draw",function(c,f){function a(i,k,p,l){var m=this.dragOffset;if(!m)m=this.dragOffset=new Y(i.startX-
this.xy.x,i.startY-this.xy.y);this.xy.x=k-m.x;this.xy.y=p-m.y;if(l){delete this.dragOffset;c.syncXY([this.xy],true);c.invalidate();this.trigger("dragDrop")}return true}function b(i){clearTimeout(g);g=setTimeout(function(){e.sort(function(k,p){if(p.xy&&k.xy){var l=p.xy.y-k.xy.y;return l!=0?l:p.xy.x-k.xy.x}});i&&i.invalidate()},50)}function d(i,k,p,l){l&&h.remove(l,k);h.insert(p,k)}f=B({zindex:10},f);var e=[],h,g=0,j=B(new Pa(f),{itemCount:0,clear:function(){h=new ub;e=[];j.itemCount=0},create:function(i,
k,p){i=ua("drawable",i,j,k);if(p)e.unshift(i);else e[e.length]=i;i.resync(c);h&&i.bounds&&h.insert(i.bounds,i);b(c);i.bind("move",d);j.itemCount=e.length},draw:function(i,k,p,l,m){p={};l=h&&k?h.search(k):[];for(var o=l.length;o--;){var r=l[o],v=r.style||j.style,w,D=i.applyTransform(r),C=r.getProps?r.getProps(i):p;if(C=(w=i["prep"+r.typeName])?w.call(i,r,k,m,C):null){if(m&&C.hit){m.elements.push(Hits.initHit(r.type,r,r.draggable?a:null));w=m.type+"Style";v=r[w]||j[w]||v}v=v?i.applyStyle(v,true):null;
(w=r.draw||C.draw)&&w.call(r,C);v&&i.applyStyle(v)}D&&D.undo&&D.undo()}},find:function(){return[].concat(e)},hitGuess:function(i,k){return h&&h.search({x:i-10,y:k-10,w:20,h:20}).length>0}});j.bind("resync",function(i,k){h=tb(k.getZoomLevel(),h);for(var p=e.length;p--;)e[p].resync(k)});return j});Z.prototype={constructor:Z,offset:function(c,f){var a=this.lat*ma,b=this.lon*ma,d=a+c/ab;a=fb(pa(f/ab)/Ia(a));b=b+a;d=(d+Ga)%Math.PI-Ga;b%=ha;return new Z(d*wa,b*wa)},toString:function(c){return this.lat+
(c||" ")+this.lon}};var oc=function(){function c(b,d){if(b.length){for(var e,h,g,j,i=b.length;i--;){c(b[i],d);e=V(e,$)||b.x<e?b.x:e;h=V(h,$)||b.y<h?b.y:h;g=V(g,$)||b.x>g?b.x:g;j=V(j,$)||b.y>j?b.y:j}return new oa(e,h,g-e,j-h)}else if(b.mercXY){e=b.mercXY;b.x=Ha((e.x+Math.PI)/d);b.y=Ha((Math.PI-e.y)/d);b.rpp=d}return b}function f(b,d){if(b.length)for(var e=b.length;e--;)f(b[e],d);else{b.mercXY=new Y(b.x*d-Math.PI,Math.PI-b.y*d);b.pos=aa.fromMercatorPixels(b.mercXY.x,b.mercXY.y)}return b}function a(b,
d,e){b.pos=d;b.mercXY=aa.toMercatorPixels(d);(e=V(e,bc)?e:b.rpp)&&c(b,e)}return{init:function(b,d){var e=new Y;a(e,b,d);return e},sync:c,syncPos:f,toPos:function(b,d){d=d||b.rpp;return aa.fromMercatorPixels(b.x*d-Math.PI,Math.PI-b.y*d)},updatePos:a}}();B(M,{ticks:sb,userMessage:function(c,f,a){M.trigger("userMessage",c,f,a)},DOM:ia,Rect:oa,XY:Ta,XYRect:Ja,Vector:ec,Hits:Hits,Service:Ba,tweenValue:Na,easing:bb,Tile:cb,getImage:Oa,GeoXY:oc,Pos:Z});var nb=[1.406245461070741,1.321415085624082,1.077179995861952,
0.703119412486786,0.488332580888611],ma=Math.PI/180,wa=180/Math.PI,ob=Ga,Kb=-ob,Lb=ha,pc=-Lb,ab=6371,Qa=0.08181919084262157,Ma=null,Mb={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",HWY:"HIGHWAY",MWY:"MOTORWAY"},aa=function(){function c(a){return!a||a.lat===0&&a.lon===0}function f(a,b){return new Z(a,b)}return{calcDistance:function(a,b){if(c(a)||c(b))return 0;var d=(b.lat-a.lat)*ma>>1,e=(b.lon-a.lon)*ma>>1;d=pa(d)*pa(d)+Ia(a.lat*ma)*Ia(b.lat*ma)*pa(e)*pa(e);d=2*ac(Sa(d),
Sa(1-d));return ab*d},copy:function(a){return a?f(a.lat,a.lon):null},empty:c,equal:function(a,b){return a&&b&&a.lat==b.lat&&a.lon==b.lon},fromMercatorPixels:function(a,b){for(var d=sa(Math.E,-b),e=Ga-2*Bb(d),h=Ab(e,d),g=0;g<12&&fa(e-h)>1.0E-7;){e=h;h=Ab(e,d);g++}return f(h*wa,a%360*wa)},generalize:function(a,b,d){var e=a.length,h=[],g=null;d||(d=250);d/=1E3;na("generalizing positions, must include "+b.length+" positions");for(var j=e;j--;)if(j===0)h.unshift(a[j]);else{var i=!g||aa.inArray(a[j],b)?
d:aa.calcDistance(g,a[j]);if(a[j]&&i>=d){h.unshift(a[j]);g=a[j]}}na("generalized "+e+" positions into "+h.length+" positions");return h},inArray:function(a,b){for(var d=aa.equal,e=b.length;e--;)if(d(a,b[e]))return true;return false},inBounds:function(a,b){var d=!(aa.empty(a)||aa.empty(b));return d=(d=d&&a.lat>=b.min.lat&&a.lat<=b.max.lat)&&a.lon>=b.min.lon&&a.lon<=b.max.lon},init:f,parse:function(a){return new Z(a)},parseArray:function(a){var b=a.length,d=Array(b);for(b=b;b--;)d[b]=new Z(a[b]);return d},
toMercatorPixels:function(a){var b=parseFloat(a.lon)*ma;a=parseFloat(a.lat)*ma;a=pa(a);var d=Qa*a;a=ta((1+a)/(1-a)*sa((1-d)/(1+d),Qa))/2;return new Y(b,a)},toString:function(a){return a?a.toString():""},vectorize:function(a,b){function d(){for(var j=0,i=b.chunkSize,k=e;k--;){h[k]=M.GeoXY.init(a[k]);j+=1;if(j>i)break}e=k;if(e<=0)b.callback&&b.callback(h);else animFrame(d)}var e=a.length,h=Array(e);b=B({chunkSize:500,async:true,callback:null},b);if(!b.async){for(var g=e;g--;)h[g]=M.GeoXY.init(a[g]);
return h}animFrame(d);return null}}}(),Nb=function(){function c(d,e,h){var g=new Y(0,e.lat-d.lat);g.x=(h||V(h,$))&&d.lon>e.lon?360-d.lon+e.lon:e.lon-d.lon;return g}function f(d,e){return Nb.init(new Z(d.min.lat-e,d.min.lon-e%360),new Z(d.max.lat+e,d.max.lon+e%360))}function a(d){var e=c(d.min,d.max);return new Z(d.min.lat+(e.y>>1),d.min.lon+(e.x>>1))}function b(d,e){return{min:new Z(d),max:new Z(e)}}return{calcSize:c,createBoundsFromCenter:function(d,e){var h=e/ab,g=d.lat*ma,j=d.lon*ma,i=g-h,k=g+
h;if(i>Kb&&k<ob){g=fb(pa(h)/Ia(g));h=(j-g)%ha;j=(j+g)%ha}else{i=ra(i,Kb);k=qa(k,ob);h=pc;j=Lb}return Nb.init(new Z(i*wa,h*wa),new Z(k*wa,j*wa))},expand:f,forPositions:function(d,e){var h=null;M.ticks();e||(e="auto");for(var g=d.length;g--;)if(h){var j=c(h.min,d[g],false),i=c(d[g],h.max,false);if(j.x<0)h.min.lon=d[g].lon;if(j.y<0)h.min.lat=d[g].lat;if(i.x<0)h.max.lon=d[g].lon;if(i.y<0)h.max.lat=d[g].lat}else h=b(d[g],d[g]);if(e){if(e=="auto"){g=c(h.min,h.max);e=ra(g.x,g.y)*0.3}h=f(h,e)}return h},getCenter:a,
getZoomLevel:function(d,e){var h=a(d);h=qa(Ha(fa(h.lat)*0.05),nb.length);var g=nb[h],j=c(d.min,d.max);h=Eb(ta(nb[3]*e.h/j.y)/ta(2));g=Eb(ta(g*e.w/j.x)/ta(2));return qa(isNaN(h)?1E3:h,isNaN(g)?1E3:g)},init:b,isEmpty:function(d){return!d||aa.empty(d.min)||aa.empty(d.max)},toString:function(d){return"min: "+aa.toString(d.min)+", max: "+aa.toString(d.max)}}}();Ba=function(){var c=/^(\d+).*$/,f=/(\d+)\s?\-\s?(\d+)/;return{buildingMatch:function(a,b){c.lastIndex=-1;if(c.test(a))for(var d=a.replace(c,"$1"),
e=b.split(","),h=0;h<e.length;h++){f.lastIndex=-1;if(f.test(e[h])){var g=f.exec(e[h]);if(d>=parseInt(g[1],10)&&d<=parseInt(g[2],10))return true}else if(d==e[h])return true}return false},normalize:function(a){if(!a)return"";a=a.toUpperCase();if(!Ma){var b=[];for(var d in Mb)b.push(d);Ma=RegExp("(\\s)("+b.join("|")+")(\\s|$)","i")}Ma.lastIndex=-1;if(b=Ma.exec(a))a=a.replace(Ma,"$1"+Mb[b[2]]);return a},toString:function(a){return a.streetDetails+" "+a.location}}}();U("generator","osm",function(c){c=
M.ex({flipY:false,tileSize:256,tilePath:"{0}/{1}/{2}.png",osmDataAck:true},c);var f=Math.PI/180,a=180/Math.PI,b=null,d=[],e,h=M.formatter(c.tilePath),g={buildTileUrl:function(j,i,k,p,l){if(i>=0&&i<p){j=(j%p+p)%p;i=h(k,j,l?Math.abs(i-p+1):i);if(b)i=e(d[j%(d.length||1)])+i;return i}},run:function(j,i,k,p){if(j=j.getZoomLevel?j.getZoomLevel():0){var l=2<<j-1,m=c.tileSize,o=Math.PI*2/(m<<j),r=(i.w/m|0)+1,v=(i.h/m|0)+1;i=M.GeoXY.toPos(M.XY.init(i.x,i.y),o);var w=i.lat;i=M.XY.init((i.lon+180)/360*l|0,(1-
Math.log(Math.tan(w*f)+1/Math.cos(w*f))/Math.PI)/2*l%l|0);w=Math.PI-2*Math.PI*i.y/l;var D=i.x/l*360-180;w=new M.Pos(a*Math.atan(0.5*(Math.exp(w)-Math.exp(-w))),D);o=M.GeoXY.init(w,o);w=c.flipY;var C=k.search({x:o.x,y:o.y,w:r*m,h:v*m});D={};var z;for(z=C.length;z--;)D[C[z].id]=true;d=(b=g.getServerDetails?g.getServerDetails():null)&&b.subDomains?b.subDomains:[];e=M.formatter(b?b.baseUrl:"");for(C=0;C<=r;C++)for(z=0;z<=v;z++){var q=i.x+C,E=i.y+z,I=q+"_"+E;if(!D[I]){tileUrl=g.buildTileUrl(q,E,j,l,w);
q=new M.Tile(o.x+C*m,o.y+z*m,tileUrl,m,m,I);k.insert(q,q)}}p&&p()}}};c.osmDataAck&&M.userMessage("ack","osm",'Map data (c) <a href="http://openstreetmap.org/" target="_blank">OpenStreetMap</a> (and) contributors, CC-BY-SA');return g});var qc="featurecollection",rc="feature",Cb={async:false};U={processor:null,group:"shapes",layer:"draw"};var sc={point:B({},U,{processor:function(c,f,a,b){f=db([f.coordinates],Cb);if(f.length>0)if(a=b.marker(f[0],a)){c.add(a);return f.length}},group:"markers",layer:"draw"}),
linestring:B({},U,{processor:function(c,f,a,b){f=db(f&&f.coordinates?f.coordinates:[]);return Ra(c,f,a,b.line)}}),multilinestring:B({},U,{processor:function(c,f,a,b){f=f&&f.coordinates?f.coordinates:[];for(var d=0,e=f.length;e--;)d+=Ra(c,f[e],a,b.line);return d}}),polygon:B({},U,{processor:function(c,f,a,b){f=f&&f.coordinates?f.coordinates:[];if(f.length>0)return Ra(c,f[0],a,b.poly);return 0}}),multipolygon:B({},U,{processor:function(c,f,a,b){f=f&&f.coordinates?f.coordinates:[];for(var d=0,e=0;e<
f.length;e++)d+=Ra(c,f[e][0],a,b.poly);return d}})},Ob=function(c,f,a,b){function d(r,v){var w=r.processor,D=i+r.group,C=B({},r,a,{properties:v.properties});if(w){var z=o[D];if(!z){z=new r.layerClass({id:D});o[D]=z}return w(z,v.data,C,b)}return 0}function e(r,v){var w=r&&r.type?r.type.toLowerCase():null;return w&&w===rc?e(r.geometry,r.properties):{type:w,isCollection:w?w===qc:false,definition:sc[w],data:r,properties:v?v:r.properties}}function h(r){var v=0,w=B({},a),D=k;r=r?r:(new Date).getTime();
if(!l){for(;D<p;D++){r=e(j?j(c[D]):c[D]);var C=null;if(r.isCollection){w.layerPrefix=i+m++ +"-";l=new Ob(r.data.features,function(z){l=null;for(var q in z)o[q]=z[q];k>=p&&f&&f(o)},w);C+=1}else if(r.definition)C=d(r.definition,r);v+=C?C:1;if(v>=g)break}k=D+1;if(l||k<p)animFrame(h);else f&&f(o)}}a=B({rowPreParse:null,simplify:false,layerPrefix:"geojson-"},a);b=B({marker:function(r){return ua("drawable","marker",{xy:r})},line:function(r,v){return ua("drawable","line",B({points:r},a,v))},poly:function(r,
v){return ua("drawable","poly",B({points:r},a,v))}},b);var g=500,j=a.rowPreParse,i=a.layerPrefix,k=0,p=0,l=null,m=0,o={};if(c){V(c,"array")||(c=[c]);p=c.length;animFrame(h)}};U=M.GeoJSON={parse:function(c,f,a){return new Ob(c,f,a)}};M.Geo={Address:function(c){return c=B({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},c)},A:Ba,GeoJSON:U};pb.T5=M;pb.Tile5=function(c,f,a){f=B({type:"map",renderer:"canvas",starpos:null,zoom:1,fastpan:false,drawOnScale:true,zoombar:{}},
f);c=ua("view",f.type,f);c.id=a||_objId("view");return c}})(window);
