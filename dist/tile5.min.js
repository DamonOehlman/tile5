COG=typeof COG!=="undefined"?COG:{};COG.extend=function(){for(var ja=arguments[0]||{},ra,L=1,J=arguments.length;L<J;L++)if((ra=arguments[L])!==null)for(var x in ra){var A=ra[x];if(ja!==A)if(A!==undefined)ja[x]=A}return ja};
(function(){var ja=Object.prototype.hasOwnProperty,ra=0,L={};L.toID=function(J){return J.replace(/\s/g,"-")};L.objId=function(J){return(J?J:"obj")+ra++};L.isFunction=function(J){return toString.call(J)==="[object Function]"};L.isArray=function(J){return toString.call(J)==="[object Array]"};L.isPlainObject=function(J){if(!J||toString.call(J)!=="[object Object]"||J.nodeType||J.setInterval)return false;if(J.constructor&&!ja.call(J,"constructor")&&!ja.call(J.constructor.prototype,"isPrototypeOf"))return false;
var x;for(x in J);return x===undefined||ja.call(J,x)};L.isEmptyObject=function(J){for(var x in J)return false;return true};L.isXmlDocument=function(J){return toString.call(J)==="[object Document]"};L.contains=function(J,x){var A=J,G=arguments,S=1;if(x&&module.isArray(x)){G=x;S=0}for(S=S;S<G;S++)A=A&&typeof foo[G[S]]!=="undefined";return A};L.formatStr=function(J){if(arguments.length<=1)return J;for(var x=arguments.length-2,A=0;A<=x;A++)J=J.replace(RegExp("\\{"+A+"\\}","gi"),arguments[A+1]);return J};
L.wordExists=function(J,x){var A="";if(x.toString)x=x.toString();for(var G=0;G<x.length;G++)A+=!/\w/.test(x[G])?"\\"+x[G]:x[G];return RegExp("(^|\\s|\\,)"+A+"(\\,|\\s|$)","i").test(J)};COG.extend(COG,L)})();
(function(){function ja(A){return typeof console!=="undefined"?function(){console[A](Array.prototype.slice.call(arguments,0).join(" "));return true}:function(){return false}}var ra=window.console&&window.console.markTimeline,L=ja("error"),J=ja("info"),x=function(){return ra?function(A,G){console.markTimeline(A+(G?": "+((new Date).getTime()-G)+"ms":""))}:function(){}}();COG.extend(COG,{trace:x,debug:ja("debug"),info:J,warn:ja("warn"),error:L,exception:function(A){if(L)for(var G in A)J("ERROR DETAIL: "+
G+": "+A[G])}})})();
COG.Loopage=function(){function ja(Z){return COG.extend({id:A++,frequency:0,after:0,single:false,lastTick:0,execute:function(){}},Z)}function ra(Z){S.push(Z);L()}function L(){pa&&clearTimeout(pa);pa=setTimeout(J,0);ua=true}function J(){for(var Z,B=(new Date).getTime(),C=G.length;S.length>0;){var I=S.shift();for(Z=C;Z--;)if(G[Z].id===I){G.splice(Z,1);break}ua=true;C=G.length}if(ua){ga=x;for(Z=C;Z--;)ga=G[Z].frequency<ga?G[Z].frequency:ga}for(Z=C;Z--;){I=B-G[Z].lastTick;if(G[Z].lastTick===0||I>=G[Z].frequency){G[Z].execute(B,
G[Z]);G[Z].lastTick=B;G[Z].single&&G[Z].trigger("complete")}}pa=C?setTimeout(J,ga):0}var x=6E4,A=0,G=[],S=[],pa=0,ga=x,ua=true;return{join:function(Z){var B=new ja(Z);if(B.after>0)B.lastTick=(new Date).getTime()+B.after;COG.observable(B);B.bind("complete",function(){ra(B.id)});G.unshift(B);L();return B},leave:ra}}();
(function(){function ja(L,J){var x=L.obsHandlers;x[J]||(x[J]=[]);return x[J]}var ra=0;COG.observable=function(L){if(!L)return null;if(!L.obsHandlers)L.obsHandlers={};if(!(L.bind||L.trigger||L.unbind)){L.bind=function(J,x){var A="callback"+ra++;ja(L,J).unshift({fn:x,id:A});return A};L.trigger=function(J){var x=ja(L,J),A={cancel:false,name:J,tickCount:(new Date).getTime()},G;if(!x)return null;G=Array.prototype.slice.call(arguments,1);L.eventInterceptor&&L.eventInterceptor(J,A,G);G.unshift(A);for(var S=
x.length;S--&&!A.cancel;)x[S].fn.apply(self,G);return A};L.unbind=function(J,x){if(typeof J==="undefined")L.obsHandlers={};else for(var A=ja(L,J),G=0;A&&G<A.length;G++)if(A[G].id===x){A.splice(G,1);break}return L}}return L}})();
(function(){function ja(x,A){x[A]||(x[A]=function(G){return x.configure(A,G)})}function ra(x){x.gtConfId="configurable"+J++;x.gtConfig={};x.gtConfigFns=[];return x.gtConfig}var L={},J=0;COG.paramTweaker=function(x,A,G){return function(S,pa){if(typeof pa!=="undefined"){if(S in x)x[S]=pa;G&&S in G&&G[S](S,pa)}else return A&&S in A?A[S](S):x[S]}};COG.configurable=function(x,A,G,S){if(x){x.gtConfId||ra(x);var pa=x.gtConfId,ga=x.gtConfig,ua=x.gtConfigFns;L[pa]=x;ua.push(G);for(G=A.length;G--;){ga[A[G]]=
true;S&&ja(x,A[G])}if(!x.configure)x.configure=function(Z,B){if(ga[Z]){for(var C=ua.length;C--;){var I=ua[C](Z,B);if(typeof I!=="undefined")return I}return L[pa]}return null}}}})();
(function(){function ja(x){var A=document.createElement("script"),G=false;A.src=x;A.async=true;A.onload=A.onreadystatechange=function(){if(!G&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){G=true;A.onload=A.onreadystatechange=null;A&&A.parentNode&&A.parentNode.removeChild(A)}};L||(L=document.getElementsByTagName("head")[0]);L.appendChild(A)}var ra=0,L,J=this;COG.jsonp=function(x,A,G){x+=x.indexOf("?")>=0?"&":"?";var S="json"+ ++ra;J[S]=function(pa){A(pa);J[S]=null;
try{delete J[S]}catch(ga){}};ja(x+(G?G:"callback")+"="+S);return S}})();
(function(){function ja(f){if(Z)return ga.length;Z=true;try{for(var r=0;r<ga.length;)if(ga[r].isComplete()){ga[r].triggerComplete(false);ga.splice(r,1)}else{ga[r].update(f);r++}}finally{Z=false}ga.length===0&&ua.trigger("complete");return ga.length}function ra(){if(!ua){ua=COG.Loopage.join({execute:ja,frequency:20});ua.bind("complete",function(){ua=null})}}var L=1.70158,J=Math.PI/2,x=Math.abs,A=Math.pow,G=Math.sin,S=Math.asin,pa=Math.cos,ga=[],ua=null,Z=false,B={linear:function(f,r,u,y){return u*
f/y+r},backin:function(f,r,u,y){return u*(f/=y)*f*((L+1)*f-L)+r},backout:function(f,r,u,y){return u*((f=f/y-1)*f*((L+1)*f+L)+1)+r},backinout:function(f,r,u,y){return(f/=y/2)<1?u/2*f*f*(((L*=1.525)+1)*f-L)+r:u/2*((f-=2)*f*(((L*=1.525)+1)*f+L)+2)+r},bouncein:function(f,r,u,y){return u-B.bounceout(y-f,0,u,y)+r},bounceout:function(f,r,u,y){return(f/=y)<1/2.75?u*7.5625*f*f+r:f<2/2.75?u*(7.5625*(f-=1.5/2.75)*f+0.75)+r:f<2.5/2.75?u*(7.5625*(f-=2.25/2.75)*f+0.9375)+r:u*(7.5625*(f-=2.625/2.75)*f+0.984375)+
r},bounceinout:function(f,r,u,y){return f<y/2?B.bouncein(f*2,0,u,y)/2+r:B.bounceout(f*2-y,0,u,y)/2+u/2+r},cubicin:function(f,r,u,y){return u*(f/=y)*f*f+r},cubicout:function(f,r,u,y){return u*((f=f/y-1)*f*f+1)+r},cubicinout:function(f,r,u,y){if((f/=y/2)<1)return u/2*f*f*f+r;return u/2*((f-=2)*f*f+2)+r},elasticin:function(f,r,u,y,T,P){if(f==0)return r;if((f/=y)==1)return r+u;P||(P=y*0.3);if(!T||T<x(u)){T=u;u=P/4}else u=P/TWO_PI*S(u/T);return-(T*A(2,10*(f-=1))*G((f*y-u)*TWO_PI/P))+r},elasticout:function(f,
r,u,y,T,P){var la;if(f==0)return r;if((f/=y)==1)return r+u;P||(P=y*0.3);if(!T||T<x(u)){T=u;la=P/4}else la=P/TWO_PI*S(u/T);return T*A(2,-10*f)*G((f*y-la)*TWO_PI/P)+u+r},elasticinout:function(f,r,u,y,T,P){var la;if(f==0)return r;if((f/=y/2)==2)return r+u;P||(P=y*0.3*1.5);if(!T||T<x(u)){T=u;la=P/4}else la=P/TWO_PI*S(u/T);if(f<1)return-0.5*T*A(2,10*(f-=1))*G((f*y-la)*TWO_PI/P)+r;return T*A(2,-10*(f-=1))*G((f*y-la)*TWO_PI/P)*0.5+u+r},quadin:function(f,r,u,y){return u*(f/=y)*f+r},quadout:function(f,r,u,
y){return-u*(f/=y)*(f-2)+r},quadinout:function(f,r,u,y){if((f/=y/2)<1)return u/2*f*f+r;return-u/2*(--f*(f-2)-1)+r},sinein:function(f,r,u,y){return-u*pa(f/y*J)+u+r},sineout:function(f,r,u,y){return u*G(f/y*J)+r},sineinout:function(f,r,u,y){return-u/2*(pa(Math.PI*f/y)-1)+r}},C=COG.Tween=function(f){f=COG.extend({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:I("sine.out"),complete:null},f);var r=(new Date).getTime(),u=[],y=false,T=0,P=0,la={isComplete:function(){return y},
triggerComplete:function(sa){f.complete&&f.complete(sa)},update:function(sa){try{var Ga=f.tweenFn(sa-r,T,P,f.duration);if(f.target)f.target[f.property]=Ga;for(var ta=u.length;ta--;)u[ta](Ga,void 0);if(y=r+f.duration<=sa){if(f.target)f.target[f.property]=f.tweenFn(f.duration,T,P,f.duration);for(var Ia=u.length;Ia--;)u[Ia](Ga,true)}}catch(Aa){COG.exception(Aa)}},requestUpdates:function(sa){u.push(sa)}};T=f.target&&f.property&&f.target[f.property]?f.target[f.property]:f.startValue;if(typeof f.endValue!==
"undefined")P=f.endValue-T;if(P==0)y=true;ra();return la};COG.tweenValue=function(f,r,u,y,T){f=new C({startValue:f,endValue:r,tweenFn:u,complete:y,duration:T});ga.push(f);return f};COG.tween=function(f,r,u,y,T,P){f=new C({target:f,property:r,endValue:u,tweenFn:y,duration:P,complete:T});ga.push(f);return f};COG.endTweens=function(f){if(!Z){Z=true;try{for(var r=0;r<ga.length;)if(!f||f(ga[r])){ga[r].triggerComplete(true);ga.splice(r,1)}else r++}finally{Z=false}}};COG.getTweens=function(){return[].concat(ga)};
var I=COG.easing=function(f){return B[f.replace(/[\-\_\s\.]/g,"").toLowerCase()]};COG.registerEasingType=function(f,r){B[f.replace(/[\-\_\s\.]/g,"").toLowerCase()]=r}})();
INTERACT=function(){function ja(B){return function(C,I,f){(f?f:B?document.body:document).addEventListener(C,I,false)}}function ra(B){return function(C,I,f){(f?f:B?document.body:document).removeEventListener(C,I,false)}}function L(B,C,I){(I?I:document).attachEvent("on"+B,C)}function J(B,C,I){(I?I:document).detachEvent("on"+B,C)}function x(B,C){return{x:B?B:0,y:C?C:0,count:1}}function A(B,C){ua.push(COG.extend({handler:null,checks:{},type:B},C))}function G(B){var C=0,I=0;if(B.offsetParent){do{C+=B.offsetLeft;
I+=B.offsetTop;B=B.offsetParent}while(B)}return{x:C,y:I}}function S(B,C){for(var I=B.target?B.target:B.srcElement;I&&I.nodeName&&I.nodeName.toUpperCase()!="CANVAS";)I=I.parentNode;return I&&I===C}function pa(B,C){return{x:B.x-(C?C.x:0),y:B.y-(C?C.y:0)}}function ga(B){if(B.preventDefault){B.preventDefault();B.stopPropagation()}else B.cancelBubble&&B.cancelBubble()}var ua=[],Z=function(B,C,I){function f(P,la,sa,Ga){r.trigger("pan",Ga.x,Ga.y)}I=COG.extend({binder:null,unbinder:null,observable:null},
I);for(var r=I.observable,u=[],y={bind:function(){return r.bind.apply(null,arguments)},pannable:function(P){COG.extend({inertia:true},P);r.bind("pointerMove",f);return y},unbind:function(){r.unbind();for(var P=0;P<u.length;P++)u[P].unbind();return y}},T=0;T<C.length;T++)u.push(C[T](B,r,I));return y};A("pointer",{handler:function(B,C,I){function f(w){if(S(w,B))if(Ga=T(w)){B.style.cursor="move";ga(w);Ba=w.pageX?w.pageX:w.screenX;N=w.pageY?w.pageY:w.screenY;ta=x(Ba,N);Ia=G(B);C.trigger("pointerDown",
ta,pa(ta,Ia))}}function r(w){Aa=w.pageX?w.pageX:w.screenX;va=w.pageY?w.pageY:w.screenY;Ga&&S(w,B)&&P("pointerMove")}function u(w){if(Ga&&T(w)){Ga=false;if(S(w,B)){B.style.cursor="default";P("pointerUp")}}}function y(w){if(S(w,B)){var ma;w=w||window.event;if(w.detail)ma=w.axis===2?-w.detail*la:0;else{ma=w.wheelDeltaY?w.wheelDeltaY:w.wheelDelta;if(window.opera)ma=-ma}if(ma!==0){var Sa=x(Aa,va);C.trigger("zoom",Sa,pa(Sa,G(B)),ma/sa,"wheel");ga(w);w.returnValue=false}}}function T(w){w=w||window.event;
return(w.which||w.button)==1}function P(w){var ma=x(Aa,va);C.trigger(w,ma,pa(ma,Ia),x(Aa-Ba,va-N));Ba=Aa;N=va}I=COG.extend({inertia:false},I);var la=120,sa=la*8,Ga=false,ta,Ia,Aa,va,Ba,N;I.binder("mousedown",f,false);I.binder("mousemove",r,false);I.binder("mouseup",u,false);I.binder("click",function(w){if(S(w,B)){w=x(w.pageX?w.pageX:w.screenX,w.pageY?w.pageY:w.screenY);C.trigger("tap",w,pa(w,G(B)))}},false);I.binder("dblclick",function(w){COG.info("captured double click");if(S(w,B)){w=x(w.pageX?w.pageX:
w.screenX,w.pageY?w.pageY:w.screenY);COG.info("captured double click + target matched");C.trigger("doubleTap",w,pa(w,G(B)))}},false);I.binder("mousewheel",y,document);I.binder("DOMMouseScroll",y,document);return{unbind:function(){I.unbinder("mousedown",f,false);I.unbinder("mousemove",r,false);I.unbinder("mouseup",u,false);I.unbinder("mousewheel",y,document);I.unbinder("DOMMouseScroll",y,document)}}},checks:{touch:false}});A("pointer",{handler:function(B,C,I){function f(U){if(U.count<2)return 0;var ea=
U.x-U.next.x;U=U.y-U.next.y;return~~Math.sqrt(ea*ea+U*U)}function r(U,ea,fa){ea=ea?ea:0;fa=fa?fa:0;for(var La={x:U.x-ea,y:U.y-fa,id:U.id,count:U.count},Ca=La;U.next;){U=U.next;Ca=Ca.next={x:U.x-ea,y:U.y-fa,id:U.id}}return La}function u(U,ea){var fa=U[ea?ea:"touches"],La,Ca;if(fa.length===0)return null;Ca=La={x:fa[0].pageX,y:fa[0].pageY,id:fa[0].identifier,count:fa.length};for(var Ta=1,ab=fa.length;Ta<ab;Ta++)Ca=Ca.next={x:fa[Ta].pageX,y:fa[Ta].pageY,id:fa[Ta].identifier};return La}function y(U){if(S(U,
B)){va=G(B);var ea=u(U,"changedTouches"),fa=r(ea,va.x,va.y);if(!N){Ba=ta;C.trigger("pointerDown",ea,fa)}Ja&&C.trigger("pointerDownMulti",ea,fa);N=u(U);if(N.count>1)ma=f(N);cb=1;Sa=r(N)}}function T(U){if(S(U,B)){U.preventDefault();w=u(U);if(Ba==ta)Ba=Math.abs(N.x-w.x)>sa||Math.abs(N.y-w.y)>sa?Ga:ta;if(Ba!=ta){Ba=w.count>1?Aa:Ia;if(Ba==Aa)if(N.count===1){N=r(w);ma=f(N)}else{U=f(w);if(Math.abs(ma-U)<la)Ba=Ia;else{var ea;ea=w.x;var fa=w.next.x,La=w.y,Ca=w.next.y,Ta=La<Ca?La:Ca;ea={x:(ea<fa?ea:fa)+(Math.abs(ea-
fa)>>1),y:Ta+(Math.abs(La-Ca)>>1)};U=U/ma;fa=U-cb;C.trigger("zoom",ea,pa(ea,va),fa,"pinch");cb=U}}Ba==Ia&&C.trigger("pointerMove",w,r(w,va.x,va.y),x(w.x-Sa.x,w.y-Sa.y));Ja&&C.trigger("pointerMoveMulti",w,r(w,va.x,va.y))}Sa=r(w)}}function P(U){if(S(U,B)){var ea=u(U,"changedTouches"),fa=r(ea,va.x,va.y);w=u(U);if(!w){Ba===ta&&C.trigger("pointerTap",ea,fa);C.trigger("pointerUp",ea,fa);N=null}Ja&&C.trigger("pointerUpMulti",ea,fa)}}I=COG.extend({detailed:false,inertia:false},I);var la=20,sa=7,Ga=0,ta=1,
Ia=2,Aa=3,va,Ba,N,w,ma,Sa,Ja=I.detailed,cb=1;I.binder("touchstart",y,false);I.binder("touchmove",T,false);I.binder("touchend",P,false);COG.info("initialized touch handler");return{unbind:function(){I.unbinder("touchstart",y,false);I.unbinder("touchmove",T,false);I.unbinder("touchend",P,false)}}},checks:{touch:true}});return{register:A,watch:function(B,C,I){C=COG.extend({bindToBody:false,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},C);capabilities=COG.extend({touch:"ontouchstart"in
window},I);if(!C.observable){COG.info("creating observable");C.observable=COG.observable({});globalOpts=C}C.binder=C.isIE?L:ja(C.bindToBody);C.unbinder=C.isIE?J:ra(C.bindToBody);I=C.types;for(var f=capabilities,r=[],u=ua.length;u--;){var y=ua[u],T=!I||I.indexOf(y.type)>=0,P=true;for(var la in y.checks){var sa=y.checks[la];COG.info("checking "+la+" capability. require: "+sa+", capability = "+f[la]);P=P&&sa===f[la]}if(T&&P)r[r.length]=y.handler}return new Z(B,r,C)}}}();
T5=function(){function ja(){return(new Date).getTime()}function ra(){for(;fa.length>0;){var c=fa.shift();document.location=c}ea=0}function L(c){for(var o=true,h=La.length;h--;)o=o&&c!=La[h];return o}function J(c,o){var h=[];for(var a in o)a&&h.push(a+"="+escape(o[a]));return"tile5://"+c+"/"+(h.length>0?"?"+h.join("&"):"")}function x(c,o){L(c)&&COG.info("would push url: "+J(c,o))}function A(c,o){if(L(c)){fa.push(J(c,o));ea||(ea=setTimeout(ra,100))}}function G(c){return function(o,h,a){(a?a:c?document.body:
document).addEventListener(o,h,false)}}function S(c){return function(o,h,a){(a?a:c?document.body:document).removeEventListener(o,h,false)}}function pa(c,o,h){(h?h:document).attachEvent("on"+c,o)}function ga(c,o,h){(h?h:document).detachEvent("on"+c,o)}function ua(){Ja={base:{name:"Unknown",bindEvent:G(),unbindEvent:S(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:x,targetFps:null},ie:{name:"MSIE",
regex:/msie/i,bindEvent:pa,unbindEvent:ga,requireFastDraw:false,targetFps:25},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:A,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:A},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:A},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:G(true),unbindEvent:S(true),supportsTouch:true,getScaling:function(){return 1/
window.devicePixelRatio},bridgeNotify:A},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:A}};cb=[Ja.froyo,Ja.android,Ja.ipod,Ja.iphone,Ja.ipad,Ja.ie]}function Z(){Ja||ua();if(!U){COG.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var c=0;c<cb.length;c++){var o=cb[c];if(o.regex&&o.regex.test(navigator.userAgent)){U=COG.extend({},Ja.base,o);COG.info("PLATFORM DETECTED AS: "+U.name);break}}if(!U){COG.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
U=Ja.base}COG.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return U}function B(c,o){function h(e,i){if(e&&a!==e){var l=c.triggerAll("zoomLevelChange",e,i);if(l)a=e;return l}}o=COG.extend({initial:1,min:0,max:null},o);var a=o.initial;COG.extend(c,{getZoomLevel:function(){return a},setZoomLevel:h});c.bind("scale",function(e,i,l){var q=Math.log(i)/Math.LN2;COG.endTweens(function(v){return v.cancelOnInteract});e.cancel=!h(a+q,l);e.cancel||c.updateOffset(l.x*i,l.y*i)})}function C(){for(var c=
0,o=arguments.length;o--;){var h=yb[arguments[o].toUpperCase()];if(h)c|=h}return c}var I=Math.PI*2,f=Math.PI/2,r=Math.abs,u=Math.ceil,y=Math.min,T=Math.max,P=Math.pow,la=Math.sqrt,sa=Math.log,Ga=Math.round,ta=Math.sin,Ia=Math.asin,Aa=Math.cos,va=Math.atan,Ba=Math.atan2,N=function(){function c(a,e){return h(a.x-e.x,a.y-e.y)}function o(a,e){if(!e)e=a.length;if(e<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var i={edges:Array(e-1),accrued:Array(e-1),total:0},
l=0;l<e-1;l++){var q=c(a[l],a[l+1]);i.edges[l]=la(q.x*q.x+q.y*q.y);i.accrued[l]=i.total+i.edges[l];i.total+=i.edges[l]}return i}function h(a,e){return{x:a?a:0,y:e?e:0}}return{VECTOR_SIMPLIFICATION:3,SIMPLIFICATION_MIN_VECTORS:25,add:function(){for(var a=0,e=0,i=arguments.length;i--;){a+=arguments[i].x;e+=arguments[i].y}return h(a,e)},absSize:function(a){return T(r(a.x),r(a.y))},copy:function(a){return a?h(a.x,a.y):null},diff:c,distance:function(a,e){return o(a,e).total},edges:o,equals:function(a,
e){return a.x===e.x&&a.y===e.y},extendBy:function(a,e,i){var l=Aa(e)*i;e=ta(e)*i;return h(a.x-l,a.y-e)},floor:function(a){for(var e=Array(a.length),i=a.length;i--;)e[i]=h(~~a[i].x,~~a[i].y);return e},getRect:function(a){for(var e,i,l,q,v=a.length;v--;){var m=a[v];e=typeof e==="undefined"||m.x<e?m.x:e;i=typeof i==="undefined"||m.y<i?m.y:i;l=typeof l==="undefined"||m.x>l?m.x:l;q=typeof q==="undefined"||m.y>q?m.y:q}return ma.init(e,i,l,q)},init:h,invert:function(a){return h(-a.x,-a.y)},min:function(a,
e){return h(a.x<e.x?a.x:e.x,a.y<e.y?a.y:e.y)},max:function(a,e){return h(a.x>e.x?a.x:e.x,a.y>e.y?a.y:e.y)},offset:function(a,e,i){return h(a.x+e,a.y+(i?i:e))},simplify:function(a,e){if(!a)return null;e=e?e:N.VECTOR_SIMPLIFICATION;for(var i=[],l=null,q=a.length;q--;){var v=a[q];if(include=!l||q===0||r(v.x-l.x)+r(v.y-l.y)>e){i.unshift(v);l=v}}return i},theta:function(a,e,i){i=Ia((a.y-e.y)/i);return a.x>e.x?i:Math.PI-i}}}(),w=function(){return{dotProduct:function(c,o){return c.x*o.x+c.y*o.y}}}(),ma=
function(){function c(h){return o(h.x1,h.y1,h.x2,h.y2)}function o(h,a,e,i){h=h?h:0;a=a?a:0;e=typeof e!=="undefined"?e:h;i=typeof i!=="undefined "?i:i;return{x1:h,y1:a,x2:e,y2:i,width:e-h,height:i-a}}return{center:function(h){return N.init(h.x1+h.width/2,h.y1+h.height/2)},copy:c,diagonalSize:function(h){return la(h.width*h.width+h.height*h.height)},fromCenter:function(h,a,e,i){e=e>>1;i=i>>1;return o(h-e,a-i,h+e,a+i)},init:o,intersect:function(h,a){var e=T(h.x1,a.x1),i=T(h.y1,a.y1),l=y(h.x2,a.x2),q=
y(h.y2,a.y2);e=o(e,i,l,q);return e.width>0&&e.height>0?e:null},toString:function(h){return"["+h.x1+", "+h.y1+", "+h.x2+", "+h.y2+"]"},union:function(h,a){if(h.width===0||h.height===0)return c(a);else if(a.width===0||a.height===0)return c(h);else{var e=y(h.x1,a.x1),i=y(h.y1,a.y1),l=T(h.x2,a.x2),q=T(h.y2,a.y2);e=o(e,i,l,q);return e.width>0&&e.height>0?e:null}}}}(),Sa=function(){return{getAspectRatio:function(c){return c.height!==0?c.width/c.height:1},getCenter:function(c){return N.init(c.width>>1,c.height>>
1)},getSize:function(c){return la(P(c.width,2)+P(c.height,2))},init:function(c,o){c=c?c:0;return{width:c,height:o?o:c}}}}(),Ja=null,cb=[],U=null,ea=0,fa=[],La=["view.wake","tile.loaded"],Ca=function(){function c(){if(!H){var t=Z().maxImageLoads;H=COG.Loopage.join({execute:function(M,aa){if(!t||m.length<t){var V=v.shift();if(V){m[m.length]=V;V.image.onload=h;V.image.src=V.url;V.requested=T5.ticks()}else aa.trigger("complete")}},frequency:10});H.bind("complete",function(){H=null})}}function o(){Q=true;
try{var t=s.length>>1;if(t>0){s.sort(function(aa,V){return aa.created-V.created});for(var M=t;M--;)delete i[s[M].url];s.splice(0,t)}}finally{Q=false}ba.trigger("cacheCleared")}function h(){var t=l[this.id],M;if(t&&t.image.complete&&t.image.width>0){t.loaded=true;t.hitCount=1;for(M=m.length;M--;)if(m[M].image.src==this.src){m.splice(M,1);break}if(t.background||t.postProcess||t.drawBackground||t.customDraw)if(t.image){globalImageData=t;M=e(t.realSize?t.realSize.width:t.image.width,t.realSize?t.realSize.height:
t.image.height);var aa=M.getContext("2d"),V=t.offset?t.offset:T5.XY.init();t.background&&aa.drawImage(t.background,0,0);t.drawBackground&&t.drawBackground(aa);t.customDraw?t.customDraw(aa,t):aa.drawImage(t.image,V.x,V.y);t.postProcess&&t.postProcess(aa,t);t.image=M}for(M=t.callbacks.length;M--;)t.callbacks[M]&&t.callbacks[M](this,false);t.callbacks=[];s[s.length]={url:this.src,created:t.requested};delete l[this.id];c()}}function a(t,M,aa){var V=i[t];if(V){V.hitCount++;V.image.complete&&V.image.width>
0&&M?M(V.image,true):V.callbacks.push(M)}else{V=COG.extend({url:t,image:new Image,loaded:false,created:T5.ticks(),requested:null,hitCount:0,callbacks:[M]},aa);V.image.id="resourceLoaderImage"+q++;i[t]=V;l[V.image.id]=V;v[v.length]=V;c()}return V}function e(t,M){var aa=document.createElement("canvas");COG.info("creating new canvas");aa.width=t?t:0;aa.height=M?M:0;if(typeof FlashCanvas!="undefined"){document.body.appendChild(aa);FlashCanvas.initElement(aa)}return aa}var i={},l={},q=0,v=[],m=[],s=[],
z=0,H=null,Q=false,ba={avgImageSize:25,loadTimeout:10,cancelLoad:function(){m=[]},get:function(t,M,aa){var V=null,wa=null;Q||(V=i[t]);if((wa=V?V.image:null)&&(wa.getContext||wa.complete&&wa.width>0))return wa;else M&&a(t,M,aa);return null},load:a,newCanvas:e,reset:function(){i={}},stats:function(){return{imageLoadingCount:m.length,queuedImageCount:v.length,imageCacheFullness:z}}};COG.observable(ba);COG.Loopage.join({execute:function(t){for(var M=false,aa=0,V=Z();aa<m.length;)if(t-m[aa].requested>
ba.loadTimeout*1E3){m.splice(aa,1);M=true}else aa++;M&&c();if(V&&V.imageCacheMaxSize){z=s.length*ba.avgImageSize/V.imageCacheMaxSize;z>=1&&o()}},frequency:2E4});return ba}(),Ta=function(){var c={};return{init:function(o,h){var a=c[o];if(!a)throw Error("Unable to locate requested generator: "+o);return new a(h)},register:function(o,h){c[o]=h},Template:function(){}}}(),ab=function(){function c(l,q){e[l]=h(q);return l}function o(l){for(var q in l)c(q,l[q])}function h(l){function q(z){var H=l[z];typeof H!==
"undefined"&&m.push(function(Q){Q[z]=H})}function v(){m=[];for(var z in l)q(z)}l=COG.extend({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},l);var m=[],s={applyToContext:function(z){for(var H=m.length;H--;)m[H](z)},update:function(z,H){l[z]=H;v()}};v();return s}var a={},e={},i={apply:function(l,q){var v=e[q]?e[q]:e.basic,m;if(l&&l.canvas){m=a[l.canvas.id];a[l.canvas.id]=
q}v.applyToContext(l);return m},define:c,defineMany:o,get:function(l){return e[l]},init:h,load:function(l){COG.jsonp(l,function(q){o(q)})}};o({basic:{lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"},waypoints:{lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"}});return i}(),yb={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,ZOOM:16,FREEZE:128},tb=function(c){function o(E,D,X,ka){Za=gb;M();if(ka&&c.inertia)m(Da-D,Ea-X,c.panAnimationEasing,c.panAnimationDuration);else ka||m(Da-D,Ea-X);clearTimeout(ha);
ha=setTimeout(h,100)}function h(){Za=kb;F=false;M()}function a(E,D,X,ka){wa(T(Y+P(2,ka)-1,0.25))}function e(E){var D=sa(Y)/Math.LN2>>0;if(Y!==1)Za=rb;if(D!==0){Y=P(2,D);D=N.init(hb-(j/Y>>0),ib-(n/Y>>0));if(!Fa.trigger("scale",Y,D).cancel){for(E=W.length;E--;)W[E].trigger("scale",Y,D);Y=1;oa=null;Za=kb;E=true}}M(E)}function i(E){E||(E=N.init(j,n));b=N.init(Da,Ea);k=N.offset(E,Da,Ea);hb=k.x;ib=k.y}function l(E,D,X){Ua("doubleTap",D,X,N.offset(X,Da,Ea));if(c.scalable){COG.endTweens(function(ka){return ka.cancelOnInteract});
wa(2,X,c.zoomAnimation,null,c.zoomDuration)}}function q(){clearTimeout(ia);ia=setTimeout(s,250)}function v(E,D,X){Ua("tap",D,X,N.offset(X,Da,Ea))}function m(E,D,X,ka,na){function xa(){Va+=1;if(Va>=2){h();na&&na()}}var Va=0,Wa=ca?N.offset(ca,-j,-n):null,bb=qa?N.offset(qa,-j,-n):null;if(Wa){E=E<Wa.x?Wa.x:E;D=D<Wa.y?Wa.y:D}if(bb){E=E>bb.x?bb.x:E;D=D>bb.y?bb.y:D}if(X){if(!F){E=COG.tweenValue(Da,E,X,xa,ka);D=COG.tweenValue(Ea,D,X,xa,ka);E.cancelOnInteract=true;E.requestUpdates(function(eb){Da=eb>>0;F=
true;M()});D.cancelOnInteract=true;D.requestUpdates(function(eb){Ea=eb>>0;F=true;M()})}}else{Da=E|0;Ea=D|0}}function s(E,D){var X;if(ya){Ma&&Ma.unbind();if(c.autoSize&&ya.parentNode){E=ya.parentNode.offsetWidth;D=ya.parentNode.offsetHeight}try{if(!ya.id)ya.id=c.id+"_canvas";da=ya.getContext("2d")}catch(ka){COG.exception(ka);throw Error("Could not initialise canvas on specified view element");}if(E&&D&&(Ha!==D||Na!==E)){Ka=true;Na=E;Ha=D;j=Na>>1;n=Ha>>1;Fa.trigger("resize",Na,Ha);for(X=za;X--;)W[X].trigger("resize",
Na,Ha)}if(c.interactive){Ma=INTERACT.watch(ya).pannable();H()}for(X=za;X--;)W[X].trigger("contextChanged",da);M(true)}}function z(E,D){D.setId(E);D.added=ja();D.bind("remove",function(){Fa.removeLayer(E)});D.trigger("contextChanged",da);D.setParent(Fa);W.push(D);W.sort(function(X,ka){var na=ka.zindex-X.zindex;if(na===0)na=ka.added-X.added;return na});za=W.length;return D}function H(){if(Ma){if(c.pannable){Ma.bind("pan",o);Ma.bind("inertiaCancel",function(){F=false;M()})}if(c.scalable){Ma.bind("zoom",
a);Ma.bind("doubleTap",l)}Ma.bind("tap",v)}}function Q(){V();p=true;K=0}function ba(E,D,X,ka){var na;ma.center(D);var xa=0;Xa=ma.copy(D);Xa.scaleFactor=Y;X&&da.clearRect(0,0,Na,Ha);da.save();try{da.globalCompositeOperation="source-over";if(Y!==1){var Va=Xa,Wa=1/Y;hb=k.x+(Da-b.x);ib=k.y+(Ea-b.y);Xa=Va?ma.fromCenter(hb>>0,ib>>0,Va.width*Wa>>0,Va.height*Wa>>0):void 0;da.scale(Y,Y)}da.translate(-Xa.x1,-Xa.y1);qa=ca=null;if(lb){da.beginPath();clipped=false;for(xa=za;xa--;)if(W[xa].clip){W[xa].clip(da,
Xa,E,Fa,X,ka);clipped=true}da.closePath();clipped&&da.clip()}for(xa=za;xa--;){na=W[xa];var bb=na.style,eb=bb?ab.apply(da,bb):null;if(na.minXY)ca=ca?N.min(ca,na.minXY):N.copy(na.minXY);if(na.maxXY)qa=qa?N.max(qa,na.maxXY):N.copy(na.maxXY);na.draw(da,Xa,E,Fa,X,ka);eb&&ab.apply(da,eb)}}finally{da.restore()}if(mb){da.globalCompositeOperation="source-over";da.strokeStyle="#f00";da.beginPath();da.moveTo(j,0);da.lineTo(j,Ha);da.moveTo(0,n);da.lineTo(Na,n);da.stroke()}Ua("drawComplete",D,ka);COG.trace("draw complete",
ka)}function t(E,D){var X=false,ka=O?O:F?gb:Za,na=!F&&(ka===rb||ka===gb),xa=$||ka===gb||COG.getTweens().length>0;if(Ka&&ya){typeof FlashCanvas!="undefined"&&FlashCanvas.initElement(ya);ya.width=Na;ya.height=Ha;ya.style.width=Na+"px";ya.style.height=Ha+"px";Ka=false}db=aa();if(na){COG.endTweens(function(Va){return Va.cancelOnInteract});p=false;if(K!==0){clearTimeout(K);K=0}}for(na=za;na--;){if(W[na].animated)Za|=sb;W[na].cycle(E,db,Za,xa);X=W[na].shouldDraw(Za,db,xa)||X}xa=xa||(Za&sb)!==0;if(X=X||
xa||Y!==1&&Y!==Oa){ba(ka,db,xa,E);Oa=Y;$=false}if(!X&&d===0&&!zb){if(!p&&K===0)K=setTimeout(Q,nb);D.trigger("complete")}E-Pa>jb&&V();d=0;COG.trace("Completed draw cycle",E)}function M(E){$=E?true:false;d+=1;if(!Ya){Ya=COG.Loopage.join({execute:t,frequency:Ab});Ya.bind("complete",function(){Ya=null})}}function aa(){return ma.init(Da,Ea,Da+Na,Ea+Ha)}function V(){Pa=(new Date).getTime();Ua("refresh",Fa);M()}function wa(E,D,X,ka,na){function xa(){Y=Math.pow(2,Math.round(Math.log(Y)/Math.LN2));ka&&ka();
e(true)}var Va=Y;i(D);if(X)COG.tweenValue(0,E-Va,X,xa,na).requestUpdates(function(Wa){Y=Va+Wa;e()});else{Y=E;e()}return Fa}function Ua(){for(var E=Fa.trigger.apply(null,arguments).cancel,D=W.length;D--;)E=W[D].trigger.apply(null,arguments).cancel||E;return!E}c=COG.extend({id:COG.objId("view"),container:"",fastDraw:false,inertia:true,idleDelay:100,minRefresh:1E3,pannable:true,clipping:false,scalable:true,interactive:true,panAnimationEasing:COG.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,
adjustScaleFactor:null,autoSize:true,tapExtent:10,mask:true,guides:false,fps:25,zoomAnimation:COG.easing("quad.out"),zoomDuration:300},c);var W=[],za=0,ya=document.getElementById(c.container),da=null,$a=typeof window.attachEvent!="undefined",nb=c.idleDelay,jb=c.minRefresh,Da=0,Ea=0,lb=c.clipping,db=null,Ya=null,Xa,mb=c.guides,g=1,d=0,j=0,n=0,b=null,k=null,p=false,F=false,K=0,ha=0,ca=null,qa=null,Pa=0,R=0,O=null,$=false,ia=0,oa=null,Y=1,Oa=0,Ka=false,Ma=null,Ha,Na,zb=typeof FlashCanvas!=="undefined",
Ab=~~(1E3/c.fps),hb,ib,kb=C("ACTIVE"),gb=C("PAN"),rb=C("ZOOM"),sb=C("ANIMATING"),Za=kb,Fa={id:c.id,deviceScaling:g,fastDraw:c.fastDraw||Z().requireFastDraw,getDimensions:function(){return Sa.init(Na,Ha)},getLayer:function(E){for(var D=0;D<za;D++)if(W[D].getId()==E)return W[D];return null},setLayer:function(E,D){for(var X=0;X<za;X++)if(W[X].getId()===E){W.splice(X,1);break}D&&z(E,D);M();return D},eachLayer:function(E){for(var D=za;D--;)E(W[D])},invalidate:M,resize:function(E,D){if(ya){c.autoSize=false;
if(Na!==E||Ha!==D)s(E,D)}},refresh:V,scale:wa,triggerAll:Ua,removeLayer:function(E){a:{for(var D=za;D--;)if(W[D].getId()==E){E=D;break a}E=-1}if(E>=0&&E<za){Fa.trigger("layerRemoved",W[E]);W.splice(E,1);M()}za=W.length},stateOverride:function(E){O=E},getOffset:function(){return N.init(Da,Ea)},getViewRect:aa,updateOffset:m,pan:function(E,D,X,ka,na){m(Da+E,Ea+D,X,ka,na)}};g=Z().getScaling();Fa.markers=z("markers",new ob);COG.observable(Fa);Fa.bind("invalidate",function(E,D){M(D)});Fa.bind("resync",
function(){qa=ca=null});COG.configurable(Fa,["inertia","container","rotation","tapExtent","scalable","pannable"],COG.paramTweaker(c,null,{container:function(E,D){ya=document.getElementById(D);s()},rotation:function(E,D){R=D}}),true);s();if(c.autoSize)$a?window.attachEvent("onresize",q):window.addEventListener("resize",q,false);return Fa},fb=function(c){c=COG.extend({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:C("ACTIVE","ANIMATING","PAN","ZOOM"),style:null,minXY:null,maxXY:null},
c);var o=null,h=false,a=false,e=c.supportFastDraw,i=c.id,l=C("ACTIVE"),q=c.validStates,v=0,m=0,s=COG.extend({addToView:function(z){z.setLayer(i,s)},shouldDraw:function(z,H,Q){return(a||Q||v!==H.x1||m!==H.y1)&&(z&q)!==0&&(h?e:true)},clip:null,cycle:function(){},draw:function(){},remove:function(){s.trigger("remove",s)},changed:function(z){a=true;s.trigger("changed",s);o&&o.trigger("invalidate",z)},getId:function(){return i},setId:function(z){i=z},getParent:function(){return o},setParent:function(z){h=
(o=z)?o.fastDraw&&displayState!==l:false;s.trigger("parentChange",o)}},c);COG.observable(s);s.bind("drawComplete",function(z,H){a=false;v=H.x1;m=H.y1});s.bind("resync",function(z,H){if(H.syncXY){s.minXY&&H.syncXY(s.minXY);s.maxXY&&H.syncXY(s.maxXY)}});return s},pb=function(c){function o(v,m,s,z){a=v;e=m;i=s;l=z}c=COG.extend({xy:N.init(),offset:true,tweenIn:null,animationSpeed:null,isNew:true},c);var h=false,a=0,e=0,i=0,l=0,q=COG.extend(c,{isAnimating:function(){return h},draw:function(v,m,s,z,H){if(q.isNew&&
c.tweenIn){var Q=q.xy.y;q.xy.y=m.y1-20;h=true;COG.tween(q.xy,"y",Q,c.tweenIn,function(){q.xy.y=Q>>0;h=false},c.animationSpeed?c.animationSpeed:250+Math.random()*500)}q.drawMarker(v,m,q.xy.x,q.xy.y,s,z,H);q.isNew=false},drawMarker:function(v,m,s,z){v.beginPath();v.arc(s,z,4,0,Math.PI*2,false);v.fill();o(s-4,z-4,8,8)},hitTest:function(v,m){return v>=a&&v<=a+i&&m>=e&&m<=e+l},updateBounds:o});COG.observable(q);return q},ob=function(c){function o(){e.changed();e.trigger("markerUpdate",a)}function h(){var i=
e.getParent();if(i&&i.syncXY)for(var l=a.length;l--;)i.syncXY([a[l].xy])}c=COG.extend({zindex:100,style:"basic"},c);var a=[],e=COG.extend(new fb(c),{draw:function(i,l,q,v){for(var m=a.length;m--;)a[m].draw(i,l,q,e,v)},add:function(i){if(i&&typeof i.length!=="undefined")for(var l=i.length;l--;){if(i[l])a[a.length]=i[l]}else if(i)a[a.length]=i;o()},clear:function(i){if(i)for(var l=0;l<a.length;)if(i(a[l]))a.splice(l,1);else l+=1;else a=[];o()},each:function(i){if(i)for(var l=a.length;l--;)i(a[l])},
find:function(i){for(var l=[],q=a.length;q--;)if(!i||i(a[q]))l[l.length]=a[q];return l}});e.bind("tap",function(i,l,q,v){var m=[],s=v.x;v=v.y;for(var z=a.length;z--;)if(a[z].hitTest(s,v))m[m.length]=a[z];if(m.length>0)i.cancel=e.trigger("markerTap",l,q,m).cancel});e.bind("parentChange",h);e.bind("resync",h);e.bind("changed",h);return e},ub=function(c){function o(q,v,m){q.fillStyle="#FFFFFF";q.strokeStyle="#222222";q.beginPath();q.arc(m.x,m.y,4,0,Math.PI*2,false);q.stroke();q.fill()}c=COG.extend({path:[],
id:COG.objId("pathAni"),easing:COG.easing("sine.inout"),validStates:C("ACTIVE","PAN","ZOOM"),drawIndicator:null,duration:2E3},c);var h=N.edges(c.path),a,e=null,i=0;COG.tweenValue(0,h.total,c.easing,function(){l.remove()},c.duration).requestUpdates(function(q,v){i=q;v&&l.remove()});var l=COG.extend(new fb(c),{cycle:function(){for(var q=0;q<h.accrued.length&&h.accrued[q]<i;)q++;e=null;if(q<c.path.length-1){var v=i-(q>0?h.accrued[q-1]:0),m=c.path[q];a=N.theta(m,c.path[q+1],h.edges[q]);e=N.extendBy(m,
a,v)}return e},draw:function(q,v){if(e)(c.drawIndicator?c.drawIndicator:o)(q,v,N.init(e.x,e.y),a)}});return l},vb=function(c){c=COG.extend({style:null,properties:{}},c);return COG.extend(c,{rect:null,draw:function(){},resync:function(){}})},qb=function(c,o){o=COG.extend({fill:false,simplify:false},o);var h=false,a=o.fill,e=o.simplify,i=C("ZOOM"),l=[],q=COG.extend(new vb(o),{draw:function(v,m,s,z,H,Q){if(h){m=true;s=(Q&i)!==0;v.beginPath();for(Q=l.length;Q--;){s=l[Q].x;z=l[Q].y;if(m){v.moveTo(s,z);
m=false}else v.lineTo(s,z);s=true}if(s){a&&v.fill();v.stroke()}}},resync:function(v){q.xy=v.syncXY(c);l=N.floor(e?N.simplify(c):c)}});h=c&&c.length>=2;return q},wb=function(c){function o(i){for(var l=a.length;l--;)a[l].resync(i);a.sort(function(q,v){var m=v.xy.y-q.xy.y;if(m===0)m=v.xy.x-q.xy.y;return m});e.changed()}function h(i,l){l.syncXY&&o(l)}c=COG.extend({zindex:80},c);var a=[],e=COG.extend(new fb(c),{add:function(i){a[a.length]=i},each:function(i){for(var l=a.length;l--;)i(a[l])},draw:function(i,
l,q){var v=l.x1,m=l.y1,s=l.width;l=l.height;for(var z=a.length;z--;){var H=a[z].style;H=H?ab.apply(i,H):null;a[z].draw(i,v,m,s,l,q);H&&ab.apply(i,H)}}});e.bind("parentChange",h);e.bind("resync",h);return e},Bb=function(){return{tileSize:256,init:function(c,o,h,a,e){return COG.extend({x:c,y:o,width:h,height:a},e)}}}(),xb=function(c){function o(Q,ba,t,M){function aa(){if(H.initTileCreator){l=true;H.initTileCreator(Q,ba,t,M)}}H.prepTileCreator?H.prepTileCreator(Q,ba,t,aa):aa()}function h(Q,ba){for(var t=
~~((Q.x1-e.x)/q),M=~~((Q.y1-e.y)/v),aa=[],V=-i;V<s;V++)for(var wa=-i;wa<z;wa++){var Ua=m(t+V,M+wa);if(Ua)aa[aa.length]=Ua}ba&&ba(aa);a=ma.copy(Q)}c=COG.extend({tileWidth:256,tileHeight:256,relative:false,padding:2},c);var a=null,e=N.init(),i=c.padding,l=false,q=c.tileWidth,v=c.tileHeight,m=null,s=0,z=0,H={getTileCreatorArgs:null,initTileCreator:null,prepTileCreator:null,requireRefresh:function(){return false},reset:function(){m=null;l=false;a=null},run:function(Q,ba,t){var M=!a||Math.abs(Q.x1-a.x1)>
q||Math.abs(Q.y1-a.y1)>v,aa=M?H.requireRefresh(Q,ba):false;if(M){if(!m&&!l||aa){e=c.relative?N.init(Q.x1,Q.y1):N.init();s=Math.ceil(Q.width/q)+i;z=Math.ceil(Q.height/v)+i;o(q,v,H.getTileCreatorArgs?H.getTileCreatorArgs(ba):{},function(V){m=V;l=false;h(Q,t)})}m&&h(Q,t)}}};COG.observable(H);H.bind("update",function(){COG.info("captured generator update");a=null});return H},Qa={ex:COG.extend,ticks:ja,getConfig:Z,userMessage:function(c,o,h){Qa.trigger("userMessage",c,o,h)},zoomable:B,XY:N,XYRect:ma,Dimensions:Sa,
Vector:w,D:Sa,Images:Ca,Generator:Ta,tween:COG.tween,tweenValue:COG.tweenValue,easing:COG.easing,Tween:COG.Tween,Style:ab,viewState:C,View:tb,ViewLayer:fb,ImageLayer:function(c,o){function h(m,s,z){for(s=i.length;s--;){var H=i[s],Q=H.x,ba=H.y,t=ma.init(H.x,H.y,H.x+H.width,H.y+H.height);if(z&&ma.intersect(m,t)){t=Ca.get(H.url,function(){v.changed()},q);z(t,Q,ba,H.width,H.height)}}}function a(m){e&&e.run(m,v.getParent(),function(s){i=[].concat(s);v.changed()})}o=COG.extend({imageLoadArgs:{}},o);var e=
c?Ta.init(c,o):null,i=[],l=ma.init(),q=o.imageLoadArgs,v=COG.extend(new fb(o),{changeGenerator:function(m,s){e=Ta.init(m,COG.extend({},o,s));i=null;a(l)},clip:function(m,s,z){h(s,z,function(H,Q,ba,t,M){H&&m.rect(Q,ba,t,M)})},cycle:function(m,s){a(s)},draw:function(m,s,z){h(s,z,function(H,Q,ba,t,M){v.drawImage(m,H,Q,ba,t,M,s,z)});l=ma.copy(s)},drawImage:function(m,s,z,H){s&&m.drawImage(s,z,H,s.width,s.height)}});v.bind("refresh",function(){a(l)});v.bind("tap",function(m,s,z,H){m=[];var Q=H.x,ba=H.y,
t,M;if(i)for(var aa=i.length;aa--;){t=i[aa];if(M=Q>=t.x&&Q<=t.x+t.width&&ba>=t.y&&ba<=t.y+t.height)m[m.length]=t}m.length>0&&v.trigger("tapImage",m,s,z,H)});return v},Marker:pb,ImageMarker:function(c){c=COG.extend({image:null,imageUrl:null,animatingImage:null,animatingImageUrl:null,imageAnchor:null,rotation:0,scale:1,opacity:1},c);var o=c.imageAnchor?T5.XY.invert(c.imageAnchor):null,h=COG.extend(new pb(c),{drawMarker:function(a,e,i,l){if((e=h.isAnimating()&&h.animatingImage?h.animatingImage:h.image)&&
e.width>0){o||(o=N.init(-e.width>>1,-e.height>>1));var q=h.scale,v=i+~~(o.x*q),m=l+~~(o.y*q),s=~~(e.width*q),z=~~(e.height*q);h.updateBounds(v,m,s,s);if(h.rotation||h.opacity!==1){a.save();try{a.globalAlpha=h.opacity;a.translate(i,l);a.rotate(h.rotation);a.drawImage(e,o.x*q,o.y*q,s,z)}finally{a.restore()}}else a.drawImage(e,v,m,s,z)}}});if(!h.image)h.image=Ca.get(c.imageUrl,function(a){h.image=a});if(!h.animatingImage)h.animatingImage=Ca.get(c.animatingImageUrl,function(a){h.animatingImage=a});return h},
MarkerLayer:ob,PathLayer:function(c){c=COG.extend({style:"waypoints",pixelGeneralization:8,zindex:50},c);var o=false,h=[],a=null,e=[],i=null,l=0,q=[],v=COG.extend(new fb(c),{getAnimation:function(m,s,z,H){var Q="pathAnimation"+l++;q.push(Q);return new ub({id:Q,path:h,zindex:c.zindex+1,easing:m?m:COG.easing("sine.inout"),duration:s?s:5E3,drawIndicator:z,autoCenter:H?H:false})},cycle:function(m,s,z,H){return H},draw:function(m){var s,z=h.length;m.save();try{ab.apply(m,c.style);if(z>0){m.beginPath();
m.moveTo(h[z-1].x,h[z-1].y);for(s=z;s--;)m.lineTo(h[s].x,h[s].y);m.stroke();if(a){m.fillStyle=c.waypointFillStyle;for(s=a.length;s--;){m.beginPath();m.arc(a[s].x,a[s].y,2,0,Math.PI*2,false);m.stroke();m.fill()}}}}finally{m.restore()}o=false},updateCoordinates:function(m,s){e=m;i=s;var z=v.getParent();if(z&&z.syncXY){z.syncXY(e);i&&z.syncXY(i);v.trigger("tidy")}}});v.bind("tidy",function(){h=N.simplify(e,c.pixelGeneralization);a=N.simplify(i,c.pixelGeneralization);o=true;v.changed()});return v},AnimatedPathLayer:ub,
Shape:vb,Arc:function(c,o){o=COG.extend({size:4},o);var h=N.init(),a=COG.extend(o,{draw:function(e){e.beginPath();e.arc(h.x,h.y,a.size,0,Math.PI*2,false);e.fill();e.stroke()},resync:function(e){e.syncXY([c]);h=N.floor([c])[0]}});COG.info("created arc = ",c);return a},Poly:qb,ShapeLayer:wb,Tiling:Bb,TileGenerator:xb};COG.observable(Qa);var Ra=Qa.Geo=function(){function c(g){g=parseFloat(g)*ba;g=ta(g);var d=M*g;return sa((1+g)/(1-g)*P((1-d)/(1+d),M))/2}function o(g){return parseFloat(g)*ba}function h(g){g=
P(Math.E,-g);for(var d=f-2*va(g),j=i(d,g),n=0;n<V&&r(d-j)>aa;){d=j;j=i(d,g);n++}return j*t}function a(g){return g%360*t}function e(g,d){var j=null;for(var n in $a)if(d){if(n==d&&$a[n][g]){j=$a[n];break}}else if($a[n][g]){j=$a[n];break}return j}function i(g,d){var j=M*ta(g);return f-2*va(d*P((1-j)/(1+j),M/2))}function l(g,d,j,n){d=v(d);g.add(n.line(d,j));return d.length}function q(g,d,j,n){d=v(d);g.add(n.poly(d,j));return d.length}function v(g){var d=g?g.length:0,j=Array(d);for(d=d;d--;)j[d]=Ra.Position.init(g[d][1],
g[d][0]);return Ra.Position.vectorize(j,db)}function m(g,d,j){return new mb(g,d,j)}var s=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],z=-f,H=f,Q=-I,ba=Math.PI/180,t=180/Math.PI,M=0.08181919084262157,aa=1.0E-7,V=12,wa=null,Ua={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",HWY:"HIGHWAY",MWY:"MOTORWAY"},W=function(){function g(b){return b?j(b.lat,b.lon):null}function d(b){return!b||b.lat===0&&b.lon===0}function j(b,k){return{lat:parseFloat(b?
b:0),lon:parseFloat(k?k:0)}}function n(b){if(b)if(typeof b.lat!=="undefined")return g(b);else{if(b.split)for(var k=[" ",","],p=0;p<k.length;p++){var F=b.split(k[p]);if(F.length===2)return j(F[0],F[1])}}else return j();return null}return{calcDistance:function(b,k){if(d(b)||d(k))return 0;var p=(k.lat-b.lat)*ba>>1,F=(k.lon-b.lon)*ba>>1;p=ta(p)*ta(p)+Aa(b.lat*ba)*Aa(k.lat*ba)*ta(F)*ta(F);return 6371*2*Ba(la(p),la(1-p))},copy:g,empty:d,equal:function(b,k){return b&&k&&b.lat==k.lat&&b.lon==k.lon},fromMercatorPixels:function(b,
k){return j(h(k),a(b))},generalize:function(b,k,p){var F=b.length,K=[],ha=null;p||(p=250);p/=1E3;COG.info("generalizing positions, must include "+k.length+" positions");for(var ca=F;ca--;)if(ca===0)K.unshift(b[ca]);else{var qa=!ha||W.inArray(b[ca],k)?p:W.calcDistance(ha,b[ca]);if(b[ca]&&qa>=p){K.unshift(b[ca]);ha=b[ca]}}COG.info("generalized "+F+" positions into "+K.length+" positions");return K},inArray:function(b,k){for(var p=W.equal,F=k.length;F--;)if(p(b,k[F]))return true;return false},inBounds:function(b,
k){var p=!(W.empty(b)||W.empty(k));return p=(p=p&&b.lat>=k.min.lat&&b.lat<=k.max.lat)&&b.lon>=k.min.lon&&b.lon<=k.max.lon},init:j,offset:function(b,k,p){var F=b.lat*ba;b=b.lon*ba;k=F+k/6371;p=Ia(ta(p/6371)/Aa(F));p=b+p;k=(k+f)%Math.PI-f;p%=I;return j(k*t,p*t)},parse:n,parseArray:function(b){var k=b.length,p=Array(k);for(k=k;k--;)p[k]=n(b[k]);return p},toMercatorPixels:function(b){return T5.XY.init(o(b.lon),c(b.lat))},toString:function(b){return b?b.lat+" "+b.lon:""},vectorize:function(b,k){var p=
b.length,F=Array(p);k=COG.extend({chunkSize:500,async:true},k);if(!k.async){for(var K=p;K--;)F[K]=T5.GeoXY.init(b[K]);return F}return COG.Loopage.join({frequency:10,execute:function(ha,ca){for(var qa=0,Pa=k.chunkSize,R=p;R--;){F[R]=T5.GeoXY.init(b[R]);qa+=1;if(qa>Pa)break}p=R;p<=0&&ca.trigger("complete",F)}})}}}(),za=function(){function g(b,k,p){var F=T5.XY.init(0,k.lat-b.lat);if(typeof p==="undefined")p=true;F.x=p&&b.lon>k.lon?360-b.lon+k.lon:k.lon-b.lon;return F}function d(b,k){return za.init(W.init(b.min.lat-
k,b.min.lon-k%360),W.init(b.max.lat+k,b.max.lon+k%360))}function j(b){var k=g(b.min,b.max);return W.init(b.min.lat+(k.y>>1),b.min.lon+(k.x>>1))}function n(b,k){return{min:W.parse(b),max:W.parse(k)}}return{calcSize:g,createBoundsFromCenter:function(b,k){var p=k/6371,F=b.lat*ba,K=b.lon*ba,ha=F-p,ca=F+p;if(ha>z&&ca<H){F=Ia(ta(p)/Aa(F));p=(K-F)%I;K=(K+F)%I}else{ha=T(ha,z);ca=y(ca,H);p=Q;K=I}return za.init(W.init(ha*t,p*t),W.init(ca*t,K*t))},expand:d,forPositions:function(b,k){var p=null,F=T5.ticks();
k||(k="auto");for(var K=b.length;K--;)if(p){var ha=g(p.min,b[K],false),ca=g(b[K],p.max,false);if(ha.x<0)p.min.lon=b[K].lon;if(ha.y<0)p.min.lat=b[K].lat;if(ca.x<0)p.max.lon=b[K].lon;if(ca.y<0)p.max.lat=b[K].lat}else p=n(b[K],b[K]);if(k){if(k=="auto"){K=g(p.min,p.max);k=T(K.x,K.y)*0.3}p=d(p,k)}COG.trace("calculated bounds for "+b.length+" positions",F);return p},getCenter:j,getGeoHash:function(b){var k=T5.Geo.GeoHash.encode(b.min.lat,b.min.lon);b=T5.Geo.GeoHash.encode(b.max.lat,b.max.lon);COG.info("min hash = "+
k+", max hash = "+b)},getZoomLevel:function(b,k){var p=j(b);p=y(Ga(r(p.lat)*0.05),s.length);var F=s[p],K=g(b.min,b.max);p=u(sa(s[3]*k.height/K.y)/sa(2));F=u(sa(F*k.width/K.x)/sa(2));return y(isNaN(p)?1E3:p,isNaN(F)?1E3:F)},init:n,isEmpty:function(b){return!b||W.empty(b.min)||W.empty(b.max)},toString:function(b){return"min: "+W.toString(b.min)+", max: "+W.toString(b.max)}}}(),ya=function(){var g=/^(\d+).*$/,d=/(\d+)\s?\-\s?(\d+)/;return{buildingMatch:function(j,n){g.lastIndex=-1;if(g.test(j))for(var b=
j.replace(g,"$1"),k=n.split(","),p=0;p<k.length;p++){d.lastIndex=-1;if(d.test(k[p])){var F=d.exec(k[p]);if(b>=parseInt(F[1],10)&&b<=parseInt(F[2],10))return true}else if(b==k[p])return true}return false},normalize:function(j){if(!j)return"";j=j.toUpperCase();if(!wa){var n=[];for(var b in Ua)n.push(b);wa=RegExp("(\\s)("+n.join("|")+")(\\s|$)","i")}wa.lastIndex=-1;if(n=wa.exec(j))j=j.replace(wa,"$1"+Ua[n[2]]);return j},toString:function(j){return j.streetDetails+" "+j.location}}}(),da=Qa.GeoXY=function(){function g(j,
n){if(j.length){for(var b,k,p,F,K=j.length;K--;){g(j[K],n);b=typeof b==="undefined"||j.x<b?j.x:b;k=typeof k==="undefined"||j.y<k?j.y:k;p=typeof p==="undefined"||j.x>p?j.x:p;F=typeof F==="undefined"||j.y>F?j.y:F}return ma.init(b,k,F,F)}else if(j.mercXY){b=j.mercXY;j.x=~~(b.x/n);j.y=~~((Math.PI-b.y)/n);j.rpp=n}else COG.warn("Attempted to sync an XY composite, not a GeoXY");return j}function d(j,n,b){j.pos=n;j.mercXY=W.toMercatorPixels(n);(b=typeof b!=="undefined"?b:j.rpp)&&g(j,b)}return{init:function(j,
n){var b=N.init();d(b,j,n);return b},sync:g,toPos:function(j,n){n=n?n:self.rpp;return W.fromMercatorPixels(j.x*n,Math.PI-j.y*n)},updatePos:d}}();Qa.GeoVector=function(g){COG.warn("The T5.Geo.GeoVector class has been deprecated, please use T5.GeoXY.init instead");return da.init(g)};var $a={},nb=function(){return{bestResults:function(g,d){d||(d=20);for(var j=g.length>0?g[0]:null,n=[],b=0;b<g.length;b++)if(j&&g[b]&&j.matchWeight-g[b].matchWeight<=d)n.push(g[b]);else break;return n}}}(),jb=function(g){g=
COG.extend({id:null,caption:"",resultType:"",data:null,pos:null,matchWeight:0},g);return COG.extend(g,{toString:function(){return g.caption+(g.matchWeight?" ("+g.matchWeight+")":"")}})},Da=function(){var g={calculate:function(d){d=COG.extend({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},d);var j=T5.Geo.getEngine("route");j&&j.route(d,function(n){if(d.generalize)n.geometry=T5.Geo.Position.generalize(n.geometry,n.getInstructionPositions());if(d.map){g.createMapOverlay(d.map,
n);d.autoFit&&d.map.gotoBounds(n.boundingBox)}d.success&&d.success(n)})},createMapOverlay:function(d,j){var n=d.getDimensions();n=new T5.Geo.UI.RouteOverlay({data:j,width:n.width,height:n.height});d.setLayer("route",n)},parseTurnType:function(d){for(var j=g.TurnType.Unknown,n=T5.Geo.Routing.TurnTypeRules,b=0;b<n.length;b++){n[b].regex.lastIndex=-1;var k=n[b].regex.exec(d);if(k){j=n[b].customCheck?n[b].customCheck(d,k):n[b].turnType;break}}return j},TurnType:{Unknown:"turn-unknown",Start:"turn-none-start",
Continue:"turn-none",Arrive:"turn-none-arrive",TurnLeft:"turn-left",TurnLeftSlight:"turn-left-slight",TurnLeftSharp:"turn-left-sharp",TurnRight:"turn-right",TurnRightSlight:"turn-right-slight",TurnRightSharp:"turn-right-sharp",Merge:"merge",UTurnLeft:"uturn-left",UTurnRight:"uturn-right",EnterRoundabout:"roundabout-enter",Ramp:"ramp",RampExit:"ramp-exit"},Instruction:function(d){var j=d=COG.extend({position:null,description:"",distance:0,distanceTotal:0,time:0,timeTotal:0,turnType:null},d),n=d.description;
n=n.replace(/(\w)(\/)(\w)/g,"$1 $2 $3");j.description=n;if(!d.turnType)d.turnType=g.parseTurnType(d.description);return d},RouteData:function(d){d=COG.extend({geometry:[],instructions:[],boundingBox:null},d);if(!d.boundingBox)d.boundingBox=T5.Geo.BoundingBox.forPositions(d.geometry);return COG.extend({getInstructionPositions:function(){for(var j=[],n=0;n<d.instructions.length;n++)d.instructions[n].position&&j.push(d.instructions[n].position);return j}},d)}};return g}(),Ea="featurecollection",lb="feature",
db={async:false},Ya={processor:null,group:"shapes",layerClass:wb},Xa={point:COG.extend({},Ya,{processor:function(g,d,j,n){d=v([d.coordinates],db);if(d.length>0)if(j=n.marker(d[0],j)){g.add(j);return d.length}},group:"markers",layerClass:ob}),linestring:COG.extend({},Ya,{processor:function(g,d,j,n){d=v(d&&d.coordinates?d.coordinates:[]);return l(g,d,j,n)}}),multilinestring:COG.extend({},Ya,{processor:function(g,d,j,n){d=d&&d.coordinates?d.coordinates:[];for(var b=0,k=d.length;k--;)b+=l(g,d[k],j,n);
return b}}),polygon:COG.extend({},Ya,{processor:function(g,d,j,n){d=d&&d.coordinates?d.coordinates:[];if(d.length>0)return q(g,d[0],j,n);return 0}}),multipolygon:COG.extend({},Ya,{processor:function(g,d,j,n){d=d&&d.coordinates?d.coordinates:[];for(var b=0,k=0;k<d.length;k++)b+=q(g,d[k][0],j,n);return b}})},mb=function(g,d,j,n){function b($,ia){var oa=$.processor,Y=K+$.group,Oa=COG.extend({},$,j,{properties:ia.properties});if(oa){var Ka=R[Y];if(!Ka){Ka=new $.layerClass({id:Y});R[Y]=Ka}globalLayers=
R;return oa(Ka,ia.data,Oa,n)}return 0}function k($,ia){var oa=$&&$.type?$.type.toLowerCase():null;return oa&&oa===lb?k($.geometry,$.properties):{type:oa,isCollection:oa?oa===Ea:false,definition:Xa[oa],data:$,properties:ia?ia:$.properties}}j=COG.extend({vectorsPerCycle:Ra.VECTORIZE_PER_CYCLE,rowPreParse:null,simplify:false,layerPrefix:"geojson-"},j);n=COG.extend({marker:function($){return new pb({xy:$})},line:function($,ia){return new qb($,ia)},poly:function($,ia){return new qb($,COG.extend({fill:true},
ia))}},n);var p=j.vectorsPerCycle,F=j.rowPreParse,K=j.layerPrefix,ha=0,ca=0,qa=null,Pa=0,R={},O;if(!g)return null;if(typeof g.length==="undefined")g=[g];ca=g.length;O=COG.Loopage.join({frequency:10,execute:function($,ia){var oa=0,Y=ha;if(!qa){for(;Y<ca;Y++){var Oa=k(F?F(g[Y]):g[Y]),Ka=null;if(Oa.isCollection){Pa+=1;qa=m(Oa.data.features,function(Ma){qa=null;for(var Ha in Ma)R[Ha]=Ma[Ha]},{layerPrefix:K+Pa+"-"});Ka+=1}else if(Oa.definition)Ka=b(Oa.definition,Oa);oa+=Ka?Ka:1;if(oa>=p)break}ha=Y+1;!qa&&
ha>=ca&&ia.trigger("complete")}}});O.bind("complete",function(){d&&d(R)});return O};Qa.GeoJSON={parse:m};Qa.Map=function(g){function d(O){try{var $=Ra.Position.init(O.coords.latitude,O.coords.longitude),ia=O.coords.accuracy/1E3;R.trigger("locationUpdate",O,ia);if(ca){if(!K){K=new Ra.UI.LocationOverlay({pos:$,accuracy:ia});K.update(R.getTileLayer());R.setLayer("location",K)}var oa=Ra.BoundingBox.createBoundsFromCenter($,Math.max(ia,1));R.gotoBounds(oa)}else{K.pos=$;K.accuracy=ia;K.update(R.getTileLayer());
b($,null,COG.easing("sine.out"))}ca=false}catch(Y){COG.exception(Y)}}function j(O){COG.info("caught location tracking error:",O)}function n(O,$,ia){R.setZoomLevel($);Ca.cancelLoad();COG.endTweens();b(O,ia)}function b(O,$,ia,oa){O=da.init(O,Ra.radsPerPixel(R.getZoomLevel()));var Y=R.getDimensions();R.updateOffset(O.x-(Y.width>>1),O.y-(Y.height>>1),ia,oa,$);R.trigger("wake");R.trigger("boundsChange",R.getBoundingBox());$&&typeof ia==="undefined"&&$(R)}g=COG.extend({tapExtent:10,crosshair:false,zoomLevel:0,
boundsChangeThreshold:30},g);var k={NONE:0,SINGLE:1,WATCH:2},p=N.init(),F=k.NONE,K=null,ha=0,ca=true,qa=0,Pa=g.tapExtent;g.adjustScaleFactor=function(O){return Math.pow(2,(O<1?Math.floor:Math.ceil)(Math.log(O)))};var R=COG.extend(new tb(g),{getBoundingBox:function(){var O=R.getViewRect();return Ra.BoundingBox.init(da.toPos(N.init(O.x1,O.y2),qa),da.toPos(N.init(O.x2,O.y1),qa))},getCenterPosition:function(){var O=R.getViewRect();if(O){O=N.init(O.x1+(O.width>>1),O.y1+(O.height>>1));return da.toPos(O,
qa)}return null},gotoBounds:function(O,$){var ia=Ra.BoundingBox.getZoomLevel(O,R.getDimensions());n(Ra.BoundingBox.getCenter(O),ia,$)},gotoPosition:n,panToPosition:b,syncXY:function(O){return da.sync(O,qa)},locate:function(){R.trackStart(k.SINGLE);setTimeout(R.trackCancel,1E4)},trackStart:function(O){if(navigator.geolocation&&!ha){F=O?O:k.WATCH;ca=true;ha=navigator.geolocation.watchPosition(d,j,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3})}},trackCancel:function(){ha&&navigator.geolocation&&
navigator.geolocation.clearWatch(ha);R.removeLayer("location");K=null;F=k.NONE;ha=0},animateRoute:function(O,$,ia,oa){var Y=R.getLayer("route");if(Y)(O=Y.getAnimation(O,$,ia,oa))&&O.addToView(R)}});R.bind("pan",function(){F===k.SINGLE&&R.trackCancel()});R.bind("tap",function(O,$,ia,oa){var Y=Ra.radsPerPixel(R.getZoomLevel());O=da.toPos(oa,Y);var Oa=da.toPos(N.offset(oa,-Pa,Pa),Y);oa=da.toPos(N.offset(oa,Pa,-Pa),Y);R.trigger("geotap",$,ia,O,za.init(Oa,oa))});R.bind("refresh",function(){if(N.absSize(N.diff(p,
R.getOffset()))>g.boundsChangeThreshold){p=N.copy(R.getOffset());R.trigger("boundsChange",R.getBoundingBox())}});B(R,g);R.bind("zoomLevelChange",function(O,$){qa=Ra.radsPerPixel($);R.triggerAll("resync",R)});return R};Qa.MapTileGenerator=function(g){g=COG.extend({relative:true},g);var d=0,j=null;return COG.extend(new xb(g),{minLevel:2,maxLevel:20,getTileCreatorArgs:function(n){j=n.getCenterPosition();d=n.getZoomLevel();return{zoomLevel:d,position:j}},requireRefresh:function(n,b){return!j||d!==b.getZoomLevel()}})};
Qa.GeoPoly=function(g,d){d=COG.extend({autoParse:true},d);for(var j=Array(g.length),n=d.autoParse,b=T5.Geo.Position.parse,k=g.length;k--;)j[k]=T5.GeoXY.init(n?b(g[k]):g[k]);return new T5.Poly(j,d)};Qa.RouteOverlay=function(g){g=COG.extend({data:null,pixelGeneralization:8,partialDraw:false,strokeStyle:"rgba(0, 51, 119, 0.9)",waypointFillStyle:"#FFFFFF",lineWidth:4,zindex:50},g);var d=[],j=[],n=new T5.PathLayer(g);(function(){if(g.data&&g.data.instructions){for(var b=g.data.instructions,k=Array(b.length),
p=b.length;p--;)k[p]=b[p].position;T5.Geo.Position.vectorize(k).bind("complete",function(F,K){j=K})}g.data&&g.data.geometry&&T5.Geo.Position.vectorize(g.data.geometry).bind("complete",function(F,K){d=K;n.updateCoordinates(d,j,true)})})();return n};Qa.LocationOverlay=function(g){g=COG.extend({pos:null,accuracy:null,zindex:90},g);var d=new Image,j=T5.XY.init(),n=T5.XY.init(),b=null;d.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAACIQAAAiEBPhEQkwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAG+SURBVCiRlZHNahNRAIW/O7mTTJPahLZBA1YUyriINRAE3bQIKm40m8K8gLj0CRQkO32ELHUlKbgoIu4EqeJPgtCaoBuNtjXt5LeTMZk0mbmuWiuuPLsD3+HAOUIpxf9IHjWmaUbEyWv5ROrsVULhcHP761rUfnN3Y2Otc8CIg4YT85lzuVsPP+Qupw1vpPjRCvhS9ymvV0e77x7nNj+uvADQAIQQ+uLyvdfLV9JGZi7EdEwQlqBpEJ019f0z1mo2u5Q8DMydv25lshemmj1FueZTawbs7inarqLbV7Qjab1upB9YlhWSAHLavLHZCvg1VEhN0PMU9W7At4bPVidg7CtkLLXkut+lBPD6/Ub155jJiADAHSpaLmx3ApyBQoYEUd0PBoOBkAC6+3llvda/YxgGgYL+UNHf/zN3KiExGlsvTdP0NYDkhPdWrz35ZDsBzV5wCMuQwEyFmXFeeadjzfuFQmGkAZRKpdGC/n7x+M6jqvA9Zo6FWDhlcHE+wqT93J1tP7vpOE7rrx8ALMuasPf8S12St4WmJ6bYWTUC52k8Hm8Vi0X/nwBAPp/XKpWKdF1X2LYdlMvlsToC/QYTls7DLFr/PAAAAABJRU5ErkJggg%3D%3D";
d.onload=function(){j=T5.XY.init(d.width>>1,d.height>>1)};var k=COG.extend(new T5.ViewLayer(g),{pos:g.pos,accuracy:g.accuracy,drawAccuracyIndicator:false,draw:function(p,F){var K=n.x-F.x,ha=n.y-F.y;if(b){p.fillStyle="rgba(30, 30, 30, 0.2)";p.beginPath();p.arc(K,ha,b,0,Math.PI*2,false);p.fill()}d.complete&&d.width>0&&p.drawImage(d,K-j.x,ha-j.y,d.width,d.height);k.changed()},update:function(p){if(p){b=p.getPixelDistance(k.accuracy)>>1;n=p.getGridXYForPosition(k.pos);k.changed()}}});k.bind("gridUpdate",
function(p,F){k.update(F)});return k};return{distanceToString:function(g){if(g>1E3)return~~(g/10)/100+" km";return g?g+" m":""},dist2rad:function(g){return g/6371},getEngine:function(g){for(var d=null,j=1;!d&&j<arguments.length;j++)d=e(g,arguments[j]);d=d?d:e(g);if(!d)throw Error("Unable to find GEO engine with "+g+" capability");return d},lat2pix:c,lon2pix:o,pix2lat:h,pix2lon:a,radsPerPixel:function(g){return I/(256<<g)},Position:W,BoundingBox:za,Radius:function(g,d){return{distance:parseInt(g,10),
uom:d}},Address:function(g){return g=COG.extend({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},g)},A:ya,GeocodeFieldWeights:{streetDetails:50,location:50},AddressCompareFns:{},Engine:function(g){if(!g.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var d=COG.extend({remove:function(){delete $a[d.id]}},g);return $a[d.id]=d},Search:nb,GeoSearchResult:jb,LocationSearch:function(g){function d(p,F){navigator.geolocation.clearWatch(n);n=0;
if(b){clearTimeout(b);b=0}F&&F([p],g)}function j(p){COG.info("caught location tracking error:",p)}g=COG.extend({name:"Geolocation Search",requiredAccuracy:null,searchTimeout:5E3,watch:false},g);var n=0,b=0,k=null;return new T5.Geo.GeoSearchAgent(COG.extend({execute:function(p,F){if(navigator.geolocation&&!n){n=navigator.geolocation.watchPosition(function(K){var ha=W.init(K.coords.latitude,K.coords.longitude);K=new jb({id:1,caption:"Current Location",pos:ha,accuracy:K.coords.accuracy/1E3,matchWeight:100});
if(!k||K.accuracy<k.accuracy)k=K;if(!g.requiredAccuracy||k.accuracy<g.requiredAccuracy)d(k,F)},j,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3});if(g.searchTimeout)b=setTimeout(function(){k&&d(k,F)},g.searchTimeout)}}},g))},Routing:Da}}();return Qa}();
