if(!this.JSON)this.JSON={};
(function(){function ga(U){return U<10?"0"+U:U}function xa(U){ya.lastIndex=0;return ya.test(U)?'"'+U.replace(ya,function(n){var x=Ca[n];return typeof x==="string"?x:"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+U+'"'}function na(U,n){var x,E,G,J,K=N,A,C=n[U];if(C&&typeof C==="object"&&typeof C.toJSON==="function")C=C.toJSON(U);if(typeof ja==="function")C=ja.call(n,U,C);switch(typeof C){case "string":return xa(C);case "number":return isFinite(C)?String(C):"null";case "boolean":case "null":return String(C);
case "object":if(!C)return"null";N+=oa;A=[];if(Object.prototype.toString.apply(C)==="[object Array]"){J=C.length;for(x=0;x<J;x+=1)A[x]=na(x,C)||"null";G=A.length===0?"[]":N?"[\n"+N+A.join(",\n"+N)+"\n"+K+"]":"["+A.join(",")+"]";N=K;return G}if(ja&&typeof ja==="object"){J=ja.length;for(x=0;x<J;x+=1){E=ja[x];if(typeof E==="string")if(G=na(E,C))A.push(xa(E)+(N?": ":":")+G)}}else for(E in C)if(Object.hasOwnProperty.call(C,E))if(G=na(E,C))A.push(xa(E)+(N?": ":":")+G);G=A.length===0?"{}":N?"{\n"+N+A.join(",\n"+
N)+"\n"+K+"}":"{"+A.join(",")+"}";N=K;return G}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+ga(this.getUTCMonth()+1)+"-"+ga(this.getUTCDate())+"T"+ga(this.getUTCHours())+":"+ga(this.getUTCMinutes())+":"+ga(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var ka=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
ya=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,N,oa,Ca={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},ja;if(typeof JSON.stringify!=="function")JSON.stringify=function(U,n,x){var E;oa=N="";if(typeof x==="number")for(E=0;E<x;E+=1)oa+=" ";else if(typeof x==="string")oa=x;if((ja=n)&&typeof n!=="function"&&(typeof n!=="object"||typeof n.length!=="number"))throw Error("JSON.stringify");
return na("",{"":U})};if(typeof JSON.parse!=="function")JSON.parse=function(U,n){function x(G,J){var K,A,C=G[J];if(C&&typeof C==="object")for(K in C)if(Object.hasOwnProperty.call(C,K)){A=x(C,K);if(A!==undefined)C[K]=A;else delete C[K]}return n.call(G,J,C)}var E;U=String(U);ka.lastIndex=0;if(ka.test(U))U=U.replace(ka,function(G){return"\\u"+("0000"+G.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(U.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){E=eval("("+U+")");return typeof n==="function"?x({"":E},""):E}throw new SyntaxError("JSON.parse");}})();
COG=function(){function ga(n,x){var E=n.gtObsHandlers;E[x]||(E[x]=[]);return E[x]}function xa(n,x){n[x]||(n[x]=function(E){return n.configure(x,E)})}function na(n){n.gtConfId=objId("configurable");n.gtConfig={};n.gtConfigFns=[];return n.gtConfig}var ka=Object.prototype.hasOwnProperty,ya=0,N={toID:function(n){return n.replace(/\s/g,"-")},objId:function(n){return(n?n:"obj")+ya++}};N.Log=function(){function n(K,A){var C,Y=A&&A.length>0?A[0]:"";for(C=1;A&&C<A.length;C++)Y+=" "+(E&&Ca(A[C])?JSON.stringify(A[C]):
A[C]);typeof console!=="undefined"&&console[K](Y);for(C=0;C<x.length;C++)x[C].call(J,Y,K)}var x=[],E=typeof JSON!=="undefined",G=window.console&&window.console.markTimeline,J={getTraceTicks:function(){return G?(new Date).getTime():null},trace:function(K,A){if(G)console.markTimeline(K+(A?": "+(J.getTraceTicks()-A)+"ms":""))},debug:function(){n("debug",arguments)},info:function(){n("info",arguments)},warn:function(){n("warn",arguments)},error:function(){n("error",arguments)},exception:function(K){J.error(arguments);
for(var A in K)J.info("ERROR DETAIL: "+A+": "+K[A])},watch:function(K,A){try{A()}catch(C){J.exception(C,K)}},throwError:function(K){J.error(K);throw Error(K);},requestUpdates:function(K){x.push(K)}};return J}();N.contains=function(n,x){var E=n,G=arguments,J=1;if(x&&module.isArray(x)){G=x;J=0}for(J=J;J<G;J++)E=E&&typeof foo[G[J]]!=="undefined";return E};var oa=N.extend=function(){var n=arguments[0]||{},x=1,E=arguments.length,G=false,J,K,A,C;if(typeof n==="boolean"){G=n;n=arguments[1]||{};x=2}if(typeof n!==
"object"&&!module.isFunction(n))n={};if(E===x){n=this;--x}for(;x<E;x++)if((J=arguments[x])!=null)for(K in J){A=n[K];C=J[K];if(n!==C)if(G&&C&&(module.isPlainObject(C)||module.isArray(C))){A=A&&(module.isPlainObject(A)||module.isArray(A))?A:module.isArray(C)?[]:{};n[K]=module.extend(G,A,C)}else if(C!==undefined)n[K]=C}return n};N.formatStr=function(n){if(arguments.length<=1)return n;for(var x=arguments.length-2,E=0;E<=x;E++)n=n.replace(RegExp("\\{"+E+"\\}","gi"),arguments[E+1]);return n};N.wordExists=
function(n,x){var E="";if(x.toString)x=x.toString();for(var G=0;G<x.length;G++)E+=!/\w/.test(x[G])?"\\"+x[G]:x[G];return RegExp("(^|\\s|\\,)"+E+"(\\,|\\s|$)","i").test(n)};N.isFunction=function(n){return toString.call(n)==="[object Function]"};N.isArray=function(n){return toString.call(n)==="[object Array]"};var Ca=N.isPlainObject=function(n){if(!n||toString.call(n)!=="[object Object]"||n.nodeType||n.setInterval)return false;if(n.constructor&&!ka.call(n,"constructor")&&!ka.call(n.constructor.prototype,
"isPrototypeOf"))return false;var x;for(x in n);return x===undefined||ka.call(n,x)};N.isEmptyObject=function(n){for(var x in n)return false;return true};N.isXmlDocument=function(n){return toString.call(n)==="[object Document]"};N.Loopage=function(){function n(S){return oa({id:K++,frequency:0,after:0,single:false,lastTick:0,execute:function(){}},S)}function x(S){C.push(S);E()}function E(){Y&&clearTimeout(Y);Y=setTimeout(G,0);pa=true}function G(){for(var S,aa=(new Date).getTime(),ba=A.length;C.length>
0;){var la=C.shift();for(S=ba;S--;)if(A[S].id===la){A.splice(S,1);break}pa=true;ba=A.length}if(pa){Z=J;for(S=ba;S--;)Z=A[S].frequency<Z?A[S].frequency:Z}for(S=ba;S--;){la=aa-A[S].lastTick;if(A[S].lastTick===0||la>=A[S].frequency){A[S].execute(aa,A[S]);A[S].lastTick=aa;A[S].single&&A[S].trigger("complete")}}Y=ba?setTimeout(G,Z):0}var J=6E4,K=0,A=[],C=[],Y=0,Z=J,pa=true;return{join:function(S){var aa=new n(S);if(aa.after>0)aa.lastTick=(new Date).getTime()+aa.after;ja(aa);aa.bind("complete",function(){x(aa.id)});
A.unshift(aa);E();return aa},leave:x}}();var ja=N.observable=function(n){if(n){if(!n.gtObsHandlers)n.gtObsHandlers={};if(!(n.bind||n.trigger||n.unbind)){n.bind=function(x,E){var G=objId("callback");ga(n,x).unshift({fn:E,id:G});return G};n.trigger=function(x){var E=ga(n,x),G={cancel:false,tickCount:(new Date).getTime()},J;if(!E)return null;J=Array.prototype.slice.call(arguments,1);J.unshift(G);for(var K=E.length;K--&&!G.cancel;)E[K].fn.apply(self,J);return G};n.unbind=function(x,E){for(var G=ga(n,
x),J=0;G&&J<G.length;J++)if(G[J].id===E){G.splice(J,1);break}return n}}}},U={};N.paramTweaker=function(n,x,E){return function(G,J){if(typeof J!=="undefined"){if(G in n)n[G]=J;E&&G in E&&E[G](G,J)}else return x&&G in x?x[G](G):n[G]}};N.configurable=function(n,x,E,G){if(n){n.gtConfId||na(n);var J=n.gtConfId,K=n.gtConfig,A=n.gtConfigFns;U[J]=n;A.push(E);for(E=x.length;E--;){K[x[E]]=true;G&&xa(n,x[E])}if(!n.configure)n.configure=function(C,Y){if(K[C]){for(var Z=A.length;Z--;){var pa=A[Z](C,Y);if(typeof pa!==
"undefined")return pa}return U[J]}return null}}};(function(){function n(J){var K=document.createElement("script"),A=false;K.src=J;K.async=true;K.onload=K.onreadystatechange=function(){if(!A&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){A=true;K.onload=K.onreadystatechange=null;K&&K.parentNode&&K.parentNode.removeChild(K)}};E||(E=document.getElementsByTagName("head")[0]);E.appendChild(K)}var x=0,E,G=this;N.jsonp=function(J,K,A){J+=J.indexOf("?")>=0?"&":"?";var C="json"+
++x;G[C]=function(Y){K(Y);G[C]=null;try{delete G[C]}catch(Z){}};n(J+(A?A:"callback")+"="+C);return C}})();return N}();
T5=function(){function ga(){return(new Date).getTime()}function xa(){for(;Qa.length>0;){var a=Qa.shift();document.location=a}Ra=0}function na(a){for(var b=true,c=hb.length;c--;)b=b&&a!=hb[c];return b}function ka(a,b){var c=[];for(var d in b)d&&c.push(d+"="+escape(b[d]));return"tile5://"+a+"/"+(c.length>0?"?"+c.join("&"):"")}function ya(a,b){na(a)&&COG.Log.info("would push url: "+ka(a,b))}function N(a,b){if(na(a)){Qa.push(ka(a,b));Ra||(Ra=setTimeout(xa,100))}}function oa(a){return function(b,c,d){(d?
d:a?document.body:document).addEventListener(b,c,false)}}function Ca(a){return function(b,c,d){(d?d:a?document.body:document).removeEventListener(b,c,false)}}function ja(a,b,c){(c?c:document).attachEvent("on"+a,b)}function U(a,b,c){(c?c:document).detachEvent("on"+a,b)}function n(){ma={base:{name:"Unknown",bindEvent:oa(),unbindEvent:Ca(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:ya,targetFps:null},
ie:{name:"MSIE",regex:/msie/i,bindEvent:ja,unbindEvent:U,requireFastDraw:false,targetFps:25},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:N,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:N},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:N},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:oa(true),unbindEvent:Ca(true),supportsTouch:true,getScaling:function(){return 1/
window.devicePixelRatio},bridgeNotify:N},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:N}};Sa=[ma.froyo,ma.android,ma.ipod,ma.iphone,ma.ipad,ma.ie]}function x(){ma||n();if(!Da){COG.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var a=0;a<Sa.length;a++){var b=Sa[a];if(b.regex&&b.regex.test(navigator.userAgent)){Da=T5.ex({},ma.base,b);COG.Log.info("PLATFORM DETECTED AS: "+Da.name);break}}if(!Da){COG.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
Da=ma.base}COG.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return Da}function E(a,b){function c(f,g){if(f&&d!==f){var h=a.triggerAll("zoomLevelChange",f,g);if(h)d=f;return h}}b=T5.ex({initial:1,min:0,max:null,zoomAnimation:Y("quad.out")},b);var d=b.initial;T5.ex(a,{getZoomLevel:function(){return d},setZoomLevel:c});a.bind("scale",function(f,g,h){var i=Math.log(g)/Math.LN2;J(function(o){return o.cancelOnInteract});f.cancel=!c(d+i,h);f.cancel||a.updateOffset(h.x*g,h.y*g)});a.bind("doubleTap",
function(f,g,h){if(a.scalable()){J(function(i){return i.cancelOnInteract});a.scale(2,XY.init(h.x,h.y))}})}function G(a){if(Ea)return ca.length;Ea=true;try{for(var b=0;b<ca.length;)if(ca[b].isComplete()){ca[b].triggerComplete(false);ca.splice(b,1)}else{ca[b].update(a);b++}}finally{Ea=false}ca.length===0&&Ia.trigger("complete");return ca.length}function J(a){if(!Ea){Ea=true;try{for(var b=0;b<ca.length;)if(!a||a(ca[b])){ca[b].triggerComplete(true);ca.splice(b,1)}else b++}finally{Ea=false}}}function K(){if(!Ia){Ia=
COG.Loopage.join({execute:G,frequency:20});Ia.bind("complete",function(){Ia=null})}}function A(a,b,c,d,f){a=new Ta({startValue:a,endValue:b,tweenFn:c,complete:d,duration:f});ca.push(a);return a}function C(a,b,c,d,f,g){a=new Ta({target:a,property:b,endValue:c,tweenFn:d,duration:g,complete:f});ca.push(a);return a}function Y(a){return Ja[a.replace(/[\-\_\s\.]/g,"").toLowerCase()]}function Z(){for(var a=0,b=arguments.length;b--;){var c=vb[arguments[b].toUpperCase()];if(c)a|=c}return a}function pa(a,b,
c,d){b=aa(b);a.add(d.line(b,c));return b.length}function S(a,b,c,d){b=aa(b);a.add(d.poly(b,c));return b.length}function aa(a){var b=a?a.length:0,c=Array(b);for(b=b;b--;)c[b]=new ia.Position(a[b][1],a[b][0]);return ia.P.vectorize(c,ib)}var ba=Math.PI*2,la=Math.PI/2,Ua=Math.abs,Na=Math.pow,Ka=Math.sin,Va=Math.asin,jb=Math.cos,ha=function(){return{dotProduct:function(a,b){return a.x*b.x+a.y*b.y}}}(),wb=function(){return{getAspectRatio:function(a){return a.height!==0?a.width/a.height:1},getCenter:function(a){return XY.init(a.width/
2,a.height/2)},getSize:function(a){return Math.sqrt(Math.pow(a.width,2)+Math.pow(a.height,2))},init:function(a,b){a=a?a:0;return{width:a,height:b?b:a}}}}(),ma=null,Sa=[],Da=null,Ra=0,Qa=[],hb=["view.wake","tile.loaded"],La=function(){function a(){if(!u){var p=T5.getConfig().maxImageLoads;u=COG.Loopage.join({execute:function(B,s){if(!p||k.length<p){var H=l.shift();if(H){k[k.length]=H;H.image.onload=c;H.image.src=H.url;H.requested=T5.ticks()}else s.trigger("complete")}},frequency:10});u.bind("complete",
function(){u=null})}}function b(){w=true;try{var p=q.length/2>>0;if(p>0){q.sort(function(s,H){return s.created-H.created});for(var B=p;B--;)delete g[q[B].url];q.splice(0,p)}}finally{w=false}v.trigger("cacheCleared")}function c(){var p=i[this.id],B;if(p&&p.image.complete&&p.image.width>0){p.loaded=true;p.hitCount=1;for(B=k.length;B--;)if(k[B].image.src==this.src){k.splice(B,1);break}if(p.background||p.postProcess||p.drawBackground||p.customDraw)if(p.image){globalImageData=p;B=f(p.realSize?p.realSize.width:
p.image.width,p.realSize?p.realSize.height:p.image.height);var s=B.getContext("2d"),H=p.offset?p.offset:T5.XY.init();p.background&&s.drawImage(p.background,0,0);p.drawBackground&&p.drawBackground(s);p.customDraw?p.customDraw(s,p):s.drawImage(p.image,H.x,H.y);p.postProcess&&p.postProcess(s,p);p.image=B}for(B=p.callbacks.length;B--;)p.callbacks[B]&&p.callbacks[B](this,false);p.callbacks=[];q[q.length]={url:this.src,created:p.requested};delete i[this.id];a()}}function d(p,B,s){var H=g[p];if(H){H.hitCount++;
H.image.complete&&H.image.width>0&&B?B(H.image,true):H.callbacks.push(B)}else{H=T5.ex({url:p,image:new Image,loaded:false,created:T5.ticks(),requested:null,hitCount:0,callbacks:[B]},s);H.image.id="resourceLoaderImage"+o++;g[p]=H;i[H.image.id]=H;l[l.length]=H;a()}return H}function f(p,B){var s=document.createElement("canvas");s.width=p?p:0;s.height=B?B:0;if(typeof FlashCanvas!=="undefined"){s.id="tmpCanvas"+h++;s.style.cssText="position: absolute; top: -"+(B-1)+"px; left: -"+(p-1)+"px;";document.body.appendChild(s);
FlashCanvas.initElement(s)}typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(s);return s}var g={},h=0,i={},o=0,l=[],k=[],q=[],z=0,u=null,w=false,v={avgImageSize:25,loadTimeout:10,cancelLoad:function(){k=[]},get:function(p,B,s){var H=null,L=null;w||(H=g[p]);if((L=H?H.image:null)&&(L.getContext||L.complete&&L.width>0))return L;else B&&d(p,B,s);return null},load:d,newCanvas:f,reset:function(){g={}},stats:function(){return{imageLoadingCount:k.length,queuedImageCount:l.length,imageCacheFullness:z}}};
COG.observable(v);COG.Loopage.join({execute:function(p){for(var B=false,s=0,H=T5.getConfig();s<k.length;)if(p-k[s].requested>v.loadTimeout*1E3){k.splice(s,1);B=true}else s++;B&&a();if(H&&H.imageCacheMaxSize){z=q.length*v.avgImageSize/H.imageCacheMaxSize;z>=1&&b()}},frequency:2E4});return v}(),Wa=function(){var a={};return{init:function(b,c){var d=a[b];if(!d)throw Error("Unable to locate requested generator: "+b);return new d(c)},register:function(b,c){a[b]=c},Template:function(){}}}(),ca=[],Ia=null,
Ea=false,ra=1.70158,Ja={linear:function(a,b,c,d){return c*a/d+b},backin:function(a,b,c,d){return c*(a/=d)*a*((ra+1)*a-ra)+b},backout:function(a,b,c,d){return c*((a=a/d-1)*a*((ra+1)*a+ra)+1)+b},backinout:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a*(((ra*=1.525)+1)*a-ra)+b:c/2*((a-=2)*a*(((ra*=1.525)+1)*a+ra)+2)+b},bouncein:function(a,b,c,d){return c-Ja.bounceout(d-a,0,c,d)+b},bounceout:function(a,b,c,d){return(a/=d)<1/2.75?c*7.5625*a*a+b:a<2/2.75?c*(7.5625*(a-=1.5/2.75)*a+0.75)+b:a<2.5/2.75?c*(7.5625*
(a-=2.25/2.75)*a+0.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+0.984375)+b},bounceinout:function(a,b,c,d){return a<d/2?Ja.bouncein(a*2,0,c,d)/2+b:Ja.bounceout(a*2-d,0,c,d)/2+c/2+b},cubicin:function(a,b,c,d){return c*(a/=d)*a*a+b},cubicout:function(a,b,c,d){return c*((a=a/d-1)*a*a+1)+b},cubicinout:function(a,b,c,d){if((a/=d/2)<1)return c/2*a*a*a+b;return c/2*((a-=2)*a*a+2)+b},elasticin:function(a,b,c,d,f,g){if(a==0)return b;if((a/=d)==1)return b+c;g||(g=d*0.3);if(!f||f<Ua(c)){f=c;c=g/4}else c=g/ba*Va(c/f);
return-(f*Na(2,10*(a-=1))*Ka((a*d-c)*ba/g))+b},elasticout:function(a,b,c,d,f,g){var h;if(a==0)return b;if((a/=d)==1)return b+c;g||(g=d*0.3);if(!f||f<Ua(c)){f=c;h=g/4}else h=g/ba*Va(c/f);return f*Na(2,-10*a)*Ka((a*d-h)*ba/g)+c+b},elasticinout:function(a,b,c,d,f,g){var h;if(a==0)return b;if((a/=d/2)==2)return b+c;g||(g=d*0.3*1.5);if(!f||f<Ua(c)){f=c;h=g/4}else h=g/ba*Va(c/f);if(a<1)return-0.5*f*Na(2,10*(a-=1))*Ka((a*d-h)*ba/g)+b;return f*Na(2,-10*(a-=1))*Ka((a*d-h)*ba/g)*0.5+c+b},quadin:function(a,
b,c,d){return c*(a/=d)*a+b},quadout:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},quadinout:function(a,b,c,d){if((a/=d/2)<1)return c/2*a*a+b;return-c/2*(--a*(a-2)-1)+b},sinein:function(a,b,c,d){return-c*jb(a/d*la)+c+b},sineout:function(a,b,c,d){return c*Ka(a/d*la)+b},sineinout:function(a,b,c,d){return-c/2*(jb(Math.PI*a/d)-1)+b}},Ta=function(a){a=T5.ex({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:Y("sine.out"),complete:null,cancelOnInteract:false},a);var b=ga(),c=[],d=false,
f=0,g=0,h={cancelOnInteract:a.cancelOnInteract,isComplete:function(){return d},triggerComplete:function(i){a.complete&&a.complete(i)},update:function(i){try{var o=a.tweenFn(i-b,f,g,a.duration);if(a.target)a.target[a.property]=o;for(var l=c.length;l--;)c[l](o,void 0);if(d=b+a.duration<=i){if(a.target)a.target[a.property]=a.tweenFn(a.duration,f,g,a.duration);for(var k=c.length;k--;)c[k](o,true)}}catch(q){COG.Log.exception(q)}},requestUpdates:function(i){c.push(i)}};f=a.target&&a.property&&a.target[a.property]?
a.target[a.property]:a.startValue;if(typeof a.endValue!=="undefined")g=a.endValue-f;if(g==0)d=true;K();return h},Fa=function(){function a(h,i){f[h]=c(i);return h}function b(h){for(var i in h)a(i,h[i])}function c(h){function i(q){var z=h[q];typeof z!=="undefined"&&l.push(function(u){u[q]=z})}function o(){l=[];for(var q in h)i(q)}h=T5.ex({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},
h);var l=[],k={applyToContext:function(q){for(var z=l.length;z--;)l[z](q)},update:function(q,z){h[q]=z;o()}};o();return k}var d={},f={},g={apply:function(h,i){var o=f[i]?f[i]:f.basic,l;if(h&&h.canvas){l=d[h.canvas.id];d[h.canvas.id]=i}o.applyToContext(h);return l},define:a,defineMany:b,get:function(h){return f[h]},init:c,load:function(h){COG.jsonp(h,function(i){b(i)})}};b({basic:{lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"},waypoints:{lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"}});
return g}(),vb={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,ZOOM:16,FREEZE:128},rb=function(a){function b(t,y,M,P){qa=Oa;v();if(P&&a.inertia)o($+y,da+M,a.panAnimationEasing,a.panAnimationDuration);else P||o($+y,da+M)}function c(){qa=Xa;sa=false;v()}function d(t,y,M){Pa||(Pa=[].concat(M));t=kb(Pa);lb(t);y=mb(t);var P=kb(M);M=lb(P);P=mb(P);h(M);W=t&&y!==0?P/y:1;g()}function f(t,y,M){V.zoom(D.getCenter(I),M)}function g(t){z();var y=XY.init(Ya-(e.width/(W*2)>>0),Za-(e.height/(W*2)>>0)),M=Math.log(W)/Math.LN2>>
0;if(W!==1)qa=$a;COG.Log.info("scale factor = "+W+", exp = "+M);if(M!==0){W=Math.pow(2,M);if(!V.trigger("scale",W,y).cancel){COG.Log.info("ok to scale");for(t=s.length;t--;)s[t].trigger("scale",W,y);W=1;Pa=null;qa=Xa;t=true}}v(t)}function h(t){za=XY.init($,da);ta=XY.offset(t,$,da)}function i(){clearTimeout(nb);nb=setTimeout(l,50)}function o(t,y,M,P,R){function X(){fa+=1;if(fa>=2){c(0,0);R&&R()}}var fa=0,ua=Aa?XY.offset(Aa,-Q,-ea):null,va=Ba?XY.offset(Ba,-Q,-ea):null;if(ua){t=t<ua.x?ua.x:t;y=y<ua.y?
ua.y:y}if(va){t=t>va.x?va.x:t;y=y>va.y?va.y:y}if(M){if(!sa){t=A($,t,M,X,P);y=A(da,y,M,X,P);t.cancelOnInteract=true;t.requestUpdates(function(ab){$=ab>>0;sa=true;v()});y.cancelOnInteract=true;y.requestUpdates(function(ab){da=ab>>0;sa=true;v()})}}else{$=t>>0;da=y>>0}}function l(){var t;if(L){COG.Touch.release(L);if(a.autoSize&&L.parentNode){t=L.parentNode.getBoundingClientRect();if(t.height!==0&&t.width!==0){L.height=t.height;L.width=t.width}}try{if(!L.id)L.id=a.id+"_canvas";O=L.getContext("2d")}catch(y){COG.Log.exception(y);
throw Error("Could not initialise canvas on specified view element");}ob=COG.Touch.capture(L,{observable:V});if(I.height!==L.height||I.width!==L.width){I=D.init(L.width,L.height);Q=I.width/2>>0;ea=I.height/2>>0;V.trigger("resize",L.width,L.height);for(t=H;t--;)s[t].trigger("resize",L.width,L.height)}a.inertia&&ob.inertiaEnable(a.panAnimationDuration,I);for(t=H;t--;)s[t].trigger("contextChanged",O);v()}}function k(t,y){y.setId(t);y.added=ga();y.bind("remove",function(){V.removeLayer(t)});y.trigger("contextChanged",
O);y.setParent(V);s.push(y);s.sort(function(M,P){var R=P.zindex-M.zindex;if(R===0)R=P.added-M.added;return R});H=s.length;return y}function q(){B("idle",V);bb=true;Ga=0}function z(t){var y=1/W;Ya=ta.x+($-za.x);Za=ta.y+(da-za.y);if(t)return XYRect.fromCenter(Ya>>0,Za>>0,t.width*y>>0,t.height*y>>0)}function u(t,y,M,P){var R=XYRect.copy(y),X,fa=0;M&&O.clearRect(0,0,L.width,L.height);O.save();try{O.globalCompositeOperation="source-over";if(W!==1){R=z(R);O.scale(W,W)}O.translate(-R.x1,-R.y1);Ba=Aa=null;
O.beginPath();r=false;for(fa=H;fa--;)if(s[fa].clip){s[fa].clip(O,R,t,V,M,P);r=true}O.closePath();r&&O.clip();for(fa=H;fa--;){X=s[fa];var ua=X.style,va=ua?Fa.apply(O,ua):null;if(X.minXY)Aa=Aa?XY.min(Aa,X.minXY):XY.copy(X.minXY);if(X.maxXY)Ba=Ba?XY.max(Ba,X.maxXY):XY.copy(X.maxXY);X.draw(O,R,t,V,M,P);va&&Fa.apply(O,va)}}finally{O.restore()}if(m){O.globalCompositeOperation="source-over";O.strokeStyle="#f00";O.beginPath();O.moveTo(L.width/2,0);O.lineTo(L.width/2,L.height);O.moveTo(0,L.height/2);O.lineTo(L.width,
L.height/2);O.stroke()}B("drawComplete",y,P);COG.Log.trace("draw complete",P)}function w(t,y){var M=false,P=cb?cb:sa?Oa:qa,R=!sa&&(P===$a||P===Oa),X=db||P===Oa||P===$a||ca.length>0;e=p();if(R){J(function(fa){return fa.cancelOnInteract});bb=false;if(Ga!==0){clearTimeout(Ga);Ga=0}}for(R=H;R--;){if(s[R].animated)qa|=pb;s[R].cycle(t,e,qa,X);M=s[R].shouldDraw(qa,e,X)||M}X=X||(qa&pb)!==0;if(M=M||X||W!==1&&W!==qb){u(P,e,X,t);qb=W;db=false}if(!M&&T===0&&!xb){if(!bb&&Ga===0)Ga=setTimeout(q,500);y.trigger("complete")}T=
0;COG.Log.trace("Completed draw cycle",t)}function v(t){db=t?true:false;T+=1;if(!j){j=COG.Loopage.join({execute:w,frequency:yb});j.bind("complete",function(){j=null})}}function p(){return XYRect.init($,da,$+I.width,da+I.height)}function B(){for(var t=V.trigger.apply(null,arguments).cancel,y=s.length;y--;)t=s[y].trigger.apply(null,arguments).cancel||t;return!t}a=T5.ex({id:COG.objId("view"),container:"",fastDraw:false,inertia:true,pannable:true,scalable:true,panAnimationEasing:Y("sine.out"),panAnimationDuration:750,
pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:true,tapExtent:10,mask:true,guides:false,fps:25},a);var s=[],H=0,L=document.getElementById(a.container),O=null,$=0,da=0,r=false,e=null,j=null,m=a.guides,F=1,I=D.init(),T=0,Q=0,ea=0,za=null,ta=null,bb=false,sa=false,Ga=0,Aa=null,Ba=null,zb=0,cb=null,db=false,nb=0,Pa=null,W=1,qb=0,xb=typeof FlashCanvas!=="undefined",yb=~~(1E3/a.fps),ob=null,Ya,Za,Xa=Z("ACTIVE"),Oa=Z("PAN"),$a=Z("ZOOM"),pb=Z("ANIMATING"),qa=Xa,kb=XY.getRect,mb=XYRect.diagonalSize,
lb=XYRect.center,V={id:a.id,deviceScaling:F,fastDraw:a.fastDraw||x().requireFastDraw,getDimensions:function(){return I},getLayer:function(t){for(var y=0;y<H;y++)if(s[y].getId()==t)return s[y];return null},setLayer:function(t,y){for(var M=0;M<H;M++)if(s[M].getId()===t){s.splice(M,1);break}y&&k(t,y);v();return y},eachLayer:function(t){for(var y=H;y--;)t(s[y])},invalidate:v,resize:function(t,y){if(L){a.autoSize=false;L.width=t;L.height=y;l();V.trigger("resize",L.width,L.height)}},scale:function(t,y,
M,P){function R(){W=Math.pow(2,Math.round(Math.log(W)/Math.LN2));P&&P();g(true)}var X=W;y||(y=D.getCenter(I));h(y);if(M)A(0,t-X,M,R,1E3).requestUpdates(function(fa){W=X+fa;g()});else{W=t;R()}return V},triggerAll:B,removeLayer:function(t){a:{for(var y=H;y--;)if(s[y].getId()==t){t=y;break a}t=-1}if(t>=0&&t<H){V.trigger("layerRemoved",s[t]);s.splice(t,1);v()}H=s.length},stateOverride:function(t){cb=t},getOffset:function(){return XY.init($,da)},getViewRect:p,updateOffset:o,pan:function(t,y,M,P,R){o($+
t,da+y,M,P,R)},zoom:function(t,y){h(t);sa=false;W=Math.max(W+Math.pow(2,y)-1,0.25);COG.Log.info("zooming, scale change = "+y+", targetXY = ",t);g()}};F=x().getScaling();V.markers=k("markers",new eb);COG.observable(V);V.bind("invalidate",function(t,y){v(y)});if(a.pannable){V.bind("pan",b);V.bind("panEnd",c);V.bind("inertiaCancel",function(){sa=false;v()})}if(a.scalable){V.bind("pinchZoom",d);V.bind("wheelZoom",f)}V.bind("tap",function(t,y,M){for(var P=XY.offset(M,$,da),R=s.length;R--;)t.cancel=t.cancel||
s[R].trigger("tap",y,M,P).cancel});V.bind("resync",function(){Ba=Aa=null});COG.configurable(V,["inertia","container","rotation","tapExtent","scalable","pannable"],COG.paramTweaker(a,null,{container:function(t,y){L=document.getElementById(y);l()},rotation:function(t,y){zb=y}}),true);l();a.autoSize&&window.addEventListener("resize",i,false);return V},Ha=function(a){a=T5.ex({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:Z("ACTIVE","ANIMATING","PAN","ZOOM"),style:null,minXY:null,maxXY:null},
a);var b=null,c=false,d=false,f=a.supportFastDraw,g=a.id,h=Z("ACTIVE"),i=a.validStates,o=0,l=0,k=T5.ex({addToView:function(q){q.setLayer(g,k)},shouldDraw:function(q,z,u){return(d||u||o!==z.x1||l!==z.y1)&&(q&i)!==0&&(c?f:true)},clip:null,cycle:function(){},draw:function(){},remove:function(){k.trigger("remove",k)},changed:function(q){d=true;k.trigger("changed",k);b&&b.trigger("invalidate",q)},getId:function(){return g},setId:function(q){g=q},getParent:function(){return b},setParent:function(q){c=(b=
q)?b.fastDraw&&displayState!==h:false;k.trigger("parentChange",b)}},a);COG.observable(k);k.bind("drawComplete",function(q,z){d=false;o=z.x1;l=z.y1});k.bind("resync",function(q,z){if(z.syncXY){k.minXY&&z.syncXY(k.minXY);k.maxXY&&z.syncXY(k.maxXY)}});return k},fb=function(a){function b(o,l,k,q){d=o;f=l;g=k;h=q}a=T5.ex({xy:XY.init(),offset:true,tweenIn:null,animationSpeed:null,isNew:true},a);var c=false,d=0,f=0,g=0,h=0,i=T5.ex(a,{isAnimating:function(){return c},draw:function(o,l,k,q,z){if(i.isNew&&
a.tweenIn){var u=i.xy.y;i.xy.y=l.y1-20;c=true;C(i.xy,"y",u,a.tweenIn,function(){i.xy.y=u>>0;c=false},a.animationSpeed?a.animationSpeed:250+Math.random()*500)}i.drawMarker(o,l,i.xy.x,i.xy.y,k,q,z);i.isNew=false},drawMarker:function(o,l,k,q){o.beginPath();o.arc(k,q,4,0,Math.PI*2,false);o.fill();b(k-4,q-4,8,8)},hitTest:function(o,l){return o>=d&&o<=d+g&&l>=f&&l<=f+h},updateBounds:b});COG.observable(i);return i},eb=function(a){function b(){f.changed();f.trigger("markerUpdate",d)}function c(){var g=f.getParent();
if(g&&g.syncXY)for(var h=d.length;h--;)g.syncXY([d[h].xy])}a=T5.ex({zindex:100,style:"basic"},a);var d=[],f=T5.ex(new Ha(a),{draw:function(g,h,i,o){for(var l=d.length;l--;)d[l].draw(g,h,i,f,o)},add:function(g){if(g&&typeof g.length!=="undefined")for(var h=g.length;h--;){if(g[h])d[d.length]=g[h]}else if(g)d[d.length]=g;b()},clear:function(g){if(g)for(var h=0;h<d.length;h++)g(d[h])&&d.splice(h,1);else d=[];b()},each:function(g){if(g)for(var h=d.length;h--;)g(d[h])},find:function(g){for(var h=[],i=d.length;i--;)if(!g||
g(d[i]))h[h.length]=d[i];return h}});f.bind("tap",function(g,h,i){for(var o=[],l=i.x,k=i.y,q=d.length;q--;)if(d[q].hitTest(l,k))o[o.length]=d[q];if(o.length>0)g.cancel=f.trigger("markerTap",h,i,o).cancel});f.bind("parentChange",c);f.bind("resync",c);f.bind("changed",c);return f},sb=function(a){function b(i,o,l){i.fillStyle="#FFFFFF";i.strokeStyle="#222222";i.beginPath();i.arc(l.x,l.y,4,0,Math.PI*2,false);i.stroke();i.fill()}a=T5.ex({path:[],id:COG.objId("pathAni"),easing:Y("sine.inout"),validStates:Z("ACTIVE",
"PAN","ZOOM"),drawIndicator:null,duration:2E3},a);var c=XY.edges(a.path),d,f=null,g=0;A(0,c.total,a.easing,function(){h.remove()},a.duration).requestUpdates(function(i,o){g=i;o&&h.remove()});var h=T5.ex(new Ha(a),{cycle:function(){for(var i=0;i<c.accrued.length&&c.accrued[i]<g;)i++;f=null;if(i<a.path.length-1){var o=g-(i>0?c.accrued[i-1]:0),l=a.path[i];d=XY.theta(l,a.path[i+1],c.edges[i]);f=XY.extendBy(l,d,o)}return f},draw:function(i,o){if(f)(a.drawIndicator?a.drawIndicator:b)(i,o,XY.init(f.x,f.y),
d)}});return h},tb=function(a){a=T5.ex({style:null,properties:{}},a);return T5.ex(a,{rect:null,draw:function(){},resync:function(){}})},gb=function(a,b){b=T5.ex({fill:false,simplify:false},b);var c=false,d=b.fill,f=b.simplify,g=Z("ZOOM"),h=[],i=T5.ex(new tb(b),{draw:function(o,l,k,q,z,u){if(c){l=true;k=(u&g)!==0;o.beginPath();for(u=h.length;u--;){k=h[u].x;q=h[u].y;if(l){o.moveTo(k,q);l=false}else o.lineTo(k,q);k=true}if(k){d&&o.fill();o.stroke()}}},resync:function(o){i.xy=o.syncXY(a);h=XY.floor(f?
XY.simplify(a):a)}});c=a&&a.length>=2;return i},wa=function(a){function b(g){for(var h=d.length;h--;)d[h].resync(g);d.sort(function(i,o){var l=o.xy.y-i.xy.y;if(l===0)l=o.xy.x-i.xy.y;return l});f.changed()}function c(g,h){h.syncXY&&b(h)}a=T5.ex({zindex:80},a);var d=[],f=T5.ex(new Ha(a),{add:function(g){d[d.length]=g},each:function(g){for(var h=d.length;h--;)g(d[h])},draw:function(g,h,i){var o=h.x1,l=h.y1,k=h.width;h=h.height;for(var q=d.length;q--;){var z=d[q].style;z=z?Fa.apply(g,z):null;d[q].draw(g,
o,l,k,h,i);z&&Fa.apply(g,z)}}});f.bind("parentChange",c);f.bind("resync",c);return f},Ab=function(){return{tileSize:256,init:function(a,b,c,d,f){return T5.ex({x:a,y:b,width:c,height:d},f)}}}(),ub=function(a){function b(w,v,p,B){function s(){if(u.initTileCreator){i=true;u.initTileCreator(w,v,p,B)}}u.prepTileCreator?u.prepTileCreator(w,v,p,s):s()}function c(w,v){for(var p=~~((w.x1-g.x)/o),B=~~((w.y1-g.y)/l),s=[],H=-h;H<q;H++)for(var L=-h;L<z;L++){var O=k(p+H,B+L);if(O)s[s.length]=O}v&&v(s);f=XYRect.copy(w)}
a=T5.ex({tileWidth:256,tileHeight:256,relative:false,padding:2},a);var d=null,f=null,g=XY.init(),h=a.padding,i=false,o=a.tileWidth,l=a.tileHeight,k=null,q=0,z=0,u={bindToView:function(w){COG.Log.info("initializing generator");d=w;u.trigger("bindView",w)},getTileCreatorArgs:null,initTileCreator:null,prepTileCreator:null,requireRefresh:function(){return false},reset:function(){k=null;i=false;f=null},run:function(w,v){if(!f||Math.abs(w.x1-f.x1)>o||Math.abs(w.y1-f.y1)>l){if(!k&&!i||u.requireRefresh()){g=
a.relative?XY.init(w.x1,w.y1):XY.init();q=Math.ceil(w.width/o)+h;z=Math.ceil(w.height/l)+h;b(o,l,u.getTileCreatorArgs?u.getTileCreatorArgs(d):{},function(p){k=p;i=false;c(w,v)})}k&&c(w,v)}}};COG.observable(u);u.bind("update",function(){COG.Log.info("captured generator update");f=null});return u};ha={ex:COG.extend,ticks:ga,getConfig:x,userMessage:function(a,b,c){module.trigger("userMessage",a,b,c)},XY:XY,XYRect:XYRect,Vector:function(a,b){COG.Log.warn("The T5.Vector class has been deprecated, please use T5.XY.init instead");
return XY.init(a,b)},V:COG.extend(XY,ha),D:wb,Images:La,Generator:Wa,tween:C,tweenValue:A,easing:Y,registerEasingType:function(a,b){Ja[a.replace(/[\-\_\s\.]/g,"").toLowerCase()]=b},Tween:Ta,Style:Fa,viewState:Z,View:rb,ViewLayer:Ha,ImageLayer:function(a,b){function c(l,k,q){for(k=g.length;k--;){var z=g[k],u=z.x,w=z.y,v=XYRect.init(z.x,z.y,z.x+z.width,z.y+z.height);if(q&&XYRect.intersect(l,v)){v=La.get(z.url,function(){o.changed()},i);q(v,u,w,z.width,z.height)}}}function d(l){f&&f.run(l,function(k){g=
[].concat(k);o.changed()})}b=T5.ex({imageLoadArgs:{}},b);var f=a?Wa.init(a,b):null,g=[],h=XYRect.init(),i=b.imageLoadArgs,o=T5.ex(new Ha(b),{changeGenerator:function(l,k){f=Wa.init(l,T5.ex({},b,k));f.bindToView(o.getParent());g=null;d(h)},clip:function(l,k,q){c(k,q,function(z,u,w,v,p){z&&l.rect(u,w,v,p)})},cycle:function(l,k){d(k)},draw:function(l,k,q){c(k,q,function(z,u,w,v,p){o.drawImage(l,z,u,w,v,p,k,q)});h=XYRect.copy(k)},drawImage:function(l,k,q,z){k&&l.drawImage(k,q,z,k.width,k.height)}});o.bind("idle",
function(){d(h)});o.bind("parentChange",function(l,k){f&&f.bindToView(k)});o.bind("tap",function(l,k,q,z){l=[];var u=z.x,w=z.y,v,p;if(g)for(var B=g.length;B--;){v=g[B];if(p=u>=v.x&&u<=v.x+v.width&&w>=v.y&&w<=v.y+v.height)l[l.length]=v}l.length>0&&o.trigger("tapImage",l,k,q,z)});return o},Marker:fb,ImageMarker:function(a){a=T5.ex({image:null,imageUrl:null,animatingImage:null,animatingImageUrl:null,imageAnchor:null,rotation:0,scale:1,opacity:1},a);var b=a.imageAnchor?T5.XY.invert(a.imageAnchor):null,
c=T5.ex(new fb(a),{drawMarker:function(d,f,g,h){if((f=c.isAnimating()&&c.animatingImage?c.animatingImage:c.image)&&f.width>0){b||(b=XY.init(-f.width>>1,-f.height>>1));var i=c.scale,o=g+~~(b.x*i),l=h+~~(b.y*i),k=~~(f.width*i),q=~~(f.height*i);c.updateBounds(o,l,k,k);if(c.rotation||c.opacity!==1){d.save();try{d.globalAlpha=c.opacity;d.translate(g,h);d.rotate(c.rotation);d.drawImage(f,b.x*i,b.y*i,k,q)}finally{d.restore()}}else d.drawImage(f,o,l,k,q)}}});if(!c.image)c.image=La.get(a.imageUrl,function(d){c.image=
d});if(!c.animatingImage)c.animatingImage=La.get(a.animatingImageUrl,function(d){c.animatingImage=d});return c},MarkerLayer:eb,PathLayer:function(a){a=T5.ex({style:"waypoints",pixelGeneralization:8,zindex:50},a);var b=false,c=[],d=null,f=[],g=null,h=0,i=[],o=T5.ex(new Ha(a),{getAnimation:function(l,k,q,z){var u="pathAnimation"+h++;i.push(u);return new sb({id:u,path:c,zindex:a.zindex+1,easing:l?l:Y("sine.inout"),duration:k?k:5E3,drawIndicator:q,autoCenter:z?z:false})},cycle:function(l,k,q,z){return z},
draw:function(l){var k,q=c.length;l.save();try{Fa.apply(l,a.style);if(q>0){l.beginPath();l.moveTo(c[q-1].x,c[q-1].y);for(k=q;k--;)l.lineTo(c[k].x,c[k].y);l.stroke();if(d){l.fillStyle=a.waypointFillStyle;for(k=d.length;k--;){l.beginPath();l.arc(d[k].x,d[k].y,2,0,Math.PI*2,false);l.stroke();l.fill()}}}}finally{l.restore()}b=false},updateCoordinates:function(l,k){f=l;g=k;var q=o.getParent();if(q&&q.syncXY){q.syncXY(f);g&&q.syncXY(g);o.trigger("tidy")}}});o.bind("tidy",function(){c=XY.simplify(f,a.pixelGeneralization);
d=XY.simplify(g,a.pixelGeneralization);b=true;o.changed()});return o},AnimatedPathLayer:sb,Shape:tb,Arc:function(a,b){b=T5.ex({size:4},b);var c=XY.init(),d=T5.ex(b,{draw:function(f){f.beginPath();f.arc(c.x,c.y,d.size,0,Math.PI*2,false);f.fill();f.stroke()},resync:function(f){f.syncXY([a]);c=XY.floor([a])[0]}});COG.Log.info("created arc = ",a);return d},Poly:gb,ShapeLayer:wa,Tiling:Ab,TileGenerator:ub};COG.observable(ha);var Ma=ha.GeoXY=function(){function a(c,d){if(c.length){for(var f,g,h,i,o=c.length;o--;){a(c[o],
d);f=typeof f==="undefined"||c.x<f?c.x:f;g=typeof g==="undefined"||c.y<g?c.y:g;h=typeof h==="undefined"||c.x>h?c.x:h;i=typeof i==="undefined"||c.y>i?c.y:i}return T5.XYRect.init(f,g,i,i)}else if(c.mercXY){f=c.mercXY;c.x=~~(f.x/d);c.y=~~((Math.PI-f.y)/d);c.rpp=d}else COG.Log.warn("Attempted to sync an XY composite, not a GeoXY");return c}function b(c,d,f){c.pos=d;c.mercXY=posTools.toMercatorPixels(d);(f=typeof f!=="undefined"?f:c.rpp)&&a(c,f)}return{init:function(c,d){var f=T5.XY.init();b(f,c,d);return f},
sync:a,toPos:function(c,d){d=d?d:self.rpp;return posTools.fromMercatorPixels(c.x*d,Math.PI-c.y*d)},updatePos:b}}();ha.GeoVector=function(a){COG.Log.warn("The T5.Geo.GeoVector class has been deprecated, please use T5.GeoXY.init instead");return T5.GeoXY.init(a)};var ia=ha.Geo=function(){function a(r){r=parseFloat(r)*k;r=Math.sin(r);var e=z*r;return Math.log((1+r)/(1-r)*Math.pow((1-e)/(1+e),z))/2}function b(r){return parseFloat(r)*k}function c(r){r=Math.pow(Math.E,-r);for(var e=la-2*Math.atan(r),j=
g(e,r),m=0;m<w&&Math.abs(e-j)>u;){e=j;j=g(e,r);m++}return j*q}function d(r){return r%360*q}function f(r,e){var j=null;for(var m in engines)if(e){if(m==e&&engines[m][r]){j=engines[m];break}}else if(engines[m][r]){j=engines[m];break}return j}function g(r,e){var j=z*Math.sin(r);return la-2*Math.atan(e*Math.pow((1-j)/(1+j),z/2))}var h=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],i=-la,o=la,l=-ba,k=Math.PI/180,q=180/Math.PI,z=0.08181919084262157,u=1.0E-7,
w=12,v=null,p={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",HWY:"HIGHWAY",MWY:"MOTORWAY"},B=function(r,e){return{lat:parseFloat(r?r:0),lon:parseFloat(e?e:0)}},s=function(){var r={calcDistance:function(e,j){if(r.empty(e)||r.empty(j))return 0;var m=(j.lat-e.lat)*k/2,F=(j.lon-e.lon)*k/2;m=Math.sin(m)*Math.sin(m)+Math.cos(e.lat*k)*Math.cos(j.lat*k)*Math.sin(F)*Math.sin(F);return 6371*2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m))},copy:function(e){return e?new B(e.lat,e.lon):null},
empty:function(e){return!e||e.lat===0&&e.lon===0},equal:function(e,j){return e&&j&&e.lat==j.lat&&e.lon==j.lon},inArray:function(e,j){for(var m=s.equal,F=j.length;F--;)if(m(e,j[F]))return true;return false},inBounds:function(e,j){var m=!(s.empty(e)||s.empty(j));return m=(m=m&&e.lat>=j.min.lat&&e.lat<=j.max.lat)&&e.lon>=j.min.lon&&e.lon<=j.max.lon},offset:function(e,j,m){var F=e.lat*k;j=F+j/6371;for(e=e.lon*k+Math.asin(Math.sin(m/6371)/Math.cos(F));j<i;)j+=Math.PI;for(;j>o;)j-=Math.PI;for(;e>ba;)e-=
2*Math.PI;return new B(j*q,e*q)},parse:function(e){if(e)if(typeof e.lat!=="undefined")return r.copy(e);else{if(e.split)for(var j=[" ",","],m=0;m<j.length;m++){var F=e.split(j[m]);if(F.length===2)return new B(F[0],F[1])}}else return new B;return null},parseArray:function(e){var j=e.length,m=Array(j);for(j=j;j--;)m[j]=r.parse(e[j]);return m},fromMercatorPixels:function(e,j){return new B(c(j),d(e))},toMercatorPixels:function(e){return T5.XY.init(b(e.lon),a(e.lat))},generalize:function(e,j,m){var F=e.length,
I=[],T=null;m||(m=250);m/=1E3;COG.Log.info("generalizing positions, must include "+j.length+" positions");for(var Q=F;Q--;)if(Q===0)I.unshift(e[Q]);else{var ea=!T||s.inArray(e[Q],j)?m:s.calcDistance(T,e[Q]);if(e[Q]&&ea>=m){I.unshift(e[Q]);T=e[Q]}}COG.Log.info("generalized "+F+" positions into "+I.length+" positions");return I},vectorize:function(e,j){var m=e.length,F=Array(m);j=T5.ex({chunkSize:500,async:true},j);if(!j.async){for(var I=m;I--;)F[I]=T5.GeoXY.init(e[I]);return F}return COG.Loopage.join({frequency:10,
execute:function(T,Q){for(var ea=0,za=j.chunkSize,ta=m;ta--;){F[ta]=T5.GeoXY.init(e[ta]);ea+=1;if(ea>za)break}m=ta;m<=0&&Q.trigger("complete",F)}})},toString:function(e){return e?e.lat+" "+e.lon:""}};return r}(),H=function(r,e){return{min:s.parse(r),max:s.parse(e)}},L=function(){var r={calcSize:function(e,j,m){var F=T5.XY.init(0,j.lat-e.lat);if(typeof m==="undefined")m=true;F.x=m&&e.lon>j.lon?360-e.lon+j.lon:j.lon-e.lon;return F},createBoundsFromCenter:function(e,j){var m=j/6371,F=e.lat*k,I=e.lon*
k,T=F-m,Q=F+m;if(T>i&&Q<o){F=Math.asin(Math.sin(m)/Math.cos(F));m=I-F;if(m<l)m+=2*Math.PI;I=I+F;if(I>ba)I-=2*Math.PI}else{T=Math.max(T,i);Q=Math.min(Q,o);m=l;I=ba}return new H(new B(T*q,m*q),new B(Q*q,I*q))},expand:function(e,j){return new H(new B(e.min.lat-j,e.min.lon-j%360),new B(e.max.lat+j,e.max.lon+j%360))},forPositions:function(e,j){var m=null,F=T5.ticks();j||(j="auto");for(var I=e.length;I--;)if(m){var T=r.calcSize(m.min,e[I],false),Q=r.calcSize(e[I],m.max,false);if(T.x<0)m.min.lon=e[I].lon;
if(T.y<0)m.min.lat=e[I].lat;if(Q.x<0)m.max.lon=e[I].lon;if(Q.y<0)m.max.lat=e[I].lat}else m=new T5.Geo.BoundingBox(e[I],e[I]);if(j){if(j=="auto"){I=r.calcSize(m.min,m.max);j=Math.max(I.x,I.y)*0.3}m=r.expand(m,j)}COG.Log.trace("calculated bounds for "+e.length+" positions",F);return m},getCenter:function(e){var j=L.calcSize(e.min,e.max);return new T5.Geo.Position(e.min.lat+j.y/2,e.min.lon+j.x/2)},getGeoHash:function(e){var j=T5.Geo.GeoHash.encode(e.min.lat,e.min.lon);e=T5.Geo.GeoHash.encode(e.max.lat,
e.max.lon);COG.Log.info("min hash = "+j+", max hash = "+e)},getZoomLevel:function(e,j){var m=r.getCenter(e),F=h[Math.min(Math.round(Math.abs(m.lat)*0.05),h.length)],I=r.calcSize(e.min,e.max);m=Math.ceil(Math.log(h[3]*j.height/I.y)/Math.log(2));F=Math.ceil(Math.log(F*j.width/I.x)/Math.log(2));return Math.min(isNaN(m)?1E3:m,isNaN(F)?1E3:F)},isEmpty:function(e){return!e||s.empty(e.min)||s.empty(e.max)},toString:function(e){return"min: "+s.toString(e.min)+", max: "+s.toString(e.max)}};return r}(),O=function(){var r=
/^(\d+).*$/,e=/(\d+)\s?\-\s?(\d+)/;return{buildingMatch:function(j,m){r.lastIndex=-1;if(r.test(j))for(var F=j.replace(r,"$1"),I=m.split(","),T=0;T<I.length;T++){e.lastIndex=-1;if(e.test(I[T])){var Q=e.exec(I[T]);if(F>=parseInt(Q[1],10)&&F<=parseInt(Q[2],10))return true}else if(F==I[T])return true}return false},normalize:function(j){if(!j)return"";j=j.toUpperCase();if(!v){var m=[];for(var F in p)m.push(F);v=RegExp("(\\s)("+m.join("|")+")(\\s|$)","i")}v.lastIndex=-1;if(m=v.exec(j))j=j.replace(v,"$1"+
p[m[2]]);return j},toString:function(j){return j.streetDetails+" "+j.location}}}(),$=function(){return{bestResults:function(r,e){e||(e=20);for(var j=r.length>0?r[0]:null,m=[],F=0;F<r.length;F++)if(j&&r[F]&&j.matchWeight-r[F].matchWeight<=e)m.push(r[F]);else break;return m}}}(),da=function(){var r={calculate:function(e){e=T5.ex({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},e);var j=T5.Geo.getEngine("route");j&&j.route(e,function(m){if(e.generalize)m.geometry=
T5.Geo.P.generalize(m.geometry,m.getInstructionPositions());if(e.map){r.createMapOverlay(e.map,m);e.autoFit&&e.map.gotoBounds(m.boundingBox)}e.success&&e.success(m)})},createMapOverlay:function(e,j){var m=e.getDimensions();m=new T5.Geo.UI.RouteOverlay({data:j,width:m.width,height:m.height});e.setLayer("route",m)},parseTurnType:function(e){for(var j=r.TurnType.Unknown,m=T5.Geo.Routing.TurnTypeRules,F=0;F<m.length;F++){m[F].regex.lastIndex=-1;var I=m[F].regex.exec(e);if(I){j=m[F].customCheck?m[F].customCheck(e,
I):m[F].turnType;break}}return j},TurnType:{Unknown:"turn-unknown",Start:"turn-none-start",Continue:"turn-none",Arrive:"turn-none-arrive",TurnLeft:"turn-left",TurnLeftSlight:"turn-left-slight",TurnLeftSharp:"turn-left-sharp",TurnRight:"turn-right",TurnRightSlight:"turn-right-slight",TurnRightSharp:"turn-right-sharp",Merge:"merge",UTurnLeft:"uturn-left",UTurnRight:"uturn-right",EnterRoundabout:"roundabout-enter",Ramp:"ramp",RampExit:"ramp-exit"},Instruction:function(e){var j=e=T5.ex({position:null,
description:"",distance:0,distanceTotal:0,time:0,timeTotal:0,turnType:null},e),m=e.description;m=m.replace(/(\w)(\/)(\w)/g,"$1 $2 $3");j.description=m;if(!e.turnType)e.turnType=r.parseTurnType(e.description);return e},RouteData:function(e){e=T5.ex({geometry:[],instructions:[],boundingBox:null},e);if(!e.boundingBox)e.boundingBox=T5.Geo.B.forPositions(e.geometry);return T5.ex({getInstructionPositions:function(){for(var j=[],m=0;m<e.instructions.length;m++)e.instructions[m].position&&j.push(e.instructions[m].position);
return j}},e)}};return r}();return{distanceToString:function(r){if(r>1E3)return~~(r/10)/100+" km";return r?r+" m":""},dist2rad:function(r){return r/6371},getEngine:function(r){for(var e=null,j=1;!e&&j<arguments.length;j++)e=f(r,arguments[j]);e=e?e:f(r);if(!e)throw Error("Unable to find GEO engine with "+r+" capability");return e},lat2pix:a,lon2pix:b,pix2lat:c,pix2lon:d,radsPerPixel:function(r){return 2*Math.PI/(256<<r)},Position:B,P:s,BoundingBox:H,B:L,Radius:function(r,e){return{distance:parseInt(r,
10),uom:e}},Address:function(r){return r=T5.ex({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},r)},A:O,GeocodeFieldWeights:{streetDetails:50,location:50},AddressCompareFns:{},Engine:function(r){if(!r.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var e=T5.ex({remove:function(){delete engines[e.id]}},r);return engines[e.id]=e},Search:$,GeoSearchResult:function(r){r=T5.ex({id:null,caption:"",resultType:"",data:null,pos:null,matchWeight:0},
r);return T5.ex(r,{toString:function(){return r.caption+(r.matchWeight?" ("+r.matchWeight+")":"")}})},LocationSearch:function(r){function e(T,Q){navigator.geolocation.clearWatch(m);m=0;if(F){clearTimeout(F);F=0}Q&&Q([T],r)}function j(T){COG.Log.info("caught location tracking error:",T)}r=T5.ex({name:"Geolocation Search",requiredAccuracy:null,searchTimeout:5E3,watch:false},r);var m=0,F=0,I=null;return new T5.Geo.GeoSearchAgent(T5.ex({execute:function(T,Q){if(navigator.geolocation&&!m){m=navigator.geolocation.watchPosition(function(ea){var za=
new T5.Geo.Position(ea.coords.latitude,ea.coords.longitude);ea=new T5.Geo.GeoSearchResult({id:1,caption:"Current Location",pos:za,accuracy:ea.coords.accuracy/1E3,matchWeight:100});if(!I||ea.accuracy<I.accuracy)I=ea;if(!r.requiredAccuracy||I.accuracy<r.requiredAccuracy)e(I,Q)},j,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3});if(r.searchTimeout)F=setTimeout(function(){I&&e(I,Q)},r.searchTimeout)}}},r))},Routing:da}}(),Bb="featurecollection",Cb="feature",ib={async:false};wa={processor:null,group:"shapes",
layerClass:wa};var Db={point:T5.ex({},wa,{processor:function(a,b,c,d){b=aa([b.coordinates],ib);if(b.length>0)if(c=d.marker(b[0],c)){a.add(c);return b.length}},group:"markers",layerClass:eb}),linestring:T5.ex({},wa,{processor:function(a,b,c,d){b=aa(b&&b.coordinates?b.coordinates:[]);return pa(a,b,c,d)}}),multilinestring:T5.ex({},wa,{processor:function(a,b,c,d){b=b&&b.coordinates?b.coordinates:[];for(var f=0,g=b.length;g--;)f+=pa(a,b[g],c,d);return f}}),polygon:T5.ex({},wa,{processor:function(a,b,c,
d){b=b&&b.coordinates?b.coordinates:[];if(b.length>0)return S(a,b[0],c,d);return 0}}),multipolygon:T5.ex({},wa,{processor:function(a,b,c,d){b=b&&b.coordinates?b.coordinates:[];for(var f=0,g=0;g<b.length;g++)f+=S(a,b[g][0],c,d);return f}})},Eb=function(a,b,c,d){function f(v,p){var B=v.processor,s=o+v.group,H=T5.ex({},v,c,{properties:p.properties});if(B){var L=u[s];if(!L){L=new v.layerClass({id:s});u[s]=L}globalLayers=u;return B(L,p.data,H,d)}return 0}function g(v,p){var B=v&&v.type?v.type.toLowerCase():
null;return B&&B===Cb?g(v.geometry,v.properties):{type:B,isCollection:B?B===Bb:false,definition:Db[B],data:v,properties:p?p:v.properties}}c=T5.ex({vectorsPerCycle:ia.VECTORIZE_PER_CYCLE,rowPreParse:null,simplify:false,layerPrefix:"geojson-"},c);d=T5.ex({marker:function(v){return new fb({xy:v})},line:function(v,p){return new gb(v,p)},poly:function(v,p){return new gb(v,T5.ex({fill:true},p))}},d);var h=c.vectorsPerCycle,i=c.rowPreParse,o=c.layerPrefix,l=0,k=0,q=null,z=0,u={},w;if(!a)return null;if(typeof a.length===
"undefined")a=[a];k=a.length;w=COG.Loopage.join({frequency:10,execute:function(v,p){var B=0,s=l;if(!q){for(;s<k;s++){var H=g(i?i(a[s]):a[s]),L=null;if(H.isCollection){z+=1;q=parse(H.data.features,function(O){q=null;for(var $ in O)u[$]=O[$]},{layerPrefix:o+z+"-"});L+=1}else if(H.definition)L=f(H.definition,H);B+=L?L:1;if(B>=h)break}l=s+1;!q&&l>=k&&p.trigger("complete")}}});w.bind("complete",function(){b&&b(u)});return w};ha.GeoJSON=function(){return{parse:function(a,b,c){return new Eb(a,b,c)}}}();
ha.Map=function(a){function b(w){try{var v=new ia.Position(w.coords.latitude,w.coords.longitude),p=w.coords.accuracy/1E3;u.trigger("locationUpdate",w,p);if(q){if(!l){l=new ia.UI.LocationOverlay({pos:v,accuracy:p});l.update(u.getTileLayer());u.setLayer("location",l)}var B=ia.B.createBoundsFromCenter(v,Math.max(p,1));u.gotoBounds(B)}else{l.pos=v;l.accuracy=p;l.update(u.getTileLayer());f(v,null,Y("sine.out"))}q=false}catch(s){COG.Log.exception(s)}}function c(w){COG.Log.info("caught location tracking error:",
w)}function d(w,v,p){u.setZoomLevel(v);La.cancelLoad();J();f(w,p)}function f(w,v,p,B){w=Ma.init(w,ia.radsPerPixel(u.getZoomLevel()));var s=u.getDimensions();u.updateOffset(w.x-s.width/2,w.y-s.height/2,p,B,v);u.trigger("wake");u.trigger("boundsChange",u.getBoundingBox());v&&typeof p==="undefined"&&v(u)}a=T5.ex({tapExtent:10,provider:null,crosshair:false,zoomLevel:0,boundsChangeThreshold:30},a);var g={NONE:0,SINGLE:1,WATCH:2},h=XY.init(),i=g.NONE,o=false,l=null,k=0,q=true,z=0;if(!a.provider)a.provider=
new ia.MapProvider;a.adjustScaleFactor=function(w){return Math.pow(2,(w<1?Math.floor:Math.ceil)(Math.log(w)))};var u=T5.ex(new rb(a),{getBoundingBox:function(){var w=u.getViewRect();return new ia.BoundingBox(Ma.toPos(XY.init(w.x1,w.y2),z),Ma.toPos(XY.init(w.x2,w.y1),z))},getCenterPosition:function(){var w=u.getViewRect();if(w){w=XY.init(w.x1+w.width/2,w.y1+w.height/2);return Ma.toPos(w,z)}return null},gotoBounds:function(w,v){var p=ia.B.getZoomLevel(w,u.getDimensions());d(ia.B.getCenter(w),p,v)},
gotoPosition:d,panToPosition:f,syncXY:function(w){return Ma.sync(w,z)},locate:function(){u.trackStart(g.SINGLE);setTimeout(u.trackCancel,1E4)},trackStart:function(w){if(navigator.geolocation&&!k){i=w?w:g.WATCH;q=true;k=navigator.geolocation.watchPosition(b,c,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3})}},trackCancel:function(){k&&navigator.geolocation&&navigator.geolocation.clearWatch(k);u.removeLayer("location");l=null;i=g.NONE;k=0},animateRoute:function(w,v,p,B){var s=u.getLayer("route");
if(s)(w=s.getAnimation(w,v,p,B))&&w.addToView(u)}});u.bind("pan",function(){i===g.SINGLE&&u.trackCancel()});u.bind("tap",function(){});u.bind("idle",function(){if(XY.absSize(XY.diff(h,u.getOffset()))>a.boundsChangeThreshold){h=XY.copy(u.getOffset());u.trigger("boundsChange",u.getBoundingBox())}});E(u,a);u.bind("zoomLevelChange",function(w,v){z=ia.radsPerPixel(v);u.triggerAll("resync",u)});COG.configurable(u,["provider"],COG.paramTweaker(a,null,{provider:function(){u.cleanup();o=false}}),true);return u};
ha.MapTileGenerator=function(a){function b(g,h){var i=h>=f.minLevel&&(!f.maxLevel||h<=f.maxLevel);COG.Log.info("new zoom level = "+h+", zoom ok = "+i);g.cancel=!i;if(i){c=h;f.reset()}}a=T5.ex({relative:true},a);var c=0,d=null,f=T5.ex(new ub(a),{minLevel:2,maxLevel:20,getTileCreatorArgs:function(g){d=g.getCenterPosition();return{zoomLevel:c,position:d}},requireRefresh:function(){return!d}});f.bind("bindView",function(g,h){if(h.getZoomLevel){c=h.getZoomLevel();h.bind("zoomLevelChange",b)}});return f};
ha.GeoPoly=function(a,b){b=T5.ex({autoParse:true},b);for(var c=Array(a.length),d=b.autoParse,f=T5.Geo.P.parse,g=a.length;g--;)c[g]=T5.GeoXY.init(d?f(a[g]):a[g]);return new T5.Poly(c,b)};ha.RouteOverlay=function(a){a=T5.ex({data:null,pixelGeneralization:8,partialDraw:false,strokeStyle:"rgba(0, 51, 119, 0.9)",waypointFillStyle:"#FFFFFF",lineWidth:4,zindex:50},a);var b=[],c=[],d=new T5.PathLayer(a);(function(){if(a.data&&a.data.instructions){for(var f=a.data.instructions,g=Array(f.length),h=f.length;h--;)g[h]=
f[h].position;T5.Geo.P.vectorize(g).bind("complete",function(i,o){c=o})}a.data&&a.data.geometry&&T5.Geo.P.vectorize(a.data.geometry).bind("complete",function(i,o){b=o;d.updateCoordinates(b,c,true)})})();return d};ha.LocationOverlay=function(a){a=T5.ex({pos:null,accuracy:null,zindex:90},a);var b=new Image,c=T5.XY.init(),d=T5.XY.init(),f=null;b.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAACIQAAAiEBPhEQkwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAG+SURBVCiRlZHNahNRAIW/O7mTTJPahLZBA1YUyriINRAE3bQIKm40m8K8gLj0CRQkO32ELHUlKbgoIu4EqeJPgtCaoBuNtjXt5LeTMZk0mbmuWiuuPLsD3+HAOUIpxf9IHjWmaUbEyWv5ROrsVULhcHP761rUfnN3Y2Otc8CIg4YT85lzuVsPP+Qupw1vpPjRCvhS9ymvV0e77x7nNj+uvADQAIQQ+uLyvdfLV9JGZi7EdEwQlqBpEJ019f0z1mo2u5Q8DMydv25lshemmj1FueZTawbs7inarqLbV7Qjab1upB9YlhWSAHLavLHZCvg1VEhN0PMU9W7At4bPVidg7CtkLLXkut+lBPD6/Ub155jJiADAHSpaLmx3ApyBQoYEUd0PBoOBkAC6+3llvda/YxgGgYL+UNHf/zN3KiExGlsvTdP0NYDkhPdWrz35ZDsBzV5wCMuQwEyFmXFeeadjzfuFQmGkAZRKpdGC/n7x+M6jqvA9Zo6FWDhlcHE+wqT93J1tP7vpOE7rrx8ALMuasPf8S12St4WmJ6bYWTUC52k8Hm8Vi0X/nwBAPp/XKpWKdF1X2LYdlMvlsToC/QYTls7DLFr/PAAAAABJRU5ErkJggg%3D%3D";
b.onload=function(){c=T5.XY.init(b.width/2,b.height/2)};var g=T5.ex(new T5.ViewLayer(a),{pos:a.pos,accuracy:a.accuracy,drawAccuracyIndicator:false,draw:function(h,i){var o=d.x-i.x,l=d.y-i.y;if(f){h.fillStyle="rgba(30, 30, 30, 0.2)";h.beginPath();h.arc(o,l,f,0,Math.PI*2,false);h.fill()}b.complete&&b.width>0&&h.drawImage(b,o-c.x,l-c.y,b.width,b.height);g.changed()},update:function(h){if(h){f=Math.floor(h.getPixelDistance(g.accuracy)*0.5);d=h.getGridXYForPosition(g.pos);g.changed()}}});g.bind("gridUpdate",
function(h,i){g.update(i)});return g};return ha}();
