if(!this.JSON)this.JSON={};
(function(){function e(k){return k<10?"0"+k:k}function l(k){a.lastIndex=0;return a.test(k)?'"'+k.replace(a,function(o){var p=d[o];return typeof p==="string"?p:"\\u"+("0000"+o.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+k+'"'}function f(k,o){var p,q,C,w,y=g,t,r=o[k];if(r&&typeof r==="object"&&typeof r.toJSON==="function")r=r.toJSON(k);if(typeof m==="function")r=m.call(o,k,r);switch(typeof r){case "string":return l(r);case "number":return isFinite(r)?String(r):"null";case "boolean":case "null":return String(r);
case "object":if(!r)return"null";g+=h;t=[];if(Object.prototype.toString.apply(r)==="[object Array]"){w=r.length;for(p=0;p<w;p+=1)t[p]=f(p,r)||"null";C=t.length===0?"[]":g?"[\n"+g+t.join(",\n"+g)+"\n"+y+"]":"["+t.join(",")+"]";g=y;return C}if(m&&typeof m==="object"){w=m.length;for(p=0;p<w;p+=1){q=m[p];if(typeof q==="string")if(C=f(q,r))t.push(l(q)+(g?": ":":")+C)}}else for(q in r)if(Object.hasOwnProperty.call(r,q))if(C=f(q,r))t.push(l(q)+(g?": ":":")+C);C=t.length===0?"{}":g?"{\n"+g+t.join(",\n"+g)+
"\n"+y+"}":"{"+t.join(",")+"}";g=y;return C}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
a=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,g,h,d={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},m;if(typeof JSON.stringify!=="function")JSON.stringify=function(k,o,p){var q;h=g="";if(typeof p==="number")for(q=0;q<p;q+=1)h+=" ";else if(typeof p==="string")h=p;if((m=o)&&typeof o!=="function"&&(typeof o!=="object"||typeof o.length!=="number"))throw Error("JSON.stringify");return f("",
{"":k})};if(typeof JSON.parse!=="function")JSON.parse=function(k,o){function p(C,w){var y,t,r=C[w];if(r&&typeof r==="object")for(y in r)if(Object.hasOwnProperty.call(r,y)){t=p(r,y);if(t!==undefined)r[y]=t;else delete r[y]}return o.call(C,w,r)}var q;k=String(k);b.lastIndex=0;if(b.test(k))k=k.replace(b,function(C){return"\\u"+("0000"+C.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(k.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){q=eval("("+k+")");return typeof o==="function"?p({"":q},""):q}throw new SyntaxError("JSON.parse");}})();
GT=function(){var e=/\$\{(.*?)\}/ig,l=Object.prototype.hasOwnProperty,f=0,b={id:"GRUNT.core",extend:function(){var a=arguments[0]||{},g=1,h=arguments.length,d=false,m,k,o,p;if(typeof a==="boolean"){d=a;a=arguments[1]||{};g=2}if(typeof a!=="object"&&!b.isFunction(a))a={};if(h===g){a=this;--g}for(;g<h;g++)if((m=arguments[g])!=null)for(k in m){o=a[k];p=m[k];if(a!==p)if(d&&p&&(b.isPlainObject(p)||b.isArray(p))){o=o&&(b.isPlainObject(o)||b.isArray(o))?o:b.isArray(p)?[]:{};a[k]=b.extend(d,o,p)}else if(p!==
undefined)a[k]=p}return a},isFunction:function(a){return toString.call(a)==="[object Function]"},isArray:function(a){return toString.call(a)==="[object Array]"},isPlainObject:function(a){if(!a||toString.call(a)!=="[object Object]"||a.nodeType||a.setInterval)return false;if(a.constructor&&!l.call(a,"constructor")&&!l.call(a.constructor.prototype,"isPrototypeOf"))return false;var g;for(g in a);return g===undefined||l.call(a,g)},isEmptyObject:function(a){for(var g in a)return false;return true},isXmlDocument:function(a){return toString.call(a)===
"[object Document]"},contains:function(a,g){var h=a,d=arguments,m=1;if(g&&b.isArray(g)){d=g;m=0}for(m=m;m<d;m++)h=h&&typeof foo[d[m]]!=="undefined";return h},newModule:function(a){a=b.extend({id:null,requires:[],parent:null},a);if(a.parent)a=b.extend({},a.parent,a);return a},toID:function(a){return a.replace(/\s/g,"-")},objId:function(a){return(a?a:"obj")+f++},formatStr:function(a){if(arguments.length<=1)return a;for(var g=arguments.length-2,h=0;h<=g;h++)a=a.replace(RegExp("\\{"+h+"\\}","gi"),arguments[h+
1]);return a},wordExists:function(a,g){var h="";if(g.toString)g=g.toString();for(var d=0;d<g.length;d++)h+=!/\w/.test(g[d])?"\\"+g[d]:g[d];return RegExp("(^|\\s|\\,)"+h+"(\\,|\\s|$)","i").test(a)},parseTemplate:function(a,g){for(var h=e.exec(a);h;){a=a.replace(h[0],GT.XPath.first(h[1],g));e.lastIndex=0;h=e.exec(a)}return a}};return b}();
GT.Log=function(){function e(g,h){var d,m=h&&h.length>0?h[0]:"";for(d=1;h&&d<h.length;d++)m+=" "+(f&&GT.isPlainObject(h[d])?JSON.stringify(h[d]):h[d]);typeof console!=="undefined"&&console[g](m);for(d=0;d<l.length;d++)l[d].call(a,m,g)}var l=[],f=typeof JSON!=="undefined",b=window.console&&window.console.markTimeline,a={id:"GRUNT.log",getTraceTicks:function(){return b?(new Date).getTime():null},trace:function(g,h){if(b)console.markTimeline(g+(h?": "+(a.getTraceTicks()-h)+"ms":""))},debug:function(){e("debug",
arguments)},info:function(){e("info",arguments)},warn:function(){e("warn",arguments)},error:function(){e("error",arguments)},exception:function(g){a.error(arguments);for(var h in g)a.info("ERROR DETAIL: "+h+": "+g[h])},watch:function(g,h){try{h()}catch(d){a.exception(d,g)}},throwError:function(g){a.error(g);throw Error(g);},requestUpdates:function(g){l.push(g)}};return a}();
(function(){function e(f,b){var a=f.split("|"),g={};for(var h in b){var d=b[h];g[h]=a.length>d?a[d]:null}return g}var l={JSON:{parse:function(f){return JSON.parse(f)}},PDON:{parse:function(f){var b=null,a=[];f=f.split("\n");for(var g=0;g<f.length;g++){var h=f[g];if(b)a.push(e(h,b));else if(h){b=h.split("|");h={};for(var d=0;d<b.length;d++)h[b[d]]=d;b=h}else b=null}return a}}};GT.parseData=function(f,b){b=b?b.toUpperCase():"JSON";if(!l[b])throw Error("Unsupported data format: "+b);try{return l[b].parse(f)}catch(a){GT.Log.exception(a)}return{}}})();
(function(){function e(b,a){b[a]||(b[a]=function(g){return b.configure(a,g)})}function l(b){b.gtConfId=GT.objId("configurable");b.gtConfig={};b.gtConfigFns=[];return b.gtConfig}var f={};GT.paramTweaker=function(b,a,g){return function(h,d){if(typeof d!=="undefined"){if(h in b)b[h]=d;g&&h in g&&g[h](h,d)}else return a&&h in a?a[h](h):b[h]}};GT.configurable=function(b,a,g,h){if(b){b.gtConfId||l(b);var d=b.gtConfId,m=b.gtConfig,k=b.gtConfigFns;f[d]=b;k.push(g);for(g=a.length;g--;){m[a[g]]=true;h&&e(b,
a[g])}if(!b.configure)b.configure=function(o,p){if(m[o]){for(var q=k.length;q--;){var C=k[q](o,p);if(typeof C!=="undefined")return C}return f[d]}return null}}}})();
(function(){function e(a){var g=document.createElement("script"),h=false;g.src=a;g.async=true;g.onload=g.onreadystatechange=function(){if(!h&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){h=true;g.onload=g.onreadystatechange=null;g&&g.parentNode&&g.parentNode.removeChild(g)}};f||(f=document.getElementsByTagName("head")[0]);f.appendChild(g)}var l=0,f,b=this;GT.jsonp=function(a,g,h){a+=a.indexOf("?")>=0?"&":"?";var d="json"+ ++l;b[d]=function(m){g(m);b[d]=null;try{delete b[d]}catch(k){}};
e(a+(h?h:"callback")+"="+d);return d}})();
(function(){function e(d){var m=[],k=function(p,q){q=GT.isFunction(q)?q():q;m[m.length]=encodeURIComponent(p)+"="+encodeURIComponent(q)};if(GT.isArray(d))for(var o=0;o<d.length;o++)k(d[o].name,d[o].value);else for(o in d)k(o,d[o]);return m.join("&").replace(/%20/g,"+")}var l={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},f={JSON:["json"],PDON:["pdon.txt"]},b=["TEXT","STREAM"],a=/^(\w+:)?\/\/([^\/?#]+)/,g={XML:function(d){return d.responseXML},JSON:function(d){return GT.parseData(d.responseText)},
PDON:function(d){return GT.parseData(d.responseText,"PDON")},DEFAULT:function(d){return d.responseText}},h={CONTENT_TYPE:"Content-Type"};GT.xhr=function(d){function m(){if(this.readyState===4){var q=null,C=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(C)if(d.handleResponse)d.handleResponse(this);else{var w=d,y=this.getResponseHeader(h.CONTENT_TYPE),t,r=false;for(t in l)if(y&&y.indexOf(l[t])>=0){r=true;break}y=
!r;for(r=0;r<b.length;r++)y=y||b[r]==t;if(y)b:{y=t;for(var E in f)for(r=0;r<f[E].length;r++)if(RegExp(f[E][r]+"$","i").test(w.url)){t=E;break b}t=y?y:"DEFAULT"}try{q=g[t](this,w)}catch(u){q=g.DEFAULT(this,w)}}else d.error&&d.error(this)}catch(n){GT.Log.exception(n,"PROCESSING AJAX RESPONSE")}C&&q&&d.success&&d.success.call(this,q)}}try{d=GT.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},d);var k=a.exec(d.url),
o=k&&(k[1]&&k[1]!==location.protocol||k[2]!==location.host);if(d.data)d.method="POST";if(d.url){k=null;if(d.xhr)k=d.xhr(d);k||(k=new XMLHttpRequest);k.open(d.method,d.url,d.async);d.data&&k.setRequestHeader("Content-Type",d.contentType);o||k.setRequestHeader("X-Requested-With","XMLHttpRequest");k.onreadystatechange=m;k.send(d.method=="POST"?e(d.data):null)}else GT.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(p){GT.Log.exception(p)}}})();
GT.XPath=function(){function e(a){for(var g=null,h=0;h<l.length;h++)if(g=l[h](a))break;return g}var l=[],f=[null,function(a){return a.numberValue},function(a){return a.stringValue},function(a){return a.booleanValue},null,null,null,null,function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null},function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||GT.Log.warn("No XPATH support");var b={SearchResult:function(a){return{toString:function(){var g=
null;if(a){var h=null;if(a.resultType>=0&&a.resultType<f.length)h=f[a.resultType];if(h)g=h(a)}return g?g:""}}},first:function(a,g){var h=b.SearchResult,d;var m=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!m)m=XPathResult.ANY_TYPE;try{if(GT.isXmlDocument(g))d=g.evaluate(a,g,e,m,null);else{GT.Log.warn("attempted xpath expression: "+a+" on a non-xml document");d=null}}catch(k){GT.Log.warn("invalid xpath expression: "+a+" on node: "+g);d=null}return new h(d)},registerResolver:function(a){l.push(a)}};return b}();
(function(){function e(l,f){var b=l.gtObsHandlers;b[f]||(b[f]=[]);return b[f]}GT.observable=function(l){if(l){if(!l.gtObsHandlers)l.gtObsHandlers={};if(!(l.bind||l.trigger||l.unbind)){l.bind=function(f,b){var a=GT.objId("callback");e(l,f).push({fn:b,id:a});return a};l.trigger=function(f){var b=e(l,f);if(!b)return l;for(var a=b.length;a--;)b[a].fn.apply(self,Array.prototype.slice.call(arguments,1));return l};l.unbind=function(f,b){for(var a=e(l,f),g=0;a&&g<a.length;g++)if(a[g].id===b){a.splice(g,1);
break}return l}}}}})();(function(){var e={},l=[];GT.addPipe=function(f){f("pipe.test",{});l.push(f)};GT.listen=function(f,b){e[f]||(e[f]=[]);b&&e[f].push(b)};GT.say=function(f,b){var a;for(a=l.length;a--;)l[a](f,b);if(e[f])for(a=e[f].length;a--;)e[f][a](b)}})();
GT.Storage=function(){function e(l){if(l&&l=="session")return sessionStorage;return localStorage}return{get:function(l,f){var b=e(f).getItem(l);return/^(\{|\[).*(\}|\])$/.test(b)?JSON.parse(b):b},set:function(l,f,b){f=jQuery.isArray(f)||jQuery.isPlainObject(f)?JSON.stringify(f):f;e(b).setItem(l,f)},remove:function(l,f){e(f).removeItem(l)}}}();
GT.ParseRules=function(){var e=[];return{add:function(l,f){e.push({regex:l,handler:f})},each:function(l,f,b){function a(){g++;b&&g>=e.length&&b(f)}for(var g=0,h=0;h<e.length;h++){var d=e[h].regex,m=e[h].handler,k=false;if(d){d.lastIndex=-1;if((d=d.exec(l))&&m){k=true;m(d,f,a)&&a()}}k||a()}}}};
T5=function(){var e=function(h,d){return{x:h?h:0,y:d?d:0}},l=function(){function h(d){if(!d||d.length<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var m={edges:Array(d.length-1),accrued:Array(d.length-1),total:0},k=l.diff,o=0;o<d.length-1;o++){var p=k(d[o],d[o+1]);m.edges[o]=Math.sqrt(p.x*p.x+p.y*p.y);m.accrued[o]=m.total+m.edges[o];m.total+=m.edges[o]}return m}return{create:function(d,m){return new e(d,m)},add:function(){for(var d=new e,m=arguments.length;m--;){d.x+=
arguments[m].x;d.y+=arguments[m].y}return d},absSize:function(d){return Math.max(Math.abs(d.x),Math.abs(d.y))},diff:function(d,m){return new e(d.x-m.x,d.y-m.y)},copy:function(d){return d?new e(d.x,d.y):null},invert:function(d){return new e(-d.x,-d.y)},offset:function(d,m,k){return new e(d.x+m,d.y+(k?k:m))},edges:h,distance:function(d){return h(d).total},theta:function(d,m,k){k=Math.asin((d.y-m.y)/k);return d.x>m.x?k:Math.PI-k},pointOnEdge:function(d,m,k,o){m=new e(Math.cos(k)*o,Math.sin(k)*o);return new e(d.x-
m.x,d.y-m.y)},getRect:function(d){var m=d.length;if(m>1)return new f(Math.min(d[0].x,d[m-1].x),Math.min(d[0].y,d[m-1].y),Math.abs(d[0].x-d[m-1].x),Math.abs(d[0].y-d[m-1].y))},toString:function(d){return d.x+", "+d.y}}}(),f=function(h,d,m,k){return{origin:new e(h,d),dimensions:new a(m,k)}},b=function(){return{copy:function(h){return h?new f(h.origin.x,h.origin.y,h.dimensions.width,h.dimensions.height):null},getCenter:function(h){return new e(h.origin.x+h.dimensions.width/2,h.origin.y+h.dimensions.height/
2)}}}(),a=function(h,d){return{width:h?h:0,height:d?d:0}},g=function(){return{getAspectRatio:function(h){return h.height!==0?h.width/h.height:1},getCenter:function(h){return new e(h.width/2,h.height/2)},getSize:function(h){return Math.sqrt(Math.pow(h.width,2)+Math.pow(h.height,2))}}}();return{ex:GT.extend,newCanvas:function(h,d){var m=document.createElement("canvas");typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(m);m.width=h?h:0;m.height=d?d:0;return m},time:function(){return(new Date).getTime()},
Vector:e,V:l,Dimensions:a,D:g,Rect:f,R:b}}();
(function(){function e(){for(;o.length>0;){var q=o.shift();document.location=q}k=0}function l(q){for(var C=true,w=p.length;w--;)C=C&&q!=p[w];return C}function f(q,C){var w=[];for(var y in C)y&&w.push(y+"="+escape(C[y]));return"tile5://"+q+"/"+(w.length>0?"?"+w.join("&"):"")}function b(q,C){l(q)&&GT.Log.info("would push url: "+f(q,C))}function a(q,C){if(l(q)){o.push(f(q,C));k||(k=setTimeout(e,100))}}function g(){h={base:{name:"Unknown",eventTarget:document,supportsTouch:"createTouch"in document,imageCacheMaxSize:null,
getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:b,targetFps:null},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:a,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:a},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:a},android:{name:"Android OS <= 2.1",regex:/android/i,eventTarget:document.body,supportsTouch:true,getScaling:function(){return 1/
window.devicePixelRatio},bridgeNotify:a},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:a}};d=[h.froyo,h.android,h.ipod,h.iphone,h.ipad]}var h=null,d=[],m=null,k=0,o=[],p=["view.wake","tile.loaded"];T5.getConfig=function(){h||g();if(!m){GT.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var q=0;q<d.length;q++){var C=d[q];if(C.regex&&C.regex.test(navigator.userAgent)){m=T5.ex({},h.base,C);GT.Log.info("PLATFORM DETECTED AS: "+
m.name);break}}if(!m){GT.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");m=h.base}GT.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return m}})();
T5.Resources=function(){var e="",l={},f={getPath:function(b){return/^(file|https?|\/)/.test(b)?b:e+b},setBasePath:function(b){e=b},loadResource:function(b){b=T5.ex({filename:"",cacheable:true,dataType:null,callback:null},b);var a=function(g){b.callback&&GT.Log.watch("CALLING RESOURCE CALLBACK",function(){b.callback(g)})};b.cacheable&&l[b.filename]?a(l[b.filename]):GT.xhr({url:f.getPath(b.filename),dataType:b.dataType,success:function(g){if(b.cacheable)l[b.filename]=g;a(g)},error:function(g,h,d){GT.Log.error("error loading resource ["+
b.filename+"], error = "+d)}})},loadSnippet:function(b,a){/\.\w+$/.test(b)||(b+=".html");f.loadResource({filename:"snippets/"+b,callback:a,dataType:"html"})}};return f}();
T5.Images=function(){function e(){var w=g[this.id];if(w&&w.image.complete&&w.image.width>0){w.loaded=true;w.hitCount=1;for(var y=m.length;y--;)if(m[y].image.src==this.src){m.splice(y,1);break}if(w.background||w.postProcess)if(w.image){y=T5.newCanvas(w.realSize?w.realSize.width:image.width,w.realSize?w.realSize.height:image.height);var t=y.getContext("2d"),r=w.offset?w.offset:new T5.Vector;w.background&&t.drawImage(w.background,0,0);t.drawImage(w.image,r.x,r.y);w.postProcess&&w.postProcess(t,w);w.image=
y}w.loadCallback&&w.loadCallback(this,false);k.push({url:this.src,created:w.requested});delete g[this.id];l()}}function l(){for(var w=T5.getConfig().maxImageLoads;d.length>0&&(!w||m.length<w);){var y=d.shift();if(y.imageLoader){m.push(y);y.imageLoader(y,e)}}}function f(w){for(var y=null,t=o.length;t--&&!y;)y=o[t](w);return y?y:function(r,E){r.image.onload=E;r.image.src=T5.Resources.getPath(r.url);r.requested=T5.time()}}function b(){q=true;try{var w=Math.floor(k.length/2);if(w>0){k.sort(function(t,
r){return t.created-r.created});for(var y=w;y--;)delete a[k[y].url];k.splice(0,w)}}finally{q=false}GT.say("imagecache.cleared")}var a={},g={},h=0,d=[],m=[],k=[],o=[],p=0,q=false,C={avgImageSize:25,loadTimeout:10,addInterceptor:function(w){o.push(w)},cancelLoad:function(){m=[]},get:function(w){var y=null,t=null;q||(y=a[w]);if((t=y?y.image:null)&&(t.getContext||t.complete&&t.width>0))return t},load:function(w,y,t){var r=a[w];if(r){r.hitCount++;r.image.complete&&y&&y(r.image,true)}else{r=T5.ex({url:w,
image:new Image,loaded:false,imageLoader:f(w),created:T5.time(),requested:null,hitCount:0,loadCallback:y},t);r.image.id="resourceLoaderImage"+h++;a[w]=r;g[r.image.id]=r;d.push(r);l()}return r},stats:function(){return{imageLoadingCount:m.length,queuedImageCount:d.length,imageCacheFullness:p}}};setInterval(function(){for(var w=T5.time(),y=false,t=0,r=T5.getConfig();t<m.length;)if(w-m[t].requested>C.loadTimeout*1E3){m.splice(t,1);y=true}else t++;y&&l();if(r&&r.imageCacheMaxSize){p=k.length*C.avgImageSize/
r.imageCacheMaxSize;p>=1&&b()}},1E3);return C}();
(function(){function e(n,v){var s=n&&n.length>0?n[0]:null;if(s&&v&&v.length>0)return r(s,v[0]);return null}function l(n){n.preventDefault();n.stopPropagation()}function f(n){for(var v=Array(n.length),s=n.length;s--;)v[s]=y(n[s].pageX,n[s].pageY);return v}var b=120,a=100,g=250,h=300,d=5,m=2,k=0,o=1,p=2,q=7,C=0,w=0,y=T5.V.create,t=T5.V.distance,r=T5.V.diff,E=function(n){function v(G,J,B,F){var K=Math.asin((G.y-J.y)/B);B=Math.min(Math.floor(B*(Z.duration/F)),Z.max);K=J.x>G.x?K:Math.PI-K;G=y(Math.cos(K)*
-B,Math.sin(K)*B);A("inertiaPan",G.x,G.y)}function s(G,J){var B,F;if(Q){B=J-$;if(B<g){F=t([P[0],G]);F>n.inertiaTrigger&&v(P[0],G,F,B)}}else{aa=G;var K=setInterval(function(){B=T5.time()-J;F=t([G,aa]);if(B<a&&F>n.inertiaTrigger){clearInterval(K);v(G,aa,F,B)}else B>a&&clearInterval(K)},5)}}function x(G){for(var J=[],B=S?-S.offsetLeft:0,F=S?-S.offsetTop:0,K=G.length;K--;)J.push(T5.V.offset(G[K],B,F));return J}function A(){ha&&ha.trigger.apply(null,arguments)}function D(G){if(G.target&&G.target===S){P=
Q?f(G.touches):[y(G.pageX,G.pageY)];V=y();U=y();da=true;L=false;$=T5.time();l(G);G.target.style.cursor="move";A("inertiaCancel");ga=$;if(G=P.length>0?P[0]:null){A("touchStart",G.x,G.y);if(ga-ba<h)if((G=X?T5.V.diff(P[0],X[0]):null)&&Math.abs(G.x)<n.maxDistDoubleTap&&Math.abs(G.y)<n.maxDistDoubleTap)L=true;N=k;X=[].concat(P)}else GT.Log.warn("Touch start fired, but no touch vector found")}}function z(G){if(G.target&&G.target===S){aa=(Q?f(G.touches):[y(G.pageX,G.pageY)])[0];if(da){Q&&l(G);G=Q?f(G.touches):
[y(G.pageX,G.pageY)];var J=0;if(G.length>1){if(P.length===1)P=[].concat(G);J=t(P)-t(G)}if(N===k){var B=e(G,P);if(B&&(Math.abs(B.x)>=q||Math.abs(B.y)>=q))N=o}if(N!==k)if(!J||Math.abs(J)<d){if(V=e(G,X)){U.x-=V.x;U.y-=V.y;Y.x-=V.x;Y.y-=V.y}if(T5.V.absSize(Y)>m){A("pan",Y.x,Y.y);Y=y()}N=o}else{A("pinchZoom",x(P),x(G));N=p}X=[].concat(G)}}}function H(G){if(G.target&&G.target===S){var J=(Q?f(G.changedTouches):[y(G.pageX,G.pageY)])[0];Q&&l(G);var B=T5.time();ba=ga;if(N===k)R||(R=setTimeout(function(){R=
0;var F=L?"doubleTap":"tap",K=P[0],O=null;if(S)O=T5.V.offset(K,-S.offsetLeft,-S.offsetTop);A(F,K,O)},h+50));else if(N==o){A("panEnd",U.x,U.y);Z&&s(J,B)}else N==p&&A("pinchZoomEnd",x(P),x(X),B-$);G.target.style.cursor="default";da=false}}function I(G){if(G.target&&G.target===S){var J;if(G.detail){J=-G.detail*b;J=y(G.axis===1?J:0,G.axis===2?J:0)}else J=y(G.wheelDeltaX,G.wheelDeltaY);var B=J.y!==0?Math.abs(J.y/b):0;if(aa&&B!==0){var F=T5.V.offset(aa,-S.offsetLeft,-S.offsetTop);A("wheelZoom",F,Math.pow(2,
J.y>0?B:-B))}G.preventDefault()}}n=T5.ex({element:null,observable:null,inertiaTrigger:20,maxDistDoubleTap:20,touchStartHandler:null,moveHandler:null,moveEndHandler:null,pinchZoomHandler:null,pinchZoomEndHandler:null,tapHandler:null,doubleTapHandler:null,wheelZoomHandler:null},n);var L=false,R=0,M=T5.getConfig(),Q=T5.getConfig().supportsTouch,P=null,X=null,V=null,U=null,Y=y(),N=null,da=false,$=0,W=[],aa=null,Z=null,ga=0,ba=0,S=n.element,ha=n.observable,ja={supportsTouch:Q,addListeners:function(G){W.push(G)},
decoupleListeners:function(G){for(var J=0;G&&J<W.length;J++)if(W[J].listenerId===G){W.splice(J,1);break}},release:function(){M.eventTarget.removeEventListener(Q?"touchstart":"mousedown",D,false);M.eventTarget.removeEventListener(Q?"touchmove":"mousemove",z,false);M.eventTarget.removeEventListener(Q?"touchend":"mouseup",H,false);if(!Q){window.removeEventListener("mousewheel",I,false);window.removeEventListener("DOMMouseScroll",I,false)}},inertiaEnable:function(G,J){Z={duration:G,max:J?Math.min(J.width,
J.height):500}},inertiaDisable:function(){Z=null}};M.eventTarget.addEventListener(Q?"touchstart":"mousedown",D,false);M.eventTarget.addEventListener(Q?"touchmove":"mousemove",z,false);M.eventTarget.addEventListener(Q?"touchend":"mouseup",H,false);if(!Q){window.addEventListener("mousewheel",I,false);window.addEventListener("DOMMouseScroll",I,false)}return ja},u=[];T5.captureTouch=function(n,v){if(!n)throw Error("Unable to capture touch of null element");if(!n.id)n.id="touchable_"+C++;var s=u[n.id];
if(!s){s=new E(T5.ex({element:n},v));u[n.id]=s}v.listenerId&&s.decoupleListeners(v.listenerId);v.listenerId=++w;s.addListeners(v);return s};T5.resetTouch=function(n){if(n&&n.id&&u[n.id]){u[n.id].release();delete u[n.id]}}})();
T5.Dispatcher=function(){var e=[],l={execute:function(f){var b=l.findAction(f);b&&b.execute.apply(b,Array.prototype.slice.call(arguments,1))},findAction:function(f){for(var b=e.length;b--;)if(e[b].id==f)return e[b];return null},getRegisteredActions:function(){return[].concat(e)},getRegisteredActionIds:function(){for(var f=[],b=e.length;b--;)e[b].id&&f.push(e[b].id);return f},registerAction:function(f){f&&f.id&&e.push(f)},Action:function(f){f=T5.ex({autoRegister:true,id:"",title:"",icon:"",execute:null},
f);var b={id:f.id,execute:function(){f.execute&&f.execute.apply(this,arguments)},getParam:function(a){return f[a]?f[a]:""},toString:function(){return GT.formatStr("{0} [title = {1}, icon = {2}]",b.id,f.title,f.icon)}};f.autoRegister&&l.registerAction(b);return b},Agent:function(f){f=GT.extend({name:"Untitled",translator:null,execute:null},f);var b={getName:function(){return f.name},getParam:function(a){return f[a]},getId:function(){return GT.toID(b.getName())},run:function(a,g){if(f.execute){var h=
f.translator?f.translator(a):a;f.execute.call(b,h,function(d,m){g&&g(d,m,h)})}}};return b},runAgents:function(f,b,a){for(var g=0;g<f.length;g++)f[g].run(b,a)}};return l}();
(function(){var e=Math.PI*2,l=Math.PI/2,f=Math.abs,b=Math.pow,a=Math.sin,g=Math.asin,h=Math.cos,d=1.70158,m={linear:function(k,o,p,q){return p*k/q+o},backin:function(k,o,p,q){return p*(k/=q)*k*((d+1)*k-d)+o},backout:function(k,o,p,q){return p*((k=k/q-1)*k*((d+1)*k+d)+1)+o},backinout:function(k,o,p,q){return(k/=q/2)<1?p/2*k*k*(((d*=1.525)+1)*k-d)+o:p/2*((k-=2)*k*(((d*=1.525)+1)*k+d)+2)+o},bouncein:function(k,o,p,q){return p-m.bounceout(q-k,0,p,q)+o},bounceout:function(k,o,p,q){return(k/=q)<1/2.75?
p*7.5625*k*k+o:k<2/2.75?p*(7.5625*(k-=1.5/2.75)*k+0.75)+o:k<2.5/2.75?p*(7.5625*(k-=2.25/2.75)*k+0.9375)+o:p*(7.5625*(k-=2.625/2.75)*k+0.984375)+o},bounceinout:function(k,o,p,q){return k<q/2?m.bouncein(k*2,0,p,q)/2+o:m.bounceout(k*2-q,0,p,q)/2+p/2+o},cubicin:function(k,o,p,q){return p*(k/=q)*k*k+o},cubicout:function(k,o,p,q){return p*((k=k/q-1)*k*k+1)+o},cubicinout:function(k,o,p,q){if((k/=q/2)<1)return p/2*k*k*k+o;return p/2*((k-=2)*k*k+2)+o},elasticin:function(k,o,p,q,C,w){if(k==0)return o;if((k/=
q)==1)return o+p;w||(w=q*0.3);if(!C||C<f(p)){C=p;p=w/4}else p=w/e*g(p/C);return-(C*b(2,10*(k-=1))*a((k*q-p)*e/w))+o},elasticout:function(k,o,p,q,C,w){var y;if(k==0)return o;if((k/=q)==1)return o+p;w||(w=q*0.3);if(!C||C<f(p)){C=p;y=w/4}else y=w/e*g(p/C);return C*b(2,-10*k)*a((k*q-y)*e/w)+p+o},elasticinout:function(k,o,p,q,C,w){var y;if(k==0)return o;if((k/=q/2)==2)return o+p;w||(w=q*0.3*1.5);if(!C||C<f(p)){C=p;y=w/4}else y=w/e*g(p/C);if(k<1)return-0.5*C*b(2,10*(k-=1))*a((k*q-y)*e/w)+o;return C*b(2,
-10*(k-=1))*a((k*q-y)*e/w)*0.5+p+o},quadin:function(k,o,p,q){return p*(k/=q)*k+o},quadout:function(k,o,p,q){return-p*(k/=q)*(k-2)+o},quadinout:function(k,o,p,q){if((k/=q/2)<1)return p/2*k*k+o;return-p/2*(--k*(k-2)-1)+o},sinein:function(k,o,p,q){return-p*h(k/q*l)+p+o},sineout:function(k,o,p,q){return p*a(k/q*l)+o},sineinout:function(k,o,p,q){return-p/2*(h(Math.PI*k/q)-1)+o}};T5.easing=function(k){return m[k.replace(/[\-\_\s\.]/g,"").toLowerCase()]};T5.registerEasingType=function(k,o){m[k.replace(/[\-\_\s\.]/g,
"").toLowerCase()]=o}})();
T5.Tween=function(e){e=T5.ex({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:T5.easing("sine.out"),complete:null,cancelOnInteract:false},e);var l=T5.time(),f=[],b=false,a=0,g=0,h={cancelOnInteract:e.cancelOnInteract,isComplete:function(){return b},triggerComplete:function(d){e.complete&&e.complete(d)},update:function(d){try{var m=e.tweenFn(d-l,a,g,e.duration);if(e.target)e.target[e.property]=m;for(var k=f.length;k--;)f[k](m,void 0);if(b=l+e.duration<=d){if(e.target)e.target[e.property]=
e.tweenFn(e.duration,a,g,e.duration);for(var o=f.length;o--;)f[o](m,true)}}catch(p){GT.Log.exception(p)}},requestUpdates:function(d){f.push(d)}};a=e.target&&e.property&&e.target[e.property]?e.target[e.property]:e.startValue;if(typeof e.endValue!=="undefined")g=e.endValue-a;if(g==0)b=true;T5.wakeTweens();return h};
(function(){var e=[],l=false,f=0;T5.tweenValue=function(b,a,g,h,d){b=new T5.Tween({startValue:b,endValue:a,tweenFn:g,complete:h,duration:d});e.push(b);return b};T5.tween=function(b,a,g,h,d,m){b=new T5.Tween({target:b,property:a,endValue:g,tweenFn:h,duration:m,complete:d});e.push(b);return b};T5.tweenVector=function(b,a,g,h,d,m){var k=[];if(b){var o=b.x==a,p=b.y==g;o||k.push(T5.tween(b,"x",a,h,function(){(o=true)&&p&&d()},m));p||k.push(T5.tween(b,"y",g,h,function(){p=true;o&&p&&d()},m))}return k};
T5.cancelAnimation=function(b){if(!l){l=true;try{for(var a=0;a<e.length;)if(!b||b(e[a])){e[a].triggerComplete(true);e.splice(a,1)}else a++}finally{l=false}}};T5.isTweening=function(){return e.length>0};T5.wakeTweens=function(){if(f===0)f=setInterval(function(){var b;b=T5.time();if(!l){l=true;try{for(var a=0;a<e.length;)if(e[a].isComplete()){e[a].triggerComplete(false);e.splice(a,1)}else{e[a].update(b);a++}}finally{l=false}}b=e.length;if(b===0){clearInterval(f);f=0}},20)}})();
(function(){var e={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,PINCH:16,FREEZE:128};T5.viewState=function(){for(var l=0,f=arguments.length;f--;){var b=e[arguments[f].toUpperCase()];if(b)l|=b}return l}})();
T5.ViewLayer=function(e){e=T5.ex({id:"",zindex:0,supportFastDraw:false,validStates:T5.viewState("ACTIVE","ANIMATING","PAN","PINCH")},e);var l=null,f=e.id,b=T5.viewState("ACTIVE"),a=T5.ex({addToView:function(g){g.setLayer(f,a)},shouldDraw:function(g){var h=l?l.fastDraw&&g!==b:false;return(g&e.validStates)!==0&&(h?e.supportFastDraw:true)},cycle:function(){return 0},draw:function(){},remove:function(){GT.say("layer.remove",{id:f})},wakeParent:function(){l&&l.trigger("wake")},getId:function(){return f},
setId:function(g){f=g},getParent:function(){return l},setParent:function(g){l=g}},e);GT.observable(a);return a};
T5.View=function(e){function l(B,F,K,O){I=typeof K!=="undefined";S=ga;t();J.updateOffset(n.x+B,n.y+F,K,O)}function f(B,F){e.inertia&&l(B,F,e.panAnimationEasing,e.panAnimationDuration)}function b(){S=Z;I=false;setTimeout(t,50)}function a(B,F){U=ha(B);Y=ha(F);var K=ja(U.dimensions),O=ja(Y.dimensions);W=G(U);z=G(Y);N=U&&K!==0?O/K:1}function g(B,F){a(B,F);if(V=N!==1){S=ba;t()}}function h(B,F,K){a(B,F);if(e.adjustScaleFactor){N=e.adjustScaleFactor(N);GT.Log.info("scale factor adjusted to: "+N)}if(K<e.pinchZoomAnimateTrigger){p(da,
N,W,q(),T5.easing("sine.out"),function(){m();N=1},300);N=da}else{m();N=1}}function d(B,F){J.zoom(B,Math.min(Math.pow(2,Math.round(Math.log(F))),8),500)}function m(){V=false;J.trigger("scale",N,U?q():z);S=Z;t()}function k(){if(E){T5.resetTouch(E);if(e.autoSize){E.height=window.innerHeight-E.offsetTop;E.width=window.innerWidth-E.offsetLeft}try{u=E.getContext("2d");u.globalCompositeOperation="source-over";u.clearRect(0,0,E.width,E.height)}catch(B){GT.Log.exception(B);throw Error("Could not initialise canvas on specified view element");
}aa=T5.captureTouch(E,{observable:J});e.inertia&&aa.inertiaEnable(e.panAnimationDuration,A);A=J.getDimensions();for(var F=r.length;F--;)layerContextChange(r[F]);t()}}function o(B,F){F.setId(B);F.added=T5.time();F.trigger("contextChanged",u);F.setParent(J);r.push(F);r.sort(function(K,O){var T=O.zindex-K.zindex;if(T===0)T=O.added-K.added;return T})}function p(B,F,K,O,T,ca,ea){function ia(){ca&&ca();m();N=1;$=null}V=true;W=T5.V.copy(K);z=T5.V.copy(O);U=null;if(T)T5.tweenValue(0,F-B,T,ia,ea?ea:1E3).requestUpdates(function(fa){$=
fa/(F-B);N=B+fa;S=ba;t();J.trigger("animate")});else{N=targetScaleFactor;ia()}}function q(){var B=T5.D.getCenter(A),F=T5.V.distance([z,B]),K=T5.V.theta(z,B,F),O=T5.V.diff(W,z);B=T5.V.pointOnEdge(z,B,K,F/N);B.x+=O.x;B.y+=O.y;return B}function C(){J.trigger("idle");H=true;M=0}function w(B,F){var K=0,O=s?T5.viewState("FROZEN"):S,T=T5.time(),ca=(O&ba)!==0,ea=0;if(v||ca){B.clearRect(0,0,E.width,E.height);v=false}if(ca){T5.D.getCenter(A);var ia=($?$:1)/2,fa=T5.V.diff(W,z);if(P=U?new T5.Vector(z.x+fa.x,
z.y+fa.y):new T5.Vector(z.x-fa.x*ia,z.y-fa.y*ia))F=T5.V.offset(F,P.x,P.y)}B.save();try{da=N;if(x!==1)B.scale(x,x);else if(ca){B.translate(z.x,z.y);B.scale(N,N)}for(ea=r.length;ea--;)if(r[ea].shouldDraw(O)){var ka=r[ea].draw(B,F,A,O,J);K+=ka?ka:0}}finally{B.restore()}GT.Log.trace("draw complete",T);R=false;return K}function y(){var B=0,F=!I&&(S===ba||S===ga);X=T5.time();n.x=Math.floor(n.x);n.y=Math.floor(n.y);if(F){T5.cancelAnimation(function(O){return O.cancelOnInteract});H=false;if(M!==0){clearTimeout(M);
M=0}}for(F=r.length;F--;){var K=r[F].cycle(X,n,S);B+=K?K:0}B+=w(u,n);L=0;if(D+B>0)t();else if(!H&&M===0)M=setTimeout(C,500);GT.Log.trace("Completed draw cycle",X)}function t(){D++;if(!(s||L!==0)){D=0;L=setTimeout(y,0)}}e=T5.ex({id:GT.objId("view"),container:"",fastDraw:false,inertia:true,pannable:true,scalable:true,panAnimationEasing:T5.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:false},e);var r=[],E=document.getElementById(e.container),
u=null,n=new T5.Vector,v=false,s=false,x=1,A=null,D=0,z=null,H=false,I=false,L=0,R=false,M=0,Q=0,P=null,X=0,V=false,U=null,Y=null,N=1,da=1,$=null,W=null,aa=null,Z=T5.viewState("ACTIVE"),ga=T5.viewState("PAN"),ba=T5.viewState("PINCH"),S=Z,ha=T5.V.getRect,ja=T5.D.getSize,G=T5.R.getCenter,J={id:e.id,deviceScaling:x,fastDraw:e.fastDraw||T5.getConfig().requireFastDraw,animate:function(B,F,K,O,T){p(N,B,F,K,O,T)},centerOn:function(B){J.setOffset(B.x-E.width/2,B.y-E.height/2)},getDimensions:function(){if(E)return new T5.Dimensions(E.width,
E.height)},getZoomCenter:function(){return P},getLayer:function(B){for(var F=0;F<r.length;F++)if(r[F].getId()==B)return r[F];return null},setLayer:function(B,F){for(var K=0;K<r.length;K++)if(r[K].getId()===B){r.splice(K,1);break}F&&o(B,F);t()},eachLayer:function(B){for(var F=0;F<r.length;F++)B(r[F])},clearBackground:function(){v=true},freeze:function(){s=true},unfreeze:function(){s=false;t()},needRepaint:function(){return R},snapshot:function(){},scale:function(B,F,K,O,T){O||(O=T5.D.getCenter(A));
T||(T=T5.D.getCenter(A));J.animate(B,O,T,F,K);return J},removeLayer:function(B){a:{for(var F=r.length;F--;)if(r[F].getId()==B){B=F;break a}B=-1}if(B>=0&&B<r.length){GT.say("layer.removed",{layer:r[B]});r.splice(B,1)}},getOffset:function(){return T5.V.copy(n)},setOffset:function(B,F){n.x=B;n.y=F},updateOffset:function(B,F,K,O,T){function ca(){b(0,0);T&&T()}if(K){B=new T5.Vector(B,F);K=T5.tweenVector(n,B.x,B.y,K,ca,O);for(O=K.length;O--;){K[O].cancelOnInteract=true;K[O].requestUpdates(t)}}else J.setOffset(B,
F)},zoom:function(B,F,K){I=false;N=F;V=N!==1;W=T5.D.getCenter(J.getDimensions());z=N>1?T5.V.copy(B):T5.D.getCenter(J.getDimensions());U=null;clearTimeout(Q);if(V){S=ba;t();if(K)Q=setTimeout(function(){m();N=1},parseInt(K,10))}}};GT.listen("layer.remove",function(B){B.id&&J.removeLayer(B.id)});x=T5.getConfig().getScaling();GT.observable(J);J.bind("wake",t);J.bind("invalidate",function(){R=true});if(e.pannable){J.bind("pan",l);J.bind("panEnd",b);J.bind("inertiaPan",f);J.bind("inertiaCancel",function(){I=
false;t()})}if(e.scalable){J.bind("pinchZoom",g);J.bind("pinchZoomEnd",h);J.bind("wheelZoom",d)}GT.configurable(J,["inertia","container"],GT.paramTweaker(e,null,{container:function(B,F){E=document.getElementById(F);k()}}),true);k();return J};
T5.AnimatedPathLayer=function(e){function l(d,m,k){d.fillStyle="#FFFFFF";d.strokeStyle="#222222";d.beginPath();d.arc(k.x,k.y,4,0,Math.PI*2,false);d.stroke();d.fill()}e=T5.ex({path:[],id:GT.objId("pathAni"),easing:T5.easing("sine.inout"),validStates:T5.viewState("ACTIVE","PAN","PINCH"),drawIndicator:null,duration:2E3,autoCenter:false},e);var f=T5.V.edges(e.path),b,a=null,g=0;T5.tweenValue(0,f.total,e.easing,function(){h.remove()},e.duration).requestUpdates(function(d,m){g=d;m&&h.remove()});var h=T5.ex(new T5.ViewLayer(e),
{cycle:function(){for(var d=0;d<f.accrued.length&&f.accrued[d]<g;)d++;a=null;if(d<e.path.length-1){var m=g-(d>0?f.accrued[d-1]:0),k=e.path[d],o=e.path[d+1];b=T5.V.theta(k,o,f.edges[d]);a=T5.V.pointOnEdge(k,o,b,m);if(e.autoCenter)(d=h.getParent())&&d.centerOn(a)}return a?1:0},draw:function(d,m){if(a)(e.drawIndicator?e.drawIndicator:l)(d,m,new T5.Vector(a.x-m.x,a.y-m.y),b)}});return h};
(function(){T5.tileSize=256;T5.Tile=function(e){return e=T5.ex({x:0,y:0,gridX:0,gridY:0,dirty:false},e)};T5.ImageTile=function(e){e=T5.ex({url:"",sessionParamRegex:null,loaded:false},e);return new T5.Tile(e)}})();
T5.TileGrid=function(e){function l(s,x){var A=T5.Vector(s*d-o.x,x*d-o.y);return new T5.ImageTile({gridX:A.x,gridY:A.y})}function f(s,x,A,D){var z=Math.floor(e.gridSize*0.2),H=new T5.Vector;if(s<0||s+A>e.gridSize)H.x=s<0?-z:z;if(x<0||x+D>e.gridSize)H.y=x<0?-z:z;return H}function b(s,x,A){var D=GT.Log.getTraceTicks(),z=0,H=e.gridSize,I=e.tileSize;new T5.Vector(H/2,H/2);if(A)g=[];if(s)for(A=0;A<H;A++)for(var L=0;L<H;L++){if(!g[z]){var R=s(L,A,m,H);R.gridX=L*I-o.x;R.gridY=A*I-o.y;g[z]=R}z++}k=s;p=x;GT.Log.trace("tile grid populated",
D);v.dirty=true;v.wakeParent()}function a(s,x){if(n){var A,D=[],z=new T5.Vector(Math.floor((s.x+o.x)*C),Math.floor((s.y+o.y)*C));tilesNeeded=false;for(var H=u;H--;)for(var I=E;I--;){A=I+z.x>=0&&I+z.x<e.gridSize?g[(H+z.y)*e.gridSize+(I+z.x)]:null;var L=new T5.Vector(I-n.x,H-n.y);if(!A){r=f(z.x,z.y,E,u);A=l(I+z.x,H+z.y)}D.push({tile:A,centerness:T5.V.absSize(L)})}D.sort(function(R,M){return M.centerness-R.centerness});y||(y=Array(D.length));for(A=D.length;A--;){y[A]=D[A].tile;v.prepTile(y[A],x)}}}e=
T5.ex({tileSize:T5.tileSize,drawGrid:false,center:new T5.Vector,gridSize:25,shiftOrigin:null,supportFastDraw:true},e);var g=Array(Math.pow(e.gridSize,2)),h=e.gridSize,d=e.tileSize,m=T5.V.offset(e.center,-Math.ceil(e.gridSize>>1)),k=null,o=new T5.Vector,p=null,q=Math.round(e.tileSize/2),C=e.tileSize?1/e.tileSize:0,w=true,y=null,t=false;new T5.Vector;var r=new T5.Vector;T5.getConfig();h=h*e.tileSize;var E,u,n,v=T5.ex(new T5.ViewLayer(e),{gridDimensions:new T5.Dimensions(h,h),dirty:false,cycle:function(s,
x,A){s=0;if(r.x!==0||r.y!==0){var D=r,z=e.shiftOrigin;if(!(D.x===0&&D.y===0)){var H=GT.Log.getTraceTicks(),I=Array(g.length);I.length=g.length;for(var L=0;L<e.gridSize;L++)for(var R=0;R<e.gridSize;R++)I[R*e.gridSize+L]=L+D.x>=0&&L+D.x<e.gridSize?g[(R+D.y)*e.gridSize+(L+D.x)]:null;g=I;m=z?z(m,D):T5.V.add(m,D);o.x+=-D.x*e.tileSize;o.y+=-D.y*e.tileSize;GT.Log.trace("tile storage shifted",H);b(k,p)}r=new T5.Vector;s++}A!==T5.viewState("PINCH")&&a(x,A);return s+v.dirty?1:0},deactivate:function(){w=false},
find:function(s){if(!s)return null;for(var x=g.length;x--;){var A=g[x];if(A&&s(A))return A}return null},prepTile:function(){},drawTile:function(){return false},getTileSize:function(){return e.tileSize},draw:function(s,x,A,D,z){if(w){var H=T5.time(),I=x.x;x=x.y;var L=true,R=z.needRepaint()||D===T5.viewState("PAN")||D===T5.viewState("PINCH")||T5.isTweening();if(!n){E=Math.ceil(A.width*C)+1;u=Math.ceil(A.height*C)+1;n=new T5.Vector(Math.floor((E-1)/2),Math.floor((u-1)/2))}if(y){if(e.drawGrid)s.strokeStyle=
"rgba(50, 50, 50, 0.3)";s.beginPath();for(A=y.length;A--;){var M=y[A];if(M){var Q=M.gridX-I,P=M.gridY-x;if(!(R?false:!M.dirty)){L=v.drawTile(s,M,Q,P,D)&&L;M.x=Q;M.y=P}}else L=false;e.drawGrid&&s.rect(Q,P,e.tileSize,e.tileSize)}s.stroke();GT.Log.trace("drawn tiles",H);L&&!t&&z.trigger("tileDrawComplete");t=L;v.dirty=false}}},getTileAtXY:function(s,x){for(var A=e.tileSize,D=y?y.length:0;D--;){var z=y[D];if(z&&s>=z.x&&x>=z.y)if(s<=z.x+A&&x<=z.y+A)return z}return null},getTileVirtualXY:function(s,x,A){s=
T5.V.add(new T5.Vector(s,x),T5.V.invert(m),o);s=new T5.Vector(s.x*e.tileSize,s.y*e.tileSize);if(A){s.x+=q;s.y+=q}return s},populate:function(s){b(s,null,true)}});GT.listen("imagecache.cleared",function(){for(var s=g.length;s--;)if(g[s])g[s].loaded=false});GT.listen("tiler.repaint",function(){for(var s=g.length;s--;)if(g[s]){g[s].x=null;g[s].y=null}});return v};
T5.ImageTileGrid=function(e){function l(){p.getParent().trigger("invalidate");p.dirty=true;p.wakeParent()}e=T5.ex({emptyTile:function(q){if(!f||q!==f.width){f=T5.newCanvas(q,q);q=f.getContext("2d");q.fillStyle="rgba(150, 150, 150, 0.01)";q.fillRect(0,0,f.width,f.height)}return f}(T5.tileSize),panningTile:function(q){function C(){var w=T5.newCanvas(32,32),y=w.getContext("2d");y.fillStyle="#BBBBBB";y.fillRect(0,0,32,32);y.fillStyle="#C3C3C3";y.fillRect(0,0,16,16);y.fillRect(16,16,16,16);return w}if(!b||
q!==b.width){b=T5.newCanvas(q,q);q=b.getContext("2d");q.fillStyle=q.createPattern(C(),"repeat");q.fillRect(0,0,b.width,b.height)}return b}(T5.tileSize),tileOffset:new T5.Vector,tileDrawArgs:{}},e);var f=e.emptyTile,b=e.panningTile,a=T5.viewState("ACTIVE"),g=T5.viewState("PAN"),h=T5.getConfig().requireFastDraw,d=e.tileSize?e.tileSize:T5.tileSize,m=T5.Images.get,k=T5.Images.load,o=T5.ex({background:null,overlay:null,offset:new T5.Vector,realSize:new T5.Dimensions(d,d)},e.tileDrawArgs),p=T5.ex(new T5.TileGrid(e),
{drawTile:function(q,C,w,y,t){var r=C.url?m(C.url):null,E=false;if(r){q.drawImage(r,w,y);C.dirty=false;E=true}else if(t===g)b&&q.drawImage(b,w,y);else f&&q.drawImage(f,w,y);return E},prepTile:function(q,C){if(q)q.dirty=true;if(q&&(!h||C===a))m(q.url)||k(q.url,l,o)}});return p};
T5.Tiler=function(e){e=T5.ex({container:"",drawCenter:false,datasources:{},tileLoadThreshold:"first"},e);var l=T5.ex(new T5.View(e),{getTileLayer:function(){return l.getLayer("grid0")},setTileLayer:function(f){l.setLayer("grid0",f);GT.say("grid.updated",{id:"grid0"})},viewPixToGridPix:function(f){var b=l.getOffset();return new T5.Vector(f.x+b.x,f.y+b.y)},centerOn:function(f,b,a,g){var h=l.getTileLayer(),d=l.getDimensions();(h=h?h.getTileSize():0)&&l.updateOffset(f.gridX-Math.floor((d.width-h)*0.5),
f.gridY-Math.floor((d.height-h)*0.5),b,a,g)},cleanup:function(){l.removeLayer("grid0")},repaint:function(){GT.say("tiler.repaint");l.trigger("wake")},select:function(f){l.trigger("selectTile",f)}});l.bind("tap",function(f,b){var a=l.getTileLayer();if(a)(a=a.getTileAtXY(b.x,b.y))&&l.trigger("selectTile",a)});return l};
T5.Geo=function(){function e(u,n){var v=null;for(var s in r)if(n){if(s==n&&r[s][u]){v=r[s];break}}else if(r[s][u]){v=r[s];break}return v}function l(u,n){var v=m*Math.sin(u);return h-2*Math.atan(n*Math.pow((1-v)/(1+v),m/2))}function f(u,n,v,s){var x=0;u=u.toUpperCase();for(var A in s){var D=n[A];if(D){var z=v[A];D=z?z(u,D):GT.wordExists(u,D)?1:0;x+=D*s[A]}}return x}var b=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],a=Math.PI/180,g=180/Math.PI,h=Math.PI/
2,d=Math.PI*2,m=0.08181919084262157,k=null,o={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",HWY:"HIGHWAY",MWY:"MOTORWAY"},p=function(u,n){return{lat:parseFloat(u?u:0),lon:parseFloat(n?n:0)}},q=function(u,n){return{min:w.parse(u),max:w.parse(n)}},C=function(u){return u=T5.ex({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},u)},w=function(){var u={calcDistance:function(n,v){if(u.empty(n)||u.empty(v))return 0;var s=(v.lat-n.lat)*a/2,x=(v.lon-
n.lon)*a/2;s=Math.sin(s)*Math.sin(s)+Math.cos(n.lat*a)*Math.cos(v.lat*a)*Math.sin(x)*Math.sin(x);return 6371*2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s))},copy:function(n){return n?new p(n.lat,n.lon):null},empty:function(n){return!n||n.lat===0&&n.lon===0},equal:function(n,v){return n&&v&&n.lat==v.lat&&n.lon==v.lon},almostEqual:function(n,v){return n&&v&&Math.floor(n.lat*1E3)===Math.floor(v.lat*1E3)&&Math.floor(n.lon*1E3)===Math.floor(v.lon*1E3)},inArray:function(n,v){for(var s=w.equal,x=v.length;x--;)if(s(n,
v[x]))return true;return false},inBounds:function(n,v){var s=!(w.empty(n)||w.empty(v));return s=(s=s&&n.lat>=v.min.lat&&n.lat<=v.max.lat)&&n.lon>=v.min.lon&&n.lon<=v.max.lon},parse:function(n){if(n)if(typeof n.lat!=="undefined")return u.copy(n);else{if(n.split)for(var v=[" ",","],s=0;s<v.length;s++){var x=n.split(v[s]);if(x.length===2)return new p(x[0],x[1])}}else return new p;return null},parseArray:function(n){var v=n.length,s=Array(v);for(v=v;v--;)s[v]=u.parse(n[v]);GT.Log.info("parsed "+s.length+
" positions");return s},fromMercatorPixels:function(n,v,s){return new p(T5.Geo.pix2lat(v,s),T5.Geo.normalizeLon(T5.Geo.pix2lon(n,s)))},toMercatorPixels:function(n,v){return new T5.Vector(T5.Geo.lon2pix(n.lon,v),T5.Geo.lat2pix(n.lat,v))},generalize:function(n,v,s){var x=n.length,A=[],D=null;s||(s=250);s/=1E3;GT.Log.info("generalizing positions, must include "+v.length+" positions");for(var z=x;z--;)if(z===0)A.unshift(n[z]);else{var H=!D||w.inArray(n[z],v)?s:w.calcDistance(D,n[z]);if(n[z]&&H>=s){A.unshift(n[z]);
D=n[z]}}GT.Log.info("generalized "+x+" positions into "+A.length+" positions");return A},toString:function(n){return n?n.lat+" "+n.lon:""}};return u}(),y=function(){var u=-h,n=h,v=-d,s={calcSize:function(x,A,D){var z=new T5.Vector(0,A.lat-x.lat);if(typeof D==="undefined")D=true;z.x=D&&x.lon>A.lon?360-x.lon+A.lon:A.lon-x.lon;return z},createBoundsFromCenter:function(x,A){var D=A/6371,z=x.lat*a,H=x.lon*a,I=z-D,L=z+D;if(I>u&&L<n){z=Math.asin(Math.sin(D)/Math.cos(z));D=H-z;if(D<v)D+=2*Math.PI;H=H+z;if(H>
d)H-=2*Math.PI}else{I=Math.max(I,u);L=Math.min(L,n);D=v;H=d}return new q(new p(I*g,D*g),new p(L*g,H*g))},expand:function(x,A){return new q(new p(x.min.lat-A,x.min.lon-E.normalizeLon(A)),new p(x.max.lat+A,x.max.lon+E.normalizeLon(A)))},forPositions:function(x,A){var D=null,z=T5.time();A||(A="auto");for(var H=x.length;H--;)if(D){var I=s.calcSize(D.min,x[H],false),L=s.calcSize(x[H],D.max,false);if(I.x<0)D.min.lon=x[H].lon;if(I.y<0)D.min.lat=x[H].lat;if(L.x<0)D.max.lon=x[H].lon;if(L.y<0)D.max.lat=x[H].lat}else D=
new T5.Geo.BoundingBox(x[H],x[H]);if(A){if(A=="auto"){H=s.calcSize(D.min,D.max);A=Math.max(H.x,H.y)*0.3}D=s.expand(D,A)}GT.Log.trace("calculated bounds for "+x.length+" positions",z);return D},getCenter:function(x){var A=y.calcSize(x.min,x.max);return new T5.Geo.Position(x.min.lat+A.y/2,x.min.lon+A.x/2)},getGeoHash:function(x){var A=T5.Geo.GeoHash.encode(x.min.lat,x.min.lon);x=T5.Geo.GeoHash.encode(x.max.lat,x.max.lon);GT.Log.info("min hash = "+A+", max hash = "+x)},getZoomLevel:function(x,A){var D=
s.getCenter(x),z=b[Math.min(Math.round(Math.abs(D.lat)*0.05),b.length)],H=s.calcSize(x.min,x.max);D=Math.ceil(Math.log(b[3]*A.height/H.y)/Math.log(2));z=Math.ceil(Math.log(z*A.width/H.x)/Math.log(2));return Math.min(isNaN(D)?1E3:D,isNaN(z)?1E3:z)},isEmpty:function(x){return!x||w.empty(x.min)||w.empty(x.max)},toString:function(x){return"min: "+w.toString(x.min)+", max: "+w.toString(x.max)}};return s}(),t=function(){var u=/^(\d+).*$/,n=/(\d+)\s?\-\s?(\d+)/;return{buildingMatch:function(v,s){u.lastIndex=
-1;if(u.test(v))for(var x=v.replace(u,"$1"),A=s.split(","),D=0;D<A.length;D++){n.lastIndex=-1;if(n.test(A[D])){var z=n.exec(A[D]);if(x>=parseInt(z[1],10)&&x<=parseInt(z[2],10))return true}else if(x==A[D])return true}return false},normalize:function(v){if(!v)return"";v=v.toUpperCase();if(!k){var s=[];for(var x in o)s.push(x);k=RegExp("(\\s)("+s.join("|")+")(\\s|$)","i")}k.lastIndex=-1;if(s=k.exec(v))v=v.replace(k,"$1"+o[s[2]]);return v},toString:function(v){return v.streetDetails+" "+v.location}}}(),
r={},E={Engine:function(u){if(!u.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var n=T5.ex({remove:function(){delete r[n.id]}},u);return r[n.id]=n},Radius:function(u,n){return{distance:parseInt(u,10),uom:n}},Position:p,BoundingBox:q,Address:C,GeocodeFieldWeights:{streetDetails:50,location:50},AddressCompareFns:{},GeoSearchResult:function(u){u=T5.ex({id:null,caption:"",resultType:"",data:null,pos:null,matchWeight:0},u);return T5.ex(u,{toString:function(){return u.caption+
(u.matchWeight?" ("+u.matchWeight+")":"")}})},GeoSearchAgent:function(u){return new T5.Dispatcher.Agent(u)},GeocodingAgent:function(u){u=T5.ex({name:"Geocoding Search Agent",paramTranslator:null,execute:function(n,v){try{if(!n.reverse&&!n.freeform)address=new C(n);var s=E.getEngine("geocode");if(s)s.geocode({addresses:[n.freeform?n.freeform:address],complete:function(A,D){if(v){var z=D;if(n.freeform)z=E.rankGeocodeResponses(n.freeform,z,E.getEngine("geocode"));v(z,u)}}})}catch(x){GT.Log.exception(x)}}},
u);return new E.GeoSearchAgent(u)},PointOfInterest:function(u){u=T5.ex({id:0,title:"",pos:null,lat:"",lon:"",group:"",retrieved:0,isNew:true},u);if(!u.pos&&u.lat&&u.lon)u.pos=new T5.Geo.Position(u.lat,u.lon);return T5.ex({toString:function(){return u.id+": '"+u.title+"'"}},u)},POIStorage:function(u){function n(z){z=z?z:"default";x[z]||(x[z]=[]);return x[z]}function v(z){var H=[];for(var I in x)for(var L=0;L<x[I].length;L++)if(!z||z(x[I][L]))H.push(x[I][L]);return H}function s(){GT.say("geo.pois-updated",
{srcID:D.id,pois:D.getPOIs()})}u=T5.ex({visibilityChange:null,onPOIDeleted:null,onPOIAdded:null},u);var x={},A=true,D={id:GT.objId(),getPOIs:function(){return v()},getOldPOIs:function(z,H){return v(function(I){return I.group==z&&I.retrieved<H})},getVisible:function(){return A},setVisible:function(z){if(z!=A){A=z;u.visibilityChange&&u.visibilityChange()}},findById:function(z){var H=v(function(I){return I.id==z});return H.length>0?H[0]:null},findByBounds:function(z){return v(function(H){return T5.Geo.P.inBounds(H.pos,
z)})},addPOIs:function(z,H){if(H)x={};for(var I=0;z&&I<z.length;I++){z[I].retrieved=T5.time();var L=z[I];n(L.group).push(L)}},removeGroup:function(z){if(x[z]){delete x[z];s()}},update:function(z){var H=[],I=0,L=z.length>0?z[0].group:"",R=T5.time();for(I=0;I<z.length;I++){var M;a:{if(M=z[I])for(var Q=n(M.group),P=0;P<Q.length;P++)if(Q[P].id==M.id){M=Q[P];break a}M=null}if(M){M.retrieved=R;M.isNew=false}else H.push(z[I])}z=D.getOldPOIs(L,R);D.addPOIs(H);for(I=0;u.onPOIAdded&&I<H.length;I++)u.onPOIAdded(H[I]);
for(I=0;I<z.length;I++){u.onPOIDeleted&&u.onPOIDeleted(z[I]);L=z[I];R=n(L.group);for(M=0;M<R.length;M++)if(R[M].id==L.id){R.splice(M,1);break}}H.length+z.length>0&&s()}};return D},MapProvider:function(){var u=1,n=20;return{zoomLevel:0,checkZoomLevel:function(v){return Math.min(Math.max(v,u),n)},getCopyright:function(){},getLogoUrl:function(){},getMapTiles:function(){},getZoomRange:function(){return{min:u,max:n}},setZoomRange:function(v,s){u=v;n=s}}},getEngine:function(u){for(var n=null,v=1;!n&&v<
arguments.length;v++)n=e(u,arguments[v]);n=n?n:e(u);if(!n)throw Error("Unable to find GEO engine with "+u+" capability");return n},rankGeocodeResponses:function(u,n,v){var s=[],x=E.AddressCompareFns;if(v&&v.compareFns)x=T5.ex({},x,v.compareFns);for(v=0;v<n.length;v++)s.push(new E.GeoSearchResult({caption:t.toString(n[v]),data:n[v],pos:n[v].pos,matchWeight:f(u,n[v],x,E.GeocodeFieldWeights)}));s.sort(function(A,D){return D.matchWeight-A.matchWeight});return s},P:w,B:y,A:t,dist2rad:function(u){return u/
6371},lat2pix:function(u,n){var v=parseFloat(u)*2*Math.PI/360;v=Math.sin(v);var s=m*v;return Math.log((1+v)/(1-v)*Math.pow((1-s)/(1+s),m))/2/n},lon2pix:function(u,n){return parseFloat(u)/180*Math.PI/n},pix2lon:function(u,n){return E.normalizeLon(u*n*180/Math.PI)},pix2lat:function(u,n){for(var v=Math.pow(Math.E,-u*n),s=h-2*Math.atan(v),x=l(s,v),A=0;A<12&&Math.abs(s-x)>1.0E-7;){s=x;x=l(s,v);A++}return x*180/Math.PI},normalizeLon:function(u){for(;u<-180;)u+=360;for(;u>180;)u-=360;return u}};return E}();
T5.Geo.GeoHash=function(){function e(l,f,b){if(f&b)l[0]=(l[0]+l[1])/2;else l[1]=(l[0]+l[1])/2}BITS=[16,8,4,2,1];BASE32="0123456789bcdefghjkmnpqrstuvwxyz";NEIGHBORS={right:{even:"bc01fg45238967deuvhjyznpkmstqrwx"},left:{even:"238967debc01fg45kmstqrwxuvhjyznp"},top:{even:"p0r21436x8zb9dcf5h7kjnmqesgutwvy"},bottom:{even:"14365h7k9dcfesgujnmqp0r2twvyx8zb"}};BORDERS={right:{even:"bcfguvyz"},left:{even:"0145hjnp"},top:{even:"prxz"},bottom:{even:"028b"}};NEIGHBORS.bottom.odd=NEIGHBORS.left.even;NEIGHBORS.top.odd=
NEIGHBORS.right.even;NEIGHBORS.left.odd=NEIGHBORS.bottom.even;NEIGHBORS.right.odd=NEIGHBORS.top.even;BORDERS.bottom.odd=BORDERS.left.even;BORDERS.top.odd=BORDERS.right.even;BORDERS.left.odd=BORDERS.bottom.even;BORDERS.right.odd=BORDERS.top.even;return{decode:function(l){var f=1,b=[],a=[];b[0]=-90;b[1]=90;a[0]=-180;a[1]=180;lat_err=90;lon_err=180;for(i=0;i<l.length;i++){c=l[i];cd=BASE32.indexOf(c);for(j=0;j<5;j++){mask=BITS[j];if(f){lon_err/=2;e(a,cd,mask)}else{lat_err/=2;e(b,cd,mask)}f=!f}}b[2]=(b[0]+
b[1])/2;a[2]=(a[0]+a[1])/2;return{latitude:b,longitude:a}},encode:function(l,f,b){var a=1,g=[],h=[],d=0,m=0;b=b?b:12;geohash="";g[0]=-90;g[1]=90;h[0]=-180;for(h[1]=180;geohash.length<b;){if(a){mid=(h[0]+h[1])/2;if(f>mid){m|=BITS[d];h[0]=mid}else h[1]=mid}else{mid=(g[0]+g[1])/2;if(l>mid){m|=BITS[d];g[0]=mid}else g[1]=mid}a=!a;if(d<4)d++;else{geohash+=BASE32[m];m=d=0}}return geohash}}}();
T5.Geo.Search=function(){return{bestResults:function(e,l){l||(l=20);for(var f=e.length>0?e[0]:null,b=[],a=0;a<e.length;a++)if(f&&e[a]&&f.matchWeight-e[a].matchWeight<=l)b.push(e[a]);else break;return b}}}();
T5.Geo.Routing=function(){var e={calculate:function(l){l=T5.ex({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},l);GT.Log.info("attempting to calculate route");var f=T5.Geo.getEngine("route");f&&f.route(l,function(b){if(l.generalize)b.geometry=T5.Geo.P.generalize(b.geometry,b.getInstructionPositions());if(l.map){e.createMapOverlay(l.map,b);if(l.autoFit){GT.Log.info("AUTOFITTING MAP TO ROUTE: bounds = "+b.boundingBox);l.map.gotoBounds(b.boundingBox)}}l.success&&
l.success(b)})},createMapOverlay:function(l,f){var b=l.getDimensions();b=new T5.Geo.UI.RouteOverlay({data:f,width:b.width,height:b.height});l.setLayer("route",b)},parseTurnType:function(l){for(var f=e.TurnType.Unknown,b=T5.Geo.Routing.TurnTypeRules,a=0;a<b.length;a++){b[a].regex.lastIndex=-1;var g=b[a].regex.exec(l);if(g){f=b[a].customCheck?b[a].customCheck(l,g):b[a].turnType;break}}return f},TurnType:{Unknown:"turn-unknown",Start:"turn-none-start",Continue:"turn-none",Arrive:"turn-none-arrive",TurnLeft:"turn-left",
TurnLeftSlight:"turn-left-slight",TurnLeftSharp:"turn-left-sharp",TurnRight:"turn-right",TurnRightSlight:"turn-right-slight",TurnRightSharp:"turn-right-sharp",Merge:"merge",UTurnLeft:"uturn-left",UTurnRight:"uturn-right",EnterRoundabout:"roundabout-enter",Ramp:"ramp",RampExit:"ramp-exit"},Instruction:function(l){l=T5.ex({position:null,description:"",turnType:null},l);if(!l.turnType)l.turnType=e.parseTurnType(l.description);return l},RouteData:function(l){l=T5.ex({geometry:[],instructions:[],boundingBox:null},
l);if(!l.boundingBox)l.boundingBox=T5.Geo.B.forPositions(l.geometry);return T5.ex({getInstructionPositions:function(){for(var f=[],b=0;b<l.instructions.length;b++)l.instructions[b].position&&f.push(l.instructions[b].position);return f}},l)}};return e}();
T5.Geo.Routing.TurnTypeRules=function(){var e=T5.Geo.Routing.TurnType,l=[];l.push({regex:/continue/i,turnType:e.Continue});l.push({regex:/(take|bear|turn)(.*?)left/i,customCheck:function(f,b){return/bear/i.test(b[1])?e.TurnLeftSlight:e.TurnLeft}});l.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(f,b){return/bear/i.test(b[1])?e.TurnRightSlight:e.TurnRight}});l.push({regex:/enter\s(roundabout|rotaty)/i,turnType:e.EnterRoundabout});l.push({regex:/take.*?ramp/i,turnType:e.Ramp});l.push({regex:/take.*?exit/i,
turnType:e.RampExit});l.push({regex:/make(.*?)u\-turn/i,customCheck:function(f,b){return/right/i.test(b[1])?e.UTurnRight:e.UTurnLeft}});l.push({regex:/proceed/i,turnType:e.Start});l.push({regex:/arrive/i,turnType:e.Arrive});l.push({regex:/fell\sthrough/i,turnType:e.Merge});return l}();
T5.Geo.UI=function(){var e=0,l={AnnotationTween:null,GeoTileGrid:function(f){f=T5.ex({grid:null,centerPos:new T5.Geo.Position,centerXY:new T5.Vector,radsPerPixel:0},f);var b=T5.Geo.P.toMercatorPixels(f.centerPos,f.radsPerPixel),a=b.x-f.centerXY.x,g=b.y-f.centerXY.y,h=T5.ex({},f.grid,{getBoundingBox:function(d,m,k,o){return new T5.Geo.BoundingBox(h.pixelsToPos(new T5.Vector(d,m+o)),h.pixelsToPos(new T5.Vector(d+k,m)))},getGridXYForPosition:function(d){d=T5.Geo.P.toMercatorPixels(d,f.radsPerPixel);
return new T5.Vector(d.x-a,h.gridDimensions.height-(d.y-g))},getPixelDistance:function(d){d=T5.Geo.dist2rad(d);return Math.floor(d/f.radsPerPixel)},pixelsToPos:function(d){return T5.Geo.P.fromMercatorPixels(a+d.x,g+h.gridDimensions.height-d.y,f.radsPerPixel)}});return h},RouteOverlay:function(f){f=T5.ex({data:null,pixelGeneralization:8,calculationsPerCycle:250,partialDraw:false,strokeStyle:"rgba(0, 51, 119, 0.9)",waypointFillStyle:"#FFFFFF",lineWidth:4,zindex:50},f);var b=true,a=null,g=[],h=0,d=[],
m=[],k=T5.ex(new T5.ViewLayer(f),{getAnimation:function(o,p,q,C){if(b)return null;var w="routeAnimation"+e++;m.push(w);return new T5.AnimatedPathLayer({id:w,path:g,zindex:f.zindex+1,easing:o?o:T5.T5.easing("sine.inout"),duration:p?p:5E3,drawIndicator:q,autoCenter:C?C:false})},draw:function(o,p,q,C,w){q=0;C=f.data?f.data.geometry:null;if(b){b=false;a=null;g=[];h=0}if(C&&h<C.length){a:{w=w.getTileLayer();d=[];if(w){C=GT.Log.getTraceTicks();var y,t,r,E=f.data?f.data.geometry:[],u=E.length,n=f.data?f.data.instructions:
[],v=n.length,s=f.calculationsPerCycle,x=0;for(y=h;y<u;y++){t=w.getGridXYForPosition(E[y]);if(r=!a||y===0||Math.abs(t.x-a.x)+Math.abs(t.y-a.y)>f.pixelGeneralization){g.push(t);a=t}x++;if(x>=s){h=y;break a}}h=u;GT.Log.trace(u+" geometry points generalized to "+g.length+" coordinates",C);a=null;for(y=v;y--;)if(n[y].position){t=w.getGridXYForPosition(n[y].position);if(r=!a||y===0||Math.abs(t.x-a.x)+Math.abs(t.y-a.y)>f.pixelGeneralization){d.push(t);a=t}}}}q++}w=g.length;if(w>0&&(!q||f.partialDraw)){o.strokeStyle=
f.strokeStyle;o.lineWidth=f.lineWidth;o.beginPath();o.moveTo(g[w-1].x-p.x,g[w-1].y-p.y);for(w=w;w--;)o.lineTo(g[w].x-p.x,g[w].y-p.y);o.stroke();o.fillStyle=f.waypointFillStyle;for(w=d.length;w--;){o.beginPath();o.arc(d[w].x-p.x,d[w].y-p.y,2,0,Math.PI*2,false);o.stroke();o.fill()}}return q}});GT.listen("grid.updated",function(){for(var o=m.length;o--;)GT.say("layer.remove",{id:m[o]});m=[];b=true;k.wakeParent()});return k},Annotation:function(f){f=T5.ex({xy:null,pos:null,draw:null,calcXY:null,tweenIn:l.AnnotationTween,
animationSpeed:null},f);var b=false,a={xy:f.xy,pos:f.pos,isNew:true,isAnimating:function(){return b},calcXY:function(g){a.xy=g.getGridXYForPosition(a.pos);f.calcXY&&f.calcXY(g)},draw:function(g,h,d,m,k){if(a.xy){if(a.isNew&&f.tweenIn){var o=a.xy.y;a.xy.y=h.y-20;b=true;T5.tween(a.xy,"y",o,f.tweenIn,function(){a.xy.y=o;b=false},f.animationSpeed?f.animationSpeed:250+Math.random()*500)}if(f.draw)f.draw(g,h,new T5.Vector(a.xy.x-h.x,a.xy.y-h.y),d,m,k);else{g.beginPath();g.arc(a.xy.x-h.x,a.xy.y-h.y,4,0,
Math.PI*2,false);g.fill()}a.isNew=false}}};return a},ImageAnnotation:function(f){f=T5.ex({imageUrl:null,animatingImageUrl:null,imageAnchor:null},f);var b=f.imageAnchor?T5.V.invert(f.imageAnchor):null;f.draw=function(g,h,d,m,k){if(f.animatingImageUrl&&a.isAnimating()){T5.Images.load(f.imageUrl);m=f.animatingImageUrl}else m=f.imageUrl;if(h=T5.Images.get(m)){if(h.complete&&h.width>0){b||(b=new T5.Vector(-h.width>>1,-h.height>>1));d=T5.V.offset(d,b.x,b.y);g.drawImage(h,d.x,d.y,h.width,h.height)}}else T5.Images.load(m,
function(){k.wakeParent()})};var a=new l.Annotation(f);return a},LocationAnnotation:function(f){f=T5.ex({accuracy:null},f);var b=new Image,a=new T5.Vector,g=null;b.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAACIQAAAiEBPhEQkwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAG+SURBVCiRlZHNahNRAIW/O7mTTJPahLZBA1YUyriINRAE3bQIKm40m8K8gLj0CRQkO32ELHUlKbgoIu4EqeJPgtCaoBuNtjXt5LeTMZk0mbmuWiuuPLsD3+HAOUIpxf9IHjWmaUbEyWv5ROrsVULhcHP761rUfnN3Y2Otc8CIg4YT85lzuVsPP+Qupw1vpPjRCvhS9ymvV0e77x7nNj+uvADQAIQQ+uLyvdfLV9JGZi7EdEwQlqBpEJ019f0z1mo2u5Q8DMydv25lshemmj1FueZTawbs7inarqLbV7Qjab1upB9YlhWSAHLavLHZCvg1VEhN0PMU9W7At4bPVidg7CtkLLXkut+lBPD6/Ub155jJiADAHSpaLmx3ApyBQoYEUd0PBoOBkAC6+3llvda/YxgGgYL+UNHf/zN3KiExGlsvTdP0NYDkhPdWrz35ZDsBzV5wCMuQwEyFmXFeeadjzfuFQmGkAZRKpdGC/n7x+M6jqvA9Zo6FWDhlcHE+wqT93J1tP7vpOE7rrx8ALMuasPf8S12St4WmJ6bYWTUC52k8Hm8Vi0X/nwBAPp/XKpWKdF1X2LYdlMvlsToC/QYTls7DLFr/PAAAAABJRU5ErkJggg%3D%3D";
b.onload=function(){a=new T5.Vector(b.width/2,b.height/2)};var h=new l.Annotation(T5.ex({calcXY:function(d){g=Math.floor(d.getPixelDistance(h.accuracy)*0.5)},draw:function(d,m,k,o,p,q){m=k.x-a.x;o=k.y-a.y;if(g&&h.drawAccuracyIndicator){d.fillStyle="rgba(30, 30, 30, 0.2)";d.beginPath();d.arc(k.x,k.y,g,0,Math.PI*2,false);d.fill()}b.complete&&b.width>0&&d.drawImage(b,m,o,b.width,b.height);q.trigger("invalidate")}},f));h.accuracy=f.accuracy;h.drawAccuracyIndicator=false;return h},AnnotationsOverlay:function(f){function b(m){var k=
f.map?f.map.getTileLayer():null,o=m.length;if(k)for(o=o;o--;)m[o].calcXY(k);m.sort(function(p,q){var C=q.xy.y-p.xy.y;if(C===0)C=q.xy.x-p.xy.x;return C})}f=T5.ex({pois:null,map:null,zindex:100},f);var a=[],g=false,h=[],d=T5.ex(new T5.ViewLayer(f),{cycle:function(){return g?1:0},draw:function(m,k,o,p,q){g=false;m.fillStyle="rgba(255, 0, 0, 0.75)";m.globalCompositeOperation="source-over";for(o=a.length;o--;){a[o].draw(m,k,p,d,q);g=g||a[o].isAnimating()}for(o=h.length;o--;){h[o].draw(m,k,p,d,q);g=g||
h[o].isAnimating()}return g?1:0},add:function(m){h.push(m);b(h);d.wakeParent()},clear:function(m){h=[];b(h);if(m){a=[];b(a)}d.wakeParent()}});GT.listen("geo.pois-updated",function(m){if(f.pois&&f.pois.id==m.srcID){m=m.pois;try{a=[];for(var k=0;k<m.length;k++)if(m[k].pos){var o;var p=m[k];if(p&&p.pos){var q={poi:p,annotation:null};f.map&&f.map.trigger("getAnnotationForPOI",q);if(!q.annotation)q.annotation=new l.Annotation({pos:p.pos});if(q.annotation){q.annotation.isNew=p.isNew;p.isNew=false}o=q.annotation}else o=
void 0;o&&a.push(o)}b(a)}catch(C){GT.Log.exception(C)}d.wakeParent()}});GT.listen("grid.updated",function(){b(a);b(h);d.wakeParent()});return d}};return l}();
T5.Map=function(e){function l(r){try{var E=new T5.Geo.Position(r.coords.latitude,r.coords.longitude),u=r.coords.accuracy/1E3;t.trigger("locationUpdate",r,u);if(w){if(!p){p=new T5.Geo.UI.LocationAnnotation({pos:E,accuracy:u});t.bind("tileDrawComplete",function(){p.drawAccuracyIndicator=true})}e.displayLocationAnnotation&&m.add(p);var n=T5.Geo.B.createBoundsFromCenter(E,Math.max(u,1));t.gotoBounds(n)}else{p.pos=E;p.accuracy=u;p.calcXY(t.getTileLayer());t.panToPosition(E,null,T5.easing("sine.out"))}w=
false}catch(v){GT.Log.exception(v)}}function f(r){GT.Log.info("caught location tracking error:",r)}e=T5.ex({tapExtent:10,provider:null,crosshair:false,zoomLevel:0,boundsChangeThreshold:30,pois:new T5.Geo.POIStorage,displayLocationAnnotation:true,zoomAnimation:T5.easing("quad.out")},e);var b={NONE:0,SINGLE:1,WATCH:2},a=new T5.Vector,g=b.NONE,h=false,d=[],m=null,k=null,o=null,p=null,q=0,C=false,w=true,y=e.zoomLevel;if(!e.provider)e.provider=new T5.Geo.MapProvider;e.adjustScaleFactor=function(r){return Math.pow(2,
(r<1?Math.floor:Math.ceil)(Math.log(r)))};var t=T5.ex({},new T5.Tiler(e),{pois:e.pois,annotations:null,getBoundingBox:function(){var r=t.getTileLayer(),E=t.getOffset(),u=t.getDimensions();if(r)return r.getBoundingBox(E.x,E.y,u.width,u.height);return null},getCenterPosition:function(){return t.getXYPosition(T5.D.getCenter(t.getDimensions()))},getXYPosition:function(r){return t.getTileLayer().pixelsToPos(t.viewPixToGridPix(r))},gotoBounds:function(r,E){var u=T5.Geo.B.getZoomLevel(r,t.getDimensions());
t.gotoPosition(T5.Geo.B.getCenter(r),u,E)},gotoPosition:function(r,E,u){function n(A){t.setTileLayer(A);o=A.getId();t.panToPosition(r,function(){t.unfreeze();t.trigger("zoomLevelChange",y);u&&u()});h=true;C=false}var v=y,s=!h,x=t.getBoundingBox();if(x)s=s||!T5.Geo.P.inBounds(r,x);y=E?E:y;if(!y)throw Error("Zoom level required to goto a position.");if(e.provider)y=e.provider.checkZoomLevel(y);if(s||y!==v)if(C)GT.Log.warn("Tile request in progress, aborting");else{T5.Images.cancelLoad();if(p)p.drawAccuracyIndicator=
false;(E=t.getTileLayer())&&E.deactivate();T5.cancelAnimation();h&&t.freeze();C=true;e.provider.zoomLevel=y;e.provider.getMapTiles(t,r,n)}else t.panToPosition(r,u)},panToPosition:function(r,E,u){var n=t.getTileLayer();if(n){r=n.getGridXYForPosition(r);n=t.getDimensions();r.x-=n.width/2;r.y-=n.height/2;if(k)k=null;t.updateOffset(r.x,r.y,u);t.trigger("wake");e.boundsChange&&e.boundsChange(t.getBoundingBox());E&&E(t)}},locate:function(){t.trackStart(b.SINGLE);setTimeout(t.trackCancel,1E4)},trackStart:function(r){if(navigator.geolocation&&
!q){g=r?r:b.WATCH;w=true;q=navigator.geolocation.watchPosition(l,f,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3})}},trackCancel:function(){q&&navigator.geolocation&&navigator.geolocation.clearWatch(q);g===b.WATCH&&m.clear();g=b.NONE;q=0},getZoomLevel:function(){return y},setZoomLevel:function(r){try{t.gotoPosition(t.getCenterPosition(),r)}catch(E){GT.Log.exception(E)}},zoomIn:function(){t.scale(2,T5.easing("sine.out"))||t.setZoomLevel(y+1)},zoomOut:function(){t.scale(0.5,T5.easing("sine.out"))||
t.setZoomLevel(y-1)},animateRoute:function(r,E,u,n){var v=t.getLayer("route");if(v)(r=v.getAnimation(r,E,u,n))&&r.addToView(t)}});t.bind("pan",function(){g===b.SINGLE&&t.trackCancel()});t.bind("tap",function(r,E){var u=t.getTileLayer(),n=null;if(u){var v=t.viewPixToGridPix(new T5.Vector(E.x,E.y)),s=u.pixelsToPos(v);n=u.pixelsToPos(T5.V.offset(v,-e.tapExtent,e.tapExtent));u=u.pixelsToPos(T5.V.offset(v,e.tapExtent,-e.tapExtent));n=new T5.Geo.BoundingBox(n,u);d=t.pois.findByBounds(n);t.trigger("geotap",
r,E,s,n);t.trigger("tapPOI",d)}});t.bind("doubleTap",function(r,E){t.animate(2,T5.D.getCenter(t.getDimensions()),new T5.Vector(E.x,E.y),e.zoomAnimation)});t.bind("scale",function(r,E){var u=0;r=Math.sqrt(r);if(r<1)u=-(0.5/r);else if(r>1)u=r;t.gotoPosition(t.getXYPosition(E),y+Math.floor(u))});m=new T5.Geo.UI.AnnotationsOverlay({pois:t.pois,map:t});t.annotations=m;t.setLayer("annotations",m);e.crosshair&&t.setLayer("crosshair",new CrosshairOverlay);t.bind("idle",function(){if(T5.V.absSize(T5.V.diff(a,
t.getOffset()))>e.boundsChangeThreshold){a=t.getOffset();t.trigger("boundsChange",t.getBoundingBox())}});GT.configurable(t,["provider"],GT.paramTweaker(e,null,{provider:function(){t.cleanup();h=false}}),true);return t};
