if(!this.JSON)this.JSON={};
(function(){function e(h){return h<10?"0"+h:h}function m(h){a.lastIndex=0;return a.test(h)?'"'+h.replace(a,function(o){var q=d[o];return typeof q==="string"?q:"\\u"+("0000"+o.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+h+'"'}function f(h,o){var q,r,C,s,p=g,w,t=o[h];if(t&&typeof t==="object"&&typeof t.toJSON==="function")t=t.toJSON(h);if(typeof l==="function")t=l.call(o,h,t);switch(typeof t){case "string":return m(t);case "number":return isFinite(t)?String(t):"null";case "boolean":case "null":return String(t);
case "object":if(!t)return"null";g+=k;w=[];if(Object.prototype.toString.apply(t)==="[object Array]"){s=t.length;for(q=0;q<s;q+=1)w[q]=f(q,t)||"null";C=w.length===0?"[]":g?"[\n"+g+w.join(",\n"+g)+"\n"+p+"]":"["+w.join(",")+"]";g=p;return C}if(l&&typeof l==="object"){s=l.length;for(q=0;q<s;q+=1){r=l[q];if(typeof r==="string")if(C=f(r,t))w.push(m(r)+(g?": ":":")+C)}}else for(r in t)if(Object.hasOwnProperty.call(t,r))if(C=f(r,t))w.push(m(r)+(g?": ":":")+C);C=w.length===0?"{}":g?"{\n"+g+w.join(",\n"+g)+
"\n"+p+"}":"{"+w.join(",")+"}";g=p;return C}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
a=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,g,k,d={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},l;if(typeof JSON.stringify!=="function")JSON.stringify=function(h,o,q){var r;k=g="";if(typeof q==="number")for(r=0;r<q;r+=1)k+=" ";else if(typeof q==="string")k=q;if((l=o)&&typeof o!=="function"&&(typeof o!=="object"||typeof o.length!=="number"))throw Error("JSON.stringify");return f("",
{"":h})};if(typeof JSON.parse!=="function")JSON.parse=function(h,o){function q(C,s){var p,w,t=C[s];if(t&&typeof t==="object")for(p in t)if(Object.hasOwnProperty.call(t,p)){w=q(t,p);if(w!==undefined)t[p]=w;else delete t[p]}return o.call(C,s,t)}var r;h=String(h);b.lastIndex=0;if(b.test(h))h=h.replace(b,function(C){return"\\u"+("0000"+C.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(h.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){r=eval("("+h+")");return typeof o==="function"?q({"":r},""):r}throw new SyntaxError("JSON.parse");}})();
GT=function(){var e=/\$\{(.*?)\}/ig,m=Object.prototype.hasOwnProperty,f=0,b={id:"GRUNT.core",extend:function(){var a=arguments[0]||{},g=1,k=arguments.length,d=false,l,h,o,q;if(typeof a==="boolean"){d=a;a=arguments[1]||{};g=2}if(typeof a!=="object"&&!b.isFunction(a))a={};if(k===g){a=this;--g}for(;g<k;g++)if((l=arguments[g])!=null)for(h in l){o=a[h];q=l[h];if(a!==q)if(d&&q&&(b.isPlainObject(q)||b.isArray(q))){o=o&&(b.isPlainObject(o)||b.isArray(o))?o:b.isArray(q)?[]:{};a[h]=b.extend(d,o,q)}else if(q!==
undefined)a[h]=q}return a},isFunction:function(a){return toString.call(a)==="[object Function]"},isArray:function(a){return toString.call(a)==="[object Array]"},isPlainObject:function(a){if(!a||toString.call(a)!=="[object Object]"||a.nodeType||a.setInterval)return false;if(a.constructor&&!m.call(a,"constructor")&&!m.call(a.constructor.prototype,"isPrototypeOf"))return false;var g;for(g in a);return g===undefined||m.call(a,g)},isEmptyObject:function(a){for(var g in a)return false;return true},isXmlDocument:function(a){return toString.call(a)===
"[object Document]"},contains:function(a,g){var k=a,d=arguments,l=1;if(g&&b.isArray(g)){d=g;l=0}for(l=l;l<d;l++)k=k&&typeof foo[d[l]]!=="undefined";return k},newModule:function(a){a=b.extend({id:null,requires:[],parent:null},a);if(a.parent)a=b.extend({},a.parent,a);return a},toID:function(a){return a.replace(/\s/g,"-")},objId:function(a){return(a?a:"obj")+f++},formatStr:function(a){if(arguments.length<=1)return a;for(var g=arguments.length-2,k=0;k<=g;k++)a=a.replace(RegExp("\\{"+k+"\\}","gi"),arguments[k+
1]);return a},wordExists:function(a,g){var k="";if(g.toString)g=g.toString();for(var d=0;d<g.length;d++)k+=!/\w/.test(g[d])?"\\"+g[d]:g[d];return RegExp("(^|\\s|\\,)"+k+"(\\,|\\s|$)","i").test(a)},parseTemplate:function(a,g){for(var k=e.exec(a);k;){a=a.replace(k[0],COG.XPath.first(k[1],g));e.lastIndex=0;k=e.exec(a)}return a}};return b}();
COG.Log=function(){function e(g,k){var d,l=k&&k.length>0?k[0]:"";for(d=1;k&&d<k.length;d++)l+=" "+(f&&COG.isPlainObject(k[d])?JSON.stringify(k[d]):k[d]);typeof console!=="undefined"&&console[g](l);for(d=0;d<m.length;d++)m[d].call(a,l,g)}var m=[],f=typeof JSON!=="undefined",b=window.console&&window.console.markTimeline,a={id:"GRUNT.log",getTraceTicks:function(){return b?(new Date).getTime():null},trace:function(g,k){if(b)console.markTimeline(g+(k?": "+(a.getTraceTicks()-k)+"ms":""))},debug:function(){e("debug",
arguments)},info:function(){e("info",arguments)},warn:function(){e("warn",arguments)},error:function(){e("error",arguments)},exception:function(g){a.error(arguments);for(var k in g)a.info("ERROR DETAIL: "+k+": "+g[k])},watch:function(g,k){try{k()}catch(d){a.exception(d,g)}},throwError:function(g){a.error(g);throw Error(g);},requestUpdates:function(g){m.push(g)}};return a}();
(function(){function e(f,b){var a=f.split("|"),g={};for(var k in b){var d=b[k];g[k]=a.length>d?a[d]:null}return g}var m={JSON:{parse:function(f){return JSON.parse(f)}},PDON:{parse:function(f){var b=null,a=[];f=f.split("\n");for(var g=0;g<f.length;g++){var k=f[g];if(b)a.push(e(k,b));else if(k){b=k.split("|");k={};for(var d=0;d<b.length;d++)k[b[d]]=d;b=k}else b=null}return a}}};COG.parseData=function(f,b){b=b?b.toUpperCase():"JSON";if(!m[b])throw Error("Unsupported data format: "+b);try{return m[b].parse(f)}catch(a){COG.Log.exception(a)}return{}}})();
(function(){function e(b,a){b[a]||(b[a]=function(g){return b.configure(a,g)})}function m(b){b.gtConfId=COG.objId("configurable");b.gtConfig={};b.gtConfigFns=[];return b.gtConfig}var f={};COG.paramTweaker=function(b,a,g){return function(k,d){if(typeof d!=="undefined"){if(k in b)b[k]=d;g&&k in g&&g[k](k,d)}else return a&&k in a?a[k](k):b[k]}};COG.configurable=function(b,a,g,k){if(b){b.gtConfId||m(b);var d=b.gtConfId,l=b.gtConfig,h=b.gtConfigFns;f[d]=b;h.push(g);for(g=a.length;g--;){l[a[g]]=true;k&&e(b,
a[g])}if(!b.configure)b.configure=function(o,q){if(l[o]){for(var r=h.length;r--;){var C=h[r](o,q);if(typeof C!=="undefined")return C}return f[d]}return null}}}})();
(function(){function e(a){var g=document.createElement("script"),k=false;g.src=a;g.async=true;g.onload=g.onreadystatechange=function(){if(!k&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){k=true;g.onload=g.onreadystatechange=null;g&&g.parentNode&&g.parentNode.removeChild(g)}};f||(f=document.getElementsByTagName("head")[0]);f.appendChild(g)}var m=0,f,b=this;COG.jsonp=function(a,g,k){a+=a.indexOf("?")>=0?"&":"?";var d="json"+ ++m;b[d]=function(l){g(l);b[d]=null;try{delete b[d]}catch(h){}};
e(a+(k?k:"callback")+"="+d);return d}})();
(function(){function e(d){var l=[],h=function(q,r){r=COG.isFunction(r)?r():r;l[l.length]=encodeURIComponent(q)+"="+encodeURIComponent(r)};if(COG.isArray(d))for(var o=0;o<d.length;o++)h(d[o].name,d[o].value);else for(o in d)h(o,d[o]);return l.join("&").replace(/%20/g,"+")}var m={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},f={JSON:["json"],PDON:["pdon.txt"]},b=["TEXT","STREAM"],a=/^(\w+:)?\/\/([^\/?#]+)/,g={XML:function(d){return d.responseXML},JSON:function(d){return COG.parseData(d.responseText)},
PDON:function(d){return COG.parseData(d.responseText,"PDON")},DEFAULT:function(d){return d.responseText}},k={CONTENT_TYPE:"Content-Type"};COG.xhr=function(d){function l(){if(this.readyState===4){var r=null,C=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(C)if(d.handleResponse)d.handleResponse(this);else{var s=d,p=this.getResponseHeader(k.CONTENT_TYPE),w,t=false;for(w in m)if(p&&p.indexOf(m[w])>=0){t=true;break}p=
!t;for(t=0;t<b.length;t++)p=p||b[t]==w;if(p)b:{p=w;for(var E in f)for(t=0;t<f[E].length;t++)if(RegExp(f[E][t]+"$","i").test(s.url)){w=E;break b}w=p?p:"DEFAULT"}try{r=g[w](this,s)}catch(u){r=g.DEFAULT(this,s)}}else d.error&&d.error(this)}catch(n){COG.Log.exception(n,"PROCESSING AJAX RESPONSE")}C&&r&&d.success&&d.success.call(this,r)}}try{d=COG.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},d);var h=a.exec(d.url),
o=h&&(h[1]&&h[1]!==location.protocol||h[2]!==location.host);if(d.data)d.method="POST";if(d.url){h=null;if(d.xhr)h=d.xhr(d);h||(h=new XMLHttpRequest);h.open(d.method,d.url,d.async);d.data&&h.setRequestHeader("Content-Type",d.contentType);o||h.setRequestHeader("X-Requested-With","XMLHttpRequest");h.onreadystatechange=l;h.send(d.method=="POST"?e(d.data):null)}else COG.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(q){COG.Log.exception(q)}}})();
COG.XPath=function(){function e(a){for(var g=null,k=0;k<m.length;k++)if(g=m[k](a))break;return g}var m=[],f=[null,function(a){return a.numberValue},function(a){return a.stringValue},function(a){return a.booleanValue},null,null,null,null,function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null},function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||COG.Log.warn("No XPATH support");var b={SearchResult:function(a){return{toString:function(){var g=
null;if(a){var k=null;if(a.resultType>=0&&a.resultType<f.length)k=f[a.resultType];if(k)g=k(a)}return g?g:""}}},first:function(a,g){var k=b.SearchResult,d;var l=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!l)l=XPathResult.ANY_TYPE;try{if(COG.isXmlDocument(g))d=g.evaluate(a,g,e,l,null);else{COG.Log.warn("attempted xpath expression: "+a+" on a non-xml document");d=null}}catch(h){COG.Log.warn("invalid xpath expression: "+a+" on node: "+g);d=null}return new k(d)},registerResolver:function(a){m.push(a)}};return b}();
(function(){function e(m,f){var b=m.gtObsHandlers;b[f]||(b[f]=[]);return b[f]}COG.observable=function(m){if(m){if(!m.gtObsHandlers)m.gtObsHandlers={};if(!(m.bind||m.trigger||m.unbind)){m.bind=function(f,b){var a=COG.objId("callback");e(m,f).push({fn:b,id:a});return a};m.trigger=function(f){var b=e(m,f);if(!b)return m;for(var a=b.length;a--;)b[a].fn.apply(self,Array.prototype.slice.call(arguments,1));return m};m.unbind=function(f,b){for(var a=e(m,f),g=0;a&&g<a.length;g++)if(a[g].id===b){a.splice(g,1);
break}return m}}}}})();(function(){var e={},m=[];COG.addPipe=function(f){f("pipe.test",{});m.push(f)};COG.listen=function(f,b){e[f]||(e[f]=[]);b&&e[f].push(b)};COG.say=function(f,b){var a;for(a=m.length;a--;)m[a](f,b);if(e[f])for(a=e[f].length;a--;)e[f][a](b)}})();
COG.Storage=function(){function e(m){if(m&&m=="session")return sessionStorage;return localStorage}return{get:function(m,f){var b=e(f).getItem(m);return/^(\{|\[).*(\}|\])$/.test(b)?JSON.parse(b):b},set:function(m,f,b){f=jQuery.isArray(f)||jQuery.isPlainObject(f)?JSON.stringify(f):f;e(b).setItem(m,f)},remove:function(m,f){e(f).removeItem(m)}}}();
COG.ParseRules=function(){var e=[];return{add:function(m,f){e.push({regex:m,handler:f})},each:function(m,f,b){function a(){g++;b&&g>=e.length&&b(f)}for(var g=0,k=0;k<e.length;k++){var d=e[k].regex,l=e[k].handler,h=false;if(d){d.lastIndex=-1;if((d=d.exec(m))&&l){h=true;l(d,f,a)&&a()}}h||a()}}}};
T5=function(){var e=function(k,d){return{x:k?k:0,y:d?d:0}},m=function(){function k(d){if(!d||d.length<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var l={edges:Array(d.length-1),accrued:Array(d.length-1),total:0},h=m.diff,o=0;o<d.length-1;o++){var q=h(d[o],d[o+1]);l.edges[o]=Math.sqrt(q.x*q.x+q.y*q.y);l.accrued[o]=l.total+l.edges[o];l.total+=l.edges[o]}return l}return{create:function(d,l){return new e(d,l)},add:function(){for(var d=new e,l=arguments.length;l--;){d.x+=
arguments[l].x;d.y+=arguments[l].y}return d},absSize:function(d){return Math.max(Math.abs(d.x),Math.abs(d.y))},diff:function(d,l){return new e(d.x-l.x,d.y-l.y)},copy:function(d){return d?new e(d.x,d.y):null},invert:function(d){return new e(-d.x,-d.y)},offset:function(d,l,h){return new e(d.x+l,d.y+(h?h:l))},edges:k,distance:function(d){return k(d).total},theta:function(d,l,h){h=Math.asin((d.y-l.y)/h);return d.x>l.x?h:Math.PI-h},pointOnEdge:function(d,l,h,o){l=new e(Math.cos(h)*o,Math.sin(h)*o);return new e(d.x-
l.x,d.y-l.y)},getRect:function(d){var l=d.length;if(l>1)return new f(Math.min(d[0].x,d[l-1].x),Math.min(d[0].y,d[l-1].y),Math.abs(d[0].x-d[l-1].x),Math.abs(d[0].y-d[l-1].y))},toString:function(d){return d.x+", "+d.y}}}(),f=function(k,d,l,h){return{origin:new e(k,d),dimensions:new a(l,h)}},b=function(){return{copy:function(k){return k?new f(k.origin.x,k.origin.y,k.dimensions.width,k.dimensions.height):null},getCenter:function(k){return new e(k.origin.x+k.dimensions.width/2,k.origin.y+k.dimensions.height/
2)}}}(),a=function(k,d){return{width:k?k:0,height:d?d:0}},g=function(){return{getAspectRatio:function(k){return k.height!==0?k.width/k.height:1},getCenter:function(k){return new e(k.width/2,k.height/2)},getSize:function(k){return Math.sqrt(Math.pow(k.width,2)+Math.pow(k.height,2))}}}();return{ex:COG.extend,newCanvas:function(k,d){var l=document.createElement("canvas");typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(l);l.width=k?k:0;l.height=d?d:0;return l},time:function(){return(new Date).getTime()},
Vector:e,V:m,Dimensions:a,D:g,Rect:f,R:b}}();
(function(){function e(){for(;o.length>0;){var r=o.shift();document.location=r}h=0}function m(r){for(var C=true,s=q.length;s--;)C=C&&r!=q[s];return C}function f(r,C){var s=[];for(var p in C)p&&s.push(p+"="+escape(C[p]));return"tile5://"+r+"/"+(s.length>0?"?"+s.join("&"):"")}function b(r,C){m(r)&&COG.Log.info("would push url: "+f(r,C))}function a(r,C){if(m(r)){o.push(f(r,C));h||(h=setTimeout(e,100))}}function g(){k={base:{name:"Unknown",eventTarget:document,supportsTouch:"createTouch"in document,imageCacheMaxSize:null,
getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:b,targetFps:null},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:a,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:a},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:a},android:{name:"Android OS <= 2.1",regex:/android/i,eventTarget:document.body,supportsTouch:true,getScaling:function(){return 1/
window.devicePixelRatio},bridgeNotify:a},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:a}};d=[k.froyo,k.android,k.ipod,k.iphone,k.ipad]}var k=null,d=[],l=null,h=0,o=[],q=["view.wake","tile.loaded"];T5.getConfig=function(){k||g();if(!l){COG.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var r=0;r<d.length;r++){var C=d[r];if(C.regex&&C.regex.test(navigator.userAgent)){l=T5.ex({},k.base,C);COG.Log.info("PLATFORM DETECTED AS: "+
l.name);break}}if(!l){COG.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");l=k.base}COG.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return l}})();
T5.Resources=function(){var e="",m={},f={getPath:function(b){return/^(file|https?|\/)/.test(b)?b:e+b},setBasePath:function(b){e=b},loadResource:function(b){b=T5.ex({filename:"",cacheable:true,dataType:null,callback:null},b);var a=function(g){b.callback&&COG.Log.watch("CALLING RESOURCE CALLBACK",function(){b.callback(g)})};b.cacheable&&m[b.filename]?a(m[b.filename]):COG.xhr({url:f.getPath(b.filename),dataType:b.dataType,success:function(g){if(b.cacheable)m[b.filename]=g;a(g)},error:function(g,k,d){COG.Log.error("error loading resource ["+
b.filename+"], error = "+d)}})},loadSnippet:function(b,a){/\.\w+$/.test(b)||(b+=".html");f.loadResource({filename:"snippets/"+b,callback:a,dataType:"html"})}};return f}();
T5.Images=function(){function e(){var s=g[this.id];if(s&&s.image.complete&&s.image.width>0){s.loaded=true;s.hitCount=1;for(var p=l.length;p--;)if(l[p].image.src==this.src){l.splice(p,1);break}if(s.background||s.postProcess)if(s.image){p=T5.newCanvas(s.realSize?s.realSize.width:image.width,s.realSize?s.realSize.height:image.height);var w=p.getContext("2d"),t=s.offset?s.offset:new T5.Vector;s.background&&w.drawImage(s.background,0,0);w.drawImage(s.image,t.x,t.y);s.postProcess&&s.postProcess(w,s);s.image=
p}s.loadCallback&&s.loadCallback(this,false);h.push({url:this.src,created:s.requested});delete g[this.id];m()}}function m(){for(var s=T5.getConfig().maxImageLoads;d.length>0&&(!s||l.length<s);){var p=d.shift();if(p.imageLoader){l.push(p);p.imageLoader(p,e)}}}function f(s){for(var p=null,w=o.length;w--&&!p;)p=o[w](s);return p?p:function(t,E){t.image.onload=E;t.image.src=T5.Resources.getPath(t.url);t.requested=T5.time()}}function b(){r=true;try{var s=Math.floor(h.length/2);if(s>0){h.sort(function(w,
t){return w.created-t.created});for(var p=s;p--;)delete a[h[p].url];h.splice(0,s)}}finally{r=false}COG.say("imagecache.cleared")}var a={},g={},k=0,d=[],l=[],h=[],o=[],q=0,r=false,C={avgImageSize:25,loadTimeout:10,addInterceptor:function(s){o.push(s)},cancelLoad:function(){l=[]},get:function(s){var p=null,w=null;r||(p=a[s]);if((w=p?p.image:null)&&(w.getContext||w.complete&&w.width>0))return w},load:function(s,p,w){var t=a[s];if(t){t.hitCount++;t.image.complete&&p&&p(t.image,true)}else{t=T5.ex({url:s,
image:new Image,loaded:false,imageLoader:f(s),created:T5.time(),requested:null,hitCount:0,loadCallback:p},w);t.image.id="resourceLoaderImage"+k++;a[s]=t;g[t.image.id]=t;d.push(t);m()}return t},stats:function(){return{imageLoadingCount:l.length,queuedImageCount:d.length,imageCacheFullness:q}}};setInterval(function(){for(var s=T5.time(),p=false,w=0,t=T5.getConfig();w<l.length;)if(s-l[w].requested>C.loadTimeout*1E3){l.splice(w,1);p=true}else w++;p&&m();if(t&&t.imageCacheMaxSize){q=h.length*C.avgImageSize/
t.imageCacheMaxSize;q>=1&&b()}},1E3);return C}();
(function(){function e(n,x){var v=n&&n.length>0?n[0]:null;if(v&&x&&x.length>0)return t(v,x[0]);return null}function m(n){n.preventDefault();n.stopPropagation()}function f(n){for(var x=Array(n.length),v=n.length;v--;)x[v]=p(n[v].pageX,n[v].pageY);return x}var b=120,a=100,g=250,k=300,d=5,l=2,h=0,o=1,q=2,r=7,C=0,s=0,p=T5.V.create,w=T5.V.distance,t=T5.V.diff,E=function(n){function x(G,J,B,F){var K=Math.asin((G.y-J.y)/B);B=Math.min(Math.floor(B*(Z.duration/F)),Z.max);K=J.x>G.x?K:Math.PI-K;G=p(Math.cos(K)*
-B,Math.sin(K)*B);A("inertiaPan",G.x,G.y)}function v(G,J){var B,F;if(Q){B=J-$;if(B<g){F=w([P[0],G]);F>n.inertiaTrigger&&x(P[0],G,F,B)}}else{aa=G;var K=setInterval(function(){B=T5.time()-J;F=w([G,aa]);if(B<a&&F>n.inertiaTrigger){clearInterval(K);x(G,aa,F,B)}else B>a&&clearInterval(K)},5)}}function y(G){for(var J=[],B=S?-S.offsetLeft:0,F=S?-S.offsetTop:0,K=G.length;K--;)J.push(T5.V.offset(G[K],B,F));return J}function A(){ha&&ha.trigger.apply(null,arguments)}function D(G){if(G.target&&G.target===S){P=
Q?f(G.touches):[p(G.pageX,G.pageY)];V=p();U=p();da=true;L=false;$=T5.time();m(G);G.target.style.cursor="move";A("inertiaCancel");ga=$;if(G=P.length>0?P[0]:null){A("touchStart",G.x,G.y);if(ga-ba<k)if((G=X?T5.V.diff(P[0],X[0]):null)&&Math.abs(G.x)<n.maxDistDoubleTap&&Math.abs(G.y)<n.maxDistDoubleTap)L=true;N=h;X=[].concat(P)}else COG.Log.warn("Touch start fired, but no touch vector found")}}function z(G){if(G.target&&G.target===S){aa=(Q?f(G.touches):[p(G.pageX,G.pageY)])[0];if(da){Q&&m(G);G=Q?f(G.touches):
[p(G.pageX,G.pageY)];var J=0;if(G.length>1){if(P.length===1)P=[].concat(G);J=w(P)-w(G)}if(N===h){var B=e(G,P);if(B&&(Math.abs(B.x)>=r||Math.abs(B.y)>=r))N=o}if(N!==h)if(!J||Math.abs(J)<d){if(V=e(G,X)){U.x-=V.x;U.y-=V.y;Y.x-=V.x;Y.y-=V.y}if(T5.V.absSize(Y)>l){A("pan",Y.x,Y.y);Y=p()}N=o}else{A("pinchZoom",y(P),y(G));N=q}X=[].concat(G)}}}function H(G){if(G.target&&G.target===S){var J=(Q?f(G.changedTouches):[p(G.pageX,G.pageY)])[0];Q&&m(G);var B=T5.time();ba=ga;if(N===h)R||(R=setTimeout(function(){R=
0;var F=L?"doubleTap":"tap",K=P[0],O=null;if(S)O=T5.V.offset(K,-S.offsetLeft,-S.offsetTop);A(F,K,O)},k+50));else if(N==o){A("panEnd",U.x,U.y);Z&&v(J,B)}else N==q&&A("pinchZoomEnd",y(P),y(X),B-$);G.target.style.cursor="default";da=false}}function I(G){if(G.target&&G.target===S){var J;if(G.detail){J=-G.detail*b;J=p(G.axis===1?J:0,G.axis===2?J:0)}else J=p(G.wheelDeltaX,G.wheelDeltaY);var B=J.y!==0?Math.abs(J.y/b):0;if(aa&&B!==0){var F=T5.V.offset(aa,-S.offsetLeft,-S.offsetTop);A("wheelZoom",F,Math.pow(2,
J.y>0?B:-B))}G.preventDefault()}}n=T5.ex({element:null,observable:null,inertiaTrigger:20,maxDistDoubleTap:20,touchStartHandler:null,moveHandler:null,moveEndHandler:null,pinchZoomHandler:null,pinchZoomEndHandler:null,tapHandler:null,doubleTapHandler:null,wheelZoomHandler:null},n);var L=false,R=0,M=T5.getConfig(),Q=T5.getConfig().supportsTouch,P=null,X=null,V=null,U=null,Y=p(),N=null,da=false,$=0,W=[],aa=null,Z=null,ga=0,ba=0,S=n.element,ha=n.observable,ja={supportsTouch:Q,addListeners:function(G){W.push(G)},
decoupleListeners:function(G){for(var J=0;G&&J<W.length;J++)if(W[J].listenerId===G){W.splice(J,1);break}},release:function(){M.eventTarget.removeEventListener(Q?"touchstart":"mousedown",D,false);M.eventTarget.removeEventListener(Q?"touchmove":"mousemove",z,false);M.eventTarget.removeEventListener(Q?"touchend":"mouseup",H,false);if(!Q){window.removeEventListener("mousewheel",I,false);window.removeEventListener("DOMMouseScroll",I,false)}},inertiaEnable:function(G,J){Z={duration:G,max:J?Math.min(J.width,
J.height):500}},inertiaDisable:function(){Z=null}};M.eventTarget.addEventListener(Q?"touchstart":"mousedown",D,false);M.eventTarget.addEventListener(Q?"touchmove":"mousemove",z,false);M.eventTarget.addEventListener(Q?"touchend":"mouseup",H,false);if(!Q){window.addEventListener("mousewheel",I,false);window.addEventListener("DOMMouseScroll",I,false)}return ja},u=[];T5.captureTouch=function(n,x){if(!n)throw Error("Unable to capture touch of null element");if(!n.id)n.id="touchable_"+C++;var v=u[n.id];
if(!v){v=new E(T5.ex({element:n},x));u[n.id]=v}x.listenerId&&v.decoupleListeners(x.listenerId);x.listenerId=++s;v.addListeners(x);return v};T5.resetTouch=function(n){if(n&&n.id&&u[n.id]){u[n.id].release();delete u[n.id]}}})();
T5.Dispatcher=function(){var e=[],m={execute:function(f){var b=m.findAction(f);b&&b.execute.apply(b,Array.prototype.slice.call(arguments,1))},findAction:function(f){for(var b=e.length;b--;)if(e[b].id==f)return e[b];return null},getRegisteredActions:function(){return[].concat(e)},getRegisteredActionIds:function(){for(var f=[],b=e.length;b--;)e[b].id&&f.push(e[b].id);return f},registerAction:function(f){f&&f.id&&e.push(f)},Action:function(f){f=T5.ex({autoRegister:true,id:"",title:"",icon:"",execute:null},
f);var b={id:f.id,execute:function(){f.execute&&f.execute.apply(this,arguments)},getParam:function(a){return f[a]?f[a]:""},toString:function(){return COG.formatStr("{0} [title = {1}, icon = {2}]",b.id,f.title,f.icon)}};f.autoRegister&&m.registerAction(b);return b},Agent:function(f){f=COG.extend({name:"Untitled",translator:null,execute:null},f);var b={getName:function(){return f.name},getParam:function(a){return f[a]},getId:function(){return COG.toID(b.getName())},run:function(a,g){if(f.execute){var k=
f.translator?f.translator(a):a;f.execute.call(b,k,function(d,l){g&&g(d,l,k)})}}};return b},runAgents:function(f,b,a){for(var g=0;g<f.length;g++)f[g].run(b,a)}};return m}();
(function(){var e=Math.PI*2,m=Math.PI/2,f=Math.abs,b=Math.pow,a=Math.sin,g=Math.asin,k=Math.cos,d=1.70158,l={linear:function(h,o,q,r){return q*h/r+o},backin:function(h,o,q,r){return q*(h/=r)*h*((d+1)*h-d)+o},backout:function(h,o,q,r){return q*((h=h/r-1)*h*((d+1)*h+d)+1)+o},backinout:function(h,o,q,r){return(h/=r/2)<1?q/2*h*h*(((d*=1.525)+1)*h-d)+o:q/2*((h-=2)*h*(((d*=1.525)+1)*h+d)+2)+o},bouncein:function(h,o,q,r){return q-l.bounceout(r-h,0,q,r)+o},bounceout:function(h,o,q,r){return(h/=r)<1/2.75?
q*7.5625*h*h+o:h<2/2.75?q*(7.5625*(h-=1.5/2.75)*h+0.75)+o:h<2.5/2.75?q*(7.5625*(h-=2.25/2.75)*h+0.9375)+o:q*(7.5625*(h-=2.625/2.75)*h+0.984375)+o},bounceinout:function(h,o,q,r){return h<r/2?l.bouncein(h*2,0,q,r)/2+o:l.bounceout(h*2-r,0,q,r)/2+q/2+o},cubicin:function(h,o,q,r){return q*(h/=r)*h*h+o},cubicout:function(h,o,q,r){return q*((h=h/r-1)*h*h+1)+o},cubicinout:function(h,o,q,r){if((h/=r/2)<1)return q/2*h*h*h+o;return q/2*((h-=2)*h*h+2)+o},elasticin:function(h,o,q,r,C,s){if(h==0)return o;if((h/=
r)==1)return o+q;s||(s=r*0.3);if(!C||C<f(q)){C=q;q=s/4}else q=s/e*g(q/C);return-(C*b(2,10*(h-=1))*a((h*r-q)*e/s))+o},elasticout:function(h,o,q,r,C,s){var p;if(h==0)return o;if((h/=r)==1)return o+q;s||(s=r*0.3);if(!C||C<f(q)){C=q;p=s/4}else p=s/e*g(q/C);return C*b(2,-10*h)*a((h*r-p)*e/s)+q+o},elasticinout:function(h,o,q,r,C,s){var p;if(h==0)return o;if((h/=r/2)==2)return o+q;s||(s=r*0.3*1.5);if(!C||C<f(q)){C=q;p=s/4}else p=s/e*g(q/C);if(h<1)return-0.5*C*b(2,10*(h-=1))*a((h*r-p)*e/s)+o;return C*b(2,
-10*(h-=1))*a((h*r-p)*e/s)*0.5+q+o},quadin:function(h,o,q,r){return q*(h/=r)*h+o},quadout:function(h,o,q,r){return-q*(h/=r)*(h-2)+o},quadinout:function(h,o,q,r){if((h/=r/2)<1)return q/2*h*h+o;return-q/2*(--h*(h-2)-1)+o},sinein:function(h,o,q,r){return-q*k(h/r*m)+q+o},sineout:function(h,o,q,r){return q*a(h/r*m)+o},sineinout:function(h,o,q,r){return-q/2*(k(Math.PI*h/r)-1)+o}};T5.easing=function(h){return l[h.replace(/[\-\_\s\.]/g,"").toLowerCase()]};T5.registerEasingType=function(h,o){l[h.replace(/[\-\_\s\.]/g,
"").toLowerCase()]=o}})();
T5.Tween=function(e){e=T5.ex({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:T5.easing("sine.out"),complete:null,cancelOnInteract:false},e);var m=T5.time(),f=[],b=false,a=0,g=0,k={cancelOnInteract:e.cancelOnInteract,isComplete:function(){return b},triggerComplete:function(d){e.complete&&e.complete(d)},update:function(d){try{var l=e.tweenFn(d-m,a,g,e.duration);if(e.target)e.target[e.property]=l;for(var h=f.length;h--;)f[h](l,void 0);if(b=m+e.duration<=d){if(e.target)e.target[e.property]=
e.tweenFn(e.duration,a,g,e.duration);for(var o=f.length;o--;)f[o](l,true)}}catch(q){COG.Log.exception(q)}},requestUpdates:function(d){f.push(d)}};a=e.target&&e.property&&e.target[e.property]?e.target[e.property]:e.startValue;if(typeof e.endValue!=="undefined")g=e.endValue-a;if(g==0)b=true;T5.wakeTweens();return k};
(function(){var e=[],m=false,f=0;T5.tweenValue=function(b,a,g,k,d){b=new T5.Tween({startValue:b,endValue:a,tweenFn:g,complete:k,duration:d});e.push(b);return b};T5.tween=function(b,a,g,k,d,l){b=new T5.Tween({target:b,property:a,endValue:g,tweenFn:k,duration:l,complete:d});e.push(b);return b};T5.tweenVector=function(b,a,g,k,d,l){var h=[];if(b){var o=b.x==a,q=b.y==g;o||h.push(T5.tween(b,"x",a,k,function(){(o=true)&&q&&d()},l));q||h.push(T5.tween(b,"y",g,k,function(){q=true;o&&q&&d()},l))}return h};
T5.cancelAnimation=function(b){if(!m){m=true;try{for(var a=0;a<e.length;)if(!b||b(e[a])){e[a].triggerComplete(true);e.splice(a,1)}else a++}finally{m=false}}};T5.isTweening=function(){return e.length>0};T5.wakeTweens=function(){if(f===0)f=setInterval(function(){var b;b=T5.time();if(!m){m=true;try{for(var a=0;a<e.length;)if(e[a].isComplete()){e[a].triggerComplete(false);e.splice(a,1)}else{e[a].update(b);a++}}finally{m=false}}b=e.length;if(b===0){clearInterval(f);f=0}},20)}})();
(function(){var e={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,PINCH:16,FREEZE:128};T5.viewState=function(){for(var m=0,f=arguments.length;f--;){var b=e[arguments[f].toUpperCase()];if(b)m|=b}return m}})();
T5.ViewLayer=function(e){e=T5.ex({id:"",zindex:0,supportFastDraw:false,validStates:T5.viewState("ACTIVE","ANIMATING","PAN","PINCH")},e);var m=null,f=e.id,b=T5.viewState("ACTIVE"),a=T5.ex({addToView:function(g){g.setLayer(f,a)},shouldDraw:function(g){var k=m?m.fastDraw&&g!==b:false;return(g&e.validStates)!==0&&(k?e.supportFastDraw:true)},cycle:function(){return 0},draw:function(){},remove:function(){COG.say("layer.remove",{id:f})},wakeParent:function(){m&&m.trigger("wake")},getId:function(){return f},
setId:function(g){f=g},getParent:function(){return m},setParent:function(g){m=g}},e);COG.observable(a);return a};
T5.View=function(e){function m(B,F,K,O){I=typeof K!=="undefined";S=ga;w();J.updateOffset(n.x+B,n.y+F,K,O)}function f(B,F){e.inertia&&m(B,F,e.panAnimationEasing,e.panAnimationDuration)}function b(){S=Z;I=false;setTimeout(w,50)}function a(B,F){U=ha(B);Y=ha(F);var K=ja(U.dimensions),O=ja(Y.dimensions);W=G(U);z=G(Y);N=U&&K!==0?O/K:1}function g(B,F){a(B,F);if(V=N!==1){S=ba;w()}}function k(B,F,K){a(B,F);if(e.adjustScaleFactor){N=e.adjustScaleFactor(N);COG.Log.info("scale factor adjusted to: "+N)}if(K<e.pinchZoomAnimateTrigger){q(da,
N,W,r(),T5.easing("sine.out"),function(){l();N=1},300);N=da}else{l();N=1}}function d(B,F){J.zoom(B,Math.min(Math.pow(2,Math.round(Math.log(F))),8),500)}function l(){V=false;J.trigger("scale",N,U?r():z);S=Z;w()}function h(){if(E){T5.resetTouch(E);if(e.autoSize){E.height=window.innerHeight-E.offsetTop;E.width=window.innerWidth-E.offsetLeft}try{u=E.getContext("2d");u.globalCompositeOperation="source-over";u.clearRect(0,0,E.width,E.height)}catch(B){COG.Log.exception(B);throw Error("Could not initialise canvas on specified view element");
}aa=T5.captureTouch(E,{observable:J});e.inertia&&aa.inertiaEnable(e.panAnimationDuration,A);A=J.getDimensions();for(var F=t.length;F--;)layerContextChange(t[F]);w()}}function o(B,F){F.setId(B);F.added=T5.time();F.trigger("contextChanged",u);F.setParent(J);t.push(F);t.sort(function(K,O){var T=O.zindex-K.zindex;if(T===0)T=O.added-K.added;return T})}function q(B,F,K,O,T,ca,ea){function ia(){ca&&ca();l();N=1;$=null}V=true;W=T5.V.copy(K);z=T5.V.copy(O);U=null;if(T)T5.tweenValue(0,F-B,T,ia,ea?ea:1E3).requestUpdates(function(fa){$=
fa/(F-B);N=B+fa;S=ba;w();J.trigger("animate")});else{N=targetScaleFactor;ia()}}function r(){var B=T5.D.getCenter(A),F=T5.V.distance([z,B]),K=T5.V.theta(z,B,F),O=T5.V.diff(W,z);B=T5.V.pointOnEdge(z,B,K,F/N);B.x+=O.x;B.y+=O.y;return B}function C(){J.trigger("idle");H=true;M=0}function s(B,F){var K=0,O=v?T5.viewState("FROZEN"):S,T=T5.time(),ca=(O&ba)!==0,ea=0;if(x||ca){B.clearRect(0,0,E.width,E.height);x=false}if(ca){T5.D.getCenter(A);var ia=($?$:1)/2,fa=T5.V.diff(W,z);if(P=U?new T5.Vector(z.x+fa.x,
z.y+fa.y):new T5.Vector(z.x-fa.x*ia,z.y-fa.y*ia))F=T5.V.offset(F,P.x,P.y)}B.save();try{da=N;if(y!==1)B.scale(y,y);else if(ca){B.translate(z.x,z.y);B.scale(N,N)}for(ea=t.length;ea--;)if(t[ea].shouldDraw(O)){var ka=t[ea].draw(B,F,A,O,J);K+=ka?ka:0}}finally{B.restore()}COG.Log.trace("draw complete",T);R=false;return K}function p(){var B=0,F=!I&&(S===ba||S===ga);X=T5.time();n.x=Math.floor(n.x);n.y=Math.floor(n.y);if(F){T5.cancelAnimation(function(O){return O.cancelOnInteract});H=false;if(M!==0){clearTimeout(M);
M=0}}for(F=t.length;F--;){var K=t[F].cycle(X,n,S);B+=K?K:0}B+=s(u,n);L=0;if(D+B>0)w();else if(!H&&M===0)M=setTimeout(C,500);COG.Log.trace("Completed draw cycle",X)}function w(){D++;if(!(v||L!==0)){D=0;L=setTimeout(p,0)}}e=T5.ex({id:COG.objId("view"),container:"",fastDraw:false,inertia:true,pannable:true,scalable:true,panAnimationEasing:T5.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:false},e);var t=[],E=document.getElementById(e.container),
u=null,n=new T5.Vector,x=false,v=false,y=1,A=null,D=0,z=null,H=false,I=false,L=0,R=false,M=0,Q=0,P=null,X=0,V=false,U=null,Y=null,N=1,da=1,$=null,W=null,aa=null,Z=T5.viewState("ACTIVE"),ga=T5.viewState("PAN"),ba=T5.viewState("PINCH"),S=Z,ha=T5.V.getRect,ja=T5.D.getSize,G=T5.R.getCenter,J={id:e.id,deviceScaling:y,fastDraw:e.fastDraw||T5.getConfig().requireFastDraw,animate:function(B,F,K,O,T){q(N,B,F,K,O,T)},centerOn:function(B){J.setOffset(B.x-E.width/2,B.y-E.height/2)},getDimensions:function(){if(E)return new T5.Dimensions(E.width,
E.height)},getZoomCenter:function(){return P},getLayer:function(B){for(var F=0;F<t.length;F++)if(t[F].getId()==B)return t[F];return null},setLayer:function(B,F){for(var K=0;K<t.length;K++)if(t[K].getId()===B){t.splice(K,1);break}F&&o(B,F);w()},eachLayer:function(B){for(var F=0;F<t.length;F++)B(t[F])},clearBackground:function(){x=true},freeze:function(){v=true},unfreeze:function(){v=false;w()},needRepaint:function(){return R},snapshot:function(){},scale:function(B,F,K,O,T){O||(O=T5.D.getCenter(A));
T||(T=T5.D.getCenter(A));J.animate(B,O,T,F,K);return J},removeLayer:function(B){a:{for(var F=t.length;F--;)if(t[F].getId()==B){B=F;break a}B=-1}if(B>=0&&B<t.length){COG.say("layer.removed",{layer:t[B]});t.splice(B,1)}},getOffset:function(){return T5.V.copy(n)},setOffset:function(B,F){n.x=B;n.y=F},updateOffset:function(B,F,K,O,T){function ca(){b(0,0);T&&T()}if(K){B=new T5.Vector(B,F);K=T5.tweenVector(n,B.x,B.y,K,ca,O);for(O=K.length;O--;){K[O].cancelOnInteract=true;K[O].requestUpdates(w)}}else J.setOffset(B,
F)},zoom:function(B,F,K){I=false;N=F;V=N!==1;W=T5.D.getCenter(J.getDimensions());z=N>1?T5.V.copy(B):T5.D.getCenter(J.getDimensions());U=null;clearTimeout(Q);if(V){S=ba;w();if(K)Q=setTimeout(function(){l();N=1},parseInt(K,10))}}};COG.listen("layer.remove",function(B){B.id&&J.removeLayer(B.id)});y=T5.getConfig().getScaling();COG.observable(J);J.bind("wake",w);J.bind("invalidate",function(){R=true});if(e.pannable){J.bind("pan",m);J.bind("panEnd",b);J.bind("inertiaPan",f);J.bind("inertiaCancel",function(){I=
false;w()})}if(e.scalable){J.bind("pinchZoom",g);J.bind("pinchZoomEnd",k);J.bind("wheelZoom",d)}COG.configurable(J,["inertia","container"],COG.paramTweaker(e,null,{container:function(B,F){E=document.getElementById(F);h()}}),true);h();return J};
T5.AnimatedPathLayer=function(e){function m(d,l,h){d.fillStyle="#FFFFFF";d.strokeStyle="#222222";d.beginPath();d.arc(h.x,h.y,4,0,Math.PI*2,false);d.stroke();d.fill()}e=T5.ex({path:[],id:COG.objId("pathAni"),easing:T5.easing("sine.inout"),validStates:T5.viewState("ACTIVE","PAN","PINCH"),drawIndicator:null,duration:2E3,autoCenter:false},e);var f=T5.V.edges(e.path),b,a=null,g=0;T5.tweenValue(0,f.total,e.easing,function(){k.remove()},e.duration).requestUpdates(function(d,l){g=d;l&&k.remove()});var k=T5.ex(new T5.ViewLayer(e),
{cycle:function(){for(var d=0;d<f.accrued.length&&f.accrued[d]<g;)d++;a=null;if(d<e.path.length-1){var l=g-(d>0?f.accrued[d-1]:0),h=e.path[d],o=e.path[d+1];b=T5.V.theta(h,o,f.edges[d]);a=T5.V.pointOnEdge(h,o,b,l);if(e.autoCenter)(d=k.getParent())&&d.centerOn(a)}return a?1:0},draw:function(d,l){if(a)(e.drawIndicator?e.drawIndicator:m)(d,l,new T5.Vector(a.x-l.x,a.y-l.y),b)}});return k};
(function(){T5.tileSize=256;T5.Tile=function(e){return e=T5.ex({x:0,y:0,gridX:0,gridY:0,dirty:false},e)};T5.ImageTile=function(e){e=T5.ex({url:"",sessionParamRegex:null,loaded:false},e);return new T5.Tile(e)}})();
T5.TileGrid=function(e){function m(v,y){var A=T5.Vector(v*d-o.x,y*d-o.y);return new T5.ImageTile({gridX:A.x,gridY:A.y})}function f(v,y,A,D){var z=Math.floor(e.gridSize*0.2),H=new T5.Vector;if(v<0||v+A>e.gridSize)H.x=v<0?-z:z;if(y<0||y+D>e.gridSize)H.y=y<0?-z:z;return H}function b(v,y,A){var D=COG.Log.getTraceTicks(),z=0,H=e.gridSize,I=e.tileSize;new T5.Vector(H/2,H/2);if(A)g=[];if(v)for(A=0;A<H;A++)for(var L=0;L<H;L++){if(!g[z]){var R=v(L,A,l,H);R.gridX=L*I-o.x;R.gridY=A*I-o.y;g[z]=R}z++}h=v;q=y;COG.Log.trace("tile grid populated",
D);x.dirty=true;x.wakeParent()}function a(v,y){if(n){var A,D=[],z=new T5.Vector(Math.floor((v.x+o.x)*C),Math.floor((v.y+o.y)*C));tilesNeeded=false;for(var H=u;H--;)for(var I=E;I--;){A=I+z.x>=0&&I+z.x<e.gridSize?g[(H+z.y)*e.gridSize+(I+z.x)]:null;var L=new T5.Vector(I-n.x,H-n.y);if(!A){t=f(z.x,z.y,E,u);A=m(I+z.x,H+z.y)}D.push({tile:A,centerness:T5.V.absSize(L)})}D.sort(function(R,M){return M.centerness-R.centerness});p||(p=Array(D.length));for(A=D.length;A--;){p[A]=D[A].tile;x.prepTile(p[A],y)}}}e=
T5.ex({tileSize:T5.tileSize,drawGrid:false,center:new T5.Vector,gridSize:25,shiftOrigin:null,supportFastDraw:true},e);var g=Array(Math.pow(e.gridSize,2)),k=e.gridSize,d=e.tileSize,l=T5.V.offset(e.center,-Math.ceil(e.gridSize>>1)),h=null,o=new T5.Vector,q=null,r=Math.round(e.tileSize/2),C=e.tileSize?1/e.tileSize:0,s=true,p=null,w=false;new T5.Vector;var t=new T5.Vector;T5.getConfig();k=k*e.tileSize;var E,u,n,x=T5.ex(new T5.ViewLayer(e),{gridDimensions:new T5.Dimensions(k,k),dirty:false,cycle:function(v,
y,A){v=0;if(t.x!==0||t.y!==0){var D=t,z=e.shiftOrigin;if(!(D.x===0&&D.y===0)){var H=COG.Log.getTraceTicks(),I=Array(g.length);I.length=g.length;for(var L=0;L<e.gridSize;L++)for(var R=0;R<e.gridSize;R++)I[R*e.gridSize+L]=L+D.x>=0&&L+D.x<e.gridSize?g[(R+D.y)*e.gridSize+(L+D.x)]:null;g=I;l=z?z(l,D):T5.V.add(l,D);o.x+=-D.x*e.tileSize;o.y+=-D.y*e.tileSize;COG.Log.trace("tile storage shifted",H);b(h,q)}t=new T5.Vector;v++}A!==T5.viewState("PINCH")&&a(y,A);return v+x.dirty?1:0},deactivate:function(){s=false},
find:function(v){if(!v)return null;for(var y=g.length;y--;){var A=g[y];if(A&&v(A))return A}return null},prepTile:function(){},drawTile:function(){return false},getTileSize:function(){return e.tileSize},draw:function(v,y,A,D,z){if(s){var H=T5.time(),I=y.x;y=y.y;var L=true,R=z.needRepaint()||D===T5.viewState("PAN")||D===T5.viewState("PINCH")||T5.isTweening();if(!n){E=Math.ceil(A.width*C)+1;u=Math.ceil(A.height*C)+1;n=new T5.Vector(Math.floor((E-1)/2),Math.floor((u-1)/2))}if(p){if(e.drawGrid)v.strokeStyle=
"rgba(50, 50, 50, 0.3)";v.beginPath();for(A=p.length;A--;){var M=p[A];if(M){var Q=M.gridX-I,P=M.gridY-y;if(!(R?false:!M.dirty)){L=x.drawTile(v,M,Q,P,D)&&L;M.x=Q;M.y=P}}else L=false;e.drawGrid&&v.rect(Q,P,e.tileSize,e.tileSize)}v.stroke();COG.Log.trace("drawn tiles",H);L&&!w&&z.trigger("tileDrawComplete");w=L;x.dirty=false}}},getTileAtXY:function(v,y){for(var A=e.tileSize,D=p?p.length:0;D--;){var z=p[D];if(z&&v>=z.x&&y>=z.y)if(v<=z.x+A&&y<=z.y+A)return z}return null},getTileVirtualXY:function(v,y,A){v=
T5.V.add(new T5.Vector(v,y),T5.V.invert(l),o);v=new T5.Vector(v.x*e.tileSize,v.y*e.tileSize);if(A){v.x+=r;v.y+=r}return v},populate:function(v){b(v,null,true)}});COG.listen("imagecache.cleared",function(){for(var v=g.length;v--;)if(g[v])g[v].loaded=false});COG.listen("tiler.repaint",function(){for(var v=g.length;v--;)if(g[v]){g[v].x=null;g[v].y=null}});return x};
T5.ImageTileGrid=function(e){function m(){q.getParent().trigger("invalidate");q.dirty=true;q.wakeParent()}e=T5.ex({emptyTile:function(r){if(!f||r!==f.width){f=T5.newCanvas(r,r);r=f.getContext("2d");r.fillStyle="rgba(150, 150, 150, 0.01)";r.fillRect(0,0,f.width,f.height)}return f}(T5.tileSize),panningTile:function(r){function C(){var s=T5.newCanvas(32,32),p=s.getContext("2d");p.fillStyle="#BBBBBB";p.fillRect(0,0,32,32);p.fillStyle="#C3C3C3";p.fillRect(0,0,16,16);p.fillRect(16,16,16,16);return s}if(!b||
r!==b.width){b=T5.newCanvas(r,r);r=b.getContext("2d");r.fillStyle=r.createPattern(C(),"repeat");r.fillRect(0,0,b.width,b.height)}return b}(T5.tileSize),tileOffset:new T5.Vector,tileDrawArgs:{}},e);var f=e.emptyTile,b=e.panningTile,a=T5.viewState("ACTIVE"),g=T5.viewState("PAN"),k=T5.getConfig().requireFastDraw,d=e.tileSize?e.tileSize:T5.tileSize,l=T5.Images.get,h=T5.Images.load,o=T5.ex({background:null,overlay:null,offset:new T5.Vector,realSize:new T5.Dimensions(d,d)},e.tileDrawArgs),q=T5.ex(new T5.TileGrid(e),
{drawTile:function(r,C,s,p,w){var t=C.url?l(C.url):null,E=false;if(t){r.drawImage(t,s,p);C.dirty=false;E=true}else if(w===g)b&&r.drawImage(b,s,p);else f&&r.drawImage(f,s,p);return E},prepTile:function(r,C){if(r)r.dirty=true;if(r&&(!k||C===a))l(r.url)||h(r.url,m,o)}});return q};
T5.Tiler=function(e){e=T5.ex({container:"",drawCenter:false,datasources:{},tileLoadThreshold:"first"},e);var m=T5.ex(new T5.View(e),{getTileLayer:function(){return m.getLayer("grid0")},setTileLayer:function(f){m.setLayer("grid0",f);COG.say("grid.updated",{id:"grid0"})},viewPixToGridPix:function(f){var b=m.getOffset();return new T5.Vector(f.x+b.x,f.y+b.y)},centerOn:function(f,b,a,g){var k=m.getTileLayer(),d=m.getDimensions();(k=k?k.getTileSize():0)&&m.updateOffset(f.gridX-Math.floor((d.width-k)*0.5),
f.gridY-Math.floor((d.height-k)*0.5),b,a,g)},cleanup:function(){m.removeLayer("grid0")},repaint:function(){COG.say("tiler.repaint");m.trigger("wake")},select:function(f){m.trigger("selectTile",f)}});m.bind("tap",function(f,b){var a=m.getTileLayer();if(a)(a=a.getTileAtXY(b.x,b.y))&&m.trigger("selectTile",a)});return m};
T5.Geo=function(){function e(u,n){var x=null;for(var v in t)if(n){if(v==n&&t[v][u]){x=t[v];break}}else if(t[v][u]){x=t[v];break}return x}function m(u,n){var x=l*Math.sin(u);return k-2*Math.atan(n*Math.pow((1-x)/(1+x),l/2))}function f(u,n,x,v){var y=0;u=u.toUpperCase();for(var A in v){var D=n[A];if(D){var z=x[A];D=z?z(u,D):COG.wordExists(u,D)?1:0;y+=D*v[A]}}return y}var b=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],a=Math.PI/180,g=180/Math.PI,k=Math.PI/
2,d=Math.PI*2,l=0.08181919084262157,h=null,o={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",HWY:"HIGHWAY",MWY:"MOTORWAY"},q=function(u,n){return{lat:parseFloat(u?u:0),lon:parseFloat(n?n:0)}},r=function(u,n){return{min:s.parse(u),max:s.parse(n)}},C=function(u){return u=T5.ex({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},u)},s=function(){var u={calcDistance:function(n,x){if(u.empty(n)||u.empty(x))return 0;var v=(x.lat-n.lat)*a/2,y=(x.lon-
n.lon)*a/2;v=Math.sin(v)*Math.sin(v)+Math.cos(n.lat*a)*Math.cos(x.lat*a)*Math.sin(y)*Math.sin(y);return 6371*2*Math.atan2(Math.sqrt(v),Math.sqrt(1-v))},copy:function(n){return n?new q(n.lat,n.lon):null},empty:function(n){return!n||n.lat===0&&n.lon===0},equal:function(n,x){return n&&x&&n.lat==x.lat&&n.lon==x.lon},almostEqual:function(n,x){return n&&x&&Math.floor(n.lat*1E3)===Math.floor(x.lat*1E3)&&Math.floor(n.lon*1E3)===Math.floor(x.lon*1E3)},inArray:function(n,x){for(var v=s.equal,y=x.length;y--;)if(v(n,
x[y]))return true;return false},inBounds:function(n,x){var v=!(s.empty(n)||s.empty(x));return v=(v=v&&n.lat>=x.min.lat&&n.lat<=x.max.lat)&&n.lon>=x.min.lon&&n.lon<=x.max.lon},parse:function(n){if(n)if(typeof n.lat!=="undefined")return u.copy(n);else{if(n.split)for(var x=[" ",","],v=0;v<x.length;v++){var y=n.split(x[v]);if(y.length===2)return new q(y[0],y[1])}}else return new q;return null},parseArray:function(n){var x=n.length,v=Array(x);for(x=x;x--;)v[x]=u.parse(n[x]);COG.Log.info("parsed "+v.length+
" positions");return v},fromMercatorPixels:function(n,x){return new q(T5.Geo.pix2lat(x),T5.Geo.normalizeLon(T5.Geo.pix2lon(n)))},toMercatorPixels:function(n){return new T5.Vector(T5.Geo.lon2pix(n.lon),T5.Geo.lat2pix(n.lat))},generalize:function(n,x,v){var y=n.length,A=[],D=null;v||(v=250);v/=1E3;COG.Log.info("generalizing positions, must include "+x.length+" positions");for(var z=y;z--;)if(z===0)A.unshift(n[z]);else{var H=!D||s.inArray(n[z],x)?v:s.calcDistance(D,n[z]);if(n[z]&&H>=v){A.unshift(n[z]);
D=n[z]}}COG.Log.info("generalized "+y+" positions into "+A.length+" positions");return A},toString:function(n){return n?n.lat+" "+n.lon:""}};return u}(),p=function(){var u=-k,n=k,x=-d,v={calcSize:function(y,A,D){var z=new T5.Vector(0,A.lat-y.lat);if(typeof D==="undefined")D=true;z.x=D&&y.lon>A.lon?360-y.lon+A.lon:A.lon-y.lon;return z},createBoundsFromCenter:function(y,A){var D=A/6371,z=y.lat*a,H=y.lon*a,I=z-D,L=z+D;if(I>u&&L<n){z=Math.asin(Math.sin(D)/Math.cos(z));D=H-z;if(D<x)D+=2*Math.PI;H=H+z;if(H>
d)H-=2*Math.PI}else{I=Math.max(I,u);L=Math.min(L,n);D=x;H=d}return new r(new q(I*g,D*g),new q(L*g,H*g))},expand:function(y,A){return new r(new q(y.min.lat-A,y.min.lon-E.normalizeLon(A)),new q(y.max.lat+A,y.max.lon+E.normalizeLon(A)))},forPositions:function(y,A){var D=null,z=T5.time();A||(A="auto");for(var H=y.length;H--;)if(D){var I=v.calcSize(D.min,y[H],false),L=v.calcSize(y[H],D.max,false);if(I.x<0)D.min.lon=y[H].lon;if(I.y<0)D.min.lat=y[H].lat;if(L.x<0)D.max.lon=y[H].lon;if(L.y<0)D.max.lat=y[H].lat}else D=
new T5.Geo.BoundingBox(y[H],y[H]);if(A){if(A=="auto"){H=v.calcSize(D.min,D.max);A=Math.max(H.x,H.y)*0.3}D=v.expand(D,A)}COG.Log.trace("calculated bounds for "+y.length+" positions",z);return D},getCenter:function(y){var A=p.calcSize(y.min,y.max);return new T5.Geo.Position(y.min.lat+A.y/2,y.min.lon+A.x/2)},getGeoHash:function(y){var A=T5.Geo.GeoHash.encode(y.min.lat,y.min.lon);y=T5.Geo.GeoHash.encode(y.max.lat,y.max.lon);COG.Log.info("min hash = "+A+", max hash = "+y)},getZoomLevel:function(y,A){var D=
v.getCenter(y),z=b[Math.min(Math.round(Math.abs(D.lat)*0.05),b.length)],H=v.calcSize(y.min,y.max);D=Math.ceil(Math.log(b[3]*A.height/H.y)/Math.log(2));z=Math.ceil(Math.log(z*A.width/H.x)/Math.log(2));return Math.min(isNaN(D)?1E3:D,isNaN(z)?1E3:z)},isEmpty:function(y){return!y||s.empty(y.min)||s.empty(y.max)},toString:function(y){return"min: "+s.toString(y.min)+", max: "+s.toString(y.max)}};return v}(),w=function(){var u=/^(\d+).*$/,n=/(\d+)\s?\-\s?(\d+)/;return{buildingMatch:function(x,v){u.lastIndex=
-1;if(u.test(x))for(var y=x.replace(u,"$1"),A=v.split(","),D=0;D<A.length;D++){n.lastIndex=-1;if(n.test(A[D])){var z=n.exec(A[D]);if(y>=parseInt(z[1],10)&&y<=parseInt(z[2],10))return true}else if(y==A[D])return true}return false},normalize:function(x){if(!x)return"";x=x.toUpperCase();if(!h){var v=[];for(var y in o)v.push(y);h=RegExp("(\\s)("+v.join("|")+")(\\s|$)","i")}h.lastIndex=-1;if(v=h.exec(x))x=x.replace(h,"$1"+o[v[2]]);return x},toString:function(x){return x.streetDetails+" "+x.location}}}(),
t={},E={Engine:function(u){if(!u.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var n=T5.ex({remove:function(){delete t[n.id]}},u);return t[n.id]=n},Radius:function(u,n){return{distance:parseInt(u,10),uom:n}},Position:q,BoundingBox:r,Address:C,GeocodeFieldWeights:{streetDetails:50,location:50},AddressCompareFns:{},GeoSearchResult:function(u){u=T5.ex({id:null,caption:"",resultType:"",data:null,pos:null,matchWeight:0},u);return T5.ex(u,{toString:function(){return u.caption+
(u.matchWeight?" ("+u.matchWeight+")":"")}})},GeoSearchAgent:function(u){return new T5.Dispatcher.Agent(u)},GeocodingAgent:function(u){u=T5.ex({name:"Geocoding Search Agent",paramTranslator:null,execute:function(n,x){try{if(!n.reverse&&!n.freeform)address=new C(n);var v=E.getEngine("geocode");if(v)v.geocode({addresses:[n.freeform?n.freeform:address],complete:function(A,D){if(x){var z=D;if(n.freeform)z=E.rankGeocodeResponses(n.freeform,z,E.getEngine("geocode"));x(z,u)}}})}catch(y){COG.Log.exception(y)}}},
u);return new E.GeoSearchAgent(u)},PointOfInterest:function(u){u=T5.ex({id:0,title:"",pos:null,lat:"",lon:"",group:"",retrieved:0,isNew:true},u);if(!u.pos&&u.lat&&u.lon)u.pos=new T5.Geo.Position(u.lat,u.lon);return T5.ex({toString:function(){return u.id+": '"+u.title+"'"}},u)},POIStorage:function(u){function n(z){z=z?z:"default";y[z]||(y[z]=[]);return y[z]}function x(z){var H=[];for(var I in y)for(var L=0;L<y[I].length;L++)if(!z||z(y[I][L]))H.push(y[I][L]);return H}function v(){COG.say("geo.pois-updated",
{srcID:D.id,pois:D.getPOIs()})}u=T5.ex({visibilityChange:null,onPOIDeleted:null,onPOIAdded:null},u);var y={},A=true,D={id:COG.objId(),getPOIs:function(){return x()},getOldPOIs:function(z,H){return x(function(I){return I.group==z&&I.retrieved<H})},getVisible:function(){return A},setVisible:function(z){if(z!=A){A=z;u.visibilityChange&&u.visibilityChange()}},findById:function(z){var H=x(function(I){return I.id==z});return H.length>0?H[0]:null},findByBounds:function(z){return x(function(H){return T5.Geo.P.inBounds(H.pos,
z)})},addPOIs:function(z,H){if(H)y={};for(var I=0;z&&I<z.length;I++){z[I].retrieved=T5.time();var L=z[I];n(L.group).push(L)}},removeGroup:function(z){if(y[z]){delete y[z];v()}},update:function(z){var H=[],I=0,L=z.length>0?z[0].group:"",R=T5.time();for(I=0;I<z.length;I++){var M;a:{if(M=z[I])for(var Q=n(M.group),P=0;P<Q.length;P++)if(Q[P].id==M.id){M=Q[P];break a}M=null}if(M){M.retrieved=R;M.isNew=false}else H.push(z[I])}z=D.getOldPOIs(L,R);D.addPOIs(H);for(I=0;u.onPOIAdded&&I<H.length;I++)u.onPOIAdded(H[I]);
for(I=0;I<z.length;I++){u.onPOIDeleted&&u.onPOIDeleted(z[I]);L=z[I];R=n(L.group);for(M=0;M<R.length;M++)if(R[M].id==L.id){R.splice(M,1);break}}H.length+z.length>0&&v()}};return D},MapProvider:function(){var u=1,n=20;return{zoomLevel:0,checkZoomLevel:function(x){return Math.min(Math.max(x,u),n)},getCopyright:function(){},getLogoUrl:function(){},getMapTiles:function(){},getZoomRange:function(){return{min:u,max:n}},setZoomRange:function(x,v){u=x;n=v}}},getEngine:function(u){for(var n=null,x=1;!n&&x<
arguments.length;x++)n=e(u,arguments[x]);n=n?n:e(u);if(!n)throw Error("Unable to find GEO engine with "+u+" capability");return n},rankGeocodeResponses:function(u,n,x){var v=[],y=E.AddressCompareFns;if(x&&x.compareFns)y=T5.ex({},y,x.compareFns);for(x=0;x<n.length;x++)v.push(new E.GeoSearchResult({caption:w.toString(n[x]),data:n[x],pos:n[x].pos,matchWeight:f(u,n[x],y,E.GeocodeFieldWeights)}));v.sort(function(A,D){return D.matchWeight-A.matchWeight});return v},P:s,B:p,A:w,dist2rad:function(u){return u/
6371},lat2pix:function(u){u=parseFloat(u)*a;u=Math.sin(u);var n=l*u;return Math.log((1+u)/(1-u)*Math.pow((1-n)/(1+n),l))/2},lon2pix:function(u){return parseFloat(u)*a},pix2lon:function(u){return E.normalizeLon(u)*g},pix2lat:function(u){u=Math.pow(Math.E,-u);for(var n=k-2*Math.atan(u),x=m(n,u),v=0;v<12&&Math.abs(n-x)>1.0E-7;){n=x;x=m(n,u);v++}return x*g},normalizeLon:function(u){for(;u<-180;)u+=360;for(;u>180;)u-=360;return u}};return E}();
T5.Geo.GeoHash=function(){function e(m,f,b){if(f&b)m[0]=(m[0]+m[1])/2;else m[1]=(m[0]+m[1])/2}BITS=[16,8,4,2,1];BASE32="0123456789bcdefghjkmnpqrstuvwxyz";NEIGHBORS={right:{even:"bc01fg45238967deuvhjyznpkmstqrwx"},left:{even:"238967debc01fg45kmstqrwxuvhjyznp"},top:{even:"p0r21436x8zb9dcf5h7kjnmqesgutwvy"},bottom:{even:"14365h7k9dcfesgujnmqp0r2twvyx8zb"}};BORDERS={right:{even:"bcfguvyz"},left:{even:"0145hjnp"},top:{even:"prxz"},bottom:{even:"028b"}};NEIGHBORS.bottom.odd=NEIGHBORS.left.even;NEIGHBORS.top.odd=
NEIGHBORS.right.even;NEIGHBORS.left.odd=NEIGHBORS.bottom.even;NEIGHBORS.right.odd=NEIGHBORS.top.even;BORDERS.bottom.odd=BORDERS.left.even;BORDERS.top.odd=BORDERS.right.even;BORDERS.left.odd=BORDERS.bottom.even;BORDERS.right.odd=BORDERS.top.even;return{decode:function(m){var f=1,b=[],a=[];b[0]=-90;b[1]=90;a[0]=-180;a[1]=180;lat_err=90;lon_err=180;for(i=0;i<m.length;i++){c=m[i];cd=BASE32.indexOf(c);for(j=0;j<5;j++){mask=BITS[j];if(f){lon_err/=2;e(a,cd,mask)}else{lat_err/=2;e(b,cd,mask)}f=!f}}b[2]=(b[0]+
b[1])/2;a[2]=(a[0]+a[1])/2;return{latitude:b,longitude:a}},encode:function(m,f,b){var a=1,g=[],k=[],d=0,l=0;b=b?b:12;geohash="";g[0]=-90;g[1]=90;k[0]=-180;for(k[1]=180;geohash.length<b;){if(a){mid=(k[0]+k[1])/2;if(f>mid){l|=BITS[d];k[0]=mid}else k[1]=mid}else{mid=(g[0]+g[1])/2;if(m>mid){l|=BITS[d];g[0]=mid}else g[1]=mid}a=!a;if(d<4)d++;else{geohash+=BASE32[l];l=d=0}}return geohash}}}();
T5.Geo.Search=function(){return{bestResults:function(e,m){m||(m=20);for(var f=e.length>0?e[0]:null,b=[],a=0;a<e.length;a++)if(f&&e[a]&&f.matchWeight-e[a].matchWeight<=m)b.push(e[a]);else break;return b}}}();
T5.Geo.Routing=function(){var e={calculate:function(m){m=T5.ex({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},m);COG.Log.info("attempting to calculate route");var f=T5.Geo.getEngine("route");f&&f.route(m,function(b){if(m.generalize)b.geometry=T5.Geo.P.generalize(b.geometry,b.getInstructionPositions());if(m.map){e.createMapOverlay(m.map,b);if(m.autoFit){COG.Log.info("AUTOFITTING MAP TO ROUTE: bounds = "+b.boundingBox);m.map.gotoBounds(b.boundingBox)}}m.success&&
m.success(b)})},createMapOverlay:function(m,f){var b=m.getDimensions();b=new T5.Geo.UI.RouteOverlay({data:f,width:b.width,height:b.height});m.setLayer("route",b)},parseTurnType:function(m){for(var f=e.TurnType.Unknown,b=T5.Geo.Routing.TurnTypeRules,a=0;a<b.length;a++){b[a].regex.lastIndex=-1;var g=b[a].regex.exec(m);if(g){f=b[a].customCheck?b[a].customCheck(m,g):b[a].turnType;break}}return f},TurnType:{Unknown:"turn-unknown",Start:"turn-none-start",Continue:"turn-none",Arrive:"turn-none-arrive",TurnLeft:"turn-left",
TurnLeftSlight:"turn-left-slight",TurnLeftSharp:"turn-left-sharp",TurnRight:"turn-right",TurnRightSlight:"turn-right-slight",TurnRightSharp:"turn-right-sharp",Merge:"merge",UTurnLeft:"uturn-left",UTurnRight:"uturn-right",EnterRoundabout:"roundabout-enter",Ramp:"ramp",RampExit:"ramp-exit"},Instruction:function(m){m=T5.ex({position:null,description:"",turnType:null},m);if(!m.turnType)m.turnType=e.parseTurnType(m.description);return m},RouteData:function(m){m=T5.ex({geometry:[],instructions:[],boundingBox:null},
m);if(!m.boundingBox)m.boundingBox=T5.Geo.B.forPositions(m.geometry);return T5.ex({getInstructionPositions:function(){for(var f=[],b=0;b<m.instructions.length;b++)m.instructions[b].position&&f.push(m.instructions[b].position);return f}},m)}};return e}();
T5.Geo.Routing.TurnTypeRules=function(){var e=T5.Geo.Routing.TurnType,m=[];m.push({regex:/continue/i,turnType:e.Continue});m.push({regex:/(take|bear|turn)(.*?)left/i,customCheck:function(f,b){return/bear/i.test(b[1])?e.TurnLeftSlight:e.TurnLeft}});m.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(f,b){return/bear/i.test(b[1])?e.TurnRightSlight:e.TurnRight}});m.push({regex:/enter\s(roundabout|rotaty)/i,turnType:e.EnterRoundabout});m.push({regex:/take.*?ramp/i,turnType:e.Ramp});m.push({regex:/take.*?exit/i,
turnType:e.RampExit});m.push({regex:/make(.*?)u\-turn/i,customCheck:function(f,b){return/right/i.test(b[1])?e.UTurnRight:e.UTurnLeft}});m.push({regex:/proceed/i,turnType:e.Start});m.push({regex:/arrive/i,turnType:e.Arrive});m.push({regex:/fell\sthrough/i,turnType:e.Merge});return m}();
T5.Geo.UI=function(){var e=0,m={AnnotationTween:null,GeoTileGrid:function(f){f=T5.ex({grid:null,centerPos:new T5.Geo.Position,centerXY:new T5.Vector,radsPerPixel:0},f);var b=f.radsPerPixel,a=T5.Geo.P.toMercatorPixels(f.centerPos);COG.Log.info("tile grid created, rads per pixel = "+b);var g=a.x/b-f.centerXY.x,k=a.y/b-f.centerXY.y,d=T5.ex({},f.grid,{getBoundingBox:function(l,h,o,q){return new T5.Geo.BoundingBox(d.pixelsToPos(new T5.Vector(l,h+q)),d.pixelsToPos(new T5.Vector(l+o,h)))},getGridXYForPosition:function(l){l=
T5.Geo.P.toMercatorPixels(l);return new T5.Vector(l.x/b-g,d.gridDimensions.height-(l.y/b-k))},getPixelDistance:function(l){l=T5.Geo.dist2rad(l);return Math.floor(l/f.radsPerPixel)},pixelsToPos:function(l){return T5.Geo.P.fromMercatorPixels((g+l.x)*b,(k+d.gridDimensions.height-l.y)*b)}});return d},RouteOverlay:function(f){f=T5.ex({data:null,pixelGeneralization:8,calculationsPerCycle:250,partialDraw:false,strokeStyle:"rgba(0, 51, 119, 0.9)",waypointFillStyle:"#FFFFFF",lineWidth:4,zindex:50},f);var b=
true,a=null,g=[],k=0,d=[],l=[],h=T5.ex(new T5.ViewLayer(f),{getAnimation:function(o,q,r,C){if(b)return null;var s="routeAnimation"+e++;l.push(s);return new T5.AnimatedPathLayer({id:s,path:g,zindex:f.zindex+1,easing:o?o:T5.T5.easing("sine.inout"),duration:q?q:5E3,drawIndicator:r,autoCenter:C?C:false})},draw:function(o,q,r,C,s){r=0;C=f.data?f.data.geometry:null;if(b){b=false;a=null;g=[];k=0}if(C&&k<C.length){a:{s=s.getTileLayer();d=[];if(s){C=COG.Log.getTraceTicks();var p,w,t,E=f.data?f.data.geometry:
[],u=E.length,n=f.data?f.data.instructions:[],x=n.length,v=f.calculationsPerCycle,y=0;for(p=k;p<u;p++){w=s.getGridXYForPosition(E[p]);if(t=!a||p===0||Math.abs(w.x-a.x)+Math.abs(w.y-a.y)>f.pixelGeneralization){g.push(w);a=w}y++;if(y>=v){k=p;break a}}k=u;COG.Log.trace(u+" geometry points generalized to "+g.length+" coordinates",C);a=null;for(p=x;p--;)if(n[p].position){w=s.getGridXYForPosition(n[p].position);if(t=!a||p===0||Math.abs(w.x-a.x)+Math.abs(w.y-a.y)>f.pixelGeneralization){d.push(w);a=w}}}}r++}s=
g.length;if(s>0&&(!r||f.partialDraw)){o.strokeStyle=f.strokeStyle;o.lineWidth=f.lineWidth;o.beginPath();o.moveTo(g[s-1].x-q.x,g[s-1].y-q.y);for(s=s;s--;)o.lineTo(g[s].x-q.x,g[s].y-q.y);o.stroke();o.fillStyle=f.waypointFillStyle;for(s=d.length;s--;){o.beginPath();o.arc(d[s].x-q.x,d[s].y-q.y,2,0,Math.PI*2,false);o.stroke();o.fill()}}return r}});COG.listen("grid.updated",function(){for(var o=l.length;o--;)COG.say("layer.remove",{id:l[o]});l=[];b=true;h.wakeParent()});return h},Annotation:function(f){f=
T5.ex({xy:null,pos:null,draw:null,calcXY:null,tweenIn:m.AnnotationTween,animationSpeed:null},f);var b=false,a={xy:f.xy,pos:f.pos,isNew:true,isAnimating:function(){return b},calcXY:function(g){a.xy=g.getGridXYForPosition(a.pos);f.calcXY&&f.calcXY(g)},draw:function(g,k,d,l,h){if(a.xy){if(a.isNew&&f.tweenIn){var o=a.xy.y;a.xy.y=k.y-20;b=true;T5.tween(a.xy,"y",o,f.tweenIn,function(){a.xy.y=o;b=false},f.animationSpeed?f.animationSpeed:250+Math.random()*500)}if(f.draw)f.draw(g,k,new T5.Vector(a.xy.x-k.x,
a.xy.y-k.y),d,l,h);else{g.beginPath();g.arc(a.xy.x-k.x,a.xy.y-k.y,4,0,Math.PI*2,false);g.fill()}a.isNew=false}}};return a},ImageAnnotation:function(f){f=T5.ex({imageUrl:null,animatingImageUrl:null,imageAnchor:null},f);var b=f.imageAnchor?T5.V.invert(f.imageAnchor):null;f.draw=function(g,k,d,l,h){if(f.animatingImageUrl&&a.isAnimating()){T5.Images.load(f.imageUrl);l=f.animatingImageUrl}else l=f.imageUrl;if(k=T5.Images.get(l)){if(k.complete&&k.width>0){b||(b=new T5.Vector(-k.width>>1,-k.height>>1));
d=T5.V.offset(d,b.x,b.y);g.drawImage(k,d.x,d.y,k.width,k.height)}}else T5.Images.load(l,function(){h.wakeParent()})};var a=new m.Annotation(f);return a},LocationAnnotation:function(f){f=T5.ex({accuracy:null},f);var b=new Image,a=new T5.Vector,g=null;b.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAACIQAAAiEBPhEQkwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAG+SURBVCiRlZHNahNRAIW/O7mTTJPahLZBA1YUyriINRAE3bQIKm40m8K8gLj0CRQkO32ELHUlKbgoIu4EqeJPgtCaoBuNtjXt5LeTMZk0mbmuWiuuPLsD3+HAOUIpxf9IHjWmaUbEyWv5ROrsVULhcHP761rUfnN3Y2Otc8CIg4YT85lzuVsPP+Qupw1vpPjRCvhS9ymvV0e77x7nNj+uvADQAIQQ+uLyvdfLV9JGZi7EdEwQlqBpEJ019f0z1mo2u5Q8DMydv25lshemmj1FueZTawbs7inarqLbV7Qjab1upB9YlhWSAHLavLHZCvg1VEhN0PMU9W7At4bPVidg7CtkLLXkut+lBPD6/Ub155jJiADAHSpaLmx3ApyBQoYEUd0PBoOBkAC6+3llvda/YxgGgYL+UNHf/zN3KiExGlsvTdP0NYDkhPdWrz35ZDsBzV5wCMuQwEyFmXFeeadjzfuFQmGkAZRKpdGC/n7x+M6jqvA9Zo6FWDhlcHE+wqT93J1tP7vpOE7rrx8ALMuasPf8S12St4WmJ6bYWTUC52k8Hm8Vi0X/nwBAPp/XKpWKdF1X2LYdlMvlsToC/QYTls7DLFr/PAAAAABJRU5ErkJggg%3D%3D";
b.onload=function(){a=new T5.Vector(b.width/2,b.height/2)};var k=new m.Annotation(T5.ex({calcXY:function(d){g=Math.floor(d.getPixelDistance(k.accuracy)*0.5)},draw:function(d,l,h,o,q,r){l=h.x-a.x;o=h.y-a.y;if(g&&k.drawAccuracyIndicator){d.fillStyle="rgba(30, 30, 30, 0.2)";d.beginPath();d.arc(h.x,h.y,g,0,Math.PI*2,false);d.fill()}b.complete&&b.width>0&&d.drawImage(b,l,o,b.width,b.height);r.trigger("invalidate")}},f));k.accuracy=f.accuracy;k.drawAccuracyIndicator=false;return k},AnnotationsOverlay:function(f){function b(l){var h=
f.map?f.map.getTileLayer():null,o=l.length;if(h)for(o=o;o--;)l[o].calcXY(h);l.sort(function(q,r){var C=r.xy.y-q.xy.y;if(C===0)C=r.xy.x-q.xy.x;return C})}f=T5.ex({pois:null,map:null,zindex:100},f);var a=[],g=false,k=[],d=T5.ex(new T5.ViewLayer(f),{cycle:function(){return g?1:0},draw:function(l,h,o,q,r){g=false;l.fillStyle="rgba(255, 0, 0, 0.75)";l.globalCompositeOperation="source-over";for(o=a.length;o--;){a[o].draw(l,h,q,d,r);g=g||a[o].isAnimating()}for(o=k.length;o--;){k[o].draw(l,h,q,d,r);g=g||
k[o].isAnimating()}return g?1:0},add:function(l){k.push(l);b(k);d.wakeParent()},clear:function(l){k=[];b(k);if(l){a=[];b(a)}d.wakeParent()}});COG.listen("geo.pois-updated",function(l){if(f.pois&&f.pois.id==l.srcID){l=l.pois;try{a=[];for(var h=0;h<l.length;h++)if(l[h].pos){var o;var q=l[h];if(q&&q.pos){var r={poi:q,annotation:null};f.map&&f.map.trigger("getAnnotationForPOI",r);if(!r.annotation)r.annotation=new m.Annotation({pos:q.pos});if(r.annotation){r.annotation.isNew=q.isNew;q.isNew=false}o=r.annotation}else o=
void 0;o&&a.push(o)}b(a)}catch(C){COG.Log.exception(C)}d.wakeParent()}});COG.listen("grid.updated",function(){b(a);b(k);d.wakeParent()});return d}};return m}();
T5.Map=function(e){function m(w){try{var t=new T5.Geo.Position(w.coords.latitude,w.coords.longitude),E=w.coords.accuracy/1E3;p.trigger("locationUpdate",w,E);if(C){if(!q){q=new T5.Geo.UI.LocationAnnotation({pos:t,accuracy:E});p.bind("tileDrawComplete",function(){q.drawAccuracyIndicator=true})}e.displayLocationAnnotation&&l.add(q);var u=T5.Geo.B.createBoundsFromCenter(t,Math.max(E,1));p.gotoBounds(u)}else{q.pos=t;q.accuracy=E;q.calcXY(p.getTileLayer());p.panToPosition(t,null,T5.easing("sine.out"))}C=
false}catch(n){COG.Log.exception(n)}}function f(w){COG.Log.info("caught location tracking error:",w)}e=T5.ex({tapExtent:10,provider:null,crosshair:false,zoomLevel:0,boundsChangeThreshold:30,pois:new T5.Geo.POIStorage,displayLocationAnnotation:true,zoomAnimation:T5.easing("quad.out")},e);var b={NONE:0,SINGLE:1,WATCH:2},a=new T5.Vector,g=b.NONE,k=false,d=[],l=null,h=null,o=null,q=null,r=0,C=true,s=e.zoomLevel;if(!e.provider)e.provider=new T5.Geo.MapProvider;e.adjustScaleFactor=function(w){return Math.pow(2,
(w<1?Math.floor:Math.ceil)(Math.log(w)))};var p=T5.ex({},new T5.Tiler(e),{pois:e.pois,annotations:null,getBoundingBox:function(){var w=p.getTileLayer(),t=p.getOffset(),E=p.getDimensions();if(w)return w.getBoundingBox(t.x,t.y,E.width,E.height);return null},getCenterPosition:function(){return p.getXYPosition(T5.D.getCenter(p.getDimensions()))},getXYPosition:function(w){return p.getTileLayer().pixelsToPos(p.viewPixToGridPix(w))},gotoBounds:function(w,t){var E=T5.Geo.B.getZoomLevel(w,p.getDimensions());
p.gotoPosition(T5.Geo.B.getCenter(w),E,t)},gotoPosition:function(w,t,E){function u(y){p.setTileLayer(y);o=y.getId();p.panToPosition(w,function(){p.unfreeze();p.trigger("zoomLevelChange",s);E&&E()});k=true}var n=s,x=!k,v=p.getBoundingBox();if(v)x=x||!T5.Geo.P.inBounds(w,v);s=t?t:s;if(!s)throw Error("Zoom level required to goto a position.");if(e.provider)s=e.provider.checkZoomLevel(s);if(x||s!==n){T5.Images.cancelLoad();if(q)q.drawAccuracyIndicator=false;(t=p.getTileLayer())&&t.deactivate();T5.cancelAnimation();
k&&p.freeze();e.provider.zoomLevel=s;e.provider.getMapTiles(p,w,u)}else p.panToPosition(w,E)},panToPosition:function(w,t,E,u){var n=p.getTileLayer();if(n){w=n.getGridXYForPosition(w);n=p.getDimensions();w.x-=n.width/2;w.y-=n.height/2;if(h)h=null;p.updateOffset(w.x,w.y,E,u,t);p.trigger("wake");e.boundsChange&&e.boundsChange(p.getBoundingBox());t&&typeof E==="undefined"&&t(p)}},locate:function(){p.trackStart(b.SINGLE);setTimeout(p.trackCancel,1E4)},trackStart:function(w){if(navigator.geolocation&&!r){g=
w?w:b.WATCH;C=true;r=navigator.geolocation.watchPosition(m,f,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3})}},trackCancel:function(){r&&navigator.geolocation&&navigator.geolocation.clearWatch(r);g===b.WATCH&&l.clear();g=b.NONE;r=0},getZoomLevel:function(){return s},setZoomLevel:function(w){try{p.gotoPosition(p.getCenterPosition(),w)}catch(t){COG.Log.exception(t)}},zoomIn:function(){p.scale(2,T5.easing("sine.out"))||p.setZoomLevel(s+1)},zoomOut:function(){p.scale(0.5,T5.easing("sine.out"))||
p.setZoomLevel(s-1)},animateRoute:function(w,t,E,u){var n=p.getLayer("route");if(n)(w=n.getAnimation(w,t,E,u))&&w.addToView(p)}});p.bind("pan",function(){g===b.SINGLE&&p.trackCancel()});p.bind("tap",function(w,t){var E=p.getTileLayer(),u=null;if(E){var n=p.viewPixToGridPix(new T5.Vector(t.x,t.y)),x=E.pixelsToPos(n);u=E.pixelsToPos(T5.V.offset(n,-e.tapExtent,e.tapExtent));E=E.pixelsToPos(T5.V.offset(n,e.tapExtent,-e.tapExtent));u=new T5.Geo.BoundingBox(u,E);d=p.pois.findByBounds(u);p.trigger("geotap",
w,t,x,u);p.trigger("tapPOI",d)}});p.bind("doubleTap",function(w,t){p.animate(2,T5.D.getCenter(p.getDimensions()),new T5.Vector(t.x,t.y),e.zoomAnimation)});p.bind("scale",function(w,t){var E=0;w=Math.sqrt(w);if(w<1)E=-(0.5/w);else if(w>1)E=w;p.gotoPosition(p.getXYPosition(t),s+Math.floor(E))});l=new T5.Geo.UI.AnnotationsOverlay({pois:p.pois,map:p});p.annotations=l;p.setLayer("annotations",l);e.crosshair&&p.setLayer("crosshair",new CrosshairOverlay);p.bind("idle",function(){if(T5.V.absSize(T5.V.diff(a,
p.getOffset()))>e.boundsChangeThreshold){a=p.getOffset();p.trigger("boundsChange",p.getBoundingBox())}});COG.configurable(p,["provider"],COG.paramTweaker(e,null,{provider:function(){p.cleanup();k=false}}),true);return p};
