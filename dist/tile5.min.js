COG=function(){var f=/\$\{(.*?)\}/ig,l=Object.prototype.hasOwnProperty,k=0,e={id:"grunt.core",extend:function(){var b=arguments[0]||{},g=1,d=arguments.length,a=false,m,h,n,o;if(typeof b==="boolean"){a=b;b=arguments[1]||{};g=2}if(typeof b!=="object"&&!e.isFunction(b))b={};if(d===g){b=this;--g}for(;g<d;g++)if((m=arguments[g])!=null)for(h in m){n=b[h];o=m[h];if(b!==o)if(a&&o&&(e.isPlainObject(o)||e.isArray(o))){n=n&&(e.isPlainObject(n)||e.isArray(n))?n:e.isArray(o)?[]:{};b[h]=e.extend(a,n,o)}else if(o!==
undefined)b[h]=o}return b},isFunction:function(b){return toString.call(b)==="[object Function]"},isArray:function(b){return toString.call(b)==="[object Array]"},isPlainObject:function(b){if(!b||toString.call(b)!=="[object Object]"||b.nodeType||b.setInterval)return false;if(b.constructor&&!l.call(b,"constructor")&&!l.call(b.constructor.prototype,"isPrototypeOf"))return false;var g;for(g in b);return g===undefined||l.call(b,g)},isEmptyObject:function(b){for(var g in b)return false;return true},isXmlDocument:function(b){return toString.call(b)===
"[object Document]"},contains:function(b,g){var d=b,a=arguments,m=1;if(g&&e.isArray(g)){a=g;m=0}for(m=m;m<a;m++)d=d&&typeof foo[a[m]]!=="undefined";return d},newModule:function(b){b=e.extend({id:null,requires:[],parent:null},b);if(b.parent)b=e.extend({},b.parent,b);return b},toID:function(b){return b.replace(/\s/g,"-")},objId:function(b){return(b?b:"obj")+k++},formatStr:function(b){if(arguments.length<=1)return b;for(var g=arguments.length-2,d=0;d<=g;d++)b=b.replace(RegExp("\\{"+d+"\\}","gi"),arguments[d+
1]);return b},wordExists:function(b,g){var d="";if(g.toString)g=g.toString();for(var a=0;a<g.length;a++)d+=!/\w/.test(g[a])?"\\"+g[a]:g[a];return RegExp("(^|\\s|\\,)"+d+"(\\,|\\s|$)","i").test(b)},parseTemplate:function(b,g){for(var d=f.exec(b);d;){b=b.replace(d[0],COG.XPath.first(d[1],g));f.lastIndex=0;d=f.exec(b)}return b}};return e}();
COG.Log=function(){function f(g,d){var a,m=d&&d.length>0?d[0]:"";for(a=1;d&&a<d.length;a++)m+=" "+(k&&COG.isPlainObject(d[a])?JSON.stringify(d[a]):d[a]);typeof console!=="undefined"&&console[g](m);for(a=0;a<l.length;a++)l[a].call(b,m,g)}var l=[],k=typeof JSON!=="undefined",e=window.console&&window.console.markTimeline,b={id:"grunt.log",getTraceTicks:function(){return e?(new Date).getTime():null},trace:function(g,d){if(e)console.markTimeline(g+(d?": "+(b.getTraceTicks()-d)+"ms":""))},debug:function(){f("debug",
arguments)},info:function(){f("info",arguments)},warn:function(){f("warn",arguments)},error:function(){f("error",arguments)},exception:function(g){b.error(arguments);for(var d in g)b.info("ERROR DETAIL: "+d+": "+g[d])},watch:function(g,d){try{d()}catch(a){b.exception(a,g)}},throwError:function(g){b.error(g);throw Error(g);},requestUpdates:function(g){l.push(g)}};return b}();
(function(){function f(e,b){e[b]||(e[b]=function(g){return e.configure(b,g)})}function l(e){e.gtConfId=COG.objId("configurable");e.gtConfig={};e.gtConfigFns=[];return e.gtConfig}var k={};COG.paramTweaker=function(e,b,g){return function(d,a){if(typeof a!=="undefined"){if(d in e)e[d]=a;g&&d in g&&g[d](d,a)}else return b&&d in b?b[d](d):e[d]}};COG.configurable=function(e,b,g,d){if(e){e.gtConfId||l(e);var a=e.gtConfId,m=e.gtConfig,h=e.gtConfigFns;k[a]=e;h.push(g);for(g=b.length;g--;){m[b[g]]=true;d&&
f(e,b[g])}if(!e.configure)e.configure=function(n,o){if(m[n]){for(var p=h.length;p--;){var z=h[p](n,o);if(typeof z!=="undefined")return z}return k[a]}return null}}}})();
(function(){function f(l,k){var e=l.gtObsHandlers;e[k]||(e[k]=[]);return e[k]}COG.observable=function(l){if(l){if(!l.gtObsHandlers)l.gtObsHandlers={};if(!(l.bind||l.trigger||l.unbind)){l.bind=function(k,e){var b=COG.objId("callback");f(l,k).unshift({fn:e,id:b});return b};l.trigger=function(k){var e=f(l,k),b={cancel:false,tickCount:Date.now()},g;if(!e)return null;g=Array.prototype.slice.call(arguments,1);g.unshift(b);for(var d=e.length;d--&&!b.cancel;)e[d].fn.apply(self,g);return b};l.unbind=function(k,
e){for(var b=f(l,k),g=0;b&&g<b.length;g++)if(b[g].id===e){b.splice(g,1);break}return l}}}}})();(function(){var f={},l=[];COG.addPipe=function(k){k("pipe.test",{});l.push(k)};COG.listen=function(k,e){f[k]||(f[k]=[]);e&&f[k].push(e)};COG.say=function(k,e){var b;for(b=l.length;b--;)l[b](k,e);if(f[k])for(b=f[k].length;b--;)f[k][b](e)}})();
COG.Loopage=function(){function f(o){return COG.extend({id:g++,frequency:0,after:0,single:false,lastTick:0,execute:function(){}},o)}function l(o){a.push(o);k()}function k(){m&&clearTimeout(m);m=setTimeout(e,0);n=true}function e(){for(var o,p=(new Date).getTime(),z=d.length;a.length>0;){var s=a.shift();for(o=z;o--;)if(d[o].id===s){d.splice(o,1);break}n=true;z=d.length}if(n){h=b;for(o=z;o--;)h=d[o].frequency<h?d[o].frequency:h}for(o=z;o--;){s=p-d[o].lastTick;if(d[o].lastTick===0||s>=d[o].frequency){d[o].execute(p,
d[o]);d[o].lastTick=p;d[o].single&&d[o].trigger("complete")}}m=z?setTimeout(e,h):0}var b=6E4,g=0,d=[],a=[],m=0,h=b,n=true;return{join:function(o){var p=new f(o);if(p.after>0)p.lastTick=(new Date).getTime()+p.after;COG.observable(p);p.bind("complete",function(){l(p.id)});d.unshift(p);k();return p},leave:l}}();if(!this.JSON)this.JSON={};
(function(){function f(h){return h<10?"0"+h:h}function l(h){b.lastIndex=0;return b.test(h)?'"'+h.replace(b,function(n){var o=a[n];return typeof o==="string"?o:"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+h+'"'}function k(h,n){var o,p,z,s,r=g,u,t=n[h];if(t&&typeof t==="object"&&typeof t.toJSON==="function")t=t.toJSON(h);if(typeof m==="function")t=m.call(n,h,t);switch(typeof t){case "string":return l(t);case "number":return isFinite(t)?String(t):"null";case "boolean":case "null":return String(t);
case "object":if(!t)return"null";g+=d;u=[];if(Object.prototype.toString.apply(t)==="[object Array]"){s=t.length;for(o=0;o<s;o+=1)u[o]=k(o,t)||"null";z=u.length===0?"[]":g?"[\n"+g+u.join(",\n"+g)+"\n"+r+"]":"["+u.join(",")+"]";g=r;return z}if(m&&typeof m==="object"){s=m.length;for(o=0;o<s;o+=1){p=m[o];if(typeof p==="string")if(z=k(p,t))u.push(l(p)+(g?": ":":")+z)}}else for(p in t)if(Object.hasOwnProperty.call(t,p))if(z=k(p,t))u.push(l(p)+(g?": ":":")+z);z=u.length===0?"{}":g?"{\n"+g+u.join(",\n"+g)+
"\n"+r+"}":"{"+u.join(",")+"}";g=r;return z}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
b=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,g,d,a={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},m;if(typeof JSON.stringify!=="function")JSON.stringify=function(h,n,o){var p;d=g="";if(typeof o==="number")for(p=0;p<o;p+=1)d+=" ";else if(typeof o==="string")d=o;if((m=n)&&typeof n!=="function"&&(typeof n!=="object"||typeof n.length!=="number"))throw Error("JSON.stringify");return k("",
{"":h})};if(typeof JSON.parse!=="function")JSON.parse=function(h,n){function o(z,s){var r,u,t=z[s];if(t&&typeof t==="object")for(r in t)if(Object.hasOwnProperty.call(t,r)){u=o(t,r);if(u!==undefined)t[r]=u;else delete t[r]}return n.call(z,s,t)}var p;h=String(h);e.lastIndex=0;if(e.test(h))h=h.replace(e,function(z){return"\\u"+("0000"+z.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(h.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){p=eval("("+h+")");return typeof n==="function"?o({"":p},""):p}throw new SyntaxError("JSON.parse");}})();
(function(){function f(k,e){var b=k.split("|"),g={};for(var d in e){var a=e[d];g[d]=b.length>a?b[a]:null}return g}var l={JSON:{parse:function(k){return JSON.parse(k)}},PDON:{parse:function(k){var e=null,b=[];k=k.split("\n");for(var g=0;g<k.length;g++){var d=k[g];if(e)b.push(f(d,e));else if(d){e=d.split("|");d={};for(var a=0;a<e.length;a++)d[e[a]]=a;e=d}else e=null}return b}}};COG.parseData=function(k,e){e=e?e.toUpperCase():"JSON";if(!l[e])throw Error("Unsupported data format: "+e);try{return l[e].parse(k)}catch(b){COG.Log.exception(b)}return{}}})();
COG.XPath=function(){function f(b){for(var g=null,d=0;d<l.length;d++)if(g=l[d](b))break;return g}var l=[],k=[null,function(b){return b.numberValue},function(b){return b.stringValue},function(b){return b.booleanValue},null,null,null,null,function(b){return b.singleNodeValue?b.singleNodeValue.textContent:null},function(b){return b.singleNodeValue?b.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||COG.Log.warn("No XPATH support");var e={SearchResult:function(b){return{toString:function(){var g=
null;if(b){var d=null;if(b.resultType>=0&&b.resultType<k.length)d=k[b.resultType];if(d)g=d(b)}return g?g:""}}},first:function(b,g){var d=e.SearchResult,a;var m=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!m)m=XPathResult.ANY_TYPE;try{if(COG.isXmlDocument(g))a=g.evaluate(b,g,f,m,null);else{COG.Log.warn("attempted xpath expression: "+b+" on a non-xml document");a=null}}catch(h){COG.Log.warn("invalid xpath expression: "+b+" on node: "+g);a=null}return new d(a)},registerResolver:function(b){l.push(b)}};return e}();
COG.Storage=function(){function f(l){if(l&&l=="session")return sessionStorage;return localStorage}return{get:function(l,k){var e=f(k).getItem(l);return/^(\{|\[).*(\}|\])$/.test(e)?JSON.parse(e):e},set:function(l,k,e){k=jQuery.isArray(k)||jQuery.isPlainObject(k)?JSON.stringify(k):k;f(e).setItem(l,k)},remove:function(l,k){f(k).removeItem(l)}}}();
COG.ParseRules=function(){var f=[];return{add:function(l,k){f.push({regex:l,handler:k})},each:function(l,k,e){function b(){g++;e&&g>=f.length&&e(k)}for(var g=0,d=0;d<f.length;d++){var a=f[d].regex,m=f[d].handler,h=false;if(a){a.lastIndex=-1;if((a=a.exec(l))&&m){h=true;m(a,k,b)&&b()}}h||b()}}}};
(function(){function f(a){var m=[],h=function(o,p){p=COG.isFunction(p)?p():p;m[m.length]=encodeURIComponent(o)+"="+encodeURIComponent(p)};if(COG.isArray(a))for(var n=0;n<a.length;n++)h(a[n].name,a[n].value);else for(n in a)h(n,a[n]);return m.join("&").replace(/%20/g,"+")}var l={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},k={JSON:["json"],PDON:["pdon.txt"]},e=["TEXT","STREAM"],b=/^(\w+:)?\/\/([^\/?#]+)/,g={XML:function(a){return a.responseXML},JSON:function(a){return COG.parseData(a.responseText)},
PDON:function(a){return COG.parseData(a.responseText,"PDON")},DEFAULT:function(a){return a.responseText}},d={CONTENT_TYPE:"Content-Type"};COG.xhr=function(a){function m(){if(this.readyState===4){var p=null,z=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(z)if(a.handleResponse)a.handleResponse(this);else{var s=a,r=this.getResponseHeader(d.CONTENT_TYPE),u,t=false;for(u in l)if(r&&r.indexOf(l[u])>=0){t=true;
break}r=!t;for(t=0;t<e.length;t++)r=r||e[t]==u;if(r)b:{r=u;for(var E in k)for(t=0;t<k[E].length;t++)if(RegExp(k[E][t]+"$","i").test(s.url)){u=E;break b}u=r?r:"DEFAULT"}try{p=g[u](this,s)}catch(I){p=g.DEFAULT(this,s)}}else a.error&&a.error(this)}catch(L){COG.Log.exception(L,"PROCESSING AJAX RESPONSE")}z&&p&&a.success&&a.success.call(this,p)}}try{a=COG.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},a);var h=
b.exec(a.url),n=h&&(h[1]&&h[1]!==location.protocol||h[2]!==location.host);if(a.data)a.method="POST";if(a.url){h=null;if(a.xhr)h=a.xhr(a);h||(h=new XMLHttpRequest);h.open(a.method,a.url,a.async);a.data&&h.setRequestHeader("Content-Type",a.contentType);n||h.setRequestHeader("X-Requested-With","XMLHttpRequest");h.onreadystatechange=m;h.send(a.method=="POST"?f(a.data):null)}else COG.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(o){COG.Log.exception(o)}}})();
(function(){function f(b){var g=document.createElement("script"),d=false;g.src=b;g.async=true;g.onload=g.onreadystatechange=function(){if(!d&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){d=true;g.onload=g.onreadystatechange=null;g&&g.parentNode&&g.parentNode.removeChild(g)}};k||(k=document.getElementsByTagName("head")[0]);k.appendChild(g)}var l=0,k,e=this;COG.jsonp=function(b,g,d){b+=b.indexOf("?")>=0?"&":"?";var a="json"+ ++l;e[a]=function(m){g(m);e[a]=null;try{delete e[a]}catch(h){}};
f(b+(d?d:"callback")+"="+a);return a}})();
COG.Touch=function(){function f(v,q){return{x:v.x-q.x,y:v.y-q.y}}function l(v,q){var A=f(v,q);return Math.sqrt(A.x*A.x+A.y*A.y)}function k(v){if(v.count>1)return l(v.touches[0],v.touches[1]);return 0}function e(v,q){var A=v&&v.count>0?v.touches[0]:null;if(A&&q&&q.count>0)return f(A,q.touches[0]);return null}function b(v,q){v.count=q.count;for(var A=h;A--;){v.touches[A].x=q.touches[A].x;v.touches[A].y=q.touches[A].y}}function g(){for(var v={count:0,touches:Array(h)},q=h;q--;)v.touches[q]=m();return v}
function d(v){if(v.preventDefault){v.preventDefault();v.stopPropagation()}else v.cancelBubble&&v.cancelBubble()}function a(v,q,A){if(x){q=q[A?A:"touches"];A=q.length;for(A=v.count=A;A--;){v.touches[A].x=q[A].pageX;v.touches[A].y=q[A].pageY}}else if(q.button===0){v.count=1;v.touches[0].x=q.pageX?q.pageX:q.screenX;v.touches[0].y=q.pageY?q.pageY:q.screenY}else v.count=0}function m(v,q){return{x:v?v:0,y:q?q:0}}var h=10,n=120,o=100,p=250,z=300,s=5,r=0,u=1,t=2,E=7,I=0,L=0,x=undefined,y=function(v){function q(w,
B,F,J){var M=Math.asin((w.y-B.y)/F);F=F*(na/J)>>0;F=F>la?la:F;M=B.x>w.x?M:Math.PI-M;H("pan",Math.cos(M)*-F,Math.sin(M)*F,true)}function A(w,B){var F,J;if(x){F=B-ha;if(F<p){J=l(O.touches[0],w);J>v.inertiaTrigger&&q(O.touches[0],w,J,F)}}else{$.x=w.x;$.y=w.y;COG.Loopage.join({execute:function(M,W){F=M-B;J=l(w,$);if(F<o&&J>v.inertiaTrigger){W.trigger("complete");q(w,$,J,F)}else F>o&&W.trigger("complete")},frequency:10})}}function D(w){var B=0,F=0;if(w.offsetParent){do{B+=w.offsetLeft;F+=w.offsetTop;w=
w.offsetParent}while(w)}return m(B,F)}function G(w){var B=w.count,F=Array(B),J=D(aa);for(B=B;B--;)F[B]=m(w.touches[B].x-J.x,w.touches[B].y-J.y);return F}function H(){pa&&pa.trigger.apply(null,arguments)}function K(w){var B=w.target?w.target:w.srcElement;if(ma||B&&B===aa){a(O,w);if(O.count!==0){fa=null;ga.x=0;ga.y=0;ka=true;S=false;ha=(new Date).getTime();d(w);B.style.cursor="move";H("inertiaCancel");ia=ha;if(w=O.count>0?O.touches[0]:null){H("touchStart",w.x,w.y);if(ia-X<z)if((w=f(O.touches[0],ba.touches[0]))&&
Math.abs(w.x)<v.maxDistDoubleTap&&Math.abs(w.y)<v.maxDistDoubleTap)S=true;Z=r;b(ba,O)}else COG.Log.warn("Touch start fired, but no touch vector found")}}}function P(w){var B=w.target?w.target:w.srcElement,F=0;if(ma||B&&B===aa){a(U,w);if(U.count>0){$.x=U.touches[0].x;$.y=U.touches[0].y}if(ka){x&&d(w);if(U.count>1){O.count===1&&b(O,U);F=k(O)-k(U)}if(Z===r)if((w=e(U,O))&&(Math.abs(w.x)>=E||Math.abs(w.y)>=E))Z=u;if(Z!==r)if(!F||Math.abs(F)<s){if(fa=e(U,ba)){ga.x-=fa.x;ga.y-=fa.y;Q.x-=fa.x;Q.y-=fa.y}H("pan",
Q.x,Q.y);Q.x=0;Q.y=0;Z=u}else{H("pinchZoom",G(O),G(U));Z=t}b(ba,U)}}}function N(w){var B=w.target?w.target:w.srcElement;if(ka&&(ma||B&&B===aa)){a(ca,w,"changedTouches");var F=ca.touches[0];x&&d(w);w=(new Date).getTime();X=ia;if(Z===r)Y||(Y=setTimeout(function(){Y=0;var J=S?"doubleTap":"tap",M=O.touches[0],W=D(aa);W=m(M.x-W.x,M.y-W.y);H(J,M,W)},z+50));else if(Z==u){H("panEnd",ga.x,ga.y);oa&&A(F,w)}else Z==t&&H("pinchZoomEnd",G(O),G(ba),w-ha);B.style.cursor="default";ka=false}}function R(w){var B=w.target?
w.target:w.srcElement;if(ma||B&&B===aa){if(w.detail){B=-w.detail*n;B=m(w.axis===1?B:0,w.axis===2?B:0)}else B=m(w.wheelDeltaX,w.wheelDeltaY);var F=B.y!==0?Math.abs(B.y/n):0;if($&&F!==0){var J=m($.x-aa.offsetLeft,$.y-aa.offsetTop);H("wheelZoom",J,Math.pow(2,B.y>0?F:-F))}d(w)}}v=COG.extend({element:null,observable:null,inertiaTrigger:20,maxDistDoubleTap:20,touchStartHandler:null,moveHandler:null,moveEndHandler:null,pinchZoomHandler:null,pinchZoomEndHandler:null,tapHandler:null,doubleTapHandler:null,
wheelZoomHandler:null},v);var S=false,Y=0,V=T5.getConfig(),O=g(),U=g(),ba=g(),ca=g(),fa=null,ga=m(),Q=m(),Z=null,ka=false,ha=0,da=[],$=m(),oa=false,na,la,ia=0,X=0,aa=v.element,pa=v.observable,ma=typeof FlashCanvas!=="undefined",T={supportsTouch:x,addListeners:function(w){da.push(w)},decoupleListeners:function(w){for(var B=0;w&&B<da.length;B++)if(da[B].listenerId===w){da.splice(B,1);break}},release:function(){V.unbindEvent(x?"touchstart":"mousedown",K,false);V.unbindEvent(x?"touchmove":"mousemove",
P,false);V.unbindEvent(x?"touchend":"mouseup",N,false);if(!x){window.removeEventListener("mousewheel",R,false);window.removeEventListener("DOMMouseScroll",R,false)}},inertiaEnable:function(w,B){oa=true;na=w;la=B?Math.min(B.width,B.height):500},inertiaDisable:function(){oa=false}};if(typeof x==="undefined")x=T5.getConfig().supportsTouch;V.bindEvent(x?"touchstart":"mousedown",K,false);V.bindEvent(x?"touchmove":"mousemove",P,false);V.bindEvent(x?"touchend":"mouseup",N,false);if(!x){V.bindEvent("mousewheel",
R,window);V.bindEvent("DOMMouseScroll",R,window)}return T},C=[];return{capture:function(v,q){if(!v)throw Error("Unable to capture touch of null element");if(!v.id)v.id="touchable_"+I++;var A=C[v.id];if(!A){A=new y(COG.extend({element:v},q));C[v.id]=A}if(q){q.listenerId&&A.decoupleListeners(q.listenerId);q.listenerId=++L;A.addListeners(q)}return A},release:function(v){if(v&&v.id&&C[v.id]){C[v.id].release();delete C[v.id]}}}}();
T5=function(){var f=function(d,a){return{x:d?d:0,y:a?a:0}},l=function(){function d(a,m){if(!m)m=a.length;if(m<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var h={edges:Array(m-1),accrued:Array(m-1),total:0},n=l.diff,o=0;o<m-1;o++){var p=n(a[o],a[o+1]);h.edges[o]=Math.sqrt(p.x*p.x+p.y*p.y);h.accrued[o]=h.total+h.edges[o];h.total+=h.edges[o]}return h}return{VECTOR_SIMPLIFICATION:4,create:function(a,m){return new f(a,m)},add:function(){for(var a=new f,m=
arguments.length;m--;){a.x+=arguments[m].x;a.y+=arguments[m].y}return a},absSize:function(a){return Math.max(Math.abs(a.x),Math.abs(a.y))},diff:function(a,m){return new f(a.x-m.x,a.y-m.y)},copy:function(a){return a?new f(a.x,a.y):null},invert:function(a){return new f(-a.x,-a.y)},offset:function(a,m,h){return new f(a.x+m,a.y+(h?h:m))},edges:d,distance:function(a,m){return d(a,m).total},simplify:function(a,m){if(!a)return null;m=m?m:l.VECTOR_SIMPLIFICATION;for(var h=[],n=null,o=a.length;o--;){var p=
a[o];if(include=!n||o===0||Math.abs(p.x-n.x)+Math.abs(p.y-n.y)>m){h.unshift(p);n=p}}return h},theta:function(a,m,h){h=Math.asin((a.y-m.y)/h);return a.x>m.x?h:Math.PI-h},pointOnEdge:function(a,m,h,n){m=new f(Math.cos(h)*n,Math.sin(h)*n);return new f(a.x-m.x,a.y-m.y)},getRect:function(a){var m=a.length;if(m>1)return new k(Math.min(a[0].x,a[m-1].x),Math.min(a[0].y,a[m-1].y),Math.abs(a[0].x-a[m-1].x),Math.abs(a[0].y-a[m-1].y))},toString:function(a){return a.x+", "+a.y}}}(),k=function(d,a,m,h){return{origin:new f(d,
a),dimensions:new b(m,h),invalid:false}},e=function(){return{bottomRight:function(d){return l.offset(d.origin,d.dimensions.width,d.dimensions.height)},empty:function(){return new k(0,0,0,0)},copy:function(d){return d?new k(d.origin.x,d.origin.y,d.dimensions.width,d.dimensions.height):null},getCenter:function(d){return new f(d.origin.x+d.dimensions.width/2,d.origin.y+d.dimensions.height/2)},isEmpty:function(d){return d.dimensions.width===0||d.dimensions.height===0},union:function(){if(!(arguments.length<
2)){for(var d=arguments[0].origin.y,a=arguments[0].origin.x,m=d+arguments[0].dimensions.height,h=a+arguments[0].dimensions.width,n=Array.prototype.slice.call(arguments,1),o=n.length;o--;){var p=n[o].origin.y,z=n[o].origin.x,s=p+n[o].dimensions.height,r=z+n[o].dimensions.width;d=d<p?d:p;a=a<z?a:z;m=m>s?m:s;h=h>r?h:r}arguments[0].origin.x=a;arguments[0].origin.y=d;arguments[0].dimensions.width=h-a;arguments[0].dimensions.height=m-d}}}}(),b=function(d,a){return{width:d?d:0,height:a?a:0}},g=function(){return{getAspectRatio:function(d){return d.height!==
0?d.width/d.height:1},getCenter:function(d){return new f(d.width/2,d.height/2)},getSize:function(d){return Math.sqrt(Math.pow(d.width,2)+Math.pow(d.height,2))}}}();return{ex:COG.extend,Vector:f,V:l,Dimensions:b,D:g,Rect:k,R:e}}();
(function(){function f(){for(;s.length>0;){var u=s.shift();document.location=u}z=0}function l(u){for(var t=true,E=r.length;E--;)t=t&&u!=r[E];return t}function k(u,t){var E=[];for(var I in t)I&&E.push(I+"="+escape(t[I]));return"tile5://"+u+"/"+(E.length>0?"?"+E.join("&"):"")}function e(u,t){l(u)&&COG.Log.info("would push url: "+k(u,t))}function b(u,t){if(l(u)){s.push(k(u,t));z||(z=setTimeout(f,100))}}function g(u){return function(t,E,I){(I?I:u?document.body:document).addEventListener(t,E,false)}}function d(u){return function(t,
E,I){(I?I:u?document.body:document).removeEventListener(t,E,false)}}function a(u,t,E){(E?E:document).attachEvent("on"+u,t)}function m(u,t,E){(E?E:document).detachEvent("on"+u,t)}function h(){n={base:{name:"Unknown",bindEvent:g(),unbindEvent:d(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:e,targetFps:null},ie:{name:"MSIE",regex:/msie/i,bindEvent:a,unbindEvent:m,requireFastDraw:false,targetFps:25},
ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:b,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:b},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:b},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:g(true),unbindEvent:d(true),supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},bridgeNotify:b},froyo:{name:"Android OS >= 2.2",
regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:b}};o=[n.froyo,n.android,n.ipod,n.iphone,n.ipad,n.ie]}var n=null,o=[],p=null,z=0,s=[],r=["view.wake","tile.loaded"];T5.getConfig=function(){n||h();if(!p){COG.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var u=0;u<o.length;u++){var t=o[u];if(t.regex&&t.regex.test(navigator.userAgent)){p=T5.ex({},n.base,t);COG.Log.info("PLATFORM DETECTED AS: "+p.name);break}}if(!p){COG.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
p=n.base}COG.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return p}})();
T5.Dispatcher=function(){var f=[],l={execute:function(k){var e=l.findAction(k);e&&e.execute.apply(e,Array.prototype.slice.call(arguments,1))},findAction:function(k){for(var e=f.length;e--;)if(f[e].id==k)return f[e];return null},getRegisteredActions:function(){return[].concat(f)},getRegisteredActionIds:function(){for(var k=[],e=f.length;e--;)f[e].id&&k.push(f[e].id);return k},registerAction:function(k){k&&k.id&&f.push(k)},Action:function(k){k=T5.ex({autoRegister:true,id:"",title:"",icon:"",hidden:false,
execute:null},k);var e={id:k.id,execute:function(){k.execute&&k.execute.apply(this,arguments)},getParam:function(b){return k[b]?k[b]:""},toString:function(){return COG.formatStr("{0} [title = {1}, icon = {2}]",e.id,k.title,k.icon)}};k.autoRegister&&l.registerAction(e);return e},Agent:function(k){k=COG.extend({name:"Untitled",translator:null,execute:null},k);var e={getName:function(){return k.name},getParam:function(b){return k[b]},getId:function(){return COG.toID(e.getName())},run:function(b,g){if(k.execute){var d=
k.translator?k.translator(b):b;k.execute.call(e,d,function(a,m){g&&g(a,m,d)})}}};return e},runAgents:function(k,e,b){for(var g=0;g<k.length;g++)k[g].run(e,b)}};return l}();
T5.Resources=function(){var f="",l={},k={getPath:function(e){return/^(file|https?|\/)/.test(e)?e:f+e},setBasePath:function(e){f=e},loadResource:function(e){e=T5.ex({filename:"",cacheable:true,dataType:null,callback:null},e);var b=function(g){e.callback&&COG.Log.watch("CALLING RESOURCE CALLBACK",function(){e.callback(g)})};e.cacheable&&l[e.filename]?b(l[e.filename]):COG.xhr({url:k.getPath(e.filename),dataType:e.dataType,success:function(g){if(e.cacheable)l[e.filename]=g;b(g)},error:function(g,d,a){COG.Log.error("error loading resource ["+
e.filename+"], error = "+a)}})},loadSnippet:function(e,b){/\.\w+$/.test(e)||(e+=".html");k.loadResource({filename:"snippets/"+e,callback:b,dataType:"html"})}};return k}();
T5.Images=function(){function f(r,u){var t=document.createElement("canvas");t.width=r?r:0;t.height=u?u:0;if(typeof FlashCanvas!=="undefined"){t.id="tmpCanvas"+g++;t.style.cssText="position: absolute; top: -"+(u-1)+"px; left: -"+(r-1)+"px;";document.body.appendChild(t);FlashCanvas.initElement(t)}return t}function l(){var r=d[this.id];if(r&&r.image.complete&&r.image.width>0){r.loaded=true;r.hitCount=1;for(var u=h.length;u--;)if(h[u].image.src==this.src){h.splice(u,1);break}if(r.background||r.postProcess||
r.drawBackground||r.customDraw)if(r.image){u=f(r.realSize?r.realSize.width:image.width,r.realSize?r.realSize.height:image.height);var t=u.getContext("2d"),E=r.offset?r.offset:new T5.Vector;r.background&&t.drawImage(r.background,0,0);r.drawBackground&&r.drawBackground(t);r.customDraw?r.customDraw(t,r):t.drawImage(r.image,E.x,E.y);r.postProcess&&r.postProcess(t,r);r.image=u}r.loadCallback&&r.loadCallback(this,false);n[n.length]={url:this.src,created:r.requested};delete d[this.id];k()}}function k(){if(!p){var r=
T5.getConfig().maxImageLoads;p=COG.Loopage.join({execute:function(u,t){if(!r||h.length<r){var E=m.shift();if(E){h[h.length]=E;E.image.onload=l;E.image.src=T5.Resources.getPath(E.url);E.requested=Date.now()}else t.trigger("complete")}},frequency:10});p.bind("complete",function(){p=null})}}function e(){z=true;try{var r=n.length/2>>0;if(r>0){n.sort(function(t,E){return t.created-E.created});for(var u=r;u--;)delete b[n[u].url];n.splice(0,r)}}finally{z=false}COG.say("imagecache.cleared")}var b={},g=0,
d={},a=0,m=[],h=[],n=[],o=0,p=null,z=false,s={avgImageSize:25,loadTimeout:10,cancelLoad:function(){h=[]},get:function(r){var u=null,t=null;z||(u=b[r]);if((t=u?u.image:null)&&(t.getContext||t.complete&&t.width>0))return t},load:function(r,u,t){var E=b[r];if(E){E.hitCount++;E.image.complete&&u&&u(E.image,true)}else{E=T5.ex({url:r,image:new Image,loaded:false,created:Date.now(),requested:null,hitCount:0,loadCallback:u},t);E.image.id="resourceLoaderImage"+a++;b[r]=E;d[E.image.id]=E;m[m.length]=E;k()}return E},
newCanvas:f,stats:function(){return{imageLoadingCount:h.length,queuedImageCount:m.length,imageCacheFullness:o}}};COG.Loopage.join({execute:function(r){for(var u=false,t=0,E=T5.getConfig();t<h.length;)if(r-h[t].requested>s.loadTimeout*1E3){h.splice(t,1);u=true}else t++;u&&k();if(E&&E.imageCacheMaxSize){o=n.length*s.avgImageSize/E.imageCacheMaxSize;o>=1&&e()}},frequency:2E4});return s}();
T5.TimeLord=function(){var f=/^P(\d+Y)?(\d+M)?(\d+D)?$/,l=/^(\d+H)?(\d+M)?(\d+S)?$/,k=function(b,g){return{days:b?b:0,seconds:g?g:0}},e={8601:function(b){b=b.split("T");var g=null;g=null;var d=0,a=0;f.lastIndex=-1;g=f.exec(b[0]);d+=g[3]?parseInt(g[3].slice(0,-1),10):0;l.lastIndex=-1;g=l.exec(b[1]);a+=g[1]?parseInt(g[1].slice(0,-1),10)*3600:0;a+=g[2]?parseInt(g[2].slice(0,-1),10)*60:0;a+=g[3]?parseInt(g[3].slice(0,-1),10):0;return new k(d,a)}};return{Duration:k,addDuration:function(){for(var b=new k,
g=arguments.length;g--;){b.days+=arguments[g].days;b.seconds+=arguments[g].seconds}if(b.seconds>=86400){b.days+=~~(b.seconds/86400);b.seconds%=86400}return b},parseDuration:function(b,g){var d=g?e[g]:null;if(d)return d(b);COG.Log.warn("Could not find duration parser for specified format: "+g);return new k},formatDuration:function(b){var g,d,a="";if(b.days)a=b.days+" days ";if(b.seconds){b=b.seconds;if(b>=3600){g=~~(b/3600);b-=g*3600}if(b>=60){d=Math.round(b/60);b-=d*60}if(g)a=a+g+(g>1?" hrs ":" hr ")+
(d?(d>10?d:"0"+d)+" min ":"");else if(d)a=a+d+" min";else if(b>0)a=a+(b>10?b:"0"+b)+" sec"}return a}}}();
(function(){var f=Math.PI*2,l=Math.PI/2,k=Math.abs,e=Math.pow,b=Math.sin,g=Math.asin,d=Math.cos,a=1.70158,m={linear:function(h,n,o,p){return o*h/p+n},backin:function(h,n,o,p){return o*(h/=p)*h*((a+1)*h-a)+n},backout:function(h,n,o,p){return o*((h=h/p-1)*h*((a+1)*h+a)+1)+n},backinout:function(h,n,o,p){return(h/=p/2)<1?o/2*h*h*(((a*=1.525)+1)*h-a)+n:o/2*((h-=2)*h*(((a*=1.525)+1)*h+a)+2)+n},bouncein:function(h,n,o,p){return o-m.bounceout(p-h,0,o,p)+n},bounceout:function(h,n,o,p){return(h/=p)<1/2.75?
o*7.5625*h*h+n:h<2/2.75?o*(7.5625*(h-=1.5/2.75)*h+0.75)+n:h<2.5/2.75?o*(7.5625*(h-=2.25/2.75)*h+0.9375)+n:o*(7.5625*(h-=2.625/2.75)*h+0.984375)+n},bounceinout:function(h,n,o,p){return h<p/2?m.bouncein(h*2,0,o,p)/2+n:m.bounceout(h*2-p,0,o,p)/2+o/2+n},cubicin:function(h,n,o,p){return o*(h/=p)*h*h+n},cubicout:function(h,n,o,p){return o*((h=h/p-1)*h*h+1)+n},cubicinout:function(h,n,o,p){if((h/=p/2)<1)return o/2*h*h*h+n;return o/2*((h-=2)*h*h+2)+n},elasticin:function(h,n,o,p,z,s){if(h==0)return n;if((h/=
p)==1)return n+o;s||(s=p*0.3);if(!z||z<k(o)){z=o;o=s/4}else o=s/f*g(o/z);return-(z*e(2,10*(h-=1))*b((h*p-o)*f/s))+n},elasticout:function(h,n,o,p,z,s){var r;if(h==0)return n;if((h/=p)==1)return n+o;s||(s=p*0.3);if(!z||z<k(o)){z=o;r=s/4}else r=s/f*g(o/z);return z*e(2,-10*h)*b((h*p-r)*f/s)+o+n},elasticinout:function(h,n,o,p,z,s){var r;if(h==0)return n;if((h/=p/2)==2)return n+o;s||(s=p*0.3*1.5);if(!z||z<k(o)){z=o;r=s/4}else r=s/f*g(o/z);if(h<1)return-0.5*z*e(2,10*(h-=1))*b((h*p-r)*f/s)+n;return z*e(2,
-10*(h-=1))*b((h*p-r)*f/s)*0.5+o+n},quadin:function(h,n,o,p){return o*(h/=p)*h+n},quadout:function(h,n,o,p){return-o*(h/=p)*(h-2)+n},quadinout:function(h,n,o,p){if((h/=p/2)<1)return o/2*h*h+n;return-o/2*(--h*(h-2)-1)+n},sinein:function(h,n,o,p){return-o*d(h/p*l)+o+n},sineout:function(h,n,o,p){return o*b(h/p*l)+n},sineinout:function(h,n,o,p){return-o/2*(d(Math.PI*h/p)-1)+n}};T5.easing=function(h){return m[h.replace(/[\-\_\s\.]/g,"").toLowerCase()]};T5.registerEasingType=function(h,n){m[h.replace(/[\-\_\s\.]/g,
"").toLowerCase()]=n}})();
T5.Tween=function(f){f=T5.ex({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:T5.easing("sine.out"),complete:null,cancelOnInteract:false},f);var l=Date.now(),k=[],e=false,b=0,g=0,d={cancelOnInteract:f.cancelOnInteract,isComplete:function(){return e},triggerComplete:function(a){f.complete&&f.complete(a)},update:function(a){try{var m=f.tweenFn(a-l,b,g,f.duration);if(f.target)f.target[f.property]=m;for(var h=k.length;h--;)k[h](m,void 0);if(e=l+f.duration<=a){if(f.target)f.target[f.property]=
f.tweenFn(f.duration,b,g,f.duration);for(var n=k.length;n--;)k[n](m,true)}}catch(o){COG.Log.exception(o)}},requestUpdates:function(a){k.push(a)}};b=f.target&&f.property&&f.target[f.property]?f.target[f.property]:f.startValue;if(typeof f.endValue!=="undefined")g=f.endValue-b;if(g==0)e=true;T5.wakeTweens();return d};
(function(){function f(b){if(e)return l.length;e=true;try{for(var g=0;g<l.length;)if(l[g].isComplete()){l[g].triggerComplete(false);l.splice(g,1)}else{l[g].update(b);g++}}finally{e=false}l.length===0&&k.trigger("complete");return l.length}var l=[],k=null,e=false;T5.tweenValue=function(b,g,d,a,m){b=new T5.Tween({startValue:b,endValue:g,tweenFn:d,complete:a,duration:m});l.push(b);return b};T5.tween=function(b,g,d,a,m,h){b=new T5.Tween({target:b,property:g,endValue:d,tweenFn:a,duration:h,complete:m});
l.push(b);return b};T5.tweenVector=function(b,g,d,a,m,h){var n=[];if(b){var o=b.x==g,p=b.y==d;o||n.push(T5.tween(b,"x",g,a,function(){(o=true)&&p&&m()},h));p||n.push(T5.tween(b,"y",d,a,function(){p=true;o&&p&&m()},h))}return n};T5.cancelAnimation=function(b){if(!e){e=true;try{for(var g=0;g<l.length;)if(!b||b(l[g])){l[g].triggerComplete(true);l.splice(g,1)}else g++}finally{e=false}}};T5.isTweening=function(){return l.length>0};T5.wakeTweens=function(){if(!k){k=COG.Loopage.join({execute:f,frequency:20});
k.bind("complete",function(){k=null})}}})();(function(){var f={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,PINCH:16,FREEZE:128};T5.viewState=function(){for(var l=0,k=arguments.length;k--;){var e=f[arguments[k].toUpperCase()];if(e)l|=e}return l}})();
T5.ViewLayer=function(f){f=T5.ex({id:"",zindex:0,supportFastDraw:false,transparent:false,validStates:T5.viewState("ACTIVE","ANIMATING","PAN","PINCH")},f);var l=null,k=false,e=f.supportFastDraw,b=f.id,g=T5.viewState("ACTIVE"),d=f.validStates,a=0,m=0,h=f.transparent,n=T5.ex({addToView:function(o){o.setLayer(b,n)},shouldDraw:function(o,p,z){if((o=(o&d)!==0&&(k?e:true))&&h)if(o=z||a!==p.x||m!==p.y){a=p.x;m=p.y}return o},cycle:function(){},draw:function(){},remove:function(){COG.say("layer.remove",{id:b})},
wakeParent:function(o){if(l)l.trigger(o?"invalidate":"wake")},getId:function(){return b},setId:function(o){b=o},getParent:function(){return l},setParent:function(o){k=(l=o)?l.fastDraw&&displayState!==g:false;n.trigger("parentChange",l)}},f);COG.observable(n);return n};
T5.View=function(f){function l(w,B,F,J){X=la;E();if(J&&f.inertia){S=true;h(C+B,v+F,f.panAnimationEasing,f.panAnimationDuration)}else J||h(C+B,v+F)}function k(){X=na;S=false;COG.Loopage.join({execute:E,after:50,single:true})}function e(w,B){ca=aa(w);fa=aa(B);var F=pa(ca.dimensions),J=pa(fa.dimensions);da=ma(ca);N=ma(fa);Q=ca&&F!==0?J/F:1}function b(w,B,F){e(B,F);if(ba=Q!==1){X=ia;E()}}function g(w,B,F,J){e(B,F);if(f.adjustScaleFactor){Q=f.adjustScaleFactor(Q);COG.Log.info("scale factor adjusted to: "+
Q)}if(J<f.pinchZoomAnimateTrigger){p(ka,Q,da,z(),T5.easing("sine.out"),function(){a();Q=1},300);Q=ka}else{a();Q=1}}function d(w,B,F){T.zoom(B,Math.min(Math.pow(2,Math.round(Math.log(F))),8),500)}function a(){ba=false;T.trigger("scale",Q,ca?z():N);X=na;E()}function m(){COG.Log.info("window resized, should adjust the canvas size")}function h(w,B,F,J,M){function W(){ja+=1;if(ja>=2){k(0,0);M&&M()}}var ja=0;if(F){w=T5.tweenValue(C,w,F,W,J);B=T5.tweenValue(v,B,F,W,J);w.cancelOnInteract=true;w.requestUpdates(function(ea){C=
ea;S=true;E()});B.cancelOnInteract=true;B.requestUpdates(function(ea){v=ea;S=true;E()})}else{C=w;v=B}}function n(){if(x){COG.Touch.release(x);if(f.autoSize&&x.parentNode){x.height=x.parentNode.offsetHeight;x.width=x.parentNode.offsetWidth;window.addEventListener("resize",m,false)}try{y=x.getContext("2d");y.clearRect(0,0,x.width,x.height)}catch(w){COG.Log.exception(w);throw Error("Could not initialise canvas on specified view element");}oa=COG.Touch.capture(x,{observable:T});K=new T5.Dimensions(x.width,
x.height);f.inertia&&oa.inertiaEnable(f.panAnimationDuration,K);for(var B=L;B--;)I[B].trigger("contextChanged",y);E()}}function o(w,B){B.setId(w);B.added=Date.now();B.trigger("contextChanged",y);B.setParent(T);I.push(B);I.sort(function(F,J){var M=J.zindex-F.zindex;if(M===0)M=J.added-F.added;return M});L=I.length;return B}function p(w,B,F,J,M,W,ja){function ea(){W&&W();a();Q=1;ha=null}ba=true;da=T5.V.copy(F);N=T5.V.copy(J);ca=null;if(M)T5.tweenValue(0,B-w,M,ea,ja?ja:1E3).requestUpdates(function(qa){ha=
qa/(B-w);Q=w+qa;X=ia;E();T.trigger("animate")});else{Q=targetScaleFactor;ea()}}function z(){var w=T5.D.getCenter(K),B=T5.V.distance([N,w]),F=T5.V.theta(N,w,B),J=T5.V.diff(da,N);w=T5.V.pointOnEdge(N,w,F,B/Q);w.x+=J.x;w.y+=J.y;return w}function s(){T.trigger("idle");R=true;Y=0}function r(w,B,F,J){var M=0,W=S?la:G?T5.viewState("FROZEN"):X,ja=(W&ia)!==0,ea=0;if(A||ja){w.clearRect(0,0,x.width,x.height);A=false}if(ja){T5.D.getCenter(K);var qa=(ha?ha:1)/2,ra=T5.V.diff(da,N);if(ca){O.x=N.x+ra.x;O.y=N.y+ra.y}else{O.x=
N.x-ra.x*qa;O.y=N.y-ra.y*qa}B=T5.V.offset(B,O.x,O.y)}w.save();try{ka=Q;if(H!==1)w.scale(H,H);else if(ja){w.translate(N.x,N.y);w.scale(Q,Q)}for(ea=L;ea--;)if(I[ea].shouldDraw(W,B,F)){var sa=I[ea].draw(w,B,K,W,T,F,J);M+=sa?sa:0}}finally{w.restore()}COG.Log.trace("draw complete",J);return M}function u(w,B){var F=false;F=!S&&(X===ia||X===la);var J=ga||X===T5.viewState("PAN")||X===T5.viewState("PINCH")||T5.isTweening();q.x=C>>0;q.y=v>>0;if(F){T5.cancelAnimation(function(W){return W.cancelOnInteract});
R=false;if(Y!==0){clearTimeout(Y);Y=0}}F=J||Q!==1&&Q!==Z;for(var M=L;M--;)F=I[M].cycle(w,q,X,J)||F;if(F){r(y,q,J,w);Z=Q;ga=false}if(!F&&P===0&&!$){if(!R&&Y===0)Y=setTimeout(s,500);B.trigger("complete")}P=0;COG.Log.trace("Completed draw cycle",w)}function t(){ga=true;E()}function E(){P++;if(!(G||D)){D=COG.Loopage.join({execute:u,frequency:30});D.bind("complete",function(){D=null})}}f=T5.ex({id:COG.objId("view"),container:"",fastDraw:false,inertia:true,pannable:true,scalable:true,panAnimationEasing:T5.easing("sine.out"),
panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:true,tapExtent:10},f);var I=[],L=0,x=document.getElementById(f.container),y=null,C=0,v=0,q=new T5.Vector,A=false,D=null,G=false,H=1,K=new T5.Dimensions,P=0,N=null,R=false,S=false,Y=0,V=0,O=new T5.Vector,U=0,ba=false,ca=null,fa=null,ga=false,Q=1,Z=0,ka=1,ha=null,da=null,$=typeof FlashCanvas!=="undefined",oa=null,na=T5.viewState("ACTIVE"),la=T5.viewState("PAN"),ia=T5.viewState("PINCH"),X=na,aa=T5.V.getRect,pa=T5.D.getSize,
ma=T5.R.getCenter,T={id:f.id,deviceScaling:H,fastDraw:f.fastDraw||T5.getConfig().requireFastDraw,animate:function(w,B,F,J,M){p(Q,w,B,F,J,M)},centerOn:function(w){C=w.x-x.width/2;v=w.y-x.height/2},getDimensions:function(){return K},getZoomCenter:function(){return O},getLayer:function(w){for(var B=0;B<L;B++)if(I[B].getId()==w)return I[B];return null},setLayer:function(w,B){for(var F=0;F<L;F++)if(I[F].getId()===w){I.splice(F,1);break}B&&o(w,B);t()},eachLayer:function(w){for(var B=L;B--;)w(I[B])},clearBackground:function(){A=
true;t()},freeze:function(){G=true},unfreeze:function(){G=false;E()},resize:function(w,B){if(x){x.width=w;x.height=B;n();t()}},scale:function(w,B,F,J,M){J||(J=T5.D.getCenter(K));M||(M=T5.D.getCenter(K));T.animate(w,J,M,B,F);return T},removeLayer:function(w){a:{for(var B=L;B--;)if(I[B].getId()==w){w=B;break a}w=-1}if(w>=0&&w<L){COG.say("layer.removed",{layer:I[w]});I.splice(w,1);t()}L=I.length},getOffset:function(){return q},updateOffset:h,zoom:function(w,B,F){S=false;Q=B;ba=Q!==1;da=T5.D.getCenter(K);
N=Q>1?T5.V.copy(w):T5.D.getCenter(K);ca=null;clearTimeout(V);if(ba){X=ia;E();if(F)V=setTimeout(function(){a();Q=1},parseInt(F,10))}}};COG.listen("layer.remove",function(w){w.id&&T.removeLayer(w.id)});H=T5.getConfig().getScaling();T.markers=o("markers",new T5.MarkerLayer);COG.observable(T);T.bind("wake",E);T.bind("invalidate",t);if(f.pannable){T.bind("pan",l);T.bind("panEnd",k);T.bind("inertiaCancel",function(){S=false;E()})}if(f.scalable){T.bind("pinchZoom",b);T.bind("pinchZoomEnd",g);T.bind("wheelZoom",
d)}T.bind("tap",function(w,B,F){for(var J=T5.V.offset(F,C,v),M=I.length;M--;)w.cancel=w.cancel||I[M].trigger("tap",B,F,J).cancel});COG.configurable(T,["inertia","container","rotation","tapExtent"],COG.paramTweaker(f,null,{container:function(w,B){x=document.getElementById(B);n()},rotation:function(w,B){U=B}}),true);n();return T};
T5.PathLayer=function(f){function l(n){n.syncVectors(g);d&&n.syncVectors(d);h.trigger("tidy")}f=T5.ex({style:"waypoints",pixelGeneralization:8,zindex:50},f);var k=false,e=[],b=null,g=[],d=null,a=0,m=[],h=T5.ex(new T5.ViewLayer(f),{getAnimation:function(n,o,p,z){var s="pathAnimation"+a++;m.push(s);return new T5.AnimatedPathLayer({id:s,path:e,zindex:f.zindex+1,easing:n?n:T5.easing("sine.inout"),duration:o?o:5E3,drawIndicator:p,autoCenter:z?z:false})},cycle:function(n,o,p,z){return z},draw:function(n,
o){var p,z=e.length;n.save();try{T5.applyStyle(n,f.style);if(z>0){n.beginPath();n.moveTo(e[z-1].x-o.x,e[z-1].y-o.y);for(p=z;p--;)n.lineTo(e[p].x-o.x,e[p].y-o.y);n.stroke();if(b){n.fillStyle=f.waypointFillStyle;for(p=b.length;p--;){n.beginPath();n.arc(b[p].x-o.x,b[p].y-o.y,2,0,Math.PI*2,false);n.stroke();n.fill()}}}}finally{n.restore()}k=false},updateCoordinates:function(n,o){var p=h.getParent();p=p?p.getTileLayer():null;g=n;d=o;COG.Log.info("updating coordinates, grid = "+p);p&&l(p)}});h.bind("gridUpdate",
function(n,o){l(o);for(var p=m.length;p--;)COG.say("layer.remove",{id:m[p]});m=[]});h.bind("tidy",function(){e=T5.V.simplify(g,f.pixelGeneralization);b=T5.V.simplify(d,f.pixelGeneralization);k=true;h.wakeParent(true)});return h};
T5.Poly=function(f,l){l=T5.ex({fill:false},l);var k=false,e=l.fill,b=[],g={draw:function(d,a,m){if(k){var h=true;d.beginPath();for(var n=b.length;n--;){var o=b[n].x-a,p=b[n].y-m;if(h){d.moveTo(o,p);h=false}else d.lineTo(o,p)}e&&d.fill();d.stroke()}},resync:function(d){d.syncVectors(f);b=f.length<=3?f:T5.V.simplify(f)}};k=f&&f.length>=2;return g};
T5.PolyLayer=function(f){f=T5.ex({zindex:80,transparent:true,style:null},f);var l=[],k=false,e=T5.ex(new T5.ViewLayer(f),{add:function(b){l.unshift(b)},cycle:function(){return k},draw:function(b,g,d,a){d=g.x;g=g.y;b.save();try{T5.applyStyle(b,f.style);for(var m=l.length;m--;)l[m].draw(b,d,g,a)}finally{b.restore()}k=false}});e.bind("gridUpdate",function(b,g){for(var d=l.length;d--;)l[d].resync(g);k=true;e.wakeParent(true)});e.bind("parentChange",function(b,g){var d=g?g.getTileLayer():null;if(d)for(var a=
l.length;a--;)l[a].resync(d)});COG.configurable(e,["style"],COG.paramTweaker(f,null,null),true);return e};
T5.AnimatedPathLayer=function(f){function l(a,m,h){a.fillStyle="#FFFFFF";a.strokeStyle="#222222";a.beginPath();a.arc(h.x,h.y,4,0,Math.PI*2,false);a.stroke();a.fill()}f=T5.ex({path:[],id:COG.objId("pathAni"),easing:T5.easing("sine.inout"),validStates:T5.viewState("ACTIVE","PAN","PINCH"),drawIndicator:null,duration:2E3,autoCenter:false},f);var k=T5.V.edges(f.path),e,b=null,g=0;T5.tweenValue(0,k.total,f.easing,function(){d.remove()},f.duration).requestUpdates(function(a,m){g=a;m&&d.remove()});var d=
T5.ex(new T5.ViewLayer(f),{cycle:function(){for(var a=0;a<k.accrued.length&&k.accrued[a]<g;)a++;b=null;if(a<f.path.length-1){var m=g-(a>0?k.accrued[a-1]:0),h=f.path[a],n=f.path[a+1];e=T5.V.theta(h,n,k.edges[a]);b=T5.V.pointOnEdge(h,n,e,m);if(f.autoCenter)(a=d.getParent())&&a.centerOn(b)}return b},draw:function(a,m){if(b)(f.drawIndicator?f.drawIndicator:l)(a,m,new T5.Vector(b.x-m.x,b.y-m.y),e)}});return d};
T5.Annotation=function(f){f=T5.ex({xy:null,tweenIn:null,animationSpeed:null},f);var l=false,k=T5.ex(f,{xy:f.xy,isNew:true,isAnimating:function(){return l},draw:function(e,b,g,d,a){if(k.xy){if(k.isNew&&f.tweenIn){var m=k.xy.y;k.xy.y=b.y-20;l=true;T5.tween(k.xy,"y",m,f.tweenIn,function(){k.xy.y=m;l=false},f.animationSpeed?f.animationSpeed:250+Math.random()*500)}k.drawMarker(e,b,new T5.Vector(k.xy.x-b.x,k.xy.y-b.y),g,d,a);k.isNew=false}},drawMarker:function(e,b,g){e.beginPath();e.arc(g.x,g.y,4,0,Math.PI*
2,false);e.fill()},hitTest:function(e){return Math.abs(e.x-k.xy.x)<=4&&Math.abs(e.y-k.xy.y)<=4}});return k};
T5.ImageAnnotation=function(f){f=T5.ex({image:null,imageUrl:null,animatingImage:null,animatingImageUrl:null,imageAnchor:null},f);var l=f.imageAnchor?T5.V.invert(f.imageAnchor):null,k=f.image,e=f.animatingImage;if(!k)(k=T5.Images.get(f.imageUrl))||T5.Images.load(f.imageUrl,function(g){k=g});if(!e)(e=T5.Images.get(f.imageUrl))||T5.Images.load(f.animatingImageUrl,function(g){e=g});var b=T5.ex(new T5.Annotation(f),{drawMarker:function(g,d,a){if((d=b.isAnimating()&&e?e:k)&&d.complete&&d.width>0){l||(l=
new T5.Vector(-d.width>>1,-d.height>>1));a=T5.V.offset(a,l.x,l.y);g.drawImage(d,a.x,a.y,d.width,d.height)}},hitTest:function(g){var d=b.xy.x,a=b.xy.y;return g.x>=d+l.x&&g.x<=d+(k.width+l.x)&&g.y>=a+l.y&&g.y<=a+(k.height+l.y)}});return b};
T5.MarkerLayer=function(f){function l(d,a){for(var m=e.length;m--;)a.syncVectors([e[m].xy])}function k(){var d=g.getParent().getTileLayer();d&&l(null,d);g.trigger("markerUpdate",e);g.wakeParent(true)}f=T5.ex({zindex:100},f);var e=[],b=false,g=T5.ex(new T5.ViewLayer(f),{cycle:function(){return b},draw:function(d,a,m,h,n){b=false;for(m=e.length;m--;){e[m].draw(d,a,h,g,n);b=b||e[m].isAnimating()}return b?1:0},add:function(d){if(d&&typeof d.length!=="undefined")for(var a=d.length;a--;){if(d[a])e[e.length]=
d[a]}else if(d)e[e.length]=d;k()},clear:function(){e=[];k()}});g.bind("tap",function(d,a,m,h){for(var n=[],o=e.length;o--;)if(e[o].hitTest(h))n[n.length]=e[o];if(n.length>0)d.cancel=g.trigger("markerTap",a,m,n).cancel});g.bind("gridUpdate",l);return g};
T5.Style=function(f){function l(g){var d=f[g];typeof d!=="undefined"&&k.push(function(a){a[g]=d})}f=T5.ex({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},f);var k=[],e={applyToContext:function(g){for(var d=k.length;d--;)k[d](g)}};for(var b in f)l(b);return e};
(function(){var f={basic:new T5.Style({lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"}),waypoints:new T5.Style({lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"})};T5.applyStyle=function(l,k){(T5.styles[k]?T5.styles[k]:T5.styles.basic).applyToContext(l)};T5.loadStyles=function(l){COG.jsonp(l,function(k){T5.resetStyles(k)})};T5.resetStyles=function(l){var k={};for(var e in l)k[e]=new T5.Style(l[e]);T5.styles=T5.ex({},f,k)};T5.styles=f})();
(function(){T5.tileSize=256;T5.Tile=function(f){return f=T5.ex({x:0,y:0,gridX:0,gridY:0,dirty:true},f)};T5.EmptyTile=function(f){f=new T5.Tile(f);f.empty=true;return f};T5.ImageTile=function(f){f=T5.ex({url:"",sessionParamRegex:null,loading:false,loaded:false},f);return new T5.Tile(f)}})();
T5.TileGrid=function(f){function l(q,A){var D=T5.Vector(q*a-n.x,A*a-n.y);return new T5.EmptyTile({gridX:D.x,gridY:D.y,empty:true})}function k(q,A,D,G){var H=d*0.2>>0,K=new T5.Vector;if(q<0||q+D>d)K.x=q<0?-H:H;if(A<0||A+G>d)K.y=A<0?-H:H;return K}function e(q,A,D){var G=COG.Log.getTraceTicks(),H=0;new T5.Vector(d/2,d/2);if(D)g=[];if(q)for(D=0;D<d;D++)for(var K=0;K<d;K++){if(!g[H]){var P=q(K,D,m,d);P.gridX=K*a-n.x;P.gridY=D*a-n.y;g[H]=P}H++}h=q;p=A;COG.Log.trace("tile grid populated",G);v.wakeParent()}
function b(q,A,D,G){var H,K=[],P=false;q=new T5.Vector((q.x+n.x)*s>>0,(q.y+n.y)*s>>0);if(!C){H=v.getParent().getDimensions();x=Math.ceil(H.width*s)+1;y=Math.ceil(H.height*s)+1;C=new T5.Vector((x-1)/2>>0,(y-1)/2>>0)}tilesNeeded=false;for(var N=y;N--;)for(var R=x;R--;){H=R+q.x>=0&&R+q.x<d?g[(N+q.y)*d+(R+q.x)]:null;var S=new T5.Vector(R-C.x,N-C.y);if(!H){I=k(q.x,q.y,x,y);H=l(R+q.x,N+q.y)}P=H?(H.dirty=D||H.dirty)||P:P;K[K.length]={tile:H,centerness:T5.V.absSize(S)}}K.sort(function(Y,V){return V.centerness-
Y.centerness});u||(u=Array(K.length));for(D=K.length;D--;){u[D]=K[D].tile;v.prepTile(u[D],A)}E=G;return P}f=T5.ex({tileSize:T5.tileSize,center:new T5.Vector,gridSize:25,shiftOrigin:null,supportFastDraw:true,allowShift:true},f);var g=Array(Math.pow(f.gridSize,2)),d=f.gridSize,a=f.tileSize,m=T5.V.offset(f.center,-Math.ceil(f.gridSize>>1)),h=null,n=new T5.Vector,o=false,p=null,z=Math.round(a/2),s=a?1/a:0,r=true,u=null,t=false,E=0;new T5.Vector;var I=new T5.Vector;T5.getConfig();var L=d*a,x,y,C,v=T5.ex(new T5.ViewLayer(f),
{gridDimensions:new T5.Dimensions(L,L),cycle:function(q,A,D,G){var H=false;if(I.x!==0||I.y!==0){G=I;var K=f.shiftOrigin;if(!(!f.allowShift||G.x===0&&G.y===0)){var P=COG.Log.getTraceTicks(),N=Array(g.length);N.length=g.length;for(var R=0;R<d;R++)for(var S=0;S<d;S++)N[S*d+R]=R+G.x>=0&&R+G.x<d?g[(S+G.y)*d+(R+G.x)]:null;g=N;m=K?K(m,G):T5.V.add(m,G);n.x+=-G.x*a;n.y+=-G.y*a;COG.Log.trace("tile storage shifted",P);e(h,p)}I=new T5.Vector;G=true}if(D!==T5.viewState("PINCH"))H=b(A,D,G,q);o=T5.isTweening();
return H},deactivate:function(){r=false},find:function(q){if(!q)return null;for(var A=g.length;A--;){var D=g[A];if(D&&q(D))return D}return null},prepTile:function(){},drawTile:function(){return false},getTileSize:function(){return a},clearTileRect:function(q,A,D,G){q.clearRect(A,D,G,G)},draw:function(q,A,D,G,H,K){if(r){var P=A.x;A=A.y;var N=D.width,R=D.height,S=true;if(u){K||q.beginPath();for(var Y=u.length;Y--;){var V=u[Y],O=V.gridX-P,U=V.gridY-A;K||q.rect(O,U,a,a);V.x=O;V.y=U;if(V.empty){COG.Log.info("empty tile @ x: "+
O+", y: "+U);v.clearTileRect(q,O,U,a,G);S=false}else if(K||V.dirty){o&&v.clearTileRect(q,O,U,a,G);S=v.drawTile(q,V,O,U,G)&&S}N=O<N?O:N;R=U<R?U:R}K||q.clip();N>0&&q.clearRect(0,0,N,D.height);R>0&&q.clearRect(0,0,D.width,R);S&&!t&&H.trigger("tileDrawComplete");t=S}}},getTileAtXY:function(q,A){for(var D=null,G=u?u.length:0;G--;){var H=u[G];if(H&&q>=H.x&&A>=H.y)if(q<=H.x+a&&A<=H.y+a){D=H;break}}COG.Log.info("looking for tile @ x: "+q+", y: "+A+", found: "+D);return D},getTileVirtualXY:function(q,A,D){q=
T5.V.add(new T5.Vector(q,A),T5.V.invert(m),n);q=new T5.Vector(q.x*a,q.y*a);if(D){q.x+=z;q.y+=z}return q},populate:function(q){e(q,null,true)}});COG.listen("imagecache.cleared",function(){for(var q=g.length;q--;)if(g[q])g[q].loaded=false});COG.listen("tiler.repaint",function(){for(var q=g.length;q--;)if(g[q]){g[q].x=null;g[q].y=null}});return v};
T5.ImageTileGrid=function(f){function l(p){function z(){var s=T5.Images.newCanvas(32,32),r=s.getContext("2d");r.fillStyle="#BBBBBB";r.fillRect(0,0,32,32);r.fillStyle="#C3C3C3";r.fillRect(0,0,16,16);r.fillRect(16,16,16,16);return s}if(!e||p!==e.width){e=T5.Images.newCanvas(p,p);p=e.getContext("2d");p.fillStyle=typeof FlashCanvas!=="undefined"?"#666666":p.createPattern(z(),"repeat");p.fillRect(0,0,e.width,e.height)}return e}f=T5.ex({emptyTile:function(p){if(!k||p!==k.width){k=T5.Images.newCanvas(p,
p);p=k.getContext("2d");p.fillStyle="rgba(150, 150, 150, 0.1)";p.fillRect(0,0,k.width,k.height)}return k}(T5.tileSize),panningTile:null,tileOffset:new T5.Vector,tileDrawArgs:{}},f);var k=f.emptyTile,e=f.panningTile?f.panningTile:l(T5.tileSize),b=T5.viewState("ACTIVE"),g=T5.viewState("PAN"),d=T5.getConfig().requireFastDraw,a=f.tileSize?f.tileSize:T5.tileSize,m=T5.Images.get,h=T5.Images.load,n=T5.ex({background:null,overlay:null,offset:new T5.Vector,realSize:new T5.Dimensions(a,a)},f.tileDrawArgs),
o=T5.ex(new T5.TileGrid(f),{clearTileRect:function(p,z,s,r,u){(u&g)===0&&p.clearRect(z,s,r,r)},drawTile:function(p,z,s,r,u){var t=z.url?m(z.url):null,E=false;if(t){p.drawImage(t,s,r);E=true}else if((u&g)!==0)p.drawImage(e,s,r);else if(k&&!z.drawnEmpty){p.drawImage(k,s,r);z.drawnEmpty=true}z.dirty=false;return E},initTileUrl:function(){},prepTile:function(p,z){if(p&&!p.loading&&(!d||z===b)){p.url||o.initTileUrl(p);if(!m(p.url)){p.loading=true;h(p.url,function(){p.loaded=true;p.dirty=true;o.wakeParent()},
n)}}}});return o};
T5.Tiler=function(f){f=T5.ex({container:"",drawCenter:false,datasources:{},tileLoadThreshold:"first"},f);var l=T5.ex(new T5.View(f),{getTileLayer:function(){return l.getLayer("grid0")},setTileLayer:function(k){l.setLayer("grid0",k);l.trigger("gridUpdate",k);l.eachLayer(function(e){e.trigger("gridUpdate",k)})},viewPixToGridPix:function(k){var e=l.getOffset();return new T5.Vector(k.x+e.x,k.y+e.y)},centerOn:function(k,e,b,g){var d=l.getTileLayer(),a=l.getDimensions();(d=d?d.getTileSize():0)&&l.updateOffset(k.gridX-
(a.width-d)*0.5>>0,k.gridY-(a.height-d)*0.5>>0,e,b,g)},cleanup:function(){l.removeLayer("grid0")},repaint:function(){COG.say("tiler.repaint");l.trigger("wake")},select:function(k){l.trigger("selectTile",k)}});l.bind("tap",function(k,e,b){if(k=l.getTileLayer())(b=k.getTileAtXY(b.x,b.y))&&l.trigger("selectTile",b)});return l};
T5.Geo=function(){function f(x,y){var C=null;for(var v in I)if(y){if(v==y&&I[v][x]){C=I[v];break}}else if(I[v][x]){C=I[v];break}return C}function l(x,y){var C=m*Math.sin(x);return d-2*Math.atan(y*Math.pow((1-C)/(1+C),m/2))}function k(x,y,C,v){var q=0;x=x.toUpperCase();for(var A in v){var D=y[A];if(D){var G=C[A];D=G?G(x,D):COG.wordExists(x,D)?1:0;q+=D*v[A]}}return q}var e=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],b=Math.PI/180,g=180/Math.PI,d=Math.PI/
2,a=Math.PI*2,m=0.08181919084262157,h=null,n={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",HWY:"HIGHWAY",MWY:"MOTORWAY"},o={VECTORIZE_PER_CYCLE:500},p={getEngine:function(x){for(var y=null,C=1;!y&&C<arguments.length;C++)y=f(x,arguments[C]);y=y?y:f(x);if(!y)throw Error("Unable to find GEO engine with "+x+" capability");return y},rankGeocodeResponses:function(x,y,C){var v=[],q=L.AddressCompareFns;if(C&&C.compareFns)q=T5.ex({},q,C.compareFns);for(C=0;C<y.length;C++)v.push(new L.GeoSearchResult({caption:E.toString(y[C]),
data:y[C],pos:y[C].pos,matchWeight:k(x,y[C],q,L.GeocodeFieldWeights)}));v.sort(function(A,D){return D.matchWeight-A.matchWeight});return v},distanceToString:function(x){if(x>1E3)return~~(x/10)/100+" km";return x?x+" m":""},dist2rad:function(x){return x/6371},lat2pix:function(x){x=parseFloat(x)*b;x=Math.sin(x);var y=m*x;return Math.log((1+x)/(1-x)*Math.pow((1-y)/(1+y),m))/2},lon2pix:function(x){return parseFloat(x)*b},pix2lon:function(x){return L.normalizeLon(x)*g},pix2lat:function(x){x=Math.pow(Math.E,
-x);for(var y=d-2*Math.atan(x),C=l(y,x),v=0;v<12&&Math.abs(y-C)>1.0E-7;){y=C;C=l(y,x);v++}return C*g},normalizeLon:function(x){for(;x<-180;)x+=360;for(;x>180;)x-=360;return x}},z=function(x,y){return{lat:parseFloat(x?x:0),lon:parseFloat(y?y:0)}},s=function(x,y){return{min:u.parse(x),max:u.parse(y)}},r=function(x){return x=T5.ex({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},x)},u=function(){var x={calcDistance:function(y,C){if(x.empty(y)||x.empty(C))return 0;var v=
(C.lat-y.lat)*b/2,q=(C.lon-y.lon)*b/2;v=Math.sin(v)*Math.sin(v)+Math.cos(y.lat*b)*Math.cos(C.lat*b)*Math.sin(q)*Math.sin(q);return 6371*2*Math.atan2(Math.sqrt(v),Math.sqrt(1-v))},copy:function(y){return y?new z(y.lat,y.lon):null},empty:function(y){return!y||y.lat===0&&y.lon===0},equal:function(y,C){return y&&C&&y.lat==C.lat&&y.lon==C.lon},inArray:function(y,C){for(var v=u.equal,q=C.length;q--;)if(v(y,C[q]))return true;return false},inBounds:function(y,C){var v=!(u.empty(y)||u.empty(C));return v=(v=
v&&y.lat>=C.min.lat&&y.lat<=C.max.lat)&&y.lon>=C.min.lon&&y.lon<=C.max.lon},parse:function(y){if(y)if(typeof y.lat!=="undefined")return x.copy(y);else{if(y.split)for(var C=[" ",","],v=0;v<C.length;v++){var q=y.split(C[v]);if(q.length===2)return new z(q[0],q[1])}}else return new z;return null},parseArray:function(y){var C=y.length,v=Array(C);for(C=C;C--;)v[C]=x.parse(y[C]);return v},fromMercatorPixels:function(y,C){return new z(T5.Geo.pix2lat(C),T5.Geo.normalizeLon(T5.Geo.pix2lon(y)))},toMercatorPixels:function(y){return new T5.Vector(T5.Geo.lon2pix(y.lon),
T5.Geo.lat2pix(y.lat))},generalize:function(y,C,v){var q=y.length,A=[],D=null;v||(v=250);v/=1E3;COG.Log.info("generalizing positions, must include "+C.length+" positions");for(var G=q;G--;)if(G===0)A.unshift(y[G]);else{var H=!D||u.inArray(y[G],C)?v:u.calcDistance(D,y[G]);if(y[G]&&H>=v){A.unshift(y[G]);D=y[G]}}COG.Log.info("generalized "+q+" positions into "+A.length+" positions");return A},vectorize:function(y,C){var v=y.length,q=Array(v);C=T5.ex({chunkSize:o.VECTORIZE_PER_CYCLE,async:true},C);if(!C.async){for(var A=
v;A--;)q[A]=new T5.Geo.GeoVector(y[A]);return q}return COG.Loopage.join({frequency:10,execute:function(D,G){for(var H=0,K=C.chunkSize,P=v;P--;){q[P]=new T5.Geo.GeoVector(y[P]);H+=1;if(H>K)break}v=P;v<=0&&G.trigger("complete",q)}})},toString:function(y){return y?y.lat+" "+y.lon:""}};return x}(),t=function(){var x=-d,y=d,C=-a,v={calcSize:function(q,A,D){var G=new T5.Vector(0,A.lat-q.lat);if(typeof D==="undefined")D=true;G.x=D&&q.lon>A.lon?360-q.lon+A.lon:A.lon-q.lon;return G},createBoundsFromCenter:function(q,
A){var D=A/6371,G=q.lat*b,H=q.lon*b,K=G-D,P=G+D;if(K>x&&P<y){G=Math.asin(Math.sin(D)/Math.cos(G));D=H-G;if(D<C)D+=2*Math.PI;H=H+G;if(H>a)H-=2*Math.PI}else{K=Math.max(K,x);P=Math.min(P,y);D=C;H=a}return new s(new z(K*g,D*g),new z(P*g,H*g))},expand:function(q,A){return new s(new z(q.min.lat-A,q.min.lon-L.normalizeLon(A)),new z(q.max.lat+A,q.max.lon+L.normalizeLon(A)))},forPositions:function(q,A){var D=null,G=Date.now();A||(A="auto");for(var H=q.length;H--;)if(D){var K=v.calcSize(D.min,q[H],false),P=
v.calcSize(q[H],D.max,false);if(K.x<0)D.min.lon=q[H].lon;if(K.y<0)D.min.lat=q[H].lat;if(P.x<0)D.max.lon=q[H].lon;if(P.y<0)D.max.lat=q[H].lat}else D=new T5.Geo.BoundingBox(q[H],q[H]);if(A){if(A=="auto"){H=v.calcSize(D.min,D.max);A=Math.max(H.x,H.y)*0.3}D=v.expand(D,A)}COG.Log.trace("calculated bounds for "+q.length+" positions",G);return D},getCenter:function(q){var A=t.calcSize(q.min,q.max);return new T5.Geo.Position(q.min.lat+A.y/2,q.min.lon+A.x/2)},getGeoHash:function(q){var A=T5.Geo.GeoHash.encode(q.min.lat,
q.min.lon);q=T5.Geo.GeoHash.encode(q.max.lat,q.max.lon);COG.Log.info("min hash = "+A+", max hash = "+q)},getZoomLevel:function(q,A){var D=v.getCenter(q),G=e[Math.min(Math.round(Math.abs(D.lat)*0.05),e.length)],H=v.calcSize(q.min,q.max);D=Math.ceil(Math.log(e[3]*A.height/H.y)/Math.log(2));G=Math.ceil(Math.log(G*A.width/H.x)/Math.log(2));return Math.min(isNaN(D)?1E3:D,isNaN(G)?1E3:G)},isEmpty:function(q){return!q||u.empty(q.min)||u.empty(q.max)},toString:function(q){return"min: "+u.toString(q.min)+
", max: "+u.toString(q.max)}};return v}(),E=function(){var x=/^(\d+).*$/,y=/(\d+)\s?\-\s?(\d+)/;return{buildingMatch:function(C,v){x.lastIndex=-1;if(x.test(C))for(var q=C.replace(x,"$1"),A=v.split(","),D=0;D<A.length;D++){y.lastIndex=-1;if(y.test(A[D])){var G=y.exec(A[D]);if(q>=parseInt(G[1],10)&&q<=parseInt(G[2],10))return true}else if(q==A[D])return true}return false},normalize:function(C){if(!C)return"";C=C.toUpperCase();if(!h){var v=[];for(var q in n)v.push(q);h=RegExp("(\\s)("+v.join("|")+")(\\s|$)",
"i")}h.lastIndex=-1;if(v=h.exec(C))C=C.replace(h,"$1"+n[v[2]]);return C},toString:function(C){return C.streetDetails+" "+C.location}}}(),I={},L={P:u,B:t,A:E,Radius:function(x,y){return{distance:parseInt(x,10),uom:y}},Position:z,BoundingBox:s,GeoVector:function(x){var y=new T5.Vector;T5.ex(y,{radsPerPixel:null,setRadsPerPixel:function(C,v,q){var A=y.mercXY;y.x=Math.abs((A.x/C>>0)+(v?v:0));y.y=Math.abs((A.y/C>>0)+(q?q:0));y.radsPerPixel=C}});(function(C){y.pos=C;y.mercXY=u.toMercatorPixels(C)})(x);
return y},Address:r,GeocodeFieldWeights:{streetDetails:50,location:50},AddressCompareFns:{},Engine:function(x){if(!x.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var y=T5.ex({remove:function(){delete I[y.id]}},x);return I[y.id]=y},GeoSearchResult:function(x){x=T5.ex({id:null,caption:"",resultType:"",data:null,pos:null,matchWeight:0},x);return T5.ex(x,{toString:function(){return x.caption+(x.matchWeight?" ("+x.matchWeight+")":"")}})},GeoSearchAgent:function(x){return new T5.Dispatcher.Agent(x)},
GeocodingAgent:function(x){x=T5.ex({name:"Geocoding Search Agent",paramTranslator:null,execute:function(y,C){try{if(!y.reverse&&!y.freeform)address=new r(y);var v=L.getEngine("geocode");if(v)v.geocode({addresses:[y.freeform?y.freeform:address],complete:function(A,D){if(C){var G=D;if(y.freeform)G=L.rankGeocodeResponses(y.freeform,G,L.getEngine("geocode"));C(G,x)}}})}catch(q){COG.Log.exception(q)}}},x);return new L.GeoSearchAgent(x)}};return T5.ex(L,o,p)}();
T5.Geo.GeoHash=function(){function f(l,k,e){if(k&e)l[0]=(l[0]+l[1])/2;else l[1]=(l[0]+l[1])/2}BITS=[16,8,4,2,1];BASE32="0123456789bcdefghjkmnpqrstuvwxyz";NEIGHBORS={right:{even:"bc01fg45238967deuvhjyznpkmstqrwx"},left:{even:"238967debc01fg45kmstqrwxuvhjyznp"},top:{even:"p0r21436x8zb9dcf5h7kjnmqesgutwvy"},bottom:{even:"14365h7k9dcfesgujnmqp0r2twvyx8zb"}};BORDERS={right:{even:"bcfguvyz"},left:{even:"0145hjnp"},top:{even:"prxz"},bottom:{even:"028b"}};NEIGHBORS.bottom.odd=NEIGHBORS.left.even;NEIGHBORS.top.odd=
NEIGHBORS.right.even;NEIGHBORS.left.odd=NEIGHBORS.bottom.even;NEIGHBORS.right.odd=NEIGHBORS.top.even;BORDERS.bottom.odd=BORDERS.left.even;BORDERS.top.odd=BORDERS.right.even;BORDERS.left.odd=BORDERS.bottom.even;BORDERS.right.odd=BORDERS.top.even;return{decode:function(l){var k=1,e=[],b=[];e[0]=-90;e[1]=90;b[0]=-180;b[1]=180;lat_err=90;lon_err=180;for(i=0;i<l.length;i++){c=l[i];cd=BASE32.indexOf(c);for(j=0;j<5;j++){mask=BITS[j];if(k){lon_err/=2;f(b,cd,mask)}else{lat_err/=2;f(e,cd,mask)}k=!k}}e[2]=(e[0]+
e[1])/2;b[2]=(b[0]+b[1])/2;return{latitude:e,longitude:b}},encode:function(l,k,e){var b=1,g=[],d=[],a=0,m=0;e=e?e:12;geohash="";g[0]=-90;g[1]=90;d[0]=-180;for(d[1]=180;geohash.length<e;){if(b){mid=(d[0]+d[1])/2;if(k>mid){m|=BITS[a];d[0]=mid}else d[1]=mid}else{mid=(g[0]+g[1])/2;if(l>mid){m|=BITS[a];g[0]=mid}else g[1]=mid}b=!b;if(a<4)a++;else{geohash+=BASE32[m];m=a=0}}return geohash}}}();
T5.Geo.JSON=function(){function f(d,a){var m=k(a);d.add(new T5.Poly(m))}function l(d,a){var m=k(a[0]);d.add(new T5.Poly(m,{fill:true}))}function k(d){var a=d.length,m=Array(a);for(a=a;a--;)m[a]=new T5.Geo.Position(d[a][1],d[a][0]);return T5.Geo.P.vectorize(m,e)}var e={async:false},b={linestring:f,multilinestring:function(d,a){for(var m=0;m<a.length;m++)f(d,a[m])},polygon:l,multipolygon:function(d,a){for(var m=0;m<a.length;m++)l(d,a[m])}},g=function(d,a,m){m=T5.ex({vectorsPerCycle:T5.Geo.VECTORIZE_PER_CYCLE,
rowPreParse:null,targetLayer:null},m);var h=m.vectorsPerCycle,n=m.targetLayer,o=m.rowPreParse,p=0,z=0;if(!d)return null;if(typeof d.length==="undefined")d=[d];z=d.length;n||(n=new T5.PolyLayer);m=COG.Loopage.join({frequency:10,execute:function(s,r){for(var u=0,t=p;t<z;t++){var E=o?o(d[t]):d[t],I=E.type?E.type.toLowerCase():null;I=b[I];var L=null;if(I)L=I(n,E.coordinates);u+=L?L:1;if(u>=h)break}p=t+1;p>=z&&r.trigger("complete")}});m.bind("complete",function(){a&&a(n)});return m};return{parse:function(d,
a,m){return new g(d,a,m)}}}();
T5.Geo.LocationSearch=function(f){function l(d,a){navigator.geolocation.clearWatch(e);e=0;if(b){clearTimeout(b);b=0}a&&a([d],f)}function k(d){COG.Log.info("caught location tracking error:",d)}f=T5.ex({name:"Geolocation Search",requiredAccuracy:null,searchTimeout:5E3,watch:false},f);var e=0,b=0,g=null;return new T5.Geo.GeoSearchAgent(T5.ex({execute:function(d,a){if(navigator.geolocation&&!e){e=navigator.geolocation.watchPosition(function(m){var h=new T5.Geo.Position(m.coords.latitude,m.coords.longitude);
m=new T5.Geo.GeoSearchResult({id:1,caption:"Current Location",pos:h,accuracy:m.coords.accuracy/1E3,matchWeight:100});if(!g||m.accuracy<g.accuracy)g=m;if(!f.requiredAccuracy||g.accuracy<f.requiredAccuracy)l(g,a)},k,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3});if(f.searchTimeout)b=setTimeout(function(){g&&l(g,a)},f.searchTimeout)}}},f))};
T5.Map=function(f){function l(r){try{var u=new T5.Geo.Position(r.coords.latitude,r.coords.longitude),t=r.coords.accuracy/1E3;s.trigger("locationUpdate",r,t);if(p){if(!n){n=new T5.Geo.UI.LocationOverlay({pos:u,accuracy:t});n.update(s.getTileLayer());s.setLayer("location",n)}var E=T5.Geo.B.createBoundsFromCenter(u,Math.max(t,1));s.gotoBounds(E)}else{n.pos=u;n.accuracy=t;n.update(s.getTileLayer());s.panToPosition(u,null,T5.easing("sine.out"))}p=false}catch(I){COG.Log.exception(I)}}function k(r){COG.Log.info("caught location tracking error:",
r)}f=T5.ex({tapExtent:10,provider:null,crosshair:false,zoomLevel:0,boundsChangeThreshold:30,pois:new T5.Geo.POIStorage,zoomAnimation:T5.easing("quad.out")},f);var e={NONE:0,SINGLE:1,WATCH:2},b=new T5.Vector,g=e.NONE,d=false,a=[],m=null,h=null,n=null,o=0,p=true,z=f.zoomLevel;if(!f.provider)f.provider=new T5.Geo.MapProvider;f.adjustScaleFactor=function(r){return Math.pow(2,(r<1?Math.floor:Math.ceil)(Math.log(r)))};var s=T5.ex({},new T5.Tiler(f),{pois:f.pois,annotations:null,getBoundingBox:function(){var r=
s.getTileLayer(),u=s.getOffset(),t=s.getDimensions();if(r)return r.getBoundingBox(u.x,u.y,t.width,t.height);return null},getCenterPosition:function(){return s.getXYPosition(T5.D.getCenter(s.getDimensions()))},getXYPosition:function(r){return s.getTileLayer().pixelsToPos(s.viewPixToGridPix(r))},gotoBounds:function(r,u){var t=T5.Geo.B.getZoomLevel(r,s.getDimensions());s.gotoPosition(T5.Geo.B.getCenter(r),t,u)},gotoPosition:function(r,u,t){function E(y){s.setTileLayer(y);s.panToPosition(r,function(){s.unfreeze();
s.trigger("zoomLevelChange",z);t&&t()});d=true}var I=z,L=!d,x=s.getBoundingBox();if(x)L=L||!T5.Geo.P.inBounds(r,x);z=u?u:z;if(!z)throw Error("Zoom level required to goto a position.");if(f.provider)z=f.provider.checkZoomLevel(z);if(L||z!==I){T5.Images.cancelLoad();(u=s.getTileLayer())&&u.deactivate();T5.cancelAnimation();d&&s.freeze();f.provider.zoomLevel=z;f.provider.getMapTiles(s,r,E)}else s.panToPosition(r,t)},panToPosition:function(r,u,t,E){var I=s.getTileLayer();if(I){r=I.getGridXYForPosition(r);
I=s.getDimensions();r.x-=I.width/2;r.y-=I.height/2;if(h)h=null;s.updateOffset(r.x,r.y,t,E,u);s.trigger("wake");s.trigger("boundsChange",s.getBoundingBox());u&&typeof t==="undefined"&&u(s)}},locate:function(){s.trackStart(e.SINGLE);setTimeout(s.trackCancel,1E4)},trackStart:function(r){if(navigator.geolocation&&!o){g=r?r:e.WATCH;p=true;o=navigator.geolocation.watchPosition(l,k,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3})}},trackCancel:function(){o&&navigator.geolocation&&navigator.geolocation.clearWatch(o);
s.removeLayer("location");n=null;g=e.NONE;o=0},getZoomLevel:function(){return z},setZoomLevel:function(r){try{s.gotoPosition(s.getCenterPosition(),r)}catch(u){COG.Log.exception(u)}},zoomIn:function(){s.scale(2,T5.easing("sine.out"))||s.setZoomLevel(z+1)},zoomOut:function(){s.scale(0.5,T5.easing("sine.out"))||s.setZoomLevel(z-1)},animateRoute:function(r,u,t,E){var I=s.getLayer("route");if(I)(r=I.getAnimation(r,u,t,E))&&r.addToView(s)}});s.bind("pan",function(){g===e.SINGLE&&s.trackCancel()});s.bind("tap",
function(r,u,t){var E=s.getTileLayer(),I=null;if(E){var L=s.viewPixToGridPix(new T5.Vector(t.x,t.y));r=E.pixelsToPos(L);I=E.pixelsToPos(T5.V.offset(L,-f.tapExtent,f.tapExtent));E=E.pixelsToPos(T5.V.offset(L,f.tapExtent,-f.tapExtent));I=new T5.Geo.BoundingBox(I,E);a=s.pois.findByBounds(I);s.trigger("geotap",u,t,r,I);s.trigger("tapPOI",a)}});s.bind("doubleTap",function(r,u,t){s.animate(2,T5.D.getCenter(s.getDimensions()),new T5.Vector(t.x,t.y),f.zoomAnimation)});s.bind("scale",function(r,u,t){r=0;u=
Math.sqrt(u);if(u<1)r=-(0.5/u);else if(u>1)r=u;s.gotoPosition(s.getXYPosition(t),z+r>>0)});s.markers.bind("markerUpdate",function(r,u){for(var t=s.getTileLayer(),E=u.length;E--;)t.syncVectors([u[E].xy])});m=new T5.Geo.UI.AnnotationsOverlay({pois:s.pois,map:s});s.annotations=m;s.setLayer("annotations",m);f.crosshair&&s.setLayer("crosshair",new CrosshairOverlay);s.bind("idle",function(){if(T5.V.absSize(T5.V.diff(b,s.getOffset()))>f.boundsChangeThreshold){b=T5.V.copy(s.getOffset());s.trigger("boundsChange",
s.getBoundingBox())}});COG.configurable(s,["provider"],COG.paramTweaker(f,null,{provider:function(){s.cleanup();d=false}}),true);return s};T5.Geo.MapProvider=function(){var f=1,l=20;return{zoomLevel:0,checkZoomLevel:function(k){return Math.min(Math.max(k,f),l)},getCopyright:function(){},getLogoUrl:function(){},getMapTiles:function(){},getZoomRange:function(){return{min:f,max:l}},setZoomRange:function(k,e){f=k;l=e}}};
T5.Geo.PointOfInterest=function(f){f=T5.ex({id:0,title:"",pos:null,lat:"",lon:"",group:"",retrieved:0,isNew:true},f);if(!f.pos&&f.lat&&f.lon)f.pos=new T5.Geo.Position(f.lat,f.lon);return T5.ex({toString:function(){return f.id+": '"+f.title+"'"}},f)};
T5.Geo.POIStorage=function(f){function l(a){a=a?a:"default";b[a]||(b[a]=[]);return b[a]}function k(a){var m=[];for(var h in b)for(var n=0;n<b[h].length;n++)if(!a||a(b[h][n]))m.push(b[h][n]);return m}function e(){COG.say("geo.pois-updated",{srcID:d.id,pois:d.getPOIs()})}f=T5.ex({visibilityChange:null,onPOIDeleted:null,onPOIAdded:null},f);var b={},g=true,d={id:COG.objId(),getPOIs:function(){return k()},getOldPOIs:function(a,m){return k(function(h){return h.group==a&&h.retrieved<m})},getVisible:function(){return g},
setVisible:function(a){if(a!=g){g=a;f.visibilityChange&&f.visibilityChange()}},findById:function(a){var m=k(function(h){return h.id==a});return m.length>0?m[0]:null},findByBounds:function(a){return k(function(m){return T5.Geo.P.inBounds(m.pos,a)})},addPOIs:function(a,m){if(m)b={};for(var h=0;a&&h<a.length;h++){a[h].retrieved=Date.now();var n=a[h];l(n.group).push(n)}},removeGroup:function(a){if(b[a]){delete b[a];e()}},update:function(a){var m=[],h=0,n=a.length>0?a[0].group:"",o=Date.now();for(h=0;h<
a.length;h++){var p;a:{if(p=a[h])for(var z=l(p.group),s=0;s<z.length;s++)if(z[s].id==p.id){p=z[s];break a}p=null}if(p){p.retrieved=o;p.isNew=false}else m.push(a[h])}a=d.getOldPOIs(n,o);d.addPOIs(m);for(h=0;f.onPOIAdded&&h<m.length;h++)f.onPOIAdded(m[h]);for(h=0;h<a.length;h++){f.onPOIDeleted&&f.onPOIDeleted(a[h]);n=a[h];o=l(n.group);for(p=0;p<o.length;p++)if(o[p].id==n.id){o.splice(p,1);break}}m.length+a.length>0&&e()}};return d};
T5.Geo.Routing=function(){var f={calculate:function(l){l=T5.ex({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},l);var k=T5.Geo.getEngine("route");k&&k.route(l,function(e){if(l.generalize)e.geometry=T5.Geo.P.generalize(e.geometry,e.getInstructionPositions());if(l.map){f.createMapOverlay(l.map,e);l.autoFit&&l.map.gotoBounds(e.boundingBox)}l.success&&l.success(e)})},createMapOverlay:function(l,k){var e=l.getDimensions();e=new T5.Geo.UI.RouteOverlay({data:k,width:e.width,
height:e.height});l.setLayer("route",e)},parseTurnType:function(l){for(var k=f.TurnType.Unknown,e=T5.Geo.Routing.TurnTypeRules,b=0;b<e.length;b++){e[b].regex.lastIndex=-1;var g=e[b].regex.exec(l);if(g){k=e[b].customCheck?e[b].customCheck(l,g):e[b].turnType;break}}return k},TurnType:{Unknown:"turn-unknown",Start:"turn-none-start",Continue:"turn-none",Arrive:"turn-none-arrive",TurnLeft:"turn-left",TurnLeftSlight:"turn-left-slight",TurnLeftSharp:"turn-left-sharp",TurnRight:"turn-right",TurnRightSlight:"turn-right-slight",
TurnRightSharp:"turn-right-sharp",Merge:"merge",UTurnLeft:"uturn-left",UTurnRight:"uturn-right",EnterRoundabout:"roundabout-enter",Ramp:"ramp",RampExit:"ramp-exit"},Instruction:function(l){var k=l=T5.ex({position:null,description:"",distance:0,distanceTotal:0,time:0,timeTotal:0,turnType:null},l),e=l.description;e=e.replace(/(\w)(\/)(\w)/g,"$1 $2 $3");k.description=e;if(!l.turnType)l.turnType=f.parseTurnType(l.description);return l},RouteData:function(l){l=T5.ex({geometry:[],instructions:[],boundingBox:null},
l);if(!l.boundingBox)l.boundingBox=T5.Geo.B.forPositions(l.geometry);return T5.ex({getInstructionPositions:function(){for(var k=[],e=0;e<l.instructions.length;e++)l.instructions[e].position&&k.push(l.instructions[e].position);return k}},l)}};return f}();T5.Geo.Search=function(){return{bestResults:function(f,l){l||(l=20);for(var k=f.length>0?f[0]:null,e=[],b=0;b<f.length;b++)if(k&&f[b]&&k.matchWeight-f[b].matchWeight<=l)e.push(f[b]);else break;return e}}}();
T5.Geo.UI=function(){var f={AnnotationTween:null,GeoTileGrid:function(l){l=T5.ex({grid:null,centerPos:new T5.Geo.Position,centerXY:new T5.Vector,radsPerPixel:0},l);var k=l.radsPerPixel,e=T5.Geo.P.toMercatorPixels(l.centerPos),b=e.x/k-l.centerXY.x>>0,g=e.y/k-l.centerXY.y>>0,d=null,a=T5.ex({},l.grid,{getBoundingBox:function(m,h,n,o){return new T5.Geo.BoundingBox(a.pixelsToPos(new T5.Vector(m,h+o)),a.pixelsToPos(new T5.Vector(m+n,h)))},getGridXYForPosition:function(m){m=new T5.Geo.GeoVector(m);a.syncVectors([m]);
return m},syncVectors:function(m){for(var h=m.length;h--;)m[h]&&m[h].setRadsPerPixel&&m[h].setRadsPerPixel(k,-b,-d)},getPixelDistance:function(m){return T5.Geo.dist2rad(m)/k>>0},pixelsToPos:function(m){return T5.Geo.P.fromMercatorPixels((b+m.x)*k,(g+a.gridDimensions.height-m.y)*k)}});d=g+a.gridDimensions.height;return a},RouteOverlay:function(l){l=T5.ex({data:null,pixelGeneralization:8,partialDraw:false,strokeStyle:"rgba(0, 51, 119, 0.9)",waypointFillStyle:"#FFFFFF",lineWidth:4,zindex:50},l);var k=
[],e=[],b=new T5.PathLayer(l);(function(){if(l.data&&l.data.instructions){for(var g=l.data.instructions,d=Array(g.length),a=g.length;a--;)d[a]=g[a].position;T5.Geo.P.vectorize(d).bind("complete",function(m,h){e=h})}l.data&&l.data.geometry&&T5.Geo.P.vectorize(l.data.geometry).bind("complete",function(m,h){k=h;b.updateCoordinates(k,e,true)})})();return b},Annotation:function(l){l=T5.ex({pos:null},l);l.xy=new T5.Geo.GeoVector(l.pos);return new T5.ImageAnnotation(l)},LocationOverlay:function(l){l=T5.ex({pos:null,
accuracy:null,zindex:90},l);var k=new Image,e=new T5.Vector,b=new T5.Vector,g=null;k.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAACIQAAAiEBPhEQkwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAG+SURBVCiRlZHNahNRAIW/O7mTTJPahLZBA1YUyriINRAE3bQIKm40m8K8gLj0CRQkO32ELHUlKbgoIu4EqeJPgtCaoBuNtjXt5LeTMZk0mbmuWiuuPLsD3+HAOUIpxf9IHjWmaUbEyWv5ROrsVULhcHP761rUfnN3Y2Otc8CIg4YT85lzuVsPP+Qupw1vpPjRCvhS9ymvV0e77x7nNj+uvADQAIQQ+uLyvdfLV9JGZi7EdEwQlqBpEJ019f0z1mo2u5Q8DMydv25lshemmj1FueZTawbs7inarqLbV7Qjab1upB9YlhWSAHLavLHZCvg1VEhN0PMU9W7At4bPVidg7CtkLLXkut+lBPD6/Ub155jJiADAHSpaLmx3ApyBQoYEUd0PBoOBkAC6+3llvda/YxgGgYL+UNHf/zN3KiExGlsvTdP0NYDkhPdWrz35ZDsBzV5wCMuQwEyFmXFeeadjzfuFQmGkAZRKpdGC/n7x+M6jqvA9Zo6FWDhlcHE+wqT93J1tP7vpOE7rrx8ALMuasPf8S12St4WmJ6bYWTUC52k8Hm8Vi0X/nwBAPp/XKpWKdF1X2LYdlMvlsToC/QYTls7DLFr/PAAAAABJRU5ErkJggg%3D%3D";
k.onload=function(){e=new T5.Vector(k.width/2,k.height/2)};var d=T5.ex(new T5.ViewLayer(l),{pos:l.pos,accuracy:l.accuracy,drawAccuracyIndicator:false,draw:function(a,m){var h=b.x-m.x,n=b.y-m.y;if(g){a.fillStyle="rgba(30, 30, 30, 0.2)";a.beginPath();a.arc(h,n,g,0,Math.PI*2,false);a.fill()}k.complete&&k.width>0&&a.drawImage(k,h-e.x,n-e.y,k.width,k.height);d.wakeParent(true)},update:function(a){if(a){g=Math.floor(a.getPixelDistance(d.accuracy)*0.5);b=a.getGridXYForPosition(d.pos);d.wakeParent(true)}}});
d.bind("gridUpdate",function(a,m){d.update(m)});return d},AnnotationsOverlay:function(l){function k(a,m){var h=a.length,n=d.getParent();if(m=m?m:n?n.getTileLayer():null)for(h=h;h--;)m.syncVectors([a[h].xy]);a.sort(function(o,p){var z=p.xy.y-o.xy.y;if(z===0)z=p.xy.x-o.xy.x;return z})}l=T5.ex({pois:null,map:null,zindex:100},l);var e=[],b=false,g=[],d=T5.ex(new T5.ViewLayer(l),{cycle:function(){return b},draw:function(a,m,h,n,o){b=false;a.fillStyle="rgba(255, 0, 0, 0.75)";a.globalCompositeOperation=
"source-over";for(h=e.length;h--;){e[h].draw(a,m,n,d,o);b=b||e[h].isAnimating()}for(h=g.length;h--;){g[h].draw(a,m,n,d,o);b=b||g[h].isAnimating()}return b?1:0},add:function(a){if(a&&a.length)for(var m=a.length;m--;)g[g.length]=a[m];else if(a)g[g.length]=a;k(g);d.wakeParent(true)},clear:function(a){g=[];k(g);if(a){e=[];k(e)}d.wakeParent(true)}});COG.listen("geo.pois-updated",function(a){if(l.pois&&l.pois.id==a.srcID){a=a.pois;try{e=[];for(var m=0;m<a.length;m++)if(a[m].pos){var h;var n=a[m];if(n&&
n.pos){var o={poi:n,annotation:null};l.map&&l.map.trigger("getAnnotationForPOI",o);if(!o.annotation)o.annotation=new T5.Annotation({xy:new T5.Geo.GeoVector(n.pos)});if(o.annotation){o.annotation.isNew=n.isNew;n.isNew=false}h=o.annotation}else h=void 0;h&&e.push(h)}k(e)}catch(p){COG.Log.exception(p)}d.wakeParent(true)}});d.bind("gridUpdate",function(a,m){k(e,m);k(g,m);d.wakeParent(true)});return d}};f.ImageAnnotation=f.Annotation;return f}();
T5.Geo.Routing.TurnTypeRules=function(){var f=T5.Geo.Routing.TurnType,l=[];l.push({regex:/continue/i,turnType:f.Continue});l.push({regex:/(take|bear|turn)(.*?)left/i,customCheck:function(k,e){return/bear/i.test(e[1])?f.TurnLeftSlight:f.TurnLeft}});l.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(k,e){return/bear/i.test(e[1])?f.TurnRightSlight:f.TurnRight}});l.push({regex:/enter\s(roundabout|rotaty)/i,turnType:f.EnterRoundabout});l.push({regex:/take.*?ramp/i,turnType:f.Ramp});l.push({regex:/take.*?exit/i,
turnType:f.RampExit});l.push({regex:/make(.*?)u\-turn/i,customCheck:function(k,e){return/right/i.test(e[1])?f.UTurnRight:f.UTurnLeft}});l.push({regex:/proceed/i,turnType:f.Start});l.push({regex:/arrive/i,turnType:f.Arrive});l.push({regex:/fell\sthrough/i,turnType:f.Merge});return l}();
