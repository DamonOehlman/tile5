COG=function(){var h=/\$\{(.*?)\}/ig,o=Object.prototype.hasOwnProperty,l=0,e={id:"grunt.core",extend:function(){var a=arguments[0]||{},f=1,k=arguments.length,b=false,p,d,n,g;if(typeof a==="boolean"){b=a;a=arguments[1]||{};f=2}if(typeof a!=="object"&&!e.isFunction(a))a={};if(k===f){a=this;--f}for(;f<k;f++)if((p=arguments[f])!=null)for(d in p){n=a[d];g=p[d];if(a!==g)if(b&&g&&(e.isPlainObject(g)||e.isArray(g))){n=n&&(e.isPlainObject(n)||e.isArray(n))?n:e.isArray(g)?[]:{};a[d]=e.extend(b,n,g)}else if(g!==
undefined)a[d]=g}return a},isFunction:function(a){return toString.call(a)==="[object Function]"},isArray:function(a){return toString.call(a)==="[object Array]"},isPlainObject:function(a){if(!a||toString.call(a)!=="[object Object]"||a.nodeType||a.setInterval)return false;if(a.constructor&&!o.call(a,"constructor")&&!o.call(a.constructor.prototype,"isPrototypeOf"))return false;var f;for(f in a);return f===undefined||o.call(a,f)},isEmptyObject:function(a){for(var f in a)return false;return true},isXmlDocument:function(a){return toString.call(a)===
"[object Document]"},contains:function(a,f){var k=a,b=arguments,p=1;if(f&&e.isArray(f)){b=f;p=0}for(p=p;p<b;p++)k=k&&typeof foo[b[p]]!=="undefined";return k},newModule:function(a){a=e.extend({id:null,requires:[],parent:null},a);if(a.parent)a=e.extend({},a.parent,a);return a},toID:function(a){return a.replace(/\s/g,"-")},objId:function(a){return(a?a:"obj")+l++},formatStr:function(a){if(arguments.length<=1)return a;for(var f=arguments.length-2,k=0;k<=f;k++)a=a.replace(RegExp("\\{"+k+"\\}","gi"),arguments[k+
1]);return a},wordExists:function(a,f){var k="";if(f.toString)f=f.toString();for(var b=0;b<f.length;b++)k+=!/\w/.test(f[b])?"\\"+f[b]:f[b];return RegExp("(^|\\s|\\,)"+k+"(\\,|\\s|$)","i").test(a)},parseTemplate:function(a,f){for(var k=h.exec(a);k;){a=a.replace(k[0],COG.XPath.first(k[1],f));h.lastIndex=0;k=h.exec(a)}return a}};return e}();
COG.Log=function(){function h(f,k){var b,p=k&&k.length>0?k[0]:"";for(b=1;k&&b<k.length;b++)p+=" "+(l&&COG.isPlainObject(k[b])?JSON.stringify(k[b]):k[b]);typeof console!=="undefined"&&console[f](p);for(b=0;b<o.length;b++)o[b].call(a,p,f)}var o=[],l=typeof JSON!=="undefined",e=window.console&&window.console.markTimeline,a={id:"grunt.log",getTraceTicks:function(){return e?(new Date).getTime():null},trace:function(f,k){if(e)console.markTimeline(f+(k?": "+(a.getTraceTicks()-k)+"ms":""))},debug:function(){h("debug",
arguments)},info:function(){h("info",arguments)},warn:function(){h("warn",arguments)},error:function(){h("error",arguments)},exception:function(f){a.error(arguments);for(var k in f)a.info("ERROR DETAIL: "+k+": "+f[k])},watch:function(f,k){try{k()}catch(b){a.exception(b,f)}},throwError:function(f){a.error(f);throw Error(f);},requestUpdates:function(f){o.push(f)}};return a}();
(function(){function h(e,a){e[a]||(e[a]=function(f){return e.configure(a,f)})}function o(e){e.gtConfId=COG.objId("configurable");e.gtConfig={};e.gtConfigFns=[];return e.gtConfig}var l={};COG.paramTweaker=function(e,a,f){return function(k,b){if(typeof b!=="undefined"){if(k in e)e[k]=b;f&&k in f&&f[k](k,b)}else return a&&k in a?a[k](k):e[k]}};COG.configurable=function(e,a,f,k){if(e){e.gtConfId||o(e);var b=e.gtConfId,p=e.gtConfig,d=e.gtConfigFns;l[b]=e;d.push(f);for(f=a.length;f--;){p[a[f]]=true;k&&
h(e,a[f])}if(!e.configure)e.configure=function(n,g){if(p[n]){for(var m=d.length;m--;){var r=d[m](n,g);if(typeof r!=="undefined")return r}return l[b]}return null}}}})();
(function(){function h(o,l){var e=o.gtObsHandlers;e[l]||(e[l]=[]);return e[l]}COG.observable=function(o){if(o){if(!o.gtObsHandlers)o.gtObsHandlers={};if(!(o.bind||o.trigger||o.unbind)){o.bind=function(l,e){var a=COG.objId("callback");h(o,l).unshift({fn:e,id:a});return a};o.trigger=function(l){var e=h(o,l),a={cancel:false,tickCount:(new Date).getTime()},f;if(!e)return null;f=Array.prototype.slice.call(arguments,1);f.unshift(a);for(var k=e.length;k--&&!a.cancel;)e[k].fn.apply(self,f);return a};o.unbind=
function(l,e){for(var a=h(o,l),f=0;a&&f<a.length;f++)if(a[f].id===e){a.splice(f,1);break}return o}}}}})();(function(){var h={},o=[];COG.addPipe=function(l){l("pipe.test",{});o.push(l)};COG.listen=function(l,e){h[l]||(h[l]=[]);e&&h[l].push(e)};COG.say=function(l,e){var a;for(a=o.length;a--;)o[a](l,e);if(h[l])for(a=h[l].length;a--;)h[l][a](e)}})();
COG.Loopage=function(){function h(g){return COG.extend({id:f++,frequency:0,after:0,single:false,lastTick:0,execute:function(){}},g)}function o(g){b.push(g);l()}function l(){p&&clearTimeout(p);p=setTimeout(e,0);n=true}function e(){for(var g,m=(new Date).getTime(),r=k.length;b.length>0;){var x=b.shift();for(g=r;g--;)if(k[g].id===x){k.splice(g,1);break}n=true;r=k.length}if(n){d=a;for(g=r;g--;)d=k[g].frequency<d?k[g].frequency:d}for(g=r;g--;){x=m-k[g].lastTick;if(k[g].lastTick===0||x>=k[g].frequency){k[g].execute(m,
k[g]);k[g].lastTick=m;k[g].single&&k[g].trigger("complete")}}p=r?setTimeout(e,d):0}var a=6E4,f=0,k=[],b=[],p=0,d=a,n=true;return{join:function(g){var m=new h(g);if(m.after>0)m.lastTick=(new Date).getTime()+m.after;COG.observable(m);m.bind("complete",function(){o(m.id)});k.unshift(m);l();return m},leave:o}}();if(!this.JSON)this.JSON={};
(function(){function h(d){return d<10?"0"+d:d}function o(d){a.lastIndex=0;return a.test(d)?'"'+d.replace(a,function(n){var g=b[n];return typeof g==="string"?g:"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+d+'"'}function l(d,n){var g,m,r,x,z=f,u,v=n[d];if(v&&typeof v==="object"&&typeof v.toJSON==="function")v=v.toJSON(d);if(typeof p==="function")v=p.call(n,d,v);switch(typeof v){case "string":return o(v);case "number":return isFinite(v)?String(v):"null";case "boolean":case "null":return String(v);
case "object":if(!v)return"null";f+=k;u=[];if(Object.prototype.toString.apply(v)==="[object Array]"){x=v.length;for(g=0;g<x;g+=1)u[g]=l(g,v)||"null";r=u.length===0?"[]":f?"[\n"+f+u.join(",\n"+f)+"\n"+z+"]":"["+u.join(",")+"]";f=z;return r}if(p&&typeof p==="object"){x=p.length;for(g=0;g<x;g+=1){m=p[g];if(typeof m==="string")if(r=l(m,v))u.push(o(m)+(f?": ":":")+r)}}else for(m in v)if(Object.hasOwnProperty.call(v,m))if(r=l(m,v))u.push(o(m)+(f?": ":":")+r);r=u.length===0?"{}":f?"{\n"+f+u.join(",\n"+f)+
"\n"+z+"}":"{"+u.join(",")+"}";f=z;return r}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+h(this.getUTCMonth()+1)+"-"+h(this.getUTCDate())+"T"+h(this.getUTCHours())+":"+h(this.getUTCMinutes())+":"+h(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
a=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f,k,b={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},p;if(typeof JSON.stringify!=="function")JSON.stringify=function(d,n,g){var m;k=f="";if(typeof g==="number")for(m=0;m<g;m+=1)k+=" ";else if(typeof g==="string")k=g;if((p=n)&&typeof n!=="function"&&(typeof n!=="object"||typeof n.length!=="number"))throw Error("JSON.stringify");return l("",
{"":d})};if(typeof JSON.parse!=="function")JSON.parse=function(d,n){function g(r,x){var z,u,v=r[x];if(v&&typeof v==="object")for(z in v)if(Object.hasOwnProperty.call(v,z)){u=g(v,z);if(u!==undefined)v[z]=u;else delete v[z]}return n.call(r,x,v)}var m;d=String(d);e.lastIndex=0;if(e.test(d))d=d.replace(e,function(r){return"\\u"+("0000"+r.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(d.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){m=eval("("+d+")");return typeof n==="function"?g({"":m},""):m}throw new SyntaxError("JSON.parse");}})();
(function(){function h(l,e){var a=l.split("|"),f={};for(var k in e){var b=e[k];f[k]=a.length>b?a[b]:null}return f}var o={JSON:{parse:function(l){return JSON.parse(l)}},PDON:{parse:function(l){var e=null,a=[];l=l.split("\n");for(var f=0;f<l.length;f++){var k=l[f];if(e)a.push(h(k,e));else if(k){e=k.split("|");k={};for(var b=0;b<e.length;b++)k[e[b]]=b;e=k}else e=null}return a}}};COG.parseData=function(l,e){e=e?e.toUpperCase():"JSON";if(!o[e])throw Error("Unsupported data format: "+e);try{return o[e].parse(l)}catch(a){COG.Log.exception(a)}return{}}})();
COG.XPath=function(){function h(a){for(var f=null,k=0;k<o.length;k++)if(f=o[k](a))break;return f}var o=[],l=[null,function(a){return a.numberValue},function(a){return a.stringValue},function(a){return a.booleanValue},null,null,null,null,function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null},function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||COG.Log.warn("No XPATH support");var e={SearchResult:function(a){return{toString:function(){var f=
null;if(a){var k=null;if(a.resultType>=0&&a.resultType<l.length)k=l[a.resultType];if(k)f=k(a)}return f?f:""}}},first:function(a,f){var k=e.SearchResult,b;var p=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!p)p=XPathResult.ANY_TYPE;try{if(COG.isXmlDocument(f))b=f.evaluate(a,f,h,p,null);else{COG.Log.warn("attempted xpath expression: "+a+" on a non-xml document");b=null}}catch(d){COG.Log.warn("invalid xpath expression: "+a+" on node: "+f);b=null}return new k(b)},registerResolver:function(a){o.push(a)}};return e}();
COG.Storage=function(){function h(o){if(o&&o=="session")return sessionStorage;return localStorage}return{get:function(o,l){var e=h(l).getItem(o);return/^(\{|\[).*(\}|\])$/.test(e)?JSON.parse(e):e},set:function(o,l,e){l=jQuery.isArray(l)||jQuery.isPlainObject(l)?JSON.stringify(l):l;h(e).setItem(o,l)},remove:function(o,l){h(l).removeItem(o)}}}();
COG.ParseRules=function(){var h=[];return{add:function(o,l){h.push({regex:o,handler:l})},each:function(o,l,e){function a(){f++;e&&f>=h.length&&e(l)}for(var f=0,k=0;k<h.length;k++){var b=h[k].regex,p=h[k].handler,d=false;if(b){b.lastIndex=-1;if((b=b.exec(o))&&p){d=true;p(b,l,a)&&a()}}d||a()}}}};
(function(){function h(b){var p=[],d=function(g,m){m=COG.isFunction(m)?m():m;p[p.length]=encodeURIComponent(g)+"="+encodeURIComponent(m)};if(COG.isArray(b))for(var n=0;n<b.length;n++)d(b[n].name,b[n].value);else for(n in b)d(n,b[n]);return p.join("&").replace(/%20/g,"+")}var o={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},l={JSON:["json"],PDON:["pdon.txt"]},e=["TEXT","STREAM"],a=/^(\w+:)?\/\/([^\/?#]+)/,f={XML:function(b){return b.responseXML},JSON:function(b){return COG.parseData(b.responseText)},
PDON:function(b){return COG.parseData(b.responseText,"PDON")},DEFAULT:function(b){return b.responseText}},k={CONTENT_TYPE:"Content-Type"};COG.xhr=function(b){function p(){if(this.readyState===4){var m=null,r=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(r)if(b.handleResponse)b.handleResponse(this);else{var x=b,z=this.getResponseHeader(k.CONTENT_TYPE),u,v=false;for(u in o)if(z&&z.indexOf(o[u])>=0){v=true;
break}z=!v;for(v=0;v<e.length;v++)z=z||e[v]==u;if(z)b:{z=u;for(var C in l)for(v=0;v<l[C].length;v++)if(RegExp(l[C][v]+"$","i").test(x.url)){u=C;break b}u=z?z:"DEFAULT"}try{m=f[u](this,x)}catch(A){m=f.DEFAULT(this,x)}}else b.error&&b.error(this)}catch(P){COG.Log.exception(P,"PROCESSING AJAX RESPONSE")}r&&m&&b.success&&b.success.call(this,m)}}try{b=COG.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},b);var d=
a.exec(b.url),n=d&&(d[1]&&d[1]!==location.protocol||d[2]!==location.host);if(b.data)b.method="POST";if(b.url){d=null;if(b.xhr)d=b.xhr(b);d||(d=new XMLHttpRequest);d.open(b.method,b.url,b.async);b.data&&d.setRequestHeader("Content-Type",b.contentType);n||d.setRequestHeader("X-Requested-With","XMLHttpRequest");d.onreadystatechange=p;d.send(b.method=="POST"?h(b.data):null)}else COG.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(g){COG.Log.exception(g)}}})();
(function(){function h(a){var f=document.createElement("script"),k=false;f.src=a;f.async=true;f.onload=f.onreadystatechange=function(){if(!k&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){k=true;f.onload=f.onreadystatechange=null;f&&f.parentNode&&f.parentNode.removeChild(f)}};l||(l=document.getElementsByTagName("head")[0]);l.appendChild(f)}var o=0,l,e=this;COG.jsonp=function(a,f,k){a+=a.indexOf("?")>=0?"&":"?";var b="json"+ ++o;e[b]=function(p){f(p);e[b]=null;try{delete e[b]}catch(d){}};
h(a+(k?k:"callback")+"="+b);return b}})();
COG.Touch=function(){function h(t,q){return{x:t.x-q.x,y:t.y-q.y}}function o(t,q){var s=h(t,q);return Math.sqrt(s.x*s.x+s.y*s.y)}function l(t){if(t.count>1)return o(t.touches[0],t.touches[1]);return 0}function e(t,q){var s=t&&t.count>0?t.touches[0]:null;if(s&&q&&q.count>0)return h(s,q.touches[0]);return null}function a(t,q){t.count=q.count;for(var s=d;s--;){t.touches[s].x=q.touches[s].x;t.touches[s].y=q.touches[s].y}}function f(){for(var t={count:0,touches:Array(d)},q=d;q--;)t.touches[q]=p();return t}
function k(t){if(t.preventDefault){t.preventDefault();t.stopPropagation()}else t.cancelBubble&&t.cancelBubble()}function b(t,q,s){if(J){q=q[s?s:"touches"];s=q.length;for(s=t.count=s;s--;){t.touches[s].x=q[s].pageX;t.touches[s].y=q[s].pageY}}else if(q.button===0){t.count=1;t.touches[0].x=q.pageX?q.pageX:q.screenX;t.touches[0].y=q.pageY?q.pageY:q.screenY}else t.count=0}function p(t,q){return{x:t?t:0,y:q?q:0}}var d=10,n=120,g=100,m=250,r=300,x=5,z=0,u=1,v=2,C=7,A=0,P=0,J=undefined,$=function(t){function q(F,
L,H,y){var E=Math.asin((F.y-L.y)/H);H=H*(ta/y)>>0;H=H>qa?qa:H;E=L.x>F.x?E:Math.PI-E;G("pan",Math.cos(E)*-H,Math.sin(E)*H,true)}function s(F,L){var H,y;if(J){H=L-ea;if(H<m){y=o(V.touches[0],F);y>t.inertiaTrigger&&q(V.touches[0],F,y,H)}}else{fa.x=F.x;fa.y=F.y;COG.Loopage.join({execute:function(E,M){H=E-L;y=o(F,fa);if(H<g&&y>t.inertiaTrigger){M.trigger("complete");q(F,fa,y,H)}else H>g&&M.trigger("complete")},frequency:10})}}function w(F){var L=0,H=0;if(F.offsetParent){do{L+=F.offsetLeft;H+=F.offsetTop;
F=F.offsetParent}while(F)}return p(L,H)}function D(F){var L=F.count,H=Array(L),y=w(ga);for(L=L;L--;)H[L]=p(F.touches[L].x-y.x,F.touches[L].y-y.y);return H}function G(){ra&&ra.trigger.apply(null,arguments)}function I(F,L){var H=w(ga);H=p(L.x-H.x,L.y-H.y);G(F,L,H)}function N(F){var L=F.target?F.target:F.srcElement;if(ha||L&&L===ga){b(V,F);if(V.count!==0){ba=null;ca.x=0;ca.y=0;la=true;S=false;ea=(new Date).getTime();k(F);L.style.cursor="move";G("inertiaCancel");na=ea;if(F=V.count>0?V.touches[0]:null){G("touchStart",
F.x,F.y);if(na-oa<r)if((F=h(V.touches[0],Y.touches[0]))&&Math.abs(F.x)<t.maxDistDoubleTap&&Math.abs(F.y)<t.maxDistDoubleTap)S=true;O=z;a(Y,V)}else COG.Log.warn("Touch start fired, but no touch vector found")}}}function B(F){var L=F.target?F.target:F.srcElement,H=0;if(ha||L&&L===ga){b(W,F);if(W.count>0){fa.x=W.touches[0].x;fa.y=W.touches[0].y}if(la){J&&k(F);if(W.count>1){V.count===1&&a(V,W);H=l(V)-l(W)}if(O===z)if((F=e(W,V))&&(Math.abs(F.x)>=C||Math.abs(F.y)>=C))O=u;if(O!==z)if(!H||Math.abs(H)<x){if(ba=
e(W,Y)){ca.x-=ba.x;ca.y-=ba.y;aa.x-=ba.x;aa.y-=ba.y}G("pan",aa.x,aa.y);aa.x=0;aa.y=0;O=u}else{G("pinchZoom",D(V),D(W));O=v}a(Y,W)}}}function T(F){var L=F.target?F.target:F.srcElement;if(la&&(ha||L&&L===ga)){b(ka,F,"changedTouches");var H=ka.touches[0];J&&k(F);F=(new Date).getTime();oa=na;if(O===z){I("tap",V.touches[0]);Q||(Q=setTimeout(function(){Q=0;S&&I("doubleTap",V.touches[0])},r+50))}else if(O==u){G("panEnd",ca.x,ca.y);sa&&s(H,F)}else O==v&&G("pinchZoomEnd",D(V),D(Y),F-ea);L.style.cursor="default";
la=false}}function K(F){var L=F.target?F.target:F.srcElement;if(ha||L&&L===ga){if(F.detail){L=-F.detail*n;L=p(F.axis===1?L:0,F.axis===2?L:0)}else L=p(F.wheelDeltaX,F.wheelDeltaY);var H=L.y!==0?Math.abs(L.y/n):0;if(fa&&H!==0){var y=p(fa.x-ga.offsetLeft,fa.y-ga.offsetTop);G("wheelZoom",y,Math.pow(2,L.y>0?H:-H))}k(F)}}t=COG.extend({element:null,observable:null,inertiaTrigger:20,maxDistDoubleTap:20,touchStartHandler:null,moveHandler:null,moveEndHandler:null,pinchZoomHandler:null,pinchZoomEndHandler:null,
tapHandler:null,doubleTapHandler:null,wheelZoomHandler:null},t);var S=false,Q=0,R=T5.getConfig(),V=f(),W=f(),Y=f(),ka=f(),ba=null,ca=p(),aa=p(),O=null,la=false,ea=0,da=[],fa=p(),sa=false,ta,qa,na=0,oa=0,ga=t.element,ra=t.observable,ha=typeof FlashCanvas!=="undefined",ua={supportsTouch:J,addListeners:function(F){da.push(F)},decoupleListeners:function(F){for(var L=0;F&&L<da.length;L++)if(da[L].listenerId===F){da.splice(L,1);break}},release:function(){R.unbindEvent(J?"touchstart":"mousedown",N,false);
R.unbindEvent(J?"touchmove":"mousemove",B,false);R.unbindEvent(J?"touchend":"mouseup",T,false);if(!J){window.removeEventListener("mousewheel",K,false);window.removeEventListener("DOMMouseScroll",K,false)}},inertiaEnable:function(F,L){sa=true;ta=F;qa=L?Math.min(L.width,L.height):500},inertiaDisable:function(){sa=false}};if(typeof J==="undefined")J=T5.getConfig().supportsTouch;R.bindEvent(J?"touchstart":"mousedown",N,false);R.bindEvent(J?"touchmove":"mousemove",B,false);R.bindEvent(J?"touchend":"mouseup",
T,false);if(!J){R.bindEvent("mousewheel",K,window);R.bindEvent("DOMMouseScroll",K,window)}return ua},U=[];return{capture:function(t,q){if(!t)throw Error("Unable to capture touch of null element");if(!t.id)t.id="touchable_"+A++;var s=U[t.id];if(!s){s=new $(COG.extend({element:t},q));U[t.id]=s}if(q){q.listenerId&&s.decoupleListeners(q.listenerId);q.listenerId=++P;s.addListeners(q)}return s},release:function(t){if(t&&t.id&&U[t.id]){U[t.id].release();delete U[t.id]}}}}();
T5=function(){var h=function(){function k(d,n){return p(d.x-n.x,d.y-n.y)}function b(d,n){if(!n)n=d.length;if(n<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var g={edges:Array(n-1),accrued:Array(n-1),total:0},m=0;m<n-1;m++){var r=k(d[m],d[m+1]);g.edges[m]=Math.sqrt(r.x*r.x+r.y*r.y);g.accrued[m]=g.total+g.edges[m];g.total+=g.edges[m]}return g}function p(d,n){return{x:d?d:0,y:n?n:0}}return{VECTOR_SIMPLIFICATION:3,SIMPLIFICATION_MIN_VECTORS:25,add:function(){for(var d=
0,n=0,g=arguments.length;g--;){d+=arguments[g].x;n+=arguments[g].y}return p(d,n)},absSize:function(d){return Math.max(Math.abs(d.x),Math.abs(d.y))},copy:function(d){return d?p(d.x,d.y):null},diff:k,distance:function(d,n){return b(d,n).total},edges:b,equals:function(d,n){return d.x===n.x&&d.y===n.y},extendBy:function(d,n,g){return p(d.x-Math.cos(n)*g,d.y-Math.sin(n)*g)},floor:function(d){for(var n=Array(d.length),g=d.length;g--;)n[g]=p(~~d[g].x,~~d[g].y);return n},getRect:function(d){var n=d.length;
if(n>1)return new l(Math.min(d[0].x,d[n-1].x),Math.min(d[0].y,d[n-1].y),Math.abs(d[0].x-d[n-1].x),Math.abs(d[0].y-d[n-1].y))},init:p,invert:function(d){return p(-d.x,-d.y)},offset:function(d,n,g){return p(d.x+n,d.y+(g?g:n))},simplify:function(d,n){if(!d)return null;n=n?n:h.VECTOR_SIMPLIFICATION;for(var g=[],m=null,r=d.length;r--;){var x=d[r];if(include=!m||r===0||Math.abs(x.x-m.x)+Math.abs(x.y-m.y)>n){g.unshift(x);m=x}}return g},theta:function(d,n,g){g=Math.asin((d.y-n.y)/g);return d.x>n.x?g:Math.PI-
g}}}(),o=function(){return{dotProduct:function(k,b){return k.x*b.x+k.y*b.y}}}(),l=function(k,b,p,d){return{origin:h.init(k,b),dimensions:new a(p,d),invalid:false}},e=function(){return{bottomRight:function(k){return o.offset(k.origin,k.dimensions.width,k.dimensions.height)},empty:function(){return new l(0,0,0,0)},copy:function(k){return k?new l(k.origin.x,k.origin.y,k.dimensions.width,k.dimensions.height):null},getCenter:function(k){return h.init(k.origin.x+k.dimensions.width/2,k.origin.y+k.dimensions.height/
2)},isEmpty:function(k){return k.dimensions.width===0||k.dimensions.height===0},union:function(){if(!(arguments.length<2)){for(var k=arguments[0].origin.y,b=arguments[0].origin.x,p=k+arguments[0].dimensions.height,d=b+arguments[0].dimensions.width,n=Array.prototype.slice.call(arguments,1),g=n.length;g--;){var m=n[g].origin.y,r=n[g].origin.x,x=m+n[g].dimensions.height,z=r+n[g].dimensions.width;k=k<m?k:m;b=b<r?b:r;p=p>x?p:x;d=d>z?d:z}arguments[0].origin.x=b;arguments[0].origin.y=k;arguments[0].dimensions.width=
d-b;arguments[0].dimensions.height=p-k}}}}(),a=function(k,b){return{width:k?k:0,height:b?b:0}},f=function(){return{getAspectRatio:function(k){return k.height!==0?k.width/k.height:1},getCenter:function(k){return h.init(k.width/2,k.height/2)},getSize:function(k){return Math.sqrt(Math.pow(k.width,2)+Math.pow(k.height,2))}}}();return{ex:COG.extend,ticks:function(){return(new Date).getTime()},XY:h,Vector:function(k,b){COG.Log.warn("The T5.Vector class has been deprecated, please use T5.XY.init instead");
return h.init(k,b)},V:COG.extend(h,o),Dimensions:a,D:f,Rect:l,R:e}}();
(function(){function h(){for(;x.length>0;){var u=x.shift();document.location=u}r=0}function o(u){for(var v=true,C=z.length;C--;)v=v&&u!=z[C];return v}function l(u,v){var C=[];for(var A in v)A&&C.push(A+"="+escape(v[A]));return"tile5://"+u+"/"+(C.length>0?"?"+C.join("&"):"")}function e(u,v){o(u)&&COG.Log.info("would push url: "+l(u,v))}function a(u,v){if(o(u)){x.push(l(u,v));r||(r=setTimeout(h,100))}}function f(u){return function(v,C,A){(A?A:u?document.body:document).addEventListener(v,C,false)}}function k(u){return function(v,
C,A){(A?A:u?document.body:document).removeEventListener(v,C,false)}}function b(u,v,C){(C?C:document).attachEvent("on"+u,v)}function p(u,v,C){(C?C:document).detachEvent("on"+u,v)}function d(){n={base:{name:"Unknown",bindEvent:f(),unbindEvent:k(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:e,targetFps:null},ie:{name:"MSIE",regex:/msie/i,bindEvent:b,unbindEvent:p,requireFastDraw:false,targetFps:25},
ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:a,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:a},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:a},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:f(true),unbindEvent:k(true),supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},bridgeNotify:a},froyo:{name:"Android OS >= 2.2",
regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:a}};g=[n.froyo,n.android,n.ipod,n.iphone,n.ipad,n.ie]}var n=null,g=[],m=null,r=0,x=[],z=["view.wake","tile.loaded"];T5.getConfig=function(){n||d();if(!m){COG.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var u=0;u<g.length;u++){var v=g[u];if(v.regex&&v.regex.test(navigator.userAgent)){m=T5.ex({},n.base,v);COG.Log.info("PLATFORM DETECTED AS: "+m.name);break}}if(!m){COG.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
m=n.base}COG.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return m}})();
T5.Dispatcher=function(){var h=[],o={execute:function(l){var e=o.findAction(l);e&&e.execute.apply(e,Array.prototype.slice.call(arguments,1))},findAction:function(l){for(var e=h.length;e--;)if(h[e].id==l)return h[e];return null},getRegisteredActions:function(){return[].concat(h)},getRegisteredActionIds:function(){for(var l=[],e=h.length;e--;)h[e].id&&l.push(h[e].id);return l},registerAction:function(l){l&&l.id&&h.push(l)},Action:function(l){l=T5.ex({autoRegister:true,id:"",title:"",icon:"",hidden:false,
execute:null},l);var e={id:l.id,execute:function(){l.execute&&l.execute.apply(this,arguments)},getParam:function(a){return l[a]?l[a]:""},toString:function(){return COG.formatStr("{0} [title = {1}, icon = {2}]",e.id,l.title,l.icon)}};l.autoRegister&&o.registerAction(e);return e},Agent:function(l){l=COG.extend({name:"Untitled",translator:null,execute:null},l);var e={getName:function(){return l.name},getParam:function(a){return l[a]},getId:function(){return COG.toID(e.getName())},run:function(a,f){if(l.execute){var k=
l.translator?l.translator(a):a;l.execute.call(e,k,function(b,p){f&&f(b,p,k)})}}};return e},runAgents:function(l,e,a){for(var f=0;f<l.length;f++)l[f].run(e,a)}};return o}();
T5.Resources=function(){var h="",o={},l={getPath:function(e){return/^(file|https?|\/)/.test(e)?e:h+e},setBasePath:function(e){h=e},loadResource:function(e){e=T5.ex({filename:"",cacheable:true,dataType:null,callback:null},e);var a=function(f){e.callback&&COG.Log.watch("CALLING RESOURCE CALLBACK",function(){e.callback(f)})};e.cacheable&&o[e.filename]?a(o[e.filename]):COG.xhr({url:l.getPath(e.filename),dataType:e.dataType,success:function(f){if(e.cacheable)o[e.filename]=f;a(f)},error:function(f,k,b){COG.Log.error("error loading resource ["+
e.filename+"], error = "+b)}})},loadSnippet:function(e,a){/\.\w+$/.test(e)||(e+=".html");l.loadResource({filename:"snippets/"+e,callback:a,dataType:"html"})}};return l}();
T5.Images=function(){function h(){if(!r){var u=T5.getConfig().maxImageLoads;r=COG.Loopage.join({execute:function(v,C){if(!u||n.length<u){var A=d.shift();if(A){n[n.length]=A;A.image.onload=l;A.image.src=T5.Resources.getPath(A.url);A.requested=T5.ticks()}else C.trigger("complete")}},frequency:10});r.bind("complete",function(){r=null})}}function o(){x=true;try{var u=g.length/2>>0;if(u>0){g.sort(function(C,A){return C.created-A.created});for(var v=u;v--;)delete f[g[v].url];g.splice(0,u)}}finally{x=false}COG.say("imagecache.cleared")}
function l(){var u=b[this.id],v;if(u&&u.image.complete&&u.image.width>0){u.loaded=true;u.hitCount=1;for(v=n.length;v--;)if(n[v].image.src==this.src){n.splice(v,1);break}if(u.background||u.postProcess||u.drawBackground||u.customDraw)if(u.image){v=a(u.realSize?u.realSize.width:image.width,u.realSize?u.realSize.height:image.height);var C=v.getContext("2d"),A=u.offset?u.offset:T5.XY.init();u.background&&C.drawImage(u.background,0,0);u.drawBackground&&u.drawBackground(C);u.customDraw?u.customDraw(C,u):
C.drawImage(u.image,A.x,A.y);u.postProcess&&u.postProcess(C,u);u.image=v}for(v=u.callbacks.length;v--;)u.callbacks[v]&&u.callbacks[v](this,false);u.callbacks=[];g[g.length]={url:this.src,created:u.requested};delete b[this.id];h()}}function e(u,v,C){var A=f[u];if(A){A.hitCount++;A.image.complete&&A.image.width>0&&v?v(A.image,true):A.callbacks.push(v)}else{A=T5.ex({url:u,image:new Image,loaded:false,created:T5.ticks(),requested:null,hitCount:0,callbacks:[v]},C);A.image.id="resourceLoaderImage"+p++;
f[u]=A;b[A.image.id]=A;d[d.length]=A;h()}return A}function a(u,v){var C=document.createElement("canvas");C.width=u?u:0;C.height=v?v:0;if(typeof FlashCanvas!=="undefined"){C.id="tmpCanvas"+k++;C.style.cssText="position: absolute; top: -"+(v-1)+"px; left: -"+(u-1)+"px;";document.body.appendChild(C);FlashCanvas.initElement(C)}typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(C);return C}var f={},k=0,b={},p=0,d=[],n=[],g=[],m=0,r=null,x=false,z={avgImageSize:25,loadTimeout:10,cancelLoad:function(){n=
[]},get:function(u,v,C){var A=null,P=null;x||(A=f[u]);if((P=A?A.image:null)&&(P.getContext||P.complete&&P.width>0))return P;else v&&e(u,v,C);return null},load:e,newCanvas:a,reset:function(){f={}},stats:function(){return{imageLoadingCount:n.length,queuedImageCount:d.length,imageCacheFullness:m}}};COG.Loopage.join({execute:function(u){for(var v=false,C=0,A=T5.getConfig();C<n.length;)if(u-n[C].requested>z.loadTimeout*1E3){n.splice(C,1);v=true}else C++;v&&h();if(A&&A.imageCacheMaxSize){m=g.length*z.avgImageSize/
A.imageCacheMaxSize;m>=1&&o()}},frequency:2E4});return z}();
T5.TimeLord=function(){var h=/^P(\d+Y)?(\d+M)?(\d+D)?$/,o=/^(\d+H)?(\d+M)?(\d+S)?$/,l=function(a,f){return{days:a?a:0,seconds:f?f:0}},e={8601:function(a){a=a.split("T");var f=null;f=null;var k=0,b=0;h.lastIndex=-1;f=h.exec(a[0]);k+=f[3]?parseInt(f[3].slice(0,-1),10):0;o.lastIndex=-1;f=o.exec(a[1]);b+=f[1]?parseInt(f[1].slice(0,-1),10)*3600:0;b+=f[2]?parseInt(f[2].slice(0,-1),10)*60:0;b+=f[3]?parseInt(f[3].slice(0,-1),10):0;return new l(k,b)}};return{Duration:l,addDuration:function(){for(var a=new l,
f=arguments.length;f--;){a.days+=arguments[f].days;a.seconds+=arguments[f].seconds}if(a.seconds>=86400){a.days+=~~(a.seconds/86400);a.seconds%=86400}return a},parseDuration:function(a,f){var k=f?e[f]:null;if(k)return k(a);COG.Log.warn("Could not find duration parser for specified format: "+f);return new l},formatDuration:function(a){var f,k,b="";if(a.days)b=a.days+" days ";if(a.seconds){a=a.seconds;if(a>=3600){f=~~(a/3600);a-=f*3600}if(a>=60){k=Math.round(a/60);a-=k*60}if(f)b=b+f+(f>1?" hrs ":" hr ")+
(k?(k>10?k:"0"+k)+" min ":"");else if(k)b=b+k+" min";else if(a>0)b=b+(a>10?a:"0"+a)+" sec"}return b}}}();
(function(){var h=Math.PI*2,o=Math.PI/2,l=Math.abs,e=Math.pow,a=Math.sin,f=Math.asin,k=Math.cos,b=1.70158,p={linear:function(d,n,g,m){return g*d/m+n},backin:function(d,n,g,m){return g*(d/=m)*d*((b+1)*d-b)+n},backout:function(d,n,g,m){return g*((d=d/m-1)*d*((b+1)*d+b)+1)+n},backinout:function(d,n,g,m){return(d/=m/2)<1?g/2*d*d*(((b*=1.525)+1)*d-b)+n:g/2*((d-=2)*d*(((b*=1.525)+1)*d+b)+2)+n},bouncein:function(d,n,g,m){return g-p.bounceout(m-d,0,g,m)+n},bounceout:function(d,n,g,m){return(d/=m)<1/2.75?
g*7.5625*d*d+n:d<2/2.75?g*(7.5625*(d-=1.5/2.75)*d+0.75)+n:d<2.5/2.75?g*(7.5625*(d-=2.25/2.75)*d+0.9375)+n:g*(7.5625*(d-=2.625/2.75)*d+0.984375)+n},bounceinout:function(d,n,g,m){return d<m/2?p.bouncein(d*2,0,g,m)/2+n:p.bounceout(d*2-m,0,g,m)/2+g/2+n},cubicin:function(d,n,g,m){return g*(d/=m)*d*d+n},cubicout:function(d,n,g,m){return g*((d=d/m-1)*d*d+1)+n},cubicinout:function(d,n,g,m){if((d/=m/2)<1)return g/2*d*d*d+n;return g/2*((d-=2)*d*d+2)+n},elasticin:function(d,n,g,m,r,x){if(d==0)return n;if((d/=
m)==1)return n+g;x||(x=m*0.3);if(!r||r<l(g)){r=g;g=x/4}else g=x/h*f(g/r);return-(r*e(2,10*(d-=1))*a((d*m-g)*h/x))+n},elasticout:function(d,n,g,m,r,x){var z;if(d==0)return n;if((d/=m)==1)return n+g;x||(x=m*0.3);if(!r||r<l(g)){r=g;z=x/4}else z=x/h*f(g/r);return r*e(2,-10*d)*a((d*m-z)*h/x)+g+n},elasticinout:function(d,n,g,m,r,x){var z;if(d==0)return n;if((d/=m/2)==2)return n+g;x||(x=m*0.3*1.5);if(!r||r<l(g)){r=g;z=x/4}else z=x/h*f(g/r);if(d<1)return-0.5*r*e(2,10*(d-=1))*a((d*m-z)*h/x)+n;return r*e(2,
-10*(d-=1))*a((d*m-z)*h/x)*0.5+g+n},quadin:function(d,n,g,m){return g*(d/=m)*d+n},quadout:function(d,n,g,m){return-g*(d/=m)*(d-2)+n},quadinout:function(d,n,g,m){if((d/=m/2)<1)return g/2*d*d+n;return-g/2*(--d*(d-2)-1)+n},sinein:function(d,n,g,m){return-g*k(d/m*o)+g+n},sineout:function(d,n,g,m){return g*a(d/m*o)+n},sineinout:function(d,n,g,m){return-g/2*(k(Math.PI*d/m)-1)+n}};T5.easing=function(d){return p[d.replace(/[\-\_\s\.]/g,"").toLowerCase()]};T5.registerEasingType=function(d,n){p[d.replace(/[\-\_\s\.]/g,
"").toLowerCase()]=n}})();
T5.Tween=function(h){h=T5.ex({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:T5.easing("sine.out"),complete:null,cancelOnInteract:false},h);var o=T5.ticks(),l=[],e=false,a=0,f=0,k={cancelOnInteract:h.cancelOnInteract,isComplete:function(){return e},triggerComplete:function(b){h.complete&&h.complete(b)},update:function(b){try{var p=h.tweenFn(b-o,a,f,h.duration);if(h.target)h.target[h.property]=p;for(var d=l.length;d--;)l[d](p,void 0);if(e=o+h.duration<=b){if(h.target)h.target[h.property]=
h.tweenFn(h.duration,a,f,h.duration);for(var n=l.length;n--;)l[n](p,true)}}catch(g){COG.Log.exception(g)}},requestUpdates:function(b){l.push(b)}};a=h.target&&h.property&&h.target[h.property]?h.target[h.property]:h.startValue;if(typeof h.endValue!=="undefined")f=h.endValue-a;if(f==0)e=true;T5.wakeTweens();return k};
(function(){function h(a){if(e)return o.length;e=true;try{for(var f=0;f<o.length;)if(o[f].isComplete()){o[f].triggerComplete(false);o.splice(f,1)}else{o[f].update(a);f++}}finally{e=false}o.length===0&&l.trigger("complete");return o.length}var o=[],l=null,e=false;T5.tweenValue=function(a,f,k,b,p){a=new T5.Tween({startValue:a,endValue:f,tweenFn:k,complete:b,duration:p});o.push(a);return a};T5.tween=function(a,f,k,b,p,d){a=new T5.Tween({target:a,property:f,endValue:k,tweenFn:b,duration:d,complete:p});
o.push(a);return a};T5.tweenVector=function(a,f,k,b,p,d){var n=[];if(a){var g=a.x==f,m=a.y==k;g||n.push(T5.tween(a,"x",f,b,function(){(g=true)&&m&&p()},d));m||n.push(T5.tween(a,"y",k,b,function(){m=true;g&&m&&p()},d))}return n};T5.cancelAnimation=function(a){if(!e){e=true;try{for(var f=0;f<o.length;)if(!a||a(o[f])){o[f].triggerComplete(true);o.splice(f,1)}else f++}finally{e=false}}};T5.isTweening=function(){return o.length>0};T5.wakeTweens=function(){if(!l){l=COG.Loopage.join({execute:h,frequency:20});
l.bind("complete",function(){l=null})}}})();(function(){var h={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,PINCH:16,FREEZE:128};T5.viewState=function(){for(var o=0,l=arguments.length;l--;){var e=h[arguments[l].toUpperCase()];if(e)o|=e}return o}})();
T5.ViewLayer=function(h){h=T5.ex({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:T5.viewState("ACTIVE","ANIMATING","PAN","PINCH")},h);var o=null,l=false,e=false,a=h.supportFastDraw,f=h.id,k=T5.viewState("ACTIVE"),b=h.validStates,p=0,d=0,n=T5.ex({addToView:function(g){g.setLayer(f,n)},shouldDraw:function(g,m,r){g=(g&b)!==0&&(l?a:true);return g=e||r||p!==m.x||d!==m.y},cycle:function(){},draw:function(){},remove:function(){n.trigger("remove",n)},changed:function(){e=true;n.trigger("changed",
n);o&&o.trigger("invalidate")},getId:function(){return f},setId:function(g){f=g},getParent:function(){return o},setParent:function(g){l=(o=g)?o.fastDraw&&displayState!==k:false;n.trigger("parentChange",o)}},h);COG.observable(n);n.bind("drawComplete",function(g,m){e=false;p=m.x;d=m.y});return n};
T5.View=function(h){function o(y,E,M,X){ha=oa;C();if(X&&h.inertia){K=true;d(U+E,t+M,h.panAnimationEasing,h.panAnimationDuration)}else X||d(U+E,t+M)}function l(){ha=na;K=false;COG.Loopage.join({execute:C,after:50,single:true})}function e(y,E){Y=ua(y);ka=ua(E);var M=F(Y.dimensions),X=F(ka.dimensions);fa=L(Y);B=L(ka);O=Y&&M!==0?X/M:1}function a(y,E,M){e(E,M);if(W=O!==1){ha=ga;C()}}function f(y,E,M,X){e(E,M);if(h.adjustScaleFactor){O=h.adjustScaleFactor(O);COG.Log.info("scale factor adjusted to: "+O)}if(X<
h.pinchZoomAnimateTrigger){m(ea,O,fa,r(),T5.easing("sine.out"),function(){b();O=1},300);O=ea}else{b();O=1}}function k(y,E,M){H.zoom(E,Math.min(Math.pow(2,Math.round(Math.log(M))),8),500)}function b(){var y=Y?r():B;O=Math.round(O*10)/10;W=false;for(var E=A.length;E--;)A[E].trigger("scale",O,y);H.trigger("scale",O,y);ha=na;C()}function p(){clearTimeout(aa);aa=setTimeout(n,50)}function d(y,E,M,X,Z){function ia(){ja+=1;if(ja>=2){l(0,0);Z&&Z()}}var ja=0;if(M){y=T5.tweenValue(U,y,M,ia,X);E=T5.tweenValue(t,
E,M,ia,X);y.cancelOnInteract=true;y.requestUpdates(function(ma){U=ma;K=true;C()});E.cancelOnInteract=true;E.requestUpdates(function(ma){t=ma;K=true;C()})}else{U=y;t=E}}function n(){var y;if(J){COG.Touch.release(J);if(h.autoSize&&J.parentNode){y=J.parentNode.getBoundingClientRect();if(y.height!==0&&y.width!==0){J.height=y.height;J.width=y.width}}try{if(!J.id)J.id=h.id+"_canvas";$=J.getContext("2d");$.clearRect(0,0,J.width,J.height)}catch(E){COG.Log.exception(E);throw Error("Could not initialise canvas on specified view element");
}qa=COG.Touch.capture(J,{observable:H});if(I.height!==J.height||I.width!==J.width){I=new T5.Dimensions(J.width,J.height);H.trigger("resize",J.width,J.height);for(y=P;y--;)A[y].trigger("resize",J.width,J.height)}h.inertia&&qa.inertiaEnable(h.panAnimationDuration,I);for(y=P;y--;)A[y].trigger("contextChanged",$);v()}}function g(y,E){E.setId(y);E.added=T5.ticks();E.bind("remove",function(){H.removeLayer(y)});E.trigger("contextChanged",$);E.setParent(H);A.push(E);A.sort(function(M,X){var Z=X.zindex-M.zindex;
if(Z===0)Z=X.added-M.added;return Z});P=A.length;return E}function m(y,E,M,X,Z,ia,ja){function ma(){ia&&ia();b();O=1;da=null}W=true;fa=T5.XY.copy(M);B=T5.XY.copy(X);Y=null;if(Z)T5.tweenValue(0,E-y,Z,ma,ja?ja:1E3).requestUpdates(function(pa){da=pa/(E-y);O=y+pa;ha=ga;C();H.trigger("animate")});else{O=targetScaleFactor;ma()}}function r(){var y=T5.D.getCenter(I),E=T5.XY.distance([B,y]);y=T5.XY.theta(B,y,E);var M=T5.XY.diff(fa,B);y=T5.XY.extendBy(B,y,E/O);y.x+=M.x;y.y+=M.y;return y}function x(){H.trigger("idle");
T=true;S=0}function z(y,E,M,X,Z){if(D)E=T5.viewState("FROZEN");var ia=(E&ga)!==0,ja=0;if(s||ia){y.clearRect(0,0,J.width,J.height);s=false}if(ia){T5.D.getCenter(I);var ma=(da?da:1)/2,pa=T5.XY.diff(fa,B);if(Y){R.x=B.x+pa.x;R.y=B.y+pa.y}else{R.x=B.x-pa.x*ma;R.y=B.y-pa.y*ma}M=T5.XY.offset(M,R.x,R.y)}y.save();try{ea=O;if(G!==1)y.scale(G,G);else if(ia){y.translate(B.x,B.y);y.scale(O,O)}for(ja=P;ja--;)if(A[ja].shouldDraw(E,M,X)){A[ja].draw(y,M,I,E,H,X,Z);A[ja].trigger("drawComplete",M,Z)}}finally{y.restore()}H.trigger("drawComplete",
M,Z);COG.Log.trace("draw complete",Z)}function u(y,E){var M=false,X=ba?ba:K?oa:ha,Z=!K&&(X===ga||X===oa),ia=ca||X===oa||X===ga||T5.isTweening();q.x=U>>0;q.y=t>>0;if(Z){T5.cancelAnimation(function(ja){return ja.cancelOnInteract});T=false;if(S!==0){clearTimeout(S);S=0}}for(Z=P;Z--;){if(A[Z].animated)ha|=ra;M=A[Z].cycle(y,q,ha,ia)||M}ia=ia||(ha&ra)!==0;if(M=M||ia||O!==1&&O!==la){z($,X,q,ia,y);la=O;ca=false}if(!M&&N===0&&!sa){if(!T&&S===0)S=setTimeout(x,500);E.trigger("complete")}N=0;COG.Log.trace("Completed draw cycle",
y)}function v(){ca=true;C()}function C(){N+=1;if(!(D||w)){w=COG.Loopage.join({execute:u,frequency:ta});w.bind("complete",function(){w=null})}}h=T5.ex({id:COG.objId("view"),container:"",fastDraw:false,inertia:true,pannable:true,scalable:true,panAnimationEasing:T5.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:true,tapExtent:10,fps:25},h);var A=[],P=0,J=document.getElementById(h.container),$=null,U=0,t=0,q=T5.XY.init(),s=false,w=null,D=false,
G=1,I=new T5.Dimensions,N=0,B=null,T=false,K=false,S=0,Q=0,R=T5.XY.init(),V=0,W=false,Y=null,ka=null,ba=null,ca=false,aa=0,O=1,la=0,ea=1,da=null,fa=null,sa=typeof FlashCanvas!=="undefined",ta=~~(1E3/h.fps),qa=null,na=T5.viewState("ACTIVE"),oa=T5.viewState("PAN"),ga=T5.viewState("PINCH"),ra=T5.viewState("ANIMATING"),ha=na,ua=T5.XY.getRect,F=T5.D.getSize,L=T5.R.getCenter,H={id:h.id,deviceScaling:G,fastDraw:h.fastDraw||T5.getConfig().requireFastDraw,animate:function(y,E,M,X,Z){m(O,y,E,M,X,Z)},centerOn:function(y){U=
y.x-J.width/2;t=y.y-J.height/2},getDimensions:function(){return I},getZoomCenter:function(){return R},getLayer:function(y){for(var E=0;E<P;E++)if(A[E].getId()==y)return A[E];return null},setLayer:function(y,E){for(var M=0;M<P;M++)if(A[M].getId()===y){A.splice(M,1);break}E&&g(y,E);v()},eachLayer:function(y){for(var E=P;E--;)y(A[E])},clearBackground:function(){COG.Log.info("CALL OF DEPRECATED METHOD CLEAR BACKGROUND");s=true;v()},invalidate:v,freeze:function(){D=true},unfreeze:function(){D=false;C()},
resize:function(y,E){if(J){h.autoSize=false;J.width=y;J.height=E;n();H.trigger("resize",J.width,J.height)}},scale:function(y,E,M,X,Z){X||(X=T5.D.getCenter(I));Z||(Z=T5.D.getCenter(I));H.animate(y,X,Z,E,M);return H},removeLayer:function(y){a:{for(var E=P;E--;)if(A[E].getId()==y){y=E;break a}y=-1}if(y>=0&&y<P){COG.say("layer.removed",{layer:A[y]});A.splice(y,1);v()}P=A.length},stateOverride:function(y){ba=y},getOffset:function(){return q},updateOffset:d,zoom:function(y,E,M){K=false;O=E;W=O!==1;fa=T5.D.getCenter(I);
B=O>1?T5.XY.copy(y):T5.D.getCenter(I);Y=null;clearTimeout(Q);if(W){ha=ga;C();if(M)Q=setTimeout(function(){b();O=1},parseInt(M,10))}}};G=T5.getConfig().getScaling();H.markers=g("markers",new T5.MarkerLayer);COG.observable(H);H.bind("wake",C);H.bind("invalidate",v);if(h.pannable){H.bind("pan",o);H.bind("panEnd",l);H.bind("inertiaCancel",function(){K=false;C()})}if(h.scalable){H.bind("pinchZoom",a);H.bind("pinchZoomEnd",f);H.bind("wheelZoom",k)}H.bind("tap",function(y,E,M){for(var X=T5.XY.offset(M,U,
t),Z=A.length;Z--;)y.cancel=y.cancel||A[Z].trigger("tap",E,M,X).cancel});COG.configurable(H,["inertia","container","rotation","tapExtent","scalable","pannable"],COG.paramTweaker(h,null,{container:function(y,E){J=document.getElementById(E);n()},rotation:function(y,E){V=E}}),true);n();h.autoSize&&window.addEventListener("resize",p,false);return H};
T5.PathLayer=function(h){function o(n){n.syncVectors(f);k&&n.syncVectors(k);d.trigger("tidy")}h=T5.ex({style:"waypoints",pixelGeneralization:8,zindex:50},h);var l=false,e=[],a=null,f=[],k=null,b=0,p=[],d=T5.ex(new T5.ViewLayer(h),{getAnimation:function(n,g,m,r){var x="pathAnimation"+b++;p.push(x);return new T5.AnimatedPathLayer({id:x,path:e,zindex:h.zindex+1,easing:n?n:T5.easing("sine.inout"),duration:g?g:5E3,drawIndicator:m,autoCenter:r?r:false})},cycle:function(n,g,m,r){return r},draw:function(n,
g){var m,r=e.length;n.save();try{T5.applyStyle(n,h.style);if(r>0){n.beginPath();n.moveTo(e[r-1].x-g.x,e[r-1].y-g.y);for(m=r;m--;)n.lineTo(e[m].x-g.x,e[m].y-g.y);n.stroke();if(a){n.fillStyle=h.waypointFillStyle;for(m=a.length;m--;){n.beginPath();n.arc(a[m].x-g.x,a[m].y-g.y,2,0,Math.PI*2,false);n.stroke();n.fill()}}}}finally{n.restore()}l=false},updateCoordinates:function(n,g){var m=d.getParent();m=m?m.getTileLayer():null;f=n;k=g;COG.Log.info("updating coordinates, grid = "+m);m&&o(m)}});d.bind("gridUpdate",
function(n,g){o(g);for(var m=p.length;m--;)COG.say("layer.remove",{id:p[m]});p=[]});d.bind("tidy",function(){e=T5.XY.simplify(f,h.pixelGeneralization);a=T5.XY.simplify(k,h.pixelGeneralization);l=true;d.changed()});return d};
T5.ShapeLayer=function(h){function o(f){for(var k=l.length;k--;)l[k].resync(f);l.sort(function(b,p){var d=p.xy.y-b.xy.y;if(d===0)d=p.xy.x-b.xy.y;return d});e=true;a.changed()}h=T5.ex({zindex:80,style:null},h);var l=[],e=false,a=T5.ex(new T5.ViewLayer(h),{add:function(f){l[l.length]=f},each:function(f){for(var k=l.length;k--;)f(l[k])},cycle:function(){return e},draw:function(f,k,b,p){var d=k.x;k=k.y;var n=b.width;b=b.height;f.save();try{T5.applyStyle(f,h.style);for(var g=l.length;g--;){var m=l[g].style,
r=m?T5.applyStyle(f,m):null;l[g].draw(f,d,k,n,b,p);r&&T5.applyStyle(f,r)}}finally{f.restore()}e=false}});a.bind("gridUpdate",function(f,k){o(k)});a.bind("parentChange",function(f,k){var b=k?k.getTileLayer():null;b&&o(b)});COG.configurable(a,["style"],COG.paramTweaker(h,null,null),true);return a};T5.PolyLayer=T5.ShapeLayer;T5.Shape=function(h){h=T5.ex({style:null,properties:{}},h);return T5.ex(h,{xy:T5.XY.init(0,0),draw:function(){},resync:function(){}})};
T5.Arc=function(h,o){o=T5.ex({size:4},o);var l=T5.XY.init(),e=T5.ex(o,{draw:function(a,f,k){a.beginPath();a.arc(l.x-f,l.y-k,e.size,0,Math.PI*2,false);a.fill();a.stroke()},resync:function(a){e.xy=a.syncVectors([h]);l=T5.XY.floor([h])[0]}});COG.Log.info("created arc = ",h);return e};
T5.Poly=function(h,o){o=T5.ex({fill:false,simplify:false},o);var l=false,e=o.fill,a=o.simplify,f=T5.viewState("PINCH"),k=[],b=T5.ex(new T5.Shape(o),{draw:function(p,d,n,g,m,r){if(l){g=true;m=(r&f)!==0;p.beginPath();for(r=k.length;r--;){m=k[r].x-d;var x=k[r].y-n;if(g){p.moveTo(m,x);g=false}else p.lineTo(m,x);m=true}if(m){e&&p.fill();p.stroke()}}},resync:function(p){b.xy=p.syncVectors(h);k=T5.XY.floor(a?T5.XY.simplify(h):h)}});l=h&&h.length>=2;return b};
T5.AnimatedPathLayer=function(h){function o(b,p,d){b.fillStyle="#FFFFFF";b.strokeStyle="#222222";b.beginPath();b.arc(d.x,d.y,4,0,Math.PI*2,false);b.stroke();b.fill()}h=T5.ex({path:[],id:COG.objId("pathAni"),easing:T5.easing("sine.inout"),validStates:T5.viewState("ACTIVE","PAN","PINCH"),drawIndicator:null,duration:2E3,autoCenter:false},h);var l=T5.XY.edges(h.path),e,a=null,f=0;T5.tweenValue(0,l.total,h.easing,function(){k.remove()},h.duration).requestUpdates(function(b,p){f=b;p&&k.remove()});var k=
T5.ex(new T5.ViewLayer(h),{cycle:function(){for(var b=0;b<l.accrued.length&&l.accrued[b]<f;)b++;a=null;if(b<h.path.length-1){var p=f-(b>0?l.accrued[b-1]:0),d=h.path[b];e=T5.XY.theta(d,h.path[b+1],l.edges[b]);a=T5.XY.extendBy(d,e,p);if(h.autoCenter)(b=k.getParent())&&b.centerOn(a)}return a},draw:function(b,p){if(a)(h.drawIndicator?h.drawIndicator:o)(b,p,T5.XY.init(a.x-p.x,a.y-p.y),e)}});return k};
T5.Marker=function(h){function o(d,n,g,m){e=d;a=n;f=g;k=m}h=T5.ex({xy:T5.XY.init(),offset:true,tweenIn:null,animationSpeed:null},h);var l=false,e=0,a=0,f=0,k=0,b=h.offset,p=T5.ex(h,{isNew:true,isAnimating:function(){return l},draw:function(d,n,g,m,r){if(p.isNew&&h.tweenIn){var x=p.xy.y;p.xy.y=n.y-20;l=true;T5.tween(p.xy,"y",x,h.tweenIn,function(){p.xy.y=x;l=false},h.animationSpeed?h.animationSpeed:250+Math.random()*500)}p.drawMarker(d,n,p.xy.x-(b?n.x:0),p.xy.y-(b?n.y:0),g,m,r);p.isNew=false},drawMarker:function(d,
n,g,m){d.beginPath();d.arc(g,m,4,0,Math.PI*2,false);d.fill();o(g-4,m-4,8,8)},hitTest:function(d,n){return d>=e&&d<=e+f&&n>=a&&n<=a+k},updateBounds:o});COG.observable(p);return p};
T5.ImageMarker=function(h){h=T5.ex({image:null,imageUrl:null,animatingImage:null,animatingImageUrl:null,imageAnchor:null,rotation:0,scale:1,opacity:1},h);var o=h.imageAnchor?T5.XY.invert(h.imageAnchor):null,l=T5.ex(new T5.Marker(h),{drawMarker:function(e,a,f,k){if((a=l.isAnimating()&&l.animatingImage?l.animatingImage:l.image)&&a.complete&&a.width>0){o||(o=T5.XY.init(-a.width>>1,-a.height>>1));var b=l.scale,p=f+~~(o.x*b),d=k+~~(o.y*b),n=~~(a.width*b),g=~~(a.height*b);l.updateBounds(p,d,n,n);if(l.rotation||
l.opacity!==1){e.save();try{e.globalAlpha=l.opacity;e.translate(f,k);e.rotate(l.rotation);e.drawImage(a,o.x*b,o.y*b,n,g)}finally{e.restore()}}else e.drawImage(a,p,d,n,g)}}});if(!l.image)l.image=T5.Images.get(h.imageUrl,function(e){COG.Log.info("updating marker image to: "+e.src);l.image=e});if(!l.animatingImage)l.animatingImage=T5.Images.get(h.animatingImageUrl,function(e){l.animatingImage=e});return l};T5.Annotation=T5.Marker;T5.ImageAnnotation=T5.ImageMarker;
T5.MarkerLayer=function(h){function o(b,p){for(var d=a.length;d--;)p.syncVectors([a[d].xy])}function l(){k.changed();k.trigger("markerUpdate",a)}function e(){var b=k.getParent();(b=b&&b.getTileLayer?b.getTileLayer():null)&&o(null,b)}h=T5.ex({zindex:100},h);var a=[],f=false,k=T5.ex(new T5.ViewLayer(h),{cycle:function(){return f},draw:function(b,p,d,n,g){f=false;for(d=a.length;d--;){a[d].draw(b,p,n,k,g);f=f||a[d].isAnimating()}return f?1:0},add:function(b){if(b&&typeof b.length!=="undefined")for(var p=
b.length;p--;){if(b[p])a[a.length]=b[p]}else if(b)a[a.length]=b;l()},clear:function(b){if(b)for(var p=0;p<a.length;p++)b(a[p])&&a.splice(p,1);else a=[];l()},find:function(b){for(var p=[],d=a.length;d--;)if(!b||b(a[d]))p[p.length]=a[d];return p}});k.bind("tap",function(b,p,d){for(var n=[],g=d.x,m=d.y,r=a.length;r--;)if(a[r].hitTest(g,m))n[n.length]=a[r];if(n.length>0)b.cancel=k.trigger("markerTap",p,d,n).cancel});k.bind("gridUpdate",o);k.bind("parentChange",e);k.bind("changed",e);return k};
T5.Style=function(h){function o(f){var k=h[f];typeof k!=="undefined"&&l.push(function(b){b[f]=k})}h=T5.ex({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},h);var l=[],e={applyToContext:function(f){for(var k=l.length;k--;)l[k](f)}};for(var a in h)o(a);return e};
(function(){var h={},o={basic:new T5.Style({lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"}),waypoints:new T5.Style({lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"})};T5.applyStyle=function(l,e){var a=T5.styles[e]?T5.styles[e]:T5.styles.basic,f;if(l&&l.canvas){f=h[l.canvas.id];h[l.canvas.id]=e}a.applyToContext(l);return f};T5.loadStyles=function(l){COG.jsonp(l,function(e){T5.resetStyles(e)})};T5.resetStyles=function(l){var e={};for(var a in l)e[a]=new T5.Style(l[a]);T5.styles=T5.ex({},
o,e)};T5.styles=o})();(function(){T5.tileSize=256;T5.Tile=function(h){return h=T5.ex({x:0,y:0,gridX:0,gridY:0,dirty:true},h)};T5.EmptyTile=function(h){h=new T5.Tile(h);h.empty=true;return h};T5.ImageTile=function(h){h=T5.ex({url:"",sessionParamRegex:null,loading:false,loaded:false},h);return new T5.Tile(h)}})();
T5.TileGrid=function(h){function o(B,T){var K=T5.Vector(B*p-r.x,T*p-r.y);return new T5.EmptyTile({gridX:K.x,gridY:K.y,empty:true})}function l(B,T,K,S){var Q=Math.max(k,b)*0.2>>0,R=T5.XY.init();if(B<0||B+K>k)R.x=B<0?-Q:Q;if(T<0||T+S>b)R.y=T<0?-Q:Q;return R}function e(B,T,K){var S=COG.Log.getTraceTicks(),Q=0;T5.XY.init(k/2,b/2);$=true;try{if(K)f=[];if(B)for(K=0;K<b;K++)for(var R=0;R<k;R++){if(!f[Q]){var V=B(R,K,g,k,b);V.gridX=R*p-r.x;V.gridY=K*p-r.y;f[Q]=V}Q++}}finally{$=false}m=B;x=T;COG.Log.trace("tile grid populated",
S);N.changed()}function a(B,T,K,S){var Q,R=[],V=false;B=T5.XY.init((B.x+r.x-p*z)*C>>0,(B.y+r.y-p*z)*C>>0);tilesNeeded=false;if(!w){Q=N.getParent().getDimensions();q=Math.ceil(Q.width*C)+1+z;s=Math.ceil(Q.height*C)+1+z;w=T5.XY.init((q-1)/2>>0,(s-1)/2>>0)}for(var W=s;W--;)for(var Y=q;Y--;){Q=Y+B.x>=0&&Y+B.x<k?f[(W+B.y)*k+(Y+B.x)]:null;var ka=T5.XY.init(Y-w.x,W-w.y);if(!Q){t=l(B.x,B.y,q,s);Q=o(Y+B.x,W+B.y)}V=Q?(Q.dirty=K||Q.dirty)||V:V;R[R.length]={tile:Q,centerness:T5.XY.absSize(ka)}}R.sort(function(ba,
ca){return ca.centerness-ba.centerness});P||(P=Array(R.length));for(K=R.length;K--;){P[K]=R[K].tile;N.prepTile(P[K],T)}U=S;return V}h=T5.ex({tileSize:T5.tileSize,bufferSize:1,center:T5.XY.init(),clearBackground:false,gridSize:25,shiftOrigin:null,supportFastDraw:true,allowShift:true},h);var f=Array(Math.pow(h.gridSize,2)),k=h.gridSize,b=h.gridSize,p=h.tileSize,d=b*p,n=k*p,g=T5.XY.offset(h.center,-Math.ceil(k>>1)),m=null,r=T5.XY.init(),x=null,z=h.bufferSize,u=Math.round(p/2),v=false,C=p?1/p:0,A=true,
P=null,J=false,$=false,U=0;T5.XY.init();var t=T5.XY.init();T5.getConfig();var q,s,w,D=h.clearBackground;T5.viewState("ANIMATING");var G=T5.viewState("PAN"),I=T5.viewState("PINCH"),N=T5.ex(new T5.ViewLayer(h),{gridDimensions:new T5.Dimensions(n,d),cycle:function(B,T,K,S){if(t.x!==0||t.y!==0){S=t;var Q=h.shiftOrigin;if(!(!h.allowShift||S.x===0&&S.y===0)){var R=COG.Log.getTraceTicks(),V=Array(f.length);V.length=f.length;for(var W=0;W<k;W++)for(var Y=0;Y<b;Y++)V[Y*k+W]=W+S.x>=0&&W+S.x<k?f[(Y+S.y)*k+(W+
S.x)]:null;f=V;g=Q?Q(g,S):T5.XY.add(g,S);r.x+=-S.x*p;r.y+=-S.y*p;COG.Log.trace("tile storage shifted",R);e(m,x)}t=T5.XY.init();S=true}if(!v&&(K&I)===0)v=a(T,K,S,B);return v},find:function(B){if(!B)return null;for(var T=f.length;T--;){var K=f[T];if(K&&B(K))return K}return null},prepTile:function(){},drawTile:function(){return false},getTileSize:function(){return p},draw:function(B,T,K,S,Q,R,V){var W=T.x;T=T.y;var Y=K.width,ka=K.height,ba=Y,ca=ka,aa,O=true;if(P){D&&B.clearRect(0,0,Y,ka);B.beginPath();
if(A)for(var la=P.length;la--;){aa=P[la];var ea=aa.gridX-W,da=aa.gridY-T;if((ea>=0||ea+p<=Y)&&(da>=0||da+p<=ka)){aa.x=ea;aa.y=da;if(aa.empty){if(!D){B.clearRect(ea,da,p,p);B.rect(ea,da,p,p);O=false}}else if(R||aa.dirty){(aa=N.drawTile(B,aa,ea,da,S,R,V,D))&&B.rect(ea,da,p,p);O=O&&aa}ba=ea<ba?ea:ba;ca=da<ca?da:ca}}if(!D&&(S&G)!==0){if(ba>0){B.clearRect(0,0,ba,K.height);B.rect(0,0,ba,K.height)}if(ca>0){B.clearRect(0,0,K.width,ca);B.rect(0,0,K.width,ca)}}D||B.clip();O&&!J&&Q.trigger("tileDrawComplete");
v=false;J=O}},getTileAtXY:function(B,T){for(var K=null,S=P?P.length:0;S--;){var Q=P[S];if(Q&&B>=Q.x&&T>=Q.y)if(B<=Q.x+p&&T<=Q.y+p){K=Q;break}}COG.Log.info("looking for tile @ x: "+B+", y: "+T+", found: "+K);return K},getTileVirtualXY:function(B,T,K){B=T5.XY.add(T5.XY.init(B,T),T5.XY.invert(g),r);B=T5.XY.init(B.x*p,B.y*p);if(K){B.x+=u;B.y+=u}return B},populate:function(B){e(B,null,true)},syncVectors:function(){return T5.XY.init(0,0)}});N.bind("resize",function(){COG.Log.info("captured resize");w=null});
N.bind("scale",function(){A=false});COG.listen("imagecache.cleared",function(){for(var B=f.length;B--;)if(f[B])f[B].loaded=false});COG.listen("tiler.repaint",function(){for(var B=f.length;B--;)if(f[B]){f[B].x=null;f[B].y=null}});return N};
T5.ImageTileGrid=function(h){function o(m){function r(){var x=T5.Images.newCanvas(32,32),z=x.getContext("2d");z.fillStyle="#BBBBBB";z.fillRect(0,0,32,32);z.fillStyle="#C3C3C3";z.fillRect(0,0,16,16);z.fillRect(16,16,16,16);return x}if(!e||m!==e.width){e=T5.Images.newCanvas(m,m);m=e.getContext("2d");m.fillStyle=typeof FlashCanvas!=="undefined"?"#666666":m.createPattern(r(),"repeat");m.fillRect(0,0,e.width,e.height)}return e}h=T5.ex({emptyTile:function(m){if(!l||m!==l.width){l=T5.Images.newCanvas(m,
m);m=l.getContext("2d");m.fillStyle="rgba(150, 150, 150, 0.1)";m.fillRect(0,0,l.width,l.height)}return l}(T5.tileSize),panningTile:null,tileOffset:T5.XY.init(),tileDrawArgs:{}},h);var l=h.emptyTile,e=h.panningTile?h.panningTile:o(T5.tileSize),a=T5.viewState("ACTIVE"),f=T5.viewState("PAN"),k=T5.getConfig().requireFastDraw,b=h.tileSize?h.tileSize:T5.tileSize,p=T5.Images.get,d=T5.Images.load,n=T5.ex({background:null,overlay:null,offset:T5.XY.init(),realSize:new T5.Dimensions(b,b)},h.tileDrawArgs),g=
T5.ex(new T5.TileGrid(h),{drawTile:function(m,r,x,z,u,v,C,A){v=r.url?p(r.url):null;C=false;if(v){m.drawImage(v,x,z);r.dirty=false;C=true}else if((u&f)!==0){A||m.drawImage(e,x,z);C=true}return C},initTileUrl:function(){},prepTile:function(m,r){if(m&&!m.loading&&(!k||r===a)){m.url||g.initTileUrl(m);if(!p(m.url)){m.loading=true;d(m.url,function(){m.loadTime=(new Date).getTime();m.loaded=true;m.dirty=true;g.changed()},n)}}}});return g};
T5.Tiler=function(h){h=T5.ex({container:"",drawCenter:false,datasources:{},tileLoadThreshold:"first"},h);var o=T5.ex(new T5.View(h),{getTileLayer:function(){return o.getLayer("grid0")},setTileLayer:function(l){o.setLayer("grid0",l);o.trigger("gridUpdate",l);o.eachLayer(function(e){e.trigger("gridUpdate",l)})},viewPixToGridPix:function(l){var e=o.getOffset();return T5.XY.init(l.x+e.x,l.y+e.y)},centerOn:function(l,e,a,f){var k=o.getTileLayer(),b=o.getDimensions();(k=k?k.getTileSize():0)&&o.updateOffset(l.gridX-
(b.width-k)*0.5>>0,l.gridY-(b.height-k)*0.5>>0,e,a,f)},cleanup:function(){o.removeLayer("grid0")},repaint:function(){COG.say("tiler.repaint");o.trigger("wake")},select:function(l){o.trigger("selectTile",l)}});o.bind("tap",function(l,e,a){if(l=o.getTileLayer())(a=l.getTileAtXY(a.x,a.y))&&o.trigger("selectTile",a)});return o};
T5.Geo=function(){function h(t,q){var s=null;for(var w in $)if(q){if(w==q&&$[w][t]){s=$[w];break}}else if($[w][t]){s=$[w];break}return s}function o(t,q){var s=g*Math.sin(t);return a-2*Math.atan(q*Math.pow((1-s)/(1+s),g/2))}function l(t,q,s,w){var D=0;t=t.toUpperCase();for(var G in w){var I=q[G];if(I){var N=s[G];I=N?N(t,I):COG.wordExists(t,I)?1:0;D+=I*w[G]}}return D}var e=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],a=Math.PI/2,f=Math.PI*2,k=-a,b=a,p=
-f,d=Math.PI/180,n=180/Math.PI,g=0.08181919084262157,m=null,r={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",HWY:"HIGHWAY",MWY:"MOTORWAY"},x={VECTORIZE_PER_CYCLE:500},z={getEngine:function(t){for(var q=null,s=1;!q&&s<arguments.length;s++)q=h(t,arguments[s]);q=q?q:h(t);if(!q)throw Error("Unable to find GEO engine with "+t+" capability");return q},rankGeocodeResponses:function(t,q,s){var w=[],D=U.AddressCompareFns;if(s&&s.compareFns)D=T5.ex({},D,s.compareFns);for(s=0;s<q.length;s++)w.push(new U.GeoSearchResult({caption:J.toString(q[s]),
data:q[s],pos:q[s].pos,matchWeight:l(t,q[s],D,U.GeocodeFieldWeights)}));w.sort(function(G,I){return I.matchWeight-G.matchWeight});return w},distanceToString:function(t){if(t>1E3)return~~(t/10)/100+" km";return t?t+" m":""},dist2rad:function(t){return t/6371},lat2pix:function(t){t=parseFloat(t)*d;t=Math.sin(t);var q=g*t;return Math.log((1+t)/(1-t)*Math.pow((1-q)/(1+q),g))/2},lon2pix:function(t){return parseFloat(t)*d},pix2lon:function(t){return U.normalizeLon(t)*n},pix2lat:function(t){t=Math.pow(Math.E,
-t);for(var q=a-2*Math.atan(t),s=o(q,t),w=0;w<12&&Math.abs(q-s)>1.0E-7;){q=s;s=o(q,t);w++}return s*n},normalizeLon:function(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}},u=function(t,q){return{lat:parseFloat(t?t:0),lon:parseFloat(q?q:0)}},v=function(t,q){return{min:A.parse(t),max:A.parse(q)}},C=function(t){return t=T5.ex({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},t)},A=function(){var t={calcDistance:function(q,s){if(t.empty(q)||t.empty(s))return 0;var w=
(s.lat-q.lat)*d/2,D=(s.lon-q.lon)*d/2;w=Math.sin(w)*Math.sin(w)+Math.cos(q.lat*d)*Math.cos(s.lat*d)*Math.sin(D)*Math.sin(D);return 6371*2*Math.atan2(Math.sqrt(w),Math.sqrt(1-w))},copy:function(q){return q?new u(q.lat,q.lon):null},empty:function(q){return!q||q.lat===0&&q.lon===0},equal:function(q,s){return q&&s&&q.lat==s.lat&&q.lon==s.lon},inArray:function(q,s){for(var w=A.equal,D=s.length;D--;)if(w(q,s[D]))return true;return false},inBounds:function(q,s){var w=!(A.empty(q)||A.empty(s));return w=(w=
w&&q.lat>=s.min.lat&&q.lat<=s.max.lat)&&q.lon>=s.min.lon&&q.lon<=s.max.lon},offset:function(q,s,w){var D=q.lat*d;s=D+s/6371;for(q=q.lon*d+Math.asin(Math.sin(w/6371)/Math.cos(D));s<k;)s+=Math.PI;for(;s>b;)s-=Math.PI;for(;q>f;)q-=2*Math.PI;return new u(s*n,q*n)},parse:function(q){if(q)if(typeof q.lat!=="undefined")return t.copy(q);else{if(q.split)for(var s=[" ",","],w=0;w<s.length;w++){var D=q.split(s[w]);if(D.length===2)return new u(D[0],D[1])}}else return new u;return null},parseArray:function(q){var s=
q.length,w=Array(s);for(s=s;s--;)w[s]=t.parse(q[s]);return w},fromMercatorPixels:function(q,s){return new u(T5.Geo.pix2lat(s),T5.Geo.normalizeLon(T5.Geo.pix2lon(q)))},toMercatorPixels:function(q){return T5.XY.init(T5.Geo.lon2pix(q.lon),T5.Geo.lat2pix(q.lat))},generalize:function(q,s,w){var D=q.length,G=[],I=null;w||(w=250);w/=1E3;COG.Log.info("generalizing positions, must include "+s.length+" positions");for(var N=D;N--;)if(N===0)G.unshift(q[N]);else{var B=!I||A.inArray(q[N],s)?w:A.calcDistance(I,
q[N]);if(q[N]&&B>=w){G.unshift(q[N]);I=q[N]}}COG.Log.info("generalized "+D+" positions into "+G.length+" positions");return G},vectorize:function(q,s){var w=q.length,D=Array(w);s=T5.ex({chunkSize:x.VECTORIZE_PER_CYCLE,async:true},s);if(!s.async){for(var G=w;G--;)D[G]=new T5.Geo.GeoVector(q[G]);return D}return COG.Loopage.join({frequency:10,execute:function(I,N){for(var B=0,T=s.chunkSize,K=w;K--;){D[K]=new T5.Geo.GeoVector(q[K]);B+=1;if(B>T)break}w=K;w<=0&&N.trigger("complete",D)}})},toString:function(q){return q?
q.lat+" "+q.lon:""}};return t}(),P=function(){var t={calcSize:function(q,s,w){var D=T5.XY.init(0,s.lat-q.lat);if(typeof w==="undefined")w=true;D.x=w&&q.lon>s.lon?360-q.lon+s.lon:s.lon-q.lon;return D},createBoundsFromCenter:function(q,s){var w=s/6371,D=q.lat*d,G=q.lon*d,I=D-w,N=D+w;if(I>k&&N<b){D=Math.asin(Math.sin(w)/Math.cos(D));w=G-D;if(w<p)w+=2*Math.PI;G=G+D;if(G>f)G-=2*Math.PI}else{I=Math.max(I,k);N=Math.min(N,b);w=p;G=f}return new v(new u(I*n,w*n),new u(N*n,G*n))},expand:function(q,s){return new v(new u(q.min.lat-
s,q.min.lon-U.normalizeLon(s)),new u(q.max.lat+s,q.max.lon+U.normalizeLon(s)))},forPositions:function(q,s){var w=null,D=T5.ticks();s||(s="auto");for(var G=q.length;G--;)if(w){var I=t.calcSize(w.min,q[G],false),N=t.calcSize(q[G],w.max,false);if(I.x<0)w.min.lon=q[G].lon;if(I.y<0)w.min.lat=q[G].lat;if(N.x<0)w.max.lon=q[G].lon;if(N.y<0)w.max.lat=q[G].lat}else w=new T5.Geo.BoundingBox(q[G],q[G]);if(s){if(s=="auto"){G=t.calcSize(w.min,w.max);s=Math.max(G.x,G.y)*0.3}w=t.expand(w,s)}COG.Log.trace("calculated bounds for "+
q.length+" positions",D);return w},getCenter:function(q){var s=P.calcSize(q.min,q.max);return new T5.Geo.Position(q.min.lat+s.y/2,q.min.lon+s.x/2)},getGeoHash:function(q){var s=T5.Geo.GeoHash.encode(q.min.lat,q.min.lon);q=T5.Geo.GeoHash.encode(q.max.lat,q.max.lon);COG.Log.info("min hash = "+s+", max hash = "+q)},getZoomLevel:function(q,s){var w=t.getCenter(q),D=e[Math.min(Math.round(Math.abs(w.lat)*0.05),e.length)],G=t.calcSize(q.min,q.max);w=Math.ceil(Math.log(e[3]*s.height/G.y)/Math.log(2));D=Math.ceil(Math.log(D*
s.width/G.x)/Math.log(2));return Math.min(isNaN(w)?1E3:w,isNaN(D)?1E3:D)},isEmpty:function(q){return!q||A.empty(q.min)||A.empty(q.max)},toString:function(q){return"min: "+A.toString(q.min)+", max: "+A.toString(q.max)}};return t}(),J=function(){var t=/^(\d+).*$/,q=/(\d+)\s?\-\s?(\d+)/;return{buildingMatch:function(s,w){t.lastIndex=-1;if(t.test(s))for(var D=s.replace(t,"$1"),G=w.split(","),I=0;I<G.length;I++){q.lastIndex=-1;if(q.test(G[I])){var N=q.exec(G[I]);if(D>=parseInt(N[1],10)&&D<=parseInt(N[2],
10))return true}else if(D==G[I])return true}return false},normalize:function(s){if(!s)return"";s=s.toUpperCase();if(!m){var w=[];for(var D in r)w.push(D);m=RegExp("(\\s)("+w.join("|")+")(\\s|$)","i")}m.lastIndex=-1;if(w=m.exec(s))s=s.replace(m,"$1"+r[w[2]]);return s},toString:function(s){return s.streetDetails+" "+s.location}}}(),$={},U={P:A,B:P,A:J,Radius:function(t,q){return{distance:parseInt(t,10),uom:q}},Position:u,BoundingBox:v,GeoXY:function(t){function q(w){s.pos=w;s.mercXY=A.toMercatorPixels(w)}
var s=T5.XY.init();T5.ex(s,{radsPerPixel:null,setRadsPerPixel:function(w,D,G){var I=s.mercXY;s.x=Math.abs((I.x/w>>0)+(D?D:0));s.y=Math.abs((I.y/w>>0)+(G?G:0));s.radsPerPixel=w},updatePos:q});q(t);return s},Address:C,GeocodeFieldWeights:{streetDetails:50,location:50},AddressCompareFns:{},Engine:function(t){if(!t.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var q=T5.ex({remove:function(){delete $[q.id]}},t);return $[q.id]=q},GeoSearchResult:function(t){t=T5.ex({id:null,
caption:"",resultType:"",data:null,pos:null,matchWeight:0},t);return T5.ex(t,{toString:function(){return t.caption+(t.matchWeight?" ("+t.matchWeight+")":"")}})},GeoSearchAgent:function(t){return new T5.Dispatcher.Agent(t)},GeocodingAgent:function(t){t=T5.ex({name:"Geocoding Search Agent",paramTranslator:null,execute:function(q,s){try{if(!q.reverse&&!q.freeform)address=new C(q);var w=U.getEngine("geocode");if(w)w.geocode({addresses:[q.freeform?q.freeform:address],complete:function(G,I){if(s){var N=
I;if(q.freeform)N=U.rankGeocodeResponses(q.freeform,N,U.getEngine("geocode"));s(N,t)}}})}catch(D){COG.Log.exception(D)}}},t);return new U.GeoSearchAgent(t)}};return T5.ex(U,x,z)}();T5.Geo.GeoVector=T5.Geo.GeoXY;
T5.Geo.GeoHash=function(){function h(o,l,e){if(l&e)o[0]=(o[0]+o[1])/2;else o[1]=(o[0]+o[1])/2}BITS=[16,8,4,2,1];BASE32="0123456789bcdefghjkmnpqrstuvwxyz";NEIGHBORS={right:{even:"bc01fg45238967deuvhjyznpkmstqrwx"},left:{even:"238967debc01fg45kmstqrwxuvhjyznp"},top:{even:"p0r21436x8zb9dcf5h7kjnmqesgutwvy"},bottom:{even:"14365h7k9dcfesgujnmqp0r2twvyx8zb"}};BORDERS={right:{even:"bcfguvyz"},left:{even:"0145hjnp"},top:{even:"prxz"},bottom:{even:"028b"}};NEIGHBORS.bottom.odd=NEIGHBORS.left.even;NEIGHBORS.top.odd=
NEIGHBORS.right.even;NEIGHBORS.left.odd=NEIGHBORS.bottom.even;NEIGHBORS.right.odd=NEIGHBORS.top.even;BORDERS.bottom.odd=BORDERS.left.even;BORDERS.top.odd=BORDERS.right.even;BORDERS.left.odd=BORDERS.bottom.even;BORDERS.right.odd=BORDERS.top.even;return{decode:function(o){var l=1,e=[],a=[];e[0]=-90;e[1]=90;a[0]=-180;a[1]=180;lat_err=90;lon_err=180;for(i=0;i<o.length;i++){c=o[i];cd=BASE32.indexOf(c);for(j=0;j<5;j++){mask=BITS[j];if(l){lon_err/=2;h(a,cd,mask)}else{lat_err/=2;h(e,cd,mask)}l=!l}}e[2]=(e[0]+
e[1])/2;a[2]=(a[0]+a[1])/2;return{latitude:e,longitude:a}},encode:function(o,l,e){var a=1,f=[],k=[],b=0,p=0;e=e?e:12;geohash="";f[0]=-90;f[1]=90;k[0]=-180;for(k[1]=180;geohash.length<e;){if(a){mid=(k[0]+k[1])/2;if(l>mid){p|=BITS[b];k[0]=mid}else k[1]=mid}else{mid=(f[0]+f[1])/2;if(o>mid){p|=BITS[b];f[0]=mid}else f[1]=mid}a=!a;if(b<4)b++;else{geohash+=BASE32[p];p=b=0}}return geohash}}}();
T5.Geo.JSON=function(){function h(n,g,m,r){g=l(g);n.add(r.line(g,m));return g.length}function o(n,g,m,r){g=l(g);n.add(r.poly(g,m));return g.length}function l(n){var g=n?n.length:0,m=Array(g);for(g=g;g--;)m[g]=new T5.Geo.Position(n[g][1],n[g][0]);return T5.Geo.P.vectorize(m,k)}function e(n,g,m){return new d(n,g,m)}var a="featurecollection",f="feature",k={async:false},b={processor:null,group:"shapes",layerClass:T5.ShapeLayer},p={point:T5.ex({},b,{processor:function(n,g,m,r){g=l([g.coordinates],k);if(g.length>
0)if(m=r.marker(g[0],m)){n.add(m);return g.length}},group:"markers",layerClass:T5.MarkerLayer}),linestring:T5.ex({},b,{processor:function(n,g,m,r){g=l(g&&g.coordinates?g.coordinates:[]);return h(n,g,m,r)}}),multilinestring:T5.ex({},b,{processor:function(n,g,m,r){g=g&&g.coordinates?g.coordinates:[];for(var x=0,z=g.length;z--;)x+=h(n,g[z],m,r);return x}}),polygon:T5.ex({},b,{processor:function(n,g,m,r){g=g&&g.coordinates?g.coordinates:[];if(g.length>0)return o(n,g[0],m,r);return 0}}),multipolygon:T5.ex({},
b,{processor:function(n,g,m,r){g=g&&g.coordinates?g.coordinates:[];for(var x=0,z=0;z<g.length;z++)x+=o(n,g[z][0],m,r);return x}})},d=function(n,g,m,r){function x(q,s){var w=q.processor,D=C+q.group,G=T5.ex({},q,m,{properties:s.properties});if(w){var I=U[D];if(!I){I=new q.layerClass({id:D});U[D]=I}globalLayers=U;return w(I,s.data,G,r)}return 0}function z(q,s){var w=q&&q.type?q.type.toLowerCase():null;return w&&w===f?z(q.geometry,q.properties):{type:w,isCollection:w?w===a:false,definition:p[w],data:q,
properties:s?s:q.properties}}m=T5.ex({vectorsPerCycle:T5.Geo.VECTORIZE_PER_CYCLE,rowPreParse:null,simplify:false,layerPrefix:"geojson-"},m);r=T5.ex({marker:function(q){return new T5.Marker({xy:q})},line:function(q,s){return new T5.Poly(q,s)},poly:function(q,s){return new T5.Poly(q,T5.ex({fill:true},s))}},r);var u=m.vectorsPerCycle,v=m.rowPreParse,C=m.layerPrefix,A=0,P=0,J=null,$=0,U={},t;if(!n)return null;if(typeof n.length==="undefined")n=[n];P=n.length;t=COG.Loopage.join({frequency:10,execute:function(q,
s){var w=0,D=A;if(!J){for(;D<P;D++){var G=z(v?v(n[D]):n[D]),I=null;if(G.isCollection){$+=1;J=e(G.data.features,function(N){J=null;for(var B in N)U[B]=N[B]},{layerPrefix:C+$+"-"});I+=1}else if(G.definition)I=x(G.definition,G);w+=I?I:1;if(w>=u)break}A=D+1;!J&&A>=P&&s.trigger("complete")}}});t.bind("complete",function(){g&&g(U)});return t};return{parse:e}}();
T5.Geo.LocationSearch=function(h){function o(k,b){navigator.geolocation.clearWatch(e);e=0;if(a){clearTimeout(a);a=0}b&&b([k],h)}function l(k){COG.Log.info("caught location tracking error:",k)}h=T5.ex({name:"Geolocation Search",requiredAccuracy:null,searchTimeout:5E3,watch:false},h);var e=0,a=0,f=null;return new T5.Geo.GeoSearchAgent(T5.ex({execute:function(k,b){if(navigator.geolocation&&!e){e=navigator.geolocation.watchPosition(function(p){var d=new T5.Geo.Position(p.coords.latitude,p.coords.longitude);
p=new T5.Geo.GeoSearchResult({id:1,caption:"Current Location",pos:d,accuracy:p.coords.accuracy/1E3,matchWeight:100});if(!f||p.accuracy<f.accuracy)f=p;if(!h.requiredAccuracy||f.accuracy<h.requiredAccuracy)o(f,b)},l,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3});if(h.searchTimeout)a=setTimeout(function(){f&&o(f,b)},h.searchTimeout)}}},h))};
T5.Map=function(h){function o(r){try{var x=new T5.Geo.Position(r.coords.latitude,r.coords.longitude),z=r.coords.accuracy/1E3;m.trigger("locationUpdate",r,z);if(n){if(!p){p=new T5.Geo.UI.LocationOverlay({pos:x,accuracy:z});p.update(m.getTileLayer());m.setLayer("location",p)}var u=T5.Geo.B.createBoundsFromCenter(x,Math.max(z,1));m.gotoBounds(u)}else{p.pos=x;p.accuracy=z;p.update(m.getTileLayer());m.panToPosition(x,null,T5.easing("sine.out"))}n=false}catch(v){COG.Log.exception(v)}}function l(r){COG.Log.info("caught location tracking error:",
r)}h=T5.ex({tapExtent:10,provider:null,crosshair:false,zoomLevel:0,boundsChangeThreshold:30,zoomAnimation:T5.easing("quad.out")},h);var e={NONE:0,SINGLE:1,WATCH:2},a=T5.XY.init(),f=e.NONE,k=false,b=null,p=null,d=0,n=true,g=h.zoomLevel;if(!h.provider)h.provider=new T5.Geo.MapProvider;h.adjustScaleFactor=function(r){return Math.pow(2,(r<1?Math.floor:Math.ceil)(Math.log(r)))};var m=T5.ex({},new T5.Tiler(h),{annotations:null,getBoundingBox:function(){var r=m.getTileLayer(),x=m.getOffset(),z=m.getDimensions();
if(r)return r.getBoundingBox(x.x,x.y,z.width,z.height);return null},getCenterPosition:function(){return m.getXYPosition(T5.D.getCenter(m.getDimensions()))},getXYPosition:function(r){return m.getTileLayer().pixelsToPos(m.viewPixToGridPix(r))},gotoBounds:function(r,x){var z=T5.Geo.B.getZoomLevel(r,m.getDimensions());m.gotoPosition(T5.Geo.B.getCenter(r),z,x)},gotoPosition:function(r,x,z){function u(P){m.setTileLayer(P);m.panToPosition(r,function(){m.unfreeze();m.trigger("zoomLevelChange",g);z&&z()});
k=true}var v=g,C=!k,A=m.getBoundingBox();if(A)C=C||!T5.Geo.P.inBounds(r,A);g=x?x:g;if(!g)throw Error("Zoom level required to goto a position.");if(h.provider)g=h.provider.checkZoomLevel(g);if(C||g!==v){T5.Images.cancelLoad();T5.cancelAnimation();k&&m.freeze();h.provider.zoomLevel=g;h.provider.getMapTiles(m,r,u)}else m.panToPosition(r,z)},panToPosition:function(r,x,z,u){var v=m.getTileLayer();if(v){r=v.getGridXYForPosition(r);v=m.getDimensions();r.x-=v.width/2;r.y-=v.height/2;if(b)b=null;m.updateOffset(r.x,
r.y,z,u,x);m.trigger("wake");m.trigger("boundsChange",m.getBoundingBox());x&&typeof z==="undefined"&&x(m)}},locate:function(){m.trackStart(e.SINGLE);setTimeout(m.trackCancel,1E4)},trackStart:function(r){if(navigator.geolocation&&!d){f=r?r:e.WATCH;n=true;d=navigator.geolocation.watchPosition(o,l,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3})}},trackCancel:function(){d&&navigator.geolocation&&navigator.geolocation.clearWatch(d);m.removeLayer("location");p=null;f=e.NONE;d=0},getZoomLevel:function(){return g},
setZoomLevel:function(r){try{m.gotoPosition(m.getCenterPosition(),r)}catch(x){COG.Log.exception(x)}},zoomIn:function(){m.scale(2,T5.easing("sine.out"))||m.setZoomLevel(g+1)},zoomOut:function(){m.scale(0.5,T5.easing("sine.out"))||m.setZoomLevel(g-1)},animateRoute:function(r,x,z,u){var v=m.getLayer("route");if(v)(r=v.getAnimation(r,x,z,u))&&r.addToView(m)}});m.bind("pan",function(){f===e.SINGLE&&m.trackCancel()});m.bind("tap",function(r,x,z){var u=m.getTileLayer(),v=null;if(u){var C=m.viewPixToGridPix(T5.XY.init(z.x,
z.y));r=u.pixelsToPos(C);v=u.pixelsToPos(T5.XY.offset(C,-h.tapExtent,h.tapExtent));u=u.pixelsToPos(T5.XY.offset(C,h.tapExtent,-h.tapExtent));v=new T5.Geo.BoundingBox(v,u);m.trigger("geotap",x,z,r,v)}});m.bind("doubleTap",function(r,x,z){m.scalable()&&m.animate(2,T5.D.getCenter(m.getDimensions()),T5.XY.init(z.x,z.y),h.zoomAnimation)});m.bind("scale",function(r,x,z){r=0;x=Math.sqrt(x);if(x<1)r=-(0.5/x);else if(x>1)r=x;m.gotoPosition(m.getXYPosition(z),g+r>>0)});h.crosshair&&m.setLayer("crosshair",new CrosshairOverlay);
m.bind("idle",function(){if(T5.XY.absSize(T5.XY.diff(a,m.getOffset()))>h.boundsChangeThreshold){a=T5.XY.copy(m.getOffset());m.trigger("boundsChange",m.getBoundingBox())}});COG.configurable(m,["provider"],COG.paramTweaker(h,null,{provider:function(){m.cleanup();k=false}}),true);return m};
T5.Geo.MapProvider=function(){var h=1,o=20;return{zoomLevel:0,checkZoomLevel:function(l){return Math.min(Math.max(l,h),o)},getCopyright:function(){},getLogoUrl:function(){},getMapTiles:function(){},getZoomRange:function(){return{min:h,max:o}},prepTileGridArgs:function(l,e,a,f,k){var b=null;if(k.tileBackgroundColor){b=T5.Images.newCanvas(a,a);var p=b.getContext("2d");p.fillStyle=k.tileBackgroundColor;p.fillRect(0,0,a,a)}return T5.ex({tileSize:a,width:l,height:e,center:f,tileDrawArgs:{background:b}},
k)},setZoomRange:function(l,e){h=l;o=e}}};
T5.Geo.Routing=function(){var h={calculate:function(o){o=T5.ex({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},o);var l=T5.Geo.getEngine("route");l&&l.route(o,function(e){if(o.generalize)e.geometry=T5.Geo.P.generalize(e.geometry,e.getInstructionPositions());if(o.map){h.createMapOverlay(o.map,e);o.autoFit&&o.map.gotoBounds(e.boundingBox)}o.success&&o.success(e)})},createMapOverlay:function(o,l){var e=o.getDimensions();e=new T5.Geo.UI.RouteOverlay({data:l,width:e.width,
height:e.height});o.setLayer("route",e)},parseTurnType:function(o){for(var l=h.TurnType.Unknown,e=T5.Geo.Routing.TurnTypeRules,a=0;a<e.length;a++){e[a].regex.lastIndex=-1;var f=e[a].regex.exec(o);if(f){l=e[a].customCheck?e[a].customCheck(o,f):e[a].turnType;break}}return l},TurnType:{Unknown:"turn-unknown",Start:"turn-none-start",Continue:"turn-none",Arrive:"turn-none-arrive",TurnLeft:"turn-left",TurnLeftSlight:"turn-left-slight",TurnLeftSharp:"turn-left-sharp",TurnRight:"turn-right",TurnRightSlight:"turn-right-slight",
TurnRightSharp:"turn-right-sharp",Merge:"merge",UTurnLeft:"uturn-left",UTurnRight:"uturn-right",EnterRoundabout:"roundabout-enter",Ramp:"ramp",RampExit:"ramp-exit"},Instruction:function(o){var l=o=T5.ex({position:null,description:"",distance:0,distanceTotal:0,time:0,timeTotal:0,turnType:null},o),e=o.description;e=e.replace(/(\w)(\/)(\w)/g,"$1 $2 $3");l.description=e;if(!o.turnType)o.turnType=h.parseTurnType(o.description);return o},RouteData:function(o){o=T5.ex({geometry:[],instructions:[],boundingBox:null},
o);if(!o.boundingBox)o.boundingBox=T5.Geo.B.forPositions(o.geometry);return T5.ex({getInstructionPositions:function(){for(var l=[],e=0;e<o.instructions.length;e++)o.instructions[e].position&&l.push(o.instructions[e].position);return l}},o)}};return h}();T5.Geo.Search=function(){return{bestResults:function(h,o){o||(o=20);for(var l=h.length>0?h[0]:null,e=[],a=0;a<h.length;a++)if(l&&h[a]&&l.matchWeight-h[a].matchWeight<=o)e.push(h[a]);else break;return e}}}();
T5.Geo.UI=function(){var h={AnnotationTween:null,GeoTileGrid:function(o){o=T5.ex({grid:null,centerPos:new T5.Geo.Position,centerXY:T5.XY.init(),radsPerPixel:0},o);var l=o.radsPerPixel,e=T5.Geo.P.toMercatorPixels(o.centerPos),a=e.x/l-o.centerXY.x>>0,f=e.y/l-o.centerXY.y>>0,k=null,b=T5.ex({},o.grid,{getBoundingBox:function(p,d,n,g){return new T5.Geo.BoundingBox(b.pixelsToPos(T5.XY.init(p,d+g)),b.pixelsToPos(T5.XY.init(p+n,d)))},getGridXYForPosition:function(p){p=new T5.Geo.GeoVector(p);b.syncVectors([p]);
return p},syncVectors:function(p){for(var d,n,g=p.length;g--;){var m=p[g];if(m&&m.setRadsPerPixel){m.setRadsPerPixel(l,-a,-k);d=typeof d==="undefined"||m.x<d?m.x:d;n=typeof n==="undefined"||m.y<n?m.y:n}}return T5.XY.init(d,n)},getPixelDistance:function(p){return T5.Geo.dist2rad(p)/l>>0},pixelsToPos:function(p){return T5.Geo.P.fromMercatorPixels((a+p.x)*l,(f+b.gridDimensions.height-p.y)*l)}});k=f+b.gridDimensions.height;return b},RouteOverlay:function(o){o=T5.ex({data:null,pixelGeneralization:8,partialDraw:false,
strokeStyle:"rgba(0, 51, 119, 0.9)",waypointFillStyle:"#FFFFFF",lineWidth:4,zindex:50},o);var l=[],e=[],a=new T5.PathLayer(o);(function(){if(o.data&&o.data.instructions){for(var f=o.data.instructions,k=Array(f.length),b=f.length;b--;)k[b]=f[b].position;T5.Geo.P.vectorize(k).bind("complete",function(p,d){e=d})}o.data&&o.data.geometry&&T5.Geo.P.vectorize(o.data.geometry).bind("complete",function(p,d){l=d;a.updateCoordinates(l,e,true)})})();return a},Poly:function(o,l){l=T5.ex({autoParse:true},l);for(var e=
Array(o.length),a=l.autoParse,f=T5.Geo.GeoVector,k=T5.Geo.P.parse,b=o.length;b--;)e[b]=new f(a?k(o[b]):o[b]);return new T5.Poly(e,l)},Annotation:function(o){o=T5.ex({pos:null},o);o.xy=new T5.Geo.GeoVector(o.pos);return new T5.ImageAnnotation(o)},LocationOverlay:function(o){o=T5.ex({pos:null,accuracy:null,zindex:90},o);var l=new Image,e=T5.XY.init(),a=T5.XY.init(),f=null;l.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAACIQAAAiEBPhEQkwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAG+SURBVCiRlZHNahNRAIW/O7mTTJPahLZBA1YUyriINRAE3bQIKm40m8K8gLj0CRQkO32ELHUlKbgoIu4EqeJPgtCaoBuNtjXt5LeTMZk0mbmuWiuuPLsD3+HAOUIpxf9IHjWmaUbEyWv5ROrsVULhcHP761rUfnN3Y2Otc8CIg4YT85lzuVsPP+Qupw1vpPjRCvhS9ymvV0e77x7nNj+uvADQAIQQ+uLyvdfLV9JGZi7EdEwQlqBpEJ019f0z1mo2u5Q8DMydv25lshemmj1FueZTawbs7inarqLbV7Qjab1upB9YlhWSAHLavLHZCvg1VEhN0PMU9W7At4bPVidg7CtkLLXkut+lBPD6/Ub155jJiADAHSpaLmx3ApyBQoYEUd0PBoOBkAC6+3llvda/YxgGgYL+UNHf/zN3KiExGlsvTdP0NYDkhPdWrz35ZDsBzV5wCMuQwEyFmXFeeadjzfuFQmGkAZRKpdGC/n7x+M6jqvA9Zo6FWDhlcHE+wqT93J1tP7vpOE7rrx8ALMuasPf8S12St4WmJ6bYWTUC52k8Hm8Vi0X/nwBAPp/XKpWKdF1X2LYdlMvlsToC/QYTls7DLFr/PAAAAABJRU5ErkJggg%3D%3D";
l.onload=function(){e=T5.XY.init(l.width/2,l.height/2)};var k=T5.ex(new T5.ViewLayer(o),{pos:o.pos,accuracy:o.accuracy,drawAccuracyIndicator:false,draw:function(b,p){var d=a.x-p.x,n=a.y-p.y;if(f){b.fillStyle="rgba(30, 30, 30, 0.2)";b.beginPath();b.arc(d,n,f,0,Math.PI*2,false);b.fill()}l.complete&&l.width>0&&b.drawImage(l,d-e.x,n-e.y,l.width,l.height);k.changed()},update:function(b){if(b){f=Math.floor(b.getPixelDistance(k.accuracy)*0.5);a=b.getGridXYForPosition(k.pos);k.changed()}}});k.bind("gridUpdate",
function(b,p){k.update(p)});return k},AnnotationsOverlay:function(o){function l(b,p){var d=b.length,n=k.getParent();if(p=p?p:n?n.getTileLayer():null)for(d=d;d--;)p.syncVectors([b[d].xy]);b.sort(function(g,m){var r=m.xy.y-g.xy.y;if(r===0)r=m.xy.x-g.xy.x;return r})}o=T5.ex({pois:null,map:null,zindex:100},o);var e=[],a=false,f=[],k=T5.ex(new T5.ViewLayer(o),{cycle:function(){return a},draw:function(b,p,d,n,g){a=false;b.fillStyle="rgba(255, 0, 0, 0.75)";b.globalCompositeOperation="source-over";for(d=
e.length;d--;){e[d].draw(b,p,n,k,g);a=a||e[d].isAnimating()}for(d=f.length;d--;){f[d].draw(b,p,n,k,g);a=a||f[d].isAnimating()}return a?1:0},add:function(b){if(b&&b.length)for(var p=b.length;p--;)f[f.length]=b[p];else if(b)f[f.length]=b;l(f);k.changed()},clear:function(b){f=[];l(f);if(b){e=[];l(e)}k.changed()}});COG.listen("geo.pois-updated",function(b){if(o.pois&&o.pois.id==b.srcID){b=b.pois;try{e=[];for(var p=0;p<b.length;p++)if(b[p].pos){var d;var n=b[p];if(n&&n.pos){var g={poi:n,annotation:null};
o.map&&o.map.trigger("getAnnotationForPOI",g);if(!g.annotation)g.annotation=new T5.Annotation({xy:new T5.Geo.GeoVector(n.pos)});if(g.annotation){g.annotation.isNew=n.isNew;n.isNew=false}d=g.annotation}else d=void 0;d&&e.push(d)}l(e)}catch(m){COG.Log.exception(m)}k.changed()}});k.bind("gridUpdate",function(b,p){l(e,p);l(f,p);k.changed()});return k}};h.ImageAnnotation=h.Annotation;return h}();
T5.Geo.Routing.TurnTypeRules=function(){var h=T5.Geo.Routing.TurnType,o=[];o.push({regex:/continue/i,turnType:h.Continue});o.push({regex:/(take|bear|turn)(.*?)left/i,customCheck:function(l,e){return/bear/i.test(e[1])?h.TurnLeftSlight:h.TurnLeft}});o.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(l,e){return/bear/i.test(e[1])?h.TurnRightSlight:h.TurnRight}});o.push({regex:/enter\s(roundabout|rotaty)/i,turnType:h.EnterRoundabout});o.push({regex:/take.*?ramp/i,turnType:h.Ramp});o.push({regex:/take.*?exit/i,
turnType:h.RampExit});o.push({regex:/make(.*?)u\-turn/i,customCheck:function(l,e){return/right/i.test(e[1])?h.UTurnRight:h.UTurnLeft}});o.push({regex:/proceed/i,turnType:h.Start});o.push({regex:/arrive/i,turnType:h.Arrive});o.push({regex:/fell\sthrough/i,turnType:h.Merge});return o}();
