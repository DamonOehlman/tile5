(function(bb){function G(){var a=arguments[0]||{},b=Array.prototype.slice.call(arguments,1),c,h;for(h=b.length;h--;)if((c=b[h])!==null)for(var k in c){var j=c[k];if(a!==j)if(j!==undefined)a[k]=j}return a}function ha(a,b){if(typeof console!=="undefined")console[b||"debug"](a)}function Ea(a){var b=a.match(Bb),c=[],h=0,k;for(k=b?b.length:0;k--;){var j=b[k].slice(1);c[j]||(c[j]=RegExp("\\{"+j+"\\}","g"))}h=c.length;return function(){var g=a;for(k=0;k<h;k++)g=g.replace(c[k],arguments[k]||"");return g}}
function Ra(a){a=a.replace(/[\-\_\s\.]/g,"").toLowerCase();return xa[a]||xa.linear}function cb(a,b,c,h,k){function j(e){e=e?e:(new Date).getTime();if(d+db<e){var f=e-g,p=c(f,a,i,h),l=g+h<=e;e=!l;if(k){f=k(p,l,f);e=typeof f!="undefined"?f&&e:e}e&&animFrame(j)}}var g=(new Date).getTime(),d=0,i=b-a;animFrame(j);return{}}function eb(a,b,c){W.trigger("userMessage",a,b,c)}function fb(a){a=parseFloat(a)*ia;a=oa(a);var b=Fa*a;return ja((1+a)/(1-a)*ka((1-b)/(1+b),Fa))/2}function gb(a){return da/(256<<a)}function hb(a,
b){var c=Fa*oa(a);return ya-2*ib(b*ka((1-c)/(1+c),Fa/2))}function O(a,b){this.mercY=this.mercX=null;if(X(a,Ga))jb.parseXY(a,this);else if(a&&a.toPixels){var c=a.toPixels();this.mercX=c.x;this.mercY=c.y}else{this.x=a||0;this.y=b||0}}function la(a,b,c,h){this.x=a||0;this.y=b||0;this.w=c||0;this.h=h||0;this.x2=this.x+this.w;this.y2=this.y+this.h}function kb(a,b){var c=new lb(Math.sqrt(256<<a)|0);b&&b.zoomLevel===a&&b.copyInto(c);c.zoomLevel=a;return c}function mb(a){a=a||(new Date).getTime();for(var b=
0;b<ua.length;){var c=ua[b],h=pa[c],k=pa[c].image&&pa[c].image.complete&&pa[c].image.width>0,j=a-h.start;j=k||j>=Cb;if(k){k=h.callbacks;nb[c]=h.image;for(var g=0;g<k.length;g++)k[g](h.image,true)}if(j){ua.splice(b,1);delete pa[c]}else b++}ua.length>0&&animFrame(mb)}function Ha(a,b){var c=a&&b?nb[a]:null;if(c&&c&&c.complete&&c.width>0)b(c);else{if(c=pa[a])c.callbacks.push(b);else{c=new Image;c.id="_ldimg"+ ++Db;pa[a]={start:(new Date).getTime(),image:c,callbacks:[b]};c.src=a;ua[ua.length]=a}animFrame(mb)}}
function Ia(a,b,c,h,k,j){this.x=a;this.y=b;this.w=h||256;this.h=h||256;this.x2=this.x+this.w;this.y2=this.y+this.h;this.url=c;this.id=j||a+"_"+b;this.loaded=false;this.image=null}function ob(a){a=a?a:(new Date).getTime();if(a-pb>db){for(var b=za.splice(0),c=b.length;c--;)b[c](a);pb=a}za.length&&animFrame(ob)}function qb(a){var b=za.length==0;za[za.length]=a;b&&animFrame(ob)}function Eb(a,b,c,h,k){k=G({easing:"sine.out",duration:1E3,progress:null,complete:null,autoInvalidate:true},k);var j=(new Date).getTime(),
g=a[b],d=b=="translate",i=k.autoInvalidate,e=c.length&&h.length&&c.length==h.length?c.length:0,f=Array(e),p=Array(e),l=Ra(k.easing),m=k.duration,q=k.progress,w=function(x){var y=x-j;x=j+m<=x;for(var E=a.layer?a.layer.view:null,J,v=e;v--;){J=l(y,c[v],f[v],m);p[v]=d?J|0:J}g.apply(a,p);i&&E&&E.invalidate();if(q){y=[].concat(x?h:p);y.unshift(x);q.apply(a,y)}if(x){a.animations--;g.apply(a,h);k.complete&&k.complete.apply(a,h)}else qb(w)};if(g&&g.apply&&e>0){m=m?m:DEFAULT_DURATION;for(b=e;b--;)f[b]=h[b]-
c[b];a.animations++;qb(w)}}function Ja(a,b){b=G({id:"layer_"+Fb++,zindex:0,animated:false,style:null,minXY:null,maxXY:null},b);this.visible=true;qa(G(this,b))}function ga(a,b){if(a&&a.split){var c=a.split(rb);if(c.length>1){a=c[0];b=c[1]}}else if(a&&a.lat){b=a.lon;a=a.lat}this.lat=parseFloat(a||0);this.lon=parseFloat(b||0)}function Aa(a,b){if(X(a,Gb)){for(var c=b,h=this.min=new ga(sb,tb),k=this.max=new ga(Hb,Ib),j=a.length;j--;){var g=a[j];if(g.lat<h.lat)h.lat=g.lat;if(g.lat>k.lat)k.lat=g.lat;if(g.lon<
h.lon)h.lon=g.lon;if(g.lon>k.lon)k.lon=g.lon}if(X(c,ma)){c=calcSize(bounds.min,bounds.max);c=Sa(c.x,c.y)*0.3}this.expand(c)}else{this.min=a;this.max=b}}var Ta={};(function(a){var b=[],c=0,h=false,k=a.register=function(j,g){b.push({section:j,run:g})};a.init=function(j){function g(){if(c<b.length){var i=b[c++];d[i.section]||(d[i.section]={});i.run(d[i.section],g)}else{for(i in d)a[i]=d[i];h=true;j&&j(a)}}var d={};if(h&&j)j(a);else{c=0;g()}};k("canvas",function(j,g){function d(){var p,l=i.getContext("2d");
l.save();try{l.translate(50,50);l.beginPath();l.rect(0,0,20,20);p=l.isPointInPath(10,10)}finally{l.restore()}return p}var i=document.createElement("canvas"),e=typeof FlashCanvas!="undefined",f=typeof G_vmlCanvasManager!="undefnined";i.width=200;i.height=200;j.pipTransformed=e||f?false:d();g()})})(Ta);window.animFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){setTimeout(function(){a((new Date).getTime())},
1E3/60)}}();var Bb=/\{(\d+)(?=\})/g,xa=function(){var a=1.70158,b=Math.PI/2,c=Math.abs,h=Math.pow,k=Math.sin,j=Math.asin,g=Math.cos;return{linear:function(d,i,e,f){return e*d/f+i},backin:function(d,i,e,f){return e*(d/=f)*d*((a+1)*d-a)+i},backout:function(d,i,e,f){return e*((d=d/f-1)*d*((a+1)*d+a)+1)+i},backinout:function(d,i,e,f){return(d/=f/2)<1?e/2*d*d*(((a*=1.525)+1)*d-a)+i:e/2*((d-=2)*d*(((a*=1.525)+1)*d+a)+2)+i},bouncein:function(d,i,e,f){return e-xa.bounceout(f-d,0,e,f)+i},bounceout:function(d,
i,e,f){return(d/=f)<1/2.75?e*7.5625*d*d+i:d<2/2.75?e*(7.5625*(d-=1.5/2.75)*d+0.75)+i:d<2.5/2.75?e*(7.5625*(d-=2.25/2.75)*d+0.9375)+i:e*(7.5625*(d-=2.625/2.75)*d+0.984375)+i},bounceinout:function(d,i,e,f){return d<f/2?xa.bouncein(d*2,0,e,f)/2+i:xa.bounceout(d*2-f,0,e,f)/2+e/2+i},cubicin:function(d,i,e,f){return e*(d/=f)*d*d+i},cubicout:function(d,i,e,f){return e*((d=d/f-1)*d*d+1)+i},cubicinout:function(d,i,e,f){if((d/=f/2)<1)return e/2*d*d*d+i;return e/2*((d-=2)*d*d+2)+i},elasticin:function(d,i,e,
f,p,l){if(d==0)return i;if((d/=f)==1)return i+e;l||(l=f*0.3);if(!p||p<c(e)){p=e;e=l/4}else e=l/da*j(e/p);return-(p*h(2,10*(d-=1))*k((d*f-e)*da/l))+i},elasticout:function(d,i,e,f,p,l){var m;if(d==0)return i;if((d/=f)==1)return i+e;l||(l=f*0.3);if(!p||p<c(e)){p=e;m=l/4}else m=l/da*j(e/p);return p*h(2,-10*d)*k((d*f-m)*da/l)+e+i},elasticinout:function(d,i,e,f,p,l){var m;if(d==0)return i;if((d/=f/2)==2)return i+e;l||(l=f*0.3*1.5);if(!p||p<c(e)){p=e;m=l/4}else m=l/da*j(e/p);if(d<1)return-0.5*p*h(2,10*(d-=
1))*k((d*f-m)*da/l)+i;return p*h(2,-10*(d-=1))*k((d*f-m)*da/l)*0.5+e+i},quadin:function(d,i,e,f){return e*(d/=f)*d+i},quadout:function(d,i,e,f){return-e*(d/=f)*(d-2)+i},quadinout:function(d,i,e,f){if((d/=f/2)<1)return e/2*d*d+i;return-e/2*(--d*(d-2)-1)+i},sinein:function(d,i,e,f){return-e*g(d/f*b)+e+i},sineout:function(d,i,e,f){return e*k(d/f*b)+i},sineinout:function(d,i,e,f){return-e/2*(g(Math.PI*d/f)-1)+i}}}();if(typeof animFrame==="undefined")throw Error("animFrame COG required for tweening support");
var qa=function(){function a(c,h){var k=c.hasOwnProperty("obsHandlers")?c.obsHandlers:null;k[h]||(k[h]=[]);return k[h]}var b=0;return function(c){if(!c)return null;if(!(c.hasOwnProperty("obsHandlers")?c.obsHandlers:null))c.obsHandlers={};if(!c.hasOwnProperty("bind")){c.bind=function(h,k){var j="callback"+b++;a(c,h).unshift({fn:k,id:j});return j};c.triggerCustom=function(h,k){var j=a(c,h),g={cancel:false,name:h,source:this},d;for(d in k)g[d]=k[d];if(!j)return null;d=Array.prototype.slice.call(arguments,
2);c.eventInterceptor&&c.eventInterceptor(h,g,d);d.unshift(g);for(var i=j.length;i--&&!g.cancel;)j[i].fn.apply(this,d);return g};c.trigger=function(h){var k=Array.prototype.slice.call(arguments,1);k.splice(0,0,h,null);return c.triggerCustom.apply(this,k)};c.unbind=function(h,k){if(typeof h==="undefined")c.obsHandlers={};else for(var j=a(c,h),g=0;j&&g<j.length;g++)if(j[g].id===k){j.splice(g,1);break}return c}}return c}}(),ub=Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===
a)return b;return-1},X=function(){return function(a,b){b=Jb.call(b);if(b=="finite")return!Kb[Lb](+a);return b=="null"&&a===null||b==typeof a||b=="object"&&a===Object(a)||b=="array"&&Array.isArray&&Array.isArray(a)||Mb.call(a).slice(8,-1).toLowerCase()==b}}(),Nb=function(){function a(k){var j=document.createElement("script"),g=false;j.src=k;j.async=true;j.onload=j.onreadystatechange=function(){if(!g&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){g=true;j.onload=j.onreadystatechange=
null;j&&j.parentNode&&j.parentNode.removeChild(j)}};c||(c=document.getElementsByTagName("head")[0]);c.appendChild(j)}var b=0,c,h=this;return function(k,j,g){k+=k.indexOf("?")>=0?"&":"?";var d="json"+ ++b;h[d]=function(i){j(i);h[d]=null;try{delete h[d]}catch(e){}};a(k+(g?g:"callback")+"="+d);return d}}();INTERACT=function(){function a(l){return function(m,q){l.addEventListener(m,q,false)}}function b(l){return function(m,q){l.removeEventListener(m,q,false)}}function c(l){return function(m,q){l.attachEvent("on"+
m,q)}}function h(l,m){return{x:l?l:0,y:m?m:0,count:1}}function k(l,m){f.push(G({handler:null,checks:{},type:l},m))}function j(l){var m=0,q=0;if(l.offsetParent){do{m+=l.offsetLeft;q+=l.offsetTop;l=l.offsetParent}while(l)}return{left:m,top:q}}function g(l,m){return{source:l,target:m.target?m.target:m.srcElement}}function d(l,m){for(var q=l.target?l.target:l.srcElement;q&&q!==m;)q=q.parentNode;return q&&q===m}function i(l,m){return{x:l.x-(m?m.left:0),y:l.y-(m?m.top:0)}}function e(l,m){if(l.preventDefault){l.preventDefault();
l.stopPropagation()}else if(typeof l.cancelBubble!="undefined")l.cancelBubble=true;m&&l.stopImmediatePropagation&&l.stopImmediatePropagation()}var f=[],p=function(l,m,q){q=G({binder:null,unbinder:null,observable:null},q);for(var w=q.observable,x=[],y,E,J={bind:function(){return w.bind.apply(null,arguments)},unbind:function(){w.unbind();for(v=0;v<x.length;v++)x[v].unbind();return J}},v=0;v<m.length;v++)x.push(m[v](l,w,q));w.bind("pointerDown",function(){E=y=0});w.bind("pointerMove",function(o,A,C,
u){y+=u.x||0;E+=u.y||0});w.bind("pointerUp",function(o,A,C){Math.abs(y)>20||Math.abs(E)>20||w.triggerCustom("tap",o,A,C)});return J};k("pointer",{handler:function(l,m,q){function w(r){if(r.pageX&&r.pageY)return h(r.pageX,r.pageY);else{var B=document.documentElement,M=document.body;return h(r.clientX+(B&&B.scrollLeft||M&&M.scrollLeft||0)-(B&&B.clientLeft||M&&M.clientLeft||0),r.clientY+(B&&B.scrollTop||M&&M.scrollTop||0)-(B&&B.clientTop||M&&M.clientTop||0))}}function x(r){if(d(r,l))if(u=v(r)){var B=
w(r);l.style.cursor="move";e(r,true);R=B.x;N=B.y;D=h(R,N);m.triggerCustom("pointerDown",g("mouse",r),D,i(D,j(l)))}}function y(r){var B=w(r);H=B.x;I=B.y;if(d(r,l))o(r,u?"pointerMove":"pointerHover")}function E(r){if(u&&v(r)){u=false;if(d(r,l)){l.style.cursor="default";o(r,"pointerUp")}}}function J(r){if(d(r,l)){var B;r=r||window.event;if(r.detail)B=r.axis===2?-r.detail*A:0;else{B=r.wheelDeltaY?r.wheelDeltaY:r.wheelDelta;if(window.opera)B=-B}if(B!==0){var M=h(H,I);m.triggerCustom("zoom",g("mouse",r),
M,i(M,j(l)),B/C,"wheel");e(r);r.returnValue=false}}}function v(r){r=r||window.event;return(r.which||r.button)==1}function o(r,B,M,P,T){M=typeof M!="undefined"?M:H;P=typeof P!="undefined"?P:I;var z=M-R,K=P-N,F=h(M,P);m.triggerCustom(B,g("mouse",r),F,i(F,j(l)),h(z,K));if(typeof T=="undefined"||T){R=M;N=P}}q=G({},q);var A=120,C=A*8,u=false,D,H,I,R,N;q.binder("mousedown",x);q.binder("mousemove",y);q.binder("mouseup",E);q.binder("dblclick",function(r){ha("captured double click");if(d(r,l)){var B=w(r);
m.triggerCustom("doubleTap",g("mouse",r),B,i(B,j(l)))}});q.binder("mousewheel",J);q.binder("DOMMouseScroll",J);return{unbind:function(){q.unbinder("mousedown",x);q.unbinder("mousemove",y);q.unbinder("mouseup",E);q.unbinder("mousewheel",J);q.unbinder("DOMMouseScroll",J)}}},checks:{touch:false}});k("pointer",{handler:function(l,m,q){function w(z){if(z.count<2)return 0;var K=z.x-z.next.x;z=z.y-z.next.y;return~~Math.sqrt(K*K+z*z)}function x(z,K,F){K=K?K:0;F=F?F:0;for(var Z={x:z.x-K,y:z.y-F,id:z.id,count:z.count},
V=Z;z.next;){z=z.next;V=V.next={x:z.x-K,y:z.y-F,id:z.id}}return Z}function y(z,K){var F=z[K?K:"touches"],Z,V;if(F.length===0)return null;V=Z={x:F[0].pageX,y:F[0].pageY,id:F[0].identifier,count:F.length};for(var Y=1,va=F.length;Y<va;Y++)V=V.next={x:F[Y].pageX,y:F[Y].pageY,id:F[Y].identifier};return Z}function E(z){if(d(z,l)){I=j(l);var K=y(z,"changedTouches"),F=x(K,I.left,I.top);if(!N){R=u;m.triggerCustom("pointerDown",g("touch",z),K,F)}P&&m.triggerCustom("pointerDownMulti",g("touch",z),K,F);N=y(z);
if(N.count>1)B=w(N);T=1;M=x(N)}}function J(z){if(d(z,l)){e(z);r=y(z);if(R==u)R=Math.abs(N.x-r.x)>A||Math.abs(N.y-r.y)>A?C:u;if(R!=u){R=r.count>1?H:D;if(R==H)if(N.count===1){N=x(r);B=w(N)}else{var K=w(r);if(Math.abs(B-K)<o)R=D;else{var F;F=r.x;var Z=r.next.x,V=r.y,Y=r.next.y;F={x:(F<Z?F:Z)+(Math.abs(F-Z)>>1),y:(V<Y?V:Y)+(Math.abs(V-Y)>>1)};K=K/B;Z=K-T;m.triggerCustom("zoom",g("touch",z),F,i(F,I),Z,"pinch");T=K}}R==D&&m.triggerCustom("pointerMove",g("touch",z),r,x(r,I.left,I.top),h(r.x-M.x,r.y-M.y));
P&&m.triggerCustom("pointerMoveMulti",g("touch",z),r,x(r,I.left,I.top))}M=x(r)}}function v(z){if(d(z,l)){var K=y(z,"changedTouches"),F=x(K,I.left,I.top);r=y(z);if(!r){m.triggerCustom("pointerUp",g("touch",z),K,F);N=null}P&&m.triggerCustom("pointerUpMulti",g("touch",z),K,F)}}q=G({detailed:false,inertia:false},q);var o=20,A=7,C=0,u=1,D=2,H=3,I,R,N,r,B,M,P=q.detailed,T=1;q.binder("touchstart",E);q.binder("touchmove",J);q.binder("touchend",v);ha("initialized touch handler");return{unbind:function(){q.unbinder("touchstart",
E);q.unbinder("touchmove",J);q.unbinder("touchend",v)}}},checks:{touch:true}});return{register:k,watch:function(l,m,q){m=G({bindTarget:null,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},m);capabilities=G({touch:"ontouchstart"in window},q);if(!m.observable){ha("creating observable");m.observable=qa({});globalOpts=m}m.binder=(m.isIE?c:a)(m.bindTarget||document);m.unbinder=(m.isIE?c:b)(m.bindTarget||document);q=m.types;for(var w=capabilities,x=[],y=f.length;y--;){var E=f[y],
J=!q||q.indexOf(E.type)>=0,v=true,o;for(o in E.checks){var A=E.checks[o];ha("checking "+o+" capability. require: "+A+", capability = "+w[o]);v=v&&A===w[o]}if(J&&v)x[x.length]=E.handler}return new p(l,x,m)}}}();var W={ex:G,log:ha,observable:qa,formatter:Ea,wordExists:function(a,b){for(var c=a.split(/\s|\,/).length;c--;)if(a.toLowerCase()==b.toLowerCase())return true;return false},is:X,indexOf:ub};qa(W);var Ua=function(){var a={};return{create:function(b,c){if(a[b][c])return a[b][c].apply(null,Array.prototype.slice.call(arguments,
2))},register:function(b,c,h){a[b]||(a[b]={});a[b][c]&&ha(Ob(b,c),"warn");a[b][c]=h}}}(),Ob=Ea("Registration of {0}: {1} will override existing definition"),Va=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],da=Math.PI*2,ya=Math.PI/2,ia=Math.PI/180,Ka=180/Math.PI,sb=ya,Hb=-sb,tb=da,Ib=-tb,Fa=0.08181919084262157,na=Math.abs,vb=Math.ceil,wa=Math.round,La=Math.min,Sa=Math.max,ka=Math.pow,wb=Math.sqrt,ja=Math.log,oa=Math.sin,Pb=Math.asin,Wa=Math.cos,ib=Math.atan,
Qb=Math.atan2,Lb="hasOwnProperty",Kb={NaN:1,Infinity:1,"-Infinity":1},Jb=String.prototype.toLowerCase,Mb=Object.prototype.toString,ma="undefined",Ga="string",Xa="number",Gb="array",ba=Ua.register,ra=Ua.create,Rb=0,Fb=0,rb=/[\,\s]/,Sb=W.newCanvas=function(a,b){var c=document.createElement("canvas");c.width=a?a:0;c.height=b?b:0;W.trigger("createCanvas",c);return c},Tb=function(){function a(k){h++;k=k||(new Date).getTime();for(var j=c.length;j--;){var g=c[j];h%g.every===0&&g.cb(k)}animFrame(a)}var b=
1E3/60,c=[],h=0;animFrame(a);return{attach:function(k,j){c[c.length]={cb:k,every:j?wa(j/b):1}},detact:function(){}}}(),jb=function(){var a=/^xy\((.*)\).*$/i;return{parseXY:function(b,c){c=c||new O;if(!a.test(b)){var h=b.split(rb);c.mercX=parseFloat(h[1])*ia;c.mercY=fb(h[0])}return c}}}(),ea=function(){var a={"-webkit-user-select":"none",position:"absolute"},b;b=function(c){for(var h=0;h<c.length;h++){var k=c[h];if(typeof document.body.style[k]!="undefined")return k}}(["-webkit-transform","MozTransform"]);
return{supportTransforms:b,create:function(c,h,k){c=document.createElement(c);var j=[];k=k||{};c.className=h||"";for(var g in k)j[j.length]=g+": "+k[g];c.style.cssText=j.join(";");return c},move:function(c,h,k,j){if(b)c.style[b]="translate("+h+"px, "+k+"px) translateZ(0) "+(j||[]).join(" ");else{c.style.left=h+"px";c.style.top=k+"px"}},styles:function(c){return G({},a,c)}}}();O.prototype={constructor:O,add:function(){for(var a=this.x,b=this.y,c=arguments.length;c--;){a+=arguments[c].x;b+=arguments[c].y}return new O(a,
b)},equals:function(a){return this.x===a.x&&this.y===a.y},offset:function(a,b){return new O(this.x+a,this.y+b)},sync:function(a){if(this.mercX||this.mercY){this.x=wa((this.mercX+Math.PI)/a);this.y=wa((Math.PI-this.mercY)/a)}},toPos:function(a){for(var b=ka(Math.E,-(Math.PI-this.y*a)),c=ya-2*ib(b),h=hb(c,b),k=0;k<12&&na(c-h)>1.0E-7;){c=h;h=hb(c,b);k++}return new ga(h*Ka,(this.x*a-Math.PI)%360*Ka)},toString:function(){return this.x+", "+this.y}};la.prototype={constructor:la,buffer:function(a,b){return new la(this.x-
a,this.y-(b||a),this.w+a*2,this.h+(b||a)*2)},center:function(){return new O(this.x+(this.w>>1),this.y+(this.h>>1))}};Hits=function(){return{diffHits:function(a,b){var c=[],h={},k;for(k=b.length;k--;)h[b[k].target.id]=true;for(k=a.length;k--;)h[a[k].target.id]||(c[c.length]=a[k]);return c},init:function(a,b,c,h){return{type:a,x:h.x|0,y:h.y|0,elements:[],absXY:b,relXY:c}},initHit:function(a,b,c){return{type:a,target:b,drag:c}},triggerEvent:function(a,b,c,h){b.triggerCustom(a.type+(c?c:"Hit"),{hitType:a.type},
h?h:a.elements,a.absXY,a.relXY,new O(a.x,a.y))}}}();var lb=function(a){function b(j,g){var d=c[j],i;d||(d=c[j]=[]);(i=d[g])||(i=d[g]=[]);return i}a=a||128;var c=[],h={},k=0;return{copyInto:function(j){for(var g in h){var d=h[g];j.insert(d.bounds||d,d,g)}},insert:function(j,g,d){var i=j.x/a|0,e=j.y/a|0,f=(j.x+j.w)/a|0;j=(j.y+j.h)/a|0;d=d||g.id||"obj_"+k++;h[d]=g;for(g=i;g<=f;g++)for(i=e;i<=j;i++)b(g,i).push(d)},remove:function(j,g,d){d=d||g.id;if(h[d]){var i=j.x/a|0;g=j.y/a|0;var e=(j.x+j.w)/a|0;j=
(j.y+j.h)/a|0;delete h[d];for(i=i;i<=e;i++)for(var f=g;f<=j;f++){var p=b(i,f),l=ub.call(p,d);l>=0&&p.splice(l,1)}}},search:function(j){var g=j.y/a|0,d=(j.x+j.w)/a|0,i=(j.y+j.h)/a|0,e=[],f=[];for(j=j.x/a|0;j<=d;j++)for(var p=g;p<=i;p++)e=e.concat(b(j,p));e.sort();for(g=e.length;g--;){d=e[g];if(i=h[d])f[f.length]=i;for(;g>0&&e[g-1]==d;)g--}return f}}},Cb=3E4,nb={},Db=0;(new Date).getTime();var pa={},ua=[];Ia.prototype={constructor:Ia,load:function(a){var b=this;Ha(this.url,function(c){b.loaded=true;
b.image=c;a&&a()})}};var Ub=function(){return qa({fastpan:true,applyStyle:function(){},applyTransform:function(a,b,c){return{restore:null,x:b,y:c}},checkSize:function(){},getDimensions:function(){return{width:0,height:0}},getViewport:function(){},hitTest:function(){return false},prepare:function(){},projectXY:null,reset:function(){}})},Vb=W.attachRenderer=function(a,b,c,h,k){a=a.split("/");for(var j=new Ub(b,c,h,k),g=0;g<a.length;g++)j=ra("renderer",a[g],b,c,h,k,j);return j};ba("renderer","canvas",
function(a,b,c,h,k){function j(o,A,C){var u,D;m[A]=function(H){for(u=J.length;u--;)if(D=C[J[u]])H[v[u]]=D}}function g(o,A,C){var u=false;if(A)u=f.isPointInPath(w?A.x-p:A.relXY.x,w?A.y-l:A.relXY.y);return{draw:C||E,viewport:o,hit:u,vpX:p,vpY:l,context:f}}h=G({},h);var d,i,e,f,p=0,l=0,m={},q=null,w=Ta.canvas.pipTransformed,x={},y=function(){},E=function(){this.fill&&f.fill();this.stroke&&f.stroke()},J=["fill","stroke","lineWidth","opacity"],v=["fillStyle","strokeStyle","lineWidth","globalAlpha"];if(b){d=
b.offsetWidth;i=b.offsetHeight;e=Sb(d,i);e.style.cssText="position: absolute; z-index: 1;";a.attachFrame(e,true);f=null}c=G(k,{applyStyle:function(o){var A=m[o],C=f&&f.canvas?f.canvas.id:"default",u;x[C]||(x[C]=[]);u=x[C].pop()||"basic";if(A){x[C].push(o);A(f);return u}},applyTransform:function(o){if(o.translateX!==0||o.translateY!==0||o.scaling!==1||o.rotation!==0){f.save();q={undo:function(){f.restore();q=null},x:o.xy.x,y:o.xy.y};f.translate(o.xy.x-p+o.translateX,o.xy.y-l+o.translateY);o.rotation!==
0&&f.rotate(o.rotation);o.scaling!==1&&f.scale(o.scaling,o.scaling)}return q},drawTiles:function(o,A,C){for(var u,D=p-256,H=l-256,I=o.x2,R=o.y2,N=A.length;N--;){o=A[N];if(u=o.x>=D&&o.x<=I&&o.y>=H&&o.y<=R)if(!o.loaded&&C)o.load(a.invalidate);else o.image&&f.drawImage(o.image,o.x-p,o.y-l)}},prepare:function(o,A){var C,u=false,D=A.scaled||A;if(f)f.restore();else f=e.getContext("2d");for(C=o.length;C--;)u=u||o[C].clip;p=D.x;l=D.y;if(f){u||f.clearRect(0,0,d,i);f.save()}f.globalCompositeOperation="source-over";
return f},prepArc:function(o,A,C){f.beginPath();f.arc(o.xy.x-(q?q.x:p),o.xy.y-(q?q.y:l),o.size>>1,o.startAngle,o.endAngle,false);return g(A,C)},prepImage:function(o,A,C,u){var D=(u.x||o.xy.x)-(q?q.x:p),H=(u.y||o.xy.y)-(q?q.y:l),I=u.image||o.image;if(I){f.beginPath();f.rect(D,H,u.width||I.width,u.height||I.height);return g(A,C,function(){f.drawImage(I,D,H,u.width||I.width,u.height||I.height)})}},prepMarker:function(o,A,C){var u=o.xy.x-(q?q.x:p),D=o.xy.y-(q?q.y:l),H=o.size,I=undefined;f.beginPath();
switch(o.markerStyle.toLowerCase()){case "image":I=y;f.rect(u-(H>>1),D-(H>>1),H,H);if(o.reset&&o.image){o.image=null;o.reset=false}o.image?f.drawImage(o.image,u-(H>>1),D-(H>>1),H,H):Ha(o.imageUrl,function(R){o.image=R;f.drawImage(o.image,u-(H>>1),D-(H>>1),H,H)});break;default:f.moveTo(u,D);f.lineTo(u-(H>>1),D-H);f.lineTo(u+(H>>1),D-H);f.lineTo(u,D)}return g(A,C,I)},prepPoly:function(o,A,C,u){var D=true;o=u.points||o.points;u=q?q.x:p;var H=q?q.y:l;f.beginPath();for(var I=o.length;I--;){var R=o[I].x-
u,N=o[I].y-H;if(D){f.moveTo(R,N);D=false}else f.lineTo(R,N)}return g(A,C)},getContext:function(){return f}});(function(){for(var o in W.styles)j(null,o,W.styles[o]);W.bind("styleDefined",j)})();c.bind("detach",function(){b.removeChild(e)});return c});ba("renderer","dom",function(a,b,c,h,k){function j(f){var p=f.image=new Image;i[f.id]=f;p.src=f.url;p.onload=function(){if(e[f.id])d.appendChild(this);else f.image=null};p.style.cssText="-webkit-user-select: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute;";
return p}function g(f,p,l){var m=[],q;for(q in f){var w=f[q];if(l?w[l]:!p[q]){if(w.image&&w.image.parentNode){d.removeChild(w.image);w.image=null}m[m.length]=q}}for(p=m.length;p--;)delete f[m[p]]}var d=null,i={},e={};d=ea.create("div","",ea.styles({width:b.offsetWidth+"px",height:b.offsetHeight+"px"}));b.childNodes.length>0?b.insertBefore(d,b.childNodes[0]):b.appendChild(d);a.attachFrame(d);a=G(k,{drawTiles:function(f,p,l){for(var m,q=f.x,w=f.y,x=p.length;x--;){f=p[x];if(f.url){(m=f.image||(l?j(f):
null))&&ea.move(m,f.x-q,f.y-w);e[f.id]=f}}}});a.bind("predraw",function(){g(i,e);e={}});a.bind("detach",function(){b.removeChild(d)});a.bind("reset",function(){for(g(i,e={});d.childNodes.length>0;)d.removeChild(d.childNodes[0])});return a});var Ya=W.styles={},Wb=W.defineStyle=function(a,b){Ya[a]=b;W.trigger("styleDefined",a,Ya[a]);return a},xb=W.defineStyles=function(a){for(var b in a)Wb(b,a[b])};W.getStyle=function(a){return Ya[a]};W.loadStyles=function(a){Nb(a,function(b){xb(b)})};xb({basic:{fill:"#ffffff"},
highlight:{fill:"#ff0000"},waypoints:{lineWidth:4,stroke:"#003377",fill:"#ffffff"},waypointsHover:{lineWidth:4,stroke:"#ff0000",fill:"#ffffff"}});ba("view","simple",function(a){function b(n,s,t,L){y(La(Sa(U+ka(2,L)-1,0.5),2))}function c(n){var s=n|0;n=s+Math.round((n-s)*50)/50;if(n!==U){U=n;n=ja(U)/Math.LN2|0;if(n!==0){U=ka(2,n);m(Ba+n,Xb,Yb)}fa++}}function h(n,s){var t=renderer&&renderer.projectXY?renderer.projectXY(n,s):null;if(!t){t=S.getViewport();var L=1/U;t=new O(t?t.x+n*L:n,t?t.y+s*L:s)}return t}
function k(n,s,t){E("doubleTap",s,t,h(t.x,t.y));a.scalable&&y(2,h(t.x,t.y),Zb,null,$b)}function j(n,s,t){D=null;N=true;l("down",s,t)}function g(n,s,t){l("hover",s,t)}function d(n,s,t,L){p(s,t,false);if(!D){r=L.x;B=L.y}}function i(n,s,t){p(s,t,true);N=false}function e(){clearTimeout(yb);yb=setTimeout(function(){renderer.checkSize()},250)}function f(n,s,t){l("tap",s,t);E("tap",s,t,h(t.x,t.y,true))}function p(n,s,t){if(D){n=h(s.x,s.y);D.drag.call(D.target,D,n.x,n.y,t)&&fa++;if(t)D=null}}function l(n,
s,t){aa=Hits.init(n,s,t,h(t.x,t.y,true));for(n=o;n--;)I=I||(v[n].hitGuess?v[n].hitGuess(aa.x,aa.y,S):false);I&&fa++}function m(n,s,t){if(X(n,Xa)){n=Sa(a.minZoom,La(a.maxZoom,n));if(n!==Ba){var L=ka(2,n-Ba),Q=Za/L|0,$=$a/L|0;Ba=n;J(((s||P+Za)-Q)*L,((t||T+$a)-$)*L);Z=F=0;E("zoom",n);U=1;renderer.trigger("reset");x()}return S}else return Ba}function q(){var n=new la(P,T,Ma,Na);n.scaleFactor=U;return n}function w(n,s,t){if(X(s,ma))for(s=0;s<o;s++){if(v[s].id===n)return v[s]}else if(X(n,Ga)){n=ra("layer",
s,S,t);n.added=(new Date).getTime();v[v.length]=n;v.sort(function(L,Q){return Q.zindex-L.zindex||Q.added-L.added});o=v.length;n.trigger("resync");n.trigger("refresh",S,q());S.trigger("layerChange",S,n);fa++;return n}else return[].concat(v)}function x(){var n=q();if(n){if(V||Y)if(n){var s=va?P+(n.w>>1):P,t=Oa?T+(n.h>>1):T,L=n.w,Q=n.h;if(V&&V>L)if(s+L>V)P=va?P:V-L;else if(s<0)P=va?P:0;if(Y&&Y>Q)if(t+Q>Y)T=Oa?T:Y-Q;else if(t<0)T=Oa?T:0}F=P;Z=T;E("refresh",S,n);fa++}}function y(n,s,t,L,Q){var $;if(!ac){t=
false;$=wa(ja(n)/Math.LN2);n=ka(2,$)}t?cb(U,n,t,Q,function(sa,Pa){n=sa;if(Pa){$=wa(ja(n)/Math.LN2);n=ka(2,$);L&&L()}c(n)}):c(n);return S}function E(){for(var n=S.trigger.apply(null,arguments).cancel,s=v.length;s--;)n=v[s].trigger.apply(null,arguments).cancel||n;return!n}function J(n,s,t){if(X(n,Xa)){if(!(t&&panSpeed===0)){P=n|0;T=s|0}}else return new O(P,T)}a=G({container:"",captureHover:true,drawOnScale:true,padding:0,inertia:true,refreshDistance:256,pannable:false,scalable:false,minZoom:1,maxZoom:1,
renderer:"canvas/dom",zoom:1},a);var v=[],o=0,A=null,C=null,u,D=null,H=!X(window.attachEvent,ma),I=false,R=true,N=false,r=0,B=0,M=a.refreshDistance,P=0,T=0,z=0,K=0,F=0,Z=0,V=null,Y=null,va=false,Oa=false,Ca=a.padding,aa=null,Da=null,yb=0,U=1,zb=1,ca=null,ab={index:0,draw:false},ac=true,fa=0,Ma,Na,Za,$a,Qa,Ab,Xb,Yb,Ba=a.zoom||a.zoomLevel,Zb=Ra("quad.out"),$b=300,S={id:a.id,padding:Ca,panSpeed:0,attachFrame:function(n,s){s&&A.appendChild(n)},center:function(n,s,t){if(X(n,Ga)){s=jb.parseXY(n);n=s.x;
s=s.y}if(X(n,Xa)){J(n-Qa,s-Qa,t);return S}else return J().offset(Qa,Ab)},detach:function(){renderer&&renderer.trigger("detach");ca&&ca.unbind();if(C){u.removeChild(C);A=C=null}},layer:w,invalidate:function(){fa++},refresh:x,resetScale:function(){U=1},scale:y,triggerAll:E,removeLayer:function(n){a:{for(var s=o;s--;)if(v[s].id===n){n=s;break a}n=-1}if(n>=0&&n<o){S.trigger("layerRemove",S,v[n]);v.splice(n,1);fa++}o=v.length},getRenderer:function(){return renderer},getScaleFactor:function(){return U},
setMaxOffset:function(n,s,t,L){V=n;Y=s;va=t;Oa=L},getViewport:q,offset:J,pan:function(n,s){r=n;B=s;fa++},zoom:m};qa(S);S.bind("resize",function(){renderer.checkSize()});Ta.init(function(){S.markers=w("markers","draw",{zindex:20});u=document.getElementById(a.container);u.appendChild(C=ea.create("div","",ea.styles({width:u.offsetWidth+"px",height:u.offsetHeight+"px"})));Ma=C.offsetWidth+Ca*2;Na=C.offsetHeight+Ca*2;Za=Ma/2;$a=Na/2;Qa=u.offsetWidth/2;Ab=u.offsetHeight/2;C.appendChild(A=ea.create("div",
"",ea.styles({width:Ma+"px",height:Na+"px","z-index":2,margin:-Ca+"px 0 0 "+-Ca+"px"})));renderer=Vb(a.renderer,S,A,u,a);R=renderer.fastpan;ca&&ca.unbind();if(renderer){ca=INTERACT.watch(renderer.interactTarget||u);if(a.scalable){ca.bind("zoom",b);ca.bind("doubleTap",k)}ca.bind("pointerDown",j);ca.bind("pointerMove",d);ca.bind("pointerUp",i);a.captureHover&&ca.bind("pointerHover",g);ca.bind("tap",f)}H?window.attachEvent("onresize",e):window.addEventListener("resize",e,false)});Tb.attach(function(n){var s=
[],t,L,Q;self.panSpeed=panSpeed=na(r)+na(B);t=U!==zb;if(panSpeed>0||t)fa++;if(panSpeed<2&&(na(P-F)>=M||na(T-Z)>=M))x();ab.index++;ab.draw=fa||panSpeed||0;if(renderer&&ab.draw){z+=r;K+=B;if(r||B)S.trigger("pan");if(U!==1&&ea.supportTransforms)s[s.length]="scale("+U+")";if(t=!R||(a.drawOnScale||U===1)&&panSpeed<5){P=P-z/U|0;T=T-K/U|0;Q=q();renderer.trigger("predraw",Q);if(renderer.prepare(v,Q,n,aa)){L=K=t=z=fa=0;for(ii=o;ii--;){var $=v[ii];if($.visible){var sa=$.style?renderer.applyStyle($.style,true):
null;$.draw(renderer,Q,S,n,aa);sa&&renderer.applyStyle(sa)}}renderer.trigger("render",Q);S.trigger("drawComplete",Q,n);zb=U;ea.move(A,t,L,s)}}else ea.move(A,z,K,s);if(N||!a.inertia)B=r=0;else if(r!=0||B!=0){r*=0.8;B*=0.8;if(na(r)<0.5)r=0;if(na(B)<0.5)B=0}if(aa){n=aa?aa.elements:[];if(Da&&Da.type==="hover"){s=Hits.diffHits(Da.elements,n);s.length>0&&Hits.triggerEvent(Da,S,"Out",s)}if(n.length>0){t=aa.x;L=aa.y;for(s=n.length;s--;){Q=n[s];$=t;sa=L;var Pa=Q&&Q.drag&&(!Q.canDrag||Q.canDrag(Q,$,sa));if(Pa){D=
Q;D.startX=$;D.startY=sa}if(Pa)break}Hits.triggerEvent(aa,S)}Da=n.length>0?G({},aa):null;aa=null}}});return S});ba("view","map",function(a){function b(d,i,e){g.zoom(i);c(d,e)}function c(d,i,e,f){d=new O(d);d.sync(gb(g.zoom()));g.center(d.x,d.y,e,f,function(){i&&i(g)})}a=G({zoomLevel:1,minZoom:1,maxZoom:18,pannable:true,scalable:true},a);var h=new O,k=0,j=a.tapExtent;a.adjustScaleFactor=function(d){return Math.pow(2,(d<1?Math.floor:Math.ceil)(Math.log(d)))};var g=G(ra("view","simple",a),{getBoundingBox:function(){var d=
g.getViewport();return d?new Aa((new O(d.x,d.y2)).toPos(k),(new O(d.x2,d.y)).toPos(k)):null},getCenterPosition:function(){var d=g.getViewport();if(d)return(new O(d.x+(d.w>>1),d.y+(d.h>>1))).toPos(k);return null},gotoBounds:function(d,i){b(d.center(),d.bestZoomLevel(g.getViewport()),i)},gotoPosition:b,panToPosition:c});g.bind("tap",function(d,i,e,f){d=f.toPos(k);var p=f.offset(-j,j).toPos(k);f=f.offset(j,-j).toPos(k);g.trigger("geotap",i,e,d,new Aa(p,f))});g.bind("refresh",function(d,i,e){if(h.x!=
e.x||h.y!=e.y){g.trigger("boundsChange",g.getBoundingBox());h.x=e.x;h.y=e.y}});g.bind("zoom",function(d,i){var e;k=g.rpp=gb(i);e=da/k|0;g.setMaxOffset(e,e,true,false);g.resetScale();g.triggerAll("resync")});return g});var ta=function(a,b,c){c=G({style:null,xy:null,size:10,fill:false,stroke:true,draggable:false,observable:true,properties:{},typeName:"Shape"},c);G(this,c);if(X(this.xy,Ga))this.xy=new O(this.xy);this.id="drawable_"+Rb++;this.bounds=null;this.view=a;this.layer=b;this.rotation=this.animations=
0;this.scaling=1;this.translateY=this.translateX=0;this.observable&&qa(this)};ta.prototype={constructor:ta,animate:function(a,b,c,h){Eb(this,a,b,c,h)},drag:null,draw:null,getProps:null,resync:function(){if(this.xy){this.xy.sync(view.rpp);if(this.size){var a=this.size>>1;this.updateBounds(new la(this.xy.x-a,this.xy.y-a,this.size,this.size))}}},rotate:function(a){this.rotation=a},scale:function(a){this.scaling=a},translate:function(a,b){this.translateX=a;this.translateY=b},updateBounds:function(a,b){a&&
(!this.bounds||a.x!=this.bounds.x||a.y!=this.bounds.y)&&this.trigger("move",this,a,this.bounds);this.bounds=a;if(b)this.xy=this.bounds.center()}};var db=1E3/60|0,za=[],pb=0;ba("drawable","marker",function(a,b,c){c=G({fill:true,stroke:false,markerStyle:"simple",hoverStyle:"highlight",typeName:"Marker"},c);return new ta(a,b,c)});ba("drawable","poly",function(a,b,c){c=G({simplify:false,fill:true,points:[],typeName:"Poly"},c);var h=c.points,k=c.simplify;ta.call(this,c);G(this,{getPoints:function(){return[].concat(h)},
resync:function(){var j,g,d,i,e,f,p,l;for(j=h.length;j--;)h[j].sync(a.rpp);l=this.points=k?k(h):h;for(j=l.length;j--;){g=l[j].x;d=l[j].y;f=X(f,ma)||g<f?g:f;p=X(p,ma)||d<p?d:p;i=X(i,ma)||g>i?g:i;e=X(e,ma)||d>e?d:e}this.updateBounds(new la(f,p,i-f,e-p),true)}});this.haveData=h&&h.length>=2});ba("drawable","line",function(a,b,c){c.fill=false;return ra("drawable","poly",a,b,c)});ba("drawable","image",function(a,b,c){function h(){if(i&&i.width>0){if(!this.centerOffset)this.centerOffset=new O(-i.width>>
1,-i.height>>1);this.updateBounds(new la(this.xy.x+this.centerOffset.x,this.xy.y+this.centerOffset.y,i.width,i.height),false)}}function k(f){if(this.imageUrl=f){var p=this;Ha(this.imageUrl,function(l,m){i=l;if(m){var q=e.layer?e.layer.view:null;q&&q.invalidate()}h.apply(p)})}}c=G({image:null,imageUrl:null,centerOffset:null,typeName:"Image"},c);var j=ta.prototype.resync,g=0,d=0,i=c.image,e=G(new ta(a,b,c),{changeImage:k,getProps:function(){this.bounds||h(this,i);return{image:i,x:this.xy.x+g,y:this.xy.y+
d}},resync:function(f){j.call(this,f);h.call(this)}});i||k.call(this,this.imageUrl);if(this.centerOffset){g=this.centerOffset.x;d=this.centerOffset.y}});ba("drawable","arc",function(a,b,c){c=G({startAngle:0,endAngle:Math.PI*2,typeName:"Arc"},c);return new ta(a,b,c)});Ja.prototype={constructor:Ja,clip:null,cycle:function(){},draw:function(){},hitGuess:null};ba("layer","tile",function(a,b){b=G({generator:"osm",imageLoadArgs:{}},b);var c=ra("generator",b.generator,b).run,h=null,k=[],j=G(new Ja(b),{draw:function(g,
d,i){g.drawTiles&&g.drawTiles(d,h.search(d.buffer(128)),i.panSpeed<2)}});j.bind("refresh",function(g,d,i){var e=(new Date).getTime();h&&c(d,i,h,function(){d.invalidate();ha("GEN COMPLETED IN "+((new Date).getTime()-e)+" ms")})});j.bind("resync",function(){var g=a&&a.zoom?a.zoom():0;k[g]||(k[g]=kb(g));h=k[g]});return j});ba("layer","draw",function(a,b){function c(e,f,p,l){var m=this.dragOffset;if(!m)m=this.dragOffset=new O(e.startX-this.xy.x,e.startY-this.xy.y);this.xy.x=f-m.x;this.xy.y=p-m.y;if(l){delete this.dragOffset;
a.invalidate();this.trigger("dragDrop")}return true}function h(e){clearTimeout(d);d=setTimeout(function(){j.sort(function(f,p){if(p.xy&&f.xy){var l=p.xy.y-f.xy.y;return l!=0?l:p.xy.x-f.xy.x}});e&&e.invalidate()},50)}function k(e,f,p,l){l&&g.remove(l,f);g.insert(p,f)}b=G({zindex:10},b);var j=[],g,d=0,i=G(new Ja(b),{itemCount:0,clear:function(){g=new lb;j=[];i.itemCount=0},create:function(e,f,p){e=ra("drawable",e,i,f);if(p)j.unshift(e);else j[j.length]=e;e.resync();g&&e.bounds&&g.insert(e.bounds,e);
h(a);e.bind("move",k);i.itemCount=j.length},draw:function(e,f,p,l,m){p={};l=g&&f?g.search(f):[];for(var q=l.length;q--;){var w=l[q],x=w.style||i.style,y,E=e.applyTransform(w),J=w.getProps?w.getProps(e):p;if(J=(y=e["prep"+w.typeName])?y.call(e,w,f,m,J):null){if(m&&J.hit){m.elements.push(Hits.initHit(w.type,w,w.draggable?c:null));y=m.type+"Style";x=w[y]||i[y]||x}x=x?e.applyStyle(x,true):null;(y=w.draw||J.draw)&&y.call(w,J);x&&e.applyStyle(x)}E&&E.undo&&E.undo()}},find:function(){return[].concat(j)},
hitGuess:function(e,f){return g&&g.search({x:e-10,y:f-10,w:20,h:20}).length>0}});i.bind("resync",function(){g=kb(a.zoom(),g);for(var e=j.length;e--;)j[e].resync()});return i});ga.prototype={constructor:ga,distanceTo:function(){if(!targetPos||this.empty()||targetPos.empty())return 0;var a=(targetPos.lat-this.lat)*ia>>1,b=(targetPos.lon-this.lon)*ia>>1;a=oa(a)*oa(a)+Wa(this.lat*ia)*Wa(targetPos.lat*ia)*oa(b)*oa(b);return 6371*2*Qb(wb(a),wb(1-a))},equalTo:function(a){return pos&&this.lat===a.lat&&this.lon===
a.lon},empty:function(){return this.lat===0&&this.lon===0},inArray:function(a){for(var b=a.length;b--;)if(this.equal(a[b]))return true;return false},offset:function(a,b){var c=this.lat*ia,h=this.lon*ia,k=c+a/6371;c=Pb(oa(b/6371)/Wa(c));h=h+c;k=(k+ya)%Math.PI-ya;h%=da;return new ga(k*Ka,h*Ka)},toPixels:function(){return new O(parseFloat(this.lon)*ia,fb(this.lat))},toString:function(a){return this.lat+(a||" ")+this.lon}};var bc=function(){return{generalize:function(a,b,c){var h=a.length,k=[],j=null;
c||(c=250);c/=1E3;ha("generalizing positions, must include "+b.length+" positions");for(var g=h;g--;)if(g===0)k.unshift(a[g]);else{var d=!j||a[g].inArray(b)?c:j.distanceTo(a[g]);if(a[g]&&d>=c){k.unshift(a[g]);j=a[g]}}ha("generalized "+h+" positions into "+k.length+" positions");return k},parseArray:function(a){var b=a.length,c=Array(b);for(b=b;b--;)c[b]=new ga(a[b]);return c},vectorize:function(a,b){function c(){for(var g=0,d=b.chunkSize,i=h;i--;){k[i]=new O(a[i]);g+=1;if(g>d)break}h=i;if(h<=0)b.callback&&
b.callback(k);else animFrame(c)}var h=a.length,k=Array(h);b=G({chunkSize:500,async:true,callback:null},b);if(!b.async){for(var j=h;j--;)k[j]=new O(a[j]);return k}animFrame(c);return null}}}();Aa.prototype={constructor:Aa,bestZoomLevel:function(a){var b=this.center();b=La(wa(na(b.lat)*0.05),Va.length);var c=Va[b],h=this.size();b=vb(ja(Va[3]*a.h/h.y)/ja(2));a=vb(ja(c*a.w/h.x)/ja(2));return La(isNaN(b)?1E3:b,isNaN(a)?1E3:a)},center:function(){var a=this.size();return new ga(this.min.lat+(a.y>>1),this.min.lon+
(a.x>>1))},expand:function(a){this.min.lat-=a;this.max.lat+=a;this.min.lon-=a%360;this.max.lon+=a%360},size:function(a){var b=new O(0,this.max.lat-this.min.lat);b.x=(a||isType(a,ma))&&this.min.lon>this.max.lon?360-this.min.lon+this.max.lon:this.max.lon-this.min.lon;return b},toString:function(){return"min: "+this.min+", max: "+this.max}};G(W,{userMessage:eb,Registry:Ua,DOM:ea,Rect:la,XY:O,Hits:Hits,tweenValue:cb,easing:Ra,Tile:Ia,getImage:Ha,Pos:ga,PosFns:bc,BBox:Aa});ba("generator","osm",function(a){a=
G({flipY:false,tileSize:256,tilePath:"{0}/{1}/{2}.png",osmDataAck:true},a);var b=Math.PI/180,c=180/Math.PI,h=null,k=[],j,g=Ea(a.tilePath),d={buildTileUrl:function(i,e,f,p,l){if(e>=0&&e<p){i=(i%p+p)%p;e=g(f,i,l?Math.abs(e-p+1):e);if(h)e=j(k[i%(k.length||1)])+e;return e}},run:function(i,e,f,p){if(i=i.zoom?i.zoom():0){var l=2<<i-1,m=a.tileSize,q=Math.PI*2/(m<<i),w=(e.w/m|0)+1,x=(e.h/m|0)+1;e=(new O(e.x,e.y)).toPos(q);var y=e.lat;e=new O((e.lon+180)/360*l|0,(1-Math.log(Math.tan(y*b)+1/Math.cos(y*b))/
Math.PI)/2*l%l|0);y=Math.PI-2*Math.PI*e.y/l;y=new ga(c*Math.atan(0.5*(Math.exp(y)-Math.exp(-y))),e.x/l*360-180);y=new O(y);y.sync(q);q=a.flipY;var E=f.search({x:y.x,y:y.y,w:w*m,h:x*m}),J={},v;for(v=E.length;v--;)J[E[v].id]=true;k=(h=d.getServerDetails?d.getServerDetails():null)&&h.subDomains?h.subDomains:[];j=Ea(h?h.baseUrl:"");for(E=0;E<=w;E++)for(v=0;v<=x;v++){var o=e.x+E,A=e.y+v,C=o+"_"+A;if(!J[C]){tileUrl=d.buildTileUrl(o,A,i,l,q);o=new Ia(y.x+E*m,y.y+v*m,tileUrl,m,m,C);f.insert(o,o)}}p&&p()}}};
a.osmDataAck&&eb("ack","osm",'Map data (c) <a href="http://openstreetmap.org/" target="_blank">OpenStreetMap</a> (and) contributors, CC-BY-SA');return d});bb.T5=W;bb.Tile5=function(a,b){b=G({container:a,type:"map",renderer:"canvas",starpos:null,zoom:1,fastpan:false,drawOnScale:true,zoombar:{}},b);return ra("view",b.type,b)}})(window);
