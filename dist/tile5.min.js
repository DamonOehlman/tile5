if(!this.JSON)this.JSON={};
(function(){function t(e){return e<10?"0"+e:e}function r(e){a.lastIndex=0;return a.test(e)?'"'+e.replace(a,function(f){var o=h[f];return typeof o==="string"?o:"\\u"+("0000"+f.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function l(e,f){var o,m,n,p,s=b,q,v=f[e];if(v&&typeof v==="object"&&typeof v.toJSON==="function")v=v.toJSON(e);if(typeof k==="function")v=k.call(f,e,v);switch(typeof v){case "string":return r(v);case "number":return isFinite(v)?String(v):"null";case "boolean":case "null":return String(v);
case "object":if(!v)return"null";b+=d;q=[];if(Object.prototype.toString.apply(v)==="[object Array]"){p=v.length;for(o=0;o<p;o+=1)q[o]=l(o,v)||"null";n=q.length===0?"[]":b?"[\n"+b+q.join(",\n"+b)+"\n"+s+"]":"["+q.join(",")+"]";b=s;return n}if(k&&typeof k==="object"){p=k.length;for(o=0;o<p;o+=1){m=k[o];if(typeof m==="string")if(n=l(m,v))q.push(r(m)+(b?": ":":")+n)}}else for(m in v)if(Object.hasOwnProperty.call(v,m))if(n=l(m,v))q.push(r(m)+(b?": ":":")+n);n=q.length===0?"{}":b?"{\n"+b+q.join(",\n"+b)+
"\n"+s+"}":"{"+q.join(",")+"}";b=s;return n}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+t(this.getUTCMonth()+1)+"-"+t(this.getUTCDate())+"T"+t(this.getUTCHours())+":"+t(this.getUTCMinutes())+":"+t(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var g=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
a=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,b,d,h={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},k;if(typeof JSON.stringify!=="function")JSON.stringify=function(e,f,o){var m;d=b="";if(typeof o==="number")for(m=0;m<o;m+=1)d+=" ";else if(typeof o==="string")d=o;if((k=f)&&typeof f!=="function"&&(typeof f!=="object"||typeof f.length!=="number"))throw Error("JSON.stringify");return l("",
{"":e})};if(typeof JSON.parse!=="function")JSON.parse=function(e,f){function o(n,p){var s,q,v=n[p];if(v&&typeof v==="object")for(s in v)if(Object.hasOwnProperty.call(v,s)){q=o(v,s);if(q!==undefined)v[s]=q;else delete v[s]}return f.call(n,p,v)}var m;e=String(e);g.lastIndex=0;if(g.test(e))e=e.replace(g,function(n){return"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){m=eval("("+e+")");return typeof f==="function"?o({"":m},""):m}throw new SyntaxError("JSON.parse");}})();if(!String.format)String.format=function(t){if(arguments.length<=1)return t;for(var r=arguments.length-2,l=0;l<=r;l++)t=t.replace(RegExp("\\{"+l+"\\}","gi"),arguments[l+1]);return t};
String.prototype.containsWord=function(t){var r="";if(t.toString)t=t.toString();for(var l=0;l<t.length;l++)r+=!/\w/.test(t[l])?"\\"+t[l]:t[l];return RegExp("(^|\\s|\\,)"+r+"(\\,|\\s|$)","i").test(this)};Number.prototype.toRad=function(){return this*Math.PI/180};Number.prototype.sec=function(){return 1/Math.cos(this)};
GRUNT=function(){var t=Object.prototype.hasOwnProperty,r=0,l={id:"GRUNT.core",extend:function(){var g=arguments[0]||{},a=1,b=arguments.length,d=false,h,k,e,f;if(typeof g==="boolean"){d=g;g=arguments[1]||{};a=2}if(typeof g!=="object"&&!l.isFunction(g))g={};if(b===a){g=this;--a}for(;a<b;a++)if((h=arguments[a])!=null)for(k in h){e=g[k];f=h[k];if(g!==f)if(d&&f&&(l.isPlainObject(f)||l.isArray(f))){e=e&&(l.isPlainObject(e)||l.isArray(e))?e:l.isArray(f)?[]:{};g[k]=l.extend(d,e,f)}else if(f!==undefined)g[k]=
f}return g},isFunction:function(g){return toString.call(g)==="[object Function]"},isArray:function(g){return toString.call(g)==="[object Array]"},isPlainObject:function(g){if(!g||toString.call(g)!=="[object Object]"||g.nodeType||g.setInterval)return false;if(g.constructor&&!t.call(g,"constructor")&&!t.call(g.constructor.prototype,"isPrototypeOf"))return false;var a;for(a in g);return a===undefined||t.call(g,a)},isEmptyObject:function(g){for(var a in g)return false;return true},isXmlDocument:function(g){return toString.call(g)===
"[object Document]"},contains:function(g,a){var b=g,d=arguments,h=1;if(a&&l.isArray(a)){d=a;h=0}for(h=h;h<d;h++)b=b&&typeof foo[d[h]]!=="undefined";return b},newModule:function(g){g=l.extend({id:null,requires:[],parent:null},g);if(g.parent)g=l.extend({},g.parent,g);return g},toID:function(g){return g.replace(/\s/g,"-")},generateObjectID:function(g){return(g?g:"obj")+r++}};return l}();
GRUNT.Log=function(){function t(b,d){var h,k=d&&d.length>0?d[0]:"";for(h=1;d&&h<d.length;h++)k+=" "+(l&&GRUNT.isPlainObject(d[h])?JSON.stringify(d[h]):d[h]);typeof console!=="undefined"&&console[b](k);for(h=0;h<r.length;h++)r[h].call(a,k,b)}var r=[],l=typeof JSON!=="undefined",g=window.console&&window.console.markTimeline,a={id:"GRUNT.log",getTraceTicks:function(){return g?(new Date).getTime():null},trace:function(b,d){if(g)console.markTimeline(b+(d?": "+(a.getTraceTicks()-d)+"ms":""))},debug:function(){t("debug",
arguments)},info:function(){t("info",arguments)},warn:function(){t("warn",arguments)},error:function(){t("error",arguments)},exception:function(b){a.error(arguments);for(var d in b)a.info("ERROR DETAIL: "+d+": "+b[d])},watch:function(b,d){try{d()}catch(h){a.exception(h,b)}},throwError:function(b){a.error(b);throw Error(b);},requestUpdates:function(b){r.push(b)}};return a}();
GRUNT.Data=function(){var t={determineObjectMapping:function(l){if(!l)return null;l=l.split("|");for(var g={},a=0;a<l.length;a++)g[l[a]]=a;return g},mapLineToObject:function(l,g){var a=l.split("|"),b={};for(var d in g){var h=g[d];b[d]=a.length>h?a[h]:null}return b},parse:function(l){var g=null,a=[];l=l.split("\n");for(var b=0;b<l.length;b++){var d=l[b];if(g)a.push(t.mapLineToObject(d,g));else g=t.determineObjectMapping(d)}return a}},r={supportedFormats:{JSON:{parse:function(l){return JSON.parse(l)}},
PDON:{parse:function(l){return t.parse(l)}}},parse:function(l){l=GRUNT.extend({data:"",format:"JSON"},l);if(!r.supportedFormats[l.format])throw Error("Unsupported data format: "+l.format+", cannot parse data in javascript object");try{return r.supportedFormats[l.format].parse(l.data)}catch(g){GRUNT.Log.error("ERROR PARSING DATA FROM FORMAT: "+l.format,l.data);GRUNT.Log.exception(g)}return{}}};return r}();
GRUNT.Template=function(){var t=/\$\{(.*?)\}/ig;return{parse:function(r,l){for(var g=r,a=t.exec(g);a;){g=g.replace(a[0],GRUNT.XPath.first(a[1],l));t.lastIndex=0;a=t.exec(g)}return g}}}();
GRUNT.JSONP=function(){function t(a){var b=document.createElement("script"),d=false;b.src=a;b.async=true;b.onload=b.onreadystatechange=function(){if(!d&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){d=true;b.onload=b.onreadystatechange=null;b&&b.parentNode&&b.parentNode.removeChild(b)}};l||(l=document.getElementsByTagName("head")[0]);l.appendChild(b)}var r=0,l,g=this;return{get:function(a,b,d){a+=a.indexOf("?")>=0?"&":"?";var h="json"+ ++r;g[h]=function(k){b(k);g[h]=
null;try{delete g[h]}catch(e){}};t(a+(d?d:"callback")+"="+h);return h}}}();
GRUNT.XHR=function(){var t={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},r={JSON:["json"],PDON:["pdon.txt"]},l=["TEXT","STREAM"],g=/^(\w+:)?\/\/([^\/?#]+)/,a={XML:function(h){return h.responseXML},JSON:function(h){try{return JSON.parse(h.responseText)}catch(k){GRUNT.Log.error("Error parsing JSON data: ",h.responseText);GRUNT.Log.exception(k)}return""},PDON:function(h){return GRUNT.Data.parse({data:h.responseText,format:"PDON"})},DEFAULT:function(h){return h.responseText}},
b={CONTENT_TYPE:"Content-Type"},d=GRUNT.newModule({id:"GRUNT.xhr",ajaxSettings:{xhr:null},ajax:function(h){try{h=GRUNT.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},d.ajaxSettings,h);var k=g.exec(h.url),e=k&&(k[1]&&k[1]!==location.protocol||k[2]!==location.host);if(h.data)h.method="POST";if(h.url){k=null;if(h.xhr)k=h.xhr(h);k||(k=new XMLHttpRequest);k.open(h.method,h.url,h.async);h.data&&k.setRequestHeader("Content-Type",
h.contentType);e||k.setRequestHeader("X-Requested-With","XMLHttpRequest");k.onreadystatechange=function(){if(this.readyState===4){var o=null,m=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(m)if(h.handleResponse)h.handleResponse(this);else{var n=h,p=this.getResponseHeader(b.CONTENT_TYPE),s,q=false;for(s in t)if(p&&p.indexOf(t[s])>=0){q=true;break}p=!q;for(q=0;q<l.length;q++)p=p||l[q]==s;if(p)b:{p=s;for(var v in r)for(q=
0;q<r[v].length;q++)if(RegExp(r[v][q]+"$","i").test(n.url)){s=v;break b}s=p?p:"DEFAULT"}try{o=a[s](this,n)}catch(w){GRUNT.Log.warn("error applying processor '"+s+"' to response type, falling back to default");o=a.DEFAULT(this,n)}}else h.error&&h.error(this)}catch(u){GRUNT.Log.exception(u,"PROCESSING AJAX RESPONSE")}m&&o&&h.success&&h.success.call(this,o)}};k.send(h.method=="POST"?d.param(h.data):null)}else GRUNT.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(f){GRUNT.Log.exception(f)}},
param:function(h){var k=[],e=function(o,m){m=GRUNT.isFunction(m)?m():m;k[k.length]=encodeURIComponent(o)+"="+encodeURIComponent(m)};if(GRUNT.isArray(h))for(var f=0;f<h.length;f++)e(h[f].name,h[f].value);else for(f in h)e(f,h[f]);return k.join("&").replace(/%20/g,"+")}});return d}();
GRUNT.XPath=function(){function t(a){for(var b=null,d=0;d<r.length;d++)if(b=r[d](a))break;return b}var r=[],l=[null,function(a){return a.numberValue},function(a){return a.stringValue},function(a){return a.booleanValue},null,null,null,null,function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null},function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||GRUNT.Log.warn("No XPATH support, this is going to cause problems");var g={SearchResult:function(a){return{toString:function(){var b=
null;if(a){var d=null;if(a.resultType>=0&&a.resultType<l.length)d=l[a.resultType];if(d){GRUNT.Log.info("invoking match handler for result type: "+a.resultType);b=d(a)}}return b?b:""}}},first:function(a,b){var d=g.SearchResult,h;var k=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!k)k=XPathResult.ANY_TYPE;try{if(GRUNT.isXmlDocument(b))h=b.evaluate(a,b,t,k,null);else{GRUNT.Log.warn("attempted xpath expression: "+a+" on a non-xml document");h=null}}catch(e){GRUNT.Log.warn("attempted to run invalid xpath expression: "+
a+" on node: "+b);h=null}return new d(h)},registerResolver:function(a){r.push(a)}};return g}();GRUNT.Observable=function(){var t={},r=0,l={bind:function(g,a){t[g]||(t[g]=[]);r+=1;t[g].push({callback:a,callbackId:r});return r},trigger:function(g){var a=t[g];if(a)for(var b=a.length;b--;)a[b].callback.apply(l,Array.prototype.slice.call(arguments,1))},unbind:function(g,a){for(var b=t[g],d=0;b&&d<b.length;d++)if(b[d].callbackId===a){b.splice(d,1);break}}};return l};
GRUNT.WaterCooler=function(){var t={},r=[];return{addPipe:function(l){l("pipe.test",{});r.push(l)},listen:function(l,g){t[l]||(t[l]=[]);g&&t[l].push(g)},say:function(l,g){var a;for(a=r.length;a--;)r[a](l,g);if(t[l])for(a=t[l].length;a--;)t[l][a](g)},leave:function(){}}}();
TILE5=function(){var t={newCanvas:function(r,l){var g=document.createElement("canvas");typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(g);g.width=r?r:0;g.height=l?l:0;return g},Settings:function(){var r={};return{get:function(l){return r[l]},set:function(l,g){r[l]=g},extend:function(l){GRUNT.extend(r,l)}}}(),Clock:function(){var r=null;return{getTime:function(l){return l&&r?r:r=(new Date).getTime()}}}(),Vector:function(r,l){return{x:r?r:0,y:l?l:0}},V:function(){function r(l){if(!l||
l.length<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var g={edges:Array(l.length-1),accrued:Array(l.length-1),total:0},a=TILE5.V.diff,b=0;b<l.length-1;b++){var d=a(l[b],l[b+1]);g.edges[b]=Math.sqrt(d.x*d.x+d.y*d.y);g.accrued[b]=g.total+g.edges[b];g.total+=g.edges[b]}return g}return{create:function(l,g){return new t.Vector(l,g)},add:function(){for(var l=new t.Vector,g=arguments.length;g--;){l.x+=arguments[g].x;l.y+=arguments[g].y}return l},absSize:function(l){return Math.max(Math.abs(l.x),
Math.abs(l.y))},diff:function(l,g){return new t.Vector(l.x-g.x,l.y-g.y)},copy:function(l){return l?new t.Vector(l.x,l.y):null},invert:function(l){return new TILE5.Vector(-l.x,-l.y)},offset:function(l,g,a){return new TILE5.Vector(l.x+g,l.y+(a?a:g))},edges:r,distance:function(l){return r(l).total},theta:function(l,g,a){a=Math.asin((l.y-g.y)/a);return l.x>g.x?a:Math.PI-a},pointOnEdge:function(l,g,a,b){g=new TILE5.Vector(Math.cos(a)*b,Math.sin(a)*b);return new TILE5.Vector(l.x-g.x,l.y-g.y)},getRect:function(l){var g=
l.length;if(g>1)return new TILE5.Rect(Math.min(l[0].x,l[g-1].x),Math.min(l[0].y,l[g-1].y),Math.abs(l[0].x-l[g-1].x),Math.abs(l[0].y-l[g-1].y))},toString:function(l){return l.x+", "+l.y}}}(),Dimensions:function(r,l){return{width:r?r:0,height:l?l:0}},D:function(){return{getAspectRatio:function(r){return r.height!==0?r.width/r.height:1},getCenter:function(r){return new t.Vector(r.width/2,r.height/2)},getSize:function(r){return Math.sqrt(Math.pow(r.width,2)+Math.pow(r.height,2))}}}(),Rect:function(r,
l,g,a){return{origin:new t.Vector(r,l),dimensions:new t.Dimensions(g,a)}},R:function(){return{copy:function(r){return r?new t.Rect(r.origin.x,r.origin.y,r.dimensions.width,r.dimensions.height):null},getCenter:function(r){return new TILE5.Vector(r.origin.x+r.dimensions.width/2,r.origin.y+r.dimensions.height/2)}}}()};return t}();
TILE5.Device=function(){function t(){for(;f.length>0;){var m=f.shift();document.location=m}e=0}function r(m){for(var n=true,p=o.length;p--;)n=n&&m!=o[p];return n}function l(m,n){var p=[];for(var s in n)s&&p.push(s+"="+escape(n[s]));return"tile5://"+m+"/"+(p.length>0?"?"+p.join("&"):"")}function g(m,n){r(m)&&GRUNT.Log.info("would push url: "+l(m,n))}function a(m,n){if(r(m)){f.push(l(m,n));e||(e=setTimeout(t,100))}}function b(){d={base:{name:"Unknown",eventTarget:document,supportsTouch:"createTouch"in
document,imageCacheMaxSize:4096,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:g,targetFps:null},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:a,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:a},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:a},android:{name:"Android OS <= 2.1",regex:/android/i,eventTarget:document.body,
supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},bridgeNotify:a},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:a}};h=[d.froyo,d.android,d.ipod,d.iphone,d.ipad]}var d=null,h=[],k=null,e=0,f=[],o=["view.wake","tile.loaded"];return{getConfig:function(){d||b();if(!k){GRUNT.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var m=0;m<h.length;m++){var n=h[m];if(n.regex&&n.regex.test(navigator.userAgent)){k=
GRUNT.extend({},d.base,n);GRUNT.Log.info("PLATFORM DETECTED AS: "+k.name);break}}if(!k){GRUNT.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");k=d.base}GRUNT.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return k}}}();
TILE5.Resources=function(){var t="",r={},l=function(){function a(){var w=e[this.id];if(w&&w.image.complete&&w.image.width>0){w.loaded=true;w.hitCount=1;for(var u=m.length;u--;)if(m[u].image.src==this.src){m.splice(u,1);break}w.loadCallback&&w.loadCallback(this,false);n.push({url:this.src,created:w.requested});delete e[this.id];b()}}function b(){for(var w=TILE5.Device.getConfig().maxImageLoads;o.length>0&&(!w||m.length<w);){var u=o.shift();if(u.imageLoader){m.push(u);u.imageLoader(u,a)}}}function d(w){for(var u=
null,x=p.length;x--&&!u;)u=p[x](w);return u?u:function(y,A){y.image.onload=A;y.image.src=g.getPath(y.url);y.requested=(new Date).getTime()}}function h(){q=true;try{var w=Math.floor(n.length/2);if(w>0){n.sort(function(x,y){return x.created-y.created});for(var u=w;u--;)delete k[n[u].url];n.splice(0,w)}}finally{q=false}GRUNT.WaterCooler.say("imagecache.cleared")}var k={},e={},f=0,o=[],m=[],n=[],p=[],s=0,q=false,v={loadingImages:m,queuedImages:o,addInterceptor:function(w){p.push(w)},getCacheFullness:function(){return s},
getImage:function(w){var u=null;q||(u=k[w]);return u?u.image:null},loadImage:function(w,u){var x=k[w];if(x){x.hitCount++;x.image.complete&&u&&u(x.image,true)}else{x={url:w,image:new Image,loaded:false,imageLoader:d(w),created:(new Date).getTime(),requested:null,hitCount:0,loadCallback:u};x.image.id="resourceLoaderImage"+f++;k[w]=x;e[x.image.id]=x;o.push(x);b()}return x},resetLoadingQueue:function(){m=[]}};setInterval(function(){for(var w=(new Date).getTime(),u=false,x=0,y=TILE5.Device.getConfig();x<
m.length;)if(w-m[x].requested>g.loadTimeout*1E3){m.splice(x,1);u=true}else x++;u&&b();if(y&&y.imageCacheMaxSize){s=n.length*g.avgImageSize/y.imageCacheMaxSize;s>=1&&h()}},1E3);return v}(),g={avgImageSize:25,loadTimeout:10,Cache:function(){return{read:function(){return null},write:function(){},getUrlCacheKey:function(a,b){for(var d=(a?a.replace(/^.*\?/,""):"").split("&"),h=a?a.replace(/\?.*$/,"?"):"",k=0;k<d.length;k++){var e=d[k].split("=");if(!b||!b.test(e[0]))h+=d[k]+"&"}return h.replace(/\W/g,
"")},isValidCacheKey:function(a){GRUNT.Log.info("cache key = "+a);return false}}}(),addInterceptor:l.addInterceptor,getPath:function(a){return/^(file|https?|\/)/.test(a)?a:t+a},setBasePath:function(a){t=a},getImage:function(a){return l.getImage(a)},loadImage:function(a,b){l.loadImage(a,b)},resetImageLoadQueue:function(){l.resetLoadingQueue()},getStats:function(){return{imageLoadingCount:l.loadingImages.length,queuedImageCount:l.queuedImages.length,imageCacheFullness:l.getCacheFullness()}},loadResource:function(a){a=
GRUNT.extend({filename:"",cacheable:true,dataType:null,callback:null},a);var b=function(d){a.callback&&GRUNT.Log.watch("CALLING RESOURCE CALLBACK",function(){a.callback(d)})};a.cacheable&&r[a.filename]?b(r[a.filename]):GRUNT.XHR.ajax({url:g.getPath(a.filename),dataType:a.dataType,success:function(d){if(a.cacheable)r[a.filename]=d;b(d)},error:function(d,h,k){GRUNT.Log.error("error loading resource ["+a.filename+"], error = "+k)}})},loadSnippet:function(a,b){/\.\w+$/.test(a)||(a+=".html");g.loadResource({filename:"snippets/"+
a,callback:b,dataType:"html"})}};return g}();
TILE5.Touch=function(){function t(n,p){var s=n&&n.length>0?n[0]:null;if(s&&p&&p.length>0)return TILE5.V.diff(s,p[0]);return null}function r(n){n.preventDefault();n.stopPropagation()}function l(n){for(var p=Array(n.length),s=n.length;s--;)p[s]=new TILE5.Vector(n[s].pageX,n[s].pageY);return p}function g(n){return[new TILE5.Vector(n.pageX,n.pageY)]}var a=120,b=100,d=250,h={TAP:0,MOVE:1,PINCHZOOM:2},k=7,e=0,f=0,o={TouchHelper:function(n){function p(B,D,J,M){var P=Math.asin((B.y-D.y)/J);J=Math.min(Math.floor(J*
(Z.duration/M)),Z.max);P=D.x>B.x?P:Math.PI-P;B=new TILE5.Vector(Math.cos(P)*-J,Math.sin(P)*J);v("inertiaPan",B.x,B.y)}function s(B,D){var J,M;if(G){J=D-ba;if(J<d){M=TILE5.V.distance([I[0],B]);M>n.inertiaTrigger&&p(I[0],B,M,J)}}else{T=B;var P=setInterval(function(){J=(new Date).getTime()-D;M=TILE5.V.distance([B,T]);if(J<b&&M>n.inertiaTrigger){clearInterval(P);p(B,T,M,J)}else J>b&&clearInterval(P)},5)}}function q(B){for(var D=[],J=n.element?-n.element.offsetLeft:0,M=n.element?-n.element.offsetTop:0,
P=B.length;P--;)D.push(TILE5.V.offset(B[P],J,M));return D}function v(){n.observable&&n.observable.trigger.apply(null,arguments)}function w(B){if(B.target&&B.target===n.element){I=G?l(B.touches):g(B);N=new TILE5.Vector;S=new TILE5.Vector;U=true;A=false;ba=TILE5.Clock.getTime();G&&r(B);v("inertiaCancel");$.current=ba;if(B=I.length>0?I[0]:null){v("touchStart",B.x,B.y);if($.current-$.last<W.THRESHOLD_DOUBLETAP)if((B=H?TILE5.V.diff(I[0],H[0]):null)&&Math.abs(B.x)<n.maxDistDoubleTap&&Math.abs(B.y)<n.maxDistDoubleTap)A=
true;R=h.TAP;H=[].concat(I)}else GRUNT.Log.warn("Touch start fired, but no touch vector found")}}function u(B){if(B.target&&B.target===n.element){T=(G?l(B.touches):g(B))[0];if(U)try{G&&r(B);var D=G?l(B.touches):g(B);B=0;if(D.length>1){if(I.length===1)I=[].concat(D);B=TILE5.V.distance(I)-TILE5.V.distance(D)}if(R===h.TAP){var J=t(D,I);if(J&&(Math.abs(J.x)>=k||Math.abs(J.y)>=k))R=h.MOVE}if(R!==h.TAP)if(!B||Math.abs(B)<n.pinchZoomThreshold){if(N=t(D,H)){S.x-=N.x;S.y-=N.y;Q.x-=N.x;Q.y-=N.y}if(TILE5.V.absSize(Q)>
n.panEventThreshhold){v("pan",Q.x,Q.y);Q=TILE5.V.create()}R=h.MOVE}else{v("pinchZoom",q(I),q(D));R=h.PINCHZOOM}H=[].concat(D)}catch(M){GRUNT.Log.exception(M)}}}function x(B){if(B.target&&B.target===n.element){var D=(G?l(B.changedTouches):g(B))[0];try{G&&r(B);var J=TILE5.Clock.getTime();$.last=$.current;if(R===h.TAP)E||(E=setTimeout(function(){E=0;var P=A?"doubleTap":"tap",V=I[0],da=null;if(n.element)da=TILE5.V.offset(V,-n.element.offsetLeft,-n.element.offsetTop);v(P,V,da)},W.THRESHOLD_DOUBLETAP+50));
else if(R==h.MOVE){v("panEnd",S.x,S.y);Z&&s(D,J)}else R==h.PINCHZOOM&&v("pinchZoomEnd",q(I),q(H))}catch(M){GRUNT.Log.exception(M)}}U=false}function y(B){if(B.target&&B.target===n.element){var D;if(B.detail){D=-B.detail*a;D=new TILE5.Vector(B.axis===1?D:0,B.axis===2?D:0)}else D=new TILE5.Vector(B.wheelDeltaX,B.wheelDeltaY);var J=D.y!==0?Math.abs(D.y/a):0;if(T&&J!==0){var M=TILE5.V.offset(T,-n.element.offsetLeft,-n.element.offsetTop);v("wheelZoom",M,Math.pow(2,D.y>0?J:-J))}B.preventDefault()}}n=GRUNT.extend({element:null,
observable:null,inertiaTrigger:20,maxDistDoubleTap:20,panEventThreshhold:0,pinchZoomThreshold:5,touchStartHandler:null,moveHandler:null,moveEndHandler:null,pinchZoomHandler:null,pinchZoomEndHandler:null,tapHandler:null,doubleTapHandler:null,wheelZoomHandler:null},n);var A=false,E=0,G=TILE5.Device.getConfig().supportsTouch,I=null,H=null,N=null,S=null,Q=new TILE5.Vector,R=null,U=false,ba=0,Y=[],T=null,Z=null,$={current:0,last:0},O=TILE5.Device.getConfig(),W={supportsTouch:G,THRESHOLD_DOUBLETAP:300,
addListeners:function(B){Y.push(B)},decoupleListeners:function(B){for(var D=0;B&&D<Y.length;D++)if(Y[D].listenerId===B){Y.splice(D,1);GRUNT.Log.info("successfully decoupled touch listener: "+B);break}},release:function(){O.eventTarget.removeEventListener(O.supportsTouch?"touchstart":"mousedown",w,false);O.eventTarget.removeEventListener(O.supportsTouch?"touchmove":"mousemove",u,false);O.eventTarget.removeEventListener(O.supportsTouch?"touchend":"mouseup",x,false);if(!O.supportsTouch){window.removeEventListener("mousewheel",
y,false);window.removeEventListener("DOMMouseScroll",y,false)}},inertiaEnable:function(B,D){Z={duration:B,max:D?Math.min(D.width,D.height):500}},inertiaDisable:function(){Z=null}};O.eventTarget.addEventListener(O.supportsTouch?"touchstart":"mousedown",w,false);O.eventTarget.addEventListener(O.supportsTouch?"touchmove":"mousemove",u,false);O.eventTarget.addEventListener(O.supportsTouch?"touchend":"mouseup",x,false);if(!O.supportsTouch){window.addEventListener("mousewheel",y,false);window.addEventListener("DOMMouseScroll",
y,false)}return W}},m=[];return{captureTouch:function(n,p){if(!n)throw Error("Unable to capture touch of null element");if(!n.id)n.id="touchable_"+e++;var s=m[n.id];if(!s){s=o.TouchHelper(GRUNT.extend({element:n},p));m[n.id]=s;GRUNT.Log.info("CREATED TOUCH HELPER. SUPPORTS TOUCH = "+s.supportsTouch)}p.listenerId&&s.decoupleListeners(p.listenerId);p.listenerId=++f;s.addListeners(p);return s},resetTouch:function(n){if(n&&n.id&&m[n.id]){m[n.id].release();delete m[n.id]}}}}();
if(typeof jQuery!=="undefined"){jQuery.fn.canTouchThis=function(t){return this.each(function(){TILE5.Touch.captureTouch(this,t)})};jQuery.fn.untouchable=function(){return this.bind("touchmove",function(t){t.preventDefault()})}}
TILE5.Dispatcher=function(){var t=[],r={execute:function(l){var g=r.findAction(l);GRUNT.Log.info("looking for action id: "+l+", found: "+g);if(g){var a=[].concat(arguments).slice(0,1);GRUNT.Log.watch("EXECUTING ACTION: "+l,function(){g.execute(a)})}},findAction:function(l){for(var g=t.length;g--;)if(t[g].id==l)return t[g];return null},getRegisteredActions:function(){return[].concat(t)},getRegisteredActionIds:function(){for(var l=[],g=t.length;g--;)t[g].id&&l.push(t[g].id);return l},registerAction:function(l){l&&
l.id&&t.push(l)},Action:function(l){l=GRUNT.extend({autoRegister:true,id:"",title:"",icon:"",execute:null},l);var g={id:l.id,execute:function(){l.execute&&l.execute.apply(this,arguments)},getParam:function(a){return l[a]?l[a]:""},toString:function(){return String.format("{0} [title = {1}, icon = {2}]",g.id,l.title,l.icon)}};l.autoRegister&&r.registerAction(g);return g},createAgent:function(l){l=GRUNT.extend({name:"Untitled",trashOrphanedResults:true,translator:null,execute:null},l);var g=null,a={getName:function(){return l.name},
getParam:function(b){return l[b]},getId:function(){return GRUNT.toID(a.getName())},run:function(b,d){if(l.execute){var h=g=TILE5.Clock.getTime(true),k=l.translator?l.translator(b):b;l.execute.call(a,k,function(e,f){if(!l.trashOrphanedResults||h==g)d&&d(e,f,k)})}}};return a},runAgents:function(l,g,a){for(var b=0;b<l.length;b++)l[b].run(g,a)}};return r}();
TILE5.Animation=function(){function t(){if(g===0)g=setInterval(function(){var b;b=TILE5.Clock.getTime();if(!l){l=true;try{for(var d=0;d<r.length;)if(r[d].isComplete()){r[d].triggerComplete(false);r.splice(d,1);GRUNT.WaterCooler.say("animation.complete")}else{r[d].update(b);d++}}finally{l=false}}b=r.length;if(b===0){clearInterval(g);g=0}},20)}var r=[],l=false,g=0,a={DURATION:2E3,tweenValue:function(b,d,h,k,e){b=new a.Tween({startValue:b,endValue:d,tweenFn:h,complete:k,duration:e});r.push(b);return b},
tween:function(b,d,h,k,e,f){b=new a.Tween({target:b,property:d,endValue:h,tweenFn:k,duration:f,complete:e});r.push(b);return b},tweenVector:function(b,d,h,k,e,f){var o=[];if(b){var m=b.x==d,n=b.y==h;m||o.push(a.tween(b,"x",d,k,function(){(m=true)&&n&&e()},f));n||o.push(a.tween(b,"y",h,k,function(){n=true;m&&n&&e()},f))}return o},cancel:function(b){if(!l){l=true;try{for(var d=0;d<r.length;)if(!b||b(r[d])){r[d].triggerComplete(true);r.splice(d,1)}else d++}finally{l=false}}},isTweening:function(){return r.length>
0},Tween:function(b){b=GRUNT.extend({target:null,property:null,startValue:0,endValue:null,duration:a.DURATION,tweenFn:a.DEFAULT,complete:null,cancelOnInteract:false},b);var d=TILE5.Clock.getTime(),h=[],k=false,e=0,f=0,o={cancelOnInteract:b.cancelOnInteract,isComplete:function(){return k},triggerComplete:function(m){b.complete&&b.complete(m)},update:function(m){try{var n=b.tweenFn(m-d,e,f,b.duration);if(b.target)b.target[b.property]=n;for(var p=h.length;p--;)h[p](n,void 0);if(k=d+b.duration<=m){if(b.target)b.target[b.property]=
b.tweenFn(b.duration,e,f,b.duration);for(var s=h.length;s--;)h[s](n,true)}}catch(q){GRUNT.Log.exception(q)}},requestUpdates:function(m){h.push(m)}};e=b.target&&b.property&&b.target[b.property]?b.target[b.property]:b.startValue;if(typeof b.endValue!=="undefined")f=b.endValue-e;if(f==0)k=true;t();return o},Easing:function(){var b=1.70158;return{Linear:function(d,h,k,e){return k*d/e+h},Back:{In:function(d,h,k,e){return k*(d/=e)*d*((b+1)*d-b)+h},Out:function(d,h,k,e){return k*((d=d/e-1)*d*((b+1)*d+b)+
1)+h},InOut:function(d,h,k,e){return(d/=e/2)<1?k/2*d*d*(((b*=1.525)+1)*d-b)+h:k/2*((d-=2)*d*(((b*=1.525)+1)*d+b)+2)+h}},Bounce:{In:function(d,h,k,e){return k-a.Easing.Bounce.Out(e-d,0,k,e)+h},Out:function(d,h,k,e){return(d/=e)<1/2.75?k*7.5625*d*d+h:d<2/2.75?k*(7.5625*(d-=1.5/2.75)*d+0.75)+h:d<2.5/2.75?k*(7.5625*(d-=2.25/2.75)*d+0.9375)+h:k*(7.5625*(d-=2.625/2.75)*d+0.984375)+h},InOut:function(d,h,k,e){return d<e/2?a.Easing.Bounce.In(d*2,0,k,e)/2+h:a.Easing.Bounce.Out(d*2-e,0,k,e)/2+k/2+h}},Cubic:{In:function(d,
h,k,e){return k*(d/=e)*d*d+h},Out:function(d,h,k,e){return k*((d=d/e-1)*d*d+1)+h},InOut:function(d,h,k,e){if((d/=e/2)<1)return k/2*d*d*d+h;return k/2*((d-=2)*d*d+2)+h}},Elastic:{In:function(d,h,k,e,f,o){if(d==0)return h;if((d/=e)==1)return h+k;o||(o=e*0.3);if(!f||f<Math.abs(k)){f=k;k=o/4}else k=o/(2*Math.PI)*Math.asin(k/f);return-(f*Math.pow(2,10*(d-=1))*Math.sin((d*e-k)*2*Math.PI/o))+h},Out:function(d,h,k,e,f,o){var m;if(d==0)return h;if((d/=e)==1)return h+k;o||(o=e*0.3);if(!f||f<Math.abs(k)){f=
k;m=o/4}else m=o/(2*Math.PI)*Math.asin(k/f);return f*Math.pow(2,-10*d)*Math.sin((d*e-m)*2*Math.PI/o)+k+h},InOut:function(d,h,k,e,f,o){var m;if(d==0)return h;if((d/=e/2)==2)return h+k;o||(o=e*0.3*1.5);if(!f||f<Math.abs(k)){f=k;m=o/4}else m=o/(2*Math.PI)*Math.asin(k/f);if(d<1)return-0.5*f*Math.pow(2,10*(d-=1))*Math.sin((d*e-m)*2*Math.PI/o)+h;return f*Math.pow(2,-10*(d-=1))*Math.sin((d*e-m)*2*Math.PI/o)*0.5+k+h}},Quad:{In:function(d,h,k,e){return k*(d/=e)*d+h},Out:function(d,h,k,e){return-k*(d/=e)*(d-
2)+h},InOut:function(d,h,k,e){if((d/=e/2)<1)return k/2*d*d+h;return-k/2*(--d*(d-2)-1)+h}},Sine:{In:function(d,h,k,e){return-k*Math.cos(d/e*(Math.PI/2))+k+h},Out:function(d,h,k,e){return k*Math.sin(d/e*(Math.PI/2))+h},InOut:function(d,h,k,e){return-k/2*(Math.cos(Math.PI*d/e)-1)+h}}}}()};return GRUNT.extend(a,{DEFAULT:a.Easing.Back.Out})}();TILE5.Border={NONE:0,TOP:1,RIGHT:2,BOTTOM:3,LEFT:4};
TILE5.Graphics=function(){var t={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,PINCHZOOM:16,FREEZE:128},r=0,l={DisplayState:t,AnyDisplayState:255,ActiveDisplayStates:t.ACTIVE|t.ANIMATING,DefaultDisplayStates:t.ACTIVE|t.ANIMATING|t.PAN|t.PINCHZOOM,ViewLayer:function(g){g=GRUNT.extend({id:"",centerOnScale:true,created:(new Date).getTime(),scalePosition:true,zindex:0,supportFastDraw:false,validStates:l.DefaultDisplayStates},g);var a=null,b=g.id,d=GRUNT.extend({addToView:function(h){h.setLayer(b,d)},shouldDraw:function(h){var k=
a?a.fastDraw&&h!==t.ACTIVE:false;return(h&g.validStates)!==0&&(k?g.supportFastDraw:true)},cycle:function(){return 0},draw:function(){},remove:function(){GRUNT.WaterCooler.say("layer.remove",{id:b})},wakeParent:function(){GRUNT.WaterCooler.say("view.wake",{id:a?a.id:null})},getId:function(){return b},setId:function(h){b=h},getParent:function(){return a},setParent:function(h){a=h}},g);return d},AnimatedPathLayer:function(g){function a(f,o,m){f.fillStyle="#FFFFFF";f.strokeStyle="#222222";f.beginPath();
f.arc(m.x,m.y,4,0,Math.PI*2,false);f.stroke();f.fill()}g=GRUNT.extend({path:[],id:GRUNT.generateObjectID("pathAnimation"),easing:TILE5.Animation.Easing.Sine.InOut,validStates:l.ActiveDisplayStates|t.PAN|t.PINCHZOOM,drawIndicator:null,duration:2E3,autoCenter:false},g);var b=TILE5.V.edges(g.path),d,h=null,k=0;TILE5.Animation.tweenValue(0,b.total,g.easing,function(){e.remove()},g.duration).requestUpdates(function(f,o){k=f;o&&e.remove()});var e=GRUNT.extend(new l.ViewLayer(g),{cycle:function(){for(var f=
0;f<b.accrued.length&&b.accrued[f]<k;)f++;h=null;if(f<g.path.length-1){var o=k-(f>0?b.accrued[f-1]:0),m=g.path[f],n=g.path[f+1];d=TILE5.V.theta(m,n,b.edges[f]);h=TILE5.V.pointOnEdge(m,n,d,o);if(g.autoCenter)(f=e.getParent())&&f.centerOn(h)}return h?1:0},draw:function(f,o){if(h)(g.drawIndicator?g.drawIndicator:a)(f,o,new TILE5.Vector(h.x-o.x,h.y-o.y),d)}});return e},View:function(g){function a(z,C,F,K){S=typeof F!=="undefined";L.updateOffset(v.x+z,v.y+C,F,K);n();V=t.PAN}function b(){V=t.ACTIVE;S=false;
setTimeout(n,50)}function d(z,C){W=TILE5.V.getRect(z);B=TILE5.V.getRect(C);var F=TILE5.D.getSize(W.dimensions),K=TILE5.D.getSize(B.dimensions);P=TILE5.R.getCenter(W);H=TILE5.R.getCenter(B);D=W&&F!==0?K/F:1}function h(){GRUNT.WaterCooler.say("view.scale",{id:L.id});O=false;L.trigger("scale",D,W?e():H);V=l.DisplayState.ACTIVE;D=1;n()}function k(z,C){C.setId(z);C.setParent(L);p.push(C);p.sort(function(F,K){var X=K.zindex-F.zindex;if(X===0)X=K.created-F.created;return X})}function e(){var z=TILE5.D.getCenter(A),
C=TILE5.V.distance([H,z]),F=TILE5.V.theta(H,z,C),K=TILE5.V.diff(P,H);z=TILE5.V.pointOnEdge(H,z,F,C/D);z.x+=K.x;z.y+=K.y;return z}function f(){GRUNT.WaterCooler.say("view.idle",{id:L.id});N=true;U=0}function o(z,C){var F=0,K=L.getDisplayState(),X=(new Date).getTime(),ca=(K&t.PINCHZOOM)!==0,aa=0;if(w||ca){z.clearRect(0,0,s.width,s.height);w=false}if(ca){TILE5.D.getCenter(A);var fa=(J?J:1)/2,ea=TILE5.V.diff(P,H);if(Y=W?new TILE5.Vector(H.x+ea.x,H.y+ea.y):new TILE5.Vector(H.x-ea.x*fa,H.y-ea.y*fa))C=TILE5.V.offset(C,
Y.x,Y.y)}z.save();try{if(y!==1)z.scale(y,y);else if(ca){z.translate(H.x,H.y);z.scale(D,D)}for(aa=p.length;aa--;)if(p[aa].shouldDraw(K)){var ga=p[aa].draw(z,C,A,K,L);F+=ga?ga:0}}finally{z.restore()}GRUNT.Log.trace("draw complete",X);R=false;return F}function m(){var z=0,C=!S&&(V===t.PINCHZOOM||V===t.PAN);T=(new Date).getTime();v.x=Math.floor(v.x);v.y=Math.floor(v.y);I&&u&&I.delays.push(T-u);if(C){TILE5.Animation.cancel(function(K){return K.cancelOnInteract});N=false;if(U!==0){clearTimeout(U);U=0}}for(C=
p.length;C--;){var F=p[C].cycle(T,v,V);z+=F?F:0}if(u+$<T){z+=o(q,v);u=T}Q=0;if(G+z>0)n();else if(!N&&U===0)U=setTimeout(f,500);GRUNT.Log.trace("Completed draw cycle",T)}function n(){G++;if(!(x||Q!==0)){G=0;Q=setTimeout(m,0)}}g=GRUNT.extend({id:"view_"+r++,container:"",clearOnDraw:false,scaleDamping:false,fastDraw:false,fillStyle:"rgb(200, 200, 200)",initialDrawMode:"source-over",bufferRefresh:100,defaultFreezeDelay:500,inertialScroll:true,panAnimationEasing:TILE5.Animation.Easing.Sine.Out,panAnimationDuration:750,
autoSize:false},g);var p=[],s=document.getElementById(g.container),q=null,v=new TILE5.Vector,w=false,u=null,x=false,y=1,A=null,E=null,G=0,I=null,H=null,N=false,S=false,Q=0,R=false,U=0,ba=0,Y=null,T=0,Z=TILE5.Device.getConfig().targetFps,$=0,O=false,W=null,B=null,D=1,J=null,M=null,P=null;E=null;var V=l.DisplayState.ACTIVE;if(s){TILE5.Touch.resetTouch(s);if(g.autoSize){s.height=window.innerHeight-s.offsetTop;s.width=window.innerWidth-s.offsetLeft}try{q=s.getContext("2d");q.globalCompositeOperation=
g.initialDrawMode;q.clearRect(0,0,s.width,s.height)}catch(da){GRUNT.Log.exception(da);throw Error("Could not initialise canvas on specified view element");}}var L=GRUNT.extend({},g,new GRUNT.Observable,{id:g.id,deviceScaling:y,fastDraw:g.fastDraw||TILE5.Device.getConfig().requireFastDraw,animate:function(z,C,F,K,X){function ca(){X&&X();h();D=1;J=null}O=true;P=TILE5.V.copy(C);H=TILE5.V.copy(F);W=null;if(K){M=D;TILE5.Animation.tweenValue(0,z-M,K,ca,1E3).requestUpdates(function(aa){J=aa/(z-M);D=M+aa;
V=l.DisplayState.PINCHZOOM;n();L.trigger("animate")})}else{D=z;ca()}},centerOn:function(z){L.setOffset(z.x-s.width/2,z.y-s.height/2)},getDimensions:function(){if(s)return new TILE5.Dimensions(s.width,s.height)},getZoomCenter:function(){return Y},getLayer:function(z){for(var C=0;C<p.length;C++)if(p[C].getId()==z)return p[C];return null},setLayer:function(z,C){for(var F=0;F<p.length;F++)if(p[F].getId()===z){p.splice(F,1);break}C&&k(z,C);GRUNT.WaterCooler.say("layer.update",{id:z});n()},eachLayer:function(z){for(var C=
0;C<p.length;C++)z(p[C])},clearBackground:function(){w=true},freeze:function(){x=true},unfreeze:function(){x=false;n()},needRepaint:function(){return R},snapshot:function(){},getDisplayState:function(){return x?t.FROZEN:V},scale:function(z,C,F,K,X){K||(K=TILE5.D.getCenter(A));X||(X=TILE5.D.getCenter(A));L.animate(z,K,X,C,F);return L},removeLayer:function(z){a:{for(var C=p.length;C--;)if(p[C].getId()==z){z=C;break a}z=-1}if(z>=0&&z<p.length){GRUNT.WaterCooler.say("layer.removed",{layer:p[z]});p.splice(z,
1)}},getOffset:function(){return TILE5.V.copy(v)},setOffset:function(z,C){v.x=z;v.y=C},updateOffset:function(z,C,F,K){if(F){z=new TILE5.Vector(z,C);F=TILE5.Animation.tweenVector(v,z.x,z.y,F,function(){b(0,0)},K);for(K=F.length;K--;){F[K].cancelOnInteract=true;F[K].requestUpdates(function(){n();g.onAnimate&&g.onAnimate(v.x,v.y)})}}else L.setOffset(z,C)},zoom:function(z,C,F){S=false;D=C;O=D!==1;P=TILE5.D.getCenter(L.getDimensions());H=D>1?TILE5.V.copy(z):TILE5.D.getCenter(L.getDimensions());W=null;
clearTimeout(ba);if(O){V=l.DisplayState.PINCHZOOM;n();if(F)ba=setTimeout(h,parseInt(F,10))}}});A=L.getDimensions();E=TILE5.D.getCenter(A);if(Z)$=Math.ceil(1E3/Z);GRUNT.WaterCooler.listen("layer.remove",function(z){z.id&&L.removeLayer(z.id)});GRUNT.WaterCooler.listen("view.wake",function(z){if(!z.id||z.id===L.id)n()});y=TILE5.Device.getConfig().getScaling();L.bind("invalidate",function(){R=true});E=TILE5.Touch.captureTouch(s,{observable:L});L.bind("pan",a);L.bind("panEnd",b);L.bind("pinchZoom",function(z,
C){d(z,C);if(O=D!==1){V=l.DisplayState.PINCHZOOM;n()}});L.bind("pinchZoomEnd",function(z,C){d(z,C);h();D=1});L.bind("wheelZoom",function(z,C){L.zoom(z,Math.min(Math.pow(2,Math.round(Math.log(C))),8),500)});g.inertialScroll&&E.inertiaEnable(g.panAnimationDuration,A);L.bind("inertiaPan",function(z,C){g.inertialScroll&&a(z,C,g.panAnimationEasing,g.panAnimationDuration)});L.bind("inertiaCancel",function(){S=false;n()});n();return L}};return l}();
TILE5.Tiling=function(){function t(){if(!l){l=TILE5.newCanvas(a.Config.TILESIZE,a.Config.TILESIZE);var b=l.getContext("2d");b.fillStyle="rgba(150, 150, 150, 0.01)";b.fillRect(0,0,l.width,l.height)}return l}function r(){function b(){var h=TILE5.newCanvas(32,32),k=h.getContext("2d");k.fillStyle="#BBBBBB";k.fillRect(0,0,32,32);k.fillStyle="#C3C3C3";k.fillRect(0,0,16,16);k.fillRect(16,16,16,16);return h}if(!g){g=TILE5.newCanvas(a.Config.TILESIZE,a.Config.TILESIZE);var d=g.getContext("2d");d.fillStyle=
d.createPattern(b(),"repeat");d.fillRect(0,0,g.width,g.height)}return g}TileStore=function(b){b=GRUNT.extend({tileSize:null,gridSize:25,center:new TILE5.Vector,onPopulate:null},b);if(!b.tileSize)throw Error("Cannot create TileStore with an empty tile size");var d=Array(Math.pow(b.gridSize,2)),h=TILE5.V.offset(b.center,-Math.ceil(b.gridSize>>1)),k=null,e=new TILE5.Vector,f=null,o={getGridSize:function(){return b.gridSize},getNormalizedPos:function(m,n){return TILE5.V.add(new TILE5.Vector(m,n),TILE5.V.invert(h),
e)},getTileShift:function(){return TILE5.V.copy(e)},getTile:function(m,n){return m>=0&&m<b.gridSize?d[n*b.gridSize+m]:null},setTile:function(m,n,p){d[n*b.gridSize+m]=p},populate:function(m,n){var p=GRUNT.Log.getTraceTicks(),s=0,q=b.gridSize,v=b.tileSize;new TILE5.Vector(q/2,q/2);if(m)for(var w=0;w<q;w++)for(var u=0;u<q;u++){if(!d[s]){var x=m(u,w,h,q);x.gridX=u*v-e.x;x.gridY=w*v-e.y;d[s]=x}s++}k=m;f=n;GRUNT.Log.trace("tile grid populated",p);b.onPopulate&&b.onPopulate()},getShiftDelta:function(m,n,
p,s){var q=Math.floor(b.gridSize*0.2),v=new TILE5.Vector;if(m<0||m+p>b.gridSize)v.x=m<0?-q:q;if(n<0||n+s>b.gridSize)v.y=n<0?-q:q;return v},shift:function(m,n){if(!(m.x===0&&m.y===0)){var p=GRUNT.Log.getTraceTicks(),s=Array(d.length);s.length=d.length;for(var q=0;q<b.gridSize;q++)for(var v=0;v<b.gridSize;v++)s[v*b.gridSize+q]=o.getTile(q+m.x,v+m.y);d=s;h=n?n(h,m):TILE5.V.add(h,m);e.x+=-m.x*b.tileSize;e.y+=-m.y*b.tileSize;GRUNT.Log.trace("tile storage shifted",p);o.populate(k,f)}},setOrigin:function(m,
n){if(tileOrigin)shiftOrigin(m,n);else h=TILE5.V.offset(new TILE5.Vector(m,n),-tileHalfWidth)}};GRUNT.WaterCooler.listen("imagecache.cleared",function(){for(var m=d.length;m--;)if(d[m])d[m].loaded=false});GRUNT.WaterCooler.listen("tiler.repaint",function(){for(var m=d.length;m--;)if(d[m]){d[m].x=null;d[m].y=null}});return o};var l=null,g=null,a={Config:{TILESIZE:256,TILEBUFFER:1,TILEBUFFER_LOADNEW:0.2},Tile:function(b){return b=GRUNT.extend({gridX:0,gridY:0,size:256,dirty:false},b)},ImageTile:function(b){b=
GRUNT.extend({url:"",sessionParamRegex:null,loaded:false},b);return new a.Tile(b)},TileGrid:function(b){function d(x,y){if(w){var A,E=[],G=new TILE5.Vector(Math.floor((x.x+p.x)*e),Math.floor((x.y+p.y)*e));tilesNeeded=false;for(var I=v;I--;)for(var H=q;H--;){A=h.getTile(H+G.x,I+G.y);var N=new TILE5.Vector(H-w.x,I-w.y);A||(n=h.getShiftDelta(G.x,G.y,q,v));E.push({tile:A,centerness:TILE5.V.absSize(N)})}E.sort(function(S,Q){return Q.centerness-S.centerness});o||(o=Array(E.length));for(A=E.length;A--;){o[A]=
E[A].tile;u.prepTile(o[A],y)}}}b=GRUNT.extend({tileSize:TILE5.Tiling.Config.TILESIZE,drawGrid:false,center:new TILE5.Vector,shiftOrigin:null,supportFastDraw:true},b);var h=new TileStore(GRUNT.extend({tileSize:b.tileSize,onPopulate:function(){u.dirty=true;u.wakeParent()}},b)),k=Math.round(b.tileSize/2),e=b.tileSize?1/b.tileSize:0,f=true,o=null,m=false;new TILE5.Vector;var n=new TILE5.Vector,p=new TILE5.Vector;TILE5.Device.getConfig();var s=h.getGridSize()*b.tileSize,q,v,w,u=GRUNT.extend(new TILE5.Graphics.ViewLayer(b),
{gridDimensions:new TILE5.Dimensions(s,s),dirty:false,cycle:function(x,y,A){x=0;if(n.x+n.y!==0){h.shift(n,b.shiftOrigin);p=h.getTileShift();n=new TILE5.Vector;x++}A!==TILE5.Graphics.DisplayState.PINCHZOOM&&d(y,A);return x+u.dirty?1:0},deactivate:function(){f=false},prepTile:function(){},drawTile:function(){return false},draw:function(x,y,A,E,G){if(f){var I=(new Date).getTime(),H=y.x;y=y.y;var N=true,S=G.needRepaint()||E===TILE5.Graphics.DisplayState.PANNING||E===TILE5.Graphics.DisplayState.PINCHZOOM||
TILE5.Animation.isTweening();if(!w){q=Math.ceil(A.width*e)+1;v=Math.ceil(A.height*e)+1;w=new TILE5.Vector(Math.floor((q-1)/2),Math.floor((v-1)/2))}if(o){if(b.drawGrid)x.strokeStyle="rgba(50, 50, 50, 0.3)";x.beginPath();for(A=o.length;A--;){var Q=o[A];if(Q){var R=Q.gridX-H,U=Q.gridY-y;N=((S?false:!Q.dirty)?true:u.drawTile(x,Q,R,U,E))&&N}else N=false;b.drawGrid&&x.rect(R,U,b.tileSize,b.tileSize)}x.stroke();GRUNT.Log.trace("drawn tiles",I);N&&!m&&G.trigger("tileDrawComplete");m=N;u.dirty=false}}},getTileVirtualXY:function(x,
y,A){x=h.getNormalizedPos(x,y);x=new TILE5.Vector(x.x*b.tileSize,x.y*b.tileSize);if(A){x.x+=k;x.y+=k}return x},populate:function(x){h.populate(x,function(){})}});return u},ImageTileGrid:function(b){function d(){m.getParent().trigger("invalidate");m.dirty=true;m.wakeParent()}b=GRUNT.extend({},b);var h=t(),k=r(),e=TILE5.Graphics.DisplayState.ACTIVE,f=TILE5.Graphics.DisplayState.PAN,o=TILE5.Device.getConfig().requireFastDraw,m=GRUNT.extend(new a.TileGrid(b),{drawTile:function(n,p,s,q,v){var w=TILE5.Resources.getImage(p.url),
u=false;if(w&&w.complete&&w.width>0){n.drawImage(w,s,q);p.dirty=false;u=true}else v===f?n.drawImage(k,s,q):n.drawImage(h,s,q);return u},prepTile:function(n,p){if(n)n.dirty=true;if(n&&(!o||p===e))TILE5.Resources.getImage(n.url)||TILE5.Resources.loadImage(n.url,d)}});return m},Tiler:function(b){b=GRUNT.extend({container:"",drawCenter:false,datasources:{},tileLoadThreshold:"first"},b);var d=new TILE5.Graphics.View(GRUNT.extend({},b,{pannable:true,scalable:true,scaleDamping:true}));GRUNT.extend(d,{getTileLayer:function(){return d.getLayer("grid0")},
setTileLayer:function(h){d.setLayer("grid0",h);GRUNT.WaterCooler.say("grid.updated",{id:"grid0"})},viewPixToGridPix:function(h){var k=d.getOffset();return new TILE5.Vector(h.x+k.x,h.y+k.y)},cleanup:function(){d.removeLayer("grid0")},repaint:function(){GRUNT.WaterCooler.say("tiler.repaint");GRUNT.WaterCooler.say("view.wake",{id:d.id})}});return d}};return a}();
TILE5.Geo=function(){function t(e,f){var o=null;for(var m in h)if(f){if(m==f&&h[m][e]){o=h[m];break}}else if(h[m][e]){o=h[m];break}return o}function r(e,f,o,m){var n=0;e=e.toUpperCase();for(var p in m){var s=f[p];if(s){var q=o[p];s=q?q(e,s):e.containsWord(s)?1:0;n+=s*m[p]}}return n}var l=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],g=Math.PI/180,a=180/Math.PI,b=null,d={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",HWY:"HIGHWAY",
MWY:"MOTORWAY"},h={},k={Engine:function(e){if(!e.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var f=GRUNT.extend({remove:function(){delete h[f.id]}},e);return h[f.id]=f},Radius:function(e,f){return{distance:parseInt(e,10),uom:f}},Position:function(e,f){return{lat:parseFloat(e?e:0),lon:parseFloat(f?f:0)}},BoundingBox:function(e,f){return{min:k.P.parse(e),max:k.P.parse(f)}},Address:function(e){return e=GRUNT.extend({streetDetails:"",location:"",country:"",postalCode:"",
pos:null,boundingBox:null},e)},GeocodeFieldWeights:{streetDetails:50,location:50},AddressCompareFns:{},Utilities:function(){var e={dist2rad:function(f){return f/6371},lat2pix:function(f,o){var m=parseFloat(f)*2*Math.PI/360;m=Math.sin(m);var n=0.08181919084262157*m;return Math.log((1+m)/(1-m)*Math.pow((1-n)/(1+n),0.08181919084262157))/2/o},lon2pix:function(f,o){return parseFloat(f)/180*Math.PI/o},pix2lon:function(f,o){return e.normalizeLon(f*o*180/Math.PI)},pix2lat:function(f,o){for(var m=Math.pow(Math.E,
-f*o),n=e.mercatorUnproject(m),p=e.findRadPhi(n,m),s=0;s<12&&Math.abs(n-p)>1.0E-7;){n=p;p=e.findRadPhi(n,m);s++}return p*180/Math.PI},mercatorUnproject:function(f){return Math.PI/2-2*Math.atan(f)},findRadPhi:function(f,o){var m=0.08181919084262157*Math.sin(f);return Math.PI/2-2*Math.atan(o*Math.pow((1-m)/(1+m),0.040909595421310785))},normalizeLon:function(f){for(;f<-180;)f+=360;for(;f>180;)f-=360;return f}};return e}(),GeoSearchResult:function(e){e=GRUNT.extend({id:null,caption:"",resultType:"",data:null,
pos:null,matchWeight:0},e);return GRUNT.extend(e,{toString:function(){return e.caption+(e.matchWeight?" ("+e.matchWeight+")":"")}})},GeoSearchAgent:function(e){return TILE5.Dispatcher.createAgent(e)},GeocodingAgent:function(e){e=GRUNT.extend({name:"Geocoding Search Agent",paramTranslator:null,execute:function(f,o){try{if(!f.reverse&&!f.freeform)address=new k.Address(f);var m=k.getEngine("geocode");if(m)m.geocode({addresses:[f.freeform?f.freeform:address],complete:function(p,s){if(o){var q=s;if(f.freeform)q=
k.rankGeocodeResponses(f.freeform,q,k.getEngine("geocode"));o(q,e)}}})}catch(n){GRUNT.Log.exception(n)}}},e);return new k.GeoSearchAgent(e)},PointOfInterest:function(e){e=GRUNT.extend({id:0,title:"",pos:null,lat:"",lon:"",group:"",retrieved:0,isNew:true},e);if(!e.pos&&e.lat&&e.lon)e.pos=new TILE5.Geo.Position(e.lat,e.lon);return GRUNT.extend({toString:function(){return e.id+": '"+e.title+"'"}},e)},POIStorage:function(e){function f(q){q=q?q:"default";n[q]||(n[q]=[]);return n[q]}function o(q){var v=
[];for(var w in n)for(var u=0;u<n[w].length;u++)if(!q||q(n[w][u]))v.push(n[w][u]);return v}function m(){GRUNT.WaterCooler.say("geo.pois-updated",{srcID:s.id,pois:s.getPOIs()})}e=GRUNT.extend({visibilityChange:null,onPOIDeleted:null,onPOIAdded:null},e);var n={},p=true,s={id:GRUNT.generateObjectID(),getPOIs:function(){return o()},getOldPOIs:function(q,v){return o(function(w){return w.group==q&&w.retrieved<v})},getVisible:function(){return p},setVisible:function(q){if(q!=p){p=q;e.visibilityChange&&e.visibilityChange()}},
findById:function(q){var v=o(function(w){return w.id==q});return v.length>0?v[0]:null},findByBounds:function(q){return o(function(v){return TILE5.Geo.P.inBounds(v.pos,q)})},addPOIs:function(q,v){if(v)n={};for(var w=0;q&&w<q.length;w++){q[w].retrieved=TILE5.Clock.getTime(true);var u=q[w];f(u.group).push(u)}},removeGroup:function(q){if(n[q]){delete n[q];m()}},update:function(q){var v=[],w=0,u=q.length>0?q[0].group:"",x=TILE5.Clock.getTime(true);for(w=0;w<q.length;w++){var y;a:{if(y=q[w])for(var A=f(y.group),
E=0;E<A.length;E++)if(A[E].id==y.id){y=A[E];break a}y=null}if(y){y.retrieved=x;y.isNew=false}else v.push(q[w])}q=s.getOldPOIs(u,x);s.addPOIs(v);for(w=0;e.onPOIAdded&&w<v.length;w++)e.onPOIAdded(v[w]);for(w=0;w<q.length;w++){e.onPOIDeleted&&e.onPOIDeleted(q[w]);u=q[w];x=f(u.group);for(y=0;y<x.length;y++)if(x[y].id==u.id){x.splice(y,1);break}}v.length+q.length>0&&m()}};return s},MapProvider:function(){var e=1,f=20;return{zoomLevel:0,checkZoomLevel:function(o){return Math.min(Math.max(o,e),f)},getCopyright:function(){},
getLogoUrl:function(){},getMapTiles:function(){},getPositionForXY:function(){return null},getZoomRange:function(){return{min:e,max:f}},setZoomRange:function(o,m){e=o;f=m}}},P:function(){var e={calcDistance:function(f,o){if(e.empty(f)||e.empty(o))return 0;var m=(o.lat-f.lat).toRad()/2,n=(o.lon-f.lon).toRad()/2;m=Math.sin(m)*Math.sin(m)+Math.cos(f.lat.toRad())*Math.cos(o.lat.toRad())*Math.sin(n)*Math.sin(n);return 6371*2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m))},copy:function(f){return f?new k.Position(f.lat,
f.lon):null},empty:function(f){return!f||f.lat===0&&f.lon===0},equal:function(f,o){return f&&o&&f.lat==o.lat&&f.lon==o.lon},almostEqual:function(f,o){return f&&o&&Math.floor(f.lat*1E3)===Math.floor(o.lat*1E3)&&Math.floor(f.lon*1E3)===Math.floor(o.lon*1E3)},inArray:function(f,o){for(var m=k.P.equal,n=o.length;n--;)if(m(f,o[n]))return true;return false},inBounds:function(f,o){var m=!(k.P.empty(f)||k.P.empty(o));return m=(m=m&&f.lat>=o.min.lat&&f.lat<=o.max.lat)&&f.lon>=o.min.lon&&f.lon<=o.max.lon},
parse:function(f){if(f)if(typeof f.lat!=="undefined")return e.copy(f);else{if(f.split)for(var o=[" ",","],m=0;m<o.length;m++){var n=f.split(o[m]);if(n.length===2)return new k.Position(n[0],n[1])}}else return new k.Position;return null},parseArray:function(f){var o=f.length,m=Array(o);for(o=o;o--;)m[o]=e.parse(f[o]);GRUNT.Log.info("parsed "+m.length+" positions");return m},fromMercatorPixels:function(f,o,m){return new k.Position(TILE5.Geo.Utilities.pix2lat(o,m),TILE5.Geo.Utilities.normalizeLon(TILE5.Geo.Utilities.pix2lon(f,
m)))},toMercatorPixels:function(f,o){return new TILE5.Vector(TILE5.Geo.Utilities.lon2pix(f.lon,o),TILE5.Geo.Utilities.lat2pix(f.lat,o))},generalize:function(f,o,m){var n=f.length,p=[],s=null;m||(m=250);m/=1E3;GRUNT.Log.info("generalizing positions, must include "+o.length+" positions");for(var q=n;q--;)if(q===0)p.unshift(f[q]);else{var v=!s||k.P.inArray(f[q],o)?m:k.P.calcDistance(s,f[q]);if(f[q]&&v>=m){p.unshift(f[q]);s=f[q]}}GRUNT.Log.info("generalized "+n+" positions into "+p.length+" positions");
return p},toString:function(f){return f?f.lat+" "+f.lon:""}};return e}(),B:function(){var e=-(Math.PI/2),f=Math.PI/2,o=-Math.PI*2,m=Math.PI*2,n={calcSize:function(p,s,q){var v=new TILE5.Vector(0,s.lat-p.lat);if(typeof q==="undefined")q=true;v.x=q&&p.lon>s.lon?360-p.lon+s.lon:s.lon-p.lon;return v},createBoundsFromCenter:function(p,s){var q=s/6371,v=p.lat*g,w=p.lon*g,u=v-q,x=v+q;if(u>e&&x<f){v=Math.asin(Math.sin(q)/Math.cos(v));q=w-v;if(q<o)q+=2*Math.PI;w=w+v;if(w>m)w-=2*Math.PI}else{u=Math.max(u,e);
x=Math.min(x,f);q=o;w=m}return new k.BoundingBox(new k.Position(u*a,q*a),new k.Position(x*a,w*a))},expand:function(p,s){return new k.BoundingBox(new k.Position(p.min.lat-s,p.min.lon-k.Utilities.normalizeLon(s)),new k.Position(p.max.lat+s,p.max.lon+k.Utilities.normalizeLon(s)))},forPositions:function(p,s){var q=null,v=TILE5.Clock.getTime();s||(s="auto");for(var w=p.length;w--;)if(q){var u=n.calcSize(q.min,p[w],false),x=n.calcSize(p[w],q.max,false);if(u.x<0)q.min.lon=p[w].lon;if(u.y<0)q.min.lat=p[w].lat;
if(x.x<0)q.max.lon=p[w].lon;if(x.y<0)q.max.lat=p[w].lat}else q=new TILE5.Geo.BoundingBox(p[w],p[w]);if(s){if(s=="auto"){w=n.calcSize(q.min,q.max);s=Math.max(w.x,w.y)*0.3}q=n.expand(q,s)}GRUNT.Log.trace("calculated bounds for "+p.length+" positions",v);return q},getCenter:function(p){var s=k.B.calcSize(p.min,p.max);return new TILE5.Geo.Position(p.min.lat+s.y/2,p.min.lon+s.x/2)},getGeoHash:function(p){var s=TILE5.Geo.GeoHash.encode(p.min.lat,p.min.lon);p=TILE5.Geo.GeoHash.encode(p.max.lat,p.max.lon);
GRUNT.Log.info("min hash = "+s+", max hash = "+p)},getZoomLevel:function(p,s){var q=n.getCenter(p),v=l[Math.min(Math.round(Math.abs(q.lat)*0.05),l.length)],w=n.calcSize(p.min,p.max);q=Math.ceil(Math.log(l[3]*s.height/w.y)/Math.log(2));v=Math.ceil(Math.log(v*s.width/w.x)/Math.log(2));return Math.min(isNaN(q)?1E3:q,isNaN(v)?1E3:v)},isEmpty:function(p){return!p||k.P.empty(p.min)||k.P.empty(p.max)},toString:function(p){return"min: "+k.P.toString(p.min)+", max: "+k.P.toString(p.max)}};return n}(),A:function(){var e=
/^(\d+).*$/,f=/(\d+)\s?\-\s?(\d+)/;return{buildingMatch:function(o,m){e.lastIndex=-1;if(e.test(o))for(var n=o.replace(e,"$1"),p=m.split(","),s=0;s<p.length;s++){f.lastIndex=-1;if(f.test(p[s])){var q=f.exec(p[s]);if(n>=parseInt(q[1],10)&&n<=parseInt(q[2],10))return true}else if(n==p[s])return true}return false},normalize:function(o){if(!o)return"";o=o.toUpperCase();if(!b){var m=[];for(var n in d)m.push(n);b=RegExp("(\\s)("+m.join("|")+")(\\s|$)","i")}b.lastIndex=-1;if(m=b.exec(o))o=o.replace(b,"$1"+
d[m[2]]);return o},toString:function(o){return o.streetDetails+" "+o.location}}}(),getEngine:function(e){for(var f=null,o=1;!f&&o<arguments.length;o++)f=t(e,arguments[o]);f=f?f:t(e);if(!f)throw Error("Unable to find GEO engine with "+e+" capability");return f},rankGeocodeResponses:function(e,f,o){var m=[],n=k.AddressCompareFns;if(o&&o.compareFns)n=GRUNT.extend({},n,o.compareFns);for(o=0;o<f.length;o++)m.push(new k.GeoSearchResult({caption:k.A.toString(f[o]),data:f[o],pos:f[o].pos,matchWeight:r(e,
f[o],n,k.GeocodeFieldWeights)}));m.sort(function(p,s){return s.matchWeight-p.matchWeight});return m}};return k}();
TILE5.Geo.GeoHash=function(){function t(r,l,g){if(l&g)r[0]=(r[0]+r[1])/2;else r[1]=(r[0]+r[1])/2}BITS=[16,8,4,2,1];BASE32="0123456789bcdefghjkmnpqrstuvwxyz";NEIGHBORS={right:{even:"bc01fg45238967deuvhjyznpkmstqrwx"},left:{even:"238967debc01fg45kmstqrwxuvhjyznp"},top:{even:"p0r21436x8zb9dcf5h7kjnmqesgutwvy"},bottom:{even:"14365h7k9dcfesgujnmqp0r2twvyx8zb"}};BORDERS={right:{even:"bcfguvyz"},left:{even:"0145hjnp"},top:{even:"prxz"},bottom:{even:"028b"}};NEIGHBORS.bottom.odd=NEIGHBORS.left.even;NEIGHBORS.top.odd=
NEIGHBORS.right.even;NEIGHBORS.left.odd=NEIGHBORS.bottom.even;NEIGHBORS.right.odd=NEIGHBORS.top.even;BORDERS.bottom.odd=BORDERS.left.even;BORDERS.top.odd=BORDERS.right.even;BORDERS.left.odd=BORDERS.bottom.even;BORDERS.right.odd=BORDERS.top.even;return{decode:function(r){var l=1,g=[],a=[];g[0]=-90;g[1]=90;a[0]=-180;a[1]=180;lat_err=90;lon_err=180;for(i=0;i<r.length;i++){c=r[i];cd=BASE32.indexOf(c);for(j=0;j<5;j++){mask=BITS[j];if(l){lon_err/=2;t(a,cd,mask)}else{lat_err/=2;t(g,cd,mask)}l=!l}}g[2]=(g[0]+
g[1])/2;a[2]=(a[0]+a[1])/2;return{latitude:g,longitude:a}},encode:function(r,l,g){var a=1,b=[],d=[],h=0,k=0;g=g?g:12;geohash="";b[0]=-90;b[1]=90;d[0]=-180;for(d[1]=180;geohash.length<g;){if(a){mid=(d[0]+d[1])/2;if(l>mid){k|=BITS[h];d[0]=mid}else d[1]=mid}else{mid=(b[0]+b[1])/2;if(r>mid){k|=BITS[h];b[0]=mid}else b[1]=mid}a=!a;if(h<4)h++;else{geohash+=BASE32[k];k=h=0}}return geohash}}}();
TILE5.Geo.Search=function(){return{bestResults:function(t,r){r||(r=20);for(var l=t.length>0?t[0]:null,g=[],a=0;a<t.length;a++)if(l.matchWeight-t[a].matchWeight<=r)g.push(t[a]);else break;return g}}}();
TILE5.Geo.Routing=function(){var t={calculate:function(r){r=GRUNT.extend({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:true},r);GRUNT.Log.info("attempting to calculate route");var l=TILE5.Geo.getEngine("route");l&&l.route(r,function(g){if(r.generalize)g.geometry=TILE5.Geo.P.generalize(g.geometry,g.getInstructionPositions());if(r.map){t.createMapOverlay(r.map,g);if(r.autoFit){GRUNT.Log.info("AUTOFITTING MAP TO ROUTE: bounds = "+g.boundingBox);r.map.gotoBounds(g.boundingBox)}}r.success&&
r.success(g)})},createMapOverlay:function(r,l){var g=r.getDimensions();g=new TILE5.Geo.UI.RouteOverlay({data:l,width:g.width,height:g.height});r.setLayer("route",g)},parseTurnType:function(r){for(var l=t.TurnType.Unknown,g=TILE5.Geo.Routing.TurnTypeRules,a=0;a<g.length;a++){g[a].regex.lastIndex=-1;var b=g[a].regex.exec(r);if(b){l=g[a].customCheck?g[a].customCheck(r,b):g[a].turnType;break}}return l},TurnType:{Unknown:"turn-unknown",Start:"turn-none-start",Continue:"turn-none",Arrive:"turn-none-arrive",
TurnLeft:"turn-left",TurnLeftSlight:"turn-left-slight",TurnLeftSharp:"turn-left-sharp",TurnRight:"turn-right",TurnRightSlight:"turn-right-slight",TurnRightSharp:"turn-right-sharp",Merge:"merge",UTurnLeft:"uturn-left",UTurnRight:"uturn-right",EnterRoundabout:"roundabout-enter",Ramp:"ramp",RampExit:"ramp-exit"},Instruction:function(r){r=GRUNT.extend({position:null,description:"",turnType:null},r);if(!r.turnType)r.turnType=t.parseTurnType(r.description);return r},RouteData:function(r){r=GRUNT.extend({geometry:[],
instructions:[],boundingBox:null},r);if(!r.boundingBox)r.boundingBox=TILE5.Geo.B.forPositions(r.geometry);return GRUNT.extend({getInstructionPositions:function(){for(var l=[],g=0;g<r.instructions.length;g++)r.instructions[g].position&&l.push(r.instructions[g].position);return l}},r)}};return t}();
TILE5.Geo.Routing.TurnTypeRules=function(){var t=TILE5.Geo.Routing.TurnType,r=[];r.push({regex:/continue/i,turnType:t.Continue});r.push({regex:/(take|bear|turn)(.*?)left/i,customCheck:function(l,g){return/bear/i.test(g[1])?t.TurnLeftSlight:t.TurnLeft}});r.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(l,g){return/bear/i.test(g[1])?t.TurnRightSlight:t.TurnRight}});r.push({regex:/enter\s(roundabout|rotaty)/i,turnType:t.EnterRoundabout});r.push({regex:/take.*?ramp/i,turnType:t.Ramp});
r.push({regex:/take.*?exit/i,turnType:t.RampExit});r.push({regex:/make(.*?)u\-turn/i,customCheck:function(l,g){return/right/i.test(g[1])?t.UTurnRight:t.UTurnLeft}});r.push({regex:/proceed/i,turnType:t.Start});r.push({regex:/arrive/i,turnType:t.Arrive});r.push({regex:/fell\sthrough/i,turnType:t.Merge});return r}();
TILE5.Geo.UI=function(){function t(a){a=GRUNT.extend({size:12,zindex:150,scalePosition:false,validStates:TILE5.Graphics.DisplayState.ACTIVE|TILE5.Graphics.DisplayState.ANIMATING|TILE5.Graphics.DisplayState.PAN},a);var b=null,d=function(){var h=TILE5.newCanvas(a.size*4,a.size*4),k=h.getContext("2d"),e=new TILE5.Vector(h.width/2,h.height/2),f=a.size,o=["#FFFFFF","#333333"],m=[3,1.5];k.lineCap="round";for(var n=0;n<o.length;n++){var p=f;k.lineWidth=m[n];k.strokeStyle=o[n];k.beginPath();k.moveTo(e.x,
e.y-p);k.lineTo(e.x,e.y+p);k.moveTo(e.x-p,e.y);k.lineTo(e.x+p,e.y);k.arc(e.x,e.y,f*0.6666,0,2*Math.PI,false);k.stroke()}return h}();return GRUNT.extend(new TILE5.Graphics.ViewLayer(a),{draw:function(h,k,e){if(!b){b=TILE5.D.getCenter(e);b=new TILE5.Vector(Math.round(b.x-d.width/2),Math.round(b.y-d.height/2))}h.drawImage(d,b.x,b.y)}})}var r=0,l={NONE:0,SINGLE:1,WATCH:2},g={AnnotationTween:null,GeoTileGrid:function(a){a=GRUNT.extend({grid:null,centerPos:new TILE5.Geo.Position,centerXY:new TILE5.Vector,
radsPerPixel:0},a);var b=TILE5.Geo.P.toMercatorPixels(a.centerPos,a.radsPerPixel),d=b.x-a.centerXY.x,h=b.y-a.centerXY.y,k=GRUNT.extend({},a.grid,{getBoundingBox:function(e,f,o,m){return new TILE5.Geo.BoundingBox(k.pixelsToPos(new TILE5.Vector(e,f+m)),k.pixelsToPos(new TILE5.Vector(e+o,f)))},getGridXYForPosition:function(e){e=TILE5.Geo.P.toMercatorPixels(e,a.radsPerPixel);return new TILE5.Vector(e.x-d,k.gridDimensions.height-(e.y-h))},getPixelDistance:function(e){e=TILE5.Geo.Utilities.dist2rad(e);
return Math.floor(e/a.radsPerPixel)},pixelsToPos:function(e){return TILE5.Geo.P.fromMercatorPixels(d+e.x,h+k.gridDimensions.height-e.y,a.radsPerPixel)}});return k},RouteOverlay:function(a){a=GRUNT.extend({data:null,pixelGeneralization:8,calculationsPerCycle:250,partialDraw:false,strokeStyle:"rgba(0, 51, 119, 0.9)",waypointFillStyle:"#FFFFFF",lineWidth:4,zindex:50},a);var b=true,d=null,h=[],k=0,e=[],f=[],o=GRUNT.extend(new TILE5.Graphics.ViewLayer(a),{getAnimation:function(m,n,p,s){if(b)return null;
var q="routeAnimation"+r++;f.push(q);return new TILE5.Graphics.AnimatedPathLayer({id:q,path:h,zindex:a.zindex+1,easing:m?m:TILE5.Animation.Easing.Sine.InOut,duration:n?n:5E3,drawIndicator:p,autoCenter:s?s:false})},draw:function(m,n,p,s,q){p=0;s=a.data?a.data.geometry:null;if(b){b=false;d=null;h=[];k=0}if(s&&k<s.length){a:{q=q.getTileLayer();e=[];if(q){s=GRUNT.Log.getTraceTicks();var v,w,u,x=a.data?a.data.geometry:[],y=x.length,A=a.data?a.data.instructions:[],E=A.length,G=a.calculationsPerCycle,I=
0;for(v=k;v<y;v++){w=q.getGridXYForPosition(x[v]);if(u=!d||v===0||Math.abs(w.x-d.x)+Math.abs(w.y-d.y)>a.pixelGeneralization){h.push(w);d=w}I++;if(I>=G){k=v;break a}}k=y;GRUNT.Log.trace(y+" geometry points generalized to "+h.length+" coordinates",s);d=null;for(v=E;v--;)if(A[v].position){w=q.getGridXYForPosition(A[v].position);if(u=!d||v===0||Math.abs(w.x-d.x)+Math.abs(w.y-d.y)>a.pixelGeneralization){e.push(w);d=w}}}}p++}q=h.length;if(q>0&&(!p||a.partialDraw)){m.strokeStyle=a.strokeStyle;m.lineWidth=
a.lineWidth;m.beginPath();m.moveTo(h[q-1].x-n.x,h[q-1].y-n.y);for(q=q;q--;)m.lineTo(h[q].x-n.x,h[q].y-n.y);m.stroke();m.fillStyle=a.waypointFillStyle;for(q=e.length;q--;){m.beginPath();m.arc(e[q].x-n.x,e[q].y-n.y,2,0,Math.PI*2,false);m.stroke();m.fill()}}return p}});GRUNT.WaterCooler.listen("grid.updated",function(){for(var m=f.length;m--;)GRUNT.WaterCooler.say("layer.remove",{id:f[m]});f=[];b=true;o.wakeParent()});return o},Annotation:function(a){a=GRUNT.extend({xy:null,pos:null,draw:null,calcXY:null,
tweenIn:g.AnnotationTween,animationSpeed:null},a);var b=false,d={xy:a.xy,pos:a.pos,isNew:true,isAnimating:function(){return b},calcXY:function(h){d.xy=h.getGridXYForPosition(d.pos);a.calcXY&&a.calcXY(h)},draw:function(h,k,e,f,o){if(d.xy){if(d.isNew&&a.tweenIn){var m=d.xy.y;d.xy.y=k.y-20;b=true;TILE5.Animation.tween(d.xy,"y",m,a.tweenIn,function(){d.xy.y=m;b=false},a.animationSpeed?a.animationSpeed:250+Math.random()*500)}if(a.draw)a.draw(h,k,new TILE5.Vector(d.xy.x-k.x,d.xy.y-k.y),e,f,o);else{h.beginPath();
h.arc(d.xy.x-k.x,d.xy.y-k.y,4,0,Math.PI*2,false);h.fill()}d.isNew=false}}};return d},ImageAnnotation:function(a){a=GRUNT.extend({imageUrl:null,animatingImageUrl:null,imageAnchor:null},a);var b=a.imageAnchor?TILE5.V.invert(a.imageAnchor):null;a.draw=function(h,k,e,f,o){if(a.animatingImageUrl&&d.isAnimating()){TILE5.Resources.loadImage(a.imageUrl);f=a.animatingImageUrl}else f=a.imageUrl;if(k=TILE5.Resources.getImage(f)){if(k.complete&&k.width>0){b||(b=new TILE5.Vector(-k.width>>1,-k.height>>1));e=TILE5.V.offset(e,
b.x,b.y);h.drawImage(k,e.x,e.y,k.width,k.height)}}else TILE5.Resources.loadImage(f,function(){o.wakeParent()})};var d=new g.Annotation(a);return d},LocationAnnotation:function(a){a=GRUNT.extend({accuracy:null},a);var b=new Image,d=new TILE5.Vector,h=null;b.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAACIQAAAiEBPhEQkwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAG+SURBVCiRlZHNahNRAIW/O7mTTJPahLZBA1YUyriINRAE3bQIKm40m8K8gLj0CRQkO32ELHUlKbgoIu4EqeJPgtCaoBuNtjXt5LeTMZk0mbmuWiuuPLsD3+HAOUIpxf9IHjWmaUbEyWv5ROrsVULhcHP761rUfnN3Y2Otc8CIg4YT85lzuVsPP+Qupw1vpPjRCvhS9ymvV0e77x7nNj+uvADQAIQQ+uLyvdfLV9JGZi7EdEwQlqBpEJ019f0z1mo2u5Q8DMydv25lshemmj1FueZTawbs7inarqLbV7Qjab1upB9YlhWSAHLavLHZCvg1VEhN0PMU9W7At4bPVidg7CtkLLXkut+lBPD6/Ub155jJiADAHSpaLmx3ApyBQoYEUd0PBoOBkAC6+3llvda/YxgGgYL+UNHf/zN3KiExGlsvTdP0NYDkhPdWrz35ZDsBzV5wCMuQwEyFmXFeeadjzfuFQmGkAZRKpdGC/n7x+M6jqvA9Zo6FWDhlcHE+wqT93J1tP7vpOE7rrx8ALMuasPf8S12St4WmJ6bYWTUC52k8Hm8Vi0X/nwBAPp/XKpWKdF1X2LYdlMvlsToC/QYTls7DLFr/PAAAAABJRU5ErkJggg%3D%3D";
b.onload=function(){d=new TILE5.Vector(b.width/2,b.height/2)};var k=new g.Annotation(GRUNT.extend({calcXY:function(e){h=Math.floor(e.getPixelDistance(k.accuracy)*0.5)},draw:function(e,f,o,m,n,p){f=o.x-d.x;m=o.y-d.y;if(h&&k.drawAccuracyIndicator){e.fillStyle="rgba(30, 30, 30, 0.2)";e.beginPath();e.arc(o.x,o.y,h,0,Math.PI*2,false);e.fill()}b.complete&&b.width>0&&e.drawImage(b,f,m,b.width,b.height);p.trigger("invalidate")}},a));k.accuracy=a.accuracy;k.drawAccuracyIndicator=false;return k},AnnotationsOverlay:function(a){function b(f){var o=
a.map?a.map.getTileLayer():null,m=f.length;if(o)for(m=m;m--;)f[m].calcXY(o);f.sort(function(n,p){var s=p.xy.y-n.xy.y;if(s===0)s=p.xy.x-n.xy.x;return s})}a=GRUNT.extend({pois:null,map:null,createAnnotationForPOI:null,zindex:100},a);var d=[],h=false,k=[],e=GRUNT.extend(new TILE5.Graphics.ViewLayer(a),{cycle:function(){return h?1:0},draw:function(f,o,m,n,p){h=false;f.fillStyle="rgba(255, 0, 0, 0.75)";f.globalCompositeOperation="source-over";for(m=d.length;m--;){d[m].draw(f,o,n,e,p);h=h||d[m].isAnimating()}for(m=
k.length;m--;){k[m].draw(f,o,n,e,p);h=h||k[m].isAnimating()}return h?1:0},add:function(f){k.push(f);b(k);e.wakeParent()},clear:function(f){k=[];b(k);if(f){d=[];b(d)}e.wakeParent()}});GRUNT.WaterCooler.listen("geo.pois-updated",function(f){if(a.pois&&a.pois.id==f.srcID){f=f.pois;try{d=[];for(var o=0;o<f.length;o++)if(f[o].pos){var m;var n=f[o];if(n&&n.pos){var p=null;if(p=a.createAnnotationForPOI?a.createAnnotationForPOI(n):new g.Annotation({pos:n.pos})){p.isNew=n.isNew;n.isNew=false}m=p}else m=void 0;
m&&d.push(m)}b(d)}catch(s){GRUNT.Log.exception(s)}e.wakeParent()}});GRUNT.WaterCooler.listen("grid.updated",function(){b(d);b(k);e.wakeParent()});return e},Tiler:function(a){function b(x){try{var y=new TILE5.Geo.Position(x.coords.latitude,x.coords.longitude),A=x.coords.accuracy/1E3;u.trigger("locationUpdate",x,A);if(v){if(!s){s=new g.LocationAnnotation({pos:y,accuracy:A});u.bind("tileDrawComplete",function(){s.drawAccuracyIndicator=true})}a.displayLocationAnnotation&&o.add(s);var E=TILE5.Geo.B.createBoundsFromCenter(y,
Math.max(A,1));u.gotoBounds(E)}else{s.pos=y;s.accuracy=A;s.calcXY(u.getTileLayer());u.panToPosition(y,null,TILE5.Animation.Easing.Sine.Out)}v=false}catch(G){GRUNT.Log.exception(G)}}function d(x){GRUNT.Log.info("caught location tracking error:",x)}a=GRUNT.extend({tapExtent:10,provider:null,crosshair:false,zoomLevel:0,boundsChange:null,tapPOI:null,boundsChangeThreshold:30,pois:new TILE5.Geo.POIStorage,createAnnotationForPOI:null,displayLocationAnnotation:true,zoomAnimation:TILE5.Animation.Easing.Quad.Out},
a);var h=new TILE5.Vector,k=l.NONE,e=false,f=[],o=null,m=0,n=null,p=null,s=null,q=0,v=true,w=a.zoomLevel;if(!a.provider)a.provider=new TILE5.Geo.MapProvider;var u=GRUNT.extend({},new TILE5.Tiling.Tiler(a),{pois:a.pois,annotations:null,getProvider:function(){return a.provider},setProvider:function(x){a.provider=x;e=false},getBoundingBox:function(){var x=u.getTileLayer(),y=u.getOffset(),A=u.getDimensions();if(x)return x.getBoundingBox(y.x,y.y,A.width,A.height);return null},getCenterPosition:function(){return u.getXYPosition(TILE5.D.getCenter(u.getDimensions()))},
getXYPosition:function(x){return u.getTileLayer().pixelsToPos(u.viewPixToGridPix(x))},gotoBounds:function(x,y){var A=TILE5.Geo.B.getZoomLevel(x,u.getDimensions());u.gotoPosition(TILE5.Geo.B.getCenter(x),A,y)},gotoPosition:function(x,y,A){var E=w,G=(new Date).getTime(),I=false,H=u.getBoundingBox();if(H)I=!TILE5.Geo.P.inBounds(x,H);w=y?y:w;if(!w)throw Error("Zoom level required to goto a position.");if(a.provider)w=a.provider.checkZoomLevel(w);if(I||!e||w!==E){TILE5.Resources.resetImageLoadQueue();
if(s)s.drawAccuracyIndicator=false;(y=u.getTileLayer())&&y.deactivate();TILE5.Animation.cancel();e&&u.freeze();m=G;a.provider.zoomLevel=w;a.provider.getMapTiles(u,x,function(N){if(G===m){u.setTileLayer(N);p=N.getId();u.panToPosition(x,function(){u.unfreeze();u.trigger("zoomLevelChange",w);A&&A()})}else GRUNT.Log.info("request time mismatch - ignoring update")});e=true}else u.panToPosition(x,A)},panToPosition:function(x,y,A){var E=u.getTileLayer();if(E){x=E.getGridXYForPosition(x);E=u.getDimensions();
x.x-=E.width/2;x.y-=E.height/2;if(n)n=null;u.updateOffset(x.x,x.y,A);GRUNT.WaterCooler.say("view.wake",{id:u.id});a.boundsChange&&a.boundsChange(u.getBoundingBox());y&&y(u)}},locate:function(){u.trackStart(l.SINGLE);setTimeout(u.trackCancel,1E4)},trackStart:function(x){if(navigator.geolocation){k=x?x:l.WATCH;v=true;q=navigator.geolocation.watchPosition(b,d,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3})}},trackCancel:function(){q&&navigator.geolocation&&navigator.geolocation.clearWatch(q);k===
l.WATCH&&o.clear();k=l.NONE;q=0},getZoomLevel:function(){return w},setZoomLevel:function(x){try{u.gotoPosition(u.getCenterPosition(),x)}catch(y){GRUNT.Log.exception(y)}},zoomIn:function(){u.scale(2,TILE5.Animation.Easing.Sine.Out)||u.setZoomLevel(w+1)},zoomOut:function(){u.scale(0.5,TILE5.Animation.Easing.Sine.Out)||u.setZoomLevel(w-1)},animateRoute:function(x,y,A,E){var G=u.getLayer("route");if(G)(x=G.getAnimation(x,y,A,E))&&x.addToView(u)}});u.bind("pan",function(){k===l.SINGLE&&u.trackCancel()});
u.bind("tap",function(x,y){var A=u.getTileLayer(),E=null;if(A){E=u.viewPixToGridPix(new TILE5.Vector(y.x,y.y));var G=A.pixelsToPos(E),I=A.pixelsToPos(TILE5.V.offset(E,-a.tapExtent,a.tapExtent)),H=A.pixelsToPos(TILE5.V.offset(E,a.tapExtent,-a.tapExtent));GRUNT.Log.info("grid tapped @ "+TILE5.Geo.P.toString(A.pixelsToPos(E)));E=new TILE5.Geo.BoundingBox(I,H);f=u.pois.findByBounds(E);u.trigger("geotap",x,y,G,E);a.tapPOI&&a.tapPOI(f)}});u.bind("doubleTap",function(x,y){u.animate(2,TILE5.D.getCenter(u.getDimensions()),
new TILE5.Vector(y.x,y.y),a.zoomAnimation)});u.bind("scale",function(x,y){var A=0;x=Math.sqrt(x);if(x<1)A=-(0.5/x);else if(x>1)A=x;u.gotoPosition(u.getXYPosition(y),w+Math.floor(A))});o=new TILE5.Geo.UI.AnnotationsOverlay({pois:u.pois,map:u,createAnnotationForPOI:a.createAnnotationForPOI});u.annotations=o;u.setLayer("annotations",o);a.crosshair&&u.setLayer("crosshair",new t);GRUNT.WaterCooler.listen("view.idle",function(x){if(x.id&&x.id==u.id)if(TILE5.V.absSize(TILE5.V.diff(h,u.getOffset()))>a.boundsChangeThreshold&&
a.boundsChange){h=u.getOffset();a.boundsChange(u.getBoundingBox())}});return u}};return g}();
