COG=function(){var h=/\$\{(.*?)\}/ig,m=Object.prototype.hasOwnProperty,l=0,d={id:"grunt.core",extend:function(){var a=arguments[0]||{},f=1,g=arguments.length,e=false,k,b,o,p;if(typeof a==="boolean"){e=a;a=arguments[1]||{};f=2}if(typeof a!=="object"&&!d.isFunction(a))a={};if(g===f){a=this;--f}for(;f<g;f++)if((k=arguments[f])!=null)for(b in k){o=a[b];p=k[b];if(a!==p)if(e&&p&&(d.isPlainObject(p)||d.isArray(p))){o=o&&(d.isPlainObject(o)||d.isArray(o))?o:d.isArray(p)?[]:{};a[b]=d.extend(e,o,p)}else if(p!==
undefined)a[b]=p}return a},isFunction:function(a){return toString.call(a)==="[object Function]"},isArray:function(a){return toString.call(a)==="[object Array]"},isPlainObject:function(a){if(!a||toString.call(a)!=="[object Object]"||a.nodeType||a.setInterval)return false;if(a.constructor&&!m.call(a,"constructor")&&!m.call(a.constructor.prototype,"isPrototypeOf"))return false;var f;for(f in a);return f===undefined||m.call(a,f)},isEmptyObject:function(a){for(var f in a)return false;return true},isXmlDocument:function(a){return toString.call(a)===
"[object Document]"},contains:function(a,f){var g=a,e=arguments,k=1;if(f&&d.isArray(f)){e=f;k=0}for(k=k;k<e;k++)g=g&&typeof foo[e[k]]!=="undefined";return g},newModule:function(a){a=d.extend({id:null,requires:[],parent:null},a);if(a.parent)a=d.extend({},a.parent,a);return a},toID:function(a){return a.replace(/\s/g,"-")},objId:function(a){return(a?a:"obj")+l++},formatStr:function(a){if(arguments.length<=1)return a;for(var f=arguments.length-2,g=0;g<=f;g++)a=a.replace(RegExp("\\{"+g+"\\}","gi"),arguments[g+
1]);return a},wordExists:function(a,f){var g="";if(f.toString)f=f.toString();for(var e=0;e<f.length;e++)g+=!/\w/.test(f[e])?"\\"+f[e]:f[e];return RegExp("(^|\\s|\\,)"+g+"(\\,|\\s|$)","i").test(a)},parseTemplate:function(a,f){for(var g=h.exec(a);g;){a=a.replace(g[0],COG.XPath.first(g[1],f));h.lastIndex=0;g=h.exec(a)}return a}};return d}();
COG.Log=function(){function h(f,g){var e,k=g&&g.length>0?g[0]:"";for(e=1;g&&e<g.length;e++)k+=" "+(l&&COG.isPlainObject(g[e])?JSON.stringify(g[e]):g[e]);typeof console!=="undefined"&&console[f](k);for(e=0;e<m.length;e++)m[e].call(a,k,f)}var m=[],l=typeof JSON!=="undefined",d=window.console&&window.console.markTimeline,a={id:"grunt.log",getTraceTicks:function(){return d?(new Date).getTime():null},trace:function(f,g){if(d)console.markTimeline(f+(g?": "+(a.getTraceTicks()-g)+"ms":""))},debug:function(){h("debug",
arguments)},info:function(){h("info",arguments)},warn:function(){h("warn",arguments)},error:function(){h("error",arguments)},exception:function(f){a.error(arguments);for(var g in f)a.info("ERROR DETAIL: "+g+": "+f[g])},watch:function(f,g){try{g()}catch(e){a.exception(e,f)}},throwError:function(f){a.error(f);throw Error(f);},requestUpdates:function(f){m.push(f)}};return a}();
(function(){function h(d,a){d[a]||(d[a]=function(f){return d.configure(a,f)})}function m(d){d.gtConfId=COG.objId("configurable");d.gtConfig={};d.gtConfigFns=[];return d.gtConfig}var l={};COG.paramTweaker=function(d,a,f){return function(g,e){if(typeof e!=="undefined"){if(g in d)d[g]=e;f&&g in f&&f[g](g,e)}else return a&&g in a?a[g](g):d[g]}};COG.configurable=function(d,a,f,g){if(d){d.gtConfId||m(d);var e=d.gtConfId,k=d.gtConfig,b=d.gtConfigFns;l[e]=d;b.push(f);for(f=a.length;f--;){k[a[f]]=true;g&&
h(d,a[f])}if(!d.configure)d.configure=function(o,p){if(k[o]){for(var n=b.length;n--;){var t=b[n](o,p);if(typeof t!=="undefined")return t}return l[e]}return null}}}})();
(function(){function h(m,l){var d=m.gtObsHandlers;d[l]||(d[l]=[]);return d[l]}COG.observable=function(m){if(m){if(!m.gtObsHandlers)m.gtObsHandlers={};if(!(m.bind||m.trigger||m.unbind)){m.bind=function(l,d){var a=COG.objId("callback");h(m,l).unshift({fn:d,id:a});return a};m.trigger=function(l){var d=h(m,l),a={cancel:false,tickCount:(new Date).getTime()},f;if(!d)return null;f=Array.prototype.slice.call(arguments,1);f.unshift(a);for(var g=d.length;g--&&!a.cancel;)d[g].fn.apply(self,f);return a};m.unbind=
function(l,d){for(var a=h(m,l),f=0;a&&f<a.length;f++)if(a[f].id===d){a.splice(f,1);break}return m}}}}})();(function(){var h={},m=[];COG.addPipe=function(l){l("pipe.test",{});m.push(l)};COG.listen=function(l,d){h[l]||(h[l]=[]);d&&h[l].push(d)};COG.say=function(l,d){var a;for(a=m.length;a--;)m[a](l,d);if(h[l])for(a=h[l].length;a--;)h[l][a](d)}})();
COG.Loopage=function(){function h(p){return COG.extend({id:f++,frequency:0,after:0,single:false,lastTick:0,execute:function(){}},p)}function m(p){e.push(p);l()}function l(){k&&clearTimeout(k);k=setTimeout(d,0);o=true}function d(){for(var p,n=(new Date).getTime(),t=g.length;e.length>0;){var y=e.shift();for(p=t;p--;)if(g[p].id===y){g.splice(p,1);break}o=true;t=g.length}if(o){b=a;for(p=t;p--;)b=g[p].frequency<b?g[p].frequency:b}for(p=t;p--;){y=n-g[p].lastTick;if(g[p].lastTick===0||y>=g[p].frequency){g[p].execute(n,
g[p]);g[p].lastTick=n;g[p].single&&g[p].trigger("complete")}}k=t?setTimeout(d,b):0}var a=6E4,f=0,g=[],e=[],k=0,b=a,o=true;return{join:function(p){var n=new h(p);if(n.after>0)n.lastTick=(new Date).getTime()+n.after;COG.observable(n);n.bind("complete",function(){m(n.id)});g.unshift(n);l();return n},leave:m}}();if(!this.JSON)this.JSON={};
(function(){function h(b){return b<10?"0"+b:b}function m(b){a.lastIndex=0;return a.test(b)?'"'+b.replace(a,function(o){var p=e[o];return typeof p==="string"?p:"\\u"+("0000"+o.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+b+'"'}function l(b,o){var p,n,t,y,A=f,u,v=o[b];if(v&&typeof v==="object"&&typeof v.toJSON==="function")v=v.toJSON(b);if(typeof k==="function")v=k.call(o,b,v);switch(typeof v){case "string":return m(v);case "number":return isFinite(v)?String(v):"null";case "boolean":case "null":return String(v);
case "object":if(!v)return"null";f+=g;u=[];if(Object.prototype.toString.apply(v)==="[object Array]"){y=v.length;for(p=0;p<y;p+=1)u[p]=l(p,v)||"null";t=u.length===0?"[]":f?"[\n"+f+u.join(",\n"+f)+"\n"+A+"]":"["+u.join(",")+"]";f=A;return t}if(k&&typeof k==="object"){y=k.length;for(p=0;p<y;p+=1){n=k[p];if(typeof n==="string")if(t=l(n,v))u.push(m(n)+(f?": ":":")+t)}}else for(n in v)if(Object.hasOwnProperty.call(v,n))if(t=l(n,v))u.push(m(n)+(f?": ":":")+t);t=u.length===0?"{}":f?"{\n"+f+u.join(",\n"+f)+
"\n"+A+"}":"{"+u.join(",")+"}";f=A;return t}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+h(this.getUTCMonth()+1)+"-"+h(this.getUTCDate())+"T"+h(this.getUTCHours())+":"+h(this.getUTCMinutes())+":"+h(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
a=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f,g,e={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},k;if(typeof JSON.stringify!=="function")JSON.stringify=function(b,o,p){var n;g=f="";if(typeof p==="number")for(n=0;n<p;n+=1)g+=" ";else if(typeof p==="string")g=p;if((k=o)&&typeof o!=="function"&&(typeof o!=="object"||typeof o.length!=="number"))throw Error("JSON.stringify");return l("",
{"":b})};if(typeof JSON.parse!=="function")JSON.parse=function(b,o){function p(t,y){var A,u,v=t[y];if(v&&typeof v==="object")for(A in v)if(Object.hasOwnProperty.call(v,A)){u=p(v,A);if(u!==undefined)v[A]=u;else delete v[A]}return o.call(t,y,v)}var n;b=String(b);d.lastIndex=0;if(d.test(b))b=b.replace(d,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(b.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){n=eval("("+b+")");return typeof o==="function"?p({"":n},""):n}throw new SyntaxError("JSON.parse");}})();
(function(){function h(l,d){var a=l.split("|"),f={};for(var g in d){var e=d[g];f[g]=a.length>e?a[e]:null}return f}var m={JSON:{parse:function(l){return JSON.parse(l)}},PDON:{parse:function(l){var d=null,a=[];l=l.split("\n");for(var f=0;f<l.length;f++){var g=l[f];if(d)a.push(h(g,d));else if(g){d=g.split("|");g={};for(var e=0;e<d.length;e++)g[d[e]]=e;d=g}else d=null}return a}}};COG.parseData=function(l,d){d=d?d.toUpperCase():"JSON";if(!m[d])throw Error("Unsupported data format: "+d);try{return m[d].parse(l)}catch(a){COG.Log.exception(a)}return{}}})();
COG.XPath=function(){function h(a){for(var f=null,g=0;g<m.length;g++)if(f=m[g](a))break;return f}var m=[],l=[null,function(a){return a.numberValue},function(a){return a.stringValue},function(a){return a.booleanValue},null,null,null,null,function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null},function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||COG.Log.warn("No XPATH support");var d={SearchResult:function(a){return{toString:function(){var f=
null;if(a){var g=null;if(a.resultType>=0&&a.resultType<l.length)g=l[a.resultType];if(g)f=g(a)}return f?f:""}}},first:function(a,f){var g=d.SearchResult,e;var k=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!k)k=XPathResult.ANY_TYPE;try{if(COG.isXmlDocument(f))e=f.evaluate(a,f,h,k,null);else{COG.Log.warn("attempted xpath expression: "+a+" on a non-xml document");e=null}}catch(b){COG.Log.warn("invalid xpath expression: "+a+" on node: "+f);e=null}return new g(e)},registerResolver:function(a){m.push(a)}};return d}();
COG.Storage=function(){function h(m){if(m&&m=="session")return sessionStorage;return localStorage}return{get:function(m,l){var d=h(l).getItem(m);return/^(\{|\[).*(\}|\])$/.test(d)?JSON.parse(d):d},set:function(m,l,d){l=jQuery.isArray(l)||jQuery.isPlainObject(l)?JSON.stringify(l):l;h(d).setItem(m,l)},remove:function(m,l){h(l).removeItem(m)}}}();
COG.ParseRules=function(){var h=[];return{add:function(m,l){h.push({regex:m,handler:l})},each:function(m,l,d){function a(){f++;d&&f>=h.length&&d(l)}for(var f=0,g=0;g<h.length;g++){var e=h[g].regex,k=h[g].handler,b=false;if(e){e.lastIndex=-1;if((e=e.exec(m))&&k){b=true;k(e,l,a)&&a()}}b||a()}}}};
(function(){function h(e){var k=[],b=function(p,n){n=COG.isFunction(n)?n():n;k[k.length]=encodeURIComponent(p)+"="+encodeURIComponent(n)};if(COG.isArray(e))for(var o=0;o<e.length;o++)b(e[o].name,e[o].value);else for(o in e)b(o,e[o]);return k.join("&").replace(/%20/g,"+")}var m={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},l={JSON:["json"],PDON:["pdon.txt"]},d=["TEXT","STREAM"],a=/^(\w+:)?\/\/([^\/?#]+)/,f={XML:function(e){return e.responseXML},JSON:function(e){return COG.parseData(e.responseText)},
PDON:function(e){return COG.parseData(e.responseText,"PDON")},DEFAULT:function(e){return e.responseText}},g={CONTENT_TYPE:"Content-Type"};COG.xhr=function(e){function k(){if(this.readyState===4){var n=null,t=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(t)if(e.handleResponse)e.handleResponse(this);else{var y=e,A=this.getResponseHeader(g.CONTENT_TYPE),u,v=false;for(u in m)if(A&&A.indexOf(m[u])>=0){v=true;
break}A=!v;for(v=0;v<d.length;v++)A=A||d[v]==u;if(A)b:{A=u;for(var C in l)for(v=0;v<l[C].length;v++)if(RegExp(l[C][v]+"$","i").test(y.url)){u=C;break b}u=A?A:"DEFAULT"}try{n=f[u](this,y)}catch(x){n=f.DEFAULT(this,y)}}else e.error&&e.error(this)}catch(U){COG.Log.exception(U,"PROCESSING AJAX RESPONSE")}t&&n&&e.success&&e.success.call(this,n)}}try{e=COG.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},e);var b=
a.exec(e.url),o=b&&(b[1]&&b[1]!==location.protocol||b[2]!==location.host);if(e.data)e.method="POST";if(e.url){b=null;if(e.xhr)b=e.xhr(e);b||(b=new XMLHttpRequest);b.open(e.method,e.url,e.async);e.data&&b.setRequestHeader("Content-Type",e.contentType);o||b.setRequestHeader("X-Requested-With","XMLHttpRequest");b.onreadystatechange=k;b.send(e.method=="POST"?h(e.data):null)}else COG.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(p){COG.Log.exception(p)}}})();
(function(){function h(a){var f=document.createElement("script"),g=false;f.src=a;f.async=true;f.onload=f.onreadystatechange=function(){if(!g&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){g=true;f.onload=f.onreadystatechange=null;f&&f.parentNode&&f.parentNode.removeChild(f)}};l||(l=document.getElementsByTagName("head")[0]);l.appendChild(f)}var m=0,l,d=this;COG.jsonp=function(a,f,g){a+=a.indexOf("?")>=0?"&":"?";var e="json"+ ++m;d[e]=function(k){f(k);d[e]=null;try{delete d[e]}catch(b){}};
h(a+(g?g:"callback")+"="+e);return e}})();
COG.Touch=function(){function h(r,q){return{x:r.x-q.x,y:r.y-q.y}}function m(r,q){var s=h(r,q);return Math.sqrt(s.x*s.x+s.y*s.y)}function l(r){if(r.count>1)return m(r.touches[0],r.touches[1]);return 0}function d(r,q){var s=r&&r.count>0?r.touches[0]:null;if(s&&q&&q.count>0)return h(s,q.touches[0]);return null}function a(r,q){r.count=q.count;for(var s=b;s--;){r.touches[s].x=q.touches[s].x;r.touches[s].y=q.touches[s].y}}function f(){for(var r={count:0,touches:Array(b)},q=b;q--;)r.touches[q]=k();return r}
function g(r){if(r.preventDefault){r.preventDefault();r.stopPropagation()}else r.cancelBubble&&r.cancelBubble()}function e(r,q,s){if(I){q=q[s?s:"touches"];s=q.length;for(s=r.count=s;s--;){r.touches[s].x=q[s].pageX;r.touches[s].y=q[s].pageY}}else if(q.button===0){r.count=1;r.touches[0].x=q.pageX?q.pageX:q.screenX;r.touches[0].y=q.pageY?q.pageY:q.screenY}else r.count=0}function k(r,q){return{x:r?r:0,y:q?q:0}}var b=10,o=120,p=100,n=250,t=300,y=5,A=0,u=1,v=2,C=7,x=0,U=0,I=undefined,$=function(r){function q(E,
K,H,z){var D=Math.asin((E.y-K.y)/H);H=H*(ta/z)>>0;H=H>qa?qa:H;D=K.x>E.x?D:Math.PI-D;G("pan",Math.cos(D)*-H,Math.sin(D)*H,true)}function s(E,K){var H,z;if(I){H=K-la;if(H<n){z=m(V.touches[0],E);z>r.inertiaTrigger&&q(V.touches[0],E,z,H)}}else{da.x=E.x;da.y=E.y;COG.Loopage.join({execute:function(D,L){H=D-K;z=m(E,da);if(H<p&&z>r.inertiaTrigger){L.trigger("complete");q(E,da,z,H)}else H>p&&L.trigger("complete")},frequency:10})}}function w(E){var K=0,H=0;if(E.offsetParent){do{K+=E.offsetLeft;H+=E.offsetTop;
E=E.offsetParent}while(E)}return k(K,H)}function F(E){var K=E.count,H=Array(K),z=w(ea);for(K=K;K--;)H[K]=k(E.touches[K].x-z.x,E.touches[K].y-z.y);return H}function G(){ra&&ra.trigger.apply(null,arguments)}function J(E,K){var H=w(ea);H=k(K.x-H.x,K.y-H.y);G(E,K,H)}function B(E){var K=E.target?E.target:E.srcElement;if(fa||K&&K===ea){e(V,E);if(V.count!==0){ba=null;ha.x=0;ha.y=0;ma=true;Q=false;la=(new Date).getTime();g(E);K.style.cursor="move";G("inertiaCancel");na=la;if(E=V.count>0?V.touches[0]:null){G("touchStart",
E.x,E.y);if(na-oa<t)if((E=h(V.touches[0],Z.touches[0]))&&Math.abs(E.x)<r.maxDistDoubleTap&&Math.abs(E.y)<r.maxDistDoubleTap)Q=true;O=A;a(Z,V)}else COG.Log.warn("Touch start fired, but no touch vector found")}}}function M(E){var K=E.target?E.target:E.srcElement,H=0;if(fa||K&&K===ea){e(S,E);if(S.count>0){da.x=S.touches[0].x;da.y=S.touches[0].y}if(ma){I&&g(E);if(S.count>1){V.count===1&&a(V,S);H=l(V)-l(S)}if(O===A)if((E=d(S,V))&&(Math.abs(E.x)>=C||Math.abs(E.y)>=C))O=u;if(O!==A)if(!H||Math.abs(H)<y){if(ba=
d(S,Z)){ha.x-=ba.x;ha.y-=ba.y;ca.x-=ba.x;ca.y-=ba.y}G("pan",ca.x,ca.y);ca.x=0;ca.y=0;O=u}else{G("pinchZoom",F(V),F(S));O=v}a(Z,S)}}}function N(E){var K=E.target?E.target:E.srcElement;if(ma&&(fa||K&&K===ea)){e(aa,E,"changedTouches");var H=aa.touches[0];I&&g(E);E=(new Date).getTime();oa=na;if(O===A){J("tap",V.touches[0]);Y||(Y=setTimeout(function(){Y=0;Q&&J("doubleTap",V.touches[0])},t+50))}else if(O==u){G("panEnd",ha.x,ha.y);sa&&s(H,E)}else O==v&&G("pinchZoomEnd",F(V),F(Z),E-la);K.style.cursor="default";
ma=false}}function P(E){var K=E.target?E.target:E.srcElement;if(fa||K&&K===ea){if(E.detail){K=-E.detail*o;K=k(E.axis===1?K:0,E.axis===2?K:0)}else K=k(E.wheelDeltaX,E.wheelDeltaY);var H=K.y!==0?Math.abs(K.y/o):0;if(da&&H!==0){var z=k(da.x-ea.offsetLeft,da.y-ea.offsetTop);G("wheelZoom",z,Math.pow(2,K.y>0?H:-H))}g(E)}}r=COG.extend({element:null,observable:null,inertiaTrigger:20,maxDistDoubleTap:20,touchStartHandler:null,moveHandler:null,moveEndHandler:null,pinchZoomHandler:null,pinchZoomEndHandler:null,
tapHandler:null,doubleTapHandler:null,wheelZoomHandler:null},r);var Q=false,Y=0,W=T5.getConfig(),V=f(),S=f(),Z=f(),aa=f(),ba=null,ha=k(),ca=k(),O=null,ma=false,la=0,ja=[],da=k(),sa=false,ta,qa,na=0,oa=0,ea=r.element,ra=r.observable,fa=typeof FlashCanvas!=="undefined",ua={supportsTouch:I,addListeners:function(E){ja.push(E)},decoupleListeners:function(E){for(var K=0;E&&K<ja.length;K++)if(ja[K].listenerId===E){ja.splice(K,1);break}},release:function(){W.unbindEvent(I?"touchstart":"mousedown",B,false);
W.unbindEvent(I?"touchmove":"mousemove",M,false);W.unbindEvent(I?"touchend":"mouseup",N,false);if(!I){window.removeEventListener("mousewheel",P,false);window.removeEventListener("DOMMouseScroll",P,false)}},inertiaEnable:function(E,K){sa=true;ta=E;qa=K?Math.min(K.width,K.height):500},inertiaDisable:function(){sa=false}};if(typeof I==="undefined")I=T5.getConfig().supportsTouch;W.bindEvent(I?"touchstart":"mousedown",B,false);W.bindEvent(I?"touchmove":"mousemove",M,false);W.bindEvent(I?"touchend":"mouseup",
N,false);if(!I){W.bindEvent("mousewheel",P,window);W.bindEvent("DOMMouseScroll",P,window)}return ua},R=[];return{capture:function(r,q){if(!r)throw Error("Unable to capture touch of null element");if(!r.id)r.id="touchable_"+x++;var s=R[r.id];if(!s){s=new $(COG.extend({element:r},q));R[r.id]=s}if(q){q.listenerId&&s.decoupleListeners(q.listenerId);q.listenerId=++U;s.addListeners(q)}return s},release:function(r){if(r&&r.id&&R[r.id]){R[r.id].release();delete R[r.id]}}}}();
T5=function(){var h=function(g,e){return{x:g?g:0,y:e?e:0}},m=function(){function g(k,b){return new h(k.x-b.x,k.y-b.y)}function e(k,b){if(!b)b=k.length;if(b<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var o={edges:Array(b-1),accrued:Array(b-1),total:0},p=0;p<b-1;p++){var n=g(k[p],k[p+1]);o.edges[p]=Math.sqrt(n.x*n.x+n.y*n.y);o.accrued[p]=o.total+o.edges[p];o.total+=o.edges[p]}return o}return{VECTOR_SIMPLIFICATION:3,SIMPLIFICATION_MIN_VECTORS:25,create:function(k,
b){return new h(k,b)},add:function(){for(var k=new h,b=arguments.length;b--;){k.x+=arguments[b].x;k.y+=arguments[b].y}return k},absSize:function(k){return Math.max(Math.abs(k.x),Math.abs(k.y))},diff:g,dotProduct:function(k,b){return k.x*b.x+k.y*b.y},equals:function(k,b){return k.x===b.x&&k.y===b.y},copy:function(k){return k?new h(k.x,k.y):null},invert:function(k){return new h(-k.x,-k.y)},offset:function(k,b,o){return new h(k.x+b,k.y+(o?o:b))},edges:e,floor:function(k){for(var b=Array(k.length),o=
k.length;o--;)b[o]=new T5.Vector(~~k[o].x,~~k[o].y);return b},distance:function(k,b){return e(k,b).total},simplify:function(k,b){if(!k)return null;b=b?b:m.VECTOR_SIMPLIFICATION;for(var o=[],p=null,n=k.length;n--;){var t=k[n];if(include=!p||n===0||Math.abs(t.x-p.x)+Math.abs(t.y-p.y)>b){o.unshift(t);p=t}}return o},theta:function(k,b,o){o=Math.asin((k.y-b.y)/o);return k.x>b.x?o:Math.PI-o},pointOnEdge:function(k,b,o,p){b=new h(Math.cos(o)*p,Math.sin(o)*p);return new h(k.x-b.x,k.y-b.y)},getRect:function(k){var b=
k.length;if(b>1)return new l(Math.min(k[0].x,k[b-1].x),Math.min(k[0].y,k[b-1].y),Math.abs(k[0].x-k[b-1].x),Math.abs(k[0].y-k[b-1].y))},toString:function(k){return k.x+", "+k.y}}}(),l=function(g,e,k,b){return{origin:new h(g,e),dimensions:new a(k,b),invalid:false}},d=function(){return{bottomRight:function(g){return m.offset(g.origin,g.dimensions.width,g.dimensions.height)},empty:function(){return new l(0,0,0,0)},copy:function(g){return g?new l(g.origin.x,g.origin.y,g.dimensions.width,g.dimensions.height):
null},getCenter:function(g){return new h(g.origin.x+g.dimensions.width/2,g.origin.y+g.dimensions.height/2)},isEmpty:function(g){return g.dimensions.width===0||g.dimensions.height===0},union:function(){if(!(arguments.length<2)){for(var g=arguments[0].origin.y,e=arguments[0].origin.x,k=g+arguments[0].dimensions.height,b=e+arguments[0].dimensions.width,o=Array.prototype.slice.call(arguments,1),p=o.length;p--;){var n=o[p].origin.y,t=o[p].origin.x,y=n+o[p].dimensions.height,A=t+o[p].dimensions.width;g=
g<n?g:n;e=e<t?e:t;k=k>y?k:y;b=b>A?b:A}arguments[0].origin.x=e;arguments[0].origin.y=g;arguments[0].dimensions.width=b-e;arguments[0].dimensions.height=k-g}}}}(),a=function(g,e){return{width:g?g:0,height:e?e:0}},f=function(){return{getAspectRatio:function(g){return g.height!==0?g.width/g.height:1},getCenter:function(g){return new h(g.width/2,g.height/2)},getSize:function(g){return Math.sqrt(Math.pow(g.width,2)+Math.pow(g.height,2))}}}();return{ex:COG.extend,ticks:function(){return(new Date).getTime()},
Vector:h,V:m,Dimensions:a,D:f,Rect:l,R:d}}();
(function(){function h(){for(;y.length>0;){var u=y.shift();document.location=u}t=0}function m(u){for(var v=true,C=A.length;C--;)v=v&&u!=A[C];return v}function l(u,v){var C=[];for(var x in v)x&&C.push(x+"="+escape(v[x]));return"tile5://"+u+"/"+(C.length>0?"?"+C.join("&"):"")}function d(u,v){m(u)&&COG.Log.info("would push url: "+l(u,v))}function a(u,v){if(m(u)){y.push(l(u,v));t||(t=setTimeout(h,100))}}function f(u){return function(v,C,x){(x?x:u?document.body:document).addEventListener(v,C,false)}}function g(u){return function(v,
C,x){(x?x:u?document.body:document).removeEventListener(v,C,false)}}function e(u,v,C){(C?C:document).attachEvent("on"+u,v)}function k(u,v,C){(C?C:document).detachEvent("on"+u,v)}function b(){o={base:{name:"Unknown",bindEvent:f(),unbindEvent:g(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:d,targetFps:null},ie:{name:"MSIE",regex:/msie/i,bindEvent:e,unbindEvent:k,requireFastDraw:false,targetFps:25},
ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:a,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:a},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:a},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:f(true),unbindEvent:g(true),supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},bridgeNotify:a},froyo:{name:"Android OS >= 2.2",
regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:a}};p=[o.froyo,o.android,o.ipod,o.iphone,o.ipad,o.ie]}var o=null,p=[],n=null,t=0,y=[],A=["view.wake","tile.loaded"];T5.getConfig=function(){o||b();if(!n){COG.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var u=0;u<p.length;u++){var v=p[u];if(v.regex&&v.regex.test(navigator.userAgent)){n=T5.ex({},o.base,v);COG.Log.info("PLATFORM DETECTED AS: "+n.name);break}}if(!n){COG.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
n=o.base}COG.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return n}})();
T5.Dispatcher=function(){var h=[],m={execute:function(l){var d=m.findAction(l);d&&d.execute.apply(d,Array.prototype.slice.call(arguments,1))},findAction:function(l){for(var d=h.length;d--;)if(h[d].id==l)return h[d];return null},getRegisteredActions:function(){return[].concat(h)},getRegisteredActionIds:function(){for(var l=[],d=h.length;d--;)h[d].id&&l.push(h[d].id);return l},registerAction:function(l){l&&l.id&&h.push(l)},Action:function(l){l=T5.ex({autoRegister:true,id:"",title:"",icon:"",hidden:false,
execute:null},l);var d={id:l.id,execute:function(){l.execute&&l.execute.apply(this,arguments)},getParam:function(a){return l[a]?l[a]:""},toString:function(){return COG.formatStr("{0} [title = {1}, icon = {2}]",d.id,l.title,l.icon)}};l.autoRegister&&m.registerAction(d);return d},Agent:function(l){l=COG.extend({name:"Untitled",translator:null,execute:null},l);var d={getName:function(){return l.name},getParam:function(a){return l[a]},getId:function(){return COG.toID(d.getName())},run:function(a,f){if(l.execute){var g=
l.translator?l.translator(a):a;l.execute.call(d,g,function(e,k){f&&f(e,k,g)})}}};return d},runAgents:function(l,d,a){for(var f=0;f<l.length;f++)l[f].run(d,a)}};return m}();
T5.Resources=function(){var h="",m={},l={getPath:function(d){return/^(file|https?|\/)/.test(d)?d:h+d},setBasePath:function(d){h=d},loadResource:function(d){d=T5.ex({filename:"",cacheable:true,dataType:null,callback:null},d);var a=function(f){d.callback&&COG.Log.watch("CALLING RESOURCE CALLBACK",function(){d.callback(f)})};d.cacheable&&m[d.filename]?a(m[d.filename]):COG.xhr({url:l.getPath(d.filename),dataType:d.dataType,success:function(f){if(d.cacheable)m[d.filename]=f;a(f)},error:function(f,g,e){COG.Log.error("error loading resource ["+
d.filename+"], error = "+e)}})},loadSnippet:function(d,a){/\.\w+$/.test(d)||(d+=".html");l.loadResource({filename:"snippets/"+d,callback:a,dataType:"html"})}};return l}();
T5.Images=function(){function h(){if(!t){var u=T5.getConfig().maxImageLoads;t=COG.Loopage.join({execute:function(v,C){if(!u||o.length<u){var x=b.shift();if(x){o[o.length]=x;x.image.onload=l;x.image.src=T5.Resources.getPath(x.url);x.requested=T5.ticks()}else C.trigger("complete")}},frequency:10});t.bind("complete",function(){t=null})}}function m(){y=true;try{var u=p.length/2>>0;if(u>0){p.sort(function(C,x){return C.created-x.created});for(var v=u;v--;)delete f[p[v].url];p.splice(0,u)}}finally{y=false}COG.say("imagecache.cleared")}
function l(){var u=e[this.id],v;if(u&&u.image.complete&&u.image.width>0){u.loaded=true;u.hitCount=1;for(v=o.length;v--;)if(o[v].image.src==this.src){o.splice(v,1);break}if(u.background||u.postProcess||u.drawBackground||u.customDraw)if(u.image){v=a(u.realSize?u.realSize.width:image.width,u.realSize?u.realSize.height:image.height);var C=v.getContext("2d"),x=u.offset?u.offset:new T5.Vector;u.background&&C.drawImage(u.background,0,0);u.drawBackground&&u.drawBackground(C);u.customDraw?u.customDraw(C,u):
C.drawImage(u.image,x.x,x.y);u.postProcess&&u.postProcess(C,u);u.image=v}for(v=u.callbacks.length;v--;)u.callbacks[v]&&u.callbacks[v](this,false);u.callbacks=[];p[p.length]={url:this.src,created:u.requested};delete e[this.id];h()}}function d(u,v,C){var x=f[u];if(x){x.hitCount++;x.image.complete&&x.image.width>0&&v?v(x.image,true):x.callbacks.push(v)}else{x=T5.ex({url:u,image:new Image,loaded:false,created:T5.ticks(),requested:null,hitCount:0,callbacks:[v]},C);x.image.id="resourceLoaderImage"+k++;
f[u]=x;e[x.image.id]=x;b[b.length]=x;h()}return x}function a(u,v){var C=document.createElement("canvas");C.width=u?u:0;C.height=v?v:0;if(typeof FlashCanvas!=="undefined"){C.id="tmpCanvas"+g++;C.style.cssText="position: absolute; top: -"+(v-1)+"px; left: -"+(u-1)+"px;";document.body.appendChild(C);FlashCanvas.initElement(C)}typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(C);return C}var f={},g=0,e={},k=0,b=[],o=[],p=[],n=0,t=null,y=false,A={avgImageSize:25,loadTimeout:10,cancelLoad:function(){o=
[]},get:function(u,v){var C=null,x=null;y||(C=f[u]);if((x=C?C.image:null)&&(x.getContext||x.complete&&x.width>0))return x;else d(u,v);return null},load:d,newCanvas:a,reset:function(){f={}},stats:function(){return{imageLoadingCount:o.length,queuedImageCount:b.length,imageCacheFullness:n}}};COG.Loopage.join({execute:function(u){for(var v=false,C=0,x=T5.getConfig();C<o.length;)if(u-o[C].requested>A.loadTimeout*1E3){o.splice(C,1);v=true}else C++;v&&h();if(x&&x.imageCacheMaxSize){n=p.length*A.avgImageSize/
x.imageCacheMaxSize;n>=1&&m()}},frequency:2E4});return A}();
T5.TimeLord=function(){var h=/^P(\d+Y)?(\d+M)?(\d+D)?$/,m=/^(\d+H)?(\d+M)?(\d+S)?$/,l=function(a,f){return{days:a?a:0,seconds:f?f:0}},d={8601:function(a){a=a.split("T");var f=null;f=null;var g=0,e=0;h.lastIndex=-1;f=h.exec(a[0]);g+=f[3]?parseInt(f[3].slice(0,-1),10):0;m.lastIndex=-1;f=m.exec(a[1]);e+=f[1]?parseInt(f[1].slice(0,-1),10)*3600:0;e+=f[2]?parseInt(f[2].slice(0,-1),10)*60:0;e+=f[3]?parseInt(f[3].slice(0,-1),10):0;return new l(g,e)}};return{Duration:l,addDuration:function(){for(var a=new l,
f=arguments.length;f--;){a.days+=arguments[f].days;a.seconds+=arguments[f].seconds}if(a.seconds>=86400){a.days+=~~(a.seconds/86400);a.seconds%=86400}return a},parseDuration:function(a,f){var g=f?d[f]:null;if(g)return g(a);COG.Log.warn("Could not find duration parser for specified format: "+f);return new l},formatDuration:function(a){var f,g,e="";if(a.days)e=a.days+" days ";if(a.seconds){a=a.seconds;if(a>=3600){f=~~(a/3600);a-=f*3600}if(a>=60){g=Math.round(a/60);a-=g*60}if(f)e=e+f+(f>1?" hrs ":" hr ")+
(g?(g>10?g:"0"+g)+" min ":"");else if(g)e=e+g+" min";else if(a>0)e=e+(a>10?a:"0"+a)+" sec"}return e}}}();
(function(){var h=Math.PI*2,m=Math.PI/2,l=Math.abs,d=Math.pow,a=Math.sin,f=Math.asin,g=Math.cos,e=1.70158,k={linear:function(b,o,p,n){return p*b/n+o},backin:function(b,o,p,n){return p*(b/=n)*b*((e+1)*b-e)+o},backout:function(b,o,p,n){return p*((b=b/n-1)*b*((e+1)*b+e)+1)+o},backinout:function(b,o,p,n){return(b/=n/2)<1?p/2*b*b*(((e*=1.525)+1)*b-e)+o:p/2*((b-=2)*b*(((e*=1.525)+1)*b+e)+2)+o},bouncein:function(b,o,p,n){return p-k.bounceout(n-b,0,p,n)+o},bounceout:function(b,o,p,n){return(b/=n)<1/2.75?
p*7.5625*b*b+o:b<2/2.75?p*(7.5625*(b-=1.5/2.75)*b+0.75)+o:b<2.5/2.75?p*(7.5625*(b-=2.25/2.75)*b+0.9375)+o:p*(7.5625*(b-=2.625/2.75)*b+0.984375)+o},bounceinout:function(b,o,p,n){return b<n/2?k.bouncein(b*2,0,p,n)/2+o:k.bounceout(b*2-n,0,p,n)/2+p/2+o},cubicin:function(b,o,p,n){return p*(b/=n)*b*b+o},cubicout:function(b,o,p,n){return p*((b=b/n-1)*b*b+1)+o},cubicinout:function(b,o,p,n){if((b/=n/2)<1)return p/2*b*b*b+o;return p/2*((b-=2)*b*b+2)+o},elasticin:function(b,o,p,n,t,y){if(b==0)return o;if((b/=
n)==1)return o+p;y||(y=n*0.3);if(!t||t<l(p)){t=p;p=y/4}else p=y/h*f(p/t);return-(t*d(2,10*(b-=1))*a((b*n-p)*h/y))+o},elasticout:function(b,o,p,n,t,y){var A;if(b==0)return o;if((b/=n)==1)return o+p;y||(y=n*0.3);if(!t||t<l(p)){t=p;A=y/4}else A=y/h*f(p/t);return t*d(2,-10*b)*a((b*n-A)*h/y)+p+o},elasticinout:function(b,o,p,n,t,y){var A;if(b==0)return o;if((b/=n/2)==2)return o+p;y||(y=n*0.3*1.5);if(!t||t<l(p)){t=p;A=y/4}else A=y/h*f(p/t);if(b<1)return-0.5*t*d(2,10*(b-=1))*a((b*n-A)*h/y)+o;return t*d(2,
-10*(b-=1))*a((b*n-A)*h/y)*0.5+p+o},quadin:function(b,o,p,n){return p*(b/=n)*b+o},quadout:function(b,o,p,n){return-p*(b/=n)*(b-2)+o},quadinout:function(b,o,p,n){if((b/=n/2)<1)return p/2*b*b+o;return-p/2*(--b*(b-2)-1)+o},sinein:function(b,o,p,n){return-p*g(b/n*m)+p+o},sineout:function(b,o,p,n){return p*a(b/n*m)+o},sineinout:function(b,o,p,n){return-p/2*(g(Math.PI*b/n)-1)+o}};T5.easing=function(b){return k[b.replace(/[\-\_\s\.]/g,"").toLowerCase()]};T5.registerEasingType=function(b,o){k[b.replace(/[\-\_\s\.]/g,
"").toLowerCase()]=o}})();
T5.Tween=function(h){h=T5.ex({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:T5.easing("sine.out"),complete:null,cancelOnInteract:false},h);var m=T5.ticks(),l=[],d=false,a=0,f=0,g={cancelOnInteract:h.cancelOnInteract,isComplete:function(){return d},triggerComplete:function(e){h.complete&&h.complete(e)},update:function(e){try{var k=h.tweenFn(e-m,a,f,h.duration);if(h.target)h.target[h.property]=k;for(var b=l.length;b--;)l[b](k,void 0);if(d=m+h.duration<=e){if(h.target)h.target[h.property]=
h.tweenFn(h.duration,a,f,h.duration);for(var o=l.length;o--;)l[o](k,true)}}catch(p){COG.Log.exception(p)}},requestUpdates:function(e){l.push(e)}};a=h.target&&h.property&&h.target[h.property]?h.target[h.property]:h.startValue;if(typeof h.endValue!=="undefined")f=h.endValue-a;if(f==0)d=true;T5.wakeTweens();return g};
(function(){function h(a){if(d)return m.length;d=true;try{for(var f=0;f<m.length;)if(m[f].isComplete()){m[f].triggerComplete(false);m.splice(f,1)}else{m[f].update(a);f++}}finally{d=false}m.length===0&&l.trigger("complete");return m.length}var m=[],l=null,d=false;T5.tweenValue=function(a,f,g,e,k){a=new T5.Tween({startValue:a,endValue:f,tweenFn:g,complete:e,duration:k});m.push(a);return a};T5.tween=function(a,f,g,e,k,b){a=new T5.Tween({target:a,property:f,endValue:g,tweenFn:e,duration:b,complete:k});
m.push(a);return a};T5.tweenVector=function(a,f,g,e,k,b){var o=[];if(a){var p=a.x==f,n=a.y==g;p||o.push(T5.tween(a,"x",f,e,function(){(p=true)&&n&&k()},b));n||o.push(T5.tween(a,"y",g,e,function(){n=true;p&&n&&k()},b))}return o};T5.cancelAnimation=function(a){if(!d){d=true;try{for(var f=0;f<m.length;)if(!a||a(m[f])){m[f].triggerComplete(true);m.splice(f,1)}else f++}finally{d=false}}};T5.isTweening=function(){return m.length>0};T5.wakeTweens=function(){if(!l){l=COG.Loopage.join({execute:h,frequency:20});
l.bind("complete",function(){l=null})}}})();(function(){var h={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,PINCH:16,FREEZE:128};T5.viewState=function(){for(var m=0,l=arguments.length;l--;){var d=h[arguments[l].toUpperCase()];if(d)m|=d}return m}})();
T5.ViewLayer=function(h){h=T5.ex({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:T5.viewState("ACTIVE","ANIMATING","PAN","PINCH")},h);var m=null,l=false,d=false,a=h.supportFastDraw,f=h.id,g=T5.viewState("ACTIVE"),e=h.validStates,k=0,b=0,o=T5.ex({addToView:function(p){p.setLayer(f,o)},shouldDraw:function(p,n,t){p=(p&e)!==0&&(l?a:true);return p=d||t||k!==n.x||b!==n.y},cycle:function(){},draw:function(){},remove:function(){o.trigger("remove",o)},changed:function(){d=true;o.trigger("changed",
o);m&&m.trigger("invalidate")},getId:function(){return f},setId:function(p){f=p},getParent:function(){return m},setParent:function(p){l=(m=p)?m.fastDraw&&displayState!==g:false;o.trigger("parentChange",m)}},h);COG.observable(o);o.bind("drawComplete",function(p,n){d=false;k=n.x;b=n.y});return o};
T5.View=function(h){function m(z,D,L,T){fa=oa;C();if(T&&h.inertia){P=true;b(R+D,r+L,h.panAnimationEasing,h.panAnimationDuration)}else T||b(R+D,r+L)}function l(){fa=na;P=false;COG.Loopage.join({execute:C,after:50,single:true})}function d(z,D){Z=ua(z);aa=ua(D);var L=E(Z.dimensions),T=E(aa.dimensions);da=K(Z);M=K(aa);O=Z&&L!==0?T/L:1}function a(z,D,L){d(D,L);if(S=O!==1){fa=ea;C()}}function f(z,D,L,T){d(D,L);if(h.adjustScaleFactor){O=h.adjustScaleFactor(O);COG.Log.info("scale factor adjusted to: "+O)}if(T<
h.pinchZoomAnimateTrigger){n(la,O,da,t(),T5.easing("sine.out"),function(){e();O=1},300);O=la}else{e();O=1}}function g(z,D,L){H.zoom(D,Math.min(Math.pow(2,Math.round(Math.log(L))),8),500)}function e(){var z=Z?t():M;O=Math.round(O*10)/10;S=false;for(var D=x.length;D--;)x[D].trigger("scale",O,z);H.trigger("scale",O,z);fa=na;C()}function k(){clearTimeout(ca);ca=setTimeout(o,50)}function b(z,D,L,T,X){function ga(){ia+=1;if(ia>=2){l(0,0);X&&X()}}var ia=0;if(L){z=T5.tweenValue(R,z,L,ga,T);D=T5.tweenValue(r,
D,L,ga,T);z.cancelOnInteract=true;z.requestUpdates(function(ka){R=ka;P=true;C()});D.cancelOnInteract=true;D.requestUpdates(function(ka){r=ka;P=true;C()})}else{R=z;r=D}}function o(){var z;if(I){COG.Touch.release(I);if(h.autoSize&&I.parentNode){z=I.parentNode.getBoundingClientRect();if(z.height!==0&&z.width!==0){I.height=z.height;I.width=z.width}}try{if(!I.id)I.id=h.id+"_canvas";$=I.getContext("2d");$.clearRect(0,0,I.width,I.height)}catch(D){COG.Log.exception(D);throw Error("Could not initialise canvas on specified view element");
}qa=COG.Touch.capture(I,{observable:H});if(J.height!==I.height||J.width!==I.width){J=new T5.Dimensions(I.width,I.height);H.trigger("resize",I.width,I.height);for(z=U;z--;)x[z].trigger("resize",I.width,I.height)}h.inertia&&qa.inertiaEnable(h.panAnimationDuration,J);for(z=U;z--;)x[z].trigger("contextChanged",$);v()}}function p(z,D){D.setId(z);D.added=T5.ticks();D.bind("remove",function(){H.removeLayer(z)});D.trigger("contextChanged",$);D.setParent(H);x.push(D);x.sort(function(L,T){var X=T.zindex-L.zindex;
if(X===0)X=T.added-L.added;return X});U=x.length;return D}function n(z,D,L,T,X,ga,ia){function ka(){ga&&ga();e();O=1;ja=null}S=true;da=T5.V.copy(L);M=T5.V.copy(T);Z=null;if(X)T5.tweenValue(0,D-z,X,ka,ia?ia:1E3).requestUpdates(function(pa){ja=pa/(D-z);O=z+pa;fa=ea;C();H.trigger("animate")});else{O=targetScaleFactor;ka()}}function t(){var z=T5.D.getCenter(J),D=T5.V.distance([M,z]),L=T5.V.theta(M,z,D),T=T5.V.diff(da,M);z=T5.V.pointOnEdge(M,z,L,D/O);z.x+=T.x;z.y+=T.y;return z}function y(){H.trigger("idle");
N=true;Q=0}function A(z,D,L,T,X){if(F)D=T5.viewState("FROZEN");var ga=(D&ea)!==0,ia=0;if(s||ga){z.clearRect(0,0,I.width,I.height);s=false}if(ga){T5.D.getCenter(J);var ka=(ja?ja:1)/2,pa=T5.V.diff(da,M);if(Z){W.x=M.x+pa.x;W.y=M.y+pa.y}else{W.x=M.x-pa.x*ka;W.y=M.y-pa.y*ka}L=T5.V.offset(L,W.x,W.y)}z.save();try{la=O;if(G!==1)z.scale(G,G);else if(ga){z.translate(M.x,M.y);z.scale(O,O)}for(ia=U;ia--;)if(x[ia].shouldDraw(D,L,T)){x[ia].draw(z,L,J,D,H,T,X);x[ia].trigger("drawComplete",L,X)}}finally{z.restore()}H.trigger("drawComplete",
L,X);COG.Log.trace("draw complete",X)}function u(z,D){var L=false,T=ba?ba:P?oa:fa,X=!P&&(T===ea||T===oa),ga=ha||T===oa||T===ea||T5.isTweening();q.x=R>>0;q.y=r>>0;if(X){T5.cancelAnimation(function(ia){return ia.cancelOnInteract});N=false;if(Q!==0){clearTimeout(Q);Q=0}}for(X=U;X--;){if(x[X].animated)fa|=ra;L=x[X].cycle(z,q,fa,ga)||L}ga=ga||(fa&ra)!==0;if(L=L||ga||O!==1&&O!==ma){A($,T,q,ga,z);ma=O;ha=false}if(!L&&B===0&&!sa){if(!N&&Q===0)Q=setTimeout(y,500);D.trigger("complete")}B=0;COG.Log.trace("Completed draw cycle",
z)}function v(){ha=true;C()}function C(){B+=1;if(!(F||w)){w=COG.Loopage.join({execute:u,frequency:ta});w.bind("complete",function(){w=null})}}h=T5.ex({id:COG.objId("view"),container:"",fastDraw:false,inertia:true,pannable:true,scalable:true,panAnimationEasing:T5.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:true,tapExtent:10,fps:25},h);var x=[],U=0,I=document.getElementById(h.container),$=null,R=0,r=0,q=new T5.Vector,s=false,w=null,F=false,
G=1,J=new T5.Dimensions,B=0,M=null,N=false,P=false,Q=0,Y=0,W=new T5.Vector,V=0,S=false,Z=null,aa=null,ba=null,ha=false,ca=0,O=1,ma=0,la=1,ja=null,da=null,sa=typeof FlashCanvas!=="undefined",ta=~~(1E3/h.fps),qa=null,na=T5.viewState("ACTIVE"),oa=T5.viewState("PAN"),ea=T5.viewState("PINCH"),ra=T5.viewState("ANIMATING"),fa=na,ua=T5.V.getRect,E=T5.D.getSize,K=T5.R.getCenter,H={id:h.id,deviceScaling:G,fastDraw:h.fastDraw||T5.getConfig().requireFastDraw,animate:function(z,D,L,T,X){n(O,z,D,L,T,X)},centerOn:function(z){R=
z.x-I.width/2;r=z.y-I.height/2},getDimensions:function(){return J},getZoomCenter:function(){return W},getLayer:function(z){for(var D=0;D<U;D++)if(x[D].getId()==z)return x[D];return null},setLayer:function(z,D){for(var L=0;L<U;L++)if(x[L].getId()===z){x.splice(L,1);break}D&&p(z,D);v()},eachLayer:function(z){for(var D=U;D--;)z(x[D])},clearBackground:function(){COG.Log.info("CALL OF DEPRECATED METHOD CLEAR BACKGROUND");s=true;v()},invalidate:v,freeze:function(){F=true},unfreeze:function(){F=false;C()},
resize:function(z,D){if(I){h.autoSize=false;I.width=z;I.height=D;o();H.trigger("resize",I.width,I.height)}},scale:function(z,D,L,T,X){T||(T=T5.D.getCenter(J));X||(X=T5.D.getCenter(J));H.animate(z,T,X,D,L);return H},removeLayer:function(z){a:{for(var D=U;D--;)if(x[D].getId()==z){z=D;break a}z=-1}if(z>=0&&z<U){COG.say("layer.removed",{layer:x[z]});x.splice(z,1);v()}U=x.length},stateOverride:function(z){ba=z},getOffset:function(){return q},updateOffset:b,zoom:function(z,D,L){P=false;O=D;S=O!==1;da=T5.D.getCenter(J);
M=O>1?T5.V.copy(z):T5.D.getCenter(J);Z=null;clearTimeout(Y);if(S){fa=ea;C();if(L)Y=setTimeout(function(){e();O=1},parseInt(L,10))}}};G=T5.getConfig().getScaling();H.markers=p("markers",new T5.MarkerLayer);COG.observable(H);H.bind("wake",C);H.bind("invalidate",v);if(h.pannable){H.bind("pan",m);H.bind("panEnd",l);H.bind("inertiaCancel",function(){P=false;C()})}if(h.scalable){H.bind("pinchZoom",a);H.bind("pinchZoomEnd",f);H.bind("wheelZoom",g)}H.bind("tap",function(z,D,L){for(var T=T5.V.offset(L,R,r),
X=x.length;X--;)z.cancel=z.cancel||x[X].trigger("tap",D,L,T).cancel});COG.configurable(H,["inertia","container","rotation","tapExtent","scalable","pannable"],COG.paramTweaker(h,null,{container:function(z,D){I=document.getElementById(D);o()},rotation:function(z,D){V=D}}),true);o();h.autoSize&&window.addEventListener("resize",k,false);return H};
T5.PathLayer=function(h){function m(o){o.syncVectors(f);g&&o.syncVectors(g);b.trigger("tidy")}h=T5.ex({style:"waypoints",pixelGeneralization:8,zindex:50},h);var l=false,d=[],a=null,f=[],g=null,e=0,k=[],b=T5.ex(new T5.ViewLayer(h),{getAnimation:function(o,p,n,t){var y="pathAnimation"+e++;k.push(y);return new T5.AnimatedPathLayer({id:y,path:d,zindex:h.zindex+1,easing:o?o:T5.easing("sine.inout"),duration:p?p:5E3,drawIndicator:n,autoCenter:t?t:false})},cycle:function(o,p,n,t){return t},draw:function(o,
p){var n,t=d.length;o.save();try{T5.applyStyle(o,h.style);if(t>0){o.beginPath();o.moveTo(d[t-1].x-p.x,d[t-1].y-p.y);for(n=t;n--;)o.lineTo(d[n].x-p.x,d[n].y-p.y);o.stroke();if(a){o.fillStyle=h.waypointFillStyle;for(n=a.length;n--;){o.beginPath();o.arc(a[n].x-p.x,a[n].y-p.y,2,0,Math.PI*2,false);o.stroke();o.fill()}}}}finally{o.restore()}l=false},updateCoordinates:function(o,p){var n=b.getParent();n=n?n.getTileLayer():null;f=o;g=p;COG.Log.info("updating coordinates, grid = "+n);n&&m(n)}});b.bind("gridUpdate",
function(o,p){m(p);for(var n=k.length;n--;)COG.say("layer.remove",{id:k[n]});k=[]});b.bind("tidy",function(){d=T5.V.simplify(f,h.pixelGeneralization);a=T5.V.simplify(g,h.pixelGeneralization);l=true;b.changed()});return b};
T5.ShapeLayer=function(h){h=T5.ex({zindex:80,style:null},h);var m=[],l=false,d=T5.ex(new T5.ViewLayer(h),{add:function(a){m.unshift(a)},cycle:function(){return l},draw:function(a,f,g,e){var k=f.x;f=f.y;var b=g.width;g=g.height;a.save();try{T5.applyStyle(a,h.style);for(var o=m.length;o--;){var p=m[o].style,n=p?T5.applyStyle(a,p):null;m[o].draw(a,k,f,b,g,e);n&&T5.applyStyle(a,n)}}finally{a.restore()}l=false}});d.bind("gridUpdate",function(a,f){for(var g=m.length;g--;)m[g].resync(f);l=true;d.changed()});
d.bind("parentChange",function(a,f){var g=f?f.getTileLayer():null;if(g)for(var e=m.length;e--;)m[e].resync(g)});COG.configurable(d,["style"],COG.paramTweaker(h,null,null),true);return d};T5.PolyLayer=T5.ShapeLayer;T5.Shape=function(h){h=T5.ex({style:null},h);return T5.ex(h,{draw:function(){},resync:function(){}})};
T5.Poly=function(h,m){m=T5.ex({fill:false,simplify:false},m);var l=false,d=m.fill,a=m.simplify,f=T5.viewState("PINCH"),g=[],e=T5.ex(new T5.Shape(m),{draw:function(k,b,o,p,n,t){if(l){var y=true;t=(t&f)!==0;var A=false;k.beginPath();for(var u=g.length;u--;){var v=g[u].x-b,C=g[u].y-o;if(y){k.moveTo(v,C);y=false}else k.lineTo(v,C);A=A||!t&&v>=0&&v<=p&&C>=0&&C<=n}if(A){d&&k.fill();k.stroke()}}},resync:function(k){k.syncVectors(h);g=T5.V.floor(a?T5.V.simplify(h):h)}});l=h&&h.length>=2;return e};
T5.AnimatedPathLayer=function(h){function m(e,k,b){e.fillStyle="#FFFFFF";e.strokeStyle="#222222";e.beginPath();e.arc(b.x,b.y,4,0,Math.PI*2,false);e.stroke();e.fill()}h=T5.ex({path:[],id:COG.objId("pathAni"),easing:T5.easing("sine.inout"),validStates:T5.viewState("ACTIVE","PAN","PINCH"),drawIndicator:null,duration:2E3,autoCenter:false},h);var l=T5.V.edges(h.path),d,a=null,f=0;T5.tweenValue(0,l.total,h.easing,function(){g.remove()},h.duration).requestUpdates(function(e,k){f=e;k&&g.remove()});var g=
T5.ex(new T5.ViewLayer(h),{cycle:function(){for(var e=0;e<l.accrued.length&&l.accrued[e]<f;)e++;a=null;if(e<h.path.length-1){var k=f-(e>0?l.accrued[e-1]:0),b=h.path[e],o=h.path[e+1];d=T5.V.theta(b,o,l.edges[e]);a=T5.V.pointOnEdge(b,o,d,k);if(h.autoCenter)(e=g.getParent())&&e.centerOn(a)}return a},draw:function(e,k){if(a)(h.drawIndicator?h.drawIndicator:m)(e,k,new T5.Vector(a.x-k.x,a.y-k.y),d)}});return g};
T5.Marker=function(h){function m(b,o,p,n){d=b;a=o;f=p;g=n}h=T5.ex({xy:new T5.Vector,offset:true,tweenIn:null,animationSpeed:null},h);var l=false,d=0,a=0,f=0,g=0,e=h.offset,k=T5.ex(h,{isNew:true,isAnimating:function(){return l},draw:function(b,o,p,n,t){if(k.isNew&&h.tweenIn){var y=k.xy.y;k.xy.y=o.y-20;l=true;T5.tween(k.xy,"y",y,h.tweenIn,function(){k.xy.y=y;l=false},h.animationSpeed?h.animationSpeed:250+Math.random()*500)}k.drawMarker(b,o,k.xy.x-(e?o.x:0),k.xy.y-(e?o.y:0),p,n,t);k.isNew=false},drawMarker:function(b,
o,p,n){b.beginPath();b.arc(p,n,4,0,Math.PI*2,false);b.fill();m(p-4,n-4,8,8)},hitTest:function(b,o){return b>=d&&b<=d+f&&o>=a&&o<=a+g},updateBounds:m});COG.observable(k);return k};
T5.ImageMarker=function(h){h=T5.ex({image:null,imageUrl:null,animatingImage:null,animatingImageUrl:null,imageAnchor:null,rotation:0,scale:1,opacity:1},h);var m=h.imageAnchor?T5.V.invert(h.imageAnchor):null,l=T5.ex(new T5.Marker(h),{drawMarker:function(d,a,f,g){if((a=l.isAnimating()&&l.animatingImage?l.animatingImage:l.image)&&a.complete&&a.width>0){m||(m=new T5.Vector(-a.width>>1,-a.height>>1));var e=l.scale,k=f+~~(m.x*e),b=g+~~(m.y*e),o=~~(a.width*e),p=~~(a.height*e);l.updateBounds(k,b,o,o);if(l.rotation||
l.opacity!==1){d.save();try{d.globalAlpha=l.opacity;d.translate(f,g);d.rotate(l.rotation);d.drawImage(a,m.x*e,m.y*e,o,p)}finally{d.restore()}}else d.drawImage(a,k,b,o,p)}}});if(!l.image)l.image=T5.Images.get(h.imageUrl,function(d){COG.Log.info("updating marker image to: "+d.src);l.image=d});if(!l.animatingImage)l.animatingImage=T5.Images.get(h.animatingImageUrl,function(d){l.animatingImage=d});return l};T5.Annotation=T5.Marker;T5.ImageAnnotation=T5.ImageMarker;
T5.MarkerLayer=function(h){function m(g,e){for(var k=d.length;k--;)e.syncVectors([d[k].xy])}function l(){f.changed();f.trigger("markerUpdate",d)}h=T5.ex({zindex:100},h);var d=[],a=false,f=T5.ex(new T5.ViewLayer(h),{cycle:function(){return a},draw:function(g,e,k,b,o){a=false;for(k=d.length;k--;){d[k].draw(g,e,b,f,o);a=a||d[k].isAnimating()}return a?1:0},add:function(g){if(g&&typeof g.length!=="undefined")for(var e=g.length;e--;){if(g[e])d[d.length]=g[e]}else if(g)d[d.length]=g;l()},clear:function(g){if(g)for(var e=
0;e<d.length;e++)g(d[e])&&d.splice(e,1);else d=[];l()},find:function(g){var e=[];if(g)for(var k=d.length;k--;)if(g(d[k]))e[e.length]=d[k];return e}});f.bind("tap",function(g,e,k){for(var b=[],o=k.x,p=k.y,n=d.length;n--;)if(d[n].hitTest(o,p))b[b.length]=d[n];if(b.length>0)g.cancel=f.trigger("markerTap",e,k,b).cancel});f.bind("gridUpdate",m);f.bind("changed",function(){var g=f.getParent().getTileLayer();g&&m(null,g)});return f};
T5.Style=function(h){function m(f){var g=h[f];typeof g!=="undefined"&&l.push(function(e){e[f]=g})}h=T5.ex({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},h);var l=[],d={applyToContext:function(f){for(var g=l.length;g--;)l[g](f)}};for(var a in h)m(a);return d};
(function(){var h={},m={basic:new T5.Style({lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"}),waypoints:new T5.Style({lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"})};T5.applyStyle=function(l,d){var a=T5.styles[d]?T5.styles[d]:T5.styles.basic,f;if(l&&l.canvas){f=h[l.canvas.id];h[l.canvas.id]=d}a.applyToContext(l);return f};T5.loadStyles=function(l){COG.jsonp(l,function(d){T5.resetStyles(d)})};T5.resetStyles=function(l){var d={};for(var a in l)d[a]=new T5.Style(l[a]);T5.styles=T5.ex({},
m,d)};T5.styles=m})();(function(){T5.tileSize=256;T5.Tile=function(h){return h=T5.ex({x:0,y:0,gridX:0,gridY:0,dirty:true},h)};T5.EmptyTile=function(h){h=new T5.Tile(h);h.empty=true;return h};T5.ImageTile=function(h){h=T5.ex({url:"",sessionParamRegex:null,loading:false,loaded:false},h);return new T5.Tile(h)}})();
T5.TileGrid=function(h){function m(B,M){var N=T5.Vector(B*k-t.x,M*k-t.y);return new T5.EmptyTile({gridX:N.x,gridY:N.y,empty:true})}function l(B,M,N,P){var Q=Math.max(g,e)*0.2>>0,Y=new T5.Vector;if(B<0||B+N>g)Y.x=B<0?-Q:Q;if(M<0||M+P>e)Y.y=M<0?-Q:Q;return Y}function d(B,M,N){var P=COG.Log.getTraceTicks(),Q=0;new T5.Vector(g/2,e/2);I=true;try{if(N)f=[];if(B)for(N=0;N<e;N++)for(var Y=0;Y<g;Y++){if(!f[Q]){var W=B(Y,N,p,g,e);W.gridX=Y*k-t.x;W.gridY=N*k-t.y;f[Q]=W}Q++}}finally{I=false}n=B;y=M;COG.Log.trace("tile grid populated",
P);J.changed()}function a(B,M,N,P){var Q,Y=[],W=false;B=new T5.Vector((B.x+t.x)*v>>0,(B.y+t.y)*v>>0);tilesNeeded=false;if(!s){Q=J.getParent().getDimensions();r=Math.ceil(Q.width*v)+1;q=Math.ceil(Q.height*v)+1;s=new T5.Vector((r-1)/2>>0,(q-1)/2>>0)}for(var V=q;V--;)for(var S=r;S--;){Q=S+B.x>=0&&S+B.x<g?f[(V+B.y)*g+(S+B.x)]:null;var Z=new T5.Vector(S-s.x,V-s.y);if(!Q){R=l(B.x,B.y,r,q);Q=m(S+B.x,V+B.y)}W=Q?(Q.dirty=N||Q.dirty)||W:W;Y[Y.length]={tile:Q,centerness:T5.V.absSize(Z)}}Y.sort(function(aa,ba){return ba.centerness-
aa.centerness});x||(x=Array(Y.length));for(N=Y.length;N--;){x[N]=Y[N].tile;J.prepTile(x[N],M)}$=P;return W}h=T5.ex({tileSize:T5.tileSize,center:new T5.Vector,clearBackground:false,gridSize:25,shiftOrigin:null,supportFastDraw:true,allowShift:true},h);var f=Array(Math.pow(h.gridSize,2)),g=h.gridSize,e=h.gridSize,k=h.tileSize,b=e*k,o=g*k,p=T5.V.offset(h.center,-Math.ceil(g>>1)),n=null,t=new T5.Vector,y=null,A=Math.round(k/2),u=false,v=k?1/k:0,C=true,x=null,U=false,I=false,$=0;new T5.Vector;var R=new T5.Vector;
T5.getConfig();var r,q,s,w=h.clearBackground;T5.viewState("ANIMATING");var F=T5.viewState("PAN"),G=T5.viewState("PINCH"),J=T5.ex(new T5.ViewLayer(h),{gridDimensions:new T5.Dimensions(o,b),cycle:function(B,M,N,P){if(R.x!==0||R.y!==0){P=R;var Q=h.shiftOrigin;if(!(!h.allowShift||P.x===0&&P.y===0)){var Y=COG.Log.getTraceTicks(),W=Array(f.length);W.length=f.length;for(var V=0;V<g;V++)for(var S=0;S<e;S++)W[S*g+V]=V+P.x>=0&&V+P.x<g?f[(S+P.y)*g+(V+P.x)]:null;f=W;p=Q?Q(p,P):T5.V.add(p,P);t.x+=-P.x*k;t.y+=
-P.y*k;COG.Log.trace("tile storage shifted",Y);d(n,y)}R=new T5.Vector;P=true}if(!u&&(N&G)===0)u=a(M,N,P,B);return u},find:function(B){if(!B)return null;for(var M=f.length;M--;){var N=f[M];if(N&&B(N))return N}return null},prepTile:function(){},drawTile:function(){return false},getTileSize:function(){return k},draw:function(B,M,N,P,Q,Y,W){var V=M.x;M=M.y;var S=N.width,Z=N.height,aa,ba=true;if(x){w&&B.clearRect(0,0,N.width,N.height);B.beginPath();if(C)for(var ha=x.length;ha--;){aa=x[ha];var ca=aa.gridX-
V,O=aa.gridY-M;aa.x=ca;aa.y=O;if(aa.empty){if(!w){B.clearRect(ca,O,k,k);B.rect(ca,O,k,k);ba=false}}else if(Y||aa.dirty){(aa=J.drawTile(B,aa,ca,O,P,Y,W,w))&&B.rect(ca,O,k,k);ba=ba&&aa}S=ca<S?ca:S;Z=O<Z?O:Z}if(!w&&(P&F)!==0){if(S>0){B.clearRect(0,0,S,N.height);B.rect(0,0,S,N.height)}if(Z>0){B.clearRect(0,0,N.width,Z);B.rect(0,0,N.width,Z)}}w||B.clip();ba&&!U&&Q.trigger("tileDrawComplete");u=false;U=ba}},getTileAtXY:function(B,M){for(var N=null,P=x?x.length:0;P--;){var Q=x[P];if(Q&&B>=Q.x&&M>=Q.y)if(B<=
Q.x+k&&M<=Q.y+k){N=Q;break}}COG.Log.info("looking for tile @ x: "+B+", y: "+M+", found: "+N);return N},getTileVirtualXY:function(B,M,N){B=T5.V.add(new T5.Vector(B,M),T5.V.invert(p),t);B=new T5.Vector(B.x*k,B.y*k);if(N){B.x+=A;B.y+=A}return B},populate:function(B){d(B,null,true)},syncVectors:function(){}});J.bind("resize",function(){COG.Log.info("captured resize");s=null});J.bind("scale",function(){C=false});COG.listen("imagecache.cleared",function(){for(var B=f.length;B--;)if(f[B])f[B].loaded=false});
COG.listen("tiler.repaint",function(){for(var B=f.length;B--;)if(f[B]){f[B].x=null;f[B].y=null}});return J};
T5.ImageTileGrid=function(h){function m(n){function t(){var y=T5.Images.newCanvas(32,32),A=y.getContext("2d");A.fillStyle="#BBBBBB";A.fillRect(0,0,32,32);A.fillStyle="#C3C3C3";A.fillRect(0,0,16,16);A.fillRect(16,16,16,16);return y}if(!d||n!==d.width){d=T5.Images.newCanvas(n,n);n=d.getContext("2d");n.fillStyle=typeof FlashCanvas!=="undefined"?"#666666":n.createPattern(t(),"repeat");n.fillRect(0,0,d.width,d.height)}return d}h=T5.ex({emptyTile:function(n){if(!l||n!==l.width){l=T5.Images.newCanvas(n,
n);n=l.getContext("2d");n.fillStyle="rgba(150, 150, 150, 0.1)";n.fillRect(0,0,l.width,l.height)}return l}(T5.tileSize),panningTile:null,tileOffset:new T5.Vector,tileDrawArgs:{}},h);var l=h.emptyTile,d=h.panningTile?h.panningTile:m(T5.tileSize),a=T5.viewState("ACTIVE"),f=T5.viewState("PAN"),g=T5.getConfig().requireFastDraw,e=h.tileSize?h.tileSize:T5.tileSize,k=T5.Images.get,b=T5.Images.load,o=T5.ex({background:null,overlay:null,offset:new T5.Vector,realSize:new T5.Dimensions(e,e)},h.tileDrawArgs),
p=T5.ex(new T5.TileGrid(h),{drawTile:function(n,t,y,A,u,v,C,x){v=t.url?k(t.url):null;C=false;if(v){n.drawImage(v,y,A);t.dirty=false;C=true}else if((u&f)!==0){x||n.drawImage(d,y,A);C=true}return C},initTileUrl:function(){},prepTile:function(n,t){if(n&&!n.loading&&(!g||t===a)){n.url||p.initTileUrl(n);if(!k(n.url)){n.loading=true;b(n.url,function(){n.loadTime=(new Date).getTime();n.loaded=true;n.dirty=true;p.changed()},o)}}}});return p};
T5.Tiler=function(h){h=T5.ex({container:"",drawCenter:false,datasources:{},tileLoadThreshold:"first"},h);var m=T5.ex(new T5.View(h),{getTileLayer:function(){return m.getLayer("grid0")},setTileLayer:function(l){m.setLayer("grid0",l);m.trigger("gridUpdate",l);m.eachLayer(function(d){d.trigger("gridUpdate",l)})},viewPixToGridPix:function(l){var d=m.getOffset();return new T5.Vector(l.x+d.x,l.y+d.y)},centerOn:function(l,d,a,f){var g=m.getTileLayer(),e=m.getDimensions();(g=g?g.getTileSize():0)&&m.updateOffset(l.gridX-
(e.width-g)*0.5>>0,l.gridY-(e.height-g)*0.5>>0,d,a,f)},cleanup:function(){m.removeLayer("grid0")},repaint:function(){COG.say("tiler.repaint");m.trigger("wake")},select:function(l){m.trigger("selectTile",l)}});m.bind("tap",function(l,d,a){if(l=m.getTileLayer())(a=l.getTileAtXY(a.x,a.y))&&m.trigger("selectTile",a)});return m};
T5.Geo=function(){function h(r,q){var s=null;for(var w in $)if(q){if(w==q&&$[w][r]){s=$[w];break}}else if($[w][r]){s=$[w];break}return s}function m(r,q){var s=p*Math.sin(r);return a-2*Math.atan(q*Math.pow((1-s)/(1+s),p/2))}function l(r,q,s,w){var F=0;r=r.toUpperCase();for(var G in w){var J=q[G];if(J){var B=s[G];J=B?B(r,J):COG.wordExists(r,J)?1:0;F+=J*w[G]}}return F}var d=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],a=Math.PI/2,f=Math.PI*2,g=-a,e=a,k=
-f,b=Math.PI/180,o=180/Math.PI,p=0.08181919084262157,n=null,t={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",HWY:"HIGHWAY",MWY:"MOTORWAY"},y={VECTORIZE_PER_CYCLE:500},A={getEngine:function(r){for(var q=null,s=1;!q&&s<arguments.length;s++)q=h(r,arguments[s]);q=q?q:h(r);if(!q)throw Error("Unable to find GEO engine with "+r+" capability");return q},rankGeocodeResponses:function(r,q,s){var w=[],F=R.AddressCompareFns;if(s&&s.compareFns)F=T5.ex({},F,s.compareFns);for(s=0;s<q.length;s++)w.push(new R.GeoSearchResult({caption:I.toString(q[s]),
data:q[s],pos:q[s].pos,matchWeight:l(r,q[s],F,R.GeocodeFieldWeights)}));w.sort(function(G,J){return J.matchWeight-G.matchWeight});return w},distanceToString:function(r){if(r>1E3)return~~(r/10)/100+" km";return r?r+" m":""},dist2rad:function(r){return r/6371},lat2pix:function(r){r=parseFloat(r)*b;r=Math.sin(r);var q=p*r;return Math.log((1+r)/(1-r)*Math.pow((1-q)/(1+q),p))/2},lon2pix:function(r){return parseFloat(r)*b},pix2lon:function(r){return R.normalizeLon(r)*o},pix2lat:function(r){r=Math.pow(Math.E,
-r);for(var q=a-2*Math.atan(r),s=m(q,r),w=0;w<12&&Math.abs(q-s)>1.0E-7;){q=s;s=m(q,r);w++}return s*o},normalizeLon:function(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}},u=function(r,q){return{lat:parseFloat(r?r:0),lon:parseFloat(q?q:0)}},v=function(r,q){return{min:x.parse(r),max:x.parse(q)}},C=function(r){return r=T5.ex({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},r)},x=function(){var r={calcDistance:function(q,s){if(r.empty(q)||r.empty(s))return 0;var w=
(s.lat-q.lat)*b/2,F=(s.lon-q.lon)*b/2;w=Math.sin(w)*Math.sin(w)+Math.cos(q.lat*b)*Math.cos(s.lat*b)*Math.sin(F)*Math.sin(F);return 6371*2*Math.atan2(Math.sqrt(w),Math.sqrt(1-w))},copy:function(q){return q?new u(q.lat,q.lon):null},empty:function(q){return!q||q.lat===0&&q.lon===0},equal:function(q,s){return q&&s&&q.lat==s.lat&&q.lon==s.lon},inArray:function(q,s){for(var w=x.equal,F=s.length;F--;)if(w(q,s[F]))return true;return false},inBounds:function(q,s){var w=!(x.empty(q)||x.empty(s));return w=(w=
w&&q.lat>=s.min.lat&&q.lat<=s.max.lat)&&q.lon>=s.min.lon&&q.lon<=s.max.lon},offset:function(q,s,w){var F=q.lat*b;s=F+s/6371;for(q=q.lon*b+Math.asin(Math.sin(w/6371)/Math.cos(F));s<g;)s+=Math.PI;for(;s>e;)s-=Math.PI;for(;q>f;)q-=2*Math.PI;return new u(s*o,q*o)},parse:function(q){if(q)if(typeof q.lat!=="undefined")return r.copy(q);else{if(q.split)for(var s=[" ",","],w=0;w<s.length;w++){var F=q.split(s[w]);if(F.length===2)return new u(F[0],F[1])}}else return new u;return null},parseArray:function(q){var s=
q.length,w=Array(s);for(s=s;s--;)w[s]=r.parse(q[s]);return w},fromMercatorPixels:function(q,s){return new u(T5.Geo.pix2lat(s),T5.Geo.normalizeLon(T5.Geo.pix2lon(q)))},toMercatorPixels:function(q){return new T5.Vector(T5.Geo.lon2pix(q.lon),T5.Geo.lat2pix(q.lat))},generalize:function(q,s,w){var F=q.length,G=[],J=null;w||(w=250);w/=1E3;COG.Log.info("generalizing positions, must include "+s.length+" positions");for(var B=F;B--;)if(B===0)G.unshift(q[B]);else{var M=!J||x.inArray(q[B],s)?w:x.calcDistance(J,
q[B]);if(q[B]&&M>=w){G.unshift(q[B]);J=q[B]}}COG.Log.info("generalized "+F+" positions into "+G.length+" positions");return G},vectorize:function(q,s){var w=q.length,F=Array(w);s=T5.ex({chunkSize:y.VECTORIZE_PER_CYCLE,async:true},s);if(!s.async){for(var G=w;G--;)F[G]=new T5.Geo.GeoVector(q[G]);return F}return COG.Loopage.join({frequency:10,execute:function(J,B){for(var M=0,N=s.chunkSize,P=w;P--;){F[P]=new T5.Geo.GeoVector(q[P]);M+=1;if(M>N)break}w=P;w<=0&&B.trigger("complete",F)}})},toString:function(q){return q?
q.lat+" "+q.lon:""}};return r}(),U=function(){var r={calcSize:function(q,s,w){var F=new T5.Vector(0,s.lat-q.lat);if(typeof w==="undefined")w=true;F.x=w&&q.lon>s.lon?360-q.lon+s.lon:s.lon-q.lon;return F},createBoundsFromCenter:function(q,s){var w=s/6371,F=q.lat*b,G=q.lon*b,J=F-w,B=F+w;if(J>g&&B<e){F=Math.asin(Math.sin(w)/Math.cos(F));w=G-F;if(w<k)w+=2*Math.PI;G=G+F;if(G>f)G-=2*Math.PI}else{J=Math.max(J,g);B=Math.min(B,e);w=k;G=f}return new v(new u(J*o,w*o),new u(B*o,G*o))},expand:function(q,s){return new v(new u(q.min.lat-
s,q.min.lon-R.normalizeLon(s)),new u(q.max.lat+s,q.max.lon+R.normalizeLon(s)))},forPositions:function(q,s){var w=null,F=T5.ticks();s||(s="auto");for(var G=q.length;G--;)if(w){var J=r.calcSize(w.min,q[G],false),B=r.calcSize(q[G],w.max,false);if(J.x<0)w.min.lon=q[G].lon;if(J.y<0)w.min.lat=q[G].lat;if(B.x<0)w.max.lon=q[G].lon;if(B.y<0)w.max.lat=q[G].lat}else w=new T5.Geo.BoundingBox(q[G],q[G]);if(s){if(s=="auto"){G=r.calcSize(w.min,w.max);s=Math.max(G.x,G.y)*0.3}w=r.expand(w,s)}COG.Log.trace("calculated bounds for "+
q.length+" positions",F);return w},getCenter:function(q){var s=U.calcSize(q.min,q.max);return new T5.Geo.Position(q.min.lat+s.y/2,q.min.lon+s.x/2)},getGeoHash:function(q){var s=T5.Geo.GeoHash.encode(q.min.lat,q.min.lon);q=T5.Geo.GeoHash.encode(q.max.lat,q.max.lon);COG.Log.info("min hash = "+s+", max hash = "+q)},getZoomLevel:function(q,s){var w=r.getCenter(q),F=d[Math.min(Math.round(Math.abs(w.lat)*0.05),d.length)],G=r.calcSize(q.min,q.max);w=Math.ceil(Math.log(d[3]*s.height/G.y)/Math.log(2));F=Math.ceil(Math.log(F*
s.width/G.x)/Math.log(2));return Math.min(isNaN(w)?1E3:w,isNaN(F)?1E3:F)},isEmpty:function(q){return!q||x.empty(q.min)||x.empty(q.max)},toString:function(q){return"min: "+x.toString(q.min)+", max: "+x.toString(q.max)}};return r}(),I=function(){var r=/^(\d+).*$/,q=/(\d+)\s?\-\s?(\d+)/;return{buildingMatch:function(s,w){r.lastIndex=-1;if(r.test(s))for(var F=s.replace(r,"$1"),G=w.split(","),J=0;J<G.length;J++){q.lastIndex=-1;if(q.test(G[J])){var B=q.exec(G[J]);if(F>=parseInt(B[1],10)&&F<=parseInt(B[2],
10))return true}else if(F==G[J])return true}return false},normalize:function(s){if(!s)return"";s=s.toUpperCase();if(!n){var w=[];for(var F in t)w.push(F);n=RegExp("(\\s)("+w.join("|")+")(\\s|$)","i")}n.lastIndex=-1;if(w=n.exec(s))s=s.replace(n,"$1"+t[w[2]]);return s},toString:function(s){return s.streetDetails+" "+s.location}}}(),$={},R={P:x,B:U,A:I,Radius:function(r,q){return{distance:parseInt(r,10),uom:q}},Position:u,BoundingBox:v,GeoVector:function(r){function q(w){s.pos=w;s.mercXY=x.toMercatorPixels(w)}
var s=new T5.Vector;T5.ex(s,{radsPerPixel:null,setRadsPerPixel:function(w,F,G){var J=s.mercXY;s.x=Math.abs((J.x/w>>0)+(F?F:0));s.y=Math.abs((J.y/w>>0)+(G?G:0));s.radsPerPixel=w},updatePos:q});q(r);return s},Address:C,GeocodeFieldWeights:{streetDetails:50,location:50},AddressCompareFns:{},Engine:function(r){if(!r.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var q=T5.ex({remove:function(){delete $[q.id]}},r);return $[q.id]=q},GeoSearchResult:function(r){r=T5.ex({id:null,
caption:"",resultType:"",data:null,pos:null,matchWeight:0},r);return T5.ex(r,{toString:function(){return r.caption+(r.matchWeight?" ("+r.matchWeight+")":"")}})},GeoSearchAgent:function(r){return new T5.Dispatcher.Agent(r)},GeocodingAgent:function(r){r=T5.ex({name:"Geocoding Search Agent",paramTranslator:null,execute:function(q,s){try{if(!q.reverse&&!q.freeform)address=new C(q);var w=R.getEngine("geocode");if(w)w.geocode({addresses:[q.freeform?q.freeform:address],complete:function(G,J){if(s){var B=
J;if(q.freeform)B=R.rankGeocodeResponses(q.freeform,B,R.getEngine("geocode"));s(B,r)}}})}catch(F){COG.Log.exception(F)}}},r);return new R.GeoSearchAgent(r)}};return T5.ex(R,y,A)}();
T5.Geo.GeoHash=function(){function h(m,l,d){if(l&d)m[0]=(m[0]+m[1])/2;else m[1]=(m[0]+m[1])/2}BITS=[16,8,4,2,1];BASE32="0123456789bcdefghjkmnpqrstuvwxyz";NEIGHBORS={right:{even:"bc01fg45238967deuvhjyznpkmstqrwx"},left:{even:"238967debc01fg45kmstqrwxuvhjyznp"},top:{even:"p0r21436x8zb9dcf5h7kjnmqesgutwvy"},bottom:{even:"14365h7k9dcfesgujnmqp0r2twvyx8zb"}};BORDERS={right:{even:"bcfguvyz"},left:{even:"0145hjnp"},top:{even:"prxz"},bottom:{even:"028b"}};NEIGHBORS.bottom.odd=NEIGHBORS.left.even;NEIGHBORS.top.odd=
NEIGHBORS.right.even;NEIGHBORS.left.odd=NEIGHBORS.bottom.even;NEIGHBORS.right.odd=NEIGHBORS.top.even;BORDERS.bottom.odd=BORDERS.left.even;BORDERS.top.odd=BORDERS.right.even;BORDERS.left.odd=BORDERS.bottom.even;BORDERS.right.odd=BORDERS.top.even;return{decode:function(m){var l=1,d=[],a=[];d[0]=-90;d[1]=90;a[0]=-180;a[1]=180;lat_err=90;lon_err=180;for(i=0;i<m.length;i++){c=m[i];cd=BASE32.indexOf(c);for(j=0;j<5;j++){mask=BITS[j];if(l){lon_err/=2;h(a,cd,mask)}else{lat_err/=2;h(d,cd,mask)}l=!l}}d[2]=(d[0]+
d[1])/2;a[2]=(a[0]+a[1])/2;return{latitude:d,longitude:a}},encode:function(m,l,d){var a=1,f=[],g=[],e=0,k=0;d=d?d:12;geohash="";f[0]=-90;f[1]=90;g[0]=-180;for(g[1]=180;geohash.length<d;){if(a){mid=(g[0]+g[1])/2;if(l>mid){k|=BITS[e];g[0]=mid}else g[1]=mid}else{mid=(f[0]+f[1])/2;if(m>mid){k|=BITS[e];f[0]=mid}else f[1]=mid}a=!a;if(e<4)e++;else{geohash+=BASE32[k];k=e=0}}return geohash}}}();
T5.Geo.JSON=function(){function h(k,b,o){b=m(b);k.add(new T5.Poly(b,T5.ex({fill:true},o)));return b.length}function m(k){var b=k?k.length:0,o=Array(b);for(b=b;b--;)o[b]=new T5.Geo.Position(k[b][1],k[b][0]);return T5.Geo.P.vectorize(o,f)}function l(k,b,o){return new e(k,b,o)}var d="featurecollection",a="feature",f={async:false},g={linestring:function(k,b){var o=m(b&&b.coordinates?b.coordinates:[]);k.add(new T5.Poly(o));return o.length},multilinestring:function(k,b,o){b=b&&b.coordinates?b.coordinates:
[];for(var p=0,n=b.length;n--;){p=p;var t=k,y=o,A=m(b[n]);t.add(new T5.Poly(A,y));p=p+A.length}return p},polygon:function(k,b,o){b=b&&b.coordinates?b.coordinates:[];if(b.length>0)return h(k,b[0],o);return 0},multipolygon:function(k,b,o){b=b&&b.coordinates?b.coordinates:[];for(var p=0,n=0;n<b.length;n++)p+=h(k,b[n][0],o);return p}},e=function(k,b,o){function p(x){var U=x&&x.type?x.type.toLowerCase():null;return U&&U===a?p(x.geometry):{type:U,isCollection:U?U===d:false,processor:g[U],data:x}}o=T5.ex({vectorsPerCycle:T5.Geo.VECTORIZE_PER_CYCLE,
rowPreParse:null,targetLayer:null,simplify:false},o);var n=o.vectorsPerCycle,t=o.targetLayer,y=o.rowPreParse,A=0,u=0,v=null,C;if(!k)return null;if(typeof k.length==="undefined")k=[k];u=k.length;t||(t=new T5.PolyLayer);C=COG.Loopage.join({frequency:10,execute:function(x,U){var I=0,$=A;if(!v){for(;$<u;$++){var R=p(y?y(k[$]):k[$]),r=null;if(R.isCollection){v=l(R.data.features,function(){v=null},{targetLayer:t});r=1}else if(R.processor)r=R.processor(t,R.data,o);I+=r?r:1;if(I>=n)break}A=$+1;!v&&A>=u&&
U.trigger("complete")}}});C.bind("complete",function(){b&&b(t)});return C};return{parse:l}}();
T5.Geo.LocationSearch=function(h){function m(g,e){navigator.geolocation.clearWatch(d);d=0;if(a){clearTimeout(a);a=0}e&&e([g],h)}function l(g){COG.Log.info("caught location tracking error:",g)}h=T5.ex({name:"Geolocation Search",requiredAccuracy:null,searchTimeout:5E3,watch:false},h);var d=0,a=0,f=null;return new T5.Geo.GeoSearchAgent(T5.ex({execute:function(g,e){if(navigator.geolocation&&!d){d=navigator.geolocation.watchPosition(function(k){var b=new T5.Geo.Position(k.coords.latitude,k.coords.longitude);
k=new T5.Geo.GeoSearchResult({id:1,caption:"Current Location",pos:b,accuracy:k.coords.accuracy/1E3,matchWeight:100});if(!f||k.accuracy<f.accuracy)f=k;if(!h.requiredAccuracy||f.accuracy<h.requiredAccuracy)m(f,e)},l,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3});if(h.searchTimeout)a=setTimeout(function(){f&&m(f,e)},h.searchTimeout)}}},h))};
T5.Map=function(h){function m(t){try{var y=new T5.Geo.Position(t.coords.latitude,t.coords.longitude),A=t.coords.accuracy/1E3;n.trigger("locationUpdate",t,A);if(o){if(!k){k=new T5.Geo.UI.LocationOverlay({pos:y,accuracy:A});k.update(n.getTileLayer());n.setLayer("location",k)}var u=T5.Geo.B.createBoundsFromCenter(y,Math.max(A,1));n.gotoBounds(u)}else{k.pos=y;k.accuracy=A;k.update(n.getTileLayer());n.panToPosition(y,null,T5.easing("sine.out"))}o=false}catch(v){COG.Log.exception(v)}}function l(t){COG.Log.info("caught location tracking error:",
t)}h=T5.ex({tapExtent:10,provider:null,crosshair:false,zoomLevel:0,boundsChangeThreshold:30,zoomAnimation:T5.easing("quad.out")},h);var d={NONE:0,SINGLE:1,WATCH:2},a=new T5.Vector,f=d.NONE,g=false,e=null,k=null,b=0,o=true,p=h.zoomLevel;if(!h.provider)h.provider=new T5.Geo.MapProvider;h.adjustScaleFactor=function(t){return Math.pow(2,(t<1?Math.floor:Math.ceil)(Math.log(t)))};var n=T5.ex({},new T5.Tiler(h),{annotations:null,getBoundingBox:function(){var t=n.getTileLayer(),y=n.getOffset(),A=n.getDimensions();
if(t)return t.getBoundingBox(y.x,y.y,A.width,A.height);return null},getCenterPosition:function(){return n.getXYPosition(T5.D.getCenter(n.getDimensions()))},getXYPosition:function(t){return n.getTileLayer().pixelsToPos(n.viewPixToGridPix(t))},gotoBounds:function(t,y){var A=T5.Geo.B.getZoomLevel(t,n.getDimensions());n.gotoPosition(T5.Geo.B.getCenter(t),A,y)},gotoPosition:function(t,y,A){function u(U){n.setTileLayer(U);n.panToPosition(t,function(){n.unfreeze();n.trigger("zoomLevelChange",p);A&&A()});
g=true}var v=p,C=!g,x=n.getBoundingBox();if(x)C=C||!T5.Geo.P.inBounds(t,x);p=y?y:p;if(!p)throw Error("Zoom level required to goto a position.");if(h.provider)p=h.provider.checkZoomLevel(p);if(C||p!==v){T5.Images.cancelLoad();T5.cancelAnimation();g&&n.freeze();h.provider.zoomLevel=p;h.provider.getMapTiles(n,t,u)}else n.panToPosition(t,A)},panToPosition:function(t,y,A,u){var v=n.getTileLayer();if(v){t=v.getGridXYForPosition(t);v=n.getDimensions();t.x-=v.width/2;t.y-=v.height/2;if(e)e=null;n.updateOffset(t.x,
t.y,A,u,y);n.trigger("wake");n.trigger("boundsChange",n.getBoundingBox());y&&typeof A==="undefined"&&y(n)}},locate:function(){n.trackStart(d.SINGLE);setTimeout(n.trackCancel,1E4)},trackStart:function(t){if(navigator.geolocation&&!b){f=t?t:d.WATCH;o=true;b=navigator.geolocation.watchPosition(m,l,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3})}},trackCancel:function(){b&&navigator.geolocation&&navigator.geolocation.clearWatch(b);n.removeLayer("location");k=null;f=d.NONE;b=0},getZoomLevel:function(){return p},
setZoomLevel:function(t){try{n.gotoPosition(n.getCenterPosition(),t)}catch(y){COG.Log.exception(y)}},zoomIn:function(){n.scale(2,T5.easing("sine.out"))||n.setZoomLevel(p+1)},zoomOut:function(){n.scale(0.5,T5.easing("sine.out"))||n.setZoomLevel(p-1)},animateRoute:function(t,y,A,u){var v=n.getLayer("route");if(v)(t=v.getAnimation(t,y,A,u))&&t.addToView(n)}});n.bind("pan",function(){f===d.SINGLE&&n.trackCancel()});n.bind("tap",function(t,y,A){var u=n.getTileLayer(),v=null;if(u){var C=n.viewPixToGridPix(new T5.Vector(A.x,
A.y));t=u.pixelsToPos(C);v=u.pixelsToPos(T5.V.offset(C,-h.tapExtent,h.tapExtent));u=u.pixelsToPos(T5.V.offset(C,h.tapExtent,-h.tapExtent));v=new T5.Geo.BoundingBox(v,u);n.trigger("geotap",y,A,t,v)}});n.bind("doubleTap",function(t,y,A){n.scalable()&&n.animate(2,T5.D.getCenter(n.getDimensions()),new T5.Vector(A.x,A.y),h.zoomAnimation)});n.bind("scale",function(t,y,A){t=0;y=Math.sqrt(y);if(y<1)t=-(0.5/y);else if(y>1)t=y;n.gotoPosition(n.getXYPosition(A),p+t>>0)});h.crosshair&&n.setLayer("crosshair",
new CrosshairOverlay);n.bind("idle",function(){if(T5.V.absSize(T5.V.diff(a,n.getOffset()))>h.boundsChangeThreshold){a=T5.V.copy(n.getOffset());n.trigger("boundsChange",n.getBoundingBox())}});COG.configurable(n,["provider"],COG.paramTweaker(h,null,{provider:function(){n.cleanup();g=false}}),true);return n};
T5.Geo.MapProvider=function(){var h=1,m=20;return{zoomLevel:0,checkZoomLevel:function(l){return Math.min(Math.max(l,h),m)},getCopyright:function(){},getLogoUrl:function(){},getMapTiles:function(){},getZoomRange:function(){return{min:h,max:m}},prepTileGridArgs:function(l,d,a,f,g){var e=null;if(g.tileBackgroundColor){e=T5.Images.newCanvas(a,a);var k=e.getContext("2d");k.fillStyle=g.tileBackgroundColor;k.fillRect(0,0,a,a)}return T5.ex({tileSize:a,width:l,height:d,center:f,tileDrawArgs:{background:e}},
g)},setZoomRange:function(l,d){h=l;m=d}}};
T5.Geo.Routing=function(){var h={calculate:function(m){m=T5.ex({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},m);var l=T5.Geo.getEngine("route");l&&l.route(m,function(d){if(m.generalize)d.geometry=T5.Geo.P.generalize(d.geometry,d.getInstructionPositions());if(m.map){h.createMapOverlay(m.map,d);m.autoFit&&m.map.gotoBounds(d.boundingBox)}m.success&&m.success(d)})},createMapOverlay:function(m,l){var d=m.getDimensions();d=new T5.Geo.UI.RouteOverlay({data:l,width:d.width,
height:d.height});m.setLayer("route",d)},parseTurnType:function(m){for(var l=h.TurnType.Unknown,d=T5.Geo.Routing.TurnTypeRules,a=0;a<d.length;a++){d[a].regex.lastIndex=-1;var f=d[a].regex.exec(m);if(f){l=d[a].customCheck?d[a].customCheck(m,f):d[a].turnType;break}}return l},TurnType:{Unknown:"turn-unknown",Start:"turn-none-start",Continue:"turn-none",Arrive:"turn-none-arrive",TurnLeft:"turn-left",TurnLeftSlight:"turn-left-slight",TurnLeftSharp:"turn-left-sharp",TurnRight:"turn-right",TurnRightSlight:"turn-right-slight",
TurnRightSharp:"turn-right-sharp",Merge:"merge",UTurnLeft:"uturn-left",UTurnRight:"uturn-right",EnterRoundabout:"roundabout-enter",Ramp:"ramp",RampExit:"ramp-exit"},Instruction:function(m){var l=m=T5.ex({position:null,description:"",distance:0,distanceTotal:0,time:0,timeTotal:0,turnType:null},m),d=m.description;d=d.replace(/(\w)(\/)(\w)/g,"$1 $2 $3");l.description=d;if(!m.turnType)m.turnType=h.parseTurnType(m.description);return m},RouteData:function(m){m=T5.ex({geometry:[],instructions:[],boundingBox:null},
m);if(!m.boundingBox)m.boundingBox=T5.Geo.B.forPositions(m.geometry);return T5.ex({getInstructionPositions:function(){for(var l=[],d=0;d<m.instructions.length;d++)m.instructions[d].position&&l.push(m.instructions[d].position);return l}},m)}};return h}();T5.Geo.Search=function(){return{bestResults:function(h,m){m||(m=20);for(var l=h.length>0?h[0]:null,d=[],a=0;a<h.length;a++)if(l&&h[a]&&l.matchWeight-h[a].matchWeight<=m)d.push(h[a]);else break;return d}}}();
T5.Geo.UI=function(){var h={AnnotationTween:null,GeoTileGrid:function(m){m=T5.ex({grid:null,centerPos:new T5.Geo.Position,centerXY:new T5.Vector,radsPerPixel:0},m);var l=m.radsPerPixel,d=T5.Geo.P.toMercatorPixels(m.centerPos),a=d.x/l-m.centerXY.x>>0,f=d.y/l-m.centerXY.y>>0,g=null,e=T5.ex({},m.grid,{getBoundingBox:function(k,b,o,p){return new T5.Geo.BoundingBox(e.pixelsToPos(new T5.Vector(k,b+p)),e.pixelsToPos(new T5.Vector(k+o,b)))},getGridXYForPosition:function(k){k=new T5.Geo.GeoVector(k);e.syncVectors([k]);
return k},syncVectors:function(k){for(var b=k.length;b--;)k[b]&&k[b].setRadsPerPixel&&k[b].setRadsPerPixel(l,-a,-g)},getPixelDistance:function(k){return T5.Geo.dist2rad(k)/l>>0},pixelsToPos:function(k){return T5.Geo.P.fromMercatorPixels((a+k.x)*l,(f+e.gridDimensions.height-k.y)*l)}});g=f+e.gridDimensions.height;return e},RouteOverlay:function(m){m=T5.ex({data:null,pixelGeneralization:8,partialDraw:false,strokeStyle:"rgba(0, 51, 119, 0.9)",waypointFillStyle:"#FFFFFF",lineWidth:4,zindex:50},m);var l=
[],d=[],a=new T5.PathLayer(m);(function(){if(m.data&&m.data.instructions){for(var f=m.data.instructions,g=Array(f.length),e=f.length;e--;)g[e]=f[e].position;T5.Geo.P.vectorize(g).bind("complete",function(k,b){d=b})}m.data&&m.data.geometry&&T5.Geo.P.vectorize(m.data.geometry).bind("complete",function(k,b){l=b;a.updateCoordinates(l,d,true)})})();return a},Poly:function(m,l){l=T5.ex({autoParse:true},l);for(var d=Array(m.length),a=l.autoParse,f=T5.Geo.GeoVector,g=T5.Geo.P.parse,e=m.length;e--;)d[e]=new f(a?
g(m[e]):m[e]);return new T5.Poly(d,l)},Annotation:function(m){m=T5.ex({pos:null},m);m.xy=new T5.Geo.GeoVector(m.pos);return new T5.ImageAnnotation(m)},LocationOverlay:function(m){m=T5.ex({pos:null,accuracy:null,zindex:90},m);var l=new Image,d=new T5.Vector,a=new T5.Vector,f=null;l.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAACIQAAAiEBPhEQkwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAG+SURBVCiRlZHNahNRAIW/O7mTTJPahLZBA1YUyriINRAE3bQIKm40m8K8gLj0CRQkO32ELHUlKbgoIu4EqeJPgtCaoBuNtjXt5LeTMZk0mbmuWiuuPLsD3+HAOUIpxf9IHjWmaUbEyWv5ROrsVULhcHP761rUfnN3Y2Otc8CIg4YT85lzuVsPP+Qupw1vpPjRCvhS9ymvV0e77x7nNj+uvADQAIQQ+uLyvdfLV9JGZi7EdEwQlqBpEJ019f0z1mo2u5Q8DMydv25lshemmj1FueZTawbs7inarqLbV7Qjab1upB9YlhWSAHLavLHZCvg1VEhN0PMU9W7At4bPVidg7CtkLLXkut+lBPD6/Ub155jJiADAHSpaLmx3ApyBQoYEUd0PBoOBkAC6+3llvda/YxgGgYL+UNHf/zN3KiExGlsvTdP0NYDkhPdWrz35ZDsBzV5wCMuQwEyFmXFeeadjzfuFQmGkAZRKpdGC/n7x+M6jqvA9Zo6FWDhlcHE+wqT93J1tP7vpOE7rrx8ALMuasPf8S12St4WmJ6bYWTUC52k8Hm8Vi0X/nwBAPp/XKpWKdF1X2LYdlMvlsToC/QYTls7DLFr/PAAAAABJRU5ErkJggg%3D%3D";
l.onload=function(){d=new T5.Vector(l.width/2,l.height/2)};var g=T5.ex(new T5.ViewLayer(m),{pos:m.pos,accuracy:m.accuracy,drawAccuracyIndicator:false,draw:function(e,k){var b=a.x-k.x,o=a.y-k.y;if(f){e.fillStyle="rgba(30, 30, 30, 0.2)";e.beginPath();e.arc(b,o,f,0,Math.PI*2,false);e.fill()}l.complete&&l.width>0&&e.drawImage(l,b-d.x,o-d.y,l.width,l.height);g.changed()},update:function(e){if(e){f=Math.floor(e.getPixelDistance(g.accuracy)*0.5);a=e.getGridXYForPosition(g.pos);g.changed()}}});g.bind("gridUpdate",
function(e,k){g.update(k)});return g},AnnotationsOverlay:function(m){function l(e,k){var b=e.length,o=g.getParent();if(k=k?k:o?o.getTileLayer():null)for(b=b;b--;)k.syncVectors([e[b].xy]);e.sort(function(p,n){var t=n.xy.y-p.xy.y;if(t===0)t=n.xy.x-p.xy.x;return t})}m=T5.ex({pois:null,map:null,zindex:100},m);var d=[],a=false,f=[],g=T5.ex(new T5.ViewLayer(m),{cycle:function(){return a},draw:function(e,k,b,o,p){a=false;e.fillStyle="rgba(255, 0, 0, 0.75)";e.globalCompositeOperation="source-over";for(b=
d.length;b--;){d[b].draw(e,k,o,g,p);a=a||d[b].isAnimating()}for(b=f.length;b--;){f[b].draw(e,k,o,g,p);a=a||f[b].isAnimating()}return a?1:0},add:function(e){if(e&&e.length)for(var k=e.length;k--;)f[f.length]=e[k];else if(e)f[f.length]=e;l(f);g.changed()},clear:function(e){f=[];l(f);if(e){d=[];l(d)}g.changed()}});COG.listen("geo.pois-updated",function(e){if(m.pois&&m.pois.id==e.srcID){e=e.pois;try{d=[];for(var k=0;k<e.length;k++)if(e[k].pos){var b;var o=e[k];if(o&&o.pos){var p={poi:o,annotation:null};
m.map&&m.map.trigger("getAnnotationForPOI",p);if(!p.annotation)p.annotation=new T5.Annotation({xy:new T5.Geo.GeoVector(o.pos)});if(p.annotation){p.annotation.isNew=o.isNew;o.isNew=false}b=p.annotation}else b=void 0;b&&d.push(b)}l(d)}catch(n){COG.Log.exception(n)}g.changed()}});g.bind("gridUpdate",function(e,k){l(d,k);l(f,k);g.changed()});return g}};h.ImageAnnotation=h.Annotation;return h}();
T5.Geo.Routing.TurnTypeRules=function(){var h=T5.Geo.Routing.TurnType,m=[];m.push({regex:/continue/i,turnType:h.Continue});m.push({regex:/(take|bear|turn)(.*?)left/i,customCheck:function(l,d){return/bear/i.test(d[1])?h.TurnLeftSlight:h.TurnLeft}});m.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(l,d){return/bear/i.test(d[1])?h.TurnRightSlight:h.TurnRight}});m.push({regex:/enter\s(roundabout|rotaty)/i,turnType:h.EnterRoundabout});m.push({regex:/take.*?ramp/i,turnType:h.Ramp});m.push({regex:/take.*?exit/i,
turnType:h.RampExit});m.push({regex:/make(.*?)u\-turn/i,customCheck:function(l,d){return/right/i.test(d[1])?h.UTurnRight:h.UTurnLeft}});m.push({regex:/proceed/i,turnType:h.Start});m.push({regex:/arrive/i,turnType:h.Arrive});m.push({regex:/fell\sthrough/i,turnType:h.Merge});return m}();
