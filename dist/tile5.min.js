COG=function(){var l=/\$\{(.*?)\}/ig,n=Object.prototype.hasOwnProperty,m=0,f={id:"grunt.core",extend:function(){var a=arguments[0]||{},b=1,g=arguments.length,d=false,o,e,k,h;if(typeof a==="boolean"){d=a;a=arguments[1]||{};b=2}if(typeof a!=="object"&&!f.isFunction(a))a={};if(g===b){a=this;--b}for(;b<g;b++)if((o=arguments[b])!=null)for(e in o){k=a[e];h=o[e];if(a!==h)if(d&&h&&(f.isPlainObject(h)||f.isArray(h))){k=k&&(f.isPlainObject(k)||f.isArray(k))?k:f.isArray(h)?[]:{};a[e]=f.extend(d,k,h)}else if(h!==
undefined)a[e]=h}return a},isFunction:function(a){return toString.call(a)==="[object Function]"},isArray:function(a){return toString.call(a)==="[object Array]"},isPlainObject:function(a){if(!a||toString.call(a)!=="[object Object]"||a.nodeType||a.setInterval)return false;if(a.constructor&&!n.call(a,"constructor")&&!n.call(a.constructor.prototype,"isPrototypeOf"))return false;var b;for(b in a);return b===undefined||n.call(a,b)},isEmptyObject:function(a){for(var b in a)return false;return true},isXmlDocument:function(a){return toString.call(a)===
"[object Document]"},contains:function(a,b){var g=a,d=arguments,o=1;if(b&&f.isArray(b)){d=b;o=0}for(o=o;o<d;o++)g=g&&typeof foo[d[o]]!=="undefined";return g},newModule:function(a){a=f.extend({id:null,requires:[],parent:null},a);if(a.parent)a=f.extend({},a.parent,a);return a},toID:function(a){return a.replace(/\s/g,"-")},objId:function(a){return(a?a:"obj")+m++},formatStr:function(a){if(arguments.length<=1)return a;for(var b=arguments.length-2,g=0;g<=b;g++)a=a.replace(RegExp("\\{"+g+"\\}","gi"),arguments[g+
1]);return a},wordExists:function(a,b){var g="";if(b.toString)b=b.toString();for(var d=0;d<b.length;d++)g+=!/\w/.test(b[d])?"\\"+b[d]:b[d];return RegExp("(^|\\s|\\,)"+g+"(\\,|\\s|$)","i").test(a)},parseTemplate:function(a,b){for(var g=l.exec(a);g;){a=a.replace(g[0],COG.XPath.first(g[1],b));l.lastIndex=0;g=l.exec(a)}return a}};return f}();
COG.Log=function(){function l(b,g){var d,o=g&&g.length>0?g[0]:"";for(d=1;g&&d<g.length;d++)o+=" "+(m&&COG.isPlainObject(g[d])?JSON.stringify(g[d]):g[d]);typeof console!=="undefined"&&console[b](o);for(d=0;d<n.length;d++)n[d].call(a,o,b)}var n=[],m=typeof JSON!=="undefined",f=window.console&&window.console.markTimeline,a={id:"grunt.log",getTraceTicks:function(){return f?(new Date).getTime():null},trace:function(b,g){if(f)console.markTimeline(b+(g?": "+(a.getTraceTicks()-g)+"ms":""))},debug:function(){l("debug",
arguments)},info:function(){l("info",arguments)},warn:function(){l("warn",arguments)},error:function(){l("error",arguments)},exception:function(b){a.error(arguments);for(var g in b)a.info("ERROR DETAIL: "+g+": "+b[g])},watch:function(b,g){try{g()}catch(d){a.exception(d,b)}},throwError:function(b){a.error(b);throw Error(b);},requestUpdates:function(b){n.push(b)}};return a}();
(function(){function l(f,a){f[a]||(f[a]=function(b){return f.configure(a,b)})}function n(f){f.gtConfId=COG.objId("configurable");f.gtConfig={};f.gtConfigFns=[];return f.gtConfig}var m={};COG.paramTweaker=function(f,a,b){return function(g,d){if(typeof d!=="undefined"){if(g in f)f[g]=d;b&&g in b&&b[g](g,d)}else return a&&g in a?a[g](g):f[g]}};COG.configurable=function(f,a,b,g){if(f){f.gtConfId||n(f);var d=f.gtConfId,o=f.gtConfig,e=f.gtConfigFns;m[d]=f;e.push(b);for(b=a.length;b--;){o[a[b]]=true;g&&
l(f,a[b])}if(!f.configure)f.configure=function(k,h){if(o[k]){for(var p=e.length;p--;){var t=e[p](k,h);if(typeof t!=="undefined")return t}return m[d]}return null}}}})();
(function(){function l(n,m){var f=n.gtObsHandlers;f[m]||(f[m]=[]);return f[m]}COG.observable=function(n){if(n){if(!n.gtObsHandlers)n.gtObsHandlers={};if(!(n.bind||n.trigger||n.unbind)){n.bind=function(m,f){var a=COG.objId("callback");l(n,m).unshift({fn:f,id:a});return a};n.trigger=function(m){var f=l(n,m),a={cancel:false,tickCount:(new Date).getTime()},b;if(!f)return null;b=Array.prototype.slice.call(arguments,1);b.unshift(a);for(var g=f.length;g--&&!a.cancel;)f[g].fn.apply(self,b);return a};n.unbind=
function(m,f){for(var a=l(n,m),b=0;a&&b<a.length;b++)if(a[b].id===f){a.splice(b,1);break}return n}}}}})();(function(){var l={},n=[];COG.addPipe=function(m){m("pipe.test",{});n.push(m)};COG.listen=function(m,f){l[m]||(l[m]=[]);f&&l[m].push(f)};COG.say=function(m,f){var a;for(a=n.length;a--;)n[a](m,f);if(l[m])for(a=l[m].length;a--;)l[m][a](f)}})();
COG.Loopage=function(){function l(h){return COG.extend({id:b++,frequency:0,after:0,single:false,lastTick:0,execute:function(){}},h)}function n(h){d.push(h);m()}function m(){o&&clearTimeout(o);o=setTimeout(f,0);k=true}function f(){for(var h,p=(new Date).getTime(),t=g.length;d.length>0;){var w=d.shift();for(h=t;h--;)if(g[h].id===w){g.splice(h,1);break}k=true;t=g.length}if(k){e=a;for(h=t;h--;)e=g[h].frequency<e?g[h].frequency:e}for(h=t;h--;){w=p-g[h].lastTick;if(g[h].lastTick===0||w>=g[h].frequency){g[h].execute(p,
g[h]);g[h].lastTick=p;g[h].single&&g[h].trigger("complete")}}o=t?setTimeout(f,e):0}var a=6E4,b=0,g=[],d=[],o=0,e=a,k=true;return{join:function(h){var p=new l(h);if(p.after>0)p.lastTick=(new Date).getTime()+p.after;COG.observable(p);p.bind("complete",function(){n(p.id)});g.unshift(p);m();return p},leave:n}}();if(!this.JSON)this.JSON={};
(function(){function l(e){return e<10?"0"+e:e}function n(e){a.lastIndex=0;return a.test(e)?'"'+e.replace(a,function(k){var h=d[k];return typeof h==="string"?h:"\\u"+("0000"+k.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function m(e,k){var h,p,t,w,z=b,u,v=k[e];if(v&&typeof v==="object"&&typeof v.toJSON==="function")v=v.toJSON(e);if(typeof o==="function")v=o.call(k,e,v);switch(typeof v){case "string":return n(v);case "number":return isFinite(v)?String(v):"null";case "boolean":case "null":return String(v);
case "object":if(!v)return"null";b+=g;u=[];if(Object.prototype.toString.apply(v)==="[object Array]"){w=v.length;for(h=0;h<w;h+=1)u[h]=m(h,v)||"null";t=u.length===0?"[]":b?"[\n"+b+u.join(",\n"+b)+"\n"+z+"]":"["+u.join(",")+"]";b=z;return t}if(o&&typeof o==="object"){w=o.length;for(h=0;h<w;h+=1){p=o[h];if(typeof p==="string")if(t=m(p,v))u.push(n(p)+(b?": ":":")+t)}}else for(p in v)if(Object.hasOwnProperty.call(v,p))if(t=m(p,v))u.push(n(p)+(b?": ":":")+t);t=u.length===0?"{}":b?"{\n"+b+u.join(",\n"+b)+
"\n"+z+"}":"{"+u.join(",")+"}";b=z;return t}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+l(this.getUTCMonth()+1)+"-"+l(this.getUTCDate())+"T"+l(this.getUTCHours())+":"+l(this.getUTCMinutes())+":"+l(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var f=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
a=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,b,g,d={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},o;if(typeof JSON.stringify!=="function")JSON.stringify=function(e,k,h){var p;g=b="";if(typeof h==="number")for(p=0;p<h;p+=1)g+=" ";else if(typeof h==="string")g=h;if((o=k)&&typeof k!=="function"&&(typeof k!=="object"||typeof k.length!=="number"))throw Error("JSON.stringify");return m("",
{"":e})};if(typeof JSON.parse!=="function")JSON.parse=function(e,k){function h(t,w){var z,u,v=t[w];if(v&&typeof v==="object")for(z in v)if(Object.hasOwnProperty.call(v,z)){u=h(v,z);if(u!==undefined)v[z]=u;else delete v[z]}return k.call(t,w,v)}var p;e=String(e);f.lastIndex=0;if(f.test(e))e=e.replace(f,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){p=eval("("+e+")");return typeof k==="function"?h({"":p},""):p}throw new SyntaxError("JSON.parse");}})();
(function(){function l(m,f){var a=m.split("|"),b={};for(var g in f){var d=f[g];b[g]=a.length>d?a[d]:null}return b}var n={JSON:{parse:function(m){return JSON.parse(m)}},PDON:{parse:function(m){var f=null,a=[];m=m.split("\n");for(var b=0;b<m.length;b++){var g=m[b];if(f)a.push(l(g,f));else if(g){f=g.split("|");g={};for(var d=0;d<f.length;d++)g[f[d]]=d;f=g}else f=null}return a}}};COG.parseData=function(m,f){f=f?f.toUpperCase():"JSON";if(!n[f])throw Error("Unsupported data format: "+f);try{return n[f].parse(m)}catch(a){COG.Log.exception(a)}return{}}})();
COG.XPath=function(){function l(a){for(var b=null,g=0;g<n.length;g++)if(b=n[g](a))break;return b}var n=[],m=[null,function(a){return a.numberValue},function(a){return a.stringValue},function(a){return a.booleanValue},null,null,null,null,function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null},function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||COG.Log.warn("No XPATH support");var f={SearchResult:function(a){return{toString:function(){var b=
null;if(a){var g=null;if(a.resultType>=0&&a.resultType<m.length)g=m[a.resultType];if(g)b=g(a)}return b?b:""}}},first:function(a,b){var g=f.SearchResult,d;var o=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!o)o=XPathResult.ANY_TYPE;try{if(COG.isXmlDocument(b))d=b.evaluate(a,b,l,o,null);else{COG.Log.warn("attempted xpath expression: "+a+" on a non-xml document");d=null}}catch(e){COG.Log.warn("invalid xpath expression: "+a+" on node: "+b);d=null}return new g(d)},registerResolver:function(a){n.push(a)}};return f}();
COG.Storage=function(){function l(n){if(n&&n=="session")return sessionStorage;return localStorage}return{get:function(n,m){var f=l(m).getItem(n);return/^(\{|\[).*(\}|\])$/.test(f)?JSON.parse(f):f},set:function(n,m,f){m=jQuery.isArray(m)||jQuery.isPlainObject(m)?JSON.stringify(m):m;l(f).setItem(n,m)},remove:function(n,m){l(m).removeItem(n)}}}();
COG.ParseRules=function(){var l=[];return{add:function(n,m){l.push({regex:n,handler:m})},each:function(n,m,f){function a(){b++;f&&b>=l.length&&f(m)}for(var b=0,g=0;g<l.length;g++){var d=l[g].regex,o=l[g].handler,e=false;if(d){d.lastIndex=-1;if((d=d.exec(n))&&o){e=true;o(d,m,a)&&a()}}e||a()}}}};
(function(){function l(d){var o=[],e=function(h,p){p=COG.isFunction(p)?p():p;o[o.length]=encodeURIComponent(h)+"="+encodeURIComponent(p)};if(COG.isArray(d))for(var k=0;k<d.length;k++)e(d[k].name,d[k].value);else for(k in d)e(k,d[k]);return o.join("&").replace(/%20/g,"+")}var n={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},m={JSON:["json"],PDON:["pdon.txt"]},f=["TEXT","STREAM"],a=/^(\w+:)?\/\/([^\/?#]+)/,b={XML:function(d){return d.responseXML},JSON:function(d){return COG.parseData(d.responseText)},
PDON:function(d){return COG.parseData(d.responseText,"PDON")},DEFAULT:function(d){return d.responseText}},g={CONTENT_TYPE:"Content-Type"};COG.xhr=function(d){function o(){if(this.readyState===4){var p=null,t=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(t)if(d.handleResponse)d.handleResponse(this);else{var w=d,z=this.getResponseHeader(g.CONTENT_TYPE),u,v=false;for(u in n)if(z&&z.indexOf(n[u])>=0){v=true;
break}z=!v;for(v=0;v<f.length;v++)z=z||f[v]==u;if(z)b:{z=u;for(var D in m)for(v=0;v<m[D].length;v++)if(RegExp(m[D][v]+"$","i").test(w.url)){u=D;break b}u=z?z:"DEFAULT"}try{p=b[u](this,w)}catch(A){p=b.DEFAULT(this,w)}}else d.error&&d.error(this)}catch(Q){COG.Log.exception(Q,"PROCESSING AJAX RESPONSE")}t&&p&&d.success&&d.success.call(this,p)}}try{d=COG.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},d);var e=
a.exec(d.url),k=e&&(e[1]&&e[1]!==location.protocol||e[2]!==location.host);if(d.data)d.method="POST";if(d.url){e=null;if(d.xhr)e=d.xhr(d);e||(e=new XMLHttpRequest);e.open(d.method,d.url,d.async);d.data&&e.setRequestHeader("Content-Type",d.contentType);k||e.setRequestHeader("X-Requested-With","XMLHttpRequest");e.onreadystatechange=o;e.send(d.method=="POST"?l(d.data):null)}else COG.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(h){COG.Log.exception(h)}}})();
(function(){function l(a){var b=document.createElement("script"),g=false;b.src=a;b.async=true;b.onload=b.onreadystatechange=function(){if(!g&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){g=true;b.onload=b.onreadystatechange=null;b&&b.parentNode&&b.parentNode.removeChild(b)}};m||(m=document.getElementsByTagName("head")[0]);m.appendChild(b)}var n=0,m,f=this;COG.jsonp=function(a,b,g){a+=a.indexOf("?")>=0?"&":"?";var d="json"+ ++n;f[d]=function(o){b(o);f[d]=null;try{delete f[d]}catch(e){}};
l(a+(g?g:"callback")+"="+d);return d}})();
COG.Touch=function(){function l(s,q){return{x:s.x-q.x,y:s.y-q.y}}function n(s,q){var r=l(s,q);return Math.sqrt(r.x*r.x+r.y*r.y)}function m(s){if(s.count>1)return n(s.touches[0],s.touches[1]);return 0}function f(s,q){var r=s&&s.count>0?s.touches[0]:null;if(r&&q&&q.count>0)return l(r,q.touches[0]);return null}function a(s,q){s.count=q.count;for(var r=e;r--;){s.touches[r].x=q.touches[r].x;s.touches[r].y=q.touches[r].y}}function b(){for(var s={count:0,touches:Array(e)},q=e;q--;)s.touches[q]=o();return s}
function g(s){if(s.preventDefault){s.preventDefault();s.stopPropagation()}else s.cancelBubble&&s.cancelBubble()}function d(s,q,r){if(H){q=q[r?r:"touches"];r=q.length;for(r=s.count=r;r--;){s.touches[r].x=q[r].pageX;s.touches[r].y=q[r].pageY}}else if(q.button===0){s.count=1;s.touches[0].x=q.pageX?q.pageX:q.screenX;s.touches[0].y=q.pageY?q.pageY:q.screenY}else s.count=0}function o(s,q){return{x:s?s:0,y:q?q:0}}var e=10,k=120,h=100,p=250,t=300,w=5,z=0,u=1,v=2,D=7,A=0,Q=0,H=undefined,N=function(s){function q(E,
J,G,y){var B=Math.asin((E.y-J.y)/G);G=G*(na/y)>>0;G=G>ja?ja:G;B=J.x>E.x?B:Math.PI-B;F("pan",Math.cos(B)*-G,Math.sin(B)*G,true)}function r(E,J){var G,y;if(H){G=J-ka;if(G<p){y=n(S.touches[0],E);y>s.inertiaTrigger&&q(S.touches[0],E,y,G)}}else{ca.x=E.x;ca.y=E.y;COG.Loopage.join({execute:function(B,K){G=B-J;y=n(E,ca);if(G<h&&y>s.inertiaTrigger){K.trigger("complete");q(E,ca,y,G)}else G>h&&K.trigger("complete")},frequency:10})}}function x(E){var J=0,G=0;if(E.offsetParent){do{J+=E.offsetLeft;G+=E.offsetTop;
E=E.offsetParent}while(E)}return o(J,G)}function C(E){var J=E.count,G=Array(J),y=x($);for(J=J;J--;)G[J]=o(E.touches[J].x-y.x,E.touches[J].y-y.y);return G}function F(){ta&&ta.trigger.apply(null,arguments)}function I(E,J){var G=x($);G=o(J.x-G.x,J.y-G.y);F(E,J,G)}function L(E){var J=E.target?E.target:E.srcElement;if(Z||J&&J===$){d(S,E);if(S.count!==0){ea=null;ha.x=0;ha.y=0;oa=true;fa=false;ka=(new Date).getTime();g(E);J.style.cursor="move";F("inertiaCancel");la=ka;if(E=S.count>0?S.touches[0]:null){F("touchStart",
E.x,E.y);if(la-ma<t)if((E=l(S.touches[0],da.touches[0]))&&Math.abs(E.x)<s.maxDistDoubleTap&&Math.abs(E.y)<s.maxDistDoubleTap)fa=true;ba=z;a(da,S)}else COG.Log.warn("Touch start fired, but no touch vector found")}}}function T(E){var J=E.target?E.target:E.srcElement,G=0;if(Z||J&&J===$){d(aa,E);if(aa.count>0){ca.x=aa.touches[0].x;ca.y=aa.touches[0].y}if(oa){H&&g(E);if(aa.count>1){S.count===1&&a(S,aa);G=m(S)-m(aa)}if(ba===z)if((E=f(aa,S))&&(Math.abs(E.x)>=D||Math.abs(E.y)>=D))ba=u;if(ba!==z)if(!G||Math.abs(G)<
w){if(ea=f(aa,da)){ha.x-=ea.x;ha.y-=ea.y;R.x-=ea.x;R.y-=ea.y}F("pan",R.x,R.y);R.x=0;R.y=0;ba=u}else{F("pinchZoom",C(S),C(aa));ba=v}a(da,aa)}}}function ia(E){var J=E.target?E.target:E.srcElement;if(oa&&(Z||J&&J===$)){d(pa,E,"changedTouches");var G=pa.touches[0];H&&g(E);E=(new Date).getTime();ma=la;if(ba===z){I("tap",S.touches[0]);qa||(qa=setTimeout(function(){qa=0;fa&&I("doubleTap",S.touches[0])},t+50))}else if(ba==u){F("panEnd",ha.x,ha.y);ra&&r(G,E)}else ba==v&&F("pinchZoomEnd",C(S),C(da),E-ka);J.style.cursor=
"default";oa=false}}function W(E){var J=E.target?E.target:E.srcElement;if(Z||J&&J===$){if(E.detail){J=-E.detail*k;J=o(E.axis===1?J:0,E.axis===2?J:0)}else J=o(E.wheelDeltaX,E.wheelDeltaY);var G=J.y!==0?Math.abs(J.y/k):0;if(ca&&G!==0){var y=o(ca.x-$.offsetLeft,ca.y-$.offsetTop);F("wheelZoom",y,Math.pow(2,J.y>0?G:-G))}g(E)}}s=COG.extend({element:null,observable:null,inertiaTrigger:20,maxDistDoubleTap:20,touchStartHandler:null,moveHandler:null,moveEndHandler:null,pinchZoomHandler:null,pinchZoomEndHandler:null,
tapHandler:null,doubleTapHandler:null,wheelZoomHandler:null},s);var fa=false,qa=0,V=T5.getConfig(),S=b(),aa=b(),da=b(),pa=b(),ea=null,ha=o(),R=o(),ba=null,oa=false,ka=0,sa=[],ca=o(),ra=false,na,ja,la=0,ma=0,$=s.element,ta=s.observable,Z=typeof FlashCanvas!=="undefined",ua={supportsTouch:H,addListeners:function(E){sa.push(E)},decoupleListeners:function(E){for(var J=0;E&&J<sa.length;J++)if(sa[J].listenerId===E){sa.splice(J,1);break}},release:function(){V.unbindEvent(H?"touchstart":"mousedown",L,false);
V.unbindEvent(H?"touchmove":"mousemove",T,false);V.unbindEvent(H?"touchend":"mouseup",ia,false);if(!H){window.removeEventListener("mousewheel",W,false);window.removeEventListener("DOMMouseScroll",W,false)}},inertiaEnable:function(E,J){ra=true;na=E;ja=J?Math.min(J.width,J.height):500},inertiaDisable:function(){ra=false}};if(typeof H==="undefined")H=T5.getConfig().supportsTouch;V.bindEvent(H?"touchstart":"mousedown",L,false);V.bindEvent(H?"touchmove":"mousemove",T,false);V.bindEvent(H?"touchend":"mouseup",
ia,false);if(!H){V.bindEvent("mousewheel",W,window);V.bindEvent("DOMMouseScroll",W,window)}return ua},M=[];return{capture:function(s,q){if(!s)throw Error("Unable to capture touch of null element");if(!s.id)s.id="touchable_"+A++;var r=M[s.id];if(!r){r=new N(COG.extend({element:s},q));M[s.id]=r}if(q){q.listenerId&&r.decoupleListeners(q.listenerId);q.listenerId=++Q;r.addListeners(q)}return r},release:function(s){if(s&&s.id&&M[s.id]){M[s.id].release();delete M[s.id]}}}}();
T5=function(){var l=function(){function b(o,e){return d(o.x-e.x,o.y-e.y)}function g(o,e){if(!e)e=o.length;if(e<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var k={edges:Array(e-1),accrued:Array(e-1),total:0},h=0;h<e-1;h++){var p=b(o[h],o[h+1]);k.edges[h]=Math.sqrt(p.x*p.x+p.y*p.y);k.accrued[h]=k.total+k.edges[h];k.total+=k.edges[h]}return k}function d(o,e){return{x:o?o:0,y:e?e:0}}return{VECTOR_SIMPLIFICATION:3,SIMPLIFICATION_MIN_VECTORS:25,add:function(){for(var o=
0,e=0,k=arguments.length;k--;){o+=arguments[k].x;e+=arguments[k].y}return d(o,e)},absSize:function(o){return Math.max(Math.abs(o.x),Math.abs(o.y))},copy:function(o){return o?d(o.x,o.y):null},diff:b,distance:function(o,e){return g(o,e).total},edges:g,equals:function(o,e){return o.x===e.x&&o.y===e.y},extendBy:function(o,e,k){return d(o.x-Math.cos(e)*k,o.y-Math.sin(e)*k)},floor:function(o){for(var e=Array(o.length),k=o.length;k--;)e[k]=d(~~o[k].x,~~o[k].y);return e},getRect:function(o){for(var e,k,h,
p,t=o.length;t--;){var w=o[t];e=typeof e==="undefined"||w.x<e?w.x:e;k=typeof k==="undefined"||w.y<k?w.y:k;h=typeof h==="undefined"||w.x>h?w.x:h;p=typeof p==="undefined"||w.y>p?w.y:p}return m.init(e,k,h,p)},init:d,invert:function(o){return d(-o.x,-o.y)},min:function(o,e){return d(o.x<e.x?o.x:e.x,o.y<e.y?o.y:e.y)},max:function(o,e){return d(o.x>e.x?o.x:e.x,o.y>e.y?o.y:e.y)},offset:function(o,e,k){return d(o.x+e,o.y+(k?k:e))},simplify:function(o,e){if(!o)return null;e=e?e:l.VECTOR_SIMPLIFICATION;for(var k=
[],h=null,p=o.length;p--;){var t=o[p];if(include=!h||p===0||Math.abs(t.x-h.x)+Math.abs(t.y-h.y)>e){k.unshift(t);h=t}}return k},theta:function(o,e,k){k=Math.asin((o.y-e.y)/k);return o.x>e.x?k:Math.PI-k}}}(),n=function(){return{dotProduct:function(b,g){return b.x*g.x+b.y*g.y}}}(),m=function(){function b(d){return g(d.x1,d.y1,d.x2,d.y2)}function g(d,o,e,k){d=d?d:0;o=o?o:0;e=typeof e!=="undefined"?e:d;k=typeof k!=="undefined "?k:k;return{x1:d,y1:o,x2:e,y2:k,width:e-d,height:k-o}}return{center:function(d){return l.init(d.x1+
d.width/2,d.y1+d.height/2)},copy:b,diagonalSize:function(d){return Math.sqrt(d.width*d.width+d.height*d.height)},fromCenter:function(d,o,e,k){e=~~(e/2);k=~~(k/2);return g(d-e,o-k,d+e,o+k)},init:g,intersect:function(d,o){var e=g(Math.max(d.x1,o.x1),Math.max(d.y1,o.y1),Math.min(d.x2,o.x2),Math.min(d.y2,o.y2));return e.width>0&&e.height>0?e:null},union:function(d,o){if(d.width===0||d.height===0)return b(o);else if(o.width===0||o.height===0)return b(d);else{var e=g(Math.min(d.x1,o.x1),Math.min(d.y1,o.y1),
Math.max(d.x2,o.x2),Math.max(d.y2,o.y2));return e.width>0&&e.height>0?e:null}}}}(),f=function(){return{getAspectRatio:function(b){return b.height!==0?b.width/b.height:1},getCenter:function(b){return l.init(b.width/2,b.height/2)},getSize:function(b){return Math.sqrt(Math.pow(b.width,2)+Math.pow(b.height,2))},init:function(b,g){b=b?b:0;return{width:b,height:g?g:b}}}}(),a={ex:COG.extend,ticks:function(){return(new Date).getTime()},userMessage:function(b,g,d){a.trigger("userMessage",b,g,d)},XY:l,XYRect:m,
Vector:function(b,g){COG.Log.warn("The T5.Vector class has been deprecated, please use T5.XY.init instead");return l.init(b,g)},V:COG.extend(l,n),D:f};COG.observable(a);return a}();
(function(){function l(){for(;w.length>0;){var u=w.shift();document.location=u}t=0}function n(u){for(var v=true,D=z.length;D--;)v=v&&u!=z[D];return v}function m(u,v){var D=[];for(var A in v)A&&D.push(A+"="+escape(v[A]));return"tile5://"+u+"/"+(D.length>0?"?"+D.join("&"):"")}function f(u,v){n(u)&&COG.Log.info("would push url: "+m(u,v))}function a(u,v){if(n(u)){w.push(m(u,v));t||(t=setTimeout(l,100))}}function b(u){return function(v,D,A){(A?A:u?document.body:document).addEventListener(v,D,false)}}function g(u){return function(v,
D,A){(A?A:u?document.body:document).removeEventListener(v,D,false)}}function d(u,v,D){(D?D:document).attachEvent("on"+u,v)}function o(u,v,D){(D?D:document).detachEvent("on"+u,v)}function e(){k={base:{name:"Unknown",bindEvent:b(),unbindEvent:g(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:f,targetFps:null},ie:{name:"MSIE",regex:/msie/i,bindEvent:d,unbindEvent:o,requireFastDraw:false,targetFps:25},
ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:a,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:a},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:a},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:b(true),unbindEvent:g(true),supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},bridgeNotify:a},froyo:{name:"Android OS >= 2.2",
regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:a}};h=[k.froyo,k.android,k.ipod,k.iphone,k.ipad,k.ie]}var k=null,h=[],p=null,t=0,w=[],z=["view.wake","tile.loaded"];T5.getConfig=function(){k||e();if(!p){COG.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var u=0;u<h.length;u++){var v=h[u];if(v.regex&&v.regex.test(navigator.userAgent)){p=T5.ex({},k.base,v);COG.Log.info("PLATFORM DETECTED AS: "+p.name);break}}if(!p){COG.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
p=k.base}COG.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return p}})();
T5.Dispatcher=function(){var l=[],n={execute:function(m){var f=n.findAction(m);f&&f.execute.apply(f,Array.prototype.slice.call(arguments,1))},findAction:function(m){for(var f=l.length;f--;)if(l[f].id==m)return l[f];return null},getRegisteredActions:function(){return[].concat(l)},getRegisteredActionIds:function(){for(var m=[],f=l.length;f--;)l[f].id&&m.push(l[f].id);return m},registerAction:function(m){m&&m.id&&l.push(m)},Action:function(m){m=T5.ex({autoRegister:true,id:"",title:"",icon:"",hidden:false,
execute:null},m);var f={id:m.id,execute:function(){m.execute&&m.execute.apply(this,arguments)},getParam:function(a){return m[a]?m[a]:""},toString:function(){return COG.formatStr("{0} [title = {1}, icon = {2}]",f.id,m.title,m.icon)}};m.autoRegister&&n.registerAction(f);return f},Agent:function(m){m=COG.extend({name:"Untitled",translator:null,execute:null},m);var f={getName:function(){return m.name},getParam:function(a){return m[a]},getId:function(){return COG.toID(f.getName())},run:function(a,b){if(m.execute){var g=
m.translator?m.translator(a):a;m.execute.call(f,g,function(d,o){b&&b(d,o,g)})}}};return f},runAgents:function(m,f,a){for(var b=0;b<m.length;b++)m[b].run(f,a)}};return n}();
T5.Resources=function(){var l="",n={},m={getPath:function(f){return/^(file|https?|\/)/.test(f)?f:l+f},setBasePath:function(f){l=f},loadResource:function(f){f=T5.ex({filename:"",cacheable:true,dataType:null,callback:null},f);var a=function(b){f.callback&&COG.Log.watch("CALLING RESOURCE CALLBACK",function(){f.callback(b)})};f.cacheable&&n[f.filename]?a(n[f.filename]):COG.xhr({url:m.getPath(f.filename),dataType:f.dataType,success:function(b){if(f.cacheable)n[f.filename]=b;a(b)},error:function(b,g,d){COG.Log.error("error loading resource ["+
f.filename+"], error = "+d)}})},loadSnippet:function(f,a){/\.\w+$/.test(f)||(f+=".html");m.loadResource({filename:"snippets/"+f,callback:a,dataType:"html"})}};return m}();
T5.Images=function(){function l(){if(!t){var u=T5.getConfig().maxImageLoads;t=COG.Loopage.join({execute:function(v,D){if(!u||k.length<u){var A=e.shift();if(A){k[k.length]=A;A.image.onload=m;A.image.src=T5.Resources.getPath(A.url);A.requested=T5.ticks()}else D.trigger("complete")}},frequency:10});t.bind("complete",function(){t=null})}}function n(){w=true;try{var u=h.length/2>>0;if(u>0){h.sort(function(D,A){return D.created-A.created});for(var v=u;v--;)delete b[h[v].url];h.splice(0,u)}}finally{w=false}COG.say("imagecache.cleared")}
function m(){var u=d[this.id],v;if(u&&u.image.complete&&u.image.width>0){u.loaded=true;u.hitCount=1;for(v=k.length;v--;)if(k[v].image.src==this.src){k.splice(v,1);break}if(u.background||u.postProcess||u.drawBackground||u.customDraw)if(u.image){globalImageData=u;v=a(u.realSize?u.realSize.width:u.image.width,u.realSize?u.realSize.height:u.image.height);var D=v.getContext("2d"),A=u.offset?u.offset:T5.XY.init();u.background&&D.drawImage(u.background,0,0);u.drawBackground&&u.drawBackground(D);u.customDraw?
u.customDraw(D,u):D.drawImage(u.image,A.x,A.y);u.postProcess&&u.postProcess(D,u);u.image=v}for(v=u.callbacks.length;v--;)u.callbacks[v]&&u.callbacks[v](this,false);u.callbacks=[];h[h.length]={url:this.src,created:u.requested};delete d[this.id];l()}}function f(u,v,D){var A=b[u];if(A){A.hitCount++;A.image.complete&&A.image.width>0&&v?v(A.image,true):A.callbacks.push(v)}else{A=T5.ex({url:u,image:new Image,loaded:false,created:T5.ticks(),requested:null,hitCount:0,callbacks:[v]},D);A.image.id="resourceLoaderImage"+
o++;b[u]=A;d[A.image.id]=A;e[e.length]=A;l()}return A}function a(u,v){var D=document.createElement("canvas");D.width=u?u:0;D.height=v?v:0;if(typeof FlashCanvas!=="undefined"){D.id="tmpCanvas"+g++;D.style.cssText="position: absolute; top: -"+(v-1)+"px; left: -"+(u-1)+"px;";document.body.appendChild(D);FlashCanvas.initElement(D)}typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(D);return D}var b={},g=0,d={},o=0,e=[],k=[],h=[],p=0,t=null,w=false,z={avgImageSize:25,loadTimeout:10,
cancelLoad:function(){k=[]},get:function(u,v,D){var A=null,Q=null;w||(A=b[u]);if((Q=A?A.image:null)&&(Q.getContext||Q.complete&&Q.width>0))return Q;else v&&f(u,v,D);return null},load:f,newCanvas:a,reset:function(){b={}},stats:function(){return{imageLoadingCount:k.length,queuedImageCount:e.length,imageCacheFullness:p}}};COG.Loopage.join({execute:function(u){for(var v=false,D=0,A=T5.getConfig();D<k.length;)if(u-k[D].requested>z.loadTimeout*1E3){k.splice(D,1);v=true}else D++;v&&l();if(A&&A.imageCacheMaxSize){p=
h.length*z.avgImageSize/A.imageCacheMaxSize;p>=1&&n()}},frequency:2E4});return z}();T5.Generator=function(){var l={};return{init:function(n,m){var f=l[n];if(!f)throw Error("Unable to locate requested generator: "+n);return new f(m)},register:function(n,m){l[n]=m},Template:function(){}}}();
T5.TimeLord=function(){var l=/^P(\d+Y)?(\d+M)?(\d+D)?$/,n=/^(\d+H)?(\d+M)?(\d+S)?$/,m=function(a,b){return{days:a?a:0,seconds:b?b:0}},f={8601:function(a){a=a.split("T");var b=null;b=null;var g=0,d=0;l.lastIndex=-1;b=l.exec(a[0]);g+=b[3]?parseInt(b[3].slice(0,-1),10):0;n.lastIndex=-1;b=n.exec(a[1]);d+=b[1]?parseInt(b[1].slice(0,-1),10)*3600:0;d+=b[2]?parseInt(b[2].slice(0,-1),10)*60:0;d+=b[3]?parseInt(b[3].slice(0,-1),10):0;return new m(g,d)}};return{Duration:m,addDuration:function(){for(var a=new m,
b=arguments.length;b--;){a.days+=arguments[b].days;a.seconds+=arguments[b].seconds}if(a.seconds>=86400){a.days+=~~(a.seconds/86400);a.seconds%=86400}return a},parseDuration:function(a,b){var g=b?f[b]:null;if(g)return g(a);COG.Log.warn("Could not find duration parser for specified format: "+b);return new m},formatDuration:function(a){var b,g,d="";if(a.days)d=a.days+" days ";if(a.seconds){a=a.seconds;if(a>=3600){b=~~(a/3600);a-=b*3600}if(a>=60){g=Math.round(a/60);a-=g*60}if(b)d=d+b+(b>1?" hrs ":" hr ")+
(g?(g>10?g:"0"+g)+" min ":"");else if(g)d=d+g+" min";else if(a>0)d=d+(a>10?a:"0"+a)+" sec"}return d}}}();
T5.zoomable=function(l,n){function m(a,b){if(a&&f!==a){f=a;l.triggerAll("zoomLevelChange",f,b)}}n=T5.ex({initial:1,min:0,max:null,zoomAnimation:T5.easing("quad.out")},n);var f=n.initial;T5.ex(l,{getZoomLevel:function(){return f},setZoomLevel:m,zoomIn:function(){l.scale(2,T5.easing("sine.out"))||l.setZoomLevel(f+1)},zoomOut:function(){l.scale(0.5,T5.easing("sine.out"))||l.setZoomLevel(f-1)}});l.bind("scale",function(a,b,g){l.updateOffset(g.x*b,g.y*b);a=0;b=Math.sqrt(b);if(b<1)a=-(0.5/b);else if(b>
1)a=b;T5.cancelAnimation(function(d){return d.cancelOnInteract});m(f+a>>0,g)});l.bind("doubleTap",function(a,b,g){if(l.scalable()){T5.cancelAnimation(function(d){return d.cancelOnInteract});l.animate(2,T5.D.getCenter(l.getDimensions()),T5.XY.init(g.x,g.y),n.zoomAnimation)}})};
(function(){var l=Math.PI*2,n=Math.PI/2,m=Math.abs,f=Math.pow,a=Math.sin,b=Math.asin,g=Math.cos,d=1.70158,o={linear:function(e,k,h,p){return h*e/p+k},backin:function(e,k,h,p){return h*(e/=p)*e*((d+1)*e-d)+k},backout:function(e,k,h,p){return h*((e=e/p-1)*e*((d+1)*e+d)+1)+k},backinout:function(e,k,h,p){return(e/=p/2)<1?h/2*e*e*(((d*=1.525)+1)*e-d)+k:h/2*((e-=2)*e*(((d*=1.525)+1)*e+d)+2)+k},bouncein:function(e,k,h,p){return h-o.bounceout(p-e,0,h,p)+k},bounceout:function(e,k,h,p){return(e/=p)<1/2.75?
h*7.5625*e*e+k:e<2/2.75?h*(7.5625*(e-=1.5/2.75)*e+0.75)+k:e<2.5/2.75?h*(7.5625*(e-=2.25/2.75)*e+0.9375)+k:h*(7.5625*(e-=2.625/2.75)*e+0.984375)+k},bounceinout:function(e,k,h,p){return e<p/2?o.bouncein(e*2,0,h,p)/2+k:o.bounceout(e*2-p,0,h,p)/2+h/2+k},cubicin:function(e,k,h,p){return h*(e/=p)*e*e+k},cubicout:function(e,k,h,p){return h*((e=e/p-1)*e*e+1)+k},cubicinout:function(e,k,h,p){if((e/=p/2)<1)return h/2*e*e*e+k;return h/2*((e-=2)*e*e+2)+k},elasticin:function(e,k,h,p,t,w){if(e==0)return k;if((e/=
p)==1)return k+h;w||(w=p*0.3);if(!t||t<m(h)){t=h;h=w/4}else h=w/l*b(h/t);return-(t*f(2,10*(e-=1))*a((e*p-h)*l/w))+k},elasticout:function(e,k,h,p,t,w){var z;if(e==0)return k;if((e/=p)==1)return k+h;w||(w=p*0.3);if(!t||t<m(h)){t=h;z=w/4}else z=w/l*b(h/t);return t*f(2,-10*e)*a((e*p-z)*l/w)+h+k},elasticinout:function(e,k,h,p,t,w){var z;if(e==0)return k;if((e/=p/2)==2)return k+h;w||(w=p*0.3*1.5);if(!t||t<m(h)){t=h;z=w/4}else z=w/l*b(h/t);if(e<1)return-0.5*t*f(2,10*(e-=1))*a((e*p-z)*l/w)+k;return t*f(2,
-10*(e-=1))*a((e*p-z)*l/w)*0.5+h+k},quadin:function(e,k,h,p){return h*(e/=p)*e+k},quadout:function(e,k,h,p){return-h*(e/=p)*(e-2)+k},quadinout:function(e,k,h,p){if((e/=p/2)<1)return h/2*e*e+k;return-h/2*(--e*(e-2)-1)+k},sinein:function(e,k,h,p){return-h*g(e/p*n)+h+k},sineout:function(e,k,h,p){return h*a(e/p*n)+k},sineinout:function(e,k,h,p){return-h/2*(g(Math.PI*e/p)-1)+k}};T5.easing=function(e){return o[e.replace(/[\-\_\s\.]/g,"").toLowerCase()]};T5.registerEasingType=function(e,k){o[e.replace(/[\-\_\s\.]/g,
"").toLowerCase()]=k}})();
T5.Tween=function(l){l=T5.ex({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:T5.easing("sine.out"),complete:null,cancelOnInteract:false},l);var n=T5.ticks(),m=[],f=false,a=0,b=0,g={cancelOnInteract:l.cancelOnInteract,isComplete:function(){return f},triggerComplete:function(d){l.complete&&l.complete(d)},update:function(d){try{var o=l.tweenFn(d-n,a,b,l.duration);if(l.target)l.target[l.property]=o;for(var e=m.length;e--;)m[e](o,void 0);if(f=n+l.duration<=d){if(l.target)l.target[l.property]=
l.tweenFn(l.duration,a,b,l.duration);for(var k=m.length;k--;)m[k](o,true)}}catch(h){COG.Log.exception(h)}},requestUpdates:function(d){m.push(d)}};a=l.target&&l.property&&l.target[l.property]?l.target[l.property]:l.startValue;if(typeof l.endValue!=="undefined")b=l.endValue-a;if(b==0)f=true;T5.wakeTweens();return g};
(function(){function l(a){if(f)return n.length;f=true;try{for(var b=0;b<n.length;)if(n[b].isComplete()){n[b].triggerComplete(false);n.splice(b,1)}else{n[b].update(a);b++}}finally{f=false}n.length===0&&m.trigger("complete");return n.length}var n=[],m=null,f=false;T5.tweenValue=function(a,b,g,d,o){a=new T5.Tween({startValue:a,endValue:b,tweenFn:g,complete:d,duration:o});n.push(a);return a};T5.tween=function(a,b,g,d,o,e){a=new T5.Tween({target:a,property:b,endValue:g,tweenFn:d,duration:e,complete:o});
n.push(a);return a};T5.tweenVector=function(a,b,g,d,o,e){var k=[];if(a){var h=a.x==b,p=a.y==g;h||k.push(T5.tween(a,"x",b,d,function(){(h=true)&&p&&o()},e));p||k.push(T5.tween(a,"y",g,d,function(){p=true;h&&p&&o()},e))}return k};T5.cancelAnimation=function(a){if(!f){f=true;try{for(var b=0;b<n.length;)if(!a||a(n[b])){n[b].triggerComplete(true);n.splice(b,1)}else b++}finally{f=false}}};T5.isTweening=function(){return n.length>0};T5.wakeTweens=function(){if(!m){m=COG.Loopage.join({execute:l,frequency:20});
m.bind("complete",function(){m=null})}}})();(function(){var l={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,ZOOM:16,FREEZE:128};T5.viewState=function(){for(var n=0,m=arguments.length;m--;){var f=l[arguments[m].toUpperCase()];if(f)n|=f}return n}})();
T5.ViewLayer=function(l){l=T5.ex({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:T5.viewState("ACTIVE","ANIMATING","PAN","ZOOM"),style:null,minXY:null,maxXY:null},l);var n=null,m=false,f=false,a=l.supportFastDraw,b=l.id,g=T5.viewState("ACTIVE"),d=l.validStates,o=0,e=0,k=T5.ex({addToView:function(h){h.setLayer(b,k)},shouldDraw:function(h,p,t){return(f||t||o!==p.x1||e!==p.y1)&&(h&d)!==0&&(m?a:true)},clip:null,cycle:function(){},draw:function(){},remove:function(){k.trigger("remove",
k)},changed:function(h){f=true;k.trigger("changed",k);n&&n.trigger("invalidate",h)},getId:function(){return b},setId:function(h){b=h},getParent:function(){return n},setParent:function(h){m=(n=h)?n.fastDraw&&displayState!==g:false;k.trigger("parentChange",n)}},l);COG.observable(k);k.bind("drawComplete",function(h,p){f=false;o=p.x1;e=p.y1});k.bind("resync",function(h,p){if(p.syncXY){k.minXY&&p.syncXY(k.minXY);k.maxXY&&p.syncXY(k.maxXY)}});return k};
T5.View=function(l){function n(y,B,K,O){Z=ma;v();if(O&&l.inertia){W=true;e(M+B,s+K,l.panAnimationEasing,l.panAnimationDuration)}else O||e(M+B,s+K)}function m(){Z=la;W=false;COG.Loopage.join({execute:v,after:50,single:true})}function f(y,B){var K=ua(y);J(K);var O=E(K),P=ua(B),U=J(P);P=E(P);T=T5.XY.offset(U,M,s);R=K&&O!==0?P/O:1}function a(y,B,K){f(B,K);if(da=R!==1){Z=$;v()}}function b(y,B,K){f(B,K);if(l.adjustScaleFactor){R=l.adjustScaleFactor(R);COG.Log.info("scale factor adjusted to: "+R)}d();R=
1}function g(y,B,K){G.zoom(B,Math.min(Math.pow(2,Math.round(Math.log(K))),8),500)}function d(){var y=T5.XY.init(na-(r.width/(R*2)>>0),ja-(r.height/(R*2)>>0));R=Math.round(R*10)/10;da=false;for(var B=A.length;B--;)A[B].trigger("scale",R,y);G.trigger("scale",R,y);Z=la;v()}function o(){clearTimeout(ha);ha=setTimeout(k,50)}function e(y,B,K,O,P){function U(){X+=1;if(X>=2){m(0,0);P&&P()}}var X=0;if(V){y=y<V.x?V.x:y;B=B<V.y?V.y:B}if(S){y=y>S.x?S.x:y;B=B>S.y?S.y:B}if(K){y=T5.tweenValue(M,y,K,U,O);B=T5.tweenValue(s,
B,K,U,O);y.cancelOnInteract=true;y.requestUpdates(function(Y){M=Y;W=true;v()});B.cancelOnInteract=true;B.requestUpdates(function(Y){s=Y;W=true;v()})}else{M=y;s=B}}function k(){var y;if(H){COG.Touch.release(H);if(l.autoSize&&H.parentNode){y=H.parentNode.getBoundingClientRect();if(y.height!==0&&y.width!==0){H.height=y.height;H.width=y.width}}try{if(!H.id)H.id=l.id+"_canvas";N=H.getContext("2d")}catch(B){COG.Log.exception(B);throw Error("Could not initialise canvas on specified view element");}ra=COG.Touch.capture(H,
{observable:G});if(I.height!==H.height||I.width!==H.width){I=T5.D.init(H.width,H.height);G.trigger("resize",H.width,H.height);for(y=Q;y--;)A[y].trigger("resize",H.width,H.height)}l.inertia&&ra.inertiaEnable(l.panAnimationDuration,I);for(y=Q;y--;)A[y].trigger("contextChanged",N);v()}}function h(y,B){B.setId(y);B.added=T5.ticks();B.bind("remove",function(){G.removeLayer(y)});B.trigger("contextChanged",N);B.setParent(G);A.push(B);A.sort(function(K,O){var P=O.zindex-K.zindex;if(P===0)P=O.added-K.added;
return P});Q=A.length;return B}function p(){return T5.XYRect.init(M,s,M+I.width,s+I.height)}function t(y,B,K,O,P,U,X){function Y(){U&&U();d();R=1;ka=null}da=true;T=T5.XY.offset(O,M,s);if(P)T5.tweenValue(0,B-y,P,Y,X?X:1E3).requestUpdates(function(ga){ka=ga/(B-y);R=y+ga;Z=$;v();G.trigger("animate")});else{R=B;Y()}}function w(){D("idle",G);ia=true;fa=0}function z(y,B,K,O){var P=false,U=(y&$)!==0,X=T5.XYRect.copy(B),Y,ga=0;K&&N.clearRect(0,0,H.width,H.height);N.save();try{oa=R;N.globalCompositeOperation=
"source-over";if(U){U=1/R;var va=(U-0.5)*2,ya=X.width*U>>0,za=X.height*U>>0,Aa=T.y-(s+X.height/2);na=T.x-(T.x-(M+X.width/2))*va>>0;ja=T.y-Aa*va>>0;X=T5.XYRect.fromCenter(na,ja,ya,za);N.scale(R,R)}N.translate(-X.x1,-X.y1);S=V=null;N.beginPath();for(ga=Q;ga--;)if(A[ga].clip){A[ga].clip(N,X,y,G,K,O);P=true}N.closePath();P&&N.clip();for(ga=Q;ga--;){Y=A[ga];var wa=Y.style,xa=wa?T5.Style.apply(N,wa):null;if(Y.minXY)V=V?T5.XY.min(V,Y.minXY):T5.XY.copy(Y.minXY);if(Y.maxXY)S=S?T5.XY.max(S,Y.maxXY):T5.XY.copy(Y.maxXY);
Y.draw(N,X,y,G,K,O);xa&&T5.Style.apply(N,xa);Y.trigger("drawComplete",X,O)}}finally{N.restore()}if(C){N.globalCompositeOperation="source-over";N.strokeStyle="#f00";N.beginPath();N.moveTo(H.width/2,0);N.lineTo(H.width/2,H.height);N.moveTo(0,H.height/2);N.lineTo(H.width,H.height/2);N.stroke()}G.trigger("drawComplete",B,O);COG.Log.trace("draw complete",O)}function u(y,B){var K=false,O=pa?pa:W?ma:Z,P=!W&&(O===$||O===ma),U=ea||O===ma||O===$||T5.isTweening();q=T5.XY.init(M>>0,s>>0);r=p();if(P){T5.cancelAnimation(function(X){return X.cancelOnInteract});
ia=false;if(fa!==0){clearTimeout(fa);fa=0}}for(P=Q;P--;){if(A[P].animated)Z|=ta;A[P].cycle(y,r,Z,U);K=A[P].shouldDraw(Z,r,U)||K}U=U||(Z&ta)!==0;if(K=K||U||R!==1&&R!==ba){z(O,r,U,y);ba=R;ea=false}if(!K&&L===0&&!sa){if(!ia&&fa===0)fa=setTimeout(w,500);B.trigger("complete")}L=0;COG.Log.trace("Completed draw cycle",y)}function v(y){ea=y?true:false;L+=1;if(!x){x=COG.Loopage.join({execute:u,frequency:ca});x.bind("complete",function(){x=null})}}function D(){G.trigger.apply(null,arguments);for(var y=A.length;y--;)A[y].trigger.apply(null,
arguments)}l=T5.ex({id:COG.objId("view"),container:"",fastDraw:false,inertia:true,pannable:true,scalable:true,panAnimationEasing:T5.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:true,tapExtent:10,mask:true,guides:false,fps:25},l);var A=[],Q=0,H=document.getElementById(l.container),N=null,M=0,s=0,q=null,r=null,x=null,C=l.guides,F=1,I=T5.D.init(),L=0,T=null,ia=false,W=false,fa=0,qa=0,V=null,S=null,aa=0,da=false,pa=null,ea=false,ha=0,R=1,ba=0,
oa=1,ka=null,sa=typeof FlashCanvas!=="undefined",ca=~~(1E3/l.fps),ra=null,na,ja,la=T5.viewState("ACTIVE"),ma=T5.viewState("PAN"),$=T5.viewState("ZOOM"),ta=T5.viewState("ANIMATING"),Z=la,ua=T5.XY.getRect,E=T5.XYRect.diagonalSize,J=T5.XYRect.center,G={id:l.id,deviceScaling:F,fastDraw:l.fastDraw||T5.getConfig().requireFastDraw,animate:function(y,B,K,O,P){t(R,y,B,K,O,P)},centerOn:function(y){M=y.x;s=y.y},getDimensions:function(){return I},getLayer:function(y){for(var B=0;B<Q;B++)if(A[B].getId()==y)return A[B];
return null},setLayer:function(y,B){for(var K=0;K<Q;K++)if(A[K].getId()===y){A.splice(K,1);break}B&&h(y,B);v();return B},eachLayer:function(y){for(var B=Q;B--;)y(A[B])},invalidate:v,resize:function(y,B){if(H){l.autoSize=false;H.width=y;H.height=B;k();G.trigger("resize",H.width,H.height)}},scale:function(y,B,K,O,P){O||(O=T5.D.getCenter(I));P||(P=T5.D.getCenter(I));G.animate(y,O,P,B,K);return G},triggerAll:D,removeLayer:function(y){a:{for(var B=Q;B--;)if(A[B].getId()==y){y=B;break a}y=-1}if(y>=0&&y<
Q){COG.say("layer.removed",{layer:A[y]});A.splice(y,1);v()}Q=A.length},stateOverride:function(y){pa=y},getOffset:function(){return q?q:T5.XY.init(M,s)},getViewRect:function(){return r?r:p()},updateOffset:e,pan:function(y,B,K,O,P){e(M+y,s+B,K,O,P)},zoom:function(y,B,K){W=false;R=B;da=R!==1;T=T5.XY.offset(y,M,s);clearTimeout(qa);if(da){Z=$;v();if(K)qa=setTimeout(function(){d();R=1},parseInt(K,10))}}};F=T5.getConfig().getScaling();G.markers=h("markers",new T5.MarkerLayer);COG.observable(G);G.bind("invalidate",
function(y,B){v(B)});if(l.pannable){G.bind("pan",n);G.bind("panEnd",m);G.bind("inertiaCancel",function(){W=false;v()})}if(l.scalable){G.bind("pinchZoom",a);G.bind("pinchZoomEnd",b);G.bind("wheelZoom",g)}G.bind("tap",function(y,B,K){for(var O=T5.XY.offset(K,M,s),P=A.length;P--;)y.cancel=y.cancel||A[P].trigger("tap",B,K,O).cancel});G.bind("resync",function(){S=V=null});COG.configurable(G,["inertia","container","rotation","tapExtent","scalable","pannable"],COG.paramTweaker(l,null,{container:function(y,
B){H=document.getElementById(B);k()},rotation:function(y,B){aa=B}}),true);k();l.autoSize&&window.addEventListener("resize",o,false);return G};
T5.PathLayer=function(l){l=T5.ex({style:"waypoints",pixelGeneralization:8,zindex:50},l);var n=false,m=[],f=null,a=[],b=null,g=0,d=[],o=T5.ex(new T5.ViewLayer(l),{getAnimation:function(e,k,h,p){var t="pathAnimation"+g++;d.push(t);return new T5.AnimatedPathLayer({id:t,path:m,zindex:l.zindex+1,easing:e?e:T5.easing("sine.inout"),duration:k?k:5E3,drawIndicator:h,autoCenter:p?p:false})},cycle:function(e,k,h,p){return p},draw:function(e){var k,h=m.length;e.save();try{T5.Style.apply(e,l.style);if(h>0){e.beginPath();
e.moveTo(m[h-1].x,m[h-1].y);for(k=h;k--;)e.lineTo(m[k].x,m[k].y);e.stroke();if(f){e.fillStyle=l.waypointFillStyle;for(k=f.length;k--;){e.beginPath();e.arc(f[k].x,f[k].y,2,0,Math.PI*2,false);e.stroke();e.fill()}}}}finally{e.restore()}n=false},updateCoordinates:function(e,k){a=e;b=k;var h=o.getParent();if(h&&h.syncXY){h.syncXY(a);b&&h.syncXY(b);o.trigger("tidy")}}});o.bind("tidy",function(){m=T5.XY.simplify(a,l.pixelGeneralization);f=T5.XY.simplify(b,l.pixelGeneralization);n=true;o.changed()});return o};
T5.ShapeLayer=function(l){function n(b){for(var g=f.length;g--;)f[g].resync(b);f.sort(function(d,o){var e=o.xy.y-d.xy.y;if(e===0)e=o.xy.x-d.xy.y;return e});a.changed()}function m(b,g){g.syncXY&&n(g)}l=T5.ex({zindex:80},l);var f=[],a=T5.ex(new T5.ViewLayer(l),{add:function(b){f[f.length]=b},each:function(b){for(var g=f.length;g--;)b(f[g])},draw:function(b,g,d){var o=g.x1,e=g.y1,k=g.width;g=g.height;for(var h=f.length;h--;){var p=f[h].style;p=p?T5.Style.apply(b,p):null;f[h].draw(b,o,e,k,g,d);p&&T5.Style.apply(b,
p)}}});a.bind("parentChange",m);a.bind("resync",m);return a};T5.PolyLayer=T5.ShapeLayer;T5.Shape=function(l){l=T5.ex({style:null,properties:{}},l);return T5.ex(l,{rect:null,draw:function(){},resync:function(){}})};T5.Arc=function(l,n){n=T5.ex({size:4},n);var m=T5.XY.init(),f=T5.ex(n,{draw:function(a){a.beginPath();a.arc(m.x,m.y,f.size,0,Math.PI*2,false);a.fill();a.stroke()},resync:function(a){a.syncXY([l]);m=T5.XY.floor([l])[0]}});COG.Log.info("created arc = ",l);return f};
T5.Poly=function(l,n){n=T5.ex({fill:false,simplify:false},n);var m=false,f=n.fill,a=n.simplify,b=T5.viewState("ZOOM"),g=[],d=T5.ex(new T5.Shape(n),{draw:function(o,e,k,h,p,t){if(m){e=true;k=(t&b)!==0;o.beginPath();for(t=g.length;t--;){k=g[t].x;h=g[t].y;if(e){o.moveTo(k,h);e=false}else o.lineTo(k,h);k=true}if(k){f&&o.fill();o.stroke()}}},resync:function(o){d.xy=o.syncXY(l);g=T5.XY.floor(a?T5.XY.simplify(l):l)}});m=l&&l.length>=2;return d};
T5.AnimatedPathLayer=function(l){function n(d,o,e){d.fillStyle="#FFFFFF";d.strokeStyle="#222222";d.beginPath();d.arc(e.x,e.y,4,0,Math.PI*2,false);d.stroke();d.fill()}l=T5.ex({path:[],id:COG.objId("pathAni"),easing:T5.easing("sine.inout"),validStates:T5.viewState("ACTIVE","PAN","ZOOM"),drawIndicator:null,duration:2E3,autoCenter:false},l);var m=T5.XY.edges(l.path),f,a=null,b=0;T5.tweenValue(0,m.total,l.easing,function(){g.remove()},l.duration).requestUpdates(function(d,o){b=d;o&&g.remove()});var g=
T5.ex(new T5.ViewLayer(l),{cycle:function(){for(var d=0;d<m.accrued.length&&m.accrued[d]<b;)d++;a=null;if(d<l.path.length-1){var o=b-(d>0?m.accrued[d-1]:0),e=l.path[d];f=T5.XY.theta(e,l.path[d+1],m.edges[d]);a=T5.XY.extendBy(e,f,o);if(l.autoCenter)(d=g.getParent())&&d.centerOn(a)}return a},draw:function(d,o){if(a)(l.drawIndicator?l.drawIndicator:n)(d,o,T5.XY.init(a.x,a.y),f)}});return g};
T5.Marker=function(l){function n(o,e,k,h){f=o;a=e;b=k;g=h}l=T5.ex({xy:T5.XY.init(),offset:true,tweenIn:null,animationSpeed:null},l);var m=false,f=0,a=0,b=0,g=0,d=T5.ex(l,{isNew:true,isAnimating:function(){return m},draw:function(o,e,k,h,p){if(d.isNew&&l.tweenIn){var t=d.xy.y;d.xy.y=e.y1-20;m=true;T5.tween(d.xy,"y",t,l.tweenIn,function(){d.xy.y=t;m=false},l.animationSpeed?l.animationSpeed:250+Math.random()*500)}d.drawMarker(o,e,d.xy.x,d.xy.y,k,h,p);d.isNew=false},drawMarker:function(o,e,k,h){o.beginPath();
o.arc(k,h,4,0,Math.PI*2,false);o.fill();n(k-4,h-4,8,8)},hitTest:function(o,e){return o>=f&&o<=f+b&&e>=a&&e<=a+g},updateBounds:n});COG.observable(d);return d};
T5.ImageMarker=function(l){l=T5.ex({image:null,imageUrl:null,animatingImage:null,animatingImageUrl:null,imageAnchor:null,rotation:0,scale:1,opacity:1},l);var n=l.imageAnchor?T5.XY.invert(l.imageAnchor):null,m=T5.ex(new T5.Marker(l),{drawMarker:function(f,a,b,g){if((a=m.isAnimating()&&m.animatingImage?m.animatingImage:m.image)&&a.width>0){n||(n=T5.XY.init(-a.width>>1,-a.height>>1));var d=m.scale,o=b+~~(n.x*d),e=g+~~(n.y*d),k=~~(a.width*d),h=~~(a.height*d);m.updateBounds(o,e,k,k);if(m.rotation||m.opacity!==
1){f.save();try{f.globalAlpha=m.opacity;f.translate(b,g);f.rotate(m.rotation);f.drawImage(a,n.x*d,n.y*d,k,h)}finally{f.restore()}}else f.drawImage(a,o,e,k,h)}}});if(!m.image)m.image=T5.Images.get(l.imageUrl,function(f){m.image=f});if(!m.animatingImage)m.animatingImage=T5.Images.get(l.animatingImageUrl,function(f){m.animatingImage=f});return m};T5.Annotation=T5.Marker;T5.ImageAnnotation=T5.ImageMarker;
T5.MarkerLayer=function(l){function n(){a.changed();a.trigger("markerUpdate",f)}function m(){var b=a.getParent();if(b&&b.syncXY)for(var g=f.length;g--;)b.syncXY([f[g].xy])}l=T5.ex({zindex:100,style:"basic"},l);var f=[],a=T5.ex(new T5.ViewLayer(l),{draw:function(b,g,d,o){for(var e=f.length;e--;)f[e].draw(b,g,d,a,o)},add:function(b){if(b&&typeof b.length!=="undefined")for(var g=b.length;g--;){if(b[g])f[f.length]=b[g]}else if(b)f[f.length]=b;n()},clear:function(b){if(b)for(var g=0;g<f.length;g++)b(f[g])&&
f.splice(g,1);else f=[];n()},each:function(b){if(b)for(var g=f.length;g--;)b(f[g])},find:function(b){for(var g=[],d=f.length;d--;)if(!b||b(f[d]))g[g.length]=f[d];return g}});a.bind("tap",function(b,g,d){for(var o=[],e=d.x,k=d.y,h=f.length;h--;)if(f[h].hitTest(e,k))o[o.length]=f[h];if(o.length>0)b.cancel=a.trigger("markerTap",g,d,o).cancel});a.bind("parentChange",m);a.bind("resync",m);a.bind("changed",m);return a};
T5.ImageLayer=function(l,n){function m(h,p,t){if(g)for(var w=g.length;w--;){var z=g[w],u=z.x,v=z.y,D=T5.XYRect.init(z.x,z.y,z.x+z.width,z.y+z.height);if(t&&T5.XYRect.intersect(h,D)){D=T5.Images.get(z.url,(p&e)===0?a:null,o);t(D,u,v,z.width,z.height)}}}function f(h){b&&b.run(h,function(p){g=p;k.changed()})}function a(){k.changed()}n=T5.ex({imageLoadArgs:{}},n);var b=l?T5.Generator.init(l,n):null,g=null,d=T5.XYRect.init(),o=n.imageLoadArgs,e=T5.viewState("ZOOM"),k=T5.ex(new T5.ViewLayer(n),{changeGenerator:function(h,
p){b=T5.Generator.init(h,T5.ex({},n,p));b.bindToView(k.getParent());g=null;f(d)},clip:function(h,p,t){m(p,t,function(w,z,u,v,D){w&&h.rect(z,u,v,D)})},cycle:function(h,p){f(p)},draw:function(h,p,t){m(p,t,function(w,z,u,v,D){k.drawImage(h,w,z,u,v,D,p,t)});d=T5.XYRect.copy(p)},drawImage:function(h,p,t,w){p&&h.drawImage(p,t,w,p.width,p.height)}});k.bind("idle",function(){f(d)});k.bind("parentChange",function(h,p){b&&b.bindToView(p)});k.bind("tap",function(h,p,t,w){h=[];var z=w.x,u=w.y,v,D;if(g)for(var A=
g.length;A--;){v=g[A];if(D=z>=v.x&&z<=v.x+v.width&&u>=v.y&&u<=v.y+v.height)h[h.length]=v}h.length>0&&k.trigger("tapImage",h,p,t,w)});return k};
T5.Style=function(){function l(g,d){a[g]=m(d);return g}function n(g){for(var d in g)l(d,g[d])}function m(g){function d(h){var p=g[h];typeof p!=="undefined"&&e.push(function(t){t[h]=p})}function o(){e=[];for(var h in g)d(h)}g=T5.ex({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},g);var e=[],k={applyToContext:function(h){for(var p=e.length;p--;)e[p](h)},update:function(h,
p){g[h]=p;o()}};o();return k}var f={},a={},b={apply:function(g,d){var o=a[d]?a[d]:a.basic,e;if(g&&g.canvas){e=f[g.canvas.id];f[g.canvas.id]=d}o.applyToContext(g);return e},define:l,defineMany:n,get:function(g){return a[g]},init:m,load:function(g){COG.jsonp(g,function(d){T5.resetStyles(d)})}};n({basic:{lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"},waypoints:{lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"}});return b}();
T5.Tiling=function(){return{tileSize:256,init:function(l,n,m,f,a){return T5.ex({x:l,y:n,width:m,height:f},a)}}}();
T5.TileGenerator=function(l){function n(w,z,u,v){function D(){if(t.initTileCreator){d=true;t.initTileCreator(w,z,u,v)}}t.prepTileCreator?t.prepTileCreator(w,z,u,D):D()}function m(w,z){for(var u=~~((w.x1-b.x)/o),v=~~((w.y1-b.y)/e),D=[],A=-g;A<h;A++)for(var Q=-g;Q<p;Q++){var H=k(u+A,v+Q);if(H)D[D.length]=H}z&&z(D);a=T5.XYRect.copy(w)}l=T5.ex({tileWidth:256,tileHeight:256,relative:false,padding:2},l);var f=null,a=null,b=T5.XY.init(),g=l.padding,d=false,o=l.tileWidth,e=l.tileHeight,k=null,h=0,p=0,t={bindToView:function(w){COG.Log.info("initializing generator");
f=w;t.trigger("bindView",w)},getTileCreatorArgs:null,initTileCreator:null,prepTileCreator:null,requireRefresh:function(){return false},reset:function(){k=null;d=false;a=null},run:function(w,z){if(!a||Math.abs(w.x1-a.x1)>o||Math.abs(w.y1-a.y1)>e){if(!k&&!d||t.requireRefresh()){b=l.relative?T5.XY.init(w.x1,w.y1):T5.XY.init();h=Math.ceil(w.width/o)+g;p=Math.ceil(w.height/e)+g;n(o,e,t.getTileCreatorArgs?t.getTileCreatorArgs(f):{},function(u){k=u;d=false;m(w,z)})}k&&m(w,z)}}};COG.observable(t);t.bind("update",
function(){COG.Log.info("captured generator update");a=null});return t};
T5.Geo=function(){function l(s,q){var r=null;for(var x in N)if(q){if(x==q&&N[x][s]){r=N[x];break}}else if(N[x][s]){r=N[x];break}return r}function n(s,q){var r=h*Math.sin(s);return a-2*Math.atan(q*Math.pow((1-r)/(1+r),h/2))}function m(s,q,r,x){var C=0;s=s.toUpperCase();for(var F in x){var I=q[F];if(I){var L=r[F];I=L?L(s,I):COG.wordExists(s,I)?1:0;C+=I*x[F]}}return C}var f=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],a=Math.PI/2,b=Math.PI*2,g=-a,d=a,o=
-b,e=Math.PI/180,k=180/Math.PI,h=0.08181919084262157,p=null,t={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",HWY:"HIGHWAY",MWY:"MOTORWAY"},w={VECTORIZE_PER_CYCLE:500},z={getEngine:function(s){for(var q=null,r=1;!q&&r<arguments.length;r++)q=l(s,arguments[r]);q=q?q:l(s);if(!q)throw Error("Unable to find GEO engine with "+s+" capability");return q},rankGeocodeResponses:function(s,q,r){var x=[],C=M.AddressCompareFns;if(r&&r.compareFns)C=T5.ex({},C,r.compareFns);for(r=0;r<q.length;r++)x.push(new M.GeoSearchResult({caption:H.toString(q[r]),
data:q[r],pos:q[r].pos,matchWeight:m(s,q[r],C,M.GeocodeFieldWeights)}));x.sort(function(F,I){return I.matchWeight-F.matchWeight});return x},distanceToString:function(s){if(s>1E3)return~~(s/10)/100+" km";return s?s+" m":""},dist2rad:function(s){return s/6371},lat2pix:function(s){s=parseFloat(s)*e;s=Math.sin(s);var q=h*s;return Math.log((1+s)/(1-s)*Math.pow((1-q)/(1+q),h))/2},lon2pix:function(s){return parseFloat(s)*e},pix2lon:function(s){return M.normalizeLon(s)*k},pix2lat:function(s){s=Math.pow(Math.E,
-s);for(var q=a-2*Math.atan(s),r=n(q,s),x=0;x<12&&Math.abs(q-r)>1.0E-7;){q=r;r=n(q,s);x++}return r*k},normalizeLon:function(s){for(;s<-180;)s+=360;for(;s>180;)s-=360;return s},radsPerPixel:function(s){return 2*Math.PI/(256<<s)}},u=function(s,q){return{lat:parseFloat(s?s:0),lon:parseFloat(q?q:0)}},v=function(s,q){return{min:A.parse(s),max:A.parse(q)}},D=function(s){return s=T5.ex({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},s)},A=function(){var s={calcDistance:function(q,
r){if(s.empty(q)||s.empty(r))return 0;var x=(r.lat-q.lat)*e/2,C=(r.lon-q.lon)*e/2;x=Math.sin(x)*Math.sin(x)+Math.cos(q.lat*e)*Math.cos(r.lat*e)*Math.sin(C)*Math.sin(C);return 6371*2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x))},copy:function(q){return q?new u(q.lat,q.lon):null},empty:function(q){return!q||q.lat===0&&q.lon===0},equal:function(q,r){return q&&r&&q.lat==r.lat&&q.lon==r.lon},inArray:function(q,r){for(var x=A.equal,C=r.length;C--;)if(x(q,r[C]))return true;return false},inBounds:function(q,r){var x=
!(A.empty(q)||A.empty(r));return x=(x=x&&q.lat>=r.min.lat&&q.lat<=r.max.lat)&&q.lon>=r.min.lon&&q.lon<=r.max.lon},offset:function(q,r,x){var C=q.lat*e;r=C+r/6371;for(q=q.lon*e+Math.asin(Math.sin(x/6371)/Math.cos(C));r<g;)r+=Math.PI;for(;r>d;)r-=Math.PI;for(;q>b;)q-=2*Math.PI;return new u(r*k,q*k)},parse:function(q){if(q)if(typeof q.lat!=="undefined")return s.copy(q);else{if(q.split)for(var r=[" ",","],x=0;x<r.length;x++){var C=q.split(r[x]);if(C.length===2)return new u(C[0],C[1])}}else return new u;
return null},parseArray:function(q){var r=q.length,x=Array(r);for(r=r;r--;)x[r]=s.parse(q[r]);return x},fromMercatorPixels:function(q,r){return new u(T5.Geo.pix2lat(r),T5.Geo.normalizeLon(T5.Geo.pix2lon(q)))},toMercatorPixels:function(q){return T5.XY.init(T5.Geo.lon2pix(q.lon),T5.Geo.lat2pix(q.lat))},generalize:function(q,r,x){var C=q.length,F=[],I=null;x||(x=250);x/=1E3;COG.Log.info("generalizing positions, must include "+r.length+" positions");for(var L=C;L--;)if(L===0)F.unshift(q[L]);else{var T=
!I||A.inArray(q[L],r)?x:A.calcDistance(I,q[L]);if(q[L]&&T>=x){F.unshift(q[L]);I=q[L]}}COG.Log.info("generalized "+C+" positions into "+F.length+" positions");return F},vectorize:function(q,r){var x=q.length,C=Array(x);r=T5.ex({chunkSize:w.VECTORIZE_PER_CYCLE,async:true},r);if(!r.async){for(var F=x;F--;)C[F]=T5.GeoXY.init(q[F]);return C}return COG.Loopage.join({frequency:10,execute:function(I,L){for(var T=0,ia=r.chunkSize,W=x;W--;){C[W]=T5.GeoXY.init(q[W]);T+=1;if(T>ia)break}x=W;x<=0&&L.trigger("complete",
C)}})},toString:function(q){return q?q.lat+" "+q.lon:""}};return s}(),Q=function(){var s={calcSize:function(q,r,x){var C=T5.XY.init(0,r.lat-q.lat);if(typeof x==="undefined")x=true;C.x=x&&q.lon>r.lon?360-q.lon+r.lon:r.lon-q.lon;return C},createBoundsFromCenter:function(q,r){var x=r/6371,C=q.lat*e,F=q.lon*e,I=C-x,L=C+x;if(I>g&&L<d){C=Math.asin(Math.sin(x)/Math.cos(C));x=F-C;if(x<o)x+=2*Math.PI;F=F+C;if(F>b)F-=2*Math.PI}else{I=Math.max(I,g);L=Math.min(L,d);x=o;F=b}return new v(new u(I*k,x*k),new u(L*
k,F*k))},expand:function(q,r){return new v(new u(q.min.lat-r,q.min.lon-M.normalizeLon(r)),new u(q.max.lat+r,q.max.lon+M.normalizeLon(r)))},forPositions:function(q,r){var x=null,C=T5.ticks();r||(r="auto");for(var F=q.length;F--;)if(x){var I=s.calcSize(x.min,q[F],false),L=s.calcSize(q[F],x.max,false);if(I.x<0)x.min.lon=q[F].lon;if(I.y<0)x.min.lat=q[F].lat;if(L.x<0)x.max.lon=q[F].lon;if(L.y<0)x.max.lat=q[F].lat}else x=new T5.Geo.BoundingBox(q[F],q[F]);if(r){if(r=="auto"){F=s.calcSize(x.min,x.max);r=
Math.max(F.x,F.y)*0.3}x=s.expand(x,r)}COG.Log.trace("calculated bounds for "+q.length+" positions",C);return x},getCenter:function(q){var r=Q.calcSize(q.min,q.max);return new T5.Geo.Position(q.min.lat+r.y/2,q.min.lon+r.x/2)},getGeoHash:function(q){var r=T5.Geo.GeoHash.encode(q.min.lat,q.min.lon);q=T5.Geo.GeoHash.encode(q.max.lat,q.max.lon);COG.Log.info("min hash = "+r+", max hash = "+q)},getZoomLevel:function(q,r){var x=s.getCenter(q),C=f[Math.min(Math.round(Math.abs(x.lat)*0.05),f.length)],F=s.calcSize(q.min,
q.max);x=Math.ceil(Math.log(f[3]*r.height/F.y)/Math.log(2));C=Math.ceil(Math.log(C*r.width/F.x)/Math.log(2));return Math.min(isNaN(x)?1E3:x,isNaN(C)?1E3:C)},isEmpty:function(q){return!q||A.empty(q.min)||A.empty(q.max)},toString:function(q){return"min: "+A.toString(q.min)+", max: "+A.toString(q.max)}};return s}(),H=function(){var s=/^(\d+).*$/,q=/(\d+)\s?\-\s?(\d+)/;return{buildingMatch:function(r,x){s.lastIndex=-1;if(s.test(r))for(var C=r.replace(s,"$1"),F=x.split(","),I=0;I<F.length;I++){q.lastIndex=
-1;if(q.test(F[I])){var L=q.exec(F[I]);if(C>=parseInt(L[1],10)&&C<=parseInt(L[2],10))return true}else if(C==F[I])return true}return false},normalize:function(r){if(!r)return"";r=r.toUpperCase();if(!p){var x=[];for(var C in t)x.push(C);p=RegExp("(\\s)("+x.join("|")+")(\\s|$)","i")}p.lastIndex=-1;if(x=p.exec(r))r=r.replace(p,"$1"+t[x[2]]);return r},toString:function(r){return r.streetDetails+" "+r.location}}}(),N={},M={P:A,B:Q,A:H,Radius:function(s,q){return{distance:parseInt(s,10),uom:q}},Position:u,
BoundingBox:v,Address:D,GeocodeFieldWeights:{streetDetails:50,location:50},AddressCompareFns:{},Engine:function(s){if(!s.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var q=T5.ex({remove:function(){delete N[q.id]}},s);return N[q.id]=q},GeoSearchResult:function(s){s=T5.ex({id:null,caption:"",resultType:"",data:null,pos:null,matchWeight:0},s);return T5.ex(s,{toString:function(){return s.caption+(s.matchWeight?" ("+s.matchWeight+")":"")}})},GeoSearchAgent:function(s){return new T5.Dispatcher.Agent(s)},
GeocodingAgent:function(s){s=T5.ex({name:"Geocoding Search Agent",paramTranslator:null,execute:function(q,r){try{if(!q.reverse&&!q.freeform)address=new D(q);var x=M.getEngine("geocode");if(x)x.geocode({addresses:[q.freeform?q.freeform:address],complete:function(F,I){if(r){var L=I;if(q.freeform)L=M.rankGeocodeResponses(q.freeform,L,M.getEngine("geocode"));r(L,s)}}})}catch(C){COG.Log.exception(C)}}},s);return new M.GeoSearchAgent(s)}};T5.GeoXY=function(){function s(r,x){if(r.length){for(var C,F,I,L,
T=r.length;T--;){s(r[T],x);C=typeof C==="undefined"||r.x<C?r.x:C;F=typeof F==="undefined"||r.y<F?r.y:F;I=typeof I==="undefined"||r.x>I?r.x:I;L=typeof L==="undefined"||r.y>L?r.y:L}return T5.XYRect.init(C,F,L,L)}else if(r.mercXY){C=r.mercXY;r.x=~~(C.x/x);r.y=~~((Math.PI-C.y)/x);r.radsPerPixel=x}else COG.Log.warn("Attempted to sync an XY composite, not a GeoXY");return r}function q(r,x,C){r.pos=x;r.mercXY=A.toMercatorPixels(x);(C=typeof C!=="undefined"?C:r.radsPerPixel)&&s(r,C)}return{init:function(r,
x){var C=T5.XY.init();q(C,r,x);return C},sync:s,toPos:function(r,x){x=x?x:self.radsPerPixel;return A.fromMercatorPixels(r.x*x,Math.PI-r.y*x)},updatePos:q}}();M.GeoVector=function(s){COG.Log.warn("The T5.Geo.GeoVector class has been deprecated, please use T5.GeoXY.init instead");return T5.GeoXY.init(s)};return T5.ex(M,w,z)}();
T5.Geo.GeoHash=function(){function l(n,m,f){if(m&f)n[0]=(n[0]+n[1])/2;else n[1]=(n[0]+n[1])/2}BITS=[16,8,4,2,1];BASE32="0123456789bcdefghjkmnpqrstuvwxyz";NEIGHBORS={right:{even:"bc01fg45238967deuvhjyznpkmstqrwx"},left:{even:"238967debc01fg45kmstqrwxuvhjyznp"},top:{even:"p0r21436x8zb9dcf5h7kjnmqesgutwvy"},bottom:{even:"14365h7k9dcfesgujnmqp0r2twvyx8zb"}};BORDERS={right:{even:"bcfguvyz"},left:{even:"0145hjnp"},top:{even:"prxz"},bottom:{even:"028b"}};NEIGHBORS.bottom.odd=NEIGHBORS.left.even;NEIGHBORS.top.odd=
NEIGHBORS.right.even;NEIGHBORS.left.odd=NEIGHBORS.bottom.even;NEIGHBORS.right.odd=NEIGHBORS.top.even;BORDERS.bottom.odd=BORDERS.left.even;BORDERS.top.odd=BORDERS.right.even;BORDERS.left.odd=BORDERS.bottom.even;BORDERS.right.odd=BORDERS.top.even;return{decode:function(n){var m=1,f=[],a=[];f[0]=-90;f[1]=90;a[0]=-180;a[1]=180;lat_err=90;lon_err=180;for(i=0;i<n.length;i++){c=n[i];cd=BASE32.indexOf(c);for(j=0;j<5;j++){mask=BITS[j];if(m){lon_err/=2;l(a,cd,mask)}else{lat_err/=2;l(f,cd,mask)}m=!m}}f[2]=(f[0]+
f[1])/2;a[2]=(a[0]+a[1])/2;return{latitude:f,longitude:a}},encode:function(n,m,f){var a=1,b=[],g=[],d=0,o=0;f=f?f:12;geohash="";b[0]=-90;b[1]=90;g[0]=-180;for(g[1]=180;geohash.length<f;){if(a){mid=(g[0]+g[1])/2;if(m>mid){o|=BITS[d];g[0]=mid}else g[1]=mid}else{mid=(b[0]+b[1])/2;if(n>mid){o|=BITS[d];b[0]=mid}else b[1]=mid}a=!a;if(d<4)d++;else{geohash+=BASE32[o];o=d=0}}return geohash}}}();
T5.Geo.JSON=function(){function l(k,h,p,t){h=m(h);k.add(t.line(h,p));return h.length}function n(k,h,p,t){h=m(h);k.add(t.poly(h,p));return h.length}function m(k){var h=k?k.length:0,p=Array(h);for(h=h;h--;)p[h]=new T5.Geo.Position(k[h][1],k[h][0]);return T5.Geo.P.vectorize(p,g)}function f(k,h,p){return new e(k,h,p)}var a="featurecollection",b="feature",g={async:false},d={processor:null,group:"shapes",layerClass:T5.ShapeLayer},o={point:T5.ex({},d,{processor:function(k,h,p,t){h=m([h.coordinates],g);if(h.length>
0)if(p=t.marker(h[0],p)){k.add(p);return h.length}},group:"markers",layerClass:T5.MarkerLayer}),linestring:T5.ex({},d,{processor:function(k,h,p,t){h=m(h&&h.coordinates?h.coordinates:[]);return l(k,h,p,t)}}),multilinestring:T5.ex({},d,{processor:function(k,h,p,t){h=h&&h.coordinates?h.coordinates:[];for(var w=0,z=h.length;z--;)w+=l(k,h[z],p,t);return w}}),polygon:T5.ex({},d,{processor:function(k,h,p,t){h=h&&h.coordinates?h.coordinates:[];if(h.length>0)return n(k,h[0],p,t);return 0}}),multipolygon:T5.ex({},
d,{processor:function(k,h,p,t){h=h&&h.coordinates?h.coordinates:[];for(var w=0,z=0;z<h.length;z++)w+=n(k,h[z][0],p,t);return w}})},e=function(k,h,p,t){function w(q,r){var x=q.processor,C=D+q.group,F=T5.ex({},q,p,{properties:r.properties});if(x){var I=M[C];if(!I){I=new q.layerClass({id:C});M[C]=I}globalLayers=M;return x(I,r.data,F,t)}return 0}function z(q,r){var x=q&&q.type?q.type.toLowerCase():null;return x&&x===b?z(q.geometry,q.properties):{type:x,isCollection:x?x===a:false,definition:o[x],data:q,
properties:r?r:q.properties}}p=T5.ex({vectorsPerCycle:T5.Geo.VECTORIZE_PER_CYCLE,rowPreParse:null,simplify:false,layerPrefix:"geojson-"},p);t=T5.ex({marker:function(q){return new T5.Marker({xy:q})},line:function(q,r){return new T5.Poly(q,r)},poly:function(q,r){return new T5.Poly(q,T5.ex({fill:true},r))}},t);var u=p.vectorsPerCycle,v=p.rowPreParse,D=p.layerPrefix,A=0,Q=0,H=null,N=0,M={},s;if(!k)return null;if(typeof k.length==="undefined")k=[k];Q=k.length;s=COG.Loopage.join({frequency:10,execute:function(q,
r){var x=0,C=A;if(!H){for(;C<Q;C++){var F=z(v?v(k[C]):k[C]),I=null;if(F.isCollection){N+=1;H=f(F.data.features,function(L){H=null;for(var T in L)M[T]=L[T]},{layerPrefix:D+N+"-"});I+=1}else if(F.definition)I=w(F.definition,F);x+=I?I:1;if(x>=u)break}A=C+1;!H&&A>=Q&&r.trigger("complete")}}});s.bind("complete",function(){h&&h(M)});return s};return{parse:f}}();
T5.Geo.LocationSearch=function(l){function n(g,d){navigator.geolocation.clearWatch(f);f=0;if(a){clearTimeout(a);a=0}d&&d([g],l)}function m(g){COG.Log.info("caught location tracking error:",g)}l=T5.ex({name:"Geolocation Search",requiredAccuracy:null,searchTimeout:5E3,watch:false},l);var f=0,a=0,b=null;return new T5.Geo.GeoSearchAgent(T5.ex({execute:function(g,d){if(navigator.geolocation&&!f){f=navigator.geolocation.watchPosition(function(o){var e=new T5.Geo.Position(o.coords.latitude,o.coords.longitude);
o=new T5.Geo.GeoSearchResult({id:1,caption:"Current Location",pos:e,accuracy:o.coords.accuracy/1E3,matchWeight:100});if(!b||o.accuracy<b.accuracy)b=o;if(!l.requiredAccuracy||b.accuracy<l.requiredAccuracy)n(b,d)},m,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3});if(l.searchTimeout)a=setTimeout(function(){b&&n(b,d)},l.searchTimeout)}}},l))};
T5.Map=function(l){function n(w){try{var z=new T5.Geo.Position(w.coords.latitude,w.coords.longitude),u=w.coords.accuracy/1E3;t.trigger("locationUpdate",w,u);if(h){if(!e){e=new T5.Geo.UI.LocationOverlay({pos:z,accuracy:u});e.update(t.getTileLayer());t.setLayer("location",e)}var v=T5.Geo.B.createBoundsFromCenter(z,Math.max(u,1));t.gotoBounds(v)}else{e.pos=z;e.accuracy=u;e.update(t.getTileLayer());a(z,null,T5.easing("sine.out"))}h=false}catch(D){COG.Log.exception(D)}}function m(w){COG.Log.info("caught location tracking error:",
w)}function f(w,z,u){t.setZoomLevel(z);T5.Images.cancelLoad();T5.cancelAnimation();a(w,u)}function a(w,z,u,v){w=T5.GeoXY.init(w,T5.Geo.radsPerPixel(t.getZoomLevel()));var D=t.getDimensions();t.updateOffset(w.x-D.width/2,w.y-D.height/2,u,v,z);t.trigger("wake");t.trigger("boundsChange",t.getBoundingBox());z&&typeof u==="undefined"&&z(t)}l=T5.ex({tapExtent:10,provider:null,crosshair:false,zoomLevel:0,boundsChangeThreshold:30},l);var b={NONE:0,SINGLE:1,WATCH:2},g=T5.XY.init(),d=b.NONE,o=false,e=null,
k=0,h=true,p=0;if(!l.provider)l.provider=new T5.Geo.MapProvider;l.adjustScaleFactor=function(w){return Math.pow(2,(w<1?Math.floor:Math.ceil)(Math.log(w)))};var t=T5.ex(new T5.View(l),{getBoundingBox:function(){var w=t.getViewRect();return new T5.Geo.BoundingBox(T5.GeoXY.toPos(T5.XY.init(w.x1,w.y2),p),T5.GeoXY.toPos(T5.XY.init(w.x2,w.y1),p))},getCenterPosition:function(){var w=t.getViewRect();if(w){w=T5.XY.init(w.x1+w.width/2,w.y1+w.height/2);return T5.GeoXY.toPos(w,p)}return null},gotoBounds:function(w,
z){var u=T5.Geo.B.getZoomLevel(w,t.getDimensions());f(T5.Geo.B.getCenter(w),u,z)},gotoPosition:f,panToPosition:a,syncXY:function(w){return T5.GeoXY.sync(w,p)},locate:function(){t.trackStart(b.SINGLE);setTimeout(t.trackCancel,1E4)},trackStart:function(w){if(navigator.geolocation&&!k){d=w?w:b.WATCH;h=true;k=navigator.geolocation.watchPosition(n,m,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3})}},trackCancel:function(){k&&navigator.geolocation&&navigator.geolocation.clearWatch(k);t.removeLayer("location");
e=null;d=b.NONE;k=0},animateRoute:function(w,z,u,v){var D=t.getLayer("route");if(D)(w=D.getAnimation(w,z,u,v))&&w.addToView(t)}});t.bind("pan",function(){d===b.SINGLE&&t.trackCancel()});t.bind("tap",function(){});t.bind("idle",function(){if(T5.XY.absSize(T5.XY.diff(g,t.getOffset()))>l.boundsChangeThreshold){g=T5.XY.copy(t.getOffset());t.trigger("boundsChange",t.getBoundingBox())}});T5.zoomable(t,l);t.bind("zoomLevelChange",function(w,z){p=T5.Geo.radsPerPixel(z);t.triggerAll("resync",t)});COG.configurable(t,
["provider"],COG.paramTweaker(l,null,{provider:function(){t.cleanup();o=false}}),true);return t};
T5.Geo.MapProvider=function(){var l=1,n=20;return{zoomLevel:0,checkZoomLevel:function(m){return Math.min(Math.max(m,l),n)},getCopyright:function(){},getLogoUrl:function(){},getMapTiles:function(){},getZoomRange:function(){return{min:l,max:n}},prepTileGridArgs:function(m,f,a,b,g){var d=null;if(g.tileBackgroundColor){d=T5.Images.newCanvas(a,a);var o=d.getContext("2d");o.fillStyle=g.tileBackgroundColor;o.fillRect(0,0,a,a)}return T5.ex({tileSize:a,width:m,height:f,center:b,tileDrawArgs:{background:d}},
g)},setZoomRange:function(m,f){l=m;n=f}}};T5.MapTileGenerator=function(l){function n(b,g){m=g;a.reset()}l=T5.ex({relative:true},l);var m=0,f=null,a=T5.ex(new T5.TileGenerator(l),{getTileCreatorArgs:function(b){f=b.getCenterPosition();return{zoomLevel:m,position:f}},requireRefresh:function(){return!f}});a.bind("bindView",function(b,g){if(g.getZoomLevel){m=g.getZoomLevel();g.bind("zoomLevelChange",n)}});return a};
T5.Geo.Routing=function(){var l={calculate:function(n){n=T5.ex({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},n);var m=T5.Geo.getEngine("route");m&&m.route(n,function(f){if(n.generalize)f.geometry=T5.Geo.P.generalize(f.geometry,f.getInstructionPositions());if(n.map){l.createMapOverlay(n.map,f);n.autoFit&&n.map.gotoBounds(f.boundingBox)}n.success&&n.success(f)})},createMapOverlay:function(n,m){var f=n.getDimensions();f=new T5.Geo.UI.RouteOverlay({data:m,width:f.width,
height:f.height});n.setLayer("route",f)},parseTurnType:function(n){for(var m=l.TurnType.Unknown,f=T5.Geo.Routing.TurnTypeRules,a=0;a<f.length;a++){f[a].regex.lastIndex=-1;var b=f[a].regex.exec(n);if(b){m=f[a].customCheck?f[a].customCheck(n,b):f[a].turnType;break}}return m},TurnType:{Unknown:"turn-unknown",Start:"turn-none-start",Continue:"turn-none",Arrive:"turn-none-arrive",TurnLeft:"turn-left",TurnLeftSlight:"turn-left-slight",TurnLeftSharp:"turn-left-sharp",TurnRight:"turn-right",TurnRightSlight:"turn-right-slight",
TurnRightSharp:"turn-right-sharp",Merge:"merge",UTurnLeft:"uturn-left",UTurnRight:"uturn-right",EnterRoundabout:"roundabout-enter",Ramp:"ramp",RampExit:"ramp-exit"},Instruction:function(n){var m=n=T5.ex({position:null,description:"",distance:0,distanceTotal:0,time:0,timeTotal:0,turnType:null},n),f=n.description;f=f.replace(/(\w)(\/)(\w)/g,"$1 $2 $3");m.description=f;if(!n.turnType)n.turnType=l.parseTurnType(n.description);return n},RouteData:function(n){n=T5.ex({geometry:[],instructions:[],boundingBox:null},
n);if(!n.boundingBox)n.boundingBox=T5.Geo.B.forPositions(n.geometry);return T5.ex({getInstructionPositions:function(){for(var m=[],f=0;f<n.instructions.length;f++)n.instructions[f].position&&m.push(n.instructions[f].position);return m}},n)}};return l}();T5.Geo.Search=function(){return{bestResults:function(l,n){n||(n=20);for(var m=l.length>0?l[0]:null,f=[],a=0;a<l.length;a++)if(m&&l[a]&&m.matchWeight-l[a].matchWeight<=n)f.push(l[a]);else break;return f}}}();
T5.Geo.UI=function(){var l={AnnotationTween:null,RouteOverlay:function(n){n=T5.ex({data:null,pixelGeneralization:8,partialDraw:false,strokeStyle:"rgba(0, 51, 119, 0.9)",waypointFillStyle:"#FFFFFF",lineWidth:4,zindex:50},n);var m=[],f=[],a=new T5.PathLayer(n);(function(){if(n.data&&n.data.instructions){for(var b=n.data.instructions,g=Array(b.length),d=b.length;d--;)g[d]=b[d].position;T5.Geo.P.vectorize(g).bind("complete",function(o,e){f=e})}n.data&&n.data.geometry&&T5.Geo.P.vectorize(n.data.geometry).bind("complete",
function(o,e){m=e;a.updateCoordinates(m,f,true)})})();return a},Poly:function(n,m){m=T5.ex({autoParse:true},m);for(var f=Array(n.length),a=m.autoParse,b=T5.Geo.P.parse,g=n.length;g--;)f[g]=T5.GeoXY.init(a?b(n[g]):n[g]);return new T5.Poly(f,m)},Annotation:function(n){n=T5.ex({pos:null},n);n.xy=T5.GeoXY.init(n.pos);return new T5.ImageAnnotation(n)},LocationOverlay:function(n){n=T5.ex({pos:null,accuracy:null,zindex:90},n);var m=new Image,f=T5.XY.init(),a=T5.XY.init(),b=null;m.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAACIQAAAiEBPhEQkwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAG+SURBVCiRlZHNahNRAIW/O7mTTJPahLZBA1YUyriINRAE3bQIKm40m8K8gLj0CRQkO32ELHUlKbgoIu4EqeJPgtCaoBuNtjXt5LeTMZk0mbmuWiuuPLsD3+HAOUIpxf9IHjWmaUbEyWv5ROrsVULhcHP761rUfnN3Y2Otc8CIg4YT85lzuVsPP+Qupw1vpPjRCvhS9ymvV0e77x7nNj+uvADQAIQQ+uLyvdfLV9JGZi7EdEwQlqBpEJ019f0z1mo2u5Q8DMydv25lshemmj1FueZTawbs7inarqLbV7Qjab1upB9YlhWSAHLavLHZCvg1VEhN0PMU9W7At4bPVidg7CtkLLXkut+lBPD6/Ub155jJiADAHSpaLmx3ApyBQoYEUd0PBoOBkAC6+3llvda/YxgGgYL+UNHf/zN3KiExGlsvTdP0NYDkhPdWrz35ZDsBzV5wCMuQwEyFmXFeeadjzfuFQmGkAZRKpdGC/n7x+M6jqvA9Zo6FWDhlcHE+wqT93J1tP7vpOE7rrx8ALMuasPf8S12St4WmJ6bYWTUC52k8Hm8Vi0X/nwBAPp/XKpWKdF1X2LYdlMvlsToC/QYTls7DLFr/PAAAAABJRU5ErkJggg%3D%3D";
m.onload=function(){f=T5.XY.init(m.width/2,m.height/2)};var g=T5.ex(new T5.ViewLayer(n),{pos:n.pos,accuracy:n.accuracy,drawAccuracyIndicator:false,draw:function(d,o){var e=a.x-o.x,k=a.y-o.y;if(b){d.fillStyle="rgba(30, 30, 30, 0.2)";d.beginPath();d.arc(e,k,b,0,Math.PI*2,false);d.fill()}m.complete&&m.width>0&&d.drawImage(m,e-f.x,k-f.y,m.width,m.height);g.changed()},update:function(d){if(d){b=Math.floor(d.getPixelDistance(g.accuracy)*0.5);a=d.getGridXYForPosition(g.pos);g.changed()}}});g.bind("gridUpdate",
function(d,o){g.update(o)});return g},AnnotationsOverlay:function(n){function m(d,o){var e=d.length,k=g.getParent();if(o=o?o:k?k.getTileLayer():null)for(e=e;e--;)o.syncVectors([d[e].xy]);d.sort(function(h,p){var t=p.xy.y-h.xy.y;if(t===0)t=p.xy.x-h.xy.x;return t})}n=T5.ex({pois:null,map:null,zindex:100},n);var f=[],a=false,b=[],g=T5.ex(new T5.ViewLayer(n),{cycle:function(){return a},draw:function(d,o,e,k,h){a=false;d.fillStyle="rgba(255, 0, 0, 0.75)";d.globalCompositeOperation="source-over";for(e=
f.length;e--;){f[e].draw(d,o,k,g,h);a=a||f[e].isAnimating()}for(e=b.length;e--;){b[e].draw(d,o,k,g,h);a=a||b[e].isAnimating()}return a?1:0},add:function(d){if(d&&d.length)for(var o=d.length;o--;)b[b.length]=d[o];else if(d)b[b.length]=d;m(b);g.changed()},clear:function(d){b=[];m(b);if(d){f=[];m(f)}g.changed()}});COG.listen("geo.pois-updated",function(d){if(n.pois&&n.pois.id==d.srcID){d=d.pois;try{f=[];for(var o=0;o<d.length;o++)if(d[o].pos){var e;var k=d[o];if(k&&k.pos){var h={poi:k,annotation:null};
n.map&&n.map.trigger("getAnnotationForPOI",h);if(!h.annotation)h.annotation=new T5.Annotation({xy:T5.GeoXY.init(k.pos)});if(h.annotation){h.annotation.isNew=k.isNew;k.isNew=false}e=h.annotation}else e=void 0;e&&f.push(e)}m(f)}catch(p){COG.Log.exception(p)}g.changed()}});g.bind("gridUpdate",function(d,o){m(f,o);m(b,o);g.changed()});return g}};l.ImageAnnotation=l.Annotation;return l}();
T5.Geo.Routing.TurnTypeRules=function(){var l=T5.Geo.Routing.TurnType,n=[];n.push({regex:/continue/i,turnType:l.Continue});n.push({regex:/(take|bear|turn)(.*?)left/i,customCheck:function(m,f){return/bear/i.test(f[1])?l.TurnLeftSlight:l.TurnLeft}});n.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(m,f){return/bear/i.test(f[1])?l.TurnRightSlight:l.TurnRight}});n.push({regex:/enter\s(roundabout|rotaty)/i,turnType:l.EnterRoundabout});n.push({regex:/take.*?ramp/i,turnType:l.Ramp});n.push({regex:/take.*?exit/i,
turnType:l.RampExit});n.push({regex:/make(.*?)u\-turn/i,customCheck:function(m,f){return/right/i.test(f[1])?l.UTurnRight:l.UTurnLeft}});n.push({regex:/proceed/i,turnType:l.Start});n.push({regex:/arrive/i,turnType:l.Arrive});n.push({regex:/fell\sthrough/i,turnType:l.Merge});return n}();
