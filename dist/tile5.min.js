COG=function(){var f=/\$\{(.*?)\}/ig,n=Object.prototype.hasOwnProperty,h=0,d={id:"grunt.core",extend:function(){var a=arguments[0]||{},e=1,m=arguments.length,b=false,o,g,p,k;if(typeof a==="boolean"){b=a;a=arguments[1]||{};e=2}if(typeof a!=="object"&&!d.isFunction(a))a={};if(m===e){a=this;--e}for(;e<m;e++)if((o=arguments[e])!=null)for(g in o){p=a[g];k=o[g];if(a!==k)if(b&&k&&(d.isPlainObject(k)||d.isArray(k))){p=p&&(d.isPlainObject(p)||d.isArray(p))?p:d.isArray(k)?[]:{};a[g]=d.extend(b,p,k)}else if(k!==
undefined)a[g]=k}return a},isFunction:function(a){return toString.call(a)==="[object Function]"},isArray:function(a){return toString.call(a)==="[object Array]"},isPlainObject:function(a){if(!a||toString.call(a)!=="[object Object]"||a.nodeType||a.setInterval)return false;if(a.constructor&&!n.call(a,"constructor")&&!n.call(a.constructor.prototype,"isPrototypeOf"))return false;var e;for(e in a);return e===undefined||n.call(a,e)},isEmptyObject:function(a){for(var e in a)return false;return true},isXmlDocument:function(a){return toString.call(a)===
"[object Document]"},contains:function(a,e){var m=a,b=arguments,o=1;if(e&&d.isArray(e)){b=e;o=0}for(o=o;o<b;o++)m=m&&typeof foo[b[o]]!=="undefined";return m},newModule:function(a){a=d.extend({id:null,requires:[],parent:null},a);if(a.parent)a=d.extend({},a.parent,a);return a},toID:function(a){return a.replace(/\s/g,"-")},objId:function(a){return(a?a:"obj")+h++},formatStr:function(a){if(arguments.length<=1)return a;for(var e=arguments.length-2,m=0;m<=e;m++)a=a.replace(RegExp("\\{"+m+"\\}","gi"),arguments[m+
1]);return a},wordExists:function(a,e){var m="";if(e.toString)e=e.toString();for(var b=0;b<e.length;b++)m+=!/\w/.test(e[b])?"\\"+e[b]:e[b];return RegExp("(^|\\s|\\,)"+m+"(\\,|\\s|$)","i").test(a)},parseTemplate:function(a,e){for(var m=f.exec(a);m;){a=a.replace(m[0],COG.XPath.first(m[1],e));f.lastIndex=0;m=f.exec(a)}return a}};return d}();
COG.Log=function(){function f(e,m){var b,o=m&&m.length>0?m[0]:"";for(b=1;m&&b<m.length;b++)o+=" "+(h&&COG.isPlainObject(m[b])?JSON.stringify(m[b]):m[b]);typeof console!=="undefined"&&console[e](o);for(b=0;b<n.length;b++)n[b].call(a,o,e)}var n=[],h=typeof JSON!=="undefined",d=window.console&&window.console.markTimeline,a={id:"grunt.log",getTraceTicks:function(){return d?(new Date).getTime():null},trace:function(e,m){if(d)console.markTimeline(e+(m?": "+(a.getTraceTicks()-m)+"ms":""))},debug:function(){f("debug",
arguments)},info:function(){f("info",arguments)},warn:function(){f("warn",arguments)},error:function(){f("error",arguments)},exception:function(e){a.error(arguments);for(var m in e)a.info("ERROR DETAIL: "+m+": "+e[m])},watch:function(e,m){try{m()}catch(b){a.exception(b,e)}},throwError:function(e){a.error(e);throw Error(e);},requestUpdates:function(e){n.push(e)}};return a}();
(function(){function f(d,a){d[a]||(d[a]=function(e){return d.configure(a,e)})}function n(d){d.gtConfId=COG.objId("configurable");d.gtConfig={};d.gtConfigFns=[];return d.gtConfig}var h={};COG.paramTweaker=function(d,a,e){return function(m,b){if(typeof b!=="undefined"){if(m in d)d[m]=b;e&&m in e&&e[m](m,b)}else return a&&m in a?a[m](m):d[m]}};COG.configurable=function(d,a,e,m){if(d){d.gtConfId||n(d);var b=d.gtConfId,o=d.gtConfig,g=d.gtConfigFns;h[b]=d;g.push(e);for(e=a.length;e--;){o[a[e]]=true;m&&
f(d,a[e])}if(!d.configure)d.configure=function(p,k){if(o[p]){for(var l=g.length;l--;){var r=g[l](p,k);if(typeof r!=="undefined")return r}return h[b]}return null}}}})();
(function(){function f(n,h){var d=n.gtObsHandlers;d[h]||(d[h]=[]);return d[h]}COG.observable=function(n){if(n){if(!n.gtObsHandlers)n.gtObsHandlers={};if(!(n.bind||n.trigger||n.unbind)){n.bind=function(h,d){var a=COG.objId("callback");f(n,h).unshift({fn:d,id:a});return a};n.trigger=function(h){var d=f(n,h),a={cancel:false,tickCount:(new Date).getTime()},e;if(!d)return null;e=Array.prototype.slice.call(arguments,1);e.unshift(a);for(var m=d.length;m--&&!a.cancel;)d[m].fn.apply(self,e);return a};n.unbind=
function(h,d){for(var a=f(n,h),e=0;a&&e<a.length;e++)if(a[e].id===d){a.splice(e,1);break}return n}}}}})();(function(){var f={},n=[];COG.addPipe=function(h){h("pipe.test",{});n.push(h)};COG.listen=function(h,d){f[h]||(f[h]=[]);d&&f[h].push(d)};COG.say=function(h,d){var a;for(a=n.length;a--;)n[a](h,d);if(f[h])for(a=f[h].length;a--;)f[h][a](d)}})();
COG.Loopage=function(){function f(k){return COG.extend({id:e++,frequency:0,after:0,single:false,lastTick:0,execute:function(){}},k)}function n(k){b.push(k);h()}function h(){o&&clearTimeout(o);o=setTimeout(d,0);p=true}function d(){for(var k,l=(new Date).getTime(),r=m.length;b.length>0;){var x=b.shift();for(k=r;k--;)if(m[k].id===x){m.splice(k,1);break}p=true;r=m.length}if(p){g=a;for(k=r;k--;)g=m[k].frequency<g?m[k].frequency:g}for(k=r;k--;){x=l-m[k].lastTick;if(m[k].lastTick===0||x>=m[k].frequency){m[k].execute(l,
m[k]);m[k].lastTick=l;m[k].single&&m[k].trigger("complete")}}o=r?setTimeout(d,g):0}var a=6E4,e=0,m=[],b=[],o=0,g=a,p=true;return{join:function(k){var l=new f(k);if(l.after>0)l.lastTick=(new Date).getTime()+l.after;COG.observable(l);l.bind("complete",function(){n(l.id)});m.unshift(l);h();return l},leave:n}}();if(!this.JSON)this.JSON={};
(function(){function f(g){return g<10?"0"+g:g}function n(g){a.lastIndex=0;return a.test(g)?'"'+g.replace(a,function(p){var k=b[p];return typeof k==="string"?k:"\\u"+("0000"+p.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+g+'"'}function h(g,p){var k,l,r,x,z=e,u,v=p[g];if(v&&typeof v==="object"&&typeof v.toJSON==="function")v=v.toJSON(g);if(typeof o==="function")v=o.call(p,g,v);switch(typeof v){case "string":return n(v);case "number":return isFinite(v)?String(v):"null";case "boolean":case "null":return String(v);
case "object":if(!v)return"null";e+=m;u=[];if(Object.prototype.toString.apply(v)==="[object Array]"){x=v.length;for(k=0;k<x;k+=1)u[k]=h(k,v)||"null";r=u.length===0?"[]":e?"[\n"+e+u.join(",\n"+e)+"\n"+z+"]":"["+u.join(",")+"]";e=z;return r}if(o&&typeof o==="object"){x=o.length;for(k=0;k<x;k+=1){l=o[k];if(typeof l==="string")if(r=h(l,v))u.push(n(l)+(e?": ":":")+r)}}else for(l in v)if(Object.hasOwnProperty.call(v,l))if(r=h(l,v))u.push(n(l)+(e?": ":":")+r);r=u.length===0?"{}":e?"{\n"+e+u.join(",\n"+e)+
"\n"+z+"}":"{"+u.join(",")+"}";e=z;return r}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
a=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e,m,b={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},o;if(typeof JSON.stringify!=="function")JSON.stringify=function(g,p,k){var l;m=e="";if(typeof k==="number")for(l=0;l<k;l+=1)m+=" ";else if(typeof k==="string")m=k;if((o=p)&&typeof p!=="function"&&(typeof p!=="object"||typeof p.length!=="number"))throw Error("JSON.stringify");return h("",
{"":g})};if(typeof JSON.parse!=="function")JSON.parse=function(g,p){function k(r,x){var z,u,v=r[x];if(v&&typeof v==="object")for(z in v)if(Object.hasOwnProperty.call(v,z)){u=k(v,z);if(u!==undefined)v[z]=u;else delete v[z]}return p.call(r,x,v)}var l;g=String(g);d.lastIndex=0;if(d.test(g))g=g.replace(d,function(r){return"\\u"+("0000"+r.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(g.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){l=eval("("+g+")");return typeof p==="function"?k({"":l},""):l}throw new SyntaxError("JSON.parse");}})();
(function(){function f(h,d){var a=h.split("|"),e={};for(var m in d){var b=d[m];e[m]=a.length>b?a[b]:null}return e}var n={JSON:{parse:function(h){return JSON.parse(h)}},PDON:{parse:function(h){var d=null,a=[];h=h.split("\n");for(var e=0;e<h.length;e++){var m=h[e];if(d)a.push(f(m,d));else if(m){d=m.split("|");m={};for(var b=0;b<d.length;b++)m[d[b]]=b;d=m}else d=null}return a}}};COG.parseData=function(h,d){d=d?d.toUpperCase():"JSON";if(!n[d])throw Error("Unsupported data format: "+d);try{return n[d].parse(h)}catch(a){COG.Log.exception(a)}return{}}})();
COG.XPath=function(){function f(a){for(var e=null,m=0;m<n.length;m++)if(e=n[m](a))break;return e}var n=[],h=[null,function(a){return a.numberValue},function(a){return a.stringValue},function(a){return a.booleanValue},null,null,null,null,function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null},function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||COG.Log.warn("No XPATH support");var d={SearchResult:function(a){return{toString:function(){var e=
null;if(a){var m=null;if(a.resultType>=0&&a.resultType<h.length)m=h[a.resultType];if(m)e=m(a)}return e?e:""}}},first:function(a,e){var m=d.SearchResult,b;var o=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!o)o=XPathResult.ANY_TYPE;try{if(COG.isXmlDocument(e))b=e.evaluate(a,e,f,o,null);else{COG.Log.warn("attempted xpath expression: "+a+" on a non-xml document");b=null}}catch(g){COG.Log.warn("invalid xpath expression: "+a+" on node: "+e);b=null}return new m(b)},registerResolver:function(a){n.push(a)}};return d}();
COG.Storage=function(){function f(n){if(n&&n=="session")return sessionStorage;return localStorage}return{get:function(n,h){var d=f(h).getItem(n);return/^(\{|\[).*(\}|\])$/.test(d)?JSON.parse(d):d},set:function(n,h,d){h=jQuery.isArray(h)||jQuery.isPlainObject(h)?JSON.stringify(h):h;f(d).setItem(n,h)},remove:function(n,h){f(h).removeItem(n)}}}();
COG.ParseRules=function(){var f=[];return{add:function(n,h){f.push({regex:n,handler:h})},each:function(n,h,d){function a(){e++;d&&e>=f.length&&d(h)}for(var e=0,m=0;m<f.length;m++){var b=f[m].regex,o=f[m].handler,g=false;if(b){b.lastIndex=-1;if((b=b.exec(n))&&o){g=true;o(b,h,a)&&a()}}g||a()}}}};
(function(){function f(b){var o=[],g=function(k,l){l=COG.isFunction(l)?l():l;o[o.length]=encodeURIComponent(k)+"="+encodeURIComponent(l)};if(COG.isArray(b))for(var p=0;p<b.length;p++)g(b[p].name,b[p].value);else for(p in b)g(p,b[p]);return o.join("&").replace(/%20/g,"+")}var n={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},h={JSON:["json"],PDON:["pdon.txt"]},d=["TEXT","STREAM"],a=/^(\w+:)?\/\/([^\/?#]+)/,e={XML:function(b){return b.responseXML},JSON:function(b){return COG.parseData(b.responseText)},
PDON:function(b){return COG.parseData(b.responseText,"PDON")},DEFAULT:function(b){return b.responseText}},m={CONTENT_TYPE:"Content-Type"};COG.xhr=function(b){function o(){if(this.readyState===4){var l=null,r=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(r)if(b.handleResponse)b.handleResponse(this);else{var x=b,z=this.getResponseHeader(m.CONTENT_TYPE),u,v=false;for(u in n)if(z&&z.indexOf(n[u])>=0){v=true;
break}z=!v;for(v=0;v<d.length;v++)z=z||d[v]==u;if(z)b:{z=u;for(var C in h)for(v=0;v<h[C].length;v++)if(RegExp(h[C][v]+"$","i").test(x.url)){u=C;break b}u=z?z:"DEFAULT"}try{l=e[u](this,x)}catch(A){l=e.DEFAULT(this,x)}}else b.error&&b.error(this)}catch(P){COG.Log.exception(P,"PROCESSING AJAX RESPONSE")}r&&l&&b.success&&b.success.call(this,l)}}try{b=COG.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},b);var g=
a.exec(b.url),p=g&&(g[1]&&g[1]!==location.protocol||g[2]!==location.host);if(b.data)b.method="POST";if(b.url){g=null;if(b.xhr)g=b.xhr(b);g||(g=new XMLHttpRequest);g.open(b.method,b.url,b.async);b.data&&g.setRequestHeader("Content-Type",b.contentType);p||g.setRequestHeader("X-Requested-With","XMLHttpRequest");g.onreadystatechange=o;g.send(b.method=="POST"?f(b.data):null)}else COG.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(k){COG.Log.exception(k)}}})();
(function(){function f(a){var e=document.createElement("script"),m=false;e.src=a;e.async=true;e.onload=e.onreadystatechange=function(){if(!m&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){m=true;e.onload=e.onreadystatechange=null;e&&e.parentNode&&e.parentNode.removeChild(e)}};h||(h=document.getElementsByTagName("head")[0]);h.appendChild(e)}var n=0,h,d=this;COG.jsonp=function(a,e,m){a+=a.indexOf("?")>=0?"&":"?";var b="json"+ ++n;d[b]=function(o){e(o);d[b]=null;try{delete d[b]}catch(g){}};
f(a+(m?m:"callback")+"="+b);return b}})();
COG.Touch=function(){function f(t,q){return{x:t.x-q.x,y:t.y-q.y}}function n(t,q){var s=f(t,q);return Math.sqrt(s.x*s.x+s.y*s.y)}function h(t){if(t.count>1)return n(t.touches[0],t.touches[1]);return 0}function d(t,q){var s=t&&t.count>0?t.touches[0]:null;if(s&&q&&q.count>0)return f(s,q.touches[0]);return null}function a(t,q){t.count=q.count;for(var s=g;s--;){t.touches[s].x=q.touches[s].x;t.touches[s].y=q.touches[s].y}}function e(){for(var t={count:0,touches:Array(g)},q=g;q--;)t.touches[q]=o();return t}
function m(t){if(t.preventDefault){t.preventDefault();t.stopPropagation()}else t.cancelBubble&&t.cancelBubble()}function b(t,q,s){if(J){q=q[s?s:"touches"];s=q.length;for(s=t.count=s;s--;){t.touches[s].x=q[s].pageX;t.touches[s].y=q[s].pageY}}else if(q.button===0){t.count=1;t.touches[0].x=q.pageX?q.pageX:q.screenX;t.touches[0].y=q.pageY?q.pageY:q.screenY}else t.count=0}function o(t,q){return{x:t?t:0,y:q?q:0}}var g=10,p=120,k=100,l=250,r=300,x=5,z=0,u=1,v=2,C=7,A=0,P=0,J=undefined,$=function(t){function q(F,
L,H,y){var E=Math.asin((F.y-L.y)/H);H=H*(ta/y)>>0;H=H>qa?qa:H;E=L.x>F.x?E:Math.PI-E;G("pan",Math.cos(E)*-H,Math.sin(E)*H,true)}function s(F,L){var H,y;if(J){H=L-ea;if(H<l){y=n(V.touches[0],F);y>t.inertiaTrigger&&q(V.touches[0],F,y,H)}}else{fa.x=F.x;fa.y=F.y;COG.Loopage.join({execute:function(E,M){H=E-L;y=n(F,fa);if(H<k&&y>t.inertiaTrigger){M.trigger("complete");q(F,fa,y,H)}else H>k&&M.trigger("complete")},frequency:10})}}function w(F){var L=0,H=0;if(F.offsetParent){do{L+=F.offsetLeft;H+=F.offsetTop;
F=F.offsetParent}while(F)}return o(L,H)}function D(F){var L=F.count,H=Array(L),y=w(ga);for(L=L;L--;)H[L]=o(F.touches[L].x-y.x,F.touches[L].y-y.y);return H}function G(){ra&&ra.trigger.apply(null,arguments)}function I(F,L){var H=w(ga);H=o(L.x-H.x,L.y-H.y);G(F,L,H)}function N(F){var L=F.target?F.target:F.srcElement;if(ha||L&&L===ga){b(V,F);if(V.count!==0){ba=null;ca.x=0;ca.y=0;la=true;S=false;ea=(new Date).getTime();m(F);L.style.cursor="move";G("inertiaCancel");na=ea;if(F=V.count>0?V.touches[0]:null){G("touchStart",
F.x,F.y);if(na-oa<r)if((F=f(V.touches[0],Y.touches[0]))&&Math.abs(F.x)<t.maxDistDoubleTap&&Math.abs(F.y)<t.maxDistDoubleTap)S=true;O=z;a(Y,V)}else COG.Log.warn("Touch start fired, but no touch vector found")}}}function B(F){var L=F.target?F.target:F.srcElement,H=0;if(ha||L&&L===ga){b(W,F);if(W.count>0){fa.x=W.touches[0].x;fa.y=W.touches[0].y}if(la){J&&m(F);if(W.count>1){V.count===1&&a(V,W);H=h(V)-h(W)}if(O===z)if((F=d(W,V))&&(Math.abs(F.x)>=C||Math.abs(F.y)>=C))O=u;if(O!==z)if(!H||Math.abs(H)<x){if(ba=
d(W,Y)){ca.x-=ba.x;ca.y-=ba.y;aa.x-=ba.x;aa.y-=ba.y}G("pan",aa.x,aa.y);aa.x=0;aa.y=0;O=u}else{G("pinchZoom",D(V),D(W));O=v}a(Y,W)}}}function T(F){var L=F.target?F.target:F.srcElement;if(la&&(ha||L&&L===ga)){b(ka,F,"changedTouches");var H=ka.touches[0];J&&m(F);F=(new Date).getTime();oa=na;if(O===z){I("tap",V.touches[0]);Q||(Q=setTimeout(function(){Q=0;S&&I("doubleTap",V.touches[0])},r+50))}else if(O==u){G("panEnd",ca.x,ca.y);sa&&s(H,F)}else O==v&&G("pinchZoomEnd",D(V),D(Y),F-ea);L.style.cursor="default";
la=false}}function K(F){var L=F.target?F.target:F.srcElement;if(ha||L&&L===ga){if(F.detail){L=-F.detail*p;L=o(F.axis===1?L:0,F.axis===2?L:0)}else L=o(F.wheelDeltaX,F.wheelDeltaY);var H=L.y!==0?Math.abs(L.y/p):0;if(fa&&H!==0){var y=o(fa.x-ga.offsetLeft,fa.y-ga.offsetTop);G("wheelZoom",y,Math.pow(2,L.y>0?H:-H))}m(F)}}t=COG.extend({element:null,observable:null,inertiaTrigger:20,maxDistDoubleTap:20,touchStartHandler:null,moveHandler:null,moveEndHandler:null,pinchZoomHandler:null,pinchZoomEndHandler:null,
tapHandler:null,doubleTapHandler:null,wheelZoomHandler:null},t);var S=false,Q=0,R=T5.getConfig(),V=e(),W=e(),Y=e(),ka=e(),ba=null,ca=o(),aa=o(),O=null,la=false,ea=0,da=[],fa=o(),sa=false,ta,qa,na=0,oa=0,ga=t.element,ra=t.observable,ha=typeof FlashCanvas!=="undefined",ua={supportsTouch:J,addListeners:function(F){da.push(F)},decoupleListeners:function(F){for(var L=0;F&&L<da.length;L++)if(da[L].listenerId===F){da.splice(L,1);break}},release:function(){R.unbindEvent(J?"touchstart":"mousedown",N,false);
R.unbindEvent(J?"touchmove":"mousemove",B,false);R.unbindEvent(J?"touchend":"mouseup",T,false);if(!J){window.removeEventListener("mousewheel",K,false);window.removeEventListener("DOMMouseScroll",K,false)}},inertiaEnable:function(F,L){sa=true;ta=F;qa=L?Math.min(L.width,L.height):500},inertiaDisable:function(){sa=false}};if(typeof J==="undefined")J=T5.getConfig().supportsTouch;R.bindEvent(J?"touchstart":"mousedown",N,false);R.bindEvent(J?"touchmove":"mousemove",B,false);R.bindEvent(J?"touchend":"mouseup",
T,false);if(!J){R.bindEvent("mousewheel",K,window);R.bindEvent("DOMMouseScroll",K,window)}return ua},U=[];return{capture:function(t,q){if(!t)throw Error("Unable to capture touch of null element");if(!t.id)t.id="touchable_"+A++;var s=U[t.id];if(!s){s=new $(COG.extend({element:t},q));U[t.id]=s}if(q){q.listenerId&&s.decoupleListeners(q.listenerId);q.listenerId=++P;s.addListeners(q)}return s},release:function(t){if(t&&t.id&&U[t.id]){U[t.id].release();delete U[t.id]}}}}();
T5=function(){var f=function(){function a(b,o){return m(b.x-o.x,b.y-o.y)}function e(b,o){if(!o)o=b.length;if(o<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var g={edges:Array(o-1),accrued:Array(o-1),total:0},p=0;p<o-1;p++){var k=a(b[p],b[p+1]);g.edges[p]=Math.sqrt(k.x*k.x+k.y*k.y);g.accrued[p]=g.total+g.edges[p];g.total+=g.edges[p]}return g}function m(b,o){return{x:b?b:0,y:o?o:0}}return{VECTOR_SIMPLIFICATION:3,SIMPLIFICATION_MIN_VECTORS:25,add:function(){for(var b=
0,o=0,g=arguments.length;g--;){b+=arguments[g].x;o+=arguments[g].y}return m(b,o)},absSize:function(b){return Math.max(Math.abs(b.x),Math.abs(b.y))},copy:function(b){return b?m(b.x,b.y):null},diff:a,distance:function(b,o){return e(b,o).total},edges:e,equals:function(b,o){return b.x===o.x&&b.y===o.y},extendBy:function(b,o,g){return m(b.x-Math.cos(o)*g,b.y-Math.sin(o)*g)},floor:function(b){for(var o=Array(b.length),g=b.length;g--;)o[g]=m(~~b[g].x,~~b[g].y);return o},getRect:function(b){for(var o,g,p,
k,l=b.length;l--;){var r=b[l];o=typeof o==="undefined"||r.x<o?r.x:o;g=typeof g==="undefined"||r.y<g?r.y:g;p=typeof p==="undefined"||r.x>p?r.x:p;k=typeof k==="undefined"||r.y>k?r.y:k}return h.init(o,g,k,k)},init:m,invert:function(b){return m(-b.x,-b.y)},offset:function(b,o,g){return m(b.x+o,b.y+(g?g:o))},simplify:function(b,o){if(!b)return null;o=o?o:f.VECTOR_SIMPLIFICATION;for(var g=[],p=null,k=b.length;k--;){var l=b[k];if(include=!p||k===0||Math.abs(l.x-p.x)+Math.abs(l.y-p.y)>o){g.unshift(l);p=l}}return g},
theta:function(b,o,g){g=Math.asin((b.y-o.y)/g);return b.x>o.x?g:Math.PI-g}}}(),n=function(){return{dotProduct:function(a,e){return a.x*e.x+a.y*e.y}}}(),h=function(){return{center:function(a){return f.init(a.x1+a.width/2,a.y1+a.height/2)},diagonalSize:function(a){return Math.sqrt(a.width*a.width+a.height*a.height)},init:function(a,e,m,b){a=a?a:0;e=e?e:0;m=m?m:a;b=b?b:b;return{x1:a,y1:e,x2:m,y2:b,width:m-a,height:b-e}}}}(),d=function(){return{getAspectRatio:function(a){return a.height!==0?a.width/a.height:
1},getCenter:function(a){return f.init(a.width/2,a.height/2)},getSize:function(a){return Math.sqrt(Math.pow(a.width,2)+Math.pow(a.height,2))},init:function(a,e){a=a?a:0;return{width:a,height:e?e:a}}}}();return{ex:COG.extend,ticks:function(){return(new Date).getTime()},XY:f,XYRect:h,Vector:function(a,e){COG.Log.warn("The T5.Vector class has been deprecated, please use T5.XY.init instead");return f.init(a,e)},V:COG.extend(f,n),D:d}}();
(function(){function f(){for(;x.length>0;){var u=x.shift();document.location=u}r=0}function n(u){for(var v=true,C=z.length;C--;)v=v&&u!=z[C];return v}function h(u,v){var C=[];for(var A in v)A&&C.push(A+"="+escape(v[A]));return"tile5://"+u+"/"+(C.length>0?"?"+C.join("&"):"")}function d(u,v){n(u)&&COG.Log.info("would push url: "+h(u,v))}function a(u,v){if(n(u)){x.push(h(u,v));r||(r=setTimeout(f,100))}}function e(u){return function(v,C,A){(A?A:u?document.body:document).addEventListener(v,C,false)}}function m(u){return function(v,
C,A){(A?A:u?document.body:document).removeEventListener(v,C,false)}}function b(u,v,C){(C?C:document).attachEvent("on"+u,v)}function o(u,v,C){(C?C:document).detachEvent("on"+u,v)}function g(){p={base:{name:"Unknown",bindEvent:e(),unbindEvent:m(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:d,targetFps:null},ie:{name:"MSIE",regex:/msie/i,bindEvent:b,unbindEvent:o,requireFastDraw:false,targetFps:25},
ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:a,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:a},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:a},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:e(true),unbindEvent:m(true),supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},bridgeNotify:a},froyo:{name:"Android OS >= 2.2",
regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:a}};k=[p.froyo,p.android,p.ipod,p.iphone,p.ipad,p.ie]}var p=null,k=[],l=null,r=0,x=[],z=["view.wake","tile.loaded"];T5.getConfig=function(){p||g();if(!l){COG.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var u=0;u<k.length;u++){var v=k[u];if(v.regex&&v.regex.test(navigator.userAgent)){l=T5.ex({},p.base,v);COG.Log.info("PLATFORM DETECTED AS: "+l.name);break}}if(!l){COG.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
l=p.base}COG.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return l}})();
T5.Dispatcher=function(){var f=[],n={execute:function(h){var d=n.findAction(h);d&&d.execute.apply(d,Array.prototype.slice.call(arguments,1))},findAction:function(h){for(var d=f.length;d--;)if(f[d].id==h)return f[d];return null},getRegisteredActions:function(){return[].concat(f)},getRegisteredActionIds:function(){for(var h=[],d=f.length;d--;)f[d].id&&h.push(f[d].id);return h},registerAction:function(h){h&&h.id&&f.push(h)},Action:function(h){h=T5.ex({autoRegister:true,id:"",title:"",icon:"",hidden:false,
execute:null},h);var d={id:h.id,execute:function(){h.execute&&h.execute.apply(this,arguments)},getParam:function(a){return h[a]?h[a]:""},toString:function(){return COG.formatStr("{0} [title = {1}, icon = {2}]",d.id,h.title,h.icon)}};h.autoRegister&&n.registerAction(d);return d},Agent:function(h){h=COG.extend({name:"Untitled",translator:null,execute:null},h);var d={getName:function(){return h.name},getParam:function(a){return h[a]},getId:function(){return COG.toID(d.getName())},run:function(a,e){if(h.execute){var m=
h.translator?h.translator(a):a;h.execute.call(d,m,function(b,o){e&&e(b,o,m)})}}};return d},runAgents:function(h,d,a){for(var e=0;e<h.length;e++)h[e].run(d,a)}};return n}();
T5.Resources=function(){var f="",n={},h={getPath:function(d){return/^(file|https?|\/)/.test(d)?d:f+d},setBasePath:function(d){f=d},loadResource:function(d){d=T5.ex({filename:"",cacheable:true,dataType:null,callback:null},d);var a=function(e){d.callback&&COG.Log.watch("CALLING RESOURCE CALLBACK",function(){d.callback(e)})};d.cacheable&&n[d.filename]?a(n[d.filename]):COG.xhr({url:h.getPath(d.filename),dataType:d.dataType,success:function(e){if(d.cacheable)n[d.filename]=e;a(e)},error:function(e,m,b){COG.Log.error("error loading resource ["+
d.filename+"], error = "+b)}})},loadSnippet:function(d,a){/\.\w+$/.test(d)||(d+=".html");h.loadResource({filename:"snippets/"+d,callback:a,dataType:"html"})}};return h}();
T5.Images=function(){function f(){if(!r){var u=T5.getConfig().maxImageLoads;r=COG.Loopage.join({execute:function(v,C){if(!u||p.length<u){var A=g.shift();if(A){p[p.length]=A;A.image.onload=h;A.image.src=T5.Resources.getPath(A.url);A.requested=T5.ticks()}else C.trigger("complete")}},frequency:10});r.bind("complete",function(){r=null})}}function n(){x=true;try{var u=k.length/2>>0;if(u>0){k.sort(function(C,A){return C.created-A.created});for(var v=u;v--;)delete e[k[v].url];k.splice(0,u)}}finally{x=false}COG.say("imagecache.cleared")}
function h(){var u=b[this.id],v;if(u&&u.image.complete&&u.image.width>0){u.loaded=true;u.hitCount=1;for(v=p.length;v--;)if(p[v].image.src==this.src){p.splice(v,1);break}if(u.background||u.postProcess||u.drawBackground||u.customDraw)if(u.image){v=a(u.realSize?u.realSize.width:image.width,u.realSize?u.realSize.height:image.height);var C=v.getContext("2d"),A=u.offset?u.offset:T5.XY.init();u.background&&C.drawImage(u.background,0,0);u.drawBackground&&u.drawBackground(C);u.customDraw?u.customDraw(C,u):
C.drawImage(u.image,A.x,A.y);u.postProcess&&u.postProcess(C,u);u.image=v}for(v=u.callbacks.length;v--;)u.callbacks[v]&&u.callbacks[v](this,false);u.callbacks=[];k[k.length]={url:this.src,created:u.requested};delete b[this.id];f()}}function d(u,v,C){var A=e[u];if(A){A.hitCount++;A.image.complete&&A.image.width>0&&v?v(A.image,true):A.callbacks.push(v)}else{A=T5.ex({url:u,image:new Image,loaded:false,created:T5.ticks(),requested:null,hitCount:0,callbacks:[v]},C);A.image.id="resourceLoaderImage"+o++;
e[u]=A;b[A.image.id]=A;g[g.length]=A;f()}return A}function a(u,v){var C=document.createElement("canvas");C.width=u?u:0;C.height=v?v:0;if(typeof FlashCanvas!=="undefined"){C.id="tmpCanvas"+m++;C.style.cssText="position: absolute; top: -"+(v-1)+"px; left: -"+(u-1)+"px;";document.body.appendChild(C);FlashCanvas.initElement(C)}typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(C);return C}var e={},m=0,b={},o=0,g=[],p=[],k=[],l=0,r=null,x=false,z={avgImageSize:25,loadTimeout:10,cancelLoad:function(){p=
[]},get:function(u,v,C){var A=null,P=null;x||(A=e[u]);if((P=A?A.image:null)&&(P.getContext||P.complete&&P.width>0))return P;else v&&d(u,v,C);return null},load:d,newCanvas:a,reset:function(){e={}},stats:function(){return{imageLoadingCount:p.length,queuedImageCount:g.length,imageCacheFullness:l}}};COG.Loopage.join({execute:function(u){for(var v=false,C=0,A=T5.getConfig();C<p.length;)if(u-p[C].requested>z.loadTimeout*1E3){p.splice(C,1);v=true}else C++;v&&f();if(A&&A.imageCacheMaxSize){l=k.length*z.avgImageSize/
A.imageCacheMaxSize;l>=1&&n()}},frequency:2E4});return z}();
T5.TimeLord=function(){var f=/^P(\d+Y)?(\d+M)?(\d+D)?$/,n=/^(\d+H)?(\d+M)?(\d+S)?$/,h=function(a,e){return{days:a?a:0,seconds:e?e:0}},d={8601:function(a){a=a.split("T");var e=null;e=null;var m=0,b=0;f.lastIndex=-1;e=f.exec(a[0]);m+=e[3]?parseInt(e[3].slice(0,-1),10):0;n.lastIndex=-1;e=n.exec(a[1]);b+=e[1]?parseInt(e[1].slice(0,-1),10)*3600:0;b+=e[2]?parseInt(e[2].slice(0,-1),10)*60:0;b+=e[3]?parseInt(e[3].slice(0,-1),10):0;return new h(m,b)}};return{Duration:h,addDuration:function(){for(var a=new h,
e=arguments.length;e--;){a.days+=arguments[e].days;a.seconds+=arguments[e].seconds}if(a.seconds>=86400){a.days+=~~(a.seconds/86400);a.seconds%=86400}return a},parseDuration:function(a,e){var m=e?d[e]:null;if(m)return m(a);COG.Log.warn("Could not find duration parser for specified format: "+e);return new h},formatDuration:function(a){var e,m,b="";if(a.days)b=a.days+" days ";if(a.seconds){a=a.seconds;if(a>=3600){e=~~(a/3600);a-=e*3600}if(a>=60){m=Math.round(a/60);a-=m*60}if(e)b=b+e+(e>1?" hrs ":" hr ")+
(m?(m>10?m:"0"+m)+" min ":"");else if(m)b=b+m+" min";else if(a>0)b=b+(a>10?a:"0"+a)+" sec"}return b}}}();
(function(){var f=Math.PI*2,n=Math.PI/2,h=Math.abs,d=Math.pow,a=Math.sin,e=Math.asin,m=Math.cos,b=1.70158,o={linear:function(g,p,k,l){return k*g/l+p},backin:function(g,p,k,l){return k*(g/=l)*g*((b+1)*g-b)+p},backout:function(g,p,k,l){return k*((g=g/l-1)*g*((b+1)*g+b)+1)+p},backinout:function(g,p,k,l){return(g/=l/2)<1?k/2*g*g*(((b*=1.525)+1)*g-b)+p:k/2*((g-=2)*g*(((b*=1.525)+1)*g+b)+2)+p},bouncein:function(g,p,k,l){return k-o.bounceout(l-g,0,k,l)+p},bounceout:function(g,p,k,l){return(g/=l)<1/2.75?
k*7.5625*g*g+p:g<2/2.75?k*(7.5625*(g-=1.5/2.75)*g+0.75)+p:g<2.5/2.75?k*(7.5625*(g-=2.25/2.75)*g+0.9375)+p:k*(7.5625*(g-=2.625/2.75)*g+0.984375)+p},bounceinout:function(g,p,k,l){return g<l/2?o.bouncein(g*2,0,k,l)/2+p:o.bounceout(g*2-l,0,k,l)/2+k/2+p},cubicin:function(g,p,k,l){return k*(g/=l)*g*g+p},cubicout:function(g,p,k,l){return k*((g=g/l-1)*g*g+1)+p},cubicinout:function(g,p,k,l){if((g/=l/2)<1)return k/2*g*g*g+p;return k/2*((g-=2)*g*g+2)+p},elasticin:function(g,p,k,l,r,x){if(g==0)return p;if((g/=
l)==1)return p+k;x||(x=l*0.3);if(!r||r<h(k)){r=k;k=x/4}else k=x/f*e(k/r);return-(r*d(2,10*(g-=1))*a((g*l-k)*f/x))+p},elasticout:function(g,p,k,l,r,x){var z;if(g==0)return p;if((g/=l)==1)return p+k;x||(x=l*0.3);if(!r||r<h(k)){r=k;z=x/4}else z=x/f*e(k/r);return r*d(2,-10*g)*a((g*l-z)*f/x)+k+p},elasticinout:function(g,p,k,l,r,x){var z;if(g==0)return p;if((g/=l/2)==2)return p+k;x||(x=l*0.3*1.5);if(!r||r<h(k)){r=k;z=x/4}else z=x/f*e(k/r);if(g<1)return-0.5*r*d(2,10*(g-=1))*a((g*l-z)*f/x)+p;return r*d(2,
-10*(g-=1))*a((g*l-z)*f/x)*0.5+k+p},quadin:function(g,p,k,l){return k*(g/=l)*g+p},quadout:function(g,p,k,l){return-k*(g/=l)*(g-2)+p},quadinout:function(g,p,k,l){if((g/=l/2)<1)return k/2*g*g+p;return-k/2*(--g*(g-2)-1)+p},sinein:function(g,p,k,l){return-k*m(g/l*n)+k+p},sineout:function(g,p,k,l){return k*a(g/l*n)+p},sineinout:function(g,p,k,l){return-k/2*(m(Math.PI*g/l)-1)+p}};T5.easing=function(g){return o[g.replace(/[\-\_\s\.]/g,"").toLowerCase()]};T5.registerEasingType=function(g,p){o[g.replace(/[\-\_\s\.]/g,
"").toLowerCase()]=p}})();
T5.Tween=function(f){f=T5.ex({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:T5.easing("sine.out"),complete:null,cancelOnInteract:false},f);var n=T5.ticks(),h=[],d=false,a=0,e=0,m={cancelOnInteract:f.cancelOnInteract,isComplete:function(){return d},triggerComplete:function(b){f.complete&&f.complete(b)},update:function(b){try{var o=f.tweenFn(b-n,a,e,f.duration);if(f.target)f.target[f.property]=o;for(var g=h.length;g--;)h[g](o,void 0);if(d=n+f.duration<=b){if(f.target)f.target[f.property]=
f.tweenFn(f.duration,a,e,f.duration);for(var p=h.length;p--;)h[p](o,true)}}catch(k){COG.Log.exception(k)}},requestUpdates:function(b){h.push(b)}};a=f.target&&f.property&&f.target[f.property]?f.target[f.property]:f.startValue;if(typeof f.endValue!=="undefined")e=f.endValue-a;if(e==0)d=true;T5.wakeTweens();return m};
(function(){function f(a){if(d)return n.length;d=true;try{for(var e=0;e<n.length;)if(n[e].isComplete()){n[e].triggerComplete(false);n.splice(e,1)}else{n[e].update(a);e++}}finally{d=false}n.length===0&&h.trigger("complete");return n.length}var n=[],h=null,d=false;T5.tweenValue=function(a,e,m,b,o){a=new T5.Tween({startValue:a,endValue:e,tweenFn:m,complete:b,duration:o});n.push(a);return a};T5.tween=function(a,e,m,b,o,g){a=new T5.Tween({target:a,property:e,endValue:m,tweenFn:b,duration:g,complete:o});
n.push(a);return a};T5.tweenVector=function(a,e,m,b,o,g){var p=[];if(a){var k=a.x==e,l=a.y==m;k||p.push(T5.tween(a,"x",e,b,function(){(k=true)&&l&&o()},g));l||p.push(T5.tween(a,"y",m,b,function(){l=true;k&&l&&o()},g))}return p};T5.cancelAnimation=function(a){if(!d){d=true;try{for(var e=0;e<n.length;)if(!a||a(n[e])){n[e].triggerComplete(true);n.splice(e,1)}else e++}finally{d=false}}};T5.isTweening=function(){return n.length>0};T5.wakeTweens=function(){if(!h){h=COG.Loopage.join({execute:f,frequency:20});
h.bind("complete",function(){h=null})}}})();(function(){var f={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,PINCH:16,FREEZE:128};T5.viewState=function(){for(var n=0,h=arguments.length;h--;){var d=f[arguments[h].toUpperCase()];if(d)n|=d}return n}})();
T5.ViewLayer=function(f){f=T5.ex({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:T5.viewState("ACTIVE","ANIMATING","PAN","PINCH")},f);var n=null,h=false,d=false,a=f.supportFastDraw,e=f.id,m=T5.viewState("ACTIVE"),b=f.validStates,o=0,g=0,p=T5.ex({addToView:function(k){k.setLayer(e,p)},shouldDraw:function(k,l,r){k=(k&b)!==0&&(h?a:true);return k=d||r||o!==l.x||g!==l.y},cycle:function(){},draw:function(){},remove:function(){p.trigger("remove",p)},changed:function(){d=true;p.trigger("changed",
p);n&&n.trigger("invalidate")},getId:function(){return e},setId:function(k){e=k},getParent:function(){return n},setParent:function(k){h=(n=k)?n.fastDraw&&displayState!==m:false;p.trigger("parentChange",n)}},f);COG.observable(p);p.bind("drawComplete",function(k,l){d=false;o=l.x;g=l.y});return p};
T5.View=function(f){function n(y,E,M,X){ha=oa;C();if(X&&f.inertia){K=true;g(U+E,t+M,f.panAnimationEasing,f.panAnimationDuration)}else X||g(U+E,t+M)}function h(){ha=na;K=false;COG.Loopage.join({execute:C,after:50,single:true})}function d(y,E){Y=ua(y);ka=ua(E);var M=F(Y),X=F(ka);fa=L(Y);B=L(ka);O=Y&&M!==0?X/M:1}function a(y,E,M){d(E,M);if(W=O!==1){ha=ga;C()}}function e(y,E,M,X){d(E,M);if(f.adjustScaleFactor){O=f.adjustScaleFactor(O);COG.Log.info("scale factor adjusted to: "+O)}if(X<f.pinchZoomAnimateTrigger){l(ea,
O,fa,r(),T5.easing("sine.out"),function(){b();O=1},300);O=ea}else{b();O=1}}function m(y,E,M){H.zoom(E,Math.min(Math.pow(2,Math.round(Math.log(M))),8),500)}function b(){var y=Y?r():B;O=Math.round(O*10)/10;W=false;for(var E=A.length;E--;)A[E].trigger("scale",O,y);H.trigger("scale",O,y);ha=na;C()}function o(){clearTimeout(aa);aa=setTimeout(p,50)}function g(y,E,M,X,Z){function ia(){ja+=1;if(ja>=2){h(0,0);Z&&Z()}}var ja=0;if(M){y=T5.tweenValue(U,y,M,ia,X);E=T5.tweenValue(t,E,M,ia,X);y.cancelOnInteract=
true;y.requestUpdates(function(ma){U=ma;K=true;C()});E.cancelOnInteract=true;E.requestUpdates(function(ma){t=ma;K=true;C()})}else{U=y;t=E}}function p(){var y;if(J){COG.Touch.release(J);if(f.autoSize&&J.parentNode){y=J.parentNode.getBoundingClientRect();if(y.height!==0&&y.width!==0){J.height=y.height;J.width=y.width}}try{if(!J.id)J.id=f.id+"_canvas";$=J.getContext("2d");$.clearRect(0,0,J.width,J.height)}catch(E){COG.Log.exception(E);throw Error("Could not initialise canvas on specified view element");
}qa=COG.Touch.capture(J,{observable:H});if(I.height!==J.height||I.width!==J.width){I=T5.D.init(J.width,J.height);H.trigger("resize",J.width,J.height);for(y=P;y--;)A[y].trigger("resize",J.width,J.height)}f.inertia&&qa.inertiaEnable(f.panAnimationDuration,I);for(y=P;y--;)A[y].trigger("contextChanged",$);v()}}function k(y,E){E.setId(y);E.added=T5.ticks();E.bind("remove",function(){H.removeLayer(y)});E.trigger("contextChanged",$);E.setParent(H);A.push(E);A.sort(function(M,X){var Z=X.zindex-M.zindex;if(Z===
0)Z=X.added-M.added;return Z});P=A.length;return E}function l(y,E,M,X,Z,ia,ja){function ma(){ia&&ia();b();O=1;da=null}W=true;fa=T5.XY.copy(M);B=T5.XY.copy(X);Y=null;if(Z)T5.tweenValue(0,E-y,Z,ma,ja?ja:1E3).requestUpdates(function(pa){da=pa/(E-y);O=y+pa;ha=ga;C();H.trigger("animate")});else{O=targetScaleFactor;ma()}}function r(){var y=T5.D.getCenter(I),E=T5.XY.distance([B,y]);y=T5.XY.theta(B,y,E);var M=T5.XY.diff(fa,B);y=T5.XY.extendBy(B,y,E/O);y.x+=M.x;y.y+=M.y;return y}function x(){H.trigger("idle");
T=true;S=0}function z(y,E,M,X,Z){if(D)E=T5.viewState("FROZEN");var ia=(E&ga)!==0,ja=0;if(s||ia){y.clearRect(0,0,J.width,J.height);s=false}if(ia){T5.D.getCenter(I);var ma=(da?da:1)/2,pa=T5.XY.diff(fa,B);if(Y){R.x=B.x+pa.x;R.y=B.y+pa.y}else{R.x=B.x-pa.x*ma;R.y=B.y-pa.y*ma}M=T5.XY.offset(M,R.x,R.y)}y.save();try{ea=O;if(G!==1)y.scale(G,G);else if(ia){y.translate(B.x,B.y);y.scale(O,O)}for(ja=P;ja--;)if(A[ja].shouldDraw(E,M,X)){A[ja].draw(y,M,I,E,H,X,Z);A[ja].trigger("drawComplete",M,Z)}}finally{y.restore()}H.trigger("drawComplete",
M,Z);COG.Log.trace("draw complete",Z)}function u(y,E){var M=false,X=ba?ba:K?oa:ha,Z=!K&&(X===ga||X===oa),ia=ca||X===oa||X===ga||T5.isTweening();q.x=U>>0;q.y=t>>0;if(Z){T5.cancelAnimation(function(ja){return ja.cancelOnInteract});T=false;if(S!==0){clearTimeout(S);S=0}}for(Z=P;Z--;){if(A[Z].animated)ha|=ra;M=A[Z].cycle(y,q,ha,ia)||M}ia=ia||(ha&ra)!==0;if(M=M||ia||O!==1&&O!==la){z($,X,q,ia,y);la=O;ca=false}if(!M&&N===0&&!sa){if(!T&&S===0)S=setTimeout(x,500);E.trigger("complete")}N=0;COG.Log.trace("Completed draw cycle",
y)}function v(){ca=true;C()}function C(){N+=1;if(!(D||w)){w=COG.Loopage.join({execute:u,frequency:ta});w.bind("complete",function(){w=null})}}f=T5.ex({id:COG.objId("view"),container:"",fastDraw:false,inertia:true,pannable:true,scalable:true,panAnimationEasing:T5.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:true,tapExtent:10,fps:25},f);var A=[],P=0,J=document.getElementById(f.container),$=null,U=0,t=0,q=T5.XY.init(),s=false,w=null,D=false,
G=1,I=T5.D.init(),N=0,B=null,T=false,K=false,S=0,Q=0,R=T5.XY.init(),V=0,W=false,Y=null,ka=null,ba=null,ca=false,aa=0,O=1,la=0,ea=1,da=null,fa=null,sa=typeof FlashCanvas!=="undefined",ta=~~(1E3/f.fps),qa=null,na=T5.viewState("ACTIVE"),oa=T5.viewState("PAN"),ga=T5.viewState("PINCH"),ra=T5.viewState("ANIMATING"),ha=na,ua=T5.XY.getRect,F=T5.XYRect.diagonalSize,L=T5.XYRect.center,H={id:f.id,deviceScaling:G,fastDraw:f.fastDraw||T5.getConfig().requireFastDraw,animate:function(y,E,M,X,Z){l(O,y,E,M,X,Z)},
centerOn:function(y){U=y.x-J.width/2;t=y.y-J.height/2},getDimensions:function(){return I},getZoomCenter:function(){return R},getLayer:function(y){for(var E=0;E<P;E++)if(A[E].getId()==y)return A[E];return null},setLayer:function(y,E){for(var M=0;M<P;M++)if(A[M].getId()===y){A.splice(M,1);break}E&&k(y,E);v()},eachLayer:function(y){for(var E=P;E--;)y(A[E])},clearBackground:function(){COG.Log.info("CALL OF DEPRECATED METHOD CLEAR BACKGROUND");s=true;v()},invalidate:v,freeze:function(){D=true},unfreeze:function(){D=
false;C()},resize:function(y,E){if(J){f.autoSize=false;J.width=y;J.height=E;p();H.trigger("resize",J.width,J.height)}},scale:function(y,E,M,X,Z){X||(X=T5.D.getCenter(I));Z||(Z=T5.D.getCenter(I));H.animate(y,X,Z,E,M);return H},removeLayer:function(y){a:{for(var E=P;E--;)if(A[E].getId()==y){y=E;break a}y=-1}if(y>=0&&y<P){COG.say("layer.removed",{layer:A[y]});A.splice(y,1);v()}P=A.length},stateOverride:function(y){ba=y},getOffset:function(){return q},updateOffset:g,zoom:function(y,E,M){K=false;O=E;W=
O!==1;fa=T5.D.getCenter(I);B=O>1?T5.XY.copy(y):T5.D.getCenter(I);Y=null;clearTimeout(Q);if(W){ha=ga;C();if(M)Q=setTimeout(function(){b();O=1},parseInt(M,10))}}};G=T5.getConfig().getScaling();H.markers=k("markers",new T5.MarkerLayer);COG.observable(H);H.bind("wake",C);H.bind("invalidate",v);if(f.pannable){H.bind("pan",n);H.bind("panEnd",h);H.bind("inertiaCancel",function(){K=false;C()})}if(f.scalable){H.bind("pinchZoom",a);H.bind("pinchZoomEnd",e);H.bind("wheelZoom",m)}H.bind("tap",function(y,E,M){for(var X=
T5.XY.offset(M,U,t),Z=A.length;Z--;)y.cancel=y.cancel||A[Z].trigger("tap",E,M,X).cancel});COG.configurable(H,["inertia","container","rotation","tapExtent","scalable","pannable"],COG.paramTweaker(f,null,{container:function(y,E){J=document.getElementById(E);p()},rotation:function(y,E){V=E}}),true);p();f.autoSize&&window.addEventListener("resize",o,false);return H};
T5.PathLayer=function(f){function n(p){p.syncVectors(e);m&&p.syncVectors(m);g.trigger("tidy")}f=T5.ex({style:"waypoints",pixelGeneralization:8,zindex:50},f);var h=false,d=[],a=null,e=[],m=null,b=0,o=[],g=T5.ex(new T5.ViewLayer(f),{getAnimation:function(p,k,l,r){var x="pathAnimation"+b++;o.push(x);return new T5.AnimatedPathLayer({id:x,path:d,zindex:f.zindex+1,easing:p?p:T5.easing("sine.inout"),duration:k?k:5E3,drawIndicator:l,autoCenter:r?r:false})},cycle:function(p,k,l,r){return r},draw:function(p,
k){var l,r=d.length;p.save();try{T5.applyStyle(p,f.style);if(r>0){p.beginPath();p.moveTo(d[r-1].x-k.x,d[r-1].y-k.y);for(l=r;l--;)p.lineTo(d[l].x-k.x,d[l].y-k.y);p.stroke();if(a){p.fillStyle=f.waypointFillStyle;for(l=a.length;l--;){p.beginPath();p.arc(a[l].x-k.x,a[l].y-k.y,2,0,Math.PI*2,false);p.stroke();p.fill()}}}}finally{p.restore()}h=false},updateCoordinates:function(p,k){var l=g.getParent();l=l?l.getTileLayer():null;e=p;m=k;COG.Log.info("updating coordinates, grid = "+l);l&&n(l)}});g.bind("gridUpdate",
function(p,k){n(k);for(var l=o.length;l--;)COG.say("layer.remove",{id:o[l]});o=[]});g.bind("tidy",function(){d=T5.XY.simplify(e,f.pixelGeneralization);a=T5.XY.simplify(m,f.pixelGeneralization);h=true;g.changed()});return g};
T5.ShapeLayer=function(f){function n(e){for(var m=h.length;m--;)h[m].resync(e);h.sort(function(b,o){var g=o.xy.y-b.xy.y;if(g===0)g=o.xy.x-b.xy.y;return g});d=true;a.changed()}f=T5.ex({zindex:80,style:null},f);var h=[],d=false,a=T5.ex(new T5.ViewLayer(f),{add:function(e){h[h.length]=e},each:function(e){for(var m=h.length;m--;)e(h[m])},cycle:function(){return d},draw:function(e,m,b,o){var g=m.x;m=m.y;var p=b.width;b=b.height;e.save();try{T5.applyStyle(e,f.style);for(var k=h.length;k--;){var l=h[k].style,
r=l?T5.applyStyle(e,l):null;h[k].draw(e,g,m,p,b,o);r&&T5.applyStyle(e,r)}}finally{e.restore()}d=false}});a.bind("gridUpdate",function(e,m){n(m)});a.bind("parentChange",function(e,m){var b=m?m.getTileLayer():null;b&&n(b)});COG.configurable(a,["style"],COG.paramTweaker(f,null,null),true);return a};T5.PolyLayer=T5.ShapeLayer;T5.Shape=function(f){f=T5.ex({style:null,properties:{}},f);return T5.ex(f,{rect:null,draw:function(){},resync:function(){}})};
T5.Arc=function(f,n){n=T5.ex({size:4},n);var h=T5.XY.init(),d=T5.ex(n,{draw:function(a,e,m){a.beginPath();a.arc(h.x-e,h.y-m,d.size,0,Math.PI*2,false);a.fill();a.stroke()},resync:function(a){a.syncVectors([f]);h=T5.XY.floor([f])[0]}});COG.Log.info("created arc = ",f);return d};
T5.Poly=function(f,n){n=T5.ex({fill:false,simplify:false},n);var h=false,d=n.fill,a=n.simplify,e=T5.viewState("PINCH"),m=[],b=T5.ex(new T5.Shape(n),{draw:function(o,g,p,k,l,r){if(h){k=true;l=(r&e)!==0;o.beginPath();for(r=m.length;r--;){l=m[r].x-g;var x=m[r].y-p;if(k){o.moveTo(l,x);k=false}else o.lineTo(l,x);l=true}if(l){d&&o.fill();o.stroke()}}},resync:function(o){b.xy=o.syncVectors(f);m=T5.XY.floor(a?T5.XY.simplify(f):f)}});h=f&&f.length>=2;return b};
T5.AnimatedPathLayer=function(f){function n(b,o,g){b.fillStyle="#FFFFFF";b.strokeStyle="#222222";b.beginPath();b.arc(g.x,g.y,4,0,Math.PI*2,false);b.stroke();b.fill()}f=T5.ex({path:[],id:COG.objId("pathAni"),easing:T5.easing("sine.inout"),validStates:T5.viewState("ACTIVE","PAN","PINCH"),drawIndicator:null,duration:2E3,autoCenter:false},f);var h=T5.XY.edges(f.path),d,a=null,e=0;T5.tweenValue(0,h.total,f.easing,function(){m.remove()},f.duration).requestUpdates(function(b,o){e=b;o&&m.remove()});var m=
T5.ex(new T5.ViewLayer(f),{cycle:function(){for(var b=0;b<h.accrued.length&&h.accrued[b]<e;)b++;a=null;if(b<f.path.length-1){var o=e-(b>0?h.accrued[b-1]:0),g=f.path[b];d=T5.XY.theta(g,f.path[b+1],h.edges[b]);a=T5.XY.extendBy(g,d,o);if(f.autoCenter)(b=m.getParent())&&b.centerOn(a)}return a},draw:function(b,o){if(a)(f.drawIndicator?f.drawIndicator:n)(b,o,T5.XY.init(a.x-o.x,a.y-o.y),d)}});return m};
T5.Marker=function(f){function n(g,p,k,l){d=g;a=p;e=k;m=l}f=T5.ex({xy:T5.XY.init(),offset:true,tweenIn:null,animationSpeed:null},f);var h=false,d=0,a=0,e=0,m=0,b=f.offset,o=T5.ex(f,{isNew:true,isAnimating:function(){return h},draw:function(g,p,k,l,r){if(o.isNew&&f.tweenIn){var x=o.xy.y;o.xy.y=p.y-20;h=true;T5.tween(o.xy,"y",x,f.tweenIn,function(){o.xy.y=x;h=false},f.animationSpeed?f.animationSpeed:250+Math.random()*500)}o.drawMarker(g,p,o.xy.x-(b?p.x:0),o.xy.y-(b?p.y:0),k,l,r);o.isNew=false},drawMarker:function(g,
p,k,l){g.beginPath();g.arc(k,l,4,0,Math.PI*2,false);g.fill();n(k-4,l-4,8,8)},hitTest:function(g,p){return g>=d&&g<=d+e&&p>=a&&p<=a+m},updateBounds:n});COG.observable(o);return o};
T5.ImageMarker=function(f){f=T5.ex({image:null,imageUrl:null,animatingImage:null,animatingImageUrl:null,imageAnchor:null,rotation:0,scale:1,opacity:1},f);var n=f.imageAnchor?T5.XY.invert(f.imageAnchor):null,h=T5.ex(new T5.Marker(f),{drawMarker:function(d,a,e,m){if((a=h.isAnimating()&&h.animatingImage?h.animatingImage:h.image)&&a.complete&&a.width>0){n||(n=T5.XY.init(-a.width>>1,-a.height>>1));var b=h.scale,o=e+~~(n.x*b),g=m+~~(n.y*b),p=~~(a.width*b),k=~~(a.height*b);h.updateBounds(o,g,p,p);if(h.rotation||
h.opacity!==1){d.save();try{d.globalAlpha=h.opacity;d.translate(e,m);d.rotate(h.rotation);d.drawImage(a,n.x*b,n.y*b,p,k)}finally{d.restore()}}else d.drawImage(a,o,g,p,k)}}});if(!h.image)h.image=T5.Images.get(f.imageUrl,function(d){COG.Log.info("updating marker image to: "+d.src);h.image=d});if(!h.animatingImage)h.animatingImage=T5.Images.get(f.animatingImageUrl,function(d){h.animatingImage=d});return h};T5.Annotation=T5.Marker;T5.ImageAnnotation=T5.ImageMarker;
T5.MarkerLayer=function(f){function n(b,o){for(var g=a.length;g--;)o.syncVectors([a[g].xy])}function h(){m.changed();m.trigger("markerUpdate",a)}function d(){var b=m.getParent();(b=b&&b.getTileLayer?b.getTileLayer():null)&&n(null,b)}f=T5.ex({zindex:100},f);var a=[],e=false,m=T5.ex(new T5.ViewLayer(f),{cycle:function(){return e},draw:function(b,o,g,p,k){e=false;for(g=a.length;g--;){a[g].draw(b,o,p,m,k);e=e||a[g].isAnimating()}return e?1:0},add:function(b){if(b&&typeof b.length!=="undefined")for(var o=
b.length;o--;){if(b[o])a[a.length]=b[o]}else if(b)a[a.length]=b;h()},clear:function(b){if(b)for(var o=0;o<a.length;o++)b(a[o])&&a.splice(o,1);else a=[];h()},find:function(b){for(var o=[],g=a.length;g--;)if(!b||b(a[g]))o[o.length]=a[g];return o}});m.bind("tap",function(b,o,g){for(var p=[],k=g.x,l=g.y,r=a.length;r--;)if(a[r].hitTest(k,l))p[p.length]=a[r];if(p.length>0)b.cancel=m.trigger("markerTap",o,g,p).cancel});m.bind("gridUpdate",n);m.bind("parentChange",d);m.bind("changed",d);return m};
T5.Style=function(f){function n(e){var m=f[e];typeof m!=="undefined"&&h.push(function(b){b[e]=m})}f=T5.ex({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},f);var h=[],d={applyToContext:function(e){for(var m=h.length;m--;)h[m](e)}};for(var a in f)n(a);return d};
(function(){var f={},n={basic:new T5.Style({lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"}),waypoints:new T5.Style({lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"})};T5.applyStyle=function(h,d){var a=T5.styles[d]?T5.styles[d]:T5.styles.basic,e;if(h&&h.canvas){e=f[h.canvas.id];f[h.canvas.id]=d}a.applyToContext(h);return e};T5.loadStyles=function(h){COG.jsonp(h,function(d){T5.resetStyles(d)})};T5.resetStyles=function(h){var d={};for(var a in h)d[a]=new T5.Style(h[a]);T5.styles=T5.ex({},
n,d)};T5.styles=n})();(function(){T5.tileSize=256;T5.Tile=function(f){return f=T5.ex({x:0,y:0,gridX:0,gridY:0,dirty:true},f)};T5.EmptyTile=function(f){f=new T5.Tile(f);f.empty=true;return f};T5.ImageTile=function(f){f=T5.ex({url:"",sessionParamRegex:null,loading:false,loaded:false},f);return new T5.Tile(f)}})();
T5.TileGrid=function(f){function n(B,T){var K=T5.Vector(B*o-r.x,T*o-r.y);return new T5.EmptyTile({gridX:K.x,gridY:K.y,empty:true})}function h(B,T,K,S){var Q=Math.max(m,b)*0.2>>0,R=T5.XY.init();if(B<0||B+K>m)R.x=B<0?-Q:Q;if(T<0||T+S>b)R.y=T<0?-Q:Q;return R}function d(B,T,K){var S=COG.Log.getTraceTicks(),Q=0;T5.XY.init(m/2,b/2);$=true;try{if(K)e=[];if(B)for(K=0;K<b;K++)for(var R=0;R<m;R++){if(!e[Q]){var V=B(R,K,k,m,b);V.gridX=R*o-r.x;V.gridY=K*o-r.y;e[Q]=V}Q++}}finally{$=false}l=B;x=T;COG.Log.trace("tile grid populated",
S);N.changed()}function a(B,T,K,S){var Q,R=[],V=false;B=T5.XY.init((B.x+r.x-o*z)*C>>0,(B.y+r.y-o*z)*C>>0);tilesNeeded=false;if(!w){Q=N.getParent().getDimensions();q=Math.ceil(Q.width*C)+1+z;s=Math.ceil(Q.height*C)+1+z;w=T5.XY.init((q-1)/2>>0,(s-1)/2>>0)}for(var W=s;W--;)for(var Y=q;Y--;){Q=Y+B.x>=0&&Y+B.x<m?e[(W+B.y)*m+(Y+B.x)]:null;var ka=T5.XY.init(Y-w.x,W-w.y);if(!Q){t=h(B.x,B.y,q,s);Q=n(Y+B.x,W+B.y)}V=Q?(Q.dirty=K||Q.dirty)||V:V;R[R.length]={tile:Q,centerness:T5.XY.absSize(ka)}}R.sort(function(ba,
ca){return ca.centerness-ba.centerness});P||(P=Array(R.length));for(K=R.length;K--;){P[K]=R[K].tile;N.prepTile(P[K],T)}U=S;return V}f=T5.ex({tileSize:T5.tileSize,bufferSize:1,center:T5.XY.init(),clearBackground:false,gridSize:25,shiftOrigin:null,supportFastDraw:true,allowShift:true},f);var e=Array(Math.pow(f.gridSize,2)),m=f.gridSize,b=f.gridSize,o=f.tileSize,g=b*o,p=m*o,k=T5.XY.offset(f.center,-Math.ceil(m>>1)),l=null,r=T5.XY.init(),x=null,z=f.bufferSize,u=Math.round(o/2),v=false,C=o?1/o:0,A=true,
P=null,J=false,$=false,U=0;T5.XY.init();var t=T5.XY.init();T5.getConfig();var q,s,w,D=f.clearBackground;T5.viewState("ANIMATING");var G=T5.viewState("PAN"),I=T5.viewState("PINCH"),N=T5.ex(new T5.ViewLayer(f),{gridDimensions:T5.D.init(p,g),cycle:function(B,T,K,S){if(t.x!==0||t.y!==0){S=t;var Q=f.shiftOrigin;if(!(!f.allowShift||S.x===0&&S.y===0)){var R=COG.Log.getTraceTicks(),V=Array(e.length);V.length=e.length;for(var W=0;W<m;W++)for(var Y=0;Y<b;Y++)V[Y*m+W]=W+S.x>=0&&W+S.x<m?e[(Y+S.y)*m+(W+S.x)]:
null;e=V;k=Q?Q(k,S):T5.XY.add(k,S);r.x+=-S.x*o;r.y+=-S.y*o;COG.Log.trace("tile storage shifted",R);d(l,x)}t=T5.XY.init();S=true}if(!v&&(K&I)===0)v=a(T,K,S,B);return v},find:function(B){if(!B)return null;for(var T=e.length;T--;){var K=e[T];if(K&&B(K))return K}return null},prepTile:function(){},drawTile:function(){return false},getTileSize:function(){return o},draw:function(B,T,K,S,Q,R,V){var W=T.x;T=T.y;var Y=K.width,ka=K.height,ba=Y,ca=ka,aa,O=true;if(P){D&&B.clearRect(0,0,Y,ka);B.beginPath();if(A)for(var la=
P.length;la--;){aa=P[la];var ea=aa.gridX-W,da=aa.gridY-T;if((ea>=0||ea+o<=Y)&&(da>=0||da+o<=ka)){aa.x=ea;aa.y=da;if(aa.empty){if(!D){B.clearRect(ea,da,o,o);B.rect(ea,da,o,o);O=false}}else if(R||aa.dirty){(aa=N.drawTile(B,aa,ea,da,S,R,V,D))&&B.rect(ea,da,o,o);O=O&&aa}ba=ea<ba?ea:ba;ca=da<ca?da:ca}}if(!D&&(S&G)!==0){if(ba>0){B.clearRect(0,0,ba,K.height);B.rect(0,0,ba,K.height)}if(ca>0){B.clearRect(0,0,K.width,ca);B.rect(0,0,K.width,ca)}}D||B.clip();O&&!J&&Q.trigger("tileDrawComplete");v=false;J=O}},
getTileAtXY:function(B,T){for(var K=null,S=P?P.length:0;S--;){var Q=P[S];if(Q&&B>=Q.x&&T>=Q.y)if(B<=Q.x+o&&T<=Q.y+o){K=Q;break}}COG.Log.info("looking for tile @ x: "+B+", y: "+T+", found: "+K);return K},getTileVirtualXY:function(B,T,K){B=T5.XY.add(T5.XY.init(B,T),T5.XY.invert(k),r);B=T5.XY.init(B.x*o,B.y*o);if(K){B.x+=u;B.y+=u}return B},populate:function(B){d(B,null,true)},syncVectors:function(){return T5.XY.init(0,0)}});N.bind("resize",function(){COG.Log.info("captured resize");w=null});N.bind("scale",
function(){A=false});COG.listen("imagecache.cleared",function(){for(var B=e.length;B--;)if(e[B])e[B].loaded=false});COG.listen("tiler.repaint",function(){for(var B=e.length;B--;)if(e[B]){e[B].x=null;e[B].y=null}});return N};
T5.ImageTileGrid=function(f){function n(l){function r(){var x=T5.Images.newCanvas(32,32),z=x.getContext("2d");z.fillStyle="#BBBBBB";z.fillRect(0,0,32,32);z.fillStyle="#C3C3C3";z.fillRect(0,0,16,16);z.fillRect(16,16,16,16);return x}if(!d||l!==d.width){d=T5.Images.newCanvas(l,l);l=d.getContext("2d");l.fillStyle=typeof FlashCanvas!=="undefined"?"#666666":l.createPattern(r(),"repeat");l.fillRect(0,0,d.width,d.height)}return d}f=T5.ex({emptyTile:function(l){if(!h||l!==h.width){h=T5.Images.newCanvas(l,
l);l=h.getContext("2d");l.fillStyle="rgba(150, 150, 150, 0.1)";l.fillRect(0,0,h.width,h.height)}return h}(T5.tileSize),panningTile:null,tileOffset:T5.XY.init(),tileDrawArgs:{}},f);var h=f.emptyTile,d=f.panningTile?f.panningTile:n(T5.tileSize),a=T5.viewState("ACTIVE"),e=T5.viewState("PAN"),m=T5.getConfig().requireFastDraw,b=f.tileSize?f.tileSize:T5.tileSize,o=T5.Images.get,g=T5.Images.load,p=T5.ex({background:null,overlay:null,offset:T5.XY.init(),realSize:T5.D.init(b)},f.tileDrawArgs),k=T5.ex(new T5.TileGrid(f),
{drawTile:function(l,r,x,z,u,v,C,A){v=r.url?o(r.url):null;C=false;if(v){l.drawImage(v,x,z);r.dirty=false;C=true}else if((u&e)!==0){A||l.drawImage(d,x,z);C=true}return C},initTileUrl:function(){},prepTile:function(l,r){if(l&&!l.loading&&(!m||r===a)){l.url||k.initTileUrl(l);if(!o(l.url)){l.loading=true;g(l.url,function(){l.loadTime=(new Date).getTime();l.loaded=true;l.dirty=true;k.changed()},p)}}}});return k};
T5.Tiler=function(f){f=T5.ex({container:"",drawCenter:false,datasources:{},tileLoadThreshold:"first"},f);var n=T5.ex(new T5.View(f),{getTileLayer:function(){return n.getLayer("grid0")},setTileLayer:function(h){n.setLayer("grid0",h);n.trigger("gridUpdate",h);n.eachLayer(function(d){d.trigger("gridUpdate",h)})},viewPixToGridPix:function(h){var d=n.getOffset();return T5.XY.init(h.x+d.x,h.y+d.y)},centerOn:function(h,d,a,e){var m=n.getTileLayer(),b=n.getDimensions();(m=m?m.getTileSize():0)&&n.updateOffset(h.gridX-
(b.width-m)*0.5>>0,h.gridY-(b.height-m)*0.5>>0,d,a,e)},cleanup:function(){n.removeLayer("grid0")},repaint:function(){COG.say("tiler.repaint");n.trigger("wake")},select:function(h){n.trigger("selectTile",h)}});n.bind("tap",function(h,d,a){if(h=n.getTileLayer())(a=h.getTileAtXY(a.x,a.y))&&n.trigger("selectTile",a)});return n};
T5.Geo=function(){function f(t,q){var s=null;for(var w in $)if(q){if(w==q&&$[w][t]){s=$[w];break}}else if($[w][t]){s=$[w];break}return s}function n(t,q){var s=k*Math.sin(t);return a-2*Math.atan(q*Math.pow((1-s)/(1+s),k/2))}function h(t,q,s,w){var D=0;t=t.toUpperCase();for(var G in w){var I=q[G];if(I){var N=s[G];I=N?N(t,I):COG.wordExists(t,I)?1:0;D+=I*w[G]}}return D}var d=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],a=Math.PI/2,e=Math.PI*2,m=-a,b=a,o=
-e,g=Math.PI/180,p=180/Math.PI,k=0.08181919084262157,l=null,r={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",HWY:"HIGHWAY",MWY:"MOTORWAY"},x={VECTORIZE_PER_CYCLE:500},z={getEngine:function(t){for(var q=null,s=1;!q&&s<arguments.length;s++)q=f(t,arguments[s]);q=q?q:f(t);if(!q)throw Error("Unable to find GEO engine with "+t+" capability");return q},rankGeocodeResponses:function(t,q,s){var w=[],D=U.AddressCompareFns;if(s&&s.compareFns)D=T5.ex({},D,s.compareFns);for(s=0;s<q.length;s++)w.push(new U.GeoSearchResult({caption:J.toString(q[s]),
data:q[s],pos:q[s].pos,matchWeight:h(t,q[s],D,U.GeocodeFieldWeights)}));w.sort(function(G,I){return I.matchWeight-G.matchWeight});return w},distanceToString:function(t){if(t>1E3)return~~(t/10)/100+" km";return t?t+" m":""},dist2rad:function(t){return t/6371},lat2pix:function(t){t=parseFloat(t)*g;t=Math.sin(t);var q=k*t;return Math.log((1+t)/(1-t)*Math.pow((1-q)/(1+q),k))/2},lon2pix:function(t){return parseFloat(t)*g},pix2lon:function(t){return U.normalizeLon(t)*p},pix2lat:function(t){t=Math.pow(Math.E,
-t);for(var q=a-2*Math.atan(t),s=n(q,t),w=0;w<12&&Math.abs(q-s)>1.0E-7;){q=s;s=n(q,t);w++}return s*p},normalizeLon:function(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}},u=function(t,q){return{lat:parseFloat(t?t:0),lon:parseFloat(q?q:0)}},v=function(t,q){return{min:A.parse(t),max:A.parse(q)}},C=function(t){return t=T5.ex({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},t)},A=function(){var t={calcDistance:function(q,s){if(t.empty(q)||t.empty(s))return 0;var w=
(s.lat-q.lat)*g/2,D=(s.lon-q.lon)*g/2;w=Math.sin(w)*Math.sin(w)+Math.cos(q.lat*g)*Math.cos(s.lat*g)*Math.sin(D)*Math.sin(D);return 6371*2*Math.atan2(Math.sqrt(w),Math.sqrt(1-w))},copy:function(q){return q?new u(q.lat,q.lon):null},empty:function(q){return!q||q.lat===0&&q.lon===0},equal:function(q,s){return q&&s&&q.lat==s.lat&&q.lon==s.lon},inArray:function(q,s){for(var w=A.equal,D=s.length;D--;)if(w(q,s[D]))return true;return false},inBounds:function(q,s){var w=!(A.empty(q)||A.empty(s));return w=(w=
w&&q.lat>=s.min.lat&&q.lat<=s.max.lat)&&q.lon>=s.min.lon&&q.lon<=s.max.lon},offset:function(q,s,w){var D=q.lat*g;s=D+s/6371;for(q=q.lon*g+Math.asin(Math.sin(w/6371)/Math.cos(D));s<m;)s+=Math.PI;for(;s>b;)s-=Math.PI;for(;q>e;)q-=2*Math.PI;return new u(s*p,q*p)},parse:function(q){if(q)if(typeof q.lat!=="undefined")return t.copy(q);else{if(q.split)for(var s=[" ",","],w=0;w<s.length;w++){var D=q.split(s[w]);if(D.length===2)return new u(D[0],D[1])}}else return new u;return null},parseArray:function(q){var s=
q.length,w=Array(s);for(s=s;s--;)w[s]=t.parse(q[s]);return w},fromMercatorPixels:function(q,s){return new u(T5.Geo.pix2lat(s),T5.Geo.normalizeLon(T5.Geo.pix2lon(q)))},toMercatorPixels:function(q){return T5.XY.init(T5.Geo.lon2pix(q.lon),T5.Geo.lat2pix(q.lat))},generalize:function(q,s,w){var D=q.length,G=[],I=null;w||(w=250);w/=1E3;COG.Log.info("generalizing positions, must include "+s.length+" positions");for(var N=D;N--;)if(N===0)G.unshift(q[N]);else{var B=!I||A.inArray(q[N],s)?w:A.calcDistance(I,
q[N]);if(q[N]&&B>=w){G.unshift(q[N]);I=q[N]}}COG.Log.info("generalized "+D+" positions into "+G.length+" positions");return G},vectorize:function(q,s){var w=q.length,D=Array(w);s=T5.ex({chunkSize:x.VECTORIZE_PER_CYCLE,async:true},s);if(!s.async){for(var G=w;G--;)D[G]=new T5.Geo.GeoVector(q[G]);return D}return COG.Loopage.join({frequency:10,execute:function(I,N){for(var B=0,T=s.chunkSize,K=w;K--;){D[K]=new T5.Geo.GeoVector(q[K]);B+=1;if(B>T)break}w=K;w<=0&&N.trigger("complete",D)}})},toString:function(q){return q?
q.lat+" "+q.lon:""}};return t}(),P=function(){var t={calcSize:function(q,s,w){var D=T5.XY.init(0,s.lat-q.lat);if(typeof w==="undefined")w=true;D.x=w&&q.lon>s.lon?360-q.lon+s.lon:s.lon-q.lon;return D},createBoundsFromCenter:function(q,s){var w=s/6371,D=q.lat*g,G=q.lon*g,I=D-w,N=D+w;if(I>m&&N<b){D=Math.asin(Math.sin(w)/Math.cos(D));w=G-D;if(w<o)w+=2*Math.PI;G=G+D;if(G>e)G-=2*Math.PI}else{I=Math.max(I,m);N=Math.min(N,b);w=o;G=e}return new v(new u(I*p,w*p),new u(N*p,G*p))},expand:function(q,s){return new v(new u(q.min.lat-
s,q.min.lon-U.normalizeLon(s)),new u(q.max.lat+s,q.max.lon+U.normalizeLon(s)))},forPositions:function(q,s){var w=null,D=T5.ticks();s||(s="auto");for(var G=q.length;G--;)if(w){var I=t.calcSize(w.min,q[G],false),N=t.calcSize(q[G],w.max,false);if(I.x<0)w.min.lon=q[G].lon;if(I.y<0)w.min.lat=q[G].lat;if(N.x<0)w.max.lon=q[G].lon;if(N.y<0)w.max.lat=q[G].lat}else w=new T5.Geo.BoundingBox(q[G],q[G]);if(s){if(s=="auto"){G=t.calcSize(w.min,w.max);s=Math.max(G.x,G.y)*0.3}w=t.expand(w,s)}COG.Log.trace("calculated bounds for "+
q.length+" positions",D);return w},getCenter:function(q){var s=P.calcSize(q.min,q.max);return new T5.Geo.Position(q.min.lat+s.y/2,q.min.lon+s.x/2)},getGeoHash:function(q){var s=T5.Geo.GeoHash.encode(q.min.lat,q.min.lon);q=T5.Geo.GeoHash.encode(q.max.lat,q.max.lon);COG.Log.info("min hash = "+s+", max hash = "+q)},getZoomLevel:function(q,s){var w=t.getCenter(q),D=d[Math.min(Math.round(Math.abs(w.lat)*0.05),d.length)],G=t.calcSize(q.min,q.max);w=Math.ceil(Math.log(d[3]*s.height/G.y)/Math.log(2));D=Math.ceil(Math.log(D*
s.width/G.x)/Math.log(2));return Math.min(isNaN(w)?1E3:w,isNaN(D)?1E3:D)},isEmpty:function(q){return!q||A.empty(q.min)||A.empty(q.max)},toString:function(q){return"min: "+A.toString(q.min)+", max: "+A.toString(q.max)}};return t}(),J=function(){var t=/^(\d+).*$/,q=/(\d+)\s?\-\s?(\d+)/;return{buildingMatch:function(s,w){t.lastIndex=-1;if(t.test(s))for(var D=s.replace(t,"$1"),G=w.split(","),I=0;I<G.length;I++){q.lastIndex=-1;if(q.test(G[I])){var N=q.exec(G[I]);if(D>=parseInt(N[1],10)&&D<=parseInt(N[2],
10))return true}else if(D==G[I])return true}return false},normalize:function(s){if(!s)return"";s=s.toUpperCase();if(!l){var w=[];for(var D in r)w.push(D);l=RegExp("(\\s)("+w.join("|")+")(\\s|$)","i")}l.lastIndex=-1;if(w=l.exec(s))s=s.replace(l,"$1"+r[w[2]]);return s},toString:function(s){return s.streetDetails+" "+s.location}}}(),$={},U={P:A,B:P,A:J,Radius:function(t,q){return{distance:parseInt(t,10),uom:q}},Position:u,BoundingBox:v,GeoXY:function(t){function q(w){s.pos=w;s.mercXY=A.toMercatorPixels(w)}
var s=T5.XY.init();T5.ex(s,{radsPerPixel:null,setRadsPerPixel:function(w,D,G){var I=s.mercXY;s.x=Math.abs((I.x/w>>0)+(D?D:0));s.y=Math.abs((I.y/w>>0)+(G?G:0));s.radsPerPixel=w},updatePos:q});q(t);return s},Address:C,GeocodeFieldWeights:{streetDetails:50,location:50},AddressCompareFns:{},Engine:function(t){if(!t.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var q=T5.ex({remove:function(){delete $[q.id]}},t);return $[q.id]=q},GeoSearchResult:function(t){t=T5.ex({id:null,
caption:"",resultType:"",data:null,pos:null,matchWeight:0},t);return T5.ex(t,{toString:function(){return t.caption+(t.matchWeight?" ("+t.matchWeight+")":"")}})},GeoSearchAgent:function(t){return new T5.Dispatcher.Agent(t)},GeocodingAgent:function(t){t=T5.ex({name:"Geocoding Search Agent",paramTranslator:null,execute:function(q,s){try{if(!q.reverse&&!q.freeform)address=new C(q);var w=U.getEngine("geocode");if(w)w.geocode({addresses:[q.freeform?q.freeform:address],complete:function(G,I){if(s){var N=
I;if(q.freeform)N=U.rankGeocodeResponses(q.freeform,N,U.getEngine("geocode"));s(N,t)}}})}catch(D){COG.Log.exception(D)}}},t);return new U.GeoSearchAgent(t)}};return T5.ex(U,x,z)}();T5.Geo.GeoVector=T5.Geo.GeoXY;
T5.Geo.GeoHash=function(){function f(n,h,d){if(h&d)n[0]=(n[0]+n[1])/2;else n[1]=(n[0]+n[1])/2}BITS=[16,8,4,2,1];BASE32="0123456789bcdefghjkmnpqrstuvwxyz";NEIGHBORS={right:{even:"bc01fg45238967deuvhjyznpkmstqrwx"},left:{even:"238967debc01fg45kmstqrwxuvhjyznp"},top:{even:"p0r21436x8zb9dcf5h7kjnmqesgutwvy"},bottom:{even:"14365h7k9dcfesgujnmqp0r2twvyx8zb"}};BORDERS={right:{even:"bcfguvyz"},left:{even:"0145hjnp"},top:{even:"prxz"},bottom:{even:"028b"}};NEIGHBORS.bottom.odd=NEIGHBORS.left.even;NEIGHBORS.top.odd=
NEIGHBORS.right.even;NEIGHBORS.left.odd=NEIGHBORS.bottom.even;NEIGHBORS.right.odd=NEIGHBORS.top.even;BORDERS.bottom.odd=BORDERS.left.even;BORDERS.top.odd=BORDERS.right.even;BORDERS.left.odd=BORDERS.bottom.even;BORDERS.right.odd=BORDERS.top.even;return{decode:function(n){var h=1,d=[],a=[];d[0]=-90;d[1]=90;a[0]=-180;a[1]=180;lat_err=90;lon_err=180;for(i=0;i<n.length;i++){c=n[i];cd=BASE32.indexOf(c);for(j=0;j<5;j++){mask=BITS[j];if(h){lon_err/=2;f(a,cd,mask)}else{lat_err/=2;f(d,cd,mask)}h=!h}}d[2]=(d[0]+
d[1])/2;a[2]=(a[0]+a[1])/2;return{latitude:d,longitude:a}},encode:function(n,h,d){var a=1,e=[],m=[],b=0,o=0;d=d?d:12;geohash="";e[0]=-90;e[1]=90;m[0]=-180;for(m[1]=180;geohash.length<d;){if(a){mid=(m[0]+m[1])/2;if(h>mid){o|=BITS[b];m[0]=mid}else m[1]=mid}else{mid=(e[0]+e[1])/2;if(n>mid){o|=BITS[b];e[0]=mid}else e[1]=mid}a=!a;if(b<4)b++;else{geohash+=BASE32[o];o=b=0}}return geohash}}}();
T5.Geo.JSON=function(){function f(p,k,l,r){k=h(k);p.add(r.line(k,l));return k.length}function n(p,k,l,r){k=h(k);p.add(r.poly(k,l));return k.length}function h(p){var k=p?p.length:0,l=Array(k);for(k=k;k--;)l[k]=new T5.Geo.Position(p[k][1],p[k][0]);return T5.Geo.P.vectorize(l,m)}function d(p,k,l){return new g(p,k,l)}var a="featurecollection",e="feature",m={async:false},b={processor:null,group:"shapes",layerClass:T5.ShapeLayer},o={point:T5.ex({},b,{processor:function(p,k,l,r){k=h([k.coordinates],m);if(k.length>
0)if(l=r.marker(k[0],l)){p.add(l);return k.length}},group:"markers",layerClass:T5.MarkerLayer}),linestring:T5.ex({},b,{processor:function(p,k,l,r){k=h(k&&k.coordinates?k.coordinates:[]);return f(p,k,l,r)}}),multilinestring:T5.ex({},b,{processor:function(p,k,l,r){k=k&&k.coordinates?k.coordinates:[];for(var x=0,z=k.length;z--;)x+=f(p,k[z],l,r);return x}}),polygon:T5.ex({},b,{processor:function(p,k,l,r){k=k&&k.coordinates?k.coordinates:[];if(k.length>0)return n(p,k[0],l,r);return 0}}),multipolygon:T5.ex({},
b,{processor:function(p,k,l,r){k=k&&k.coordinates?k.coordinates:[];for(var x=0,z=0;z<k.length;z++)x+=n(p,k[z][0],l,r);return x}})},g=function(p,k,l,r){function x(q,s){var w=q.processor,D=C+q.group,G=T5.ex({},q,l,{properties:s.properties});if(w){var I=U[D];if(!I){I=new q.layerClass({id:D});U[D]=I}globalLayers=U;return w(I,s.data,G,r)}return 0}function z(q,s){var w=q&&q.type?q.type.toLowerCase():null;return w&&w===e?z(q.geometry,q.properties):{type:w,isCollection:w?w===a:false,definition:o[w],data:q,
properties:s?s:q.properties}}l=T5.ex({vectorsPerCycle:T5.Geo.VECTORIZE_PER_CYCLE,rowPreParse:null,simplify:false,layerPrefix:"geojson-"},l);r=T5.ex({marker:function(q){return new T5.Marker({xy:q})},line:function(q,s){return new T5.Poly(q,s)},poly:function(q,s){return new T5.Poly(q,T5.ex({fill:true},s))}},r);var u=l.vectorsPerCycle,v=l.rowPreParse,C=l.layerPrefix,A=0,P=0,J=null,$=0,U={},t;if(!p)return null;if(typeof p.length==="undefined")p=[p];P=p.length;t=COG.Loopage.join({frequency:10,execute:function(q,
s){var w=0,D=A;if(!J){for(;D<P;D++){var G=z(v?v(p[D]):p[D]),I=null;if(G.isCollection){$+=1;J=d(G.data.features,function(N){J=null;for(var B in N)U[B]=N[B]},{layerPrefix:C+$+"-"});I+=1}else if(G.definition)I=x(G.definition,G);w+=I?I:1;if(w>=u)break}A=D+1;!J&&A>=P&&s.trigger("complete")}}});t.bind("complete",function(){k&&k(U)});return t};return{parse:d}}();
T5.Geo.LocationSearch=function(f){function n(m,b){navigator.geolocation.clearWatch(d);d=0;if(a){clearTimeout(a);a=0}b&&b([m],f)}function h(m){COG.Log.info("caught location tracking error:",m)}f=T5.ex({name:"Geolocation Search",requiredAccuracy:null,searchTimeout:5E3,watch:false},f);var d=0,a=0,e=null;return new T5.Geo.GeoSearchAgent(T5.ex({execute:function(m,b){if(navigator.geolocation&&!d){d=navigator.geolocation.watchPosition(function(o){var g=new T5.Geo.Position(o.coords.latitude,o.coords.longitude);
o=new T5.Geo.GeoSearchResult({id:1,caption:"Current Location",pos:g,accuracy:o.coords.accuracy/1E3,matchWeight:100});if(!e||o.accuracy<e.accuracy)e=o;if(!f.requiredAccuracy||e.accuracy<f.requiredAccuracy)n(e,b)},h,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3});if(f.searchTimeout)a=setTimeout(function(){e&&n(e,b)},f.searchTimeout)}}},f))};
T5.Map=function(f){function n(r){try{var x=new T5.Geo.Position(r.coords.latitude,r.coords.longitude),z=r.coords.accuracy/1E3;l.trigger("locationUpdate",r,z);if(p){if(!o){o=new T5.Geo.UI.LocationOverlay({pos:x,accuracy:z});o.update(l.getTileLayer());l.setLayer("location",o)}var u=T5.Geo.B.createBoundsFromCenter(x,Math.max(z,1));l.gotoBounds(u)}else{o.pos=x;o.accuracy=z;o.update(l.getTileLayer());l.panToPosition(x,null,T5.easing("sine.out"))}p=false}catch(v){COG.Log.exception(v)}}function h(r){COG.Log.info("caught location tracking error:",
r)}f=T5.ex({tapExtent:10,provider:null,crosshair:false,zoomLevel:0,boundsChangeThreshold:30,zoomAnimation:T5.easing("quad.out")},f);var d={NONE:0,SINGLE:1,WATCH:2},a=T5.XY.init(),e=d.NONE,m=false,b=null,o=null,g=0,p=true,k=f.zoomLevel;if(!f.provider)f.provider=new T5.Geo.MapProvider;f.adjustScaleFactor=function(r){return Math.pow(2,(r<1?Math.floor:Math.ceil)(Math.log(r)))};var l=T5.ex({},new T5.Tiler(f),{annotations:null,getBoundingBox:function(){var r=l.getTileLayer(),x=l.getOffset(),z=l.getDimensions();
if(r)return r.getBoundingBox(x.x,x.y,z.width,z.height);return null},getCenterPosition:function(){return l.getXYPosition(T5.D.getCenter(l.getDimensions()))},getXYPosition:function(r){return l.getTileLayer().pixelsToPos(l.viewPixToGridPix(r))},gotoBounds:function(r,x){var z=T5.Geo.B.getZoomLevel(r,l.getDimensions());l.gotoPosition(T5.Geo.B.getCenter(r),z,x)},gotoPosition:function(r,x,z){function u(P){l.setTileLayer(P);l.panToPosition(r,function(){l.unfreeze();l.trigger("zoomLevelChange",k);z&&z()});
m=true}var v=k,C=!m,A=l.getBoundingBox();if(A)C=C||!T5.Geo.P.inBounds(r,A);k=x?x:k;if(!k)throw Error("Zoom level required to goto a position.");if(f.provider)k=f.provider.checkZoomLevel(k);if(C||k!==v){T5.Images.cancelLoad();T5.cancelAnimation();m&&l.freeze();f.provider.zoomLevel=k;f.provider.getMapTiles(l,r,u)}else l.panToPosition(r,z)},panToPosition:function(r,x,z,u){var v=l.getTileLayer();if(v){r=v.getGridXYForPosition(r);v=l.getDimensions();r.x-=v.width/2;r.y-=v.height/2;if(b)b=null;l.updateOffset(r.x,
r.y,z,u,x);l.trigger("wake");l.trigger("boundsChange",l.getBoundingBox());x&&typeof z==="undefined"&&x(l)}},locate:function(){l.trackStart(d.SINGLE);setTimeout(l.trackCancel,1E4)},trackStart:function(r){if(navigator.geolocation&&!g){e=r?r:d.WATCH;p=true;g=navigator.geolocation.watchPosition(n,h,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3})}},trackCancel:function(){g&&navigator.geolocation&&navigator.geolocation.clearWatch(g);l.removeLayer("location");o=null;e=d.NONE;g=0},getZoomLevel:function(){return k},
setZoomLevel:function(r){try{l.gotoPosition(l.getCenterPosition(),r)}catch(x){COG.Log.exception(x)}},zoomIn:function(){l.scale(2,T5.easing("sine.out"))||l.setZoomLevel(k+1)},zoomOut:function(){l.scale(0.5,T5.easing("sine.out"))||l.setZoomLevel(k-1)},animateRoute:function(r,x,z,u){var v=l.getLayer("route");if(v)(r=v.getAnimation(r,x,z,u))&&r.addToView(l)}});l.bind("pan",function(){e===d.SINGLE&&l.trackCancel()});l.bind("tap",function(r,x,z){var u=l.getTileLayer(),v=null;if(u){var C=l.viewPixToGridPix(T5.XY.init(z.x,
z.y));r=u.pixelsToPos(C);v=u.pixelsToPos(T5.XY.offset(C,-f.tapExtent,f.tapExtent));u=u.pixelsToPos(T5.XY.offset(C,f.tapExtent,-f.tapExtent));v=new T5.Geo.BoundingBox(v,u);l.trigger("geotap",x,z,r,v)}});l.bind("doubleTap",function(r,x,z){l.scalable()&&l.animate(2,T5.D.getCenter(l.getDimensions()),T5.XY.init(z.x,z.y),f.zoomAnimation)});l.bind("scale",function(r,x,z){r=0;x=Math.sqrt(x);if(x<1)r=-(0.5/x);else if(x>1)r=x;l.gotoPosition(l.getXYPosition(z),k+r>>0)});f.crosshair&&l.setLayer("crosshair",new CrosshairOverlay);
l.bind("idle",function(){if(T5.XY.absSize(T5.XY.diff(a,l.getOffset()))>f.boundsChangeThreshold){a=T5.XY.copy(l.getOffset());l.trigger("boundsChange",l.getBoundingBox())}});COG.configurable(l,["provider"],COG.paramTweaker(f,null,{provider:function(){l.cleanup();m=false}}),true);return l};
T5.Geo.MapProvider=function(){var f=1,n=20;return{zoomLevel:0,checkZoomLevel:function(h){return Math.min(Math.max(h,f),n)},getCopyright:function(){},getLogoUrl:function(){},getMapTiles:function(){},getZoomRange:function(){return{min:f,max:n}},prepTileGridArgs:function(h,d,a,e,m){var b=null;if(m.tileBackgroundColor){b=T5.Images.newCanvas(a,a);var o=b.getContext("2d");o.fillStyle=m.tileBackgroundColor;o.fillRect(0,0,a,a)}return T5.ex({tileSize:a,width:h,height:d,center:e,tileDrawArgs:{background:b}},
m)},setZoomRange:function(h,d){f=h;n=d}}};
T5.Geo.Routing=function(){var f={calculate:function(n){n=T5.ex({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},n);var h=T5.Geo.getEngine("route");h&&h.route(n,function(d){if(n.generalize)d.geometry=T5.Geo.P.generalize(d.geometry,d.getInstructionPositions());if(n.map){f.createMapOverlay(n.map,d);n.autoFit&&n.map.gotoBounds(d.boundingBox)}n.success&&n.success(d)})},createMapOverlay:function(n,h){var d=n.getDimensions();d=new T5.Geo.UI.RouteOverlay({data:h,width:d.width,
height:d.height});n.setLayer("route",d)},parseTurnType:function(n){for(var h=f.TurnType.Unknown,d=T5.Geo.Routing.TurnTypeRules,a=0;a<d.length;a++){d[a].regex.lastIndex=-1;var e=d[a].regex.exec(n);if(e){h=d[a].customCheck?d[a].customCheck(n,e):d[a].turnType;break}}return h},TurnType:{Unknown:"turn-unknown",Start:"turn-none-start",Continue:"turn-none",Arrive:"turn-none-arrive",TurnLeft:"turn-left",TurnLeftSlight:"turn-left-slight",TurnLeftSharp:"turn-left-sharp",TurnRight:"turn-right",TurnRightSlight:"turn-right-slight",
TurnRightSharp:"turn-right-sharp",Merge:"merge",UTurnLeft:"uturn-left",UTurnRight:"uturn-right",EnterRoundabout:"roundabout-enter",Ramp:"ramp",RampExit:"ramp-exit"},Instruction:function(n){var h=n=T5.ex({position:null,description:"",distance:0,distanceTotal:0,time:0,timeTotal:0,turnType:null},n),d=n.description;d=d.replace(/(\w)(\/)(\w)/g,"$1 $2 $3");h.description=d;if(!n.turnType)n.turnType=f.parseTurnType(n.description);return n},RouteData:function(n){n=T5.ex({geometry:[],instructions:[],boundingBox:null},
n);if(!n.boundingBox)n.boundingBox=T5.Geo.B.forPositions(n.geometry);return T5.ex({getInstructionPositions:function(){for(var h=[],d=0;d<n.instructions.length;d++)n.instructions[d].position&&h.push(n.instructions[d].position);return h}},n)}};return f}();T5.Geo.Search=function(){return{bestResults:function(f,n){n||(n=20);for(var h=f.length>0?f[0]:null,d=[],a=0;a<f.length;a++)if(h&&f[a]&&h.matchWeight-f[a].matchWeight<=n)d.push(f[a]);else break;return d}}}();
T5.Geo.UI=function(){var f={AnnotationTween:null,GeoTileGrid:function(n){n=T5.ex({grid:null,centerPos:new T5.Geo.Position,centerXY:T5.XY.init(),radsPerPixel:0},n);var h=n.radsPerPixel,d=T5.Geo.P.toMercatorPixels(n.centerPos),a=d.x/h-n.centerXY.x>>0,e=d.y/h-n.centerXY.y>>0,m=null,b=T5.ex({},n.grid,{getBoundingBox:function(o,g,p,k){return new T5.Geo.BoundingBox(b.pixelsToPos(T5.XY.init(o,g+k)),b.pixelsToPos(T5.XY.init(o+p,g)))},getGridXYForPosition:function(o){o=new T5.Geo.GeoVector(o);b.syncVectors([o]);
return o},syncVectors:function(o){for(var g,p,k,l,r=o.length;r--;){var x=o[r];if(x&&x.setRadsPerPixel){x.setRadsPerPixel(h,-a,-m);g=typeof g==="undefined"||x.x<g?x.x:g;p=typeof p==="undefined"||x.y<p?x.y:p;k=typeof k==="undefined"||x.x>k?x.x:k;l=typeof l==="undefined"||x.y>l?x.y:l}}return T5.XYRect.init(g,p,l,l)},getPixelDistance:function(o){return T5.Geo.dist2rad(o)/h>>0},pixelsToPos:function(o){return T5.Geo.P.fromMercatorPixels((a+o.x)*h,(e+b.gridDimensions.height-o.y)*h)}});m=e+b.gridDimensions.height;
return b},RouteOverlay:function(n){n=T5.ex({data:null,pixelGeneralization:8,partialDraw:false,strokeStyle:"rgba(0, 51, 119, 0.9)",waypointFillStyle:"#FFFFFF",lineWidth:4,zindex:50},n);var h=[],d=[],a=new T5.PathLayer(n);(function(){if(n.data&&n.data.instructions){for(var e=n.data.instructions,m=Array(e.length),b=e.length;b--;)m[b]=e[b].position;T5.Geo.P.vectorize(m).bind("complete",function(o,g){d=g})}n.data&&n.data.geometry&&T5.Geo.P.vectorize(n.data.geometry).bind("complete",function(o,g){h=g;a.updateCoordinates(h,
d,true)})})();return a},Poly:function(n,h){h=T5.ex({autoParse:true},h);for(var d=Array(n.length),a=h.autoParse,e=T5.Geo.GeoVector,m=T5.Geo.P.parse,b=n.length;b--;)d[b]=new e(a?m(n[b]):n[b]);return new T5.Poly(d,h)},Annotation:function(n){n=T5.ex({pos:null},n);n.xy=new T5.Geo.GeoVector(n.pos);return new T5.ImageAnnotation(n)},LocationOverlay:function(n){n=T5.ex({pos:null,accuracy:null,zindex:90},n);var h=new Image,d=T5.XY.init(),a=T5.XY.init(),e=null;h.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAACIQAAAiEBPhEQkwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAG+SURBVCiRlZHNahNRAIW/O7mTTJPahLZBA1YUyriINRAE3bQIKm40m8K8gLj0CRQkO32ELHUlKbgoIu4EqeJPgtCaoBuNtjXt5LeTMZk0mbmuWiuuPLsD3+HAOUIpxf9IHjWmaUbEyWv5ROrsVULhcHP761rUfnN3Y2Otc8CIg4YT85lzuVsPP+Qupw1vpPjRCvhS9ymvV0e77x7nNj+uvADQAIQQ+uLyvdfLV9JGZi7EdEwQlqBpEJ019f0z1mo2u5Q8DMydv25lshemmj1FueZTawbs7inarqLbV7Qjab1upB9YlhWSAHLavLHZCvg1VEhN0PMU9W7At4bPVidg7CtkLLXkut+lBPD6/Ub155jJiADAHSpaLmx3ApyBQoYEUd0PBoOBkAC6+3llvda/YxgGgYL+UNHf/zN3KiExGlsvTdP0NYDkhPdWrz35ZDsBzV5wCMuQwEyFmXFeeadjzfuFQmGkAZRKpdGC/n7x+M6jqvA9Zo6FWDhlcHE+wqT93J1tP7vpOE7rrx8ALMuasPf8S12St4WmJ6bYWTUC52k8Hm8Vi0X/nwBAPp/XKpWKdF1X2LYdlMvlsToC/QYTls7DLFr/PAAAAABJRU5ErkJggg%3D%3D";
h.onload=function(){d=T5.XY.init(h.width/2,h.height/2)};var m=T5.ex(new T5.ViewLayer(n),{pos:n.pos,accuracy:n.accuracy,drawAccuracyIndicator:false,draw:function(b,o){var g=a.x-o.x,p=a.y-o.y;if(e){b.fillStyle="rgba(30, 30, 30, 0.2)";b.beginPath();b.arc(g,p,e,0,Math.PI*2,false);b.fill()}h.complete&&h.width>0&&b.drawImage(h,g-d.x,p-d.y,h.width,h.height);m.changed()},update:function(b){if(b){e=Math.floor(b.getPixelDistance(m.accuracy)*0.5);a=b.getGridXYForPosition(m.pos);m.changed()}}});m.bind("gridUpdate",
function(b,o){m.update(o)});return m},AnnotationsOverlay:function(n){function h(b,o){var g=b.length,p=m.getParent();if(o=o?o:p?p.getTileLayer():null)for(g=g;g--;)o.syncVectors([b[g].xy]);b.sort(function(k,l){var r=l.xy.y-k.xy.y;if(r===0)r=l.xy.x-k.xy.x;return r})}n=T5.ex({pois:null,map:null,zindex:100},n);var d=[],a=false,e=[],m=T5.ex(new T5.ViewLayer(n),{cycle:function(){return a},draw:function(b,o,g,p,k){a=false;b.fillStyle="rgba(255, 0, 0, 0.75)";b.globalCompositeOperation="source-over";for(g=
d.length;g--;){d[g].draw(b,o,p,m,k);a=a||d[g].isAnimating()}for(g=e.length;g--;){e[g].draw(b,o,p,m,k);a=a||e[g].isAnimating()}return a?1:0},add:function(b){if(b&&b.length)for(var o=b.length;o--;)e[e.length]=b[o];else if(b)e[e.length]=b;h(e);m.changed()},clear:function(b){e=[];h(e);if(b){d=[];h(d)}m.changed()}});COG.listen("geo.pois-updated",function(b){if(n.pois&&n.pois.id==b.srcID){b=b.pois;try{d=[];for(var o=0;o<b.length;o++)if(b[o].pos){var g;var p=b[o];if(p&&p.pos){var k={poi:p,annotation:null};
n.map&&n.map.trigger("getAnnotationForPOI",k);if(!k.annotation)k.annotation=new T5.Annotation({xy:new T5.Geo.GeoVector(p.pos)});if(k.annotation){k.annotation.isNew=p.isNew;p.isNew=false}g=k.annotation}else g=void 0;g&&d.push(g)}h(d)}catch(l){COG.Log.exception(l)}m.changed()}});m.bind("gridUpdate",function(b,o){h(d,o);h(e,o);m.changed()});return m}};f.ImageAnnotation=f.Annotation;return f}();
T5.Geo.Routing.TurnTypeRules=function(){var f=T5.Geo.Routing.TurnType,n=[];n.push({regex:/continue/i,turnType:f.Continue});n.push({regex:/(take|bear|turn)(.*?)left/i,customCheck:function(h,d){return/bear/i.test(d[1])?f.TurnLeftSlight:f.TurnLeft}});n.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(h,d){return/bear/i.test(d[1])?f.TurnRightSlight:f.TurnRight}});n.push({regex:/enter\s(roundabout|rotaty)/i,turnType:f.EnterRoundabout});n.push({regex:/take.*?ramp/i,turnType:f.Ramp});n.push({regex:/take.*?exit/i,
turnType:f.RampExit});n.push({regex:/make(.*?)u\-turn/i,customCheck:function(h,d){return/right/i.test(d[1])?f.UTurnRight:f.UTurnLeft}});n.push({regex:/proceed/i,turnType:f.Start});n.push({regex:/arrive/i,turnType:f.Arrive});n.push({regex:/fell\sthrough/i,turnType:f.Merge});return n}();
