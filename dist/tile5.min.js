COG=typeof COG!=="undefined"?COG:{};COG.extend=function(){for(var P=arguments[0]||{},ha,M=1,D=arguments.length;M<D;M++)if((ha=arguments[M])!==null)for(var j in ha){var k=ha[j];if(P!==k)if(k!==undefined)P[j]=k}return P};
(function(){var P=Object.prototype.hasOwnProperty,ha=0,M={};M.toID=function(D){return D.replace(/\s/g,"-")};M.objId=function(D){return(D?D:"obj")+ha++};M.isFunction=function(D){return toString.call(D)==="[object Function]"};M.isArray=function(D){return toString.call(D)==="[object Array]"};M.isPlainObject=function(D){if(!D||toString.call(D)!=="[object Object]"||D.nodeType||D.setInterval)return false;if(D.constructor&&!P.call(D,"constructor")&&!P.call(D.constructor.prototype,"isPrototypeOf"))return false;
var j;for(j in D);return j===undefined||P.call(D,j)};M.isEmptyObject=function(D){for(var j in D)return false;return true};M.isXmlDocument=function(D){return toString.call(D)==="[object Document]"};M.contains=function(D,j){var k=D,x=arguments,E=1;if(j&&module.isArray(j)){x=j;E=0}for(E=E;E<x;E++)k=k&&typeof foo[x[E]]!=="undefined";return k};M.formatStr=function(D){if(arguments.length<=1)return D;for(var j=arguments.length-2,k=0;k<=j;k++)D=D.replace(RegExp("\\{"+k+"\\}","gi"),arguments[k+1]);return D};
M.wordExists=function(D,j){var k="";if(j.toString)j=j.toString();for(var x=0;x<j.length;x++)k+=!/\w/.test(j[x])?"\\"+j[x]:j[x];return RegExp("(^|\\s|\\,)"+k+"(\\,|\\s|$)","i").test(D)};COG.extend(COG,M)})();
(function(){function P(k){return typeof console!=="undefined"?function(){console[k](Array.prototype.slice.call(arguments,0).join(" "));return true}:function(){return false}}var ha=window.console&&window.console.markTimeline,M=P("error"),D=P("info"),j=function(){return ha?function(k,x){console.markTimeline(k+(x?": "+((new Date).getTime()-x)+"ms":""))}:function(){}}();COG.extend(COG,{trace:j,debug:P("debug"),info:D,warn:P("warn"),error:M,exception:function(k){if(M)for(var x in k)D("ERROR DETAIL: "+
x+": "+k[x])}})})();
(function(){function P(M,D){var j=M.obsHandlers;j[D]||(j[D]=[]);return j[D]}var ha=0;COG.observable=function(M){if(!M)return null;if(!M.obsHandlers)M.obsHandlers={};if(!(M.bind||M.trigger||M.unbind)){M.bind=function(D,j){var k="callback"+ha++;P(M,D).unshift({fn:j,id:k});return k};M.triggerCustom=function(D,j){var k=P(M,D),x={cancel:false,name:D,source:this},E;j&&COG.extend(x,j);if(!k)return null;E=Array.prototype.slice.call(arguments,2);M.eventInterceptor&&M.eventInterceptor(D,x,E);E.unshift(x);for(var V=
k.length;V--&&!x.cancel;)k[V].fn.apply(this,E);return x};M.trigger=function(D){var j=Array.prototype.slice.call(arguments,1);j.splice(0,0,D,null);return M.triggerCustom.apply(this,j)};M.unbind=function(D,j){if(typeof D==="undefined")M.obsHandlers={};else for(var k=P(M,D),x=0;k&&x<k.length;x++)if(k[x].id===j){k.splice(x,1);break}return M}}return M}})();
(function(){function P(j,k){j[k]||(j[k]=function(x){return j.configure(k,x)})}function ha(j){j.gtConfId="configurable"+D++;j.gtConfig={};j.gtConfigFns=[];return j.gtConfig}var M={},D=0;COG.paramTweaker=function(j,k,x){return function(E,V){if(typeof V!=="undefined"){if(E in j)j[E]=V;x&&E in x&&x[E](E,V)}else return k&&E in k?k[E](E):j[E]}};COG.configurable=function(j,k,x,E){if(j){j.gtConfId||ha(j);var V=j.gtConfId,m=j.gtConfig,K=j.gtConfigFns;M[V]=j;K.push(x);for(x=k.length;x--;){m[k[x]]=true;E&&P(j,
k[x])}if(!j.configure)j.configure=function(H,N){if(m[H]){for(var y=K.length;y--;){var A=K[y](H,N);if(typeof A!=="undefined")return A}return M[V]}return null}}}})();
(function(){function P(j){var k=document.createElement("script"),x=false;k.src=j;k.async=true;k.onload=k.onreadystatechange=function(){if(!x&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){x=true;k.onload=k.onreadystatechange=null;k&&k.parentNode&&k.parentNode.removeChild(k)}};M||(M=document.getElementsByTagName("head")[0]);M.appendChild(k)}var ha=0,M,D=this;COG.jsonp=function(j,k,x){j+=j.indexOf("?")>=0?"&":"?";var E="json"+ ++ha;D[E]=function(V){k(V);D[E]=null;try{delete D[E]}catch(m){}};
P(j+(x?x:"callback")+"="+E);return E}})();
(function(){var P=1.70158,ha=Math.PI/2,M=1E3/60|0,D=Math.abs,j=Math.pow,k=Math.sin,x=Math.asin,E=Math.cos,V={linear:function(m,K,H,N){return H*m/N+K},backin:function(m,K,H,N){return H*(m/=N)*m*((P+1)*m-P)+K},backout:function(m,K,H,N){return H*((m=m/N-1)*m*((P+1)*m+P)+1)+K},backinout:function(m,K,H,N){return(m/=N/2)<1?H/2*m*m*(((P*=1.525)+1)*m-P)+K:H/2*((m-=2)*m*(((P*=1.525)+1)*m+P)+2)+K},bouncein:function(m,K,H,N){return H-V.bounceout(N-m,0,H,N)+K},bounceout:function(m,K,H,N){return(m/=N)<1/2.75?
H*7.5625*m*m+K:m<2/2.75?H*(7.5625*(m-=1.5/2.75)*m+0.75)+K:m<2.5/2.75?H*(7.5625*(m-=2.25/2.75)*m+0.9375)+K:H*(7.5625*(m-=2.625/2.75)*m+0.984375)+K},bounceinout:function(m,K,H,N){return m<N/2?V.bouncein(m*2,0,H,N)/2+K:V.bounceout(m*2-N,0,H,N)/2+H/2+K},cubicin:function(m,K,H,N){return H*(m/=N)*m*m+K},cubicout:function(m,K,H,N){return H*((m=m/N-1)*m*m+1)+K},cubicinout:function(m,K,H,N){if((m/=N/2)<1)return H/2*m*m*m+K;return H/2*((m-=2)*m*m+2)+K},elasticin:function(m,K,H,N,y,A){if(m==0)return K;if((m/=
N)==1)return K+H;A||(A=N*0.3);if(!y||y<D(H)){y=H;H=A/4}else H=A/TWO_PI*x(H/y);return-(y*j(2,10*(m-=1))*k((m*N-H)*TWO_PI/A))+K},elasticout:function(m,K,H,N,y,A){var I;if(m==0)return K;if((m/=N)==1)return K+H;A||(A=N*0.3);if(!y||y<D(H)){y=H;I=A/4}else I=A/TWO_PI*x(H/y);return y*j(2,-10*m)*k((m*N-I)*TWO_PI/A)+H+K},elasticinout:function(m,K,H,N,y,A){var I;if(m==0)return K;if((m/=N/2)==2)return K+H;A||(A=N*0.3*1.5);if(!y||y<D(H)){y=H;I=A/4}else I=A/TWO_PI*x(H/y);if(m<1)return-0.5*y*j(2,10*(m-=1))*k((m*
N-I)*TWO_PI/A)+K;return y*j(2,-10*(m-=1))*k((m*N-I)*TWO_PI/A)*0.5+H+K},quadin:function(m,K,H,N){return H*(m/=N)*m+K},quadout:function(m,K,H,N){return-H*(m/=N)*(m-2)+K},quadinout:function(m,K,H,N){if((m/=N/2)<1)return H/2*m*m+K;return-H/2*(--m*(m-2)-1)+K},sinein:function(m,K,H,N){return-H*E(m/N*ha)+H+K},sineout:function(m,K,H,N){return H*k(m/N*ha)+K},sineinout:function(m,K,H,N){return-H/2*(E(Math.PI*m/N)-1)+K}};COG.tweenValue=function(m,K,H,N,y){function A(ca){ca=ca?ca:(new Date).getTime();if(sa+M<
ca){var va=ca-I,ba=H(va,m,ia,N),ta=I+N<=ca;ca=!ta;if(y){va=y(ba,ta,va);ca=typeof va!="undefined"?va&&ca:ca}ca&&animFrame(A)}}var I=(new Date).getTime(),sa=0,ia=K-m;animFrame(A);return{}};COG.easing=function(m){return V[m.replace(/[\-\_\s\.]/g,"").toLowerCase()]};COG.registerEasingType=function(m,K){V[m.replace(/[\-\_\s\.]/g,"").toLowerCase()]=K}})();
(function(){var P=/^P(\d+Y)?(\d+M)?(\d+D)?$/,ha=/^(\d+H)?(\d+M)?(\d+S)?$/,M={8601:function(j){j=j.split("T");var k=null;k=null;var x=0,E=0;P.lastIndex=-1;k=P.exec(j[0]);x+=k[3]?parseInt(k[3].slice(0,-1),10):0;ha.lastIndex=-1;k=ha.exec(j[1]);E+=k[1]?parseInt(k[1].slice(0,-1),10)*3600:0;E+=k[2]?parseInt(k[2].slice(0,-1),10)*60:0;E+=k[3]?parseInt(k[3].slice(0,-1),10):0;return new D(x,E)}},D=COG.Duration=function(j,k){return{days:j?j:0,seconds:k?k:0}};COG.addDuration=function(){for(var j=new D,k=arguments.length;k--;){j.days+=
arguments[k].days;j.seconds+=arguments[k].seconds}if(j.seconds>=86400){j.days+=~~(j.seconds/86400);j.seconds%=86400}return j};COG.formatDuration=function(j){var k,x,E="";if(j.days)E=j.days+" days ";if(j.seconds){j=j.seconds;if(j>=3600){k=~~(j/3600);j-=k*3600}if(j>=60){x=Math.round(j/60);j-=x*60}if(k)E=E+k+(k>1?" hrs ":" hr ")+(x?(x>10?x:"0"+x)+" min ":"");else if(x)E=E+x+" min";else if(j>0)E=E+(j>10?j:"0"+j)+" sec"}return E};COG.parseDuration=function(j,k){var x=k?M[k]:null;if(x)return x(j);COG.Log.warn("Could not find duration parser for specified format: "+
k);return new D}})();COG.ObjectStore=function(){var P={},ha={},M="obj_"+(new Date).getTime(),D=0,j=Object.prototype.hasOwnProperty;return{add:function(k,x){var E;x=x?x:"default";if(k&&k.constructor)if(!j.call(k,"id"))k.id=M+ ++D;E=ha[x]?ha[x]:ha[x]=[];P[k.id]=E.length;E[k.length]=k}}};var CANI={};
(function(P){var ha=[],M=0,D=false,j=P.register=function(k,x){ha.push({section:k,run:x})};P.init=function(k){function x(){if(M<ha.length){var V=ha[M++];E[V.section]||(E[V.section]={});V.run(E[V.section],x)}else{for(V in E)P[V]=E[V];D=true;k&&k(P)}}var E={};if(D&&k)k(P);else{M=0;x()}};j("canvas",function(k,x){var E=document.createElement("canvas"),V=E.getContext("2d");E.width=200;E.height=200;k.pipTransformed=function(){var m;V.save();try{V.translate(50,50);V.beginPath();V.rect(0,0,20,20);m=V.isPointInPath(10,
10)}finally{V.restore()}return m}();x()})})(CANI);
INTERACT=function(){function P(y){return function(A,I,sa){(sa?sa:y?document.body:document).addEventListener(A,I,false)}}function ha(y){return function(A,I,sa){(sa?sa:y?document.body:document).removeEventListener(A,I,false)}}function M(y,A,I){(I?I:document).attachEvent("on"+y,A)}function D(y,A,I){(I?I:document).detachEvent("on"+y,A)}function j(y,A){return{x:y?y:0,y:A?A:0,count:1}}function k(y,A){H.push(COG.extend({handler:null,checks:{},type:y},A))}function x(y){var A=0,I=0;if(y.offsetParent){do{A+=
y.offsetLeft;I+=y.offsetTop;y=y.offsetParent}while(y)}return{x:A,y:I}}function E(y,A){return{source:y,target:A.target?A.target:A.srcElement}}function V(y,A){for(var I=y.target?y.target:y.srcElement;I&&I!==A&&I.nodeName&&I.nodeName.toUpperCase()!="CANVAS";)I=I.parentNode;return I&&I===A}function m(y,A){return{x:y.x-(A?A.x:0),y:y.y-(A?A.y:0)}}function K(y){if(y.preventDefault){y.preventDefault();y.stopPropagation()}else y.cancelBubble&&y.cancelBubble()}var H=[],N=function(y,A,I){function sa(oa,da,ua,
X){var ga=0,Ca=0,q=0;COG.tweenValue(0,oa,ua,X,function(za){q=ga;ga=za});COG.tweenValue(0,da,ua,X,function(za){ia.trigger("pan",ga-q,za-Ca);Ca=za})}I=COG.extend({binder:null,unbinder:null,observable:null},I);for(var ia=I.observable,ca=null,va=[],ba=[],ta,Aa,Ia={bind:function(){return ia.bind.apply(null,arguments)},pannable:function(oa){ca=COG.extend({inertia:true},oa);return Ia},unbind:function(){ia.unbind();for(var oa=0;oa<va.length;oa++)va[oa].unbind();return Ia}},Ga=0;Ga<A.length;Ga++)va.push(A[Ga](y,
ia,I));ia.bind("pointerDown",function(){ba=[];Aa=ta=0});ia.bind("pointerMove",function(oa,da,ua,X){if(ca){ba[ba.length]={ticks:(new Date).getTime(),x:X.x,y:X.y};ia.trigger("pan",X.x,X.y)}ta+=X.x?X.x:0;Aa+=X.y?X.y:0});ia.bind("pointerUp",function(oa,da,ua){if(Math.abs(ta)>20||Math.abs(Aa)>20){if(ca){ua=ba.length;var X,ga;da=0;for(ga=ba.length;--ga>1&&da<50;)da+=ba[ga].ticks-ba[ga-1].ticks;if(ua-ga>1){oa=ba[ua-1].x-ba[ga].x;X=ba[ua-1].y-ba[ga].y;ga=Math.sqrt(oa*oa+X*X)|0;if(ga>15){oa=ba[ua-1].x-ba[0].x;
X=ba[ua-1].y-ba[0].y;ga=Math.sqrt(oa*oa+X*X)|0;ua=Math.asin(X/ga);da=ga*500/da|0;da=da>300?300:da;sa(Math.cos(oa>0?ua:Math.PI-ua)*da,Math.sin(ua)*da,COG.easing("sine.out"),500)}}}}else ia.trigger("tap",da,ua)});return Ia};k("pointer",{handler:function(y,A,I){function sa(q){if(V(q,y))if(Ga=ba(q)){y.style.cursor="move";K(q);ga=q.pageX?q.pageX:q.screenX;Ca=q.pageY?q.pageY:q.screenY;oa=j(ga,Ca);da=x(y);A.triggerCustom("pointerDown",E("mouse",q),oa,m(oa,da))}}function ia(q){ua=q.pageX?q.pageX:q.screenX;
X=q.pageY?q.pageY:q.screenY;if(V(q,y))ta(q,Ga?"pointerMove":"pointerHover")}function ca(q){if(Ga&&ba(q)){Ga=false;if(V(q,y)){y.style.cursor="default";ta(q,"pointerUp")}}}function va(q){if(V(q,y)){var za;q=q||window.event;if(q.detail)za=q.axis===2?-q.detail*Aa:0;else{za=q.wheelDeltaY?q.wheelDeltaY:q.wheelDelta;if(window.opera)za=-za}if(za!==0){var pa=j(ua,X);A.triggerCustom("zoom",E("mouse",q),pa,m(pa,x(y)),za/Ia,"wheel");K(q);q.returnValue=false}}}function ba(q){q=q||window.event;return(q.which||
q.button)==1}function ta(q,za,pa,Va,Ja){pa=typeof pa!="undefined"?pa:ua;Va=typeof Va!="undefined"?Va:X;var U=pa-ga,ea=Va-Ca,Z=j(pa,Va);da||(da=x(y));A.triggerCustom(za,E("mouse",q),Z,m(Z,da),j(U,ea));if(typeof Ja=="undefined"||Ja){ga=pa;Ca=Va}}I=COG.extend({},I);var Aa=120,Ia=Aa*8,Ga=false,oa,da,ua,X,ga,Ca;I.binder("mousedown",sa,false);I.binder("mousemove",ia,false);I.binder("mouseup",ca,false);I.binder("dblclick",function(q){COG.info("captured double click");if(V(q,y)){var za=j(q.pageX?q.pageX:
q.screenX,q.pageY?q.pageY:q.screenY);COG.info("captured double click + target matched");A.triggerCustom("doubleTap",E("mouse",q),za,m(za,x(y)))}},false);I.binder("mousewheel",va,document);I.binder("DOMMouseScroll",va,document);return{unbind:function(){I.unbinder("mousedown",sa,false);I.unbinder("mousemove",ia,false);I.unbinder("mouseup",ca,false);I.unbinder("mousewheel",va,document);I.unbinder("DOMMouseScroll",va,document)}}},checks:{touch:false}});k("pointer",{handler:function(y,A,I){function sa(U){if(U.count<
2)return 0;var ea=U.x-U.next.x;U=U.y-U.next.y;return~~Math.sqrt(ea*ea+U*U)}function ia(U,ea,Z){ea=ea?ea:0;Z=Z?Z:0;for(var Ma={x:U.x-ea,y:U.y-Z,id:U.id,count:U.count},Wa=Ma;U.next;){U=U.next;Wa=Wa.next={x:U.x-ea,y:U.y-Z,id:U.id}}return Ma}function ca(U,ea){var Z=U[ea?ea:"touches"],Ma,Wa;if(Z.length===0)return null;Wa=Ma={x:Z[0].pageX,y:Z[0].pageY,id:Z[0].identifier,count:Z.length};for(var Oa=1,jb=Z.length;Oa<jb;Oa++)Wa=Wa.next={x:Z[Oa].pageX,y:Z[Oa].pageY,id:Z[Oa].identifier};return Ma}function va(U){if(V(U,
y)){X=x(y);var ea=ca(U,"changedTouches"),Z=ia(ea,X.x,X.y);if(!Ca){ga=oa;A.triggerCustom("pointerDown",E("touch",U),ea,Z)}Va&&A.triggerCustom("pointerDownMulti",E("touch",U),ea,Z);Ca=ca(U);if(Ca.count>1)za=sa(Ca);Ja=1;pa=ia(Ca)}}function ba(U){if(V(U,y)){U.preventDefault();q=ca(U);if(ga==oa)ga=Math.abs(Ca.x-q.x)>Ia||Math.abs(Ca.y-q.y)>Ia?Ga:oa;if(ga!=oa){ga=q.count>1?ua:da;if(ga==ua)if(Ca.count===1){Ca=ia(q);za=sa(Ca)}else{var ea=sa(q);if(Math.abs(za-ea)<Aa)ga=da;else{var Z;Z=q.x;var Ma=q.next.x,Wa=
q.y,Oa=q.next.y,jb=Wa<Oa?Wa:Oa;Z={x:(Z<Ma?Z:Ma)+(Math.abs(Z-Ma)>>1),y:jb+(Math.abs(Wa-Oa)>>1)};ea=ea/za;Ma=ea-Ja;A.triggerCustom("zoom",E("touch",U),Z,m(Z,X),Ma,"pinch");Ja=ea}}ga==da&&A.triggerCustom("pointerMove",E("touch",U),q,ia(q,X.x,X.y),j(q.x-pa.x,q.y-pa.y));Va&&A.triggerCustom("pointerMoveMulti",E("touch",U),q,ia(q,X.x,X.y))}pa=ia(q)}}function ta(U){if(V(U,y)){var ea=ca(U,"changedTouches"),Z=ia(ea,X.x,X.y);q=ca(U);if(!q){A.triggerCustom("pointerUp",E("touch",U),ea,Z);Ca=null}Va&&A.triggerCustom("pointerUpMulti",
E("touch",U),ea,Z)}}I=COG.extend({detailed:false,inertia:false},I);var Aa=20,Ia=7,Ga=0,oa=1,da=2,ua=3,X,ga,Ca,q,za,pa,Va=I.detailed,Ja=1;I.binder("touchstart",va,false);I.binder("touchmove",ba,false);I.binder("touchend",ta,false);COG.info("initialized touch handler");return{unbind:function(){I.unbinder("touchstart",va,false);I.unbinder("touchmove",ba,false);I.unbinder("touchend",ta,false)}}},checks:{touch:true}});return{register:k,watch:function(y,A,I){A=COG.extend({bindToBody:false,observable:null,
isIE:typeof window.attachEvent!="undefined",types:null},A);capabilities=COG.extend({touch:"ontouchstart"in window},I);if(!A.observable){COG.info("creating observable");A.observable=COG.observable({});globalOpts=A}A.binder=A.isIE?M:P(A.bindToBody);A.unbinder=A.isIE?D:ha(A.bindToBody);I=A.types;for(var sa=capabilities,ia=[],ca=H.length;ca--;){var va=H[ca],ba=!I||I.indexOf(va.type)>=0,ta=true;for(var Aa in va.checks){var Ia=va.checks[Aa];COG.info("checking "+Aa+" capability. require: "+Ia+", capability = "+
sa[Aa]);ta=ta&&Ia===sa[Aa]}if(ba&&ta)ia[ia.length]=va.handler}return new N(y,ia,A)}}}();var T5={};
(function(P){function ha(){return(new Date).getTime()}function M(){for(;Ma.length>0;){var b=Ma.shift();document.location=b}Z=0}function D(b){for(var n=true,h=Wa.length;h--;)n=n&&b!=Wa[h];return n}function j(b,n){var h=[];for(var d in n)d&&h.push(d+"="+escape(n[d]));return"tile5://"+b+"/"+(h.length>0?"?"+h.join("&"):"")}function k(b,n){D(b)&&COG.info("would push url: "+j(b,n))}function x(b,n){if(D(b)){Ma.push(j(b,n));Z||(Z=setTimeout(M,100))}}function E(b){return function(n,h,d){(d?d:b?document.body:
document).addEventListener(n,h,false)}}function V(b){return function(n,h,d){(d?d:b?document.body:document).removeEventListener(n,h,false)}}function m(b,n,h){(h?h:document).attachEvent("on"+b,n)}function K(b,n,h){(h?h:document).detachEvent("on"+b,n)}function H(){Ja={base:{name:"Unknown",bindEvent:E(),unbindEvent:V(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:k,targetFps:null},ie:{name:"MSIE",regex:/msie/i,
bindEvent:m,unbindEvent:K,requireFastDraw:false,targetFps:25},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:x,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:x},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:x},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:E(true),unbindEvent:V(true),supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},
bridgeNotify:x},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:x}};U=[Ja.froyo,Ja.android,Ja.ipod,Ja.iphone,Ja.ipad,Ja.ie]}function N(){Ja||H();if(!ea){COG.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var b=0;b<U.length;b++){var n=U[b];if(n.regex&&n.regex.test(navigator.userAgent)){ea=COG.extend({},Ja.base,n);COG.info("PLATFORM DETECTED AS: "+ea.name);break}}if(!ea){COG.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
ea=Ja.base}COG.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return ea}function y(){for(var b=0,n=arguments.length;n--;){var h=Hb[arguments[n].toUpperCase()];if(h)b|=h}return b}function A(b,n){var h,d;if(n&&n.width>0){if(!b.imageOffset)b.imageOffset=q.init(-n.width>>1,-n.height>>1);if(!b.bounds){h=b.xy.x+b.imageOffset.x;d=b.xy.y+b.imageOffset.y;b.bounds=pa.init(h,d,h+n.width,d+n.height)}}}function I(b){function n(){b.transformed=g!==1||d%sa!==0||s!==0||l!==0}var h=1E3/60|0,d=0,g=1,
s=0,l=0;COG.extend(b,{animate:function(v,C,r,z,B,R){var ma=(new Date).getTime(),na=b[v],W=C.length&&r.length&&C.length==r.length?C.length:0,t=Array(W),O=Array(W),$=COG.easing(z?z:"sine.out"),S=function(wa){wa=wa?wa:(new Date).getTime();if(wa-0>h){var db=wa-ma;wa=ma+B<=wa;for(var ja=W;ja--;)O[ja]=$(db,C[ja],t[ja],B);na.apply(b,O);b.invalidate.call(b);if(wa){na.apply(b,r);b.invalidate.call(b);R&&R()}else animFrame(S)}};if(na&&na.apply&&W>0){B=B?B:1E3;for(v=W;v--;)t[v]=r[v]-C[v];animFrame(S)}},rotate:function(v){d=
v;n()},scale:function(v){g=v;n()},translate:function(v,C){s=v;l=C;n()},transform:function(v,C,r){v.save();v.translate(b.xy.x-C+s,b.xy.y-r+l);d!==0&&v.rotate(d);g!==1&&v.scale(g,g)}})}window.animFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b){setTimeout(function(){b((new Date).getTime())},1E3/60)}}();var sa=Math.PI*2,ia=Math.PI/2,ca=Math.abs,va=Math.ceil,
ba=Math.min,ta=Math.max,Aa=Math.pow,Ia=Math.sqrt,Ga=Math.log,oa=Math.round,da=Math.sin,ua=Math.asin,X=Math.cos,ga=Math.atan,Ca=Math.atan2,q=function(){function b(d,g){return h(d.x-g.x,d.y-g.y)}function n(d,g){if(!g)g=d.length;if(g<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var s={edges:Array(g-1),accrued:Array(g-1),total:0},l=0;l<g-1;l++){var v=b(d[l],d[l+1]);s.edges[l]=Ia(v.x*v.x+v.y*v.y);s.accrued[l]=s.total+s.edges[l];s.total+=s.edges[l]}return s}
function h(d,g){return{x:d?d:0,y:g?g:0}}return{VECTOR_SIMPLIFICATION:3,SIMPLIFICATION_MIN_VECTORS:25,add:function(){for(var d=0,g=0,s=arguments.length;s--;){d+=arguments[s].x;g+=arguments[s].y}return h(d,g)},absSize:function(d){return ta(ca(d.x),ca(d.y))},copy:function(d){return d?h(d.x,d.y):null},diff:b,distance:function(d,g){return n(d,g).total},edges:n,equals:function(d,g){return d.x===g.x&&d.y===g.y},extendBy:function(d,g,s){var l=X(g)*s;g=da(g)*s;return h(d.x-l,d.y-g)},floor:function(d){for(var g=
Array(d.length),s=d.length;s--;)g[s]=h(~~d[s].x,~~d[s].y);return g},getRect:function(d){for(var g,s,l,v,C=d.length;C--;){var r=d[C];g=typeof g==="undefined"||r.x<g?r.x:g;s=typeof s==="undefined"||r.y<s?r.y:s;l=typeof l==="undefined"||r.x>l?r.x:l;v=typeof v==="undefined"||r.y>v?r.y:v}return pa.init(g,s,l,v)},init:h,invert:function(d){return h(-d.x,-d.y)},min:function(d,g){return h(d.x<g.x?d.x:g.x,d.y<g.y?d.y:g.y)},max:function(d,g){return h(d.x>g.x?d.x:g.x,d.y>g.y?d.y:g.y)},offset:function(d,g,s){return h(d.x+
g,d.y+(s?s:g))},scale:function(d,g){return h(d.x/g|0,d.y/g|0)},simplify:function(d,g){if(!d)return null;g=g?g:q.VECTOR_SIMPLIFICATION;for(var s=[],l=null,v=d.length;v--;){var C=d[v];if(include=!l||v===0||ca(C.x-l.x)+ca(C.y-l.y)>g){s.unshift(C);l=C}}return s},theta:function(d,g,s){s=ua((d.y-g.y)/s);return d.x>g.x?s:Math.PI-s},toString:function(d){return d?d.x+", "+d.y:""}}}(),za=function(){return{dotProduct:function(b,n){return b.x*n.x+b.y*n.y}}}(),pa=function(){function b(h){return n(h.x1,h.y1,h.x2,
h.y2)}function n(h,d,g,s){h=h?h:0;d=d?d:0;g=typeof g!=="undefined"?g:h;s=typeof s!=="undefined "?s:s;return{x1:h,y1:d,x2:g,y2:s,width:g-h,height:s-d}}return{center:function(h){return q.init(h.x1+(h.width>>1),h.y1+(h.height>>1))},copy:b,diagonalSize:function(h){return Ia(h.width*h.width+h.height*h.height)},fromCenter:function(h,d,g,s){g=g>>1;s=s>>1;return n(h-g,d-s,h+g,d+s)},init:n,intersect:function(h,d){var g=ta(h.x1,d.x1),s=ta(h.y1,d.y1),l=ba(h.x2,d.x2),v=ba(h.y2,d.y2);g=n(g,s,l,v);return g.width>
0&&g.height>0?g:null},toString:function(h){return h?"["+h.x1+", "+h.y1+", "+h.x2+", "+h.y2+"]":""},union:function(h,d){if(h.width===0||h.height===0)return b(d);else if(d.width===0||d.height===0)return b(h);else{var g=ba(h.x1,d.x1),s=ba(h.y1,d.y1),l=ta(h.x2,d.x2),v=ta(h.y2,d.y2);g=n(g,s,l,v);return g.width>0&&g.height>0?g:null}}}}(),Va=function(){return{getAspectRatio:function(b){return b.height!==0?b.width/b.height:1},getCenter:function(b){return q.init(b.width>>1,b.height>>1)},getSize:function(b){return Ia(Aa(b.width,
2)+Aa(b.height,2))},init:function(b,n){b=b?b:0;return{width:b,height:n?n:b}}}}();Hits=function(){return{diffHits:function(b,n){var h=[],d={},g;for(g=n.length;g--;)d[n[g].target.id]=true;for(g=b.length;g--;)d[b[g].target.id]||(h[h.length]=b[g]);return h},init:function(b,n,h,d){return{type:b,x:d.x|0,y:d.y|0,elements:[],absXY:n,relXY:h}},initHit:function(b,n,h){return h=COG.extend({type:b,target:n,drag:false},h)},triggerEvent:function(b,n,h,d){n.triggerCustom(b.type+(h?h:"Hit"),{hitType:b.type},d?d:
b.elements,b.absXY,b.relXY,q.init(b.x,b.y))}}}();var Ja=null,U=[],ea=null,Z=0,Ma=[],Wa=["view.wake","tile.loaded"],Oa=function(){function b(){var t=N().maxImageLoads;if(!t||z.length<t){var O=r.shift();t=T5.ticks();if(O){z[z.length]=O;O.image.onload=h;O.image.src=O.url;O.requested=t}if(t-ma>s){O=false;for(var $=0,S=N();$<z.length;)if(t-z[$].requested>W.loadTimeout*1E3){z.splice($,1);O=true}else $++;O&&b();if(S&&S.imageCacheMaxSize){R=B.length*W.avgImageSize/S.imageCacheMaxSize;R>=1&&n()}ma=t}}}function n(){na=
true;try{var t=B.length>>1;if(t>0){B.sort(function($,S){return $.created-S.created});for(var O=t;O--;)delete l[B[O].url];B.splice(0,t)}}finally{na=false}W.trigger("cacheCleared")}function h(){var t=v[this.id],O;if(t&&t.image.complete&&t.image.width>0){t.loaded=true;t.hitCount=1;for(O=z.length;O--;)if(z[O].image.src==this.src){z.splice(O,1);break}if(t.background||t.postProcess||t.drawBackground||t.customDraw)if(t.image){globalImageData=t;O=g(t.realSize?t.realSize.width:t.image.width,t.realSize?t.realSize.height:
t.image.height);var $=O.getContext("2d"),S=t.offset?t.offset:T5.XY.init();t.background&&$.drawImage(t.background,0,0);t.drawBackground&&t.drawBackground($);t.customDraw?t.customDraw($,t):$.drawImage(t.image,S.x,S.y);t.postProcess&&t.postProcess($,t);t.image=O}for(O=t.callbacks.length;O--;)t.callbacks[O]&&t.callbacks[O](this,false);t.callbacks=[];B[B.length]={url:this.src,created:t.requested};delete v[this.id];b()}}function d(t,O,$){var S=l[t];if(S){S.hitCount++;S.image.complete&&S.image.width>0&&
O?O(S.image,true):S.callbacks.push(O)}else{S=COG.extend({url:t,image:new Image,loaded:false,created:T5.ticks(),requested:null,hitCount:0,callbacks:[O]},$);S.image.id="resourceLoaderImage"+C++;l[t]=S;v[S.image.id]=S;r[r.length]=S;b()}return S}function g(t,O){var $=document.createElement("canvas");COG.info("creating new canvas");$.width=t?t:0;$.height=O?O:0;if(typeof FlashCanvas!="undefined"){document.body.appendChild($);FlashCanvas.initElement($)}return $}var s=1E4,l={},v={},C=0,r=[],z=[],B=[],R=0,
ma=0,na=false,W={avgImageSize:25,loadTimeout:10,cancelLoad:function(){var t;for(t=z.length;t--;)delete l[z[t].url];z=[];for(t=r.length;t--;)delete l[r[t].url];r=[]},get:function(t,O,$){var S=null,wa=null;na||(S=l[t]);if((wa=S?S.image:null)&&(wa.getContext||wa.complete&&wa.width>0))return wa;else O&&d(t,O,$);return null},load:d,newCanvas:g,reset:function(){l={}},stats:function(){return{imageLoadingCount:z.length,queuedImageCount:r.length,imageCacheFullness:R}}};COG.observable(W);return W}(),jb=function(){var b=
{};return{init:function(n,h){var d=b[n];if(!d)throw Error("Unable to locate requested generator: "+n);return new d(h)},register:function(n,h){b[n]=h},Template:function(){}}}(),nb=function(){function b(l,v){g[l]=h(v);return l}function n(l){for(var v in l)b(v,l[v])}function h(l){function v(B){var R=l[B];typeof R!=="undefined"&&r.push(function(ma){ma[B]=R})}function C(){r=[];for(var B in l)v(B)}l=COG.extend({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,
fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},l);var r=[],z={applyToContext:function(B){for(var R=r.length;R--;)r[R](B)},update:function(B,R){l[B]=R;C()}};C();return z}var d={},g={},s={apply:function(l,v){var C=g[v]?g[v]:g.basic,r;if(l&&l.canvas){r=d[l.canvas.id];d[l.canvas.id]=v}C.applyToContext(l);return r},define:b,defineMany:n,get:function(l){return g[l]},init:h,load:function(l){COG.jsonp(l,function(v){n(v)})}};n({basic:{lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"},
waypoints:{lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"},waypointsHover:{lineWidth:4,strokeStyle:"#f00",fillStyle:"#FFF"}});return s}(),Hb={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,ZOOM:16,FREEZE:128},Fb=function(b){function n(u,w,G){Ya||Pa(xa-w,e-G)}function h(u,w,G,ka){ja(ba(ta(Ha+Aa(2,ka)-1,0.5),2))}function d(){var u=Ga(Ha)/Math.LN2|0;if(u!==0){Ha=Aa(2,u);eb(ob+u,pb,qb)}S()}function g(u){u||(u=q.init(Ba,T));Q=q.init(xa,e);Y=q.offset(u,xa,e);pb=Y.x;qb=Y.y}function s(u,w){var G=1/Ha;
return q.init(fa.x1+u*G,fa.y1+w*G)}function l(u,w,G){fb("doubleTap",w,G,s(G.x,G.y));b.scalable&&ja(2,G,b.zoomEasing,null,b.zoomDuration)}function v(u,w,G){Ya=null;$("down",w,G)}function C(u,w,G){$("hover",w,G)}function r(u,w,G){t(w,G,false)}function z(u,w,G){t(w,G,true)}function B(){clearTimeout(Cb);Cb=setTimeout(ma,250)}function R(u,w,G){$("tap",w,G);fb("tap",w,G,s(G.x,G.y,true))}function ma(u,w){var G;kb=typeof FlashCanvas!=="undefined";COG.info("is flash = "+kb);if(Ea){if(b.autoSize&&Ea.parentNode){u=
Ea.parentNode.offsetWidth;w=Ea.parentNode.offsetHeight}try{if(!Ea.id)Ea.id=b.id+"_canvas";Ka=Ea.getContext("2d")}catch(ka){COG.exception(ka);throw Error("Could not initialise canvas on specified view element");}if(u&&w&&(Qa!==w||Ra!==u)){tb=true;Ra=u;Qa=w;Ba=Ra>>1;T=Qa>>1;Fa.trigger("resize",Ra,Qa);for(G=Na;G--;)la[G].trigger("resize",Ra,Qa)}for(G=Na;G--;)la[G].trigger("contextChanged",Ka);S();W()}}function na(u,w){w.setId(u);w.added=ha();w.bind("remove",function(){Fa.removeLayer(u)});w.trigger("contextChanged",
Ka);w.setParent(Fa);la.push(w);la.sort(function(G,ka){var qa=ka.zindex-G.zindex;if(qa===0)qa=ka.added-G.added;return qa});Na=la.length;return w}function W(){Xa&&Xa.unbind();Xa=INTERACT.watch(Ea);b.pannable&&Xa.pannable().bind("pan",n);if(b.scalable){Xa.bind("zoom",h);Xa.bind("doubleTap",l)}Xa.bind("pointerDown",v);Xa.bind("pointerMove",r);Xa.bind("pointerUp",z);b.captureHover&&Xa.bind("pointerHover",C);Xa.bind("tap",R)}function t(u,w,G){if(Ya){u=s(w.x,w.y);Ya.drag.call(Ya.target,Ya,u.x,u.y,G)&&S();
if(G)Ya=null}}function O(u){var w,G,ka=false;if(ub|kb){u=u?u:(new Date).getTime();G=xa!==i||e!==o;bb=Db|(Ha!==1?Eb:0)|(G?vb:0)|(wb?xb:0);ra=(w=(bb&(Eb|vb))!==0)&&(bb&xb)===0;if(tb&&Ea){kb&&FlashCanvas.initElement(Ea);Ea.width=Ra;Ea.height=Qa;Ea.style.width=Ra+"px";Ea.style.height=Qa+"px";tb=false}J=wa();for(G=Na;G--;){bb|=la[G].animated?xb:0;la[G].cycle(u,J,bb);ka=la[G].clip||ka}G=bb;var qa=J;ka=F&&ka&&!w;w=u;var La;pa.center(qa);var Sa=0,Ta;if(Ha!==1){Ta=1/Ha;pb=Y.x+(xa-Q.x);qb=Y.y+(e-Q.y);Ta=qa?
pa.fromCenter(pb>>0,qb>>0,qa.width*Ta>>0,qa.height*Ta>>0):void 0}else Ta=pa.copy(qa);fa=Ta;ka||Ka.clearRect(0,0,Ra,Qa);fa.scaleFactor=Ha;Ka.save();try{Ha!==1&&Ka.scale(Ha,Ha);Za=ya=null;if(ka){Ka.beginPath();for(Sa=Na;Sa--;)la[Sa].clip&&la[Sa].clip(Ka,fa,G,Fa,w);Ka.closePath();Ka.clip()}Ka.globalCompositeOperation="source-over";for(Sa=Na;Sa--;){La=la[Sa];if(La.shouldDraw(bb,J)){var Ua=La.style,gb=Ua?nb.apply(Ka,Ua):null;La.draw(Ka,fa,G,Fa,w,L);gb&&nb.apply(Ka,gb)}}}finally{Ka.restore()}ub=0;fb("drawComplete",
qa,w);if(L){La=L?L.elements:[];if(hb&&hb.type==="hover"){Ua=Hits.diffHits(hb.elements,La);Ua.length>0&&Hits.triggerEvent(hb,Fa,"Out",Ua)}if(La.length>0){gb=L.x;G=L.y;for(Ua=La.length;Ua--;){qa=La[Ua];ka=gb;w=G;if(Sa=qa&&qa.drag&&(!qa.canDrag||qa.canDrag(qa,ka,w))){Ya=qa;Ya.startX=ka;Ya.startY=w}if(Sa)break}Hits.triggerEvent(L,Fa)}hb=La.length>0?COG.extend({},L):null;L=null}u-ab>yb&&db();Ib=u;i=xa;o=e;animFrame(O)}else aa=false}function $(u,w,G){L=Hits.init(u,w,G,s(G.x,G.y,true));for(u=Na;u--;)cb=
cb||(la[u].hitGuess?la[u].hitGuess(L.x,L.y,bb,Fa):false);cb&&S()}function S(){ub+=1;if(!aa){aa=true;animFrame(O)}}function wa(){return pa.init(xa,e,xa+Ra,e+Qa)}function db(){if(p||a){var u=c?xa+Ba:xa,w=f?e+T:e;if(p&&p>Ra)if(u+Ra>p)xa=c?u-p>0?xa-p:xa:p-Ra;else if(u<0)xa=c?xa+p:0;if(a&&a>Qa)if(w+Qa>a)e=f?w-a>0?e-a:e:a-Qa;else if(w<0)e=f?e+a:0}ab=(new Date).getTime();fb("refresh",Fa,wa());S()}function ja(u,w,G,ka,qa){if(G)COG.tweenValue(Ha,u,G,qa,function(La,Sa){Ha=La;if(Sa){var Ta=oa(Ga(Ha)/Math.LN2);
Ha=Aa(2,Ta);ka&&ka()}g(w);d()});else{Ha=u;g(w);d()}return Fa}function eb(u,w,G){u=ta(b.minZoom,ba(b.maxZoom,u));if(u!==ob){var ka=Aa(2,u-ob),qa=Ba/ka|0,La=T/ka|0;ob=u;Pa(((w?w:xa+Ba)-qa)*ka,((G?G:e+T)-La)*ka);i=xa;o=e;fb("zoomLevelChange",u);Ha=1;db()}}function fb(){for(var u=Fa.trigger.apply(null,arguments).cancel,w=la.length;w--;)u=la[w].trigger.apply(null,arguments).cancel||u;return!u}function Pa(u,w,G,ka,qa){function La(){Sa+=1;if(Sa>=2){wb=false;qa&&qa()}}var Sa=0,Ta=ya?q.offset(ya,-Ba,-T):null,
Ua=Za?q.offset(Za,-Ba,-T):null;if(Ta){u=u<Ta.x?Ta.x:u;w=w<Ta.y?Ta.y:w}if(Ua){u=u>Ua.x?Ua.x:u;w=w>Ua.y?Ua.y:w}if(G){if((bb&vb)===0){COG.tweenValue(xa,u,G,ka,function(gb,zb){xa=gb|0;(zb?La:S)();return!ra});COG.tweenValue(e,w,G,ka,function(gb,zb){e=gb|0;(zb?La:S)();return!ra});wb=true}}else{xa=u|0;e=w|0;S();qa&&qa()}}b=COG.extend({id:COG.objId("view"),container:"",captureHover:true,captureDrag:false,fastDraw:false,inertia:true,minRefresh:1E3,pannable:false,clipping:true,scalable:false,panAnimationEasing:COG.easing("sine.out"),
panAnimationDuration:750,pinchZoomAnimateTrigger:400,autoSize:true,tapExtent:10,guides:false,turbo:false,fps:25,minZoom:1,maxZoom:1,zoomEasing:COG.easing("quad.out"),zoomDuration:300,zoomLevel:1},b);var la=[],Na=0,Ea=document.getElementById(b.container),Ya=null,Ka=null,Ab=typeof window.attachEvent!="undefined",kb,cb=false,yb=b.minRefresh,xa=0,e=0,i=0,o=0,p=null,a=null,c=false,f=false,F=b.clipping,J=null,aa=false,fa,Da=1,Ba=0,T=0,L=null,Q=null,Y=null,ra=false,ya=null,Za=null,ab=0,hb=null,Cb=0,Ha=1,
Ib=0,tb=false,Xa=null,wb=false,Qa,Ra,ub=0,pb,qb,ob=b.zoomLevel,Db=y("ACTIVE"),vb=y("PAN"),Eb=y("ZOOM"),xb=y("ANIMATING"),bb=Db,Fa={id:b.id,deviceScaling:Da,fastDraw:b.fastDraw||N().requireFastDraw,detach:function(){Xa&&Xa.unbind()},eachLayer:function(u){for(var w=Na;w--;)u(la[w])},getDimensions:function(){return Va.init(Ra,Qa)},getLayer:function(u){for(var w=0;w<Na;w++)if(la[w].getId()==u)return la[w];return null},getZoomLevel:function(){return ob},setLayer:function(u,w){for(var G=0;G<Na;G++)if(la[G].getId()===
u){la.splice(G,1);break}if(w){na(u,w);w.trigger("refresh",Fa,wa())}S();return w},invalidate:S,refresh:db,resetScale:function(){Ha=1},resize:function(u,w){if(Ea){b.autoSize=false;if(Ra!==u||Qa!==w)ma(u,w)}},scale:ja,setZoomLevel:eb,syncXY:function(){},triggerAll:fb,removeLayer:function(u){a:{for(var w=Na;w--;)if(la[w].getId()==u){u=w;break a}u=-1}if(u>=0&&u<Na){Fa.trigger("layerRemoved",la[u]);la.splice(u,1);S()}Na=la.length},getOffset:function(){return q.init(xa,e)},setMaxOffset:function(u,w,G,ka){p=
u;a=w;c=typeof G!="undefined"?G:false;f=typeof ka!="undefined"?ka:false},getViewRect:wa,updateOffset:Pa,pan:function(u,w,G,ka,qa){Pa(xa+u,e+w,G,ka,qa)}};Da=N().getScaling();COG.observable(Fa);Fa.bind("invalidate",function(){S()});Fa.bind("resync",function(){Za=ya=null});COG.configurable(Fa,["container","captureHover","captureDrag","scalable","pannable","inertia","minZoom","maxZoom","zoom"],COG.paramTweaker(b,null,{container:function(u,w){Ea=document.getElementById(w);ma()},inertia:W,captureHover:W,
scalable:W,pannable:W}),true);CANI.init(function(u){Fa.markers=na("markers",new rb({zindex:20}));canvasCaps=u.canvas;ma();if(b.autoSize)Ab?window.attachEvent("onresize",B):window.addEventListener("resize",B,false)});return Fa},Bb=function(b){b=COG.extend({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:y("ACTIVE","ANIMATING","PAN","ZOOM"),style:null,minXY:null,maxXY:null},b);var n=null,h=false,d=false,g=b.id,s=y("ACTIVE"),l=b.validStates,v=0,C=0,r=COG.extend({addToView:function(z){z.setLayer(g,
r)},shouldDraw:function(z){return(z&l)!==0},clip:null,cycle:function(){},draw:function(){},hitGuess:null,remove:function(){r.trigger("remove",r)},changed:function(){d=true;n&&n.invalidate()},hitTest:null,getId:function(){return g},setId:function(z){g=z},getParent:function(){return n},setParent:function(z){h=(n=z)?n.fastDraw&&displayState!==s:false;r.trigger("parentChange",n)}},b);COG.observable(r);r.bind("drawComplete",function(z,B){d=false;v=B.x1;C=B.y1});r.bind("resync",function(z,B){r.minXY&&B.syncXY(r.minXY);
r.maxXY&&B.syncXY(r.maxXY)});return r},ib=function(b){b=COG.extend({style:null,xy:null,size:null,fill:false,stroke:true,draggable:false,observable:true,properties:{},type:"shape",transformable:false},b);COG.extend(this,b);this.id=COG.objId(this.type);this.bounds=null;this.observable&&COG.observable(this);this.transformable&&I(this);this.transformed=false};ib.prototype={constructor:ib,drag:null,draw:function(b){this.fill&&b.fill();this.stroke&&b.stroke()},invalidate:function(){var b=this.layer?this.layer.getParent():
null;b&&b.invalidate()},prepPath:function(){},resync:function(b){if(this.xy){b.syncXY([this.xy]);this.size&&this.updateBounds(pa.fromCenter(this.xy.x,this.xy.y,this.size,this.size))}},setTransformable:function(b){b&&!this.transformable&&I(this);this.transformable=b},updateBounds:function(b,n){this.bounds=b;if(n)this.xy=pa.center(this.bounds)}};var lb=function(b,n){n=COG.extend({simplify:false},n);var h=false,d=n.simplify;y("ZOOM");var g=[];n.type=n.fill?"polygon":"line";ib.call(this,n);COG.extend(this,
{animatePath:function(){},prepPath:function(s,l,v){if(h){var C=true;s.beginPath();for(var r=g.length;r--;){var z=g[r].x-l,B=g[r].y-v;if(C){s.moveTo(z,B);C=false}else s.lineTo(z,B)}}return h},resync:function(s){var l,v,C,r,z;s.syncXY(b);g=q.floor(d?q.simplify(b):b);for(var B=g.length;B--;){s=g[B].x;l=g[B].y;r=typeof r=="undefined"||s<r?s:r;z=typeof z=="undefined"||l<z?l:z;v=typeof v=="undefined"||s>v?s:v;C=typeof C=="undefined"||l>C?l:C}this.updateBounds(pa.init(r,z,v,C),true)}});h=b&&b.length>=2};
lb.prototype=COG.extend(ib.prototype,{constructor:lb});var Gb=function(b,n){n.fill=false;lb.call(this,b,n)};Gb.prototype=new lb;var mb=function(b){function n(C){if(this.imageUrl=C)l=Oa.get(this.imageUrl,function(r){var z=v.layer?v.layer.getParent():null;l=r;z&&z.invalidate()})}b=COG.extend({image:null,imageUrl:null,imageOffset:null},b);var h=null,d=ib.prototype.updateBounds,g,s,l=b.image;ib.call(this,b);var v=COG.extend(this,{changeImage:n,drag:function(C,r,z,B){h||(h=q.init(C.startX-this.xy.x,C.startY-
this.xy.y));this.xy.x=r-h.x;this.xy.y=z-h.y;if(B){h=null;if(this.layer)(C=this.layer.getParent())&&C.syncXY([this.xy],true);this.trigger("dragDrop")}return true},draw:function(C){C.drawImage(l,g,s)},prepPath:function(C,r,z){var B=l&&l.width>0;if(B){A(this,l);g=this.xy.x+this.imageOffset.x-r;s=this.xy.y+this.imageOffset.y-z;C.beginPath();C.rect(g,s,l.width,l.height)}return B},updateBounds:function(C,r){d.call(this,C,r);A(this,l)}});l||n(this.imageUrl)};mb.prototype=new ib;mb.prototype.constructor=
mb;var sb=function(b){b=COG.extend({imageAnchor:null},b);if(b.imageAnchor)b.imageOffset=q.invert(b.imageAnchor);mb.call(this,b)};sb.prototype=new mb;sb.prototype.constructor=sb;var rb=function(b){function n(l){for(var v=d.length;v--;)d[v].resync(l);d.sort(function(C,r){var z=r.xy.y-C.xy.y;return z!=0?z:r.xy.x-C.xy.y});s.changed()}function h(l,v){n(v)}b=COG.extend({zindex:10},b);var d=[],g=CANI.canvas.pipTransformed,s=COG.extend(new Bb(b),{add:function(l,v){if(l){l.layer=s;var C=s.getParent();if(C){l.resync(s.getParent());
C.invalidate()}if(v)d.unshift(l);else d[d.length]=l}},clear:function(){d=[]},draw:function(l,v,C,r,z,B){r=v.x1;z=v.y1;var R=B?g?B.x-r:B.relXY.x:0,ma=B?g?B.y-z:B.relXY.y:0,na=v.width;v=v.height;for(var W=d.length;W--;){var t=d[W],O=t.style,$,S=t.transformed;if(S){t.transform(l,r,z);if(g){R-=t.xy.x;ma-=t.xy.y}}if(t.prepPath(l,S?t.xy.x:r,S?t.xy.y:z,na,v,C)){if(B&&l.isPointInPath(R,ma)){B.elements.push(Hits.initHit(t.type,t,{drag:t.draggable?t.drag:null}));$=B.type+"Style";O=t[$]||s[$]||O}O=O?nb.apply(l,
O):null;t.draw(l,r,z,na,v,C);O&&nb.apply(l,O)}S&&l.restore()}},find:function(){return[].concat(d)},hitGuess:function(l,v){for(var C=false,r=d.length;!C&&r--;){var z=d[r].bounds;C=C||z&&l>=z.x1&&l<=z.x2&&v>=z.y1&&v<=z.y2}return C}});s.bind("parentChange",h);s.bind("resync",h);return s},Jb=function(){return{tileSize:256,init:function(b,n,h,d,g){return COG.extend({x:b,y:n,width:h,height:d},g)}}}();COG.extend(P,{ex:COG.extend,ticks:ha,getConfig:N,userMessage:function(b,n,h){P.trigger("userMessage",b,
n,h)},XY:q,XYRect:pa,Dimensions:Va,Vector:za,Hits:Hits,Images:Oa,Generator:jb,tween:COG.tween,tweenValue:COG.tweenValue,easing:COG.easing,Tween:COG.Tween,Style:nb,viewState:y,View:Fb,ViewLayer:Bb,ImageLayer:function(b,n){function h(r,z,B){for(z=l.length;z--;){var R=l[z],ma=R.x,na=R.y,W=pa.init(R.x,R.y,R.x+R.width,R.y+R.height);if(B&&pa.intersect(r,W))(W=Oa.get(R.url,function(){C.changed()},v))&&B(W,ma,na,R.width,R.height)}}function d(r){var z=++s,B=C.getParent();g&&g.run(B,r,function(R){if(z==s){l=
[].concat(R);B.invalidate()}})}n=COG.extend({imageLoadArgs:{}},n);var g=b?jb.init(b,n):null,s=0,l=[],v=n.imageLoadArgs,C=COG.extend(new Bb(n),{changeGenerator:function(r,z){g=jb.init(r,COG.extend({},n,z));l=null;d(C.getParent().getViewRect())},clip:function(r,z,B){var R=z.x1,ma=z.y1;h(z,B,function(na,W,t,O,$){r.rect(W-R,t-ma,O,$)})},draw:function(r,z,B){var R=z.x1,ma=z.y1;h(z,B,function(na,W,t){r.drawImage(na,W-R,t-ma,na.width,na.height)})},mask:function(r,z,B){h(z,B,function(R,ma,na,W,t){COG.info("clearing rect @ x = "+
ma+", y = "+na+", width = "+W+", height = "+t);r.clearRect(ma,na,W,t)})}});C.bind("refresh",function(r,z,B){d(B)});C.bind("tap",function(r,z,B,R){r=[];var ma=R.x,na=R.y,W,t;if(l)for(var O=l.length;O--;){W=l[O];if(t=ma>=W.x&&ma<=W.x+W.width&&na>=W.y&&na<=W.y+W.height)r[r.length]=W}r.length>0&&C.trigger("tapImage",r,z,B,R)});return C},ImageGenerator:function(b){b=COG.extend({relative:false,padding:2},b);b={run:function(){COG.warn("running base generator - this should be overriden")}};COG.observable(b);
return b},Drawable:ib,Poly:lb,Line:Gb,ImageDrawable:mb,ImageMarker:sb,ShapeLayer:rb,transformable:I,Tiling:Jb});COG.observable(P);var $a=P.Geo=function(){function b(e){for(var i=null,o=1;!i&&o<arguments.length;o++)i=s(e,arguments[o]);i=i?i:s(e);if(!i)throw Error("Unable to find GEO engine with "+e+" capability");return i}function n(e){e=parseFloat(e)*B;e=da(e);var i=O*e;return Ga((1+e)/(1-e)*Aa((1-i)/(1+i),O))/2}function h(e){return parseFloat(e)*B}function d(e){e=Aa(Math.E,-e);for(var i=ia-2*ga(e),
o=l(i,e),p=0;p<S&&ca(i-o)>$;){i=o;o=l(i,e);p++}return o*R}function g(e){return e%360*R}function s(e,i){var o=null;for(var p in la)if(i){if(p==i&&la[p][e]){o=la[p];break}}else if(la[p][e]){o=la[p];break}return o}function l(e,i){var o=O*da(e);return ia-2*ga(i*Aa((1-o)/(1+o),O/2))}function v(e,i,o,p){i=C(i);e.add(p(i,o));return i.length}function C(e){var i=e?e.length:0,o=Array(i);for(i=i;i--;)o[i]=$a.Position.init(e[i][1],e[i][0]);return $a.Position.vectorize(o,kb)}function r(e,i,o){return new xa(e,
i,o)}var z=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],B=Math.PI/180,R=180/Math.PI,ma=ia,na=-ma,W=sa,t=-W,O=0.08181919084262157,$=1.0E-7,S=12,wa=null,db={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",HWY:"HIGHWAY",MWY:"MOTORWAY"},ja=function(){function e(a){return a?o(a.lat,a.lon):null}function i(a){return!a||a.lat===0&&a.lon===0}function o(a,c){return{lat:parseFloat(a?a:0),lon:parseFloat(c?c:0)}}function p(a){if(a)if(typeof a.lat!==
"undefined")return e(a);else{if(a.split)for(var c=[" ",","],f=0;f<c.length;f++){var F=a.split(c[f]);if(F.length===2)return o(F[0],F[1])}}else return o();return null}return{calcDistance:function(a,c){if(i(a)||i(c))return 0;var f=(c.lat-a.lat)*B>>1,F=(c.lon-a.lon)*B>>1;f=da(f)*da(f)+X(a.lat*B)*X(c.lat*B)*da(F)*da(F);return 6371*2*Ca(Ia(f),Ia(1-f))},copy:e,empty:i,equal:function(a,c){return a&&c&&a.lat==c.lat&&a.lon==c.lon},fromMercatorPixels:function(a,c){return o(d(c),g(a))},generalize:function(a,
c,f){var F=a.length,J=[],aa=null;f||(f=250);f/=1E3;COG.info("generalizing positions, must include "+c.length+" positions");for(var fa=F;fa--;)if(fa===0)J.unshift(a[fa]);else{var Da=!aa||ja.inArray(a[fa],c)?f:ja.calcDistance(aa,a[fa]);if(a[fa]&&Da>=f){J.unshift(a[fa]);aa=a[fa]}}COG.info("generalized "+F+" positions into "+J.length+" positions");return J},inArray:function(a,c){for(var f=ja.equal,F=c.length;F--;)if(f(a,c[F]))return true;return false},inBounds:function(a,c){var f=!(ja.empty(a)||ja.empty(c));
return f=(f=f&&a.lat>=c.min.lat&&a.lat<=c.max.lat)&&a.lon>=c.min.lon&&a.lon<=c.max.lon},init:o,offset:function(a,c,f){var F=a.lat*B;a=a.lon*B;c=F+c/6371;f=ua(da(f/6371)/X(F));f=a+f;c=(c+ia)%Math.PI-ia;f%=sa;return o(c*R,f*R)},parse:p,parseArray:function(a){var c=a.length,f=Array(c);for(c=c;c--;)f[c]=p(a[c]);return f},toMercatorPixels:function(a){return T5.XY.init(h(a.lon),n(a.lat))},toString:function(a){return a?a.lat+" "+a.lon:""},vectorize:function(a,c){function f(){for(var fa=0,Da=c.chunkSize,
Ba=F;Ba--;){J[Ba]=T5.GeoXY.init(a[Ba]);fa+=1;if(fa>Da)break}F=Ba;if(F<=0)c.callback&&c.callback(J);else animFrame(f)}var F=a.length,J=Array(F);c=COG.extend({chunkSize:500,async:true,callback:null},c);if(!c.async){for(var aa=F;aa--;)J[aa]=T5.GeoXY.init(a[aa]);return J}animFrame(f);return null}}}(),eb=function(){function e(a,c,f){var F=T5.XY.init(0,c.lat-a.lat);if(typeof f==="undefined")f=true;F.x=f&&a.lon>c.lon?360-a.lon+c.lon:c.lon-a.lon;return F}function i(a,c){return eb.init(ja.init(a.min.lat-c,
a.min.lon-c%360),ja.init(a.max.lat+c,a.max.lon+c%360))}function o(a){var c=e(a.min,a.max);return ja.init(a.min.lat+(c.y>>1),a.min.lon+(c.x>>1))}function p(a,c){return{min:ja.parse(a),max:ja.parse(c)}}return{calcSize:e,createBoundsFromCenter:function(a,c){var f=c/6371,F=a.lat*B,J=a.lon*B,aa=F-f,fa=F+f;if(aa>na&&fa<ma){F=ua(da(f)/X(F));f=(J-F)%sa;J=(J+F)%sa}else{aa=ta(aa,na);fa=ba(fa,ma);f=t;J=W}return eb.init(ja.init(aa*R,f*R),ja.init(fa*R,J*R))},expand:i,forPositions:function(a,c){var f=null,F=T5.ticks();
c||(c="auto");for(var J=a.length;J--;)if(f){var aa=e(f.min,a[J],false),fa=e(a[J],f.max,false);if(aa.x<0)f.min.lon=a[J].lon;if(aa.y<0)f.min.lat=a[J].lat;if(fa.x<0)f.max.lon=a[J].lon;if(fa.y<0)f.max.lat=a[J].lat}else f=p(a[J],a[J]);if(c){if(c=="auto"){J=e(f.min,f.max);c=ta(J.x,J.y)*0.3}f=i(f,c)}COG.trace("calculated bounds for "+a.length+" positions",F);return f},getCenter:o,getGeoHash:function(a){var c=T5.Geo.GeoHash.encode(a.min.lat,a.min.lon);a=T5.Geo.GeoHash.encode(a.max.lat,a.max.lon);COG.info("min hash = "+
c+", max hash = "+a)},getZoomLevel:function(a,c){var f=o(a);f=ba(oa(ca(f.lat)*0.05),z.length);var F=z[f],J=e(a.min,a.max);f=va(Ga(z[3]*c.height/J.y)/Ga(2));F=va(Ga(F*c.width/J.x)/Ga(2));return ba(isNaN(f)?1E3:f,isNaN(F)?1E3:F)},init:p,isEmpty:function(a){return!a||ja.empty(a.min)||ja.empty(a.max)},toString:function(a){return"min: "+ja.toString(a.min)+", max: "+ja.toString(a.max)}}}(),fb=function(){var e=/^(\d+).*$/,i=/(\d+)\s?\-\s?(\d+)/;return{buildingMatch:function(o,p){e.lastIndex=-1;if(e.test(o))for(var a=
o.replace(e,"$1"),c=p.split(","),f=0;f<c.length;f++){i.lastIndex=-1;if(i.test(c[f])){var F=i.exec(c[f]);if(a>=parseInt(F[1],10)&&a<=parseInt(F[2],10))return true}else if(a==c[f])return true}return false},normalize:function(o){if(!o)return"";o=o.toUpperCase();if(!wa){var p=[];for(var a in db)p.push(a);wa=RegExp("(\\s)("+p.join("|")+")(\\s|$)","i")}wa.lastIndex=-1;if(p=wa.exec(o))o=o.replace(wa,"$1"+db[p[2]]);return o},toString:function(o){return o.streetDetails+" "+o.location}}}(),Pa=P.GeoXY=function(){function e(p,
a){if(p.length){for(var c,f,F,J,aa=p.length;aa--;){e(p[aa],a);c=typeof c==="undefined"||p.x<c?p.x:c;f=typeof f==="undefined"||p.y<f?p.y:f;F=typeof F==="undefined"||p.x>F?p.x:F;J=typeof J==="undefined"||p.y>J?p.y:J}return pa.init(c,f,J,J)}else if(p.mercXY){c=p.mercXY;p.x=(c.x+Math.PI)/a|0;p.y=(Math.PI-c.y)/a|0;p.rpp=a}else COG.warn("Attempted to sync an XY composite, not a GeoXY");return p}function i(p,a){if(p.length)for(var c=p.length;c--;)i(p[c],a);else{p.mercXY=q.init(p.x*a-Math.PI,Math.PI-p.y*
a);p.pos=ja.fromMercatorPixels(p.mercXY.x,p.mercXY.y)}return p}function o(p,a,c){p.pos=a;p.mercXY=ja.toMercatorPixels(a);(c=typeof c!=="undefined"?c:p.rpp)&&e(p,c)}return{init:function(p,a){var c=q.init();o(c,p,a);return c},sync:e,syncPos:i,toPos:function(p,a){a=a?a:_self.rpp;return ja.fromMercatorPixels(p.x*a-Math.PI,Math.PI-p.y*a)},updatePos:o}}(),la={},Na=function(){return{bestResults:function(e,i){i||(i=20);for(var o=e.length>0?e[0]:null,p=[],a=0;a<e.length;a++)if(o&&e[a]&&o.matchWeight-e[a].matchWeight<=
i)p.push(e[a]);else break;return p}}}(),Ea=function(e){e=COG.extend({id:null,caption:"",resultType:"",data:null,pos:null,matchWeight:0},e);return COG.extend(e,{toString:function(){return e.caption+(e.matchWeight?" ("+e.matchWeight+")":"")}})},Ya=function(){function e(a,c){var f=new T5.ShapeLayer;c.geometry&&ja.vectorize(c.geometry,{callback:function(F){f.add(new T5.Line(F,{style:"waypoints",simplify:true}));a.setLayer("route",f)}})}function i(a){for(var c=o.Unknown,f=p,F=0;F<f.length;F++){f[F].regex.lastIndex=
-1;var J=f[F].regex.exec(a);if(J){c=f[F].customCheck?f[F].customCheck(a,J):f[F].turnType;break}}return c}var o={Unknown:"turn-unknown",Start:"turn-none-start",Continue:"turn-none",Arrive:"turn-none-arrive",TurnLeft:"turn-left",TurnLeftSlight:"turn-left-slight",TurnLeftSharp:"turn-left-sharp",TurnRight:"turn-right",TurnRightSlight:"turn-right-slight",TurnRightSharp:"turn-right-sharp",Merge:"merge",UTurnLeft:"uturn-left",UTurnRight:"uturn-right",EnterRoundabout:"roundabout-enter",Ramp:"ramp",RampExit:"ramp-exit"},
p=function(){var a=[];a.push({regex:/continue/i,turnType:o.Continue});a.push({regex:/(take|bear|turn)(.*?)left/i,customCheck:function(c,f){return/bear/i.test(f[1])?o.TurnLeftSlight:o.TurnLeft}});a.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(c,f){return/bear/i.test(f[1])?o.TurnRightSlight:o.TurnRight}});a.push({regex:/enter\s(roundabout|rotaty)/i,turnType:o.EnterRoundabout});a.push({regex:/take.*?ramp/i,turnType:o.Ramp});a.push({regex:/take.*?exit/i,turnType:o.RampExit});a.push({regex:/make(.*?)u\-turn/i,
customCheck:function(c,f){return/right/i.test(f[1])?o.UTurnRight:o.UTurnLeft}});a.push({regex:/proceed/i,turnType:o.Start});a.push({regex:/arrive/i,turnType:o.Arrive});a.push({regex:/fell\sthrough/i,turnType:o.Merge});return a}();return{calculate:function(a){a=COG.extend({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},a);var c=b("route");c&&c.route(a,function(f){if(a.generalize)f.geometry=ja.generalize(f.geometry,f.getInstructionPositions());if(a.map){e(a.map,
f);a.autoFit&&a.map.gotoBounds(f.boundingBox)}a.success&&a.success(f)})},createMapOverlay:e,parseTurnType:i,TurnType:o,Instruction:function(a){var c=a=COG.extend({position:null,description:"",distance:0,distanceTotal:0,time:0,timeTotal:0,turnType:null},a),f=a.description;f=f.replace(/(\w)(\/)(\w)/g,"$1 $2 $3");c.description=f;if(!a.turnType)a.turnType=i(a.description);return a},RouteData:function(a){a=COG.extend({geometry:[],instructions:[],boundingBox:null},a);if(!a.boundingBox)a.boundingBox=eb.forPositions(a.geometry);
return COG.extend({getInstructionPositions:function(){for(var c=[],f=0;f<a.instructions.length;f++)a.instructions[f].position&&c.push(a.instructions[f].position);return c}},a)}}}(),Ka="featurecollection",Ab="feature",kb={async:false},cb={processor:null,group:"shapes",layerClass:rb},yb={point:COG.extend({},cb,{processor:function(e,i,o,p){i=C([i.coordinates],kb);if(i.length>0)if(o=p.marker(i[0],o)){e.add(o);return i.length}},group:"markers",layerClass:rb}),linestring:COG.extend({},cb,{processor:function(e,
i,o,p){i=C(i&&i.coordinates?i.coordinates:[]);return v(e,i,o,p.line)}}),multilinestring:COG.extend({},cb,{processor:function(e,i,o,p){i=i&&i.coordinates?i.coordinates:[];for(var a=0,c=i.length;c--;)a+=v(e,i[c],o,p.line);return a}}),polygon:COG.extend({},cb,{processor:function(e,i,o,p){i=i&&i.coordinates?i.coordinates:[];if(i.length>0)return v(e,i[0],o,p.poly);return 0}}),multipolygon:COG.extend({},cb,{processor:function(e,i,o,p){i=i&&i.coordinates?i.coordinates:[];for(var a=0,c=0;c<i.length;c++)a+=
v(e,i[c][0],o,p.poly);return a}})},xa=function(e,i,o,p){function a(Q,Y){var ra=Q.processor,ya=aa+Q.group,Za=COG.extend({},Q,o,{properties:Y.properties});if(ra){var ab=L[ya];if(!ab){ab=new Q.layerClass({id:ya});L[ya]=ab}globalLayers=L;return ra(ab,Y.data,Za,p)}return 0}function c(Q,Y){var ra=Q&&Q.type?Q.type.toLowerCase():null;return ra&&ra===Ab?c(Q.geometry,Q.properties):{type:ra,isCollection:ra?ra===Ka:false,definition:yb[ra],data:Q,properties:Y?Y:Q.properties}}function f(Q){var Y=0,ra=COG.extend({},
o),ya=fa;Q=Q?Q:(new Date).getTime();if(!Ba){for(;ya<Da;ya++){Q=c(J?J(e[ya]):e[ya]);var Za=null;if(Q.isCollection){ra.layerPrefix=aa+T++ +"-";Ba=r(Q.data.features,function(ab){Ba=null;for(var hb in ab)L[hb]=ab[hb]},ra);Za+=1}else if(Q.definition)Za=a(Q.definition,Q);Y+=Za?Za:1;if(Y>=F)break}fa=ya+1;if(Ba||fa<Da)animFrame(f);else i&&i(L)}}o=COG.extend({vectorsPerCycle:$a.VECTORIZE_PER_CYCLE,rowPreParse:null,simplify:false,layerPrefix:"geojson-"},o);p=COG.extend({marker:function(Q){return new Marker({xy:Q})},
line:function(Q,Y){return new lb(Q,COG.extend({},o,Y))},poly:function(Q,Y){return new lb(Q,COG.extend({fill:true},o,Y))}},p);var F=o.vectorsPerCycle,J=o.rowPreParse,aa=o.layerPrefix,fa=0,Da=0,Ba=null,T=0,L={};if(e){if(typeof e.length==="undefined")e=[e];Da=e.length;animFrame(f)}};P.GeoJSON={parse:r};P.Map=function(e){function i(L){try{var Q=$a.Position.init(L.coords.latitude,L.coords.longitude),Y=L.coords.accuracy/1E3;T.trigger("locationUpdate",L,Y);if(fa){if(!J){J=new $a.UI.LocationOverlay({pos:Q,
accuracy:Y});J.update(T.getTileLayer());T.setLayer("location",J)}var ra=$a.BoundingBox.createBoundsFromCenter(Q,Math.max(Y,1));T.gotoBounds(ra)}else{J.pos=Q;J.accuracy=Y;J.update(T.getTileLayer());a(Q,null,COG.easing("sine.out"))}fa=false}catch(ya){COG.exception(ya)}}function o(L){COG.info("caught location tracking error:",L)}function p(L,Q,Y){T.setZoomLevel(Q);a(L,Y)}function a(L,Q,Y,ra){L=Pa.init(L,$a.radsPerPixel(T.getZoomLevel()));var ya=T.getDimensions();T.updateOffset(L.x-(ya.width>>1),L.y-
(ya.height>>1),Y,ra,function(){T.refresh();T.trigger("boundsChange",T.getBoundingBox());Q&&Q(T)})}e=COG.extend({tapExtent:10,crosshair:false,zoomLevel:0,boundsChangeThreshold:30,minZoom:1,maxZoom:18,pannable:true,scalable:true},e);var c={NONE:0,SINGLE:1,WATCH:2},f=q.init(),F=c.NONE,J=null,aa=0,fa=true,Da=0,Ba=e.tapExtent;e.adjustScaleFactor=function(L){return Math.pow(2,(L<1?Math.floor:Math.ceil)(Math.log(L)))};var T=COG.extend(new Fb(e),{getBoundingBox:function(){var L=T.getViewRect();return $a.BoundingBox.init(Pa.toPos(q.init(L.x1,
L.y2),Da),Pa.toPos(q.init(L.x2,L.y1),Da))},getCenterPosition:function(){var L=T.getViewRect();if(L){L=q.init(L.x1+(L.width>>1),L.y1+(L.height>>1));return Pa.toPos(L,Da)}return null},gotoBounds:function(L,Q){var Y=$a.BoundingBox.getZoomLevel(L,T.getDimensions());p($a.BoundingBox.getCenter(L),Y,Q)},gotoPosition:p,panToPosition:a,syncXY:function(L,Q){return(Q?Pa.syncPos:Pa.sync)(L,Da)},locate:function(){T.trackStart(c.SINGLE);setTimeout(T.trackCancel,1E4)},trackStart:function(L){if(navigator.geolocation&&
!aa){F=L?L:c.WATCH;fa=true;aa=navigator.geolocation.watchPosition(i,o,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3})}},trackCancel:function(){aa&&navigator.geolocation&&navigator.geolocation.clearWatch(aa);T.removeLayer("location");J=null;F=c.NONE;aa=0},animateRoute:function(L,Q,Y,ra){var ya=T.getLayer("route");if(ya)(L=ya.getAnimation(L,Q,Y,ra))&&L.addToView(T)}});T.bind("pan",function(){F===c.SINGLE&&T.trackCancel()});T.bind("tap",function(L,Q,Y,ra){L=Pa.toPos(ra,Da);var ya=Pa.toPos(q.offset(ra,
-Ba,Ba),Da);ra=Pa.toPos(q.offset(ra,Ba,-Ba),Da);T.trigger("geotap",Q,Y,L,eb.init(ya,ra))});T.bind("refresh",function(){if(q.absSize(q.diff(f,T.getOffset()))>e.boundsChangeThreshold){f=q.copy(T.getOffset());T.trigger("boundsChange",T.getBoundingBox())}});T.bind("zoomLevelChange",function(L,Q){var Y;Da=$a.radsPerPixel(Q);Y=sa/Da|0;T.setMaxOffset(Y,Y,true,false);Oa.cancelLoad();T.resetScale();T.triggerAll("resync",T);T.refresh()});return T};P.GeoShape=function(e,i){i=COG.extend({autoParse:true},i);for(var o=
Array(e.length),p=i.autoParse,a=T5.Geo.Position.parse,c=e.length;c--;)o[c]=T5.GeoXY.init(p?a(e[c]):e[c]);return new T5.Poly(o,i)};P.LocationOverlay=function(e){e=COG.extend({pos:null,accuracy:null,zindex:90},e);var i=new Image,o=T5.XY.init(),p=T5.XY.init(),a=null;i.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAACIQAAAiEBPhEQkwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAG+SURBVCiRlZHNahNRAIW/O7mTTJPahLZBA1YUyriINRAE3bQIKm40m8K8gLj0CRQkO32ELHUlKbgoIu4EqeJPgtCaoBuNtjXt5LeTMZk0mbmuWiuuPLsD3+HAOUIpxf9IHjWmaUbEyWv5ROrsVULhcHP761rUfnN3Y2Otc8CIg4YT85lzuVsPP+Qupw1vpPjRCvhS9ymvV0e77x7nNj+uvADQAIQQ+uLyvdfLV9JGZi7EdEwQlqBpEJ019f0z1mo2u5Q8DMydv25lshemmj1FueZTawbs7inarqLbV7Qjab1upB9YlhWSAHLavLHZCvg1VEhN0PMU9W7At4bPVidg7CtkLLXkut+lBPD6/Ub155jJiADAHSpaLmx3ApyBQoYEUd0PBoOBkAC6+3llvda/YxgGgYL+UNHf/zN3KiExGlsvTdP0NYDkhPdWrz35ZDsBzV5wCMuQwEyFmXFeeadjzfuFQmGkAZRKpdGC/n7x+M6jqvA9Zo6FWDhlcHE+wqT93J1tP7vpOE7rrx8ALMuasPf8S12St4WmJ6bYWTUC52k8Hm8Vi0X/nwBAPp/XKpWKdF1X2LYdlMvlsToC/QYTls7DLFr/PAAAAABJRU5ErkJggg%3D%3D";
i.onload=function(){o=T5.XY.init(i.width>>1,i.height>>1)};var c=COG.extend(new T5.ViewLayer(e),{pos:e.pos,accuracy:e.accuracy,drawAccuracyIndicator:false,draw:function(f,F){var J=p.x-F.x,aa=p.y-F.y;if(a){f.fillStyle="rgba(30, 30, 30, 0.2)";f.beginPath();f.arc(J,aa,a,0,Math.PI*2,false);f.fill()}i.complete&&i.width>0&&f.drawImage(i,J-o.x,aa-o.y,i.width,i.height);c.changed()},update:function(f){if(f){a=f.getPixelDistance(c.accuracy)>>1;p=f.getGridXYForPosition(c.pos);c.changed()}}});c.bind("gridUpdate",
function(f,F){c.update(F)});return c};return{distanceToString:function(e){if(e>1E3)return~~(e/10)/100+" km";return e?e+" m":""},dist2rad:function(e){return e/6371},getEngine:b,lat2pix:n,lon2pix:h,pix2lat:d,pix2lon:g,radsPerPixel:function(e){return sa/(256<<e)},Position:ja,BoundingBox:eb,Radius:function(e,i){return{distance:parseInt(e,10),uom:i}},Address:function(e){return e=COG.extend({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},e)},A:fb,GeocodeFieldWeights:{streetDetails:50,
location:50},AddressCompareFns:{},Engine:function(e){if(!e.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var i=COG.extend({remove:function(){delete la[i.id]}},e);return la[i.id]=i},Search:Na,GeoSearchResult:Ea,LocationSearch:function(e){function i(f,F){navigator.geolocation.clearWatch(p);p=0;if(a){clearTimeout(a);a=0}F&&F([f],e)}function o(f){COG.info("caught location tracking error:",f)}e=COG.extend({name:"Geolocation Search",requiredAccuracy:null,searchTimeout:5E3,
watch:false},e);var p=0,a=0,c=null;return new T5.Geo.GeoSearchAgent(COG.extend({execute:function(f,F){if(navigator.geolocation&&!p){p=navigator.geolocation.watchPosition(function(J){var aa=ja.init(J.coords.latitude,J.coords.longitude);J=new Ea({id:1,caption:"Current Location",pos:aa,accuracy:J.coords.accuracy/1E3,matchWeight:100});if(!c||J.accuracy<c.accuracy)c=J;if(!e.requiredAccuracy||c.accuracy<e.requiredAccuracy)i(c,F)},o,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3});if(e.searchTimeout)a=
setTimeout(function(){c&&i(c,F)},e.searchTimeout)}}},e))},Routing:Ya}}()})(T5);
