if(!this.JSON)this.JSON={};
(function(){function e(k){return k<10?"0"+k:k}function m(k){a.lastIndex=0;return a.test(k)?'"'+k.replace(a,function(n){var o=d[n];return typeof o==="string"?o:"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+k+'"'}function f(k,n){var o,r,B,u,z=g,w,s=n[k];if(s&&typeof s==="object"&&typeof s.toJSON==="function")s=s.toJSON(k);if(typeof l==="function")s=l.call(n,k,s);switch(typeof s){case "string":return m(s);case "number":return isFinite(s)?String(s):"null";case "boolean":case "null":return String(s);
case "object":if(!s)return"null";g+=h;w=[];if(Object.prototype.toString.apply(s)==="[object Array]"){u=s.length;for(o=0;o<u;o+=1)w[o]=f(o,s)||"null";B=w.length===0?"[]":g?"[\n"+g+w.join(",\n"+g)+"\n"+z+"]":"["+w.join(",")+"]";g=z;return B}if(l&&typeof l==="object"){u=l.length;for(o=0;o<u;o+=1){r=l[o];if(typeof r==="string")if(B=f(r,s))w.push(m(r)+(g?": ":":")+B)}}else for(r in s)if(Object.hasOwnProperty.call(s,r))if(B=f(r,s))w.push(m(r)+(g?": ":":")+B);B=w.length===0?"{}":g?"{\n"+g+w.join(",\n"+g)+
"\n"+z+"}":"{"+w.join(",")+"}";g=z;return B}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
a=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,g,h,d={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},l;if(typeof JSON.stringify!=="function")JSON.stringify=function(k,n,o){var r;h=g="";if(typeof o==="number")for(r=0;r<o;r+=1)h+=" ";else if(typeof o==="string")h=o;if((l=n)&&typeof n!=="function"&&(typeof n!=="object"||typeof n.length!=="number"))throw Error("JSON.stringify");return f("",
{"":k})};if(typeof JSON.parse!=="function")JSON.parse=function(k,n){function o(B,u){var z,w,s=B[u];if(s&&typeof s==="object")for(z in s)if(Object.hasOwnProperty.call(s,z)){w=o(s,z);if(w!==undefined)s[z]=w;else delete s[z]}return n.call(B,u,s)}var r;k=String(k);b.lastIndex=0;if(b.test(k))k=k.replace(b,function(B){return"\\u"+("0000"+B.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(k.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){r=eval("("+k+")");return typeof n==="function"?o({"":r},""):r}throw new SyntaxError("JSON.parse");}})();
GT=function(){var e=/\$\{(.*?)\}/ig,m=Object.prototype.hasOwnProperty,f=0,b={id:"GRUNT.core",extend:function(){var a=arguments[0]||{},g=1,h=arguments.length,d=false,l,k,n,o;if(typeof a==="boolean"){d=a;a=arguments[1]||{};g=2}if(typeof a!=="object"&&!b.isFunction(a))a={};if(h===g){a=this;--g}for(;g<h;g++)if((l=arguments[g])!=null)for(k in l){n=a[k];o=l[k];if(a!==o)if(d&&o&&(b.isPlainObject(o)||b.isArray(o))){n=n&&(b.isPlainObject(n)||b.isArray(n))?n:b.isArray(o)?[]:{};a[k]=b.extend(d,n,o)}else if(o!==
undefined)a[k]=o}return a},isFunction:function(a){return toString.call(a)==="[object Function]"},isArray:function(a){return toString.call(a)==="[object Array]"},isPlainObject:function(a){if(!a||toString.call(a)!=="[object Object]"||a.nodeType||a.setInterval)return false;if(a.constructor&&!m.call(a,"constructor")&&!m.call(a.constructor.prototype,"isPrototypeOf"))return false;var g;for(g in a);return g===undefined||m.call(a,g)},isEmptyObject:function(a){for(var g in a)return false;return true},isXmlDocument:function(a){return toString.call(a)===
"[object Document]"},contains:function(a,g){var h=a,d=arguments,l=1;if(g&&b.isArray(g)){d=g;l=0}for(l=l;l<d;l++)h=h&&typeof foo[d[l]]!=="undefined";return h},newModule:function(a){a=b.extend({id:null,requires:[],parent:null},a);if(a.parent)a=b.extend({},a.parent,a);return a},toID:function(a){return a.replace(/\s/g,"-")},objId:function(a){return(a?a:"obj")+f++},formatStr:function(a){if(arguments.length<=1)return a;for(var g=arguments.length-2,h=0;h<=g;h++)a=a.replace(RegExp("\\{"+h+"\\}","gi"),arguments[h+
1]);return a},wordExists:function(a,g){var h="";if(g.toString)g=g.toString();for(var d=0;d<g.length;d++)h+=!/\w/.test(g[d])?"\\"+g[d]:g[d];return RegExp("(^|\\s|\\,)"+h+"(\\,|\\s|$)","i").test(a)},parseTemplate:function(a,g){for(var h=e.exec(a);h;){a=a.replace(h[0],GT.XPath.first(h[1],g));e.lastIndex=0;h=e.exec(a)}return a}};return b}();
GT.Log=function(){function e(g,h){var d,l=h&&h.length>0?h[0]:"";for(d=1;h&&d<h.length;d++)l+=" "+(f&&GT.isPlainObject(h[d])?JSON.stringify(h[d]):h[d]);typeof console!=="undefined"&&console[g](l);for(d=0;d<m.length;d++)m[d].call(a,l,g)}var m=[],f=typeof JSON!=="undefined",b=window.console&&window.console.markTimeline,a={id:"GRUNT.log",getTraceTicks:function(){return b?(new Date).getTime():null},trace:function(g,h){if(b)console.markTimeline(g+(h?": "+(a.getTraceTicks()-h)+"ms":""))},debug:function(){e("debug",
arguments)},info:function(){e("info",arguments)},warn:function(){e("warn",arguments)},error:function(){e("error",arguments)},exception:function(g){a.error(arguments);for(var h in g)a.info("ERROR DETAIL: "+h+": "+g[h])},watch:function(g,h){try{h()}catch(d){a.exception(d,g)}},throwError:function(g){a.error(g);throw Error(g);},requestUpdates:function(g){m.push(g)}};return a}();
(function(){function e(f,b){var a=f.split("|"),g={};for(var h in b){var d=b[h];g[h]=a.length>d?a[d]:null}return g}var m={JSON:{parse:function(f){return JSON.parse(f)}},PDON:{parse:function(f){var b=null,a=[];f=f.split("\n");for(var g=0;g<f.length;g++){var h=f[g];if(b)a.push(e(h,b));else if(h){b=h.split("|");h={};for(var d=0;d<b.length;d++)h[b[d]]=d;b=h}else b=null}return a}}};GT.parseData=function(f,b){b=b?b.toUpperCase():"JSON";if(!m[b])throw Error("Unsupported data format: "+b);try{return m[b].parse(f)}catch(a){GT.Log.exception(a)}return{}}})();
(function(){function e(b,a){b[a]||(b[a]=function(g){return b.configure(a,g)})}function m(b){b.gtConfId=GT.objId("configurable");b.gtConfig={};b.gtConfigFns=[];return b.gtConfig}var f={};GT.paramTweaker=function(b,a,g){return function(h,d){if(typeof d!=="undefined"){if(h in b)b[h]=d;g&&h in g&&g[h](h,d)}else return a&&h in a?a[h](h):b[h]}};GT.configurable=function(b,a,g,h){if(b){b.gtConfId||m(b);var d=b.gtConfId,l=b.gtConfig,k=b.gtConfigFns;f[d]=b;k.push(g);for(g=a.length;g--;){l[a[g]]=true;h&&e(b,
a[g])}if(!b.configure)b.configure=function(n,o){if(l[n]){for(var r=k.length;r--;){var B=k[r](n,o);if(typeof B!=="undefined")return B}return f[d]}return null}}}})();
(function(){function e(a){var g=document.createElement("script"),h=false;g.src=a;g.async=true;g.onload=g.onreadystatechange=function(){if(!h&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){h=true;g.onload=g.onreadystatechange=null;g&&g.parentNode&&g.parentNode.removeChild(g)}};f||(f=document.getElementsByTagName("head")[0]);f.appendChild(g)}var m=0,f,b=this;GT.jsonp=function(a,g,h){a+=a.indexOf("?")>=0?"&":"?";var d="json"+ ++m;b[d]=function(l){g(l);b[d]=null;try{delete b[d]}catch(k){}};
e(a+(h?h:"callback")+"="+d);return d}})();
(function(){function e(){if(this.readyState===4){var d=null,l=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(l)if(params.handleResponse)params.handleResponse(this);else{var k=params,n=this.getResponseHeader(h.CONTENT_TYPE),o,r=false;for(o in m)if(n&&n.indexOf(m[o])>=0){r=true;break}n=!r;for(r=0;r<b.length;r++)n=n||b[r]==o;if(n)b:{n=o;for(var B in f)for(r=0;r<f[B].length;r++)if(RegExp(f[B][r]+"$","i").test(k.url)){o=
B;break b}o=n?n:"DEFAULT"}try{d=g[o](this,k)}catch(u){d=g.DEFAULT(this,k)}}else params.error&&params.error(this)}catch(z){GT.Log.exception(z,"PROCESSING AJAX RESPONSE")}l&&d&&params.success&&params.success.call(this,d)}}var m={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},f={JSON:["json"],PDON:["pdon.txt"]},b=["TEXT","STREAM"],a=/^(\w+:)?\/\/([^\/?#]+)/,g={XML:function(d){return d.responseXML},JSON:function(d){return GT.parseData(d.responseText)},PDON:function(d){return GT.parseData(d.responseText,
"PDON")},DEFAULT:function(d){return d.responseText}},h={CONTENT_TYPE:"Content-Type"};GT.xhr=function(d){try{d=GT.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},module.ajaxSettings,d);var l=a.exec(d.url),k=l&&(l[1]&&l[1]!==location.protocol||l[2]!==location.host);if(d.data)d.method="POST";if(d.url){l=null;if(d.xhr)l=d.xhr(d);l||(l=new XMLHttpRequest);l.open(d.method,d.url,d.async);d.data&&l.setRequestHeader("Content-Type",
d.contentType);k||l.setRequestHeader("X-Requested-With","XMLHttpRequest");l.onreadystatechange=e;l.send(d.method=="POST"?module.param(d.data):null)}else GT.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(n){GT.Log.exception(n)}}})();
GT.XPath=function(){function e(a){for(var g=null,h=0;h<m.length;h++)if(g=m[h](a))break;return g}var m=[],f=[null,function(a){return a.numberValue},function(a){return a.stringValue},function(a){return a.booleanValue},null,null,null,null,function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null},function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||GT.Log.warn("No XPATH support");var b={SearchResult:function(a){return{toString:function(){var g=
null;if(a){var h=null;if(a.resultType>=0&&a.resultType<f.length)h=f[a.resultType];if(h)g=h(a)}return g?g:""}}},first:function(a,g){var h=b.SearchResult,d;var l=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!l)l=XPathResult.ANY_TYPE;try{if(GT.isXmlDocument(g))d=g.evaluate(a,g,e,l,null);else{GT.Log.warn("attempted xpath expression: "+a+" on a non-xml document");d=null}}catch(k){GT.Log.warn("invalid xpath expression: "+a+" on node: "+g);d=null}return new h(d)},registerResolver:function(a){m.push(a)}};return b}();
(function(){function e(m,f){var b=m.gtObsHandlers;b[f]||(b[f]=[]);return b[f]}GT.observable=function(m){if(m){if(!m.gtObsHandlers)m.gtObsHandlers={};if(!(m.bind||m.trigger||m.unbind)){m.bind=function(f,b){var a=GT.objId("callback");e(m,f).push({fn:b,id:a});return a};m.trigger=function(f){var b=e(m,f);if(!b)return m;for(var a=b.length;a--;)b[a].fn.apply(self,Array.prototype.slice.call(arguments,1));return m};m.unbind=function(f,b){for(var a=e(m,f),g=0;a&&g<a.length;g++)if(a[g].id===b){a.splice(g,1);
break}return m}}}}})();(function(){var e={},m=[];GT.addPipe=function(f){f("pipe.test",{});m.push(f)};GT.listen=function(f,b){e[f]||(e[f]=[]);b&&e[f].push(b)};GT.say=function(f,b){var a;for(a=m.length;a--;)m[a](f,b);if(e[f])for(a=e[f].length;a--;)e[f][a](b)}})();
GT.Storage=function(){function e(m){if(m&&m=="session")return sessionStorage;return localStorage}return{get:function(m,f){var b=e(f).getItem(m);return/^(\{|\[).*(\}|\])$/.test(b)?JSON.parse(b):b},set:function(m,f,b){f=jQuery.isArray(f)||jQuery.isPlainObject(f)?JSON.stringify(f):f;e(b).setItem(m,f)},remove:function(m,f){e(f).removeItem(m)}}}();
GT.ParseRules=function(){var e=[];return{add:function(m,f){e.push({regex:m,handler:f})},each:function(m,f,b){function a(){g++;b&&g>=e.length&&b(f)}for(var g=0,h=0;h<e.length;h++){var d=e[h].regex,l=e[h].handler,k=false;if(d){d.lastIndex=-1;if((d=d.exec(m))&&l){k=true;l(d,f,a)&&a()}}k||a()}}}};
T5=function(){var e=function(h,d){return{x:h?h:0,y:d?d:0}},m=function(){function h(d){if(!d||d.length<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var l={edges:Array(d.length-1),accrued:Array(d.length-1),total:0},k=m.diff,n=0;n<d.length-1;n++){var o=k(d[n],d[n+1]);l.edges[n]=Math.sqrt(o.x*o.x+o.y*o.y);l.accrued[n]=l.total+l.edges[n];l.total+=l.edges[n]}return l}return{create:function(d,l){return new e(d,l)},add:function(){for(var d=new e,l=arguments.length;l--;){d.x+=
arguments[l].x;d.y+=arguments[l].y}return d},absSize:function(d){return Math.max(Math.abs(d.x),Math.abs(d.y))},diff:function(d,l){return new e(d.x-l.x,d.y-l.y)},copy:function(d){return d?new e(d.x,d.y):null},invert:function(d){return new e(-d.x,-d.y)},offset:function(d,l,k){return new e(d.x+l,d.y+(k?k:l))},edges:h,distance:function(d){return h(d).total},theta:function(d,l,k){k=Math.asin((d.y-l.y)/k);return d.x>l.x?k:Math.PI-k},pointOnEdge:function(d,l,k,n){l=new e(Math.cos(k)*n,Math.sin(k)*n);return new e(d.x-
l.x,d.y-l.y)},getRect:function(d){var l=d.length;if(l>1)return new f(Math.min(d[0].x,d[l-1].x),Math.min(d[0].y,d[l-1].y),Math.abs(d[0].x-d[l-1].x),Math.abs(d[0].y-d[l-1].y))},toString:function(d){return d.x+", "+d.y}}}(),f=function(h,d,l,k){return{origin:new e(h,d),dimensions:new a(l,k)}},b=function(){return{copy:function(h){return h?new f(h.origin.x,h.origin.y,h.dimensions.width,h.dimensions.height):null},getCenter:function(h){return new e(h.origin.x+h.dimensions.width/2,h.origin.y+h.dimensions.height/
2)}}}(),a=function(h,d){return{width:h?h:0,height:d?d:0}},g=function(){return{getAspectRatio:function(h){return h.height!==0?h.width/h.height:1},getCenter:function(h){return new e(h.width/2,h.height/2)},getSize:function(h){return Math.sqrt(Math.pow(h.width,2)+Math.pow(h.height,2))}}}();return{ex:GT.extend,newCanvas:function(h,d){var l=document.createElement("canvas");typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(l);l.width=h?h:0;l.height=d?d:0;return l},time:function(){return(new Date).getTime()},
Vector:e,V:m,Dimensions:a,D:g,Rect:f,R:b}}();
(function(){function e(){for(;n.length>0;){var r=n.shift();document.location=r}k=0}function m(r){for(var B=true,u=o.length;u--;)B=B&&r!=o[u];return B}function f(r,B){var u=[];for(var z in B)z&&u.push(z+"="+escape(B[z]));return"tile5://"+r+"/"+(u.length>0?"?"+u.join("&"):"")}function b(r,B){m(r)&&GT.Log.info("would push url: "+f(r,B))}function a(r,B){if(m(r)){n.push(f(r,B));k||(k=setTimeout(e,100))}}function g(){h={base:{name:"Unknown",eventTarget:document,supportsTouch:"createTouch"in document,imageCacheMaxSize:null,
getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:b,targetFps:null},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:a,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:a},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:a},android:{name:"Android OS <= 2.1",regex:/android/i,eventTarget:document.body,supportsTouch:true,getScaling:function(){return 1/
window.devicePixelRatio},bridgeNotify:a},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:a}};d=[h.froyo,h.android,h.ipod,h.iphone,h.ipad]}var h=null,d=[],l=null,k=0,n=[],o=["view.wake","tile.loaded"];T5.getConfig=function(){h||g();if(!l){GT.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var r=0;r<d.length;r++){var B=d[r];if(B.regex&&B.regex.test(navigator.userAgent)){l=T5.ex({},h.base,B);GT.Log.info("PLATFORM DETECTED AS: "+
l.name);break}}if(!l){GT.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");l=h.base}GT.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return l}})();
T5.Resources=function(){var e="",m={},f={getPath:function(b){return/^(file|https?|\/)/.test(b)?b:e+b},setBasePath:function(b){e=b},loadResource:function(b){b=T5.ex({filename:"",cacheable:true,dataType:null,callback:null},b);var a=function(g){b.callback&&GT.Log.watch("CALLING RESOURCE CALLBACK",function(){b.callback(g)})};b.cacheable&&m[b.filename]?a(m[b.filename]):GT.xhr({url:f.getPath(b.filename),dataType:b.dataType,success:function(g){if(b.cacheable)m[b.filename]=g;a(g)},error:function(g,h,d){GT.Log.error("error loading resource ["+
b.filename+"], error = "+d)}})},loadSnippet:function(b,a){/\.\w+$/.test(b)||(b+=".html");f.loadResource({filename:"snippets/"+b,callback:a,dataType:"html"})}};return f}();
T5.Images=function(){function e(){var u=g[this.id];if(u&&u.image.complete&&u.image.width>0){u.loaded=true;u.hitCount=1;for(var z=l.length;z--;)if(l[z].image.src==this.src){l.splice(z,1);break}if(u.background||u.postProcess)if(u.image){z=T5.newCanvas(u.realSize?u.realSize.width:image.width,u.realSize?u.realSize.height:image.height);var w=z.getContext("2d"),s=u.offset?u.offset:new T5.Vector;u.background&&w.drawImage(u.background,0,0);w.drawImage(u.image,s.x,s.y);u.postProcess&&u.postProcess(w,u);u.image=
z}u.loadCallback&&u.loadCallback(this,false);k.push({url:this.src,created:u.requested});delete g[this.id];m()}}function m(){for(var u=T5.getConfig().maxImageLoads;d.length>0&&(!u||l.length<u);){var z=d.shift();if(z.imageLoader){l.push(z);z.imageLoader(z,e)}}}function f(u){for(var z=null,w=n.length;w--&&!z;)z=n[w](u);return z?z:function(s,E){s.image.onload=E;s.image.src=T5.Resources.getPath(s.url);s.requested=T5.time()}}function b(){r=true;try{var u=Math.floor(k.length/2);if(u>0){k.sort(function(w,
s){return w.created-s.created});for(var z=u;z--;)delete a[k[z].url];k.splice(0,u)}}finally{r=false}GT.say("imagecache.cleared")}var a={},g={},h=0,d=[],l=[],k=[],n=[],o=0,r=false,B={avgImageSize:25,loadTimeout:10,addInterceptor:function(u){n.push(u)},cancelLoad:function(){l=[]},get:function(u){var z=null,w=null;r||(z=a[u]);if((w=z?z.image:null)&&(w.getContext||w.complete&&w.width>0))return w},load:function(u,z,w){var s=a[u];if(s){s.hitCount++;s.image.complete&&z&&z(s.image,true)}else{s=T5.ex({url:u,
image:new Image,loaded:false,imageLoader:f(u),created:T5.time(),requested:null,hitCount:0,loadCallback:z},w);s.image.id="resourceLoaderImage"+h++;a[u]=s;g[s.image.id]=s;d.push(s);m()}return s},stats:function(){return{imageLoadingCount:l.length,queuedImageCount:d.length,imageCacheFullness:o}}};setInterval(function(){for(var u=T5.time(),z=false,w=0,s=T5.getConfig();w<l.length;)if(u-l[w].requested>B.loadTimeout*1E3){l.splice(w,1);z=true}else w++;z&&m();if(s&&s.imageCacheMaxSize){o=k.length*B.avgImageSize/
s.imageCacheMaxSize;o>=1&&b()}},1E3);return B}();
(function(){function e(p,q){var t=p&&p.length>0?p[0]:null;if(t&&q&&q.length>0)return w(t,q[0]);return null}function m(p){p.preventDefault();p.stopPropagation()}function f(p){for(var q=Array(p.length),t=p.length;t--;)q[t]=u(p[t].pageX,p[t].pageY);return q}var b=120,a=100,g=250,h=300,d=5,l=2,k=0,n=1,o=7,r=0,B=0,u=T5.V.create,z=T5.V.distance,w=T5.V.diff,s=function(p){function q(G,N,J,D){var F=Math.asin((G.y-N.y)/J);J=Math.min(Math.floor(J*(ba.duration/D)),ba.max);F=N.x>G.x?F:Math.PI-F;G=u(Math.cos(F)*
-J,Math.sin(F)*J);x("inertiaPan",G.x,G.y)}function t(G,N){var J,D;if(L){J=N-ca;if(J<g){D=z([R[0],G]);D>p.inertiaTrigger&&q(R[0],G,D,J)}}else{W=G;var F=setInterval(function(){J=T5.time()-N;D=z([G,W]);if(J<a&&D>p.inertiaTrigger){clearInterval(F);q(G,W,D,J)}else J>a&&clearInterval(F)},5)}}function v(G){for(var N=[],J=T?-T.offsetLeft:0,D=T?-T.offsetTop:0,F=G.length;F--;)N.push(T5.V.offset(G[F],J,D));return N}function x(){X&&X.trigger.apply(null,arguments)}function A(G){if(G.target&&G.target===T){R=L?
f(G.touches):[u(G.pageX,G.pageY)];$=u();Z=u();Q=true;I=false;ca=T5.time();m(G);G.target.style.cursor="move";x("inertiaCancel");ea=ca;if(G=R.length>0?R[0]:null){x("touchStart",G.x,G.y);if(ea-ha<h)if((G=S?T5.V.diff(R[0],S[0]):null)&&Math.abs(G.x)<p.maxDistDoubleTap&&Math.abs(G.y)<p.maxDistDoubleTap)I=true;Y=k;S=[].concat(R)}else GT.Log.warn("Touch start fired, but no touch vector found")}}function C(G){if(G.target&&G.target===T){W=(L?f(G.touches):[u(G.pageX,G.pageY)])[0];if(Q){L&&m(G);G=L?f(G.touches):
[u(G.pageX,G.pageY)];var N=0;if(G.length>1){if(R.length===1)R=[].concat(G);N=z(R)-z(G)}if(Y===k){var J=e(G,R);if(J&&(Math.abs(J.x)>=o||Math.abs(J.y)>=o))Y=n}if(Y!==k)if(!N||Math.abs(N)<d){if($=e(G,S)){Z.x-=$.x;Z.y-=$.y;V.x-=$.x;V.y-=$.y}if(T5.V.absSize(V)>l){x("pan",V.x,V.y);V=u()}Y=n}else{x("pinchZoom",v(R),v(G));Y=TOUCH_MODE_PINCH}S=[].concat(G)}}}function y(G){if(G.target&&G.target===T){var N=(L?f(G.changedTouches):[u(G.pageX,G.pageY)])[0];L&&m(G);var J=T5.time();ha=ea;if(Y===k)K||(K=setTimeout(function(){K=
0;var D=I?"doubleTap":"tap",F=R[0],M=null;if(T)M=T5.V.offset(F,-T.offsetLeft,-T.offsetTop);x(D,F,M)},h+50));else if(Y==n){x("panEnd",Z.x,Z.y);ba&&t(N,J)}else Y==TOUCH_MODE_PINCH&&x("pinchZoomEnd",v(R),v(S),J-ca);G.target.style.cursor="default";Q=false}}function H(G){if(G.target&&G.target===T){var N;if(G.detail){N=-G.detail*b;N=u(G.axis===1?N:0,G.axis===2?N:0)}else N=u(G.wheelDeltaX,G.wheelDeltaY);var J=N.y!==0?Math.abs(N.y/b):0;if(W&&J!==0){var D=T5.V.offset(W,-T.offsetLeft,-T.offsetTop);x("wheelZoom",
D,Math.pow(2,N.y>0?J:-J))}G.preventDefault()}}p=T5.ex({element:null,observable:null,inertiaTrigger:20,maxDistDoubleTap:20,touchStartHandler:null,moveHandler:null,moveEndHandler:null,pinchZoomHandler:null,pinchZoomEndHandler:null,tapHandler:null,doubleTapHandler:null,wheelZoomHandler:null},p);var I=false,K=0,O=T5.getConfig(),L=T5.getConfig().supportsTouch,R=null,S=null,$=null,Z=null,V=u(),Y=null,Q=false,ca=0,aa=[],W=null,ba=null,ea=0,ha=0,T=p.element,X=p.observable,ja={supportsTouch:L,addListeners:function(G){aa.push(G)},
decoupleListeners:function(G){for(var N=0;G&&N<aa.length;N++)if(aa[N].listenerId===G){aa.splice(N,1);break}},release:function(){O.eventTarget.removeEventListener(L?"touchstart":"mousedown",A,false);O.eventTarget.removeEventListener(L?"touchmove":"mousemove",C,false);O.eventTarget.removeEventListener(L?"touchend":"mouseup",y,false);if(!L){window.removeEventListener("mousewheel",H,false);window.removeEventListener("DOMMouseScroll",H,false)}},inertiaEnable:function(G,N){ba={duration:G,max:N?Math.min(N.width,
N.height):500}},inertiaDisable:function(){ba=null}};O.eventTarget.addEventListener(L?"touchstart":"mousedown",A,false);O.eventTarget.addEventListener(L?"touchmove":"mousemove",C,false);O.eventTarget.addEventListener(L?"touchend":"mouseup",y,false);if(!L){window.addEventListener("mousewheel",H,false);window.addEventListener("DOMMouseScroll",H,false)}return ja},E=[];T5.captureTouch=function(p,q){if(!p)throw Error("Unable to capture touch of null element");if(!p.id)p.id="touchable_"+r++;var t=E[p.id];
if(!t){t=new s(T5.ex({element:p},q));E[p.id]=t}q.listenerId&&t.decoupleListeners(q.listenerId);q.listenerId=++B;t.addListeners(q);return t};T5.resetTouch=function(p){if(p&&p.id&&E[p.id]){E[p.id].release();delete E[p.id]}}})();
T5.Dispatcher=function(){var e=[],m={execute:function(f){var b=m.findAction(f);b&&b.execute.apply(b,Array.prototype.slice.call(arguments,1))},findAction:function(f){for(var b=e.length;b--;)if(e[b].id==f)return e[b];return null},getRegisteredActions:function(){return[].concat(e)},getRegisteredActionIds:function(){for(var f=[],b=e.length;b--;)e[b].id&&f.push(e[b].id);return f},registerAction:function(f){f&&f.id&&e.push(f)},Action:function(f){f=T5.ex({autoRegister:true,id:"",title:"",icon:"",execute:null},
f);var b={id:f.id,execute:function(){f.execute&&f.execute.apply(this,arguments)},getParam:function(a){return f[a]?f[a]:""},toString:function(){return GT.formatStr("{0} [title = {1}, icon = {2}]",b.id,f.title,f.icon)}};f.autoRegister&&m.registerAction(b);return b},Agent:function(f){f=GT.extend({name:"Untitled",translator:null,execute:null},f);var b={getName:function(){return f.name},getParam:function(a){return f[a]},getId:function(){return GT.toID(b.getName())},run:function(a,g){if(f.execute){var h=
f.translator?f.translator(a):a;f.execute.call(b,h,function(d,l){g&&g(d,l,h)})}}};return b},runAgents:function(f,b,a){for(var g=0;g<f.length;g++)f[g].run(b,a)}};return m}();
(function(){var e=Math.PI*2,m=Math.PI/2,f=Math.abs,b=Math.pow,a=Math.sin,g=Math.asin,h=Math.cos,d=1.70158,l={linear:function(k,n,o,r){return o*k/r+n},backin:function(k,n,o,r){return o*(k/=r)*k*((d+1)*k-d)+n},backout:function(k,n,o,r){return o*((k=k/r-1)*k*((d+1)*k+d)+1)+n},backinout:function(k,n,o,r){return(k/=r/2)<1?o/2*k*k*(((d*=1.525)+1)*k-d)+n:o/2*((k-=2)*k*(((d*=1.525)+1)*k+d)+2)+n},bouncein:function(k,n,o,r){return o-l.bounceout(r-k,0,o,r)+n},bounceout:function(k,n,o,r){return(k/=r)<1/2.75?
o*7.5625*k*k+n:k<2/2.75?o*(7.5625*(k-=1.5/2.75)*k+0.75)+n:k<2.5/2.75?o*(7.5625*(k-=2.25/2.75)*k+0.9375)+n:o*(7.5625*(k-=2.625/2.75)*k+0.984375)+n},bounceinout:function(k,n,o,r){return k<r/2?l.bouncein(k*2,0,o,r)/2+n:l.bounceout(k*2-r,0,o,r)/2+o/2+n},cubicin:function(k,n,o,r){return o*(k/=r)*k*k+n},cubicout:function(k,n,o,r){return o*((k=k/r-1)*k*k+1)+n},cubicinout:function(k,n,o,r){if((k/=r/2)<1)return o/2*k*k*k+n;return o/2*((k-=2)*k*k+2)+n},elasticin:function(k,n,o,r,B,u){if(k==0)return n;if((k/=
r)==1)return n+o;u||(u=r*0.3);if(!B||B<f(o)){B=o;o=u/4}else o=u/e*g(o/B);return-(B*b(2,10*(k-=1))*a((k*r-o)*e/u))+n},elasticout:function(k,n,o,r,B,u){var z;if(k==0)return n;if((k/=r)==1)return n+o;u||(u=r*0.3);if(!B||B<f(o)){B=o;z=u/4}else z=u/e*g(o/B);return B*b(2,-10*k)*a((k*r-z)*e/u)+o+n},elasticinout:function(k,n,o,r,B,u){var z;if(k==0)return n;if((k/=r/2)==2)return n+o;u||(u=r*0.3*1.5);if(!B||B<f(o)){B=o;z=u/4}else z=u/e*g(o/B);if(k<1)return-0.5*B*b(2,10*(k-=1))*a((k*r-z)*e/u)+n;return B*b(2,
-10*(k-=1))*a((k*r-z)*e/u)*0.5+o+n},quadin:function(k,n,o,r){return o*(k/=r)*k+n},quadout:function(k,n,o,r){return-o*(k/=r)*(k-2)+n},quadinout:function(k,n,o,r){if((k/=r/2)<1)return o/2*k*k+n;return-o/2*(--k*(k-2)-1)+n},sinein:function(k,n,o,r){return-o*h(k/r*m)+o+n},sineout:function(k,n,o,r){return o*a(k/r*m)+n},sineinout:function(k,n,o,r){return-o/2*(h(Math.PI*k/r)-1)+n}};T5.easing=function(k){return l[k.replace(/[\-\_\s\.]/g,"").toLowerCase()]};T5.registerEasingType=function(k,n){l[k.replace(/[\-\_\s\.]/g,
"").toLowerCase()]=n}})();
T5.Tween=function(e){e=T5.ex({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:T5.easing("sine.out"),complete:null,cancelOnInteract:false},e);var m=T5.time(),f=[],b=false,a=0,g=0,h={cancelOnInteract:e.cancelOnInteract,isComplete:function(){return b},triggerComplete:function(d){e.complete&&e.complete(d)},update:function(d){try{var l=e.tweenFn(d-m,a,g,e.duration);if(e.target)e.target[e.property]=l;for(var k=f.length;k--;)f[k](l,void 0);if(b=m+e.duration<=d){if(e.target)e.target[e.property]=
e.tweenFn(e.duration,a,g,e.duration);for(var n=f.length;n--;)f[n](l,true)}}catch(o){GT.Log.exception(o)}},requestUpdates:function(d){f.push(d)}};a=e.target&&e.property&&e.target[e.property]?e.target[e.property]:e.startValue;if(typeof e.endValue!=="undefined")g=e.endValue-a;if(g==0)b=true;T5.wakeTweens();return h};
(function(){var e=[],m=false,f=0;T5.tweenValue=function(b,a,g,h,d){b=new T5.Tween({startValue:b,endValue:a,tweenFn:g,complete:h,duration:d});e.push(b);return b};T5.tween=function(b,a,g,h,d,l){b=new T5.Tween({target:b,property:a,endValue:g,tweenFn:h,duration:l,complete:d});e.push(b);return b};T5.tweenVector=function(b,a,g,h,d,l){var k=[];if(b){var n=b.x==a,o=b.y==g;n||k.push(T5.tween(b,"x",a,h,function(){(n=true)&&o&&d()},l));o||k.push(T5.tween(b,"y",g,h,function(){o=true;n&&o&&d()},l))}return k};
T5.cancelAnimation=function(b){if(!m){m=true;try{for(var a=0;a<e.length;)if(!b||b(e[a])){e[a].triggerComplete(true);e.splice(a,1)}else a++}finally{m=false}}};T5.isTweening=function(){return e.length>0};T5.wakeTweens=function(){if(f===0)f=setInterval(function(){var b;b=T5.time();if(!m){m=true;try{for(var a=0;a<e.length;)if(e[a].isComplete()){e[a].triggerComplete(false);e.splice(a,1)}else{e[a].update(b);a++}}finally{m=false}}b=e.length;if(b===0){clearInterval(f);f=0}},20)}})();
(function(){var e={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,PINCH:16,FREEZE:128};T5.viewState=function(){for(var m=0,f=arguments.length;f--;){var b=e[arguments[f].toUpperCase()];if(b)m|=b}return m}})();
T5.ViewLayer=function(e){e=T5.ex({id:"",zindex:0,supportFastDraw:false,validStates:T5.viewState("ACTIVE","ANIMATING","PAN","PINCH")},e);var m=null,f=e.id,b=T5.viewState("ACTIVE"),a=T5.ex({addToView:function(g){g.setLayer(f,a)},shouldDraw:function(g){var h=m?m.fastDraw&&g!==b:false;return(g&e.validStates)!==0&&(h?e.supportFastDraw:true)},cycle:function(){return 0},draw:function(){},remove:function(){GT.say("layer.remove",{id:f})},wakeParent:function(){m&&m.trigger("wake")},getId:function(){return f},
setId:function(g){f=g},getParent:function(){return m},setParent:function(g){m=g}},e);GT.observable(a);return a};
T5.View=function(e){function m(D,F,M,P){I=typeof M!=="undefined";X=ha;w();J.updateOffset(q.x+D,q.y+F,M,P)}function f(D,F){e.inertia&&m(D,F,e.panAnimationEasing,e.panAnimationDuration)}function b(){X=ea;I=false;setTimeout(w,50)}function a(D,F){V=ja(D);Y=ja(F);var M=G(V.dimensions),P=G(Y.dimensions);W=N(V);y=N(Y);Q=V&&M!==0?P/M:1}function g(D,F){a(D,F);if(Z=Q!==1){X=T;w()}}function h(D,F,M){a(D,F);if(e.adjustScaleFactor){Q=e.adjustScaleFactor(Q);GT.Log.info("scale factor adjusted to: "+Q)}if(M<e.pinchZoomAnimateTrigger){o(ca,
Q,W,r(),T5.easing("sine.out"),function(){l();Q=1},300);Q=ca}else{l();Q=1}}function d(D,F){J.zoom(D,Math.min(Math.pow(2,Math.round(Math.log(F))),8),500)}function l(){Z=false;J.trigger("scale",Q,V?r():y);X=ea;w()}function k(){if(E){T5.resetTouch(E);if(e.autoSize){E.height=window.innerHeight-E.offsetTop;E.width=window.innerWidth-E.offsetLeft}try{p=E.getContext("2d");p.globalCompositeOperation="source-over";p.clearRect(0,0,E.width,E.height)}catch(D){GT.Log.exception(D);throw Error("Could not initialise canvas on specified view element");
}ba=T5.captureTouch(E,{observable:J});e.inertia&&ba.inertiaEnable(e.panAnimationDuration,A);A=J.getDimensions();for(var F=s.length;F--;)layerContextChange(s[F]);w()}}function n(D,F){F.setId(D);F.added=T5.time();F.trigger("contextChanged",p);F.setParent(J);s.push(F);s.sort(function(M,P){var U=P.zindex-M.zindex;if(U===0)U=P.added-M.added;return U})}function o(D,F,M,P,U,da,fa){function ia(){da&&da();l();Q=1;aa=null}Z=true;W=T5.V.copy(M);y=T5.V.copy(P);V=null;if(U)T5.tweenValue(0,F-D,U,ia,fa?fa:1E3).requestUpdates(function(ga){aa=
ga/(F-D);Q=D+ga;X=T;w();J.trigger("animate")});else{Q=targetScaleFactor;ia()}}function r(){var D=T5.D.getCenter(A),F=T5.V.distance([y,D]),M=T5.V.theta(y,D,F),P=T5.V.diff(W,y);D=T5.V.pointOnEdge(y,D,M,F/Q);D.x+=P.x;D.y+=P.y;return D}function B(){J.trigger("idle");H=true;L=0}function u(D,F){var M=0,P=v?T5.viewState("FROZEN"):X,U=T5.time(),da=(P&T)!==0,fa=0;if(t||da){D.clearRect(0,0,E.width,E.height);t=false}if(da){T5.D.getCenter(A);var ia=(aa?aa:1)/2,ga=T5.V.diff(W,y);if(S=V?new T5.Vector(y.x+ga.x,
y.y+ga.y):new T5.Vector(y.x-ga.x*ia,y.y-ga.y*ia))F=T5.V.offset(F,S.x,S.y)}D.save();try{ca=Q;if(x!==1)D.scale(x,x);else if(da){D.translate(y.x,y.y);D.scale(Q,Q)}for(fa=s.length;fa--;)if(s[fa].shouldDraw(P)){var ka=s[fa].draw(D,F,A,P,J);M+=ka?ka:0}}finally{D.restore()}GT.Log.trace("draw complete",U);O=false;return M}function z(){var D=0,F=!I&&(X===T||X===ha);$=T5.time();q.x=Math.floor(q.x);q.y=Math.floor(q.y);if(F){T5.cancelAnimation(function(P){return P.cancelOnInteract});H=false;if(L!==0){clearTimeout(L);
L=0}}for(F=s.length;F--;){var M=s[F].cycle($,q,X);D+=M?M:0}D+=u(p,q);K=0;if(C+D>0)w();else if(!H&&L===0)L=setTimeout(B,500);GT.Log.trace("Completed draw cycle",$)}function w(){C++;if(!(v||K!==0)){C=0;K=setTimeout(z,0)}}e=T5.ex({id:GT.objId("view"),container:"",fastDraw:false,inertia:true,pannable:true,scalable:true,panAnimationEasing:T5.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:false},e);var s=[],E=document.getElementById(e.container),
p=null,q=new T5.Vector,t=false,v=false,x=1,A=null,C=0,y=null,H=false,I=false,K=0,O=false,L=0,R=0,S=null,$=0,Z=false,V=null,Y=null,Q=1,ca=1,aa=null,W=null,ba=null,ea=T5.viewState("ACTIVE"),ha=T5.viewState("PAN"),T=T5.viewState("PINCH"),X=ea,ja=T5.V.getRect,G=T5.D.getSize,N=T5.R.getCenter,J={id:e.id,deviceScaling:x,fastDraw:e.fastDraw||T5.getConfig().requireFastDraw,animate:function(D,F,M,P,U){o(Q,D,F,M,P,U)},centerOn:function(D){J.setOffset(D.x-E.width/2,D.y-E.height/2)},getDimensions:function(){if(E)return new T5.Dimensions(E.width,
E.height)},getZoomCenter:function(){return S},getLayer:function(D){for(var F=0;F<s.length;F++)if(s[F].getId()==D)return s[F];return null},setLayer:function(D,F){for(var M=0;M<s.length;M++)if(s[M].getId()===D){s.splice(M,1);break}F&&n(D,F);w()},eachLayer:function(D){for(var F=0;F<s.length;F++)D(s[F])},clearBackground:function(){t=true},freeze:function(){v=true},unfreeze:function(){v=false;w()},needRepaint:function(){return O},snapshot:function(){},scale:function(D,F,M,P,U){P||(P=T5.D.getCenter(A));
U||(U=T5.D.getCenter(A));J.animate(D,P,U,F,M);return J},removeLayer:function(D){a:{for(var F=s.length;F--;)if(s[F].getId()==D){D=F;break a}D=-1}if(D>=0&&D<s.length){GT.say("layer.removed",{layer:s[D]});s.splice(D,1)}},getOffset:function(){return T5.V.copy(q)},setOffset:function(D,F){q.x=D;q.y=F},updateOffset:function(D,F,M,P,U){function da(){b(0,0);U&&U()}if(M){D=new T5.Vector(D,F);M=T5.tweenVector(q,D.x,D.y,M,da,P);for(P=M.length;P--;){M[P].cancelOnInteract=true;M[P].requestUpdates(w)}}else J.setOffset(D,
F)},zoom:function(D,F,M){I=false;Q=F;Z=Q!==1;W=T5.D.getCenter(J.getDimensions());y=Q>1?T5.V.copy(D):T5.D.getCenter(J.getDimensions());V=null;clearTimeout(R);if(Z){X=T;w();if(M)R=setTimeout(function(){l();Q=1},parseInt(M,10))}}};GT.listen("layer.remove",function(D){D.id&&J.removeLayer(D.id)});x=T5.getConfig().getScaling();GT.observable(J);J.bind("wake",w);J.bind("invalidate",function(){O=true});if(e.pannable){J.bind("pan",m);J.bind("panEnd",b);J.bind("inertiaPan",f);J.bind("inertiaCancel",function(){I=
false;w()})}if(e.scalable){J.bind("pinchZoom",g);J.bind("pinchZoomEnd",h);J.bind("wheelZoom",d)}GT.configurable(J,["inertia","container"],GT.paramTweaker(e,null,{container:function(D,F){E=document.getElementById(F);k()}}),true);k();return J};
T5.AnimatedPathLayer=function(e){function m(d,l,k){d.fillStyle="#FFFFFF";d.strokeStyle="#222222";d.beginPath();d.arc(k.x,k.y,4,0,Math.PI*2,false);d.stroke();d.fill()}e=T5.ex({path:[],id:GT.objId("pathAni"),easing:T5.easing("sine.inout"),validStates:T5.viewState("ACTIVE","PAN","PINCH"),drawIndicator:null,duration:2E3,autoCenter:false},e);var f=T5.V.edges(e.path),b,a=null,g=0;T5.tweenValue(0,f.total,e.easing,function(){h.remove()},e.duration).requestUpdates(function(d,l){g=d;l&&h.remove()});var h=T5.ex(new T5.ViewLayer(e),
{cycle:function(){for(var d=0;d<f.accrued.length&&f.accrued[d]<g;)d++;a=null;if(d<e.path.length-1){var l=g-(d>0?f.accrued[d-1]:0),k=e.path[d],n=e.path[d+1];b=T5.V.theta(k,n,f.edges[d]);a=T5.V.pointOnEdge(k,n,b,l);if(e.autoCenter)(d=h.getParent())&&d.centerOn(a)}return a?1:0},draw:function(d,l){if(a)(e.drawIndicator?e.drawIndicator:m)(d,l,new T5.Vector(a.x-l.x,a.y-l.y),b)}});return h};
(function(){T5.tileSize=256;T5.Tile=function(e){return e=T5.ex({x:0,y:0,gridX:0,gridY:0,dirty:false},e)};T5.ImageTile=function(e){e=T5.ex({url:"",sessionParamRegex:null,loaded:false},e);return new T5.Tile(e)}})();
T5.TileGrid=function(e){function m(v,x){var A=T5.Vector(v*d-n.x,x*d-n.y);return new T5.ImageTile({gridX:A.x,gridY:A.y})}function f(v,x,A,C){var y=Math.floor(e.gridSize*0.2),H=new T5.Vector;if(v<0||v+A>e.gridSize)H.x=v<0?-y:y;if(x<0||x+C>e.gridSize)H.y=x<0?-y:y;return H}function b(v,x,A){var C=GT.Log.getTraceTicks(),y=0,H=e.gridSize,I=e.tileSize;new T5.Vector(H/2,H/2);if(A)g=[];if(v)for(A=0;A<H;A++)for(var K=0;K<H;K++){if(!g[y]){var O=v(K,A,l,H);O.gridX=K*I-n.x;O.gridY=A*I-n.y;g[y]=O}y++}k=v;o=x;GT.Log.trace("tile grid populated",
C);t.dirty=true;t.wakeParent()}function a(v,x){if(q){var A,C=[],y=new T5.Vector(Math.floor((v.x+n.x)*B),Math.floor((v.y+n.y)*B));tilesNeeded=false;for(var H=p;H--;)for(var I=E;I--;){A=I+y.x>=0&&I+y.x<e.gridSize?g[(H+y.y)*e.gridSize+(I+y.x)]:null;var K=new T5.Vector(I-q.x,H-q.y);if(!A){s=f(y.x,y.y,E,p);A=m(I+y.x,H+y.y)}C.push({tile:A,centerness:T5.V.absSize(K)})}C.sort(function(O,L){return L.centerness-O.centerness});z||(z=Array(C.length));for(A=C.length;A--;){z[A]=C[A].tile;t.prepTile(z[A],x)}}}e=
T5.ex({tileSize:T5.tileSize,drawGrid:false,center:new T5.Vector,gridSize:25,shiftOrigin:null,supportFastDraw:true},e);var g=Array(Math.pow(e.gridSize,2)),h=e.gridSize,d=e.tileSize,l=T5.V.offset(e.center,-Math.ceil(e.gridSize>>1)),k=null,n=new T5.Vector,o=null,r=Math.round(e.tileSize/2),B=e.tileSize?1/e.tileSize:0,u=true,z=null,w=false;new T5.Vector;var s=new T5.Vector;T5.getConfig();h=h*e.tileSize;var E,p,q,t=T5.ex(new T5.ViewLayer(e),{gridDimensions:new T5.Dimensions(h,h),dirty:false,cycle:function(v,
x,A){v=0;if(s.x!==0||s.y!==0){var C=s,y=e.shiftOrigin;if(!(C.x===0&&C.y===0)){var H=GT.Log.getTraceTicks(),I=Array(g.length);I.length=g.length;for(var K=0;K<e.gridSize;K++)for(var O=0;O<e.gridSize;O++)I[O*e.gridSize+K]=K+C.x>=0&&K+C.x<e.gridSize?g[(O+C.y)*e.gridSize+(K+C.x)]:null;g=I;l=y?y(l,C):T5.V.add(l,C);n.x+=-C.x*e.tileSize;n.y+=-C.y*e.tileSize;GT.Log.trace("tile storage shifted",H);b(k,o)}s=new T5.Vector;v++}A!==T5.viewState("PINCH")&&a(x,A);return v+t.dirty?1:0},deactivate:function(){u=false},
find:function(v){if(!v)return null;for(var x=g.length;x--;){var A=g[x];if(A&&v(A))return A}return null},prepTile:function(){},drawTile:function(){return false},getTileSize:function(){return e.tileSize},draw:function(v,x,A,C,y){if(u){var H=T5.time(),I=x.x;x=x.y;var K=true,O=y.needRepaint()||C===T5.viewState("PAN")||C===T5.viewState("PINCH")||T5.isTweening();if(!q){E=Math.ceil(A.width*B)+1;p=Math.ceil(A.height*B)+1;q=new T5.Vector(Math.floor((E-1)/2),Math.floor((p-1)/2))}if(z){if(e.drawGrid)v.strokeStyle=
"rgba(50, 50, 50, 0.3)";v.beginPath();for(A=z.length;A--;){var L=z[A];if(L){var R=L.gridX-I,S=L.gridY-x;if(!(O?false:!L.dirty)){K=t.drawTile(v,L,R,S,C)&&K;L.x=R;L.y=S}}else K=false;e.drawGrid&&v.rect(R,S,e.tileSize,e.tileSize)}v.stroke();GT.Log.trace("drawn tiles",H);K&&!w&&y.trigger("tileDrawComplete");w=K;t.dirty=false}}},getTileAtXY:function(v,x){for(var A=e.tileSize,C=z?z.length:0;C--;){var y=z[C];if(y&&v>=y.x&&x>=y.y)if(v<=y.x+A&&x<=y.y+A)return y}return null},getTileVirtualXY:function(v,x,A){v=
T5.V.add(new T5.Vector(v,x),T5.V.invert(l),n);v=new T5.Vector(v.x*e.tileSize,v.y*e.tileSize);if(A){v.x+=r;v.y+=r}return v},populate:function(v){b(v,null,true)}});GT.listen("imagecache.cleared",function(){for(var v=g.length;v--;)if(g[v])g[v].loaded=false});GT.listen("tiler.repaint",function(){for(var v=g.length;v--;)if(g[v]){g[v].x=null;g[v].y=null}});return t};
T5.ImageTileGrid=function(e){function m(){o.getParent().trigger("invalidate");o.dirty=true;o.wakeParent()}e=T5.ex({emptyTile:function(r){if(!f||r!==f.width){f=T5.newCanvas(r,r);r=f.getContext("2d");r.fillStyle="rgba(150, 150, 150, 0.01)";r.fillRect(0,0,f.width,f.height)}return f}(T5.tileSize),panningTile:function(r){function B(){var u=T5.newCanvas(32,32),z=u.getContext("2d");z.fillStyle="#BBBBBB";z.fillRect(0,0,32,32);z.fillStyle="#C3C3C3";z.fillRect(0,0,16,16);z.fillRect(16,16,16,16);return u}if(!b||
r!==b.width){b=T5.newCanvas(r,r);r=b.getContext("2d");r.fillStyle=r.createPattern(B(),"repeat");r.fillRect(0,0,b.width,b.height)}return b}(T5.tileSize),tileOffset:new T5.Vector,tileDrawArgs:{}},e);var f=e.emptyTile,b=e.panningTile,a=T5.viewState("ACTIVE"),g=T5.viewState("PAN"),h=T5.getConfig().requireFastDraw,d=e.tileSize?e.tileSize:T5.tileSize,l=T5.Images.get,k=T5.Images.load,n=T5.ex({background:null,overlay:null,offset:new T5.Vector,realSize:new T5.Dimensions(d,d)},e.tileDrawArgs),o=T5.ex(new T5.TileGrid(e),
{drawTile:function(r,B,u,z,w){var s=B.url?l(B.url):null,E=false;if(s){r.drawImage(s,u,z);B.dirty=false;E=true}else if(w===g)b&&r.drawImage(b,u,z);else f&&r.drawImage(f,u,z);return E},prepTile:function(r,B){if(r)r.dirty=true;if(r&&(!h||B===a))l(r.url)||k(r.url,m,n)}});return o};
T5.Tiler=function(e){e=T5.ex({container:"",drawCenter:false,datasources:{},tileLoadThreshold:"first"},e);var m=T5.ex(new T5.View(e),{getTileLayer:function(){return m.getLayer("grid0")},setTileLayer:function(f){m.setLayer("grid0",f);GT.say("grid.updated",{id:"grid0"})},viewPixToGridPix:function(f){var b=m.getOffset();return new T5.Vector(f.x+b.x,f.y+b.y)},centerOn:function(f,b,a,g){var h=m.getTileLayer(),d=m.getDimensions();(h=h?h.getTileSize():0)&&m.updateOffset(f.gridX-Math.floor((d.width-h)*0.5),
f.gridY-Math.floor((d.height-h)*0.5),b,a,g)},cleanup:function(){m.removeLayer("grid0")},repaint:function(){GT.say("tiler.repaint");m.trigger("wake")},select:function(f){m.trigger("selectTile",f)}});m.bind("tap",function(f,b){var a=m.getTileLayer();if(a)(a=a.getTileAtXY(b.x,b.y))&&m.trigger("selectTile",a)});return m};
T5.Geo=function(){function e(p,q){var t=null;for(var v in s)if(q){if(v==q&&s[v][p]){t=s[v];break}}else if(s[v][p]){t=s[v];break}return t}function m(p,q){var t=l*Math.sin(p);return h-2*Math.atan(q*Math.pow((1-t)/(1+t),l/2))}function f(p,q,t,v){var x=0;p=p.toUpperCase();for(var A in v){var C=q[A];if(C){var y=t[A];C=y?y(p,C):GT.wordExists(p,C)?1:0;x+=C*v[A]}}return x}var b=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],a=Math.PI/180,g=180/Math.PI,h=Math.PI/
2,d=Math.PI*2,l=0.08181919084262157,k=null,n={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",HWY:"HIGHWAY",MWY:"MOTORWAY"},o=function(p,q){return{lat:parseFloat(p?p:0),lon:parseFloat(q?q:0)}},r=function(p,q){return{min:u.parse(p),max:u.parse(q)}},B=function(p){return p=T5.ex({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},p)},u=function(){var p={calcDistance:function(q,t){if(p.empty(q)||p.empty(t))return 0;var v=(t.lat-q.lat)*a/2,x=(t.lon-
q.lon)*a/2;v=Math.sin(v)*Math.sin(v)+Math.cos(q.lat*a)*Math.cos(t.lat*a)*Math.sin(x)*Math.sin(x);return 6371*2*Math.atan2(Math.sqrt(v),Math.sqrt(1-v))},copy:function(q){return q?new o(q.lat,q.lon):null},empty:function(q){return!q||q.lat===0&&q.lon===0},equal:function(q,t){return q&&t&&q.lat==t.lat&&q.lon==t.lon},almostEqual:function(q,t){return q&&t&&Math.floor(q.lat*1E3)===Math.floor(t.lat*1E3)&&Math.floor(q.lon*1E3)===Math.floor(t.lon*1E3)},inArray:function(q,t){for(var v=u.equal,x=t.length;x--;)if(v(q,
t[x]))return true;return false},inBounds:function(q,t){var v=!(u.empty(q)||u.empty(t));return v=(v=v&&q.lat>=t.min.lat&&q.lat<=t.max.lat)&&q.lon>=t.min.lon&&q.lon<=t.max.lon},parse:function(q){if(q)if(typeof q.lat!=="undefined")return p.copy(q);else{if(q.split)for(var t=[" ",","],v=0;v<t.length;v++){var x=q.split(t[v]);if(x.length===2)return new o(x[0],x[1])}}else return new o;return null},parseArray:function(q){var t=q.length,v=Array(t);for(t=t;t--;)v[t]=p.parse(q[t]);GT.Log.info("parsed "+v.length+
" positions");return v},fromMercatorPixels:function(q,t,v){return new o(T5.Geo.pix2lat(t,v),T5.Geo.normalizeLon(T5.Geo.pix2lon(q,v)))},toMercatorPixels:function(q,t){return new T5.Vector(T5.Geo.lon2pix(q.lon,t),T5.Geo.lat2pix(q.lat,t))},generalize:function(q,t,v){var x=q.length,A=[],C=null;v||(v=250);v/=1E3;GT.Log.info("generalizing positions, must include "+t.length+" positions");for(var y=x;y--;)if(y===0)A.unshift(q[y]);else{var H=!C||u.inArray(q[y],t)?v:u.calcDistance(C,q[y]);if(q[y]&&H>=v){A.unshift(q[y]);
C=q[y]}}GT.Log.info("generalized "+x+" positions into "+A.length+" positions");return A},toString:function(q){return q?q.lat+" "+q.lon:""}};return p}(),z=function(){var p=-h,q=h,t=-d,v={calcSize:function(x,A,C){var y=new T5.Vector(0,A.lat-x.lat);if(typeof C==="undefined")C=true;y.x=C&&x.lon>A.lon?360-x.lon+A.lon:A.lon-x.lon;return y},createBoundsFromCenter:function(x,A){var C=A/6371,y=x.lat*a,H=x.lon*a,I=y-C,K=y+C;if(I>p&&K<q){y=Math.asin(Math.sin(C)/Math.cos(y));C=H-y;if(C<t)C+=2*Math.PI;H=H+y;if(H>
d)H-=2*Math.PI}else{I=Math.max(I,p);K=Math.min(K,q);C=t;H=d}return new r(new o(I*g,C*g),new o(K*g,H*g))},expand:function(x,A){return new r(new o(x.min.lat-A,x.min.lon-E.normalizeLon(A)),new o(x.max.lat+A,x.max.lon+E.normalizeLon(A)))},forPositions:function(x,A){var C=null,y=T5.time();A||(A="auto");for(var H=x.length;H--;)if(C){var I=v.calcSize(C.min,x[H],false),K=v.calcSize(x[H],C.max,false);if(I.x<0)C.min.lon=x[H].lon;if(I.y<0)C.min.lat=x[H].lat;if(K.x<0)C.max.lon=x[H].lon;if(K.y<0)C.max.lat=x[H].lat}else C=
new T5.Geo.BoundingBox(x[H],x[H]);if(A){if(A=="auto"){H=v.calcSize(C.min,C.max);A=Math.max(H.x,H.y)*0.3}C=v.expand(C,A)}GT.Log.trace("calculated bounds for "+x.length+" positions",y);return C},getCenter:function(x){var A=z.calcSize(x.min,x.max);return new T5.Geo.Position(x.min.lat+A.y/2,x.min.lon+A.x/2)},getGeoHash:function(x){var A=T5.Geo.GeoHash.encode(x.min.lat,x.min.lon);x=T5.Geo.GeoHash.encode(x.max.lat,x.max.lon);GT.Log.info("min hash = "+A+", max hash = "+x)},getZoomLevel:function(x,A){var C=
v.getCenter(x),y=b[Math.min(Math.round(Math.abs(C.lat)*0.05),b.length)],H=v.calcSize(x.min,x.max);C=Math.ceil(Math.log(b[3]*A.height/H.y)/Math.log(2));y=Math.ceil(Math.log(y*A.width/H.x)/Math.log(2));return Math.min(isNaN(C)?1E3:C,isNaN(y)?1E3:y)},isEmpty:function(x){return!x||u.empty(x.min)||u.empty(x.max)},toString:function(x){return"min: "+u.toString(x.min)+", max: "+u.toString(x.max)}};return v}(),w=function(){var p=/^(\d+).*$/,q=/(\d+)\s?\-\s?(\d+)/;return{buildingMatch:function(t,v){p.lastIndex=
-1;if(p.test(t))for(var x=t.replace(p,"$1"),A=v.split(","),C=0;C<A.length;C++){q.lastIndex=-1;if(q.test(A[C])){var y=q.exec(A[C]);if(x>=parseInt(y[1],10)&&x<=parseInt(y[2],10))return true}else if(x==A[C])return true}return false},normalize:function(t){if(!t)return"";t=t.toUpperCase();if(!k){var v=[];for(var x in n)v.push(x);k=RegExp("(\\s)("+v.join("|")+")(\\s|$)","i")}k.lastIndex=-1;if(v=k.exec(t))t=t.replace(k,"$1"+n[v[2]]);return t},toString:function(t){return t.streetDetails+" "+t.location}}}(),
s={},E={Engine:function(p){if(!p.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var q=T5.ex({remove:function(){delete s[q.id]}},p);return s[q.id]=q},Radius:function(p,q){return{distance:parseInt(p,10),uom:q}},Position:o,BoundingBox:r,Address:B,GeocodeFieldWeights:{streetDetails:50,location:50},AddressCompareFns:{},GeoSearchResult:function(p){p=T5.ex({id:null,caption:"",resultType:"",data:null,pos:null,matchWeight:0},p);return T5.ex(p,{toString:function(){return p.caption+
(p.matchWeight?" ("+p.matchWeight+")":"")}})},GeoSearchAgent:function(p){return new T5.Dispatcher.Agent(p)},GeocodingAgent:function(p){p=T5.ex({name:"Geocoding Search Agent",paramTranslator:null,execute:function(q,t){try{if(!q.reverse&&!q.freeform)address=new B(q);var v=E.getEngine("geocode");if(v)v.geocode({addresses:[q.freeform?q.freeform:address],complete:function(A,C){if(t){var y=C;if(q.freeform)y=E.rankGeocodeResponses(q.freeform,y,E.getEngine("geocode"));t(y,p)}}})}catch(x){GT.Log.exception(x)}}},
p);return new E.GeoSearchAgent(p)},PointOfInterest:function(p){p=T5.ex({id:0,title:"",pos:null,lat:"",lon:"",group:"",retrieved:0,isNew:true},p);if(!p.pos&&p.lat&&p.lon)p.pos=new T5.Geo.Position(p.lat,p.lon);return T5.ex({toString:function(){return p.id+": '"+p.title+"'"}},p)},POIStorage:function(p){function q(y){y=y?y:"default";x[y]||(x[y]=[]);return x[y]}function t(y){var H=[];for(var I in x)for(var K=0;K<x[I].length;K++)if(!y||y(x[I][K]))H.push(x[I][K]);return H}function v(){GT.say("geo.pois-updated",
{srcID:C.id,pois:C.getPOIs()})}p=T5.ex({visibilityChange:null,onPOIDeleted:null,onPOIAdded:null},p);var x={},A=true,C={id:GT.objId(),getPOIs:function(){return t()},getOldPOIs:function(y,H){return t(function(I){return I.group==y&&I.retrieved<H})},getVisible:function(){return A},setVisible:function(y){if(y!=A){A=y;p.visibilityChange&&p.visibilityChange()}},findById:function(y){var H=t(function(I){return I.id==y});return H.length>0?H[0]:null},findByBounds:function(y){return t(function(H){return T5.Geo.P.inBounds(H.pos,
y)})},addPOIs:function(y,H){if(H)x={};for(var I=0;y&&I<y.length;I++){y[I].retrieved=T5.time();var K=y[I];q(K.group).push(K)}},removeGroup:function(y){if(x[y]){delete x[y];v()}},update:function(y){var H=[],I=0,K=y.length>0?y[0].group:"",O=T5.time();for(I=0;I<y.length;I++){var L;a:{if(L=y[I])for(var R=q(L.group),S=0;S<R.length;S++)if(R[S].id==L.id){L=R[S];break a}L=null}if(L){L.retrieved=O;L.isNew=false}else H.push(y[I])}y=C.getOldPOIs(K,O);C.addPOIs(H);for(I=0;p.onPOIAdded&&I<H.length;I++)p.onPOIAdded(H[I]);
for(I=0;I<y.length;I++){p.onPOIDeleted&&p.onPOIDeleted(y[I]);K=y[I];O=q(K.group);for(L=0;L<O.length;L++)if(O[L].id==K.id){O.splice(L,1);break}}H.length+y.length>0&&v()}};return C},MapProvider:function(){var p=1,q=20;return{zoomLevel:0,checkZoomLevel:function(t){return Math.min(Math.max(t,p),q)},getCopyright:function(){},getLogoUrl:function(){},getMapTiles:function(){},getZoomRange:function(){return{min:p,max:q}},setZoomRange:function(t,v){p=t;q=v}}},getEngine:function(p){for(var q=null,t=1;!q&&t<
arguments.length;t++)q=e(p,arguments[t]);q=q?q:e(p);if(!q)throw Error("Unable to find GEO engine with "+p+" capability");return q},rankGeocodeResponses:function(p,q,t){var v=[],x=E.AddressCompareFns;if(t&&t.compareFns)x=T5.ex({},x,t.compareFns);for(t=0;t<q.length;t++)v.push(new E.GeoSearchResult({caption:w.toString(q[t]),data:q[t],pos:q[t].pos,matchWeight:f(p,q[t],x,E.GeocodeFieldWeights)}));v.sort(function(A,C){return C.matchWeight-A.matchWeight});return v},P:u,B:z,A:w,dist2rad:function(p){return p/
6371},lat2pix:function(p,q){var t=parseFloat(p)*2*Math.PI/360;t=Math.sin(t);var v=l*t;return Math.log((1+t)/(1-t)*Math.pow((1-v)/(1+v),l))/2/q},lon2pix:function(p,q){return parseFloat(p)/180*Math.PI/q},pix2lon:function(p,q){return E.normalizeLon(p*q*180/Math.PI)},pix2lat:function(p,q){for(var t=Math.pow(Math.E,-p*q),v=h-2*Math.atan(t),x=m(v,t),A=0;A<12&&Math.abs(v-x)>1.0E-7;){v=x;x=m(v,t);A++}return x*180/Math.PI},normalizeLon:function(p){for(;p<-180;)p+=360;for(;p>180;)p-=360;return p}};return E}();
T5.Geo.GeoHash=function(){function e(m,f,b){if(f&b)m[0]=(m[0]+m[1])/2;else m[1]=(m[0]+m[1])/2}BITS=[16,8,4,2,1];BASE32="0123456789bcdefghjkmnpqrstuvwxyz";NEIGHBORS={right:{even:"bc01fg45238967deuvhjyznpkmstqrwx"},left:{even:"238967debc01fg45kmstqrwxuvhjyznp"},top:{even:"p0r21436x8zb9dcf5h7kjnmqesgutwvy"},bottom:{even:"14365h7k9dcfesgujnmqp0r2twvyx8zb"}};BORDERS={right:{even:"bcfguvyz"},left:{even:"0145hjnp"},top:{even:"prxz"},bottom:{even:"028b"}};NEIGHBORS.bottom.odd=NEIGHBORS.left.even;NEIGHBORS.top.odd=
NEIGHBORS.right.even;NEIGHBORS.left.odd=NEIGHBORS.bottom.even;NEIGHBORS.right.odd=NEIGHBORS.top.even;BORDERS.bottom.odd=BORDERS.left.even;BORDERS.top.odd=BORDERS.right.even;BORDERS.left.odd=BORDERS.bottom.even;BORDERS.right.odd=BORDERS.top.even;return{decode:function(m){var f=1,b=[],a=[];b[0]=-90;b[1]=90;a[0]=-180;a[1]=180;lat_err=90;lon_err=180;for(i=0;i<m.length;i++){c=m[i];cd=BASE32.indexOf(c);for(j=0;j<5;j++){mask=BITS[j];if(f){lon_err/=2;e(a,cd,mask)}else{lat_err/=2;e(b,cd,mask)}f=!f}}b[2]=(b[0]+
b[1])/2;a[2]=(a[0]+a[1])/2;return{latitude:b,longitude:a}},encode:function(m,f,b){var a=1,g=[],h=[],d=0,l=0;b=b?b:12;geohash="";g[0]=-90;g[1]=90;h[0]=-180;for(h[1]=180;geohash.length<b;){if(a){mid=(h[0]+h[1])/2;if(f>mid){l|=BITS[d];h[0]=mid}else h[1]=mid}else{mid=(g[0]+g[1])/2;if(m>mid){l|=BITS[d];g[0]=mid}else g[1]=mid}a=!a;if(d<4)d++;else{geohash+=BASE32[l];l=d=0}}return geohash}}}();
T5.Geo.Search=function(){return{bestResults:function(e,m){m||(m=20);for(var f=e.length>0?e[0]:null,b=[],a=0;a<e.length;a++)if(f&&e[a]&&f.matchWeight-e[a].matchWeight<=m)b.push(e[a]);else break;return b}}}();
T5.Geo.Routing=function(){var e={calculate:function(m){m=T5.ex({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},m);GT.Log.info("attempting to calculate route");var f=T5.Geo.getEngine("route");f&&f.route(m,function(b){if(m.generalize)b.geometry=T5.Geo.P.generalize(b.geometry,b.getInstructionPositions());if(m.map){e.createMapOverlay(m.map,b);if(m.autoFit){GT.Log.info("AUTOFITTING MAP TO ROUTE: bounds = "+b.boundingBox);m.map.gotoBounds(b.boundingBox)}}m.success&&
m.success(b)})},createMapOverlay:function(m,f){var b=m.getDimensions();b=new T5.Geo.UI.RouteOverlay({data:f,width:b.width,height:b.height});m.setLayer("route",b)},parseTurnType:function(m){for(var f=e.TurnType.Unknown,b=T5.Geo.Routing.TurnTypeRules,a=0;a<b.length;a++){b[a].regex.lastIndex=-1;var g=b[a].regex.exec(m);if(g){f=b[a].customCheck?b[a].customCheck(m,g):b[a].turnType;break}}return f},TurnType:{Unknown:"turn-unknown",Start:"turn-none-start",Continue:"turn-none",Arrive:"turn-none-arrive",TurnLeft:"turn-left",
TurnLeftSlight:"turn-left-slight",TurnLeftSharp:"turn-left-sharp",TurnRight:"turn-right",TurnRightSlight:"turn-right-slight",TurnRightSharp:"turn-right-sharp",Merge:"merge",UTurnLeft:"uturn-left",UTurnRight:"uturn-right",EnterRoundabout:"roundabout-enter",Ramp:"ramp",RampExit:"ramp-exit"},Instruction:function(m){m=T5.ex({position:null,description:"",turnType:null},m);if(!m.turnType)m.turnType=e.parseTurnType(m.description);return m},RouteData:function(m){m=T5.ex({geometry:[],instructions:[],boundingBox:null},
m);if(!m.boundingBox)m.boundingBox=T5.Geo.B.forPositions(m.geometry);return T5.ex({getInstructionPositions:function(){for(var f=[],b=0;b<m.instructions.length;b++)m.instructions[b].position&&f.push(m.instructions[b].position);return f}},m)}};return e}();
T5.Geo.Routing.TurnTypeRules=function(){var e=T5.Geo.Routing.TurnType,m=[];m.push({regex:/continue/i,turnType:e.Continue});m.push({regex:/(take|bear|turn)(.*?)left/i,customCheck:function(f,b){return/bear/i.test(b[1])?e.TurnLeftSlight:e.TurnLeft}});m.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(f,b){return/bear/i.test(b[1])?e.TurnRightSlight:e.TurnRight}});m.push({regex:/enter\s(roundabout|rotaty)/i,turnType:e.EnterRoundabout});m.push({regex:/take.*?ramp/i,turnType:e.Ramp});m.push({regex:/take.*?exit/i,
turnType:e.RampExit});m.push({regex:/make(.*?)u\-turn/i,customCheck:function(f,b){return/right/i.test(b[1])?e.UTurnRight:e.UTurnLeft}});m.push({regex:/proceed/i,turnType:e.Start});m.push({regex:/arrive/i,turnType:e.Arrive});m.push({regex:/fell\sthrough/i,turnType:e.Merge});return m}();
T5.Geo.UI=function(){var e=0,m={AnnotationTween:null,GeoTileGrid:function(f){f=T5.ex({grid:null,centerPos:new T5.Geo.Position,centerXY:new T5.Vector,radsPerPixel:0},f);var b=T5.Geo.P.toMercatorPixels(f.centerPos,f.radsPerPixel),a=b.x-f.centerXY.x,g=b.y-f.centerXY.y,h=T5.ex({},f.grid,{getBoundingBox:function(d,l,k,n){return new T5.Geo.BoundingBox(h.pixelsToPos(new T5.Vector(d,l+n)),h.pixelsToPos(new T5.Vector(d+k,l)))},getGridXYForPosition:function(d){d=T5.Geo.P.toMercatorPixels(d,f.radsPerPixel);
return new T5.Vector(d.x-a,h.gridDimensions.height-(d.y-g))},getPixelDistance:function(d){d=T5.Geo.dist2rad(d);return Math.floor(d/f.radsPerPixel)},pixelsToPos:function(d){return T5.Geo.P.fromMercatorPixels(a+d.x,g+h.gridDimensions.height-d.y,f.radsPerPixel)}});return h},RouteOverlay:function(f){f=T5.ex({data:null,pixelGeneralization:8,calculationsPerCycle:250,partialDraw:false,strokeStyle:"rgba(0, 51, 119, 0.9)",waypointFillStyle:"#FFFFFF",lineWidth:4,zindex:50},f);var b=true,a=null,g=[],h=0,d=[],
l=[],k=T5.ex(new T5.ViewLayer(f),{getAnimation:function(n,o,r,B){if(b)return null;var u="routeAnimation"+e++;l.push(u);return new T5.AnimatedPathLayer({id:u,path:g,zindex:f.zindex+1,easing:n?n:T5.T5.easing("sine.inout"),duration:o?o:5E3,drawIndicator:r,autoCenter:B?B:false})},draw:function(n,o,r,B,u){r=0;B=f.data?f.data.geometry:null;if(b){b=false;a=null;g=[];h=0}if(B&&h<B.length){a:{u=u.getTileLayer();d=[];if(u){B=GT.Log.getTraceTicks();var z,w,s,E=f.data?f.data.geometry:[],p=E.length,q=f.data?f.data.instructions:
[],t=q.length,v=f.calculationsPerCycle,x=0;for(z=h;z<p;z++){w=u.getGridXYForPosition(E[z]);if(s=!a||z===0||Math.abs(w.x-a.x)+Math.abs(w.y-a.y)>f.pixelGeneralization){g.push(w);a=w}x++;if(x>=v){h=z;break a}}h=p;GT.Log.trace(p+" geometry points generalized to "+g.length+" coordinates",B);a=null;for(z=t;z--;)if(q[z].position){w=u.getGridXYForPosition(q[z].position);if(s=!a||z===0||Math.abs(w.x-a.x)+Math.abs(w.y-a.y)>f.pixelGeneralization){d.push(w);a=w}}}}r++}u=g.length;if(u>0&&(!r||f.partialDraw)){n.strokeStyle=
f.strokeStyle;n.lineWidth=f.lineWidth;n.beginPath();n.moveTo(g[u-1].x-o.x,g[u-1].y-o.y);for(u=u;u--;)n.lineTo(g[u].x-o.x,g[u].y-o.y);n.stroke();n.fillStyle=f.waypointFillStyle;for(u=d.length;u--;){n.beginPath();n.arc(d[u].x-o.x,d[u].y-o.y,2,0,Math.PI*2,false);n.stroke();n.fill()}}return r}});GT.listen("grid.updated",function(){for(var n=l.length;n--;)GT.say("layer.remove",{id:l[n]});l=[];b=true;k.wakeParent()});return k},Annotation:function(f){f=T5.ex({xy:null,pos:null,draw:null,calcXY:null,tweenIn:m.AnnotationTween,
animationSpeed:null},f);var b=false,a={xy:f.xy,pos:f.pos,isNew:true,isAnimating:function(){return b},calcXY:function(g){a.xy=g.getGridXYForPosition(a.pos);f.calcXY&&f.calcXY(g)},draw:function(g,h,d,l,k){if(a.xy){if(a.isNew&&f.tweenIn){var n=a.xy.y;a.xy.y=h.y-20;b=true;T5.tween(a.xy,"y",n,f.tweenIn,function(){a.xy.y=n;b=false},f.animationSpeed?f.animationSpeed:250+Math.random()*500)}if(f.draw)f.draw(g,h,new T5.Vector(a.xy.x-h.x,a.xy.y-h.y),d,l,k);else{g.beginPath();g.arc(a.xy.x-h.x,a.xy.y-h.y,4,0,
Math.PI*2,false);g.fill()}a.isNew=false}}};return a},ImageAnnotation:function(f){f=T5.ex({imageUrl:null,animatingImageUrl:null,imageAnchor:null},f);var b=f.imageAnchor?T5.V.invert(f.imageAnchor):null;f.draw=function(g,h,d,l,k){if(f.animatingImageUrl&&a.isAnimating()){T5.Images.load(f.imageUrl);l=f.animatingImageUrl}else l=f.imageUrl;if(h=T5.Images.get(l)){if(h.complete&&h.width>0){b||(b=new T5.Vector(-h.width>>1,-h.height>>1));d=T5.V.offset(d,b.x,b.y);g.drawImage(h,d.x,d.y,h.width,h.height)}}else T5.Images.load(l,
function(){k.wakeParent()})};var a=new m.Annotation(f);return a},LocationAnnotation:function(f){f=T5.ex({accuracy:null},f);var b=new Image,a=new T5.Vector,g=null;b.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAACIQAAAiEBPhEQkwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAG+SURBVCiRlZHNahNRAIW/O7mTTJPahLZBA1YUyriINRAE3bQIKm40m8K8gLj0CRQkO32ELHUlKbgoIu4EqeJPgtCaoBuNtjXt5LeTMZk0mbmuWiuuPLsD3+HAOUIpxf9IHjWmaUbEyWv5ROrsVULhcHP761rUfnN3Y2Otc8CIg4YT85lzuVsPP+Qupw1vpPjRCvhS9ymvV0e77x7nNj+uvADQAIQQ+uLyvdfLV9JGZi7EdEwQlqBpEJ019f0z1mo2u5Q8DMydv25lshemmj1FueZTawbs7inarqLbV7Qjab1upB9YlhWSAHLavLHZCvg1VEhN0PMU9W7At4bPVidg7CtkLLXkut+lBPD6/Ub155jJiADAHSpaLmx3ApyBQoYEUd0PBoOBkAC6+3llvda/YxgGgYL+UNHf/zN3KiExGlsvTdP0NYDkhPdWrz35ZDsBzV5wCMuQwEyFmXFeeadjzfuFQmGkAZRKpdGC/n7x+M6jqvA9Zo6FWDhlcHE+wqT93J1tP7vpOE7rrx8ALMuasPf8S12St4WmJ6bYWTUC52k8Hm8Vi0X/nwBAPp/XKpWKdF1X2LYdlMvlsToC/QYTls7DLFr/PAAAAABJRU5ErkJggg%3D%3D";
b.onload=function(){a=new T5.Vector(b.width/2,b.height/2)};var h=new m.Annotation(T5.ex({calcXY:function(d){g=Math.floor(d.getPixelDistance(h.accuracy)*0.5)},draw:function(d,l,k,n,o,r){l=k.x-a.x;n=k.y-a.y;if(g&&h.drawAccuracyIndicator){d.fillStyle="rgba(30, 30, 30, 0.2)";d.beginPath();d.arc(k.x,k.y,g,0,Math.PI*2,false);d.fill()}b.complete&&b.width>0&&d.drawImage(b,l,n,b.width,b.height);r.trigger("invalidate")}},f));h.accuracy=f.accuracy;h.drawAccuracyIndicator=false;return h},AnnotationsOverlay:function(f){function b(l){var k=
f.map?f.map.getTileLayer():null,n=l.length;if(k)for(n=n;n--;)l[n].calcXY(k);l.sort(function(o,r){var B=r.xy.y-o.xy.y;if(B===0)B=r.xy.x-o.xy.x;return B})}f=T5.ex({pois:null,map:null,zindex:100},f);var a=[],g=false,h=[],d=T5.ex(new T5.ViewLayer(f),{cycle:function(){return g?1:0},draw:function(l,k,n,o,r){g=false;l.fillStyle="rgba(255, 0, 0, 0.75)";l.globalCompositeOperation="source-over";for(n=a.length;n--;){a[n].draw(l,k,o,d,r);g=g||a[n].isAnimating()}for(n=h.length;n--;){h[n].draw(l,k,o,d,r);g=g||
h[n].isAnimating()}return g?1:0},add:function(l){h.push(l);b(h);d.wakeParent()},clear:function(l){h=[];b(h);if(l){a=[];b(a)}d.wakeParent()}});GT.listen("geo.pois-updated",function(l){if(f.pois&&f.pois.id==l.srcID){l=l.pois;try{a=[];for(var k=0;k<l.length;k++)if(l[k].pos){var n;var o=l[k];if(o&&o.pos){var r={poi:o,annotation:null};f.map&&f.map.trigger("getAnnotationForPOI",r);if(!r.annotation)r.annotation=new m.Annotation({pos:o.pos});if(r.annotation){r.annotation.isNew=o.isNew;o.isNew=false}n=r.annotation}else n=
void 0;n&&a.push(n)}b(a)}catch(B){GT.Log.exception(B)}d.wakeParent()}});GT.listen("grid.updated",function(){b(a);b(h);d.wakeParent()});return d}};return m}();
T5.Map=function(e){function m(s){try{var E=new T5.Geo.Position(s.coords.latitude,s.coords.longitude),p=s.coords.accuracy/1E3;w.trigger("locationUpdate",s,p);if(u){if(!o){o=new T5.Geo.UI.LocationAnnotation({pos:E,accuracy:p});w.bind("tileDrawComplete",function(){o.drawAccuracyIndicator=true})}e.displayLocationAnnotation&&l.add(o);var q=T5.Geo.B.createBoundsFromCenter(E,Math.max(p,1));w.gotoBounds(q)}else{o.pos=E;o.accuracy=p;o.calcXY(w.getTileLayer());w.panToPosition(E,null,T5.easing("sine.out"))}u=
false}catch(t){GT.Log.exception(t)}}function f(s){GT.Log.info("caught location tracking error:",s)}e=T5.ex({tapExtent:10,provider:null,crosshair:false,zoomLevel:0,boundsChangeThreshold:30,pois:new T5.Geo.POIStorage,displayLocationAnnotation:true,zoomAnimation:T5.easing("quad.out")},e);var b={NONE:0,SINGLE:1,WATCH:2},a=new T5.Vector,g=b.NONE,h=false,d=[],l=null,k=null,n=null,o=null,r=0,B=false,u=true,z=e.zoomLevel;if(!e.provider)e.provider=new T5.Geo.MapProvider;e.adjustScaleFactor=function(s){return Math.pow(2,
(s<1?Math.floor:Math.ceil)(Math.log(s)))};var w=T5.ex({},new T5.Tiler(e),{pois:e.pois,annotations:null,getBoundingBox:function(){var s=w.getTileLayer(),E=w.getOffset(),p=w.getDimensions();if(s)return s.getBoundingBox(E.x,E.y,p.width,p.height);return null},getCenterPosition:function(){return w.getXYPosition(T5.D.getCenter(w.getDimensions()))},getXYPosition:function(s){return w.getTileLayer().pixelsToPos(w.viewPixToGridPix(s))},gotoBounds:function(s,E){var p=T5.Geo.B.getZoomLevel(s,w.getDimensions());
w.gotoPosition(T5.Geo.B.getCenter(s),p,E)},gotoPosition:function(s,E,p){function q(A){w.setTileLayer(A);n=A.getId();w.panToPosition(s,function(){w.unfreeze();w.trigger("zoomLevelChange",z);p&&p()});h=true;B=false}var t=z,v=!h,x=w.getBoundingBox();if(x)v=v||!T5.Geo.P.inBounds(s,x);z=E?E:z;if(!z)throw Error("Zoom level required to goto a position.");if(e.provider)z=e.provider.checkZoomLevel(z);if(v||z!==t)if(B)GT.Log.warn("Tile request in progress, aborting");else{T5.Images.cancelLoad();if(o)o.drawAccuracyIndicator=
false;(E=w.getTileLayer())&&E.deactivate();T5.cancelAnimation();h&&w.freeze();B=true;e.provider.zoomLevel=z;e.provider.getMapTiles(w,s,q)}else w.panToPosition(s,p)},panToPosition:function(s,E,p){var q=w.getTileLayer();if(q){s=q.getGridXYForPosition(s);q=w.getDimensions();s.x-=q.width/2;s.y-=q.height/2;if(k)k=null;w.updateOffset(s.x,s.y,p);w.trigger("wake");e.boundsChange&&e.boundsChange(w.getBoundingBox());E&&E(w)}},locate:function(){w.trackStart(b.SINGLE);setTimeout(w.trackCancel,1E4)},trackStart:function(s){if(navigator.geolocation&&
!r){g=s?s:b.WATCH;u=true;r=navigator.geolocation.watchPosition(m,f,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3})}},trackCancel:function(){r&&navigator.geolocation&&navigator.geolocation.clearWatch(r);g===b.WATCH&&l.clear();g=b.NONE;r=0},getZoomLevel:function(){return z},setZoomLevel:function(s){try{w.gotoPosition(w.getCenterPosition(),s)}catch(E){GT.Log.exception(E)}},zoomIn:function(){w.scale(2,T5.easing("sine.out"))||w.setZoomLevel(z+1)},zoomOut:function(){w.scale(0.5,T5.easing("sine.out"))||
w.setZoomLevel(z-1)},animateRoute:function(s,E,p,q){var t=w.getLayer("route");if(t)(s=t.getAnimation(s,E,p,q))&&s.addToView(w)}});w.bind("pan",function(){g===b.SINGLE&&w.trackCancel()});w.bind("tap",function(s,E){var p=w.getTileLayer(),q=null;if(p){var t=w.viewPixToGridPix(new T5.Vector(E.x,E.y)),v=p.pixelsToPos(t);q=p.pixelsToPos(T5.V.offset(t,-e.tapExtent,e.tapExtent));p=p.pixelsToPos(T5.V.offset(t,e.tapExtent,-e.tapExtent));q=new T5.Geo.BoundingBox(q,p);d=w.pois.findByBounds(q);w.trigger("geotap",
s,E,v,q);w.trigger("tapPOI",d)}});w.bind("doubleTap",function(s,E){w.animate(2,T5.D.getCenter(w.getDimensions()),new T5.Vector(E.x,E.y),e.zoomAnimation)});w.bind("scale",function(s,E){var p=0;s=Math.sqrt(s);if(s<1)p=-(0.5/s);else if(s>1)p=s;w.gotoPosition(w.getXYPosition(E),z+Math.floor(p))});l=new T5.Geo.UI.AnnotationsOverlay({pois:w.pois,map:w});w.annotations=l;w.setLayer("annotations",l);e.crosshair&&w.setLayer("crosshair",new CrosshairOverlay);w.bind("idle",function(){if(T5.V.absSize(T5.V.diff(a,
w.getOffset()))>e.boundsChangeThreshold){a=w.getOffset();w.trigger("boundsChange",w.getBoundingBox())}});GT.configurable(w,["provider"],GT.paramTweaker(e,null,{provider:function(){w.cleanup();h=false}}),true);return w};
