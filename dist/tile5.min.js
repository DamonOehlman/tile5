(function(rb){function B(){var c=arguments[0]||{},g=Array.prototype.slice.call(arguments,1),a,b;for(b=g.length;b--;)if((a=g[b])!==null)for(var d in a){var f=a[d];if(c!==f)if(f!==undefined)c[d]=f}return c}function pa(c,g){if(typeof console!=="undefined")console[g||"debug"](c)}function sb(c){var g=c.match(Sb),a=[],b=0,d;for(d=g?g.length:0;d--;){var f=g[d].slice(1);a[f]||(a[f]=RegExp("\\{"+f+"\\}","g"))}b=a.length;return function(){var h=c;for(d=0;d<b;d++)h=h.replace(a[d],arguments[d]||"");return h}}
function db(c){c=c.replace(/[\-\_\s\.]/g,"").toLowerCase();return Ga[c]||Ga.linear}function Qa(c,g,a,b,d){function f(i){i=i?i:(new Date).getTime();if(e+tb<i){var k=i-h,o=a(k,c,j,b),l=h+b<=i;i=!l;if(d){k=d(o,l,k);i=typeof k!="undefined"?k&&i:i}i&&animFrame(f)}}var h=(new Date).getTime(),e=0,j=g-c;animFrame(f);return{}}function ub(){return(new Date).getTime()}function V(c,g){this.x=c||0;this.y=g||0}function qa(c,g,a,b){this.x=c||0;this.y=g||0;this.w=a||0;this.h=b||0;this.x2=this.x+this.w;this.y2=this.y+
this.h}function vb(c,g){var a=new wb(Math.sqrt(256<<c)|0);g&&g.zoomLevel===c&&g.copyInto(a);a.zoomLevel=c;return a}function xb(c){c=c||(new Date).getTime();for(var g=0;g<Ba.length;){var a=Ba[g],b=ya[a],d=ya[a].image&&ya[a].image.complete&&ya[a].image.width>0,f=c-b.start;f=d||f>=Tb;if(d){d=b.callbacks;yb[a]=b.image;for(var h=0;h<d.length;h++)d[h](b.image,true)}if(f){Ba.splice(g,1);delete ya[a]}else g++}Ba.length>0&&animFrame(xb)}function Ra(c,g){var a=c&&g?yb[c]:null;if(a&&a&&a.complete&&a.width>0)g(a);
else{if(a=ya[c])a.callbacks.push(g);else{a=new Image;a.id="_ldimg"+ ++Ub;ya[c]={start:(new Date).getTime(),image:a,callbacks:[g]};a.src=c;Ba[Ba.length]=c}animFrame(xb)}}function eb(c,g,a,b,d,f){this.x=c;this.y=g;this.w=b||256;this.h=b||256;this.x2=this.x+this.w;this.y2=this.y+this.h;this.url=a;this.id=f||c+"_"+g;this.loaded=false;this.image=null}function zb(c){c=c?c:(new Date).getTime();if(c-Ab>tb){for(var g=Ha.splice(0),a=g.length;a--;)g[a](c);Ab=c}Ha.length&&animFrame(zb)}function Bb(c){var g=Ha.length==
0;Ha[Ha.length]=c;g&&animFrame(zb)}function Vb(c,g,a,b,d){d=B({easing:"sine.out",duration:1E3,progress:null,complete:null,autoInvalidate:true},d);var f=(new Date).getTime(),h=c[g],e=g=="translate",j=d.autoInvalidate,i=a.length&&b.length&&a.length==b.length?a.length:0,k=Array(i),o=Array(i),l=db(d.easing),m=d.duration,p=d.progress,r=function(u){var w=u-f;u=f+m<=u;for(var D=c.layer?c.layer.view:null,C,z=i;z--;){C=l(w,a[z],k[z],m);o[z]=e?C|0:C}h.apply(c,o);j&&D&&D.invalidate();if(p){w=[].concat(u?b:o);
w.unshift(u);p.apply(c,w)}if(u){c.animations--;h.apply(c,b);d.complete&&d.complete.apply(c,b)}else Bb(r)};if(h&&h.apply&&i>0){m=m?m:DEFAULT_DURATION;for(g=i;g--;)k[g]=b[g]-a[g];c.animations++;Bb(r)}}function Sa(c,g){g=B({id:"layer_"+Wb++,zindex:0,animated:false,style:null,minXY:null,maxXY:null},g);this.visible=true;za(B(this,g))}function Z(c,g){if(c&&c.split){var a=c.split(Xb);if(a.length>1){c=a[0];g=a[1]}}else if(c&&c.lat){g=c.lon;c=c.lat}this.lat=parseFloat(c||0);this.lon=parseFloat(g||0)}function Cb(c){return aa/
(256<<c)}function Db(c,g){var a=Ta*ra(c);return Ia-2*Eb(g*ua((1-a)/(1+a),Ta/2))}function Ua(c,g,a,b){g=fb(g);c.add(b(g,a));return g.length}function fb(c){var g=c?c.length:0,a=Array(g);for(g=g;g--;)a[g]=new Z(c[g][1],c[g][0]);return ba.vectorize(a,Fb)}var gb={};(function(c){var g=[],a=0,b=false,d=c.register=function(f,h){g.push({section:f,run:h})};c.init=function(f){function h(){if(a<g.length){var j=g[a++];e[j.section]||(e[j.section]={});j.run(e[j.section],h)}else{for(j in e)c[j]=e[j];b=true;f&&f(c)}}
var e={};if(b&&f)f(c);else{a=0;h()}};d("canvas",function(f,h){function e(){var o,l=j.getContext("2d");l.save();try{l.translate(50,50);l.beginPath();l.rect(0,0,20,20);o=l.isPointInPath(10,10)}finally{l.restore()}return o}var j=document.createElement("canvas"),i=typeof FlashCanvas!="undefined",k=typeof G_vmlCanvasManager!="undefnined";j.width=200;j.height=200;f.pipTransformed=i||k?false:e();h()})})(gb);window.animFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||
window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(c){setTimeout(function(){c((new Date).getTime())},1E3/60)}}();var Sb=/\{(\d+)(?=\})/g,Ga=function(){var c=1.70158,g=Math.PI/2,a=Math.abs,b=Math.pow,d=Math.sin,f=Math.asin,h=Math.cos;return{linear:function(e,j,i,k){return i*e/k+j},backin:function(e,j,i,k){return i*(e/=k)*e*((c+1)*e-c)+j},backout:function(e,j,i,k){return i*((e=e/k-1)*e*((c+1)*e+c)+1)+j},backinout:function(e,j,i,k){return(e/=k/2)<
1?i/2*e*e*(((c*=1.525)+1)*e-c)+j:i/2*((e-=2)*e*(((c*=1.525)+1)*e+c)+2)+j},bouncein:function(e,j,i,k){return i-Ga.bounceout(k-e,0,i,k)+j},bounceout:function(e,j,i,k){return(e/=k)<1/2.75?i*7.5625*e*e+j:e<2/2.75?i*(7.5625*(e-=1.5/2.75)*e+0.75)+j:e<2.5/2.75?i*(7.5625*(e-=2.25/2.75)*e+0.9375)+j:i*(7.5625*(e-=2.625/2.75)*e+0.984375)+j},bounceinout:function(e,j,i,k){return e<k/2?Ga.bouncein(e*2,0,i,k)/2+j:Ga.bounceout(e*2-k,0,i,k)/2+i/2+j},cubicin:function(e,j,i,k){return i*(e/=k)*e*e+j},cubicout:function(e,
j,i,k){return i*((e=e/k-1)*e*e+1)+j},cubicinout:function(e,j,i,k){if((e/=k/2)<1)return i/2*e*e*e+j;return i/2*((e-=2)*e*e+2)+j},elasticin:function(e,j,i,k,o,l){if(e==0)return j;if((e/=k)==1)return j+i;l||(l=k*0.3);if(!o||o<a(i)){o=i;i=l/4}else i=l/aa*f(i/o);return-(o*b(2,10*(e-=1))*d((e*k-i)*aa/l))+j},elasticout:function(e,j,i,k,o,l){var m;if(e==0)return j;if((e/=k)==1)return j+i;l||(l=k*0.3);if(!o||o<a(i)){o=i;m=l/4}else m=l/aa*f(i/o);return o*b(2,-10*e)*d((e*k-m)*aa/l)+i+j},elasticinout:function(e,
j,i,k,o,l){var m;if(e==0)return j;if((e/=k/2)==2)return j+i;l||(l=k*0.3*1.5);if(!o||o<a(i)){o=i;m=l/4}else m=l/aa*f(i/o);if(e<1)return-0.5*o*b(2,10*(e-=1))*d((e*k-m)*aa/l)+j;return o*b(2,-10*(e-=1))*d((e*k-m)*aa/l)*0.5+i+j},quadin:function(e,j,i,k){return i*(e/=k)*e+j},quadout:function(e,j,i,k){return-i*(e/=k)*(e-2)+j},quadinout:function(e,j,i,k){if((e/=k/2)<1)return i/2*e*e+j;return-i/2*(--e*(e-2)-1)+j},sinein:function(e,j,i,k){return-i*h(e/k*g)+i+j},sineout:function(e,j,i,k){return i*d(e/k*g)+j},
sineinout:function(e,j,i,k){return-i/2*(h(Math.PI*e/k)-1)+j}}}();if(typeof animFrame==="undefined")throw Error("animFrame COG required for tweening support");var za=function(){function c(a,b){var d=a.hasOwnProperty("obsHandlers")?a.obsHandlers:null;d[b]||(d[b]=[]);return d[b]}var g=0;return function(a){if(!a)return null;if(!(a.hasOwnProperty("obsHandlers")?a.obsHandlers:null))a.obsHandlers={};if(!a.hasOwnProperty("bind")){a.bind=function(b,d){var f="callback"+g++;c(a,b).unshift({fn:d,id:f});return f};
a.triggerCustom=function(b,d){var f=c(a,b),h={cancel:false,name:b,source:this},e;for(e in d)h[e]=d[e];if(!f)return null;e=Array.prototype.slice.call(arguments,2);a.eventInterceptor&&a.eventInterceptor(b,h,e);e.unshift(h);for(var j=f.length;j--&&!h.cancel;)f[j].fn.apply(this,e);return h};a.trigger=function(b){var d=Array.prototype.slice.call(arguments,1);d.splice(0,0,b,null);return a.triggerCustom.apply(this,d)};a.unbind=function(b,d){if(typeof b==="undefined")a.obsHandlers={};else for(var f=c(a,b),
h=0;f&&h<f.length;h++)if(f[h].id===d){f.splice(h,1);break}return a}}return a}}(),Gb=Array.prototype.indexOf||function(c){for(var g=0;g<this.length;g++)if(this[g]===c)return g;return-1},W=function(){return function(c,g){g=Yb.call(g);if(g=="finite")return!Zb[$b](+c);return g=="null"&&c===null||g==typeof c||g=="object"&&c===Object(c)||g=="array"&&Array.isArray&&Array.isArray(c)||ac.call(c).slice(8,-1).toLowerCase()==g}}(),bc=function(){function c(d){var f=document.createElement("script"),h=false;f.src=
d;f.async=true;f.onload=f.onreadystatechange=function(){if(!h&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){h=true;f.onload=f.onreadystatechange=null;f&&f.parentNode&&f.parentNode.removeChild(f)}};a||(a=document.getElementsByTagName("head")[0]);a.appendChild(f)}var g=0,a,b=this;return function(d,f,h){d+=d.indexOf("?")>=0?"&":"?";var e="json"+ ++g;b[e]=function(j){f(j);b[e]=null;try{delete b[e]}catch(i){}};c(d+(h?h:"callback")+"="+e);return e}}();INTERACT=function(){function c(l){return function(m,
p){l.addEventListener(m,p,false)}}function g(l){return function(m,p){l.removeEventListener(m,p,false)}}function a(l){return function(m,p){l.attachEvent("on"+m,p)}}function b(l,m){return{x:l?l:0,y:m?m:0,count:1}}function d(l,m){k.push(B({handler:null,checks:{},type:l},m))}function f(l){var m=0,p=0;if(l.offsetParent){do{m+=l.offsetLeft;p+=l.offsetTop;l=l.offsetParent}while(l)}return{left:m,top:p}}function h(l,m){return{source:l,target:m.target?m.target:m.srcElement}}function e(l,m){for(var p=l.target?
l.target:l.srcElement;p&&p!==m;)p=p.parentNode;return p&&p===m}function j(l,m){return{x:l.x-(m?m.left:0),y:l.y-(m?m.top:0)}}function i(l,m){if(l.preventDefault){l.preventDefault();l.stopPropagation()}else if(typeof l.cancelBubble!="undefined")l.cancelBubble=true;m&&l.stopImmediatePropagation&&l.stopImmediatePropagation()}var k=[],o=function(l,m,p){p=B({binder:null,unbinder:null,observable:null},p);for(var r=p.observable,u=[],w,D,C={bind:function(){return r.bind.apply(null,arguments)},unbind:function(){r.unbind();
for(z=0;z<u.length;z++)u[z].unbind();return C}},z=0;z<m.length;z++)u.push(m[z](l,r,p));r.bind("pointerDown",function(){D=w=0});r.bind("pointerMove",function(q,E,I,y){w+=y.x||0;D+=y.y||0});r.bind("pointerUp",function(q,E,I){Math.abs(w)>20||Math.abs(D)>20||r.triggerCustom("tap",q,E,I)});return C};d("pointer",{handler:function(l,m,p){function r(s){if(s.pageX&&s.pageY)return b(s.pageX,s.pageY);else{var L=document.documentElement,Q=document.body;return b(s.clientX+(L&&L.scrollLeft||Q&&Q.scrollLeft||0)-
(L&&L.clientLeft||Q&&Q.clientLeft||0),s.clientY+(L&&L.scrollTop||Q&&Q.scrollTop||0)-(L&&L.clientTop||Q&&Q.clientTop||0))}}function u(s){if(e(s,l))if(y=z(s)){var L=r(s);l.style.cursor="move";i(s,true);P=L.x;O=L.y;A=b(P,O);m.triggerCustom("pointerDown",h("mouse",s),A,j(A,f(l)))}}function w(s){var L=r(s);F=L.x;H=L.y;if(e(s,l))q(s,y?"pointerMove":"pointerHover")}function D(s){if(y&&z(s)){y=false;if(e(s,l)){l.style.cursor="default";q(s,"pointerUp")}}}function C(s){if(e(s,l)){var L;s=s||window.event;if(s.detail)L=
s.axis===2?-s.detail*E:0;else{L=s.wheelDeltaY?s.wheelDeltaY:s.wheelDelta;if(window.opera)L=-L}if(L!==0){var Q=b(F,H);m.triggerCustom("zoom",h("mouse",s),Q,j(Q,f(l)),L/I,"wheel");i(s);s.returnValue=false}}}function z(s){s=s||window.event;return(s.which||s.button)==1}function q(s,L,Q,ca,ka){Q=typeof Q!="undefined"?Q:F;ca=typeof ca!="undefined"?ca:H;var x=Q-P,G=ca-O,J=b(Q,ca);m.triggerCustom(L,h("mouse",s),J,j(J,f(l)),b(x,G));if(typeof ka=="undefined"||ka){P=Q;O=ca}}p=B({},p);var E=120,I=E*8,y=false,
A,F,H,P,O;p.binder("mousedown",u);p.binder("mousemove",w);p.binder("mouseup",D);p.binder("dblclick",function(s){pa("captured double click");if(e(s,l)){var L=r(s);m.triggerCustom("doubleTap",h("mouse",s),L,j(L,f(l)))}});p.binder("mousewheel",C);p.binder("DOMMouseScroll",C);return{unbind:function(){p.unbinder("mousedown",u);p.unbinder("mousemove",w);p.unbinder("mouseup",D);p.unbinder("mousewheel",C);p.unbinder("DOMMouseScroll",C)}}},checks:{touch:false}});d("pointer",{handler:function(l,m,p){function r(x){if(x.count<
2)return 0;var G=x.x-x.next.x;x=x.y-x.next.y;return~~Math.sqrt(G*G+x*x)}function u(x,G,J){G=G?G:0;J=J?J:0;for(var da={x:x.x-G,y:x.y-J,id:x.id,count:x.count},ea=da;x.next;){x=x.next;ea=ea.next={x:x.x-G,y:x.y-J,id:x.id}}return da}function w(x,G){var J=x[G?G:"touches"],da,ea;if(J.length===0)return null;ea=da={x:J[0].pageX,y:J[0].pageY,id:J[0].identifier,count:J.length};for(var R=1,T=J.length;R<T;R++)ea=ea.next={x:J[R].pageX,y:J[R].pageY,id:J[R].identifier};return da}function D(x){if(e(x,l)){H=f(l);var G=
w(x,"changedTouches"),J=u(G,H.left,H.top);if(!O){P=y;m.triggerCustom("pointerDown",h("touch",x),G,J)}ca&&m.triggerCustom("pointerDownMulti",h("touch",x),G,J);O=w(x);if(O.count>1)L=r(O);ka=1;Q=u(O)}}function C(x){if(e(x,l)){i(x);s=w(x);if(P==y)P=Math.abs(O.x-s.x)>E||Math.abs(O.y-s.y)>E?I:y;if(P!=y){P=s.count>1?F:A;if(P==F)if(O.count===1){O=u(s);L=r(O)}else{var G=r(s);if(Math.abs(L-G)<q)P=A;else{var J;J=s.x;var da=s.next.x,ea=s.y,R=s.next.y,T=ea<R?ea:R;J={x:(J<da?J:da)+(Math.abs(J-da)>>1),y:T+(Math.abs(ea-
R)>>1)};G=G/L;da=G-ka;m.triggerCustom("zoom",h("touch",x),J,j(J,H),da,"pinch");ka=G}}P==A&&m.triggerCustom("pointerMove",h("touch",x),s,u(s,H.left,H.top),b(s.x-Q.x,s.y-Q.y));ca&&m.triggerCustom("pointerMoveMulti",h("touch",x),s,u(s,H.left,H.top))}Q=u(s)}}function z(x){if(e(x,l)){var G=w(x,"changedTouches"),J=u(G,H.left,H.top);s=w(x);if(!s){m.triggerCustom("pointerUp",h("touch",x),G,J);O=null}ca&&m.triggerCustom("pointerUpMulti",h("touch",x),G,J)}}p=B({detailed:false,inertia:false},p);var q=20,E=7,
I=0,y=1,A=2,F=3,H,P,O,s,L,Q,ca=p.detailed,ka=1;p.binder("touchstart",D);p.binder("touchmove",C);p.binder("touchend",z);pa("initialized touch handler");return{unbind:function(){p.unbinder("touchstart",D);p.unbinder("touchmove",C);p.unbinder("touchend",z)}}},checks:{touch:true}});return{register:d,watch:function(l,m,p){m=B({bindTarget:null,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},m);capabilities=B({touch:"ontouchstart"in window},p);if(!m.observable){pa("creating observable");
m.observable=za({});globalOpts=m}m.binder=(m.isIE?a:c)(m.bindTarget||document);m.unbinder=(m.isIE?a:g)(m.bindTarget||document);p=m.types;for(var r=capabilities,u=[],w=k.length;w--;){var D=k[w],C=!p||p.indexOf(D.type)>=0,z=true;for(var q in D.checks){var E=D.checks[q];pa("checking "+q+" capability. require: "+E+", capability = "+r[q]);z=z&&E===r[q]}if(C&&z)u[u.length]=D.handler}return new o(l,u,m)}}}();var M={ex:B,log:pa,observable:za,formatter:sb,wordExists:function(c,g){for(var a=c.split(/\s|\,/).length;a--;)if(c.toLowerCase()==
g.toLowerCase())return true;return false},is:W,indexOf:Gb};za(M);var Ja=function(){var c={};return{create:function(g,a){if(c[g][a])return c[g][a].apply(null,Array.prototype.slice.call(arguments,2))},register:function(g,a,b){c[g]||(c[g]={});c[g][a]&&pa(cc(g,a),"warn");c[g][a]=b}}}(),cc=sb("Registration of {0}: {1} will override existing definition"),aa=Math.PI*2,Ia=Math.PI/2,ga=Math.abs,Hb=Math.ceil,Ka=Math.round,sa=Math.min,ta=Math.max,ua=Math.pow,Va=Math.sqrt,va=Math.log,ra=Math.sin,hb=Math.asin,
La=Math.cos,Eb=Math.atan,dc=Math.atan2,$b="hasOwnProperty",Zb={NaN:1,Infinity:1,"-Infinity":1},Yb=String.prototype.toLowerCase,ac=Object.prototype.toString,$="undefined",Ib="number",U=Ja.register,la=Ja.create,ec=0,Wb=0,Xb=/[\,\s]/,fc=M.newCanvas=function(c,g){var a=document.createElement("canvas");a.width=c?c:0;a.height=g?g:0;M.trigger("createCanvas",a);return a},gc=function(){var c={};return{find:function(g){return(c[g]||[])[0]},register:function(g,a){c[g]||(c[g]=[]);c[g].push(a())}}}(),ia=function(){function c(b){for(var d=
0;d<b.length;d++){var f=b[d];if(typeof document.body.style[f]!="undefined")return f}}var g={"-webkit-user-select":"none",position:"absolute",overflow:"hidden"},a;a=c(["-webkit-transform","MozTransform"]);css3DTransformProp=c(["WebkitPerspective","MozPerspective"]);return{supportTransforms:a,create:function(b,d,f){b=document.createElement(b);var h=[];f=f||{};b.className=d||"";for(var e in f)h[h.length]=e+": "+f[e];b.style.cssText=h.join(";");return b},move:function(b,d,f,h){if(a)b.style[a]="translate("+
d+"px, "+f+"px) "+(h||[]).join(" ");else{b.style.left=d+"px";b.style.top=f+"px"}},styles:function(b){return B({},g,b)}}}();V.prototype={constructor:V,add:function(){for(var c=this.x,g=this.y,a=arguments.length;a--;){c+=arguments[a].x;g+=arguments[a].y}return new V(c,g)},equals:function(c){return this.x===c.x&&this.y===c.y}};qa.prototype={constructor:qa};var Ca=function(){function c(b,d){return a(b.x-d.x,b.y-d.y)}function g(b,d){d=d||b.length;if(d<=1)return null;for(var f=Array(d-1),h=Array(d-1),e=
0,j,i=0;i<d-1;i++){j=c(b[i],b[i+1]);f[i]=Va(j.x*j.x+j.y*j.y);h[i]=e+=f[i]}return{edges:f,accrued:h,tota:e}}function a(b,d){return new V(b,d)}return{VECTOR_SIMPLIFICATION:3,SIMPLIFICATION_MIN_VECTORS:25,add:function(){for(var b=0,d=0,f=arguments.length;f--;){b+=arguments[f].x;d+=arguments[f].y}return a(b,d)},absSize:function(b){return ta(ga(b.x),ga(b.y))},copy:function(b){return b?a(b.x,b.y):null},diff:c,distance:function(b,d){return g(b,d).total},edges:g,equals:function(b,d){return b.equals(d)},extendBy:function(b,
d,f){var h=La(d)*f|0;d=ra(d)*f|0;return a(b.x-h,b.y-d)},floor:function(b){for(var d=Array(b.length),f=b.length;f--;)d[f]=a(b[f].x|0,b[f].y|0);return d},getRect:function(b){for(var d,f,h,e,j=b.length;j--;){var i=b[j];d=W(d,$)||i.x<d?i.x:d;f=W(f,$)||i.y<f?i.y:f;h=W(h,$)||i.x>h?i.x:h;e=W(e,$)||i.y>e?i.y:e}return new qa(d,f,h-d,e-f)},init:a,invert:function(b){return a(-b.x,-b.y)},min:function(b,d){return a(b.x<d.x?b.x:d.x,b.y<d.y?b.y:d.y)},max:function(b,d){return a(b.x>d.x?b.x:d.x,b.y>d.y?b.y:d.y)},
offset:function(b,d,f){return a(b.x+d,b.y+(f||d))},scale:function(b,d){return a(b.x/d|0,b.y/d|0)},simplify:function(b,d){if(!b)return null;d=d||Ca.VECTOR_SIMPLIFICATION;for(var f=[],h=null,e=b.length;e--;){var j=b[e];if(include=!h||e===0||ga(j.x-h.x)+ga(j.y-h.y)>d){f.unshift(j);h=j}}return f},theta:function(b,d,f){f=hb((b.y-d.y)/f);return b.x>d.x?f:Math.PI-f},toString:function(b){return b?b.x+", "+b.y:""}}}(),hc=function(){return{dotProduct:function(c,g){return c.x*g.x+c.y*g.y}}}(),Ma=function(){function c(a){return g(a.x,
a.y,a.x2,a.y2)}function g(a,b,d,f){return new qa(a,b,(d||a)-a,(f||b)-b)}return{buffer:function(a,b,d){return Ma.init(a.x-b,a.y-(d||b),a.x2+b,a.y2+(d||b))},center:function(a){return new V(a.x+(a.w>>1),a.y+(a.h>>1))},copy:c,diagonalSize:function(a){return Va(a.w*a.w+a.h*a.h)},fromCenter:function(a,b,d,f){d=d>>1;f=f>>1;return g(a-d,b-f,a+d,b+f)},init:g,intersect:function(a,b){var d=ta(a.x,b.x),f=ta(a.y,b.y),h=sa(a.x2,b.x2),e=sa(a.y2,b.y2);d=g(d,f,h,e);return d.w>0&&d.h>0?d:null},toString:function(a){return a?
"["+a.x+", "+a.y+", "+a.x2+", "+a.y2+"]":""},union:function(a,b){if(a.w===0||a.h===0)return c(b);else if(b.w===0||b.h===0)return c(a);else{var d=sa(a.x,b.x),f=sa(a.y,b.y),h=ta(a.x2,b.x2),e=ta(a.y2,b.y2);d=g(d,f,h,e);return d.w>0&&d.h>0?d:null}}}}();Hits=function(){return{diffHits:function(c,g){var a=[],b={},d;for(d=g.length;d--;)b[g[d].target.id]=true;for(d=c.length;d--;)b[c[d].target.id]||(a[a.length]=c[d]);return a},init:function(c,g,a,b){return{type:c,x:b.x|0,y:b.y|0,elements:[],absXY:g,relXY:a}},
initHit:function(c,g,a){return{type:c,target:g,drag:a}},triggerEvent:function(c,g,a,b){g.triggerCustom(c.type+(a?a:"Hit"),{hitType:c.type},b?b:c.elements,c.absXY,c.relXY,new V(c.x,c.y))}}}();var wb=function(c){function g(f,h){var e=a[f],j;e||(e=a[f]=[]);(j=e[h])||(j=e[h]=[]);return j}c=c||128;var a=[],b={},d=0;return{copyInto:function(f){for(var h in b){var e=b[h];f.insert(e.bounds||e,e,h)}},insert:function(f,h,e){var j=f.x/c|0,i=f.y/c|0,k=(f.x+f.w)/c|0;f=(f.y+f.h)/c|0;e=e||h.id||"obj_"+d++;b[e]=
h;for(h=j;h<=k;h++)for(j=i;j<=f;j++)g(h,j).push(e)},remove:function(f,h,e){e=e||h.id;if(b[e]){var j=f.x/c|0;h=f.y/c|0;var i=(f.x+f.w)/c|0;f=(f.y+f.h)/c|0;delete b[e];for(j=j;j<=i;j++)for(var k=h;k<=f;k++){var o=g(j,k),l=Gb.call(o,e);l>=0&&o.splice(l,1)}}},search:function(f){var h=f.y/c|0,e=(f.x+f.w)/c|0,j=(f.y+f.h)/c|0,i=[],k=[];for(f=f.x/c|0;f<=e;f++)for(var o=h;o<=j;o++)i=i.concat(g(f,o));i.sort();for(h=i.length;h--;){e=i[h];if(j=b[e])k[k.length]=j;for(;h>0&&i[h-1]==e;)h--}return k}}},Tb=3E4,yb=
{},Ub=0;(new Date).getTime();var ya={},Ba=[];eb.prototype={constructor:eb,load:function(c){var g=this;Ra(this.url,function(a){g.loaded=true;g.image=a;c&&c()})}};var ic=function(){return za({fastpan:true,applyStyle:function(){},applyTransform:function(c,g,a){return{restore:null,x:g,y:a}},checkSize:function(){},getDimensions:function(){return{width:0,height:0}},getOffset:function(){return new V},getViewport:function(){},hitTest:function(){return false},prepare:function(){},projectXY:null,reset:function(){}})},
jc=M.attachRenderer=function(c,g,a,b,d){c=c.split("/");for(var f=new ic(g,a,b,d),h=0;h<c.length;h++)f=la("renderer",c[h],g,a,b,d,f);return f};U("renderer","canvas",function(c,g,a,b,d){function f(q,E,I){var y,A;m[E]=function(F){for(y=C.length;y--;)if(A=I[C[y]])F[z[y]]=A}}function h(q,E,I){var y=false;if(E)y=k.isPointInPath(r?E.x-o:E.relXY.x,r?E.y-l:E.relXY.y);return{draw:I||D,viewport:q,hit:y,vpX:o,vpY:l,context:k}}b=B({},b);var e,j,i,k,o=0,l=0,m={},p=null,r=gb.canvas.pipTransformed,u={},w=function(){},
D=function(){this.fill&&k.fill();this.stroke&&k.stroke()},C=["fill","stroke","lineWidth","opacity"],z=["fillStyle","strokeStyle","lineWidth","globalAlpha"];if(g){e=g.offsetWidth;j=g.offsetHeight;i=fc(e,j);i.style.cssText="position: absolute; z-index: 1;";c.attachFrame(i,true);k=null}a=B(d,{applyStyle:function(q){var E=m[q],I=k&&k.canvas?k.canvas.id:"default",y;u[I]||(u[I]=[]);y=u[I].pop()||"basic";if(E){u[I].push(q);E(k);return y}},applyTransform:function(q){if(q.translateX!==0||q.translateY!==0||
q.scaling!==1||q.rotation!==0){k.save();p={undo:function(){k.restore();p=null},x:q.xy.x,y:q.xy.y};k.translate(q.xy.x-o+q.translateX,q.xy.y-l+q.translateY);q.rotation!==0&&k.rotate(q.rotation);q.scaling!==1&&k.scale(q.scaling,q.scaling)}return p},drawTiles:function(q,E,I){for(var y,A=o-256,F=l-256,H=q.x2,P=q.y2,O=E.length;O--;){q=E[O];if(y=q.x>=A&&q.x<=H&&q.y>=F&&q.y<=P)if(!q.loaded&&I)q.load(c.invalidate);else q.image&&k.drawImage(q.image,q.x-o,q.y-l)}},prepare:function(q,E){var I,y=false,A=E.scaled||
E;if(k)k.restore();else k=i.getContext("2d");for(I=q.length;I--;)y=y||q[I].clip;o=A.x;l=A.y;if(k){y||k.clearRect(0,0,e,j);k.save()}k.globalCompositeOperation="source-over";return k},prepArc:function(q,E,I){k.beginPath();k.arc(q.xy.x-(p?p.x:o),q.xy.y-(p?p.y:l),q.size>>1,q.startAngle,q.endAngle,false);return h(E,I)},prepImage:function(q,E,I,y){var A=(y.x||q.xy.x)-(p?p.x:o),F=(y.y||q.xy.y)-(p?p.y:l),H=y.image||q.image;if(H){k.beginPath();k.rect(A,F,y.width||H.width,y.height||H.height);return h(E,I,function(){k.drawImage(H,
A,F,y.width||H.width,y.height||H.height)})}},prepMarker:function(q,E,I){var y=q.xy.x-(p?p.x:o),A=q.xy.y-(p?p.y:l),F=q.size,H=undefined;k.beginPath();switch(q.markerStyle.toLowerCase()){case "image":H=w;k.rect(y-(F>>1),A-(F>>1),F,F);if(q.reset&&q.image){q.image=null;q.reset=false}q.image?k.drawImage(q.image,y-(F>>1),A-(F>>1),F,F):Ra(q.imageUrl,function(P){q.image=P;k.drawImage(q.image,y-(F>>1),A-(F>>1),F,F)});break;default:k.moveTo(y,A);k.lineTo(y-(F>>1),A-F);k.lineTo(y+(F>>1),A-F);k.lineTo(y,A);break}return h(E,
I,H)},prepPoly:function(q,E,I,y){var A=true;q=y.points||q.points;y=p?p.x:o;var F=p?p.y:l;k.beginPath();for(var H=q.length;H--;){var P=q[H].x-y,O=q[H].y-F;if(A){k.moveTo(P,O);A=false}else k.lineTo(P,O)}return h(E,I)},getContext:function(){return k}});(function(){for(var q in M.styles)f(null,q,M.styles[q]);M.bind("styleDefined",f)})();a.bind("detach",function(){g.removeChild(i)});return a});U("renderer","dom",function(c,g,a,b,d){function f(k){var o=k.image=new Image;j[k.id]=k;o.src=k.url;o.onload=function(){if(i[k.id])e.appendChild(this);
else k.image=null};o.style.cssText="-webkit-user-select: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute;";return o}function h(k,o,l){var m=[];for(var p in k){var r=
k[p];if(l?r[l]:!o[p]){if(r.image&&r.image.parentNode){e.removeChild(r.image);r.image=null}m[m.length]=p}}for(o=m.length;o--;)delete k[m[o]]}var e=null,j={},i={};e=ia.create("div","",ia.styles({width:g.offsetWidth+"px",height:g.offsetHeight+"px"}));g.childNodes.length>0?g.insertBefore(e,g.childNodes[0]):g.appendChild(e);c.attachFrame(e);c=B(d,{drawTiles:function(k,o,l){for(var m,p=k.x,r=k.y,u=o.length;u--;){k=o[u];if(k.url){(m=k.image||(l?f(k):null))&&ia.move(m,k.x-p,k.y-r);i[k.id]=k}}}});c.bind("predraw",
function(){h(j,i);i={}});c.bind("detach",function(){g.removeChild(e)});c.bind("reset",function(){for(h(j,i={});e.childNodes.length>0;)e.removeChild(e.childNodes[0])});return c});var ib=M.styles={},kc=M.defineStyle=function(c,g){ib[c]=g;M.trigger("styleDefined",c,ib[c]);return c},Jb=M.defineStyles=function(c){for(var g in c)kc(g,c[g])};M.getStyle=function(c){return ib[c]};M.loadStyles=function(c){bc(c,function(g){Jb(g)})};Jb({basic:{fill:"#ffffff"},highlight:{fill:"#ff0000"},waypoints:{lineWidth:4,
stroke:"#003377",fill:"#ffffff"},waypointsHover:{lineWidth:4,stroke:"#ff0000",fill:"#ffffff"}});U("view","simple",function(c){function g(n,t,v,K){C(sa(ta(X+ua(2,K)-1,0.5),2))}function a(n){var t=n|0;n=t+Math.round((n-t)*50)/50;if(n!==X){X=n;n=va(X)/Math.LN2|0;if(n!==0){X=ua(2,n);p(Na+n,lc,mc)}ja++}}function b(n,t){var v=renderer&&renderer.projectXY?renderer.projectXY(n,t):null;if(!v){v=S.getViewport();var K=1/X;v=new V(v?v.x+n*K:n,v?v.y+t*K:t)}return v}function d(n,t,v){z("doubleTap",t,v,b(v.x,v.y));
c.scalable&&C(2,b(v.x,v.y),nc,null,oc)}function f(n,t,v){s=null;ka=true;m("down",t,v)}function h(n,t,v){m("hover",t,v)}function e(n,t,v,K){o(t,v,false);if(!s){x=K.x;G=K.y}}function j(n,t,v){o(t,v,true);ka=false}function i(){clearTimeout(Kb);Kb=setTimeout(function(){renderer.checkSize()},250)}function k(n,t,v){m("tap",t,v);z("tap",t,v,b(v.x,v.y,true))}function o(n,t,v){if(s){n=b(t.x,t.y);s.drag.call(s.target,s,n.x,n.y,v)&&ja++;if(v)s=null}}function l(n){var t=[],v,K=false,N;n=n||(new Date).getTime();
if(K=n-Lb>pc){self.panSpeed=panSpeed=ga(x)+ga(G);N=ga(R-jb)>=ea||ga(T-kb)>=ea;v=X!==Mb;if(panSpeed>0||v)ja++;N&&panSpeed<E&&D();Wa.index++;Wa.draw=ja||panSpeed||J||da;S.trigger("enterFrame",n,Wa);Lb=n}if(renderer&&K&&Wa.draw){Xa+=x;Ya+=G;if(x||G)S.trigger("pan");if(X!==1&&ia.supportTransforms)t[t.length]="scale("+X+")";if(v=!ca||(c.drawOnScale||X===1)&&panSpeed<I){R=R-Xa/X|0;T=T-Ya/X|0;N=u();renderer.trigger("predraw",N);if(renderer.prepare(A,N,n,fa)){K=Ya=v=Xa=ja=0;for(ii=F;ii--;){var Y=A[ii];if(Y.visible){var ma=
Y.style?renderer.applyStyle(Y.style,true):null;Y.draw(renderer,N,S,n,fa);ma&&renderer.applyStyle(ma)}}renderer.trigger("render",N);S.trigger("drawComplete",N,n);Mb=X;ia.move(H,v,K,t)}}else ia.move(H,Xa,Ya,t);if(ka||!c.inertia)G=x=0;else if(x!=0||G!=0){x*=0.8;G*=0.8;if(ga(x)<0.5)x=0;if(ga(G)<0.5)G=0}if(fa){n=fa?fa.elements:[];if(Oa&&Oa.type==="hover"){t=Hits.diffHits(Oa.elements,n);t.length>0&&Hits.triggerEvent(Oa,S,"Out",t)}if(n.length>0){v=fa.x;K=fa.y;for(t=n.length;t--;){N=n[t];Y=v;ma=K;var wa=
N&&N.drag&&(!N.canDrag||N.canDrag(N,Y,ma));if(wa){s=N;s.startX=Y;s.startY=ma}if(wa)break}Hits.triggerEvent(fa,S)}Oa=n.length>0?B({},fa):null;fa=null}}animFrame(l)}function m(n,t,v){fa=Hits.init(n,t,v,b(v.x,v.y,true));for(n=F;n--;)Q=Q||(A[n].hitGuess?A[n].hitGuess(fa.x,fa.y,S):false);Q&&ja++}function p(n,t,v){if(W(n,Ib)){n=ta(c.minZoom,sa(c.maxZoom,n));if(n!==Na){var K=ua(2,n-Na),N=lb/K|0,Y=mb/K|0;Na=n;q(((t||R+lb)-N)*K,((v||T+mb)-Y)*K);kb=jb=0;z("zoomLevelChange",n);X=1;renderer.trigger("reset");
D()}}return Na}function r(){ja++}function u(){var n=new qa(R,T,Za,$a);n.scaleFactor=X;return n}function w(n,t,v){if(W(t,$))for(t=0;t<F;t++){if(A[t].id===n)return A[t]}else{n=la("layer",t,S,v);n.added=ub();A[A.length]=n;A.sort(function(K,N){return N.zindex-K.zindex||N.added-K.added});F=A.length;n.trigger("resync");n.trigger("refresh",S,u());S.trigger("layerChange",S,n);ja++;return n}}function D(){var n=u();if(n){if(Da||Ea)if(n){var t=ab?R+(n.w>>1):R,v=bb?T+(n.h>>1):T,K=n.w,N=n.h;if(Da&&Da>K)if(t+K>
Da)R=ab?R:Da-K;else if(t<0)R=ab?R:0;if(Ea&&Ea>N)if(v+N>Ea)T=bb?T:Ea-N;else if(v<0)T=bb?T:0}jb=R;kb=T;z("refresh",S,n);ja++}}function C(n,t,v,K,N){var Y;if(!qc){v=false;Y=Ka(va(n)/Math.LN2);n=ua(2,Y)}v?Qa(X,n,v,N,function(ma,wa){n=ma;if(wa){Y=Ka(va(n)/Math.LN2);n=ua(2,Y);K&&K()}a(n)}):a(n);return S}function z(){for(var n=S.trigger.apply(null,arguments).cancel,t=A.length;t--;)n=A[t].trigger.apply(null,arguments).cancel||n;return!n}function q(n,t,v,K,N){function Y(){ma+=1;if(ma>=2){Nb=false;N&&N()}}
var ma=0;if(v&&panSpeed===0){Qa(R,n,v,K,function(wa,nb){R=wa|0;(nb?Y:r)();return panSpeed===0});Qa(T,t,v,K,function(wa,nb){T=wa|0;(nb?Y:r)();return panSpeed===0});Nb=true}else{R=n|0;T=t|0;N&&N()}}c=B({container:"",captureHover:true,drawOnScale:true,fastpan:false,fastpanPadding:128,inertia:true,refreshDistance:256,pannable:false,scalable:false,fps:60,minZoom:1,maxZoom:1,renderer:"canvas",zoomLevel:1},c);var E=2,I=5,y={},A=[],F=0,H=null,P=null,O,s=null,L=!W(window.attachEvent,$),Q=false,ca=true,ka=
false,x=0,G=0,J=0,da=0,ea=c.refreshDistance,R=0,T=0,Xa=0,Ya=0,jb=0,kb=0,Da=null,Ea=null,ab=false,bb=false,ob=[],fa=null,Oa=null,Kb=0,X=1,Mb=1,Lb=0,ha=null,Wa={index:0,draw:false},qc=true,Nb=false,pc=1E3/c.fps|0,ja=0,Za,$a,lb,mb,lc,mc,Na=c.zoomLevel,nc=db("quad.out"),oc=300,S={id:c.id,padding:0,panSpeed:0,attachFrame:function(n,t){ob[ob.length]=n;t&&H.appendChild(n)},detach:function(){renderer&&renderer.trigger("detach");ha&&ha.unbind();if(P){O.removeChild(P);H=P=null}ob=[]},eachLayer:function(n){for(var t=
F;t--;)n(A[t])},layer:w,invalidate:r,refresh:D,resetScale:function(){X=1},scale:C,syncXY:function(){},triggerAll:z,removeLayer:function(n){a:{for(var t=F;t--;)if(A[t].id===n){n=t;break a}n=-1}if(n>=0&&n<F){S.trigger("layerRemove",S,A[n]);A.splice(n,1);ja++}F=A.length},getOffset:function(){return new V(R,T)},getRenderer:function(){return renderer},getScaleFactor:function(){return X},setMaxOffset:function(n,t,v,K){Da=n;Ea=t;ab=v;bb=K},getViewport:u,updateOffset:q,pan:function(n,t){x=n;G=t;ja++},zoomlevel:p};
za(S);S.bind("resize",function(){renderer.checkSize()});gb.init(function(n){S.markers=w("markers","draw",{zindex:20});y=n;O=document.getElementById(c.container);O.appendChild(P=ia.create("div","",ia.styles({width:O.offsetWidth+"px",height:O.offsetHeight+"px"})));Za=P.offsetWidth+0;$a=P.offsetHeight+0;lb=Za/2;mb=$a/2;P.appendChild(H=ia.create("div","",ia.styles({width:Za+"px",height:$a+"px","z-index":2,margin:"0px 0 0 0px"})));renderer=jc(c.renderer,S,H,O,c);ca=c.fastpan&&renderer.fastpan;ha&&ha.unbind();
if(renderer){ha=INTERACT.watch(renderer.interactTarget||O);if(c.scalable){ha.bind("zoom",g);ha.bind("doubleTap",d)}ha.bind("pointerDown",f);ha.bind("pointerMove",e);ha.bind("pointerUp",j);c.captureHover&&ha.bind("pointerHover",h);ha.bind("tap",k)}L?window.attachEvent("onresize",i):window.addEventListener("resize",i,false)});animFrame(l);return S});U("view","map",function(c){function g(e,j,i){h.zoomlevel(j);a(e,i)}function a(e,j,i,k){e=na.init(e,Cb(h.zoomlevel()));var o=h.getViewport();h.updateOffset(e.x-
(o.w>>1),e.y-(o.h>>1),i,k,function(){j&&j(h)})}c=B({zoomLevel:1,minZoom:1,maxZoom:18,pannable:true,scalable:true},c);var b=new V,d=0,f=c.tapExtent;c.adjustScaleFactor=function(e){return Math.pow(2,(e<1?Math.floor:Math.ceil)(Math.log(e)))};var h=B(la("view","simple",c),{getBoundingBox:function(){var e=h.getViewport();return e?Fa.init(na.toPos(new V(e.x,e.y2),d),na.toPos(new V(e.x2,e.y),d)):null},getCenterPosition:function(){var e=h.getViewport();if(e){e=new V(e.x+(e.w>>1),e.y+(e.h>>1));return na.toPos(e,
d)}return null},gotoBounds:function(e,j){var i=Fa.getZoomLevel(e,h.getViewport());g(Fa.getCenter(e),i,j)},gotoPosition:g,panToPosition:a,syncXY:function(e,j){return(j?na.syncPos:na.sync)(e,d)}});h.bind("tap",function(e,j,i,k){e=na.toPos(k,d);var o=na.toPos(Ca.offset(k,-f,f),d);k=na.toPos(Ca.offset(k,f,-f),d);h.trigger("geotap",j,i,e,Fa.init(o,k))});h.bind("refresh",function(e,j,i){if(b.x!=i.x||b.y!=i.y){h.trigger("boundsChange",h.getBoundingBox());b.x=i.x;b.y=i.y}});h.bind("zoomLevelChange",function(e,
j){var i;d=Cb(j);i=aa/d|0;h.setMaxOffset(i,i,true,false);h.resetScale();h.triggerAll("resync")});return h});var Aa=function(c,g,a){a=B({style:null,xy:null,size:10,fill:false,stroke:true,draggable:false,observable:true,properties:{},typeName:"Shape"},a);B(this,a);this.id="drawable_"+ec++;this.bounds=null;this.view=c;this.layer=g;this.rotation=this.animations=0;this.scaling=1;this.translateY=this.translateX=0;this.observable&&za(this)};Aa.prototype={constructor:Aa,animate:function(c,g,a,b){Vb(this,
c,g,a,b)},drag:null,draw:null,getProps:null,resync:function(c){if(this.xy){c.syncXY([this.xy]);this.size&&this.updateBounds(Ma.fromCenter(this.xy.x,this.xy.y,this.size,this.size))}},rotate:function(c){this.rotation=c},scale:function(c){this.scaling=c},translate:function(c,g){this.translateX=c;this.translateY=g},updateBounds:function(c,g){c&&(!this.bounds||c.x!=this.bounds.x||c.y!=this.bounds.y)&&this.trigger("move",this,c,this.bounds);this.bounds=c;if(g)this.xy=Ma.center(this.bounds)}};var tb=1E3/
60|0,Ha=[],Ab=0;U("drawable","marker",function(c,g,a){a=B({fill:true,stroke:false,markerStyle:"simple",hoverStyle:"highlight",typeName:"Marker"},a);return new Aa(c,g,a)});U("drawable","poly",function(c,g,a){a=B({simplify:false,fill:true,points:[],typeName:"Poly"},a);var b=a.points,d=a.simplify;Aa.call(this,a);B(this,{getPoints:function(){return[].concat(b)},resync:function(f){var h,e,j,i,k,o;f.syncXY(b);o=this.points=Ca.floor(d?Ca.simplify(b):b);for(var l=o.length;l--;){f=o[l].x;h=o[l].y;i=W(i,$)||
f<i?f:i;k=W(k,$)||h<k?h:k;e=W(e,$)||f>e?f:e;j=W(j,$)||h>j?h:j}this.updateBounds(new qa(i,k,e-i,j-k),true)}});this.haveData=b&&b.length>=2});U("drawable","line",function(c,g,a){a.fill=false;return la("drawable","poly",c,g,a)});U("drawable","image",function(c,g,a){function b(){if(j&&j.width>0){if(!this.centerOffset)this.centerOffset=new V(-j.width>>1,-j.height>>1);this.updateBounds(new qa(this.xy.x+this.centerOffset.x,this.xy.y+this.centerOffset.y,j.width,j.height),false)}}function d(k){if(this.imageUrl=
k){var o=this;Ra(this.imageUrl,function(l,m){j=l;if(m){var p=i.layer?i.layer.view:null;p&&p.invalidate()}b.apply(o)})}}a=B({image:null,imageUrl:null,centerOffset:null,typeName:"Image"},a);var f=Aa.prototype.resync,h=0,e=0,j=a.image,i=B(new Aa(c,g,a),{changeImage:d,getProps:function(){this.bounds||b(this,j);return{image:j,x:this.xy.x+h,y:this.xy.y+e}},resync:function(k){f.call(this,k);b.call(this)}});j||d.call(this,this.imageUrl);if(this.centerOffset){h=this.centerOffset.x;e=this.centerOffset.y}});
U("drawable","arc",function(c,g,a){a=B({startAngle:0,endAngle:Math.PI*2,typeName:"Arc"},a);return new Aa(c,g,a)});Sa.prototype={constructor:Sa,clip:null,cycle:function(){},draw:function(){},hitGuess:null};U("layer","tile",function(c,g){g=B({generator:"osm",imageLoadArgs:{}},g);var a=la("generator",g.generator,g).run,b=null,d=[],f=B(new Sa(g),{draw:function(h,e,j){h.drawTiles&&h.drawTiles(e,b.search(Ma.buffer(e,128)),j.panSpeed<2)}});f.bind("refresh",function(h,e,j){var i=(new Date).getTime();b&&a(e,
j,b,function(){e.invalidate();pa("GEN COMPLETED IN "+((new Date).getTime()-i)+" ms")})});f.bind("resync",function(){var h=c&&c.zoomlevel?c.zoomlevel():0;d[h]||(d[h]=vb(h));b=d[h]});return f});U("layer","draw",function(c,g){function a(i,k,o,l){var m=this.dragOffset;if(!m)m=this.dragOffset=new V(i.startX-this.xy.x,i.startY-this.xy.y);this.xy.x=k-m.x;this.xy.y=o-m.y;if(l){delete this.dragOffset;c.syncXY([this.xy],true);c.invalidate();this.trigger("dragDrop")}return true}function b(i){clearTimeout(e);
e=setTimeout(function(){f.sort(function(k,o){if(o.xy&&k.xy){var l=o.xy.y-k.xy.y;return l!=0?l:o.xy.x-k.xy.x}});i&&i.invalidate()},50)}function d(i,k,o,l){l&&h.remove(l,k);h.insert(o,k)}g=B({zindex:10},g);var f=[],h,e=0,j=B(new Sa(g),{itemCount:0,clear:function(){h=new wb;f=[];j.itemCount=0},create:function(i,k,o){i=la("drawable",i,j,k);if(o)f.unshift(i);else f[f.length]=i;i.resync(c);h&&i.bounds&&h.insert(i.bounds,i);b(c);i.bind("move",d);j.itemCount=f.length},draw:function(i,k,o,l,m){o={};l=h&&k?
h.search(k):[];for(var p=l.length;p--;){var r=l[p],u=r.style||j.style,w,D=i.applyTransform(r),C=r.getProps?r.getProps(i):o;if(C=(w=i["prep"+r.typeName])?w.call(i,r,k,m,C):null){if(m&&C.hit){m.elements.push(Hits.initHit(r.type,r,r.draggable?a:null));w=m.type+"Style";u=r[w]||j[w]||u}u=u?i.applyStyle(u,true):null;(w=r.draw||C.draw)&&w.call(r,C);u&&i.applyStyle(u)}D&&D.undo&&D.undo()}},find:function(){return[].concat(f)},hitGuess:function(i,k){return h&&h.search({x:i-10,y:k-10,w:20,h:20}).length>0}});
j.bind("resync",function(){h=vb(c.zoomlevel(),h);for(var i=f.length;i--;)f[i].resync(c)});return j});Z.prototype={constructor:Z,offset:function(c,g){var a=this.lat*oa,b=this.lon*oa,d=a+c/cb;a=hb(ra(g/cb)/La(a));b=b+a;d=(d+Ia)%Math.PI-Ia;b%=aa;return new Z(d*xa,b*xa)},toString:function(c){return this.lat+(c||" ")+this.lon}};var na=function(){function c(b,d){if(b.length){for(var f,h,e,j,i=b.length;i--;){c(b[i],d);f=W(f,$)||b.x<f?b.x:f;h=W(h,$)||b.y<h?b.y:h;e=W(e,$)||b.x>e?b.x:e;j=W(j,$)||b.y>j?b.y:
j}return new qa(f,h,e-f,j-h)}else if(b.mercXY){f=b.mercXY;b.x=Ka((f.x+Math.PI)/d);b.y=Ka((Math.PI-f.y)/d);b.rpp=d}return b}function g(b,d){if(b.length)for(var f=b.length;f--;)g(b[f],d);else{b.mercXY=new V(b.x*d-Math.PI,Math.PI-b.y*d);b.pos=ba.fromMercatorPixels(b.mercXY.x,b.mercXY.y)}return b}function a(b,d,f){b.pos=d;b.mercXY=ba.toMercatorPixels(d);(f=W(f,Ib)?f:b.rpp)&&c(b,f)}return{init:function(b,d){var f=new V;a(f,b,d);return f},sync:c,syncPos:g,toPos:function(b,d){d=d||b.rpp;return ba.fromMercatorPixels(b.x*
d-Math.PI,Math.PI-b.y*d)},updatePos:a}}();B(M,{ticks:ub,userMessage:function(c,g,a){M.trigger("userMessage",c,g,a)},Registry:Ja,DOM:ia,Rect:qa,XY:Ca,XYRect:Ma,Vector:hc,Hits:Hits,Service:gc,tweenValue:Qa,easing:db,Tile:eb,getImage:Ra,GeoXY:na,Pos:Z});var pb=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],oa=Math.PI/180,xa=180/Math.PI,qb=Ia,Ob=-qb,Pb=aa,rc=-Pb,cb=6371,Ta=0.08181919084262157,Pa=null,Qb={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",
CT:"COURT",LN:"LANE",HWY:"HIGHWAY",MWY:"MOTORWAY"},ba=function(){function c(a){return!a||a.lat===0&&a.lon===0}function g(a,b){return new Z(a,b)}return{calcDistance:function(a,b){if(c(a)||c(b))return 0;var d=(b.lat-a.lat)*oa>>1,f=(b.lon-a.lon)*oa>>1;d=ra(d)*ra(d)+La(a.lat*oa)*La(b.lat*oa)*ra(f)*ra(f);d=2*dc(Va(d),Va(1-d));return cb*d},copy:function(a){return a?g(a.lat,a.lon):null},empty:c,equal:function(a,b){return a&&b&&a.lat==b.lat&&a.lon==b.lon},fromMercatorPixels:function(a,b){for(var d=ua(Math.E,
-b),f=Ia-2*Eb(d),h=Db(f,d),e=0;e<12&&ga(f-h)>1.0E-7;){f=h;h=Db(f,d);e++}return g(h*xa,a%360*xa)},generalize:function(a,b,d){var f=a.length,h=[],e=null;d||(d=250);d/=1E3;pa("generalizing positions, must include "+b.length+" positions");for(var j=f;j--;)if(j===0)h.unshift(a[j]);else{var i=!e||ba.inArray(a[j],b)?d:ba.calcDistance(e,a[j]);if(a[j]&&i>=d){h.unshift(a[j]);e=a[j]}}pa("generalized "+f+" positions into "+h.length+" positions");return h},inArray:function(a,b){for(var d=ba.equal,f=b.length;f--;)if(d(a,
b[f]))return true;return false},inBounds:function(a,b){var d=!(ba.empty(a)||ba.empty(b));return d=(d=d&&a.lat>=b.min.lat&&a.lat<=b.max.lat)&&a.lon>=b.min.lon&&a.lon<=b.max.lon},init:g,parse:function(a){return new Z(a)},parseArray:function(a){var b=a.length,d=Array(b);for(b=b;b--;)d[b]=new Z(a[b]);return d},toMercatorPixels:function(a){var b=parseFloat(a.lon)*oa;a=parseFloat(a.lat)*oa;a=ra(a);var d=Ta*a;a=va((1+a)/(1-a)*ua((1-d)/(1+d),Ta))/2;return new V(b,a)},toString:function(a){return a?a.toString():
""},vectorize:function(a,b){function d(){for(var j=0,i=b.chunkSize,k=f;k--;){h[k]=M.GeoXY.init(a[k]);j+=1;if(j>i)break}f=k;if(f<=0)b.callback&&b.callback(h);else animFrame(d)}var f=a.length,h=Array(f);b=B({chunkSize:500,async:true,callback:null},b);if(!b.async){for(var e=f;e--;)h[e]=M.GeoXY.init(a[e]);return h}animFrame(d);return null}}}(),Fa=function(){function c(d,f,h){var e=new V(0,f.lat-d.lat);e.x=(h||W(h,$))&&d.lon>f.lon?360-d.lon+f.lon:f.lon-d.lon;return e}function g(d,f){return Fa.init(new Z(d.min.lat-
f,d.min.lon-f%360),new Z(d.max.lat+f,d.max.lon+f%360))}function a(d){var f=c(d.min,d.max);return new Z(d.min.lat+(f.y>>1),d.min.lon+(f.x>>1))}function b(d,f){return{min:new Z(d),max:new Z(f)}}return{calcSize:c,createBoundsFromCenter:function(d,f){var h=f/cb,e=d.lat*oa,j=d.lon*oa,i=e-h,k=e+h;if(i>Ob&&k<qb){e=hb(ra(h)/La(e));h=(j-e)%aa;j=(j+e)%aa}else{i=ta(i,Ob);k=sa(k,qb);h=rc;j=Pb}return Fa.init(new Z(i*xa,h*xa),new Z(k*xa,j*xa))},expand:g,forPositions:function(d,f){var h=null;M.ticks();f||(f="auto");
for(var e=d.length;e--;)if(h){var j=c(h.min,d[e],false),i=c(d[e],h.max,false);if(j.x<0)h.min.lon=d[e].lon;if(j.y<0)h.min.lat=d[e].lat;if(i.x<0)h.max.lon=d[e].lon;if(i.y<0)h.max.lat=d[e].lat}else h=b(d[e],d[e]);if(f){if(f=="auto"){e=c(h.min,h.max);f=ta(e.x,e.y)*0.3}h=g(h,f)}return h},getCenter:a,getZoomLevel:function(d,f){var h=a(d);h=sa(Ka(ga(h.lat)*0.05),pb.length);var e=pb[h],j=c(d.min,d.max);h=Hb(va(pb[3]*f.h/j.y)/va(2));e=Hb(va(e*f.w/j.x)/va(2));return sa(isNaN(h)?1E3:h,isNaN(e)?1E3:e)},init:b,
isEmpty:function(d){return!d||ba.empty(d.min)||ba.empty(d.max)},toString:function(d){return"min: "+ba.toString(d.min)+", max: "+ba.toString(d.max)}}}();Ja=function(){var c=/^(\d+).*$/,g=/(\d+)\s?\-\s?(\d+)/;return{buildingMatch:function(a,b){c.lastIndex=-1;if(c.test(a))for(var d=a.replace(c,"$1"),f=b.split(","),h=0;h<f.length;h++){g.lastIndex=-1;if(g.test(f[h])){var e=g.exec(f[h]);if(d>=parseInt(e[1],10)&&d<=parseInt(e[2],10))return true}else if(d==f[h])return true}return false},normalize:function(a){if(!a)return"";
a=a.toUpperCase();if(!Pa){var b=[];for(var d in Qb)b.push(d);Pa=RegExp("(\\s)("+b.join("|")+")(\\s|$)","i")}Pa.lastIndex=-1;if(b=Pa.exec(a))a=a.replace(Pa,"$1"+Qb[b[2]]);return a},toString:function(a){return a.streetDetails+" "+a.location}}}();U("generator","osm",function(c){c=M.ex({flipY:false,tileSize:256,tilePath:"{0}/{1}/{2}.png",osmDataAck:true},c);var g=Math.PI/180,a=180/Math.PI,b=null,d=[],f,h=M.formatter(c.tilePath),e={buildTileUrl:function(j,i,k,o,l){if(i>=0&&i<o){j=(j%o+o)%o;i=h(k,j,l?Math.abs(i-
o+1):i);if(b)i=f(d[j%(d.length||1)])+i;return i}},run:function(j,i,k,o){if(j=j.zoomlevel?j.zoomlevel():0){var l=2<<j-1,m=c.tileSize,p=Math.PI*2/(m<<j),r=(i.w/m|0)+1,u=(i.h/m|0)+1;i=M.GeoXY.toPos(M.XY.init(i.x,i.y),p);var w=i.lat;i=M.XY.init((i.lon+180)/360*l|0,(1-Math.log(Math.tan(w*g)+1/Math.cos(w*g))/Math.PI)/2*l%l|0);w=Math.PI-2*Math.PI*i.y/l;var D=i.x/l*360-180;w=new M.Pos(a*Math.atan(0.5*(Math.exp(w)-Math.exp(-w))),D);p=M.GeoXY.init(w,p);w=c.flipY;var C=k.search({x:p.x,y:p.y,w:r*m,h:u*m});D=
{};var z;for(z=C.length;z--;)D[C[z].id]=true;d=(b=e.getServerDetails?e.getServerDetails():null)&&b.subDomains?b.subDomains:[];f=M.formatter(b?b.baseUrl:"");for(C=0;C<=r;C++)for(z=0;z<=u;z++){var q=i.x+C,E=i.y+z,I=q+"_"+E;if(!D[I]){tileUrl=e.buildTileUrl(q,E,j,l,w);q=new M.Tile(p.x+C*m,p.y+z*m,tileUrl,m,m,I);k.insert(q,q)}}o&&o()}}};c.osmDataAck&&M.userMessage("ack","osm",'Map data (c) <a href="http://openstreetmap.org/" target="_blank">OpenStreetMap</a> (and) contributors, CC-BY-SA');return e});var sc=
"featurecollection",tc="feature",Fb={async:false};U={processor:null,group:"shapes",layer:"draw"};var uc={point:B({},U,{processor:function(c,g,a,b){g=fb([g.coordinates],Fb);if(g.length>0)if(a=b.marker(g[0],a)){c.add(a);return g.length}},group:"markers",layer:"draw"}),linestring:B({},U,{processor:function(c,g,a,b){g=fb(g&&g.coordinates?g.coordinates:[]);return Ua(c,g,a,b.line)}}),multilinestring:B({},U,{processor:function(c,g,a,b){g=g&&g.coordinates?g.coordinates:[];for(var d=0,f=g.length;f--;)d+=Ua(c,
g[f],a,b.line);return d}}),polygon:B({},U,{processor:function(c,g,a,b){g=g&&g.coordinates?g.coordinates:[];if(g.length>0)return Ua(c,g[0],a,b.poly);return 0}}),multipolygon:B({},U,{processor:function(c,g,a,b){g=g&&g.coordinates?g.coordinates:[];for(var d=0,f=0;f<g.length;f++)d+=Ua(c,g[f][0],a,b.poly);return d}})},Rb=function(c,g,a,b){function d(r,u){var w=r.processor,D=i+r.group,C=B({},r,a,{properties:u.properties});if(w){var z=p[D];if(!z){z=new r.layerClass({id:D});p[D]=z}return w(z,u.data,C,b)}return 0}
function f(r,u){var w=r&&r.type?r.type.toLowerCase():null;return w&&w===tc?f(r.geometry,r.properties):{type:w,isCollection:w?w===sc:false,definition:uc[w],data:r,properties:u?u:r.properties}}function h(r){var u=0,w=B({},a),D=k;r=r?r:(new Date).getTime();if(!l){for(;D<o;D++){r=f(j?j(c[D]):c[D]);var C=null;if(r.isCollection){w.layerPrefix=i+m++ +"-";l=new Rb(r.data.features,function(z){l=null;for(var q in z)p[q]=z[q];k>=o&&g&&g(p)},w);C+=1}else if(r.definition)C=d(r.definition,r);u+=C?C:1;if(u>=e)break}k=
D+1;if(l||k<o)animFrame(h);else g&&g(p)}}a=B({rowPreParse:null,simplify:false,layerPrefix:"geojson-"},a);b=B({marker:function(r){return la("drawable","marker",{xy:r})},line:function(r,u){return la("drawable","line",B({points:r},a,u))},poly:function(r,u){return la("drawable","poly",B({points:r},a,u))}},b);var e=500,j=a.rowPreParse,i=a.layerPrefix,k=0,o=0,l=null,m=0,p={};if(c){W(c,"array")||(c=[c]);o=c.length;animFrame(h)}};U=M.GeoJSON={parse:function(c,g,a){return new Rb(c,g,a)}};M.Geo={Address:function(c){return c=
B({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},c)},A:Ja,GeoJSON:U};rb.T5=M;rb.Tile5=function(c,g){g=B({container:c,type:"map",renderer:"canvas",starpos:null,zoom:1,fastpan:false,drawOnScale:true,zoombar:{}},g);return la("view",g.type,g)}})(window);
