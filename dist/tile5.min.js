COG=function(){var f=/\$\{(.*?)\}/ig,n=Object.prototype.hasOwnProperty,h=0,d={id:"grunt.core",extend:function(){var a=arguments[0]||{},e=1,k=arguments.length,b=false,o,l,m,g;if(typeof a==="boolean"){b=a;a=arguments[1]||{};e=2}if(typeof a!=="object"&&!d.isFunction(a))a={};if(k===e){a=this;--e}for(;e<k;e++)if((o=arguments[e])!=null)for(l in o){m=a[l];g=o[l];if(a!==g)if(b&&g&&(d.isPlainObject(g)||d.isArray(g))){m=m&&(d.isPlainObject(m)||d.isArray(m))?m:d.isArray(g)?[]:{};a[l]=d.extend(b,m,g)}else if(g!==
undefined)a[l]=g}return a},isFunction:function(a){return toString.call(a)==="[object Function]"},isArray:function(a){return toString.call(a)==="[object Array]"},isPlainObject:function(a){if(!a||toString.call(a)!=="[object Object]"||a.nodeType||a.setInterval)return false;if(a.constructor&&!n.call(a,"constructor")&&!n.call(a.constructor.prototype,"isPrototypeOf"))return false;var e;for(e in a);return e===undefined||n.call(a,e)},isEmptyObject:function(a){for(var e in a)return false;return true},isXmlDocument:function(a){return toString.call(a)===
"[object Document]"},contains:function(a,e){var k=a,b=arguments,o=1;if(e&&d.isArray(e)){b=e;o=0}for(o=o;o<b;o++)k=k&&typeof foo[b[o]]!=="undefined";return k},newModule:function(a){a=d.extend({id:null,requires:[],parent:null},a);if(a.parent)a=d.extend({},a.parent,a);return a},toID:function(a){return a.replace(/\s/g,"-")},objId:function(a){return(a?a:"obj")+h++},formatStr:function(a){if(arguments.length<=1)return a;for(var e=arguments.length-2,k=0;k<=e;k++)a=a.replace(RegExp("\\{"+k+"\\}","gi"),arguments[k+
1]);return a},wordExists:function(a,e){var k="";if(e.toString)e=e.toString();for(var b=0;b<e.length;b++)k+=!/\w/.test(e[b])?"\\"+e[b]:e[b];return RegExp("(^|\\s|\\,)"+k+"(\\,|\\s|$)","i").test(a)},parseTemplate:function(a,e){for(var k=f.exec(a);k;){a=a.replace(k[0],COG.XPath.first(k[1],e));f.lastIndex=0;k=f.exec(a)}return a}};return d}();
COG.Log=function(){function f(e,k){var b,o=k&&k.length>0?k[0]:"";for(b=1;k&&b<k.length;b++)o+=" "+(h&&COG.isPlainObject(k[b])?JSON.stringify(k[b]):k[b]);typeof console!=="undefined"&&console[e](o);for(b=0;b<n.length;b++)n[b].call(a,o,e)}var n=[],h=typeof JSON!=="undefined",d=window.console&&window.console.markTimeline,a={id:"grunt.log",getTraceTicks:function(){return d?(new Date).getTime():null},trace:function(e,k){if(d)console.markTimeline(e+(k?": "+(a.getTraceTicks()-k)+"ms":""))},debug:function(){f("debug",
arguments)},info:function(){f("info",arguments)},warn:function(){f("warn",arguments)},error:function(){f("error",arguments)},exception:function(e){a.error(arguments);for(var k in e)a.info("ERROR DETAIL: "+k+": "+e[k])},watch:function(e,k){try{k()}catch(b){a.exception(b,e)}},throwError:function(e){a.error(e);throw Error(e);},requestUpdates:function(e){n.push(e)}};return a}();
(function(){function f(d,a){d[a]||(d[a]=function(e){return d.configure(a,e)})}function n(d){d.gtConfId=COG.objId("configurable");d.gtConfig={};d.gtConfigFns=[];return d.gtConfig}var h={};COG.paramTweaker=function(d,a,e){return function(k,b){if(typeof b!=="undefined"){if(k in d)d[k]=b;e&&k in e&&e[k](k,b)}else return a&&k in a?a[k](k):d[k]}};COG.configurable=function(d,a,e,k){if(d){d.gtConfId||n(d);var b=d.gtConfId,o=d.gtConfig,l=d.gtConfigFns;h[b]=d;l.push(e);for(e=a.length;e--;){o[a[e]]=true;k&&
f(d,a[e])}if(!d.configure)d.configure=function(m,g){if(o[m]){for(var p=l.length;p--;){var v=l[p](m,g);if(typeof v!=="undefined")return v}return h[b]}return null}}}})();
(function(){function f(n,h){var d=n.gtObsHandlers;d[h]||(d[h]=[]);return d[h]}COG.observable=function(n){if(n){if(!n.gtObsHandlers)n.gtObsHandlers={};if(!(n.bind||n.trigger||n.unbind)){n.bind=function(h,d){var a=COG.objId("callback");f(n,h).unshift({fn:d,id:a});return a};n.trigger=function(h){var d=f(n,h),a={cancel:false,tickCount:(new Date).getTime()},e;if(!d)return null;e=Array.prototype.slice.call(arguments,1);e.unshift(a);for(var k=d.length;k--&&!a.cancel;)d[k].fn.apply(self,e);return a};n.unbind=
function(h,d){for(var a=f(n,h),e=0;a&&e<a.length;e++)if(a[e].id===d){a.splice(e,1);break}return n}}}}})();(function(){var f={},n=[];COG.addPipe=function(h){h("pipe.test",{});n.push(h)};COG.listen=function(h,d){f[h]||(f[h]=[]);d&&f[h].push(d)};COG.say=function(h,d){var a;for(a=n.length;a--;)n[a](h,d);if(f[h])for(a=f[h].length;a--;)f[h][a](d)}})();
COG.Loopage=function(){function f(g){return COG.extend({id:e++,frequency:0,after:0,single:false,lastTick:0,execute:function(){}},g)}function n(g){b.push(g);h()}function h(){o&&clearTimeout(o);o=setTimeout(d,0);m=true}function d(){for(var g,p=(new Date).getTime(),v=k.length;b.length>0;){var y=b.shift();for(g=v;g--;)if(k[g].id===y){k.splice(g,1);break}m=true;v=k.length}if(m){l=a;for(g=v;g--;)l=k[g].frequency<l?k[g].frequency:l}for(g=v;g--;){y=p-k[g].lastTick;if(k[g].lastTick===0||y>=k[g].frequency){k[g].execute(p,
k[g]);k[g].lastTick=p;k[g].single&&k[g].trigger("complete")}}o=v?setTimeout(d,l):0}var a=6E4,e=0,k=[],b=[],o=0,l=a,m=true;return{join:function(g){var p=new f(g);if(p.after>0)p.lastTick=(new Date).getTime()+p.after;COG.observable(p);p.bind("complete",function(){n(p.id)});k.unshift(p);h();return p},leave:n}}();if(!this.JSON)this.JSON={};
(function(){function f(l){return l<10?"0"+l:l}function n(l){a.lastIndex=0;return a.test(l)?'"'+l.replace(a,function(m){var g=b[m];return typeof g==="string"?g:"\\u"+("0000"+m.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+l+'"'}function h(l,m){var g,p,v,y,w=e,r,u=m[l];if(u&&typeof u==="object"&&typeof u.toJSON==="function")u=u.toJSON(l);if(typeof o==="function")u=o.call(m,l,u);switch(typeof u){case "string":return n(u);case "number":return isFinite(u)?String(u):"null";case "boolean":case "null":return String(u);
case "object":if(!u)return"null";e+=k;r=[];if(Object.prototype.toString.apply(u)==="[object Array]"){y=u.length;for(g=0;g<y;g+=1)r[g]=h(g,u)||"null";v=r.length===0?"[]":e?"[\n"+e+r.join(",\n"+e)+"\n"+w+"]":"["+r.join(",")+"]";e=w;return v}if(o&&typeof o==="object"){y=o.length;for(g=0;g<y;g+=1){p=o[g];if(typeof p==="string")if(v=h(p,u))r.push(n(p)+(e?": ":":")+v)}}else for(p in u)if(Object.hasOwnProperty.call(u,p))if(v=h(p,u))r.push(n(p)+(e?": ":":")+v);v=r.length===0?"{}":e?"{\n"+e+r.join(",\n"+e)+
"\n"+w+"}":"{"+r.join(",")+"}";e=w;return v}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
a=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e,k,b={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},o;if(typeof JSON.stringify!=="function")JSON.stringify=function(l,m,g){var p;k=e="";if(typeof g==="number")for(p=0;p<g;p+=1)k+=" ";else if(typeof g==="string")k=g;if((o=m)&&typeof m!=="function"&&(typeof m!=="object"||typeof m.length!=="number"))throw Error("JSON.stringify");return h("",
{"":l})};if(typeof JSON.parse!=="function")JSON.parse=function(l,m){function g(v,y){var w,r,u=v[y];if(u&&typeof u==="object")for(w in u)if(Object.hasOwnProperty.call(u,w)){r=g(u,w);if(r!==undefined)u[w]=r;else delete u[w]}return m.call(v,y,u)}var p;l=String(l);d.lastIndex=0;if(d.test(l))l=l.replace(d,function(v){return"\\u"+("0000"+v.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(l.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){p=eval("("+l+")");return typeof m==="function"?g({"":p},""):p}throw new SyntaxError("JSON.parse");}})();
(function(){function f(h,d){var a=h.split("|"),e={};for(var k in d){var b=d[k];e[k]=a.length>b?a[b]:null}return e}var n={JSON:{parse:function(h){return JSON.parse(h)}},PDON:{parse:function(h){var d=null,a=[];h=h.split("\n");for(var e=0;e<h.length;e++){var k=h[e];if(d)a.push(f(k,d));else if(k){d=k.split("|");k={};for(var b=0;b<d.length;b++)k[d[b]]=b;d=k}else d=null}return a}}};COG.parseData=function(h,d){d=d?d.toUpperCase():"JSON";if(!n[d])throw Error("Unsupported data format: "+d);try{return n[d].parse(h)}catch(a){COG.Log.exception(a)}return{}}})();
COG.XPath=function(){function f(a){for(var e=null,k=0;k<n.length;k++)if(e=n[k](a))break;return e}var n=[],h=[null,function(a){return a.numberValue},function(a){return a.stringValue},function(a){return a.booleanValue},null,null,null,null,function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null},function(a){return a.singleNodeValue?a.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||COG.Log.warn("No XPATH support");var d={SearchResult:function(a){return{toString:function(){var e=
null;if(a){var k=null;if(a.resultType>=0&&a.resultType<h.length)k=h[a.resultType];if(k)e=k(a)}return e?e:""}}},first:function(a,e){var k=d.SearchResult,b;var o=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!o)o=XPathResult.ANY_TYPE;try{if(COG.isXmlDocument(e))b=e.evaluate(a,e,f,o,null);else{COG.Log.warn("attempted xpath expression: "+a+" on a non-xml document");b=null}}catch(l){COG.Log.warn("invalid xpath expression: "+a+" on node: "+e);b=null}return new k(b)},registerResolver:function(a){n.push(a)}};return d}();
COG.Storage=function(){function f(n){if(n&&n=="session")return sessionStorage;return localStorage}return{get:function(n,h){var d=f(h).getItem(n);return/^(\{|\[).*(\}|\])$/.test(d)?JSON.parse(d):d},set:function(n,h,d){h=jQuery.isArray(h)||jQuery.isPlainObject(h)?JSON.stringify(h):h;f(d).setItem(n,h)},remove:function(n,h){f(h).removeItem(n)}}}();
COG.ParseRules=function(){var f=[];return{add:function(n,h){f.push({regex:n,handler:h})},each:function(n,h,d){function a(){e++;d&&e>=f.length&&d(h)}for(var e=0,k=0;k<f.length;k++){var b=f[k].regex,o=f[k].handler,l=false;if(b){b.lastIndex=-1;if((b=b.exec(n))&&o){l=true;o(b,h,a)&&a()}}l||a()}}}};
(function(){function f(b){var o=[],l=function(g,p){p=COG.isFunction(p)?p():p;o[o.length]=encodeURIComponent(g)+"="+encodeURIComponent(p)};if(COG.isArray(b))for(var m=0;m<b.length;m++)l(b[m].name,b[m].value);else for(m in b)l(m,b[m]);return o.join("&").replace(/%20/g,"+")}var n={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},h={JSON:["json"],PDON:["pdon.txt"]},d=["TEXT","STREAM"],a=/^(\w+:)?\/\/([^\/?#]+)/,e={XML:function(b){return b.responseXML},JSON:function(b){return COG.parseData(b.responseText)},
PDON:function(b){return COG.parseData(b.responseText,"PDON")},DEFAULT:function(b){return b.responseText}},k={CONTENT_TYPE:"Content-Type"};COG.xhr=function(b){function o(){if(this.readyState===4){var p=null,v=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(v)if(b.handleResponse)b.handleResponse(this);else{var y=b,w=this.getResponseHeader(k.CONTENT_TYPE),r,u=false;for(r in n)if(w&&w.indexOf(n[r])>=0){u=true;
break}w=!u;for(u=0;u<d.length;u++)w=w||d[u]==r;if(w)b:{w=r;for(var A in h)for(u=0;u<h[A].length;u++)if(RegExp(h[A][u]+"$","i").test(y.url)){r=A;break b}r=w?w:"DEFAULT"}try{p=e[r](this,y)}catch(z){p=e.DEFAULT(this,y)}}else b.error&&b.error(this)}catch(I){COG.Log.exception(I,"PROCESSING AJAX RESPONSE")}v&&p&&b.success&&b.success.call(this,p)}}try{b=COG.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},b);var l=
a.exec(b.url),m=l&&(l[1]&&l[1]!==location.protocol||l[2]!==location.host);if(b.data)b.method="POST";if(b.url){l=null;if(b.xhr)l=b.xhr(b);l||(l=new XMLHttpRequest);l.open(b.method,b.url,b.async);b.data&&l.setRequestHeader("Content-Type",b.contentType);m||l.setRequestHeader("X-Requested-With","XMLHttpRequest");l.onreadystatechange=o;l.send(b.method=="POST"?f(b.data):null)}else COG.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(g){COG.Log.exception(g)}}})();
(function(){function f(a){var e=document.createElement("script"),k=false;e.src=a;e.async=true;e.onload=e.onreadystatechange=function(){if(!k&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){k=true;e.onload=e.onreadystatechange=null;e&&e.parentNode&&e.parentNode.removeChild(e)}};h||(h=document.getElementsByTagName("head")[0]);h.appendChild(e)}var n=0,h,d=this;COG.jsonp=function(a,e,k){a+=a.indexOf("?")>=0?"&":"?";var b="json"+ ++n;d[b]=function(o){e(o);d[b]=null;try{delete d[b]}catch(l){}};
f(a+(k?k:"callback")+"="+b);return b}})();
COG.Touch=function(){function f(t,q){return{x:t.x-q.x,y:t.y-q.y}}function n(t,q){var s=f(t,q);return Math.sqrt(s.x*s.x+s.y*s.y)}function h(t){if(t.count>1)return n(t.touches[0],t.touches[1]);return 0}function d(t,q){var s=t&&t.count>0?t.touches[0]:null;if(s&&q&&q.count>0)return f(s,q.touches[0]);return null}function a(t,q){t.count=q.count;for(var s=l;s--;){t.touches[s].x=q.touches[s].x;t.touches[s].y=q.touches[s].y}}function e(){for(var t={count:0,touches:Array(l)},q=l;q--;)t.touches[q]=o();return t}
function k(t){if(t.preventDefault){t.preventDefault();t.stopPropagation()}else t.cancelBubble&&t.cancelBubble()}function b(t,q,s){if(H){q=q[s?s:"touches"];s=q.length;for(s=t.count=s;s--;){t.touches[s].x=q[s].pageX;t.touches[s].y=q[s].pageY}}else if(q.button===0){t.count=1;t.touches[0].x=q.pageX?q.pageX:q.screenX;t.touches[0].y=q.pageY?q.pageY:q.screenY}else t.count=0}function o(t,q){return{x:t?t:0,y:q?q:0}}var l=10,m=120,g=100,p=250,v=300,y=5,w=0,r=1,u=2,A=7,z=0,I=0,H=undefined,W=function(t){function q(F,
K,R,Q){var B=Math.asin((F.y-K.y)/R);R=R*(va/Q)>>0;R=R>ua?ua:R;B=K.x>F.x?B:Math.PI-B;G("pan",Math.cos(B)*-R,Math.sin(B)*R,true)}function s(F,K){var R,Q;if(H){R=K-ga;if(R<p){Q=n(T.touches[0],F);Q>t.inertiaTrigger&&q(T.touches[0],F,Q,R)}}else{ja.x=F.x;ja.y=F.y;COG.Loopage.join({execute:function(B,E){R=B-K;Q=n(F,ja);if(R<g&&Q>t.inertiaTrigger){E.trigger("complete");q(F,ja,Q,R)}else R>g&&E.trigger("complete")},frequency:10})}}function x(F){var K=0,R=0;if(F.offsetParent){do{K+=F.offsetLeft;R+=F.offsetTop;
F=F.offsetParent}while(F)}return o(K,R)}function C(F){var K=F.count,R=Array(K),Q=x(ka);for(K=K;K--;)R[K]=o(F.touches[K].x-Q.x,F.touches[K].y-Q.y);return R}function G(){oa&&oa.trigger.apply(null,arguments)}function N(F,K){var R=x(ka);R=o(K.x-R.x,K.y-R.y);G(F,K,R)}function J(F){var K=F.target?F.target:F.srcElement;if(qa||K&&K===ka){b(T,F);if(T.count!==0){ca=null;da.x=0;da.y=0;U=true;S=false;ga=(new Date).getTime();k(F);K.style.cursor="move";G("inertiaCancel");sa=ga;if(F=T.count>0?T.touches[0]:null){G("touchStart",
F.x,F.y);if(sa-ta<v)if((F=f(T.touches[0],$.touches[0]))&&Math.abs(F.x)<t.maxDistDoubleTap&&Math.abs(F.y)<t.maxDistDoubleTap)S=true;ea=w;a($,T)}else COG.Log.warn("Touch start fired, but no touch vector found")}}}function D(F){var K=F.target?F.target:F.srcElement,R=0;if(qa||K&&K===ka){b(aa,F);if(aa.count>0){ja.x=aa.touches[0].x;ja.y=aa.touches[0].y}if(U){H&&k(F);if(aa.count>1){T.count===1&&a(T,aa);R=h(T)-h(aa)}if(ea===w)if((F=d(aa,T))&&(Math.abs(F.x)>=A||Math.abs(F.y)>=A))ea=r;if(ea!==w)if(!R||Math.abs(R)<
y){if(ca=d(aa,$)){da.x-=ca.x;da.y-=ca.y;ba.x-=ca.x;ba.y-=ca.y}G("pan",ba.x,ba.y);ba.x=0;ba.y=0;ea=r}else{G("pinchZoom",C(T),C(aa));ea=u}a($,aa)}}}function O(F){var K=F.target?F.target:F.srcElement;if(U&&(qa||K&&K===ka)){b(ha,F,"changedTouches");var R=ha.touches[0];H&&k(F);F=(new Date).getTime();ta=sa;if(ea===w){N("tap",T.touches[0]);P||(P=setTimeout(function(){P=0;S&&N("doubleTap",T.touches[0])},v+50))}else if(ea==r){G("panEnd",da.x,da.y);na&&s(R,F)}else ea==u&&G("pinchZoomEnd",C(T),C($),F-ga);K.style.cursor=
"default";U=false}}function L(F){var K=F.target?F.target:F.srcElement;if(qa||K&&K===ka){if(F.detail){K=-F.detail*m;K=o(F.axis===1?K:0,F.axis===2?K:0)}else K=o(F.wheelDeltaX,F.wheelDeltaY);var R=K.y!==0?Math.abs(K.y/m):0;if(ja&&R!==0){var Q=o(ja.x-ka.offsetLeft,ja.y-ka.offsetTop);G("wheelZoom",Q,Math.pow(2,K.y>0?R:-R))}k(F)}}t=COG.extend({element:null,observable:null,inertiaTrigger:20,maxDistDoubleTap:20,touchStartHandler:null,moveHandler:null,moveEndHandler:null,pinchZoomHandler:null,pinchZoomEndHandler:null,
tapHandler:null,doubleTapHandler:null,wheelZoomHandler:null},t);var S=false,P=0,X=T5.getConfig(),T=e(),aa=e(),$=e(),ha=e(),ca=null,da=o(),ba=o(),ea=null,U=false,ga=0,fa=[],ja=o(),na=false,va,ua,sa=0,ta=0,ka=t.element,oa=t.observable,qa=typeof FlashCanvas!=="undefined",ma={supportsTouch:H,addListeners:function(F){fa.push(F)},decoupleListeners:function(F){for(var K=0;F&&K<fa.length;K++)if(fa[K].listenerId===F){fa.splice(K,1);break}},release:function(){X.unbindEvent(H?"touchstart":"mousedown",J,false);
X.unbindEvent(H?"touchmove":"mousemove",D,false);X.unbindEvent(H?"touchend":"mouseup",O,false);if(!H){window.removeEventListener("mousewheel",L,false);window.removeEventListener("DOMMouseScroll",L,false)}},inertiaEnable:function(F,K){na=true;va=F;ua=K?Math.min(K.width,K.height):500},inertiaDisable:function(){na=false}};if(typeof H==="undefined")H=T5.getConfig().supportsTouch;X.bindEvent(H?"touchstart":"mousedown",J,false);X.bindEvent(H?"touchmove":"mousemove",D,false);X.bindEvent(H?"touchend":"mouseup",
O,false);if(!H){X.bindEvent("mousewheel",L,window);X.bindEvent("DOMMouseScroll",L,window)}return ma},V=[];return{capture:function(t,q){if(!t)throw Error("Unable to capture touch of null element");if(!t.id)t.id="touchable_"+z++;var s=V[t.id];if(!s){s=new W(COG.extend({element:t},q));V[t.id]=s}if(q){q.listenerId&&s.decoupleListeners(q.listenerId);q.listenerId=++I;s.addListeners(q)}return s},release:function(t){if(t&&t.id&&V[t.id]){V[t.id].release();delete V[t.id]}}}}();
T5=function(){var f=function(){function a(b,o){return k(b.x-o.x,b.y-o.y)}function e(b,o){if(!o)o=b.length;if(o<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var l={edges:Array(o-1),accrued:Array(o-1),total:0},m=0;m<o-1;m++){var g=a(b[m],b[m+1]);l.edges[m]=Math.sqrt(g.x*g.x+g.y*g.y);l.accrued[m]=l.total+l.edges[m];l.total+=l.edges[m]}return l}function k(b,o){return{x:b?b:0,y:o?o:0}}return{VECTOR_SIMPLIFICATION:3,SIMPLIFICATION_MIN_VECTORS:25,add:function(){for(var b=
0,o=0,l=arguments.length;l--;){b+=arguments[l].x;o+=arguments[l].y}return k(b,o)},absSize:function(b){return Math.max(Math.abs(b.x),Math.abs(b.y))},copy:function(b){return b?k(b.x,b.y):null},diff:a,distance:function(b,o){return e(b,o).total},edges:e,equals:function(b,o){return b.x===o.x&&b.y===o.y},extendBy:function(b,o,l){return k(b.x-Math.cos(o)*l,b.y-Math.sin(o)*l)},floor:function(b){for(var o=Array(b.length),l=b.length;l--;)o[l]=k(~~b[l].x,~~b[l].y);return o},getRect:function(b){for(var o,l,m,
g,p=b.length;p--;){var v=b[p];o=typeof o==="undefined"||v.x<o?v.x:o;l=typeof l==="undefined"||v.y<l?v.y:l;m=typeof m==="undefined"||v.x>m?v.x:m;g=typeof g==="undefined"||v.y>g?v.y:g}return h.init(o,l,g,g)},init:k,invert:function(b){return k(-b.x,-b.y)},offset:function(b,o,l){return k(b.x+o,b.y+(l?l:o))},simplify:function(b,o){if(!b)return null;o=o?o:f.VECTOR_SIMPLIFICATION;for(var l=[],m=null,g=b.length;g--;){var p=b[g];if(include=!m||g===0||Math.abs(p.x-m.x)+Math.abs(p.y-m.y)>o){l.unshift(p);m=p}}return l},
theta:function(b,o,l){l=Math.asin((b.y-o.y)/l);return b.x>o.x?l:Math.PI-l}}}(),n=function(){return{dotProduct:function(a,e){return a.x*e.x+a.y*e.y}}}(),h=function(){function a(e,k,b,o){e=e?e:0;k=k?k:0;b=b?b:e;o=o?o:o;return{x1:e,y1:k,x2:b,y2:o,width:b-e,height:o-k}}return{center:function(e){return f.init(e.x1+e.width/2,e.y1+e.height/2)},copy:function(e){return a(e.x1,e.y1,e.x2,e.y2)},diagonalSize:function(e){return Math.sqrt(e.width*e.width+e.height*e.height)},fromCenter:function(e,k,b,o){b=~~(b/
2);o=~~(o/2);return a(e-b,k-o,e+b,k+o)},init:a}}(),d=function(){return{getAspectRatio:function(a){return a.height!==0?a.width/a.height:1},getCenter:function(a){return f.init(a.width/2,a.height/2)},getSize:function(a){return Math.sqrt(Math.pow(a.width,2)+Math.pow(a.height,2))},init:function(a,e){a=a?a:0;return{width:a,height:e?e:a}}}}();return{ex:COG.extend,ticks:function(){return(new Date).getTime()},XY:f,XYRect:h,Vector:function(a,e){COG.Log.warn("The T5.Vector class has been deprecated, please use T5.XY.init instead");
return f.init(a,e)},V:COG.extend(f,n),D:d}}();
(function(){function f(){for(;y.length>0;){var r=y.shift();document.location=r}v=0}function n(r){for(var u=true,A=w.length;A--;)u=u&&r!=w[A];return u}function h(r,u){var A=[];for(var z in u)z&&A.push(z+"="+escape(u[z]));return"tile5://"+r+"/"+(A.length>0?"?"+A.join("&"):"")}function d(r,u){n(r)&&COG.Log.info("would push url: "+h(r,u))}function a(r,u){if(n(r)){y.push(h(r,u));v||(v=setTimeout(f,100))}}function e(r){return function(u,A,z){(z?z:r?document.body:document).addEventListener(u,A,false)}}function k(r){return function(u,
A,z){(z?z:r?document.body:document).removeEventListener(u,A,false)}}function b(r,u,A){(A?A:document).attachEvent("on"+r,u)}function o(r,u,A){(A?A:document).detachEvent("on"+r,u)}function l(){m={base:{name:"Unknown",bindEvent:e(),unbindEvent:k(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:d,targetFps:null},ie:{name:"MSIE",regex:/msie/i,bindEvent:b,unbindEvent:o,requireFastDraw:false,targetFps:25},
ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:a,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:a},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:a},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:e(true),unbindEvent:k(true),supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},bridgeNotify:a},froyo:{name:"Android OS >= 2.2",
regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:a}};g=[m.froyo,m.android,m.ipod,m.iphone,m.ipad,m.ie]}var m=null,g=[],p=null,v=0,y=[],w=["view.wake","tile.loaded"];T5.getConfig=function(){m||l();if(!p){COG.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var r=0;r<g.length;r++){var u=g[r];if(u.regex&&u.regex.test(navigator.userAgent)){p=T5.ex({},m.base,u);COG.Log.info("PLATFORM DETECTED AS: "+p.name);break}}if(!p){COG.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
p=m.base}COG.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return p}})();
T5.Dispatcher=function(){var f=[],n={execute:function(h){var d=n.findAction(h);d&&d.execute.apply(d,Array.prototype.slice.call(arguments,1))},findAction:function(h){for(var d=f.length;d--;)if(f[d].id==h)return f[d];return null},getRegisteredActions:function(){return[].concat(f)},getRegisteredActionIds:function(){for(var h=[],d=f.length;d--;)f[d].id&&h.push(f[d].id);return h},registerAction:function(h){h&&h.id&&f.push(h)},Action:function(h){h=T5.ex({autoRegister:true,id:"",title:"",icon:"",hidden:false,
execute:null},h);var d={id:h.id,execute:function(){h.execute&&h.execute.apply(this,arguments)},getParam:function(a){return h[a]?h[a]:""},toString:function(){return COG.formatStr("{0} [title = {1}, icon = {2}]",d.id,h.title,h.icon)}};h.autoRegister&&n.registerAction(d);return d},Agent:function(h){h=COG.extend({name:"Untitled",translator:null,execute:null},h);var d={getName:function(){return h.name},getParam:function(a){return h[a]},getId:function(){return COG.toID(d.getName())},run:function(a,e){if(h.execute){var k=
h.translator?h.translator(a):a;h.execute.call(d,k,function(b,o){e&&e(b,o,k)})}}};return d},runAgents:function(h,d,a){for(var e=0;e<h.length;e++)h[e].run(d,a)}};return n}();
T5.Resources=function(){var f="",n={},h={getPath:function(d){return/^(file|https?|\/)/.test(d)?d:f+d},setBasePath:function(d){f=d},loadResource:function(d){d=T5.ex({filename:"",cacheable:true,dataType:null,callback:null},d);var a=function(e){d.callback&&COG.Log.watch("CALLING RESOURCE CALLBACK",function(){d.callback(e)})};d.cacheable&&n[d.filename]?a(n[d.filename]):COG.xhr({url:h.getPath(d.filename),dataType:d.dataType,success:function(e){if(d.cacheable)n[d.filename]=e;a(e)},error:function(e,k,b){COG.Log.error("error loading resource ["+
d.filename+"], error = "+b)}})},loadSnippet:function(d,a){/\.\w+$/.test(d)||(d+=".html");h.loadResource({filename:"snippets/"+d,callback:a,dataType:"html"})}};return h}();
T5.Images=function(){function f(){if(!v){var r=T5.getConfig().maxImageLoads;v=COG.Loopage.join({execute:function(u,A){if(!r||m.length<r){var z=l.shift();if(z){m[m.length]=z;z.image.onload=h;z.image.src=T5.Resources.getPath(z.url);z.requested=T5.ticks()}else A.trigger("complete")}},frequency:10});v.bind("complete",function(){v=null})}}function n(){y=true;try{var r=g.length/2>>0;if(r>0){g.sort(function(A,z){return A.created-z.created});for(var u=r;u--;)delete e[g[u].url];g.splice(0,r)}}finally{y=false}COG.say("imagecache.cleared")}
function h(){var r=b[this.id],u;if(r&&r.image.complete&&r.image.width>0){r.loaded=true;r.hitCount=1;for(u=m.length;u--;)if(m[u].image.src==this.src){m.splice(u,1);break}if(r.background||r.postProcess||r.drawBackground||r.customDraw)if(r.image){u=a(r.realSize?r.realSize.width:image.width,r.realSize?r.realSize.height:image.height);var A=u.getContext("2d"),z=r.offset?r.offset:T5.XY.init();r.background&&A.drawImage(r.background,0,0);r.drawBackground&&r.drawBackground(A);r.customDraw?r.customDraw(A,r):
A.drawImage(r.image,z.x,z.y);r.postProcess&&r.postProcess(A,r);r.image=u}for(u=r.callbacks.length;u--;)r.callbacks[u]&&r.callbacks[u](this,false);r.callbacks=[];g[g.length]={url:this.src,created:r.requested};delete b[this.id];f()}}function d(r,u,A){var z=e[r];if(z){z.hitCount++;z.image.complete&&z.image.width>0&&u?u(z.image,true):z.callbacks.push(u)}else{z=T5.ex({url:r,image:new Image,loaded:false,created:T5.ticks(),requested:null,hitCount:0,callbacks:[u]},A);z.image.id="resourceLoaderImage"+o++;
e[r]=z;b[z.image.id]=z;l[l.length]=z;f()}return z}function a(r,u){var A=document.createElement("canvas");A.width=r?r:0;A.height=u?u:0;if(typeof FlashCanvas!=="undefined"){A.id="tmpCanvas"+k++;A.style.cssText="position: absolute; top: -"+(u-1)+"px; left: -"+(r-1)+"px;";document.body.appendChild(A);FlashCanvas.initElement(A)}typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(A);return A}var e={},k=0,b={},o=0,l=[],m=[],g=[],p=0,v=null,y=false,w={avgImageSize:25,loadTimeout:10,cancelLoad:function(){m=
[]},get:function(r,u,A){var z=null,I=null;y||(z=e[r]);if((I=z?z.image:null)&&(I.getContext||I.complete&&I.width>0))return I;else u&&d(r,u,A);return null},load:d,newCanvas:a,reset:function(){e={}},stats:function(){return{imageLoadingCount:m.length,queuedImageCount:l.length,imageCacheFullness:p}}};COG.Loopage.join({execute:function(r){for(var u=false,A=0,z=T5.getConfig();A<m.length;)if(r-m[A].requested>w.loadTimeout*1E3){m.splice(A,1);u=true}else A++;u&&f();if(z&&z.imageCacheMaxSize){p=g.length*w.avgImageSize/
z.imageCacheMaxSize;p>=1&&n()}},frequency:2E4});return w}();T5.Generator=function(){var f={};return{init:function(n,h){var d=f[n];if(!d)throw Error("Unable to locate requested generator: "+n);return new d(h)},register:function(n,h){f[n]=h},Template:function(){}}}();
T5.TimeLord=function(){var f=/^P(\d+Y)?(\d+M)?(\d+D)?$/,n=/^(\d+H)?(\d+M)?(\d+S)?$/,h=function(a,e){return{days:a?a:0,seconds:e?e:0}},d={8601:function(a){a=a.split("T");var e=null;e=null;var k=0,b=0;f.lastIndex=-1;e=f.exec(a[0]);k+=e[3]?parseInt(e[3].slice(0,-1),10):0;n.lastIndex=-1;e=n.exec(a[1]);b+=e[1]?parseInt(e[1].slice(0,-1),10)*3600:0;b+=e[2]?parseInt(e[2].slice(0,-1),10)*60:0;b+=e[3]?parseInt(e[3].slice(0,-1),10):0;return new h(k,b)}};return{Duration:h,addDuration:function(){for(var a=new h,
e=arguments.length;e--;){a.days+=arguments[e].days;a.seconds+=arguments[e].seconds}if(a.seconds>=86400){a.days+=~~(a.seconds/86400);a.seconds%=86400}return a},parseDuration:function(a,e){var k=e?d[e]:null;if(k)return k(a);COG.Log.warn("Could not find duration parser for specified format: "+e);return new h},formatDuration:function(a){var e,k,b="";if(a.days)b=a.days+" days ";if(a.seconds){a=a.seconds;if(a>=3600){e=~~(a/3600);a-=e*3600}if(a>=60){k=Math.round(a/60);a-=k*60}if(e)b=b+e+(e>1?" hrs ":" hr ")+
(k?(k>10?k:"0"+k)+" min ":"");else if(k)b=b+k+" min";else if(a>0)b=b+(a>10?a:"0"+a)+" sec"}return b}}}();
(function(){var f=Math.PI*2,n=Math.PI/2,h=Math.abs,d=Math.pow,a=Math.sin,e=Math.asin,k=Math.cos,b=1.70158,o={linear:function(l,m,g,p){return g*l/p+m},backin:function(l,m,g,p){return g*(l/=p)*l*((b+1)*l-b)+m},backout:function(l,m,g,p){return g*((l=l/p-1)*l*((b+1)*l+b)+1)+m},backinout:function(l,m,g,p){return(l/=p/2)<1?g/2*l*l*(((b*=1.525)+1)*l-b)+m:g/2*((l-=2)*l*(((b*=1.525)+1)*l+b)+2)+m},bouncein:function(l,m,g,p){return g-o.bounceout(p-l,0,g,p)+m},bounceout:function(l,m,g,p){return(l/=p)<1/2.75?
g*7.5625*l*l+m:l<2/2.75?g*(7.5625*(l-=1.5/2.75)*l+0.75)+m:l<2.5/2.75?g*(7.5625*(l-=2.25/2.75)*l+0.9375)+m:g*(7.5625*(l-=2.625/2.75)*l+0.984375)+m},bounceinout:function(l,m,g,p){return l<p/2?o.bouncein(l*2,0,g,p)/2+m:o.bounceout(l*2-p,0,g,p)/2+g/2+m},cubicin:function(l,m,g,p){return g*(l/=p)*l*l+m},cubicout:function(l,m,g,p){return g*((l=l/p-1)*l*l+1)+m},cubicinout:function(l,m,g,p){if((l/=p/2)<1)return g/2*l*l*l+m;return g/2*((l-=2)*l*l+2)+m},elasticin:function(l,m,g,p,v,y){if(l==0)return m;if((l/=
p)==1)return m+g;y||(y=p*0.3);if(!v||v<h(g)){v=g;g=y/4}else g=y/f*e(g/v);return-(v*d(2,10*(l-=1))*a((l*p-g)*f/y))+m},elasticout:function(l,m,g,p,v,y){var w;if(l==0)return m;if((l/=p)==1)return m+g;y||(y=p*0.3);if(!v||v<h(g)){v=g;w=y/4}else w=y/f*e(g/v);return v*d(2,-10*l)*a((l*p-w)*f/y)+g+m},elasticinout:function(l,m,g,p,v,y){var w;if(l==0)return m;if((l/=p/2)==2)return m+g;y||(y=p*0.3*1.5);if(!v||v<h(g)){v=g;w=y/4}else w=y/f*e(g/v);if(l<1)return-0.5*v*d(2,10*(l-=1))*a((l*p-w)*f/y)+m;return v*d(2,
-10*(l-=1))*a((l*p-w)*f/y)*0.5+g+m},quadin:function(l,m,g,p){return g*(l/=p)*l+m},quadout:function(l,m,g,p){return-g*(l/=p)*(l-2)+m},quadinout:function(l,m,g,p){if((l/=p/2)<1)return g/2*l*l+m;return-g/2*(--l*(l-2)-1)+m},sinein:function(l,m,g,p){return-g*k(l/p*n)+g+m},sineout:function(l,m,g,p){return g*a(l/p*n)+m},sineinout:function(l,m,g,p){return-g/2*(k(Math.PI*l/p)-1)+m}};T5.easing=function(l){return o[l.replace(/[\-\_\s\.]/g,"").toLowerCase()]};T5.registerEasingType=function(l,m){o[l.replace(/[\-\_\s\.]/g,
"").toLowerCase()]=m}})();
T5.Tween=function(f){f=T5.ex({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:T5.easing("sine.out"),complete:null,cancelOnInteract:false},f);var n=T5.ticks(),h=[],d=false,a=0,e=0,k={cancelOnInteract:f.cancelOnInteract,isComplete:function(){return d},triggerComplete:function(b){f.complete&&f.complete(b)},update:function(b){try{var o=f.tweenFn(b-n,a,e,f.duration);if(f.target)f.target[f.property]=o;for(var l=h.length;l--;)h[l](o,void 0);if(d=n+f.duration<=b){if(f.target)f.target[f.property]=
f.tweenFn(f.duration,a,e,f.duration);for(var m=h.length;m--;)h[m](o,true)}}catch(g){COG.Log.exception(g)}},requestUpdates:function(b){h.push(b)}};a=f.target&&f.property&&f.target[f.property]?f.target[f.property]:f.startValue;if(typeof f.endValue!=="undefined")e=f.endValue-a;if(e==0)d=true;T5.wakeTweens();return k};
(function(){function f(a){if(d)return n.length;d=true;try{for(var e=0;e<n.length;)if(n[e].isComplete()){n[e].triggerComplete(false);n.splice(e,1)}else{n[e].update(a);e++}}finally{d=false}n.length===0&&h.trigger("complete");return n.length}var n=[],h=null,d=false;T5.tweenValue=function(a,e,k,b,o){a=new T5.Tween({startValue:a,endValue:e,tweenFn:k,complete:b,duration:o});n.push(a);return a};T5.tween=function(a,e,k,b,o,l){a=new T5.Tween({target:a,property:e,endValue:k,tweenFn:b,duration:l,complete:o});
n.push(a);return a};T5.tweenVector=function(a,e,k,b,o,l){var m=[];if(a){var g=a.x==e,p=a.y==k;g||m.push(T5.tween(a,"x",e,b,function(){(g=true)&&p&&o()},l));p||m.push(T5.tween(a,"y",k,b,function(){p=true;g&&p&&o()},l))}return m};T5.cancelAnimation=function(a){if(!d){d=true;try{for(var e=0;e<n.length;)if(!a||a(n[e])){n[e].triggerComplete(true);n.splice(e,1)}else e++}finally{d=false}}};T5.isTweening=function(){return n.length>0};T5.wakeTweens=function(){if(!h){h=COG.Loopage.join({execute:f,frequency:20});
h.bind("complete",function(){h=null})}}})();(function(){var f={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,PINCH:16,FREEZE:128};T5.viewState=function(){for(var n=0,h=arguments.length;h--;){var d=f[arguments[h].toUpperCase()];if(d)n|=d}return n}})();
T5.ViewLayer=function(f){f=T5.ex({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:T5.viewState("ACTIVE","ANIMATING","PAN","PINCH")},f);var n=null,h=false,d=false,a=f.supportFastDraw,e=f.id,k=T5.viewState("ACTIVE"),b=f.validStates,o=0,l=0,m=T5.ex({addToView:function(g){g.setLayer(e,m)},shouldDraw:function(g,p,v){g=(g&b)!==0&&(h?a:true);return g=d||v||o!==p.x||l!==p.y},cycle:function(){},draw:function(){},remove:function(){m.trigger("remove",m)},changed:function(){d=true;m.trigger("changed",
m);n&&n.trigger("invalidate")},getId:function(){return e},setId:function(g){e=g},getParent:function(){return n},setParent:function(g){h=(n=g)?n.fastDraw&&displayState!==k:false;m.trigger("parentChange",n)}},f);COG.observable(m);m.bind("drawComplete",function(g,p){d=false;o=p.x;l=p.y});return m};
T5.View=function(f){function n(B,E,M,Y){ma=ka;A();if(Y&&f.inertia){S=true;l(V+E,t+M,f.panAnimationEasing,f.panAnimationDuration)}else Y||l(V+E,t+M)}function h(){ma=ta;S=false;COG.Loopage.join({execute:A,after:50,single:true})}function d(B,E){ha=F(B);ca=F(E);var M=K(ha),Y=K(ca);na=R(ha);O=R(ca);U=ha&&M!==0?Y/M:1}function a(B,E,M){d(E,M);if($=U!==1){ma=oa;A()}}function e(B,E,M,Y){d(E,M);if(f.adjustScaleFactor){U=f.adjustScaleFactor(U);COG.Log.info("scale factor adjusted to: "+U)}if(Y<f.pinchZoomAnimateTrigger){p(fa,
U,na,v(),T5.easing("sine.out"),function(){b();U=1},300);U=fa}else{b();U=1}}function k(B,E,M){Q.zoom(E,Math.min(Math.pow(2,Math.round(Math.log(M))),8),500)}function b(){var B=ha?v():O;U=Math.round(U*10)/10;$=false;for(var E=z.length;E--;)z[E].trigger("scale",U,B);Q.trigger("scale",U,B);ma=ta;A()}function o(){clearTimeout(ea);ea=setTimeout(m,50)}function l(B,E,M,Y,Z){function ia(){la+=1;if(la>=2){h(0,0);Z&&Z()}}var la=0;if(M){B=T5.tweenValue(V,B,M,ia,Y);E=T5.tweenValue(t,E,M,ia,Y);B.cancelOnInteract=
true;B.requestUpdates(function(pa){V=pa;S=true;A()});E.cancelOnInteract=true;E.requestUpdates(function(pa){t=pa;S=true;A()})}else{V=B;t=E}}function m(){var B;if(H){COG.Touch.release(H);if(f.autoSize&&H.parentNode){B=H.parentNode.getBoundingClientRect();if(B.height!==0&&B.width!==0){H.height=B.height;H.width=B.width}}try{if(!H.id)H.id=f.id+"_canvas";W=H.getContext("2d");W.clearRect(0,0,H.width,H.height)}catch(E){COG.Log.exception(E);throw Error("Could not initialise canvas on specified view element");
}sa=COG.Touch.capture(H,{observable:Q});if(J.height!==H.height||J.width!==H.width){J=T5.D.init(H.width,H.height);Q.trigger("resize",H.width,H.height);for(B=I;B--;)z[B].trigger("resize",H.width,H.height)}f.inertia&&sa.inertiaEnable(f.panAnimationDuration,J);for(B=I;B--;)z[B].trigger("contextChanged",W);u()}}function g(B,E){E.setId(B);E.added=T5.ticks();E.bind("remove",function(){Q.removeLayer(B)});E.trigger("contextChanged",W);E.setParent(Q);z.push(E);z.sort(function(M,Y){var Z=Y.zindex-M.zindex;if(Z===
0)Z=Y.added-M.added;return Z});I=z.length;return E}function p(B,E,M,Y,Z,ia,la){function pa(){ia&&ia();b();U=1;ja=null}$=true;na=T5.XY.copy(M);O=T5.XY.copy(Y);ha=null;if(Z)T5.tweenValue(0,E-B,Z,pa,la?la:1E3).requestUpdates(function(ra){ja=ra/(E-B);U=B+ra;ma=oa;A();Q.trigger("animate")});else{U=targetScaleFactor;pa()}}function v(){var B=T5.D.getCenter(J),E=T5.XY.distance([O,B]);B=T5.XY.theta(O,B,E);var M=T5.XY.diff(na,O);B=T5.XY.extendBy(O,B,E/U);B.x+=M.x;B.y+=M.y;return B}function y(){Q.trigger("idle",
Q);L=true;P=0}function w(B,E,M,Y,Z){if(G)E=T5.viewState("FROZEN");var ia=(E&oa)!==0,la=0;if(x||ia){B.clearRect(0,0,H.width,H.height);x=false}if(ia){T5.D.getCenter(J);var pa=(ja?ja:1)/2,ra=T5.XY.diff(na,O);if(ha){T.x=O.x+ra.x;T.y=O.y+ra.y}else{T.x=O.x-ra.x*pa;T.y=O.y-ra.y*pa}}B.save();try{fa=U;B.translate(-M.x1,-M.y1);if(N!==1)B.scale(N,N);else if(ia){B.translate(O.x,O.y);B.scale(U,U)}for(la=I;la--;)if(z[la].shouldDraw(E,M,Y)){z[la].draw(B,M,E,Q,Y,Z);z[la].trigger("drawComplete",M,Z)}}finally{B.restore()}Q.trigger("drawComplete",
M,Z);COG.Log.trace("draw complete",Z)}function r(B,E){var M=false,Y=da?da:S?ka:ma,Z=!S&&(Y===oa||Y===ka),ia=ba||Y===ka||Y===oa||T5.isTweening();q=T5.XY.init(V>>0,t>>0);s=T5.XYRect.fromCenter(q.x,q.y,J.width,J.height);if(Z){T5.cancelAnimation(function(la){return la.cancelOnInteract});L=false;if(P!==0){clearTimeout(P);P=0}}for(Z=I;Z--;){if(z[Z].animated)ma|=qa;M=z[Z].cycle(B,s,ma,ia)||M}ia=ia||(ma&qa)!==0;if(M=M||ia||U!==1&&U!==ga){w(W,Y,s,ia,B);ga=U;ba=false}if(!M&&D===0&&!va){if(!L&&P===0)P=setTimeout(y,
500);E.trigger("complete")}D=0;COG.Log.trace("Completed draw cycle",B)}function u(){ba=true;A()}function A(){D+=1;if(!(G||C)){C=COG.Loopage.join({execute:r,frequency:ua});C.bind("complete",function(){C=null})}}f=T5.ex({id:COG.objId("view"),container:"",fastDraw:false,inertia:true,pannable:true,scalable:true,panAnimationEasing:T5.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:true,tapExtent:10,fps:25},f);var z=[],I=0,H=document.getElementById(f.container),
W=null,V=0,t=0,q=null,s=null,x=false,C=null,G=false,N=1,J=T5.D.init(),D=0,O=null,L=false,S=false,P=0,X=0,T=T5.XY.init(),aa=0,$=false,ha=null,ca=null,da=null,ba=false,ea=0,U=1,ga=0,fa=1,ja=null,na=null,va=typeof FlashCanvas!=="undefined",ua=~~(1E3/f.fps),sa=null,ta=T5.viewState("ACTIVE"),ka=T5.viewState("PAN"),oa=T5.viewState("PINCH"),qa=T5.viewState("ANIMATING"),ma=ta,F=T5.XY.getRect,K=T5.XYRect.diagonalSize,R=T5.XYRect.center,Q={id:f.id,deviceScaling:N,fastDraw:f.fastDraw||T5.getConfig().requireFastDraw,
animate:function(B,E,M,Y,Z){p(U,B,E,M,Y,Z)},centerOn:function(B){V=B.x-H.width/2;t=B.y-H.height/2},getDimensions:function(){return J},getZoomCenter:function(){return T},getLayer:function(B){for(var E=0;E<I;E++)if(z[E].getId()==B)return z[E];return null},setLayer:function(B,E){for(var M=0;M<I;M++)if(z[M].getId()===B){z.splice(M,1);break}E&&g(B,E);u()},eachLayer:function(B){for(var E=I;E--;)B(z[E])},clearBackground:function(){COG.Log.info("CALL OF DEPRECATED METHOD CLEAR BACKGROUND");x=true;u()},invalidate:u,
freeze:function(){G=true},unfreeze:function(){G=false;A()},resize:function(B,E){if(H){f.autoSize=false;H.width=B;H.height=E;m();Q.trigger("resize",H.width,H.height)}},scale:function(B,E,M,Y,Z){Y||(Y=T5.D.getCenter(J));Z||(Z=T5.D.getCenter(J));Q.animate(B,Y,Z,E,M);return Q},removeLayer:function(B){a:{for(var E=I;E--;)if(z[E].getId()==B){B=E;break a}B=-1}if(B>=0&&B<I){COG.say("layer.removed",{layer:z[B]});z.splice(B,1);u()}I=z.length},stateOverride:function(B){da=B},getOffset:function(){return q?q:
T5.XY.init(V,t)},getOffsetRect:function(){return s?s:T5.XYRect.fromCenter(V,t,J.width,J.height)},updateOffset:l,zoom:function(B,E,M){S=false;U=E;$=U!==1;na=T5.D.getCenter(J);O=U>1?T5.XY.copy(B):T5.D.getCenter(J);ha=null;clearTimeout(X);if($){ma=oa;A();if(M)X=setTimeout(function(){b();U=1},parseInt(M,10))}}};N=T5.getConfig().getScaling();Q.markers=g("markers",new T5.MarkerLayer);COG.observable(Q);Q.bind("wake",A);Q.bind("invalidate",u);if(f.pannable){Q.bind("pan",n);Q.bind("panEnd",h);Q.bind("inertiaCancel",
function(){S=false;A()})}if(f.scalable){Q.bind("pinchZoom",a);Q.bind("pinchZoomEnd",e);Q.bind("wheelZoom",k)}Q.bind("tap",function(B,E,M){for(var Y=T5.XY.offset(M,V,t),Z=z.length;Z--;)B.cancel=B.cancel||z[Z].trigger("tap",E,M,Y).cancel});COG.configurable(Q,["inertia","container","rotation","tapExtent","scalable","pannable"],COG.paramTweaker(f,null,{container:function(B,E){H=document.getElementById(E);m()},rotation:function(B,E){aa=E}}),true);m();f.autoSize&&window.addEventListener("resize",o,false);
return Q};
T5.PathLayer=function(f){function n(m){m.syncVectors(e);k&&m.syncVectors(k);l.trigger("tidy")}f=T5.ex({style:"waypoints",pixelGeneralization:8,zindex:50},f);var h=false,d=[],a=null,e=[],k=null,b=0,o=[],l=T5.ex(new T5.ViewLayer(f),{getAnimation:function(m,g,p,v){var y="pathAnimation"+b++;o.push(y);return new T5.AnimatedPathLayer({id:y,path:d,zindex:f.zindex+1,easing:m?m:T5.easing("sine.inout"),duration:g?g:5E3,drawIndicator:p,autoCenter:v?v:false})},cycle:function(m,g,p,v){return v},draw:function(m,g){var p,
v=d.length;m.save();try{T5.applyStyle(m,f.style);if(v>0){m.beginPath();m.moveTo(d[v-1].x-g.x,d[v-1].y-g.y);for(p=v;p--;)m.lineTo(d[p].x-g.x,d[p].y-g.y);m.stroke();if(a){m.fillStyle=f.waypointFillStyle;for(p=a.length;p--;){m.beginPath();m.arc(a[p].x-g.x,a[p].y-g.y,2,0,Math.PI*2,false);m.stroke();m.fill()}}}}finally{m.restore()}h=false},updateCoordinates:function(m,g){var p=l.getParent();p=p?p.getTileLayer():null;e=m;k=g;COG.Log.info("updating coordinates, grid = "+p);p&&n(p)}});l.bind("gridUpdate",
function(m,g){n(g);for(var p=o.length;p--;)COG.say("layer.remove",{id:o[p]});o=[]});l.bind("tidy",function(){d=T5.XY.simplify(e,f.pixelGeneralization);a=T5.XY.simplify(k,f.pixelGeneralization);h=true;l.changed()});return l};
T5.ShapeLayer=function(f){function n(e){for(var k=h.length;k--;)h[k].resync(e);h.sort(function(b,o){var l=o.xy.y-b.xy.y;if(l===0)l=o.xy.x-b.xy.y;return l});d=true;a.changed()}f=T5.ex({zindex:80,style:null},f);var h=[],d=false,a=T5.ex(new T5.ViewLayer(f),{add:function(e){h[h.length]=e},each:function(e){for(var k=h.length;k--;)e(h[k])},cycle:function(){return d},draw:function(e,k,b){var o=k.x1,l=k.y1,m=k.width;k=k.height;e.save();try{T5.applyStyle(e,f.style);for(var g=h.length;g--;){var p=h[g].style,
v=p?T5.applyStyle(e,p):null;h[g].draw(e,o,l,m,k,b);v&&T5.applyStyle(e,v)}}finally{e.restore()}d=false}});a.bind("parentChange",function(e,k){k.syncVectors&&n(k)});COG.configurable(a,["style"],COG.paramTweaker(f,null,null),true);return a};T5.PolyLayer=T5.ShapeLayer;T5.Shape=function(f){f=T5.ex({style:null,properties:{}},f);return T5.ex(f,{rect:null,draw:function(){},resync:function(){}})};
T5.Arc=function(f,n){n=T5.ex({size:4},n);var h=T5.XY.init(),d=T5.ex(n,{draw:function(a){a.beginPath();a.arc(h.x,h.y,d.size,0,Math.PI*2,false);a.fill();a.stroke()},resync:function(a){a.syncVectors([f]);h=T5.XY.floor([f])[0]}});COG.Log.info("created arc = ",f);return d};
T5.Poly=function(f,n){n=T5.ex({fill:false,simplify:false},n);var h=false,d=n.fill,a=n.simplify,e=T5.viewState("PINCH"),k=[],b=T5.ex(new T5.Shape(n),{draw:function(o,l,m,g,p,v){if(h){l=true;m=(v&e)!==0;o.beginPath();for(v=k.length;v--;){m=k[v].x;g=k[v].y;if(l){o.moveTo(m,g);l=false}else o.lineTo(m,g);m=true}if(m){d&&o.fill();o.stroke()}}},resync:function(o){b.xy=o.syncVectors(f);k=T5.XY.floor(a?T5.XY.simplify(f):f)}});h=f&&f.length>=2;return b};
T5.AnimatedPathLayer=function(f){function n(b,o,l){b.fillStyle="#FFFFFF";b.strokeStyle="#222222";b.beginPath();b.arc(l.x,l.y,4,0,Math.PI*2,false);b.stroke();b.fill()}f=T5.ex({path:[],id:COG.objId("pathAni"),easing:T5.easing("sine.inout"),validStates:T5.viewState("ACTIVE","PAN","PINCH"),drawIndicator:null,duration:2E3,autoCenter:false},f);var h=T5.XY.edges(f.path),d,a=null,e=0;T5.tweenValue(0,h.total,f.easing,function(){k.remove()},f.duration).requestUpdates(function(b,o){e=b;o&&k.remove()});var k=
T5.ex(new T5.ViewLayer(f),{cycle:function(){for(var b=0;b<h.accrued.length&&h.accrued[b]<e;)b++;a=null;if(b<f.path.length-1){var o=e-(b>0?h.accrued[b-1]:0),l=f.path[b];d=T5.XY.theta(l,f.path[b+1],h.edges[b]);a=T5.XY.extendBy(l,d,o);if(f.autoCenter)(b=k.getParent())&&b.centerOn(a)}return a},draw:function(b,o){if(a)(f.drawIndicator?f.drawIndicator:n)(b,o,T5.XY.init(a.x-o.x,a.y-o.y),d)}});return k};
T5.Marker=function(f){function n(o,l,m,g){d=o;a=l;e=m;k=g}f=T5.ex({xy:T5.XY.init(),offset:true,tweenIn:null,animationSpeed:null},f);var h=false,d=0,a=0,e=0,k=0,b=T5.ex(f,{isNew:true,isAnimating:function(){return h},draw:function(o,l,m,g,p){if(b.isNew&&f.tweenIn){var v=b.xy.y;b.xy.y=l.y-20;h=true;T5.tween(b.xy,"y",v,f.tweenIn,function(){b.xy.y=v;h=false},f.animationSpeed?f.animationSpeed:250+Math.random()*500)}b.drawMarker(o,l,b.xy.x,b.xy.y,m,g,p);b.isNew=false},drawMarker:function(o,l,m,g){o.beginPath();
o.arc(m,g,4,0,Math.PI*2,false);o.fill();n(m-4,g-4,8,8)},hitTest:function(o,l){return o>=d&&o<=d+e&&l>=a&&l<=a+k},updateBounds:n});COG.observable(b);return b};
T5.ImageMarker=function(f){f=T5.ex({image:null,imageUrl:null,animatingImage:null,animatingImageUrl:null,imageAnchor:null,rotation:0,scale:1,opacity:1},f);var n=f.imageAnchor?T5.XY.invert(f.imageAnchor):null,h=T5.ex(new T5.Marker(f),{drawMarker:function(d,a,e,k){if((a=h.isAnimating()&&h.animatingImage?h.animatingImage:h.image)&&a.complete&&a.width>0){n||(n=T5.XY.init(-a.width>>1,-a.height>>1));var b=h.scale,o=e+~~(n.x*b),l=k+~~(n.y*b),m=~~(a.width*b),g=~~(a.height*b);h.updateBounds(o,l,m,m);if(h.rotation||
h.opacity!==1){d.save();try{d.globalAlpha=h.opacity;d.translate(e,k);d.rotate(h.rotation);d.drawImage(a,n.x*b,n.y*b,m,g)}finally{d.restore()}}else d.drawImage(a,o,l,m,g)}}});if(!h.image)h.image=T5.Images.get(f.imageUrl,function(d){COG.Log.info("updating marker image to: "+d.src);h.image=d});if(!h.animatingImage)h.animatingImage=T5.Images.get(f.animatingImageUrl,function(d){h.animatingImage=d});return h};T5.Annotation=T5.Marker;T5.ImageAnnotation=T5.ImageMarker;
T5.MarkerLayer=function(f){function n(){e.changed();e.trigger("markerUpdate",d)}function h(){var k=e.getParent();if(k&&k.syncVectors)for(var b=d.length;b--;)k.syncVectors([d[b].xy])}f=T5.ex({zindex:100},f);var d=[],a=false,e=T5.ex(new T5.ViewLayer(f),{cycle:function(){return a},draw:function(k,b,o,l){a=false;for(var m=d.length;m--;){d[m].draw(k,b,o,e,l);a=a||d[m].isAnimating()}return a?1:0},add:function(k){if(k&&typeof k.length!=="undefined")for(var b=k.length;b--;){if(k[b])d[d.length]=k[b]}else if(k)d[d.length]=
k;n()},clear:function(k){if(k)for(var b=0;b<d.length;b++)k(d[b])&&d.splice(b,1);else d=[];n()},find:function(k){for(var b=[],o=d.length;o--;)if(!k||k(d[o]))b[b.length]=d[o];return b}});e.bind("tap",function(k,b,o){for(var l=[],m=o.x,g=o.y,p=d.length;p--;)if(d[p].hitTest(m,g))l[l.length]=d[p];if(l.length>0)k.cancel=e.trigger("markerTap",b,o,l).cancel});e.bind("gridUpdate",function(k,b){for(var o=d.length;o--;)b.syncVectors([d[o].xy])});e.bind("parentChange",h);e.bind("changed",h);return e};
T5.ImageLayer=function(f,n){function h(m){e.run(m,function(g){k=g;(g=l.getParent())&&g.trigger("invalidate")});o=T5.XYRect.copy(m)}function d(){var m=l.getParent();m&&m.trigger("invalidate")}function a(){h(b)}n=T5.ex({},n);var e=T5.Generator.init(f,n),k=null,b=T5.XYRect.init(),o=T5.XYRect.init(),l=T5.ex(new T5.ViewLayer(n),{cycle:function(m,g){(Math.abs(g.x1-o.x1)>g.width||Math.abs(g.y1-o.y1)>g.height)&&h(g)},draw:function(m,g){m.save();try{m.strokeStyle="#555";if(k)for(var p=k.length;p--;){var v=
m,y=k[p],w=T5.Images.get(y.url,d);if(w)v.drawImage(w,y.x,y.y,w.width,w.height);else{v.fillStyle="#777";v.fillRect(y.x,y.y,y.width,y.height)}}}finally{m.restore()}m.strokeStyle="#f00";m.beginPath();m.moveTo(g.x1+g.width/2,g.y1);m.lineTo(g.x1+g.width/2,g.y2);m.moveTo(g.x1,g.y1+g.height/2);m.lineTo(g.x2,g.y1+g.height/2);m.stroke();b=T5.XYRect.copy(g)}});l.bind("parentChange",function(m,g){e.bindToView(g);g.bind("idle",a)});return l};
T5.Style=function(f){function n(e){var k=f[e];typeof k!=="undefined"&&h.push(function(b){b[e]=k})}f=T5.ex({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},f);var h=[],d={applyToContext:function(e){for(var k=h.length;k--;)h[k](e)}};for(var a in f)n(a);return d};
(function(){var f={},n={basic:new T5.Style({lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"}),waypoints:new T5.Style({lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"})};T5.applyStyle=function(h,d){var a=T5.styles[d]?T5.styles[d]:T5.styles.basic,e;if(h&&h.canvas){e=f[h.canvas.id];f[h.canvas.id]=d}a.applyToContext(h);return e};T5.loadStyles=function(h){COG.jsonp(h,function(d){T5.resetStyles(d)})};T5.resetStyles=function(h){var d={};for(var a in h)d[a]=new T5.Style(h[a]);T5.styles=T5.ex({},
n,d)};T5.styles=n})();(function(){T5.tileSize=256;T5.Tile=function(f){return f=T5.ex({x:0,y:0,gridX:0,gridY:0,dirty:true},f)};T5.EmptyTile=function(f){f=new T5.Tile(f);f.empty=true;return f};T5.ImageTile=function(f){f=T5.ex({url:"",sessionParamRegex:null,loading:false,loaded:false},f);return new T5.Tile(f)}})();
T5.TileGrid=function(f){function n(D,O){var L=T5.Vector(D*o-v.x,O*o-v.y);return new T5.EmptyTile({gridX:L.x,gridY:L.y,empty:true})}function h(D,O,L,S){var P=Math.max(k,b)*0.2>>0,X=T5.XY.init();if(D<0||D+L>k)X.x=D<0?-P:P;if(O<0||O+S>b)X.y=O<0?-P:P;return X}function d(D,O,L){var S=COG.Log.getTraceTicks(),P=0;T5.XY.init(k/2,b/2);W=true;try{if(L)e=[];if(D)for(L=0;L<b;L++)for(var X=0;X<k;X++){if(!e[P]){var T=D(X,L,g,k,b);T.gridX=X*o-v.x;T.gridY=L*o-v.y;e[P]=T}P++}}finally{W=false}p=D;y=O;COG.Log.trace("tile grid populated",
S);J.changed()}function a(D,O,L,S){var P,X=[],T=false;D=T5.XY.init((D.x+v.x-o*w)*A>>0,(D.y+v.y-o*w)*A>>0);tilesNeeded=false;if(!x){P=J.getParent().getDimensions();q=Math.ceil(P.width*A)+1+w;s=Math.ceil(P.height*A)+1+w;x=T5.XY.init((q-1)/2>>0,(s-1)/2>>0)}for(var aa=s;aa--;)for(var $=q;$--;){P=$+D.x>=0&&$+D.x<k?e[(aa+D.y)*k+($+D.x)]:null;var ha=T5.XY.init($-x.x,aa-x.y);if(!P){t=h(D.x,D.y,q,s);P=n($+D.x,aa+D.y)}T=P?(P.dirty=L||P.dirty)||T:T;X[X.length]={tile:P,centerness:T5.XY.absSize(ha)}}X.sort(function(ca,
da){return da.centerness-ca.centerness});I||(I=Array(X.length));for(L=X.length;L--;){I[L]=X[L].tile;J.prepTile(I[L],O)}V=S;return T}f=T5.ex({tileSize:T5.tileSize,bufferSize:1,center:T5.XY.init(),clearBackground:false,gridSize:25,shiftOrigin:null,supportFastDraw:true,allowShift:true},f);var e=Array(Math.pow(f.gridSize,2)),k=f.gridSize,b=f.gridSize,o=f.tileSize,l=b*o,m=k*o,g=T5.XY.offset(f.center,-Math.ceil(k>>1)),p=null,v=T5.XY.init(),y=null,w=f.bufferSize,r=Math.round(o/2),u=false,A=o?1/o:0,z=true,
I=null,H=false,W=false,V=0;T5.XY.init();var t=T5.XY.init();T5.getConfig();var q,s,x,C=f.clearBackground;T5.viewState("ANIMATING");var G=T5.viewState("PAN"),N=T5.viewState("PINCH"),J=T5.ex(new T5.ViewLayer(f),{gridDimensions:T5.D.init(m,l),cycle:function(D,O,L,S){if(t.x!==0||t.y!==0){S=t;var P=f.shiftOrigin;if(!(!f.allowShift||S.x===0&&S.y===0)){var X=COG.Log.getTraceTicks(),T=Array(e.length);T.length=e.length;for(var aa=0;aa<k;aa++)for(var $=0;$<b;$++)T[$*k+aa]=aa+S.x>=0&&aa+S.x<k?e[($+S.y)*k+(aa+
S.x)]:null;e=T;g=P?P(g,S):T5.XY.add(g,S);v.x+=-S.x*o;v.y+=-S.y*o;COG.Log.trace("tile storage shifted",X);d(p,y)}t=T5.XY.init();S=true}if(!u&&(L&N)===0)u=a(O,L,S,D);return u},find:function(D){if(!D)return null;for(var O=e.length;O--;){var L=e[O];if(L&&D(L))return L}return null},prepTile:function(){},drawTile:function(){return false},getTileSize:function(){return o},draw:function(D,O,L,S,P,X,T){var aa=O.x;O=O.y;var $=L.width,ha=L.height,ca=$,da=ha,ba,ea=true;if(I){C&&D.clearRect(0,0,$,ha);D.beginPath();
if(z)for(var U=I.length;U--;){ba=I[U];var ga=ba.gridX-aa,fa=ba.gridY-O;if((ga>=0||ga+o<=$)&&(fa>=0||fa+o<=ha)){ba.x=ga;ba.y=fa;if(ba.empty){if(!C){D.clearRect(ga,fa,o,o);D.rect(ga,fa,o,o);ea=false}}else if(X||ba.dirty){(ba=J.drawTile(D,ba,ga,fa,S,X,T,C))&&D.rect(ga,fa,o,o);ea=ea&&ba}ca=ga<ca?ga:ca;da=fa<da?fa:da}}if(!C&&(S&G)!==0){if(ca>0){D.clearRect(0,0,ca,L.height);D.rect(0,0,ca,L.height)}if(da>0){D.clearRect(0,0,L.width,da);D.rect(0,0,L.width,da)}}C||D.clip();ea&&!H&&P.trigger("tileDrawComplete");
u=false;H=ea}},getTileAtXY:function(D,O){for(var L=null,S=I?I.length:0;S--;){var P=I[S];if(P&&D>=P.x&&O>=P.y)if(D<=P.x+o&&O<=P.y+o){L=P;break}}COG.Log.info("looking for tile @ x: "+D+", y: "+O+", found: "+L);return L},getTileVirtualXY:function(D,O,L){D=T5.XY.add(T5.XY.init(D,O),T5.XY.invert(g),v);D=T5.XY.init(D.x*o,D.y*o);if(L){D.x+=r;D.y+=r}return D},populate:function(D){d(D,null,true)},syncVectors:function(){return T5.XY.init(0,0)}});J.bind("resize",function(){COG.Log.info("captured resize");x=
null});J.bind("scale",function(){z=false});COG.listen("imagecache.cleared",function(){for(var D=e.length;D--;)if(e[D])e[D].loaded=false});COG.listen("tiler.repaint",function(){for(var D=e.length;D--;)if(e[D]){e[D].x=null;e[D].y=null}});return J};
T5.ImageTileGrid=function(f){function n(p){function v(){var y=T5.Images.newCanvas(32,32),w=y.getContext("2d");w.fillStyle="#BBBBBB";w.fillRect(0,0,32,32);w.fillStyle="#C3C3C3";w.fillRect(0,0,16,16);w.fillRect(16,16,16,16);return y}if(!d||p!==d.width){d=T5.Images.newCanvas(p,p);p=d.getContext("2d");p.fillStyle=typeof FlashCanvas!=="undefined"?"#666666":p.createPattern(v(),"repeat");p.fillRect(0,0,d.width,d.height)}return d}f=T5.ex({emptyTile:function(p){if(!h||p!==h.width){h=T5.Images.newCanvas(p,
p);p=h.getContext("2d");p.fillStyle="rgba(150, 150, 150, 0.1)";p.fillRect(0,0,h.width,h.height)}return h}(T5.tileSize),panningTile:null,tileOffset:T5.XY.init(),tileDrawArgs:{}},f);var h=f.emptyTile,d=f.panningTile?f.panningTile:n(T5.tileSize),a=T5.viewState("ACTIVE"),e=T5.viewState("PAN"),k=T5.getConfig().requireFastDraw,b=f.tileSize?f.tileSize:T5.tileSize,o=T5.Images.get,l=T5.Images.load,m=T5.ex({background:null,overlay:null,offset:T5.XY.init(),realSize:T5.D.init(b)},f.tileDrawArgs),g=T5.ex(new T5.TileGrid(f),
{drawTile:function(p,v,y,w,r,u,A,z){u=v.url?o(v.url):null;A=false;if(u){p.drawImage(u,y,w);v.dirty=false;A=true}else if((r&e)!==0){z||p.drawImage(d,y,w);A=true}return A},initTileUrl:function(){},prepTile:function(p,v){if(p&&!p.loading&&(!k||v===a)){p.url||g.initTileUrl(p);if(!o(p.url)){p.loading=true;l(p.url,function(){p.loadTime=(new Date).getTime();p.loaded=true;p.dirty=true;g.changed()},m)}}}});return g};
T5.Tiler=function(f){f=T5.ex({container:"",drawCenter:false,datasources:{},tileLoadThreshold:"first"},f);var n=T5.ex(new T5.View(f),{getTileLayer:function(){return n.getLayer("grid0")},setTileLayer:function(h){n.setLayer("grid0",h);n.trigger("gridUpdate",h);n.eachLayer(function(d){d.trigger("gridUpdate",h)})},viewPixToGridPix:function(h){var d=n.getOffset();return T5.XY.init(h.x+d.x,h.y+d.y)},centerOn:function(h,d,a,e){var k=n.getTileLayer(),b=n.getDimensions();(k=k?k.getTileSize():0)&&n.updateOffset(h.gridX-
(b.width-k)*0.5>>0,h.gridY-(b.height-k)*0.5>>0,d,a,e)},cleanup:function(){n.removeLayer("grid0")},repaint:function(){COG.say("tiler.repaint");n.trigger("wake")},select:function(h){n.trigger("selectTile",h)}});n.bind("tap",function(h,d,a){if(h=n.getTileLayer())(a=h.getTileAtXY(a.x,a.y))&&n.trigger("selectTile",a)});return n};T5.TileGenerator=function(){};
T5.Geo=function(){function f(t,q){var s=null;for(var x in W)if(q){if(x==q&&W[x][t]){s=W[x];break}}else if(W[x][t]){s=W[x];break}return s}function n(t,q){var s=g*Math.sin(t);return a-2*Math.atan(q*Math.pow((1-s)/(1+s),g/2))}function h(t,q,s,x){var C=0;t=t.toUpperCase();for(var G in x){var N=q[G];if(N){var J=s[G];N=J?J(t,N):COG.wordExists(t,N)?1:0;C+=N*x[G]}}return C}var d=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],a=Math.PI/2,e=Math.PI*2,k=-a,b=a,o=
-e,l=Math.PI/180,m=180/Math.PI,g=0.08181919084262157,p=null,v={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",HWY:"HIGHWAY",MWY:"MOTORWAY"},y={VECTORIZE_PER_CYCLE:500},w={getEngine:function(t){for(var q=null,s=1;!q&&s<arguments.length;s++)q=f(t,arguments[s]);q=q?q:f(t);if(!q)throw Error("Unable to find GEO engine with "+t+" capability");return q},rankGeocodeResponses:function(t,q,s){var x=[],C=V.AddressCompareFns;if(s&&s.compareFns)C=T5.ex({},C,s.compareFns);for(s=0;s<q.length;s++)x.push(new V.GeoSearchResult({caption:H.toString(q[s]),
data:q[s],pos:q[s].pos,matchWeight:h(t,q[s],C,V.GeocodeFieldWeights)}));x.sort(function(G,N){return N.matchWeight-G.matchWeight});return x},distanceToString:function(t){if(t>1E3)return~~(t/10)/100+" km";return t?t+" m":""},dist2rad:function(t){return t/6371},lat2pix:function(t){t=parseFloat(t)*l;t=Math.sin(t);var q=g*t;return Math.log((1+t)/(1-t)*Math.pow((1-q)/(1+q),g))/2},lon2pix:function(t){return parseFloat(t)*l},pix2lon:function(t){return V.normalizeLon(t)*m},pix2lat:function(t){t=Math.pow(Math.E,
-t);for(var q=a-2*Math.atan(t),s=n(q,t),x=0;x<12&&Math.abs(q-s)>1.0E-7;){q=s;s=n(q,t);x++}return s*m},normalizeLon:function(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t},radsPerPixel:function(t){return 2*Math.PI/(256<<t)}},r=function(t,q){return{lat:parseFloat(t?t:0),lon:parseFloat(q?q:0)}},u=function(t,q){return{min:z.parse(t),max:z.parse(q)}},A=function(t){return t=T5.ex({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},t)},z=function(){var t={calcDistance:function(q,
s){if(t.empty(q)||t.empty(s))return 0;var x=(s.lat-q.lat)*l/2,C=(s.lon-q.lon)*l/2;x=Math.sin(x)*Math.sin(x)+Math.cos(q.lat*l)*Math.cos(s.lat*l)*Math.sin(C)*Math.sin(C);return 6371*2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x))},copy:function(q){return q?new r(q.lat,q.lon):null},empty:function(q){return!q||q.lat===0&&q.lon===0},equal:function(q,s){return q&&s&&q.lat==s.lat&&q.lon==s.lon},inArray:function(q,s){for(var x=z.equal,C=s.length;C--;)if(x(q,s[C]))return true;return false},inBounds:function(q,s){var x=
!(z.empty(q)||z.empty(s));return x=(x=x&&q.lat>=s.min.lat&&q.lat<=s.max.lat)&&q.lon>=s.min.lon&&q.lon<=s.max.lon},offset:function(q,s,x){var C=q.lat*l;s=C+s/6371;for(q=q.lon*l+Math.asin(Math.sin(x/6371)/Math.cos(C));s<k;)s+=Math.PI;for(;s>b;)s-=Math.PI;for(;q>e;)q-=2*Math.PI;return new r(s*m,q*m)},parse:function(q){if(q)if(typeof q.lat!=="undefined")return t.copy(q);else{if(q.split)for(var s=[" ",","],x=0;x<s.length;x++){var C=q.split(s[x]);if(C.length===2)return new r(C[0],C[1])}}else return new r;
return null},parseArray:function(q){var s=q.length,x=Array(s);for(s=s;s--;)x[s]=t.parse(q[s]);return x},fromMercatorPixels:function(q,s){return new r(T5.Geo.pix2lat(s),T5.Geo.normalizeLon(T5.Geo.pix2lon(q)))},toMercatorPixels:function(q){return T5.XY.init(T5.Geo.lon2pix(q.lon),T5.Geo.lat2pix(q.lat))},generalize:function(q,s,x){var C=q.length,G=[],N=null;x||(x=250);x/=1E3;COG.Log.info("generalizing positions, must include "+s.length+" positions");for(var J=C;J--;)if(J===0)G.unshift(q[J]);else{var D=
!N||z.inArray(q[J],s)?x:z.calcDistance(N,q[J]);if(q[J]&&D>=x){G.unshift(q[J]);N=q[J]}}COG.Log.info("generalized "+C+" positions into "+G.length+" positions");return G},vectorize:function(q,s){var x=q.length,C=Array(x);s=T5.ex({chunkSize:y.VECTORIZE_PER_CYCLE,async:true},s);if(!s.async){for(var G=x;G--;)C[G]=new T5.Geo.GeoVector(q[G]);return C}return COG.Loopage.join({frequency:10,execute:function(N,J){for(var D=0,O=s.chunkSize,L=x;L--;){C[L]=new T5.Geo.GeoVector(q[L]);D+=1;if(D>O)break}x=L;x<=0&&
J.trigger("complete",C)}})},toString:function(q){return q?q.lat+" "+q.lon:""}};return t}(),I=function(){var t={calcSize:function(q,s,x){var C=T5.XY.init(0,s.lat-q.lat);if(typeof x==="undefined")x=true;C.x=x&&q.lon>s.lon?360-q.lon+s.lon:s.lon-q.lon;return C},createBoundsFromCenter:function(q,s){var x=s/6371,C=q.lat*l,G=q.lon*l,N=C-x,J=C+x;if(N>k&&J<b){C=Math.asin(Math.sin(x)/Math.cos(C));x=G-C;if(x<o)x+=2*Math.PI;G=G+C;if(G>e)G-=2*Math.PI}else{N=Math.max(N,k);J=Math.min(J,b);x=o;G=e}return new u(new r(N*
m,x*m),new r(J*m,G*m))},expand:function(q,s){return new u(new r(q.min.lat-s,q.min.lon-V.normalizeLon(s)),new r(q.max.lat+s,q.max.lon+V.normalizeLon(s)))},forPositions:function(q,s){var x=null,C=T5.ticks();s||(s="auto");for(var G=q.length;G--;)if(x){var N=t.calcSize(x.min,q[G],false),J=t.calcSize(q[G],x.max,false);if(N.x<0)x.min.lon=q[G].lon;if(N.y<0)x.min.lat=q[G].lat;if(J.x<0)x.max.lon=q[G].lon;if(J.y<0)x.max.lat=q[G].lat}else x=new T5.Geo.BoundingBox(q[G],q[G]);if(s){if(s=="auto"){G=t.calcSize(x.min,
x.max);s=Math.max(G.x,G.y)*0.3}x=t.expand(x,s)}COG.Log.trace("calculated bounds for "+q.length+" positions",C);return x},getCenter:function(q){var s=I.calcSize(q.min,q.max);return new T5.Geo.Position(q.min.lat+s.y/2,q.min.lon+s.x/2)},getGeoHash:function(q){var s=T5.Geo.GeoHash.encode(q.min.lat,q.min.lon);q=T5.Geo.GeoHash.encode(q.max.lat,q.max.lon);COG.Log.info("min hash = "+s+", max hash = "+q)},getZoomLevel:function(q,s){var x=t.getCenter(q),C=d[Math.min(Math.round(Math.abs(x.lat)*0.05),d.length)],
G=t.calcSize(q.min,q.max);x=Math.ceil(Math.log(d[3]*s.height/G.y)/Math.log(2));C=Math.ceil(Math.log(C*s.width/G.x)/Math.log(2));return Math.min(isNaN(x)?1E3:x,isNaN(C)?1E3:C)},isEmpty:function(q){return!q||z.empty(q.min)||z.empty(q.max)},toString:function(q){return"min: "+z.toString(q.min)+", max: "+z.toString(q.max)}};return t}(),H=function(){var t=/^(\d+).*$/,q=/(\d+)\s?\-\s?(\d+)/;return{buildingMatch:function(s,x){t.lastIndex=-1;if(t.test(s))for(var C=s.replace(t,"$1"),G=x.split(","),N=0;N<G.length;N++){q.lastIndex=
-1;if(q.test(G[N])){var J=q.exec(G[N]);if(C>=parseInt(J[1],10)&&C<=parseInt(J[2],10))return true}else if(C==G[N])return true}return false},normalize:function(s){if(!s)return"";s=s.toUpperCase();if(!p){var x=[];for(var C in v)x.push(C);p=RegExp("(\\s)("+x.join("|")+")(\\s|$)","i")}p.lastIndex=-1;if(x=p.exec(s))s=s.replace(p,"$1"+v[x[2]]);return s},toString:function(s){return s.streetDetails+" "+s.location}}}(),W={},V={P:z,B:I,A:H,Radius:function(t,q){return{distance:parseInt(t,10),uom:q}},Position:r,
BoundingBox:u,GeoXY:function(t,q){function s(C){x.pos=C;x.mercXY=z.toMercatorPixels(C)}var x=T5.XY.init();T5.ex(x,{radsPerPixel:null,setRadsPerPixel:function(C){var G=x.mercXY;x.x=G.x/C>>0;x.y=(Math.PI-G.y)/C>>0;x.radsPerPixel=C},updatePos:s});s(t);q&&x.setRadsPerPixel(q);return x},Address:A,GeocodeFieldWeights:{streetDetails:50,location:50},AddressCompareFns:{},Engine:function(t){if(!t.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var q=T5.ex({remove:function(){delete W[q.id]}},
t);return W[q.id]=q},GeoSearchResult:function(t){t=T5.ex({id:null,caption:"",resultType:"",data:null,pos:null,matchWeight:0},t);return T5.ex(t,{toString:function(){return t.caption+(t.matchWeight?" ("+t.matchWeight+")":"")}})},GeoSearchAgent:function(t){return new T5.Dispatcher.Agent(t)},GeocodingAgent:function(t){t=T5.ex({name:"Geocoding Search Agent",paramTranslator:null,execute:function(q,s){try{if(!q.reverse&&!q.freeform)address=new A(q);var x=V.getEngine("geocode");if(x)x.geocode({addresses:[q.freeform?
q.freeform:address],complete:function(G,N){if(s){var J=N;if(q.freeform)J=V.rankGeocodeResponses(q.freeform,J,V.getEngine("geocode"));s(J,t)}}})}catch(C){COG.Log.exception(C)}}},t);return new V.GeoSearchAgent(t)}};return T5.ex(V,y,w)}();T5.Geo.GeoVector=T5.Geo.GeoXY;
T5.Geo.GeoHash=function(){function f(n,h,d){if(h&d)n[0]=(n[0]+n[1])/2;else n[1]=(n[0]+n[1])/2}BITS=[16,8,4,2,1];BASE32="0123456789bcdefghjkmnpqrstuvwxyz";NEIGHBORS={right:{even:"bc01fg45238967deuvhjyznpkmstqrwx"},left:{even:"238967debc01fg45kmstqrwxuvhjyznp"},top:{even:"p0r21436x8zb9dcf5h7kjnmqesgutwvy"},bottom:{even:"14365h7k9dcfesgujnmqp0r2twvyx8zb"}};BORDERS={right:{even:"bcfguvyz"},left:{even:"0145hjnp"},top:{even:"prxz"},bottom:{even:"028b"}};NEIGHBORS.bottom.odd=NEIGHBORS.left.even;NEIGHBORS.top.odd=
NEIGHBORS.right.even;NEIGHBORS.left.odd=NEIGHBORS.bottom.even;NEIGHBORS.right.odd=NEIGHBORS.top.even;BORDERS.bottom.odd=BORDERS.left.even;BORDERS.top.odd=BORDERS.right.even;BORDERS.left.odd=BORDERS.bottom.even;BORDERS.right.odd=BORDERS.top.even;return{decode:function(n){var h=1,d=[],a=[];d[0]=-90;d[1]=90;a[0]=-180;a[1]=180;lat_err=90;lon_err=180;for(i=0;i<n.length;i++){c=n[i];cd=BASE32.indexOf(c);for(j=0;j<5;j++){mask=BITS[j];if(h){lon_err/=2;f(a,cd,mask)}else{lat_err/=2;f(d,cd,mask)}h=!h}}d[2]=(d[0]+
d[1])/2;a[2]=(a[0]+a[1])/2;return{latitude:d,longitude:a}},encode:function(n,h,d){var a=1,e=[],k=[],b=0,o=0;d=d?d:12;geohash="";e[0]=-90;e[1]=90;k[0]=-180;for(k[1]=180;geohash.length<d;){if(a){mid=(k[0]+k[1])/2;if(h>mid){o|=BITS[b];k[0]=mid}else k[1]=mid}else{mid=(e[0]+e[1])/2;if(n>mid){o|=BITS[b];e[0]=mid}else e[1]=mid}a=!a;if(b<4)b++;else{geohash+=BASE32[o];o=b=0}}return geohash}}}();
T5.Geo.JSON=function(){function f(m,g,p,v){g=h(g);m.add(v.line(g,p));return g.length}function n(m,g,p,v){g=h(g);m.add(v.poly(g,p));return g.length}function h(m){var g=m?m.length:0,p=Array(g);for(g=g;g--;)p[g]=new T5.Geo.Position(m[g][1],m[g][0]);return T5.Geo.P.vectorize(p,k)}function d(m,g,p){return new l(m,g,p)}var a="featurecollection",e="feature",k={async:false},b={processor:null,group:"shapes",layerClass:T5.ShapeLayer},o={point:T5.ex({},b,{processor:function(m,g,p,v){g=h([g.coordinates],k);if(g.length>
0)if(p=v.marker(g[0],p)){m.add(p);return g.length}},group:"markers",layerClass:T5.MarkerLayer}),linestring:T5.ex({},b,{processor:function(m,g,p,v){g=h(g&&g.coordinates?g.coordinates:[]);return f(m,g,p,v)}}),multilinestring:T5.ex({},b,{processor:function(m,g,p,v){g=g&&g.coordinates?g.coordinates:[];for(var y=0,w=g.length;w--;)y+=f(m,g[w],p,v);return y}}),polygon:T5.ex({},b,{processor:function(m,g,p,v){g=g&&g.coordinates?g.coordinates:[];if(g.length>0)return n(m,g[0],p,v);return 0}}),multipolygon:T5.ex({},
b,{processor:function(m,g,p,v){g=g&&g.coordinates?g.coordinates:[];for(var y=0,w=0;w<g.length;w++)y+=n(m,g[w][0],p,v);return y}})},l=function(m,g,p,v){function y(q,s){var x=q.processor,C=A+q.group,G=T5.ex({},q,p,{properties:s.properties});if(x){var N=V[C];if(!N){N=new q.layerClass({id:C});V[C]=N}globalLayers=V;return x(N,s.data,G,v)}return 0}function w(q,s){var x=q&&q.type?q.type.toLowerCase():null;return x&&x===e?w(q.geometry,q.properties):{type:x,isCollection:x?x===a:false,definition:o[x],data:q,
properties:s?s:q.properties}}p=T5.ex({vectorsPerCycle:T5.Geo.VECTORIZE_PER_CYCLE,rowPreParse:null,simplify:false,layerPrefix:"geojson-"},p);v=T5.ex({marker:function(q){return new T5.Marker({xy:q})},line:function(q,s){return new T5.Poly(q,s)},poly:function(q,s){return new T5.Poly(q,T5.ex({fill:true},s))}},v);var r=p.vectorsPerCycle,u=p.rowPreParse,A=p.layerPrefix,z=0,I=0,H=null,W=0,V={},t;if(!m)return null;if(typeof m.length==="undefined")m=[m];I=m.length;t=COG.Loopage.join({frequency:10,execute:function(q,
s){var x=0,C=z;if(!H){for(;C<I;C++){var G=w(u?u(m[C]):m[C]),N=null;if(G.isCollection){W+=1;H=d(G.data.features,function(J){H=null;for(var D in J)V[D]=J[D]},{layerPrefix:A+W+"-"});N+=1}else if(G.definition)N=y(G.definition,G);x+=N?N:1;if(x>=r)break}z=C+1;!H&&z>=I&&s.trigger("complete")}}});t.bind("complete",function(){g&&g(V)});return t};return{parse:d}}();
T5.Geo.LocationSearch=function(f){function n(k,b){navigator.geolocation.clearWatch(d);d=0;if(a){clearTimeout(a);a=0}b&&b([k],f)}function h(k){COG.Log.info("caught location tracking error:",k)}f=T5.ex({name:"Geolocation Search",requiredAccuracy:null,searchTimeout:5E3,watch:false},f);var d=0,a=0,e=null;return new T5.Geo.GeoSearchAgent(T5.ex({execute:function(k,b){if(navigator.geolocation&&!d){d=navigator.geolocation.watchPosition(function(o){var l=new T5.Geo.Position(o.coords.latitude,o.coords.longitude);
o=new T5.Geo.GeoSearchResult({id:1,caption:"Current Location",pos:l,accuracy:o.coords.accuracy/1E3,matchWeight:100});if(!e||o.accuracy<e.accuracy)e=o;if(!f.requiredAccuracy||e.accuracy<f.requiredAccuracy)n(e,b)},h,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3});if(f.searchTimeout)a=setTimeout(function(){e&&n(e,b)},f.searchTimeout)}}},f))};T5.Geo.ImageTileGrid=function(f){T5.ex({},f)};
T5.Map=function(f){function n(r){try{var u=new T5.Geo.Position(r.coords.latitude,r.coords.longitude),A=r.coords.accuracy/1E3;w.trigger("locationUpdate",r,A);if(p){if(!m){m=new T5.Geo.UI.LocationOverlay({pos:u,accuracy:A});m.update(w.getTileLayer());w.setLayer("location",m)}var z=T5.Geo.B.createBoundsFromCenter(u,Math.max(A,1));w.gotoBounds(z)}else{m.pos=u;m.accuracy=A;m.update(w.getTileLayer());e(u,null,T5.easing("sine.out"))}p=false}catch(I){COG.Log.exception(I)}}function h(r){COG.Log.info("caught location tracking error:",
r)}function d(r,u){return T5.Geo.P.fromMercatorPixels(r*v,Math.PI-u*v)}function a(r,u,A){COG.Log.info("position updated to: ",r);y=u;T5.Images.cancelLoad();T5.cancelAnimation();v=T5.Geo.radsPerPixel(y);w.trigger("zoomLevelChange",y);e(r,A)}function e(r,u,A,z){r=new T5.Geo.GeoXY(r);r.setRadsPerPixel(T5.Geo.radsPerPixel(y));w.getDimensions();w.updateOffset(r.x,r.y,A,z,u);w.trigger("wake");w.trigger("boundsChange",w.getBoundingBox());u&&typeof A==="undefined"&&u(w)}f=T5.ex({tapExtent:10,provider:null,
crosshair:false,zoomLevel:0,boundsChangeThreshold:30,zoomAnimation:T5.easing("quad.out")},f);var k={NONE:0,SINGLE:1,WATCH:2},b=T5.XY.init(),o=k.NONE,l=false,m=null,g=0,p=true,v=0,y=f.zoomLevel;if(!f.provider)f.provider=new T5.Geo.MapProvider;f.adjustScaleFactor=function(r){return Math.pow(2,(r<1?Math.floor:Math.ceil)(Math.log(r)))};var w=T5.ex(new T5.Tiler(f),{annotations:null,getBoundingBox:function(){var r=w.getOffsetRect();return new T5.Geo.BoundingBox(d(r.x1,r.y2),d(r.x2,r.y1))},getCenterPosition:function(){var r=
w.getOffset();return w.getXYPosition(r.x,r.y)},getXYPosition:d,gotoBounds:function(r,u){var A=T5.Geo.B.getZoomLevel(r,w.getDimensions());a(T5.Geo.B.getCenter(r),A,u)},gotoPosition:a,panToPosition:e,locate:function(){w.trackStart(k.SINGLE);setTimeout(w.trackCancel,1E4)},trackStart:function(r){if(navigator.geolocation&&!g){o=r?r:k.WATCH;p=true;g=navigator.geolocation.watchPosition(n,h,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3})}},trackCancel:function(){g&&navigator.geolocation&&navigator.geolocation.clearWatch(g);
w.removeLayer("location");m=null;o=k.NONE;g=0},syncVectors:function(r){for(var u,A,z,I,H=r.length;H--;){var W=r[H];if(W&&W.setRadsPerPixel){W.setRadsPerPixel(v);u=typeof u==="undefined"||W.x<u?W.x:u;A=typeof A==="undefined"||W.y<A?W.y:A;z=typeof z==="undefined"||W.x>z?W.x:z;I=typeof I==="undefined"||W.y>I?W.y:I}}return T5.XYRect.init(u,A,I,I)},getZoomLevel:function(){return y},setZoomLevel:function(r){try{a(w.getCenterPosition(),r)}catch(u){COG.Log.exception(u)}},zoomIn:function(){T5.Geo.radsPerPixel(y);
T5.Geo.radsPerPixel(y+1);w.scale(2,T5.easing("sine.out"))||w.setZoomLevel(y+1)},zoomOut:function(){T5.Geo.radsPerPixel(y);T5.Geo.radsPerPixel(y-1);w.scale(0.5,T5.easing("sine.out"))||w.setZoomLevel(y-1)},animateRoute:function(r,u,A,z){var I=w.getLayer("route");if(I)(r=I.getAnimation(r,u,A,z))&&r.addToView(w)}});w.bind("pan",function(){o===k.SINGLE&&w.trackCancel()});w.bind("tap",function(r,u,A){var z=w.getTileLayer(),I=null;if(z){var H=w.viewPixToGridPix(T5.XY.init(A.x,A.y));r=z.pixelsToPos(H);I=
z.pixelsToPos(T5.XY.offset(H,-f.tapExtent,f.tapExtent));z=z.pixelsToPos(T5.XY.offset(H,f.tapExtent,-f.tapExtent));I=new T5.Geo.BoundingBox(I,z);w.trigger("geotap",u,A,r,I)}});w.bind("doubleTap",function(r,u,A){w.scalable()&&w.animate(2,T5.D.getCenter(w.getDimensions()),T5.XY.init(A.x,A.y),f.zoomAnimation)});w.bind("scale",function(r,u,A){r=0;u=Math.sqrt(u);if(u<1)r=-(0.5/u);else if(u>1)r=u;a(w.getXYPosition(A),y+r>>0)});f.crosshair&&w.setLayer("crosshair",new CrosshairOverlay);w.bind("idle",function(){if(T5.XY.absSize(T5.XY.diff(b,
w.getOffset()))>f.boundsChangeThreshold){b=T5.XY.copy(w.getOffset());w.trigger("boundsChange",w.getBoundingBox())}});COG.configurable(w,["provider"],COG.paramTweaker(f,null,{provider:function(){w.cleanup();l=false}}),true);return w};
T5.Geo.MapProvider=function(){var f=1,n=20;return{zoomLevel:0,checkZoomLevel:function(h){return Math.min(Math.max(h,f),n)},getCopyright:function(){},getLogoUrl:function(){},getMapTiles:function(){},getZoomRange:function(){return{min:f,max:n}},prepTileGridArgs:function(h,d,a,e,k){var b=null;if(k.tileBackgroundColor){b=T5.Images.newCanvas(a,a);var o=b.getContext("2d");o.fillStyle=k.tileBackgroundColor;o.fillRect(0,0,a,a)}return T5.ex({tileSize:a,width:h,height:d,center:e,tileDrawArgs:{background:b}},
k)},setZoomRange:function(h,d){f=h;n=d}}};
T5.MapTileGenerator=function(f){function n(y,w){for(var r=~~((y.x1-b.x)/l),u=~~((y.y1-b.y)/m),A=[],z=-g;z<g;z++)for(var I=-p;I<p;I++)A[A.length]=tileCreator(r+z,u+I);w&&w(A);k=T5.XYRect.copy(y)}function h(y,w){d=w;a=null}f=T5.ex({tileWidth:256,tileHeight:256},f);var d=0,a=null,e=null,k=null,b=T5.XY.init(),o=false,l=f.tileWidth,m=f.tileHeight,g=0,p=0,v={bindToView:function(y){COG.Log.info("initializing generator");e=y;if(y.getZoomLevel){d=y.getZoomLevel();y.bind("zoomLevelChange",h)}},initTileCreator:null,
run:function(y,w){var r=!k||Math.abs(y.x1-k.x1)>l||Math.abs(y.y1-k.y1)>m;if(!a&&!o){COG.Log.info("generating tiles, view rect = ",y);a=e.getCenterPosition();b=T5.XY.init(y.x1,y.y1);g=Math.ceil(y.width/l)+1;p=Math.ceil(y.height/m)+1;if(v.initTileCreator){o=true;v.initTileCreator(a,d,m,l,function(u){tileCreator=u;o=false;n(y,w)})}COG.Log.info("generator got view center: ",a)}tileCreator&&r&&n(y,w)}};COG.observable(v);return v};
T5.Geo.Routing=function(){var f={calculate:function(n){n=T5.ex({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},n);var h=T5.Geo.getEngine("route");h&&h.route(n,function(d){if(n.generalize)d.geometry=T5.Geo.P.generalize(d.geometry,d.getInstructionPositions());if(n.map){f.createMapOverlay(n.map,d);n.autoFit&&n.map.gotoBounds(d.boundingBox)}n.success&&n.success(d)})},createMapOverlay:function(n,h){var d=n.getDimensions();d=new T5.Geo.UI.RouteOverlay({data:h,width:d.width,
height:d.height});n.setLayer("route",d)},parseTurnType:function(n){for(var h=f.TurnType.Unknown,d=T5.Geo.Routing.TurnTypeRules,a=0;a<d.length;a++){d[a].regex.lastIndex=-1;var e=d[a].regex.exec(n);if(e){h=d[a].customCheck?d[a].customCheck(n,e):d[a].turnType;break}}return h},TurnType:{Unknown:"turn-unknown",Start:"turn-none-start",Continue:"turn-none",Arrive:"turn-none-arrive",TurnLeft:"turn-left",TurnLeftSlight:"turn-left-slight",TurnLeftSharp:"turn-left-sharp",TurnRight:"turn-right",TurnRightSlight:"turn-right-slight",
TurnRightSharp:"turn-right-sharp",Merge:"merge",UTurnLeft:"uturn-left",UTurnRight:"uturn-right",EnterRoundabout:"roundabout-enter",Ramp:"ramp",RampExit:"ramp-exit"},Instruction:function(n){var h=n=T5.ex({position:null,description:"",distance:0,distanceTotal:0,time:0,timeTotal:0,turnType:null},n),d=n.description;d=d.replace(/(\w)(\/)(\w)/g,"$1 $2 $3");h.description=d;if(!n.turnType)n.turnType=f.parseTurnType(n.description);return n},RouteData:function(n){n=T5.ex({geometry:[],instructions:[],boundingBox:null},
n);if(!n.boundingBox)n.boundingBox=T5.Geo.B.forPositions(n.geometry);return T5.ex({getInstructionPositions:function(){for(var h=[],d=0;d<n.instructions.length;d++)n.instructions[d].position&&h.push(n.instructions[d].position);return h}},n)}};return f}();T5.Geo.Search=function(){return{bestResults:function(f,n){n||(n=20);for(var h=f.length>0?f[0]:null,d=[],a=0;a<f.length;a++)if(h&&f[a]&&h.matchWeight-f[a].matchWeight<=n)d.push(f[a]);else break;return d}}}();
T5.Geo.UI=function(){var f={AnnotationTween:null,GeoTileGrid:function(n){n=T5.ex({grid:null,centerPos:new T5.Geo.Position,centerXY:T5.XY.init(),radsPerPixel:0},n);var h=n.radsPerPixel,d=T5.Geo.P.toMercatorPixels(n.centerPos),a=d.x/h-n.centerXY.x>>0,e=d.y/h-n.centerXY.y>>0,k=null,b=T5.ex({},n.grid,{getGridXYForPosition:function(o){o=new T5.Geo.GeoVector(o);b.syncVectors([o]);return o},syncVectors:function(o){for(var l,m,g,p,v=o.length;v--;){var y=o[v];if(y&&y.setRadsPerPixel){y.setRadsPerPixel(h,-a,
-k);l=typeof l==="undefined"||y.x<l?y.x:l;m=typeof m==="undefined"||y.y<m?y.y:m;g=typeof g==="undefined"||y.x>g?y.x:g;p=typeof p==="undefined"||y.y>p?y.y:p}}return T5.XYRect.init(l,m,p,p)},getPixelDistance:function(o){return T5.Geo.dist2rad(o)/h>>0},pixelsToPos:function(o){return T5.Geo.P.fromMercatorPixels((a+o.x)*h,(e+b.gridDimensions.height-o.y)*h)}});k=e+b.gridDimensions.height;return b},RouteOverlay:function(n){n=T5.ex({data:null,pixelGeneralization:8,partialDraw:false,strokeStyle:"rgba(0, 51, 119, 0.9)",
waypointFillStyle:"#FFFFFF",lineWidth:4,zindex:50},n);var h=[],d=[],a=new T5.PathLayer(n);(function(){if(n.data&&n.data.instructions){for(var e=n.data.instructions,k=Array(e.length),b=e.length;b--;)k[b]=e[b].position;T5.Geo.P.vectorize(k).bind("complete",function(o,l){d=l})}n.data&&n.data.geometry&&T5.Geo.P.vectorize(n.data.geometry).bind("complete",function(o,l){h=l;a.updateCoordinates(h,d,true)})})();return a},Poly:function(n,h){h=T5.ex({autoParse:true},h);for(var d=Array(n.length),a=h.autoParse,
e=T5.Geo.GeoVector,k=T5.Geo.P.parse,b=n.length;b--;)d[b]=new e(a?k(n[b]):n[b]);return new T5.Poly(d,h)},Annotation:function(n){n=T5.ex({pos:null},n);n.xy=new T5.Geo.GeoVector(n.pos);return new T5.ImageAnnotation(n)},LocationOverlay:function(n){n=T5.ex({pos:null,accuracy:null,zindex:90},n);var h=new Image,d=T5.XY.init(),a=T5.XY.init(),e=null;h.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAACIQAAAiEBPhEQkwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAG+SURBVCiRlZHNahNRAIW/O7mTTJPahLZBA1YUyriINRAE3bQIKm40m8K8gLj0CRQkO32ELHUlKbgoIu4EqeJPgtCaoBuNtjXt5LeTMZk0mbmuWiuuPLsD3+HAOUIpxf9IHjWmaUbEyWv5ROrsVULhcHP761rUfnN3Y2Otc8CIg4YT85lzuVsPP+Qupw1vpPjRCvhS9ymvV0e77x7nNj+uvADQAIQQ+uLyvdfLV9JGZi7EdEwQlqBpEJ019f0z1mo2u5Q8DMydv25lshemmj1FueZTawbs7inarqLbV7Qjab1upB9YlhWSAHLavLHZCvg1VEhN0PMU9W7At4bPVidg7CtkLLXkut+lBPD6/Ub155jJiADAHSpaLmx3ApyBQoYEUd0PBoOBkAC6+3llvda/YxgGgYL+UNHf/zN3KiExGlsvTdP0NYDkhPdWrz35ZDsBzV5wCMuQwEyFmXFeeadjzfuFQmGkAZRKpdGC/n7x+M6jqvA9Zo6FWDhlcHE+wqT93J1tP7vpOE7rrx8ALMuasPf8S12St4WmJ6bYWTUC52k8Hm8Vi0X/nwBAPp/XKpWKdF1X2LYdlMvlsToC/QYTls7DLFr/PAAAAABJRU5ErkJggg%3D%3D";
h.onload=function(){d=T5.XY.init(h.width/2,h.height/2)};var k=T5.ex(new T5.ViewLayer(n),{pos:n.pos,accuracy:n.accuracy,drawAccuracyIndicator:false,draw:function(b,o){var l=a.x-o.x,m=a.y-o.y;if(e){b.fillStyle="rgba(30, 30, 30, 0.2)";b.beginPath();b.arc(l,m,e,0,Math.PI*2,false);b.fill()}h.complete&&h.width>0&&b.drawImage(h,l-d.x,m-d.y,h.width,h.height);k.changed()},update:function(b){if(b){e=Math.floor(b.getPixelDistance(k.accuracy)*0.5);a=b.getGridXYForPosition(k.pos);k.changed()}}});k.bind("gridUpdate",
function(b,o){k.update(o)});return k},AnnotationsOverlay:function(n){function h(b,o){var l=b.length,m=k.getParent();if(o=o?o:m?m.getTileLayer():null)for(l=l;l--;)o.syncVectors([b[l].xy]);b.sort(function(g,p){var v=p.xy.y-g.xy.y;if(v===0)v=p.xy.x-g.xy.x;return v})}n=T5.ex({pois:null,map:null,zindex:100},n);var d=[],a=false,e=[],k=T5.ex(new T5.ViewLayer(n),{cycle:function(){return a},draw:function(b,o,l,m,g){a=false;b.fillStyle="rgba(255, 0, 0, 0.75)";b.globalCompositeOperation="source-over";for(l=
d.length;l--;){d[l].draw(b,o,m,k,g);a=a||d[l].isAnimating()}for(l=e.length;l--;){e[l].draw(b,o,m,k,g);a=a||e[l].isAnimating()}return a?1:0},add:function(b){if(b&&b.length)for(var o=b.length;o--;)e[e.length]=b[o];else if(b)e[e.length]=b;h(e);k.changed()},clear:function(b){e=[];h(e);if(b){d=[];h(d)}k.changed()}});COG.listen("geo.pois-updated",function(b){if(n.pois&&n.pois.id==b.srcID){b=b.pois;try{d=[];for(var o=0;o<b.length;o++)if(b[o].pos){var l;var m=b[o];if(m&&m.pos){var g={poi:m,annotation:null};
n.map&&n.map.trigger("getAnnotationForPOI",g);if(!g.annotation)g.annotation=new T5.Annotation({xy:new T5.Geo.GeoVector(m.pos)});if(g.annotation){g.annotation.isNew=m.isNew;m.isNew=false}l=g.annotation}else l=void 0;l&&d.push(l)}h(d)}catch(p){COG.Log.exception(p)}k.changed()}});k.bind("gridUpdate",function(b,o){h(d,o);h(e,o);k.changed()});return k}};f.ImageAnnotation=f.Annotation;return f}();
T5.Geo.Routing.TurnTypeRules=function(){var f=T5.Geo.Routing.TurnType,n=[];n.push({regex:/continue/i,turnType:f.Continue});n.push({regex:/(take|bear|turn)(.*?)left/i,customCheck:function(h,d){return/bear/i.test(d[1])?f.TurnLeftSlight:f.TurnLeft}});n.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(h,d){return/bear/i.test(d[1])?f.TurnRightSlight:f.TurnRight}});n.push({regex:/enter\s(roundabout|rotaty)/i,turnType:f.EnterRoundabout});n.push({regex:/take.*?ramp/i,turnType:f.Ramp});n.push({regex:/take.*?exit/i,
turnType:f.RampExit});n.push({regex:/make(.*?)u\-turn/i,customCheck:function(h,d){return/right/i.test(d[1])?f.UTurnRight:f.UTurnLeft}});n.push({regex:/proceed/i,turnType:f.Start});n.push({regex:/arrive/i,turnType:f.Arrive});n.push({regex:/fell\sthrough/i,turnType:f.Merge});return n}();
