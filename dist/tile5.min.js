(function(){function I(){var a=arguments[0]||{},d=Array.prototype.slice.call(arguments,1),b=d.length,e,h;for(h=0;h<b;h++)if((e=d[h])!==null)for(var j in e){var g=e[j];if(a!==g)if(g!==undefined)a[j]=g}return a}function va(a,d){if(typeof console!=="undefined")console[d||"log"](a)}function Da(a){var d=a.match(Ab),b=[],e=0,h;for(h=d?d.length:0;h--;){var j=d[h].slice(1);b[j]||(b[j]=RegExp("\\{"+j+"\\}","g"))}e=b.length;return function(){var g=a;for(h=0;h<e;h++){var i=arguments[h];if(typeof i=="undefined")i=
"";g=g.replace(b[h],i)}return g}}function kb(a,d){var b=Pa*da(a);return lb-2*mb(d*wa((1-b)/(1+b),Pa/2))}function V(a,d){if(R(a,oa)){var b=a.split(nb);this.x=parseFloat(b[0]);this.y=parseFloat(b[1])}else if(a&&a.x){this.x=a.x;this.y=a.y}else{this.x=a||0;this.y=d||0}}function Ea(a){this.allowCull=a}function pa(a,d,b,e){this.mercX=b;this.mercY=e;if(R(a,oa))I(this,Bb.parseXY(a));else a&&a.toBounds?I(this,Qa(a.lon,a.lat)):V.call(this,a,d)}function qa(a,d,b,e){this.x=a||0;this.y=d||0;this.w=b||0;this.h=
e||0;this.x2=this.x+this.w;this.y2=this.y+this.h}function ob(a,d){var b=new pb(Math.sqrt(256<<a)|0);d&&d.zoomLevel===a&&d.copyInto(b);b.zoomLevel=a;return b}function ab(a,d,b,e,h,j){this.x=a;this.y=d;this.w=e||256;this.h=e||256;this.x2=this.x+this.w;this.y2=this.y+this.h;this.url=b;this.id=j||a+"_"+d;this.loaded=false;this.image=null}function Ra(a,d){d=I({id:"layer_"+Cb++,zindex:0,animated:false,style:null,minXY:null,maxXY:null,visible:true},d);this.visible=d.visible;this.view=a;ra(I(this,d))}function Sa(){ra(this)}
var Ab=/\{(\d+)(?=\})/g,Db=function(){var a=1.70158,d=Math.PI/2,b=Math.abs,e=Math.pow,h=Math.sin,j=Math.asin,g=Math.cos,i={linear:function(c,m,k,f){return k*c/f+m},backin:function(c,m,k,f){return k*(c/=f)*c*((a+1)*c-a)+m},backout:function(c,m,k,f){return k*((c=c/f-1)*c*((a+1)*c+a)+1)+m},backinout:function(c,m,k,f){return(c/=f/2)<1?k/2*c*c*(((a*=1.525)+1)*c-a)+m:k/2*((c-=2)*c*(((a*=1.525)+1)*c+a)+2)+m},bouncein:function(c,m,k,f){return k-i.bounceout(f-c,0,k,f)+m},bounceout:function(c,m,k,f){return(c/=
f)<1/2.75?k*7.5625*c*c+m:c<2/2.75?k*(7.5625*(c-=1.5/2.75)*c+0.75)+m:c<2.5/2.75?k*(7.5625*(c-=2.25/2.75)*c+0.9375)+m:k*(7.5625*(c-=2.625/2.75)*c+0.984375)+m},bounceinout:function(c,m,k,f){return c<f/2?i.bouncein(c*2,0,k,f)/2+m:i.bounceout(c*2-f,0,k,f)/2+k/2+m},cubicin:function(c,m,k,f){return k*(c/=f)*c*c+m},cubicout:function(c,m,k,f){return k*((c=c/f-1)*c*c+1)+m},cubicinout:function(c,m,k,f){if((c/=f/2)<1)return k/2*c*c*c+m;return k/2*((c-=2)*c*c+2)+m},elasticin:function(c,m,k,f,n,l){if(c==0)return m;
if((c/=f)==1)return m+k;l||(l=f*0.3);if(!n||n<b(k)){n=k;k=l/4}else k=l/ea*j(k/n);return-(n*e(2,10*(c-=1))*h((c*f-k)*ea/l))+m},elasticout:function(c,m,k,f,n,l){var q;if(c==0)return m;if((c/=f)==1)return m+k;l||(l=f*0.3);if(!n||n<b(k)){n=k;q=l/4}else q=l/ea*j(k/n);return n*e(2,-10*c)*h((c*f-q)*ea/l)+k+m},elasticinout:function(c,m,k,f,n,l){var q;if(c==0)return m;if((c/=f/2)==2)return m+k;l||(l=f*0.3*1.5);if(!n||n<b(k)){n=k;q=l/4}else q=l/ea*j(k/n);if(c<1)return-0.5*n*e(2,10*(c-=1))*h((c*f-q)*ea/l)+m;
return n*e(2,-10*(c-=1))*h((c*f-q)*ea/l)*0.5+k+m},quadin:function(c,m,k,f){return k*(c/=f)*c+m},quadout:function(c,m,k,f){return-k*(c/=f)*(c-2)+m},quadinout:function(c,m,k,f){if((c/=f/2)<1)return k/2*c*c+m;return-k/2*(--c*(c-2)-1)+m},sinein:function(c,m,k,f){return-k*g(c/f*d)+k+m},sineout:function(c,m,k,f){return k*h(c/f*d)+m},sineinout:function(c,m,k,f){return-k/2*(g(Math.PI*c/f)-1)+m}};return function(c){c=c.replace(/[\-\_\s\.]/g,"").toLowerCase();return i[c]||i.linear}}(),ra=function(){function a(b,
e){var h=b.hasOwnProperty("obsHandlers")?b.obsHandlers:null;h[e]||(h[e]=[]);return h[e]}var d=0;return function(b){if(!b)return null;if(!(b.hasOwnProperty("obsHandlers")?b.obsHandlers:null))b.obsHandlers={};if(!b.hasOwnProperty("bind")){b.bind=function(e,h){var j="callback"+d++;a(b,e).unshift({fn:h,id:j});return j};b.triggerCustom=function(e,h){var j=a(b,e),g={cancel:false,name:e,source:this},i;for(i in h)g[i]=h[i];if(!j)return null;i=Array.prototype.slice.call(arguments,2);b.eventInterceptor&&b.eventInterceptor(e,
g,i);i.unshift(g);for(var c=j.length;c--&&!g.cancel;)j[c].fn.apply(this,i);return g};b.trigger=function(e){var h=Array.prototype.slice.call(arguments,1);h.splice(0,0,e,null);return b.triggerCustom.apply(this,h)};b.unbind=function(e,h){if(typeof e==="undefined")b.obsHandlers={};else for(var j=a(b,e),g=0;j&&g<j.length;g++)if(j[g].id===h){j.splice(g,1);break}return b}}return b}}(),qb=function(){function a(d,b,e,h){if(typeof d[h]=="undefined")d[h]=function(j){if(typeof j!="undefined"){b[h]=j;e[h]&&e[h](j);
return d}else return b[h]}}return function(d,b,e){b=b||d;for(var h in b)typeof b[h]!="function"&&a(d,b,e,h);return d}}(),bb=Array.prototype.indexOf||function(a){for(var d=0;d<this.length;d++)if(this[d]===a)return d;return-1},R=function(){var a={NaN:1,Infinity:1,"-Infinity":1},d=String.prototype.toLowerCase,b=Object.prototype.toString;return function(e,h){h=d.call(h);if(h=="finite")return!a.hasOwnProperty(+e);return h=="null"&&e===null||h==typeof e||h=="object"&&e===Object(e)||h=="array"&&Array.isArray&&
Array.isArray(e)||b.call(e).slice(8,-1).toLowerCase()==h}}();(function(){function a(j){var g=document.createElement("script"),i=false;g.src=j;g.async=true;g.onload=g.onreadystatechange=function(){if(!i&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){i=true;g.onload=g.onreadystatechange=null;g&&g.parentNode&&g.parentNode.removeChild(g)}};h||(h=document.getElementsByTagName("head")[0]);h.appendChild(g)}function d(j,g,i){j+=j.indexOf("?")>=0?"&":"?";var c="json"+ ++e;window[c]=
function(m){g(m);window[c]=null;try{delete window[c]}catch(k){}};a(j+(i?i:"callback")+"="+c);return c}function b(j,g,i){var c=require("request");j=j+(j.indexOf("?")>=0?"&":"?")+(i?i:"callback")+"=cb";c({uri:j},function(m,k,f){m=f.replace(/^.*\(/,"").replace(/\).*$/,"");g(JSON.parse(m))})}var e=0,h;return typeof window!="undefined"?d:b})();INTERACT=function(){function a(n){return function(l,q){n.addEventListener(l,q,false)}}function d(n){return function(l,q){n.removeEventListener(l,q,false)}}function b(n){return function(l,
q){n.attachEvent("on"+l,q)}}function e(n,l){return{x:n?n:0,y:l?l:0,count:1}}function h(n,l){k.push(I({handler:null,checks:{},type:n},l))}function j(n){var l=0,q=0;if(n.offsetParent){do{l+=n.offsetLeft;q+=n.offsetTop;n=n.offsetParent}while(n)}return{left:l,top:q}}function g(n,l){return{source:n,target:l.target?l.target:l.srcElement}}function i(n,l){for(var q=n.target?n.target:n.srcElement;q&&q!==l;)q=q.parentNode;return q&&q===l}function c(n,l){return{x:n.x-(l?l.left:0),y:n.y-(l?l.top:0)}}function m(n,
l){if(n.preventDefault){n.preventDefault();n.stopPropagation()}else if(typeof n.cancelBubble!="undefined")n.cancelBubble=true;l&&n.stopImmediatePropagation&&n.stopImmediatePropagation()}var k=[],f=function(n,l,q){q=I({binder:null,unbinder:null,observable:null},q);for(var v=q.observable,A=[],K,O,p={bind:function(){return v.bind.apply(null,arguments)},unbind:function(){v.unbind();for(w=0;w<A.length;w++)A[w].unbind();return p}},w=0;w<l.length;w++)A.push(l[w](n,v,q));v.bind("pointerDown",function(){O=
K=0});v.bind("pointerMove",function(o,u,t,y){K+=y.x||0;O+=y.y||0});v.bind("pointerUp",function(o,u,t){Math.abs(K)>20||Math.abs(O)>20||v.triggerCustom("tap",o,u,t)});return p};h("pointer",{handler:function(n,l,q){function v(z){if(z.pageX&&z.pageY)return e(z.pageX,z.pageY);else{var G=document.documentElement,H=document.body;return e(z.clientX+(G&&G.scrollLeft||H&&H.scrollLeft||0)-(G&&G.clientLeft||H&&H.clientLeft||0),z.clientY+(G&&G.scrollTop||H&&H.scrollTop||0)-(G&&G.clientTop||H&&H.clientTop||0))}}
function A(z){if(i(z,n))if(y=w(z)){var G=v(z);n.style.cursor="move";m(z,true);L=G.x;P=G.y;B=e(L,P);l.triggerCustom("pointerDown",g("mouse",z),B,c(B,j(n)))}}function K(z){var G=v(z);E=G.x;M=G.y;if(i(z,n))o(z,y?"pointerMove":"pointerHover")}function O(z){if(y&&w(z)){y=false;if(i(z,n)){n.style.cursor="default";o(z,"pointerUp")}}}function p(z){if(i(z,n)){var G;z=z||window.event;if(z.detail){if(typeof z.axis=="undefined"||z.axis===2)G=-z.detail*u}else{G=z.wheelDeltaY?z.wheelDeltaY:z.wheelDelta;if(window.opera)G=
-G}if(G){var H=e(E,M);l.triggerCustom("zoom",g("mouse",z),H,c(H,j(n)),G/t,"wheel");m(z);z.returnValue=false}}}function w(z){z=z||window.event;return(z.which||z.button)==1}function o(z,G,H,T,ha){H=typeof H!="undefined"?H:E;T=typeof T!="undefined"?T:M;var C=H-L,N=T-P,F=e(H,T);l.triggerCustom(G,g("mouse",z),F,c(F,j(n)),e(C,N));if(typeof ha=="undefined"||ha){L=H;P=T}}q=I({},q);var u=120,t=u*8,y=false,B,E,M,L,P;q.binder("mousedown",A);q.binder("mousemove",K);q.binder("mouseup",O);q.binder("dblclick",function(z){va("captured double click");
if(i(z,n)){var G=v(z);l.triggerCustom("doubleTap",g("mouse",z),G,c(G,j(n)))}});q.binder("mousewheel",p);q.binder("DOMMouseScroll",p);return{unbind:function(){q.unbinder("mousedown",A);q.unbinder("mousemove",K);q.unbinder("mouseup",O);q.unbinder("mousewheel",p);q.unbinder("DOMMouseScroll",p)}}},checks:{touch:false}});h("pointer",{handler:function(n,l,q){function v(C){if(C.count<2)return 0;var N=C.x-C.next.x;C=C.y-C.next.y;return~~Math.sqrt(N*N+C*C)}function A(C,N,F){N=N?N:0;F=F?F:0;for(var U={x:C.x-
N,y:C.y-F,id:C.id,count:C.count},ba=U;C.next;){C=C.next;ba=ba.next={x:C.x-N,y:C.y-F,id:C.id}}return U}function K(C,N){var F=C[N?N:"touches"],U,ba;if(F.length===0)return null;ba=U={x:F[0].pageX,y:F[0].pageY,id:F[0].identifier,count:F.length};for(var S=1,Y=F.length;S<Y;S++)ba=ba.next={x:F[S].pageX,y:F[S].pageY,id:F[S].identifier};return U}function O(C){if(i(C,n)){M=j(n);var N=K(C,"changedTouches"),F=A(N,M.left,M.top);if(!P){L=y;l.triggerCustom("pointerDown",g("touch",C),N,F)}T&&l.triggerCustom("pointerDownMulti",
g("touch",C),N,F);P=K(C);if(P.count>1)G=v(P);ha=1;H=A(P)}}function p(C){if(i(C,n)){m(C);z=K(C);if(L==y)L=Math.abs(P.x-z.x)>u||Math.abs(P.y-z.y)>u?t:y;if(L!=y){L=z.count>1?E:B;if(L==E)if(P.count===1){P=A(z);G=v(P)}else{var N=v(z);if(Math.abs(G-N)<o)L=B;else{var F;F=z.x;var U=z.next.x,ba=z.y,S=z.next.y;F={x:(F<U?F:U)+(Math.abs(F-U)>>1),y:(ba<S?ba:S)+(Math.abs(ba-S)>>1)};N=N/G;U=N-ha;l.triggerCustom("zoom",g("touch",C),F,c(F,M),U,"pinch");ha=N}}L==B&&l.triggerCustom("pointerMove",g("touch",C),z,A(z,
M.left,M.top),e(z.x-H.x,z.y-H.y));T&&l.triggerCustom("pointerMoveMulti",g("touch",C),z,A(z,M.left,M.top))}H=A(z)}}function w(C){if(i(C,n)){var N=K(C,"changedTouches"),F=A(N,M.left,M.top);z=K(C);if(!z){l.triggerCustom("pointerUp",g("touch",C),N,F);P=null}T&&l.triggerCustom("pointerUpMulti",g("touch",C),N,F)}}q=I({detailed:false,inertia:false},q);var o=20,u=7,t=0,y=1,B=2,E=3,M,L,P,z,G,H,T=q.detailed,ha=1;q.binder("touchstart",O);q.binder("touchmove",p);q.binder("touchend",w);va("initialized touch handler");
return{unbind:function(){q.unbinder("touchstart",O);q.unbinder("touchmove",p);q.unbinder("touchend",w)}}},checks:{touch:true}});return{register:h,watch:function(n,l,q){l=I({bindTarget:null,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},l);capabilities=I({touch:"ontouchstart"in window},q);if(!l.observable){va("creating observable");l.observable=ra({});globalOpts=l}l.binder=(l.isIE?b:a)(l.bindTarget||document);l.unbinder=(l.isIE?b:d)(l.bindTarget||document);q=l.types;for(var v=
capabilities,A=[],K=k.length;K--;){var O=k[K],p=!q||q.indexOf(O.type)>=0,w=true,o;for(o in O.checks){var u=O.checks[o];va("checking "+o+" capability. require: "+u+", capability = "+v[o]);w=w&&u===v[o]}if(p&&w)A[A.length]=O.handler}return new f(n,A,l)}}}();(function(){function a(p,w){if(p&&p.split){var o=p.split(K);if(o.length>1){p=o[0];w=o[1]}}else if(p&&p.lat){w=p.lon;p=p.lat}this.lat=parseFloat(p||0);this.lon=parseFloat(w||0)}function d(p,w){if(p&&p.splice){for(var o=w,u=new a(m,f),t=new a(k,n),
y=p.length;y--;){var B=typeof p[y]=="string"?new a(p[y]):p[y];if(B.lat<u.lat)u.lat=B.lat;if(B.lat>t.lat)t.lat=B.lat;if(B.lon<u.lon)u.lon=B.lon;if(B.lon>t.lon)t.lon=B.lon}this.min=u;this.max=t;if(typeof o=="undefined"){o=this.size();o=Math.max(o.x,o.y)*0.3}this.min=new a(u.lat-o,(u.lon-o)%360);this.max=new a(t.lat+o,(t.lon+o)%360)}else{this.min=p;this.max=w}}function b(p){if(typeof p=="string"){var w=(p.replace(/\d|\.|\s/g,"")||"m").toLowerCase();p=parseFloat(p)*({km:1E3}[w]||1)}this.meters=p||0}var e=
[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],h=typeof module!="undefined"&&module.exports,j=Math.PI*2,g=Math.PI/2,i=Math.PI/180,c=180/Math.PI,m=90,k=-m,f=180,n=-f,l=m*i,q=-l,v=f*i,A=-v,K=/[\,\s]+/;a.prototype={constructor:a,copy:function(){return new a(this.lat,this.lon)},distanceTo:function(){if(!targetPos||this.empty()||targetPos.empty())return 0;var p=(targetPos.lat-this.lat)*ka/2,w=(targetPos.lon-this.lon)*ka/2;p=da(p)*da(p)+sa(this.lat*ka)*sa(targetPos.lat*
ka)*da(w)*da(w);return 6371*2*Eb(cb(p),cb(1-p))},equalTo:function(p){return pos&&this.lat===p.lat&&this.lon===p.lon},empty:function(){return this.lat===0&&this.lon===0},inArray:function(p){for(var w=p.length;w--;)if(this.equal(p[w]))return true;return false},offset:function(p,w){var o=this.lat*i,u=this.lon*i,t=o+p/6371;o=rb(da(w/6371)/sa(o));u=u+o;t=(t+g)%Math.PI-g;u%=j;return new a(t*c,u*c)},toBounds:function(p){var w=p.radians(),o=this.lat*i,u=this.lon*i;p=o-w;var t=o+w;if(p>q&&t<l){o=rb(da(w)/
sa(o));w=u-o;if(w<A)w+=j;u=u+o;if(u>v)u-=j}else{p=Fa(p,q);t=db(t,l);w=n;u=f}return new d(new a(p*c,w*c),new a(t*c,u*c))},toString:function(p){return this.lat+(p||" ")+this.lon}};d.prototype={constructor:d,bestZoomLevel:function(p,w){var o=this.center(),u=e[Math.min(Math.round(Math.abs(o.lat)*0.05),e.length)],t=this.size();o=Math.ceil(Math.log(e[3]*w/t.y)/Math.LN2);u=Math.ceil(Math.log(u*p/t.x)/Math.LN2);return Math.min(isNaN(o)?1E3:o,isNaN(u)?1E3:u)},center:function(){var p=this.size();return new a(this.min.lat+
p.y/2,this.min.lon+p.x/2)},expand:function(p){return new d(new a(this.min.lat-p,(this.min.lon-p)%360),new a(this.max.lat+p,(this.max.lon+p)%360))},size:function(p){var w={x:0,y:this.max.lat-this.min.lat};w.x=typeof p!="undefined"&&p&&this.min.lon>this.max.lon?360-this.min.lon+this.max.lon:this.max.lon-this.min.lon;return w},toString:function(){return"min: "+this.min+", max: "+this.max},union:function(){for(var p=this.min.copy(),w=this.max.copy(),o=arguments.length;o--;)if(arguments[o]){var u=arguments[o].min,
t=arguments[o].max;p.lat=Math.min(p.lat,u.lat);p.lon=Math.min(p.lon,u.lon);w.lat=Math.max(w.lat,t.lat);w.lon=Math.max(w.lon,t.lon)}return new d(p,w)}};b.prototype={add:function(){for(var p=this.meters,w=arguments.length;w--;){var o=typeof arguments[w]=="string"?new b(arguments[w]):arguments[w];p+=o.meters}return new b(p)},radians:function(p){if(typeof p!="undefined"){this.meters=p*6371E3;return this}else return this.meters/6371E3},toString:function(){if(this.meters>1E3)return(this.meters/10|0)/100+
"km";return this.meters+"m"}};var O=this.GeoJS={Pos:a,BBox:d,Distance:b,generalize:function(p,w,o){var u=p.length,t=[],y=null;o=(o||250)/1E3;for(u=u;u--;)if(u===0)t.unshift(p[u]);else{var B=!y||p[u].inArray(w)?o:y.distanceTo(p[u]);if(p[u]&&B>=o){t.unshift(p[u]);y=p[u]}}return t},include:function(p){if(h){p=p.split(",");for(var w=0;w<p.length;w++){var o=require("./plugins/"+p[w].trim()),u;for(u in o)O[u]=o[u]}}return O}};if(h)module.exports=O})();var Ga=this.T5=ra({}),Ta=function(){var a={};return{create:function(d,
b){if(a[d][b])return a[d][b].apply(null,Array.prototype.slice.call(arguments,2));throw Fb(d,b);},get:function(d,b){return a[d]?a[d][b]:null},register:function(d,b,e){a[d]||(a[d]={});a[d][b]&&va(Gb(d,b),"warn");a[d][b]=e}}}(),Gb=Da("Registration of {0}: {1} will override existing definition"),Fb=Da("Could not create {0} of type: {1}");Da("Could not create drawable of type: {0}");var ea=Math.PI*2,lb=Math.PI/2,ka=Math.PI/180,Ua=180/Math.PI,Pa=0.08181919084262157,la=Math.abs,Va=Math.round,db=Math.min,
Fa=Math.max,wa=Math.pow,cb=Math.sqrt,eb=Math.log,da=Math.sin,rb=Math.asin,sa=Math.cos,mb=Math.atan,Eb=Math.atan2,xa="undefined",oa="string",Hb="object",ta="number",Ib="array",ia=Ta.register,za=Ta.create,Jb=Ta.get,Kb=0,Cb=0,nb=/[\,\s]+/,Aa=function(){function a(g){h++;g=Q?window.mozAnimationStartTime||g||(new Date).getTime():(new Date).getTime();for(var i=e.length;i--;){var c=e[i];h%c.every===0&&c.cb(g)}j&&animFrame(a)}var d=1E3/60,b=["r","webkitR","mozR","oR","msR"],e=[],h=0,j=Q&&function(){for(var g=
0;g<b.length;g++)window.animFrame=window.animFrame||window[b[g]+"equestAnimationFrame"];return animFrame}();j?animFrame(a):setInterval(a,1E3/60);return{attach:function(g,i){e[e.length]={cb:g,every:i?Va(i/d):1}},detach:function(g){for(var i=e.length;i--;)if(e[i].cb===g){e.splice(i,1);break}}}}(),Bb=function(){var a=/^xy\((.*)\).*$/i;return{parseXY:function(d){if(!a.test(d)){d=d.split(nb);return Qa(d[1],d[0])}}}}(),Q=typeof window!="undefined"?function(){function a(h){for(var j=0;j<h.length;j++){var g=
h[j];if(typeof document.body.style[g]!="undefined")return g}}var d={"-webkit-user-select":"none",position:"absolute"},b,e;b=a(["-webkit-transform","MozTransform"]);css3DTransformProp=a(["WebkitPerspective","MozPerspective"]);e=a(["-webkit-transform-origin","MozTransformOrigin"]);return{transforms:R(b,oa),create:function(h,j,g){h=document.createElement(h);var i=[];g=g||{};h.className=j||"";for(var c in g)i[i.length]=c+": "+g[c];h.style.cssText=i.join(";");return h},move:function(h,j,g,i,c){if(b){h.style[b]=
"translate("+j+"px, "+g+"px) "+(i||[]).join(" ");if(c&&e)h.style[e]=c.x+"px "+c.y+"px"}else{h.style.left=j+"px";h.style.top=g+"px"}},styles:function(h){return I({},d,h)}}}():null,sb=function(){function a(){for(var h=e.length,j=h;j--;)try{e[j](h)}catch(g){va(g.toString(),"error")}}var d=20,b=50,e=[];return{process:function(h,j,g,i){function c(f){f=(m||b)/f;if(k<h.length){var n=h.slice(k,k+f);f=n.length;var l=m?0:(new Date).getTime();j(n,f);if(!m)m=(n=((new Date).getTime()-l)/f)?d/n|0:h.length;k+=f}else{for(f=
e.length;f--;)if(e[f]===c){e.splice(f,1);break}e.length===0&&Aa.detach(a);g&&g()}}var m,k=0;if(Q&&h.length>(i||0))e.push(c)===1&&Aa.attach(a);else{j(h,h.length);g&&g()}}}}(),Qa=Qa||function(a,d){var b=parseFloat(d)*ka;b=da(b);var e=Pa*b;b=eb((1+b)/(1-b)*wa((1-e)/(1+e),Pa))/2;return new pa(0,0,parseFloat(a)*ka,b)},fb=fb||function(a,d){for(var b=wa(Math.E,-d),e=lb-2*mb(b),h=kb(e,b),j=0;j<12&&la(e-h)>1.0E-7;){e=h;h=kb(e,b);j++}return new GeoJS.Pos(h*Ua,a%360*Ua)};V.prototype={constructor:V,add:function(){for(var a=
this.x,d=this.y,b=arguments.length;b--;){a+=arguments[b].x;d+=arguments[b].y}return this.copy(a,d)},copy:function(a,d){var b=I({},this);b.x=a||b.x;b.y=d||b.y;return b},equals:function(a){return this.x===a.x&&this.y===a.y},offset:function(a,d){return this.copy(this.x+a,this.y+d)},relative:function(a){a=a.viewport();return this.copy(this.x-a.x-a.padding.x,this.y-a.y-a.padding.y)},rotate:function(a,d){d=d||new V(0,0);var b=this.x-d.x,e=this.y-d.y;return new V(d.x+sa(a)*b+-da(a)*e,d.y+da(a)*b+sa(a)*e)},
scale:function(a,d){d=d||new V(0,0);return new V(d.x+(this.x-d.x)*a,d.y+(this.y-d.y)*a)},sync:function(){return this},toString:function(){return this.x+", "+this.y}};Ea.prototype=I([],{cull:function(a){if(this.allowCull){var d=a.x,b=a.y,e=a.x+a.w;a=a.y+a.h;for(var h=Infinity,j=0,g,i=this.length;i--;)if(g=this[i].x>=d&&this[i].x<=e&&this[i].y>=b&&this[i].y<=a){h=i<h?i:h;j=i>j?i:j}return this.slice(Fa(h-1,0),db(j+1,this.length))}return this},simplify:function(a){a=a||3;for(var d=new Ea(this.allowCull),
b=null,e=this.length;e--;){var h=this[e];if(include=!b||e===0||la(h.x-b.x)+la(h.y-b.y)>a){d.unshift(h);b=h}}return d}});pa.prototype=I(new V,{constructor:pa,pos:function(){return fb(this.mercX,this.mercY)},sync:function(a,d){var b;if(!(b=a.rpp)){b=a.zoom();b=ea/(256<<b)}b=b;if(d){this.mercX=this.x*b-Math.PI;this.mercY=Math.PI-this.y*b}else{this.x=Va(((this.mercX||0)+Math.PI)/b);this.y=Va((Math.PI-(this.mercY||0))/b)}return this}});qa.prototype={constructor:qa,buffer:function(a,d){return new qa(this.x-
a,this.y-(d||a),this.w+a*2,this.h+(d||a)*2)},center:function(){return new V(this.x+(this.w>>1),this.y+(this.h>>1))}};Hits=function(){return{diffHits:function(a,d){var b=[],e={},h;for(h=d.length;h--;)e[d[h].target.id]=true;for(h=a.length;h--;)e[a[h].target.id]||(b[b.length]=a[h]);return b},init:function(a,d,b,e,h){return{type:a,x:h.x,y:h.y,gridX:e.x|0,gridY:e.y|0,elements:[],absXY:d,relXY:b}},initHit:function(a,d,b){return{type:a,target:d,drag:b}},triggerEvent:function(a,d,b,e){d.triggerCustom(a.type+
(b?b:"Hit"),{hitType:a.type},e?e:a.elements,a.absXY,a.relXY,new pa(a.gridX,a.gridY))}}}();var pb=function(a){function d(j,g){var i=b[j],c;i||(i=b[j]=[]);(c=i[g])||(c=i[g]=[]);return c}a=a||128;var b=[],e={},h=0;return{copyInto:function(j){for(var g in e){var i=e[g];j.insert(i.bounds||i,i,g)}},insert:function(j,g,i){var c=j.x/a|0,m=j.y/a|0,k=(j.x+j.w)/a|0;j=(j.y+j.h)/a|0;i=i||g.id||"obj_"+h++;e[i]=g;for(g=c;g<=k;g++)for(c=m;c<=j;c++)d(g,c).push(i)},remove:function(j,g,i){i=i||g.id;if(e[i]){var c=j.x/
a|0;g=j.y/a|0;var m=(j.x+j.w)/a|0;j=(j.y+j.h)/a|0;delete e[i];for(c=c;c<=m;c++)for(var k=g;k<=j;k++){var f=d(c,k),n=bb.call(f,i);n>=0&&f.splice(n,1)}}},search:function(j){var g=j.y/a|0,i=(j.x+j.w)/a|0,c=(j.y+j.h)/a|0,m=[],k=[];for(j=j.x/a|0;j<=i;j++)for(var f=g;f<=c;f++)m=m.concat(d(j,f));m.sort();for(g=m.length;g--;){i=m[g];if(c=e[i])k[k.length]=c;for(;g>0&&m[g-1]==i;)g--}return k}}},Wa=function(){var a={},d=0;(new Date).getTime();var b={},e=[];Aa.attach(function(h){h=h||(new Date).getTime();for(var j=
0;j<e.length;){var g=e[j],i=b[g],c=b[g].image&&b[g].image.complete&&b[g].image.width>0,m=h-i.start;m=c||m>=3E4;if(c){c=i.callbacks;a[g]=i.image;for(var k=0;k<c.length;k++)c[k](i.image,true)}if(m){e.splice(j,1);delete b[g]}else j++}},250);return function(h,j){var g=h&&j?a[h]:null;if(g&&g&&g.complete&&g.width>0)j(g);else if(g=b[h])g.callbacks.push(j);else{g=new Image;g.id="_ldimg"+ ++d;b[h]={start:(new Date).getTime(),image:g,callbacks:[j]};g.src=h;e[e.length]=h}}}();ab.prototype={constructor:ab,load:function(a){var d=
this;Wa(this.url,function(b){d.loaded=true;d.image=b;a&&a()})}};var Lb=function(){return ra({fastpan:true,applyStyle:function(){},applyTransform:function(a,d,b){return{restore:null,x:d,y:b}},getDimensions:function(){return{width:0,height:0}},getViewport:function(){},hitTest:function(){return false},prepare:function(){},projectXY:null,reset:function(){}})};ia("renderer","canvas",function(a,d,b,e,h){function j(){function o(y,B){this.save();this.setTransform(1,0,0,1,0,0);var E=this.isPointInPath_old(y,
B);this.restore();return E}var u=CanvasRenderingContext2D.prototype,t=document.createElement("canvas").getContext("2d");t.translate(50,0);t.moveTo(125,50);t.arc(100,50,25,0,360,false);if(!t.isPointInPath(150,50)){u.isPointInPath_old=u.isPointInPath;u.isPointInPath=o}}function g(o,u,t){var y,B;q[u]=function(E){for(y=p.length;y--;)if(B=t[p[y]])E[w[y]]=B}}function i(o,u,t){return{draw:t||O,viewport:o,hit:u&&f.isPointInPath(u.x,u.y),vpX:n,vpY:l,context:f}}e=I({},e);var c,m,k,f,n=0,l=0,q={},v=null,A={},
K=function(){},O=function(){this.fill&&f.fill();this.stroke&&f.stroke()},p=["fill","stroke","lineWidth","opacity"],w=["fillStyle","strokeStyle","lineWidth","globalAlpha"];Q&&j();if(d){c=d.offsetWidth;m=d.offsetHeight;k=Q?Q.create("canvas",null,{position:"absolute","z-index":1}):new Canvas;k.width=c;k.height=m;a.attachFrame(k,true);f=null}b=I(h,{applyStyle:function(o){var u=q[o],t=f&&f.canvas?f.canvas.id:"default",y;A[t]||(A[t]=[]);y=A[t].pop()||"reset";if(u){A[t].push(o);u(f);return y}},applyTransform:function(o){if(o.translateX!==
0||o.translateY!==0||o.scaling!==1||o.rotation!==0){f.save();v={undo:function(){f.restore();v=null},x:o.xy.x,y:o.xy.y};f.translate(o.xy.x-n+o.translateX,o.xy.y-l+o.translateY);o.rotation!==0&&f.rotate(o.rotation);o.scaling!==1&&f.scale(o.scaling,o.scaling)}return v},drawTiles:function(o,u,t){for(var y=u.length;y--;){o=u[y];if(!o.loaded&&t)o.load(a.invalidate);else o.image&&f.drawImage(o.image,o.x-n,o.y-l)}},prepare:function(o,u){var t,y=false;if(f)f.restore();else if(k)f=k.getContext("2d");for(t=
o.length;t--;)y=y||o[t].clip;n=u.x;l=u.y;if(f){y||f.clearRect(0,0,c,m);f.save();f.globalCompositeOperation="source-over"}return f},prepArc:function(o,u,t){f.beginPath();f.arc(o.xy.x-(v?v.x:n),o.xy.y-(v?v.y:l),o.size>>1,o.startAngle,o.endAngle,false);return i(u,t)},prepImage:function(o,u,t,y){var B=(y.x||o.xy.x)-(v?v.x:n),E=(y.y||o.xy.y)-(v?v.y:l),M=y.image||o.image;if(M){f.beginPath();f.rect(B,E,y.width||M.width,y.height||M.height);return i(u,t,function(){f.drawImage(M,B,E,y.width||M.width,y.height||
M.height)})}},prepMarker:function(o,u,t){var y=o.xy.x-(v?v.x:n),B=o.xy.y-(v?v.y:l),E=o.size,M=undefined;f.beginPath();switch(o.markerType.toLowerCase()){case "image":M=K;f.rect(y-(E>>1),B-(E>>1),E,E);if(o.reset&&o.image){o.image=null;o.reset=false}o.image?f.drawImage(o.image,y-(E>>1),B-(E>>1),E,E):Wa(o.imageUrl,function(L){o.image=L;f.drawImage(o.image,y-(E>>1),B-(E>>1),E,E)});break;default:f.moveTo(y,B);f.lineTo(y-(E>>1),B-E);f.lineTo(y+(E>>1),B-E);f.lineTo(y,B)}return i(u,t,M)},prepPoly:function(o,
u,t,y){var B=true;o=y.points||o.points().cull(u);y=v?v.x:n;var E=v?v.y:l;f.beginPath();for(var M=o.length;M--;){var L=o[M].x-y,P=o[M].y-E;if(B){f.moveTo(L,P);B=false}else f.lineTo(L,P)}return i(u,t)},getContext:function(){return f}});(function(){tb.each(function(o,u){g(null,o,u)});Ga.bind("styleDefined",g)})();b.bind("detach",function(){d.removeChild(k)});b.bind("resize",function(){});return b});ia("renderer","dom",function(a,d,b,e,h){function j(k){var f=k.image=new Image;c[k.id]=k;f.src=k.url;f.onload=
function(){if(m[k.id])i.appendChild(this);else k.image=null};f.style.cssText="-webkit-user-select: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute;";return f}function g(k,
f,n){var l=[],q;for(q in k){var v=k[q];if(n?v[n]:!f[q]){if(v.image&&v.image.parentNode){i.removeChild(v.image);v.image=null}l[l.length]=q}}for(f=l.length;f--;)delete k[l[f]]}var i=null,c={},m={};i=Q.create("div","",Q.styles({width:d.offsetWidth+"px",height:d.offsetHeight+"px"}));d.childNodes.length>0?d.insertBefore(i,d.childNodes[0]):d.appendChild(i);a.attachFrame(i);b=I(h,{drawTiles:function(k,f,n){for(var l,q=k.x,v=k.y,A=f.length;A--;){k=f[A];if(k.url){(l=k.image||(n?j(k):null))&&Q.move(l,k.x-q,
k.y-v);m[k.id]=k}}}});b.bind("predraw",function(){g(c,m);m={}});b.bind("detach",function(){d.removeChild(i)});a.bind("reset",function(){for(g(c,m={});i.childNodes.length>0;)i.removeChild(i.childNodes[0])});return b});var tb=function(){function a(b,e){if(R(b,oa)){Ga.trigger("styleDefined",b,d[b]=e);return b}else{var h=[],j;for(j in b)h[h.length]=a(j,b[j]);return h}}var d={};a({reset:{fill:"#ffffff",opacity:1},highlight:{fill:"#ff0000"},waypoints:{lineWidth:4,stroke:"#003377",fill:"#ffffff"},waypointsHover:{lineWidth:4,
stroke:"#ff0000",fill:"#ffffff"}});return{resetStyle:"reset",each:function(b){for(var e in d)b(e,d[e])},get:function(b){return d[b]},define:a}}(),zb=function(a,d){function b(r,s,x,D){r=B?Fa(W+wa(2,D)-1,0.125):D>0?2:0.5;o(r,false,true)}function e(r,s){var x=X&&X.projectXY?X.projectXY(r,s):null;if(!x){x=O();var D=1/W;x=new J.XY(x?x.x+r*D:r,x?x.y+s*D:s)}return x.sync(J,true)}function h(r,s,x){u("doubleTap",s,x,e(x.x,x.y));d.scalable&&o(2,{easing:"quad.out",duration:300},true)}function j(r,s,x){T=null;
N=true;A("down",s,x)}function g(r,s,x){A("hover",s,x)}function i(r,s,x,D){l(s,x,false);if(!T){F=D.x;U=D.y}}function c(r,s,x){l(s,x,true);N=false}function m(){clearTimeout(ub);ub=setTimeout(function(){if(H)if(H.offsetWidth!==Ha*2||H.offsetHeight!==Ia*2){var r=K();v(a);K(r.x,r.y)}},250)}function k(r,s,x){A("tap",s,x);J.trigger("tap",s,x,e(x.x,x.y,true))}function f(){fa&&fa.unbind();if(Q&&X){fa=INTERACT.watch(X.interactTarget||H);if(d.scalable){fa.bind("zoom",b);fa.bind("doubleTap",h)}fa.bind("pointerDown",
j);fa.bind("pointerMove",i);fa.bind("pointerUp",c);d.captureHover&&fa.bind("pointerHover",g);fa.bind("tap",k)}}function n(r){if(X){X.trigger("detach");X=null}var s=J,x=z,D=H,Z=d;r=r.split("/");for(var $=new Lb(s,x,D,Z),ma=0;ma<r.length;ma++)$=za("renderer",r[ma],s,x,D,Z,$);X=$;C=Q&&X.fastpan&&Q.transforms;B=Q&&Q.transforms&&d.useTransforms;f();J.trigger("reset");w()}function l(r,s,x){if(T){r=e(s.x,s.y);T.drag.call(T.target,T,r.x,r.y,x)&&aa++;if(x)T=null}}function q(r){for(var s=P;s--;)if(L[s].id===
r)return s;return P}function v(r){if(Q){H=document.getElementById(r);H.appendChild(G=Q.create("div","",Q.styles({overflow:"hidden",width:H.offsetWidth+"px",height:H.offsetHeight+"px"})));r=d.padding;if(r===y){r=H.offsetWidth;var s=H.offsetHeight,x=cb(r*r+s*s);ga=new V(x-r>>1,x-s>>1)}else ga=new V(r,r);Xa=G.offsetWidth+ga.x*2;Ya=G.offsetHeight+ga.y*2;gb=Xa/2;hb=Ya/2;Ha=H.offsetWidth/2;Ia=H.offsetHeight/2;Ja=new V(gb,hb);G.appendChild(z=Q.create("div","",Q.styles({width:Xa+"px",height:Ya+"px","z-index":2,
margin:-ga.y+"px 0 0 "+-ga.x+"px"})));n(d.renderer);r=d.controls;for(s=0;s<M.length;s++)M[s].trigger("detach");M=[];for(s=0;s<r.length;s++)M[M.length]=za("control",r[s],J,G,H,d[r[s]])}else n("canvas")}function A(r,s,x){var D=(new V(x.x-Ha+gb,x.y-Ia+hb)).rotate(-ja*ka,Ja).scale(1/W,Ja);ca=Hits.init(r,s,x,e(x.x,x.y,true),D);for(r=P;r--;)if(L[r].visible)ha=ha||(L[r].hitGuess?L[r].hitGuess(ca.gridX,ca.gridY,J):false);ha&&aa++}function K(r,s,x){if(R(r,oa)||R(r,Hb)){s=new J.XY(r);s.sync(J);r=s.x;s=s.y}if(R(r,
ta)){t(r-Ha-ga.x,s-Ia-ga.y,x);return J}else return t().offset(Ha+ga.x|0,Ia+ga.y|0).sync(J,true)}function O(){var r=new qa(S,Y,Xa,Ya);r.scaleFactor=W;r.padding=ga?ga.copy():new V;return r}function p(r,s,x){if(R(r,oa)&&R(s,xa))for(s=0;s<P;s++){if(L[s].id===r)return L[s]}else if(R(r,oa)){s=za("layer",s,J,x);s.added=(new Date).getTime();s.id=r;L[q(r)]=s;L.sort(function(D,Z){return Z.zindex-D.zindex||Z.added-D.added});P=L.length;J.trigger("resync");w();J.trigger("layerChange",J,s);aa++;return s}else return[].concat(L)}
function w(){var r=O();if(r){if(Ba||Ca)if(r){var s=Za?S+(r.w>>1):S,x=$a?Y+(r.h>>1):Y,D=r.w,Z=r.h;if(Ba&&Ba>D)if(s+D>Ba)S=Za?S:Ba-D;else if(s<0)S=Za?S:0;if(Ca&&Ca>Z)if(x+Z>Ca)Y=$a?Y:Ca-Z;else if(x<0)Y=$a?Y:0}vb=S;wb=Y;J.trigger("refresh",J,r);aa++}}function o(r,s,x){if(R(r,ta)){var D=x?r:W*r;if(!Mb){s=null;r=Va(eb(D)/Math.LN2);D=wa(2,r)}if(s)Ka=na.tween([W],[D],s,function(){W=D;Ka=null;aa++});else{W=D;aa++}return J}else return W}function u(){for(var r=J.trigger.apply(null,arguments).cancel,s=L.length;s--;)r=
L[s].trigger.apply(null,arguments).cancel||r;return!r}function t(r,s,x){if(R(r,ta)){if(x)ua=na.tween([S,Y],[r,s],x,function(){ua=null});else{S=r|0;Y=s|0;aa++}return J}else return(new J.XY(S,Y)).sync(J,true)}d=I({captureHover:true,controls:[],drawOnScale:true,padding:128,inertia:true,refreshDistance:128,pannable:true,scalable:true,renderer:"canvas",useTransforms:true},d);var y="auto",B=true,E=false,M=[],L=[],P=0,z=null,G=null,H,T=null,ha=false,C,N=false,F=0,U=0,ba=d.refreshDistance,S=0,Y=0,La=0,Ma=
0,vb=0,wb=0,Ba=null,Ca=null,Za=false,$a=false,ua=null,ga,ca=null,Na=null,X,ub=0,Ja=new V,ja=0,Oa=null,W=1,Ka=null,ib=1,fa=null,jb={index:0,draw:false},Mb=true,aa=0,Xa,Ya,gb,hb,Ha,Ia,J={XY:V,id:d.id,panSpeed:0,attachFrame:function(r,s){s&&z.appendChild(r)},center:K,detach:function(){X&&X.trigger("detach");fa&&fa.unbind();if(G){H.removeChild(G);z=G=null}},frozen:function(r){if(R(r,xa))return E;else{E=r;return J}},layer:p,invalidate:function(){aa++},pan:function(r,s,x){t(S+r,Y+s,x)},refresh:w,rotate:function(r,
s,x){if(R(r,ta)){var D=x?r:ja+r;if(s)Oa=na.tween([ja],[D],s,function(){ja=D%360;Oa=null;aa++});else{ja=D%360;aa++}return J}else return ja},scale:o,triggerAll:u,setMaxOffset:function(r,s,x,D){Ba=r;Ca=s;Za=x;$a=D},offset:t,viewport:O};ra(J);J.bind("resize",m);J.bind("layerRemove",function(r,s){var x=bb(L,s.id);if(x>=0&&x<P){L.splice(x,1);aa++}P=L.length});qb(J,d,{container:v,captureHover:f,scalable:f,pannable:f,renderer:n});p("markers","draw",{zindex:20});v(a);if(Q&&!R(window.attachEvent,xa))window.attachEvent("onresize",
m);else Q&&window.addEventListener("resize",m,false);Aa.attach(function(r){var s=[],x,D,Z;if(!E){J.panSpeed=panSpeed=la(F)+la(U);(x=W!==ib)&&J.trigger("scale");if(panSpeed>0||x||ua||Ka||Oa){aa++;if(ua&&panSpeed>0){ua(true);ua=null}}if(panSpeed<2&&(la(S-vb)>=ba||la(Y-wb)>=ba))w();jb.index++;jb.draw=aa||panSpeed||0;if(X&&jb.draw){if(Ka)W=Ka()[0];if(Oa)ja=Oa()[0];La+=F;Ma+=U;if(F||U)J.trigger("pan");if(B){if(W!==1)s[s.length]="scale("+W+")";if(ja!==0)s[s.length]="rotate("+ja+"deg)"}if(x=!C||(d.drawOnScale||
W===1)&&panSpeed<5){if(ua){x=ua();S=x[0]|0;Y=x[1]|0}else{D=-ja*ka;x=sa(D)*La+-da(D)*Ma;D=da(D)*La+sa(D)*Ma;S=S-x/W|0;Y=Y-D/W|0}Z=O();X.trigger("predraw",Z);if(X.prepare(L,Z,r,ca)){D=Ma=x=La=aa=0;for(ii=P;ii--;){var $=L[ii];if($.visible){var ma=$.style?X.applyStyle($.style,true):null;$.draw(X,Z,J,r,ca);ma&&X.applyStyle(ma)}}X.trigger("render",Z);J.trigger("drawComplete",Z,r);Q.move(z,x,D,s,Ja)}}else Q.move(z,La,Ma,s,Ja);if(N||!d.inertia)U=F=0;else if(F!=0||U!=0){F*=0.8;U*=0.8;if(la(F)<0.5)F=0;if(la(U)<
0.5)U=0}if(ca){r=true;s=ca?ca.elements:[];if(Na&&Na.type==="hover"){diffElements=Hits.diffHits(Na.elements,s);if(diffElements.length>0)Hits.triggerEvent(Na,J,"Out",diffElements);else r=false}if(s.length>0){D=ca.gridX;Z=ca.gridY;for(x=s.length;x--;){$=s[x];ma=D;var xb=Z,yb=$&&$.drag&&(!$.canDrag||$.canDrag($,ma,xb));if(yb){T=$;T.startX=ma;T.startY=xb}if(yb)break}r&&Hits.triggerEvent(ca,J)}Na=s.length>0?I({},ca):null;ca=null}if(ib!==W){J.trigger("scaleChanged",W);ib=W}}}});return J},na=function(){return{tween:function(a,
d,b,e,h){function j(q){var v=q-l;q=l+n<=q;for(var A=g;A--;)i[A]=m(v,a[A],k[A],n);h&&h.invalidate();if(q||f){Aa.detach(j);for(A=0;A<c.length;A++)c[A]&&c[A](i,v,f)}}b=I({easing:"sine.out",duration:1E3,complete:null},b);var g=a.length,i=[].concat(a),c=[e,b.complete],m=Db(b.easing),k=[],f=false,n=b.duration,l=(new Date).getTime();for(b=g;b--;)k[b]=d[b]-a[b];Aa.attach(j);return function(q){f=q;return i}},tweenDrawable:function(a,d,b,e,h){var j=na.tween([b],[e],h,function(){a[d]=e;for(var i=a.tweens.length;i--;)if(a.tweens[i]===
g){a.tweens.splice(i,1);break}},a.view),g=function(){a[d]=j()[0]};return g}}}(),ya=function(a,d,b){b=I({style:null,xy:null,size:20,fill:false,stroke:true,draggable:false,observable:true,properties:{},typeName:"Shape",zindex:0},b);I(this,b);if(R(this.xy,oa))this.xy=new a.XY(this.xy);this.id="drawable_"+Kb++;this.bounds=null;this.view=a;this.layer=d;this.tweens=[];this.rotation=this.animations=0;this.scaling=1;this.translateY=this.translateX=0;this.observable&&ra(this)};ya.prototype={constructor:ya,
applyTweens:function(){for(var a=this.tweens.length;a--;)this.tweens[a]()},drag:null,draw:null,getProps:null,resync:function(){if(this.xy){this.xy.sync(this.view);if(this.size){var a=this.size>>1;this.updateBounds(new qa(this.xy.x-a,this.xy.y-a,this.size,this.size))}}},rotate:function(a,d,b){if(R(a,ta)){a=(b?a:this.rotation*Ua+a)*ka;if(d)this.tweens.push(na.tweenDrawable(this,"rotation",this.rotation,a,d));else{this.rotation=a;this.view.invalidate()}return this}else return this.rotation*Ua},scale:function(a,
d,b){if(R(a,ta)){a=b?a:this.scaling*a;if(d)this.tweens.push(na.tweenDrawable(this,"scaling",this.scaling,a,d));else{this.scaling=a;this.view.invalidate()}return this}else return this.scaling},translate:function(a,d,b,e){if(R(a,ta)){a=e?a:this.translateX+a;d=e?d:this.translateY+d;if(b){this.tweens.push(na.tweenDrawable(this,"translateX",this.translateX,a,b));this.tweens.push(na.tweenDrawable(this,"translateY",this.translateY,d,b))}else{this.translateX=a;this.translateY=d;this.view.invalidate()}return this}else return new V(this.translateX,
this.translateY)},updateBounds:function(a,d){a&&(!this.bounds||a.x!=this.bounds.x||a.y!=this.bounds.y)&&this.trigger("move",this,a,this.bounds);this.bounds=a;if(d)this.xy=this.bounds.center()}};ia("drawable","marker",function(a,d,b){b=I({fill:true,stroke:false,markerType:"simple",hoverStyle:"highlight",typeName:"Marker"},b);return new ya(a,d,b)});ia("drawable","poly",function(a,d,b){function e(){var k,f,n,l,q,v,A;c=b.simplify?i.simplify():i;for(k=c.length;k--;){f=c[k].x;n=c[k].y;v=R(v,xa)||f<v?f:
v;A=R(A,xa)||n<A?n:A;l=R(l,xa)||f>l?f:l;q=R(q,xa)||n>q?n:q}m.updateBounds(new qa(v,A,l-v,q-A),true);a.invalidate()}function h(k){if(R(k,Ib)){i=new Ea(b.allowCull);sb.process(k,function(f,n){for(var l=0;l<n;l++)i.push(new a.XY(f[l]))},j,g);return m}else return c}function j(){i.length&&sb.process(i,function(k,f){for(var n=f;n--;)k[n].sync(a)},e,g)}b=I({allowCull:false,simplify:false,fill:true,points:[],typeName:"Poly"},b);var g=500,i=new Ea(b.allowCull),c,m=I(new ya(a,d,b),{points:h,resync:j});h(b.points);
return m});ia("drawable","line",function(a,d,b){b.fill=false;b.allowCull=true;return za("drawable","poly",a,d,b)});ia("drawable","image",function(a,d,b){function e(){if(c&&c.width>0){if(!this.centerOffset)this.centerOffset=new V(-c.width>>1,-c.height>>1);this.updateBounds(new qa(this.xy.x+this.centerOffset.x,this.xy.y+this.centerOffset.y,c.width,c.height),false)}}function h(k){if(this.imageUrl=k){var f=this;Wa(this.imageUrl,function(n,l){c=n;if(l){var q=m.layer?m.layer.view:null;q&&q.invalidate()}e.apply(f)})}}
b=I({image:null,imageUrl:null,centerOffset:null,typeName:"Image"},b);var j=ya.prototype.resync,g=0,i=0,c=b.image,m=I(new ya(a,d,b),{changeImage:h,getProps:function(){this.bounds||e(this,c);return{image:c,x:this.xy.x+g,y:this.xy.y+i}},resync:function(k){j.call(this,k);e.call(this)}});c||h.call(this,this.imageUrl);if(this.centerOffset){g=this.centerOffset.x;i=this.centerOffset.y}});ia("drawable","arc",function(a,d,b){b=I({startAngle:0,endAngle:Math.PI*2,typeName:"Arc"},b);return new ya(a,d,b)});Ra.prototype=
{constructor:Ra,clip:null,cycle:function(){},draw:function(){},hitGuess:null,remove:function(){this.view.trigger("layerRemove",this)}};ia("layer","tile",function(a,d){d=I({generator:"osm",imageLoadArgs:{}},d);var b=za("generator",d.generator,d).run,e=null,h=[],j=I(new Ra(a,d),{draw:function(g,i,c){g.drawTiles&&g.drawTiles(i,e.search(i.buffer(128)),c.panSpeed<2)}});a.bind("resync",function(){var g=a&&a.zoom?a.zoom():0;h[g]||(h[g]=ob(g));e=h[g]});a.bind("refresh",function(g,i,c){e&&b(i,c,e,function(){i.invalidate()})});
return j});ia("layer","draw",function(a,d){function b(i,c,m,k){var f=this.dragOffset;if(!f)f=this.dragOffset=new a.XY(i.startX-this.xy.x,i.startY-this.xy.y);this.xy.x=c-f.x;this.xy.y=m-f.y;if(k){delete this.dragOffset;a.invalidate();this.xy.sync(a,true);this.trigger("dragDrop")}return true}function e(i,c,m,k){k&&j.remove(k,c);j.insert(m,c)}d=I({zindex:10},d);var h=[],j,g=I(new Ra(a,d),{itemCount:0,clear:function(){j=new pb;h=[];g.trigger("cleared");g.itemCount=0;a.invalidate()},create:function(i,
c,m){c=za("drawable",i,a,g,c);if(m)h.unshift(c);else h[h.length]=c;c.resync();j&&c.bounds&&j.insert(c.bounds,c);c.bind("move",e);g.itemCount=h.length;g.trigger(i+"Added",c);return c},draw:function(i,c,m,k,f){m={};k=j&&c?j.search(c):[];for(var n=k.length;n--;){var l=k[n],q=l.style||g.style,v,A,K=l.getProps?l.getProps(i):m;v=i["prep"+l.typeName];l.tweens.length>0&&l.applyTweens();A=i.applyTransform(l);if(K=v?v.call(i,l,c,f,K):null){if(f&&K.hit){f.elements.push(Hits.initHit(l.type,l,l.draggable?b:null));
v=f.type+"Style";q=l[v]||g[v]||q}q=q?i.applyStyle(q,true):null;(v=l.draw||K.draw)&&v.call(l,K);q&&i.applyStyle(q)}A&&A.undo&&A.undo()}},find:function(){return[].concat(h)},hitGuess:function(i,c){return j&&j.search({x:i-10,y:c-10,w:20,h:20}).length>0}});a.bind("resync",function(){j=ob(a.zoom(),j);for(var i=h.length;i--;)h[i].resync()});return g});Sa.prototype={constructor:Sa};ia("control","zoombar",function(a,d,b,e){function h(t,y){var B=p[t]=Q.create("div","t5-zoombar-button",{position:"absolute",
background:j(t),"z-index":51,width:e.width+"px",height:e.buttonHeight+"px","margin-top":(y||0)+"px"});w.appendChild(B)}function j(t,y){return"url("+e.images+") 0 -"+(f+l*3+(t||0)*m*3+(y||0)*m)+"px"}function g(t){return"url("+e.images+") 0 -"+(f+(t||0)*l)+"px"}function i(t,y){var B;if(t===n){n.style.background=g(y);B="thumb"}else for(var E=0;E<p.length;E++)if(t===p[E]){B="button"+E;p[E].style.background=j(E,y);break}return B}function c(t){if(t!==K){K=t;A=v-K/O*(v-q)|0;Q.move(n,0,A-q);clearTimeout(o);
o=setTimeout(function(){a.zoom(K)},500)}}e=I({width:24,height:200,images:"img/zoom.png",align:"right",marginTop:10,spacing:10,thumbHeight:16,buttonHeight:16},e);var m=e.buttonHeight,k,f=e.height,n,l=e.thumbHeight,q=e.spacing+m-(l>>1),v=e.height-m-(l>>1),A=q,K=-1;d=a.minZoom();var O=a.maxZoom()-d+1,p=[],w,o=0,u={button0:function(){a.zoom(a.zoom()+1)},button1:function(){a.zoom(a.zoom()-1)}};w=Q.create("div","t5-zoombar",{position:"absolute",background:"url("+e.images+")","z-index":50,overflow:"hidden",
width:e.width+"px",height:e.height+"px",margin:function(){var t=e.spacing,y=Da("{0}px 0 0 {1}px");if(e.align==="right")t=b.offsetWidth-e.width-e.spacing;return y(e.marginTop,t)}()});b.childNodes[0]?b.insertBefore(w,b.childNodes[0]):b.appendChild(w);w.appendChild(n=Q.create("div","t5-zoombar-thumb",{position:"absolute",background:g(),"z-index":51,width:e.width+"px",height:e.thumbHeight+"px",margin:"10px 0 0 0",top:A-q+"px"}));h(0);h(1,e.height-e.buttonHeight);k=INTERACT.watch(w,{bindTarget:w});k.bind("pointerMove",
function(t,y,B){A=Math.min(Math.max(q,B.y-(l>>1)),v);c(O-(A-q)/v*O|0)});k.bind("pointerDown",function(t){i(t.target,2)});k.bind("pointerUp",function(t){i(t.target,0)});k.bind("tap",function(t){(t=u[i(t.target,2)])&&t()});d=new Sa(a);d.bind("detach",function(){k.unbind();b.removeChild(w)});a.bind("zoom",function(t,y){c(y)});c(a.zoom());return d});I(Ga,{ex:I,log:va,observable:ra,configurable:qb,formatter:Da,wordExists:function(a,d){for(var b=a.split(/\s|\,/).length;b--;)if(a.toLowerCase()==d.toLowerCase())return true;
return false},is:R,indexOf:bb,fn:function(a){return Jb("fn",a)},project:Qa,unproject:fb,getImage:Wa,userMessage:function(a,d,b){Ga.trigger("userMessage",a,d,b)},Registry:Ta,Style:tb,DOM:Q,Rect:qa,XY:V,Line:Ea,Hits:Hits,Control:Sa,Tile:ab,Tweener:na,View:zb,Map:function(a,d){function b(m,k){var f=c.viewport();if(m){f=Fa(m.bestZoomLevel(f.w,f.h),k||0);return e(f).center(m.center())}else return new GeoJS.BBox((new pa(f.x,f.y2)).sync(c,true).pos(),(new pa(f.x2,f.y)).sync(c,true).pos())}function e(m,k,
f){if(R(m,ta)){m=Fa(d.minZoom,db(d.maxZoom,m|0));if(m!==g){var n=c.viewport(),l=c.offset(),q=n.w/2;n=n.h/2;var v=wa(2,m-g),A=q/v|0,K=n/v|0;g=m;c.offset(((k||l.x+q)-A)*v,((f||l.y+n)-K)*v);refreshY=refreshX=0;c.trigger("zoom",m);c.trigger("reset");j=c.rpp=ea/(256<<g);c.setMaxOffset(ea/j|0,ea/j|0,true,false);c.scale(1,false,true);c.trigger("resync");c.refresh()}return c}else return g}d=I({controls:["zoombar"],minZoom:1,maxZoom:18,renderer:"canvas/dom",zoom:1,zoombar:{}},d);var h=new pa,j,g=d.zoom||d.zoomLevel,
i=0,c=I(new zb(a,d),{XY:pa,bounds:b,zoom:e});j=c.rpp=ea/(256<<g);c.bind("refresh",function(){var m=c.viewport();if(h.x!=m.x||h.y!=m.y){c.trigger("boundsChange",b());h.x=m.x;h.y=m.y}});c.bind("scaleChanged",function(m,k){var f=eb(k)/Math.LN2|0;if(f!==0){k=wa(2,f);clearTimeout(i);i=setTimeout(function(){e(g+f)},500)}});return c}});if(typeof module!="undefined"&&module.exports)module.exports=Ga})();
