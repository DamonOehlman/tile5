(function(rb){function C(){var a=arguments[0]||{},c=Array.prototype.slice.call(arguments,1),b=c.length,e,g;for(g=0;g<b;g++)if((e=c[g])!==null)for(var i in e){var h=e[i];if(a!==h)if(h!==undefined)a[i]=h}return a}function ra(a,c){if(typeof console!=="undefined")console[c||"debug"](a)}function Ha(a){var c=a.match(Kb),b=[],e=0,g;for(g=c?c.length:0;g--;){var i=c[g].slice(1);b[i]||(b[i]=RegExp("\\{"+i+"\\}","g"))}e=b.length;return function(){var h=a;for(g=0;g<e;g++){var j=arguments[g];if(typeof j=="undefined")j=
"";h=h.replace(b[g],j)}return h}}function sb(a,c){var b=Ta*ha(a);return Ua-2*tb(c*ya((1-b)/(1+b),Ta/2))}function T(a,c){if(L(a,ma)){var b=a.split(eb);this.x=parseFloat(b[0]);this.y=parseFloat(b[1])}else if(a&&a.x){this.x=a.x;this.y=a.y}else{this.x=a||0;this.y=c||0}}function Ia(a){this.allowCull=a}function sa(a,c,b,e){this.mercX=b;this.mercY=e;if(L(a,ma))C(this,Lb.parseXY(a));else a&&a.toPixels?C(this,a.toPixels()):T.call(this,a,c)}function ta(a,c,b,e){this.x=a||0;this.y=c||0;this.w=b||0;this.h=e||
0;this.x2=this.x+this.w;this.y2=this.y+this.h}function ub(a,c){var b=new vb(Math.sqrt(256<<a)|0);c&&c.zoomLevel===a&&c.copyInto(b);b.zoomLevel=a;return b}function fb(a,c,b,e,g,i){this.x=a;this.y=c;this.w=e||256;this.h=e||256;this.x2=this.x+this.w;this.y2=this.y+this.h;this.url=b;this.id=i||a+"_"+c;this.loaded=false;this.image=null}function Va(a,c){c=C({id:"layer_"+Mb++,zindex:0,animated:false,style:null,minXY:null,maxXY:null,visible:true},c);this.visible=c.visible;this.view=a;ua(C(this,c))}function Wa(){ua(this)}
function ia(a,c){if(a&&a.split){var b=a.split(eb);if(b.length>1){a=b[0];c=b[1]}}else if(a&&a.lat){c=a.lon;a=a.lat}this.lat=parseFloat(a||0);this.lon=parseFloat(c||0)}function Ja(a,c){if(L(a,wb)){for(var b=c,e=new ia(gb,Xa),g=new ia(Nb,xb),i=a.length;i--;){var h=a[i];if(h.lat<e.lat)e.lat=h.lat;if(h.lat>g.lat)g.lat=h.lat;if(h.lon<e.lon)e.lon=h.lon;if(h.lon>g.lon)g.lon=h.lon}this.min=e;this.max=g;if(L(b,va)){b=this.size();b=Ba(b.x,b.y)*0.3}this.expand(b)}else{this.min=a;this.max=c}}function hb(a){if(!L(a,
ma))this.meters=a}var Kb=/\{(\d+)(?=\})/g,Ob=function(){var a=1.70158,c=Math.PI/2,b=Math.abs,e=Math.pow,g=Math.sin,i=Math.asin,h=Math.cos,j={linear:function(f,m,d,l){return d*f/l+m},backin:function(f,m,d,l){return d*(f/=l)*f*((a+1)*f-a)+m},backout:function(f,m,d,l){return d*((f=f/l-1)*f*((a+1)*f+a)+1)+m},backinout:function(f,m,d,l){return(f/=l/2)<1?d/2*f*f*(((a*=1.525)+1)*f-a)+m:d/2*((f-=2)*f*(((a*=1.525)+1)*f+a)+2)+m},bouncein:function(f,m,d,l){return d-j.bounceout(l-f,0,d,l)+m},bounceout:function(f,
m,d,l){return(f/=l)<1/2.75?d*7.5625*f*f+m:f<2/2.75?d*(7.5625*(f-=1.5/2.75)*f+0.75)+m:f<2.5/2.75?d*(7.5625*(f-=2.25/2.75)*f+0.9375)+m:d*(7.5625*(f-=2.625/2.75)*f+0.984375)+m},bounceinout:function(f,m,d,l){return f<l/2?j.bouncein(f*2,0,d,l)/2+m:j.bounceout(f*2-l,0,d,l)/2+d/2+m},cubicin:function(f,m,d,l){return d*(f/=l)*f*f+m},cubicout:function(f,m,d,l){return d*((f=f/l-1)*f*f+1)+m},cubicinout:function(f,m,d,l){if((f/=l/2)<1)return d/2*f*f*f+m;return d/2*((f-=2)*f*f+2)+m},elasticin:function(f,m,d,l,
k,n){if(f==0)return m;if((f/=l)==1)return m+d;n||(n=l*0.3);if(!k||k<b(d)){k=d;d=n/4}else d=n/Z*i(d/k);return-(k*e(2,10*(f-=1))*g((f*l-d)*Z/n))+m},elasticout:function(f,m,d,l,k,n){var o;if(f==0)return m;if((f/=l)==1)return m+d;n||(n=l*0.3);if(!k||k<b(d)){k=d;o=n/4}else o=n/Z*i(d/k);return k*e(2,-10*f)*g((f*l-o)*Z/n)+d+m},elasticinout:function(f,m,d,l,k,n){var o;if(f==0)return m;if((f/=l/2)==2)return m+d;n||(n=l*0.3*1.5);if(!k||k<b(d)){k=d;o=n/4}else o=n/Z*i(d/k);if(f<1)return-0.5*k*e(2,10*(f-=1))*
g((f*l-o)*Z/n)+m;return k*e(2,-10*(f-=1))*g((f*l-o)*Z/n)*0.5+d+m},quadin:function(f,m,d,l){return d*(f/=l)*f+m},quadout:function(f,m,d,l){return-d*(f/=l)*(f-2)+m},quadinout:function(f,m,d,l){if((f/=l/2)<1)return d/2*f*f+m;return-d/2*(--f*(f-2)-1)+m},sinein:function(f,m,d,l){return-d*h(f/l*c)+d+m},sineout:function(f,m,d,l){return d*g(f/l*c)+m},sineinout:function(f,m,d,l){return-d/2*(h(Math.PI*f/l)-1)+m}};return function(f){f=f.replace(/[\-\_\s\.]/g,"").toLowerCase();return j[f]||j.linear}}(),ua=function(){function a(b,
e){var g=b.hasOwnProperty("obsHandlers")?b.obsHandlers:null;g[e]||(g[e]=[]);return g[e]}var c=0;return function(b){if(!b)return null;if(!(b.hasOwnProperty("obsHandlers")?b.obsHandlers:null))b.obsHandlers={};if(!b.hasOwnProperty("bind")){b.bind=function(e,g){var i="callback"+c++;a(b,e).unshift({fn:g,id:i});return i};b.triggerCustom=function(e,g){var i=a(b,e),h={cancel:false,name:e,source:this},j;for(j in g)h[j]=g[j];if(!i)return null;j=Array.prototype.slice.call(arguments,2);b.eventInterceptor&&b.eventInterceptor(e,
h,j);j.unshift(h);for(var f=i.length;f--&&!h.cancel;)i[f].fn.apply(this,j);return h};b.trigger=function(e){var g=Array.prototype.slice.call(arguments,1);g.splice(0,0,e,null);return b.triggerCustom.apply(this,g)};b.unbind=function(e,g){if(typeof e==="undefined")b.obsHandlers={};else for(var i=a(b,e),h=0;i&&h<i.length;h++)if(i[h].id===g){i.splice(h,1);break}return b}}return b}}(),yb=function(){function a(c,b,e,g){if(typeof c[g]=="undefined")c[g]=function(i){if(typeof i!="undefined"){b[g]=i;e[g]&&e[g](i);
return c}else return b[g]}}return function(c,b,e){b=b||c;for(var g in b)typeof b[g]!="function"&&a(c,b,e,g);return c}}(),ib=Array.prototype.indexOf||function(a){for(var c=0;c<this.length;c++)if(this[c]===a)return c;return-1},L=function(){var a={NaN:1,Infinity:1,"-Infinity":1},c=String.prototype.toLowerCase,b=Object.prototype.toString;return function(e,g){g=c.call(g);if(g=="finite")return!a.hasOwnProperty(+e);return g=="null"&&e===null||g==typeof e||g=="object"&&e===Object(e)||g=="array"&&Array.isArray&&
Array.isArray(e)||b.call(e).slice(8,-1).toLowerCase()==g}}();(function(){function a(g){var i=document.createElement("script"),h=false;i.src=g;i.async=true;i.onload=i.onreadystatechange=function(){if(!h&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){h=true;i.onload=i.onreadystatechange=null;i&&i.parentNode&&i.parentNode.removeChild(i)}};b||(b=document.getElementsByTagName("head")[0]);b.appendChild(i)}var c=0,b,e=this;return function(g,i,h){g+=g.indexOf("?")>=0?"&":"?";
var j="json"+ ++c;e[j]=function(f){i(f);e[j]=null;try{delete e[j]}catch(m){}};a(g+(h?h:"callback")+"="+j);return j}})();INTERACT=function(){function a(k){return function(n,o){k.addEventListener(n,o,false)}}function c(k){return function(n,o){k.removeEventListener(n,o,false)}}function b(k){return function(n,o){k.attachEvent("on"+n,o)}}function e(k,n){return{x:k?k:0,y:n?n:0,count:1}}function g(k,n){d.push(C({handler:null,checks:{},type:k},n))}function i(k){var n=0,o=0;if(k.offsetParent){do{n+=k.offsetLeft;
o+=k.offsetTop;k=k.offsetParent}while(k)}return{left:n,top:o}}function h(k,n){return{source:k,target:n.target?n.target:n.srcElement}}function j(k,n){for(var o=k.target?k.target:k.srcElement;o&&o!==n;)o=o.parentNode;return o&&o===n}function f(k,n){return{x:k.x-(n?n.left:0),y:k.y-(n?n.top:0)}}function m(k,n){if(k.preventDefault){k.preventDefault();k.stopPropagation()}else if(typeof k.cancelBubble!="undefined")k.cancelBubble=true;n&&k.stopImmediatePropagation&&k.stopImmediatePropagation()}var d=[],l=
function(k,n,o){o=C({binder:null,unbinder:null,observable:null},o);for(var v=o.observable,w=[],E,N,M={bind:function(){return v.bind.apply(null,arguments)},unbind:function(){v.unbind();for(r=0;r<w.length;r++)w[r].unbind();return M}},r=0;r<n.length;r++)w.push(n[r](k,v,o));v.bind("pointerDown",function(){N=E=0});v.bind("pointerMove",function(z,B,u,A){E+=A.x||0;N+=A.y||0});v.bind("pointerUp",function(z,B,u){Math.abs(E)>20||Math.abs(N)>20||v.triggerCustom("tap",z,B,u)});return M};g("pointer",{handler:function(k,
n,o){function v(s){if(s.pageX&&s.pageY)return e(s.pageX,s.pageY);else{var J=document.documentElement,P=document.body;return e(s.clientX+(J&&J.scrollLeft||P&&P.scrollLeft||0)-(J&&J.clientLeft||P&&P.clientLeft||0),s.clientY+(J&&J.scrollTop||P&&P.scrollTop||0)-(J&&J.clientTop||P&&P.clientTop||0))}}function w(s){if(j(s,k))if(A=r(s)){var J=v(s);k.style.cursor="move";m(s,true);S=J.x;K=J.y;x=e(S,K);n.triggerCustom("pointerDown",h("mouse",s),x,f(x,i(k)))}}function E(s){var J=v(s);F=J.x;R=J.y;if(j(s,k))z(s,
A?"pointerMove":"pointerHover")}function N(s){if(A&&r(s)){A=false;if(j(s,k)){k.style.cursor="default";z(s,"pointerUp")}}}function M(s){if(j(s,k)){var J;s=s||window.event;if(s.detail){if(typeof s.axis=="undefined"||s.axis===2)J=-s.detail*B}else{J=s.wheelDeltaY?s.wheelDeltaY:s.wheelDelta;if(window.opera)J=-J}if(J){var P=e(F,R);n.triggerCustom("zoom",h("mouse",s),P,f(P,i(k)),J/u,"wheel");m(s);s.returnValue=false}}}function r(s){s=s||window.event;return(s.which||s.button)==1}function z(s,J,P,ca,ja){P=
typeof P!="undefined"?P:F;ca=typeof ca!="undefined"?ca:R;var y=P-S,D=ca-K,H=e(P,ca);n.triggerCustom(J,h("mouse",s),H,f(H,i(k)),e(y,D));if(typeof ja=="undefined"||ja){S=P;K=ca}}o=C({},o);var B=120,u=B*8,A=false,x,F,R,S,K;o.binder("mousedown",w);o.binder("mousemove",E);o.binder("mouseup",N);o.binder("dblclick",function(s){ra("captured double click");if(j(s,k)){var J=v(s);n.triggerCustom("doubleTap",h("mouse",s),J,f(J,i(k)))}});o.binder("mousewheel",M);o.binder("DOMMouseScroll",M);return{unbind:function(){o.unbinder("mousedown",
w);o.unbinder("mousemove",E);o.unbinder("mouseup",N);o.unbinder("mousewheel",M);o.unbinder("DOMMouseScroll",M)}}},checks:{touch:false}});g("pointer",{handler:function(k,n,o){function v(y){if(y.count<2)return 0;var D=y.x-y.next.x;y=y.y-y.next.y;return~~Math.sqrt(D*D+y*y)}function w(y,D,H){D=D?D:0;H=H?H:0;for(var O={x:y.x-D,y:y.y-H,id:y.id,count:y.count},Q=O;y.next;){y=y.next;Q=Q.next={x:y.x-D,y:y.y-H,id:y.id}}return O}function E(y,D){var H=y[D?D:"touches"],O,Q;if(H.length===0)return null;Q=O={x:H[0].pageX,
y:H[0].pageY,id:H[0].identifier,count:H.length};for(var $=1,Ca=H.length;$<Ca;$++)Q=Q.next={x:H[$].pageX,y:H[$].pageY,id:H[$].identifier};return O}function N(y){if(j(y,k)){R=i(k);var D=E(y,"changedTouches"),H=w(D,R.left,R.top);if(!K){S=A;n.triggerCustom("pointerDown",h("touch",y),D,H)}ca&&n.triggerCustom("pointerDownMulti",h("touch",y),D,H);K=E(y);if(K.count>1)J=v(K);ja=1;P=w(K)}}function M(y){if(j(y,k)){m(y);s=E(y);if(S==A)S=Math.abs(K.x-s.x)>B||Math.abs(K.y-s.y)>B?u:A;if(S!=A){S=s.count>1?F:x;if(S==
F)if(K.count===1){K=w(s);J=v(K)}else{var D=v(s);if(Math.abs(J-D)<z)S=x;else{var H;H=s.x;var O=s.next.x,Q=s.y,$=s.next.y;H={x:(H<O?H:O)+(Math.abs(H-O)>>1),y:(Q<$?Q:$)+(Math.abs(Q-$)>>1)};D=D/J;O=D-ja;n.triggerCustom("zoom",h("touch",y),H,f(H,R),O,"pinch");ja=D}}S==x&&n.triggerCustom("pointerMove",h("touch",y),s,w(s,R.left,R.top),e(s.x-P.x,s.y-P.y));ca&&n.triggerCustom("pointerMoveMulti",h("touch",y),s,w(s,R.left,R.top))}P=w(s)}}function r(y){if(j(y,k)){var D=E(y,"changedTouches"),H=w(D,R.left,R.top);
s=E(y);if(!s){n.triggerCustom("pointerUp",h("touch",y),D,H);K=null}ca&&n.triggerCustom("pointerUpMulti",h("touch",y),D,H)}}o=C({detailed:false,inertia:false},o);var z=20,B=7,u=0,A=1,x=2,F=3,R,S,K,s,J,P,ca=o.detailed,ja=1;o.binder("touchstart",N);o.binder("touchmove",M);o.binder("touchend",r);ra("initialized touch handler");return{unbind:function(){o.unbinder("touchstart",N);o.unbinder("touchmove",M);o.unbinder("touchend",r)}}},checks:{touch:true}});return{register:g,watch:function(k,n,o){n=C({bindTarget:null,
observable:null,isIE:typeof window.attachEvent!="undefined",types:null},n);capabilities=C({touch:"ontouchstart"in window},o);if(!n.observable){ra("creating observable");n.observable=ua({});globalOpts=n}n.binder=(n.isIE?b:a)(n.bindTarget||document);n.unbinder=(n.isIE?b:c)(n.bindTarget||document);o=n.types;for(var v=capabilities,w=[],E=d.length;E--;){var N=d[E],M=!o||o.indexOf(N.type)>=0,r=true,z;for(z in N.checks){var B=N.checks[z];ra("checking "+z+" capability. require: "+B+", capability = "+v[z]);
r=r&&B===v[z]}if(M&&r)w[w.length]=N.handler}return new l(k,w,n)}}}();var Ka=ua({}),Ya=function(){var a={};return{create:function(c,b){if(a[c][b])return a[c][b].apply(null,Array.prototype.slice.call(arguments,2));throw Pb(c,b);},get:function(c,b){return a[c]?a[c][b]:null},register:function(c,b,e){a[c]||(a[c]={});a[c][b]&&ra(Qb(c,b),"warn");a[c][b]=e}}}(),Qb=Ha("Registration of {0}: {1} will override existing definition"),Pb=Ha("Could not create {0} of type: {1}");Ha("Could not create drawable of type: {0}");
var jb=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],Z=Math.PI*2,Ua=Math.PI/2,aa=Math.PI/180,ka=180/Math.PI,gb=90,Nb=-gb,Xa=180,xb=-Xa,kb=gb*aa,zb=-kb,Ab=Xa*aa,Rb=-Ab,Ta=0.08181919084262157,la=Math.abs,Bb=Math.ceil,La=Math.round,Ma=Math.min,Ba=Math.max,ya=Math.pow,lb=Math.sqrt,za=Math.log,ha=Math.sin,Cb=Math.asin,Da=Math.cos,tb=Math.atan,Sb=Math.atan2,va="undefined",ma="string",Tb="object",na="number",wb="array",da=Ya.register,wa=Ya.create,Ub=Ya.get,Vb=
0,Mb=0,eb=/[\,\s]+/,Ea=function(){function a(h){g++;h=h||(new Date).getTime();for(var j=e.length;j--;){var f=e[j];g%f.every===0&&f.cb(h)}i&&animFrame(a)}var c=1E3/60,b=["r","webkitR","mozR","oR","msR"],e=[],g=0,i=function(){for(var h=0;h<b.length;h++)window.animFrame=window.animFrame||window[b[h]+"equestAnimationFrame"];return animFrame}();i?animFrame(a):setInterval(a,1E3/60);return{attach:function(h,j){e[e.length]={cb:h,every:j?La(j/c):1}},detach:function(h){for(var j=e.length;j--;)if(e[j].cb===
h){e.splice(j,1);break}}}}(),Lb=function(){var a=/^xy\((.*)\).*$/i;return{parseXY:function(c){if(!a.test(c)){c=c.split(eb);return Za(c[1],c[0])}}}}(),X=function(){function a(g){for(var i=0;i<g.length;i++){var h=g[i];if(typeof document.body.style[h]!="undefined")return h}}var c={"-webkit-user-select":"none",position:"absolute"},b,e;b=a(["-webkit-transform","MozTransform"]);css3DTransformProp=a(["WebkitPerspective","MozPerspective"]);e=a(["-webkit-transform-origin","MozTransformOrigin"]);return{transforms:L(b,
ma),create:function(g,i,h){g=document.createElement(g);var j=[];h=h||{};g.className=i||"";for(var f in h)j[j.length]=f+": "+h[f];g.style.cssText=j.join(";");return g},move:function(g,i,h,j,f){if(b){g.style[b]="translate("+i+"px, "+h+"px) "+(j||[]).join(" ");if(f&&e)g.style[e]=f.x+"px "+f.y+"px"}else{g.style.left=i+"px";g.style.top=h+"px"}},styles:function(g){return C({},c,g)}}}(),Db=function(){function a(){for(var g=e.length,i=g;i--;)try{e[i](g)}catch(h){ra(h.toString(),"error")}}var c=20,b=50,e=
[];return{process:function(g,i,h,j){function f(l){l=(m||b)/l;if(d<g.length){var k=g.slice(d,d+l);l=k.length;var n=m?0:(new Date).getTime();i(k,l);if(!m){m=(k=((new Date).getTime()-n)/l)?c/k|0:g.length;ra("calculated that we can process "+m+" items per cycle")}d+=l}else{for(l=e.length;l--;)if(e[l]===f){e.splice(l,1);break}e.length===0&&Ea.detach(a);h&&h()}}var m,d=0;if(g.length>(j||0))e.push(f)===1&&Ea.attach(a);else{i(g,g.length);h&&h()}}}}(),Za=Za||function(a,c){var b=parseFloat(c)*aa;b=ha(b);var e=
Ta*b;b=za((1+b)/(1-b)*ya((1-e)/(1+e),Ta))/2;return new sa(0,0,parseFloat(a)*aa,b)},mb=mb||function(a,c){for(var b=ya(Math.E,-c),e=Ua-2*tb(b),g=sb(e,b),i=0;i<12&&la(e-g)>1.0E-7;){e=g;g=sb(e,b);i++}return new ia(g*ka,a%360*ka)};T.prototype={constructor:T,add:function(){for(var a=this.x,c=this.y,b=arguments.length;b--;){a+=arguments[b].x;c+=arguments[b].y}return this.copy(a,c)},copy:function(a,c){var b=C({},this);b.x=a||b.x;b.y=c||b.y;return b},equals:function(a){return this.x===a.x&&this.y===a.y},offset:function(a,
c){return this.copy(this.x+a,this.y+c)},relative:function(a){a=a.viewport();return this.copy(this.x-a.x-a.padding.x,this.y-a.y-a.padding.y)},rotate:function(a,c){c=c||new T(0,0);var b=this.x-c.x,e=this.y-c.y;return new T(c.x+Da(a)*b+-ha(a)*e,c.y+ha(a)*b+Da(a)*e)},scale:function(a,c){c=c||new T(0,0);return new T(c.x+(this.x-c.x)*a,c.y+(this.y-c.y)*a)},sync:function(){return this},toString:function(){return this.x+", "+this.y}};Ia.prototype=C([],{cull:function(a){if(this.allowCull){var c=a.x,b=a.y,
e=a.x+a.w;a=a.y+a.h;for(var g=Infinity,i=0,h,j=this.length;j--;)if(h=this[j].x>=c&&this[j].x<=e&&this[j].y>=b&&this[j].y<=a){g=j<g?j:g;i=j>i?j:i}return this.slice(Ba(g-1,0),Ma(i+1,this.length))}return this},simplify:function(a){a=a||3;for(var c=new Ia,b=null,e=this.length;e--;){var g=this[e];if(include=!b||e===0||la(g.x-b.x)+la(g.y-b.y)>a){c.unshift(g);b=g}}return c}});sa.prototype=C(new T,{constructor:sa,pos:function(){return mb(this.mercX,this.mercY)},sync:function(a,c){var b;if(!(b=a.rpp)){b=a.zoom();
b=Z/(256<<b)}b=b;if(c){this.mercX=this.x*b-Math.PI;this.mercY=Math.PI-this.y*b}else{this.x=La(((this.mercX||0)+Math.PI)/b);this.y=La((Math.PI-(this.mercY||0))/b)}return this}});ta.prototype={constructor:ta,buffer:function(a,c){return new ta(this.x-a,this.y-(c||a),this.w+a*2,this.h+(c||a)*2)},center:function(){return new T(this.x+(this.w>>1),this.y+(this.h>>1))}};Hits=function(){return{diffHits:function(a,c){var b=[],e={},g;for(g=c.length;g--;)e[c[g].target.id]=true;for(g=a.length;g--;)e[a[g].target.id]||
(b[b.length]=a[g]);return b},init:function(a,c,b,e,g){return{type:a,x:g.x,y:g.y,gridX:e.x|0,gridY:e.y|0,elements:[],absXY:c,relXY:b}},initHit:function(a,c,b){return{type:a,target:c,drag:b}},triggerEvent:function(a,c,b,e){c.triggerCustom(a.type+(b?b:"Hit"),{hitType:a.type},e?e:a.elements,a.absXY,a.relXY,new sa(a.gridX,a.gridY))}}}();var vb=function(a){function c(i,h){var j=b[i],f;j||(j=b[i]=[]);(f=j[h])||(f=j[h]=[]);return f}a=a||128;var b=[],e={},g=0;return{copyInto:function(i){for(var h in e){var j=
e[h];i.insert(j.bounds||j,j,h)}},insert:function(i,h,j){var f=i.x/a|0,m=i.y/a|0,d=(i.x+i.w)/a|0;i=(i.y+i.h)/a|0;j=j||h.id||"obj_"+g++;e[j]=h;for(h=f;h<=d;h++)for(f=m;f<=i;f++)c(h,f).push(j)},remove:function(i,h,j){j=j||h.id;if(e[j]){var f=i.x/a|0;h=i.y/a|0;var m=(i.x+i.w)/a|0;i=(i.y+i.h)/a|0;delete e[j];for(f=f;f<=m;f++)for(var d=h;d<=i;d++){var l=c(f,d),k=ib.call(l,j);k>=0&&l.splice(k,1)}}},search:function(i,h){for(var j=i.y/a|0,f=(i.x+i.w)/a|0,m=(i.y+i.h)/a|0,d=[],l=[],k=i.x/a|0;k<=f;k++)for(var n=
j;n<=m;n++)d=d.concat(c(k,n));d.sort();for(j=d.length;j--;){f=d[j];if(m=e[f])l[l.length]=m;for(;j>0&&d[j-1]==f;)j--}h&&l.sort(function(o,v){return v[h]-o[h]});return l}}},$a=function(){var a={},c=0;(new Date).getTime();var b={},e=[];Ea.attach(function(g){g=g||(new Date).getTime();for(var i=0;i<e.length;){var h=e[i],j=b[h],f=b[h].image&&b[h].image.complete&&b[h].image.width>0,m=g-j.start;m=f||m>=3E4;if(f){f=j.callbacks;a[h]=j.image;for(var d=0;d<f.length;d++)f[d](j.image,true)}if(m){e.splice(i,1);
delete b[h]}else i++}},250);return function(g,i){var h=g&&i?a[g]:null;if(h&&h&&h.complete&&h.width>0)i(h);else if(h=b[g])h.callbacks.push(i);else{h=new Image;h.id="_ldimg"+ ++c;b[g]={start:(new Date).getTime(),image:h,callbacks:[i]};h.src=g;e[e.length]=g}}}();fb.prototype={constructor:fb,load:function(a){var c=this;$a(this.url,function(b){c.loaded=true;c.image=b;a&&a()})}};var Wb=function(){return ua({fastpan:true,applyStyle:function(){},applyTransform:function(a,c,b){return{restore:null,x:c,y:b}},
getDimensions:function(){return{width:0,height:0}},getViewport:function(){},hitTest:function(){return false},prepare:function(){},projectXY:null,reset:function(){}})};da("renderer","canvas",function(a,c,b,e,g){function i(r,z,B){var u,A;n[z]=function(x){for(u=N.length;u--;)if(A=B[N[u]])x[M[u]]=A}}function h(r,z,B){return{draw:B||E,viewport:r,hit:z&&d.isPointInPath(z.x,z.y),vpX:l,vpY:k,context:d}}e=C({},e);var j,f,m,d,l=0,k=0,n={},o=null,v={},w=function(){},E=function(){this.fill&&d.fill();this.stroke&&
d.stroke()},N=["fill","stroke","lineWidth","opacity"],M=["fillStyle","strokeStyle","lineWidth","globalAlpha"];(function(){function r(u,A){this.save();this.setTransform(1,0,0,1,0,0);var x=this.isPointInPath_old(u,A);this.restore();return x}var z=CanvasRenderingContext2D.prototype,B=document.createElement("canvas").getContext("2d");B.translate(50,0);B.moveTo(125,50);B.arc(100,50,25,0,360,false);if(!B.isPointInPath(150,50)){z.isPointInPath_old=z.isPointInPath;z.isPointInPath=r}})();if(c){j=c.offsetWidth;
f=c.offsetHeight;m=X.create("canvas",null,{position:"absolute","z-index":1});m.width=j;m.height=f;a.attachFrame(m,true);d=null}b=C(g,{applyStyle:function(r){var z=n[r],B=d&&d.canvas?d.canvas.id:"default",u;v[B]||(v[B]=[]);u=v[B].pop()||"reset";if(z){v[B].push(r);z(d);return u}},applyTransform:function(r){if(r.translateX!==0||r.translateY!==0||r.scaling!==1||r.rotation!==0){d.save();o={undo:function(){d.restore();o=null},x:r.xy.x,y:r.xy.y};d.translate(r.xy.x-l+r.translateX,r.xy.y-k+r.translateY);r.rotation!==
0&&d.rotate(r.rotation);r.scaling!==1&&d.scale(r.scaling,r.scaling)}return o},drawTiles:function(r,z,B){for(var u=z.length;u--;){r=z[u];if(!r.loaded&&B)r.load(a.invalidate);else r.image&&d.drawImage(r.image,r.x-l,r.y-k)}},prepare:function(r,z){var B,u=false;if(d)d.restore();else d=m.getContext("2d");for(B=r.length;B--;)u=u||r[B].clip;l=z.x;k=z.y;if(d){u||d.clearRect(0,0,j,f);d.save()}d.globalCompositeOperation="source-over";return d},prepArc:function(r,z,B){d.beginPath();d.arc(r.xy.x-(o?o.x:l),r.xy.y-
(o?o.y:k),r.size>>1,r.startAngle,r.endAngle,false);return h(z,B)},prepImage:function(r,z,B,u){var A=(u.x||r.xy.x)-(o?o.x:l),x=(u.y||r.xy.y)-(o?o.y:k),F=u.image||r.image;if(F){d.beginPath();d.rect(A,x,u.width||F.width,u.height||F.height);return h(z,B,function(){d.drawImage(F,A,x,u.width||F.width,u.height||F.height)})}},prepMarker:function(r,z,B){var u=r.xy.x-(o?o.x:l),A=r.xy.y-(o?o.y:k),x=r.size,F=undefined;d.beginPath();switch(r.markerType.toLowerCase()){case "image":F=w;d.rect(u-(x>>1),A-(x>>1),
x,x);if(r.reset&&r.image){r.image=null;r.reset=false}r.image?d.drawImage(r.image,u-(x>>1),A-(x>>1),x,x):$a(r.imageUrl,function(R){r.image=R;d.drawImage(r.image,u-(x>>1),A-(x>>1),x,x)});break;default:d.moveTo(u,A);d.lineTo(u-(x>>1),A-x);d.lineTo(u+(x>>1),A-x);d.lineTo(u,A)}return h(z,B,F)},prepPoly:function(r,z,B,u){var A=true;r=u.points||r.points().cull(z);u=o?o.x:l;var x=o?o.y:k;d.beginPath();for(var F=r.length;F--;){var R=r[F].x-u,S=r[F].y-x;if(A){d.moveTo(R,S);A=false}else d.lineTo(R,S)}return h(z,
B)},getContext:function(){return d}});(function(){Eb.each(function(r,z){i(null,r,z)});Ka.bind("styleDefined",i)})();b.bind("detach",function(){c.removeChild(m)});b.bind("resize",function(){});return b});da("renderer","dom",function(a,c,b,e,g){function i(d){var l=d.image=new Image;f[d.id]=d;l.src=d.url;l.onload=function(){if(m[d.id])j.appendChild(this);else d.image=null};l.style.cssText="-webkit-user-select: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute;";
return l}function h(d,l,k){var n=[],o;for(o in d){var v=d[o];if(k?v[k]:!l[o]){if(v.image&&v.image.parentNode){j.removeChild(v.image);v.image=null}n[n.length]=o}}for(l=n.length;l--;)delete d[n[l]]}var j=null,f={},m={};j=X.create("div","",X.styles({width:c.offsetWidth+"px",height:c.offsetHeight+"px"}));c.childNodes.length>0?c.insertBefore(j,c.childNodes[0]):c.appendChild(j);a.attachFrame(j);b=C(g,{drawTiles:function(d,l,k){for(var n,o=d.x,v=d.y,w=l.length;w--;){d=l[w];if(d.url){(n=d.image||(k?i(d):
null))&&X.move(n,d.x-o,d.y-v);m[d.id]=d}}}});b.bind("predraw",function(){h(f,m);m={}});b.bind("detach",function(){c.removeChild(j)});a.bind("reset",function(){for(h(f,m={});j.childNodes.length>0;)j.removeChild(j.childNodes[0])});return b});var Eb=function(){function a(b,e){if(L(b,ma)){Ka.trigger("styleDefined",b,c[b]=e);return b}else{var g=[],i;for(i in b)g[g.length]=a(i,b[i]);return g}}var c={};a({reset:{fill:"#ffffff",opacity:1},highlight:{fill:"#ff0000"},waypoints:{lineWidth:4,stroke:"#003377",
fill:"#ffffff"},waypointsHover:{lineWidth:4,stroke:"#ff0000",fill:"#ffffff"}});return{resetStyle:"reset",each:function(b){for(var e in c)b(e,c[e])},get:function(b){return c[b]},define:a}}();da("view","view",function(a){function c(p,q,t,G){r(Ba(U+ya(2,G)-1,0.125),false,true)}function b(p,q){var t=V&&V.projectXY?V.projectXY(p,q):null;if(!t){t=E();var G=1/U;t=new I.XY(t?t.x+p*G:p,t?t.y+q*G:q)}return t.sync(I,true)}function e(p,q,t){z("doubleTap",q,t,b(t.x,t.y));a.scalable&&r(2,{easing:"quad.out",duration:300},
true)}function g(p,q,t){s=null;ja=true;v("down",q,t)}function i(p,q,t){v("hover",q,t)}function h(p,q,t,G){k(q,t,false);if(!s){y=G.x;D=G.y}}function j(p,q,t){k(q,t,true);ja=false}function f(){clearTimeout(Fb);Fb=setTimeout(function(){if(K)if(K.offsetWidth!==Na*2||K.offsetHeight!==Oa*2){var p=w();o(a.container);w(p.x,p.y)}},250)}function m(p,q,t){v("tap",q,t);I.trigger("tap",q,t,b(t.x,t.y,true))}function d(){fa&&fa.unbind();if(V){fa=INTERACT.watch(V.interactTarget||K);if(a.scalable){fa.bind("zoom",
c);fa.bind("doubleTap",e)}fa.bind("pointerDown",g);fa.bind("pointerMove",h);fa.bind("pointerUp",j);a.captureHover&&fa.bind("pointerHover",i);fa.bind("tap",m)}}function l(p){if(V){V.trigger("detach");V=null}var q=I,t=R,G=K,W=a;p=p.split("/");for(var Y=new Wb(q,t,G,W),oa=0;oa<p.length;oa++)Y=wa("renderer",p[oa],q,t,G,W,Y);V=Y;ca=V.fastpan&&X.transforms;d();I.trigger("reset");M()}function k(p,q,t){if(s){p=b(q.x,q.y);s.drag.call(s.target,s,p.x,p.y,t)&&ba++;if(t)s=null}}function n(p){for(var q=F;q--;)if(x[q].id===
p)return q;return F}function o(p){K=document.getElementById(p);K.appendChild(S=X.create("div","",X.styles({overflow:"hidden",width:K.offsetWidth+"px",height:K.offsetHeight+"px"})));p=a.padding;if(p===u){p=K.offsetWidth;var q=K.offsetHeight,t=lb(p*p+q*q);ga=new T(t-p>>1,t-q>>1)}else ga=new T(p,p);ab=S.offsetWidth+ga.x*2;bb=S.offsetHeight+ga.y*2;nb=ab/2;ob=bb/2;Na=K.offsetWidth/2;Oa=K.offsetHeight/2;Pa=new T(nb,ob);S.appendChild(R=X.create("div","",X.styles({width:ab+"px",height:bb+"px","z-index":2,
margin:-ga.y+"px 0 0 "+-ga.x+"px"})));l(a.renderer);p=a.controls;for(q=0;q<A.length;q++)A[q].trigger("detach");A=[];for(q=0;q<p.length;q++)A[A.length]=wa("control",p[q],I,S,K,a[p[q]])}function v(p,q,t){var G=(new T(t.x-Na+nb,t.y-Oa+ob)).rotate(-pa*aa,Pa).scale(1/U,Pa);ea=Hits.init(p,q,t,b(t.x,t.y,true),G);for(p=F;p--;)if(x[p].visible)P=P||(x[p].hitGuess?x[p].hitGuess(ea.gridX,ea.gridY,I):false);P&&ba++}function w(p,q,t){if(L(p,ma)||L(p,Tb)){q=new I.XY(p);q.sync(I);p=q.x;q=q.y}if(L(p,na)){B(p-Na-ga.x,
q-Oa-ga.y,t);return I}else return B().offset(Na+ga.x|0,Oa+ga.y|0).sync(I,true)}function E(){var p=new ta(O,Q,ab,bb);p.scaleFactor=U;p.padding=ga?ga.copy():new T;return p}function N(p,q,t){if(L(p,ma)&&L(q,va))for(q=0;q<F;q++){if(x[q].id===p)return x[q]}else if(L(p,ma)){q=wa("layer",q,I,t);q.added=(new Date).getTime();q.id=p;x[n(p)]=q;x.sort(function(G,W){return W.zindex-G.zindex||W.added-G.added});F=x.length;I.trigger("resync");M();I.trigger("layerChange",I,q);ba++;return q}else return[].concat(x)}
function M(){var p=E();if(p){if(Fa||Ga)if(p){var q=cb?O+(p.w>>1):O,t=db?Q+(p.h>>1):Q,G=p.w,W=p.h;if(Fa&&Fa>G)if(q+G>Fa)O=cb?O:Fa-G;else if(q<0)O=cb?O:0;if(Ga&&Ga>W)if(t+W>Ga)Q=db?Q:Ga-W;else if(t<0)Q=db?Q:0}Gb=O;Hb=Q;I.trigger("refresh",I,p);ba++}}function r(p,q,t){if(L(p,na)){var G=t?p:U*p;if(!Xb){q=null;p=La(za(G)/Math.LN2);G=ya(2,p)}if(q)Qa=qa.tween([U],[G],q,function(){U=G;Qa=null;ba++});else{U=G;ba++}return I}else return U}function z(){for(var p=I.trigger.apply(null,arguments).cancel,q=x.length;q--;)p=
x[q].trigger.apply(null,arguments).cancel||p;return!p}function B(p,q,t){if(L(p,na)){if(t)xa=qa.tween([O,Q],[p,q],t,function(){xa=null});else{O=p|0;Q=q|0;ba++}return I}else return(new I.XY(O,Q)).sync(I,true)}a=C({container:"",captureHover:true,controls:[],drawOnScale:true,padding:128,inertia:true,refreshDistance:256,pannable:true,scalable:true,renderer:"canvas"},a);var u="auto",A=[],x=[],F=0,R=null,S=null,K,s=null,J=!L(window.attachEvent,va),P=false,ca,ja=false,y=0,D=0,H=a.refreshDistance,O=0,Q=0,
$=0,Ca=0,Gb=0,Hb=0,Fa=null,Ga=null,cb=false,db=false,xa=null,ga,ea=null,Ra=null,V,Fb=0,Pa=new T,pa=0,Sa=null,U=1,Qa=null,pb=1,fa=null,qb={index:0,draw:false},Xb=true,ba=0,ab,bb,nb,ob,Na,Oa,I={XY:T,id:a.id,panSpeed:0,attachFrame:function(p,q){q&&R.appendChild(p)},center:w,detach:function(){V&&V.trigger("detach");fa&&fa.unbind();if(S){K.removeChild(S);R=S=null}},layer:N,invalidate:function(){ba++},pan:function(p,q,t){B(O+p,Q+q,t)},refresh:M,rotate:function(p,q,t){if(L(p,na)){var G=t?p:pa+p;if(q)Sa=
qa.tween([pa],[G],q,function(){pa=G%360;Sa=null;ba++});else{pa=G%360;ba++}return I}else return pa},scale:r,triggerAll:z,setMaxOffset:function(p,q,t,G){Fa=p;Ga=q;cb=t;db=G},offset:B,viewport:E};ua(I);I.bind("resize",f);I.bind("layerRemove",function(p,q){var t=ib(x,q.id);if(t>=0&&t<F){x.splice(t,1);ba++}F=x.length});yb(I,a,{container:o,captureHover:d,scalable:d,pannable:d,renderer:l});N("markers","draw",{zindex:20});o(a.container);J?window.attachEvent("onresize",f):window.addEventListener("resize",
f,false);Ea.attach(function(p){var q=[],t,G,W;self.panSpeed=panSpeed=la(y)+la(D);t=U!==pb;if(panSpeed>0||t||xa||Qa||Sa){ba++;if(xa&&panSpeed>0){xa(true);xa=null}}if(panSpeed<2&&(la(O-Gb)>=H||la(Q-Hb)>=H))M();qb.index++;qb.draw=ba||panSpeed||0;if(V&&qb.draw){if(Qa)U=Qa()[0];if(Sa)pa=Sa()[0];$+=y;Ca+=D;if(y||D)I.trigger("pan");if(X.transforms){if(U!==1)q[q.length]="scale("+U+")";if(pa!==0)q[q.length]="rotate("+pa+"deg)"}if(t=!ca||(a.drawOnScale||U===1)&&panSpeed<5){if(xa){t=xa();O=t[0]|0;Q=t[1]|0}else{O=
O-$/U|0;Q=Q-Ca/U|0}W=E();V.trigger("predraw",W);if(V.prepare(x,W,p,ea)){G=Ca=t=$=ba=0;for(ii=F;ii--;){var Y=x[ii];if(Y.visible){var oa=Y.style?V.applyStyle(Y.style,true):null;Y.draw(V,W,I,p,ea);oa&&V.applyStyle(oa)}}V.trigger("render",W);I.trigger("drawComplete",W,p);X.move(R,t,G,q,Pa)}}else X.move(R,$,Ca,q,Pa);if(ja||!a.inertia)D=y=0;else if(y!=0||D!=0){y*=0.8;D*=0.8;if(la(y)<0.5)y=0;if(la(D)<0.5)D=0}if(ea){p=true;q=ea?ea.elements:[];if(Ra&&Ra.type==="hover"){diffElements=Hits.diffHits(Ra.elements,
q);if(diffElements.length>0)Hits.triggerEvent(Ra,I,"Out",diffElements);else p=false}if(q.length>0){G=ea.gridX;W=ea.gridY;for(t=q.length;t--;){Y=q[t];oa=G;var Ib=W,Jb=Y&&Y.drag&&(!Y.canDrag||Y.canDrag(Y,oa,Ib));if(Jb){s=Y;s.startX=oa;s.startY=Ib}if(Jb)break}p&&Hits.triggerEvent(ea,I)}Ra=q.length>0?C({},ea):null;ea=null}if(pb!==U){I.trigger("scaleChanged",U);pb=U}}});return I});da("view","map",function(a){function c(f,m){var d=j.viewport();if(f){d=Ba(f.bestZoomLevel(d),m||0);return b(d).center(f.center())}else return new Ja((new sa(d.x,
d.y2)).sync(j,true).pos(),(new sa(d.x2,d.y)).sync(j,true).pos())}function b(f,m,d){if(L(f,na)){f=Ba(a.minZoom,Ma(a.maxZoom,f|0));if(f!==i){var l=j.viewport(),k=j.offset(),n=l.w/2;l=l.h/2;var o=ya(2,f-i),v=n/o|0,w=l/o|0;i=f;j.offset(((m||k.x+n)-v)*o,((d||k.y+l)-w)*o);refreshY=refreshX=0;j.trigger("zoom",f);j.trigger("reset");g=j.rpp=Z/(256<<i);j.setMaxOffset(Z/g|0,Z/g|0,true,false);j.scale(1,false,true);j.trigger("resync");j.refresh()}return j}else return i}a=C({controls:["zoombar"],minZoom:1,maxZoom:18,
renderer:"canvas/dom",zoom:1,zoombar:{}},a);var e=new sa,g,i=a.zoom||a.zoomLevel,h=0,j=C(wa("view","view",a),{XY:sa,bounds:c,zoom:b});j.bind("refresh",function(){var f=j.viewport();if(e.x!=f.x||e.y!=f.y){j.trigger("boundsChange",c());e.x=f.x;e.y=f.y}});j.bind("scaleChanged",function(f,m){var d=za(m)/Math.LN2|0;if(d!==0){m=ya(2,d);clearTimeout(h);h=setTimeout(function(){b(i+d)},500)}});return j});var qa=function(){return{tween:function(a,c,b,e,g){function i(o){var v=o-n;o=n+k<=o;for(var w=h;w--;){j[w]=
m(v,a[w],d[w],k);g&&g.invalidate()}if(o||l){Ea.detach(i);for(w=0;w<f.length;w++)f[w]&&f[w](j,v,l)}}b=C({easing:"sine.out",duration:1E3,complete:null},b);var h=a.length,j=[].concat(a),f=[e,b.complete],m=Ob(b.easing),d=[],l=false,k=b.duration,n=(new Date).getTime();for(b=h;b--;)d[b]=c[b]-a[b];Ea.attach(i);return function(o){l=o;return j}},tweenDrawable:function(a,c,b,e,g){var i=qa.tween([b],[e],g,function(){a[c]=e;for(var j=a.tweens.length;j--;)if(a.tweens[j]===h){a.tweens.splice(j,1);break}},a.view),
h=function(){a[c]=i()[0]};return h}}}(),Aa=function(a,c,b){b=C({style:null,xy:null,size:20,fill:false,stroke:true,draggable:false,observable:true,properties:{},typeName:"Shape",zindex:0},b);C(this,b);if(L(this.xy,ma))this.xy=new a.XY(this.xy);this.id="drawable_"+Vb++;this.bounds=null;this.view=a;this.layer=c;this.tweens=[];this.rotation=this.animations=0;this.scaling=1;this.translateY=this.translateX=0;this.observable&&ua(this)};Aa.prototype={constructor:Aa,applyTweens:function(){for(var a=this.tweens.length;a--;)this.tweens[a]()},
drag:null,draw:null,getProps:null,resync:function(){if(this.xy){this.xy.sync(this.view);if(this.size){var a=this.size>>1;this.updateBounds(new ta(this.xy.x-a,this.xy.y-a,this.size,this.size))}}},rotate:function(a,c,b){if(L(a,na)){a=(b?a:this.rotation*ka+a)*aa;if(c)this.tweens.push(qa.tweenDrawable(this,"rotation",this.rotation,a,c));else{this.rotation=a;this.view.invalidate()}return this}else return this.rotation*ka},scale:function(a,c,b){if(L(a,na)){a=b?a:this.scaling*a;if(c)this.tweens.push(qa.tweenDrawable(this,
"scaling",this.scaling,a,c));else{this.scaling=a;this.view.invalidate()}return this}else return this.scaling},translate:function(a,c,b,e){if(L(a,na)){a=e?a:this.translateX+a;c=e?c:this.translateY+c;if(b){this.tweens.push(qa.tweenDrawable(this,"translateX",this.translateX,a,b));this.tweens.push(qa.tweenDrawable(this,"translateY",this.translateY,c,b))}else{this.translateX=a;this.translateY=c;this.view.invalidate()}return this}else return new T(this.translateX,this.translateY)},updateBounds:function(a,
c){a&&(!this.bounds||a.x!=this.bounds.x||a.y!=this.bounds.y)&&this.trigger("move",this,a,this.bounds);this.bounds=a;if(c)this.xy=this.bounds.center()}};da("drawable","marker",function(a,c,b){b=C({fill:true,stroke:false,markerType:"simple",hoverStyle:"highlight",typeName:"Marker"},b);return new Aa(a,c,b)});da("drawable","poly",function(a,c,b){function e(){var d,l,k,n,o,v,w;f=b.simplify?j.simplify():j;for(d=f.length;d--;){l=f[d].x;k=f[d].y;v=L(v,va)||l<v?l:v;w=L(w,va)||k<w?k:w;n=L(n,va)||l>n?l:n;o=
L(o,va)||k>o?k:o}m.updateBounds(new ta(v,w,n-v,o-w),true)}function g(d){if(L(d,wb)){j=new Ia(b.allowCull);Db.process(d,function(l,k){for(var n=0;n<k;n++)j.push(new a.XY(l[n]))},i,h);return m}else return f}function i(){j.length&&Db.process(j,function(d,l){for(var k=l;k--;)d[k].sync(a)},e,h)}b=C({allowCull:false,simplify:false,fill:true,points:[],typeName:"Poly"},b);var h=500,j=new Ia(b.allowCull),f,m=C(new Aa(a,c,b),{points:g,resync:i});g(b.points);return m});da("drawable","line",function(a,c,b){b.fill=
false;b.allowCull=true;return wa("drawable","poly",a,c,b)});da("drawable","image",function(a,c,b){function e(){if(f&&f.width>0){if(!this.centerOffset)this.centerOffset=new T(-f.width>>1,-f.height>>1);this.updateBounds(new ta(this.xy.x+this.centerOffset.x,this.xy.y+this.centerOffset.y,f.width,f.height),false)}}function g(d){if(this.imageUrl=d){var l=this;$a(this.imageUrl,function(k,n){f=k;if(n){var o=m.layer?m.layer.view:null;o&&o.invalidate()}e.apply(l)})}}b=C({image:null,imageUrl:null,centerOffset:null,
typeName:"Image"},b);var i=Aa.prototype.resync,h=0,j=0,f=b.image,m=C(new Aa(a,c,b),{changeImage:g,getProps:function(){this.bounds||e(this,f);return{image:f,x:this.xy.x+h,y:this.xy.y+j}},resync:function(d){i.call(this,d);e.call(this)}});f||g.call(this,this.imageUrl);if(this.centerOffset){h=this.centerOffset.x;j=this.centerOffset.y}});da("drawable","arc",function(a,c,b){b=C({startAngle:0,endAngle:Math.PI*2,typeName:"Arc"},b);return new Aa(a,c,b)});Va.prototype={constructor:Va,clip:null,cycle:function(){},
draw:function(){},hitGuess:null,remove:function(){this.view.trigger("layerRemove",this)}};da("layer","tile",function(a,c){c=C({generator:"osm",imageLoadArgs:{}},c);var b=wa("generator",c.generator,c).run,e=null,g=[],i=C(new Va(a,c),{draw:function(h,j,f){h.drawTiles&&h.drawTiles(j,e.search(j.buffer(128)),f.panSpeed<2)}});a.bind("resync",function(){var h=a&&a.zoom?a.zoom():0;g[h]||(g[h]=ub(h));e=g[h]});a.bind("refresh",function(h,j,f){e&&b(j,f,e,function(){j.invalidate()})});return i});da("layer","draw",
function(a,c){function b(m,d,l,k){var n=this.dragOffset;if(!n)n=this.dragOffset=new a.XY(m.startX-this.xy.x,m.startY-this.xy.y);this.xy.x=d-n.x;this.xy.y=l-n.y;if(k){delete this.dragOffset;a.invalidate();this.xy.sync(a,true);this.trigger("dragDrop")}return true}function e(m){clearTimeout(j);j=setTimeout(function(){i.sort(function(d,l){if(l.xy&&d.xy){var k=l.xy.y-d.xy.y;return k!=0?k:l.xy.x-d.xy.x}});m&&m.invalidate()},50)}function g(m,d,l,k){k&&h.remove(k,d);h.insert(l,d)}c=C({zindex:10},c);var i=
[],h,j=0,f=C(new Va(a,c),{itemCount:0,clear:function(){h=new vb;i=[];f.trigger("cleared");f.itemCount=0;a.invalidate()},create:function(m,d,l){d=wa("drawable",m,a,f,d);if(l)i.unshift(d);else i[i.length]=d;d.resync();h&&d.bounds&&h.insert(d.bounds,d);e(a);d.bind("move",g);f.itemCount=i.length;f.trigger(m+"Added",d);return d},draw:function(m,d,l,k,n){l={};k=h&&d?h.search(d):[];for(var o=k.length;o--;){var v=k[o],w=v.style||f.style,E,N,M=v.getProps?v.getProps(m):l;E=m["prep"+v.typeName];v.tweens.length>
0&&v.applyTweens();N=m.applyTransform(v);if(M=E?E.call(m,v,d,n,M):null){if(n&&M.hit){n.elements.push(Hits.initHit(v.type,v,v.draggable?b:null));E=n.type+"Style";w=v[E]||f[E]||w}w=w?m.applyStyle(w,true):null;(E=v.draw||M.draw)&&E.call(v,M);w&&m.applyStyle(w)}N&&N.undo&&N.undo()}},find:function(){return[].concat(i)},hitGuess:function(m,d){return h&&h.search({x:m-10,y:d-10,w:20,h:20}).length>0}});a.bind("resync",function(){h=ub(a.zoom(),h);for(var m=i.length;m--;)i[m].resync()});return f});Wa.prototype=
{constructor:Wa};da("control","zoombar",function(a,c,b,e){function g(u,A){var x=M[u]=X.create("div","t5-zoombar-button",{position:"absolute",background:i(u),"z-index":51,width:e.width+"px",height:e.buttonHeight+"px","margin-top":(A||0)+"px"});r.appendChild(x)}function i(u,A){return"url("+e.images+") 0 -"+(l+n*3+(u||0)*m*3+(A||0)*m)+"px"}function h(u){return"url("+e.images+") 0 -"+(l+(u||0)*n)+"px"}function j(u,A){var x;if(u===k){k.style.background=h(A);x="thumb"}else for(var F=0;F<M.length;F++)if(u===
M[F]){x="button"+F;M[F].style.background=i(F,A);break}return x}function f(u){if(u!==E){E=u;w=v-E/N*(v-o)|0;X.move(k,0,w-o);clearTimeout(z);z=setTimeout(function(){a.zoom(E)},500)}}e=C({width:24,height:200,images:"img/zoom.png",align:"right",marginTop:10,spacing:10,thumbHeight:16,buttonHeight:16},e);var m=e.buttonHeight,d,l=e.height,k,n=e.thumbHeight,o=e.spacing+m-(n>>1),v=e.height-m-(n>>1),w=o,E=-1;c=a.minZoom();var N=a.maxZoom()-c+1,M=[],r,z=0,B={button0:function(){a.zoom(a.zoom()+1)},button1:function(){a.zoom(a.zoom()-
1)}};r=X.create("div","t5-zoombar",{position:"absolute",background:"url("+e.images+")","z-index":50,overflow:"hidden",width:e.width+"px",height:e.height+"px",margin:function(){var u=e.spacing,A=Ha("{0}px 0 0 {1}px");if(e.align==="right")u=b.offsetWidth-e.width-e.spacing;return A(e.marginTop,u)}()});b.childNodes[0]?b.insertBefore(r,b.childNodes[0]):b.appendChild(r);r.appendChild(k=X.create("div","t5-zoombar-thumb",{position:"absolute",background:h(),"z-index":51,width:e.width+"px",height:e.thumbHeight+
"px",margin:"10px 0 0 0",top:w-o+"px"}));g(0);g(1,e.height-e.buttonHeight);d=INTERACT.watch(r,{bindTarget:r});d.bind("pointerMove",function(u,A,x){w=Math.min(Math.max(o,x.y-(n>>1)),v);f(N-(w-o)/v*N|0)});d.bind("pointerDown",function(u){j(u.target,2)});d.bind("pointerUp",function(u){j(u.target,0)});d.bind("tap",function(u){(u=B[j(u.target,2)])&&u()});c=new Wa(a);c.bind("detach",function(){d.unbind();b.removeChild(r)});a.bind("zoom",function(u,A){f(A)});f(a.zoom());return c});ia.prototype={constructor:ia,
distanceTo:function(){if(!targetPos||this.empty()||targetPos.empty())return 0;var a=(targetPos.lat-this.lat)*aa>>1,c=(targetPos.lon-this.lon)*aa>>1;a=ha(a)*ha(a)+Da(this.lat*aa)*Da(targetPos.lat*aa)*ha(c)*ha(c);return 6371*2*Sb(lb(a),lb(1-a))},equalTo:function(a){return pos&&this.lat===a.lat&&this.lon===a.lon},empty:function(){return this.lat===0&&this.lon===0},inArray:function(a){for(var c=a.length;c--;)if(this.equal(a[c]))return true;return false},offset:function(a,c){var b=this.lat*aa,e=this.lon*
aa,g=b+a/6371;b=Cb(ha(c/6371)/Da(b));e=e+b;g=(g+Ua)%Math.PI-Ua;e%=Z;return new ia(g*ka,e*ka)},toPixels:function(){return Za(this.lon,this.lat)},toBounds:function(a){var c=a.radians(),b=this.lat*aa,e=this.lon*aa;a=b-c;var g=b+c;if(a>zb&&g<kb){b=Cb(ha(c)/Da(b));c=e-b;if(c<Rb)c+=Z;e=e+b;if(e>Ab)e-=Z}else{a=Ba(a,zb);g=Ma(g,kb);c=xb;e=Xa}return new Ja(new ia(a*ka,c*ka),new ia(g*ka,e*ka))},toString:function(a){return this.lat+(a||" ")+this.lon}};(function(){da("fn","generalize",function(a,c,b){var e=a.length,
g=[],i=null;b=(b||250)/1E3;for(e=e;e--;)if(e===0)g.unshift(a[e]);else{var h=!i||a[e].inArray(c)?b:i.distanceTo(a[e]);if(a[e]&&h>=b){g.unshift(a[e]);i=a[e]}}return g})})();Ja.prototype={constructor:Ja,bestZoomLevel:function(a){var c=this.center();c=Ma(La(la(c.lat)*0.05),jb.length);var b=jb[c],e=this.size();c=Bb(za(jb[3]*a.h/e.y)/za(2));a=Bb(za(b*a.w/e.x)/za(2));return Ma(isNaN(c)?1E3:c,isNaN(a)?1E3:a)},center:function(){var a=this.size();return new ia(this.min.lat+(a.y>>1),this.min.lon+(a.x>>1))},
expand:function(a){this.min.lat-=a;this.max.lat+=a;this.min.lon-=a%360;this.max.lon+=a%360},size:function(a){var c=new T(0,this.max.lat-this.min.lat);c.x=(a||L(a,va))&&this.min.lon>this.max.lon?360-this.min.lon+this.max.lon:this.max.lon-this.min.lon;return c},toString:function(){return"min: "+this.min+", max: "+this.max}};hb.prototype={constructor:hb,radians:function(a){if(L(a,na)){this.meters=a*6371E3;return this}else return this.meters/6371E3},toString:function(){if(this.meters>1E3)return(this.meters/
10|0)/100+"km";return this.meters+"m"}};C(Ka,{ex:C,log:ra,observable:ua,configurable:yb,formatter:Ha,wordExists:function(a,c){for(var b=a.split(/\s|\,/).length;b--;)if(a.toLowerCase()==c.toLowerCase())return true;return false},is:L,indexOf:ib,fn:function(a){return Ub("fn",a)},project:Za,unproject:mb,getImage:$a,userMessage:function(a,c,b){Ka.trigger("userMessage",a,c,b)},Registry:Ya,Style:Eb,DOM:X,Rect:ta,XY:T,Line:Ia,Pos:ia,BBox:Ja,Distance:hb,Hits:Hits,Control:Wa,Tile:fb,Tweener:qa});rb.T5=Ka;rb.Tile5=
function(a,c){c=C({container:a,type:"map",renderer:"canvas",starpos:null,zoom:1,fastpan:false,drawOnScale:true,zoombar:{}},c);return wa("view",c.type,c)}})(window);
