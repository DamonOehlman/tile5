if(!this.JSON)this.JSON={};
(function(){function k(p){return p<10?"0"+p:p}function f(p){d.lastIndex=0;return d.test(p)?'"'+p.replace(d,function(g){var r=l[g];return typeof r==="string"?r:"\\u"+("0000"+g.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+p+'"'}function a(p,g){var r,o,n,s,u=e,h,t=g[p];if(t&&typeof t==="object"&&typeof t.toJSON==="function")t=t.toJSON(p);if(typeof q==="function")t=q.call(g,p,t);switch(typeof t){case "string":return f(t);case "number":return isFinite(t)?String(t):"null";case "boolean":case "null":return String(t);
case "object":if(!t)return"null";e+=m;h=[];if(Object.prototype.toString.apply(t)==="[object Array]"){s=t.length;for(r=0;r<s;r+=1)h[r]=a(r,t)||"null";n=h.length===0?"[]":e?"[\n"+e+h.join(",\n"+e)+"\n"+u+"]":"["+h.join(",")+"]";e=u;return n}if(q&&typeof q==="object"){s=q.length;for(r=0;r<s;r+=1){o=q[r];if(typeof o==="string")if(n=a(o,t))h.push(f(o)+(e?": ":":")+n)}}else for(o in t)if(Object.hasOwnProperty.call(t,o))if(n=a(o,t))h.push(f(o)+(e?": ":":")+n);n=h.length===0?"{}":e?"{\n"+e+h.join(",\n"+e)+
"\n"+u+"}":"{"+h.join(",")+"}";e=u;return n}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+k(this.getUTCMonth()+1)+"-"+k(this.getUTCDate())+"T"+k(this.getUTCHours())+":"+k(this.getUTCMinutes())+":"+k(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
d=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e,m,l={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},q;if(typeof JSON.stringify!=="function")JSON.stringify=function(p,g,r){var o;m=e="";if(typeof r==="number")for(o=0;o<r;o+=1)m+=" ";else if(typeof r==="string")m=r;if((q=g)&&typeof g!=="function"&&(typeof g!=="object"||typeof g.length!=="number"))throw Error("JSON.stringify");return a("",
{"":p})};if(typeof JSON.parse!=="function")JSON.parse=function(p,g){function r(n,s){var u,h,t=n[s];if(t&&typeof t==="object")for(u in t)if(Object.hasOwnProperty.call(t,u)){h=r(t,u);if(h!==undefined)t[u]=h;else delete t[u]}return g.call(n,s,t)}var o;p=String(p);b.lastIndex=0;if(b.test(p))p=p.replace(b,function(n){return"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(p.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){o=eval("("+p+")");return typeof g==="function"?r({"":o},""):o}throw new SyntaxError("JSON.parse");}})();if(!String.format)String.format=function(k){if(arguments.length<=1)return k;for(var f=arguments.length-2,a=0;a<=f;a++)k=k.replace(RegExp("\\{"+a+"\\}","gi"),arguments[a+1]);return k};
String.prototype.containsWord=function(k){var f="";if(k.toString)k=k.toString();for(var a=0;a<k.length;a++)f+=!/\w/.test(k[a])?"\\"+k[a]:k[a];return RegExp("(^|\\s|\\,)"+f+"(\\,|\\s|$)","i").test(this)};Number.prototype.toRad=function(){return this*Math.PI/180};Number.prototype.sec=function(){return 1/Math.cos(this)};
GRUNT=function(){var k=Object.prototype.hasOwnProperty,f=0,a={id:"GRUNT.core",extend:function(){var b=arguments[0]||{},d=1,e=arguments.length,m=false,l,q,p,g;if(typeof b==="boolean"){m=b;b=arguments[1]||{};d=2}if(typeof b!=="object"&&!a.isFunction(b))b={};if(e===d){b=this;--d}for(;d<e;d++)if((l=arguments[d])!=null)for(q in l){p=b[q];g=l[q];if(b!==g)if(m&&g&&(a.isPlainObject(g)||a.isArray(g))){p=p&&(a.isPlainObject(p)||a.isArray(p))?p:a.isArray(g)?[]:{};b[q]=a.extend(m,p,g)}else if(g!==undefined)b[q]=
g}return b},isFunction:function(b){return toString.call(b)==="[object Function]"},isArray:function(b){return toString.call(b)==="[object Array]"},isPlainObject:function(b){if(!b||toString.call(b)!=="[object Object]"||b.nodeType||b.setInterval)return false;if(b.constructor&&!k.call(b,"constructor")&&!k.call(b.constructor.prototype,"isPrototypeOf"))return false;var d;for(d in b);return d===undefined||k.call(b,d)},isEmptyObject:function(b){for(var d in b)return false;return true},isXmlDocument:function(b){return toString.call(b)===
"[object Document]"},contains:function(b,d){var e=b,m=arguments,l=1;if(d&&a.isArray(d)){m=d;l=0}for(l=l;l<m;l++)e=e&&typeof foo[m[l]]!=="undefined";return e},newModule:function(b){b=a.extend({id:null,requires:[],parent:null},b);if(b.parent)b=a.extend({},b.parent,b);return b},toID:function(b){return b.replace(/\s/g,"-")},generateObjectID:function(b){return(b?b:"obj")+f++}};return a}();
GRUNT.Log=function(){function k(e,m){var l,q=m&&m.length>0?m[0]:"";for(l=1;m&&l<m.length;l++)q+=" "+(a&&GRUNT.isPlainObject(m[l])?JSON.stringify(m[l]):m[l]);typeof console!=="undefined"&&console[e](q);for(l=0;l<f.length;l++)f[l].call(d,q,e)}var f=[],a=typeof JSON!=="undefined",b=window.console&&window.console.markTimeline,d={id:"GRUNT.log",getTraceTicks:function(){return b?(new Date).getTime():null},trace:function(e,m){if(b)console.markTimeline(e+(m?": "+(d.getTraceTicks()-m)+"ms":""))},debug:function(){k("debug",
arguments)},info:function(){k("info",arguments)},warn:function(){k("warn",arguments)},error:function(){k("error",arguments)},exception:function(e){d.error(arguments);for(var m in e)d.info("ERROR DETAIL: "+m+": "+e[m])},watch:function(e,m){try{m()}catch(l){d.exception(l,e)}},throwError:function(e){d.error(e);throw Error(e);},requestUpdates:function(e){f.push(e)}};return d}();
GRUNT.Data=function(){var k={determineObjectMapping:function(a){if(!a)return null;a=a.split("|");for(var b={},d=0;d<a.length;d++)b[a[d]]=d;return b},mapLineToObject:function(a,b){var d=a.split("|"),e={};for(var m in b){var l=b[m];e[m]=d.length>l?d[l]:null}return e},parse:function(a){var b=null,d=[];a=a.split("\n");for(var e=0;e<a.length;e++){var m=a[e];if(b)d.push(k.mapLineToObject(m,b));else b=k.determineObjectMapping(m)}return d}},f={supportedFormats:{JSON:{parse:function(a){return JSON.parse(a)}},
PDON:{parse:function(a){return k.parse(a)}}},parse:function(a){a=GRUNT.extend({data:"",format:"JSON"},a);if(!f.supportedFormats[a.format])throw Error("Unsupported data format: "+a.format+", cannot parse data in javascript object");try{return f.supportedFormats[a.format].parse(a.data)}catch(b){GRUNT.Log.error("ERROR PARSING DATA FROM FORMAT: "+a.format,a.data);GRUNT.Log.exception(b)}return{}}};return f}();
GRUNT.paramTweaker=function(k,f,a){return function(b,d){if(typeof d!=="undefined"){if(b in k)k[b]=d;a&&b in a&&a[b](b,d)}else return f&&b in f?f[b](b):k[b]}};
GRUNT.configurable=function(k,f,a,b){function d(e){k[e]||(k[e]=function(m){return k.configure(e,m)})}if(k){if(!k.configurableSettings){k.configurableId=GRUNT.generateObjectID("configurable");k.configurableSettings={};k.configCallbacks=[];if(!GRUNT.configurables)GRUNT.configurables={}}GRUNT.configurables[k.configurableId]=k;k.configCallbacks.push(a);for(a=f.length;a--;){k.configurableSettings[f[a]]=true;b&&d(f[a])}if(!k.configure)k.configure=function(e,m){var l=k.configCallbacks;if(k.configurableSettings[e]){for(var q=
l.length;q--;){var p=l[q](e,m);if(typeof p!=="undefined")return p}return GRUNT.configurables[k.configurableId]}return null}}};GRUNT.Template=function(){var k=/\$\{(.*?)\}/ig;return{parse:function(f,a){for(var b=f,d=k.exec(b);d;){b=b.replace(d[0],GRUNT.XPath.first(d[1],a));k.lastIndex=0;d=k.exec(b)}return b}}}();
GRUNT.JSONP=function(){function k(d){var e=document.createElement("script"),m=false;e.src=d;e.async=true;e.onload=e.onreadystatechange=function(){if(!m&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){m=true;e.onload=e.onreadystatechange=null;e&&e.parentNode&&e.parentNode.removeChild(e)}};a||(a=document.getElementsByTagName("head")[0]);a.appendChild(e)}var f=0,a,b=this;return{get:function(d,e,m){d+=d.indexOf("?")>=0?"&":"?";var l="json"+ ++f;b[l]=function(q){e(q);b[l]=
null;try{delete b[l]}catch(p){}};k(d+(m?m:"callback")+"="+l);return l}}}();
GRUNT.XHR=function(){var k={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},f={JSON:["json"],PDON:["pdon.txt"]},a=["TEXT","STREAM"],b=/^(\w+:)?\/\/([^\/?#]+)/,d={XML:function(l){return l.responseXML},JSON:function(l){try{return JSON.parse(l.responseText)}catch(q){GRUNT.Log.error("Error parsing JSON data: ",l.responseText);GRUNT.Log.exception(q)}return""},PDON:function(l){return GRUNT.Data.parse({data:l.responseText,format:"PDON"})},DEFAULT:function(l){return l.responseText}},
e={CONTENT_TYPE:"Content-Type"},m=GRUNT.newModule({id:"GRUNT.xhr",ajaxSettings:{xhr:null},ajax:function(l){try{l=GRUNT.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},m.ajaxSettings,l);var q=b.exec(l.url),p=q&&(q[1]&&q[1]!==location.protocol||q[2]!==location.host);if(l.data)l.method="POST";if(l.url){q=null;if(l.xhr)q=l.xhr(l);q||(q=new XMLHttpRequest);q.open(l.method,l.url,l.async);l.data&&q.setRequestHeader("Content-Type",
l.contentType);p||q.setRequestHeader("X-Requested-With","XMLHttpRequest");q.onreadystatechange=function(){if(this.readyState===4){var r=null,o=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(o)if(l.handleResponse)l.handleResponse(this);else{var n=l,s=this.getResponseHeader(e.CONTENT_TYPE),u,h=false;for(u in k)if(s&&s.indexOf(k[u])>=0){h=true;break}s=!h;for(h=0;h<a.length;h++)s=s||a[h]==u;if(s)b:{s=u;for(var t in f)for(h=
0;h<f[t].length;h++)if(RegExp(f[t][h]+"$","i").test(n.url)){u=t;break b}u=s?s:"DEFAULT"}try{r=d[u](this,n)}catch(v){GRUNT.Log.warn("error applying processor '"+u+"' to response type, falling back to default");r=d.DEFAULT(this,n)}}else l.error&&l.error(this)}catch(w){GRUNT.Log.exception(w,"PROCESSING AJAX RESPONSE")}o&&r&&l.success&&l.success.call(this,r)}};q.send(l.method=="POST"?m.param(l.data):null)}else GRUNT.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(g){GRUNT.Log.exception(g)}},
param:function(l){var q=[],p=function(r,o){o=GRUNT.isFunction(o)?o():o;q[q.length]=encodeURIComponent(r)+"="+encodeURIComponent(o)};if(GRUNT.isArray(l))for(var g=0;g<l.length;g++)p(l[g].name,l[g].value);else for(g in l)p(g,l[g]);return q.join("&").replace(/%20/g,"+")}});return m}();
GRUNT.XPath=function(){function k(d){for(var e=null,m=0;m<f.length;m++)if(e=f[m](d))break;return e}var f=[],a=[null,function(d){return d.numberValue},function(d){return d.stringValue},function(d){return d.booleanValue},null,null,null,null,function(d){return d.singleNodeValue?d.singleNodeValue.textContent:null},function(d){return d.singleNodeValue?d.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||GRUNT.Log.warn("No XPATH support, this is going to cause problems");var b={SearchResult:function(d){return{toString:function(){var e=
null;if(d){var m=null;if(d.resultType>=0&&d.resultType<a.length)m=a[d.resultType];if(m){GRUNT.Log.info("invoking match handler for result type: "+d.resultType);e=m(d)}}return e?e:""}}},first:function(d,e){var m=b.SearchResult,l;var q=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!q)q=XPathResult.ANY_TYPE;try{if(GRUNT.isXmlDocument(e))l=e.evaluate(d,e,k,q,null);else{GRUNT.Log.warn("attempted xpath expression: "+d+" on a non-xml document");l=null}}catch(p){GRUNT.Log.warn("attempted to run invalid xpath expression: "+
d+" on node: "+e);l=null}return new m(l)},registerResolver:function(d){f.push(d)}};return b}();
GRUNT.observable=function(k){if(k){if(!k.observableHandlers)k.observableHandlers={};if(!(k.bind||k.trigger||k.unbind)){k.bind=function(f,a){var b=GRUNT.generateObjectID("callback"),d=k.observableHandlers;d[f]||(d[f]=[]);k.observableHandlers[f].push({callback:a,callbackId:b});return b};k.trigger=function(f){var a=k.observableHandlers[f];if(!a)return k;for(var b=a.length;b--;)a[b].callback.apply(self,Array.prototype.slice.call(arguments,1));return k};k.unbind=function(f,a){for(var b=k.observableHandlers[f],
d=0;b&&d<b.length;d++)if(b[d].callbackId===a){b.splice(d,1);break}return k}}}};GRUNT.WaterCooler=function(){var k={},f=[];return{addPipe:function(a){a("pipe.test",{});f.push(a)},listen:function(a,b){k[a]||(k[a]=[]);b&&k[a].push(b)},say:function(a,b){var d;for(d=f.length;d--;)f[d](a,b);if(k[a])for(d=k[a].length;d--;)k[a][d](b)},leave:function(){}}}();
GRUNT.Storage=function(){function k(f){if(f&&f=="session")return sessionStorage;return localStorage}return{get:function(f,a){var b=k(a).getItem(f);return/^(\{|\[).*(\}|\])$/.test(b)?JSON.parse(b):b},set:function(f,a,b){a=jQuery.isArray(a)||jQuery.isPlainObject(a)?JSON.stringify(a):a;k(b).setItem(f,a)},remove:function(f,a){k(a).removeItem(f)}}}();
T5=function(){var k={ex:GRUNT.extend,newCanvas:function(f,a){var b=document.createElement("canvas");typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(b);b.width=f?f:0;b.height=a?a:0;return b},time:function(){return(new Date).getTime()},Settings:function(){var f={};return{get:function(a){return f[a]},set:function(a,b){f[a]=b},extend:function(a){T5.ex(f,a)}}}(),Vector:function(f,a){return{x:f?f:0,y:a?a:0}},V:function(){function f(a){if(!a||a.length<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");
for(var b={edges:Array(a.length-1),accrued:Array(a.length-1),total:0},d=T5.V.diff,e=0;e<a.length-1;e++){var m=d(a[e],a[e+1]);b.edges[e]=Math.sqrt(m.x*m.x+m.y*m.y);b.accrued[e]=b.total+b.edges[e];b.total+=b.edges[e]}return b}return{create:function(a,b){return new k.Vector(a,b)},add:function(){for(var a=new k.Vector,b=arguments.length;b--;){a.x+=arguments[b].x;a.y+=arguments[b].y}return a},absSize:function(a){return Math.max(Math.abs(a.x),Math.abs(a.y))},diff:function(a,b){return new k.Vector(a.x-b.x,
a.y-b.y)},copy:function(a){return a?new k.Vector(a.x,a.y):null},invert:function(a){return new T5.Vector(-a.x,-a.y)},offset:function(a,b,d){return new T5.Vector(a.x+b,a.y+(d?d:b))},edges:f,distance:function(a){return f(a).total},theta:function(a,b,d){d=Math.asin((a.y-b.y)/d);return a.x>b.x?d:Math.PI-d},pointOnEdge:function(a,b,d,e){b=new T5.Vector(Math.cos(d)*e,Math.sin(d)*e);return new T5.Vector(a.x-b.x,a.y-b.y)},getRect:function(a){var b=a.length;if(b>1)return new T5.Rect(Math.min(a[0].x,a[b-1].x),
Math.min(a[0].y,a[b-1].y),Math.abs(a[0].x-a[b-1].x),Math.abs(a[0].y-a[b-1].y))},toString:function(a){return a.x+", "+a.y}}}(),Dimensions:function(f,a){return{width:f?f:0,height:a?a:0}},D:function(){return{getAspectRatio:function(f){return f.height!==0?f.width/f.height:1},getCenter:function(f){return new k.Vector(f.width/2,f.height/2)},getSize:function(f){return Math.sqrt(Math.pow(f.width,2)+Math.pow(f.height,2))}}}(),Rect:function(f,a,b,d){return{origin:new k.Vector(f,a),dimensions:new k.Dimensions(b,
d)}},R:function(){return{copy:function(f){return f?new k.Rect(f.origin.x,f.origin.y,f.dimensions.width,f.dimensions.height):null},getCenter:function(f){return new T5.Vector(f.origin.x+f.dimensions.width/2,f.origin.y+f.dimensions.height/2)}}}()};return k}();
T5.Device=function(){function k(){for(;g.length>0;){var o=g.shift();document.location=o}p=0}function f(o){for(var n=true,s=r.length;s--;)n=n&&o!=r[s];return n}function a(o,n){var s=[];for(var u in n)u&&s.push(u+"="+escape(n[u]));return"tile5://"+o+"/"+(s.length>0?"?"+s.join("&"):"")}function b(o,n){f(o)&&GRUNT.Log.info("would push url: "+a(o,n))}function d(o,n){if(f(o)){g.push(a(o,n));p||(p=setTimeout(k,100))}}function e(){m={base:{name:"Unknown",eventTarget:document,supportsTouch:"createTouch"in
document,imageCacheMaxSize:4096,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:b,targetFps:null},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:d,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:d},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:d},android:{name:"Android OS <= 2.1",regex:/android/i,eventTarget:document.body,
supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},bridgeNotify:d},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:d}};l=[m.froyo,m.android,m.ipod,m.iphone,m.ipad]}var m=null,l=[],q=null,p=0,g=[],r=["view.wake","tile.loaded"];return{getConfig:function(){m||e();if(!q){GRUNT.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var o=0;o<l.length;o++){var n=l[o];if(n.regex&&n.regex.test(navigator.userAgent)){q=
T5.ex({},m.base,n);GRUNT.Log.info("PLATFORM DETECTED AS: "+q.name);break}}if(!q){GRUNT.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");q=m.base}GRUNT.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return q}}}();
T5.Resources=function(){var k="",f={},a=function(){function d(){var v=p[this.id];if(v&&v.image.complete&&v.image.width>0){v.loaded=true;v.hitCount=1;for(var w=o.length;w--;)if(o[w].image.src==this.src){o.splice(w,1);break}v.loadCallback&&v.loadCallback(this,false);n.push({url:this.src,created:v.requested});delete p[this.id];e()}}function e(){for(var v=T5.Device.getConfig().maxImageLoads;r.length>0&&(!v||o.length<v);){var w=r.shift();if(w.imageLoader){o.push(w);w.imageLoader(w,d)}}}function m(v){for(var w=
null,x=s.length;x--&&!w;)w=s[x](v);return w?w:function(A,D){A.image.onload=D;A.image.src=b.getPath(A.url);A.requested=T5.time()}}function l(){h=true;try{var v=Math.floor(n.length/2);if(v>0){n.sort(function(x,A){return x.created-A.created});for(var w=v;w--;)delete q[n[w].url];n.splice(0,v)}}finally{h=false}GRUNT.WaterCooler.say("imagecache.cleared")}var q={},p={},g=0,r=[],o=[],n=[],s=[],u=0,h=false,t={loadingImages:o,queuedImages:r,addInterceptor:function(v){s.push(v)},getCacheFullness:function(){return u},
getImage:function(v){var w=null;h||(w=q[v]);return w?w.image:null},loadImage:function(v,w){var x=q[v];if(x){x.hitCount++;x.image.complete&&w&&w(x.image,true)}else{x={url:v,image:new Image,loaded:false,imageLoader:m(v),created:T5.time(),requested:null,hitCount:0,loadCallback:w};x.image.id="resourceLoaderImage"+g++;q[v]=x;p[x.image.id]=x;r.push(x);e()}return x},resetLoadingQueue:function(){o=[]}};setInterval(function(){for(var v=T5.time(),w=false,x=0,A=T5.Device.getConfig();x<o.length;)if(v-o[x].requested>
b.loadTimeout*1E3){o.splice(x,1);w=true}else x++;w&&e();if(A&&A.imageCacheMaxSize){u=n.length*b.avgImageSize/A.imageCacheMaxSize;u>=1&&l()}},1E3);return t}(),b={avgImageSize:25,loadTimeout:10,Cache:function(){return{read:function(){return null},write:function(){},getUrlCacheKey:function(d,e){for(var m=(d?d.replace(/^.*\?/,""):"").split("&"),l=d?d.replace(/\?.*$/,"?"):"",q=0;q<m.length;q++){var p=m[q].split("=");if(!e||!e.test(p[0]))l+=m[q]+"&"}return l.replace(/\W/g,"")},isValidCacheKey:function(d){GRUNT.Log.info("cache key = "+
d);return false}}}(),addInterceptor:a.addInterceptor,getPath:function(d){return/^(file|https?|\/)/.test(d)?d:k+d},setBasePath:function(d){k=d},getImage:function(d){return a.getImage(d)},loadImage:function(d,e){a.loadImage(d,e)},resetImageLoadQueue:function(){a.resetLoadingQueue()},getStats:function(){return{imageLoadingCount:a.loadingImages.length,queuedImageCount:a.queuedImages.length,imageCacheFullness:a.getCacheFullness()}},loadResource:function(d){d=T5.ex({filename:"",cacheable:true,dataType:null,
callback:null},d);var e=function(m){d.callback&&GRUNT.Log.watch("CALLING RESOURCE CALLBACK",function(){d.callback(m)})};d.cacheable&&f[d.filename]?e(f[d.filename]):GRUNT.XHR.ajax({url:b.getPath(d.filename),dataType:d.dataType,success:function(m){if(d.cacheable)f[d.filename]=m;e(m)},error:function(m,l,q){GRUNT.Log.error("error loading resource ["+d.filename+"], error = "+q)}})},loadSnippet:function(d,e){/\.\w+$/.test(d)||(d+=".html");b.loadResource({filename:"snippets/"+d,callback:e,dataType:"html"})}};
return b}();
T5.Touch=function(){function k(n,s){var u=n&&n.length>0?n[0]:null;if(u&&s&&s.length>0)return T5.V.diff(u,s[0]);return null}function f(n){n.preventDefault();n.stopPropagation()}function a(n){for(var s=Array(n.length),u=n.length;u--;)s[u]=new T5.Vector(n[u].pageX,n[u].pageY);return s}function b(n){return[new T5.Vector(n.pageX,n.pageY)]}var d=120,e=100,m=250,l={TAP:0,MOVE:1,PINCHZOOM:2},q=7,p=0,g=0,r=function(n){function s(z,C,G,O){var L=Math.asin((z.y-C.y)/G);G=Math.min(Math.floor(G*(W.duration/O)),
W.max);L=C.x>z.x?L:Math.PI-L;z=new T5.Vector(Math.cos(L)*-G,Math.sin(L)*G);t("inertiaPan",z.x,z.y)}function u(z,C){var G,O;if(M){G=C-Y;if(G<m){O=T5.V.distance([F[0],z]);O>n.inertiaTrigger&&s(F[0],z,O,G)}}else{$=z;var L=setInterval(function(){G=T5.time()-C;O=T5.V.distance([z,$]);if(G<e&&O>n.inertiaTrigger){clearInterval(L);s(z,$,O,G)}else G>e&&clearInterval(L)},5)}}function h(z){for(var C=[],G=n.element?-n.element.offsetLeft:0,O=n.element?-n.element.offsetTop:0,L=z.length;L--;)C.push(T5.V.offset(z[L],
G,O));return C}function t(){n.observable&&n.observable.trigger.apply(null,arguments)}function v(z){if(z.target&&z.target===n.element){F=M?a(z.touches):b(z);N=new T5.Vector;V=new T5.Vector;Z=true;D=false;Y=T5.time();M&&f(z);t("inertiaCancel");U.current=Y;if(z=F.length>0?F[0]:null){t("touchStart",z.x,z.y);if(U.current-U.last<K.THRESHOLD_DOUBLETAP)if((z=S?T5.V.diff(F[0],S[0]):null)&&Math.abs(z.x)<n.maxDistDoubleTap&&Math.abs(z.y)<n.maxDistDoubleTap)D=true;P=l.TAP;S=[].concat(F)}else GRUNT.Log.warn("Touch start fired, but no touch vector found")}}
function w(z){if(z.target&&z.target===n.element){$=(M?a(z.touches):b(z))[0];if(Z)try{M&&f(z);var C=M?a(z.touches):b(z);z=0;if(C.length>1){if(F.length===1)F=[].concat(C);z=T5.V.distance(F)-T5.V.distance(C)}if(P===l.TAP){var G=k(C,F);if(G&&(Math.abs(G.x)>=q||Math.abs(G.y)>=q))P=l.MOVE}if(P!==l.TAP)if(!z||Math.abs(z)<n.pinchZoomThreshold){if(N=k(C,S)){V.x-=N.x;V.y-=N.y;Q.x-=N.x;Q.y-=N.y}if(T5.V.absSize(Q)>n.panEventThreshhold){t("pan",Q.x,Q.y);Q=T5.V.create()}P=l.MOVE}else{t("pinchZoom",h(F),h(C));P=
l.PINCHZOOM}S=[].concat(C)}catch(O){GRUNT.Log.exception(O)}}}function x(z){if(z.target&&z.target===n.element){var C=(M?a(z.changedTouches):b(z))[0];try{M&&f(z);var G=T5.time();U.last=U.current;if(P===l.TAP)J||(J=setTimeout(function(){J=0;var L=D?"doubleTap":"tap",H=F[0],y=null;if(n.element)y=T5.V.offset(H,-n.element.offsetLeft,-n.element.offsetTop);t(L,H,y)},K.THRESHOLD_DOUBLETAP+50));else if(P==l.MOVE){t("panEnd",V.x,V.y);W&&u(C,G)}else P==l.PINCHZOOM&&t("pinchZoomEnd",h(F),h(S),G-Y)}catch(O){GRUNT.Log.exception(O)}}Z=
false}function A(z){if(z.target&&z.target===n.element){var C;if(z.detail){C=-z.detail*d;C=new T5.Vector(z.axis===1?C:0,z.axis===2?C:0)}else C=new T5.Vector(z.wheelDeltaX,z.wheelDeltaY);var G=C.y!==0?Math.abs(C.y/d):0;if($&&G!==0){var O=T5.V.offset($,-n.element.offsetLeft,-n.element.offsetTop);t("wheelZoom",O,Math.pow(2,C.y>0?G:-G))}z.preventDefault()}}n=T5.ex({element:null,observable:null,inertiaTrigger:20,maxDistDoubleTap:20,panEventThreshhold:0,pinchZoomThreshold:5,touchStartHandler:null,moveHandler:null,
moveEndHandler:null,pinchZoomHandler:null,pinchZoomEndHandler:null,tapHandler:null,doubleTapHandler:null,wheelZoomHandler:null},n);var D=false,J=0,M=T5.Device.getConfig().supportsTouch,F=null,S=null,N=null,V=null,Q=new T5.Vector,P=null,Z=false,Y=0,X=[],$=null,W=null,U={current:0,last:0},R=T5.Device.getConfig(),K={supportsTouch:M,THRESHOLD_DOUBLETAP:300,addListeners:function(z){X.push(z)},decoupleListeners:function(z){for(var C=0;z&&C<X.length;C++)if(X[C].listenerId===z){X.splice(C,1);GRUNT.Log.info("successfully decoupled touch listener: "+
z);break}},release:function(){R.eventTarget.removeEventListener(R.supportsTouch?"touchstart":"mousedown",v,false);R.eventTarget.removeEventListener(R.supportsTouch?"touchmove":"mousemove",w,false);R.eventTarget.removeEventListener(R.supportsTouch?"touchend":"mouseup",x,false);if(!R.supportsTouch){window.removeEventListener("mousewheel",A,false);window.removeEventListener("DOMMouseScroll",A,false)}},inertiaEnable:function(z,C){W={duration:z,max:C?Math.min(C.width,C.height):500}},inertiaDisable:function(){W=
null}};R.eventTarget.addEventListener(R.supportsTouch?"touchstart":"mousedown",v,false);R.eventTarget.addEventListener(R.supportsTouch?"touchmove":"mousemove",w,false);R.eventTarget.addEventListener(R.supportsTouch?"touchend":"mouseup",x,false);if(!R.supportsTouch){window.addEventListener("mousewheel",A,false);window.addEventListener("DOMMouseScroll",A,false)}return K},o=[];return{capture:function(n,s){if(!n)throw Error("Unable to capture touch of null element");if(!n.id)n.id="touchable_"+p++;var u=
o[n.id];if(!u){u=new r(T5.ex({element:n},s));o[n.id]=u;GRUNT.Log.info("CREATED TOUCH HELPER. SUPPORTS TOUCH = "+u.supportsTouch)}s.listenerId&&u.decoupleListeners(s.listenerId);s.listenerId=++g;u.addListeners(s);return u},resetTouch:function(n){if(n&&n.id&&o[n.id]){o[n.id].release();delete o[n.id]}}}}();if(typeof jQuery!=="undefined"){jQuery.fn.canTouchThis=function(k){return this.each(function(){T5.Touch.capture(this,k)})};jQuery.fn.untouchable=function(){return this.bind("touchmove",function(k){k.preventDefault()})}}
T5.Dispatcher=function(){var k=[],f={execute:function(a){var b=f.findAction(a);GRUNT.Log.info("looking for action id: "+a+", found: "+b);if(b){var d=[].concat(arguments).slice(0,1);GRUNT.Log.watch("EXECUTING ACTION: "+a,function(){b.execute(d)})}},findAction:function(a){for(var b=k.length;b--;)if(k[b].id==a)return k[b];return null},getRegisteredActions:function(){return[].concat(k)},getRegisteredActionIds:function(){for(var a=[],b=k.length;b--;)k[b].id&&a.push(k[b].id);return a},registerAction:function(a){a&&
a.id&&k.push(a)},Action:function(a){a=T5.ex({autoRegister:true,id:"",title:"",icon:"",execute:null},a);var b={id:a.id,execute:function(){a.execute&&a.execute.apply(this,arguments)},getParam:function(d){return a[d]?a[d]:""},toString:function(){return String.format("{0} [title = {1}, icon = {2}]",b.id,a.title,a.icon)}};a.autoRegister&&f.registerAction(b);return b},createAgent:function(a){a=T5.ex({name:"Untitled",trashOrphanedResults:true,translator:null,execute:null},a);var b=null,d={getName:function(){return a.name},
getParam:function(e){return a[e]},getId:function(){return GRUNT.toID(d.getName())},run:function(e,m){if(a.execute){var l=b=T5.time(),q=a.translator?a.translator(e):e;a.execute.call(d,q,function(p,g){if(!a.trashOrphanedResults||l==b)m&&m(p,g,q)})}}};return d},runAgents:function(a,b,d){for(var e=0;e<a.length;e++)a[e].run(b,d)}};return f}();
T5.Easing=function(){var k=1.70158;return{Linear:function(f,a,b,d){return b*f/d+a},Back:{In:function(f,a,b,d){return b*(f/=d)*f*((k+1)*f-k)+a},Out:function(f,a,b,d){return b*((f=f/d-1)*f*((k+1)*f+k)+1)+a},InOut:function(f,a,b,d){return(f/=d/2)<1?b/2*f*f*(((k*=1.525)+1)*f-k)+a:b/2*((f-=2)*f*(((k*=1.525)+1)*f+k)+2)+a}},Bounce:{In:function(f,a,b,d){return b-module.Easing.Bounce.Out(d-f,0,b,d)+a},Out:function(f,a,b,d){return(f/=d)<1/2.75?b*7.5625*f*f+a:f<2/2.75?b*(7.5625*(f-=1.5/2.75)*f+0.75)+a:f<2.5/
2.75?b*(7.5625*(f-=2.25/2.75)*f+0.9375)+a:b*(7.5625*(f-=2.625/2.75)*f+0.984375)+a},InOut:function(f,a,b,d){return f<d/2?module.Easing.Bounce.In(f*2,0,b,d)/2+a:module.Easing.Bounce.Out(f*2-d,0,b,d)/2+b/2+a}},Cubic:{In:function(f,a,b,d){return b*(f/=d)*f*f+a},Out:function(f,a,b,d){return b*((f=f/d-1)*f*f+1)+a},InOut:function(f,a,b,d){if((f/=d/2)<1)return b/2*f*f*f+a;return b/2*((f-=2)*f*f+2)+a}},Elastic:{In:function(f,a,b,d,e,m){if(f==0)return a;if((f/=d)==1)return a+b;m||(m=d*0.3);if(!e||e<Math.abs(b)){e=
b;b=m/4}else b=m/(2*Math.PI)*Math.asin(b/e);return-(e*Math.pow(2,10*(f-=1))*Math.sin((f*d-b)*2*Math.PI/m))+a},Out:function(f,a,b,d,e,m){var l;if(f==0)return a;if((f/=d)==1)return a+b;m||(m=d*0.3);if(!e||e<Math.abs(b)){e=b;l=m/4}else l=m/(2*Math.PI)*Math.asin(b/e);return e*Math.pow(2,-10*f)*Math.sin((f*d-l)*2*Math.PI/m)+b+a},InOut:function(f,a,b,d,e,m){var l;if(f==0)return a;if((f/=d/2)==2)return a+b;m||(m=d*0.3*1.5);if(!e||e<Math.abs(b)){e=b;l=m/4}else l=m/(2*Math.PI)*Math.asin(b/e);if(f<1)return-0.5*
e*Math.pow(2,10*(f-=1))*Math.sin((f*d-l)*2*Math.PI/m)+a;return e*Math.pow(2,-10*(f-=1))*Math.sin((f*d-l)*2*Math.PI/m)*0.5+b+a}},Quad:{In:function(f,a,b,d){return b*(f/=d)*f+a},Out:function(f,a,b,d){return-b*(f/=d)*(f-2)+a},InOut:function(f,a,b,d){if((f/=d/2)<1)return b/2*f*f+a;return-b/2*(--f*(f-2)-1)+a}},Sine:{In:function(f,a,b,d){return-b*Math.cos(f/d*(Math.PI/2))+b+a},Out:function(f,a,b,d){return b*Math.sin(f/d*(Math.PI/2))+a},InOut:function(f,a,b,d){return-b/2*(Math.cos(Math.PI*f/d)-1)+a}}}}();
T5.Animation=function(){function k(){if(b===0)b=setInterval(function(){var e;e=T5.time();if(!a){a=true;try{for(var m=0;m<f.length;)if(f[m].isComplete()){f[m].triggerComplete(false);f.splice(m,1)}else{f[m].update(e);m++}}finally{a=false}}e=f.length;if(e===0){clearInterval(b);b=0}},20)}var f=[],a=false,b=0,d={DURATION:2E3,tweenValue:function(e,m,l,q,p){e=new d.Tween({startValue:e,endValue:m,tweenFn:l,complete:q,duration:p});f.push(e);return e},tween:function(e,m,l,q,p,g){e=new d.Tween({target:e,property:m,
endValue:l,tweenFn:q,duration:g,complete:p});f.push(e);return e},tweenVector:function(e,m,l,q,p,g){var r=[];if(e){var o=e.x==m,n=e.y==l;o||r.push(d.tween(e,"x",m,q,function(){(o=true)&&n&&p()},g));n||r.push(d.tween(e,"y",l,q,function(){n=true;o&&n&&p()},g))}return r},cancel:function(e){if(!a){a=true;try{for(var m=0;m<f.length;)if(!e||e(f[m])){f[m].triggerComplete(true);f.splice(m,1)}else m++}finally{a=false}}},isTweening:function(){return f.length>0},Tween:function(e){e=T5.ex({target:null,property:null,
startValue:0,endValue:null,duration:d.DURATION,tweenFn:d.DEFAULT,complete:null,cancelOnInteract:false},e);var m=T5.time(),l=[],q=false,p=0,g=0,r={cancelOnInteract:e.cancelOnInteract,isComplete:function(){return q},triggerComplete:function(o){e.complete&&e.complete(o)},update:function(o){try{var n=e.tweenFn(o-m,p,g,e.duration);if(e.target)e.target[e.property]=n;for(var s=l.length;s--;)l[s](n,void 0);if(q=m+e.duration<=o){if(e.target)e.target[e.property]=e.tweenFn(e.duration,p,g,e.duration);for(var u=
l.length;u--;)l[u](n,true)}}catch(h){GRUNT.Log.exception(h)}},requestUpdates:function(o){l.push(o)}};p=e.target&&e.property&&e.target[e.property]?e.target[e.property]:e.startValue;if(typeof e.endValue!=="undefined")g=e.endValue-p;if(g==0)q=true;k();return r}};return T5.ex(d,{DEFAULT:T5.Easing.Back.Out})}();T5.ViewState=function(){var k={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,PINCHZOOM:16,FREEZE:128,get:function(){for(var f=0,a=arguments.length;a--;){var b=k[arguments[a]];if(b)f|=b}return f}};return k}();
T5.ViewLayer=function(k){k=T5.ex({id:"",centerOnScale:true,created:T5.time(),scalePosition:true,zindex:0,supportFastDraw:false,validStates:T5.ViewState.get("ACTIVE","ANIMATING","PAN","PINCHZOOM")},k);var f=null,a=k.id,b=T5.ViewState.get("ACTIVE"),d=T5.ex({addToView:function(e){e.setLayer(a,d)},shouldDraw:function(e){var m=f?f.fastDraw&&e!==b:false;return(e&k.validStates)!==0&&(m?k.supportFastDraw:true)},cycle:function(){return 0},draw:function(){},remove:function(){GRUNT.WaterCooler.say("layer.remove",
{id:a})},wakeParent:function(){f&&f.trigger("wake")},getId:function(){return a},setId:function(e){a=e},getParent:function(){return f},setParent:function(e){f=e}},k);return d};
T5.View=function(k){function f(y,B,E,I){N=typeof E!=="undefined";H.updateOffset(h.x+y,h.y+B,E,I);o();L=T5.ViewState.PAN}function a(){L=T5.ViewState.ACTIVE;N=false;setTimeout(o,50)}function b(y,B){U=T5.V.getRect(y);R=T5.V.getRect(B);var E=T5.D.getSize(U.dimensions),I=T5.D.getSize(R.dimensions);G=T5.R.getCenter(U);F=T5.R.getCenter(R);K=U&&E!==0?I/E:1}function d(){GRUNT.WaterCooler.say("view.scale",{id:H.id});W=false;H.trigger("scale",K,U?q():F);L=T5.ViewState.ACTIVE;o()}function e(){if(s){T5.Touch.resetTouch(s);
if(k.autoSize){s.height=window.innerHeight-s.offsetTop;s.width=window.innerWidth-s.offsetLeft}try{u=s.getContext("2d");u.globalCompositeOperation=k.initialDrawMode;u.clearRect(0,0,s.width,s.height)}catch(y){GRUNT.Log.exception(y);throw Error("Could not initialise canvas on specified view element");}O=T5.Touch.capture(s,{observable:H});k.inertia&&O.inertiaEnable(k.panAnimationDuration,A);A=H.getDimensions();D=T5.D.getCenter(A);o()}}function m(y,B){B.setId(y);B.setParent(H);n.push(B);n.sort(function(E,
I){var T=I.zindex-E.zindex;if(T===0)T=I.created-E.created;return T})}function l(y,B,E,I,T,ca,aa){function da(){ca&&ca();d();K=1;C=null}W=true;G=T5.V.copy(E);F=T5.V.copy(I);U=null;if(T)T5.Animation.tweenValue(0,B-y,T,da,aa?aa:1E3).requestUpdates(function(ba){C=ba/(B-y);K=y+ba;L=T5.ViewState.PINCHZOOM;o();H.trigger("animate")});else{K=targetScaleFactor;da()}}function q(){var y=T5.D.getCenter(A),B=T5.V.distance([F,y]),E=T5.V.theta(F,y,B),I=T5.V.diff(G,F);y=T5.V.pointOnEdge(F,y,E,B/K);y.x+=I.x;y.y+=I.y;
return y}function p(){H.trigger("idle");S=true;P=0}function g(y,B){var E=0,I=H.getDisplayState(),T=T5.time(),ca=(I&T5.ViewState.PINCHZOOM)!==0,aa=0;if(t||ca){y.clearRect(0,0,s.width,s.height);t=false}if(ca){T5.D.getCenter(A);var da=(C?C:1)/2,ba=T5.V.diff(G,F);if(Y=U?new T5.Vector(F.x+ba.x,F.y+ba.y):new T5.Vector(F.x-ba.x*da,F.y-ba.y*da))B=T5.V.offset(B,Y.x,Y.y)}y.save();try{z=K;if(x!==1)y.scale(x,x);else if(ca){y.translate(F.x,F.y);y.scale(K,K)}for(aa=n.length;aa--;)if(n[aa].shouldDraw(I)){var ea=
n[aa].draw(y,B,A,I,H);E+=ea?ea:0}}finally{y.restore()}GRUNT.Log.trace("draw complete",T);Q=false;return E}function r(){var y=0,B=!N&&(L===T5.ViewState.PINCHZOOM||L===T5.ViewState.PAN);X=T5.time();h.x=Math.floor(h.x);h.y=Math.floor(h.y);M&&v&&M.delays.push(X-v);if(B){T5.Animation.cancel(function(I){return I.cancelOnInteract});S=false;if(P!==0){clearTimeout(P);P=0}}for(B=n.length;B--;){var E=n[B].cycle(X,h,L);y+=E?E:0}if(v+$<X){y+=g(u,h);v=X}V=0;if(J+y>0)o();else if(!S&&P===0)P=setTimeout(p,500);GRUNT.Log.trace("Completed draw cycle",
X)}function o(){J++;if(!(w||V!==0)){J=0;V=setTimeout(r,0)}}k=T5.ex({id:GRUNT.generateObjectID("view"),container:"",clearOnDraw:false,scaleDamping:false,fastDraw:false,fillStyle:"rgb(200, 200, 200)",initialDrawMode:"source-over",bufferRefresh:100,defaultFreezeDelay:500,inertia:true,panAnimationEasing:T5.Easing.Sine.Out,panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:false},k);var n=[],s=document.getElementById(k.container),u=null,h=new T5.Vector,t=false,v=null,
w=false,x=1,A=null,D=null,J=0,M=null,F=null,S=false,N=false,V=0,Q=false,P=0,Z=0,Y=null,X=0;T5.Device.getConfig();var $=0,W=false,U=null,R=null,K=1,z=1,C=null,G=null,O=null,L=T5.ViewState.ACTIVE,H={id:k.id,deviceScaling:x,fastDraw:k.fastDraw||T5.Device.getConfig().requireFastDraw,animate:function(y,B,E,I,T){l(K,y,B,E,I,T)},centerOn:function(y){H.setOffset(y.x-s.width/2,y.y-s.height/2)},getDimensions:function(){if(s)return new T5.Dimensions(s.width,s.height)},getZoomCenter:function(){return Y},getLayer:function(y){for(var B=
0;B<n.length;B++)if(n[B].getId()==y)return n[B];return null},setLayer:function(y,B){for(var E=0;E<n.length;E++)if(n[E].getId()===y){n.splice(E,1);break}B&&m(y,B);GRUNT.WaterCooler.say("layer.update",{id:y});o()},eachLayer:function(y){for(var B=0;B<n.length;B++)y(n[B])},clearBackground:function(){t=true},freeze:function(){w=true},unfreeze:function(){w=false;o()},needRepaint:function(){return Q},snapshot:function(){},getDisplayState:function(){return w?T5.ViewState.FROZEN:L},scale:function(y,B,E,I,
T){I||(I=T5.D.getCenter(A));T||(T=T5.D.getCenter(A));H.animate(y,I,T,B,E);return H},removeLayer:function(y){a:{for(var B=n.length;B--;)if(n[B].getId()==y){y=B;break a}y=-1}if(y>=0&&y<n.length){GRUNT.WaterCooler.say("layer.removed",{layer:n[y]});n.splice(y,1)}},getOffset:function(){return T5.V.copy(h)},setOffset:function(y,B){h.x=y;h.y=B},updateOffset:function(y,B,E,I){function T(){a(0,0)}if(E){y=new T5.Vector(y,B);E=T5.Animation.tweenVector(h,y.x,y.y,E,T,I);for(I=E.length;I--;){E[I].cancelOnInteract=
true;E[I].requestUpdates(function(){o();k.onAnimate&&k.onAnimate(h.x,h.y)})}}else H.setOffset(y,B)},zoom:function(y,B,E){N=false;K=B;W=K!==1;G=T5.D.getCenter(H.getDimensions());F=K>1?T5.V.copy(y):T5.D.getCenter(H.getDimensions());U=null;clearTimeout(Z);if(W){L=T5.ViewState.PINCHZOOM;o();if(E)Z=setTimeout(function(){d();K=1},parseInt(E,10))}}};GRUNT.WaterCooler.listen("layer.remove",function(y){y.id&&H.removeLayer(y.id)});x=T5.Device.getConfig().getScaling();GRUNT.observable(H);H.bind("wake",o);H.bind("invalidate",
function(){Q=true});H.bind("pan",f);H.bind("panEnd",a);H.bind("pinchZoom",function(y,B){b(y,B);if(W=K!==1){L=T5.ViewState.PINCHZOOM;o()}});H.bind("pinchZoomEnd",function(y,B,E){b(y,B);if(k.adjustScaleFactor){K=k.adjustScaleFactor(K);GRUNT.Log.info("scale factor adjusted to: "+K)}if(E<k.pinchZoomAnimateTrigger){l(z,K,G,q(),T5.Easing.Sine.Out,function(){d();K=1},300);K=z}else{d();K=1}});H.bind("wheelZoom",function(y,B){H.zoom(y,Math.min(Math.pow(2,Math.round(Math.log(B))),8),500)});H.bind("inertiaPan",
function(y,B){k.inertia&&f(y,B,k.panAnimationEasing,k.panAnimationDuration)});H.bind("inertiaCancel",function(){N=false;o()});GRUNT.configurable(H,["inertia","container"],GRUNT.paramTweaker(k,null,{container:function(y,B){s=document.getElementById(B);e()}}),true);e();return H};
T5.AnimatedPathLayer=function(k){function f(l,q,p){l.fillStyle="#FFFFFF";l.strokeStyle="#222222";l.beginPath();l.arc(p.x,p.y,4,0,Math.PI*2,false);l.stroke();l.fill()}k=T5.ex({path:[],id:GRUNT.generateObjectID("pathAnimation"),easing:T5.Easing.Sine.InOut,validStates:T5.ViewState.get("ACTIVE","PAN","PINCHZOOM"),drawIndicator:null,duration:2E3,autoCenter:false},k);var a=T5.V.edges(k.path),b,d=null,e=0;T5.Animation.tweenValue(0,a.total,k.easing,function(){m.remove()},k.duration).requestUpdates(function(l,
q){e=l;q&&m.remove()});var m=T5.ex(new T5.ViewLayer(k),{cycle:function(){for(var l=0;l<a.accrued.length&&a.accrued[l]<e;)l++;d=null;if(l<k.path.length-1){var q=e-(l>0?a.accrued[l-1]:0),p=k.path[l],g=k.path[l+1];b=T5.V.theta(p,g,a.edges[l]);d=T5.V.pointOnEdge(p,g,b,q);if(k.autoCenter)(l=m.getParent())&&l.centerOn(d)}return d?1:0},draw:function(l,q){if(d)(k.drawIndicator?k.drawIndicator:f)(l,q,new T5.Vector(d.x-q.x,d.y-q.y),b)}});return m};
T5.Tiling=function(){function k(){if(!a){a=T5.newCanvas(d.Config.TILESIZE,d.Config.TILESIZE);var e=a.getContext("2d");e.fillStyle="rgba(150, 150, 150, 0.01)";e.fillRect(0,0,a.width,a.height)}return a}function f(){function e(){var l=T5.newCanvas(32,32),q=l.getContext("2d");q.fillStyle="#BBBBBB";q.fillRect(0,0,32,32);q.fillStyle="#C3C3C3";q.fillRect(0,0,16,16);q.fillRect(16,16,16,16);return l}if(!b){b=T5.newCanvas(d.Config.TILESIZE,d.Config.TILESIZE);var m=b.getContext("2d");m.fillStyle=m.createPattern(e(),
"repeat");m.fillRect(0,0,b.width,b.height)}return b}TileStore=function(e){e=T5.ex({tileSize:null,gridSize:25,center:new T5.Vector,onPopulate:null},e);if(!e.tileSize)throw Error("Cannot create TileStore with an empty tile size");var m=Array(Math.pow(e.gridSize,2)),l=T5.V.offset(e.center,-Math.ceil(e.gridSize>>1)),q=null,p=new T5.Vector,g=null,r={getGridSize:function(){return e.gridSize},getNormalizedPos:function(o,n){return T5.V.add(new T5.Vector(o,n),T5.V.invert(l),p)},getTileShift:function(){return T5.V.copy(p)},
getTile:function(o,n){return o>=0&&o<e.gridSize?m[n*e.gridSize+o]:null},setTile:function(o,n,s){m[n*e.gridSize+o]=s},populate:function(o,n){var s=GRUNT.Log.getTraceTicks(),u=0,h=e.gridSize,t=e.tileSize;new T5.Vector(h/2,h/2);if(o)for(var v=0;v<h;v++)for(var w=0;w<h;w++){if(!m[u]){var x=o(w,v,l,h);x.gridX=w*t-p.x;x.gridY=v*t-p.y;m[u]=x}u++}q=o;g=n;GRUNT.Log.trace("tile grid populated",s);e.onPopulate&&e.onPopulate()},getShiftDelta:function(o,n,s,u){var h=Math.floor(e.gridSize*0.2),t=new T5.Vector;
if(o<0||o+s>e.gridSize)t.x=o<0?-h:h;if(n<0||n+u>e.gridSize)t.y=n<0?-h:h;return t},shift:function(o,n){if(!(o.x===0&&o.y===0)){var s=GRUNT.Log.getTraceTicks(),u=Array(m.length);u.length=m.length;for(var h=0;h<e.gridSize;h++)for(var t=0;t<e.gridSize;t++)u[t*e.gridSize+h]=r.getTile(h+o.x,t+o.y);m=u;l=n?n(l,o):T5.V.add(l,o);p.x+=-o.x*e.tileSize;p.y+=-o.y*e.tileSize;GRUNT.Log.trace("tile storage shifted",s);r.populate(q,g)}},setOrigin:function(o,n){if(tileOrigin)shiftOrigin(o,n);else l=T5.V.offset(new T5.Vector(o,
n),-tileHalfWidth)}};GRUNT.WaterCooler.listen("imagecache.cleared",function(){for(var o=m.length;o--;)if(m[o])m[o].loaded=false});GRUNT.WaterCooler.listen("tiler.repaint",function(){for(var o=m.length;o--;)if(m[o]){m[o].x=null;m[o].y=null}});return r};var a=null,b=null,d={Config:{TILESIZE:256,TILEBUFFER:1,TILEBUFFER_LOADNEW:0.2},Tile:function(e){return e=T5.ex({gridX:0,gridY:0,size:256,dirty:false},e)},ImageTile:function(e){e=T5.ex({url:"",sessionParamRegex:null,loaded:false},e);return new d.Tile(e)},
TileGrid:function(e){function m(x,A){if(v){var D,J=[],M=new T5.Vector(Math.floor((x.x+s.x)*p),Math.floor((x.y+s.y)*p));tilesNeeded=false;for(var F=t;F--;)for(var S=h;S--;){D=l.getTile(S+M.x,F+M.y);var N=new T5.Vector(S-v.x,F-v.y);D||(n=l.getShiftDelta(M.x,M.y,h,t));J.push({tile:D,centerness:T5.V.absSize(N)})}J.sort(function(V,Q){return Q.centerness-V.centerness});r||(r=Array(J.length));for(D=J.length;D--;){r[D]=J[D].tile;w.prepTile(r[D],A)}}}e=T5.ex({tileSize:T5.Tiling.Config.TILESIZE,drawGrid:false,
center:new T5.Vector,shiftOrigin:null,supportFastDraw:true},e);var l=new TileStore(T5.ex({tileSize:e.tileSize,onPopulate:function(){w.dirty=true;w.wakeParent()}},e)),q=Math.round(e.tileSize/2),p=e.tileSize?1/e.tileSize:0,g=true,r=null,o=false;new T5.Vector;var n=new T5.Vector,s=new T5.Vector;T5.Device.getConfig();var u=l.getGridSize()*e.tileSize,h,t,v,w=T5.ex(new T5.ViewLayer(e),{gridDimensions:new T5.Dimensions(u,u),dirty:false,cycle:function(x,A,D){x=0;if(n.x+n.y!==0){l.shift(n,e.shiftOrigin);s=
l.getTileShift();n=new T5.Vector;x++}D!==T5.ViewState.PINCHZOOM&&m(A,D);return x+w.dirty?1:0},deactivate:function(){g=false},prepTile:function(){},drawTile:function(){return false},draw:function(x,A,D,J,M){if(g){var F=T5.time(),S=A.x;A=A.y;var N=true,V=M.needRepaint()||J===T5.ViewState.PANNING||J===T5.ViewState.PINCHZOOM||T5.Animation.isTweening();if(!v){h=Math.ceil(D.width*p)+1;t=Math.ceil(D.height*p)+1;v=new T5.Vector(Math.floor((h-1)/2),Math.floor((t-1)/2))}if(r){if(e.drawGrid)x.strokeStyle="rgba(50, 50, 50, 0.3)";
x.beginPath();for(D=r.length;D--;){var Q=r[D];if(Q){var P=Q.gridX-S,Z=Q.gridY-A;N=((V?false:!Q.dirty)?true:w.drawTile(x,Q,P,Z,J))&&N}else N=false;e.drawGrid&&x.rect(P,Z,e.tileSize,e.tileSize)}x.stroke();GRUNT.Log.trace("drawn tiles",F);N&&!o&&M.trigger("tileDrawComplete");o=N;w.dirty=false}}},getTileVirtualXY:function(x,A,D){x=l.getNormalizedPos(x,A);x=new T5.Vector(x.x*e.tileSize,x.y*e.tileSize);if(D){x.x+=q;x.y+=q}return x},populate:function(x){l.populate(x,function(){})}});return w},ImageTileGrid:function(e){function m(){o.getParent().trigger("invalidate");
o.dirty=true;o.wakeParent()}e=T5.ex({},e);var l=k(),q=f(),p=T5.ViewState.ACTIVE,g=T5.ViewState.PAN,r=T5.Device.getConfig().requireFastDraw,o=T5.ex(new d.TileGrid(e),{drawTile:function(n,s,u,h,t){var v=T5.Resources.getImage(s.url),w=false;if(v&&v.complete&&v.width>0){n.drawImage(v,u,h);s.dirty=false;w=true}else t===g?n.drawImage(q,u,h):n.drawImage(l,u,h);return w},prepTile:function(n,s){if(n)n.dirty=true;if(n&&(!r||s===p))T5.Resources.getImage(n.url)||T5.Resources.loadImage(n.url,m)}});return o},Tiler:function(e){e=
T5.ex({container:"",drawCenter:false,datasources:{},tileLoadThreshold:"first"},e);var m=T5.ex(new T5.View(e),{getTileLayer:function(){return m.getLayer("grid0")},setTileLayer:function(l){m.setLayer("grid0",l);GRUNT.WaterCooler.say("grid.updated",{id:"grid0"})},viewPixToGridPix:function(l){var q=m.getOffset();return new T5.Vector(l.x+q.x,l.y+q.y)},cleanup:function(){m.removeLayer("grid0")},repaint:function(){GRUNT.WaterCooler.say("tiler.repaint");m.trigger("wake")}});return m}};return d}();
T5.Geo=function(){function k(p,g){var r=null;for(var o in l)if(g){if(o==g&&l[o][p]){r=l[o];break}}else if(l[o][p]){r=l[o];break}return r}function f(p,g,r,o){var n=0;p=p.toUpperCase();for(var s in o){var u=g[s];if(u){var h=r[s];u=h?h(p,u):p.containsWord(u)?1:0;n+=u*o[s]}}return n}var a=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],b=Math.PI/180,d=180/Math.PI,e=null,m={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",HWY:"HIGHWAY",
MWY:"MOTORWAY"},l={},q={Engine:function(p){if(!p.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var g=T5.ex({remove:function(){delete l[g.id]}},p);return l[g.id]=g},Radius:function(p,g){return{distance:parseInt(p,10),uom:g}},Position:function(p,g){return{lat:parseFloat(p?p:0),lon:parseFloat(g?g:0)}},BoundingBox:function(p,g){return{min:q.P.parse(p),max:q.P.parse(g)}},Address:function(p){return p=T5.ex({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},
p)},GeocodeFieldWeights:{streetDetails:50,location:50},AddressCompareFns:{},Utilities:function(){var p={dist2rad:function(g){return g/6371},lat2pix:function(g,r){var o=parseFloat(g)*2*Math.PI/360;o=Math.sin(o);var n=0.08181919084262157*o;return Math.log((1+o)/(1-o)*Math.pow((1-n)/(1+n),0.08181919084262157))/2/r},lon2pix:function(g,r){return parseFloat(g)/180*Math.PI/r},pix2lon:function(g,r){return p.normalizeLon(g*r*180/Math.PI)},pix2lat:function(g,r){for(var o=Math.pow(Math.E,-g*r),n=p.mercatorUnproject(o),
s=p.findRadPhi(n,o),u=0;u<12&&Math.abs(n-s)>1.0E-7;){n=s;s=p.findRadPhi(n,o);u++}return s*180/Math.PI},mercatorUnproject:function(g){return Math.PI/2-2*Math.atan(g)},findRadPhi:function(g,r){var o=0.08181919084262157*Math.sin(g);return Math.PI/2-2*Math.atan(r*Math.pow((1-o)/(1+o),0.040909595421310785))},normalizeLon:function(g){for(;g<-180;)g+=360;for(;g>180;)g-=360;return g}};return p}(),GeoSearchResult:function(p){p=T5.ex({id:null,caption:"",resultType:"",data:null,pos:null,matchWeight:0},p);return T5.ex(p,
{toString:function(){return p.caption+(p.matchWeight?" ("+p.matchWeight+")":"")}})},GeoSearchAgent:function(p){return T5.Dispatcher.createAgent(p)},GeocodingAgent:function(p){p=T5.ex({name:"Geocoding Search Agent",paramTranslator:null,execute:function(g,r){try{if(!g.reverse&&!g.freeform)address=new q.Address(g);var o=q.getEngine("geocode");if(o)o.geocode({addresses:[g.freeform?g.freeform:address],complete:function(s,u){if(r){var h=u;if(g.freeform)h=q.rankGeocodeResponses(g.freeform,h,q.getEngine("geocode"));
r(h,p)}}})}catch(n){GRUNT.Log.exception(n)}}},p);return new q.GeoSearchAgent(p)},PointOfInterest:function(p){p=T5.ex({id:0,title:"",pos:null,lat:"",lon:"",group:"",retrieved:0,isNew:true},p);if(!p.pos&&p.lat&&p.lon)p.pos=new T5.Geo.Position(p.lat,p.lon);return T5.ex({toString:function(){return p.id+": '"+p.title+"'"}},p)},POIStorage:function(p){function g(h){h=h?h:"default";n[h]||(n[h]=[]);return n[h]}function r(h){var t=[];for(var v in n)for(var w=0;w<n[v].length;w++)if(!h||h(n[v][w]))t.push(n[v][w]);
return t}function o(){GRUNT.WaterCooler.say("geo.pois-updated",{srcID:u.id,pois:u.getPOIs()})}p=T5.ex({visibilityChange:null,onPOIDeleted:null,onPOIAdded:null},p);var n={},s=true,u={id:GRUNT.generateObjectID(),getPOIs:function(){return r()},getOldPOIs:function(h,t){return r(function(v){return v.group==h&&v.retrieved<t})},getVisible:function(){return s},setVisible:function(h){if(h!=s){s=h;p.visibilityChange&&p.visibilityChange()}},findById:function(h){var t=r(function(v){return v.id==h});return t.length>
0?t[0]:null},findByBounds:function(h){return r(function(t){return T5.Geo.P.inBounds(t.pos,h)})},addPOIs:function(h,t){if(t)n={};for(var v=0;h&&v<h.length;v++){h[v].retrieved=T5.time();var w=h[v];g(w.group).push(w)}},removeGroup:function(h){if(n[h]){delete n[h];o()}},update:function(h){var t=[],v=0,w=h.length>0?h[0].group:"",x=T5.time();for(v=0;v<h.length;v++){var A;a:{if(A=h[v])for(var D=g(A.group),J=0;J<D.length;J++)if(D[J].id==A.id){A=D[J];break a}A=null}if(A){A.retrieved=x;A.isNew=false}else t.push(h[v])}h=
u.getOldPOIs(w,x);u.addPOIs(t);for(v=0;p.onPOIAdded&&v<t.length;v++)p.onPOIAdded(t[v]);for(v=0;v<h.length;v++){p.onPOIDeleted&&p.onPOIDeleted(h[v]);w=h[v];x=g(w.group);for(A=0;A<x.length;A++)if(x[A].id==w.id){x.splice(A,1);break}}t.length+h.length>0&&o()}};return u},MapProvider:function(){var p=1,g=20;return{zoomLevel:0,checkZoomLevel:function(r){return Math.min(Math.max(r,p),g)},getCopyright:function(){},getLogoUrl:function(){},getMapTiles:function(){},getPositionForXY:function(){return null},getZoomRange:function(){return{min:p,
max:g}},setZoomRange:function(r,o){p=r;g=o}}},P:function(){var p={calcDistance:function(g,r){if(p.empty(g)||p.empty(r))return 0;var o=(r.lat-g.lat).toRad()/2,n=(r.lon-g.lon).toRad()/2;o=Math.sin(o)*Math.sin(o)+Math.cos(g.lat.toRad())*Math.cos(r.lat.toRad())*Math.sin(n)*Math.sin(n);return 6371*2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))},copy:function(g){return g?new q.Position(g.lat,g.lon):null},empty:function(g){return!g||g.lat===0&&g.lon===0},equal:function(g,r){return g&&r&&g.lat==r.lat&&g.lon==
r.lon},almostEqual:function(g,r){return g&&r&&Math.floor(g.lat*1E3)===Math.floor(r.lat*1E3)&&Math.floor(g.lon*1E3)===Math.floor(r.lon*1E3)},inArray:function(g,r){for(var o=q.P.equal,n=r.length;n--;)if(o(g,r[n]))return true;return false},inBounds:function(g,r){var o=!(q.P.empty(g)||q.P.empty(r));return o=(o=o&&g.lat>=r.min.lat&&g.lat<=r.max.lat)&&g.lon>=r.min.lon&&g.lon<=r.max.lon},parse:function(g){if(g)if(typeof g.lat!=="undefined")return p.copy(g);else{if(g.split)for(var r=[" ",","],o=0;o<r.length;o++){var n=
g.split(r[o]);if(n.length===2)return new q.Position(n[0],n[1])}}else return new q.Position;return null},parseArray:function(g){var r=g.length,o=Array(r);for(r=r;r--;)o[r]=p.parse(g[r]);GRUNT.Log.info("parsed "+o.length+" positions");return o},fromMercatorPixels:function(g,r,o){return new q.Position(T5.Geo.Utilities.pix2lat(r,o),T5.Geo.Utilities.normalizeLon(T5.Geo.Utilities.pix2lon(g,o)))},toMercatorPixels:function(g,r){return new T5.Vector(T5.Geo.Utilities.lon2pix(g.lon,r),T5.Geo.Utilities.lat2pix(g.lat,
r))},generalize:function(g,r,o){var n=g.length,s=[],u=null;o||(o=250);o/=1E3;GRUNT.Log.info("generalizing positions, must include "+r.length+" positions");for(var h=n;h--;)if(h===0)s.unshift(g[h]);else{var t=!u||q.P.inArray(g[h],r)?o:q.P.calcDistance(u,g[h]);if(g[h]&&t>=o){s.unshift(g[h]);u=g[h]}}GRUNT.Log.info("generalized "+n+" positions into "+s.length+" positions");return s},toString:function(g){return g?g.lat+" "+g.lon:""}};return p}(),B:function(){var p=-(Math.PI/2),g=Math.PI/2,r=-Math.PI*2,
o=Math.PI*2,n={calcSize:function(s,u,h){var t=new T5.Vector(0,u.lat-s.lat);if(typeof h==="undefined")h=true;t.x=h&&s.lon>u.lon?360-s.lon+u.lon:u.lon-s.lon;return t},createBoundsFromCenter:function(s,u){var h=u/6371,t=s.lat*b,v=s.lon*b,w=t-h,x=t+h;if(w>p&&x<g){t=Math.asin(Math.sin(h)/Math.cos(t));h=v-t;if(h<r)h+=2*Math.PI;v=v+t;if(v>o)v-=2*Math.PI}else{w=Math.max(w,p);x=Math.min(x,g);h=r;v=o}return new q.BoundingBox(new q.Position(w*d,h*d),new q.Position(x*d,v*d))},expand:function(s,u){return new q.BoundingBox(new q.Position(s.min.lat-
u,s.min.lon-q.Utilities.normalizeLon(u)),new q.Position(s.max.lat+u,s.max.lon+q.Utilities.normalizeLon(u)))},forPositions:function(s,u){var h=null,t=T5.time();u||(u="auto");for(var v=s.length;v--;)if(h){var w=n.calcSize(h.min,s[v],false),x=n.calcSize(s[v],h.max,false);if(w.x<0)h.min.lon=s[v].lon;if(w.y<0)h.min.lat=s[v].lat;if(x.x<0)h.max.lon=s[v].lon;if(x.y<0)h.max.lat=s[v].lat}else h=new T5.Geo.BoundingBox(s[v],s[v]);if(u){if(u=="auto"){v=n.calcSize(h.min,h.max);u=Math.max(v.x,v.y)*0.3}h=n.expand(h,
u)}GRUNT.Log.trace("calculated bounds for "+s.length+" positions",t);return h},getCenter:function(s){var u=q.B.calcSize(s.min,s.max);return new T5.Geo.Position(s.min.lat+u.y/2,s.min.lon+u.x/2)},getGeoHash:function(s){var u=T5.Geo.GeoHash.encode(s.min.lat,s.min.lon);s=T5.Geo.GeoHash.encode(s.max.lat,s.max.lon);GRUNT.Log.info("min hash = "+u+", max hash = "+s)},getZoomLevel:function(s,u){var h=n.getCenter(s),t=a[Math.min(Math.round(Math.abs(h.lat)*0.05),a.length)],v=n.calcSize(s.min,s.max);h=Math.ceil(Math.log(a[3]*
u.height/v.y)/Math.log(2));t=Math.ceil(Math.log(t*u.width/v.x)/Math.log(2));return Math.min(isNaN(h)?1E3:h,isNaN(t)?1E3:t)},isEmpty:function(s){return!s||q.P.empty(s.min)||q.P.empty(s.max)},toString:function(s){return"min: "+q.P.toString(s.min)+", max: "+q.P.toString(s.max)}};return n}(),A:function(){var p=/^(\d+).*$/,g=/(\d+)\s?\-\s?(\d+)/;return{buildingMatch:function(r,o){p.lastIndex=-1;if(p.test(r))for(var n=r.replace(p,"$1"),s=o.split(","),u=0;u<s.length;u++){g.lastIndex=-1;if(g.test(s[u])){var h=
g.exec(s[u]);if(n>=parseInt(h[1],10)&&n<=parseInt(h[2],10))return true}else if(n==s[u])return true}return false},normalize:function(r){if(!r)return"";r=r.toUpperCase();if(!e){var o=[];for(var n in m)o.push(n);e=RegExp("(\\s)("+o.join("|")+")(\\s|$)","i")}e.lastIndex=-1;if(o=e.exec(r))r=r.replace(e,"$1"+m[o[2]]);return r},toString:function(r){return r.streetDetails+" "+r.location}}}(),getEngine:function(p){for(var g=null,r=1;!g&&r<arguments.length;r++)g=k(p,arguments[r]);g=g?g:k(p);if(!g)throw Error("Unable to find GEO engine with "+
p+" capability");return g},rankGeocodeResponses:function(p,g,r){var o=[],n=q.AddressCompareFns;if(r&&r.compareFns)n=T5.ex({},n,r.compareFns);for(r=0;r<g.length;r++)o.push(new q.GeoSearchResult({caption:q.A.toString(g[r]),data:g[r],pos:g[r].pos,matchWeight:f(p,g[r],n,q.GeocodeFieldWeights)}));o.sort(function(s,u){return u.matchWeight-s.matchWeight});return o}};return q}();
T5.Geo.GeoHash=function(){function k(f,a,b){if(a&b)f[0]=(f[0]+f[1])/2;else f[1]=(f[0]+f[1])/2}BITS=[16,8,4,2,1];BASE32="0123456789bcdefghjkmnpqrstuvwxyz";NEIGHBORS={right:{even:"bc01fg45238967deuvhjyznpkmstqrwx"},left:{even:"238967debc01fg45kmstqrwxuvhjyznp"},top:{even:"p0r21436x8zb9dcf5h7kjnmqesgutwvy"},bottom:{even:"14365h7k9dcfesgujnmqp0r2twvyx8zb"}};BORDERS={right:{even:"bcfguvyz"},left:{even:"0145hjnp"},top:{even:"prxz"},bottom:{even:"028b"}};NEIGHBORS.bottom.odd=NEIGHBORS.left.even;NEIGHBORS.top.odd=
NEIGHBORS.right.even;NEIGHBORS.left.odd=NEIGHBORS.bottom.even;NEIGHBORS.right.odd=NEIGHBORS.top.even;BORDERS.bottom.odd=BORDERS.left.even;BORDERS.top.odd=BORDERS.right.even;BORDERS.left.odd=BORDERS.bottom.even;BORDERS.right.odd=BORDERS.top.even;return{decode:function(f){var a=1,b=[],d=[];b[0]=-90;b[1]=90;d[0]=-180;d[1]=180;lat_err=90;lon_err=180;for(i=0;i<f.length;i++){c=f[i];cd=BASE32.indexOf(c);for(j=0;j<5;j++){mask=BITS[j];if(a){lon_err/=2;k(d,cd,mask)}else{lat_err/=2;k(b,cd,mask)}a=!a}}b[2]=(b[0]+
b[1])/2;d[2]=(d[0]+d[1])/2;return{latitude:b,longitude:d}},encode:function(f,a,b){var d=1,e=[],m=[],l=0,q=0;b=b?b:12;geohash="";e[0]=-90;e[1]=90;m[0]=-180;for(m[1]=180;geohash.length<b;){if(d){mid=(m[0]+m[1])/2;if(a>mid){q|=BITS[l];m[0]=mid}else m[1]=mid}else{mid=(e[0]+e[1])/2;if(f>mid){q|=BITS[l];e[0]=mid}else e[1]=mid}d=!d;if(l<4)l++;else{geohash+=BASE32[q];q=l=0}}return geohash}}}();
T5.Geo.Search=function(){return{bestResults:function(k,f){f||(f=20);for(var a=k.length>0?k[0]:null,b=[],d=0;d<k.length;d++)if(a.matchWeight-k[d].matchWeight<=f)b.push(k[d]);else break;return b}}}();
T5.Geo.Routing=function(){var k={calculate:function(f){f=T5.ex({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:true},f);GRUNT.Log.info("attempting to calculate route");var a=T5.Geo.getEngine("route");a&&a.route(f,function(b){if(f.generalize)b.geometry=T5.Geo.P.generalize(b.geometry,b.getInstructionPositions());if(f.map){k.createMapOverlay(f.map,b);if(f.autoFit){GRUNT.Log.info("AUTOFITTING MAP TO ROUTE: bounds = "+b.boundingBox);f.map.gotoBounds(b.boundingBox)}}f.success&&
f.success(b)})},createMapOverlay:function(f,a){var b=f.getDimensions();b=new T5.Geo.UI.RouteOverlay({data:a,width:b.width,height:b.height});f.setLayer("route",b)},parseTurnType:function(f){for(var a=k.TurnType.Unknown,b=T5.Geo.Routing.TurnTypeRules,d=0;d<b.length;d++){b[d].regex.lastIndex=-1;var e=b[d].regex.exec(f);if(e){a=b[d].customCheck?b[d].customCheck(f,e):b[d].turnType;break}}return a},TurnType:{Unknown:"turn-unknown",Start:"turn-none-start",Continue:"turn-none",Arrive:"turn-none-arrive",TurnLeft:"turn-left",
TurnLeftSlight:"turn-left-slight",TurnLeftSharp:"turn-left-sharp",TurnRight:"turn-right",TurnRightSlight:"turn-right-slight",TurnRightSharp:"turn-right-sharp",Merge:"merge",UTurnLeft:"uturn-left",UTurnRight:"uturn-right",EnterRoundabout:"roundabout-enter",Ramp:"ramp",RampExit:"ramp-exit"},Instruction:function(f){f=T5.ex({position:null,description:"",turnType:null},f);if(!f.turnType)f.turnType=k.parseTurnType(f.description);return f},RouteData:function(f){f=T5.ex({geometry:[],instructions:[],boundingBox:null},
f);if(!f.boundingBox)f.boundingBox=T5.Geo.B.forPositions(f.geometry);return T5.ex({getInstructionPositions:function(){for(var a=[],b=0;b<f.instructions.length;b++)f.instructions[b].position&&a.push(f.instructions[b].position);return a}},f)}};return k}();
T5.Geo.Routing.TurnTypeRules=function(){var k=T5.Geo.Routing.TurnType,f=[];f.push({regex:/continue/i,turnType:k.Continue});f.push({regex:/(take|bear|turn)(.*?)left/i,customCheck:function(a,b){return/bear/i.test(b[1])?k.TurnLeftSlight:k.TurnLeft}});f.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(a,b){return/bear/i.test(b[1])?k.TurnRightSlight:k.TurnRight}});f.push({regex:/enter\s(roundabout|rotaty)/i,turnType:k.EnterRoundabout});f.push({regex:/take.*?ramp/i,turnType:k.Ramp});f.push({regex:/take.*?exit/i,
turnType:k.RampExit});f.push({regex:/make(.*?)u\-turn/i,customCheck:function(a,b){return/right/i.test(b[1])?k.UTurnRight:k.UTurnLeft}});f.push({regex:/proceed/i,turnType:k.Start});f.push({regex:/arrive/i,turnType:k.Arrive});f.push({regex:/fell\sthrough/i,turnType:k.Merge});return f}();
T5.Geo.UI=function(){var k=0,f={AnnotationTween:null,GeoTileGrid:function(a){a=T5.ex({grid:null,centerPos:new T5.Geo.Position,centerXY:new T5.Vector,radsPerPixel:0},a);var b=T5.Geo.P.toMercatorPixels(a.centerPos,a.radsPerPixel),d=b.x-a.centerXY.x,e=b.y-a.centerXY.y,m=T5.ex({},a.grid,{getBoundingBox:function(l,q,p,g){return new T5.Geo.BoundingBox(m.pixelsToPos(new T5.Vector(l,q+g)),m.pixelsToPos(new T5.Vector(l+p,q)))},getGridXYForPosition:function(l){l=T5.Geo.P.toMercatorPixels(l,a.radsPerPixel);
return new T5.Vector(l.x-d,m.gridDimensions.height-(l.y-e))},getPixelDistance:function(l){l=T5.Geo.Utilities.dist2rad(l);return Math.floor(l/a.radsPerPixel)},pixelsToPos:function(l){return T5.Geo.P.fromMercatorPixels(d+l.x,e+m.gridDimensions.height-l.y,a.radsPerPixel)}});return m},RouteOverlay:function(a){a=T5.ex({data:null,pixelGeneralization:8,calculationsPerCycle:250,partialDraw:false,strokeStyle:"rgba(0, 51, 119, 0.9)",waypointFillStyle:"#FFFFFF",lineWidth:4,zindex:50},a);var b=true,d=null,e=
[],m=0,l=[],q=[],p=T5.ex(new T5.ViewLayer(a),{getAnimation:function(g,r,o,n){if(b)return null;var s="routeAnimation"+k++;q.push(s);return new T5.AnimatedPathLayer({id:s,path:e,zindex:a.zindex+1,easing:g?g:T5.Easing.Sine.InOut,duration:r?r:5E3,drawIndicator:o,autoCenter:n?n:false})},draw:function(g,r,o,n,s){o=0;n=a.data?a.data.geometry:null;if(b){b=false;d=null;e=[];m=0}if(n&&m<n.length){a:{s=s.getTileLayer();l=[];if(s){n=GRUNT.Log.getTraceTicks();var u,h,t,v=a.data?a.data.geometry:[],w=v.length,x=
a.data?a.data.instructions:[],A=x.length,D=a.calculationsPerCycle,J=0;for(u=m;u<w;u++){h=s.getGridXYForPosition(v[u]);if(t=!d||u===0||Math.abs(h.x-d.x)+Math.abs(h.y-d.y)>a.pixelGeneralization){e.push(h);d=h}J++;if(J>=D){m=u;break a}}m=w;GRUNT.Log.trace(w+" geometry points generalized to "+e.length+" coordinates",n);d=null;for(u=A;u--;)if(x[u].position){h=s.getGridXYForPosition(x[u].position);if(t=!d||u===0||Math.abs(h.x-d.x)+Math.abs(h.y-d.y)>a.pixelGeneralization){l.push(h);d=h}}}}o++}s=e.length;
if(s>0&&(!o||a.partialDraw)){g.strokeStyle=a.strokeStyle;g.lineWidth=a.lineWidth;g.beginPath();g.moveTo(e[s-1].x-r.x,e[s-1].y-r.y);for(s=s;s--;)g.lineTo(e[s].x-r.x,e[s].y-r.y);g.stroke();g.fillStyle=a.waypointFillStyle;for(s=l.length;s--;){g.beginPath();g.arc(l[s].x-r.x,l[s].y-r.y,2,0,Math.PI*2,false);g.stroke();g.fill()}}return o}});GRUNT.WaterCooler.listen("grid.updated",function(){for(var g=q.length;g--;)GRUNT.WaterCooler.say("layer.remove",{id:q[g]});q=[];b=true;p.wakeParent()});return p},Annotation:function(a){a=
T5.ex({xy:null,pos:null,draw:null,calcXY:null,tweenIn:f.AnnotationTween,animationSpeed:null},a);var b=false,d={xy:a.xy,pos:a.pos,isNew:true,isAnimating:function(){return b},calcXY:function(e){d.xy=e.getGridXYForPosition(d.pos);a.calcXY&&a.calcXY(e)},draw:function(e,m,l,q,p){if(d.xy){if(d.isNew&&a.tweenIn){var g=d.xy.y;d.xy.y=m.y-20;b=true;T5.Animation.tween(d.xy,"y",g,a.tweenIn,function(){d.xy.y=g;b=false},a.animationSpeed?a.animationSpeed:250+Math.random()*500)}if(a.draw)a.draw(e,m,new T5.Vector(d.xy.x-
m.x,d.xy.y-m.y),l,q,p);else{e.beginPath();e.arc(d.xy.x-m.x,d.xy.y-m.y,4,0,Math.PI*2,false);e.fill()}d.isNew=false}}};return d},ImageAnnotation:function(a){a=T5.ex({imageUrl:null,animatingImageUrl:null,imageAnchor:null},a);var b=a.imageAnchor?T5.V.invert(a.imageAnchor):null;a.draw=function(e,m,l,q,p){if(a.animatingImageUrl&&d.isAnimating()){T5.Resources.loadImage(a.imageUrl);q=a.animatingImageUrl}else q=a.imageUrl;if(m=T5.Resources.getImage(q)){if(m.complete&&m.width>0){b||(b=new T5.Vector(-m.width>>
1,-m.height>>1));l=T5.V.offset(l,b.x,b.y);e.drawImage(m,l.x,l.y,m.width,m.height)}}else T5.Resources.loadImage(q,function(){p.wakeParent()})};var d=new f.Annotation(a);return d},LocationAnnotation:function(a){a=T5.ex({accuracy:null},a);var b=new Image,d=new T5.Vector,e=null;b.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAACIQAAAiEBPhEQkwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAG+SURBVCiRlZHNahNRAIW/O7mTTJPahLZBA1YUyriINRAE3bQIKm40m8K8gLj0CRQkO32ELHUlKbgoIu4EqeJPgtCaoBuNtjXt5LeTMZk0mbmuWiuuPLsD3+HAOUIpxf9IHjWmaUbEyWv5ROrsVULhcHP761rUfnN3Y2Otc8CIg4YT85lzuVsPP+Qupw1vpPjRCvhS9ymvV0e77x7nNj+uvADQAIQQ+uLyvdfLV9JGZi7EdEwQlqBpEJ019f0z1mo2u5Q8DMydv25lshemmj1FueZTawbs7inarqLbV7Qjab1upB9YlhWSAHLavLHZCvg1VEhN0PMU9W7At4bPVidg7CtkLLXkut+lBPD6/Ub155jJiADAHSpaLmx3ApyBQoYEUd0PBoOBkAC6+3llvda/YxgGgYL+UNHf/zN3KiExGlsvTdP0NYDkhPdWrz35ZDsBzV5wCMuQwEyFmXFeeadjzfuFQmGkAZRKpdGC/n7x+M6jqvA9Zo6FWDhlcHE+wqT93J1tP7vpOE7rrx8ALMuasPf8S12St4WmJ6bYWTUC52k8Hm8Vi0X/nwBAPp/XKpWKdF1X2LYdlMvlsToC/QYTls7DLFr/PAAAAABJRU5ErkJggg%3D%3D";
b.onload=function(){d=new T5.Vector(b.width/2,b.height/2)};var m=new f.Annotation(T5.ex({calcXY:function(l){e=Math.floor(l.getPixelDistance(m.accuracy)*0.5)},draw:function(l,q,p,g,r,o){q=p.x-d.x;g=p.y-d.y;if(e&&m.drawAccuracyIndicator){l.fillStyle="rgba(30, 30, 30, 0.2)";l.beginPath();l.arc(p.x,p.y,e,0,Math.PI*2,false);l.fill()}b.complete&&b.width>0&&l.drawImage(b,q,g,b.width,b.height);o.trigger("invalidate")}},a));m.accuracy=a.accuracy;m.drawAccuracyIndicator=false;return m},AnnotationsOverlay:function(a){function b(q){var p=
a.map?a.map.getTileLayer():null,g=q.length;if(p)for(g=g;g--;)q[g].calcXY(p);q.sort(function(r,o){var n=o.xy.y-r.xy.y;if(n===0)n=o.xy.x-r.xy.x;return n})}a=T5.ex({pois:null,map:null,createAnnotationForPOI:null,zindex:100},a);var d=[],e=false,m=[],l=T5.ex(new T5.ViewLayer(a),{cycle:function(){return e?1:0},draw:function(q,p,g,r,o){e=false;q.fillStyle="rgba(255, 0, 0, 0.75)";q.globalCompositeOperation="source-over";for(g=d.length;g--;){d[g].draw(q,p,r,l,o);e=e||d[g].isAnimating()}for(g=m.length;g--;){m[g].draw(q,
p,r,l,o);e=e||m[g].isAnimating()}return e?1:0},add:function(q){m.push(q);b(m);l.wakeParent()},clear:function(q){m=[];b(m);if(q){d=[];b(d)}l.wakeParent()}});GRUNT.WaterCooler.listen("geo.pois-updated",function(q){if(a.pois&&a.pois.id==q.srcID){q=q.pois;try{d=[];for(var p=0;p<q.length;p++)if(q[p].pos){var g;var r=q[p];if(r&&r.pos){var o=null;if(o=a.createAnnotationForPOI?a.createAnnotationForPOI(r):new f.Annotation({pos:r.pos})){o.isNew=r.isNew;r.isNew=false}g=o}else g=void 0;g&&d.push(g)}b(d)}catch(n){GRUNT.Log.exception(n)}l.wakeParent()}});
GRUNT.WaterCooler.listen("grid.updated",function(){b(d);b(m);l.wakeParent()});return l}};return f}();
T5.Map=function(k){function f(t){try{var v=new T5.Geo.Position(t.coords.latitude,t.coords.longitude),w=t.coords.accuracy/1E3;h.trigger("locationUpdate",t,w);if(s){if(!r){r=new T5.Geo.UI.LocationAnnotation({pos:v,accuracy:w});h.bind("tileDrawComplete",function(){r.drawAccuracyIndicator=true})}k.displayLocationAnnotation&&q.add(r);var x=T5.Geo.B.createBoundsFromCenter(v,Math.max(w,1));h.gotoBounds(x)}else{r.pos=v;r.accuracy=w;r.calcXY(h.getTileLayer());h.panToPosition(v,null,T5.Easing.Sine.Out)}s=false}catch(A){GRUNT.Log.exception(A)}}
function a(t){GRUNT.Log.info("caught location tracking error:",t)}k=T5.ex({tapExtent:10,provider:null,crosshair:false,zoomLevel:0,boundsChange:null,tapPOI:null,boundsChangeThreshold:30,pois:new T5.Geo.POIStorage,createAnnotationForPOI:null,displayLocationAnnotation:true,zoomAnimation:T5.Easing.Quad.Out},k);var b={NONE:0,SINGLE:1,WATCH:2},d=new T5.Vector,e=b.NONE,m=false,l=[],q=null,p=null,g=null,r=null,o=0,n=false,s=true,u=k.zoomLevel;if(!k.provider)k.provider=new T5.Geo.MapProvider;k.adjustScaleFactor=
function(t){return Math.pow(2,(t<1?Math.floor:Math.ceil)(Math.log(t)))};var h=T5.ex({},new T5.Tiling.Tiler(k),{pois:k.pois,annotations:null,getBoundingBox:function(){var t=h.getTileLayer(),v=h.getOffset(),w=h.getDimensions();if(t)return t.getBoundingBox(v.x,v.y,w.width,w.height);return null},getCenterPosition:function(){return h.getXYPosition(T5.D.getCenter(h.getDimensions()))},getXYPosition:function(t){return h.getTileLayer().pixelsToPos(h.viewPixToGridPix(t))},gotoBounds:function(t,v){var w=T5.Geo.B.getZoomLevel(t,
h.getDimensions());h.gotoPosition(T5.Geo.B.getCenter(t),w,v)},gotoPosition:function(t,v,w){function x(M){h.setTileLayer(M);g=M.getId();h.panToPosition(t,function(){h.unfreeze();h.trigger("zoomLevelChange",u);w&&w()});m=true;n=false}var A=u,D=!m,J=h.getBoundingBox();if(J)D=D||!T5.Geo.P.inBounds(t,J);u=v?v:u;if(!u)throw Error("Zoom level required to goto a position.");if(k.provider)u=k.provider.checkZoomLevel(u);if(D||u!==A)if(n)GRUNT.Log.warn("Tile request in progress, aborting");else{T5.Resources.resetImageLoadQueue();
if(r)r.drawAccuracyIndicator=false;(v=h.getTileLayer())&&v.deactivate();T5.Animation.cancel();m&&h.freeze();n=true;k.provider.zoomLevel=u;k.provider.getMapTiles(h,t,x)}else h.panToPosition(t,w)},panToPosition:function(t,v,w){var x=h.getTileLayer();if(x){t=x.getGridXYForPosition(t);x=h.getDimensions();t.x-=x.width/2;t.y-=x.height/2;if(p)p=null;h.updateOffset(t.x,t.y,w);h.trigger("wake");k.boundsChange&&k.boundsChange(h.getBoundingBox());v&&v(h)}},locate:function(){h.trackStart(b.SINGLE);setTimeout(h.trackCancel,
1E4)},trackStart:function(t){if(navigator.geolocation&&!o){e=t?t:b.WATCH;s=true;o=navigator.geolocation.watchPosition(f,a,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3})}},trackCancel:function(){o&&navigator.geolocation&&navigator.geolocation.clearWatch(o);e===b.WATCH&&q.clear();e=b.NONE;o=0},getZoomLevel:function(){return u},setZoomLevel:function(t){try{h.gotoPosition(h.getCenterPosition(),t)}catch(v){GRUNT.Log.exception(v)}},zoomIn:function(){h.scale(2,T5.Easing.Sine.Out)||h.setZoomLevel(u+
1)},zoomOut:function(){h.scale(0.5,T5.Easing.Sine.Out)||h.setZoomLevel(u-1)},animateRoute:function(t,v,w,x){var A=h.getLayer("route");if(A)(t=A.getAnimation(t,v,w,x))&&t.addToView(h)}});h.bind("pan",function(){e===b.SINGLE&&h.trackCancel()});h.bind("tap",function(t,v){var w=h.getTileLayer(),x=null;if(w){var A=h.viewPixToGridPix(new T5.Vector(v.x,v.y)),D=w.pixelsToPos(A);x=w.pixelsToPos(T5.V.offset(A,-k.tapExtent,k.tapExtent));w=w.pixelsToPos(T5.V.offset(A,k.tapExtent,-k.tapExtent));x=new T5.Geo.BoundingBox(x,
w);l=h.pois.findByBounds(x);h.trigger("geotap",t,v,D,x);k.tapPOI&&k.tapPOI(l)}});h.bind("doubleTap",function(t,v){h.animate(2,T5.D.getCenter(h.getDimensions()),new T5.Vector(v.x,v.y),k.zoomAnimation)});h.bind("scale",function(t,v){var w=0;t=Math.sqrt(t);if(t<1)w=-(0.5/t);else if(t>1)w=t;h.gotoPosition(h.getXYPosition(v),u+Math.floor(w))});q=new T5.Geo.UI.AnnotationsOverlay({pois:h.pois,map:h,createAnnotationForPOI:k.createAnnotationForPOI});h.annotations=q;h.setLayer("annotations",q);k.crosshair&&
h.setLayer("crosshair",new CrosshairOverlay);h.bind("idle",function(){if(T5.V.absSize(T5.V.diff(d,h.getOffset()))>k.boundsChangeThreshold&&k.boundsChange){d=h.getOffset();k.boundsChange(h.getBoundingBox())}});GRUNT.configurable(h,["provider"],GRUNT.paramTweaker(k,null,{provider:function(){h.cleanup();m=false}}),true);return h};
