COG=typeof COG!=="undefined"?COG:{};COG.extend=function(){for(var Y=arguments[0]||{},la,J=1,G=arguments.length;J<G;J++)if((la=arguments[J])!==null)for(var q in la){var p=la[q];if(Y!==p)if(p!==undefined)Y[q]=p}return Y};
(function(){var Y=Object.prototype.hasOwnProperty,la=0,J={};J.toID=function(G){return G.replace(/\s/g,"-")};J.objId=function(G){return(G?G:"obj")+la++};J.isFunction=function(G){return toString.call(G)==="[object Function]"};J.isArray=function(G){return toString.call(G)==="[object Array]"};J.isPlainObject=function(G){if(!G||toString.call(G)!=="[object Object]"||G.nodeType||G.setInterval)return false;if(G.constructor&&!Y.call(G,"constructor")&&!Y.call(G.constructor.prototype,"isPrototypeOf"))return false;
var q;for(q in G);return q===undefined||Y.call(G,q)};J.isEmptyObject=function(G){for(var q in G)return false;return true};J.isXmlDocument=function(G){return toString.call(G)==="[object Document]"};J.contains=function(G,q){var p=G,E=arguments,C=1;if(q&&module.isArray(q)){E=q;C=0}for(C=C;C<E;C++)p=p&&typeof foo[E[C]]!=="undefined";return p};J.formatStr=function(G){if(arguments.length<=1)return G;for(var q=arguments.length-2,p=0;p<=q;p++)G=G.replace(RegExp("\\{"+p+"\\}","gi"),arguments[p+1]);return G};
J.wordExists=function(G,q){var p="";if(q.toString)q=q.toString();for(var E=0;E<q.length;E++)p+=!/\w/.test(q[E])?"\\"+q[E]:q[E];return RegExp("(^|\\s|\\,)"+p+"(\\,|\\s|$)","i").test(G)};COG.extend(COG,J)})();
(function(){function Y(p){return typeof console!=="undefined"?function(){console[p](Array.prototype.slice.call(arguments,0).join(" "));return true}:function(){return false}}var la=window.console&&window.console.markTimeline,J=Y("error"),G=Y("info"),q=function(){return la?function(p,E){console.markTimeline(p+(E?": "+((new Date).getTime()-E)+"ms":""))}:function(){}}();COG.extend(COG,{trace:q,debug:Y("debug"),info:G,warn:Y("warn"),error:J,exception:function(p){if(J)for(var E in p)G("ERROR DETAIL: "+
E+": "+p[E])}})})();var FNS_TIME=["webkitAnimationTime","mozAnimationTime","animationTime","webkitAnimationStartTime","mozAnimationStartTime","animationStartTime"],FNS_FRAME=["webkitRequestAnimationFrame","mozRequestAnimationFrame","requestAnimationFrame"],animTime=function(){return(new Date).getTime()},animFrame=function(Y){setTimeout(function(){Y(animTime())},1E3/60)};FNS_TIME.forEach(function(Y){if(Y in window)animTime=function(){return window[Y]}});
FNS_FRAME.forEach(function(Y){if(Y in window)animFrame=function(la){window[Y](la)}});COG.animTime=animTime;COG.animFrame=animFrame;
COG.Loopage=function(){function Y(C){return COG.extend({id:q++,frequency:0,after:0,single:false,lastTick:0,execute:function(){}},C)}function la(C){E.push(C);G||(G=animFrame(J));recalcSleepFrequency=true}function J(){for(var C,aa=animTime(),ka=p.length;E.length>0;){var wa=E.shift();for(C=ka;C--;)if(p[C].id===wa){p.splice(C,1);break}ka=p.length}for(C=ka;C--;){wa=aa-p[C].lastTick;if(p[C].lastTick===0||wa>=p[C].frequency){p[C].execute(aa,p[C]);p[C].lastTick=aa;p[C].single&&p[C].trigger("complete")}}G=
ka?animFrame(J):0}var G=0,q=0,p=[],E=[];return{join:function(C){var aa=new Y(C);if(aa.after>0)aa.lastTick=(new Date).getTime()+aa.after;COG.observable(aa);aa.bind("complete",function(){la(aa.id)});p.unshift(aa);G||(G=animFrame(J));recalcSleepFrequency=true;return aa},leave:la}}();
(function(){function Y(J,G){var q=J.obsHandlers;q[G]||(q[G]=[]);return q[G]}var la=0;COG.observable=function(J){if(!J)return null;if(!J.obsHandlers)J.obsHandlers={};if(!(J.bind||J.trigger||J.unbind)){J.bind=function(G,q){var p="callback"+la++;Y(J,G).unshift({fn:q,id:p});return p};J.trigger=function(G){var q=Y(J,G),p={cancel:false,name:G},E;if(!q)return null;E=Array.prototype.slice.call(arguments,1);J.eventInterceptor&&J.eventInterceptor(G,p,E);E.unshift(p);for(var C=q.length;C--&&!p.cancel;)q[C].fn.apply(self,
E);return p};J.unbind=function(G,q){if(typeof G==="undefined")J.obsHandlers={};else for(var p=Y(J,G),E=0;p&&E<p.length;E++)if(p[E].id===q){p.splice(E,1);break}return J}}return J}})();
(function(){function Y(q,p){q[p]||(q[p]=function(E){return q.configure(p,E)})}function la(q){q.gtConfId="configurable"+G++;q.gtConfig={};q.gtConfigFns=[];return q.gtConfig}var J={},G=0;COG.paramTweaker=function(q,p,E){return function(C,aa){if(typeof aa!=="undefined"){if(C in q)q[C]=aa;E&&C in E&&E[C](C,aa)}else return p&&C in p?p[C](C):q[C]}};COG.configurable=function(q,p,E,C){if(q){q.gtConfId||la(q);var aa=q.gtConfId,ka=q.gtConfig,wa=q.gtConfigFns;J[aa]=q;wa.push(E);for(E=p.length;E--;){ka[p[E]]=
true;C&&Y(q,p[E])}if(!q.configure)q.configure=function(Ea,K){if(ka[Ea]){for(var H=wa.length;H--;){var I=wa[H](Ea,K);if(typeof I!=="undefined")return I}return J[aa]}return null}}}})();
(function(){function Y(q){var p=document.createElement("script"),E=false;p.src=q;p.async=true;p.onload=p.onreadystatechange=function(){if(!E&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){E=true;p.onload=p.onreadystatechange=null;p&&p.parentNode&&p.parentNode.removeChild(p)}};J||(J=document.getElementsByTagName("head")[0]);J.appendChild(p)}var la=0,J,G=this;COG.jsonp=function(q,p,E){q+=q.indexOf("?")>=0?"&":"?";var C="json"+ ++la;G[C]=function(aa){p(aa);G[C]=null;try{delete G[C]}catch(ka){}};
Y(q+(E?E:"callback")+"="+C);return C}})();
(function(){function Y(f){if(Ea)return ka.length;Ea=true;try{for(var t=0;t<ka.length;)if(ka[t].isComplete()){ka[t].triggerComplete(false);ka.splice(t,1)}else{ka[t].update(f);t++}}finally{Ea=false}ka.length===0&&wa.trigger("complete");return ka.length}function la(){if(!wa){wa=COG.Loopage.join({execute:Y,frequency:20});wa.bind("complete",function(){wa=null})}}var J=1.70158,G=Math.PI/2,q=Math.abs,p=Math.pow,E=Math.sin,C=Math.asin,aa=Math.cos,ka=[],wa=null,Ea=false,K={linear:function(f,t,u,x){return u*
f/x+t},backin:function(f,t,u,x){return u*(f/=x)*f*((J+1)*f-J)+t},backout:function(f,t,u,x){return u*((f=f/x-1)*f*((J+1)*f+J)+1)+t},backinout:function(f,t,u,x){return(f/=x/2)<1?u/2*f*f*(((J*=1.525)+1)*f-J)+t:u/2*((f-=2)*f*(((J*=1.525)+1)*f+J)+2)+t},bouncein:function(f,t,u,x){return u-K.bounceout(x-f,0,u,x)+t},bounceout:function(f,t,u,x){return(f/=x)<1/2.75?u*7.5625*f*f+t:f<2/2.75?u*(7.5625*(f-=1.5/2.75)*f+0.75)+t:f<2.5/2.75?u*(7.5625*(f-=2.25/2.75)*f+0.9375)+t:u*(7.5625*(f-=2.625/2.75)*f+0.984375)+
t},bounceinout:function(f,t,u,x){return f<x/2?K.bouncein(f*2,0,u,x)/2+t:K.bounceout(f*2-x,0,u,x)/2+u/2+t},cubicin:function(f,t,u,x){return u*(f/=x)*f*f+t},cubicout:function(f,t,u,x){return u*((f=f/x-1)*f*f+1)+t},cubicinout:function(f,t,u,x){if((f/=x/2)<1)return u/2*f*f*f+t;return u/2*((f-=2)*f*f+2)+t},elasticin:function(f,t,u,x,P,Q){if(f==0)return t;if((f/=x)==1)return t+u;Q||(Q=x*0.3);if(!P||P<q(u)){P=u;u=Q/4}else u=Q/TWO_PI*C(u/P);return-(P*p(2,10*(f-=1))*E((f*x-u)*TWO_PI/Q))+t},elasticout:function(f,
t,u,x,P,Q){var ba;if(f==0)return t;if((f/=x)==1)return t+u;Q||(Q=x*0.3);if(!P||P<q(u)){P=u;ba=Q/4}else ba=Q/TWO_PI*C(u/P);return P*p(2,-10*f)*E((f*x-ba)*TWO_PI/Q)+u+t},elasticinout:function(f,t,u,x,P,Q){var ba;if(f==0)return t;if((f/=x/2)==2)return t+u;Q||(Q=x*0.3*1.5);if(!P||P<q(u)){P=u;ba=Q/4}else ba=Q/TWO_PI*C(u/P);if(f<1)return-0.5*P*p(2,10*(f-=1))*E((f*x-ba)*TWO_PI/Q)+t;return P*p(2,-10*(f-=1))*E((f*x-ba)*TWO_PI/Q)*0.5+u+t},quadin:function(f,t,u,x){return u*(f/=x)*f+t},quadout:function(f,t,u,
x){return-u*(f/=x)*(f-2)+t},quadinout:function(f,t,u,x){if((f/=x/2)<1)return u/2*f*f+t;return-u/2*(--f*(f-2)-1)+t},sinein:function(f,t,u,x){return-u*aa(f/x*G)+u+t},sineout:function(f,t,u,x){return u*E(f/x*G)+t},sineinout:function(f,t,u,x){return-u/2*(aa(Math.PI*f/x)-1)+t}},H=COG.Tween=function(f){f=COG.extend({target:null,property:null,startValue:0,endValue:null,duration:2E3,tweenFn:I("sine.out"),complete:null},f);var t=(new Date).getTime(),u=[],x=false,P=0,Q=0,ba={isComplete:function(){return x},
triggerComplete:function($){f.complete&&f.complete($)},update:function($){var pa=f.tweenFn($-t,P,Q,f.duration);if(f.target)f.target[f.property]=pa;for(var ia=u.length;ia--;)u[ia](pa,void 0);if(x=t+f.duration<=$){if(f.target)f.target[f.property]=f.tweenFn(f.duration,P,Q,f.duration);for($=u.length;$--;)u[$](pa,true)}},requestUpdates:function($){u.push($)}};P=f.target&&f.property&&f.target[f.property]?f.target[f.property]:f.startValue;if(typeof f.endValue!=="undefined")Q=f.endValue-P;if(Q==0)x=true;
la();return ba};COG.tweenValue=function(f,t,u,x,P){function Q(pa){var ia=pa-ba,xa=u(ia,f,$,x),Ia=ba+x<=pa;pa=!Ia;if(P){ia=P(xa,Ia,ia);pa=typeof ia!="undefined"?ia&&pa:pa}pa&&animFrame(Q)}var ba=animTime(),$=t-f;animFrame(Q);return{}};COG.tween=function(f,t,u,x,P,Q){f=new H({target:f,property:t,endValue:u,tweenFn:x,duration:Q,complete:P});ka.push(f);return f};COG.endTweens=function(f){if(!Ea){Ea=true;try{for(var t=0;t<ka.length;)if(!f||f(ka[t])){ka[t].triggerComplete(true);ka.splice(t,1)}else t++}finally{Ea=
false}}};COG.getTweens=function(){return[].concat(ka)};var I=COG.easing=function(f){return K[f.replace(/[\-\_\s\.]/g,"").toLowerCase()]};COG.registerEasingType=function(f,t){K[f.replace(/[\-\_\s\.]/g,"").toLowerCase()]=t}})();
(function(){var Y=/^P(\d+Y)?(\d+M)?(\d+D)?$/,la=/^(\d+H)?(\d+M)?(\d+S)?$/,J={8601:function(q){q=q.split("T");var p=null;p=null;var E=0,C=0;Y.lastIndex=-1;p=Y.exec(q[0]);E+=p[3]?parseInt(p[3].slice(0,-1),10):0;la.lastIndex=-1;p=la.exec(q[1]);C+=p[1]?parseInt(p[1].slice(0,-1),10)*3600:0;C+=p[2]?parseInt(p[2].slice(0,-1),10)*60:0;C+=p[3]?parseInt(p[3].slice(0,-1),10):0;return new G(E,C)}},G=COG.Duration=function(q,p){return{days:q?q:0,seconds:p?p:0}};COG.addDuration=function(){for(var q=new G,p=arguments.length;p--;){q.days+=
arguments[p].days;q.seconds+=arguments[p].seconds}if(q.seconds>=86400){q.days+=~~(q.seconds/86400);q.seconds%=86400}return q};COG.formatDuration=function(q){var p,E,C="";if(q.days)C=q.days+" days ";if(q.seconds){q=q.seconds;if(q>=3600){p=~~(q/3600);q-=p*3600}if(q>=60){E=Math.round(q/60);q-=E*60}if(p)C=C+p+(p>1?" hrs ":" hr ")+(E?(E>10?E:"0"+E)+" min ":"");else if(E)C=C+E+" min";else if(q>0)C=C+(q>10?q:"0"+q)+" sec"}return C};COG.parseDuration=function(q,p){var E=p?J[p]:null;if(E)return E(q);COG.Log.warn("Could not find duration parser for specified format: "+
p);return new G}})();
INTERACT=function(){function Y(K){return function(H,I,f){(f?f:K?document.body:document).addEventListener(H,I,false)}}function la(K){return function(H,I,f){(f?f:K?document.body:document).removeEventListener(H,I,false)}}function J(K,H,I){(I?I:document).attachEvent("on"+K,H)}function G(K,H,I){(I?I:document).detachEvent("on"+K,H)}function q(K,H){return{x:K?K:0,y:H?H:0,count:1}}function p(K,H){wa.push(COG.extend({handler:null,checks:{},type:K},H))}function E(K){var H=0,I=0;if(K.offsetParent){do{H+=K.offsetLeft;
I+=K.offsetTop;K=K.offsetParent}while(K)}return{x:H,y:I}}function C(K,H){for(var I=K.target?K.target:K.srcElement;I&&I.nodeName&&I.nodeName.toUpperCase()!="CANVAS";)I=I.parentNode;return I&&I===H}function aa(K,H){return{x:K.x-(H?H.x:0),y:K.y-(H?H.y:0)}}function ka(K){if(K.preventDefault){K.preventDefault();K.stopPropagation()}else K.cancelBubble&&K.cancelBubble()}var wa=[],Ea=function(K,H,I){function f($,pa,ia,xa){P[P.length]={ticks:(new Date).getTime(),x:xa.x,y:xa.y};u.trigger("pan",xa.x,xa.y)}function t(){COG.info("reset "+
P.length+" pan history");P=[]}I=COG.extend({binder:null,unbinder:null,observable:null},I);for(var u=I.observable,x=[],P=[],Q={bind:function(){return u.bind.apply(null,arguments)},pannable:function($){COG.extend({inertia:true},$);u.bind("pointerDown",t);u.bind("pointerMove",f);return Q},unbind:function(){u.unbind();for(var $=0;$<x.length;$++)x[$].unbind();return Q}},ba=0;ba<H.length;ba++)x.push(H[ba](K,u,I));return Q};p("pointer",{handler:function(K,H,I){function f(y){if(C(y,K))if(pa=P(y)){K.style.cursor=
"move";ka(y);Fa=y.pageX?y.pageX:y.screenX;N=y.pageY?y.pageY:y.screenY;ia=q(Fa,N);xa=E(K);H.trigger("pointerDown",ia,aa(ia,xa))}}function t(y){Ia=y.pageX?y.pageX:y.screenX;Ba=y.pageY?y.pageY:y.screenY;if(C(y,K))Q(pa?"pointerMove":"pointerHover")}function u(y){if(pa&&P(y)){pa=false;if(C(y,K)){K.style.cursor="default";Q("pointerUp")}}}function x(y){if(C(y,K)){var ja;y=y||window.event;if(y.detail)ja=y.axis===2?-y.detail*ba:0;else{ja=y.wheelDeltaY?y.wheelDeltaY:y.wheelDelta;if(window.opera)ja=-ja}if(ja!==
0){var ya=q(Ia,Ba);H.trigger("zoom",ya,aa(ya,E(K)),ja/$,"wheel");ka(y);y.returnValue=false}}}function P(y){y=y||window.event;return(y.which||y.button)==1}function Q(y,ja,ya,Ca){ja=typeof ja!="undefined"?ja:Ia;ya=typeof ya!="undefined"?ya:Ba;var Ra=q(ja,ya);H.trigger(y,Ra,aa(Ra,xa),q(ja-Fa,ya-N));if(typeof Ca=="undefined"||Ca){Fa=ja;N=ya}}I=COG.extend({},I);var ba=120,$=ba*8,pa=false,ia,xa,Ia,Ba,Fa,N;I.binder("mousedown",f,false);I.binder("mousemove",t,false);I.binder("mouseup",u,false);I.binder("click",
function(y){if(C(y,K)){y=q(y.pageX?y.pageX:y.screenX,y.pageY?y.pageY:y.screenY);H.trigger("tap",y,aa(y,E(K)))}},false);I.binder("dblclick",function(y){COG.info("captured double click");if(C(y,K)){y=q(y.pageX?y.pageX:y.screenX,y.pageY?y.pageY:y.screenY);COG.info("captured double click + target matched");H.trigger("doubleTap",y,aa(y,E(K)))}},false);I.binder("mousewheel",x,document);I.binder("DOMMouseScroll",x,document);return{unbind:function(){I.unbinder("mousedown",f,false);I.unbinder("mousemove",
t,false);I.unbinder("mouseup",u,false);I.unbinder("mousewheel",x,document);I.unbinder("DOMMouseScroll",x,document)}}},checks:{touch:false}});p("pointer",{handler:function(K,H,I){function f(U){if(U.count<2)return 0;var ea=U.x-U.next.x;U=U.y-U.next.y;return~~Math.sqrt(ea*ea+U*U)}function t(U,ea,fa){ea=ea?ea:0;fa=fa?fa:0;for(var Ka={x:U.x-ea,y:U.y-fa,id:U.id,count:U.count},Ga=Ka;U.next;){U=U.next;Ga=Ga.next={x:U.x-ea,y:U.y-fa,id:U.id}}return Ka}function u(U,ea){var fa=U[ea?ea:"touches"],Ka,Ga;if(fa.length===
0)return null;Ga=Ka={x:fa[0].pageX,y:fa[0].pageY,id:fa[0].identifier,count:fa.length};for(var Oa=1,Ya=fa.length;Oa<Ya;Oa++)Ga=Ga.next={x:fa[Oa].pageX,y:fa[Oa].pageY,id:fa[Oa].identifier};return Ka}function x(U){if(C(U,K)){Ba=E(K);var ea=u(U,"changedTouches"),fa=t(ea,Ba.x,Ba.y);if(!N){Fa=ia;H.trigger("pointerDown",ea,fa)}Ca&&H.trigger("pointerDownMulti",ea,fa);N=u(U);if(N.count>1)ja=f(N);Ra=1;ya=t(N)}}function P(U){if(C(U,K)){U.preventDefault();y=u(U);if(Fa==ia)Fa=Math.abs(N.x-y.x)>$||Math.abs(N.y-
y.y)>$?pa:ia;if(Fa!=ia){Fa=y.count>1?Ia:xa;if(Fa==Ia)if(N.count===1){N=t(y);ja=f(N)}else{U=f(y);if(Math.abs(ja-U)<ba)Fa=xa;else{var ea;ea=y.x;var fa=y.next.x,Ka=y.y,Ga=y.next.y,Oa=Ka<Ga?Ka:Ga;ea={x:(ea<fa?ea:fa)+(Math.abs(ea-fa)>>1),y:Oa+(Math.abs(Ka-Ga)>>1)};U=U/ja;fa=U-Ra;H.trigger("zoom",ea,aa(ea,Ba),fa,"pinch");Ra=U}}Fa==xa&&H.trigger("pointerMove",y,t(y,Ba.x,Ba.y),q(y.x-ya.x,y.y-ya.y));Ca&&H.trigger("pointerMoveMulti",y,t(y,Ba.x,Ba.y))}ya=t(y)}}function Q(U){if(C(U,K)){var ea=u(U,"changedTouches"),
fa=t(ea,Ba.x,Ba.y);y=u(U);if(!y){Fa===ia&&H.trigger("pointerTap",ea,fa);H.trigger("pointerUp",ea,fa);N=null}Ca&&H.trigger("pointerUpMulti",ea,fa)}}I=COG.extend({detailed:false,inertia:false},I);var ba=20,$=7,pa=0,ia=1,xa=2,Ia=3,Ba,Fa,N,y,ja,ya,Ca=I.detailed,Ra=1;I.binder("touchstart",x,false);I.binder("touchmove",P,false);I.binder("touchend",Q,false);COG.info("initialized touch handler");return{unbind:function(){I.unbinder("touchstart",x,false);I.unbinder("touchmove",P,false);I.unbinder("touchend",
Q,false)}}},checks:{touch:true}});return{register:p,watch:function(K,H,I){H=COG.extend({bindToBody:false,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},H);capabilities=COG.extend({touch:"ontouchstart"in window},I);if(!H.observable){COG.info("creating observable");H.observable=COG.observable({});globalOpts=H}H.binder=H.isIE?J:Y(H.bindToBody);H.unbinder=H.isIE?G:la(H.bindToBody);I=H.types;for(var f=capabilities,t=[],u=wa.length;u--;){var x=wa[u],P=!I||I.indexOf(x.type)>=0,Q=
true;for(var ba in x.checks){var $=x.checks[ba];COG.info("checking "+ba+" capability. require: "+$+", capability = "+f[ba]);Q=Q&&$===f[ba]}if(P&&Q)t[t.length]=x.handler}return new Ea(K,t,H)}}}();
T5=function(){function Y(){return(new Date).getTime()}function la(){for(;fa.length>0;){var c=fa.shift();document.location=c}ea=0}function J(c){for(var s=true,g=Ka.length;g--;)s=s&&c!=Ka[g];return s}function G(c,s){var g=[];for(var b in s)b&&g.push(b+"="+escape(s[b]));return"tile5://"+c+"/"+(g.length>0?"?"+g.join("&"):"")}function q(c,s){J(c)&&COG.info("would push url: "+G(c,s))}function p(c,s){if(J(c)){fa.push(G(c,s));ea||(ea=setTimeout(la,100))}}function E(c){return function(s,g,b){(b?b:c?document.body:
document).addEventListener(s,g,false)}}function C(c){return function(s,g,b){(b?b:c?document.body:document).removeEventListener(s,g,false)}}function aa(c,s,g){(g?g:document).attachEvent("on"+c,s)}function ka(c,s,g){(g?g:document).detachEvent("on"+c,s)}function wa(){Ca={base:{name:"Unknown",bindEvent:E(),unbindEvent:C(),supportsTouch:"ontouchstart"in window,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:q,targetFps:null},ie:{name:"MSIE",
regex:/msie/i,bindEvent:aa,unbindEvent:ka,requireFastDraw:false,targetFps:25},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:p,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:p},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:p},android:{name:"Android OS <= 2.1",regex:/android/i,bindEvent:E(true),unbindEvent:C(true),supportsTouch:true,getScaling:function(){return 1/
window.devicePixelRatio},bridgeNotify:p},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:p}};Ra=[Ca.froyo,Ca.android,Ca.ipod,Ca.iphone,Ca.ipad,Ca.ie]}function Ea(){Ca||wa();if(!U){COG.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var c=0;c<Ra.length;c++){var s=Ra[c];if(s.regex&&s.regex.test(navigator.userAgent)){U=COG.extend({},Ca.base,s);COG.info("PLATFORM DETECTED AS: "+U.name);break}}if(!U){COG.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");
U=Ca.base}COG.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return U}function K(c,s){function g(k,r){k=k?P(x(k,n),d):d;if(k!=b){b=k;c.triggerAll("zoomLevelChange",k,r)}}s=COG.extend({initial:1,minZoom:1,maxZoom:16},s);var b=null,d=s.minZoom,n=s.maxZoom;COG.extend(c,{getZoomLevel:function(){return b},setZoomLevel:g});c.bind("scale",function(k,r,v){k=Math.log(r)/Math.LN2;COG.endTweens(function(o){return o.cancelOnInteract});g(b+k,v);c.updateOffset(v.x*r,v.y*r)})}function H(){for(var c=
0,s=arguments.length;s--;){var g=zb[arguments[s].toUpperCase()];if(g)c|=g}return c}var I=Math.PI*2,f=Math.PI/2,t=Math.abs,u=Math.ceil,x=Math.min,P=Math.max,Q=Math.pow,ba=Math.sqrt,$=Math.log,pa=Math.round,ia=Math.sin,xa=Math.asin,Ia=Math.cos,Ba=Math.atan,Fa=Math.atan2,N=function(){function c(b,d){return g(b.x-d.x,b.y-d.y)}function s(b,d){if(!d)d=b.length;if(d<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");for(var n={edges:Array(d-1),accrued:Array(d-1),total:0},
k=0;k<d-1;k++){var r=c(b[k],b[k+1]);n.edges[k]=ba(r.x*r.x+r.y*r.y);n.accrued[k]=n.total+n.edges[k];n.total+=n.edges[k]}return n}function g(b,d){return{x:b?b:0,y:d?d:0}}return{VECTOR_SIMPLIFICATION:3,SIMPLIFICATION_MIN_VECTORS:25,add:function(){for(var b=0,d=0,n=arguments.length;n--;){b+=arguments[n].x;d+=arguments[n].y}return g(b,d)},absSize:function(b){return P(t(b.x),t(b.y))},copy:function(b){return b?g(b.x,b.y):null},diff:c,distance:function(b,d){return s(b,d).total},edges:s,equals:function(b,
d){return b.x===d.x&&b.y===d.y},extendBy:function(b,d,n){var k=Ia(d)*n;d=ia(d)*n;return g(b.x-k,b.y-d)},floor:function(b){for(var d=Array(b.length),n=b.length;n--;)d[n]=g(~~b[n].x,~~b[n].y);return d},getRect:function(b){for(var d,n,k,r,v=b.length;v--;){var o=b[v];d=typeof d==="undefined"||o.x<d?o.x:d;n=typeof n==="undefined"||o.y<n?o.y:n;k=typeof k==="undefined"||o.x>k?o.x:k;r=typeof r==="undefined"||o.y>r?o.y:r}return ja.init(d,n,k,r)},init:g,invert:function(b){return g(-b.x,-b.y)},min:function(b,
d){return g(b.x<d.x?b.x:d.x,b.y<d.y?b.y:d.y)},max:function(b,d){return g(b.x>d.x?b.x:d.x,b.y>d.y?b.y:d.y)},offset:function(b,d,n){return g(b.x+d,b.y+(n?n:d))},simplify:function(b,d){if(!b)return null;d=d?d:N.VECTOR_SIMPLIFICATION;for(var n=[],k=null,r=b.length;r--;){var v=b[r];if(include=!k||r===0||t(v.x-k.x)+t(v.y-k.y)>d){n.unshift(v);k=v}}return n},theta:function(b,d,n){n=xa((b.y-d.y)/n);return b.x>d.x?n:Math.PI-n},toString:function(b){return b.x+", "+b.y}}}(),y=function(){return{dotProduct:function(c,
s){return c.x*s.x+c.y*s.y}}}(),ja=function(){function c(g){return s(g.x1,g.y1,g.x2,g.y2)}function s(g,b,d,n){g=g?g:0;b=b?b:0;d=typeof d!=="undefined"?d:g;n=typeof n!=="undefined "?n:n;return{x1:g,y1:b,x2:d,y2:n,width:d-g,height:n-b}}return{center:function(g){return N.init(g.x1+g.width/2,g.y1+g.height/2)},copy:c,diagonalSize:function(g){return ba(g.width*g.width+g.height*g.height)},fromCenter:function(g,b,d,n){d=d>>1;n=n>>1;return s(g-d,b-n,g+d,b+n)},init:s,intersect:function(g,b){var d=P(g.x1,b.x1),
n=P(g.y1,b.y1),k=x(g.x2,b.x2),r=x(g.y2,b.y2);d=s(d,n,k,r);return d.width>0&&d.height>0?d:null},toString:function(g){return"["+g.x1+", "+g.y1+", "+g.x2+", "+g.y2+"]"},union:function(g,b){if(g.width===0||g.height===0)return c(b);else if(b.width===0||b.height===0)return c(g);else{var d=x(g.x1,b.x1),n=x(g.y1,b.y1),k=P(g.x2,b.x2),r=P(g.y2,b.y2);d=s(d,n,k,r);return d.width>0&&d.height>0?d:null}}}}(),ya=function(){return{getAspectRatio:function(c){return c.height!==0?c.width/c.height:1},getCenter:function(c){return N.init(c.width>>
1,c.height>>1)},getSize:function(c){return ba(Q(c.width,2)+Q(c.height,2))},init:function(c,s){c=c?c:0;return{width:c,height:s?s:c}}}}(),Ca=null,Ra=[],U=null,ea=0,fa=[],Ka=["view.wake","tile.loaded"],Ga=function(){function c(){var j=Ea().maxImageLoads;if(!j||v.length<j)if(j=r.shift()){v[v.length]=j;j.image.onload=s;j.image.src=j.url;j.requested=T5.ticks()}}function s(){var j=n[this.id],A;if(j&&j.image.complete&&j.image.width>0){j.loaded=true;j.hitCount=1;for(A=v.length;A--;)if(v[A].image.src==this.src){v.splice(A,
1);break}if(j.background||j.postProcess||j.drawBackground||j.customDraw)if(j.image){globalImageData=j;A=b(j.realSize?j.realSize.width:j.image.width,j.realSize?j.realSize.height:j.image.height);var T=A.getContext("2d"),W=j.offset?j.offset:T5.XY.init();j.background&&T.drawImage(j.background,0,0);j.drawBackground&&j.drawBackground(T);j.customDraw?j.customDraw(T,j):T.drawImage(j.image,W.x,W.y);j.postProcess&&j.postProcess(T,j);j.image=A}for(A=j.callbacks.length;A--;)j.callbacks[A]&&j.callbacks[A](this,
false);j.callbacks=[];o[o.length]={url:this.src,created:j.requested};delete n[this.id];c()}}function g(j,A,T){var W=d[j];if(W){W.hitCount++;W.image.complete&&W.image.width>0&&A?A(W.image,true):W.callbacks.push(A)}else{W=COG.extend({url:j,image:new Image,loaded:false,created:T5.ticks(),requested:null,hitCount:0,callbacks:[A]},T);W.image.id="resourceLoaderImage"+k++;d[j]=W;n[W.image.id]=W;r[r.length]=W;c()}return W}function b(j,A){var T=document.createElement("canvas");COG.info("creating new canvas");
T.width=j?j:0;T.height=A?A:0;if(typeof FlashCanvas!="undefined"){document.body.appendChild(T);FlashCanvas.initElement(T)}return T}var d={},n={},k=0,r=[],v=[],o=[],B={avgImageSize:25,loadTimeout:10,cancelLoad:function(){var j;for(j=v.length;j--;)delete d[v[j].url];v=[];for(j=r.length;j--;)delete d[r[j].url];r=[]},get:function(j,A,T){var W=null;W=null;if((W=(W=d[j])?W.image:null)&&(W.getContext||W.complete&&W.width>0))return W;else A&&g(j,A,T);return null},load:g,newCanvas:b,reset:function(){d={}},
stats:function(){return{imageLoadingCount:v.length,queuedImageCount:r.length,imageCacheFullness:0}}};COG.observable(B);return B}(),Oa=function(){var c={};return{init:function(s,g){var b=c[s];if(!b)throw Error("Unable to locate requested generator: "+s);return new b(g)},register:function(s,g){c[s]=g},Template:function(){}}}(),Ya=function(){function c(k,r){d[k]=g(r);return k}function s(k){for(var r in k)c(r,k[r])}function g(k){function r(j){var A=k[j];typeof A!=="undefined"&&o.push(function(T){T[j]=
A})}function v(){o=[];for(var j in k)r(j)}k=COG.extend({lineWidth:undefined,lineCap:undefined,lineJoin:undefined,miterLimit:undefined,lineStyle:undefined,fillStyle:undefined,globalAlpha:undefined,globalCompositeOperation:undefined},k);var o=[],B={applyToContext:function(j){for(var A=o.length;A--;)o[A](j)},update:function(j,A){k[j]=A;v()}};v();return B}var b={},d={},n={apply:function(k,r){var v=d[r]?d[r]:d.basic,o;if(k&&k.canvas){o=b[k.canvas.id];b[k.canvas.id]=r}v.applyToContext(k);return o},define:c,
defineMany:s,get:function(k){return d[k]},init:g,load:function(k){COG.jsonp(k,function(r){s(r)})}};s({basic:{lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"},waypoints:{lineWidth:4,strokeStyle:"rgba(0, 51, 119, 0.9)",fillStyle:"#FFF"}});return n}(),zb={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,ZOOM:16,FREEZE:128},vb=function(c){function s(F,D,R,Z){La=ib;B(qa-D,ta-R,Z?c.panAnimationEasing:null,Z?c.panAnimationDuration:null);clearTimeout(ga);ga=setTimeout(g,100)}function g(){La=lb;va()}function b(F,D,R,Z){Wa(x(P(M+
Q(2,Z)-1,0.5),2))}function d(){var F=$(M)/Math.LN2>>0;if(F!==0){M=Q(2,F);F=N.init(jb-(w/M>>0),kb-(a/M>>0));if(!Da.trigger("scale",M,F).cancel){for(var D=S.length;D--;)S[D].trigger("scale",M,F);M=1;La=lb}gb()}va()}function n(F){F||(F=N.init(w,a));h=N.init(qa,ta);i=N.offset(F,qa,ta);jb=i.x;kb=i.y}function k(F,D){var R,Z;Z=1/M;if(M!==1&&e){R=e.x1+F*Z;Z=e.y1+D*Z}else{R=F+qa;Z=D+ta}return N.init(R,Z)}function r(F,D,R){Za("doubleTap",D,R,k(R.x,R.y));if(c.scalable){COG.endTweens(function(Z){return Z.cancelOnInteract});
Wa(2,R,c.zoomAnimation,null,c.zoomDuration)}}function v(){clearTimeout(X);X=setTimeout(j,250)}function o(F,D,R){Za("tap",D,R,k(R.x,R.y))}function B(F,D,R,Z,ma){function Ma(){$a+=1;if($a>=2){g();ma&&ma()}}var $a=0,Sa=ra?N.offset(ra,-w,-a):null,ab=sa?N.offset(sa,-w,-a):null;if(Sa){F=F<Sa.x?Sa.x:F;D=D<Sa.y?Sa.y:D}if(ab){F=F>ab.x?ab.x:F;D=D>ab.y?ab.y:D}if(R){if((La&ib)===0){COG.tweenValue(qa,F,R,Z,function(cb,mb){qa=cb|0;(mb?Ma:va)();return!z});COG.tweenValue(ta,D,R,Z,function(cb,mb){ta=cb|0;(mb?Ma:va)();
return!z});La=ib|nb}}else{qa=F|0;ta=D|0;va();ma&&ma()}}function j(F,D){var R;if(za){Ha&&Ha.unbind();if(c.autoSize&&za.parentNode){F=za.parentNode.offsetWidth;D=za.parentNode.offsetHeight}try{if(!za.id)za.id=c.id+"_canvas";ca=za.getContext("2d")}catch(Z){COG.exception(Z);throw Error("Could not initialise canvas on specified view element");}if(F&&D&&(oa!==D||Ja!==F)){na=true;Ja=F;oa=D;w=Ja>>1;a=oa>>1;Da.trigger("resize",Ja,oa);for(R=Aa;R--;)S[R].trigger("resize",Ja,oa)}if(c.interactive){Ha=INTERACT.watch(za).pannable();
T()}for(R=Aa;R--;)S[R].trigger("contextChanged",ca);va()}}function A(F,D){D.setId(F);D.added=Y();D.bind("remove",function(){Da.removeLayer(F)});D.trigger("contextChanged",ca);D.setParent(Da);S.push(D);S.sort(function(R,Z){var ma=Z.zindex-R.zindex;if(ma===0)ma=Z.added-R.added;return ma});Aa=S.length;return D}function T(){if(Ha){if(c.pannable){Ha.bind("pan",s);Ha.bind("inertiaCancel",function(){va()})}if(c.scalable){Ha.bind("zoom",b);Ha.bind("doubleTap",r)}Ha.bind("tap",o)}}function W(){var F=bb?qa+
w:qa,D=Ta?ta+a:ta;if(Pa&&Pa>Ja)if(F+Ja>Pa)qa=bb?F-Pa>0?qa-Pa:qa:Pa-Ja;else if(F<0)qa=bb?qa+Pa:0;if(Qa&&Qa>oa)if(D+oa>Qa)ta=Ta?D-Qa>0?ta-Qa:ta:Qa-oa;else if(D<0)ta=Ta?ta+Qa:0}function ua(F,D,R,Z){var ma;ja.center(D);var Ma=0;e=ja.copy(D);e.scaleFactor=M;R||ca.clearRect(0,0,Ja,oa);ca.save();try{ca.globalCompositeOperation="source-over";if(M!==1){var $a=e,Sa=1/M;jb=i.x+(qa-h.x);kb=i.y+(ta-h.y);e=$a?ja.fromCenter(jb>>0,kb>>0,$a.width*Sa>>0,$a.height*Sa>>0):void 0;ca.scale(M,M)}ca.translate(-e.x1,-e.y1);
sa=ra=null;if(R){ca.beginPath();for(Ma=Aa;Ma--;)S[Ma].clip&&S[Ma].clip(ca,e,F,Da,Z);ca.closePath();ca.clip()}for(Ma=Aa;Ma--;){ma=S[Ma];var ab=ma.style,cb=ab?Ya.apply(ca,ab):null;if(ma.minXY)ra=ra?N.min(ra,ma.minXY):N.copy(ma.minXY);if(ma.maxXY)sa=sa?N.max(sa,ma.maxXY):N.copy(ma.maxXY);ma.draw(ca,e,F,Da,Z);cb&&Ya.apply(ca,cb)}}finally{ca.restore()}if(m){ca.globalCompositeOperation="source-over";ca.strokeStyle="#f00";ca.beginPath();ca.moveTo(w,0);ca.lineTo(w,oa);ca.moveTo(0,a);ca.lineTo(Ja,a);ca.stroke()}ob=
0;Za("drawComplete",D,Z)}function Ua(F){var D,R=false;if(ob){if(F-ha>Ab){if(M!==1)La|=ub;z=(D=(La&(ub|ib))!==0)&&(La&nb)===0;if(na&&za){typeof FlashCanvas!="undefined"&&FlashCanvas.initElement(za);za.width=Ja;za.height=oa;za.style.width=Ja+"px";za.style.height=oa+"px";na=false}if(Pa||Qa)W();db=eb();if(z){COG.endTweens(function(ma){return ma.cancelOnInteract});L=false;if(da!==0){clearTimeout(da);da=0}}for(var Z=Aa;Z--;){if(S[Z].animated)La|=nb;S[Z].cycle(F,db,La);S[Z].shouldDraw(La,db);R=S[Z].clip||
R}ua(La,db,pb&&R&&!D,F);F-V>qb&&gb();ha=F}COG.animFrame(Ua)}else hb=false}function va(){ob+=1;if(!hb){hb=true;COG.animFrame(Ua)}}function eb(){return ja.init(qa,ta,qa+Ja,ta+oa)}function gb(){V=(new Date).getTime();Za("refresh",Da,eb());va()}function Wa(F,D,R,Z,ma){if(R)COG.tweenValue(M,F,R,ma,function(Ma,$a){M=Ma;if($a){var Sa=pa($(M)/Math.LN2);M=Q(2,Sa);Z&&Z()}n(D);d()});else{M=F;n(D);d()}return Da}function Za(){for(var F=Da.trigger.apply(null,arguments).cancel,D=S.length;D--;)F=S[D].trigger.apply(null,
arguments).cancel||F;return!F}c=COG.extend({id:COG.objId("view"),container:"",fastDraw:false,inertia:true,idleDelay:100,minRefresh:1E3,pannable:true,clipping:true,scalable:true,interactive:true,panAnimationEasing:COG.easing("sine.out"),panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:true,tapExtent:10,mask:true,guides:false,fps:25,zoomAnimation:COG.easing("quad.out"),zoomDuration:300},c);var S=[],Aa=0,za=document.getElementById(c.container),ca=null,Xa=typeof window.attachEvent!=
"undefined",qb=c.minRefresh,qa=0,ta=0,Pa=null,Qa=null,bb=false,Ta=false,pb=c.clipping,db=null,hb=false,e,m=c.guides,l=1,w=0,a=0,h=null,i=null,z=false,L=false,da=0,ga=0,ra=null,sa=null,V=0,O=0,X=0,M=1,ha=0,na=false,Ha=null,oa,Ja,Ab=1E3/c.fps|0,ob=0,jb,kb,lb=H("ACTIVE"),ib=H("PAN"),ub=H("ZOOM"),nb=H("ANIMATING"),La=lb,Da={id:c.id,deviceScaling:l,fastDraw:c.fastDraw||Ea().requireFastDraw,getDimensions:function(){return ya.init(Ja,oa)},getLayer:function(F){for(var D=0;D<Aa;D++)if(S[D].getId()==F)return S[D];
return null},setLayer:function(F,D){for(var R=0;R<Aa;R++)if(S[R].getId()===F){S.splice(R,1);break}if(D){A(F,D);D.trigger("refresh",Da,eb())}va();return D},eachLayer:function(F){for(var D=Aa;D--;)F(S[D])},invalidate:va,refresh:gb,resetScale:function(){M=1},resize:function(F,D){if(za){c.autoSize=false;if(Ja!==F||oa!==D)j(F,D)}},scale:Wa,triggerAll:Za,removeLayer:function(F){a:{for(var D=Aa;D--;)if(S[D].getId()==F){F=D;break a}F=-1}if(F>=0&&F<Aa){Da.trigger("layerRemoved",S[F]);S.splice(F,1);va()}Aa=
S.length},getOffset:function(){return N.init(qa,ta)},setMaxOffset:function(F,D,R,Z){Pa=F;Qa=D;bb=typeof R!="undefined"?R:false;Ta=typeof Z!="undefined"?Z:false},getViewRect:eb,updateOffset:B,pan:function(F,D,R,Z,ma){B(qa+F,ta+D,R,Z,ma)}};l=Ea().getScaling();Da.markers=A("markers",new rb);COG.observable(Da);Da.bind("invalidate",function(){va()});Da.bind("resync",function(){sa=ra=null});COG.configurable(Da,["inertia","container","rotation","tapExtent","scalable","pannable"],COG.paramTweaker(c,null,
{container:function(F,D){za=document.getElementById(D);j()},rotation:function(F,D){O=D}}),true);j();if(c.autoSize)Xa?window.attachEvent("onresize",v):window.addEventListener("resize",v,false);return Da},fb=function(c){c=COG.extend({id:"",zindex:0,supportFastDraw:false,animated:false,validStates:H("ACTIVE","ANIMATING","PAN","ZOOM"),style:null,minXY:null,maxXY:null},c);var s=null,g=false,b=false,d=c.id,n=H("ACTIVE"),k=c.validStates,r=0,v=0,o=COG.extend({addToView:function(B){B.setLayer(d,o)},shouldDraw:function(B){return(B&
k)!==0},clip:null,cycle:function(){},draw:function(){},remove:function(){o.trigger("remove",o)},changed:function(){b=true;s&&s.invalidate()},getId:function(){return d},setId:function(B){d=B},getParent:function(){return s},setParent:function(B){g=(s=B)?s.fastDraw&&displayState!==n:false;o.trigger("parentChange",s)}},c);COG.observable(o);o.bind("drawComplete",function(B,j){b=false;r=j.x1;v=j.y1});o.bind("resync",function(B,j){if(j.syncXY){o.minXY&&j.syncXY(o.minXY);o.maxXY&&j.syncXY(o.maxXY)}});return o},
sb=function(c){function s(v,o,B,j){b=v;d=o;n=B;k=j}c=COG.extend({xy:N.init(),offset:true,tweenIn:null,animationSpeed:null,isNew:true},c);var g=false,b=0,d=0,n=0,k=0,r=COG.extend(c,{isAnimating:function(){return g},draw:function(v,o,B,j,A){if(r.isNew&&c.tweenIn)COG.tweenValue(o.y1-20,r.xy.y,c.tweenIn,c.animationSpeed?c.animationSpeed:250+Math.random()*500,function(T,W){r.xy.y=T|0;g=!W;A.invalidate()});r.drawMarker(v,o,r.xy.x,r.xy.y,B,j,A);r.isNew=false},drawMarker:function(v,o,B,j){v.beginPath();v.arc(B,
j,4,0,Math.PI*2,false);v.fill();s(B-4,j-4,8,8)},hitTest:function(v,o){return v>=b&&v<=b+n&&o>=d&&o<=d+k},updateBounds:s});COG.observable(r);return r},rb=function(c){function s(){g();d.changed();d.trigger("markerUpdate",b)}function g(){var n=d.getParent();if(n&&n.syncXY)for(var k=b.length;k--;)n.syncXY([b[k].xy])}c=COG.extend({zindex:100,style:"basic"},c);var b=[],d=COG.extend(new fb(c),{draw:function(n,k,r,v){for(var o=b.length;o--;)b[o].draw(n,k,r,d,v)},add:function(n){if(n&&typeof n.length!=="undefined")for(var k=
n.length;k--;){if(n[k])b[b.length]=n[k]}else if(n)b[b.length]=n;s()},clear:function(n){if(n)for(var k=0;k<b.length;)if(n(b[k]))b.splice(k,1);else k+=1;else b=[];s()},each:function(n){if(n)for(var k=b.length;k--;)n(b[k])},find:function(n){for(var k=[],r=b.length;r--;)if(!n||n(b[r]))k[k.length]=b[r];return k}});d.bind("tap",function(n,k,r,v){var o=[],B=v.x;v=v.y;for(var j=b.length;j--;)if(b[j].hitTest(B,v))o[o.length]=b[j];if(o.length>0)n.cancel=d.trigger("markerTap",k,r,o).cancel});d.bind("parentChange",
g);d.bind("resync",g);return d},wb=function(c){function s(r,v,o){r.fillStyle="#FFFFFF";r.strokeStyle="#222222";r.beginPath();r.arc(o.x,o.y,4,0,Math.PI*2,false);r.stroke();r.fill()}c=COG.extend({path:[],id:COG.objId("pathAni"),easing:COG.easing("sine.inout"),validStates:H("ACTIVE","PAN","ZOOM"),drawIndicator:null,duration:2E3},c);var g=N.edges(c.path),b,d=null,n=0;COG.tweenValue(0,g.total,c.easing,function(){k.remove()},c.duration).requestUpdates(function(r,v){n=r;v&&k.remove()});var k=COG.extend(new fb(c),
{cycle:function(){for(var r=0;r<g.accrued.length&&g.accrued[r]<n;)r++;d=null;if(r<c.path.length-1){var v=n-(r>0?g.accrued[r-1]:0),o=c.path[r];b=N.theta(o,c.path[r+1],g.edges[r]);d=N.extendBy(o,b,v)}return d},draw:function(r,v){if(d)(c.drawIndicator?c.drawIndicator:s)(r,v,N.init(d.x,d.y),b)}});return k},xb=function(c){c=COG.extend({style:null,properties:{}},c);return COG.extend(c,{rect:null,draw:function(){},resync:function(){}})},tb=function(c,s){s=COG.extend({fill:false,simplify:false},s);var g=
false,b=s.fill,d=s.simplify,n=H("ZOOM"),k=[],r=COG.extend(new xb(s),{draw:function(v,o,B,j,A,T){if(g){o=true;B=(T&n)!==0;v.beginPath();for(T=k.length;T--;){B=k[T].x;j=k[T].y;if(o){v.moveTo(B,j);o=false}else v.lineTo(B,j);B=true}if(B){b&&v.fill();v.stroke()}}},resync:function(v){r.xy=v.syncXY(c);k=N.floor(d?N.simplify(c):c)}});g=c&&c.length>=2;return r},yb=function(c){function s(n){for(var k=b.length;k--;)b[k].resync(n);b.sort(function(r,v){var o=v.xy.y-r.xy.y;if(o===0)o=v.xy.x-r.xy.y;return o});d.changed()}
function g(n,k){k.syncXY&&s(k)}c=COG.extend({zindex:80},c);var b=[],d=COG.extend(new fb(c),{add:function(n){b[b.length]=n},each:function(n){for(var k=b.length;k--;)n(b[k])},draw:function(n,k,r){var v=k.x1,o=k.y1,B=k.width;k=k.height;for(var j=b.length;j--;){var A=b[j].style;A=A?Ya.apply(n,A):null;b[j].draw(n,v,o,B,k,r);A&&Ya.apply(n,A)}}});d.bind("parentChange",g);d.bind("resync",g);return d},Bb=function(){return{tileSize:256,init:function(c,s,g,b,d){return COG.extend({x:c,y:s,width:g,height:b},d)}}}(),
Va={ex:COG.extend,ticks:Y,getConfig:Ea,userMessage:function(c,s,g){Va.trigger("userMessage",c,s,g)},zoomable:K,XY:N,XYRect:ja,Dimensions:ya,Vector:y,D:ya,Images:Ga,Generator:Oa,tween:COG.tween,tweenValue:COG.tweenValue,easing:COG.easing,Tween:COG.Tween,Style:Ya,viewState:H,View:vb,ViewLayer:fb,ImageLayer:function(c,s){function g(o,B,j){for(B=k.length;B--;){var A=k[B],T=A.x,W=A.y,ua=ja.init(A.x,A.y,A.x+A.width,A.y+A.height);if(j&&ja.intersect(o,ua))(ua=Ga.get(A.url,function(){v.changed()},r))&&j(ua,
T,W,A.width,A.height)}}function b(o){var B=++n,j=v.getParent();if(d){COG.info("generating: "+ja.toString(o)+", sequence = "+B);d.run(j,o,function(A){if(B==n){k=[].concat(A);j.invalidate()}})}}s=COG.extend({imageLoadArgs:{}},s);var d=c?Oa.init(c,s):null,n=0,k=[],r=s.imageLoadArgs,v=COG.extend(new fb(s),{changeGenerator:function(o,B){d=Oa.init(o,COG.extend({},s,B));k=null;b(v.getParent().getViewRect())},clip:function(o,B,j){g(B,j,function(A,T,W,ua,Ua){o.rect(T,W,ua,Ua)})},draw:function(o,B,j){g(B,j,
function(A,T,W,ua,Ua){v.drawImage(o,A,T,W,ua,Ua,B,j)})},drawImage:function(o,B,j,A){B&&o.drawImage(B,j,A,B.width,B.height)}});v.bind("refresh",function(o,B,j){b(j)});v.bind("tap",function(o,B,j,A){o=[];var T=A.x,W=A.y,ua,Ua;if(k)for(var va=k.length;va--;){ua=k[va];if(Ua=T>=ua.x&&T<=ua.x+ua.width&&W>=ua.y&&W<=ua.y+ua.height)o[o.length]=ua}o.length>0&&v.trigger("tapImage",o,B,j,A)});return v},ImageGenerator:function(c){c=COG.extend({relative:false,padding:2},c);c={run:function(){COG.warn("running base generator - this should be overriden")}};
COG.observable(c);return c},Marker:sb,ImageMarker:function(c){c=COG.extend({image:null,imageUrl:null,animatingImage:null,animatingImageUrl:null,imageAnchor:null,rotation:0,scale:1,opacity:1},c);var s=c.imageAnchor?T5.XY.invert(c.imageAnchor):null,g=COG.extend(new sb(c),{drawMarker:function(b,d,n,k){if((d=g.isAnimating()&&g.animatingImage?g.animatingImage:g.image)&&d.width>0){s||(s=N.init(-d.width>>1,-d.height>>1));var r=g.scale,v=n+~~(s.x*r),o=k+~~(s.y*r),B=~~(d.width*r),j=~~(d.height*r);g.updateBounds(v,
o,B,B);if(g.rotation||g.opacity!==1){b.save();try{b.globalAlpha=g.opacity;b.translate(n,k);b.rotate(g.rotation);b.drawImage(d,s.x*r,s.y*r,B,j)}finally{b.restore()}}else b.drawImage(d,v,o,B,j)}}});if(!g.image)g.image=Ga.get(c.imageUrl,function(b){g.image=b});if(!g.animatingImage)g.animatingImage=Ga.get(c.animatingImageUrl,function(b){g.animatingImage=b});return g},MarkerLayer:rb,PathLayer:function(c){function s(){var o=v.getParent();if(o&&o.syncXY){o.syncXY(d);n&&o.syncXY(n);v.trigger("tidy")}}c=COG.extend({style:"waypoints",
pixelGeneralization:8,zindex:50},c);var g=[],b=null,d=[],n=null,k=0,r=[],v=COG.extend(new fb(c),{getAnimation:function(o,B,j,A){var T="pathAnimation"+k++;r.push(T);return new wb({id:T,path:g,zindex:c.zindex+1,easing:o?o:COG.easing("sine.inout"),duration:B?B:5E3,drawIndicator:j,autoCenter:A?A:false})},draw:function(o){var B,j=g.length;o.save();try{Ya.apply(o,c.style);if(j>0){o.beginPath();o.moveTo(g[j-1].x,g[j-1].y);for(B=j;B--;)o.lineTo(g[B].x,g[B].y);o.stroke();if(b){o.fillStyle=c.waypointFillStyle;
for(B=b.length;B--;){o.beginPath();o.arc(b[B].x,b[B].y,2,0,Math.PI*2,false);o.stroke();o.fill()}}}}finally{o.restore()}},updateCoordinates:function(o,B){d=o;n=B;s()}});v.bind("tidy",function(){g=N.simplify(d,c.pixelGeneralization);b=N.simplify(n,c.pixelGeneralization);v.changed(true)});v.bind("resync",s);return v},AnimatedPathLayer:wb,Shape:xb,Arc:function(c,s){s=COG.extend({size:4},s);var g=N.init(),b=COG.extend(s,{draw:function(d){d.beginPath();d.arc(g.x,g.y,b.size,0,Math.PI*2,false);d.fill();d.stroke()},
resync:function(d){d.syncXY([c]);g=N.floor([c])[0]}});COG.info("created arc = ",c);return b},Poly:tb,ShapeLayer:yb,Tiling:Bb};COG.observable(Va);var Na=Va.Geo=function(){function c(e){for(var m=null,l=1;!m&&l<arguments.length;l++)m=n(e,arguments[l]);m=m?m:n(e);if(!m)throw Error("Unable to find GEO engine with "+e+" capability");return m}function s(e){e=parseFloat(e)*A;e=ia(e);var m=va*e;return $((1+e)/(1-e)*Q((1-m)/(1+m),va))/2}function g(e){return parseFloat(e)*A}function b(e){e=Q(Math.E,-e);for(var m=
f-2*Ba(e),l=k(m,e),w=0;w<gb&&t(m-l)>eb;){m=l;l=k(m,e);w++}return l*T}function d(e){return e%360*T}function n(e,m){var l=null;for(var w in Xa)if(m){if(w==m&&Xa[w][e]){l=Xa[w];break}}else if(Xa[w][e]){l=Xa[w];break}return l}function k(e,m){var l=va*ia(e);return f-2*Ba(m*Q((1-l)/(1+l),va/2))}function r(e,m,l,w){m=o(m);e.add(w.line(m,l));return m.length}function v(e,m,l,w){m=o(m);e.add(w.poly(m,l));return m.length}function o(e){var m=e?e.length:0,l=Array(m);for(m=m;m--;)l[m]=Na.Position.init(e[m][1],
e[m][0]);return Na.Position.vectorize(l,bb)}function B(e,m,l){return new db(e,m,l)}var j=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],A=Math.PI/180,T=180/Math.PI,W=f,ua=-W,Ua=-I,va=0.08181919084262157,eb=1.0E-7,gb=12,Wa=null,Za={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",HWY:"HIGHWAY",MWY:"MOTORWAY"},S=function(){function e(a){return a?l(a.lat,a.lon):null}function m(a){return!a||a.lat===0&&a.lon===0}function l(a,h){return{lat:parseFloat(a?
a:0),lon:parseFloat(h?h:0)}}function w(a){if(a)if(typeof a.lat!=="undefined")return e(a);else{if(a.split)for(var h=[" ",","],i=0;i<h.length;i++){var z=a.split(h[i]);if(z.length===2)return l(z[0],z[1])}}else return l();return null}return{calcDistance:function(a,h){if(m(a)||m(h))return 0;var i=(h.lat-a.lat)*A>>1,z=(h.lon-a.lon)*A>>1;i=ia(i)*ia(i)+Ia(a.lat*A)*Ia(h.lat*A)*ia(z)*ia(z);return 6371*2*Fa(ba(i),ba(1-i))},copy:e,empty:m,equal:function(a,h){return a&&h&&a.lat==h.lat&&a.lon==h.lon},fromMercatorPixels:function(a,
h){return l(b(h),d(a))},generalize:function(a,h,i){var z=a.length,L=[],da=null;i||(i=250);i/=1E3;COG.info("generalizing positions, must include "+h.length+" positions");for(var ga=z;ga--;)if(ga===0)L.unshift(a[ga]);else{var ra=!da||S.inArray(a[ga],h)?i:S.calcDistance(da,a[ga]);if(a[ga]&&ra>=i){L.unshift(a[ga]);da=a[ga]}}COG.info("generalized "+z+" positions into "+L.length+" positions");return L},inArray:function(a,h){for(var i=S.equal,z=h.length;z--;)if(i(a,h[z]))return true;return false},inBounds:function(a,
h){var i=!(S.empty(a)||S.empty(h));return i=(i=i&&a.lat>=h.min.lat&&a.lat<=h.max.lat)&&a.lon>=h.min.lon&&a.lon<=h.max.lon},init:l,offset:function(a,h,i){var z=a.lat*A;a=a.lon*A;h=z+h/6371;i=xa(ia(i/6371)/Ia(z));i=a+i;h=(h+f)%Math.PI-f;i%=I;return l(h*T,i*T)},parse:w,parseArray:function(a){var h=a.length,i=Array(h);for(h=h;h--;)i[h]=w(a[h]);return i},toMercatorPixels:function(a){return T5.XY.init(g(a.lon),s(a.lat))},toString:function(a){return a?a.lat+" "+a.lon:""},vectorize:function(a,h){function i(){for(var ga=
0,ra=h.chunkSize,sa=z;sa--;){L[sa]=T5.GeoXY.init(a[sa]);ga+=1;if(ga>ra)break}z=sa;if(z<=0)h.callback&&h.callback(L);else COG.animFrame(i)}var z=a.length,L=Array(z);h=COG.extend({chunkSize:500,async:true,callback:null},h);if(!h.async){for(var da=z;da--;)L[da]=T5.GeoXY.init(a[da]);return L}COG.animFrame(i);return null}}}(),Aa=function(){function e(a,h,i){var z=T5.XY.init(0,h.lat-a.lat);if(typeof i==="undefined")i=true;z.x=i&&a.lon>h.lon?360-a.lon+h.lon:h.lon-a.lon;return z}function m(a,h){return Aa.init(S.init(a.min.lat-
h,a.min.lon-h%360),S.init(a.max.lat+h,a.max.lon+h%360))}function l(a){var h=e(a.min,a.max);return S.init(a.min.lat+(h.y>>1),a.min.lon+(h.x>>1))}function w(a,h){return{min:S.parse(a),max:S.parse(h)}}return{calcSize:e,createBoundsFromCenter:function(a,h){var i=h/6371,z=a.lat*A,L=a.lon*A,da=z-i,ga=z+i;if(da>ua&&ga<W){z=xa(ia(i)/Ia(z));i=(L-z)%I;L=(L+z)%I}else{da=P(da,ua);ga=x(ga,W);i=Ua;L=I}return Aa.init(S.init(da*T,i*T),S.init(ga*T,L*T))},expand:m,forPositions:function(a,h){var i=null,z=T5.ticks();
h||(h="auto");for(var L=a.length;L--;)if(i){var da=e(i.min,a[L],false),ga=e(a[L],i.max,false);if(da.x<0)i.min.lon=a[L].lon;if(da.y<0)i.min.lat=a[L].lat;if(ga.x<0)i.max.lon=a[L].lon;if(ga.y<0)i.max.lat=a[L].lat}else i=w(a[L],a[L]);if(h){if(h=="auto"){L=e(i.min,i.max);h=P(L.x,L.y)*0.3}i=m(i,h)}COG.trace("calculated bounds for "+a.length+" positions",z);return i},getCenter:l,getGeoHash:function(a){var h=T5.Geo.GeoHash.encode(a.min.lat,a.min.lon);a=T5.Geo.GeoHash.encode(a.max.lat,a.max.lon);COG.info("min hash = "+
h+", max hash = "+a)},getZoomLevel:function(a,h){var i=l(a);i=x(pa(t(i.lat)*0.05),j.length);var z=j[i],L=e(a.min,a.max);i=u($(j[3]*h.height/L.y)/$(2));z=u($(z*h.width/L.x)/$(2));return x(isNaN(i)?1E3:i,isNaN(z)?1E3:z)},init:w,isEmpty:function(a){return!a||S.empty(a.min)||S.empty(a.max)},toString:function(a){return"min: "+S.toString(a.min)+", max: "+S.toString(a.max)}}}(),za=function(){var e=/^(\d+).*$/,m=/(\d+)\s?\-\s?(\d+)/;return{buildingMatch:function(l,w){e.lastIndex=-1;if(e.test(l))for(var a=
l.replace(e,"$1"),h=w.split(","),i=0;i<h.length;i++){m.lastIndex=-1;if(m.test(h[i])){var z=m.exec(h[i]);if(a>=parseInt(z[1],10)&&a<=parseInt(z[2],10))return true}else if(a==h[i])return true}return false},normalize:function(l){if(!l)return"";l=l.toUpperCase();if(!Wa){var w=[];for(var a in Za)w.push(a);Wa=RegExp("(\\s)("+w.join("|")+")(\\s|$)","i")}Wa.lastIndex=-1;if(w=Wa.exec(l))l=l.replace(Wa,"$1"+Za[w[2]]);return l},toString:function(l){return l.streetDetails+" "+l.location}}}(),ca=Va.GeoXY=function(){function e(l,
w){if(l.length){for(var a,h,i,z,L=l.length;L--;){e(l[L],w);a=typeof a==="undefined"||l.x<a?l.x:a;h=typeof h==="undefined"||l.y<h?l.y:h;i=typeof i==="undefined"||l.x>i?l.x:i;z=typeof z==="undefined"||l.y>z?l.y:z}return ja.init(a,h,z,z)}else if(l.mercXY){a=l.mercXY;l.x=(a.x+Math.PI)/w|0;l.y=(Math.PI-a.y)/w|0;l.rpp=w}else COG.warn("Attempted to sync an XY composite, not a GeoXY");return l}function m(l,w,a){l.pos=w;l.mercXY=S.toMercatorPixels(w);(a=typeof a!=="undefined"?a:l.rpp)&&e(l,a)}return{init:function(l,
w){var a=N.init();m(a,l,w);return a},sync:e,toPos:function(l,w){w=w?w:self.rpp;return S.fromMercatorPixels(l.x*w-Math.PI,Math.PI-l.y*w)},updatePos:m}}(),Xa={},qb=function(){return{bestResults:function(e,m){m||(m=20);for(var l=e.length>0?e[0]:null,w=[],a=0;a<e.length;a++)if(l&&e[a]&&l.matchWeight-e[a].matchWeight<=m)w.push(e[a]);else break;return w}}}(),qa=function(e){e=COG.extend({id:null,caption:"",resultType:"",data:null,pos:null,matchWeight:0},e);return COG.extend(e,{toString:function(){return e.caption+
(e.matchWeight?" ("+e.matchWeight+")":"")}})},ta=function(){function e(a,h){var i=a.getDimensions();i=new hb({data:h,width:i.width,height:i.height});a.setLayer("route",i)}function m(a){for(var h=l.Unknown,i=w,z=0;z<i.length;z++){i[z].regex.lastIndex=-1;var L=i[z].regex.exec(a);if(L){h=i[z].customCheck?i[z].customCheck(a,L):i[z].turnType;break}}return h}var l={Unknown:"turn-unknown",Start:"turn-none-start",Continue:"turn-none",Arrive:"turn-none-arrive",TurnLeft:"turn-left",TurnLeftSlight:"turn-left-slight",
TurnLeftSharp:"turn-left-sharp",TurnRight:"turn-right",TurnRightSlight:"turn-right-slight",TurnRightSharp:"turn-right-sharp",Merge:"merge",UTurnLeft:"uturn-left",UTurnRight:"uturn-right",EnterRoundabout:"roundabout-enter",Ramp:"ramp",RampExit:"ramp-exit"},w=function(){var a=[];a.push({regex:/continue/i,turnType:l.Continue});a.push({regex:/(take|bear|turn)(.*?)left/i,customCheck:function(h,i){return/bear/i.test(i[1])?l.TurnLeftSlight:l.TurnLeft}});a.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(h,
i){return/bear/i.test(i[1])?l.TurnRightSlight:l.TurnRight}});a.push({regex:/enter\s(roundabout|rotaty)/i,turnType:l.EnterRoundabout});a.push({regex:/take.*?ramp/i,turnType:l.Ramp});a.push({regex:/take.*?exit/i,turnType:l.RampExit});a.push({regex:/make(.*?)u\-turn/i,customCheck:function(h,i){return/right/i.test(i[1])?l.UTurnRight:l.UTurnLeft}});a.push({regex:/proceed/i,turnType:l.Start});a.push({regex:/arrive/i,turnType:l.Arrive});a.push({regex:/fell\sthrough/i,turnType:l.Merge});return a}();return{calculate:function(a){a=
COG.extend({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},a);var h=c("route");h&&h.route(a,function(i){if(a.generalize)i.geometry=S.generalize(i.geometry,i.getInstructionPositions());if(a.map){e(a.map,i);a.autoFit&&a.map.gotoBounds(i.boundingBox)}a.success&&a.success(i)})},createMapOverlay:e,parseTurnType:m,TurnType:l,Instruction:function(a){var h=a=COG.extend({position:null,description:"",distance:0,distanceTotal:0,time:0,timeTotal:0,turnType:null},a),i=
a.description;i=i.replace(/(\w)(\/)(\w)/g,"$1 $2 $3");h.description=i;if(!a.turnType)a.turnType=m(a.description);return a},RouteData:function(a){a=COG.extend({geometry:[],instructions:[],boundingBox:null},a);if(!a.boundingBox)a.boundingBox=Aa.forPositions(a.geometry);return COG.extend({getInstructionPositions:function(){for(var h=[],i=0;i<a.instructions.length;i++)a.instructions[i].position&&h.push(a.instructions[i].position);return h}},a)}}}(),Pa="featurecollection",Qa="feature",bb={async:false},
Ta={processor:null,group:"shapes",layerClass:yb},pb={point:COG.extend({},Ta,{processor:function(e,m,l,w){m=o([m.coordinates],bb);if(m.length>0)if(l=w.marker(m[0],l)){e.add(l);return m.length}},group:"markers",layerClass:rb}),linestring:COG.extend({},Ta,{processor:function(e,m,l,w){m=o(m&&m.coordinates?m.coordinates:[]);return r(e,m,l,w)}}),multilinestring:COG.extend({},Ta,{processor:function(e,m,l,w){m=m&&m.coordinates?m.coordinates:[];for(var a=0,h=m.length;h--;)a+=r(e,m[h],l,w);return a}}),polygon:COG.extend({},
Ta,{processor:function(e,m,l,w){m=m&&m.coordinates?m.coordinates:[];if(m.length>0)return v(e,m[0],l,w);return 0}}),multipolygon:COG.extend({},Ta,{processor:function(e,m,l,w){m=m&&m.coordinates?m.coordinates:[];for(var a=0,h=0;h<m.length;h++)a+=v(e,m[h][0],l,w);return a}})},db=function(e,m,l,w){function a(X,M){var ha=X.processor,na=da+X.group,Ha=COG.extend({},X,l,{properties:M.properties});if(ha){var oa=O[na];if(!oa){oa=new X.layerClass({id:na});O[na]=oa}globalLayers=O;return ha(oa,M.data,Ha,w)}return 0}
function h(X,M){var ha=X&&X.type?X.type.toLowerCase():null;return ha&&ha===Qa?h(X.geometry,X.properties):{type:ha,isCollection:ha?ha===Pa:false,definition:pb[ha],data:X,properties:M?M:X.properties}}function i(){var X=0,M=ga;if(!sa){for(;M<ra;M++){var ha=h(L?L(e[M]):e[M]),na=null;if(ha.isCollection){V+=1;sa=B(ha.data.features,function(Ha){sa=null;for(var oa in Ha)O[oa]=Ha[oa]},{layerPrefix:da+V+"-"});na+=1}else if(ha.definition)na=a(ha.definition,ha);X+=na?na:1;if(X>=z)break}ga=M+1;if(sa||ga<ra)COG.animFrame(i);
else m&&m(O)}}l=COG.extend({vectorsPerCycle:Na.VECTORIZE_PER_CYCLE,rowPreParse:null,simplify:false,layerPrefix:"geojson-"},l);w=COG.extend({marker:function(X){return new sb({xy:X})},line:function(X,M){return new tb(X,M)},poly:function(X,M){return new tb(X,COG.extend({fill:true},M))}},w);var z=l.vectorsPerCycle,L=l.rowPreParse,da=l.layerPrefix,ga=0,ra=0,sa=null,V=0,O={};if(e){if(typeof e.length==="undefined")e=[e];ra=e.length;COG.animFrame(i)}};Va.GeoJSON={parse:B};Va.Map=function(e){function m(O){try{var X=
Na.Position.init(O.coords.latitude,O.coords.longitude),M=O.coords.accuracy/1E3;V.trigger("locationUpdate",O,M);if(ga){if(!L){L=new Na.UI.LocationOverlay({pos:X,accuracy:M});L.update(V.getTileLayer());V.setLayer("location",L)}var ha=Na.BoundingBox.createBoundsFromCenter(X,Math.max(M,1));V.gotoBounds(ha)}else{L.pos=X;L.accuracy=M;L.update(V.getTileLayer());a(X,null,COG.easing("sine.out"))}ga=false}catch(na){COG.exception(na)}}function l(O){COG.info("caught location tracking error:",O)}function w(O,
X,M){COG.endTweens();V.setZoomLevel(X);a(O,M)}function a(O,X,M,ha){O=ca.init(O,Na.radsPerPixel(V.getZoomLevel()));var na=V.getDimensions();V.updateOffset(O.x-(na.width>>1),O.y-(na.height>>1),M,ha,function(){V.refresh();V.trigger("boundsChange",V.getBoundingBox());X&&X(V)})}e=COG.extend({tapExtent:10,crosshair:false,zoomLevel:0,boundsChangeThreshold:30},e);var h={NONE:0,SINGLE:1,WATCH:2},i=N.init(),z=h.NONE,L=null,da=0,ga=true,ra=0,sa=e.tapExtent;e.adjustScaleFactor=function(O){return Math.pow(2,(O<
1?Math.floor:Math.ceil)(Math.log(O)))};var V=COG.extend(new vb(e),{getBoundingBox:function(){var O=V.getViewRect();return Na.BoundingBox.init(ca.toPos(N.init(O.x1,O.y2),ra),ca.toPos(N.init(O.x2,O.y1),ra))},getCenterPosition:function(){var O=V.getViewRect();if(O){O=N.init(O.x1+(O.width>>1),O.y1+(O.height>>1));return ca.toPos(O,ra)}return null},gotoBounds:function(O,X){var M=Na.BoundingBox.getZoomLevel(O,V.getDimensions());w(Na.BoundingBox.getCenter(O),M,X)},gotoPosition:w,panToPosition:a,syncXY:function(O){return ca.sync(O,
ra)},locate:function(){V.trackStart(h.SINGLE);setTimeout(V.trackCancel,1E4)},trackStart:function(O){if(navigator.geolocation&&!da){z=O?O:h.WATCH;ga=true;da=navigator.geolocation.watchPosition(m,l,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3})}},trackCancel:function(){da&&navigator.geolocation&&navigator.geolocation.clearWatch(da);V.removeLayer("location");L=null;z=h.NONE;da=0},animateRoute:function(O,X,M,ha){var na=V.getLayer("route");if(na)(O=na.getAnimation(O,X,M,ha))&&O.addToView(V)}});
V.bind("pan",function(){z===h.SINGLE&&V.trackCancel()});V.bind("tap",function(O,X,M,ha){var na=Na.radsPerPixel(V.getZoomLevel());O=ca.toPos(ha,na);var Ha=ca.toPos(N.offset(ha,-sa,sa),na);ha=ca.toPos(N.offset(ha,sa,-sa),na);V.trigger("geotap",X,M,O,Aa.init(Ha,ha))});V.bind("refresh",function(){if(N.absSize(N.diff(i,V.getOffset()))>e.boundsChangeThreshold){i=N.copy(V.getOffset());V.trigger("boundsChange",V.getBoundingBox())}});K(V,e);V.bind("zoomLevelChange",function(O,X){var M;ra=Na.radsPerPixel(X);
M=I/ra|0;V.setMaxOffset(M,M,true,false);Ga.cancelLoad();V.resetScale();V.triggerAll("resync",V);V.refresh()});return V};Va.GeoShape=function(e,m){m=COG.extend({autoParse:true},m);for(var l=Array(e.length),w=m.autoParse,a=T5.Geo.Position.parse,h=e.length;h--;)l[h]=T5.GeoXY.init(w?a(e[h]):e[h]);return new T5.Poly(l,m)};var hb=Va.RouteOverlay=function(e){e=COG.extend({data:null,pixelGeneralization:8,partialDraw:false,strokeStyle:"rgba(0, 51, 119, 0.9)",waypointFillStyle:"#FFFFFF",lineWidth:4,zindex:50},
e);var m=[],l=[],w=new T5.PathLayer(e);(function(){if(e.data&&e.data.instructions){for(var a=e.data.instructions,h=Array(a.length),i=a.length;i--;)h[i]=a[i].position;S.vectorize(h,{callback:function(z){l=z}})}e.data&&e.data.geometry&&S.vectorize(e.data.geometry,{callback:function(z){m=z;w.updateCoordinates(m,l,true)}})})();return w};Va.LocationOverlay=function(e){e=COG.extend({pos:null,accuracy:null,zindex:90},e);var m=new Image,l=T5.XY.init(),w=T5.XY.init(),a=null;m.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAACIQAAAiEBPhEQkwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAG+SURBVCiRlZHNahNRAIW/O7mTTJPahLZBA1YUyriINRAE3bQIKm40m8K8gLj0CRQkO32ELHUlKbgoIu4EqeJPgtCaoBuNtjXt5LeTMZk0mbmuWiuuPLsD3+HAOUIpxf9IHjWmaUbEyWv5ROrsVULhcHP761rUfnN3Y2Otc8CIg4YT85lzuVsPP+Qupw1vpPjRCvhS9ymvV0e77x7nNj+uvADQAIQQ+uLyvdfLV9JGZi7EdEwQlqBpEJ019f0z1mo2u5Q8DMydv25lshemmj1FueZTawbs7inarqLbV7Qjab1upB9YlhWSAHLavLHZCvg1VEhN0PMU9W7At4bPVidg7CtkLLXkut+lBPD6/Ub155jJiADAHSpaLmx3ApyBQoYEUd0PBoOBkAC6+3llvda/YxgGgYL+UNHf/zN3KiExGlsvTdP0NYDkhPdWrz35ZDsBzV5wCMuQwEyFmXFeeadjzfuFQmGkAZRKpdGC/n7x+M6jqvA9Zo6FWDhlcHE+wqT93J1tP7vpOE7rrx8ALMuasPf8S12St4WmJ6bYWTUC52k8Hm8Vi0X/nwBAPp/XKpWKdF1X2LYdlMvlsToC/QYTls7DLFr/PAAAAABJRU5ErkJggg%3D%3D";
m.onload=function(){l=T5.XY.init(m.width>>1,m.height>>1)};var h=COG.extend(new T5.ViewLayer(e),{pos:e.pos,accuracy:e.accuracy,drawAccuracyIndicator:false,draw:function(i,z){var L=w.x-z.x,da=w.y-z.y;if(a){i.fillStyle="rgba(30, 30, 30, 0.2)";i.beginPath();i.arc(L,da,a,0,Math.PI*2,false);i.fill()}m.complete&&m.width>0&&i.drawImage(m,L-l.x,da-l.y,m.width,m.height);h.changed()},update:function(i){if(i){a=i.getPixelDistance(h.accuracy)>>1;w=i.getGridXYForPosition(h.pos);h.changed()}}});h.bind("gridUpdate",
function(i,z){h.update(z)});return h};return{distanceToString:function(e){if(e>1E3)return~~(e/10)/100+" km";return e?e+" m":""},dist2rad:function(e){return e/6371},getEngine:c,lat2pix:s,lon2pix:g,pix2lat:b,pix2lon:d,radsPerPixel:function(e){return I/(256<<e)},Position:S,BoundingBox:Aa,Radius:function(e,m){return{distance:parseInt(e,10),uom:m}},Address:function(e){return e=COG.extend({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},e)},A:za,GeocodeFieldWeights:{streetDetails:50,
location:50},AddressCompareFns:{},Engine:function(e){if(!e.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var m=COG.extend({remove:function(){delete Xa[m.id]}},e);return Xa[m.id]=m},Search:qb,GeoSearchResult:qa,LocationSearch:function(e){function m(i,z){navigator.geolocation.clearWatch(w);w=0;if(a){clearTimeout(a);a=0}z&&z([i],e)}function l(i){COG.info("caught location tracking error:",i)}e=COG.extend({name:"Geolocation Search",requiredAccuracy:null,searchTimeout:5E3,
watch:false},e);var w=0,a=0,h=null;return new T5.Geo.GeoSearchAgent(COG.extend({execute:function(i,z){if(navigator.geolocation&&!w){w=navigator.geolocation.watchPosition(function(L){var da=S.init(L.coords.latitude,L.coords.longitude);L=new qa({id:1,caption:"Current Location",pos:da,accuracy:L.coords.accuracy/1E3,matchWeight:100});if(!h||L.accuracy<h.accuracy)h=L;if(!e.requiredAccuracy||h.accuracy<e.requiredAccuracy)m(h,z)},l,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3});if(e.searchTimeout)a=
setTimeout(function(){h&&m(h,z)},e.searchTimeout)}}},e))},Routing:ta}}();return Va}();
