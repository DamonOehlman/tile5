if(!this.JSON)this.JSON={};
(function(){function h(p){return p<10?"0"+p:p}function d(p){e.lastIndex=0;return e.test(p)?'"'+p.replace(e,function(f){var o=l[f];return typeof o==="string"?o:"\\u"+("0000"+f.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+p+'"'}function b(p,f){var o,s,q,n,u=g,k,r=f[p];if(r&&typeof r==="object"&&typeof r.toJSON==="function")r=r.toJSON(p);if(typeof t==="function")r=t.call(f,p,r);switch(typeof r){case "string":return d(r);case "number":return isFinite(r)?String(r):"null";case "boolean":case "null":return String(r);
case "object":if(!r)return"null";g+=m;k=[];if(Object.prototype.toString.apply(r)==="[object Array]"){n=r.length;for(o=0;o<n;o+=1)k[o]=b(o,r)||"null";q=k.length===0?"[]":g?"[\n"+g+k.join(",\n"+g)+"\n"+u+"]":"["+k.join(",")+"]";g=u;return q}if(t&&typeof t==="object"){n=t.length;for(o=0;o<n;o+=1){s=t[o];if(typeof s==="string")if(q=b(s,r))k.push(d(s)+(g?": ":":")+q)}}else for(s in r)if(Object.hasOwnProperty.call(r,s))if(q=b(s,r))k.push(d(s)+(g?": ":":")+q);q=k.length===0?"{}":g?"{\n"+g+k.join(",\n"+g)+
"\n"+u+"}":"{"+k.join(",")+"}";g=u;return q}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+h(this.getUTCMonth()+1)+"-"+h(this.getUTCDate())+"T"+h(this.getUTCHours())+":"+h(this.getUTCMinutes())+":"+h(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var a=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,g,m,l={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},t;if(typeof JSON.stringify!=="function")JSON.stringify=function(p,f,o){var s;m=g="";if(typeof o==="number")for(s=0;s<o;s+=1)m+=" ";else if(typeof o==="string")m=o;if((t=f)&&typeof f!=="function"&&(typeof f!=="object"||typeof f.length!=="number"))throw Error("JSON.stringify");return b("",
{"":p})};if(typeof JSON.parse!=="function")JSON.parse=function(p,f){function o(q,n){var u,k,r=q[n];if(r&&typeof r==="object")for(u in r)if(Object.hasOwnProperty.call(r,u)){k=o(r,u);if(k!==undefined)r[u]=k;else delete r[u]}return f.call(q,n,r)}var s;p=String(p);a.lastIndex=0;if(a.test(p))p=p.replace(a,function(q){return"\\u"+("0000"+q.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(p.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){s=eval("("+p+")");return typeof f==="function"?o({"":s},""):s}throw new SyntaxError("JSON.parse");}})();if(!String.format)String.format=function(h){if(arguments.length<=1)return h;for(var d=arguments.length-2,b=0;b<=d;b++)h=h.replace(RegExp("\\{"+b+"\\}","gi"),arguments[b+1]);return h};
String.prototype.containsWord=function(h){var d="";if(h.toString)h=h.toString();for(var b=0;b<h.length;b++)d+=!/\w/.test(h[b])?"\\"+h[b]:h[b];return RegExp("(^|\\s|\\,)"+d+"(\\,|\\s|$)","i").test(this)};Number.prototype.toRad=function(){return this*Math.PI/180};Number.prototype.sec=function(){return 1/Math.cos(this)};
GRUNT=function(){var h=Object.prototype.hasOwnProperty,d=0,b={id:"GRUNT.core",extend:function(){var a=arguments[0]||{},e=1,g=arguments.length,m=false,l,t,p,f;if(typeof a==="boolean"){m=a;a=arguments[1]||{};e=2}if(typeof a!=="object"&&!b.isFunction(a))a={};if(g===e){a=this;--e}for(;e<g;e++)if((l=arguments[e])!=null)for(t in l){p=a[t];f=l[t];if(a!==f)if(m&&f&&(b.isPlainObject(f)||b.isArray(f))){p=p&&(b.isPlainObject(p)||b.isArray(p))?p:b.isArray(f)?[]:{};a[t]=b.extend(m,p,f)}else if(f!==undefined)a[t]=
f}return a},isFunction:function(a){return toString.call(a)==="[object Function]"},isArray:function(a){return toString.call(a)==="[object Array]"},isPlainObject:function(a){if(!a||toString.call(a)!=="[object Object]"||a.nodeType||a.setInterval)return false;if(a.constructor&&!h.call(a,"constructor")&&!h.call(a.constructor.prototype,"isPrototypeOf"))return false;var e;for(e in a);return e===undefined||h.call(a,e)},isEmptyObject:function(a){for(var e in a)return false;return true},isXmlDocument:function(a){return toString.call(a)===
"[object Document]"},contains:function(a,e){var g=a,m=arguments,l=1;if(e&&b.isArray(e)){m=e;l=0}for(l=l;l<m;l++)g=g&&typeof foo[m[l]]!=="undefined";return g},newModule:function(a){a=b.extend({id:null,requires:[],parent:null},a);if(a.parent)a=b.extend({},a.parent,a);return a},toID:function(a){return a.replace(/\s/g,"-")},generateObjectID:function(a){return(a?a:"obj")+d++}};return b}();
GRUNT.Log=function(){function h(g,m){var l,t=m&&m.length>0?m[0]:"";for(l=1;m&&l<m.length;l++)t+=" "+(b&&GRUNT.isPlainObject(m[l])?JSON.stringify(m[l]):m[l]);typeof console!=="undefined"&&console[g](t);for(l=0;l<d.length;l++)d[l].call(e,t,g)}var d=[],b=typeof JSON!=="undefined",a=window.console&&window.console.markTimeline,e={id:"GRUNT.log",getTraceTicks:function(){return a?(new Date).getTime():null},trace:function(g,m){if(a)console.markTimeline(g+(m?": "+(e.getTraceTicks()-m)+"ms":""))},debug:function(){h("debug",
arguments)},info:function(){h("info",arguments)},warn:function(){h("warn",arguments)},error:function(){h("error",arguments)},exception:function(g){e.error(arguments);for(var m in g)e.info("ERROR DETAIL: "+m+": "+g[m])},watch:function(g,m){try{m()}catch(l){e.exception(l,g)}},throwError:function(g){e.error(g);throw Error(g);},requestUpdates:function(g){d.push(g)}};return e}();
GRUNT.Data=function(){var h={determineObjectMapping:function(b){if(!b)return null;b=b.split("|");for(var a={},e=0;e<b.length;e++)a[b[e]]=e;return a},mapLineToObject:function(b,a){var e=b.split("|"),g={};for(var m in a){var l=a[m];g[m]=e.length>l?e[l]:null}return g},parse:function(b){var a=null,e=[];b=b.split("\n");for(var g=0;g<b.length;g++){var m=b[g];if(a)e.push(h.mapLineToObject(m,a));else a=h.determineObjectMapping(m)}return e}},d={supportedFormats:{JSON:{parse:function(b){return JSON.parse(b)}},
PDON:{parse:function(b){return h.parse(b)}}},parse:function(b){b=GRUNT.extend({data:"",format:"JSON"},b);if(!d.supportedFormats[b.format])throw Error("Unsupported data format: "+b.format+", cannot parse data in javascript object");try{return d.supportedFormats[b.format].parse(b.data)}catch(a){GRUNT.Log.error("ERROR PARSING DATA FROM FORMAT: "+b.format,b.data);GRUNT.Log.exception(a)}return{}}};return d}();
GRUNT.paramTweaker=function(h,d,b){return function(a,e){if(typeof e!=="undefined"){if(a in h)h[a]=e;b&&a in b&&b[a](a,e)}else return d&&a in d?d[a](a):h[a]}};
GRUNT.configurable=function(h,d,b,a){function e(g){h[g]||(h[g]=function(m){return h.configure(g,m)})}if(h){if(!h.configurableSettings){h.configurableId=GRUNT.generateObjectID("configurable");h.configurableSettings={};h.configCallbacks=[];if(!GRUNT.configurables)GRUNT.configurables={}}GRUNT.configurables[h.configurableId]=h;h.configCallbacks.push(b);for(b=d.length;b--;){h.configurableSettings[d[b]]=true;a&&e(d[b])}if(!h.configure)h.configure=function(g,m){var l=h.configCallbacks;if(h.configurableSettings[g]){for(var t=
l.length;t--;){var p=l[t](g,m);if(typeof p!=="undefined")return p}return GRUNT.configurables[h.configurableId]}return null}}};GRUNT.Template=function(){var h=/\$\{(.*?)\}/ig;return{parse:function(d,b){for(var a=d,e=h.exec(a);e;){a=a.replace(e[0],GRUNT.XPath.first(e[1],b));h.lastIndex=0;e=h.exec(a)}return a}}}();
GRUNT.JSONP=function(){function h(e){var g=document.createElement("script"),m=false;g.src=e;g.async=true;g.onload=g.onreadystatechange=function(){if(!m&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){m=true;g.onload=g.onreadystatechange=null;g&&g.parentNode&&g.parentNode.removeChild(g)}};b||(b=document.getElementsByTagName("head")[0]);b.appendChild(g)}var d=0,b,a=this;return{get:function(e,g,m){e+=e.indexOf("?")>=0?"&":"?";var l="json"+ ++d;a[l]=function(t){g(t);a[l]=
null;try{delete a[l]}catch(p){}};h(e+(m?m:"callback")+"="+l);return l}}}();
GRUNT.XHR=function(){var h={HTML:"text/html",XML:"text/xml",TEXT:"text/plain",STREAM:"application/octet-stream"},d={JSON:["json"],PDON:["pdon.txt"]},b=["TEXT","STREAM"],a=/^(\w+:)?\/\/([^\/?#]+)/,e={XML:function(l){return l.responseXML},JSON:function(l){try{return JSON.parse(l.responseText)}catch(t){GRUNT.Log.error("Error parsing JSON data: ",l.responseText);GRUNT.Log.exception(t)}return""},PDON:function(l){return GRUNT.Data.parse({data:l.responseText,format:"PDON"})},DEFAULT:function(l){return l.responseText}},
g={CONTENT_TYPE:"Content-Type"},m=GRUNT.newModule({id:"GRUNT.xhr",ajaxSettings:{xhr:null},ajax:function(l){try{l=GRUNT.extend({method:"GET",data:null,url:null,async:true,success:null,handleResponse:null,error:null,contentType:"application/x-www-form-urlencoded"},m.ajaxSettings,l);var t=a.exec(l.url),p=t&&(t[1]&&t[1]!==location.protocol||t[2]!==location.host);if(l.data)l.method="POST";if(l.url){t=null;if(l.xhr)t=l.xhr(l);t||(t=new XMLHttpRequest);t.open(l.method,l.url,l.async);l.data&&t.setRequestHeader("Content-Type",
l.contentType);p||t.setRequestHeader("X-Requested-With","XMLHttpRequest");t.onreadystatechange=function(){if(this.readyState===4){var o=null,s=!this.status&&location.protocol==="file:"||this.status>=200&&this.status<300||this.status===304||this.status===1223||this.status===0;try{if(s)if(l.handleResponse)l.handleResponse(this);else{var q=l,n=this.getResponseHeader(g.CONTENT_TYPE),u,k=false;for(u in h)if(n&&n.indexOf(h[u])>=0){k=true;break}n=!k;for(k=0;k<b.length;k++)n=n||b[k]==u;if(n)b:{n=u;for(var r in d)for(k=
0;k<d[r].length;k++)if(RegExp(d[r][k]+"$","i").test(q.url)){u=r;break b}u=n?n:"DEFAULT"}try{o=e[u](this,q)}catch(v){GRUNT.Log.warn("error applying processor '"+u+"' to response type, falling back to default");o=e.DEFAULT(this,q)}}else l.error&&l.error(this)}catch(w){GRUNT.Log.exception(w,"PROCESSING AJAX RESPONSE")}s&&o&&l.success&&l.success.call(this,o)}};t.send(l.method=="POST"?m.param(l.data):null)}else GRUNT.Log.warn("ajax request issued with no url - that ain't going to work...")}catch(f){GRUNT.Log.exception(f)}},
param:function(l){var t=[],p=function(o,s){s=GRUNT.isFunction(s)?s():s;t[t.length]=encodeURIComponent(o)+"="+encodeURIComponent(s)};if(GRUNT.isArray(l))for(var f=0;f<l.length;f++)p(l[f].name,l[f].value);else for(f in l)p(f,l[f]);return t.join("&").replace(/%20/g,"+")}});return m}();
GRUNT.XPath=function(){function h(e){for(var g=null,m=0;m<d.length;m++)if(g=d[m](e))break;return g}var d=[],b=[null,function(e){return e.numberValue},function(e){return e.stringValue},function(e){return e.booleanValue},null,null,null,null,function(e){return e.singleNodeValue?e.singleNodeValue.textContent:null},function(e){return e.singleNodeValue?e.singleNodeValue.textContent:null}];typeof XPathResult!=="undefined"||GRUNT.Log.warn("No XPATH support, this is going to cause problems");var a={SearchResult:function(e){return{toString:function(){var g=
null;if(e){var m=null;if(e.resultType>=0&&e.resultType<b.length)m=b[e.resultType];if(m){GRUNT.Log.info("invoking match handler for result type: "+e.resultType);g=m(e)}}return g?g:""}}},first:function(e,g){var m=a.SearchResult,l;var t=XPathResult.FIRST_ORDERED_NODE_TYPE;if(!t)t=XPathResult.ANY_TYPE;try{if(GRUNT.isXmlDocument(g))l=g.evaluate(e,g,h,t,null);else{GRUNT.Log.warn("attempted xpath expression: "+e+" on a non-xml document");l=null}}catch(p){GRUNT.Log.warn("attempted to run invalid xpath expression: "+
e+" on node: "+g);l=null}return new m(l)},registerResolver:function(e){d.push(e)}};return a}();
GRUNT.observable=function(h){if(h){if(!h.observableHandlers)h.observableHandlers={};if(!(h.bind||h.trigger||h.unbind)){h.bind=function(d,b){var a=GRUNT.generateObjectID("callback"),e=h.observableHandlers;e[d]||(e[d]=[]);h.observableHandlers[d].push({callback:b,callbackId:a});return a};h.trigger=function(d){var b=h.observableHandlers[d];if(!b)return h;for(var a=b.length;a--;)b[a].callback.apply(self,Array.prototype.slice.call(arguments,1));return h};h.unbind=function(d,b){for(var a=h.observableHandlers[d],
e=0;a&&e<a.length;e++)if(a[e].callbackId===b){a.splice(e,1);break}return h}}}};GRUNT.WaterCooler=function(){var h={},d=[];return{addPipe:function(b){b("pipe.test",{});d.push(b)},listen:function(b,a){h[b]||(h[b]=[]);a&&h[b].push(a)},say:function(b,a){var e;for(e=d.length;e--;)d[e](b,a);if(h[b])for(e=h[b].length;e--;)h[b][e](a)},leave:function(){}}}();
GRUNT.Storage=function(){function h(d){if(d&&d=="session")return sessionStorage;return localStorage}return{get:function(d,b){var a=h(b).getItem(d);return/^(\{|\[).*(\}|\])$/.test(a)?JSON.parse(a):a},set:function(d,b,a){b=jQuery.isArray(b)||jQuery.isPlainObject(b)?JSON.stringify(b):b;h(a).setItem(d,b)},remove:function(d,b){h(b).removeItem(d)}}}();
GRUNT.ParseRules=function(){var h=[];return{add:function(d,b){h.push({regex:d,handler:b})},each:function(d,b,a){function e(){g++;a&&g>=h.length&&a(b)}for(var g=0,m=0;m<h.length;m++){var l=h[m].regex,t=h[m].handler,p=false;if(l){l.lastIndex=-1;if((l=l.exec(d))&&t){p=true;t(l,b,e)&&e()}}p||e()}}}};
T5=function(){var h={ex:GRUNT.extend,newCanvas:function(d,b){var a=document.createElement("canvas");typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(a);a.width=d?d:0;a.height=b?b:0;return a},time:function(){return(new Date).getTime()},Settings:function(){var d={};return{get:function(b){return d[b]},set:function(b,a){d[b]=a},extend:function(b){T5.ex(d,b)}}}(),Vector:function(d,b){return{x:d?d:0,y:b?b:0}},V:function(){function d(b){if(!b||b.length<=1)throw Error("Cannot determine edge distances for a vector array of only one vector");
for(var a={edges:Array(b.length-1),accrued:Array(b.length-1),total:0},e=T5.V.diff,g=0;g<b.length-1;g++){var m=e(b[g],b[g+1]);a.edges[g]=Math.sqrt(m.x*m.x+m.y*m.y);a.accrued[g]=a.total+a.edges[g];a.total+=a.edges[g]}return a}return{create:function(b,a){return new h.Vector(b,a)},add:function(){for(var b=new h.Vector,a=arguments.length;a--;){b.x+=arguments[a].x;b.y+=arguments[a].y}return b},absSize:function(b){return Math.max(Math.abs(b.x),Math.abs(b.y))},diff:function(b,a){return new h.Vector(b.x-a.x,
b.y-a.y)},copy:function(b){return b?new h.Vector(b.x,b.y):null},invert:function(b){return new T5.Vector(-b.x,-b.y)},offset:function(b,a,e){return new T5.Vector(b.x+a,b.y+(e?e:a))},edges:d,distance:function(b){return d(b).total},theta:function(b,a,e){e=Math.asin((b.y-a.y)/e);return b.x>a.x?e:Math.PI-e},pointOnEdge:function(b,a,e,g){a=new T5.Vector(Math.cos(e)*g,Math.sin(e)*g);return new T5.Vector(b.x-a.x,b.y-a.y)},getRect:function(b){var a=b.length;if(a>1)return new T5.Rect(Math.min(b[0].x,b[a-1].x),
Math.min(b[0].y,b[a-1].y),Math.abs(b[0].x-b[a-1].x),Math.abs(b[0].y-b[a-1].y))},toString:function(b){return b.x+", "+b.y}}}(),Dimensions:function(d,b){return{width:d?d:0,height:b?b:0}},D:function(){return{getAspectRatio:function(d){return d.height!==0?d.width/d.height:1},getCenter:function(d){return new h.Vector(d.width/2,d.height/2)},getSize:function(d){return Math.sqrt(Math.pow(d.width,2)+Math.pow(d.height,2))}}}(),Rect:function(d,b,a,e){return{origin:new h.Vector(d,b),dimensions:new h.Dimensions(a,
e)}},R:function(){return{copy:function(d){return d?new h.Rect(d.origin.x,d.origin.y,d.dimensions.width,d.dimensions.height):null},getCenter:function(d){return new T5.Vector(d.origin.x+d.dimensions.width/2,d.origin.y+d.dimensions.height/2)}}}()};return h}();
T5.Device=function(){function h(){for(;f.length>0;){var s=f.shift();document.location=s}p=0}function d(s){for(var q=true,n=o.length;n--;)q=q&&s!=o[n];return q}function b(s,q){var n=[];for(var u in q)u&&n.push(u+"="+escape(q[u]));return"tile5://"+s+"/"+(n.length>0?"?"+n.join("&"):"")}function a(s,q){d(s)&&GRUNT.Log.info("would push url: "+b(s,q))}function e(s,q){if(d(s)){f.push(b(s,q));p||(p=setTimeout(h,100))}}function g(){m={base:{name:"Unknown",eventTarget:document,supportsTouch:"createTouch"in
document,imageCacheMaxSize:null,getScaling:function(){return 1},maxImageLoads:null,requireFastDraw:false,bridgeNotify:a,targetFps:null},ipod:{name:"iPod Touch",regex:/ipod/i,imageCacheMaxSize:6144,maxImageLoads:4,requireFastDraw:false,bridgeNotify:e,targetFps:25},iphone:{name:"iPhone",regex:/iphone/i,imageCacheMaxSize:6144,maxImageLoads:4,bridgeNotify:e},ipad:{name:"iPad",regex:/ipad/i,imageCacheMaxSize:6144,bridgeNotify:e},android:{name:"Android OS <= 2.1",regex:/android/i,eventTarget:document.body,
supportsTouch:true,getScaling:function(){return 1/window.devicePixelRatio},bridgeNotify:e},froyo:{name:"Android OS >= 2.2",regex:/froyo/i,eventTarget:document.body,supportsTouch:true,bridgeNotify:e}};l=[m.froyo,m.android,m.ipod,m.iphone,m.ipad]}var m=null,l=[],t=null,p=0,f=[],o=["view.wake","tile.loaded"];return{getConfig:function(){m||g();if(!t){GRUNT.Log.info("ATTEMPTING TO DETECT PLATFORM: UserAgent = "+navigator.userAgent);for(var s=0;s<l.length;s++){var q=l[s];if(q.regex&&q.regex.test(navigator.userAgent)){t=
T5.ex({},m.base,q);GRUNT.Log.info("PLATFORM DETECTED AS: "+t.name);break}}if(!t){GRUNT.Log.warn("UNABLE TO DETECT PLATFORM, REVERTING TO BASE CONFIGURATION");t=m.base}GRUNT.Log.info("CURRENT DEVICE PIXEL RATIO = "+window.devicePixelRatio)}return t}}}();
T5.Resources=function(){var h="",d={},b={getPath:function(a){return/^(file|https?|\/)/.test(a)?a:h+a},setBasePath:function(a){h=a},loadResource:function(a){a=T5.ex({filename:"",cacheable:true,dataType:null,callback:null},a);var e=function(g){a.callback&&GRUNT.Log.watch("CALLING RESOURCE CALLBACK",function(){a.callback(g)})};a.cacheable&&d[a.filename]?e(d[a.filename]):GRUNT.XHR.ajax({url:b.getPath(a.filename),dataType:a.dataType,success:function(g){if(a.cacheable)d[a.filename]=g;e(g)},error:function(g,
m,l){GRUNT.Log.error("error loading resource ["+a.filename+"], error = "+l)}})},loadSnippet:function(a,e){/\.\w+$/.test(a)||(a+=".html");b.loadResource({filename:"snippets/"+a,callback:e,dataType:"html"})}};return b}();
T5.Images=function(){function h(){var n=g[this.id];if(n&&n.image.complete&&n.image.width>0){n.loaded=true;n.hitCount=1;for(var u=t.length;u--;)if(t[u].image.src==this.src){t.splice(u,1);break}if(n.background||n.postProcess)if(n.image){u=T5.newCanvas(n.realSize?n.realSize.width:image.width,n.realSize?n.realSize.height:image.height);var k=u.getContext("2d"),r=n.offset?n.offset:new T5.Vector;n.background&&k.drawImage(n.background,0,0);k.drawImage(n.image,r.x,r.y);n.postProcess&&n.postProcess(k,n);n.image=
u}n.loadCallback&&n.loadCallback(this,false);p.push({url:this.src,created:n.requested});delete g[this.id];d()}}function d(){for(var n=T5.Device.getConfig().maxImageLoads;l.length>0&&(!n||t.length<n);){var u=l.shift();if(u.imageLoader){t.push(u);u.imageLoader(u,h)}}}function b(n){for(var u=null,k=f.length;k--&&!u;)u=f[k](n);return u?u:function(r,v){r.image.onload=v;r.image.src=T5.Resources.getPath(r.url);r.requested=T5.time()}}function a(){s=true;try{var n=Math.floor(p.length/2);if(n>0){p.sort(function(k,
r){return k.created-r.created});for(var u=n;u--;)delete e[p[u].url];p.splice(0,n)}}finally{s=false}GRUNT.WaterCooler.say("imagecache.cleared")}var e={},g={},m=0,l=[],t=[],p=[],f=[],o=0,s=false,q={avgImageSize:25,loadTimeout:10,addInterceptor:function(n){f.push(n)},cancelLoad:function(){t=[]},get:function(n){var u=null,k=null;s||(u=e[n]);if((k=u?u.image:null)&&(k.getContext||k.complete&&k.width>0))return k},load:function(n,u,k){var r=e[n];if(r){r.hitCount++;r.image.complete&&u&&u(r.image,true)}else{r=
T5.ex({url:n,image:new Image,loaded:false,imageLoader:b(n),created:T5.time(),requested:null,hitCount:0,loadCallback:u},k);r.image.id="resourceLoaderImage"+m++;e[n]=r;g[r.image.id]=r;l.push(r);d()}return r},stats:function(){return{imageLoadingCount:t.length,queuedImageCount:l.length,imageCacheFullness:o}}};setInterval(function(){for(var n=T5.time(),u=false,k=0,r=T5.Device.getConfig();k<t.length;)if(n-t[k].requested>q.loadTimeout*1E3){t.splice(k,1);u=true}else k++;u&&d();if(r&&r.imageCacheMaxSize){o=
p.length*q.avgImageSize/r.imageCacheMaxSize;o>=1&&a()}},1E3);return q}();
T5.Touch=function(){function h(q,n){var u=q&&q.length>0?q[0]:null;if(u&&n&&n.length>0)return T5.V.diff(u,n[0]);return null}function d(q){q.preventDefault();q.stopPropagation()}function b(q){for(var n=Array(q.length),u=q.length;u--;)n[u]=new T5.Vector(q[u].pageX,q[u].pageY);return n}function a(q){return[new T5.Vector(q.pageX,q.pageY)]}var e=120,g=100,m=250,l={TAP:0,MOVE:1,PINCHZOOM:2},t=7,p=0,f=0,o=function(q){function n(y,C,H,E){var O=Math.asin((y.y-C.y)/H);H=Math.min(Math.floor(H*(Y.duration/E)),
Y.max);O=C.x>y.x?O:Math.PI-O;y=new T5.Vector(Math.cos(O)*-H,Math.sin(O)*H);r("inertiaPan",y.x,y.y)}function u(y,C){var H,E;if(M){H=C-Z;if(H<m){E=T5.V.distance([I[0],y]);E>q.inertiaTrigger&&n(I[0],y,E,H)}}else{U=y;var O=setInterval(function(){H=T5.time()-C;E=T5.V.distance([y,U]);if(H<g&&E>q.inertiaTrigger){clearInterval(O);n(y,U,E,H)}else H>g&&clearInterval(O)},5)}}function k(y){for(var C=[],H=q.element?-q.element.offsetLeft:0,E=q.element?-q.element.offsetTop:0,O=y.length;O--;)C.push(T5.V.offset(y[O],
H,E));return C}function r(){q.observable&&q.observable.trigger.apply(null,arguments)}function v(y){if(y.target&&y.target===q.element){I=M?b(y.touches):a(y);T=new T5.Vector;P=new T5.Vector;X=true;G=false;Z=T5.time();d(y);y.target.style.cursor="move";r("inertiaCancel");V.current=Z;if(y=I.length>0?I[0]:null){r("touchStart",y.x,y.y);if(V.current-V.last<fa.THRESHOLD_DOUBLETAP)if((y=S?T5.V.diff(I[0],S[0]):null)&&Math.abs(y.x)<q.maxDistDoubleTap&&Math.abs(y.y)<q.maxDistDoubleTap)G=true;Q=l.TAP;S=[].concat(I)}else GRUNT.Log.warn("Touch start fired, but no touch vector found")}}
function w(y){if(y.target&&y.target===q.element){U=(M?b(y.touches):a(y))[0];if(X){M&&d(y);y=M?b(y.touches):a(y);var C=0;if(y.length>1){if(I.length===1)I=[].concat(y);C=T5.V.distance(I)-T5.V.distance(y)}if(Q===l.TAP){var H=h(y,I);if(H&&(Math.abs(H.x)>=t||Math.abs(H.y)>=t))Q=l.MOVE}if(Q!==l.TAP)if(!C||Math.abs(C)<q.pinchZoomThreshold){if(T=h(y,S)){P.x-=T.x;P.y-=T.y;L.x-=T.x;L.y-=T.y}if(T5.V.absSize(L)>q.panEventThreshhold){r("pan",L.x,L.y);L=T5.V.create()}Q=l.MOVE}else{r("pinchZoom",k(I),k(y));Q=l.PINCHZOOM}S=
[].concat(y)}}}function z(y){if(y.target&&y.target===q.element){var C=(M?b(y.changedTouches):a(y))[0];M&&d(y);var H=T5.time();V.last=V.current;if(Q===l.TAP)F||(F=setTimeout(function(){F=0;var E=G?"doubleTap":"tap",O=I[0],ba=null;if(q.element)ba=T5.V.offset(O,-q.element.offsetLeft,-q.element.offsetTop);r(E,O,ba)},fa.THRESHOLD_DOUBLETAP+50));else if(Q==l.MOVE){r("panEnd",P.x,P.y);Y&&u(C,H)}else Q==l.PINCHZOOM&&r("pinchZoomEnd",k(I),k(S),H-Z);y.target.style.cursor="default";X=false}}function A(y){if(y.target&&
y.target===q.element){var C;if(y.detail){C=-y.detail*e;C=new T5.Vector(y.axis===1?C:0,y.axis===2?C:0)}else C=new T5.Vector(y.wheelDeltaX,y.wheelDeltaY);var H=C.y!==0?Math.abs(C.y/e):0;if(U&&H!==0){var E=T5.V.offset(U,-q.element.offsetLeft,-q.element.offsetTop);r("wheelZoom",E,Math.pow(2,C.y>0?H:-H))}y.preventDefault()}}q=T5.ex({element:null,observable:null,inertiaTrigger:20,maxDistDoubleTap:20,panEventThreshhold:0,pinchZoomThreshold:5,touchStartHandler:null,moveHandler:null,moveEndHandler:null,pinchZoomHandler:null,
pinchZoomEndHandler:null,tapHandler:null,doubleTapHandler:null,wheelZoomHandler:null},q);var G=false,F=0,M=T5.Device.getConfig().supportsTouch,I=null,S=null,T=null,P=null,L=new T5.Vector,Q=null,X=false,Z=0,$=[],U=null,Y=null,V={current:0,last:0},N=T5.Device.getConfig(),fa={supportsTouch:M,THRESHOLD_DOUBLETAP:300,addListeners:function(y){$.push(y)},decoupleListeners:function(y){for(var C=0;y&&C<$.length;C++)if($[C].listenerId===y){$.splice(C,1);GRUNT.Log.info("successfully decoupled touch listener: "+
y);break}},release:function(){N.eventTarget.removeEventListener(N.supportsTouch?"touchstart":"mousedown",v,false);N.eventTarget.removeEventListener(N.supportsTouch?"touchmove":"mousemove",w,false);N.eventTarget.removeEventListener(N.supportsTouch?"touchend":"mouseup",z,false);if(!N.supportsTouch){window.removeEventListener("mousewheel",A,false);window.removeEventListener("DOMMouseScroll",A,false)}},inertiaEnable:function(y,C){Y={duration:y,max:C?Math.min(C.width,C.height):500}},inertiaDisable:function(){Y=
null}};N.eventTarget.addEventListener(N.supportsTouch?"touchstart":"mousedown",v,false);N.eventTarget.addEventListener(N.supportsTouch?"touchmove":"mousemove",w,false);N.eventTarget.addEventListener(N.supportsTouch?"touchend":"mouseup",z,false);if(!N.supportsTouch){window.addEventListener("mousewheel",A,false);window.addEventListener("DOMMouseScroll",A,false)}return fa},s=[];return{capture:function(q,n){if(!q)throw Error("Unable to capture touch of null element");if(!q.id)q.id="touchable_"+p++;var u=
s[q.id];if(!u){u=new o(T5.ex({element:q},n));s[q.id]=u;GRUNT.Log.info("CREATED TOUCH HELPER. SUPPORTS TOUCH = "+u.supportsTouch)}n.listenerId&&u.decoupleListeners(n.listenerId);n.listenerId=++f;u.addListeners(n);return u},resetTouch:function(q){if(q&&q.id&&s[q.id]){s[q.id].release();delete s[q.id]}}}}();if(typeof jQuery!=="undefined"){jQuery.fn.canTouchThis=function(h){return this.each(function(){T5.Touch.capture(this,h)})};jQuery.fn.untouchable=function(){return this.bind("touchmove",function(h){h.preventDefault()})}}
T5.Dispatcher=function(){var h=[],d={execute:function(b){var a=d.findAction(b);a&&a.execute.apply(a,Array.prototype.slice.call(arguments,1))},findAction:function(b){for(var a=h.length;a--;)if(h[a].id==b)return h[a];return null},getRegisteredActions:function(){return[].concat(h)},getRegisteredActionIds:function(){for(var b=[],a=h.length;a--;)h[a].id&&b.push(h[a].id);return b},registerAction:function(b){b&&b.id&&h.push(b)},Action:function(b){b=T5.ex({autoRegister:true,id:"",title:"",icon:"",execute:null},
b);var a={id:b.id,execute:function(){b.execute&&b.execute.apply(this,arguments)},getParam:function(e){return b[e]?b[e]:""},toString:function(){return String.format("{0} [title = {1}, icon = {2}]",a.id,b.title,b.icon)}};b.autoRegister&&d.registerAction(a);return a},Agent:function(b){b=GRUNT.extend({name:"Untitled",translator:null,execute:null},b);var a={getName:function(){return b.name},getParam:function(e){return b[e]},getId:function(){return GRUNT.toID(a.getName())},run:function(e,g){if(b.execute){var m=
b.translator?b.translator(e):e;b.execute.call(a,m,function(l,t){g&&g(l,t,m)})}}};return a},runAgents:function(b,a,e){for(var g=0;g<b.length;g++)b[g].run(a,e)}};return d}();
T5.Easing=function(){var h=1.70158;return{Linear:function(d,b,a,e){return a*d/e+b},Back:{In:function(d,b,a,e){return a*(d/=e)*d*((h+1)*d-h)+b},Out:function(d,b,a,e){return a*((d=d/e-1)*d*((h+1)*d+h)+1)+b},InOut:function(d,b,a,e){return(d/=e/2)<1?a/2*d*d*(((h*=1.525)+1)*d-h)+b:a/2*((d-=2)*d*(((h*=1.525)+1)*d+h)+2)+b}},Bounce:{In:function(d,b,a,e){return a-module.Easing.Bounce.Out(e-d,0,a,e)+b},Out:function(d,b,a,e){return(d/=e)<1/2.75?a*7.5625*d*d+b:d<2/2.75?a*(7.5625*(d-=1.5/2.75)*d+0.75)+b:d<2.5/
2.75?a*(7.5625*(d-=2.25/2.75)*d+0.9375)+b:a*(7.5625*(d-=2.625/2.75)*d+0.984375)+b},InOut:function(d,b,a,e){return d<e/2?module.Easing.Bounce.In(d*2,0,a,e)/2+b:module.Easing.Bounce.Out(d*2-e,0,a,e)/2+a/2+b}},Cubic:{In:function(d,b,a,e){return a*(d/=e)*d*d+b},Out:function(d,b,a,e){return a*((d=d/e-1)*d*d+1)+b},InOut:function(d,b,a,e){if((d/=e/2)<1)return a/2*d*d*d+b;return a/2*((d-=2)*d*d+2)+b}},Elastic:{In:function(d,b,a,e,g,m){if(d==0)return b;if((d/=e)==1)return b+a;m||(m=e*0.3);if(!g||g<Math.abs(a)){g=
a;a=m/4}else a=m/(2*Math.PI)*Math.asin(a/g);return-(g*Math.pow(2,10*(d-=1))*Math.sin((d*e-a)*2*Math.PI/m))+b},Out:function(d,b,a,e,g,m){var l;if(d==0)return b;if((d/=e)==1)return b+a;m||(m=e*0.3);if(!g||g<Math.abs(a)){g=a;l=m/4}else l=m/(2*Math.PI)*Math.asin(a/g);return g*Math.pow(2,-10*d)*Math.sin((d*e-l)*2*Math.PI/m)+a+b},InOut:function(d,b,a,e,g,m){var l;if(d==0)return b;if((d/=e/2)==2)return b+a;m||(m=e*0.3*1.5);if(!g||g<Math.abs(a)){g=a;l=m/4}else l=m/(2*Math.PI)*Math.asin(a/g);if(d<1)return-0.5*
g*Math.pow(2,10*(d-=1))*Math.sin((d*e-l)*2*Math.PI/m)+b;return g*Math.pow(2,-10*(d-=1))*Math.sin((d*e-l)*2*Math.PI/m)*0.5+a+b}},Quad:{In:function(d,b,a,e){return a*(d/=e)*d+b},Out:function(d,b,a,e){return-a*(d/=e)*(d-2)+b},InOut:function(d,b,a,e){if((d/=e/2)<1)return a/2*d*d+b;return-a/2*(--d*(d-2)-1)+b}},Sine:{In:function(d,b,a,e){return-a*Math.cos(d/e*(Math.PI/2))+a+b},Out:function(d,b,a,e){return a*Math.sin(d/e*(Math.PI/2))+b},InOut:function(d,b,a,e){return-a/2*(Math.cos(Math.PI*d/e)-1)+b}}}}();
T5.Animation=function(){function h(){if(a===0)a=setInterval(function(){var g;g=T5.time();if(!b){b=true;try{for(var m=0;m<d.length;)if(d[m].isComplete()){d[m].triggerComplete(false);d.splice(m,1)}else{d[m].update(g);m++}}finally{b=false}}g=d.length;if(g===0){clearInterval(a);a=0}},20)}var d=[],b=false,a=0,e={DURATION:2E3,tweenValue:function(g,m,l,t,p){g=new e.Tween({startValue:g,endValue:m,tweenFn:l,complete:t,duration:p});d.push(g);return g},tween:function(g,m,l,t,p,f){g=new e.Tween({target:g,property:m,
endValue:l,tweenFn:t,duration:f,complete:p});d.push(g);return g},tweenVector:function(g,m,l,t,p,f){var o=[];if(g){var s=g.x==m,q=g.y==l;s||o.push(e.tween(g,"x",m,t,function(){(s=true)&&q&&p()},f));q||o.push(e.tween(g,"y",l,t,function(){q=true;s&&q&&p()},f))}return o},cancel:function(g){if(!b){b=true;try{for(var m=0;m<d.length;)if(!g||g(d[m])){d[m].triggerComplete(true);d.splice(m,1)}else m++}finally{b=false}}},isTweening:function(){return d.length>0},Tween:function(g){g=T5.ex({target:null,property:null,
startValue:0,endValue:null,duration:e.DURATION,tweenFn:e.DEFAULT,complete:null,cancelOnInteract:false},g);var m=T5.time(),l=[],t=false,p=0,f=0,o={cancelOnInteract:g.cancelOnInteract,isComplete:function(){return t},triggerComplete:function(s){g.complete&&g.complete(s)},update:function(s){try{var q=g.tweenFn(s-m,p,f,g.duration);if(g.target)g.target[g.property]=q;for(var n=l.length;n--;)l[n](q,void 0);if(t=m+g.duration<=s){if(g.target)g.target[g.property]=g.tweenFn(g.duration,p,f,g.duration);for(var u=
l.length;u--;)l[u](q,true)}}catch(k){GRUNT.Log.exception(k)}},requestUpdates:function(s){l.push(s)}};p=g.target&&g.property&&g.target[g.property]?g.target[g.property]:g.startValue;if(typeof g.endValue!=="undefined")f=g.endValue-p;if(f==0)t=true;h();return o}};return T5.ex(e,{DEFAULT:T5.Easing.Back.Out})}();T5.ViewState=function(){var h={NONE:0,ACTIVE:1,ANIMATING:4,PAN:8,PINCHZOOM:16,FREEZE:128,get:function(){for(var d=0,b=arguments.length;b--;){var a=h[arguments[b]];if(a)d|=a}return d}};return h}();
T5.ViewLayer=function(h){h=T5.ex({id:"",centerOnScale:true,created:T5.time(),scalePosition:true,zindex:0,supportFastDraw:false,validStates:T5.ViewState.get("ACTIVE","ANIMATING","PAN","PINCHZOOM")},h);var d=null,b=h.id,a=T5.ViewState.get("ACTIVE"),e=T5.ex({addToView:function(g){g.setLayer(b,e)},shouldDraw:function(g){var m=d?d.fastDraw&&g!==a:false;return(g&h.validStates)!==0&&(m?h.supportFastDraw:true)},cycle:function(){return 0},draw:function(){},remove:function(){GRUNT.WaterCooler.say("layer.remove",
{id:b})},wakeParent:function(){d&&d.trigger("wake")},getId:function(){return b},setId:function(g){b=g},getParent:function(){return d},setParent:function(g){d=g}},h);return e};
T5.View=function(h){function d(x,B,D,K){X=typeof D!=="undefined";J.updateOffset(z.x+x,z.y+B,D,K);k();W=T5.ViewState.PAN}function b(x,B){h.inertia&&d(x,B,h.panAnimationEasing,h.panAnimationDuration)}function a(){W=T5.ViewState.ACTIVE;X=false;setTimeout(k,50)}function e(x,B){C=T5.V.getRect(x);H=T5.V.getRect(B);var D=T5.D.getSize(C.dimensions),K=T5.D.getSize(H.dimensions);ea=T5.R.getCenter(C);L=T5.R.getCenter(H);E=C&&D!==0?K/D:1}function g(x,B){e(x,B);if(y=E!==1){W=T5.ViewState.PINCHZOOM;k()}}function m(x,
B,D){e(x,B);if(h.adjustScaleFactor){E=h.adjustScaleFactor(E);GRUNT.Log.info("scale factor adjusted to: "+E)}if(D<h.pinchZoomAnimateTrigger){o(O,E,ea,s(),T5.Easing.Sine.Out,function(){t();E=1},300);E=O}else{t();E=1}}function l(x,B){J.zoom(x,Math.min(Math.pow(2,Math.round(Math.log(B))),8),500)}function t(){GRUNT.WaterCooler.say("view.scale",{id:J.id});y=false;J.trigger("scale",E,C?s():L);W=T5.ViewState.ACTIVE;k()}function p(){if(v){T5.Touch.resetTouch(v);if(h.autoSize){v.height=window.innerHeight-v.offsetTop;
v.width=window.innerWidth-v.offsetLeft}try{w=v.getContext("2d");w.globalCompositeOperation=h.initialDrawMode;w.clearRect(0,0,v.width,v.height)}catch(x){GRUNT.Log.exception(x);throw Error("Could not initialise canvas on specified view element");}ha=T5.Touch.capture(v,{observable:J});h.inertia&&ha.inertiaEnable(h.panAnimationDuration,I);I=J.getDimensions();S=T5.D.getCenter(I);k()}}function f(x,B){B.setId(x);B.setParent(J);r.push(B);r.sort(function(D,K){var R=K.zindex-D.zindex;if(R===0)R=K.created-D.created;
return R})}function o(x,B,D,K,R,aa,ca){function ga(){aa&&aa();t();E=1;ba=null}y=true;ea=T5.V.copy(D);L=T5.V.copy(K);C=null;if(R)T5.Animation.tweenValue(0,B-x,R,ga,ca?ca:1E3).requestUpdates(function(da){ba=da/(B-x);E=x+da;W=T5.ViewState.PINCHZOOM;k();J.trigger("animate")});else{E=targetScaleFactor;ga()}}function s(){var x=T5.D.getCenter(I),B=T5.V.distance([L,x]),D=T5.V.theta(L,x,B),K=T5.V.diff(ea,L);x=T5.V.pointOnEdge(L,x,D,B/E);x.x+=K.x;x.y+=K.y;return x}function q(){J.trigger("idle");Q=true;U=0}
function n(x,B){var D=0,K=J.getDisplayState(),R=T5.time(),aa=(K&T5.ViewState.PINCHZOOM)!==0,ca=0;if(A||aa){x.clearRect(0,0,v.width,v.height);A=false}if(aa){T5.D.getCenter(I);var ga=(ba?ba:1)/2,da=T5.V.diff(ea,L);if(V=C?new T5.Vector(L.x+da.x,L.y+da.y):new T5.Vector(L.x-da.x*ga,L.y-da.y*ga))B=T5.V.offset(B,V.x,V.y)}x.save();try{O=E;if(M!==1)x.scale(M,M);else if(aa){x.translate(L.x,L.y);x.scale(E,E)}for(ca=r.length;ca--;)if(r[ca].shouldDraw(K)){var ia=r[ca].draw(x,B,I,K,J);D+=ia?ia:0}}finally{x.restore()}GRUNT.Log.trace("draw complete",
R);$=false;return D}function u(){var x=0,B=!X&&(W===T5.ViewState.PINCHZOOM||W===T5.ViewState.PAN);N=T5.time();z.x=Math.floor(z.x);z.y=Math.floor(z.y);P&&G&&P.delays.push(N-G);if(B){T5.Animation.cancel(function(K){return K.cancelOnInteract});Q=false;if(U!==0){clearTimeout(U);U=0}}for(B=r.length;B--;){var D=r[B].cycle(N,z,W);x+=D?D:0}if(G+fa<N){x+=n(w,z);G=N}Z=0;if(T+x>0)k();else if(!Q&&U===0)U=setTimeout(q,500);GRUNT.Log.trace("Completed draw cycle",N)}function k(){T++;if(!(F||Z!==0)){T=0;Z=setTimeout(u,
0)}}h=T5.ex({id:GRUNT.generateObjectID("view"),container:"",clearOnDraw:false,scaleDamping:false,fastDraw:false,fillStyle:"rgb(200, 200, 200)",initialDrawMode:"source-over",bufferRefresh:100,defaultFreezeDelay:500,inertia:true,pannable:true,scalable:true,panAnimationEasing:T5.Easing.Sine.Out,panAnimationDuration:750,pinchZoomAnimateTrigger:400,adjustScaleFactor:null,autoSize:false},h);var r=[],v=document.getElementById(h.container),w=null,z=new T5.Vector,A=false,G=null,F=false,M=1,I=null,S=null,T=
0,P=null,L=null,Q=false,X=false,Z=0,$=false,U=0,Y=0,V=null,N=0;T5.Device.getConfig();var fa=0,y=false,C=null,H=null,E=1,O=1,ba=null,ea=null,ha=null,W=T5.ViewState.ACTIVE,J={id:h.id,deviceScaling:M,fastDraw:h.fastDraw||T5.Device.getConfig().requireFastDraw,animate:function(x,B,D,K,R){o(E,x,B,D,K,R)},centerOn:function(x){J.setOffset(x.x-v.width/2,x.y-v.height/2)},getDimensions:function(){if(v)return new T5.Dimensions(v.width,v.height)},getZoomCenter:function(){return V},getLayer:function(x){for(var B=
0;B<r.length;B++)if(r[B].getId()==x)return r[B];return null},setLayer:function(x,B){for(var D=0;D<r.length;D++)if(r[D].getId()===x){r.splice(D,1);break}B&&f(x,B);GRUNT.WaterCooler.say("layer.update",{id:x});k()},eachLayer:function(x){for(var B=0;B<r.length;B++)x(r[B])},clearBackground:function(){A=true},freeze:function(){F=true},unfreeze:function(){F=false;k()},needRepaint:function(){return $},snapshot:function(){},getDisplayState:function(){return F?T5.ViewState.FROZEN:W},scale:function(x,B,D,K,
R){K||(K=T5.D.getCenter(I));R||(R=T5.D.getCenter(I));J.animate(x,K,R,B,D);return J},removeLayer:function(x){a:{for(var B=r.length;B--;)if(r[B].getId()==x){x=B;break a}x=-1}if(x>=0&&x<r.length){GRUNT.WaterCooler.say("layer.removed",{layer:r[x]});r.splice(x,1)}},getOffset:function(){return T5.V.copy(z)},setOffset:function(x,B){z.x=x;z.y=B},updateOffset:function(x,B,D,K,R){function aa(){a(0,0);R&&R()}if(D){x=new T5.Vector(x,B);D=T5.Animation.tweenVector(z,x.x,x.y,D,aa,K);for(K=D.length;K--;){D[K].cancelOnInteract=
true;D[K].requestUpdates(function(){k();h.onAnimate&&h.onAnimate(z.x,z.y)})}}else J.setOffset(x,B)},zoom:function(x,B,D){X=false;E=B;y=E!==1;ea=T5.D.getCenter(J.getDimensions());L=E>1?T5.V.copy(x):T5.D.getCenter(J.getDimensions());C=null;clearTimeout(Y);if(y){W=T5.ViewState.PINCHZOOM;k();if(D)Y=setTimeout(function(){t();E=1},parseInt(D,10))}}};GRUNT.WaterCooler.listen("layer.remove",function(x){x.id&&J.removeLayer(x.id)});M=T5.Device.getConfig().getScaling();GRUNT.observable(J);J.bind("wake",k);J.bind("invalidate",
function(){$=true});if(h.pannable){J.bind("pan",d);J.bind("panEnd",a);J.bind("inertiaPan",b);J.bind("inertiaCancel",function(){X=false;k()})}if(h.scalable){J.bind("pinchZoom",g);J.bind("pinchZoomEnd",m);J.bind("wheelZoom",l)}GRUNT.configurable(J,["inertia","container"],GRUNT.paramTweaker(h,null,{container:function(x,B){v=document.getElementById(B);p()}}),true);p();return J};
T5.AnimatedPathLayer=function(h){function d(l,t,p){l.fillStyle="#FFFFFF";l.strokeStyle="#222222";l.beginPath();l.arc(p.x,p.y,4,0,Math.PI*2,false);l.stroke();l.fill()}h=T5.ex({path:[],id:GRUNT.generateObjectID("pathAnimation"),easing:T5.Easing.Sine.InOut,validStates:T5.ViewState.get("ACTIVE","PAN","PINCHZOOM"),drawIndicator:null,duration:2E3,autoCenter:false},h);var b=T5.V.edges(h.path),a,e=null,g=0;T5.Animation.tweenValue(0,b.total,h.easing,function(){m.remove()},h.duration).requestUpdates(function(l,
t){g=l;t&&m.remove()});var m=T5.ex(new T5.ViewLayer(h),{cycle:function(){for(var l=0;l<b.accrued.length&&b.accrued[l]<g;)l++;e=null;if(l<h.path.length-1){var t=g-(l>0?b.accrued[l-1]:0),p=h.path[l],f=h.path[l+1];a=T5.V.theta(p,f,b.edges[l]);e=T5.V.pointOnEdge(p,f,a,t);if(h.autoCenter)(l=m.getParent())&&l.centerOn(e)}return e?1:0},draw:function(l,t){if(e)(h.drawIndicator?h.drawIndicator:d)(l,t,new T5.Vector(e.x-t.x,e.y-t.y),a)}});return m};
T5.Tiling=function(){TileStore=function(a){a=T5.ex({tileSize:null,gridSize:null,center:new T5.Vector,onPopulate:null},a);if(!a.tileSize)throw Error("Cannot create TileStore with an empty tile size");if(!a.gridSize)throw Error("0 grid size for TileStore");var e=Array(Math.pow(a.gridSize,2)),g=T5.V.offset(a.center,-Math.ceil(a.gridSize>>1)),m=null,l=new T5.Vector,t=null,p={find:function(f){if(!f)return null;for(var o=e.length;o--;){var s=e[o];if(s&&f(s))return s}return null},getGridSize:function(){return a.gridSize},
getGridXY:function(f,o){return T5.Vector(f*a.tileSize-l.x,o*a.tileSize-l.y)},getNormalizedPos:function(f,o){return T5.V.add(new T5.Vector(f,o),T5.V.invert(g),l)},getTileShift:function(){return T5.V.copy(l)},getTile:function(f,o){return f>=0&&f<a.gridSize?e[o*a.gridSize+f]:null},setTile:function(f,o,s){e[o*a.gridSize+f]=s},populate:function(f,o,s){var q=GRUNT.Log.getTraceTicks(),n=0,u=a.gridSize,k=a.tileSize;new T5.Vector(u/2,u/2);if(s)e=[];if(f)for(s=0;s<u;s++)for(var r=0;r<u;r++){if(!e[n]){var v=
f(r,s,g,u);v.gridX=r*k-l.x;v.gridY=s*k-l.y;e[n]=v}n++}m=f;t=o;GRUNT.Log.trace("tile grid populated",q);a.onPopulate&&a.onPopulate()},getShiftDelta:function(f,o,s,q){var n=Math.floor(a.gridSize*0.2),u=new T5.Vector;if(f<0||f+s>a.gridSize)u.x=f<0?-n:n;if(o<0||o+q>a.gridSize)u.y=o<0?-n:n;return u},shift:function(f,o){if(!(f.x===0&&f.y===0)){var s=GRUNT.Log.getTraceTicks(),q=Array(e.length);q.length=e.length;for(var n=0;n<a.gridSize;n++)for(var u=0;u<a.gridSize;u++)q[u*a.gridSize+n]=p.getTile(n+f.x,u+
f.y);e=q;g=o?o(g,f):T5.V.add(g,f);l.x+=-f.x*a.tileSize;l.y+=-f.y*a.tileSize;GRUNT.Log.trace("tile storage shifted",s);p.populate(m,t)}},setOrigin:function(f,o){if(tileOrigin)shiftOrigin(f,o);else g=T5.V.offset(new T5.Vector(f,o),-tileHalfWidth)}};GRUNT.WaterCooler.listen("imagecache.cleared",function(){for(var f=e.length;f--;)if(e[f])e[f].loaded=false});GRUNT.WaterCooler.listen("tiler.repaint",function(){for(var f=e.length;f--;)if(e[f]){e[f].x=null;e[f].y=null}});return p};var h=null,d=null,b={Config:{TILESIZE:256,
TILEBUFFER:1,TILEBUFFER_LOADNEW:0.2},getEmptyTile:function(a){if(!h||a!==h.width){h=T5.newCanvas(a,a);a=h.getContext("2d");a.fillStyle="rgba(150, 150, 150, 0.01)";a.fillRect(0,0,h.width,h.height)}return h},getPanningTile:function(a){function e(){var g=T5.newCanvas(32,32),m=g.getContext("2d");m.fillStyle="#BBBBBB";m.fillRect(0,0,32,32);m.fillStyle="#C3C3C3";m.fillRect(0,0,16,16);m.fillRect(16,16,16,16);return g}if(!d||a!==d.width){d=T5.newCanvas(a,a);a=d.getContext("2d");a.fillStyle=a.createPattern(e(),
"repeat");a.fillRect(0,0,d.width,d.height)}return d},Tile:function(a){return a=T5.ex({x:0,y:0,gridX:0,gridY:0,dirty:false},a)},ImageTile:function(a){a=T5.ex({url:"",sessionParamRegex:null,loaded:false},a);return new b.Tile(a)},TileGrid:function(a){function e(w,z){var A=m.getGridXY(w,z);return new b.ImageTile({gridX:A.x,gridY:A.y})}function g(w,z){if(r){var A,G=[],F=new T5.Vector(Math.floor((w.x+q.x)*t),Math.floor((w.y+q.y)*t));tilesNeeded=false;for(var M=k;M--;)for(var I=u;I--;){A=m.getTile(I+F.x,
M+F.y);var S=new T5.Vector(I-r.x,M-r.y);if(!A){s=m.getShiftDelta(F.x,F.y,u,k);A=e(I+F.x,M+F.y)}G.push({tile:A,centerness:T5.V.absSize(S)})}G.sort(function(T,P){return P.centerness-T.centerness});f||(f=Array(G.length));for(A=G.length;A--;){f[A]=G[A].tile;v.prepTile(f[A],z)}}}a=T5.ex({tileSize:T5.Tiling.Config.TILESIZE,drawGrid:false,center:new T5.Vector,gridSize:25,shiftOrigin:null,supportFastDraw:true},a);var m=new TileStore(T5.ex({tileSize:a.tileSize,gridSize:a.gridSize,onPopulate:function(){v.dirty=
true;v.wakeParent()}},a)),l=Math.round(a.tileSize/2),t=a.tileSize?1/a.tileSize:0,p=true,f=null,o=false;new T5.Vector;var s=new T5.Vector,q=new T5.Vector;T5.Device.getConfig();var n=m.getGridSize()*a.tileSize,u,k,r,v=T5.ex(new T5.ViewLayer(a),{gridDimensions:new T5.Dimensions(n,n),dirty:false,cycle:function(w,z,A){w=0;if(s.x!==0||s.y!==0){m.shift(s,a.shiftOrigin);q=m.getTileShift();s=new T5.Vector;w++}A!==T5.ViewState.PINCHZOOM&&g(z,A);return w+v.dirty?1:0},deactivate:function(){p=false},find:function(){return m.find.apply(null,
arguments)},prepTile:function(){},drawTile:function(){return false},getTileSize:function(){return a.tileSize},draw:function(w,z,A,G,F){if(p){var M=T5.time(),I=z.x;z=z.y;var S=true,T=F.needRepaint()||G===T5.ViewState.PANNING||G===T5.ViewState.PINCHZOOM||T5.Animation.isTweening();if(!r){u=Math.ceil(A.width*t)+1;k=Math.ceil(A.height*t)+1;r=new T5.Vector(Math.floor((u-1)/2),Math.floor((k-1)/2))}if(f){if(a.drawGrid)w.strokeStyle="rgba(50, 50, 50, 0.3)";w.beginPath();for(A=f.length;A--;){var P=f[A];if(P){var L=
P.gridX-I,Q=P.gridY-z;if(!(T?false:!P.dirty)){S=v.drawTile(w,P,L,Q,G)&&S;P.x=L;P.y=Q}}else S=false;a.drawGrid&&w.rect(L,Q,a.tileSize,a.tileSize)}w.stroke();GRUNT.Log.trace("drawn tiles",M);S&&!o&&F.trigger("tileDrawComplete");o=S;v.dirty=false}}},getTileAtXY:function(w,z){for(var A=a.tileSize,G=f?f.length:0;G--;){var F=f[G];if(F&&w>=F.x&&z>=F.y)if(w<=F.x+A&&z<=F.y+A)return F}return null},getTileVirtualXY:function(w,z,A){w=m.getNormalizedPos(w,z);w=new T5.Vector(w.x*a.tileSize,w.y*a.tileSize);if(A){w.x+=
l;w.y+=l}return w},populate:function(w){m.populate(w,null,true)}});return v},ImageTileGrid:function(a){function e(){s.getParent().trigger("invalidate");s.dirty=true;s.wakeParent()}a=T5.ex({emptyTile:b.getEmptyTile(b.Config.TILESIZE),panningTile:b.getPanningTile(b.Config.TILESIZE),tileOffset:new T5.Vector,tileDrawArgs:{}},a);var g=a.emptyTile,m=a.panningTile,l=T5.ViewState.ACTIVE,t=T5.ViewState.PAN,p=T5.Device.getConfig().requireFastDraw,f=a.tileSize?a.tileSize:b.Config.TILESIZE,o=T5.ex({background:null,
overlay:null,offset:new T5.Vector,realSize:new T5.Dimensions(f,f)},a.tileDrawArgs),s=T5.ex(new b.TileGrid(a),{drawTile:function(q,n,u,k,r){var v=n.url?T5.Images.get(n.url):null,w=false;if(v){q.drawImage(v,u,k);n.dirty=false;w=true}else if(r===t)m&&q.drawImage(m,u,k);else g&&q.drawImage(g,u,k);return w},prepTile:function(q,n){if(q)q.dirty=true;if(q&&(!p||n===l))T5.Images.get(q.url)||T5.Images.load(q.url,e,o)}});return s}};return b}();
T5.Tiler=function(h){h=T5.ex({container:"",drawCenter:false,datasources:{},tileLoadThreshold:"first"},h);var d=T5.ex(new T5.View(h),{getTileLayer:function(){return d.getLayer("grid0")},setTileLayer:function(b){d.setLayer("grid0",b);GRUNT.WaterCooler.say("grid.updated",{id:"grid0"})},viewPixToGridPix:function(b){var a=d.getOffset();return new T5.Vector(b.x+a.x,b.y+a.y)},centerOn:function(b,a,e,g){var m=d.getTileLayer(),l=d.getDimensions();(m=m?m.getTileSize():0)&&d.updateOffset(b.gridX-Math.floor((l.width-
m)*0.5),b.gridY-Math.floor((l.height-m)*0.5),a,e,g)},cleanup:function(){d.removeLayer("grid0")},repaint:function(){GRUNT.WaterCooler.say("tiler.repaint");d.trigger("wake")},select:function(b){d.trigger("selectTile",b)}});d.bind("tap",function(b,a){var e=d.getTileLayer();if(e)(e=e.getTileAtXY(a.x,a.y))&&d.trigger("selectTile",e)});return d};
T5.Geo=function(){function h(p,f){var o=null;for(var s in l)if(f){if(s==f&&l[s][p]){o=l[s];break}}else if(l[s][p]){o=l[s];break}return o}function d(p,f,o,s){var q=0;p=p.toUpperCase();for(var n in s){var u=f[n];if(u){var k=o[n];u=k?k(p,u):p.containsWord(u)?1:0;q+=u*s[n]}}return q}var b=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],a=Math.PI/180,e=180/Math.PI,g=null,m={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",HWY:"HIGHWAY",
MWY:"MOTORWAY"},l={},t={Engine:function(p){if(!p.id)throw Error("A GEO.Engine cannot be registered without providing an id.");var f=T5.ex({remove:function(){delete l[f.id]}},p);return l[f.id]=f},Radius:function(p,f){return{distance:parseInt(p,10),uom:f}},Position:function(p,f){return{lat:parseFloat(p?p:0),lon:parseFloat(f?f:0)}},BoundingBox:function(p,f){return{min:t.P.parse(p),max:t.P.parse(f)}},Address:function(p){return p=T5.ex({streetDetails:"",location:"",country:"",postalCode:"",pos:null,boundingBox:null},
p)},GeocodeFieldWeights:{streetDetails:50,location:50},AddressCompareFns:{},Utilities:function(){var p={dist2rad:function(f){return f/6371},lat2pix:function(f,o){var s=parseFloat(f)*2*Math.PI/360;s=Math.sin(s);var q=0.08181919084262157*s;return Math.log((1+s)/(1-s)*Math.pow((1-q)/(1+q),0.08181919084262157))/2/o},lon2pix:function(f,o){return parseFloat(f)/180*Math.PI/o},pix2lon:function(f,o){return p.normalizeLon(f*o*180/Math.PI)},pix2lat:function(f,o){for(var s=Math.pow(Math.E,-f*o),q=p.mercatorUnproject(s),
n=p.findRadPhi(q,s),u=0;u<12&&Math.abs(q-n)>1.0E-7;){q=n;n=p.findRadPhi(q,s);u++}return n*180/Math.PI},mercatorUnproject:function(f){return Math.PI/2-2*Math.atan(f)},findRadPhi:function(f,o){var s=0.08181919084262157*Math.sin(f);return Math.PI/2-2*Math.atan(o*Math.pow((1-s)/(1+s),0.040909595421310785))},normalizeLon:function(f){for(;f<-180;)f+=360;for(;f>180;)f-=360;return f}};return p}(),GeoSearchResult:function(p){p=T5.ex({id:null,caption:"",resultType:"",data:null,pos:null,matchWeight:0},p);return T5.ex(p,
{toString:function(){return p.caption+(p.matchWeight?" ("+p.matchWeight+")":"")}})},GeoSearchAgent:function(p){return new T5.Dispatcher.Agent(p)},GeocodingAgent:function(p){p=T5.ex({name:"Geocoding Search Agent",paramTranslator:null,execute:function(f,o){try{if(!f.reverse&&!f.freeform)address=new t.Address(f);var s=t.getEngine("geocode");if(s)s.geocode({addresses:[f.freeform?f.freeform:address],complete:function(n,u){if(o){var k=u;if(f.freeform)k=t.rankGeocodeResponses(f.freeform,k,t.getEngine("geocode"));
o(k,p)}}})}catch(q){GRUNT.Log.exception(q)}}},p);return new t.GeoSearchAgent(p)},PointOfInterest:function(p){p=T5.ex({id:0,title:"",pos:null,lat:"",lon:"",group:"",retrieved:0,isNew:true},p);if(!p.pos&&p.lat&&p.lon)p.pos=new T5.Geo.Position(p.lat,p.lon);return T5.ex({toString:function(){return p.id+": '"+p.title+"'"}},p)},POIStorage:function(p){function f(k){k=k?k:"default";q[k]||(q[k]=[]);return q[k]}function o(k){var r=[];for(var v in q)for(var w=0;w<q[v].length;w++)if(!k||k(q[v][w]))r.push(q[v][w]);
return r}function s(){GRUNT.WaterCooler.say("geo.pois-updated",{srcID:u.id,pois:u.getPOIs()})}p=T5.ex({visibilityChange:null,onPOIDeleted:null,onPOIAdded:null},p);var q={},n=true,u={id:GRUNT.generateObjectID(),getPOIs:function(){return o()},getOldPOIs:function(k,r){return o(function(v){return v.group==k&&v.retrieved<r})},getVisible:function(){return n},setVisible:function(k){if(k!=n){n=k;p.visibilityChange&&p.visibilityChange()}},findById:function(k){var r=o(function(v){return v.id==k});return r.length>
0?r[0]:null},findByBounds:function(k){return o(function(r){return T5.Geo.P.inBounds(r.pos,k)})},addPOIs:function(k,r){if(r)q={};for(var v=0;k&&v<k.length;v++){k[v].retrieved=T5.time();var w=k[v];f(w.group).push(w)}},removeGroup:function(k){if(q[k]){delete q[k];s()}},update:function(k){var r=[],v=0,w=k.length>0?k[0].group:"",z=T5.time();for(v=0;v<k.length;v++){var A;a:{if(A=k[v])for(var G=f(A.group),F=0;F<G.length;F++)if(G[F].id==A.id){A=G[F];break a}A=null}if(A){A.retrieved=z;A.isNew=false}else r.push(k[v])}k=
u.getOldPOIs(w,z);u.addPOIs(r);for(v=0;p.onPOIAdded&&v<r.length;v++)p.onPOIAdded(r[v]);for(v=0;v<k.length;v++){p.onPOIDeleted&&p.onPOIDeleted(k[v]);w=k[v];z=f(w.group);for(A=0;A<z.length;A++)if(z[A].id==w.id){z.splice(A,1);break}}r.length+k.length>0&&s()}};return u},MapProvider:function(){var p=1,f=20;return{zoomLevel:0,checkZoomLevel:function(o){return Math.min(Math.max(o,p),f)},getCopyright:function(){},getLogoUrl:function(){},getMapTiles:function(){},getZoomRange:function(){return{min:p,max:f}},
setZoomRange:function(o,s){p=o;f=s}}},P:function(){var p={calcDistance:function(f,o){if(p.empty(f)||p.empty(o))return 0;var s=(o.lat-f.lat).toRad()/2,q=(o.lon-f.lon).toRad()/2;s=Math.sin(s)*Math.sin(s)+Math.cos(f.lat.toRad())*Math.cos(o.lat.toRad())*Math.sin(q)*Math.sin(q);return 6371*2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s))},copy:function(f){return f?new t.Position(f.lat,f.lon):null},empty:function(f){return!f||f.lat===0&&f.lon===0},equal:function(f,o){return f&&o&&f.lat==o.lat&&f.lon==o.lon},almostEqual:function(f,
o){return f&&o&&Math.floor(f.lat*1E3)===Math.floor(o.lat*1E3)&&Math.floor(f.lon*1E3)===Math.floor(o.lon*1E3)},inArray:function(f,o){for(var s=t.P.equal,q=o.length;q--;)if(s(f,o[q]))return true;return false},inBounds:function(f,o){var s=!(t.P.empty(f)||t.P.empty(o));return s=(s=s&&f.lat>=o.min.lat&&f.lat<=o.max.lat)&&f.lon>=o.min.lon&&f.lon<=o.max.lon},parse:function(f){if(f)if(typeof f.lat!=="undefined")return p.copy(f);else{if(f.split)for(var o=[" ",","],s=0;s<o.length;s++){var q=f.split(o[s]);if(q.length===
2)return new t.Position(q[0],q[1])}}else return new t.Position;return null},parseArray:function(f){var o=f.length,s=Array(o);for(o=o;o--;)s[o]=p.parse(f[o]);GRUNT.Log.info("parsed "+s.length+" positions");return s},fromMercatorPixels:function(f,o,s){return new t.Position(T5.Geo.Utilities.pix2lat(o,s),T5.Geo.Utilities.normalizeLon(T5.Geo.Utilities.pix2lon(f,s)))},toMercatorPixels:function(f,o){return new T5.Vector(T5.Geo.Utilities.lon2pix(f.lon,o),T5.Geo.Utilities.lat2pix(f.lat,o))},generalize:function(f,
o,s){var q=f.length,n=[],u=null;s||(s=250);s/=1E3;GRUNT.Log.info("generalizing positions, must include "+o.length+" positions");for(var k=q;k--;)if(k===0)n.unshift(f[k]);else{var r=!u||t.P.inArray(f[k],o)?s:t.P.calcDistance(u,f[k]);if(f[k]&&r>=s){n.unshift(f[k]);u=f[k]}}GRUNT.Log.info("generalized "+q+" positions into "+n.length+" positions");return n},toString:function(f){return f?f.lat+" "+f.lon:""}};return p}(),B:function(){var p=-(Math.PI/2),f=Math.PI/2,o=-Math.PI*2,s=Math.PI*2,q={calcSize:function(n,
u,k){var r=new T5.Vector(0,u.lat-n.lat);if(typeof k==="undefined")k=true;r.x=k&&n.lon>u.lon?360-n.lon+u.lon:u.lon-n.lon;return r},createBoundsFromCenter:function(n,u){var k=u/6371,r=n.lat*a,v=n.lon*a,w=r-k,z=r+k;if(w>p&&z<f){r=Math.asin(Math.sin(k)/Math.cos(r));k=v-r;if(k<o)k+=2*Math.PI;v=v+r;if(v>s)v-=2*Math.PI}else{w=Math.max(w,p);z=Math.min(z,f);k=o;v=s}return new t.BoundingBox(new t.Position(w*e,k*e),new t.Position(z*e,v*e))},expand:function(n,u){return new t.BoundingBox(new t.Position(n.min.lat-
u,n.min.lon-t.Utilities.normalizeLon(u)),new t.Position(n.max.lat+u,n.max.lon+t.Utilities.normalizeLon(u)))},forPositions:function(n,u){var k=null,r=T5.time();u||(u="auto");for(var v=n.length;v--;)if(k){var w=q.calcSize(k.min,n[v],false),z=q.calcSize(n[v],k.max,false);if(w.x<0)k.min.lon=n[v].lon;if(w.y<0)k.min.lat=n[v].lat;if(z.x<0)k.max.lon=n[v].lon;if(z.y<0)k.max.lat=n[v].lat}else k=new T5.Geo.BoundingBox(n[v],n[v]);if(u){if(u=="auto"){v=q.calcSize(k.min,k.max);u=Math.max(v.x,v.y)*0.3}k=q.expand(k,
u)}GRUNT.Log.trace("calculated bounds for "+n.length+" positions",r);return k},getCenter:function(n){var u=t.B.calcSize(n.min,n.max);return new T5.Geo.Position(n.min.lat+u.y/2,n.min.lon+u.x/2)},getGeoHash:function(n){var u=T5.Geo.GeoHash.encode(n.min.lat,n.min.lon);n=T5.Geo.GeoHash.encode(n.max.lat,n.max.lon);GRUNT.Log.info("min hash = "+u+", max hash = "+n)},getZoomLevel:function(n,u){var k=q.getCenter(n),r=b[Math.min(Math.round(Math.abs(k.lat)*0.05),b.length)],v=q.calcSize(n.min,n.max);k=Math.ceil(Math.log(b[3]*
u.height/v.y)/Math.log(2));r=Math.ceil(Math.log(r*u.width/v.x)/Math.log(2));return Math.min(isNaN(k)?1E3:k,isNaN(r)?1E3:r)},isEmpty:function(n){return!n||t.P.empty(n.min)||t.P.empty(n.max)},toString:function(n){return"min: "+t.P.toString(n.min)+", max: "+t.P.toString(n.max)}};return q}(),A:function(){var p=/^(\d+).*$/,f=/(\d+)\s?\-\s?(\d+)/;return{buildingMatch:function(o,s){p.lastIndex=-1;if(p.test(o))for(var q=o.replace(p,"$1"),n=s.split(","),u=0;u<n.length;u++){f.lastIndex=-1;if(f.test(n[u])){var k=
f.exec(n[u]);if(q>=parseInt(k[1],10)&&q<=parseInt(k[2],10))return true}else if(q==n[u])return true}return false},normalize:function(o){if(!o)return"";o=o.toUpperCase();if(!g){var s=[];for(var q in m)s.push(q);g=RegExp("(\\s)("+s.join("|")+")(\\s|$)","i")}g.lastIndex=-1;if(s=g.exec(o))o=o.replace(g,"$1"+m[s[2]]);return o},toString:function(o){return o.streetDetails+" "+o.location}}}(),getEngine:function(p){for(var f=null,o=1;!f&&o<arguments.length;o++)f=h(p,arguments[o]);f=f?f:h(p);if(!f)throw Error("Unable to find GEO engine with "+
p+" capability");return f},rankGeocodeResponses:function(p,f,o){var s=[],q=t.AddressCompareFns;if(o&&o.compareFns)q=T5.ex({},q,o.compareFns);for(o=0;o<f.length;o++)s.push(new t.GeoSearchResult({caption:t.A.toString(f[o]),data:f[o],pos:f[o].pos,matchWeight:d(p,f[o],q,t.GeocodeFieldWeights)}));s.sort(function(n,u){return u.matchWeight-n.matchWeight});return s}};return t}();
T5.Geo.GeoHash=function(){function h(d,b,a){if(b&a)d[0]=(d[0]+d[1])/2;else d[1]=(d[0]+d[1])/2}BITS=[16,8,4,2,1];BASE32="0123456789bcdefghjkmnpqrstuvwxyz";NEIGHBORS={right:{even:"bc01fg45238967deuvhjyznpkmstqrwx"},left:{even:"238967debc01fg45kmstqrwxuvhjyznp"},top:{even:"p0r21436x8zb9dcf5h7kjnmqesgutwvy"},bottom:{even:"14365h7k9dcfesgujnmqp0r2twvyx8zb"}};BORDERS={right:{even:"bcfguvyz"},left:{even:"0145hjnp"},top:{even:"prxz"},bottom:{even:"028b"}};NEIGHBORS.bottom.odd=NEIGHBORS.left.even;NEIGHBORS.top.odd=
NEIGHBORS.right.even;NEIGHBORS.left.odd=NEIGHBORS.bottom.even;NEIGHBORS.right.odd=NEIGHBORS.top.even;BORDERS.bottom.odd=BORDERS.left.even;BORDERS.top.odd=BORDERS.right.even;BORDERS.left.odd=BORDERS.bottom.even;BORDERS.right.odd=BORDERS.top.even;return{decode:function(d){var b=1,a=[],e=[];a[0]=-90;a[1]=90;e[0]=-180;e[1]=180;lat_err=90;lon_err=180;for(i=0;i<d.length;i++){c=d[i];cd=BASE32.indexOf(c);for(j=0;j<5;j++){mask=BITS[j];if(b){lon_err/=2;h(e,cd,mask)}else{lat_err/=2;h(a,cd,mask)}b=!b}}a[2]=(a[0]+
a[1])/2;e[2]=(e[0]+e[1])/2;return{latitude:a,longitude:e}},encode:function(d,b,a){var e=1,g=[],m=[],l=0,t=0;a=a?a:12;geohash="";g[0]=-90;g[1]=90;m[0]=-180;for(m[1]=180;geohash.length<a;){if(e){mid=(m[0]+m[1])/2;if(b>mid){t|=BITS[l];m[0]=mid}else m[1]=mid}else{mid=(g[0]+g[1])/2;if(d>mid){t|=BITS[l];g[0]=mid}else g[1]=mid}e=!e;if(l<4)l++;else{geohash+=BASE32[t];t=l=0}}return geohash}}}();
T5.Geo.Search=function(){return{bestResults:function(h,d){d||(d=20);for(var b=h.length>0?h[0]:null,a=[],e=0;e<h.length;e++)if(b&&h[e]&&b.matchWeight-h[e].matchWeight<=d)a.push(h[e]);else break;return a}}}();
T5.Geo.Routing=function(){var h={calculate:function(d){d=T5.ex({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},d);GRUNT.Log.info("attempting to calculate route");var b=T5.Geo.getEngine("route");b&&b.route(d,function(a){if(d.generalize)a.geometry=T5.Geo.P.generalize(a.geometry,a.getInstructionPositions());if(d.map){h.createMapOverlay(d.map,a);if(d.autoFit){GRUNT.Log.info("AUTOFITTING MAP TO ROUTE: bounds = "+a.boundingBox);d.map.gotoBounds(a.boundingBox)}}d.success&&
d.success(a)})},createMapOverlay:function(d,b){var a=d.getDimensions();a=new T5.Geo.UI.RouteOverlay({data:b,width:a.width,height:a.height});d.setLayer("route",a)},parseTurnType:function(d){for(var b=h.TurnType.Unknown,a=T5.Geo.Routing.TurnTypeRules,e=0;e<a.length;e++){a[e].regex.lastIndex=-1;var g=a[e].regex.exec(d);if(g){b=a[e].customCheck?a[e].customCheck(d,g):a[e].turnType;break}}return b},TurnType:{Unknown:"turn-unknown",Start:"turn-none-start",Continue:"turn-none",Arrive:"turn-none-arrive",TurnLeft:"turn-left",
TurnLeftSlight:"turn-left-slight",TurnLeftSharp:"turn-left-sharp",TurnRight:"turn-right",TurnRightSlight:"turn-right-slight",TurnRightSharp:"turn-right-sharp",Merge:"merge",UTurnLeft:"uturn-left",UTurnRight:"uturn-right",EnterRoundabout:"roundabout-enter",Ramp:"ramp",RampExit:"ramp-exit"},Instruction:function(d){d=T5.ex({position:null,description:"",turnType:null},d);if(!d.turnType)d.turnType=h.parseTurnType(d.description);return d},RouteData:function(d){d=T5.ex({geometry:[],instructions:[],boundingBox:null},
d);if(!d.boundingBox)d.boundingBox=T5.Geo.B.forPositions(d.geometry);return T5.ex({getInstructionPositions:function(){for(var b=[],a=0;a<d.instructions.length;a++)d.instructions[a].position&&b.push(d.instructions[a].position);return b}},d)}};return h}();
T5.Geo.Routing.TurnTypeRules=function(){var h=T5.Geo.Routing.TurnType,d=[];d.push({regex:/continue/i,turnType:h.Continue});d.push({regex:/(take|bear|turn)(.*?)left/i,customCheck:function(b,a){return/bear/i.test(a[1])?h.TurnLeftSlight:h.TurnLeft}});d.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(b,a){return/bear/i.test(a[1])?h.TurnRightSlight:h.TurnRight}});d.push({regex:/enter\s(roundabout|rotaty)/i,turnType:h.EnterRoundabout});d.push({regex:/take.*?ramp/i,turnType:h.Ramp});d.push({regex:/take.*?exit/i,
turnType:h.RampExit});d.push({regex:/make(.*?)u\-turn/i,customCheck:function(b,a){return/right/i.test(a[1])?h.UTurnRight:h.UTurnLeft}});d.push({regex:/proceed/i,turnType:h.Start});d.push({regex:/arrive/i,turnType:h.Arrive});d.push({regex:/fell\sthrough/i,turnType:h.Merge});return d}();
T5.Geo.UI=function(){var h=0,d={AnnotationTween:null,GeoTileGrid:function(b){b=T5.ex({grid:null,centerPos:new T5.Geo.Position,centerXY:new T5.Vector,radsPerPixel:0},b);var a=T5.Geo.P.toMercatorPixels(b.centerPos,b.radsPerPixel),e=a.x-b.centerXY.x,g=a.y-b.centerXY.y,m=T5.ex({},b.grid,{getBoundingBox:function(l,t,p,f){return new T5.Geo.BoundingBox(m.pixelsToPos(new T5.Vector(l,t+f)),m.pixelsToPos(new T5.Vector(l+p,t)))},getGridXYForPosition:function(l){l=T5.Geo.P.toMercatorPixels(l,b.radsPerPixel);
return new T5.Vector(l.x-e,m.gridDimensions.height-(l.y-g))},getPixelDistance:function(l){l=T5.Geo.Utilities.dist2rad(l);return Math.floor(l/b.radsPerPixel)},pixelsToPos:function(l){return T5.Geo.P.fromMercatorPixels(e+l.x,g+m.gridDimensions.height-l.y,b.radsPerPixel)}});return m},RouteOverlay:function(b){b=T5.ex({data:null,pixelGeneralization:8,calculationsPerCycle:250,partialDraw:false,strokeStyle:"rgba(0, 51, 119, 0.9)",waypointFillStyle:"#FFFFFF",lineWidth:4,zindex:50},b);var a=true,e=null,g=
[],m=0,l=[],t=[],p=T5.ex(new T5.ViewLayer(b),{getAnimation:function(f,o,s,q){if(a)return null;var n="routeAnimation"+h++;t.push(n);return new T5.AnimatedPathLayer({id:n,path:g,zindex:b.zindex+1,easing:f?f:T5.Easing.Sine.InOut,duration:o?o:5E3,drawIndicator:s,autoCenter:q?q:false})},draw:function(f,o,s,q,n){s=0;q=b.data?b.data.geometry:null;if(a){a=false;e=null;g=[];m=0}if(q&&m<q.length){a:{n=n.getTileLayer();l=[];if(n){q=GRUNT.Log.getTraceTicks();var u,k,r,v=b.data?b.data.geometry:[],w=v.length,z=
b.data?b.data.instructions:[],A=z.length,G=b.calculationsPerCycle,F=0;for(u=m;u<w;u++){k=n.getGridXYForPosition(v[u]);if(r=!e||u===0||Math.abs(k.x-e.x)+Math.abs(k.y-e.y)>b.pixelGeneralization){g.push(k);e=k}F++;if(F>=G){m=u;break a}}m=w;GRUNT.Log.trace(w+" geometry points generalized to "+g.length+" coordinates",q);e=null;for(u=A;u--;)if(z[u].position){k=n.getGridXYForPosition(z[u].position);if(r=!e||u===0||Math.abs(k.x-e.x)+Math.abs(k.y-e.y)>b.pixelGeneralization){l.push(k);e=k}}}}s++}n=g.length;
if(n>0&&(!s||b.partialDraw)){f.strokeStyle=b.strokeStyle;f.lineWidth=b.lineWidth;f.beginPath();f.moveTo(g[n-1].x-o.x,g[n-1].y-o.y);for(n=n;n--;)f.lineTo(g[n].x-o.x,g[n].y-o.y);f.stroke();f.fillStyle=b.waypointFillStyle;for(n=l.length;n--;){f.beginPath();f.arc(l[n].x-o.x,l[n].y-o.y,2,0,Math.PI*2,false);f.stroke();f.fill()}}return s}});GRUNT.WaterCooler.listen("grid.updated",function(){for(var f=t.length;f--;)GRUNT.WaterCooler.say("layer.remove",{id:t[f]});t=[];a=true;p.wakeParent()});return p},Annotation:function(b){b=
T5.ex({xy:null,pos:null,draw:null,calcXY:null,tweenIn:d.AnnotationTween,animationSpeed:null},b);var a=false,e={xy:b.xy,pos:b.pos,isNew:true,isAnimating:function(){return a},calcXY:function(g){e.xy=g.getGridXYForPosition(e.pos);b.calcXY&&b.calcXY(g)},draw:function(g,m,l,t,p){if(e.xy){if(e.isNew&&b.tweenIn){var f=e.xy.y;e.xy.y=m.y-20;a=true;T5.Animation.tween(e.xy,"y",f,b.tweenIn,function(){e.xy.y=f;a=false},b.animationSpeed?b.animationSpeed:250+Math.random()*500)}if(b.draw)b.draw(g,m,new T5.Vector(e.xy.x-
m.x,e.xy.y-m.y),l,t,p);else{g.beginPath();g.arc(e.xy.x-m.x,e.xy.y-m.y,4,0,Math.PI*2,false);g.fill()}e.isNew=false}}};return e},ImageAnnotation:function(b){b=T5.ex({imageUrl:null,animatingImageUrl:null,imageAnchor:null},b);var a=b.imageAnchor?T5.V.invert(b.imageAnchor):null;b.draw=function(g,m,l,t,p){if(b.animatingImageUrl&&e.isAnimating()){T5.Images.load(b.imageUrl);t=b.animatingImageUrl}else t=b.imageUrl;if(m=T5.Images.get(t)){if(m.complete&&m.width>0){a||(a=new T5.Vector(-m.width>>1,-m.height>>
1));l=T5.V.offset(l,a.x,a.y);g.drawImage(m,l.x,l.y,m.width,m.height)}}else T5.Images.load(t,function(){p.wakeParent()})};var e=new d.Annotation(b);return e},LocationAnnotation:function(b){b=T5.ex({accuracy:null},b);var a=new Image,e=new T5.Vector,g=null;a.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAACIQAAAiEBPhEQkwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAG+SURBVCiRlZHNahNRAIW/O7mTTJPahLZBA1YUyriINRAE3bQIKm40m8K8gLj0CRQkO32ELHUlKbgoIu4EqeJPgtCaoBuNtjXt5LeTMZk0mbmuWiuuPLsD3+HAOUIpxf9IHjWmaUbEyWv5ROrsVULhcHP761rUfnN3Y2Otc8CIg4YT85lzuVsPP+Qupw1vpPjRCvhS9ymvV0e77x7nNj+uvADQAIQQ+uLyvdfLV9JGZi7EdEwQlqBpEJ019f0z1mo2u5Q8DMydv25lshemmj1FueZTawbs7inarqLbV7Qjab1upB9YlhWSAHLavLHZCvg1VEhN0PMU9W7At4bPVidg7CtkLLXkut+lBPD6/Ub155jJiADAHSpaLmx3ApyBQoYEUd0PBoOBkAC6+3llvda/YxgGgYL+UNHf/zN3KiExGlsvTdP0NYDkhPdWrz35ZDsBzV5wCMuQwEyFmXFeeadjzfuFQmGkAZRKpdGC/n7x+M6jqvA9Zo6FWDhlcHE+wqT93J1tP7vpOE7rrx8ALMuasPf8S12St4WmJ6bYWTUC52k8Hm8Vi0X/nwBAPp/XKpWKdF1X2LYdlMvlsToC/QYTls7DLFr/PAAAAABJRU5ErkJggg%3D%3D";
a.onload=function(){e=new T5.Vector(a.width/2,a.height/2)};var m=new d.Annotation(T5.ex({calcXY:function(l){g=Math.floor(l.getPixelDistance(m.accuracy)*0.5)},draw:function(l,t,p,f,o,s){t=p.x-e.x;f=p.y-e.y;if(g&&m.drawAccuracyIndicator){l.fillStyle="rgba(30, 30, 30, 0.2)";l.beginPath();l.arc(p.x,p.y,g,0,Math.PI*2,false);l.fill()}a.complete&&a.width>0&&l.drawImage(a,t,f,a.width,a.height);s.trigger("invalidate")}},b));m.accuracy=b.accuracy;m.drawAccuracyIndicator=false;return m},AnnotationsOverlay:function(b){function a(t){var p=
b.map?b.map.getTileLayer():null,f=t.length;if(p)for(f=f;f--;)t[f].calcXY(p);t.sort(function(o,s){var q=s.xy.y-o.xy.y;if(q===0)q=s.xy.x-o.xy.x;return q})}b=T5.ex({pois:null,map:null,createAnnotationForPOI:null,zindex:100},b);var e=[],g=false,m=[],l=T5.ex(new T5.ViewLayer(b),{cycle:function(){return g?1:0},draw:function(t,p,f,o,s){g=false;t.fillStyle="rgba(255, 0, 0, 0.75)";t.globalCompositeOperation="source-over";for(f=e.length;f--;){e[f].draw(t,p,o,l,s);g=g||e[f].isAnimating()}for(f=m.length;f--;){m[f].draw(t,
p,o,l,s);g=g||m[f].isAnimating()}return g?1:0},add:function(t){m.push(t);a(m);l.wakeParent()},clear:function(t){m=[];a(m);if(t){e=[];a(e)}l.wakeParent()}});GRUNT.WaterCooler.listen("geo.pois-updated",function(t){if(b.pois&&b.pois.id==t.srcID){t=t.pois;try{e=[];for(var p=0;p<t.length;p++)if(t[p].pos){var f;var o=t[p];if(o&&o.pos){var s=null;if(s=b.createAnnotationForPOI?b.createAnnotationForPOI(o):new d.Annotation({pos:o.pos})){s.isNew=o.isNew;o.isNew=false}f=s}else f=void 0;f&&e.push(f)}a(e)}catch(q){GRUNT.Log.exception(q)}l.wakeParent()}});
GRUNT.WaterCooler.listen("grid.updated",function(){a(e);a(m);l.wakeParent()});return l}};return d}();
T5.Map=function(h){function d(r){try{var v=new T5.Geo.Position(r.coords.latitude,r.coords.longitude),w=r.coords.accuracy/1E3;k.trigger("locationUpdate",r,w);if(n){if(!o){o=new T5.Geo.UI.LocationAnnotation({pos:v,accuracy:w});k.bind("tileDrawComplete",function(){o.drawAccuracyIndicator=true})}h.displayLocationAnnotation&&t.add(o);var z=T5.Geo.B.createBoundsFromCenter(v,Math.max(w,1));k.gotoBounds(z)}else{o.pos=v;o.accuracy=w;o.calcXY(k.getTileLayer());k.panToPosition(v,null,T5.Easing.Sine.Out)}n=false}catch(A){GRUNT.Log.exception(A)}}
function b(r){GRUNT.Log.info("caught location tracking error:",r)}h=T5.ex({tapExtent:10,provider:null,crosshair:false,zoomLevel:0,boundsChange:null,tapPOI:null,boundsChangeThreshold:30,pois:new T5.Geo.POIStorage,createAnnotationForPOI:null,displayLocationAnnotation:true,zoomAnimation:T5.Easing.Quad.Out},h);var a={NONE:0,SINGLE:1,WATCH:2},e=new T5.Vector,g=a.NONE,m=false,l=[],t=null,p=null,f=null,o=null,s=0,q=false,n=true,u=h.zoomLevel;if(!h.provider)h.provider=new T5.Geo.MapProvider;h.adjustScaleFactor=
function(r){return Math.pow(2,(r<1?Math.floor:Math.ceil)(Math.log(r)))};var k=T5.ex({},new T5.Tiler(h),{pois:h.pois,annotations:null,getBoundingBox:function(){var r=k.getTileLayer(),v=k.getOffset(),w=k.getDimensions();if(r)return r.getBoundingBox(v.x,v.y,w.width,w.height);return null},getCenterPosition:function(){return k.getXYPosition(T5.D.getCenter(k.getDimensions()))},getXYPosition:function(r){return k.getTileLayer().pixelsToPos(k.viewPixToGridPix(r))},gotoBounds:function(r,v){var w=T5.Geo.B.getZoomLevel(r,
k.getDimensions());k.gotoPosition(T5.Geo.B.getCenter(r),w,v)},gotoPosition:function(r,v,w){function z(M){k.setTileLayer(M);f=M.getId();k.panToPosition(r,function(){k.unfreeze();k.trigger("zoomLevelChange",u);w&&w()});m=true;q=false}var A=u,G=!m,F=k.getBoundingBox();if(F)G=G||!T5.Geo.P.inBounds(r,F);u=v?v:u;if(!u)throw Error("Zoom level required to goto a position.");if(h.provider)u=h.provider.checkZoomLevel(u);if(G||u!==A)if(q)GRUNT.Log.warn("Tile request in progress, aborting");else{T5.Images.cancelLoad();
if(o)o.drawAccuracyIndicator=false;(v=k.getTileLayer())&&v.deactivate();T5.Animation.cancel();m&&k.freeze();q=true;h.provider.zoomLevel=u;h.provider.getMapTiles(k,r,z)}else k.panToPosition(r,w)},panToPosition:function(r,v,w){var z=k.getTileLayer();if(z){r=z.getGridXYForPosition(r);z=k.getDimensions();r.x-=z.width/2;r.y-=z.height/2;if(p)p=null;k.updateOffset(r.x,r.y,w);k.trigger("wake");h.boundsChange&&h.boundsChange(k.getBoundingBox());v&&v(k)}},locate:function(){k.trackStart(a.SINGLE);setTimeout(k.trackCancel,
1E4)},trackStart:function(r){if(navigator.geolocation&&!s){g=r?r:a.WATCH;n=true;s=navigator.geolocation.watchPosition(d,b,{enableHighAccuracy:true,timeout:1E4,maximumAge:5E3})}},trackCancel:function(){s&&navigator.geolocation&&navigator.geolocation.clearWatch(s);g===a.WATCH&&t.clear();g=a.NONE;s=0},getZoomLevel:function(){return u},setZoomLevel:function(r){try{k.gotoPosition(k.getCenterPosition(),r)}catch(v){GRUNT.Log.exception(v)}},zoomIn:function(){k.scale(2,T5.Easing.Sine.Out)||k.setZoomLevel(u+
1)},zoomOut:function(){k.scale(0.5,T5.Easing.Sine.Out)||k.setZoomLevel(u-1)},animateRoute:function(r,v,w,z){var A=k.getLayer("route");if(A)(r=A.getAnimation(r,v,w,z))&&r.addToView(k)}});k.bind("pan",function(){g===a.SINGLE&&k.trackCancel()});k.bind("tap",function(r,v){var w=k.getTileLayer(),z=null;if(w){var A=k.viewPixToGridPix(new T5.Vector(v.x,v.y)),G=w.pixelsToPos(A);z=w.pixelsToPos(T5.V.offset(A,-h.tapExtent,h.tapExtent));w=w.pixelsToPos(T5.V.offset(A,h.tapExtent,-h.tapExtent));z=new T5.Geo.BoundingBox(z,
w);l=k.pois.findByBounds(z);k.trigger("geotap",r,v,G,z);h.tapPOI&&h.tapPOI(l)}});k.bind("doubleTap",function(r,v){k.animate(2,T5.D.getCenter(k.getDimensions()),new T5.Vector(v.x,v.y),h.zoomAnimation)});k.bind("scale",function(r,v){var w=0;r=Math.sqrt(r);if(r<1)w=-(0.5/r);else if(r>1)w=r;k.gotoPosition(k.getXYPosition(v),u+Math.floor(w))});t=new T5.Geo.UI.AnnotationsOverlay({pois:k.pois,map:k,createAnnotationForPOI:h.createAnnotationForPOI});k.annotations=t;k.setLayer("annotations",t);h.crosshair&&
k.setLayer("crosshair",new CrosshairOverlay);k.bind("idle",function(){if(T5.V.absSize(T5.V.diff(e,k.getOffset()))>h.boundsChangeThreshold&&h.boundsChange){e=k.getOffset();h.boundsChange(k.getBoundingBox())}});GRUNT.configurable(k,["provider"],GRUNT.paramTweaker(h,null,{provider:function(){k.cleanup();m=false}}),true);return k};
