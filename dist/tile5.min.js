(function(gb){function I(){var a=arguments[0]||{},b=Array.prototype.slice.call(arguments,1),c,e;for(e=b.length;e--;)if((c=b[e])!==null)for(var k in c){var i=c[k];if(a!==i)if(i!==undefined)a[k]=i}return a}function ga(a,b){if(typeof console!=="undefined")console[b||"debug"](a)}function Sa(a){var b=a.match(Eb),c=[],e=0,k;for(k=b?b.length:0;k--;){var i=b[k].slice(1);c[i]||(c[i]=RegExp("\\{"+i+"\\}","g"))}e=c.length;return function(){var h=a;for(k=0;k<e;k++)h=h.replace(c[k],arguments[k]||"");return h}}
function Ta(a){a=a.replace(/[\-\_\s\.]/g,"").toLowerCase();return xa[a]||xa.linear}function hb(a,b,c,e,k){function i(g){g=g?g:(new Date).getTime();if(d+ib<g){var f=g-h,q=c(f,a,j,e),l=h+e<=g;g=!l;if(k){f=k(q,l,f);g=typeof f!="undefined"?f&&g:g}g&&animFrame(i)}}var h=(new Date).getTime(),d=0,j=b-a;animFrame(i);return{}}function jb(a){a=parseFloat(a)*ha;a=qa(a);var b=Ha*a;return ka((1+a)/(1-a)*la((1-b)/(1+b),Ha))/2}function kb(a){return ea/(256<<a)}function lb(a,b){var c=Ha*qa(a);return ya-2*mb(b*la((1-
c)/(1+c),Ha/2))}function S(a,b){this.mercY=this.mercX=null;if(V(a,za))nb.parseXY(a,this);else if(a&&a.toPixels){var c=a.toPixels();this.mercX=c.x;this.mercY=c.y}else{this.x=a||0;this.y=b||0}}function ma(a,b,c,e){this.x=a||0;this.y=b||0;this.w=c||0;this.h=e||0;this.x2=this.x+this.w;this.y2=this.y+this.h}function ob(a,b){var c=new pb(Math.sqrt(256<<a)|0);b&&b.zoomLevel===a&&b.copyInto(c);c.zoomLevel=a;return c}function qb(a){a=a||(new Date).getTime();for(var b=0;b<ta.length;){var c=ta[b],e=ra[c],k=
ra[c].image&&ra[c].image.complete&&ra[c].image.width>0,i=a-e.start;i=k||i>=Fb;if(k){k=e.callbacks;rb[c]=e.image;for(var h=0;h<k.length;h++)k[h](e.image,true)}if(i){ta.splice(b,1);delete ra[c]}else b++}ta.length>0&&animFrame(qb)}function Ia(a,b){var c=a&&b?rb[a]:null;if(c&&c&&c.complete&&c.width>0)b(c);else{if(c=ra[a])c.callbacks.push(b);else{c=new Image;c.id="_ldimg"+ ++Gb;ra[a]={start:(new Date).getTime(),image:c,callbacks:[b]};c.src=a;ta[ta.length]=a}animFrame(qb)}}function Ua(a,b,c,e,k,i){this.x=
a;this.y=b;this.w=e||256;this.h=e||256;this.x2=this.x+this.w;this.y2=this.y+this.h;this.url=c;this.id=i||a+"_"+b;this.loaded=false;this.image=null}function sb(a){a=a?a:(new Date).getTime();if(a-tb>ib){for(var b=Aa.splice(0),c=b.length;c--;)b[c](a);tb=a}Aa.length&&animFrame(sb)}function ub(a){var b=Aa.length==0;Aa[Aa.length]=a;b&&animFrame(sb)}function Hb(a,b,c,e,k){k=I({easing:"sine.out",duration:1E3,progress:null,complete:null,autoInvalidate:true},k);var i=(new Date).getTime(),h=a[b],d=b=="translate",
j=k.autoInvalidate,g=c.length&&e.length&&c.length==e.length?c.length:0,f=Array(g),q=Array(g),l=Ta(k.easing),n=k.duration,o=k.progress,w=function(y){var D=y-i;y=i+n<=y;for(var M=a.layer?a.layer.view:null,H,F=g;F--;){H=l(D,c[F],f[F],n);q[F]=d?H|0:H}h.apply(a,q);j&&M&&M.invalidate();if(o){D=[].concat(y?e:q);D.unshift(y);o.apply(a,D)}if(y){a.animations--;h.apply(a,e);k.complete&&k.complete.apply(a,e)}else ub(w)};if(h&&h.apply&&g>0){n=n?n:DEFAULT_DURATION;for(b=g;b--;)f[b]=e[b]-c[b];a.animations++;ub(w)}}
function Ja(a,b){b=I({id:"layer_"+Ib++,zindex:0,animated:false,style:null,minXY:null,maxXY:null},b);this.visible=true;ia(I(this,b))}function Ka(){ia(this)}function ja(a,b){if(a&&a.split){var c=a.split(vb);if(c.length>1){a=c[0];b=c[1]}}else if(a&&a.lat){b=a.lon;a=a.lat}this.lat=parseFloat(a||0);this.lon=parseFloat(b||0)}function Ba(a,b){if(V(a,Jb)){for(var c=b,e=this.min=new ja(wb,xb),k=this.max=new ja(Kb,Lb),i=a.length;i--;){var h=a[i];if(h.lat<e.lat)e.lat=h.lat;if(h.lat>k.lat)k.lat=h.lat;if(h.lon<
e.lon)e.lon=h.lon;if(h.lon>k.lon)k.lon=h.lon}if(V(c,na)){c=calcSize(bounds.min,bounds.max);c=Va(c.x,c.y)*0.3}this.expand(c)}else{this.min=a;this.max=b}}var Wa={};(function(a){var b=[],c=0,e=false,k=a.register=function(i,h){b.push({section:i,run:h})};a.init=function(i){function h(){if(c<b.length){var j=b[c++];d[j.section]||(d[j.section]={});j.run(d[j.section],h)}else{for(j in d)a[j]=d[j];e=true;i&&i(a)}}var d={};if(e&&i)i(a);else{c=0;h()}};k("canvas",function(i,h){function d(){var q,l=j.getContext("2d");
l.save();try{l.translate(50,50);l.beginPath();l.rect(0,0,20,20);q=l.isPointInPath(10,10)}finally{l.restore()}return q}var j=document.createElement("canvas"),g=typeof FlashCanvas!="undefined",f=typeof G_vmlCanvasManager!="undefnined";j.width=200;j.height=200;i.pipTransformed=g||f?false:d();h()})})(Wa);window.animFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){setTimeout(function(){a((new Date).getTime())},
1E3/60)}}();var Eb=/\{(\d+)(?=\})/g,xa=function(){var a=1.70158,b=Math.PI/2,c=Math.abs,e=Math.pow,k=Math.sin,i=Math.asin,h=Math.cos;return{linear:function(d,j,g,f){return g*d/f+j},backin:function(d,j,g,f){return g*(d/=f)*d*((a+1)*d-a)+j},backout:function(d,j,g,f){return g*((d=d/f-1)*d*((a+1)*d+a)+1)+j},backinout:function(d,j,g,f){return(d/=f/2)<1?g/2*d*d*(((a*=1.525)+1)*d-a)+j:g/2*((d-=2)*d*(((a*=1.525)+1)*d+a)+2)+j},bouncein:function(d,j,g,f){return g-xa.bounceout(f-d,0,g,f)+j},bounceout:function(d,
j,g,f){return(d/=f)<1/2.75?g*7.5625*d*d+j:d<2/2.75?g*(7.5625*(d-=1.5/2.75)*d+0.75)+j:d<2.5/2.75?g*(7.5625*(d-=2.25/2.75)*d+0.9375)+j:g*(7.5625*(d-=2.625/2.75)*d+0.984375)+j},bounceinout:function(d,j,g,f){return d<f/2?xa.bouncein(d*2,0,g,f)/2+j:xa.bounceout(d*2-f,0,g,f)/2+g/2+j},cubicin:function(d,j,g,f){return g*(d/=f)*d*d+j},cubicout:function(d,j,g,f){return g*((d=d/f-1)*d*d+1)+j},cubicinout:function(d,j,g,f){if((d/=f/2)<1)return g/2*d*d*d+j;return g/2*((d-=2)*d*d+2)+j},elasticin:function(d,j,g,
f,q,l){if(d==0)return j;if((d/=f)==1)return j+g;l||(l=f*0.3);if(!q||q<c(g)){q=g;g=l/4}else g=l/ea*i(g/q);return-(q*e(2,10*(d-=1))*k((d*f-g)*ea/l))+j},elasticout:function(d,j,g,f,q,l){var n;if(d==0)return j;if((d/=f)==1)return j+g;l||(l=f*0.3);if(!q||q<c(g)){q=g;n=l/4}else n=l/ea*i(g/q);return q*e(2,-10*d)*k((d*f-n)*ea/l)+g+j},elasticinout:function(d,j,g,f,q,l){var n;if(d==0)return j;if((d/=f/2)==2)return j+g;l||(l=f*0.3*1.5);if(!q||q<c(g)){q=g;n=l/4}else n=l/ea*i(g/q);if(d<1)return-0.5*q*e(2,10*(d-=
1))*k((d*f-n)*ea/l)+j;return q*e(2,-10*(d-=1))*k((d*f-n)*ea/l)*0.5+g+j},quadin:function(d,j,g,f){return g*(d/=f)*d+j},quadout:function(d,j,g,f){return-g*(d/=f)*(d-2)+j},quadinout:function(d,j,g,f){if((d/=f/2)<1)return g/2*d*d+j;return-g/2*(--d*(d-2)-1)+j},sinein:function(d,j,g,f){return-g*h(d/f*b)+g+j},sineout:function(d,j,g,f){return g*k(d/f*b)+j},sineinout:function(d,j,g,f){return-g/2*(h(Math.PI*d/f)-1)+j}}}();if(typeof animFrame==="undefined")throw Error("animFrame COG required for tweening support");
var ia=function(){function a(c,e){var k=c.hasOwnProperty("obsHandlers")?c.obsHandlers:null;k[e]||(k[e]=[]);return k[e]}var b=0;return function(c){if(!c)return null;if(!(c.hasOwnProperty("obsHandlers")?c.obsHandlers:null))c.obsHandlers={};if(!c.hasOwnProperty("bind")){c.bind=function(e,k){var i="callback"+b++;a(c,e).unshift({fn:k,id:i});return i};c.triggerCustom=function(e,k){var i=a(c,e),h={cancel:false,name:e,source:this},d;for(d in k)h[d]=k[d];if(!i)return null;d=Array.prototype.slice.call(arguments,
2);c.eventInterceptor&&c.eventInterceptor(e,h,d);d.unshift(h);for(var j=i.length;j--&&!h.cancel;)i[j].fn.apply(this,d);return h};c.trigger=function(e){var k=Array.prototype.slice.call(arguments,1);k.splice(0,0,e,null);return c.triggerCustom.apply(this,k)};c.unbind=function(e,k){if(typeof e==="undefined")c.obsHandlers={};else for(var i=a(c,e),h=0;i&&h<i.length;h++)if(i[h].id===k){i.splice(h,1);break}return c}}return c}}(),Mb=function(){function a(b,c,e,k){if(typeof b[k]=="undefined")b[k]=function(i){if(typeof i!=
"undefined"){c[k]=i;e[k]&&e[k](i);return b}else return c[k]}}return function(b,c,e){for(var k in c)a(b,c,e,k)}}(),yb=Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1},V=function(){return function(a,b){b=Nb.call(b);if(b=="finite")return!Ob[Pb](+a);return b=="null"&&a===null||b==typeof a||b=="object"&&a===Object(a)||b=="array"&&Array.isArray&&Array.isArray(a)||Qb.call(a).slice(8,-1).toLowerCase()==b}}();(function(){function a(k){var i=document.createElement("script"),
h=false;i.src=k;i.async=true;i.onload=i.onreadystatechange=function(){if(!h&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){h=true;i.onload=i.onreadystatechange=null;i&&i.parentNode&&i.parentNode.removeChild(i)}};c||(c=document.getElementsByTagName("head")[0]);c.appendChild(i)}var b=0,c,e=this;return function(k,i,h){k+=k.indexOf("?")>=0?"&":"?";var d="json"+ ++b;e[d]=function(j){i(j);e[d]=null;try{delete e[d]}catch(g){}};a(k+(h?h:"callback")+"="+d);return d}})();INTERACT=
function(){function a(l){return function(n,o){l.addEventListener(n,o,false)}}function b(l){return function(n,o){l.removeEventListener(n,o,false)}}function c(l){return function(n,o){l.attachEvent("on"+n,o)}}function e(l,n){return{x:l?l:0,y:n?n:0,count:1}}function k(l,n){f.push(I({handler:null,checks:{},type:l},n))}function i(l){var n=0,o=0;if(l.offsetParent){do{n+=l.offsetLeft;o+=l.offsetTop;l=l.offsetParent}while(l)}return{left:n,top:o}}function h(l,n){return{source:l,target:n.target?n.target:n.srcElement}}
function d(l,n){for(var o=l.target?l.target:l.srcElement;o&&o!==n;)o=o.parentNode;return o&&o===n}function j(l,n){return{x:l.x-(n?n.left:0),y:l.y-(n?n.top:0)}}function g(l,n){if(l.preventDefault){l.preventDefault();l.stopPropagation()}else if(typeof l.cancelBubble!="undefined")l.cancelBubble=true;n&&l.stopImmediatePropagation&&l.stopImmediatePropagation()}var f=[],q=function(l,n,o){o=I({binder:null,unbinder:null,observable:null},o);for(var w=o.observable,y=[],D,M,H={bind:function(){return w.bind.apply(null,
arguments)},unbind:function(){w.unbind();for(F=0;F<y.length;F++)y[F].unbind();return H}},F=0;F<n.length;F++)y.push(n[F](l,w,o));w.bind("pointerDown",function(){M=D=0});w.bind("pointerMove",function(p,C,v,s){D+=s.x||0;M+=s.y||0});w.bind("pointerUp",function(p,C,v){Math.abs(D)>20||Math.abs(M)>20||w.triggerCustom("tap",p,C,v)});return H};k("pointer",{handler:function(l,n,o){function w(t){if(t.pageX&&t.pageY)return e(t.pageX,t.pageY);else{var G=document.documentElement,Q=document.body;return e(t.clientX+
(G&&G.scrollLeft||Q&&Q.scrollLeft||0)-(G&&G.clientLeft||Q&&Q.clientLeft||0),t.clientY+(G&&G.scrollTop||Q&&Q.scrollTop||0)-(G&&G.clientTop||Q&&Q.clientTop||0))}}function y(t){if(d(t,l))if(s=F(t)){var G=w(t);l.style.cursor="move";g(t,true);L=G.x;J=G.y;B=e(L,J);n.triggerCustom("pointerDown",h("mouse",t),B,j(B,i(l)))}}function D(t){var G=w(t);A=G.x;E=G.y;if(d(t,l))p(t,s?"pointerMove":"pointerHover")}function M(t){if(s&&F(t)){s=false;if(d(t,l)){l.style.cursor="default";p(t,"pointerUp")}}}function H(t){if(d(t,
l)){var G;t=t||window.event;if(t.detail)G=t.axis===2?-t.detail*C:0;else{G=t.wheelDeltaY?t.wheelDeltaY:t.wheelDelta;if(window.opera)G=-G}if(G!==0){var Q=e(A,E);n.triggerCustom("zoom",h("mouse",t),Q,j(Q,i(l)),G/v,"wheel");g(t);t.returnValue=false}}}function F(t){t=t||window.event;return(t.which||t.button)==1}function p(t,G,Q,Z,W){Q=typeof Q!="undefined"?Q:A;Z=typeof Z!="undefined"?Z:E;var x=Q-L,N=Z-J,z=e(Q,Z);n.triggerCustom(G,h("mouse",t),z,j(z,i(l)),e(x,N));if(typeof W=="undefined"||W){L=Q;J=Z}}o=
I({},o);var C=120,v=C*8,s=false,B,A,E,L,J;o.binder("mousedown",y);o.binder("mousemove",D);o.binder("mouseup",M);o.binder("dblclick",function(t){ga("captured double click");if(d(t,l)){var G=w(t);n.triggerCustom("doubleTap",h("mouse",t),G,j(G,i(l)))}});o.binder("mousewheel",H);o.binder("DOMMouseScroll",H);return{unbind:function(){o.unbinder("mousedown",y);o.unbinder("mousemove",D);o.unbinder("mouseup",M);o.unbinder("mousewheel",H);o.unbinder("DOMMouseScroll",H)}}},checks:{touch:false}});k("pointer",
{handler:function(l,n,o){function w(x){if(x.count<2)return 0;var N=x.x-x.next.x;x=x.y-x.next.y;return~~Math.sqrt(N*N+x*x)}function y(x,N,z){N=N?N:0;z=z?z:0;for(var R={x:x.x-N,y:x.y-z,id:x.id,count:x.count},Y=R;x.next;){x=x.next;Y=Y.next={x:x.x-N,y:x.y-z,id:x.id}}return R}function D(x,N){var z=x[N?N:"touches"],R,Y;if(z.length===0)return null;Y=R={x:z[0].pageX,y:z[0].pageY,id:z[0].identifier,count:z.length};for(var $=1,Ca=z.length;$<Ca;$++)Y=Y.next={x:z[$].pageX,y:z[$].pageY,id:z[$].identifier};return R}
function M(x){if(d(x,l)){E=i(l);var N=D(x,"changedTouches"),z=y(N,E.left,E.top);if(!J){L=s;n.triggerCustom("pointerDown",h("touch",x),N,z)}Z&&n.triggerCustom("pointerDownMulti",h("touch",x),N,z);J=D(x);if(J.count>1)G=w(J);W=1;Q=y(J)}}function H(x){if(d(x,l)){g(x);t=D(x);if(L==s)L=Math.abs(J.x-t.x)>C||Math.abs(J.y-t.y)>C?v:s;if(L!=s){L=t.count>1?A:B;if(L==A)if(J.count===1){J=y(t);G=w(J)}else{var N=w(t);if(Math.abs(G-N)<p)L=B;else{var z;z=t.x;var R=t.next.x,Y=t.y,$=t.next.y;z={x:(z<R?z:R)+(Math.abs(z-
R)>>1),y:(Y<$?Y:$)+(Math.abs(Y-$)>>1)};N=N/G;R=N-W;n.triggerCustom("zoom",h("touch",x),z,j(z,E),R,"pinch");W=N}}L==B&&n.triggerCustom("pointerMove",h("touch",x),t,y(t,E.left,E.top),e(t.x-Q.x,t.y-Q.y));Z&&n.triggerCustom("pointerMoveMulti",h("touch",x),t,y(t,E.left,E.top))}Q=y(t)}}function F(x){if(d(x,l)){var N=D(x,"changedTouches"),z=y(N,E.left,E.top);t=D(x);if(!t){n.triggerCustom("pointerUp",h("touch",x),N,z);J=null}Z&&n.triggerCustom("pointerUpMulti",h("touch",x),N,z)}}o=I({detailed:false,inertia:false},
o);var p=20,C=7,v=0,s=1,B=2,A=3,E,L,J,t,G,Q,Z=o.detailed,W=1;o.binder("touchstart",M);o.binder("touchmove",H);o.binder("touchend",F);ga("initialized touch handler");return{unbind:function(){o.unbinder("touchstart",M);o.unbinder("touchmove",H);o.unbinder("touchend",F)}}},checks:{touch:true}});return{register:k,watch:function(l,n,o){n=I({bindTarget:null,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},n);capabilities=I({touch:"ontouchstart"in window},o);if(!n.observable){ga("creating observable");
n.observable=ia({});globalOpts=n}n.binder=(n.isIE?c:a)(n.bindTarget||document);n.unbinder=(n.isIE?c:b)(n.bindTarget||document);o=n.types;for(var w=capabilities,y=[],D=f.length;D--;){var M=f[D],H=!o||o.indexOf(M.type)>=0,F=true,p;for(p in M.checks){var C=M.checks[p];ga("checking "+p+" capability. require: "+C+", capability = "+w[p]);F=F&&C===w[p]}if(H&&F)y[y.length]=M.handler}return new q(l,y,n)}}}();var Xa=function(){var a={};return{create:function(b,c){if(a[b][c])return a[b][c].apply(null,Array.prototype.slice.call(arguments,
2))},register:function(b,c,e){a[b]||(a[b]={});a[b][c]&&ga(Rb(b,c),"warn");a[b][c]=e}}}(),Rb=Sa("Registration of {0}: {1} will override existing definition"),Ya=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],ea=Math.PI*2,ya=Math.PI/2,ha=Math.PI/180,La=180/Math.PI,wb=ya,Kb=-wb,xb=ea,Lb=-xb,Ha=0.08181919084262157,oa=Math.abs,zb=Math.ceil,ua=Math.round,Ma=Math.min,Va=Math.max,la=Math.pow,Ab=Math.sqrt,ka=Math.log,qa=Math.sin,Sb=Math.asin,Za=Math.cos,mb=Math.atan,
Tb=Math.atan2,Pb="hasOwnProperty",Ob={NaN:1,Infinity:1,"-Infinity":1},Nb=String.prototype.toLowerCase,Qb=Object.prototype.toString,na="undefined",za="string",$a="number",Jb="array",aa=Xa.register,pa=Xa.create,Ub=0,Ib=0,vb=/[\,\s]+/,Vb=function(){function a(k){e++;k=k||(new Date).getTime();for(var i=c.length;i--;){var h=c[i];e%h.every===0&&h.cb(k)}animFrame(a)}var b=1E3/60,c=[],e=0;animFrame(a);return{attach:function(k,i){c[c.length]={cb:k,every:i?ua(i/b):1}},detact:function(){}}}(),nb=function(){var a=
/^xy\((.*)\).*$/i;return{parseXY:function(b,c){c=c||new S;if(!a.test(b)){var e=b.split(vb);c.mercX=parseFloat(e[1])*ha;c.mercY=jb(e[0])}return c}}}(),X=function(){var a={"-webkit-user-select":"none",position:"absolute"},b;b=function(c){for(var e=0;e<c.length;e++){var k=c[e];if(typeof document.body.style[k]!="undefined")return k}}(["-webkit-transform","MozTransform"]);return{supportTransforms:b,create:function(c,e,k){c=document.createElement(c);var i=[];k=k||{};c.className=e||"";for(var h in k)i[i.length]=
h+": "+k[h];c.style.cssText=i.join(";");return c},move:function(c,e,k,i){if(b)c.style[b]="translate("+e+"px, "+k+"px) translateZ(0) "+(i||[]).join(" ");else{c.style.left=e+"px";c.style.top=k+"px"}},styles:function(c){return I({},a,c)}}}();S.prototype={constructor:S,add:function(){for(var a=this.x,b=this.y,c=arguments.length;c--;){a+=arguments[c].x;b+=arguments[c].y}return new S(a,b)},equals:function(a){return this.x===a.x&&this.y===a.y},offset:function(a,b){return new S(this.x+a,this.y+b)},sync:function(a,
b){if(b){this.mercX=this.x*a-Math.PI;this.mercY=Math.PI-this.y*a}else if(this.mercX||this.mercY){this.x=ua((this.mercX+Math.PI)/a);this.y=ua((Math.PI-this.mercY)/a)}return this},pos:function(){for(var a=la(Math.E,-this.mercY),b=ya-2*mb(a),c=lb(b,a),e=0;e<12&&oa(b-c)>1.0E-7;){b=c;c=lb(b,a);e++}return new ja(c*La,this.mercX%360*La)},toString:function(){return this.x+", "+this.y}};ma.prototype={constructor:ma,buffer:function(a,b){return new ma(this.x-a,this.y-(b||a),this.w+a*2,this.h+(b||a)*2)},center:function(){return new S(this.x+
(this.w>>1),this.y+(this.h>>1))}};Hits=function(){return{diffHits:function(a,b){var c=[],e={},k;for(k=b.length;k--;)e[b[k].target.id]=true;for(k=a.length;k--;)e[a[k].target.id]||(c[c.length]=a[k]);return c},init:function(a,b,c,e){return{type:a,x:e.x|0,y:e.y|0,elements:[],absXY:b,relXY:c}},initHit:function(a,b,c){return{type:a,target:b,drag:c}},triggerEvent:function(a,b,c,e){b.triggerCustom(a.type+(c?c:"Hit"),{hitType:a.type},e?e:a.elements,a.absXY,a.relXY,new S(a.x,a.y))}}}();var pb=function(a){function b(i,
h){var d=c[i],j;d||(d=c[i]=[]);(j=d[h])||(j=d[h]=[]);return j}a=a||128;var c=[],e={},k=0;return{copyInto:function(i){for(var h in e){var d=e[h];i.insert(d.bounds||d,d,h)}},insert:function(i,h,d){var j=i.x/a|0,g=i.y/a|0,f=(i.x+i.w)/a|0;i=(i.y+i.h)/a|0;d=d||h.id||"obj_"+k++;e[d]=h;for(h=j;h<=f;h++)for(j=g;j<=i;j++)b(h,j).push(d)},remove:function(i,h,d){d=d||h.id;if(e[d]){var j=i.x/a|0;h=i.y/a|0;var g=(i.x+i.w)/a|0;i=(i.y+i.h)/a|0;delete e[d];for(j=j;j<=g;j++)for(var f=h;f<=i;f++){var q=b(j,f),l=yb.call(q,
d);l>=0&&q.splice(l,1)}}},search:function(i){var h=i.y/a|0,d=(i.x+i.w)/a|0,j=(i.y+i.h)/a|0,g=[],f=[];for(i=i.x/a|0;i<=d;i++)for(var q=h;q<=j;q++)g=g.concat(b(i,q));g.sort();for(h=g.length;h--;){d=g[h];if(j=e[d])f[f.length]=j;for(;h>0&&g[h-1]==d;)h--}return f}}},Fb=3E4,rb={},Gb=0;(new Date).getTime();var ra={},ta=[];Ua.prototype={constructor:Ua,load:function(a){var b=this;Ia(this.url,function(c){b.loaded=true;b.image=c;a&&a()})}};var Wb=function(){return ia({fastpan:true,applyStyle:function(){},applyTransform:function(a,
b,c){return{restore:null,x:b,y:c}},checkSize:function(){},getDimensions:function(){return{width:0,height:0}},getViewport:function(){},hitTest:function(){return false},prepare:function(){},projectXY:null,reset:function(){}})};aa("renderer","canvas",function(a,b,c,e,k){function i(p,C,v){var s,B;n[C]=function(A){for(s=H.length;s--;)if(B=v[H[s]])A[F[s]]=B}}function h(p,C,v){var s=false;if(C)s=f.isPointInPath(w?C.x-q:C.relXY.x,w?C.y-l:C.relXY.y);return{draw:v||M,viewport:p,hit:s,vpX:q,vpY:l,context:f}}
e=I({},e);var d,j,g,f,q=0,l=0,n={},o=null,w=Wa.canvas.pipTransformed,y={},D=function(){},M=function(){this.fill&&f.fill();this.stroke&&f.stroke()},H=["fill","stroke","lineWidth","opacity"],F=["fillStyle","strokeStyle","lineWidth","globalAlpha"];if(b){d=b.offsetWidth;j=b.offsetHeight;g=X.create("canvas",null,{position:"absolute","z-index":1});g.width=d;g.height=j;a.attachFrame(g,true);f=null}c=I(k,{applyStyle:function(p){var C=n[p],v=f&&f.canvas?f.canvas.id:"default",s;y[v]||(y[v]=[]);s=y[v].pop()||
"basic";if(C){y[v].push(p);C(f);return s}},applyTransform:function(p){if(p.translateX!==0||p.translateY!==0||p.scaling!==1||p.rotation!==0){f.save();o={undo:function(){f.restore();o=null},x:p.xy.x,y:p.xy.y};f.translate(p.xy.x-q+p.translateX,p.xy.y-l+p.translateY);p.rotation!==0&&f.rotate(p.rotation);p.scaling!==1&&f.scale(p.scaling,p.scaling)}return o},drawTiles:function(p,C,v){for(var s,B=q-256,A=l-256,E=p.x2,L=p.y2,J=C.length;J--;){p=C[J];if(s=p.x>=B&&p.x<=E&&p.y>=A&&p.y<=L)if(!p.loaded&&v)p.load(a.invalidate);
else p.image&&f.drawImage(p.image,p.x-q,p.y-l)}},prepare:function(p,C){var v,s=false,B=C.scaled||C;if(f)f.restore();else f=g.getContext("2d");for(v=p.length;v--;)s=s||p[v].clip;q=B.x;l=B.y;if(f){s||f.clearRect(0,0,d,j);f.save()}f.globalCompositeOperation="source-over";return f},prepArc:function(p,C,v){f.beginPath();f.arc(p.xy.x-(o?o.x:q),p.xy.y-(o?o.y:l),p.size>>1,p.startAngle,p.endAngle,false);return h(C,v)},prepImage:function(p,C,v,s){var B=(s.x||p.xy.x)-(o?o.x:q),A=(s.y||p.xy.y)-(o?o.y:l),E=s.image||
p.image;if(E){f.beginPath();f.rect(B,A,s.width||E.width,s.height||E.height);return h(C,v,function(){f.drawImage(E,B,A,s.width||E.width,s.height||E.height)})}},prepMarker:function(p,C,v){var s=p.xy.x-(o?o.x:q),B=p.xy.y-(o?o.y:l),A=p.size,E=undefined;f.beginPath();switch(p.markerStyle.toLowerCase()){case "image":E=D;f.rect(s-(A>>1),B-(A>>1),A,A);if(p.reset&&p.image){p.image=null;p.reset=false}p.image?f.drawImage(p.image,s-(A>>1),B-(A>>1),A,A):Ia(p.imageUrl,function(L){p.image=L;f.drawImage(p.image,
s-(A>>1),B-(A>>1),A,A)});break;default:f.moveTo(s,B);f.lineTo(s-(A>>1),B-A);f.lineTo(s+(A>>1),B-A);f.lineTo(s,B)}return h(C,v,E)},prepPoly:function(p,C,v,s){var B=true;p=s.points||p.points;s=o?o.x:q;var A=o?o.y:l;f.beginPath();for(var E=p.length;E--;){var L=p[E].x-s,J=p[E].y-A;if(B){f.moveTo(L,J);B=false}else f.lineTo(L,J)}return h(C,v)},getContext:function(){return f}});(function(){for(var p in Da.styles)i(null,p,Da.styles[p]);Bb.bind("defined",i)})();c.bind("detach",function(){b.removeChild(g)});
return c});aa("renderer","dom",function(a,b,c,e,k){function i(f){var q=f.image=new Image;j[f.id]=f;q.src=f.url;q.onload=function(){if(g[f.id])d.appendChild(this);else f.image=null};q.style.cssText="-webkit-user-select: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute;";
return q}function h(f,q,l){var n=[],o;for(o in f){var w=f[o];if(l?w[l]:!q[o]){if(w.image&&w.image.parentNode){d.removeChild(w.image);w.image=null}n[n.length]=o}}for(q=n.length;q--;)delete f[n[q]]}var d=null,j={},g={};d=X.create("div","",X.styles({width:b.offsetWidth+"px",height:b.offsetHeight+"px"}));b.childNodes.length>0?b.insertBefore(d,b.childNodes[0]):b.appendChild(d);a.attachFrame(d);a=I(k,{drawTiles:function(f,q,l){for(var n,o=f.x,w=f.y,y=q.length;y--;){f=q[y];if(f.url){(n=f.image||(l?i(f):
null))&&X.move(n,f.x-o,f.y-w);g[f.id]=f}}}});a.bind("predraw",function(){h(j,g);g={}});a.bind("detach",function(){b.removeChild(d)});a.bind("reset",function(){for(h(j,g={});d.childNodes.length>0;)d.removeChild(d.childNodes[0])});return a});var Bb=function(){function a(e,k){if(V(e,za)){c.trigger("defined",e,b[e]=k);return e}else{var i=[],h;for(h in e)i[i.length]=a(h,e[h]);return i}}var b={},c=ia({get:function(e){return b[e]},define:a});a({basic:{fill:"#ffffff"},highlight:{fill:"#ff0000"},waypoints:{lineWidth:4,
stroke:"#003377",fill:"#ffffff"},waypointsHover:{lineWidth:4,stroke:"#ff0000",fill:"#ffffff"}});return c}();aa("view","simple",function(a){function b(m,r,u,K){F(Ma(Va(T+la(2,K)-1,0.5),2))}function c(m){var r=m|0;m=r+Math.round((m-r)*50)/50;if(m!==T){T=m;m=ka(T)/Math.LN2|0;if(m!==0){T=la(2,m);y(Ea+m,Xb,Yb)}ca++}}function e(m,r){var u=renderer&&renderer.projectXY?renderer.projectXY(m,r):null;if(!u){u=O.getViewport();var K=1/T;u=new S(u?u.x+m*K:m,u?u.y+r*K:r)}return u}function k(m,r,u){p("doubleTap",
r,u,e(u.x,u.y));a.scalable&&F(2,e(u.x,u.y),Zb,null,$b)}function i(m,r,u){J=null;Z=true;w("down",r,u)}function h(m,r,u){w("hover",r,u)}function d(m,r,u,K){n(r,u,false);if(!J){W=K.x;x=K.y}}function j(m,r,u){n(r,u,true);Z=false}function g(){clearTimeout(Cb);Cb=setTimeout(function(){renderer.checkSize()},250)}function f(m,r,u){w("tap",r,u);p("tap",r,u,e(u.x,u.y,true))}function q(m){var r=O,u=A,K=L,P=a;m=(m||a.renderer).split("/");for(var U=new Wb(r,u,K,P),fa=0;fa<m.length;fa++)U=pa("renderer",m[fa],r,
u,K,P,U);renderer=U;Q=renderer.fastpan;l()}function l(){da&&da.unbind();if(renderer){da=INTERACT.watch(renderer.interactTarget||L);if(a.scalable){da.bind("zoom",b);da.bind("doubleTap",k)}da.bind("pointerDown",i);da.bind("pointerMove",d);da.bind("pointerUp",j);a.captureHover&&da.bind("pointerHover",h);da.bind("tap",f)}}function n(m,r,u){if(J){m=e(r.x,r.y);J.drag.call(J.target,J,m.x,m.y,u)&&ca++;if(u)J=null}}function o(m){L=document.getElementById(m);L.appendChild(E=X.create("div","",X.styles({overflow:"hidden",
width:L.offsetWidth+"px",height:L.offsetHeight+"px"})));Na=E.offsetWidth+Fa*2;Oa=E.offsetHeight+Fa*2;ab=Na/2;bb=Oa/2;cb=L.offsetWidth/2;db=L.offsetHeight/2;E.appendChild(A=X.create("div","",X.styles({width:Na+"px",height:Oa+"px","z-index":2,margin:-Fa+"px 0 0 "+-Fa+"px"})));q()}function w(m,r,u){ba=Hits.init(m,r,u,e(u.x,u.y,true));for(m=B;m--;)G=G||(s[m].hitGuess?s[m].hitGuess(ba.x,ba.y,O):false);G&&ca++}function y(m,r,u){if(V(m,$a)){m=Va(a.minZoom,Ma(a.maxZoom,m|0));if(m!==Ea){var K=la(2,m-Ea),P=
ab/K|0,U=bb/K|0;Ea=m;C(((r||z+ab)-P)*K,((u||R+bb)-U)*K);eb=Ca=0;p("zoom",m);T=1;renderer.trigger("reset");H()}return O}else return Ea}function D(){var m=new ma(z,R,Na,Oa);m.scaleFactor=T;return m}function M(m,r,u){if(V(r,na))for(r=0;r<B;r++){if(s[r].id===m)return s[r]}else if(V(m,za)){r=pa("layer",r,O,u);r.added=(new Date).getTime();r.id=m;s[s.length]=r;s.sort(function(K,P){return P.zindex-K.zindex||P.added-K.added});B=s.length;r.trigger("resync");r.trigger("refresh",O,D());O.trigger("layerChange",
O,r);ca++;return r}else return[].concat(s)}function H(){var m=D();if(m){if(va||wa)if(m){var r=Pa?z+(m.w>>1):z,u=Qa?R+(m.h>>1):R,K=m.w,P=m.h;if(va&&va>K)if(r+K>va)z=Pa?z:va-K;else if(r<0)z=Pa?z:0;if(wa&&wa>P)if(u+P>wa)R=Qa?R:wa-P;else if(u<0)R=Qa?R:0}Ca=z;eb=R;p("refresh",O,m);ca++}}function F(m,r,u,K,P){var U;if(!ac){u=false;U=ua(ka(m)/Math.LN2);m=la(2,U)}u?hb(T,m,u,P,function(fa,Ra){m=fa;if(Ra){U=ua(ka(m)/Math.LN2);m=la(2,U);K&&K()}c(m)}):c(m);return O}function p(){for(var m=O.trigger.apply(null,
arguments).cancel,r=s.length;r--;)m=s[r].trigger.apply(null,arguments).cancel||m;return!m}function C(m,r,u){if(V(m,$a)){if(!(u&&panSpeed===0)){z=m|0;R=r|0}}else return new S(z,R)}a=I({container:"",captureHover:true,controls:["zoombar"],drawOnScale:true,padding:0,inertia:true,refreshDistance:256,pannable:false,scalable:false,minZoom:1,maxZoom:1,renderer:"canvas/dom",zoom:1,zoombar:{}},a);var v=[],s=[],B=0,A=null,E=null,L,J=null,t=!V(window.attachEvent,na),G=false,Q=true,Z=false,W=0,x=0,N=a.refreshDistance,
z=0,R=0,Y=0,$=0,Ca=0,eb=0,va=null,wa=null,Pa=false,Qa=false,Fa=a.padding,ba=null,Ga=null,Cb=0,T=1,Db=1,da=null,fb={index:0,draw:false},ac=true,ca=0,Na,Oa,ab,bb,cb,db,Xb,Yb,Ea=a.zoom||a.zoomLevel,Zb=Ta("quad.out"),$b=300,O={id:a.id,padding:Fa,panSpeed:0,attachFrame:function(m,r){r&&A.appendChild(m)},center:function(m,r,u){if(V(m,za)){r=nb.parseXY(m).sync(O.rpp);m=r.x;r=r.y}if(V(m,$a)){C(m-cb,r-db,u);return O}else{r=C().offset(cb,db);O.rpp&&r.sync(O.rpp,true);return r}},detach:function(){renderer&&
renderer.trigger("detach");da&&da.unbind();if(E){L.removeChild(E);A=E=null}},layer:M,invalidate:function(){ca++},refresh:H,resetScale:function(){T=1},scale:F,triggerAll:p,removeLayer:function(m){a:{for(var r=B;r--;)if(s[r].id===m){m=r;break a}m=-1}if(m>=0&&m<B){O.trigger("layerRemove",O,s[m]);s.splice(m,1);ca++}B=s.length},getRenderer:function(){return renderer},getScaleFactor:function(){return T},setMaxOffset:function(m,r,u,K){va=m;wa=r;Pa=u;Qa=K},getViewport:D,offset:C,pan:function(m,r){W=m;x=r;
ca++},zoom:y};ia(O);O.bind("resize",function(){renderer.checkSize()});Mb(O,a,{container:o,captureHover:l,scalable:l,pannable:l,renderer:function(m){if(renderer){renderer.trigger("detach");renderer=null}q(m);ca++}});Wa.init(function(){M("markers","draw",{zindex:20});o(a.container);t?window.attachEvent("onresize",g):window.addEventListener("resize",g,false)});Vb.attach(function(m){var r=[],u,K,P;self.panSpeed=panSpeed=oa(W)+oa(x);u=T!==Db;if(panSpeed>0||u)ca++;if(panSpeed<2&&(oa(z-Ca)>=N||oa(R-eb)>=
N))H();fb.index++;fb.draw=ca||panSpeed||0;if(renderer&&fb.draw){Y+=W;$+=x;if(W||x)O.trigger("pan");if(T!==1&&X.supportTransforms)r[r.length]="scale("+T+")";if(u=!Q||(a.drawOnScale||T===1)&&panSpeed<5){z=z-Y/T|0;R=R-$/T|0;P=D();renderer.trigger("predraw",P);if(renderer.prepare(s,P,m,ba)){K=$=u=Y=ca=0;for(ii=B;ii--;){var U=s[ii];if(U.visible){var fa=U.style?renderer.applyStyle(U.style,true):null;U.draw(renderer,P,O,m,ba);fa&&renderer.applyStyle(fa)}}renderer.trigger("render",P);O.trigger("drawComplete",
P,m);Db=T;X.move(A,u,K,r)}}else X.move(A,Y,$,r);if(Z||!a.inertia)x=W=0;else if(W!=0||x!=0){W*=0.8;x*=0.8;if(oa(W)<0.5)W=0;if(oa(x)<0.5)x=0}if(ba){m=ba?ba.elements:[];if(Ga&&Ga.type==="hover"){r=Hits.diffHits(Ga.elements,m);r.length>0&&Hits.triggerEvent(Ga,O,"Out",r)}if(m.length>0){u=ba.x;K=ba.y;for(r=m.length;r--;){P=m[r];U=u;fa=K;var Ra=P&&P.drag&&(!P.canDrag||P.canDrag(P,U,fa));if(Ra){J=P;J.startX=U;J.startY=fa}if(Ra)break}Hits.triggerEvent(ba,O)}Ga=m.length>0?I({},ba):null;ba=null}}});(function(m){v=
[];for(var r=0;r<m.length;r++)v[v.length]=pa("control",m[r],O,E,L,a[m[r]])})(a.controls);return O});aa("view","map",function(a){function b(d,j,g){h.zoom(j);c(d,g)}function c(d,j,g,f){d=new S(d);d.sync(kb(h.zoom()));h.center(d.x,d.y,g,f,function(){j&&j(h)})}a=I({zoomLevel:1,minZoom:1,maxZoom:18,pannable:true,scalable:true},a);var e=new S,k=0,i=a.tapExtent;a.adjustScaleFactor=function(d){return Math.pow(2,(d<1?Math.floor:Math.ceil)(Math.log(d)))};var h=I(pa("view","simple",a),{getBoundingBox:function(){var d=
h.getViewport();return d?new Ba((new S(d.x,d.y2)).sync(k,true).pos(),(new S(d.x2,d.y)).sync(k,true).pos()):null},getCenterPosition:function(){var d=h.getViewport();if(d)return(new S(d.x+(d.w>>1),d.y+(d.h>>1))).sync(k,true).pos();return null},gotoBounds:function(d,j){b(d.center(),d.bestZoomLevel(h.getViewport()),j)},gotoPosition:b,panToPosition:c});h.bind("tap",function(d,j,g,f){d=f.sync(k,true).pos();var q=f.offset(-i,i).sync(k,true).pos();f=f.offset(i,-i).sync(k,true).pos();h.trigger("geotap",j,
g,d,new Ba(q,f))});h.bind("refresh",function(d,j,g){if(e.x!=g.x||e.y!=g.y){h.trigger("boundsChange",h.getBoundingBox());e.x=g.x;e.y=g.y}});h.bind("zoom",function(d,j){var g;k=h.rpp=kb(j);g=ea/k|0;h.setMaxOffset(g,g,true,false);h.resetScale();h.triggerAll("resync")});return h});var sa=function(a,b,c){c=I({style:null,xy:null,size:20,fill:false,stroke:true,draggable:false,observable:true,properties:{},typeName:"Shape"},c);I(this,c);if(V(this.xy,za))this.xy=new S(this.xy);this.id="drawable_"+Ub++;this.bounds=
null;this.view=a;this.layer=b;this.rotation=this.animations=0;this.scaling=1;this.translateY=this.translateX=0;this.observable&&ia(this)};sa.prototype={constructor:sa,animate:function(a,b,c,e){Hb(this,a,b,c,e)},drag:null,draw:null,getProps:null,resync:function(){if(this.xy){this.xy.sync(this.view.rpp);if(this.size){var a=this.size>>1;this.updateBounds(new ma(this.xy.x-a,this.xy.y-a,this.size,this.size))}}},rotate:function(a){this.rotation=a},scale:function(a){this.scaling=a},translate:function(a,
b){this.translateX=a;this.translateY=b},updateBounds:function(a,b){a&&(!this.bounds||a.x!=this.bounds.x||a.y!=this.bounds.y)&&this.trigger("move",this,a,this.bounds);this.bounds=a;if(b)this.xy=this.bounds.center()}};var ib=1E3/60|0,Aa=[],tb=0;aa("drawable","marker",function(a,b,c){c=I({fill:true,stroke:false,markerStyle:"simple",hoverStyle:"highlight",typeName:"Marker"},c);return new sa(a,b,c)});aa("drawable","poly",function(a,b,c){c=I({simplify:false,fill:true,points:[],typeName:"Poly"},c);var e=
c.points,k=c.simplify;sa.call(this,c);I(this,{getPoints:function(){return[].concat(e)},resync:function(){var i,h,d,j,g,f,q,l;for(i=e.length;i--;)e[i].sync(a.rpp);l=this.points=k?k(e):e;for(i=l.length;i--;){h=l[i].x;d=l[i].y;f=V(f,na)||h<f?h:f;q=V(q,na)||d<q?d:q;j=V(j,na)||h>j?h:j;g=V(g,na)||d>g?d:g}this.updateBounds(new ma(f,q,j-f,g-q),true)}});this.haveData=e&&e.length>=2});aa("drawable","line",function(a,b,c){c.fill=false;return pa("drawable","poly",a,b,c)});aa("drawable","image",function(a,b,c){function e(){if(j&&
j.width>0){if(!this.centerOffset)this.centerOffset=new S(-j.width>>1,-j.height>>1);this.updateBounds(new ma(this.xy.x+this.centerOffset.x,this.xy.y+this.centerOffset.y,j.width,j.height),false)}}function k(f){if(this.imageUrl=f){var q=this;Ia(this.imageUrl,function(l,n){j=l;if(n){var o=g.layer?g.layer.view:null;o&&o.invalidate()}e.apply(q)})}}c=I({image:null,imageUrl:null,centerOffset:null,typeName:"Image"},c);var i=sa.prototype.resync,h=0,d=0,j=c.image,g=I(new sa(a,b,c),{changeImage:k,getProps:function(){this.bounds||
e(this,j);return{image:j,x:this.xy.x+h,y:this.xy.y+d}},resync:function(f){i.call(this,f);e.call(this)}});j||k.call(this,this.imageUrl);if(this.centerOffset){h=this.centerOffset.x;d=this.centerOffset.y}});aa("drawable","arc",function(a,b,c){c=I({startAngle:0,endAngle:Math.PI*2,typeName:"Arc"},c);return new sa(a,b,c)});Ja.prototype={constructor:Ja,clip:null,cycle:function(){},draw:function(){},hitGuess:null};aa("layer","tile",function(a,b){b=I({generator:"osm",imageLoadArgs:{}},b);var c=pa("generator",
b.generator,b).run,e=null,k=[],i=I(new Ja(a,b),{draw:function(h,d,j){h.drawTiles&&h.drawTiles(d,e.search(d.buffer(128)),j.panSpeed<2)}});i.bind("refresh",function(h,d,j){var g=(new Date).getTime();e&&c(d,j,e,function(){d.invalidate();ga("GEN COMPLETED IN "+((new Date).getTime()-g)+" ms")})});i.bind("resync",function(){var h=a&&a.zoom?a.zoom():0;k[h]||(k[h]=ob(h));e=k[h]});return i});aa("layer","draw",function(a,b){function c(g,f,q,l){var n=this.dragOffset;if(!n)n=this.dragOffset=new S(g.startX-this.xy.x,
g.startY-this.xy.y);this.xy.x=f-n.x;this.xy.y=q-n.y;if(l){delete this.dragOffset;a.invalidate();this.trigger("dragDrop")}return true}function e(g){clearTimeout(d);d=setTimeout(function(){i.sort(function(f,q){if(q.xy&&f.xy){var l=q.xy.y-f.xy.y;return l!=0?l:q.xy.x-f.xy.x}});g&&g.invalidate()},50)}function k(g,f,q,l){l&&h.remove(l,f);h.insert(q,f)}b=I({zindex:10},b);var i=[],h,d=0,j=I(new Ja(a,b),{itemCount:0,clear:function(){h=new pb;i=[];j.itemCount=0},create:function(g,f,q){g=pa("drawable",g,a,j,
f);if(q)i.unshift(g);else i[i.length]=g;g.resync();h&&g.bounds&&h.insert(g.bounds,g);e(a);g.bind("move",k);j.itemCount=i.length;return g},draw:function(g,f,q,l,n){q={};l=h&&f?h.search(f):[];for(var o=l.length;o--;){var w=l[o],y=w.style||j.style,D,M=g.applyTransform(w),H=w.getProps?w.getProps(g):q;if(H=(D=g["prep"+w.typeName])?D.call(g,w,f,n,H):null){if(n&&H.hit){n.elements.push(Hits.initHit(w.type,w,w.draggable?c:null));D=n.type+"Style";y=w[D]||j[D]||y}y=y?g.applyStyle(y,true):null;(D=w.draw||H.draw)&&
D.call(w,H);y&&g.applyStyle(y)}M&&M.undo&&M.undo()}},find:function(){return[].concat(i)},hitGuess:function(g,f){return h&&h.search({x:g-10,y:f-10,w:20,h:20}).length>0}});j.bind("resync",function(){h=ob(a.zoom(),h);for(var g=i.length;g--;)i[g].resync()});return j});Ka.prototype={constructor:Ka};aa("control","zoombar",function(a,b,c,e){function k(v,s){var B=H[v]=X.create("div","t5-zoombar-button",{position:"absolute",background:i(v),"z-index":51,width:e.width+"px",height:e.buttonHeight+"px","margin-top":(s||
0)+"px"});F.appendChild(B)}function i(v,s){return"url("+e.images+") 0 -"+(q+n*3+(v||0)*g*3+(s||0)*g)+"px"}function h(v){return"url("+e.images+") 0 -"+(q+(v||0)*n)+"px"}function d(v,s){var B;if(v===l){l.style.background=h(s);B="thumb"}else for(var A=0;A<H.length;A++)if(v===H[A]){B="button"+A;H[A].style.background=i(A,s);break}return B}function j(v){if(v!==D){D=v;y=w-D/M*(w-o)|0;X.move(l,0,y-o);clearTimeout(p);p=setTimeout(function(){a.zoom(D)},500)}}e=I({width:24,height:200,images:"img/zoom.png",align:"right",
marginTop:10,spacing:10,thumbHeight:16,buttonHeight:16},e.zoombar);var g=e.buttonHeight,f,q=e.height,l,n=e.thumbHeight,o=e.spacing+g-(n>>1),w=e.height-g-(n>>1),y=o,D=-1;b=a.minZoom();var M=a.maxZoom()-b+1,H=[],F,p=0,C={button0:function(){a.zoom(a.zoom()+1)},button1:function(){a.zoom(a.zoom()-1)}};F=X.create("div","t5-zoombar",{position:"absolute",background:"url("+e.images+")","z-index":50,overflow:"hidden",width:e.width+"px",height:e.height+"px",margin:function(){var v=e.spacing,s=Sa("{0}px 0 0 {1}px");
if(e.align==="right")v=c.offsetWidth-e.width-e.spacing;return s(e.marginTop,v)}()});c.childNodes[0]?c.insertBefore(F,c.childNodes[0]):c.appendChild(F);F.appendChild(l=X.create("div","t5-zoombar-thumb",{position:"absolute",background:h(),"z-index":51,width:e.width+"px",height:e.thumbHeight+"px",margin:"10px 0 0 0",top:y-o+"px"}));k(0);k(1,e.height-e.buttonHeight);f=INTERACT.watch(F,{bindTarget:F});f.bind("pointerMove",function(v,s,B){y=Math.min(Math.max(o,B.y-(n>>1)),w);j(M-(y-o)/w*M|0)});f.bind("pointerDown",
function(v){d(v.target,2)});f.bind("pointerUp",function(v){d(v.target,0)});f.bind("tap",function(v){(v=C[d(v.target,2)])&&v()});b=new Ka(a);b.bind("detach",function(){f.unbind();c.removeChild(F)});a.bind("zoom",function(v,s){j(s)});j(a.zoom());return b});ja.prototype={constructor:ja,distanceTo:function(){if(!targetPos||this.empty()||targetPos.empty())return 0;var a=(targetPos.lat-this.lat)*ha>>1,b=(targetPos.lon-this.lon)*ha>>1;a=qa(a)*qa(a)+Za(this.lat*ha)*Za(targetPos.lat*ha)*qa(b)*qa(b);return 6371*
2*Tb(Ab(a),Ab(1-a))},equalTo:function(a){return pos&&this.lat===a.lat&&this.lon===a.lon},empty:function(){return this.lat===0&&this.lon===0},inArray:function(a){for(var b=a.length;b--;)if(this.equal(a[b]))return true;return false},offset:function(a,b){var c=this.lat*ha,e=this.lon*ha,k=c+a/6371;c=Sb(qa(b/6371)/Za(c));e=e+c;k=(k+ya)%Math.PI-ya;e%=ea;return new ja(k*La,e*La)},toPixels:function(){return new S(parseFloat(this.lon)*ha,jb(this.lat))},toString:function(a){return this.lat+(a||" ")+this.lon}};
aa=function(){return{generalize:function(a,b,c){var e=a.length,k=[],i=null;c||(c=250);c/=1E3;ga("generalizing positions, must include "+b.length+" positions");for(var h=e;h--;)if(h===0)k.unshift(a[h]);else{var d=!i||a[h].inArray(b)?c:i.distanceTo(a[h]);if(a[h]&&d>=c){k.unshift(a[h]);i=a[h]}}ga("generalized "+e+" positions into "+k.length+" positions");return k},parseArray:function(a){var b=a.length,c=Array(b);for(b=b;b--;)c[b]=new ja(a[b]);return c},vectorize:function(a,b){function c(){for(var h=
0,d=b.chunkSize,j=e;j--;){k[j]=new S(a[j]);h+=1;if(h>d)break}e=j;if(e<=0)b.callback&&b.callback(k);else animFrame(c)}var e=a.length,k=Array(e);b=I({chunkSize:500,async:true,callback:null},b);if(!b.async){for(var i=e;i--;)k[i]=new S(a[i]);return k}animFrame(c);return null}}}();Ba.prototype={constructor:Ba,bestZoomLevel:function(a){var b=this.center();b=Ma(ua(oa(b.lat)*0.05),Ya.length);var c=Ya[b],e=this.size();b=zb(ka(Ya[3]*a.h/e.y)/ka(2));a=zb(ka(c*a.w/e.x)/ka(2));return Ma(isNaN(b)?1E3:b,isNaN(a)?
1E3:a)},center:function(){var a=this.size();return new ja(this.min.lat+(a.y>>1),this.min.lon+(a.x>>1))},expand:function(a){this.min.lat-=a;this.max.lat+=a;this.min.lon-=a%360;this.max.lon+=a%360},size:function(a){var b=new S(0,this.max.lat-this.min.lat);b.x=(a||isType(a,na))&&this.min.lon>this.max.lon?360-this.min.lon+this.max.lon:this.max.lon-this.min.lon;return b},toString:function(){return"min: "+this.min+", max: "+this.max}};var Da={ex:I,log:ga,observable:ia,formatter:Sa,wordExists:function(a,
b){for(var c=a.split(/\s|\,/).length;c--;)if(a.toLowerCase()==b.toLowerCase())return true;return false},is:V,indexOf:yb,userMessage:function(a,b,c){Da.trigger("userMessage",a,b,c)},Registry:Xa,Style:Bb,DOM:X,Rect:ma,XY:S,Hits:Hits,tweenValue:hb,easing:Ta,Control:Ka,Tile:Ua,getImage:Ia,Pos:ja,PosFns:aa,BBox:Ba};ia(Da);gb.T5=Da;gb.Tile5=function(a,b){b=I({container:a,type:"map",renderer:"canvas",starpos:null,zoom:1,fastpan:false,drawOnScale:true,zoombar:{}},b);return pa("view",b.type,b)}})(window);
