(function(pb){function L(){var a=arguments[0]||{},d=Array.prototype.slice.call(arguments,1),b=d.length,e,h;for(h=0;h<b;h++)if((e=d[h])!==null)for(var f in e){var i=e[f];if(a!==i)if(i!==undefined)a[f]=i}return a}function da(a,d){if(typeof console!=="undefined")console[d||"debug"](a)}function la(a){var d=a.match(Ib),b=[],e=0,h;for(h=d?d.length:0;h--;){var f=d[h].slice(1);b[f]||(b[f]=RegExp("\\{"+f+"\\}","g"))}e=b.length;return function(){var i=a;for(h=0;h<e;h++){var k=arguments[h];if(typeof k=="undefined")k=
"";i=i.replace(b[h],k)}return i}}function qb(a,d){var b=Na*sa(a);return Oa-2*rb(d*Aa((1-b)/(1+b),Na/2))}function ea(a,d){if(R(a,oa)){var b=a.split(ab);this.x=parseFloat(b[0]);this.y=parseFloat(b[1])}else{this.x=a||0;this.y=d||0}}function ta(a,d,b,e){this.mercX=b;this.mercY=e;if(R(a,oa))L(this,Jb.parseXY(a));else a&&a.toPixels?L(this,a.toPixels()):ea.call(this,a,d)}function ua(a,d,b,e){this.x=a||0;this.y=d||0;this.w=b||0;this.h=e||0;this.x2=this.x+this.w;this.y2=this.y+this.h}function sb(a,d){if(!a)return null;
d=d||Kb;for(var b=[],e=null,h=a.length;h--;){var f=a[h];if(include=!e||h===0||ma(f.x-e.x)+ma(f.y-e.y)>d){b.unshift(f);e=f}}return b}function tb(a,d){var b=new ub(Math.sqrt(256<<a)|0);d&&d.zoomLevel===a&&d.copyInto(b);b.zoomLevel=a;return b}function bb(a,d,b,e,h,f){this.x=a;this.y=d;this.w=e||256;this.h=e||256;this.x2=this.x+this.w;this.y2=this.y+this.h;this.url=b;this.id=f||a+"_"+d;this.loaded=false;this.image=null}function Pa(a,d){d=L({id:"layer_"+Lb++,zindex:0,animated:false,style:null,minXY:null,
maxXY:null},d);this.visible=true;this.view=a;va(L(this,d))}function Qa(){va(this)}function ka(a,d){if(a&&a.split){var b=a.split(ab);if(b.length>1){a=b[0];d=b[1]}}else if(a&&a.lat){d=a.lon;a=a.lat}this.lat=parseFloat(a||0);this.lon=parseFloat(d||0)}function Ha(a,d){if(R(a,vb)){for(var b=d,e=new ka(cb,Ra),h=new ka(Mb,wb),f=a.length;f--;){var i=a[f];if(i.lat<e.lat)e.lat=i.lat;if(i.lat>h.lat)h.lat=i.lat;if(i.lon<e.lon)e.lon=i.lon;if(i.lon>h.lon)h.lon=i.lon}this.min=e;this.max=h;if(R(b,wa)){b=this.size();
b=Ia(b.x,b.y)*0.3}this.expand(b)}else{this.min=a;this.max=d}}function db(a){if(!R(a,oa))this.meters=a}var eb={};(function(a){var d=[],b=0,e=false,h=a.register=function(f,i){d.push({section:f,run:i})};a.init=function(f){function i(){if(b<d.length){var g=d[b++];k[g.section]||(k[g.section]={});g.run(k[g.section],i)}else{for(g in k)a[g]=k[g];e=true;f&&f(a)}}var k={};if(e&&f)f(a);else{b=0;i()}};h("canvas",function(f,i){function k(){var m,j=g.getContext("2d");j.save();try{j.translate(50,50);j.beginPath();
j.rect(0,0,20,20);m=j.isPointInPath(10,10)}finally{j.restore()}return m}var g=document.createElement("canvas"),n=typeof FlashCanvas!="undefined",c=typeof G_vmlCanvasManager!="undefnined";g.width=200;g.height=200;f.pipTransformed=n||c?false:k();i()})})(eb);var Ib=/\{(\d+)(?=\})/g,Nb=function(){var a=1.70158,d=Math.PI/2,b=Math.abs,e=Math.pow,h=Math.sin,f=Math.asin,i=Math.cos,k={linear:function(g,n,c,m){return c*g/m+n},backin:function(g,n,c,m){return c*(g/=m)*g*((a+1)*g-a)+n},backout:function(g,n,c,
m){return c*((g=g/m-1)*g*((a+1)*g+a)+1)+n},backinout:function(g,n,c,m){return(g/=m/2)<1?c/2*g*g*(((a*=1.525)+1)*g-a)+n:c/2*((g-=2)*g*(((a*=1.525)+1)*g+a)+2)+n},bouncein:function(g,n,c,m){return c-k.bounceout(m-g,0,c,m)+n},bounceout:function(g,n,c,m){return(g/=m)<1/2.75?c*7.5625*g*g+n:g<2/2.75?c*(7.5625*(g-=1.5/2.75)*g+0.75)+n:g<2.5/2.75?c*(7.5625*(g-=2.25/2.75)*g+0.9375)+n:c*(7.5625*(g-=2.625/2.75)*g+0.984375)+n},bounceinout:function(g,n,c,m){return g<m/2?k.bouncein(g*2,0,c,m)/2+n:k.bounceout(g*2-
m,0,c,m)/2+c/2+n},cubicin:function(g,n,c,m){return c*(g/=m)*g*g+n},cubicout:function(g,n,c,m){return c*((g=g/m-1)*g*g+1)+n},cubicinout:function(g,n,c,m){if((g/=m/2)<1)return c/2*g*g*g+n;return c/2*((g-=2)*g*g+2)+n},elasticin:function(g,n,c,m,j,o){if(g==0)return n;if((g/=m)==1)return n+c;o||(o=m*0.3);if(!j||j<b(c)){j=c;c=o/4}else c=o/$*f(c/j);return-(j*e(2,10*(g-=1))*h((g*m-c)*$/o))+n},elasticout:function(g,n,c,m,j,o){var q;if(g==0)return n;if((g/=m)==1)return n+c;o||(o=m*0.3);if(!j||j<b(c)){j=c;q=
o/4}else q=o/$*f(c/j);return j*e(2,-10*g)*h((g*m-q)*$/o)+c+n},elasticinout:function(g,n,c,m,j,o){var q;if(g==0)return n;if((g/=m/2)==2)return n+c;o||(o=m*0.3*1.5);if(!j||j<b(c)){j=c;q=o/4}else q=o/$*f(c/j);if(g<1)return-0.5*j*e(2,10*(g-=1))*h((g*m-q)*$/o)+n;return j*e(2,-10*(g-=1))*h((g*m-q)*$/o)*0.5+c+n},quadin:function(g,n,c,m){return c*(g/=m)*g+n},quadout:function(g,n,c,m){return-c*(g/=m)*(g-2)+n},quadinout:function(g,n,c,m){if((g/=m/2)<1)return c/2*g*g+n;return-c/2*(--g*(g-2)-1)+n},sinein:function(g,
n,c,m){return-c*i(g/m*d)+c+n},sineout:function(g,n,c,m){return c*h(g/m*d)+n},sineinout:function(g,n,c,m){return-c/2*(i(Math.PI*g/m)-1)+n}};return function(g){g=g.replace(/[\-\_\s\.]/g,"").toLowerCase();return k[g]||k.linear}}(),va=function(){function a(b,e){var h=b.hasOwnProperty("obsHandlers")?b.obsHandlers:null;h[e]||(h[e]=[]);return h[e]}var d=0;return function(b){if(!b)return null;if(!(b.hasOwnProperty("obsHandlers")?b.obsHandlers:null))b.obsHandlers={};if(!b.hasOwnProperty("bind")){b.bind=function(e,
h){var f="callback"+d++;a(b,e).unshift({fn:h,id:f});return f};b.triggerCustom=function(e,h){var f=a(b,e),i={cancel:false,name:e,source:this},k;for(k in h)i[k]=h[k];if(!f)return null;k=Array.prototype.slice.call(arguments,2);b.eventInterceptor&&b.eventInterceptor(e,i,k);k.unshift(i);for(var g=f.length;g--&&!i.cancel;)f[g].fn.apply(this,k);return i};b.trigger=function(e){var h=Array.prototype.slice.call(arguments,1);h.splice(0,0,e,null);return b.triggerCustom.apply(this,h)};b.unbind=function(e,h){if(typeof e===
"undefined")b.obsHandlers={};else for(var f=a(b,e),i=0;f&&i<f.length;i++)if(f[i].id===h){f.splice(i,1);break}return b}}return b}}(),fb=function(){function a(d,b,e,h){if(typeof d[h]=="undefined")d[h]=function(f){if(typeof f!="undefined"){b[h]=f;e[h]&&e[h](f);return d}else return b[h]}}return function(d,b,e){b=b||d;for(var h in b)typeof b[h]!="function"&&a(d,b,e,h);return d}}(),gb=Array.prototype.indexOf||function(a){for(var d=0;d<this.length;d++)if(this[d]===a)return d;return-1},R=function(){var a=
{NaN:1,Infinity:1,"-Infinity":1},d=String.prototype.toLowerCase,b=Object.prototype.toString;return function(e,h){h=d.call(h);if(h=="finite")return!a.hasOwnProperty(+e);return h=="null"&&e===null||h==typeof e||h=="object"&&e===Object(e)||h=="array"&&Array.isArray&&Array.isArray(e)||b.call(e).slice(8,-1).toLowerCase()==h}}(),Ob=function(){function a(h){var f=document.createElement("script"),i=false;f.src=h;f.async=true;f.onload=f.onreadystatechange=function(){if(!i&&(!this.readyState||this.readyState===
"loaded"||this.readyState==="complete")){i=true;f.onload=f.onreadystatechange=null;f&&f.parentNode&&f.parentNode.removeChild(f)}};b||(b=document.getElementsByTagName("head")[0]);b.appendChild(f)}var d=0,b,e=this;return function(h,f,i){h+=h.indexOf("?")>=0?"&":"?";var k="json"+ ++d;e[k]=function(g){f(g);e[k]=null;try{delete e[k]}catch(n){}};a(h+(i?i:"callback")+"="+k);return k}}();INTERACT=function(){function a(j){return function(o,q){j.addEventListener(o,q,false)}}function d(j){return function(o,
q){j.removeEventListener(o,q,false)}}function b(j){return function(o,q){j.attachEvent("on"+o,q)}}function e(j,o){return{x:j?j:0,y:o?o:0,count:1}}function h(j,o){c.push(L({handler:null,checks:{},type:j},o))}function f(j){var o=0,q=0;if(j.offsetParent){do{o+=j.offsetLeft;q+=j.offsetTop;j=j.offsetParent}while(j)}return{left:o,top:q}}function i(j,o){return{source:j,target:o.target?o.target:o.srcElement}}function k(j,o){for(var q=j.target?j.target:j.srcElement;q&&q!==o;)q=q.parentNode;return q&&q===o}
function g(j,o){return{x:j.x-(o?o.left:0),y:j.y-(o?o.top:0)}}function n(j,o){if(j.preventDefault){j.preventDefault();j.stopPropagation()}else if(typeof j.cancelBubble!="undefined")j.cancelBubble=true;o&&j.stopImmediatePropagation&&j.stopImmediatePropagation()}var c=[],m=function(j,o,q){q=L({binder:null,unbinder:null,observable:null},q);for(var B=q.observable,l=[],u,t,v={bind:function(){return B.bind.apply(null,arguments)},unbind:function(){B.unbind();for(C=0;C<l.length;C++)l[C].unbind();return v}},
C=0;C<o.length;C++)l.push(o[C](j,B,q));B.bind("pointerDown",function(){t=u=0});B.bind("pointerMove",function(D,H,p,w){u+=w.x||0;t+=w.y||0});B.bind("pointerUp",function(D,H,p){Math.abs(u)>20||Math.abs(t)>20||B.triggerCustom("tap",D,H,p)});return v};h("pointer",{handler:function(j,o,q){function B(x){if(x.pageX&&x.pageY)return e(x.pageX,x.pageY);else{var K=document.documentElement,Q=document.body;return e(x.clientX+(K&&K.scrollLeft||Q&&Q.scrollLeft||0)-(K&&K.clientLeft||Q&&Q.clientLeft||0),x.clientY+
(K&&K.scrollTop||Q&&Q.scrollTop||0)-(K&&K.clientTop||Q&&Q.clientTop||0))}}function l(x){if(k(x,j))if(w=C(x)){var K=B(x);j.style.cursor="move";n(x,true);E=K.x;F=K.y;z=e(E,F);o.triggerCustom("pointerDown",i("mouse",x),z,g(z,f(j)))}}function u(x){var K=B(x);y=K.x;G=K.y;if(k(x,j))D(x,w?"pointerMove":"pointerHover")}function t(x){if(w&&C(x)){w=false;if(k(x,j)){j.style.cursor="default";D(x,"pointerUp")}}}function v(x){if(k(x,j)){var K;x=x||window.event;if(x.detail)K=x.axis===2?-x.detail*H:0;else{K=x.wheelDeltaY?
x.wheelDeltaY:x.wheelDelta;if(window.opera)K=-K}if(K!==0){var Q=e(y,G);o.triggerCustom("zoom",i("mouse",x),Q,g(Q,f(j)),K/p,"wheel");n(x);x.returnValue=false}}}function C(x){x=x||window.event;return(x.which||x.button)==1}function D(x,K,Q,Y,fa){Q=typeof Q!="undefined"?Q:y;Y=typeof Y!="undefined"?Y:G;var I=Q-E,M=Y-F,N=e(Q,Y);o.triggerCustom(K,i("mouse",x),N,g(N,f(j)),e(I,M));if(typeof fa=="undefined"||fa){E=Q;F=Y}}q=L({},q);var H=120,p=H*8,w=false,z,y,G,E,F;q.binder("mousedown",l);q.binder("mousemove",
u);q.binder("mouseup",t);q.binder("dblclick",function(x){da("captured double click");if(k(x,j)){var K=B(x);o.triggerCustom("doubleTap",i("mouse",x),K,g(K,f(j)))}});q.binder("mousewheel",v);q.binder("DOMMouseScroll",v);return{unbind:function(){q.unbinder("mousedown",l);q.unbinder("mousemove",u);q.unbinder("mouseup",t);q.unbinder("mousewheel",v);q.unbinder("DOMMouseScroll",v)}}},checks:{touch:false}});h("pointer",{handler:function(j,o,q){function B(I){if(I.count<2)return 0;var M=I.x-I.next.x;I=I.y-
I.next.y;return~~Math.sqrt(M*M+I*I)}function l(I,M,N){M=M?M:0;N=N?N:0;for(var S={x:I.x-M,y:I.y-N,id:I.id,count:I.count},T=S;I.next;){I=I.next;T=T.next={x:I.x-M,y:I.y-N,id:I.id}}return S}function u(I,M){var N=I[M?M:"touches"],S,T;if(N.length===0)return null;T=S={x:N[0].pageX,y:N[0].pageY,id:N[0].identifier,count:N.length};for(var aa=1,Da=N.length;aa<Da;aa++)T=T.next={x:N[aa].pageX,y:N[aa].pageY,id:N[aa].identifier};return S}function t(I){if(k(I,j)){G=f(j);var M=u(I,"changedTouches"),N=l(M,G.left,G.top);
if(!F){E=w;o.triggerCustom("pointerDown",i("touch",I),M,N)}Y&&o.triggerCustom("pointerDownMulti",i("touch",I),M,N);F=u(I);if(F.count>1)K=B(F);fa=1;Q=l(F)}}function v(I){if(k(I,j)){n(I);x=u(I);if(E==w)E=Math.abs(F.x-x.x)>H||Math.abs(F.y-x.y)>H?p:w;if(E!=w){E=x.count>1?y:z;if(E==y)if(F.count===1){F=l(x);K=B(F)}else{var M=B(x);if(Math.abs(K-M)<D)E=z;else{var N;N=x.x;var S=x.next.x,T=x.y,aa=x.next.y;N={x:(N<S?N:S)+(Math.abs(N-S)>>1),y:(T<aa?T:aa)+(Math.abs(T-aa)>>1)};M=M/K;S=M-fa;o.triggerCustom("zoom",
i("touch",I),N,g(N,G),S,"pinch");fa=M}}E==z&&o.triggerCustom("pointerMove",i("touch",I),x,l(x,G.left,G.top),e(x.x-Q.x,x.y-Q.y));Y&&o.triggerCustom("pointerMoveMulti",i("touch",I),x,l(x,G.left,G.top))}Q=l(x)}}function C(I){if(k(I,j)){var M=u(I,"changedTouches"),N=l(M,G.left,G.top);x=u(I);if(!x){o.triggerCustom("pointerUp",i("touch",I),M,N);F=null}Y&&o.triggerCustom("pointerUpMulti",i("touch",I),M,N)}}q=L({detailed:false,inertia:false},q);var D=20,H=7,p=0,w=1,z=2,y=3,G,E,F,x,K,Q,Y=q.detailed,fa=1;q.binder("touchstart",
t);q.binder("touchmove",v);q.binder("touchend",C);da("initialized touch handler");return{unbind:function(){q.unbinder("touchstart",t);q.unbinder("touchmove",v);q.unbinder("touchend",C)}}},checks:{touch:true}});return{register:h,watch:function(j,o,q){o=L({bindTarget:null,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},o);capabilities=L({touch:"ontouchstart"in window},q);if(!o.observable){da("creating observable");o.observable=va({});globalOpts=o}o.binder=(o.isIE?b:a)(o.bindTarget||
document);o.unbinder=(o.isIE?b:d)(o.bindTarget||document);q=o.types;for(var B=capabilities,l=[],u=c.length;u--;){var t=c[u],v=!q||q.indexOf(t.type)>=0,C=true,D;for(D in t.checks){var H=t.checks[D];da("checking "+D+" capability. require: "+H+", capability = "+B[D]);C=C&&H===B[D]}if(v&&C)l[l.length]=t.handler}return new m(j,l,o)}}}();var J=va({}),Sa=function(){var a={};return{create:function(d,b){if(a[d][b])return a[d][b].apply(null,Array.prototype.slice.call(arguments,2));throw Pb(d,b);},get:function(d,
b){return a[d]?a[d][b]:null},register:function(d,b,e){a[d]||(a[d]={});a[d][b]&&da(Qb(d,b),"warn");a[d][b]=e}}}(),Qb=la("Registration of {0}: {1} will override existing definition"),Pb=la("Could not create {0} of type: {1}");la("Could not create drawable of type: {0}");var hb=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],$=Math.PI*2,Oa=Math.PI/2,Kb=3,ga=Math.PI/180,na=180/Math.PI,cb=90,Mb=-cb,Ra=180,wb=-Ra,ib=cb*ga,xb=-ib,yb=Ra*ga,Rb=-yb,Na=0.08181919084262157,
ma=Math.abs,zb=Math.ceil,Ja=Math.round,Ta=Math.min,Ia=Math.max,Aa=Math.pow,jb=Math.sqrt,Ba=Math.log,sa=Math.sin,Ab=Math.asin,Ua=Math.cos,rb=Math.atan,Sb=Math.atan2,wa="undefined",oa="string",Tb="object",pa="number",vb="array",ba=Sa.register,xa=Sa.create,Ub=Sa.get,Vb=0,Lb=0,ab=/[\,\s]+/,Ea=function(){function a(i){h++;i=i||(new Date).getTime();for(var k=e.length;k--;){var g=e[k];h%g.every===0&&g.cb(i)}f&&animFrame(a)}var d=1E3/60,b=["r","webkitR","mozR","oR","msR"],e=[],h=0,f=function(){for(var i=
0;i<b.length;i++)window.animFrame=window.animFrame||window[b[i]+"equestAnimationFrame"];window.animFrame&&da("Using request animation frame");return animFrame}();f?animFrame(a):setInterval(a,1E3/60);return{attach:function(i,k){e[e.length]={cb:i,every:k?Ja(k/d):1}},detach:function(i){for(var k=e.length;k--;)if(e[k].cb===i){e.splice(k,1);break}}}}(),Jb=function(){var a=/^xy\((.*)\).*$/i;return{parseXY:function(d){if(!a.test(d)){d=d.split(ab);return Va(d[1],d[0])}}}}(),X=function(){function a(e){for(var h=
0;h<e.length;h++){var f=e[h];if(typeof document.body.style[f]!="undefined")return f}}var d={"-webkit-user-select":"none",position:"absolute"},b;b=a(["-webkit-transform","MozTransform"]);css3DTransformProp=a(["WebkitPerspective","MozPerspective"]);return{transforms:R(b,oa),create:function(e,h,f){e=document.createElement(e);var i=[];f=f||{};e.className=h||"";for(var k in f)i[i.length]=k+": "+f[k];e.style.cssText=i.join(";");return e},move:function(e,h,f,i){if(b)e.style[b]="translate("+h+"px, "+f+"px) "+
(i||[]).join(" ");else{e.style.left=h+"px";e.style.top=f+"px"}},styles:function(e){return L({},d,e)}}}(),Bb=function(){function a(){for(var h=e.length,f=h;f--;)try{e[f](h)}catch(i){da(i.toString(),"error")}}var d=20,b=50,e=[];return{process:function(h,f,i){function k(c){c=(g||b)/c;if(n<h.length){var m=h.slice(n,n+c);c=m.length;var j=g?0:(new Date).getTime();f(m,c);if(!g){g=(m=((new Date).getTime()-j)/c)?d/m|0:h.length;da("calculated that we can process "+g+" items per cycle")}n+=c}else{for(c=e.length;c--;)if(e[c]===
k){e.splice(c,1);break}e.length===0&&Ea.detach(a);i&&i()}}var g,n=0;e.push(k)===1&&Ea.attach(a)}}}(),Va=Va||function(a,d){var b=parseFloat(d)*ga;b=sa(b);var e=Na*b;b=Ba((1+b)/(1-b)*Aa((1-e)/(1+e),Na))/2;return new ta(0,0,parseFloat(a)*ga,b)},kb=kb||function(a,d){for(var b=Aa(Math.E,-d),e=Oa-2*rb(b),h=qb(e,b),f=0;f<12&&ma(e-h)>1.0E-7;){e=h;h=qb(e,b);f++}return new ka(h*na,a%360*na)};ea.prototype={constructor:ea,add:function(){for(var a=this.x,d=this.y,b=arguments.length;b--;){a+=arguments[b].x;d+=
arguments[b].y}return this.copy(a,d)},copy:function(a,d){var b=L({},this);b.x=a||b.x;b.y=d||b.y;return b},equals:function(a){return this.x===a.x&&this.y===a.y},offset:function(a,d){return this.copy(this.x+a,this.y+d)},relative:function(a){a=a.viewport();return this.copy(this.x-a.x-a.padding.x,this.y-a.y-a.padding.y)},sync:function(){return this},toString:function(){return this.x+", "+this.y}};ta.prototype=L(new ea,{constructor:ta,pos:function(){return kb(this.mercX,this.mercY)},sync:function(a,d){var b;
if(!(b=a.rpp)){b=a.zoom();b=$/(256<<b)}b=b;if(d){this.mercX=this.x*b-Math.PI;this.mercY=Math.PI-this.y*b}else{this.x=Ja(((this.mercX||0)+Math.PI)/b);this.y=Ja((Math.PI-(this.mercY||0))/b)}return this}});ua.prototype={constructor:ua,buffer:function(a,d){return new ua(this.x-a,this.y-(d||a),this.w+a*2,this.h+(d||a)*2)},center:function(){return new ea(this.x+(this.w>>1),this.y+(this.h>>1))}};ba("fn","simplify",sb);Hits=function(){return{diffHits:function(a,d){var b=[],e={},h;for(h=d.length;h--;)e[d[h].target.id]=
true;for(h=a.length;h--;)e[a[h].target.id]||(b[b.length]=a[h]);return b},init:function(a,d,b,e){return{type:a,x:e.x|0,y:e.y|0,elements:[],absXY:d,relXY:b}},initHit:function(a,d,b){return{type:a,target:d,drag:b}},triggerEvent:function(a,d,b,e){d.triggerCustom(a.type+(b?b:"Hit"),{hitType:a.type},e?e:a.elements,a.absXY,a.relXY,new ta(a.x,a.y))}}}();var ub=function(a){function d(f,i){var k=b[f],g;k||(k=b[f]=[]);(g=k[i])||(g=k[i]=[]);return g}a=a||128;var b=[],e={},h=0;return{copyInto:function(f){for(var i in e){var k=
e[i];f.insert(k.bounds||k,k,i)}},insert:function(f,i,k){var g=f.x/a|0,n=f.y/a|0,c=(f.x+f.w)/a|0;f=(f.y+f.h)/a|0;k=k||i.id||"obj_"+h++;e[k]=i;for(i=g;i<=c;i++)for(g=n;g<=f;g++)d(i,g).push(k)},remove:function(f,i,k){k=k||i.id;if(e[k]){var g=f.x/a|0;i=f.y/a|0;var n=(f.x+f.w)/a|0;f=(f.y+f.h)/a|0;delete e[k];for(g=g;g<=n;g++)for(var c=i;c<=f;c++){var m=d(g,c),j=gb.call(m,k);j>=0&&m.splice(j,1)}}},search:function(f){var i=f.y/a|0,k=(f.x+f.w)/a|0,g=(f.y+f.h)/a|0,n=[],c=[];for(f=f.x/a|0;f<=k;f++)for(var m=
i;m<=g;m++)n=n.concat(d(f,m));n.sort();for(i=n.length;i--;){k=n[i];if(g=e[k])c[c.length]=g;for(;i>0&&n[i-1]==k;)i--}return c}}},Wa=function(){var a={},d=0;(new Date).getTime();var b={},e=[];Ea.attach(function(h){h=h||(new Date).getTime();for(var f=0;f<e.length;){var i=e[f],k=b[i],g=b[i].image&&b[i].image.complete&&b[i].image.width>0,n=h-k.start;n=g||n>=3E4;if(g){g=k.callbacks;a[i]=k.image;for(var c=0;c<g.length;c++)g[c](k.image,true)}if(n){e.splice(f,1);delete b[i]}else f++}},250);return function(h,
f){var i=h&&f?a[h]:null;if(i&&i&&i.complete&&i.width>0)f(i);else if(i=b[h])i.callbacks.push(f);else{i=new Image;i.id="_ldimg"+ ++d;b[h]={start:(new Date).getTime(),image:i,callbacks:[f]};i.src=h;e[e.length]=h}}}();bb.prototype={constructor:bb,load:function(a){var d=this;Wa(this.url,function(b){d.loaded=true;d.image=b;a&&a()})}};var Wb=function(){return va({fastpan:true,applyStyle:function(){},applyTransform:function(a,d,b){return{restore:null,x:d,y:b}},getDimensions:function(){return{width:0,height:0}},
getViewport:function(){},hitTest:function(){return false},prepare:function(){},projectXY:null,reset:function(){}})};ba("renderer","canvas",function(a,d,b,e,h){function f(p,w,z){var y,G;B[w]=function(E){for(y=D.length;y--;)if(G=z[D[y]])E[H[y]]=G}}function i(p,w,z){var y=false;if(w)y=c.isPointInPath((u?w.x-m:w.relXY.x)+o,(u?w.y-j:w.relXY.y)+q);return{draw:z||C,viewport:p,hit:y,vpX:m,vpY:j,context:c}}e=L({},e);var k,g,n,c,m=0,j=0,o=0,q=0,B={},l=null,u=eb.canvas.pipTransformed,t={},v=function(){},C=function(){this.fill&&
c.fill();this.stroke&&c.stroke()},D=["fill","stroke","lineWidth","opacity"],H=["fillStyle","strokeStyle","lineWidth","globalAlpha"];if(d){k=d.offsetWidth;g=d.offsetHeight;n=X.create("canvas",null,{position:"absolute","z-index":1});n.width=k;n.height=g;a.attachFrame(n,true);c=null}b=L(h,{applyStyle:function(p){var w=B[p],z=c&&c.canvas?c.canvas.id:"default",y;t[z]||(t[z]=[]);y=t[z].pop()||"reset";if(w){t[z].push(p);w(c);return y}},applyTransform:function(p){if(p.translateX!==0||p.translateY!==0||p.scaling!==
1||p.rotation!==0){c.save();l={undo:function(){c.restore();l=null},x:p.xy.x,y:p.xy.y};c.translate(p.xy.x-m+p.translateX,p.xy.y-j+p.translateY);p.rotation!==0&&c.rotate(p.rotation);p.scaling!==1&&c.scale(p.scaling,p.scaling)}return l},drawTiles:function(p,w,z){for(var y=w.length;y--;){p=w[y];if(!p.loaded&&z)p.load(a.invalidate);else p.image&&c.drawImage(p.image,p.x-m,p.y-j)}},prepare:function(p,w){var z,y=false;if(c)c.restore();else c=n.getContext("2d");for(z=p.length;z--;)y=y||p[z].clip;m=w.x;j=w.y;
o=w.padding.x;q=w.padding.y;if(c){y||c.clearRect(0,0,k,g);c.save()}c.globalCompositeOperation="source-over";return c},prepArc:function(p,w,z){c.beginPath();c.arc(p.xy.x-(l?l.x:m),p.xy.y-(l?l.y:j),p.size>>1,p.startAngle,p.endAngle,false);return i(w,z)},prepImage:function(p,w,z,y){var G=(y.x||p.xy.x)-(l?l.x:m),E=(y.y||p.xy.y)-(l?l.y:j),F=y.image||p.image;if(F){c.beginPath();c.rect(G,E,y.width||F.width,y.height||F.height);return i(w,z,function(){c.drawImage(F,G,E,y.width||F.width,y.height||F.height)})}},
prepMarker:function(p,w,z){var y=p.xy.x-(l?l.x:m),G=p.xy.y-(l?l.y:j),E=p.size,F=undefined;c.beginPath();switch(p.markerType.toLowerCase()){case "image":F=v;c.rect(y-(E>>1),G-(E>>1),E,E);if(p.reset&&p.image){p.image=null;p.reset=false}p.image?c.drawImage(p.image,y-(E>>1),G-(E>>1),E,E):Wa(p.imageUrl,function(x){p.image=x;c.drawImage(p.image,y-(E>>1),G-(E>>1),E,E)});break;default:c.moveTo(y,G);c.lineTo(y-(E>>1),G-E);c.lineTo(y+(E>>1),G-E);c.lineTo(y,G)}return i(w,z,F)},prepPoly:function(p,w,z,y){var G=
true;p=y.points||p.points;y=l?l.x:m;var E=l?l.y:j;c.beginPath();for(var F=p.length;F--;){var x=p[F].x-y,K=p[F].y-E;if(G){c.moveTo(x,K);G=false}else c.lineTo(x,K)}return i(w,z)},getContext:function(){return c}});(function(){Cb.each(function(p,w){f(null,p,w)});J.bind("styleDefined",f)})();b.bind("detach",function(){d.removeChild(n)});b.bind("resize",function(){});return b});ba("renderer","dom",function(a,d,b,e,h){function f(c){var m=c.image=new Image;g[c.id]=c;m.src=c.url;m.onload=function(){if(n[c.id])k.appendChild(this);
else c.image=null};m.style.cssText="-webkit-user-select: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute;";return m}function i(c,m,j){var o=[],q;for(q in c){var B=
c[q];if(j?B[j]:!m[q]){if(B.image&&B.image.parentNode){k.removeChild(B.image);B.image=null}o[o.length]=q}}for(m=o.length;m--;)delete c[o[m]]}var k=null,g={},n={};k=X.create("div","",X.styles({width:d.offsetWidth+"px",height:d.offsetHeight+"px"}));d.childNodes.length>0?d.insertBefore(k,d.childNodes[0]):d.appendChild(k);a.attachFrame(k);b=L(h,{drawTiles:function(c,m,j){for(var o,q=c.x,B=c.y,l=m.length;l--;){c=m[l];if(c.url){(o=c.image||(j?f(c):null))&&X.move(o,c.x-q,c.y-B);n[c.id]=c}}}});b.bind("predraw",
function(){i(g,n);n={}});b.bind("detach",function(){d.removeChild(k)});a.bind("reset",function(){for(i(g,n={});k.childNodes.length>0;)k.removeChild(k.childNodes[0])});return b});var Cb=function(){function a(b,e){if(R(b,oa)){J.trigger("styleDefined",b,d[b]=e);return b}else{var h=[],f;for(f in b)h[h.length]=a(f,b[f]);return h}}var d={};a({reset:{fill:"#ffffff",opacity:1},highlight:{fill:"#ff0000"},waypoints:{lineWidth:4,stroke:"#003377",fill:"#ffffff"},waypointsHover:{lineWidth:4,stroke:"#ff0000",fill:"#ffffff"}});
return{resetStyle:"reset",each:function(b){for(var e in d)b(e,d[e])},get:function(b){return d[b]},define:a}}();ba("view","view",function(a){function d(r,s,A,O){C(Ia(V+Aa(2,O)-1,0.125),false,true)}function b(r,s){var A=U&&U.projectXY?U.projectXY(r,s):null;if(!A){A=u();var O=1/V;A=new P.XY(A?A.x+r*O:r,A?A.y+s*O:s)}return A.sync(P,true)}function e(r,s,A){D("doubleTap",s,A,b(A.x,A.y));a.scalable&&C(2,{easing:"quad.out",duration:300},true)}function h(r,s,A){x=null;fa=true;B("down",s,A)}function f(r,s,
A){B("hover",s,A)}function i(r,s,A,O){j(s,A,false);if(!x){I=O.x;M=O.y}}function k(r,s,A){j(s,A,true);fa=false}function g(){clearTimeout(Db);Db=setTimeout(function(){if(F)if(F.offsetWidth!==Xa*2||F.offsetHeight!==Ya*2){var r=l();q(a.container);l(r.x,r.y)}},250)}function n(r,s,A){B("tap",s,A);P.trigger("tap",s,A,b(A.x,A.y,true))}function c(){ia&&ia.unbind();if(U){ia=INTERACT.watch(U.interactTarget||F);if(a.scalable){ia.bind("zoom",d);ia.bind("doubleTap",e)}ia.bind("pointerDown",h);ia.bind("pointerMove",
i);ia.bind("pointerUp",k);a.captureHover&&ia.bind("pointerHover",f);ia.bind("tap",n)}}function m(r){if(U){U.trigger("detach");U=null}var s=P,A=G,O=F,W=a;r=r.split("/");for(var Z=new Wb(s,A,O,W),qa=0;qa<r.length;qa++)Z=xa("renderer",r[qa],s,A,O,W,Z);U=Z;Y=U.fastpan&&X.transforms;c();P.trigger("reset");v()}function j(r,s,A){if(x){r=b(s.x,s.y);x.drag.call(x.target,x,r.x,r.y,A)&&ca++;if(A)x=null}}function o(r){for(var s=y;s--;)if(z[s].id===r)return s;return y}function q(r){F=document.getElementById(r);
F.appendChild(E=X.create("div","",X.styles({overflow:"hidden",width:F.offsetWidth+"px",height:F.offsetHeight+"px"})));r=a.padding;if(r===p){r=F.offsetWidth;var s=F.offsetHeight,A=jb(r*r+s*s);ja=new ea(A-r>>1,A-s>>1)}else ja=new ea(r,r);lb=E.offsetWidth+ja.x*2;mb=E.offsetHeight+ja.y*2;Xa=F.offsetWidth/2;Ya=F.offsetHeight/2;E.appendChild(G=X.create("div","",X.styles({width:lb+"px",height:mb+"px","z-index":2,margin:-ja.y+"px 0 0 "+-ja.x+"px"})));m(a.renderer);r=a.controls;for(s=0;s<w.length;s++)w[s].trigger("detach");
w=[];for(s=0;s<r.length;s++)w[w.length]=xa("control",r[s],P,E,F,a[r[s]])}function B(r,s,A){ha=Hits.init(r,s,A,b(A.x,A.y,true));for(r=y;r--;)if(z[r].visible)Q=Q||(z[r].hitGuess?z[r].hitGuess(ha.x,ha.y,P):false);Q&&ca++}function l(r,s,A){if(R(r,oa)||R(r,Tb)){s=new P.XY(r);s.sync(P);r=s.x;s=s.y}if(R(r,pa)){H(r-Xa-ja.x,s-Ya-ja.y,A);return P}else return H().offset(Xa+ja.x|0,Ya+ja.y|0).sync(P,true)}function u(){var r=new ua(S,T,lb,mb);r.scaleFactor=V;r.padding=ja?ja.copy():new ea;return r}function t(r,
s,A){if(R(r,oa)&&R(s,wa))for(s=0;s<y;s++){if(z[s].id===r)return z[s]}else if(R(r,oa)){s=xa("layer",s,P,A);s.added=(new Date).getTime();s.id=r;z[o(r)]=s;z.sort(function(O,W){return W.zindex-O.zindex||W.added-O.added});y=z.length;P.trigger("resync");v();P.trigger("layerChange",P,s);ca++;return s}else return[].concat(z)}function v(){var r=u();if(r){if(Fa||Ga)if(r){var s=Za?S+(r.w>>1):S,A=$a?T+(r.h>>1):T,O=r.w,W=r.h;if(Fa&&Fa>O)if(s+O>Fa)S=Za?S:Fa-O;else if(s<0)S=Za?S:0;if(Ga&&Ga>W)if(A+W>Ga)T=$a?T:Ga-
W;else if(A<0)T=$a?T:0}Eb=S;Fb=T;P.trigger("refresh",P,r);ca++}}function C(r,s,A){if(R(r,pa)){var O=A?r:V*r;if(!Xb){s=null;r=Ja(Ba(O)/Math.LN2);O=Aa(2,r)}if(s)Ka=ra.tween([V],[O],s,function(){V=O;Ka=null;ca++});else{V=O;ca++}return P}else return V}function D(){for(var r=P.trigger.apply(null,arguments).cancel,s=z.length;s--;)r=z[s].trigger.apply(null,arguments).cancel||r;return!r}function H(r,s,A){if(R(r,pa)){if(A)ya=ra.tween([S,T],[r,s],A,function(){ya=null});else{S=r|0;T=s|0;ca++}return P}else return(new P.XY(S,
T)).sync(P,true)}a=L({container:"",captureHover:true,controls:[],drawOnScale:true,padding:128,inertia:true,refreshDistance:256,pannable:true,scalable:true,renderer:"canvas"},a);var p="auto",w=[],z=[],y=0,G=null,E=null,F,x=null,K=!R(window.attachEvent,wa),Q=false,Y,fa=false,I=0,M=0,N=a.refreshDistance,S=0,T=0,aa=0,Da=0,Eb=0,Fb=0,Fa=null,Ga=null,Za=false,$a=false,ya=null,ja,ha=null,La=null,U,Db=0,za=0,Ma=null,V=1,Ka=null,nb=1,ia=null,ob={index:0,draw:false},Xb=true,ca=0,lb,mb,Xa,Ya,P={XY:ea,id:a.id,
panSpeed:0,attachFrame:function(r,s){s&&G.appendChild(r)},center:l,detach:function(){U&&U.trigger("detach");ia&&ia.unbind();if(E){F.removeChild(E);G=E=null}},layer:t,invalidate:function(){ca++},pan:function(r,s,A){H(S+r,T+s,A)},refresh:v,rotate:function(r,s,A){if(R(r,pa)){var O=A?r:za+r;if(s)Ma=ra.tween([za],[O],s,function(){za=O%360;Ma=null;ca++});else{za=O%360;ca++}return P}else return za},scale:C,triggerAll:D,setMaxOffset:function(r,s,A,O){Fa=r;Ga=s;Za=A;$a=O},offset:H,viewport:u};va(P);P.bind("resize",
g);P.bind("layerRemove",function(r,s){var A=gb(z,s.id);if(A>=0&&A<y){z.splice(A,1);ca++}y=z.length});fb(P,a,{container:q,captureHover:c,scalable:c,pannable:c,renderer:m});eb.init(function(){t("markers","draw",{zindex:20});q(a.container);K?window.attachEvent("onresize",g):window.addEventListener("resize",g,false)});Ea.attach(function(r){var s=[],A,O,W;self.panSpeed=panSpeed=ma(I)+ma(M);A=V!==nb;if(panSpeed>0||A||ya||Ka||Ma){ca++;if(ya&&panSpeed>0){ya(true);ya=null}}if(panSpeed<2&&(ma(S-Eb)>=N||ma(T-
Fb)>=N))v();ob.index++;ob.draw=ca||panSpeed||0;if(U&&ob.draw){if(Ka)V=Ka()[0];if(Ma)za=Ma()[0];aa+=I;Da+=M;if(I||M)P.trigger("pan");if(X.transforms){if(V!==1)s[s.length]="scale("+V+")";if(za!==0)s[s.length]="rotate("+za+"deg)"}if(A=!Y||(a.drawOnScale||V===1)&&panSpeed<5){if(ya){A=ya();S=A[0]|0;T=A[1]|0}else{S=S-aa/V|0;T=T-Da/V|0}W=u();U.trigger("predraw",W);if(U.prepare(z,W,r,ha)){O=Da=A=aa=ca=0;for(ii=y;ii--;){var Z=z[ii];if(Z.visible){var qa=Z.style?U.applyStyle(Z.style,true):null;Z.draw(U,W,P,
r,ha);qa&&U.applyStyle(qa)}}U.trigger("render",W);P.trigger("drawComplete",W,r);X.move(G,A,O,s)}}else X.move(G,aa,Da,s);if(fa||!a.inertia)M=I=0;else if(I!=0||M!=0){I*=0.8;M*=0.8;if(ma(I)<0.5)I=0;if(ma(M)<0.5)M=0}if(ha){r=true;s=ha?ha.elements:[];if(La&&La.type==="hover"){diffElements=Hits.diffHits(La.elements,s);if(diffElements.length>0)Hits.triggerEvent(La,P,"Out",diffElements);else r=false}if(s.length>0){O=ha.x;W=ha.y;for(A=s.length;A--;){Z=s[A];qa=O;var Gb=W,Hb=Z&&Z.drag&&(!Z.canDrag||Z.canDrag(Z,
qa,Gb));if(Hb){x=Z;x.startX=qa;x.startY=Gb}if(Hb)break}r&&Hits.triggerEvent(ha,P)}La=s.length>0?L({},ha):null;ha=null}if(nb!==V){P.trigger("scaleChanged",V);nb=V}}});return P});ba("view","map",function(a){function d(g,n){var c=k.viewport();if(g){c=Ia(g.bestZoomLevel(c),n||0);return b(c).center(g.center())}else return new Ha((new ta(c.x,c.y2)).sync(k,true).pos(),(new ta(c.x2,c.y)).sync(k,true).pos())}function b(g,n,c){if(R(g,pa)){g=Ia(a.minZoom,Ta(a.maxZoom,g|0));if(g!==f){var m=k.viewport(),j=k.offset(),
o=m.w/2;m=m.h/2;var q=Aa(2,g-f),B=o/q|0,l=m/q|0;f=g;k.offset(((n||j.x+o)-B)*q,((c||j.y+m)-l)*q);refreshY=refreshX=0;k.trigger("zoom",g);k.trigger("reset");h=k.rpp=$/(256<<f);k.setMaxOffset($/h|0,$/h|0,true,false);k.scale(1,false,true);k.trigger("resync");k.refresh()}return k}else return f}a=L({controls:["zoombar"],minZoom:1,maxZoom:18,renderer:"canvas/dom",zoom:1,zoombar:{}},a);var e=new ta,h,f=a.zoom||a.zoomLevel,i=0,k=L(xa("view","view",a),{XY:ta,bounds:d,zoom:b});k.bind("refresh",function(){var g=
k.viewport();if(e.x!=g.x||e.y!=g.y){k.trigger("boundsChange",d());e.x=g.x;e.y=g.y}});k.bind("scaleChanged",function(g,n){var c=Ba(n)/Math.LN2|0;if(c!==0){n=Aa(2,c);clearTimeout(i);i=setTimeout(function(){b(f+c)},500)}});return k});var ra=function(){return{tween:function(a,d,b,e,h){function f(q){var B=q-o;q=o+j<=q;for(var l=i;l--;){k[l]=n(B,a[l],c[l],j);h&&h.invalidate()}if(q||m){Ea.detach(f);for(l=0;l<g.length;l++)g[l]&&g[l](k,B,m)}}b=L({easing:"sine.out",duration:1E3,complete:null},b);var i=a.length,
k=[].concat(a),g=[e,b.complete],n=Nb(b.easing),c=[],m=false,j=b.duration,o=(new Date).getTime();for(b=i;b--;)c[b]=d[b]-a[b];Ea.attach(f);return function(q){m=q;return k}},tweenDrawable:function(a,d,b,e,h){var f=ra.tween([b],[e],h,function(){a[d]=e;for(var k=a.tweens.length;k--;)if(a.tweens[k]===i){a.tweens.splice(k,1);break}},a.view),i=function(){a[d]=f()[0]};return i}}}(),Ca=function(a,d,b){b=L({style:null,xy:null,size:20,fill:false,stroke:true,draggable:false,observable:true,properties:{},typeName:"Shape"},
b);L(this,b);if(R(this.xy,oa))this.xy=new a.XY(this.xy);this.id="drawable_"+Vb++;this.bounds=null;this.view=a;this.layer=d;this.tweens=[];this.rotation=this.animations=0;this.scaling=1;this.translateY=this.translateX=0;this.observable&&va(this)};Ca.prototype={constructor:Ca,applyTweens:function(){for(var a=this.tweens.length;a--;)this.tweens[a]()},drag:null,draw:null,getProps:null,resync:function(){if(this.xy){this.xy.sync(this.view);if(this.size){var a=this.size>>1;this.updateBounds(new ua(this.xy.x-
a,this.xy.y-a,this.size,this.size))}}},rotate:function(a,d,b){if(R(a,pa)){a=(b?a:this.rotation*na+a)*ga;if(d)this.tweens.push(ra.tweenDrawable(this,"rotation",this.rotation,a,d));else{this.rotation=a;this.view.invalidate()}return this}else return this.rotation*na},scale:function(a,d,b){if(R(a,pa)){a=b?a:this.scaling*a;if(d)this.tweens.push(ra.tweenDrawable(this,"scaling",this.scaling,a,d));else{this.scaling=a;this.view.invalidate()}return this}else return this.scaling},translate:function(a,d,b,e){if(R(a,
pa)){a=e?a:this.translateX+a;d=e?d:this.translateY+d;if(b){this.tweens.push(ra.tweenDrawable(this,"translateX",this.translateX,a,b));this.tweens.push(ra.tweenDrawable(this,"translateY",this.translateY,d,b))}else{this.translateX=a;this.translateY=d;this.view.invalidate()}return this}else return new ea(this.translateX,this.translateY)},updateBounds:function(a,d){a&&(!this.bounds||a.x!=this.bounds.x||a.y!=this.bounds.y)&&this.trigger("move",this,a,this.bounds);this.bounds=a;if(d)this.xy=this.bounds.center()}};
ba("drawable","marker",function(a,d,b){b=L({fill:true,stroke:false,markerType:"simple",hoverStyle:"highlight",typeName:"Marker"},b);return new Ca(a,d,b)});ba("drawable","poly",function(a,d,b){function e(){var g,n,c,m,j,o,q,B;B=k.points=b.simplify?sb(i):i;for(g=B.length;g--;){n=B[g].x;c=B[g].y;o=R(o,wa)||n<o?n:o;q=R(q,wa)||c<q?c:q;m=R(m,wa)||n>m?n:m;j=R(j,wa)||c>j?c:j}k.updateBounds(new ua(o,q,m-o,j-q),true)}function h(g){if(R(g,vb)){i=[];Bb.process(g,function(n,c){for(var m=0;m<c;m++)i[i.length]=
new a.XY(n[m])},f)}}function f(){i.length&&Bb.process(i,function(g,n){for(var c=n;c--;)g[c].sync(a)},e)}b=L({simplify:false,fill:true,points:[],typeName:"Poly"},b);var i=[],k=L(new Ca(a,d,b),{points:[],getPoints:function(){return[].concat(i)},resync:f});fb(k,b,{points:h});h(b.points);return k});ba("drawable","line",function(a,d,b){b.fill=false;return xa("drawable","poly",a,d,b)});ba("drawable","image",function(a,d,b){function e(){if(g&&g.width>0){if(!this.centerOffset)this.centerOffset=new ea(-g.width>>
1,-g.height>>1);this.updateBounds(new ua(this.xy.x+this.centerOffset.x,this.xy.y+this.centerOffset.y,g.width,g.height),false)}}function h(c){if(this.imageUrl=c){var m=this;Wa(this.imageUrl,function(j,o){g=j;if(o){var q=n.layer?n.layer.view:null;q&&q.invalidate()}e.apply(m)})}}b=L({image:null,imageUrl:null,centerOffset:null,typeName:"Image"},b);var f=Ca.prototype.resync,i=0,k=0,g=b.image,n=L(new Ca(a,d,b),{changeImage:h,getProps:function(){this.bounds||e(this,g);return{image:g,x:this.xy.x+i,y:this.xy.y+
k}},resync:function(c){f.call(this,c);e.call(this)}});g||h.call(this,this.imageUrl);if(this.centerOffset){i=this.centerOffset.x;k=this.centerOffset.y}});ba("drawable","arc",function(a,d,b){b=L({startAngle:0,endAngle:Math.PI*2,typeName:"Arc"},b);return new Ca(a,d,b)});Pa.prototype={constructor:Pa,clip:null,cycle:function(){},draw:function(){},hitGuess:null,remove:function(){this.view.trigger("layerRemove",this)}};ba("layer","tile",function(a,d){d=L({generator:"osm",imageLoadArgs:{}},d);var b=xa("generator",
d.generator,d).run,e=null,h=[],f=L(new Pa(a,d),{draw:function(i,k,g){i.drawTiles&&i.drawTiles(k,e.search(k.buffer(128)),g.panSpeed<2)}});a.bind("resync",function(){var i=a&&a.zoom?a.zoom():0;h[i]||(h[i]=tb(i));e=h[i]});a.bind("refresh",function(i,k,g){e&&b(k,g,e,function(){k.invalidate()})});return f});ba("layer","draw",function(a,d){function b(n,c,m,j){var o=this.dragOffset;if(!o)o=this.dragOffset=new a.XY(n.startX-this.xy.x,n.startY-this.xy.y);this.xy.x=c-o.x;this.xy.y=m-o.y;if(j){delete this.dragOffset;
a.invalidate();this.xy.sync(a,true);this.trigger("dragDrop")}return true}function e(n){clearTimeout(k);k=setTimeout(function(){f.sort(function(c,m){if(m.xy&&c.xy){var j=m.xy.y-c.xy.y;return j!=0?j:m.xy.x-c.xy.x}});n&&n.invalidate()},50)}function h(n,c,m,j){j&&i.remove(j,c);i.insert(m,c)}d=L({zindex:10},d);var f=[],i,k=0,g=L(new Pa(a,d),{itemCount:0,clear:function(){i=new ub;f=[];g.trigger("cleared");g.itemCount=0;a.invalidate()},create:function(n,c,m){c=xa("drawable",n,a,g,c);if(m)f.unshift(c);else f[f.length]=
c;c.resync();i&&c.bounds&&i.insert(c.bounds,c);e(a);c.bind("move",h);g.itemCount=f.length;g.trigger(n+"Added",c);return c},draw:function(n,c,m,j,o){m={};j=i&&c?i.search(c):[];for(var q=j.length;q--;){var B=j[q],l=B.style||g.style,u,t,v=B.getProps?B.getProps(n):m;u=n["prep"+B.typeName];B.tweens.length>0&&B.applyTweens();t=n.applyTransform(B);if(v=u?u.call(n,B,c,o,v):null){if(o&&v.hit){o.elements.push(Hits.initHit(B.type,B,B.draggable?b:null));u=o.type+"Style";l=B[u]||g[u]||l}l=l?n.applyStyle(l,true):
null;(u=B.draw||v.draw)&&u.call(B,v);l&&n.applyStyle(l)}t&&t.undo&&t.undo()}},find:function(){return[].concat(f)},hitGuess:function(n,c){return i&&i.search({x:n-10,y:c-10,w:20,h:20}).length>0}});a.bind("resync",function(){i=tb(a.zoom(),i);for(var n=f.length;n--;)f[n].resync()});return g});Qa.prototype={constructor:Qa};ba("control","zoombar",function(a,d,b,e){function h(p,w){var z=v[p]=X.create("div","t5-zoombar-button",{position:"absolute",background:f(p),"z-index":51,width:e.width+"px",height:e.buttonHeight+
"px","margin-top":(w||0)+"px"});C.appendChild(z)}function f(p,w){return"url("+e.images+") 0 -"+(m+o*3+(p||0)*n*3+(w||0)*n)+"px"}function i(p){return"url("+e.images+") 0 -"+(m+(p||0)*o)+"px"}function k(p,w){var z;if(p===j){j.style.background=i(w);z="thumb"}else for(var y=0;y<v.length;y++)if(p===v[y]){z="button"+y;v[y].style.background=f(y,w);break}return z}function g(p){if(p!==u){u=p;l=B-u/t*(B-q)|0;X.move(j,0,l-q);clearTimeout(D);D=setTimeout(function(){a.zoom(u)},500)}}e=L({width:24,height:200,images:"img/zoom.png",
align:"right",marginTop:10,spacing:10,thumbHeight:16,buttonHeight:16},e);var n=e.buttonHeight,c,m=e.height,j,o=e.thumbHeight,q=e.spacing+n-(o>>1),B=e.height-n-(o>>1),l=q,u=-1;d=a.minZoom();var t=a.maxZoom()-d+1,v=[],C,D=0,H={button0:function(){a.zoom(a.zoom()+1)},button1:function(){a.zoom(a.zoom()-1)}};C=X.create("div","t5-zoombar",{position:"absolute",background:"url("+e.images+")","z-index":50,overflow:"hidden",width:e.width+"px",height:e.height+"px",margin:function(){var p=e.spacing,w=la("{0}px 0 0 {1}px");
if(e.align==="right")p=b.offsetWidth-e.width-e.spacing;return w(e.marginTop,p)}()});b.childNodes[0]?b.insertBefore(C,b.childNodes[0]):b.appendChild(C);C.appendChild(j=X.create("div","t5-zoombar-thumb",{position:"absolute",background:i(),"z-index":51,width:e.width+"px",height:e.thumbHeight+"px",margin:"10px 0 0 0",top:l-q+"px"}));h(0);h(1,e.height-e.buttonHeight);c=INTERACT.watch(C,{bindTarget:C});c.bind("pointerMove",function(p,w,z){l=Math.min(Math.max(q,z.y-(o>>1)),B);g(t-(l-q)/B*t|0)});c.bind("pointerDown",
function(p){k(p.target,2)});c.bind("pointerUp",function(p){k(p.target,0)});c.bind("tap",function(p){(p=H[k(p.target,2)])&&p()});d=new Qa(a);d.bind("detach",function(){c.unbind();b.removeChild(C)});a.bind("zoom",function(p,w){g(w)});g(a.zoom());return d});ka.prototype={constructor:ka,distanceTo:function(){if(!targetPos||this.empty()||targetPos.empty())return 0;var a=(targetPos.lat-this.lat)*ga>>1,d=(targetPos.lon-this.lon)*ga>>1;a=sa(a)*sa(a)+Ua(this.lat*ga)*Ua(targetPos.lat*ga)*sa(d)*sa(d);return 6371*
2*Sb(jb(a),jb(1-a))},equalTo:function(a){return pos&&this.lat===a.lat&&this.lon===a.lon},empty:function(){return this.lat===0&&this.lon===0},inArray:function(a){for(var d=a.length;d--;)if(this.equal(a[d]))return true;return false},offset:function(a,d){var b=this.lat*ga,e=this.lon*ga,h=b+a/6371;b=Ab(sa(d/6371)/Ua(b));e=e+b;h=(h+Oa)%Math.PI-Oa;e%=$;return new ka(h*na,e*na)},toPixels:function(){return Va(this.lon,this.lat)},toBounds:function(a){var d=a.radians(),b=this.lat*ga,e=this.lon*ga;a=b-d;var h=
b+d;if(a>xb&&h<ib){b=Ab(sa(d)/Ua(b));d=e-b;if(d<Rb)d+=$;e=e+b;if(e>yb)e-=$}else{a=Ia(a,xb);h=Ta(h,ib);d=wb;e=Ra}return new Ha(new ka(a*na,d*na),new ka(h*na,e*na))},toString:function(a){return this.lat+(a||" ")+this.lon}};(function(){ba("fn","generalize",function(a,d,b){var e=a.length,h=[],f=null;b=(b||250)/1E3;for(e=e;e--;)if(e===0)h.unshift(a[e]);else{var i=!f||a[e].inArray(d)?b:f.distanceTo(a[e]);if(a[e]&&i>=b){h.unshift(a[e]);f=a[e]}}return h})})();Ha.prototype={constructor:Ha,bestZoomLevel:function(a){var d=
this.center();d=Ta(Ja(ma(d.lat)*0.05),hb.length);var b=hb[d],e=this.size();d=zb(Ba(hb[3]*a.h/e.y)/Ba(2));a=zb(Ba(b*a.w/e.x)/Ba(2));return Ta(isNaN(d)?1E3:d,isNaN(a)?1E3:a)},center:function(){var a=this.size();return new ka(this.min.lat+(a.y>>1),this.min.lon+(a.x>>1))},expand:function(a){this.min.lat-=a;this.max.lat+=a;this.min.lon-=a%360;this.max.lon+=a%360},size:function(a){var d=new ea(0,this.max.lat-this.min.lat);d.x=(a||R(a,wa))&&this.min.lon>this.max.lon?360-this.min.lon+this.max.lon:this.max.lon-
this.min.lon;return d},toString:function(){return"min: "+this.min+", max: "+this.max}};db.prototype={constructor:db,radians:function(a){if(R(a,pa)){this.meters=a*6371E3;return this}else return this.meters/6371E3},toString:function(){if(this.meters>1E3)return(this.meters/10|0)/100+"km";return this.meters+"m"}};L(J,{ex:L,log:da,observable:va,configurable:fb,formatter:la,wordExists:function(a,d){for(var b=a.split(/\s|\,/).length;b--;)if(a.toLowerCase()==d.toLowerCase())return true;return false},is:R,
indexOf:gb,fn:function(a){return Ub("fn",a)},project:Va,unproject:kb,getImage:Wa,userMessage:function(a,d,b){J.trigger("userMessage",a,d,b)},Registry:Sa,Style:Cb,DOM:X,Rect:ua,XY:ea,Pos:ka,BBox:Ha,Distance:db,Hits:Hits,Control:Qa,Tile:bb,Tweener:ra});J.RouteTools=function(){function a(c){if(f.test(c))return"-slight";return""}function d(c,m){m.geometry&&c.layer("route","draw").create("line",{points:m.geometry,style:"waypoints",simplify:true})}function b(c){for(var m="unknown",j=e||g,o=0;o<j.length;o++){j[o].regex.lastIndex=
-1;var q=j[o].regex.exec(c);if(q){m=j[o].customCheck?j[o].customCheck(c,q):j[o].turnType;break}}return m}var e=undefined,h=J.fn("generalize"),f=/bear/i,i=/right/i,k={unknown:"0:0",start:"1:0","continue":"1:1",arrive:"1:2",left:"2:0","left-slight":"2:1","left-sharp":"2:2",right:"3:0","right-slight":"3:1","right-sharp":"3:2","uturn-left":"4:0","uturn-right":"4:1",merge:"4:2",roundabout:"5:0",ramp:"6:0","ramp-exit":"6:1"},g=function(){var c=[];c.push({regex:/continue/i,turnType:"continue"});c.push({regex:/(take|bear|turn)(.*?)left/i,
customCheck:function(m,j){return"left"+a(j[1])}});c.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(m,j){return"right"+a(j[1])}});c.push({regex:/enter\s(roundabout|rotary)/i,turnType:"roundabout"});c.push({regex:/take.*?ramp/i,turnType:"ramp"});c.push({regex:/take.*?exit/i,turnType:"ramp-exit"});c.push({regex:/make(.*?)u\-turn/i,customCheck:function(m,j){return"uturn"+(i.test(j[1])?"-right":"-left")}});c.push({regex:/proceed/i,turnType:"start"});c.push({regex:/arrive/i,turnType:"arrive"});
c.push({regex:/fell\sthrough/i,turnType:"merge"});return c}(),n={calculate:function(c){c=L({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},c);var m=J.Registry.create("service","routing");m&&m.calculate(c,function(j){if(c.generalize)j.geometry=h(j.geometry,j.getInstructionPositions());if(c.map){d(c.map,j);c.autoFit&&c.map.bounds(j.boundingBox)}c.success&&c.success(j)})},createMapOverlay:d,getSpriteOffset:function(c,m){var j=k[c];if(j=j?j.split(":"):null)return{x:-j[0]*
(m||16),y:-j[1]*(m||16)};return null},parseTurnType:b,Instruction:function(c){var m=c=L({position:null,description:"",distance:0,distanceTotal:0,time:0,timeTotal:0,turnType:null},c),j=c.description;j=j.replace(/(\w)(\/)(\w)/g,"$1 $2 $3");m.description=j;if(!c.turnType)c.turnType=b(c.description);return c},RouteData:function(c){c=L({geometry:[],instructions:[],boundingBox:null},c);if(!c.boundingBox)c.boundingBox=new J.BBox(c.geometry);return L({getInstructionPositions:function(){for(var m=[],j=0;j<
c.instructions.length;j++)c.instructions[j].position&&m.push(c.instructions[j].position);return m}},c)}};J.observable(n);return n}();COG=typeof COG!=="undefined"?COG:{};COG.extend=function(){for(var a=arguments[0]||{},d,b=1,e=arguments.length;b<e;b++)if((d=arguments[b])!==null)for(var h in d){var f=d[h];if(a!==f)if(f!==undefined)a[h]=f}return a};(function(){var a=/^P(\d+Y)?(\d+M)?(\d+D)?$/,d=/^(\d+H)?(\d+M)?(\d+S)?$/,b={8601:function(h){h=h.split("T");var f=null;f=null;var i=0,k=0;a.lastIndex=-1;
f=a.exec(h[0]);i+=f[3]?parseInt(f[3].slice(0,-1),10):0;d.lastIndex=-1;f=d.exec(h[1]);k+=f[1]?parseInt(f[1].slice(0,-1),10)*3600:0;k+=f[2]?parseInt(f[2].slice(0,-1),10)*60:0;k+=f[3]?parseInt(f[3].slice(0,-1),10):0;return new e(i,k)}},e=COG.Duration=function(h,f){return{days:h?h:0,seconds:f?f:0}};COG.addDuration=function(){for(var h=new e,f=arguments.length;f--;){h.days+=arguments[f].days;h.seconds+=arguments[f].seconds}if(h.seconds>=86400){h.days+=~~(h.seconds/86400);h.seconds%=86400}return h};COG.formatDuration=
function(h){var f,i,k="";if(h.days)k=h.days+" days ";if(h.seconds){h=h.seconds;if(h>=3600){f=~~(h/3600);h-=f*3600}if(h>=60){i=Math.round(h/60);h-=i*60}if(f)k=k+f+(f>1?" hrs ":" hr ")+(i?(i>10?i:"0"+i)+" min ":"");else if(i)k=k+i+" min";else if(h>0)k=k+(h>10?h:"0"+h)+" sec"}return k};COG.parseDuration=function(h,f){var i=f?b[f]:null;if(i)return i(h);COG.Log.warn("Could not find duration parser for specified format: "+f);return new e}})();J.Decarta=function(){function a(l){return g(f.clientName,f.clientPassword,
f.sessionID,f.configuration,f.release,l)}function d(l,u){return n(l.maxResponses,l.version,l.requestID,l.methodName,u)}function b(l,u){f.server||da("No server configured for deCarta - we are going to have issues","warn");return c(f.server,l.requestID,escape(u))}function e(l,u){Ob(b(l,a(d(l,l.getRequestBody()))),function(t){var v=t.response.XLS.Response;if(v.numberOfResponses>0&&v[l.methodName+"Response"]){t=null;if(l.parseResponse)t=l.parseResponse(v[l.methodName+"Response"]);u&&u(t)}else da("no responses from server: "+
t.response,"error")})}function h(l,u){var t=new o({json:l.StreetAddress}),v=new j({countryCode:l.countryCode});v.parse(l.Place);return new J.Addressing.Address({streetDetails:t,location:v,country:l.countryCode?l.countryCode:"",postalCode:l.PostalCode?l.PostalCode:"",pos:u})}var f={sessionID:(new Date).getTime(),server:"",clientName:"",clientPassword:"",configuration:"",maxResponses:25,release:"4.4.2sp03",tileFormat:"PNG",fixedGrid:true,useCache:true,tileHosts:[],requestTimeout:3E4,geocoding:{countryCode:"US",
language:"EN"}},i={DEFAULT:function(l){for(var u=["landmark","municipalitySubdivision","municipality","countrySubdivision"],t="",v=0;v<u.length;v++)if(l[u[v]])t+=l[u[v]]+" ";return t}},k=1,g=la("<xls:XLS version='1' xls:lang='en' xmlns:xls='http://www.opengis.net/xls' rel='{4}' xmlns:gml='http://www.opengis.net/gml'><xls:RequestHeader clientName='{0}' clientPassword='{1}' sessionID='{2}' configuration='{3}' />{5}</xls:XLS>"),n=la("<xls:Request maximumResponses='{0}' version='{1}' requestID='{2}' methodName='{3}Request'>{4}</xls:Request>"),
c=la("{0}/JSON?reqID={1}&chunkNo=1&numChunks=1&data={2}&responseFormat=JSON"),m=function(l){l=J.ex({countryCode:f.geocoding.countryCode,language:f.geocoding.language,freeform:null,streetAddress:{building:null}},l);var u=la('<xls:Address countryCode="{0}" language="{1}">');return{getXML:function(){var t=u(l.countryCode,l.language);if(l.freeform){var v=String(l.freeform).replace(/(\'|\")/,"\\$1");t+="<xls:freeFormAddress>"+v+"</xls:freeFormAddress>"}return t+"</xls:Address>"}}},j=function(l){l=J.ex({landmark:"",
municipality:"",municipalitySubdivision:"",countrySubdivision:"",countryCode:""},l);var u=J.ex({calcMatchPercentage:function(t){var v=0;if(l.landmark&&l.landmarkSubType){if(J.wordExists(t,l.landmarkSubType)){v+=0.4;v+=J.wordExists(t,l.landmark)?0.6:0}}else{v+=J.wordExists(t,l.municipalitySubdivision)?0.8:0;if(v===0&&l.municipality)v+=J.wordExists(t,l.municipality)?0.7:0}if(l.countrySubdivision)v+=J.wordExists(t,l.countrySubdivision)?0.2:0;return v},getCountryCode:function(){if(l.countryCode)return l.countryCode.toUpperCase();
return""},parse:function(t){for(var v=0;t&&v<t.length;v++){var C=t[v].type?t[v].type.slice(0,1).toLowerCase()+t[v].type.slice(1):"";if(typeof l[C]!=="undefined"){l[C]=t[v].content;if(t[v].subType)l[C+"SubType"]=t[v].subType}}J.ex(u,l)},toString:function(){var t=i[u.getCountryCode()];if(!t)t=i.DEFAULT;return t(l)}},l);return u},o=function(l){l=J.ex({json:{}},l);var u="",t="";if(l.json.Street)u=l.json.Street.content?l.json.Street.content:l.json.Street;u=u&&u.replace?u.replace(/\/\d+$/,""):"";if(l.json.Building)if(l.json.Building.number)t=
l.json.Building.number;return{building:t,street:u,calcMatchPercentage:function(v){var C=0,D=J.Addressing.normalize(v),H=J.Addressing.normalize(u);if(l.json.Building)if(J.Addressing.buildingMatch(v,l.json.Building.number.toString()))C+=0.2;if(D&&H&&J.wordExists(D,H))C+=0.8;return C},toString:function(){if(u)return(t?t+" ":"")+u;return""}}},q=function(){return{methodName:"",maxResponses:25,version:"1.0",requestID:k++,getRequestBody:function(){return""},parseResponse:function(l){return l}}},B=function(){return J.ex(new q,
{methodName:"RUOK",parseResponse:function(l){return{aliasCount:l.maxHostAliases,host:l.hostName}}})};J.Registry.register("generator","decarta",function(l){function u(C,D,H,p){if(C=C.zoom?C.zoom():0){var w=2<<C-1,z=w>>1,y=l.tileSize,G=(D.w/y|0)+1,E=(D.h/y|0)+1,F=(D.x/y|0)-z;D=w-(D.y/y|0)-z-E;var x=H.search({x:(z+F)*y,y:(z+D*-1-E)*y,w:G*y,h:E*y});w={};var K;for(K=x.length;K--;)w[x[K].id]=true;for(x=0;x<=G;x++)for(K=0;K<=E;K++){var Q=F+x,Y=D+K-1,fa=Q+"_"+Y;if(!w[fa]){Q=new J.Tile((z+F+x)*y,(z+D*-1-K)*
y,v[x%v.length]+"/openls/image-cache/TILE?LLMIN=0.0,0.0&LLMAX="+t[C]+"&CACHEABLE=true&DS=navteq-world&WIDTH=256&HEIGHT=256&CLIENTNAME="+f.clientName+"&SESSIONID="+f.sessionID+"&FORMAT=PNG&CONFIG="+f.configuration+"&N="+Y+"&E="+Q,y,y,fa);H.insert(Q,Q)}}p&&p()}}l=J.ex({tileSize:256},l);var t=["89.787438015348100000,360.00000000000000000","85.084059050110410000,180.00000000000000000","66.653475896509040000,90.00000000000000000","41.170427238429790000,45.000000000000000000","22.076741328793200000,22.500000000000000000",
"11.251819676168665000,11.250000000000000000","5.653589942659626000,5.625000000000000000","2.830287664051185000,2.812500000000000000","1.415581451872543800,1.406250000000000000","0.707845460801532700,0.703125000000000000","0.353929573271679340,0.351562500000000000","0.176965641673330230,0.175781250000000000","0.088482927761462040,0.087890625000000000","0.044241477246363230,0.043945312500000000","0.022120740293895182,0.021972656250000000","0.011060370355776452,0.010986328125000000","0.005530185203987857,0.005493164062500000",
"0.002765092605263539,0.002746582031250000","0.001382546303032519,0.001373291015625000","0.000691272945568983,0.000686645507812500","0.000345636472797214,0.000343322753906250"],v=null;J.userMessage("ack","decarta","&copy; deCarta, Inc. Map and Imagery Data &copy; NAVTEQ or Tele Atlas or DigitalGlobe");return{run:function(C,D,H,p){v?u(C,D,H,p):e(new B,function(w){v=[];if(w.aliasCount)for(var z=0;z<w.aliasCount;z++)v[z]="http://"+w.host.replace("^(.*?).(.*)$","\u0001-0"+(z+1)+".\u0002");else v=["http://"+
w.host];u(C,D,H,p)})}}});J.Registry.register("service","geocoder",function(){var l=function(t){function v(H){var p=[],w=H?H.numberOfGeocodedAddresses:0,z=[];if(w>1)z=H.GeocodedAddress;else if(w==1)z=[H.GeocodedAddress];try{for(H=0;z&&H<z.length;H++){var y,G=z[H],E=w=null;if(G&&G.GeocodeMatchCode&&G.GeocodeMatchCode.matchType!=="NO_MATCH"){if(G&&G.Point)E=new J.Pos(G.Point.pos);if(G&&G.Address)w=h(G.Address,E)}(y=w)&&p.push(y)}}catch(F){da(F,"error")}return p}t=J.ex({addresses:[],parserReport:false,
parseOnly:false,returnSpatialKeys:false},t);var C=la('<xls:GeocodeRequest parserReport="{0}" parseOnly="{1}" returnSpatialKeys="{2}">'),D=new q;return J.ex({},D,{methodName:"Geocode",getRequestBody:function(){for(var H=C(t.parserReport,t.parseOnly,t.returnSpatialKeys),p=0;p<t.addresses.length;p++)H+=t.addresses[p].getXML();return H+"</xls:GeocodeRequest>"},parseResponse:function(H){if(t.addresses.length===1)return[v(H.GeocodeResponseList)];else{for(var p=[],w=0;w<t.addresses.length;w++)p.push(v(H.GeocodeResponseList[w]));
return p}}})},u=function(t){t=J.ex({position:null,geocodePreference:"StreetAddress"},t);return J.ex(new q,{methodName:"ReverseGeocode",getRequestBody:function(){return"<xls:ReverseGeocodeRequest><xls:Position><gml:Point><gml:pos>"+t.position.toString()+"</gml:pos></gml:Point></xls:Position><xls:ReverseGeocodePreference>"+t.geocodePreference+"</xls:ReverseGeocodePreference></xls:ReverseGeocodeRequest>"},parseResponse:function(v){var C=null;if(v&&v.Point)C=new J.Pos(match.Point.pos);if(v&&v.ReverseGeocodedLocation&&
v.ReverseGeocodedLocation.Address)return h(v.ReverseGeocodedLocation.Address,C);return null}})};return{forward:function(t,v){var C,D=[];J.is(t,"object")?J.log("attempting to geocode a simple object - not implemented","warn"):D.push(new m({freeform:t}));if(D.length>0){D=new l({addresses:D});e(D,function(H){for(C=0;v&&C<H.length;C++)v(t,H[C])})}},reverse:function(t,v){var C=new u({position:t});e(C,function(D){v&&v(D)})}}});J.Registry.register("service","routing",function(){var l=function(u){u=J.ex({waypoints:[],
provideRouteHandle:false,distanceUnit:"KM",routeQueryType:"RMAN",routePreference:"Fastest",routeInstructions:true,routeGeometry:true},u);var t=new q,v=J.formatter('<xls:DetermineRouteRequest provideRouteHandle="{0}" distanceUnit="{1}" routeQueryType="{2}">'),C=J.formatter("<xls:{0}><xls:Position><gml:Point><gml:pos>{1}</gml:pos></gml:Point></xls:Position></xls:{0}>");return J.ex({},t,{methodName:"DetermineRoute",getRequestBody:function(){if(u.waypoints.length<2)throw Error("Cannot send RouteRequest, less than 2 waypoints specified");
var D=v(u.provideRouteHandle,u.distanceUnit,u.routeQueryType);D+="<xls:RoutePlan>";D+="<xls:RoutePreference>"+u.routePreference+"</xls:RoutePreference>";D+="<xls:WayPointList>";for(var H=0;H<u.waypoints.length;H++)D+=C(H===0?"StartPoint":H===u.waypoints.length-1?"EndPoint":"ViaPoint",u.waypoints[H].toString());D+="</xls:WayPointList>";D+="</xls:RoutePlan>";if(u.routeInstructions)D+='<xls:RouteInstructionsRequest rules="maneuver-rules" providePoint="true" />';if(u.routeGeometry)D+="<xls:RouteGeometryRequest />";
D+="</xls:DetermineRouteRequest>";return D},parseResponse:function(D){var H=J.RouteTools.RouteData,p=D.RouteGeometry.LineString.pos,w=p.length,z=Array(w);for(w=w;w--;)z[w]=new ka(p[w]);p=D.RouteInstructionsList;D=[];p=p&&p.RouteInstruction?p.RouteInstruction:[];w=0;for(var y=new COG.Duration,G=0;G<p.length;G++){var E;E=p[G].distance;var F={M:1,KM:1E3}[E.uom?E.uom.toUpperCase():"M"];E=E.value&&F?E.value*F:0;F=COG.parseDuration(p[G].duration,"8601");w+=E;y=COG.addDuration(y,F);D.push(new J.RouteTools.Instruction({position:new J.Pos(p[G].Point),
description:p[G].Instruction,distance:E,distanceTotal:w,time:F,timeTotal:y}))}return new H({geometry:z,instructions:D})}})};return{calculate:function(u,t){u=J.ex({waypoints:[]},u);if(typeof J.RouteTools!=="undefined"){var v=new l(u);e(v,function(C){t&&t(C)})}else da("Could not generate route, T5.RouteTools plugin not found","warn")}}});return{applyConfig:function(l){J.ex(f,l)},compareFns:function(){return{streetDetails:function(l,u){return u.calcMatchPercentage(l)},location:function(l,u){return u.calcMatchPercentage(l)}}}()}}();
pb.T5=J;pb.Tile5=function(a,d){d=L({container:a,type:"map",renderer:"canvas",starpos:null,zoom:1,fastpan:false,drawOnScale:true,zoombar:{}},d);return xa("view",d.type,d)}})(window);
