(function(sb){function J(){var a=arguments[0]||{},c=Array.prototype.slice.call(arguments,1),b=c.length,f,g;for(g=0;g<b;g++)if((f=c[g])!==null)for(var h in f){var j=f[h];if(a!==j)if(j!==undefined)a[h]=j}return a}function ga(a,c){if(typeof console!=="undefined")console[c||"debug"](a)}function la(a){var c=a.match(Lb),b=[],f=0,g;for(g=c?c.length:0;g--;){var h=c[g].slice(1);b[h]||(b[h]=RegExp("\\{"+h+"\\}","g"))}f=b.length;return function(){var j=a;for(g=0;g<f;g++){var i=arguments[g];if(typeof i=="undefined")i=
"";j=j.replace(b[g],i)}return j}}function tb(a,c){var b=Ta*ma(a);return Ua-2*ub(c*Aa((1-b)/(1+b),Ta/2))}function U(a,c){if(Q(a,pa)){var b=a.split(fb);this.x=parseFloat(b[0]);this.y=parseFloat(b[1])}else if(a&&a.x){this.x=a.x;this.y=a.y}else{this.x=a||0;this.y=c||0}}function Ja(a){this.allowCull=a}function va(a,c,b,f){this.mercX=b;this.mercY=f;if(Q(a,pa))J(this,Mb.parseXY(a));else a&&a.toPixels?J(this,a.toPixels()):U.call(this,a,c)}function wa(a,c,b,f){this.x=a||0;this.y=c||0;this.w=b||0;this.h=f||
0;this.x2=this.x+this.w;this.y2=this.y+this.h}function vb(a,c){var b=new wb(Math.sqrt(256<<a)|0);c&&c.zoomLevel===a&&c.copyInto(b);b.zoomLevel=a;return b}function gb(a,c,b,f,g,h){this.x=a;this.y=c;this.w=f||256;this.h=f||256;this.x2=this.x+this.w;this.y2=this.y+this.h;this.url=b;this.id=h||a+"_"+c;this.loaded=false;this.image=null}function Va(a,c){c=J({id:"layer_"+Nb++,zindex:0,animated:false,style:null,minXY:null,maxXY:null,visible:true},c);this.visible=c.visible;this.view=a;xa(J(this,c))}function Wa(){xa(this)}
function ka(a,c){if(a&&a.split){var b=a.split(fb);if(b.length>1){a=b[0];c=b[1]}}else if(a&&a.lat){c=a.lon;a=a.lat}this.lat=parseFloat(a||0);this.lon=parseFloat(c||0)}function Ka(a,c){if(Q(a,xb)){for(var b=c,f=new ka(hb,Xa),g=new ka(Ob,yb),h=a.length;h--;){var j=a[h];if(j.lat<f.lat)f.lat=j.lat;if(j.lat>g.lat)g.lat=j.lat;if(j.lon<f.lon)f.lon=j.lon;if(j.lon>g.lon)g.lon=j.lon}this.min=f;this.max=g;if(Q(b,qa)){b=this.size();b=Da(b.x,b.y)*0.3}this.expand(b)}else{this.min=a;this.max=c}}function ib(a){if(!Q(a,
pa))this.meters=a}var Lb=/\{(\d+)(?=\})/g,Pb=function(){var a=1.70158,c=Math.PI/2,b=Math.abs,f=Math.pow,g=Math.sin,h=Math.asin,j=Math.cos,i={linear:function(e,q,d,l){return d*e/l+q},backin:function(e,q,d,l){return d*(e/=l)*e*((a+1)*e-a)+q},backout:function(e,q,d,l){return d*((e=e/l-1)*e*((a+1)*e+a)+1)+q},backinout:function(e,q,d,l){return(e/=l/2)<1?d/2*e*e*(((a*=1.525)+1)*e-a)+q:d/2*((e-=2)*e*(((a*=1.525)+1)*e+a)+2)+q},bouncein:function(e,q,d,l){return d-i.bounceout(l-e,0,d,l)+q},bounceout:function(e,
q,d,l){return(e/=l)<1/2.75?d*7.5625*e*e+q:e<2/2.75?d*(7.5625*(e-=1.5/2.75)*e+0.75)+q:e<2.5/2.75?d*(7.5625*(e-=2.25/2.75)*e+0.9375)+q:d*(7.5625*(e-=2.625/2.75)*e+0.984375)+q},bounceinout:function(e,q,d,l){return e<l/2?i.bouncein(e*2,0,d,l)/2+q:i.bounceout(e*2-l,0,d,l)/2+d/2+q},cubicin:function(e,q,d,l){return d*(e/=l)*e*e+q},cubicout:function(e,q,d,l){return d*((e=e/l-1)*e*e+1)+q},cubicinout:function(e,q,d,l){if((e/=l/2)<1)return d/2*e*e*e+q;return d/2*((e-=2)*e*e+2)+q},elasticin:function(e,q,d,l,
k,o){if(e==0)return q;if((e/=l)==1)return q+d;o||(o=l*0.3);if(!k||k<b(d)){k=d;d=o/4}else d=o/aa*h(d/k);return-(k*f(2,10*(e-=1))*g((e*l-d)*aa/o))+q},elasticout:function(e,q,d,l,k,o){var p;if(e==0)return q;if((e/=l)==1)return q+d;o||(o=l*0.3);if(!k||k<b(d)){k=d;p=o/4}else p=o/aa*h(d/k);return k*f(2,-10*e)*g((e*l-p)*aa/o)+d+q},elasticinout:function(e,q,d,l,k,o){var p;if(e==0)return q;if((e/=l/2)==2)return q+d;o||(o=l*0.3*1.5);if(!k||k<b(d)){k=d;p=o/4}else p=o/aa*h(d/k);if(e<1)return-0.5*k*f(2,10*(e-=
1))*g((e*l-p)*aa/o)+q;return k*f(2,-10*(e-=1))*g((e*l-p)*aa/o)*0.5+d+q},quadin:function(e,q,d,l){return d*(e/=l)*e+q},quadout:function(e,q,d,l){return-d*(e/=l)*(e-2)+q},quadinout:function(e,q,d,l){if((e/=l/2)<1)return d/2*e*e+q;return-d/2*(--e*(e-2)-1)+q},sinein:function(e,q,d,l){return-d*j(e/l*c)+d+q},sineout:function(e,q,d,l){return d*g(e/l*c)+q},sineinout:function(e,q,d,l){return-d/2*(j(Math.PI*e/l)-1)+q}};return function(e){e=e.replace(/[\-\_\s\.]/g,"").toLowerCase();return i[e]||i.linear}}(),
xa=function(){function a(b,f){var g=b.hasOwnProperty("obsHandlers")?b.obsHandlers:null;g[f]||(g[f]=[]);return g[f]}var c=0;return function(b){if(!b)return null;if(!(b.hasOwnProperty("obsHandlers")?b.obsHandlers:null))b.obsHandlers={};if(!b.hasOwnProperty("bind")){b.bind=function(f,g){var h="callback"+c++;a(b,f).unshift({fn:g,id:h});return h};b.triggerCustom=function(f,g){var h=a(b,f),j={cancel:false,name:f,source:this},i;for(i in g)j[i]=g[i];if(!h)return null;i=Array.prototype.slice.call(arguments,
2);b.eventInterceptor&&b.eventInterceptor(f,j,i);i.unshift(j);for(var e=h.length;e--&&!j.cancel;)h[e].fn.apply(this,i);return j};b.trigger=function(f){var g=Array.prototype.slice.call(arguments,1);g.splice(0,0,f,null);return b.triggerCustom.apply(this,g)};b.unbind=function(f,g){if(typeof f==="undefined")b.obsHandlers={};else for(var h=a(b,f),j=0;h&&j<h.length;j++)if(h[j].id===g){h.splice(j,1);break}return b}}return b}}(),zb=function(){function a(c,b,f,g){if(typeof c[g]=="undefined")c[g]=function(h){if(typeof h!=
"undefined"){b[g]=h;f[g]&&f[g](h);return c}else return b[g]}}return function(c,b,f){b=b||c;for(var g in b)typeof b[g]!="function"&&a(c,b,f,g);return c}}(),jb=Array.prototype.indexOf||function(a){for(var c=0;c<this.length;c++)if(this[c]===a)return c;return-1},Q=function(){var a={NaN:1,Infinity:1,"-Infinity":1},c=String.prototype.toLowerCase,b=Object.prototype.toString;return function(f,g){g=c.call(g);if(g=="finite")return!a.hasOwnProperty(+f);return g=="null"&&f===null||g==typeof f||g=="object"&&f===
Object(f)||g=="array"&&Array.isArray&&Array.isArray(f)||b.call(f).slice(8,-1).toLowerCase()==g}}(),Qb=function(){function a(g){var h=document.createElement("script"),j=false;h.src=g;h.async=true;h.onload=h.onreadystatechange=function(){if(!j&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){j=true;h.onload=h.onreadystatechange=null;h&&h.parentNode&&h.parentNode.removeChild(h)}};b||(b=document.getElementsByTagName("head")[0]);b.appendChild(h)}var c=0,b,f=this;return function(g,
h,j){g+=g.indexOf("?")>=0?"&":"?";var i="json"+ ++c;f[i]=function(e){h(e);f[i]=null;try{delete f[i]}catch(q){}};a(g+(j?j:"callback")+"="+i);return i}}();INTERACT=function(){function a(k){return function(o,p){k.addEventListener(o,p,false)}}function c(k){return function(o,p){k.removeEventListener(o,p,false)}}function b(k){return function(o,p){k.attachEvent("on"+o,p)}}function f(k,o){return{x:k?k:0,y:o?o:0,count:1}}function g(k,o){d.push(J({handler:null,checks:{},type:k},o))}function h(k){var o=0,p=
0;if(k.offsetParent){do{o+=k.offsetLeft;p+=k.offsetTop;k=k.offsetParent}while(k)}return{left:o,top:p}}function j(k,o){return{source:k,target:o.target?o.target:o.srcElement}}function i(k,o){for(var p=k.target?k.target:k.srcElement;p&&p!==o;)p=p.parentNode;return p&&p===o}function e(k,o){return{x:k.x-(o?o.left:0),y:k.y-(o?o.top:0)}}function q(k,o){if(k.preventDefault){k.preventDefault();k.stopPropagation()}else if(typeof k.cancelBubble!="undefined")k.cancelBubble=true;o&&k.stopImmediatePropagation&&
k.stopImmediatePropagation()}var d=[],l=function(k,o,p){p=J({binder:null,unbinder:null,observable:null},p);for(var E=p.observable,m=[],z,t,v={bind:function(){return E.bind.apply(null,arguments)},unbind:function(){E.unbind();for(n=0;n<m.length;n++)m[n].unbind();return v}},n=0;n<o.length;n++)m.push(o[n](k,E,p));E.bind("pointerDown",function(){t=z=0});E.bind("pointerMove",function(r,x,s,A){z+=A.x||0;t+=A.y||0});E.bind("pointerUp",function(r,x,s){Math.abs(z)>20||Math.abs(t)>20||E.triggerCustom("tap",
r,x,s)});return v};g("pointer",{handler:function(k,o,p){function E(y){if(y.pageX&&y.pageY)return f(y.pageX,y.pageY);else{var G=document.documentElement,R=document.body;return f(y.clientX+(G&&G.scrollLeft||R&&R.scrollLeft||0)-(G&&G.clientLeft||R&&R.clientLeft||0),y.clientY+(G&&G.scrollTop||R&&R.scrollTop||0)-(G&&G.clientTop||R&&R.clientTop||0))}}function m(y){if(i(y,k))if(A=n(y)){var G=E(y);k.style.cursor="move";q(y,true);N=G.x;L=G.y;C=f(N,L);o.triggerCustom("pointerDown",j("mouse",y),C,e(C,h(k)))}}
function z(y){var G=E(y);D=G.x;H=G.y;if(i(y,k))r(y,A?"pointerMove":"pointerHover")}function t(y){if(A&&n(y)){A=false;if(i(y,k)){k.style.cursor="default";r(y,"pointerUp")}}}function v(y){if(i(y,k)){var G;y=y||window.event;if(y.detail){if(typeof y.axis=="undefined"||y.axis===2)G=-y.detail*x}else{G=y.wheelDeltaY?y.wheelDeltaY:y.wheelDelta;if(window.opera)G=-G}if(G){var R=f(D,H);o.triggerCustom("zoom",j("mouse",y),R,e(R,h(k)),G/s,"wheel");q(y);y.returnValue=false}}}function n(y){y=y||window.event;return(y.which||
y.button)==1}function r(y,G,R,Y,ha){R=typeof R!="undefined"?R:D;Y=typeof Y!="undefined"?Y:H;var I=R-N,M=Y-L,K=f(R,Y);o.triggerCustom(G,j("mouse",y),K,e(K,h(k)),f(I,M));if(typeof ha=="undefined"||ha){N=R;L=Y}}p=J({},p);var x=120,s=x*8,A=false,C,D,H,N,L;p.binder("mousedown",m);p.binder("mousemove",z);p.binder("mouseup",t);p.binder("dblclick",function(y){ga("captured double click");if(i(y,k)){var G=E(y);o.triggerCustom("doubleTap",j("mouse",y),G,e(G,h(k)))}});p.binder("mousewheel",v);p.binder("DOMMouseScroll",
v);return{unbind:function(){p.unbinder("mousedown",m);p.unbinder("mousemove",z);p.unbinder("mouseup",t);p.unbinder("mousewheel",v);p.unbinder("DOMMouseScroll",v)}}},checks:{touch:false}});g("pointer",{handler:function(k,o,p){function E(I){if(I.count<2)return 0;var M=I.x-I.next.x;I=I.y-I.next.y;return~~Math.sqrt(M*M+I*I)}function m(I,M,K){M=M?M:0;K=K?K:0;for(var ba={x:I.x-M,y:I.y-K,id:I.id,count:I.count},S=ba;I.next;){I=I.next;S=S.next={x:I.x-M,y:I.y-K,id:I.id}}return ba}function z(I,M){var K=I[M?
M:"touches"],ba,S;if(K.length===0)return null;S=ba={x:K[0].pageX,y:K[0].pageY,id:K[0].identifier,count:K.length};for(var T=1,Ea=K.length;T<Ea;T++)S=S.next={x:K[T].pageX,y:K[T].pageY,id:K[T].identifier};return ba}function t(I){if(i(I,k)){H=h(k);var M=z(I,"changedTouches"),K=m(M,H.left,H.top);if(!L){N=A;o.triggerCustom("pointerDown",j("touch",I),M,K)}Y&&o.triggerCustom("pointerDownMulti",j("touch",I),M,K);L=z(I);if(L.count>1)G=E(L);ha=1;R=m(L)}}function v(I){if(i(I,k)){q(I);y=z(I);if(N==A)N=Math.abs(L.x-
y.x)>x||Math.abs(L.y-y.y)>x?s:A;if(N!=A){N=y.count>1?D:C;if(N==D)if(L.count===1){L=m(y);G=E(L)}else{var M=E(y);if(Math.abs(G-M)<r)N=C;else{var K;K=y.x;var ba=y.next.x,S=y.y,T=y.next.y;K={x:(K<ba?K:ba)+(Math.abs(K-ba)>>1),y:(S<T?S:T)+(Math.abs(S-T)>>1)};M=M/G;ba=M-ha;o.triggerCustom("zoom",j("touch",I),K,e(K,H),ba,"pinch");ha=M}}N==C&&o.triggerCustom("pointerMove",j("touch",I),y,m(y,H.left,H.top),f(y.x-R.x,y.y-R.y));Y&&o.triggerCustom("pointerMoveMulti",j("touch",I),y,m(y,H.left,H.top))}R=m(y)}}function n(I){if(i(I,
k)){var M=z(I,"changedTouches"),K=m(M,H.left,H.top);y=z(I);if(!y){o.triggerCustom("pointerUp",j("touch",I),M,K);L=null}Y&&o.triggerCustom("pointerUpMulti",j("touch",I),M,K)}}p=J({detailed:false,inertia:false},p);var r=20,x=7,s=0,A=1,C=2,D=3,H,N,L,y,G,R,Y=p.detailed,ha=1;p.binder("touchstart",t);p.binder("touchmove",v);p.binder("touchend",n);ga("initialized touch handler");return{unbind:function(){p.unbinder("touchstart",t);p.unbinder("touchmove",v);p.unbinder("touchend",n)}}},checks:{touch:true}});
return{register:g,watch:function(k,o,p){o=J({bindTarget:null,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},o);capabilities=J({touch:"ontouchstart"in window},p);if(!o.observable){ga("creating observable");o.observable=xa({});globalOpts=o}o.binder=(o.isIE?b:a)(o.bindTarget||document);o.unbinder=(o.isIE?b:c)(o.bindTarget||document);p=o.types;for(var E=capabilities,m=[],z=d.length;z--;){var t=d[z],v=!p||p.indexOf(t.type)>=0,n=true,r;for(r in t.checks){var x=t.checks[r];ga("checking "+
r+" capability. require: "+x+", capability = "+E[r]);n=n&&x===E[r]}if(v&&n)m[m.length]=t.handler}return new l(k,m,o)}}}();var F=xa({}),Ya=function(){var a={};return{create:function(c,b){if(a[c][b])return a[c][b].apply(null,Array.prototype.slice.call(arguments,2));throw Rb(c,b);},get:function(c,b){return a[c]?a[c][b]:null},register:function(c,b,f){a[c]||(a[c]={});a[c][b]&&ga(Sb(c,b),"warn");a[c][b]=f}}}(),Sb=la("Registration of {0}: {1} will override existing definition"),Rb=la("Could not create {0} of type: {1}");
la("Could not create drawable of type: {0}");var kb=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],aa=Math.PI*2,Ua=Math.PI/2,ca=Math.PI/180,na=180/Math.PI,hb=90,Ob=-hb,Xa=180,yb=-Xa,lb=hb*ca,Ab=-lb,Bb=Xa*ca,Tb=-Bb,Ta=0.08181919084262157,oa=Math.abs,Cb=Math.ceil,La=Math.round,Ma=Math.min,Da=Math.max,Aa=Math.pow,mb=Math.sqrt,Ba=Math.log,ma=Math.sin,Db=Math.asin,Fa=Math.cos,ub=Math.atan,Ub=Math.atan2,qa="undefined",pa="string",Vb="object",ra="number",xb="array",
ea=Ya.register,ya=Ya.create,Wb=Ya.get,Xb=0,Nb=0,fb=/[\,\s]+/,Ga=function(){function a(j){g++;j=j||(new Date).getTime();for(var i=f.length;i--;){var e=f[i];g%e.every===0&&e.cb(j)}h&&animFrame(a)}var c=1E3/60,b=["r","webkitR","mozR","oR","msR"],f=[],g=0,h=function(){for(var j=0;j<b.length;j++)window.animFrame=window.animFrame||window[b[j]+"equestAnimationFrame"];return animFrame}();h?animFrame(a):setInterval(a,1E3/60);return{attach:function(j,i){f[f.length]={cb:j,every:i?La(i/c):1}},detach:function(j){for(var i=
f.length;i--;)if(f[i].cb===j){f.splice(i,1);break}}}}(),Mb=function(){var a=/^xy\((.*)\).*$/i;return{parseXY:function(c){if(!a.test(c)){c=c.split(fb);return Za(c[1],c[0])}}}}(),Z=function(){function a(g){for(var h=0;h<g.length;h++){var j=g[h];if(typeof document.body.style[j]!="undefined")return j}}var c={"-webkit-user-select":"none",position:"absolute"},b,f;b=a(["-webkit-transform","MozTransform"]);css3DTransformProp=a(["WebkitPerspective","MozPerspective"]);f=a(["-webkit-transform-origin","MozTransformOrigin"]);
return{transforms:Q(b,pa),create:function(g,h,j){g=document.createElement(g);var i=[];j=j||{};g.className=h||"";for(var e in j)i[i.length]=e+": "+j[e];g.style.cssText=i.join(";");return g},move:function(g,h,j,i,e){if(b){g.style[b]="translate("+h+"px, "+j+"px) "+(i||[]).join(" ");if(e&&f)g.style[f]=e.x+"px "+e.y+"px"}else{g.style.left=h+"px";g.style.top=j+"px"}},styles:function(g){return J({},c,g)}}}(),Eb=function(){function a(){for(var g=f.length,h=g;h--;)try{f[h](g)}catch(j){ga(j.toString(),"error")}}
var c=20,b=50,f=[];return{process:function(g,h,j,i){function e(l){l=(q||b)/l;if(d<g.length){var k=g.slice(d,d+l);l=k.length;var o=q?0:(new Date).getTime();h(k,l);if(!q){q=(k=((new Date).getTime()-o)/l)?c/k|0:g.length;ga("calculated that we can process "+q+" items per cycle")}d+=l}else{for(l=f.length;l--;)if(f[l]===e){f.splice(l,1);break}f.length===0&&Ga.detach(a);j&&j()}}var q,d=0;if(g.length>(i||0))f.push(e)===1&&Ga.attach(a);else{h(g,g.length);j&&j()}}}}(),Za=Za||function(a,c){var b=parseFloat(c)*
ca;b=ma(b);var f=Ta*b;b=Ba((1+b)/(1-b)*Aa((1-f)/(1+f),Ta))/2;return new va(0,0,parseFloat(a)*ca,b)},nb=nb||function(a,c){for(var b=Aa(Math.E,-c),f=Ua-2*ub(b),g=tb(f,b),h=0;h<12&&oa(f-g)>1.0E-7;){f=g;g=tb(f,b);h++}return new ka(g*na,a%360*na)};U.prototype={constructor:U,add:function(){for(var a=this.x,c=this.y,b=arguments.length;b--;){a+=arguments[b].x;c+=arguments[b].y}return this.copy(a,c)},copy:function(a,c){var b=J({},this);b.x=a||b.x;b.y=c||b.y;return b},equals:function(a){return this.x===a.x&&
this.y===a.y},offset:function(a,c){return this.copy(this.x+a,this.y+c)},relative:function(a){a=a.viewport();return this.copy(this.x-a.x-a.padding.x,this.y-a.y-a.padding.y)},rotate:function(a,c){c=c||new U(0,0);var b=this.x-c.x,f=this.y-c.y;return new U(c.x+Fa(a)*b+-ma(a)*f,c.y+ma(a)*b+Fa(a)*f)},scale:function(a,c){c=c||new U(0,0);return new U(c.x+(this.x-c.x)*a,c.y+(this.y-c.y)*a)},sync:function(){return this},toString:function(){return this.x+", "+this.y}};Ja.prototype=J([],{cull:function(a){if(this.allowCull){var c=
a.x,b=a.y,f=a.x+a.w;a=a.y+a.h;for(var g=Infinity,h=0,j,i=this.length;i--;)if(j=this[i].x>=c&&this[i].x<=f&&this[i].y>=b&&this[i].y<=a){g=i<g?i:g;h=i>h?i:h}return this.slice(Da(g-1,0),Ma(h+1,this.length))}return this},simplify:function(a){a=a||3;for(var c=new Ja(this.allowCull),b=null,f=this.length;f--;){var g=this[f];if(include=!b||f===0||oa(g.x-b.x)+oa(g.y-b.y)>a){c.unshift(g);b=g}}return c}});va.prototype=J(new U,{constructor:va,pos:function(){return nb(this.mercX,this.mercY)},sync:function(a,c){var b;
if(!(b=a.rpp)){b=a.zoom();b=aa/(256<<b)}b=b;if(c){this.mercX=this.x*b-Math.PI;this.mercY=Math.PI-this.y*b}else{this.x=La(((this.mercX||0)+Math.PI)/b);this.y=La((Math.PI-(this.mercY||0))/b)}return this}});wa.prototype={constructor:wa,buffer:function(a,c){return new wa(this.x-a,this.y-(c||a),this.w+a*2,this.h+(c||a)*2)},center:function(){return new U(this.x+(this.w>>1),this.y+(this.h>>1))}};Hits=function(){return{diffHits:function(a,c){var b=[],f={},g;for(g=c.length;g--;)f[c[g].target.id]=true;for(g=
a.length;g--;)f[a[g].target.id]||(b[b.length]=a[g]);return b},init:function(a,c,b,f,g){return{type:a,x:g.x,y:g.y,gridX:f.x|0,gridY:f.y|0,elements:[],absXY:c,relXY:b}},initHit:function(a,c,b){return{type:a,target:c,drag:b}},triggerEvent:function(a,c,b,f){c.triggerCustom(a.type+(b?b:"Hit"),{hitType:a.type},f?f:a.elements,a.absXY,a.relXY,new va(a.gridX,a.gridY))}}}();var wb=function(a){function c(h,j){var i=b[h],e;i||(i=b[h]=[]);(e=i[j])||(e=i[j]=[]);return e}a=a||128;var b=[],f={},g=0;return{copyInto:function(h){for(var j in f){var i=
f[j];h.insert(i.bounds||i,i,j)}},insert:function(h,j,i){var e=h.x/a|0,q=h.y/a|0,d=(h.x+h.w)/a|0;h=(h.y+h.h)/a|0;i=i||j.id||"obj_"+g++;f[i]=j;for(j=e;j<=d;j++)for(e=q;e<=h;e++)c(j,e).push(i)},remove:function(h,j,i){i=i||j.id;if(f[i]){var e=h.x/a|0;j=h.y/a|0;var q=(h.x+h.w)/a|0;h=(h.y+h.h)/a|0;delete f[i];for(e=e;e<=q;e++)for(var d=j;d<=h;d++){var l=c(e,d),k=jb.call(l,i);k>=0&&l.splice(k,1)}}},search:function(h){var j=h.y/a|0,i=(h.x+h.w)/a|0,e=(h.y+h.h)/a|0,q=[],d=[];for(h=h.x/a|0;h<=i;h++)for(var l=
j;l<=e;l++)q=q.concat(c(h,l));q.sort();for(j=q.length;j--;){i=q[j];if(e=f[i])d[d.length]=e;for(;j>0&&q[j-1]==i;)j--}return d}}},$a=function(){var a={},c=0;(new Date).getTime();var b={},f=[];Ga.attach(function(g){g=g||(new Date).getTime();for(var h=0;h<f.length;){var j=f[h],i=b[j],e=b[j].image&&b[j].image.complete&&b[j].image.width>0,q=g-i.start;q=e||q>=3E4;if(e){e=i.callbacks;a[j]=i.image;for(var d=0;d<e.length;d++)e[d](i.image,true)}if(q){f.splice(h,1);delete b[j]}else h++}},250);return function(g,
h){var j=g&&h?a[g]:null;if(j&&j&&j.complete&&j.width>0)h(j);else if(j=b[g])j.callbacks.push(h);else{j=new Image;j.id="_ldimg"+ ++c;b[g]={start:(new Date).getTime(),image:j,callbacks:[h]};j.src=g;f[f.length]=g}}}();gb.prototype={constructor:gb,load:function(a){var c=this;$a(this.url,function(b){c.loaded=true;c.image=b;a&&a()})}};var Yb=function(){return xa({fastpan:true,applyStyle:function(){},applyTransform:function(a,c,b){return{restore:null,x:c,y:b}},getDimensions:function(){return{width:0,height:0}},
getViewport:function(){},hitTest:function(){return false},prepare:function(){},projectXY:null,reset:function(){}})};ea("renderer","canvas",function(a,c,b,f,g){function h(n,r,x){var s,A;o[r]=function(C){for(s=t.length;s--;)if(A=x[t[s]])C[v[s]]=A}}function j(n,r,x){return{draw:x||z,viewport:n,hit:r&&d.isPointInPath(r.x,r.y),vpX:l,vpY:k,context:d}}f=J({},f);var i,e,q,d,l=0,k=0,o={},p=null,E={},m=function(){},z=function(){this.fill&&d.fill();this.stroke&&d.stroke()},t=["fill","stroke","lineWidth","opacity"],
v=["fillStyle","strokeStyle","lineWidth","globalAlpha"];(function(){function n(s,A){this.save();this.setTransform(1,0,0,1,0,0);var C=this.isPointInPath_old(s,A);this.restore();return C}var r=CanvasRenderingContext2D.prototype,x=document.createElement("canvas").getContext("2d");x.translate(50,0);x.moveTo(125,50);x.arc(100,50,25,0,360,false);if(!x.isPointInPath(150,50)){r.isPointInPath_old=r.isPointInPath;r.isPointInPath=n}})();if(c){i=c.offsetWidth;e=c.offsetHeight;q=Z.create("canvas",null,{position:"absolute",
"z-index":1});q.width=i;q.height=e;a.attachFrame(q,true);d=null}b=J(g,{applyStyle:function(n){var r=o[n],x=d&&d.canvas?d.canvas.id:"default",s;E[x]||(E[x]=[]);s=E[x].pop()||"reset";if(r){E[x].push(n);r(d);return s}},applyTransform:function(n){if(n.translateX!==0||n.translateY!==0||n.scaling!==1||n.rotation!==0){d.save();p={undo:function(){d.restore();p=null},x:n.xy.x,y:n.xy.y};d.translate(n.xy.x-l+n.translateX,n.xy.y-k+n.translateY);n.rotation!==0&&d.rotate(n.rotation);n.scaling!==1&&d.scale(n.scaling,
n.scaling)}return p},drawTiles:function(n,r,x){for(var s=r.length;s--;){n=r[s];if(!n.loaded&&x)n.load(a.invalidate);else n.image&&d.drawImage(n.image,n.x-l,n.y-k)}},prepare:function(n,r){var x,s=false;if(d)d.restore();else d=q.getContext("2d");for(x=n.length;x--;)s=s||n[x].clip;l=r.x;k=r.y;if(d){s||d.clearRect(0,0,i,e);d.save()}d.globalCompositeOperation="source-over";return d},prepArc:function(n,r,x){d.beginPath();d.arc(n.xy.x-(p?p.x:l),n.xy.y-(p?p.y:k),n.size>>1,n.startAngle,n.endAngle,false);return j(r,
x)},prepImage:function(n,r,x,s){var A=(s.x||n.xy.x)-(p?p.x:l),C=(s.y||n.xy.y)-(p?p.y:k),D=s.image||n.image;if(D){d.beginPath();d.rect(A,C,s.width||D.width,s.height||D.height);return j(r,x,function(){d.drawImage(D,A,C,s.width||D.width,s.height||D.height)})}},prepMarker:function(n,r,x){var s=n.xy.x-(p?p.x:l),A=n.xy.y-(p?p.y:k),C=n.size,D=undefined;d.beginPath();switch(n.markerType.toLowerCase()){case "image":D=m;d.rect(s-(C>>1),A-(C>>1),C,C);if(n.reset&&n.image){n.image=null;n.reset=false}n.image?d.drawImage(n.image,
s-(C>>1),A-(C>>1),C,C):$a(n.imageUrl,function(H){n.image=H;d.drawImage(n.image,s-(C>>1),A-(C>>1),C,C)});break;default:d.moveTo(s,A);d.lineTo(s-(C>>1),A-C);d.lineTo(s+(C>>1),A-C);d.lineTo(s,A)}return j(r,x,D)},prepPoly:function(n,r,x,s){var A=true;n=s.points||n.points().cull(r);s=p?p.x:l;var C=p?p.y:k;d.beginPath();for(var D=n.length;D--;){var H=n[D].x-s,N=n[D].y-C;if(A){d.moveTo(H,N);A=false}else d.lineTo(H,N)}return j(r,x)},getContext:function(){return d}});(function(){Fb.each(function(n,r){h(null,
n,r)});F.bind("styleDefined",h)})();b.bind("detach",function(){c.removeChild(q)});b.bind("resize",function(){});return b});ea("renderer","dom",function(a,c,b,f,g){function h(d){var l=d.image=new Image;e[d.id]=d;l.src=d.url;l.onload=function(){if(q[d.id])i.appendChild(this);else d.image=null};l.style.cssText="-webkit-user-select: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute;";
return l}function j(d,l,k){var o=[],p;for(p in d){var E=d[p];if(k?E[k]:!l[p]){if(E.image&&E.image.parentNode){i.removeChild(E.image);E.image=null}o[o.length]=p}}for(l=o.length;l--;)delete d[o[l]]}var i=null,e={},q={};i=Z.create("div","",Z.styles({width:c.offsetWidth+"px",height:c.offsetHeight+"px"}));c.childNodes.length>0?c.insertBefore(i,c.childNodes[0]):c.appendChild(i);a.attachFrame(i);b=J(g,{drawTiles:function(d,l,k){for(var o,p=d.x,E=d.y,m=l.length;m--;){d=l[m];if(d.url){(o=d.image||(k?h(d):
null))&&Z.move(o,d.x-p,d.y-E);q[d.id]=d}}}});b.bind("predraw",function(){j(e,q);q={}});b.bind("detach",function(){c.removeChild(i)});a.bind("reset",function(){for(j(e,q={});i.childNodes.length>0;)i.removeChild(i.childNodes[0])});return b});var Fb=function(){function a(b,f){if(Q(b,pa)){F.trigger("styleDefined",b,c[b]=f);return b}else{var g=[],h;for(h in b)g[g.length]=a(h,b[h]);return g}}var c={};a({reset:{fill:"#ffffff",opacity:1},highlight:{fill:"#ff0000"},waypoints:{lineWidth:4,stroke:"#003377",
fill:"#ffffff"},waypointsHover:{lineWidth:4,stroke:"#ff0000",fill:"#ffffff"}});return{resetStyle:"reset",each:function(b){for(var f in c)b(f,c[f])},get:function(b){return c[b]},define:a}}();ea("view","view",function(a){function c(u,w,B,O){n(Da(V+Aa(2,O)-1,0.125),false,true)}function b(u,w){var B=W&&W.projectXY?W.projectXY(u,w):null;if(!B){B=z();var O=1/V;B=new P.XY(B?B.x+u*O:u,B?B.y+w*O:w)}return B.sync(P,true)}function f(u,w,B){r("doubleTap",w,B,b(B.x,B.y));a.scalable&&n(2,{easing:"quad.out",duration:300},
true)}function g(u,w,B){G=null;I=true;E("down",w,B)}function h(u,w,B){E("hover",w,B)}function j(u,w,B,O){k(w,B,false);if(!G){M=O.x;K=O.y}}function i(u,w,B){k(w,B,true);I=false}function e(){clearTimeout(Gb);Gb=setTimeout(function(){if(y)if(y.offsetWidth!==Na*2||y.offsetHeight!==Oa*2){var u=m();p(a.container);m(u.x,u.y)}},250)}function q(u,w,B){E("tap",w,B);P.trigger("tap",w,B,b(B.x,B.y,true))}function d(){ia&&ia.unbind();if(W){ia=INTERACT.watch(W.interactTarget||y);if(a.scalable){ia.bind("zoom",c);
ia.bind("doubleTap",f)}ia.bind("pointerDown",g);ia.bind("pointerMove",j);ia.bind("pointerUp",i);a.captureHover&&ia.bind("pointerHover",h);ia.bind("tap",q)}}function l(u){if(W){W.trigger("detach");W=null}var w=P,B=N,O=y,X=a;u=u.split("/");for(var $=new Yb(w,B,O,X),sa=0;sa<u.length;sa++)$=ya("renderer",u[sa],w,B,O,X,$);W=$;ha=W.fastpan&&Z.transforms;d();P.trigger("reset");v()}function k(u,w,B){if(G){u=b(w.x,w.y);G.drag.call(G.target,G,u.x,u.y,B)&&da++;if(B)G=null}}function o(u){for(var w=H;w--;)if(D[w].id===
u)return w;return H}function p(u){y=document.getElementById(u);y.appendChild(L=Z.create("div","",Z.styles({overflow:"hidden",width:y.offsetWidth+"px",height:y.offsetHeight+"px"})));u=a.padding;if(u===s){u=y.offsetWidth;var w=y.offsetHeight,B=mb(u*u+w*w);ja=new U(B-u>>1,B-w>>1)}else ja=new U(u,u);ab=L.offsetWidth+ja.x*2;bb=L.offsetHeight+ja.y*2;ob=ab/2;pb=bb/2;Na=y.offsetWidth/2;Oa=y.offsetHeight/2;Pa=new U(ob,pb);L.appendChild(N=Z.create("div","",Z.styles({width:ab+"px",height:bb+"px","z-index":2,
margin:-ja.y+"px 0 0 "+-ja.x+"px"})));l(a.renderer);u=a.controls;for(w=0;w<C.length;w++)C[w].trigger("detach");C=[];for(w=0;w<u.length;w++)C[C.length]=ya("control",u[w],P,L,y,a[u[w]])}function E(u,w,B){var O=(new U(B.x-Na+ob,B.y-Oa+pb)).rotate(-ta*ca,Pa).scale(1/V,Pa);fa=Hits.init(u,w,B,b(B.x,B.y,true),O);for(u=H;u--;)if(D[u].visible)Y=Y||(D[u].hitGuess?D[u].hitGuess(fa.gridX,fa.gridY,P):false);Y&&da++}function m(u,w,B){if(Q(u,pa)||Q(u,Vb)){w=new P.XY(u);w.sync(P);u=w.x;w=w.y}if(Q(u,ra)){x(u-Na-ja.x,
w-Oa-ja.y,B);return P}else return x().offset(Na+ja.x|0,Oa+ja.y|0).sync(P,true)}function z(){var u=new wa(S,T,ab,bb);u.scaleFactor=V;u.padding=ja?ja.copy():new U;return u}function t(u,w,B){if(Q(u,pa)&&Q(w,qa))for(w=0;w<H;w++){if(D[w].id===u)return D[w]}else if(Q(u,pa)){w=ya("layer",w,P,B);w.added=(new Date).getTime();w.id=u;D[o(u)]=w;D.sort(function(O,X){return X.zindex-O.zindex||X.added-O.added});H=D.length;P.trigger("resync");v();P.trigger("layerChange",P,w);da++;return w}else return[].concat(D)}
function v(){var u=z();if(u){if(Ha||Ia)if(u){var w=cb?S+(u.w>>1):S,B=db?T+(u.h>>1):T,O=u.w,X=u.h;if(Ha&&Ha>O)if(w+O>Ha)S=cb?S:Ha-O;else if(w<0)S=cb?S:0;if(Ia&&Ia>X)if(B+X>Ia)T=db?T:Ia-X;else if(B<0)T=db?T:0}Hb=S;Ib=T;P.trigger("refresh",P,u);da++}}function n(u,w,B){if(Q(u,ra)){var O=B?u:V*u;if(!Zb){w=null;u=La(Ba(O)/Math.LN2);O=Aa(2,u)}if(w)Qa=ua.tween([V],[O],w,function(){V=O;Qa=null;da++});else{V=O;da++}return P}else return V}function r(){for(var u=P.trigger.apply(null,arguments).cancel,w=D.length;w--;)u=
D[w].trigger.apply(null,arguments).cancel||u;return!u}function x(u,w,B){if(Q(u,ra)){if(B)za=ua.tween([S,T],[u,w],B,function(){za=null});else{S=u|0;T=w|0;da++}return P}else return(new P.XY(S,T)).sync(P,true)}a=J({container:"",captureHover:true,controls:[],drawOnScale:true,padding:128,inertia:true,refreshDistance:256,pannable:true,scalable:true,renderer:"canvas"},a);var s="auto",A=false,C=[],D=[],H=0,N=null,L=null,y,G=null,R=!Q(window.attachEvent,qa),Y=false,ha,I=false,M=0,K=0,ba=a.refreshDistance,
S=0,T=0,Ea=0,eb=0,Hb=0,Ib=0,Ha=null,Ia=null,cb=false,db=false,za=null,ja,fa=null,Ra=null,W,Gb=0,Pa=new U,ta=0,Sa=null,V=1,Qa=null,qb=1,ia=null,rb={index:0,draw:false},Zb=true,da=0,ab,bb,ob,pb,Na,Oa,P={XY:U,id:a.id,panSpeed:0,attachFrame:function(u,w){w&&N.appendChild(u)},center:m,detach:function(){W&&W.trigger("detach");ia&&ia.unbind();if(L){y.removeChild(L);N=L=null}},frozen:function(u){if(Q(u,qa))return A;else{A=u;return P}},layer:t,invalidate:function(){da++},pan:function(u,w,B){x(S+u,T+w,B)},
refresh:v,rotate:function(u,w,B){if(Q(u,ra)){var O=B?u:ta+u;if(w)Sa=ua.tween([ta],[O],w,function(){ta=O%360;Sa=null;da++});else{ta=O%360;da++}return P}else return ta},scale:n,triggerAll:r,setMaxOffset:function(u,w,B,O){Ha=u;Ia=w;cb=B;db=O},offset:x,viewport:z};xa(P);P.bind("resize",e);P.bind("layerRemove",function(u,w){var B=jb(D,w.id);if(B>=0&&B<H){D.splice(B,1);da++}H=D.length});zb(P,a,{container:p,captureHover:d,scalable:d,pannable:d,renderer:l});t("markers","draw",{zindex:20});p(a.container);
R?window.attachEvent("onresize",e):window.addEventListener("resize",e,false);Ga.attach(function(u){var w=[],B,O,X;if(!A){self.panSpeed=panSpeed=oa(M)+oa(K);B=V!==qb;if(panSpeed>0||B||za||Qa||Sa){da++;if(za&&panSpeed>0){za(true);za=null}}if(panSpeed<2&&(oa(S-Hb)>=ba||oa(T-Ib)>=ba))v();rb.index++;rb.draw=da||panSpeed||0;if(W&&rb.draw){if(Qa)V=Qa()[0];if(Sa)ta=Sa()[0];Ea+=M;eb+=K;if(M||K)P.trigger("pan");if(Z.transforms){if(V!==1)w[w.length]="scale("+V+")";if(ta!==0)w[w.length]="rotate("+ta+"deg)"}if(B=
!ha||(a.drawOnScale||V===1)&&panSpeed<5){if(za){B=za();S=B[0]|0;T=B[1]|0}else{S=S-Ea/V|0;T=T-eb/V|0}X=z();W.trigger("predraw",X);if(W.prepare(D,X,u,fa)){O=eb=B=Ea=da=0;for(ii=H;ii--;){var $=D[ii];if($.visible){var sa=$.style?W.applyStyle($.style,true):null;$.draw(W,X,P,u,fa);sa&&W.applyStyle(sa)}}W.trigger("render",X);P.trigger("drawComplete",X,u);Z.move(N,B,O,w,Pa)}}else Z.move(N,Ea,eb,w,Pa);if(I||!a.inertia)K=M=0;else if(M!=0||K!=0){M*=0.8;K*=0.8;if(oa(M)<0.5)M=0;if(oa(K)<0.5)K=0}if(fa){u=true;
w=fa?fa.elements:[];if(Ra&&Ra.type==="hover"){diffElements=Hits.diffHits(Ra.elements,w);if(diffElements.length>0)Hits.triggerEvent(Ra,P,"Out",diffElements);else u=false}if(w.length>0){O=fa.gridX;X=fa.gridY;for(B=w.length;B--;){$=w[B];sa=O;var Jb=X,Kb=$&&$.drag&&(!$.canDrag||$.canDrag($,sa,Jb));if(Kb){G=$;G.startX=sa;G.startY=Jb}if(Kb)break}u&&Hits.triggerEvent(fa,P)}Ra=w.length>0?J({},fa):null;fa=null}if(qb!==V){P.trigger("scaleChanged",V);qb=V}}}});return P});ea("view","map",function(a){function c(e,
q){var d=i.viewport();if(e){d=Da(e.bestZoomLevel(d),q||0);return b(d).center(e.center())}else return new Ka((new va(d.x,d.y2)).sync(i,true).pos(),(new va(d.x2,d.y)).sync(i,true).pos())}function b(e,q,d){if(Q(e,ra)){e=Da(a.minZoom,Ma(a.maxZoom,e|0));if(e!==h){var l=i.viewport(),k=i.offset(),o=l.w/2;l=l.h/2;var p=Aa(2,e-h),E=o/p|0,m=l/p|0;h=e;i.offset(((q||k.x+o)-E)*p,((d||k.y+l)-m)*p);refreshY=refreshX=0;i.trigger("zoom",e);i.trigger("reset");g=i.rpp=aa/(256<<h);i.setMaxOffset(aa/g|0,aa/g|0,true,false);
i.scale(1,false,true);i.trigger("resync");i.refresh()}return i}else return h}a=J({controls:["zoombar"],minZoom:1,maxZoom:18,renderer:"canvas/dom",zoom:1,zoombar:{}},a);var f=new va,g,h=a.zoom||a.zoomLevel,j=0,i=J(ya("view","view",a),{XY:va,bounds:c,zoom:b});i.bind("refresh",function(){var e=i.viewport();if(f.x!=e.x||f.y!=e.y){i.trigger("boundsChange",c());f.x=e.x;f.y=e.y}});i.bind("scaleChanged",function(e,q){var d=Ba(q)/Math.LN2|0;if(d!==0){q=Aa(2,d);clearTimeout(j);j=setTimeout(function(){b(h+d)},
500)}});return i});var ua=function(){return{tween:function(a,c,b,f,g){function h(p){var E=p-o;p=o+k<=p;for(var m=j;m--;){i[m]=q(E,a[m],d[m],k);g&&g.invalidate()}if(p||l){Ga.detach(h);for(m=0;m<e.length;m++)e[m]&&e[m](i,E,l)}}b=J({easing:"sine.out",duration:1E3,complete:null},b);var j=a.length,i=[].concat(a),e=[f,b.complete],q=Pb(b.easing),d=[],l=false,k=b.duration,o=(new Date).getTime();for(b=j;b--;)d[b]=c[b]-a[b];Ga.attach(h);return function(p){l=p;return i}},tweenDrawable:function(a,c,b,f,g){var h=
ua.tween([b],[f],g,function(){a[c]=f;for(var i=a.tweens.length;i--;)if(a.tweens[i]===j){a.tweens.splice(i,1);break}},a.view),j=function(){a[c]=h()[0]};return j}}}(),Ca=function(a,c,b){b=J({style:null,xy:null,size:20,fill:false,stroke:true,draggable:false,observable:true,properties:{},typeName:"Shape",zindex:0},b);J(this,b);if(Q(this.xy,pa))this.xy=new a.XY(this.xy);this.id="drawable_"+Xb++;this.bounds=null;this.view=a;this.layer=c;this.tweens=[];this.rotation=this.animations=0;this.scaling=1;this.translateY=
this.translateX=0;this.observable&&xa(this)};Ca.prototype={constructor:Ca,applyTweens:function(){for(var a=this.tweens.length;a--;)this.tweens[a]()},drag:null,draw:null,getProps:null,resync:function(){if(this.xy){this.xy.sync(this.view);if(this.size){var a=this.size>>1;this.updateBounds(new wa(this.xy.x-a,this.xy.y-a,this.size,this.size))}}},rotate:function(a,c,b){if(Q(a,ra)){a=(b?a:this.rotation*na+a)*ca;if(c)this.tweens.push(ua.tweenDrawable(this,"rotation",this.rotation,a,c));else{this.rotation=
a;this.view.invalidate()}return this}else return this.rotation*na},scale:function(a,c,b){if(Q(a,ra)){a=b?a:this.scaling*a;if(c)this.tweens.push(ua.tweenDrawable(this,"scaling",this.scaling,a,c));else{this.scaling=a;this.view.invalidate()}return this}else return this.scaling},translate:function(a,c,b,f){if(Q(a,ra)){a=f?a:this.translateX+a;c=f?c:this.translateY+c;if(b){this.tweens.push(ua.tweenDrawable(this,"translateX",this.translateX,a,b));this.tweens.push(ua.tweenDrawable(this,"translateY",this.translateY,
c,b))}else{this.translateX=a;this.translateY=c;this.view.invalidate()}return this}else return new U(this.translateX,this.translateY)},updateBounds:function(a,c){a&&(!this.bounds||a.x!=this.bounds.x||a.y!=this.bounds.y)&&this.trigger("move",this,a,this.bounds);this.bounds=a;if(c)this.xy=this.bounds.center()}};ea("drawable","marker",function(a,c,b){b=J({fill:true,stroke:false,markerType:"simple",hoverStyle:"highlight",typeName:"Marker"},b);return new Ca(a,c,b)});ea("drawable","poly",function(a,c,b){function f(){var d,
l,k,o,p,E,m;e=b.simplify?i.simplify():i;for(d=e.length;d--;){l=e[d].x;k=e[d].y;E=Q(E,qa)||l<E?l:E;m=Q(m,qa)||k<m?k:m;o=Q(o,qa)||l>o?l:o;p=Q(p,qa)||k>p?k:p}q.updateBounds(new wa(E,m,o-E,p-m),true);a.invalidate()}function g(d){if(Q(d,xb)){i=new Ja(b.allowCull);Eb.process(d,function(l,k){for(var o=0;o<k;o++)i.push(new a.XY(l[o]))},h,j);return q}else return e}function h(){i.length&&Eb.process(i,function(d,l){for(var k=l;k--;)d[k].sync(a)},f,j)}b=J({allowCull:false,simplify:false,fill:true,points:[],typeName:"Poly"},
b);var j=500,i=new Ja(b.allowCull),e,q=J(new Ca(a,c,b),{points:g,resync:h});g(b.points);return q});ea("drawable","line",function(a,c,b){b.fill=false;b.allowCull=true;return ya("drawable","poly",a,c,b)});ea("drawable","image",function(a,c,b){function f(){if(e&&e.width>0){if(!this.centerOffset)this.centerOffset=new U(-e.width>>1,-e.height>>1);this.updateBounds(new wa(this.xy.x+this.centerOffset.x,this.xy.y+this.centerOffset.y,e.width,e.height),false)}}function g(d){if(this.imageUrl=d){var l=this;$a(this.imageUrl,
function(k,o){e=k;if(o){var p=q.layer?q.layer.view:null;p&&p.invalidate()}f.apply(l)})}}b=J({image:null,imageUrl:null,centerOffset:null,typeName:"Image"},b);var h=Ca.prototype.resync,j=0,i=0,e=b.image,q=J(new Ca(a,c,b),{changeImage:g,getProps:function(){this.bounds||f(this,e);return{image:e,x:this.xy.x+j,y:this.xy.y+i}},resync:function(d){h.call(this,d);f.call(this)}});e||g.call(this,this.imageUrl);if(this.centerOffset){j=this.centerOffset.x;i=this.centerOffset.y}});ea("drawable","arc",function(a,
c,b){b=J({startAngle:0,endAngle:Math.PI*2,typeName:"Arc"},b);return new Ca(a,c,b)});Va.prototype={constructor:Va,clip:null,cycle:function(){},draw:function(){},hitGuess:null,remove:function(){this.view.trigger("layerRemove",this)}};ea("layer","tile",function(a,c){c=J({generator:"osm",imageLoadArgs:{}},c);var b=ya("generator",c.generator,c).run,f=null,g=[],h=J(new Va(a,c),{draw:function(j,i,e){j.drawTiles&&j.drawTiles(i,f.search(i.buffer(128)),e.panSpeed<2)}});a.bind("resync",function(){var j=a&&a.zoom?
a.zoom():0;g[j]||(g[j]=vb(j));f=g[j]});a.bind("refresh",function(j,i,e){f&&b(i,e,f,function(){i.invalidate()})});return h});ea("layer","draw",function(a,c){function b(i,e,q,d){var l=this.dragOffset;if(!l)l=this.dragOffset=new a.XY(i.startX-this.xy.x,i.startY-this.xy.y);this.xy.x=e-l.x;this.xy.y=q-l.y;if(d){delete this.dragOffset;a.invalidate();this.xy.sync(a,true);this.trigger("dragDrop")}return true}function f(i,e,q,d){d&&h.remove(d,e);h.insert(q,e)}c=J({zindex:10},c);var g=[],h,j=J(new Va(a,c),
{itemCount:0,clear:function(){h=new wb;g=[];j.trigger("cleared");j.itemCount=0;a.invalidate()},create:function(i,e,q){e=ya("drawable",i,a,j,e);if(q)g.unshift(e);else g[g.length]=e;e.resync();h&&e.bounds&&h.insert(e.bounds,e);e.bind("move",f);j.itemCount=g.length;j.trigger(i+"Added",e);return e},draw:function(i,e,q,d,l){q={};d=h&&e?h.search(e):[];for(var k=d.length;k--;){var o=d[k],p=o.style||j.style,E,m,z=o.getProps?o.getProps(i):q;E=i["prep"+o.typeName];o.tweens.length>0&&o.applyTweens();m=i.applyTransform(o);
if(z=E?E.call(i,o,e,l,z):null){if(l&&z.hit){l.elements.push(Hits.initHit(o.type,o,o.draggable?b:null));E=l.type+"Style";p=o[E]||j[E]||p}p=p?i.applyStyle(p,true):null;(E=o.draw||z.draw)&&E.call(o,z);p&&i.applyStyle(p)}m&&m.undo&&m.undo()}},find:function(){return[].concat(g)},hitGuess:function(i,e){return h&&h.search({x:i-10,y:e-10,w:20,h:20}).length>0}});a.bind("resync",function(){h=vb(a.zoom(),h);for(var i=g.length;i--;)g[i].resync()});return j});Wa.prototype={constructor:Wa};ea("control","zoombar",
function(a,c,b,f){function g(s,A){var C=v[s]=Z.create("div","t5-zoombar-button",{position:"absolute",background:h(s),"z-index":51,width:f.width+"px",height:f.buttonHeight+"px","margin-top":(A||0)+"px"});n.appendChild(C)}function h(s,A){return"url("+f.images+") 0 -"+(l+o*3+(s||0)*q*3+(A||0)*q)+"px"}function j(s){return"url("+f.images+") 0 -"+(l+(s||0)*o)+"px"}function i(s,A){var C;if(s===k){k.style.background=j(A);C="thumb"}else for(var D=0;D<v.length;D++)if(s===v[D]){C="button"+D;v[D].style.background=
h(D,A);break}return C}function e(s){if(s!==z){z=s;m=E-z/t*(E-p)|0;Z.move(k,0,m-p);clearTimeout(r);r=setTimeout(function(){a.zoom(z)},500)}}f=J({width:24,height:200,images:"img/zoom.png",align:"right",marginTop:10,spacing:10,thumbHeight:16,buttonHeight:16},f);var q=f.buttonHeight,d,l=f.height,k,o=f.thumbHeight,p=f.spacing+q-(o>>1),E=f.height-q-(o>>1),m=p,z=-1;c=a.minZoom();var t=a.maxZoom()-c+1,v=[],n,r=0,x={button0:function(){a.zoom(a.zoom()+1)},button1:function(){a.zoom(a.zoom()-1)}};n=Z.create("div",
"t5-zoombar",{position:"absolute",background:"url("+f.images+")","z-index":50,overflow:"hidden",width:f.width+"px",height:f.height+"px",margin:function(){var s=f.spacing,A=la("{0}px 0 0 {1}px");if(f.align==="right")s=b.offsetWidth-f.width-f.spacing;return A(f.marginTop,s)}()});b.childNodes[0]?b.insertBefore(n,b.childNodes[0]):b.appendChild(n);n.appendChild(k=Z.create("div","t5-zoombar-thumb",{position:"absolute",background:j(),"z-index":51,width:f.width+"px",height:f.thumbHeight+"px",margin:"10px 0 0 0",
top:m-p+"px"}));g(0);g(1,f.height-f.buttonHeight);d=INTERACT.watch(n,{bindTarget:n});d.bind("pointerMove",function(s,A,C){m=Math.min(Math.max(p,C.y-(o>>1)),E);e(t-(m-p)/E*t|0)});d.bind("pointerDown",function(s){i(s.target,2)});d.bind("pointerUp",function(s){i(s.target,0)});d.bind("tap",function(s){(s=x[i(s.target,2)])&&s()});c=new Wa(a);c.bind("detach",function(){d.unbind();b.removeChild(n)});a.bind("zoom",function(s,A){e(A)});e(a.zoom());return c});ka.prototype={constructor:ka,distanceTo:function(){if(!targetPos||
this.empty()||targetPos.empty())return 0;var a=(targetPos.lat-this.lat)*ca>>1,c=(targetPos.lon-this.lon)*ca>>1;a=ma(a)*ma(a)+Fa(this.lat*ca)*Fa(targetPos.lat*ca)*ma(c)*ma(c);return 6371*2*Ub(mb(a),mb(1-a))},equalTo:function(a){return pos&&this.lat===a.lat&&this.lon===a.lon},empty:function(){return this.lat===0&&this.lon===0},inArray:function(a){for(var c=a.length;c--;)if(this.equal(a[c]))return true;return false},offset:function(a,c){var b=this.lat*ca,f=this.lon*ca,g=b+a/6371;b=Db(ma(c/6371)/Fa(b));
f=f+b;g=(g+Ua)%Math.PI-Ua;f%=aa;return new ka(g*na,f*na)},toPixels:function(){return Za(this.lon,this.lat)},toBounds:function(a){var c=a.radians(),b=this.lat*ca,f=this.lon*ca;a=b-c;var g=b+c;if(a>Ab&&g<lb){b=Db(ma(c)/Fa(b));c=f-b;if(c<Tb)c+=aa;f=f+b;if(f>Bb)f-=aa}else{a=Da(a,Ab);g=Ma(g,lb);c=yb;f=Xa}return new Ka(new ka(a*na,c*na),new ka(g*na,f*na))},toString:function(a){return this.lat+(a||" ")+this.lon}};(function(){ea("fn","generalize",function(a,c,b){var f=a.length,g=[],h=null;b=(b||250)/1E3;
for(f=f;f--;)if(f===0)g.unshift(a[f]);else{var j=!h||a[f].inArray(c)?b:h.distanceTo(a[f]);if(a[f]&&j>=b){g.unshift(a[f]);h=a[f]}}return g})})();Ka.prototype={constructor:Ka,bestZoomLevel:function(a){var c=this.center();c=Ma(La(oa(c.lat)*0.05),kb.length);var b=kb[c],f=this.size();c=Cb(Ba(kb[3]*a.h/f.y)/Ba(2));a=Cb(Ba(b*a.w/f.x)/Ba(2));return Ma(isNaN(c)?1E3:c,isNaN(a)?1E3:a)},center:function(){var a=this.size();return new ka(this.min.lat+(a.y>>1),this.min.lon+(a.x>>1))},expand:function(a){this.min.lat-=
a;this.max.lat+=a;this.min.lon-=a%360;this.max.lon+=a%360},size:function(a){var c=new U(0,this.max.lat-this.min.lat);c.x=(a||Q(a,qa))&&this.min.lon>this.max.lon?360-this.min.lon+this.max.lon:this.max.lon-this.min.lon;return c},toString:function(){return"min: "+this.min+", max: "+this.max}};ib.prototype={add:function(){for(var a=this.meters,c=arguments.length;c--;)a+=arguments[c].meters;return new ib(a)},radians:function(a){if(Q(a,ra)){this.meters=a*6371E3;return this}else return this.meters/6371E3},
toString:function(){if(this.meters>1E3)return(this.meters/10|0)/100+"km";return this.meters+"m"}};J(F,{ex:J,log:ga,observable:xa,configurable:zb,formatter:la,wordExists:function(a,c){for(var b=a.split(/\s|\,/).length;b--;)if(a.toLowerCase()==c.toLowerCase())return true;return false},is:Q,indexOf:jb,fn:function(a){return Wb("fn",a)},project:Za,unproject:nb,getImage:$a,userMessage:function(a,c,b){F.trigger("userMessage",a,c,b)},Registry:Ya,Style:Fb,DOM:Z,Rect:wa,XY:U,Line:Ja,Pos:ka,BBox:Ka,Distance:ib,
Hits:Hits,Control:Wa,Tile:gb,Tweener:ua});F.RouteTools=function(){function a(d){if(h.test(d))return"-slight";return""}function c(d,l){l.geometry&&d.layer("route","draw").create("line",{points:l.geometry,style:"waypoints",simplify:true})}function b(d){for(var l="unknown",k=f||e,o=0;o<k.length;o++){k[o].regex.lastIndex=-1;var p=k[o].regex.exec(d);if(p){l=k[o].customCheck?k[o].customCheck(d,p):k[o].turnType;break}}return l}var f=undefined,g=F.fn("generalize"),h=/bear/i,j=/right/i,i={unknown:"0:0",start:"1:0",
"continue":"1:1",arrive:"1:2",left:"2:0","left-slight":"2:1","left-sharp":"2:2",right:"3:0","right-slight":"3:1","right-sharp":"3:2","uturn-left":"4:0","uturn-right":"4:1",merge:"4:2",roundabout:"5:0",ramp:"6:0","ramp-exit":"6:1"},e=function(){var d=[];d.push({regex:/continue/i,turnType:"continue"});d.push({regex:/(take|bear|turn)(.*?)left/i,customCheck:function(l,k){return"left"+a(k[1])}});d.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(l,k){return"right"+a(k[1])}});d.push({regex:/enter\s(roundabout|rotary)/i,
turnType:"roundabout"});d.push({regex:/take.*?ramp/i,turnType:"ramp"});d.push({regex:/take.*?exit/i,turnType:"ramp-exit"});d.push({regex:/make(.*?)u\-turn/i,customCheck:function(l,k){return"uturn"+(j.test(k[1])?"-right":"-left")}});d.push({regex:/proceed/i,turnType:"start"});d.push({regex:/arrive/i,turnType:"arrive"});d.push({regex:/fell\sthrough/i,turnType:"merge"});return d}(),q={calculate:function(d){d=J({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},
d);var l=F.Registry.create("service","routing");l&&l.calculate(d,function(k){if(d.generalize)k.geometry=g(k.geometry,k.getInstructionPositions());if(d.map){c(d.map,k);d.autoFit&&d.map.bounds(k.boundingBox)}d.success&&d.success(k)})},createMapOverlay:c,getSpriteOffset:function(d,l){var k=i[d];if(k=k?k.split(":"):null)return{x:-k[0]*(l||16),y:-k[1]*(l||16)};return null},parseTurnType:b,Instruction:function(d){var l=d=J({position:null,description:"",distance:0,distanceTotal:0,time:0,timeTotal:0,turnType:null},
d),k=d.description;k=k.replace(/(\w)(\/)(\w)/g,"$1 $2 $3");l.description=k;if(!d.turnType)d.turnType=b(d.description);return d},RouteData:function(d){d=J({geometry:[],instructions:[],boundingBox:null},d);if(!d.boundingBox)d.boundingBox=new F.BBox(d.geometry);return J({getInstructionPositions:function(){for(var l=[],k=0;k<d.instructions.length;k++)d.instructions[k].position&&l.push(d.instructions[k].position);return l}},d)}};F.observable(q);return q}();F.Decarta=function(){function a(m){return e(h.clientName,
h.clientPassword,h.sessionID,h.configuration,h.release,m)}function c(m,z){return q(m.maxResponses,m.version,m.requestID,m.methodName,z)}function b(m,z){h.server||ga("No server configured for deCarta - we are going to have issues","warn");return d(h.server,m.requestID,escape(z))}function f(m,z){Qb(b(m,a(c(m,m.getRequestBody()))),function(t){var v=t.response.XLS.Response;if(v.numberOfResponses>0&&v[m.methodName+"Response"]){t=null;if(m.parseResponse)t=m.parseResponse(v[m.methodName+"Response"]);z&&
z(t)}else ga("no responses from server: "+t.response,"error")})}function g(m,z){var t=new o({json:m.StreetAddress}),v=new k({countryCode:m.countryCode});v.parse(m.Place);return new F.Addressing.Address({streetDetails:t,location:v,country:m.countryCode?m.countryCode:"",postalCode:m.PostalCode?m.PostalCode:"",pos:z})}var h={sessionID:(new Date).getTime(),server:"",clientName:"",clientPassword:"",configuration:"",maxResponses:25,release:"4.4.2sp03",tileFormat:"PNG",fixedGrid:true,useCache:true,tileHosts:[],
requestTimeout:3E4,geocoding:{countryCode:"US",language:"EN"}};TL=function(){function m(t,v){this.days=t||0;this.seconds=v||0}m.prototype={add:function(){for(var t=new m(this.days,this.seconds),v=arguments.length;v--;){t.days+=arguments[v].days;t.seconds+=arguments[v].seconds}return t},toString:function(){var t,v,n,r="";if(this.days)r=this.days+" days ";if(this.seconds){n=this.seconds;if(n>=3600){t=~~(n/3600);n-=t*3600}if(n>=60){v=Math.round(n/60);n-=v*60}if(t)r=r+t+(t>1?" hrs ":" hr ")+(v?(v>10?
v:"0"+v)+" min ":"");else if(v)r=r+v+" min";else if(n>0)r=r+(n>10?n:"0"+n)+" sec"}return r}};var z=function(){var t=/^P(\d+Y)?(\d+M)?(\d+D)?$/,v=/^(\d+H)?(\d+M)?(\d+S)?$/,n={8601:function(r){r=r.split("T");var x=null;x=null;var s=0,A=0;t.lastIndex=-1;x=t.exec(r[0]);s+=x[3]?parseInt(x[3].slice(0,-1),10):0;v.lastIndex=-1;x=v.exec(r[1]);A+=x[1]?parseInt(x[1].slice(0,-1),10)*3600:0;A+=x[2]?parseInt(x[2].slice(0,-1),10)*60:0;A+=x[3]?parseInt(x[3].slice(0,-1),10):0;return new m(s,A)}};return function(r,
x){var s=n[x];if(!s)throw"No parser found for the duration format: "+x;return s(r)}}();return{Duration:m,parse:z}}();var j={DEFAULT:function(m){for(var z=["landmark","municipalitySubdivision","municipality","countrySubdivision"],t="",v=0;v<z.length;v++)if(m[z[v]])t+=m[z[v]]+" ";return t}},i=1,e=la("<xls:XLS version='1' xls:lang='en' xmlns:xls='http://www.opengis.net/xls' rel='{4}' xmlns:gml='http://www.opengis.net/gml'><xls:RequestHeader clientName='{0}' clientPassword='{1}' sessionID='{2}' configuration='{3}' />{5}</xls:XLS>"),
q=la("<xls:Request maximumResponses='{0}' version='{1}' requestID='{2}' methodName='{3}Request'>{4}</xls:Request>"),d=la("{0}/JSON?reqID={1}&chunkNo=1&numChunks=1&data={2}&responseFormat=JSON"),l=function(m){m=F.ex({countryCode:h.geocoding.countryCode,language:h.geocoding.language,freeform:null,streetAddress:{building:null}},m);var z=la('<xls:Address countryCode="{0}" language="{1}">');return{getXML:function(){var t=z(m.countryCode,m.language);if(m.freeform){var v=String(m.freeform).replace(/(\'|\")/,
"\\$1");t+="<xls:freeFormAddress>"+v+"</xls:freeFormAddress>"}return t+"</xls:Address>"}}},k=function(m){m=F.ex({landmark:"",municipality:"",municipalitySubdivision:"",countrySubdivision:"",countryCode:""},m);var z=F.ex({calcMatchPercentage:function(t){var v=0;if(m.landmark&&m.landmarkSubType){if(F.wordExists(t,m.landmarkSubType)){v+=0.4;v+=F.wordExists(t,m.landmark)?0.6:0}}else{v+=F.wordExists(t,m.municipalitySubdivision)?0.8:0;if(v===0&&m.municipality)v+=F.wordExists(t,m.municipality)?0.7:0}if(m.countrySubdivision)v+=
F.wordExists(t,m.countrySubdivision)?0.2:0;return v},getCountryCode:function(){if(m.countryCode)return m.countryCode.toUpperCase();return""},parse:function(t){for(var v=0;t&&v<t.length;v++){var n=t[v].type?t[v].type.slice(0,1).toLowerCase()+t[v].type.slice(1):"";if(typeof m[n]!=="undefined"){m[n]=t[v].content;if(t[v].subType)m[n+"SubType"]=t[v].subType}}F.ex(z,m)},toString:function(){var t=j[z.getCountryCode()];if(!t)t=j.DEFAULT;return t(m)}},m);return z},o=function(m){m=F.ex({json:{}},m);var z="",
t="";if(m.json.Street)z=m.json.Street.content?m.json.Street.content:m.json.Street;z=z&&z.replace?z.replace(/\/\d+$/,""):"";if(m.json.Building)if(m.json.Building.number)t=m.json.Building.number;return{building:t,street:z,calcMatchPercentage:function(v){var n=0,r=F.Addressing.normalize(v),x=F.Addressing.normalize(z);if(m.json.Building)if(F.Addressing.buildingMatch(v,m.json.Building.number.toString()))n+=0.2;if(r&&x&&F.wordExists(r,x))n+=0.8;return n},toString:function(){if(z)return(t?t+" ":"")+z;return""}}},
p=function(){return{methodName:"",maxResponses:25,version:"1.0",requestID:i++,getRequestBody:function(){return""},parseResponse:function(m){return m}}},E=function(){return F.ex(new p,{methodName:"RUOK",parseResponse:function(m){return{aliasCount:m.maxHostAliases,host:m.hostName}}})};F.Registry.register("generator","decarta",function(m){function z(n,r,x,s){if(n=n.zoom?n.zoom():0){var A=2<<n-1,C=A>>1,D=m.tileSize,H=(r.w/D|0)+1,N=(r.h/D|0)+1,L=(r.x/D|0)-C;r=A-(r.y/D|0)-C-N;var y=x.search({x:(C+L)*D,
y:(C+r*-1-N)*D,w:H*D,h:N*D});A={};var G;for(G=y.length;G--;)A[y[G].id]=true;for(y=0;y<=H;y++)for(G=0;G<=N;G++){var R=L+y,Y=r+G-1,ha=R+"_"+Y;if(!A[ha]){R=new F.Tile((C+L+y)*D,(C+r*-1-G)*D,v[y%v.length]+"/openls/image-cache/TILE?LLMIN=0.0,0.0&LLMAX="+t[n]+"&CACHEABLE=true&DS=navteq-world&WIDTH=256&HEIGHT=256&CLIENTNAME="+h.clientName+"&SESSIONID="+h.sessionID+"&FORMAT=PNG&CONFIG="+h.configuration+"&N="+Y+"&E="+R,D,D,ha);x.insert(R,R)}}s&&s()}}m=F.ex({tileSize:256},m);var t=["89.787438015348100000,360.00000000000000000",
"85.084059050110410000,180.00000000000000000","66.653475896509040000,90.00000000000000000","41.170427238429790000,45.000000000000000000","22.076741328793200000,22.500000000000000000","11.251819676168665000,11.250000000000000000","5.653589942659626000,5.625000000000000000","2.830287664051185000,2.812500000000000000","1.415581451872543800,1.406250000000000000","0.707845460801532700,0.703125000000000000","0.353929573271679340,0.351562500000000000","0.176965641673330230,0.175781250000000000","0.088482927761462040,0.087890625000000000",
"0.044241477246363230,0.043945312500000000","0.022120740293895182,0.021972656250000000","0.011060370355776452,0.010986328125000000","0.005530185203987857,0.005493164062500000","0.002765092605263539,0.002746582031250000","0.001382546303032519,0.001373291015625000","0.000691272945568983,0.000686645507812500","0.000345636472797214,0.000343322753906250"],v=null;F.userMessage("ack","decarta","&copy; deCarta, Inc. Map and Imagery Data &copy; NAVTEQ or Tele Atlas or DigitalGlobe");return{run:function(n,
r,x,s){v?z(n,r,x,s):f(new E,function(A){v=[];if(A.aliasCount)for(var C=0;C<A.aliasCount;C++)v[C]="http://"+A.host.replace("^(.*?).(.*)$","\u0001-0"+(C+1)+".\u0002");else v=["http://"+A.host];z(n,r,x,s)})}}});F.Registry.register("service","geocoder",function(){var m=function(t){function v(x){var s=[],A=x?x.numberOfGeocodedAddresses:0,C=[];if(A>1)C=x.GeocodedAddress;else if(A==1)C=[x.GeocodedAddress];try{for(x=0;C&&x<C.length;x++){var D,H=C[x],N=A=null;if(H&&H.GeocodeMatchCode&&H.GeocodeMatchCode.matchType!==
"NO_MATCH"){if(H&&H.Point)N=new F.Pos(H.Point.pos);if(H&&H.Address)A=g(H.Address,N)}(D=A)&&s.push(D)}}catch(L){ga(L,"error")}return s}t=F.ex({addresses:[],parserReport:false,parseOnly:false,returnSpatialKeys:false},t);var n=la('<xls:GeocodeRequest parserReport="{0}" parseOnly="{1}" returnSpatialKeys="{2}">'),r=new p;return F.ex({},r,{methodName:"Geocode",getRequestBody:function(){for(var x=n(t.parserReport,t.parseOnly,t.returnSpatialKeys),s=0;s<t.addresses.length;s++)x+=t.addresses[s].getXML();return x+
"</xls:GeocodeRequest>"},parseResponse:function(x){if(t.addresses.length===1)return[v(x.GeocodeResponseList)];else{for(var s=[],A=0;A<t.addresses.length;A++)s.push(v(x.GeocodeResponseList[A]));return s}}})},z=function(t){t=F.ex({position:null,geocodePreference:"StreetAddress"},t);return F.ex(new p,{methodName:"ReverseGeocode",getRequestBody:function(){return"<xls:ReverseGeocodeRequest><xls:Position><gml:Point><gml:pos>"+t.position.toString()+"</gml:pos></gml:Point></xls:Position><xls:ReverseGeocodePreference>"+
t.geocodePreference+"</xls:ReverseGeocodePreference></xls:ReverseGeocodeRequest>"},parseResponse:function(v){var n=null;if(v&&v.Point)n=new F.Pos(match.Point.pos);if(v&&v.ReverseGeocodedLocation&&v.ReverseGeocodedLocation.Address)return g(v.ReverseGeocodedLocation.Address,n);return null}})};return{forward:function(t,v){var n,r=[];F.is(t,"object")?F.log("attempting to geocode a simple object - not implemented","warn"):r.push(new l({freeform:t}));if(r.length>0){r=new m({addresses:r});f(r,function(x){for(n=
0;v&&n<x.length;n++)v(t,x[n])})}},reverse:function(t,v){var n=new z({position:t});f(n,function(r){v&&v(r)})}}});F.Registry.register("service","routing",function(){var m=function(z){z=F.ex({waypoints:[],provideRouteHandle:false,distanceUnit:"KM",routeQueryType:"RMAN",routePreference:"Fastest",routeInstructions:true,routeGeometry:true},z);var t=new p,v=F.formatter('<xls:DetermineRouteRequest provideRouteHandle="{0}" distanceUnit="{1}" routeQueryType="{2}">'),n=F.formatter("<xls:{0}><xls:Position><gml:Point><gml:pos>{1}</gml:pos></gml:Point></xls:Position></xls:{0}>");
return F.ex({},t,{methodName:"DetermineRoute",getRequestBody:function(){if(z.waypoints.length<2)throw Error("Cannot send RouteRequest, less than 2 waypoints specified");var r=v(z.provideRouteHandle,z.distanceUnit,z.routeQueryType);r+="<xls:RoutePlan>";r+="<xls:RoutePreference>"+z.routePreference+"</xls:RoutePreference>";r+="<xls:WayPointList>";for(var x=0;x<z.waypoints.length;x++)r+=n(x===0?"StartPoint":x===z.waypoints.length-1?"EndPoint":"ViaPoint",z.waypoints[x].toString());r+="</xls:WayPointList>";
r+="</xls:RoutePlan>";if(z.routeInstructions)r+='<xls:RouteInstructionsRequest rules="maneuver-rules" providePoint="true" />';if(z.routeGeometry)r+="<xls:RouteGeometryRequest />";r+="</xls:DetermineRouteRequest>";return r},parseResponse:function(r){var x=F.RouteTools.RouteData,s=r.RouteGeometry.LineString.pos,A=s.length,C=Array(A);for(A=A;A--;)C[A]=new ka(s[A]);s=r.RouteInstructionsList;r=[];s=s&&s.RouteInstruction?s.RouteInstruction:[];A=new F.Distance;for(var D=new TL.Duration,H=0;H<s.length;H++){var N=
F.Distance,L=s[H].distance,y={M:1,KM:1E3}[L.uom?L.uom.toUpperCase():"M"];N=new N(L.value&&y?L.value*y:0);L=TL.parse(s[H].duration,"8601");A=A.add(N);D=D.add(L);r.push(new F.RouteTools.Instruction({position:new F.Pos(s[H].Point),description:s[H].Instruction,distance:N,distanceTotal:A,time:L,timeTotal:D}))}return new x({geometry:C,instructions:r})}})};return{calculate:function(z,t){z=F.ex({waypoints:[]},z);if(typeof F.RouteTools!=="undefined"){var v=new m(z);f(v,function(n){t&&t(n)})}else ga("Could not generate route, T5.RouteTools plugin not found",
"warn")}}});return{applyConfig:function(m){F.ex(h,m)},compareFns:function(){return{streetDetails:function(m,z){return z.calcMatchPercentage(m)},location:function(m,z){return z.calcMatchPercentage(m)}}}()}}();sb.T5=F;sb.Tile5=function(a,c){c=J({container:a,type:"map",renderer:"canvas",starpos:null,zoom:1,fastpan:false,drawOnScale:true,zoombar:{}},c);return ya("view",c.type,c)}})(window);
