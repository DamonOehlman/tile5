(function(){function Q(n){n=n.split(",");for(var x=[],y=0;y<n.length;y++){var A=n[y].trim().replace(".","/");x[y]=oa[A]}return x}function La(n,x){for(var y=n.split(","),A=true,K=typeof $LAB!=="undefined"?$LAB:null,Y=0;Y<y.length;Y++){var ga=y[Y].trim().replace(".","/");if(!oa[ga]){A=false;Ma&&La("./plugins/"+pluginFile)}}if(x)if(Ma||A)x.apply(Ba,Q(n));else K&&$LAB.wait(function(){x.apply(Ba,Q(n))});return Ba}function Z(n,x,y){if(n&&n.split){var A=n.split(fb);if(A.length>1){n=A[0];x=A[1]}}else if(n&&
n.lat){x=n.lon;n=n.lat}this.lat=parseFloat(n||0);this.lon=parseFloat(x||0);this.radius=y||gb}function Ua(n){this.positions=[];for(var x=n.length;x--;)this.positions[x]=typeof n[x]=="string"?new Z(n[x]):n[x]}function aa(n,x){if(n&&n.splice){for(var y=x,A=new Z(ra,Ga),K=new Z(hb,$),Y=n.length;Y--;){var ga=typeof n[Y]=="string"?new Z(n[Y]):n[Y];if(ga.lat<A.lat)A.lat=ga.lat;if(ga.lat>K.lat)K.lat=ga.lat;if(ga.lon<A.lon)A.lon=ga.lon;if(ga.lon>K.lon)K.lon=ga.lon}this.min=A;this.max=K;if(typeof y=="undefined"){y=
this.size();y=Math.max(y.x,y.y)*0.3}this.min=new Z(A.lat-y,(A.lon-y)%360);this.max=new Z(K.lat+y,(K.lon+y)%360)}else if(n&&n.min){this.min=new Z(n.min);this.max=new Z(n.max)}else{this.min=n;this.max=x}}function ua(n){if(typeof n=="string"){var x=(n.replace(/\d|\.|\s/g,"")||"m").toLowerCase();n=parseFloat(n)*({km:1E3}[x]||1)}this.meters=n||0}function na(n,x){if(typeof n=="number"){this.days=n||0;this.seconds=x||0}else if(typeof n!="undefined"){this.days=n.days||0;this.seconds=n.seconds||0}}var oa=
{},Va=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],Ma=typeof module!="undefined"&&module.exports,Ca=Math.PI*2,Ha=Math.PI/2,ha=Math.PI/180,va=180/Math.PI,ra=90,hb=-ra,Ga=180,$=-Ga,$a=ra*ha,X=-$a,Na=Ga*ha,qb=-Na,gb=6371,la=gb*1E3,fb=/[\,\s]+/;Z.prototype={constructor:Z,bearing:function(n){var x=this.lat*ha,y=n.lat*ha;n=(n.lon-this.lon)*ha;return(Math.atan2(Math.sin(n)*Math.cos(y),Math.cos(x)*Math.sin(y)-Math.sin(x)*Math.cos(y)*Math.cos(n))*va+360)%360},
copy:function(){return new Z(this.lat,this.lon)},distanceTo:function(n){if(!n||this.empty()||n.empty())return 0;var x=(n.lat-this.lat)*ha/2,y=(n.lon-this.lon)*ha/2;n=Math.sin(x)*Math.sin(x)+Math.cos(this.lat*ha)*Math.cos(n.lat*ha)*Math.sin(y)*Math.sin(y);return this.radius*2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n))},equalTo:function(n){return pos&&this.lat===n.lat&&this.lon===n.lon},empty:function(){return this.lat===0&&this.lon===0},inArray:function(n){if(n)for(var x=n.length;x--;)if(this.equal(n[x]))return true;
return false},offset:function(n,x){var y=this.lat*ha,A=y+n/this.radius;y=this.lon*ha+Math.asin(Math.sin(x/this.radius)/Math.cos(y));A=(A+Ha)%Math.PI-Ha;y%=Ca;return new Z(A*va,y*va)},to:function(n,x){if(typeof n=="object")n=this.bearing(n);var y=x/this.radius,A=n*ha,K=this.lat*ha,Y=Math.asin(Math.sin(K)*Math.cos(y)+Math.cos(K)*Math.sin(y)*Math.cos(A));y=this.lon*ha+Math.atan2(Math.sin(A)*Math.sin(y)*Math.cos(K),Math.cos(y)-Math.sin(K)*Math.sin(Y));y=(y+3*Math.PI)%(2*Math.PI)-Math.PI;return new Z(Y*
va,y*va)},toBounds:function(n){var x=n.radians(),y=this.lat*ha,A=this.lon*ha;n=y-x;var K=y+x;if(n>X&&K<$a){y=Math.asin(Math.sin(x)/Math.cos(y));x=A-y;if(x<qb)x+=Ca;A=A+y;if(A>Na)A-=Ca}else{n=Math.max(n,X);K=Math.min(K,$a);x=$;A=Ga}return new aa(new Z(n*va,x*va),new Z(K*va,A*va))},toString:function(n){return this.lat+(n||" ")+this.lon},valid:function(){return!(isNaN(this.lat)||isNaN(this.lon))}};Ua.prototype={constructor:Ua,distance:function(){for(var n=0,x=[],y,A=this.positions.length-1;A--;){y=this.positions[A].distanceTo(this.positions[A+
1]);n+=x[A]=y}return{total:n,segments:x}},traverse:function(n,x){var y=0,A=0;if(!x||!x.segments)x=this.distance();if(n>x.total)return this.positions[this.positions.length-1];else if(n<=0)return this.positions[0];else{for(;A<x.segments.length;){y+=x.segments[A];if(y>n){y-=x.segments[A];break}A++}if(A<this.positions.length-1){var K=this.positions[A];A=K.bearing(this.positions[A+1]);return K.to(A,n-y)}else return this.positions[A]}}};aa.prototype={constructor:aa,bestZoomLevel:function(n,x){var y=this.center(),
A=Va[Math.min(Math.round(Math.abs(y.lat)*0.05),Va.length)],K=this.size();y=Math.ceil(Math.log(Va[3]*x/K.y)/Math.LN2);A=Math.ceil(Math.log(A*n/K.x)/Math.LN2);return Math.min(isNaN(y)?1E3:y,isNaN(A)?1E3:A)},center:function(){var n=this.size();return new Z(this.min.lat+n.y/2,this.min.lon+n.x/2)},expand:function(n){return new aa(new Z(this.min.lat-n,(this.min.lon-n)%360),new Z(this.max.lat+n,(this.max.lon+n)%360))},size:function(n){var x={x:0,y:this.max.lat-this.min.lat};x.x=typeof n!="undefined"&&n&&
this.min.lon>this.max.lon?360-this.min.lon+this.max.lon:this.max.lon-this.min.lon;return x},toString:function(){return"min: "+this.min+", max: "+this.max},union:function(){for(var n=this.min.copy(),x=this.max.copy(),y=arguments.length;y--;)if(arguments[y]){var A=arguments[y].min,K=arguments[y].max;n.lat=Math.min(n.lat,A.lat);n.lon=Math.min(n.lon,A.lon);x.lat=Math.max(x.lat,K.lat);x.lon=Math.max(x.lon,K.lon)}return new aa(n,x)}};ua.prototype={add:function(){for(var n=this.meters,x=arguments.length;x--;){var y=
typeof arguments[x]=="string"?new ua(arguments[x]):arguments[x];n+=y.meters}return new ua(n)},radians:function(n){if(typeof n!="undefined"){this.meters=n*la;return this}else return this.meters/la},toString:function(){if(this.meters>1E3)return(this.meters/10|0)/100+"km";return this.meters+"m"}};na.prototype={add:function(){for(var n=new na(this.days,this.seconds),x=arguments.length;x--;){n.days+=arguments[x].days;n.seconds+=arguments[x].seconds}return n},toString:function(){var n,x,y,A="";if(this.days)A=
this.days+" days ";if(this.seconds){y=this.seconds;if(y>=3600){n=~~(y/3600);y-=n*3600}if(y>=60){x=Math.round(y/60);y-=x*60}if(n)A=A+n+(n>1?" hrs ":" hr ")+(x?(x>10?x:"0"+x)+" min ":"");else if(x)A=A+x+" min";else if(y>0)A=A+(y>10?y:"0"+y)+" sec"}return A}};var Oa=function(){var n=/^P(\d+Y)?(\d+M)?(\d+D)?$/,x=/^(\d+H)?(\d+M)?(\d+S)?$/,y={8601:function(A){A=A.split("T");var K=null;K=null;var Y=0,ga=0;n.lastIndex=-1;K=n.exec(A[0]);Y+=K[3]?parseInt(K[3].slice(0,-1),10):0;x.lastIndex=-1;K=x.exec(A[1]);
ga+=K[1]?parseInt(K[1].slice(0,-1),10)*3600:0;ga+=K[2]?parseInt(K[2].slice(0,-1),10)*60:0;ga+=K[3]?parseInt(K[3].slice(0,-1),10):0;return new na(Y,ga)}};return function(A,K){var Y=y[K];if(!Y)throw"No parser found for the duration format: "+K;return Y(A)}}(),Ba=this.GeoJS={Pos:Z,Line:Ua,BBox:aa,Distance:ua,generalize:function(n,x,y){var A=n.length,K=[],Y=null;y=(y||250)/1E3;for(A=A;A--;)if(A===0)K.unshift(n[A]);else{var ga=!Y||n[A].inArray(x)?y:Y.distanceTo(n[A]);if(n[A]&&ga>=y){K.unshift(n[A]);Y=
n[A]}}return K},Duration:na,parseDuration:Oa,define:function(n,x){oa[n]=x},require:La};if(Ma)module.exports=Ba})();
(function(){function Q(){var a=arguments[0]||{},c=Array.prototype.slice.call(arguments,1),b=c.length,f,i;for(i=0;i<b;i++)if((f=c[i])!==null)for(var j in f){var e=f[j];if(a!==e)if(e!==undefined)a[j]=e}return a}function La(a,c){if(typeof console!=="undefined")console[c||"log"](a)}function Z(a){var c=a.match(ha),b=[],f=0,i;for(i=c?c.length:0;i--;){var j=c[i].slice(1);b[j]||(b[j]=RegExp("\\{"+j+"\\}","g"))}f=b.length;return function(){var e=a;for(i=0;i<f;i++){var l=arguments[i];if(typeof l=="undefined")l=
"";e=e.replace(b[i],l)}return e}}function Ua(a,c){var b=n*Wa(a);return fb-2*yb(c*Y((1-b)/(1+b),n/2))}function aa(a,c){if($(a,Ia)){var b=a.split(zb);this.x=parseFloat(b[0]);this.y=parseFloat(b[1])}else if(a&&a.x){this.x=a.x;this.y=a.y}else{this.x=a||0;this.y=c||0}}function ua(a){this.allowCull=a;this.points=[]}function na(a,c,b,f){this.mercX=b;this.mercY=f;if($(a,Ia))Q(this,Mb.parseXY(a));else a&&a.toBounds?Q(this,ib(a.lon,a.lat)):aa.call(this,a,c)}function oa(a,c,b,f){this.x=a||0;this.y=c||0;this.w=
b||0;this.h=f||0;this.x2=this.x+this.w;this.y2=this.y+this.h}function Va(a,c){var b=new Nb(Math.sqrt(256<<a)|0);c&&c.zoomLevel===a&&c.copyInto(b);b.zoomLevel=a;return b}function Ma(a,c,b,f,i,j){this.x=a;this.y=c;this.w=f||256;this.h=f||256;this.x2=this.x+this.w;this.y2=this.y+this.h;this.url=b;this.id=j||a+"_"+c;this.loaded=false;this.image=null}function Ca(a,c,b,f){f=Q({id:"layer_"+Ob++,zindex:0,animated:false,style:null,minXY:null,maxXY:null,visible:true},f);this.visible=f.visible;this.view=a;ra(Q(this,
f))}function Ha(){ra(this)}var ha=/\{(\d+)(?=\})/g,va=function(){var a=1.70158,c=Math.PI/2,b=Math.abs,f=Math.pow,i=Math.sin,j=Math.asin,e=Math.cos,l={linear:function(d,k,g,h){return g*d/h+k},backin:function(d,k,g,h){return g*(d/=h)*d*((a+1)*d-a)+k},backout:function(d,k,g,h){return g*((d=d/h-1)*d*((a+1)*d+a)+1)+k},backinout:function(d,k,g,h){return(d/=h/2)<1?g/2*d*d*(((a*=1.525)+1)*d-a)+k:g/2*((d-=2)*d*(((a*=1.525)+1)*d+a)+2)+k},bouncein:function(d,k,g,h){return g-l.bounceout(h-d,0,g,h)+k},bounceout:function(d,
k,g,h){return(d/=h)<1/2.75?g*7.5625*d*d+k:d<2/2.75?g*(7.5625*(d-=1.5/2.75)*d+0.75)+k:d<2.5/2.75?g*(7.5625*(d-=2.25/2.75)*d+0.9375)+k:g*(7.5625*(d-=2.625/2.75)*d+0.984375)+k},bounceinout:function(d,k,g,h){return d<h/2?l.bouncein(d*2,0,g,h)/2+k:l.bounceout(d*2-h,0,g,h)/2+g/2+k},cubicin:function(d,k,g,h){return g*(d/=h)*d*d+k},cubicout:function(d,k,g,h){return g*((d=d/h-1)*d*d+1)+k},cubicinout:function(d,k,g,h){if((d/=h/2)<1)return g/2*d*d*d+k;return g/2*((d-=2)*d*d+2)+k},elasticin:function(d,k,g,h,
m,p){if(d==0)return k;if((d/=h)==1)return k+g;p||(p=h*0.3);if(!m||m<b(g)){m=g;g=p/4}else g=p/la*j(g/m);return-(m*f(2,10*(d-=1))*i((d*h-g)*la/p))+k},elasticout:function(d,k,g,h,m,p){var v;if(d==0)return k;if((d/=h)==1)return k+g;p||(p=h*0.3);if(!m||m<b(g)){m=g;v=p/4}else v=p/la*j(g/m);return m*f(2,-10*d)*i((d*h-v)*la/p)+g+k},elasticinout:function(d,k,g,h,m,p){var v;if(d==0)return k;if((d/=h/2)==2)return k+g;p||(p=h*0.3*1.5);if(!m||m<b(g)){m=g;v=p/4}else v=p/la*j(g/m);if(d<1)return-0.5*m*f(2,10*(d-=
1))*i((d*h-v)*la/p)+k;return m*f(2,-10*(d-=1))*i((d*h-v)*la/p)*0.5+g+k},quadin:function(d,k,g,h){return g*(d/=h)*d+k},quadout:function(d,k,g,h){return-g*(d/=h)*(d-2)+k},quadinout:function(d,k,g,h){if((d/=h/2)<1)return g/2*d*d+k;return-g/2*(--d*(d-2)-1)+k},sinein:function(d,k,g,h){return-g*e(d/h*c)+g+k},sineout:function(d,k,g,h){return g*i(d/h*c)+k},sineinout:function(d,k,g,h){return-g/2*(e(Math.PI*d/h)-1)+k}};return function(d){d=d.replace(/[\-\_\s\.]/g,"").toLowerCase();return l[d]||l.linear}}(),
ra=function(){function a(b,f){var i=b.hasOwnProperty("obsHandlers")?b.obsHandlers:null;i[f]||(i[f]=[]);return i[f]}var c=0;return function(b){if(!b)return null;if(!(b.hasOwnProperty("obsHandlers")?b.obsHandlers:null))b.obsHandlers={};if(!b.hasOwnProperty("bind")){b.bind=function(f,i){var j="callback"+c++;a(b,f).unshift({fn:i,id:j});return j};b.triggerCustom=function(f,i){var j=a(b,f),e={cancel:false,name:f,source:this},l;for(l in i)e[l]=i[l];if(!j)return null;l=Array.prototype.slice.call(arguments,
2);b.eventInterceptor&&b.eventInterceptor(f,e,l);l.unshift(e);for(var d=j.length;d--&&!e.cancel;)j[d].fn.apply(this,l);return e};b.trigger=function(f){var i=Array.prototype.slice.call(arguments,1);i.splice(0,0,f,null);return b.triggerCustom.apply(this,i)};b.unbind=function(f,i){if(typeof f==="undefined")b.obsHandlers={};else for(var j=a(b,f),e=0;j&&e<j.length;e++)if(j[e].id===i){j.splice(e,1);break}return b}}return b}}(),hb=function(){function a(c,b,f,i){if(typeof c[i]=="undefined")c[i]=function(j){if(typeof j!=
"undefined"){b[i]=j;f[i]&&f[i](j);return c}else return b[i]}}return function(c,b,f){b=b||c;for(var i in b)typeof b[i]!="function"&&a(c,b,f,i);return c}}(),Ga=Array.indexOf||function(a){for(var c=0;c<this.length;c++)if(this[c]===a)return c;return-1},$=function(){var a={NaN:1,Infinity:1,"-Infinity":1},c=String.prototype.toLowerCase,b=Object.prototype.toString;return function(f,i){i=c.call(i);if(i=="finite")return!a.hasOwnProperty(+f);return i=="null"&&f===null||i==typeof f||i=="object"&&f===Object(f)||
i=="array"&&Array.isArray&&Array.isArray(f)||b.call(f).slice(8,-1).toLowerCase()==i}}(),$a=function(){function a(j){var e=document.createElement("script"),l=false;e.src=j;e.async=true;e.onload=e.onreadystatechange=function(){if(!l&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){l=true;e.onload=e.onreadystatechange=null;e&&e.parentNode&&e.parentNode.removeChild(e)}};i||(i=document.getElementsByTagName("head")[0]);i.appendChild(e)}function c(j,e,l){j+=j.indexOf("?")>=
0?"&":"?";var d="json"+ ++f;window[d]=function(k){e(k);window[d]=null;try{delete window[d]}catch(g){}};a(j+(l?l:"callback")+"="+d);return d}function b(j,e,l){var d=require("request");j=j+(j.indexOf("?")>=0?"&":"?")+(l?l:"callback")+"=cb";d({uri:j},function(k,g,h){if(k)e({error:k});else{k=h.replace(/^.*\(/,"").replace(/\).*$/,"");e(JSON.parse(k))}})}var f=0,i;return typeof window!="undefined"?c:b}();INTERACT=function(){function a(m){return function(p,v){m.addEventListener(p,v,false)}}function c(m){return function(p,
v){m.removeEventListener(p,v,false)}}function b(m){return function(p,v){m.attachEvent("on"+p,v)}}function f(m,p){return{x:m?m:0,y:p?p:0,count:1}}function i(m,p){g.push(Q({handler:null,checks:{},type:m},p))}function j(m){var p=0,v=0;if(m.offsetParent){do{p+=m.offsetLeft;v+=m.offsetTop;m=m.offsetParent}while(m)}return{left:p,top:v}}function e(m,p){return{source:m,target:p.target?p.target:p.srcElement}}function l(m,p){for(var v=m.target?m.target:m.srcElement;v&&v!==p;)v=v.parentNode;return v&&v===p}
function d(m,p){return{x:m.x-(p?p.left:0),y:m.y-(p?p.top:0)}}function k(m,p){if(m.preventDefault){m.preventDefault();m.stopPropagation()}else if(typeof m.cancelBubble!="undefined")m.cancelBubble=true;p&&m.stopImmediatePropagation&&m.stopImmediatePropagation()}var g=[],h=function(m,p,v){v=Q({binder:null,unbinder:null,observable:null},v);for(var B=v.observable,G=[],O,t,E={bind:function(){return B.bind.apply(null,arguments)},unbind:function(){B.unbind();for(z=0;z<G.length;z++)G[z].unbind();return E}},
z=0;z<p.length;z++)G.push(p[z](m,B,v));B.bind("pointerDown",function(){t=O=0});B.bind("pointerMove",function(o,w,s,r){O+=r.x||0;t+=r.y||0});B.bind("pointerUp",function(o,w,s){Math.max(Math.abs(O),Math.abs(t))<=20&&B.triggerCustom("tap",o,w,s)});return E};i("pointer",{handler:function(m,p,v){function B(I){if(I.pageX&&I.pageY)return f(I.pageX,I.pageY);else{var L=document.documentElement,R=document.body;return f(I.clientX+(L&&L.scrollLeft||R&&R.scrollLeft||0)-(L&&L.clientLeft||R&&R.clientLeft||0),I.clientY+
(L&&L.scrollTop||R&&R.scrollTop||0)-(L&&L.clientTop||R&&R.clientTop||0))}}function G(I){if(l(I,m))if(F=z(I)){var L=B(I);m.style.cursor="move";k(I,true);T=L.x;V=L.y;D=f(T,V);p.triggerCustom("pointerDown",e("mouse",I),D,d(D,j(m)))}}function O(I){var L=B(I);J=L.x;U=L.y;if(l(I,m))w(I,F?"pointerMove":"pointerHover")}function t(I){if(F&&z(I)){F=false;if(l(I,m)){m.style.cursor="default";w(I,"pointerUp")}}}function E(I){if(l(I,m)){var L;I=I||window.event;if(I.detail){if(typeof I.axis=="undefined"||I.axis===
2)L=-I.detail*s}else{L=I.wheelDeltaY?I.wheelDeltaY:I.wheelDelta;if(window.opera)L=-L}if(L){var R=f(J,U);p.triggerCustom("zoom",e("mouse",I),R,d(R,j(m)),L/r,"wheel");k(I);I.returnValue=false}}}function z(I){I=I||window.event;return(I.which||I.button)==1}function o(I){return!l(I,m)}function w(I,L,R,ea,H){R=typeof R!="undefined"?R:J;ea=typeof ea!="undefined"?ea:U;var N=R-T,P=ea-V,ba=f(R,ea);p.triggerCustom(L,e("mouse",I),ba,d(ba,j(m)),f(N,P));if(typeof H=="undefined"||H){T=R;V=ea}}v=Q({},v);var s=120,
r=s*8,F=false,D,J,U,T,V;v.binder("mousedown",G);v.binder("mousemove",O);v.binder("mouseup",t);v.binder("dblclick",function(I){if(l(I,m)){var L=B(I);p.triggerCustom("doubleTap",e("mouse",I),L,d(L,j(m)))}});v.binder("selectstart",o);v.binder("dragstart",o);v.binder("mousewheel",E);v.binder("DOMMouseScroll",E);return{unbind:function(){v.unbinder("mousedown",G);v.unbinder("mousemove",O);v.unbinder("mouseup",t);v.unbinder("mousewheel",E);v.unbinder("DOMMouseScroll",E)}}},checks:{touch:false}});i("pointer",
{handler:function(m,p,v){function B(H){if(H.count<2)return 0;var N=H.x-H.next.x;H=H.y-H.next.y;return~~Math.sqrt(N*N+H*H)}function G(H,N,P){N=N?N:0;P=P?P:0;for(var ba={x:H.x-N,y:H.y-P,id:H.id,count:H.count},pa=ba;H.next;){H=H.next;pa=pa.next={x:H.x-N,y:H.y-P,id:H.id}}return ba}function O(H,N){var P=H[N?N:"touches"],ba,pa;if(P.length===0)return null;pa=ba={x:P[0].pageX,y:P[0].pageY,id:P[0].identifier,count:P.length};for(var ka=1,wa=P.length;ka<wa;ka++)pa=pa.next={x:P[ka].pageX,y:P[ka].pageY,id:P[ka].identifier};
return ba}function t(H){if(l(H,m)){J=j(m);var N=O(H,"changedTouches"),P=G(N,J.left,J.top);if(!T){U=r;p.triggerCustom("pointerDown",e("touch",H),N,P)}R&&p.triggerCustom("pointerDownMulti",e("touch",H),N,P);T=O(H);if(T.count>1)I=B(T);ea=1;L=G(T)}}function E(H){if(l(H,m)){k(H);V=O(H);if(U==r)U=Math.abs(T.x-V.x)>w||Math.abs(T.y-V.y)>w?s:r;if(U!=r){U=V.count>1?D:F;if(U==D)if(T.count===1){T=G(V);I=B(T)}else{var N=B(V);if(Math.abs(I-N)<o)U=F;else{var P;P=V.x;var ba=V.next.x,pa=V.y,ka=V.next.y;P={x:(P<ba?
P:ba)+(Math.abs(P-ba)>>1),y:(pa<ka?pa:ka)+(Math.abs(pa-ka)>>1)};N=N/I;ba=N-ea;p.triggerCustom("zoom",e("touch",H),P,d(P,J),ba,"pinch");ea=N}}U==F&&p.triggerCustom("pointerMove",e("touch",H),V,G(V,J.left,J.top),f(V.x-L.x,V.y-L.y));R&&p.triggerCustom("pointerMoveMulti",e("touch",H),V,G(V,J.left,J.top))}L=G(V)}}function z(H){if(l(H,m)){var N=O(H,"changedTouches"),P=G(N,J.left,J.top);V=O(H);if(!V){p.triggerCustom("pointerUp",e("touch",H),N,P);T=null}R&&p.triggerCustom("pointerUpMulti",e("touch",H),N,
P)}}v=Q({detailed:false,inertia:false},v);var o=20,w=7,s=0,r=1,F=2,D=3,J,U,T,V,I,L,R=v.detailed,ea=1;v.binder("touchstart",t);v.binder("touchmove",E);v.binder("touchend",z);return{unbind:function(){v.unbinder("touchstart",t);v.unbinder("touchmove",E);v.unbinder("touchend",z)}}},checks:{touch:true}});return{register:i,watch:function(m,p,v){p=Q({bindTarget:null,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},p);capabilities=Q({touch:"ontouchstart"in window},v);if(!p.observable){p.observable=
ra({});globalOpts=p}p.binder=(p.isIE?b:a)(p.bindTarget||document);p.unbinder=(p.isIE?b:c)(p.bindTarget||document);v=p.types;for(var B=capabilities,G=[],O=g.length;O--;){var t=g[O],E=!v||v.indexOf(t.type)>=0,z=true,o;for(o in t.checks){var w=t.checks[o];z=z&&w===B[o]}if(E&&z)G[G.length]=t.handler}return new h(m,G,p)}}}();var X=this.T5=ra({}),Na=function(){var a={};return{create:function(c,b){if(a[c][b])return a[c][b].apply(null,Array.prototype.slice.call(arguments,2));throw gb(c,b);},get:function(c,
b){return a[c]?a[c][b]:null},register:function(c,b,f){a[c]||(a[c]={});a[c][b]&&La(qb(c,b),"warn");a[c][b]=f}}}(),qb=Z("Registration of {0}: {1} will override existing definition"),gb=Z("Could not create {0} of type: {1}");Z("Could not create drawable of type: {0}");var la=Math.PI*2,fb=Math.PI/2,Oa=Math.PI/180,Ba=180/Math.PI,n=0.08181919084262157,x=Math.abs,y=Math.round,A=Math.min,K=Math.max,Y=Math.pow,ga=Math.sqrt,rb=Math.log,Wa=Math.sin,jb=Math.cos,yb=Math.atan,Pa="undefined",Ia="string",Ja="number",
xa=Na.register,Xa=Na.create,Pb=Na.get,Qb=0,Ob=0,zb=/[\,\s]+/,Qa=function(){function a(e){i++;e=W?window.mozAnimationStartTime||e||(new Date).getTime():(new Date).getTime();for(var l=f.length;l--;){var d=f[l];i%d.every===0&&d.cb(e)}j&&animFrame(a)}var c=1E3/60,b=["r","webkitR","mozR","oR","msR"],f=[],i=0,j=W&&function(){for(var e=0;e<b.length;e++)window.animFrame=window.animFrame||window[b[e]+"equestAnimationFrame"];return animFrame}();j?animFrame(a):setInterval(a,1E3/60);return{attach:function(e,
l){f[f.length]={cb:e,every:l?y(l/c):1}},detach:function(e){for(var l=f.length;l--;)if(f[l].cb===e){f.splice(l,1);break}}}}(),Mb=function(){var a=/^xy\((.*)\).*$/i;return{parseXY:function(c){if(!a.test(c)){c=c.split(zb);return ib(c[1],c[0])}}}}(),W=typeof window!="undefined"?function(){function a(i){for(var j=0;j<i.length;j++){var e=i[j];if(typeof document.body.style[e]!="undefined")return e}}var c={"-webkit-user-select":"none",position:"absolute"},b,f;b=a(["-webkit-transform","MozTransform"]);css3DTransformProp=
a(["WebkitPerspective","MozPerspective"]);f=a(["-webkit-transform-origin","MozTransformOrigin"]);return{transforms:$(b,Ia),create:function(i,j,e){i=document.createElement(i);var l=[];e=e||{};i.className=j||"";for(var d in e)l[l.length]=d+": "+e[d];i.style.cssText=l.join(";");return i},move:function(i,j,e,l,d){if(b){i.style[b]="translate("+j+"px, "+e+"px) "+(l||[]).join(" ");if(d&&f)i.style[f]=d.x+"px "+d.y+"px"}else{i.style.left=j+"px";i.style.top=e+"px"}},rect:function(i){return new oa(i.offsetLeft,
i.offsetTop,i.offsetWidth,i.offsetHeight)},styles:function(i){return Q({},c,i)}}}():null,Ab=function(){function a(){for(var i=f.length,j=i;j--;)try{f[j](i)}catch(e){La(e.toString(),"error")}}var c=20,b=50,f=[];return{process:function(i,j,e,l){function d(h){h=(k||b)/h;if(g<i.length){var m=i.slice(g,g+h);h=m.length;var p=k?0:(new Date).getTime();j(m,h);if(!k)k=(m=((new Date).getTime()-p)/h)?c/m|0:i.length;g+=h}else{for(h=f.length;h--;)if(f[h]===d){f.splice(h,1);break}f.length===0&&Qa.detach(a);e&&e()}}
var k,g=0;if(W&&i.length>(l||0))f.push(d)===1&&Qa.attach(a);else{j(i,i.length);e&&e()}}}}(),ib=ib||function(a,c){var b=parseFloat(c)*Oa;b=Wa(b);var f=n*b;b=rb((1+b)/(1-b)*Y((1-f)/(1+f),n))/2;return new na(0,0,parseFloat(a)*Oa,b)},sb=sb||function(a,c){for(var b=Y(Math.E,-c),f=fb-2*yb(b),i=Ua(f,b),j=0;j<12&&x(f-i)>1.0E-7;){f=i;i=Ua(f,b);j++}return new GeoJS.Pos(i*Ba,a%360*Ba)};aa.prototype={constructor:aa,add:function(){for(var a=this.x,c=this.y,b=arguments.length;b--;){a+=arguments[b].x;c+=arguments[b].y}return this.copy(a,
c)},copy:function(a,c){var b=Q({},this);b.x=a||b.x;b.y=c||b.y;return b},equals:function(a){return this.x===a.x&&this.y===a.y},offset:function(a,c){return this.copy(this.x+a,this.y+c)},relative:function(a){a=a.viewport();return this.copy(this.x-a.x-a.padding.x,this.y-a.y-a.padding.y)},rotate:function(a,c){c=c||new aa(0,0);var b=this.x-c.x,f=this.y-c.y;return new aa(c.x+jb(a)*b+-Wa(a)*f,c.y+Wa(a)*b+jb(a)*f)},scale:function(a,c){c=c||new aa(0,0);return new aa(c.x+(this.x-c.x)*a,c.y+(this.y-c.y)*a)},
sync:function(){return this},toString:function(){return this.x+", "+this.y}};ua.prototype=Q([],{cull:function(a){if(this.allowCull){var c=a.x,b=a.y,f=a.x+a.w;a=a.y+a.h;for(var i=Infinity,j=0,e=this.points,l,d=e.length;d--;)if(l=e[d].x>=c&&e[d].x<=f&&e[d].y>=b&&e[d].y<=a){i=d<i?d:i;j=d>j?d:j}return e.slice(K(i-1,0),A(j+1,e.length))}return this},simplify:function(a){a=a||3;for(var c=new ua(this.allowCull),b=this.points,f=null,i=b.length;i--;){var j=b[i];if(include=!f||i===0||x(j.x-f.x)+x(j.y-f.y)>a){c.points.unshift(j);
f=j}}return c}});na.prototype=Q(new aa,{constructor:na,pos:function(){return sb(this.mercX,this.mercY)},sync:function(a,c){var b;if(!(b=a.rpp)){b=a.zoom();b=la/(256<<b)}b=b;if(c){this.mercX=this.x*b-Math.PI;this.mercY=Math.PI-this.y*b}else{this.x=y(((this.mercX||0)+Math.PI)/b);this.y=y((Math.PI-(this.mercY||0))/b)}return this}});oa.prototype={constructor:oa,buffer:function(a,c){return new oa(this.x-a,this.y-(c||a),this.w+a*2,this.h+(c||a)*2)},center:function(){return new aa(this.x+(this.w>>1),this.y+
(this.h>>1))}};Hits=function(){return{diffHits:function(a,c){var b=[],f={},i;for(i=c.length;i--;)f[c[i].target.id]=true;for(i=a.length;i--;)f[a[i].target.id]||(b[b.length]=a[i]);return b},init:function(a,c,b,f,i){return{type:a,x:i.x,y:i.y,gridX:f.x|0,gridY:f.y|0,elements:[],absXY:c,relXY:b}},initHit:function(a,c,b){return{type:a,target:c,drag:b}},match:function(a,c,b){return c===a.type&&b.x===a.absXY.x&&b.y===a.absXY.y},triggerEvent:function(a,c,b,f){c.triggerCustom(a.type+(b?b:"Hit"),{hitType:a.type},
f?f:a.elements,a.absXY,a.relXY,new na(a.gridX,a.gridY))}}}();var Nb=function(a){function c(j,e){var l=b[j],d;l||(l=b[j]=[]);(d=l[e])||(d=l[e]=[]);return d}a=a||128;var b=[],f={},i=0;return{all:function(){var j=[],e;for(e in f)j[j.length]=f[e];return j},clear:function(){b=[];f={}},copyInto:function(j){for(var e in f){var l=f[e];j.insert(l.bounds||l,l,e)}},insert:function(j,e,l){var d=j.x/a|0,k=j.y/a|0,g=(j.x+j.w)/a|0;j=(j.y+j.h)/a|0;l=l||e.id||"obj_"+i++;f[l]=e;for(e=d;e<=g;e++)for(d=k;d<=j;d++)c(e,
d).push(l)},remove:function(j,e,l){l=l||e.id;if(f[l]){var d=j.x/a|0;e=j.y/a|0;var k=(j.x+j.w)/a|0;j=(j.y+j.h)/a|0;delete f[l];for(d=d;d<=k;d++)for(var g=e;g<=j;g++){var h=c(d,g),m=Ga.call(h,l);m>=0&&h.splice(m,1)}}},search:function(j){var e=j.y/a|0,l=(j.x+j.w)/a|0,d=(j.y+j.h)/a|0,k=[],g=[];for(j=j.x/a|0;j<=l;j++)for(var h=e;h<=d;h++)k=k.concat(c(j,h));k.sort();for(e=k.length;e--;){l=k[e];if(d=f[l])g[g.length]=d;for(;e>0&&k[e-1]==l;)e--}return g}}},kb=function(){var a={},c=0;(new Date).getTime();var b=
{},f=[];Qa.attach(function(i){i=i||(new Date).getTime();for(var j=0;j<f.length;){var e=f[j],l=b[e],d=b[e].image&&b[e].image.complete&&b[e].image.width>0,k=i-l.start;k=d||k>=3E4;if(d){d=l.callbacks;a[e]=l.image;for(var g=0;g<d.length;g++)d[g](l.image,true)}if(k){f.splice(j,1);delete b[e]}else j++}},250);return function(i,j){var e=i&&j?a[i]:null;if(e&&e&&e.complete&&e.width>0)j(e);else if(e=b[i])e.callbacks.push(j);else{e=new Image;e.id="_ldimg"+ ++c;b[i]={start:(new Date).getTime(),image:e,callbacks:[j]};
e.src=i;f[f.length]=i}}}();Ma.prototype={constructor:Ma,load:function(a){var c=this;kb(this.url,function(b){c.loaded=true;c.image=b;a&&a()})}};var Rb=function(){return ra({fastpan:true,applyStyle:function(){},applyTransform:function(a,c,b){return{restore:null,x:c,y:b}},getDimensions:function(){return{width:0,height:0}},getViewport:function(){},hitTest:function(){return false},projectXY:null,reset:function(){}})};xa("renderer","canvas",function(a,c,b,f,i){function j(){function o(r,F){this.save();this.setTransform(1,
0,0,1,0,0);var D=this.isPointInPath_old(r,F);this.restore();return D}var w=CanvasRenderingContext2D.prototype,s=document.createElement("canvas").getContext("2d");s.translate(50,0);s.moveTo(125,50);s.arc(100,50,25,0,360,false);if(!s.isPointInPath(150,50)){w.isPointInPath_old=w.isPointInPath;w.isPointInPath=o}}function e(o,w,s){var r,F;v[w]=function(D){for(r=E.length;r--;)if(F=s[E[r]])D[z[r]]=F}}function l(o,w,s){return{draw:s||t,viewport:o,hit:w&&h.isPointInPath(w.x,w.y),vpX:m,vpY:p,context:h}}f=Q({},
f);var d,k,g,h,m=0,p=0,v={},B=null,G={},O=function(){},t=function(){this.fill&&h.fill();this.stroke&&h.stroke()},E=["fill","stroke","lineWidth","opacity"],z=["fillStyle","strokeStyle","lineWidth","globalAlpha"];W&&j();if(c){d=c.offsetWidth;k=c.offsetHeight;g=W?W.create("canvas",null,{position:"absolute","z-index":1}):new Canvas;g.width=d;g.height=k;a.attachFrame(g,true);h=null}b=Q(i,{applyStyle:function(o){var w=v[o],s=h&&h.canvas?h.canvas.id:"default",r;G[s]||(G[s]=[]);r=G[s].pop()||"reset";if(w){G[s].push(o);
w(h);return r}},applyTransform:function(o){if(o.translateX!==0||o.translateY!==0||o.scaling!==1||o.rotation!==0){h.save();B={undo:function(){h.restore();B=null},x:o.xy.x,y:o.xy.y};h.translate(o.xy.x-m+o.translateX,o.xy.y-p+o.translateY);o.rotation!==0&&h.rotate(o.rotation);o.scaling!==1&&h.scale(o.scaling,o.scaling)}return B},drawTiles:function(o,w,s){for(var r=w.length;r--;){o=w[r];if(!o.loaded&&s)o.load(a.invalidate);else o.image&&h.drawImage(o.image,o.x-m,o.y-p)}},prepArc:function(o,w,s){h.beginPath();
h.arc(o.xy.x-(B?B.x:m),o.xy.y-(B?B.y:p),o.size>>1,o.startAngle,o.endAngle,false);return l(w,s)},prepImage:function(o,w,s,r){var F=(r.x||o.xy.x)-(B?B.x:m),D=(r.y||o.xy.y)-(B?B.y:p),J=r.image||o.image;if(J){h.beginPath();h.rect(F,D,r.width||J.width,r.height||J.height);return l(w,s,function(){h.drawImage(J,F,D,r.width||J.width,r.height||J.height)})}},prepMarker:function(o,w,s){var r=o.xy.x-(B?B.x:m),F=o.xy.y-(B?B.y:p),D=o.size,J=undefined;h.beginPath();switch(o.markerType.toLowerCase()){case "image":J=
O;h.rect(r-(D>>1),F-(D>>1),D,D);if(o.reset&&o.image){o.image=null;o.reset=false}o.image?h.drawImage(o.image,r-(D>>1),F-(D>>1),D,D):kb(o.imageUrl,function(U){o.image=U;h.drawImage(o.image,r-(D>>1),F-(D>>1),D,D)});break;default:h.moveTo(r,F);h.lineTo(r-(D>>1),F-D);h.lineTo(r+(D>>1),F-D);h.lineTo(r,F)}return l(w,s,J)},prepPoly:function(o,w,s,r){var F=true;o=r.points||o.line().cull(w);r=B?B.x:m;var D=B?B.y:p;h.beginPath();for(var J=o.length;J--;){var U=o[J].x-r,T=o[J].y-D;if(F){h.moveTo(U,T);F=false}else h.lineTo(U,
T)}return l(w,s)},getCanvas:function(){return g},getContext:function(){return h}});(function(){Bb.each(function(o,w){e(null,o,w)});X.bind("styleDefined",e)})();b.bind("predraw",function(o,w,s){var r=false;if(h)h.restore();else if(g)h=g.getContext("2d");for(o=w.length;o--;)r=r||w[o].clip;m=s.x;p=s.y;if(h){r||h.clearRect(0,0,d,k);h.save();h.globalCompositeOperation="source-over"}});b.bind("detach",function(){c.removeChild(g)});b.bind("resize",function(){});return b});xa("renderer","dom",function(a,
c,b,f,i){function j(g){var h=g.image=new Image;d[g.id]=g;h.onload=function(){if(k[g.id])l.appendChild(this);else g.image=null};h.src=g.url;h.style.cssText="-webkit-user-select: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute;";
return h}function e(g,h,m){var p=[],v;for(v in g){var B=g[v];if(m?B[m]:!h[v]){if(B.image&&B.image.parentNode){B.image.src="";l.removeChild(B.image);B.image=null}p[p.length]=v}}for(h=p.length;h--;)delete g[p[h]]}var l=null,d={},k={};l=W.create("div","t5-tiles",W.styles({width:c.offsetWidth+"px",height:c.offsetHeight+"px"}));c.childNodes.length>0?c.insertBefore(l,c.childNodes[0]):c.appendChild(l);a.attachFrame(l);b=Q(i,{drawTiles:function(g,h,m){for(var p,v=g.x,B=g.y,G=h.length;G--;){g=h[G];if(g.url){(p=
g.image||(m?j(g):null))&&W.move(p,g.x-v,g.y-B);k[g.id]=g}}}});b.bind("predraw",function(){e(d,k);k={}});b.bind("detach",function(){c.removeChild(l)});a.bind("reset",function(){for(e(d,k={});l.childNodes.length>0;)l.removeChild(l.childNodes[0])});return b});var Bb=function(){function a(b,f){if($(b,Ia)){X.trigger("styleDefined",b,c[b]=f);return b}else{var i=[],j;for(j in b)i[i.length]=a(j,b[j]);return i}}var c={};a({reset:{fill:"#ffffff",opacity:1},highlight:{fill:"#ff0000"},waypoints:{lineWidth:4,
stroke:"#003377",fill:"#ffffff"},waypointsHover:{lineWidth:4,stroke:"#ff0000",fill:"#ffffff"}});return{resetStyle:"reset",each:function(b){for(var f in c)b(f,c[f])},get:function(b){return c[b]},define:a}}(),Lb=function(a,c){function b(q,u,C,M){Ka&&Ka(true);q=U?K(ca+Y(2,M)-1,0.125):M>0?2:0.5;s(q,false,true)}function f(q,u){var C=fa&&fa.projectXY?fa.projectXY(q,u):null;if(!C){C=z();C=new S.XY(C?C.x+(q+C.padding.x)/ca:q,C?C.y+(u+C.padding.y)/ca:u)}return C.sync(S,true)}function i(q,u,C){q=f(C.x,C.y);
clearTimeout(tb);S.trigger("doubleTap",u,C,q);if(c.scalable){u=S.center();r(ia+q.x-u.x,ja+q.y-u.y,U?Cb:null);s(2,Cb,true)}}function j(q,u,C){P=null;ka=true;O("down",u,C)}function e(q,u,C){O("hover",u,C)}function l(q,u,C,M){p(u,C,false);if(!P){wa+=M.x;Da+=M.y}}function d(q,u,C){p(u,C,true);ka=false}function k(){clearTimeout(Db);Db=setTimeout(function(){if(N)if(N.offsetWidth!==ab*2||N.offsetHeight!==bb*2){var q=E();B(a);E(q.x,q.y)}},250)}function g(q,u,C){O("tap",u,C);tb=setTimeout(function(){S.trigger("tap",
u,C,f(C.x,C.y,true))},20)}function h(){sa&&sa.unbind();if(W&&fa){sa=INTERACT.watch(fa.interactTarget||N);if(c.scalable){sa.bind("zoom",b);sa.bind("doubleTap",i)}sa.bind("pointerDown",j);sa.bind("pointerMove",l);sa.bind("pointerUp",d);c.captureHover&&sa.bind("pointerHover",e);sa.bind("tap",g)}}function m(q){if(fa){fa.trigger("detach");fa=null}var u=S,C=ea,M=N,da=c;q=q.split("/");for(var za=new Rb(u,C,M,da),qa=0;qa<q.length;qa++)za=Xa("renderer",q[qa],u,C,M,da,za);fa=za;pa=W&&fa.fastpan&&W.transforms;
U=W&&W.transforms&&c.useTransforms;h();S.trigger("changeRenderer",fa);S.trigger("reset");w()}function p(q,u,C){if(P){q=f(u.x,u.y);P.drag.call(P.target,P,q.x,q.y,C)&&ma++;if(C)P=null}}function v(q){for(var u=R;u--;)if(L[u].id===q)return u;return R}function B(q){if(W){N=document.getElementById(q);q=W.rect(N);H&&N.removeChild(H);N.appendChild(H=W.create("div","t5-panframe",W.styles({overflow:"hidden",width:q.w+"px",height:q.h+"px"})));var u=c.padding;if(u===J){u=N.offsetWidth;var C=N.offsetHeight,M=
ga(u*u+C*C);ta=new aa(M-u>>1,M-C>>1)}else ta=new aa(u,u);lb=H.offsetWidth+ta.x*2;mb=H.offsetHeight+ta.y*2;ub=lb/2;vb=mb/2;ab=q.w/2;bb=q.h/2;cb=new aa(ub,vb);H.appendChild(ea=W.create("div","t5-view",W.styles({width:lb+"px",height:mb+"px","z-index":2,margin:-ta.y+"px 0 0 "+-ta.x+"px"})));m(c.renderer);q=c.controls;for(u=0;u<V.length;u++)V[u].trigger("detach");V=[];for(u=0;u<q.length;u++)V[V.length]=Xa("control",q[u],S,H,N,c[q[u]])}else m("canvas")}function G(q){var u=[],C,M,da;if(!T){S.panSpeed=panSpeed=
x(wa)+x(Da);(C=ca!==wb)&&S.trigger("scale");if(panSpeed>0||C||Ea||Ka||db){ma++;if(Ea&&panSpeed>0){Ea(true);Ea=null}}if(!ka&&panSpeed<=F&&(x(ia-Eb)>=Fb||x(ja-Gb)>=Fb))w();xb.index++;xb.draw=ma||panSpeed||Sb||Tb;if(fa&&xb.draw){if(Ka)ca=Ka()[0];if(db)Aa=db()[0];Ra+=wa;Sa+=Da;if(wa||Da)S.trigger("pan");if(U){if(ca!==1)u[u.length]="scale("+ca+")";if(Aa!==0)u[u.length]="rotate("+Aa+"deg)"}C=ba||!pa||!ka&&!(Ea&&Hb)&&!(Ka&&Hb)&&(c.drawOnScale||ca===1)&&panSpeed<=D;if(Ea){M=Ea();da=1;if(nb)da=ca/nb;Ra=(ia-
M[0]|0)*da;Sa=(ja-M[1]|0)*da}if(C){M=-Aa*Oa;C=jb(M)*Ra+-Wa(M)*Sa;M=Wa(M)*Ra+jb(M)*Sa;ia=ia-C/ca|0;ja=ja-M/ca|0;da=z();fa.trigger("predraw",L,da,q,ya);M=Sa=C=Ra=ma=0;for(ii=R;ii--;){var za=L[ii];if(za.visible){var qa=za.style?fa.applyStyle(za.style,true):null;za.draw(fa,da,S,q,ya[0]);qa&&fa.applyStyle(qa)}}fa.trigger("render",da);S.trigger("drawComplete",da,q);W.move(ea,C,M,u,cb)}else W.move(ea,Ra,Sa,u,cb);if(ka||!c.inertia)Da=wa=0;else if(wa!=0||Da!=0){wa*=0.8;Da*=0.8;if(x(wa)<0.5)wa=0;if(x(Da)<0.5)Da=
0}if(ya.length){for(ii=0;ii<ya.length;ii++){q=ya[ii];u=true;C=q?q.elements:[];M=void 0;if(q&&eb&&q.type==="hover"&&eb.type==="hover"){diffElements=Hits.diffHits(eb.elements,C);if(diffElements.length>0)Hits.triggerEvent(eb,S,"Out",diffElements);else u=false}if(C.length>0){da=q.gridX;za=q.gridY;for(M=C.length;ka&&M--;){qa=C[M];var Ib=da,Jb=za,Kb=qa&&qa.drag&&(!qa.canDrag||qa.canDrag(qa,Ib,Jb));if(Kb){P=qa;P.startX=Ib;P.startY=Jb}if(Kb)break}if(u){Hits.triggerEvent(q,S);q.type==="tap"&&clearTimeout(tb)}}eb=
C.length>0?Q({},q):null}ya=[]}if(wb!==ca){S.trigger("scaleChanged",ca);wb=ca}}}}function O(q,u,C){var M=(new aa(C.x-ab+ub,C.y-bb+vb)).rotate(-Aa*Oa,cb).scale(1/ca,cb);if(ya.length===0||!Hits.match(ya[ya.length-1],q,u)){ya[ya.length]=q=Hits.init(q,u,C,f(C.x,C.y,true),M);ba=false;for(u=R;u--;)if(L[u].visible)ba=ba||(L[u].hitGuess?L[u].hitGuess(q.gridX,q.gridY,S):false);ba&&ma++}}function t(q){I=I?I+" "+q:q;S.trigger("copyright",I)}function E(q,u,C){if(typeof q!="undefined"&&($(q,Ia)||$(q,"object"))){u=
new S.XY(q);u.sync(S);q=u.x;u=u.y}if($(q,Ja)){r(q-ab-ta.x,u-bb-ta.y,C);return S}else return r().offset(ab+ta.x|0,bb+ta.y|0).sync(S,true)}function z(){var q=new oa(ia,ja,lb,mb);q.scaleFactor=ca;q.padding=ta?ta.copy():new aa;return q}function o(q,u,C){if($(q,Ia)&&$(u,Pa))for(u=0;u<R;u++){if(L[u].id===q)return L[u]}else if($(q,Ia)){u=Xa("layer",u,S,H,N,C);C=v(q);C!==R&&S.trigger("layerRemove",L[C]);u.added=(new Date).getTime();u.id=q;L[C]=u;L.sort(function(M,da){return da.zindex-M.zindex||da.added-M.added});
R=L.length;S.trigger("resync");w();S.trigger("layerChange",S,u);ma++;return u}else return[].concat(L)}function w(){var q=z();if(q){if(Ya||Za)if(q){var u=ob?ia+(q.w>>1):ia,C=pb?ja+(q.h>>1):ja,M=q.w,da=q.h;if(Ya&&Ya>M)if(u+M>Ya)ia=ob?ia:Ya-M;else if(u<0)ia=ob?ia:0;if(Za&&Za>da)if(C+da>Za)ja=pb?ja:Za-da;else if(C<0)ja=pb?ja:0}Eb=ia;Gb=ja;S.trigger("refresh",S,q);ma++}}function s(q,u,C){if($(q,Ja)){var M=C?q:ca*q;if(!U){u=undefined;q=y(rb(M)/Math.LN2);M=Y(2,q)}if(u){nb=ca;Ka=Fa.tween([ca],[M],u,function(){ca=
M;nb=Ka=null;ma++})}else{ca=M;ma++}return S}else return ca}function r(q,u,C){if($(q,Ja)){if(C)Ea=Fa.tween([ia,ja],[q,u],C,function(){ia=q|0;ja=u|0;Ra=Sa=0;Ea=null;ma++});else{ia=q|0;ja=u|0;ma++}return S}else return(new S.XY(ia,ja)).sync(S,true)}c=Q({captureHover:true,controls:[],copyright:"",drawOnScale:true,padding:128,inertia:true,refreshDistance:128,noDrawOnTween:true,pannable:true,scalable:true,renderer:"canvas",useTransforms:true},c);var F=0,D=2,J="auto",U=true,T=false,V=[],I="",L=[],R=0,ea=
null,H=null,N,P=null,ba=false,pa,ka=false,wa=0,Da=0,Sb=0,Tb=0,Fb=c.refreshDistance,Hb=c.noDrawOnTween,ia=0,ja=0,Ra=0,Sa=0,Eb=0,Gb=0,Ya=null,Za=null,ob=false,pb=false,Ea=null,ta,ya=[],eb=null,fa,Db=0,cb=new aa,Aa=0,db=null,ca=1,nb,Ka=null,wb=1,sa=null,xb={index:0,draw:false},Cb={easing:"sine.out",duration:500},ma=0,lb,mb,ub,vb,ab,bb,tb,S={XY:aa,id:c.id,panSpeed:0,addCopy:t,attachFrame:function(q,u){u&&ea.appendChild(q)},center:E,detach:function(){Qa.detach(G);fa&&fa.trigger("detach");sa&&sa.unbind();
if(H){N.removeChild(H);ea=H=null}},frozen:function(q){if($(q,Pa))return T;else{T=q;return S}},getCopy:function(){return I},getRenderer:function(){return fa},layer:o,invalidate:function(){ma++},pan:function(q,u,C){return r(ia+q,ja+u,C)},refresh:w,rotate:function(q,u,C){if($(q,Ja)){var M=C?q:Aa+q;if(u)db=Fa.tween([Aa],[M],u,function(){Aa=M%360;db=null;ma++});else{Aa=M%360;ma++}return S}else return Aa},scale:s,setMaxOffset:function(q,u,C,M){Ya=q;Za=u;ob=C;pb=M},offset:r,viewport:z};ra(S);S.bind("resize",
k);S.bind("layerRemove",function(q,u){var C=Ga(L,u.id);if(C>=0&&C<R){L.splice(C,1);ma++}R=L.length});hb(S,c,{container:B,captureHover:h,scalable:h,pannable:h,renderer:m});o("markers","draw",{zindex:20});B(a);if(W&&!$(window.attachEvent,Pa))window.attachEvent("onresize",k);else W&&window.addEventListener("resize",k,false);c.copyright&&t(c.copyright);Qa.attach(G);return S},Fa=function(){return{tween:function(a,c,b,f,i){function j(v){var B=v-p;v=p+m<=v;for(var G=e;G--;)l[G]=k(B,a[G],g[G],m);i&&i.invalidate();
if(v||h){Qa.detach(j);for(G=0;G<d.length;G++)d[G]&&d[G](l,B,h)}}b=Q({easing:"sine.out",duration:1E3,complete:null},b);var e=a.length,l=[].concat(a),d=[f,b.complete],k=va(b.easing),g=[],h=false,m=b.duration,p=(new Date).getTime();for(b=e;b--;)g[b]=c[b]-a[b];Qa.attach(j);return function(v){h=v;return l}},tweenDrawable:function(a,c,b,f,i){var j=Fa.tween([b],[f],i,function(){a[c]=f;for(var l=a.tweens.length;l--;)if(a.tweens[l]===e){a.tweens.splice(l,1);break}},a.view),e=function(){a[c]=j()[0]};return e}}}(),
Ta=function(a,c,b){b=Q({style:null,xy:null,size:20,fill:false,stroke:true,draggable:false,properties:{},typeName:"Shape",zindex:0},b);Q(this,b);if($(this.xy,Ia))this.xy=new a.XY(this.xy);this.id="drawable_"+Qb++;this.bounds=null;this.view=a;this.layer=c;this.tweens=[];this.rotation=this.animations=0;this.scaling=1;this.translateY=this.translateX=0;ra(this);var f=this;f.initialized=false;this.bind("initialized",function(){f.initialized=true})};Ta.prototype={constructor:Ta,applyTweens:function(){for(var a=
this.tweens.length;a--;)this.tweens[a]()},drag:null,draw:null,getProps:null,resync:function(){if(this.xy){this.xy.sync(this.view);if(this.size){var a=this.size>>1;this.updateBounds(new oa(this.xy.x-a,this.xy.y-a,this.size,this.size))}}return this},rotate:function(a,c,b){if($(a,Ja)){a=(b?a:this.rotation*Ba+a)*Oa;if(c)this.tweens.push(Fa.tweenDrawable(this,"rotation",this.rotation,a,c));else{this.rotation=a;this.view.invalidate()}return this}else return this.rotation*Ba},scale:function(a,c,b){if($(a,
Ja)){a=b?a:this.scaling*a;if(c)this.tweens.push(Fa.tweenDrawable(this,"scaling",this.scaling,a,c));else{this.scaling=a;this.view.invalidate()}return this}else return this.scaling},translate:function(a,c,b,f){if($(a,Ja)){a=f?a:this.translateX+a;c=f?c:this.translateY+c;if(b){this.tweens.push(Fa.tweenDrawable(this,"translateX",this.translateX,a,b));this.tweens.push(Fa.tweenDrawable(this,"translateY",this.translateY,c,b))}else{this.translateX=a;this.translateY=c;this.view.invalidate()}return this}else return new aa(this.translateX,
this.translateY)},updateBounds:function(a,c){a&&(!this.bounds||a.x!=this.bounds.x||a.y!=this.bounds.y)&&this.trigger("move",this,a,this.bounds);this.bounds=a;if(c)this.xy=this.bounds.center()}};xa("drawable","marker",function(a,c,b){b=Q({fill:true,stroke:false,markerType:"simple",hoverStyle:"highlight",typeName:"Marker"},b);return new Ta(a,c,b)});xa("drawable","poly",function(a,c,b){function f(){var g,h,m,p,v,B,G,O;d=b.simplify?l.simplify():l;O=d.points;for(g=O.length;g--;){h=O[g].x;m=O[g].y;B=$(B,
Pa)||h<B?h:B;G=$(G,Pa)||m<G?m:G;p=$(p,Pa)||h>p?h:p;v=$(v,Pa)||m>v?m:v}k.updateBounds(new oa(B,G,p-B,v-G),true);k.trigger("pointsUpdate",k,O);a.invalidate()}function i(g){if($(g,"array")){var h;l=new ua(b.allowCull);h=l.points;Ab.process(g,function(m,p){for(var v=0;v<p;v++)h.push(new a.XY(m[v]))},k.initialized?j:null,e);return k}else return d}function j(){l.points.length&&Ab.process(l.points,function(g,h){for(var m=h;m--;)g[m].sync(a)},f,e)}b=Q({allowCull:false,simplify:false,fill:true,points:[],typeName:"Poly"},
b);var e=500,l=new ua(b.allowCull),d=new ua(b.allowCull),k=Q(new Ta(a,c,b),{line:i,resync:j});i(b.points);return k});xa("drawable","line",function(a,c,b){b.fill=false;b.allowCull=true;return Xa("drawable","poly",a,c,b)});xa("drawable","image",function(a,c,b){function f(){if(d&&d.width>0){if(!this.centerOffset)this.centerOffset=new aa(-d.width>>1,-d.height>>1);this.updateBounds(new oa(this.xy.x+this.centerOffset.x,this.xy.y+this.centerOffset.y,d.width,d.height),false)}}function i(g){if(this.imageUrl=
g){var h=this;kb(this.imageUrl,function(m,p){d=m;if(p){var v=k.layer?k.layer.view:null;v&&v.invalidate()}f.apply(h)})}}b=Q({image:null,imageUrl:null,centerOffset:null,typeName:"Image"},b);var j=Ta.prototype.resync,e=0,l=0,d=b.image,k=Q(new Ta(a,c,b),{changeImage:i,getProps:function(){this.bounds||f(this,d);return{image:d,x:this.xy.x+e,y:this.xy.y+l}},resync:function(g){j.call(this,g);f.call(this)}});d||i.call(this,this.imageUrl);if(this.centerOffset){e=this.centerOffset.x;l=this.centerOffset.y}return k});
xa("drawable","arc",function(a,c,b){b=Q({startAngle:0,endAngle:Math.PI*2,typeName:"Arc"},b);return new Ta(a,c,b)});Ca.prototype={constructor:Ca,clip:null,cycle:function(){},draw:function(){},hitGuess:null,remove:function(){this.view.trigger("layerRemove",this)}};xa("layer","tile",function(a,c,b,f){f=Q({generator:"osm",imageLoadArgs:{}},f);var i=Xa("generator",f.generator,a,f).run,j=null,e=[];c=Q(new Ca(a,c,b,f),{draw:function(l,d,k){l.drawTiles&&l.drawTiles(d,j.search(d.buffer(128)),k.panSpeed<2)}});
a.bind("resync",function(){var l=a&&a.zoom?a.zoom():0;e[l]||(e[l]=Va(l));j=e[l]});a.bind("refresh",function(){j&&i(j,a.invalidate)});a.bind("reset",function(){j.clear()});return c});xa("layer","draw",function(a,c,b,f){function i(k,g,h,m){var p=this.dragOffset;if(!p)p=this.dragOffset=new a.XY(k.startX-this.xy.x,k.startY-this.xy.y);this.xy.x=g-p.x;this.xy.y=h-p.y;if(m){delete this.dragOffset;a.invalidate();this.xy.sync(a,true);this.trigger("dragDrop")}return true}function j(k,g,h,m){if(e){m&&e.remove(m,
g);e.insert(h,g)}}f=Q({zindex:10},f);var e,l,d=Q(new Ca(a,c,b,f),{clear:function(){if(e){e.clear();d.trigger("cleared");a.invalidate()}},create:function(k,g){var h=Xa("drawable",k,a,d,g);h.resync();e&&h.bounds&&e.insert(h.bounds,h);h.bind("move",j);h.trigger("created");d.trigger(k+"Added",h);return h},draw:function(k,g,h,m,p){h={};m=e&&g?e.search(g):[];for(var v=m.length;v--;){var B=m[v],G=B.style||d.style,O,t,E=B.getProps?B.getProps(k):h;O=k["prep"+B.typeName];B.tweens.length>0&&B.applyTweens();
t=k.applyTransform(B);if(E=O?O.call(k,B,g,p,E):null){if(p&&E.hit){p.elements.push(Hits.initHit(B.type,B,B.draggable?i:null));O=p.type+"Style";G=B[O]||d[O]||G}G=G?k.applyStyle(G,true):null;(O=B.draw||E.draw)&&O.call(B,E);G&&k.applyStyle(G)}t&&t.undo&&t.undo()}},find:function(){return e.all()},hitGuess:function(k,g){return e&&e.search({x:k-5,y:g-5,w:10,h:10}).length>0}});l=a.bind("resync",function(){var k=e?e.all():[];e=Va(a.zoom(),e);for(var g=k.length;g--;)k[g].resync()});a.bind("layerRemove",function(k,
g){if(g===d){e=null;a.unbind("resync",l)}});return d});Ha.prototype={constructor:Ha};xa("control","zoombar",function(a,c,b,f){function i(s,r){var F=E[s]=W.create("div","t5-zoombar-button",{position:"absolute",background:j(s),"z-index":51,width:f.width+"px",height:f.buttonHeight+"px","margin-top":(r||0)+"px"});z.appendChild(F)}function j(s,r){return"url("+f.images+") 0 -"+(h+p*3+(s||0)*k*3+(r||0)*k)+"px"}function e(s){return"url("+f.images+") 0 -"+(h+(s||0)*p)+"px"}function l(s,r){var F;if(s===m){m.style.background=
e(r);F="thumb"}else for(var D=0;D<E.length;D++)if(s===E[D]){F="button"+D;E[D].style.background=j(D,r);break}return F}function d(s){if(s!==O){O=s;G=B-O/t*(B-v)|0;W.move(m,0,G-v);clearTimeout(o);o=setTimeout(function(){a.zoom(O)},500)}}f=Q({width:24,height:200,images:"img/zoom.png",align:"right",marginTop:10,spacing:10,thumbHeight:16,buttonHeight:16},f);var k=f.buttonHeight,g,h=f.height,m,p=f.thumbHeight,v=f.spacing+k-(p>>1),B=f.height-k-(p>>1),G=v,O=-1;c=a.minZoom();var t=a.maxZoom()-c+1,E=[],z,o=
0,w={button0:function(){a.zoom(a.zoom()+1)},button1:function(){a.zoom(a.zoom()-1)}};z=W.create("div","t5-zoombar",{position:"absolute",background:"url("+f.images+")","z-index":50,overflow:"hidden",width:f.width+"px",height:f.height+"px",margin:function(){var s=f.spacing,r=Z("{0}px 0 0 {1}px");if(f.align==="right")s=b.offsetWidth-f.width-f.spacing;return r(f.marginTop,s)}()});b.childNodes[0]?b.insertBefore(z,b.childNodes[0]):b.appendChild(z);z.appendChild(m=W.create("div","t5-zoombar-thumb",{position:"absolute",
background:e(),"z-index":51,width:f.width+"px",height:f.thumbHeight+"px",margin:"10px 0 0 0",top:G-v+"px"}));i(0);i(1,f.height-f.buttonHeight);g=INTERACT.watch(z,{bindTarget:z});g.bind("pointerMove",function(s,r,F){G=Math.min(Math.max(v,F.y-(p>>1)),B);d(t-(G-v)/B*t|0)});g.bind("pointerDown",function(s){l(s.target,2)});g.bind("pointerUp",function(s){l(s.target,0)});g.bind("tap",function(s){(s=w[l(s.target,2)])&&s()});c=new Ha(a);c.bind("detach",function(){g.unbind();b.removeChild(z)});a.bind("zoom",
function(s,r){d(r)});d(a.zoom());return c});xa("control","copyright",function(a,c,b,f){function i(){j(a.getCopy())}function j(l){if(e){e.innerHTML=l;l=e.style;var d;a.viewport();d=W.rect(b);var k=f.spacing,g=d.h-e.offsetHeight-f.spacing,h=Z("{0}px 0 0 {1}px");if(f.align==="right")k=d.w-e.offsetWidth-f.spacing;d=h(g,k);l.margin=d}}f=Q({align:"right",text:null,spacing:5},f);var e;(function(){var l=W.rect(b),d=f.text||a.getCopy();e=W.create("div","t5-copyright",{position:"absolute",overflow:"hidden",
"max-width":Math.max(l.w>>1,Math.min(400,l.w-f.spacing*2))+"px","z-index":49});b.childNodes[0]?b.insertBefore(e,b.childNodes[0]):b.appendChild(e);d&&j(d)})();c=Q(new Ha(a),{getText:function(){return e?e.innerHTML:""},setText:j});c.bind("detach",function(){e&&b.removeChild(e)});f.text||a.bind("copyright",i);return c});Q(X,{ex:Q,log:La,observable:ra,configurable:hb,formatter:Z,wordExists:function(a,c){for(var b=a.split(/\s|\,/).length;b--;)if(a.toLowerCase()==c.toLowerCase())return true;return false},
is:$,indexOf:Ga,fn:function(a){return Pb("fn",a)},project:ib,unproject:sb,getImage:kb,Registry:Na,Style:Bb,DOM:W,Rect:oa,XY:aa,GeoXY:na,Line:ua,Hits:Hits,Control:Ha,Tile:Ma,Tweener:Fa,ViewLayer:Ca,View:Lb,Map:function(a,c){function b(g,h){var m=k.viewport();if(g){m=K(g.bestZoomLevel(m.w,m.h)-1,h||0);return f(m).center(g.center())}else return new GeoJS.BBox((new na(m.x,m.y2)).sync(k,true).pos(),(new na(m.x2,m.y)).sync(k,true).pos())}function f(g,h,m){if($(g,Ja)){g=K(c.minZoom,A(c.maxZoom,g|0));if(g!==
e){var p=k.viewport(),v=k.offset(),B=p.w/2;p=p.h/2;var G=Y(2,g-e),O=B/G|0,t=p/G|0;e=g;k.offset(((h||v.x+B)-O)*G,((m||v.y+p)-t)*G);k.trigger("zoom",g);k.trigger("reset");j=k.rpp=la/(256<<e);k.setMaxOffset(la/j|0,la/j|0,true,false);k.scale(1+l,false,true);l=0;k.trigger("resync");k.refresh()}return k}else return e}c=Q({controls:["zoombar","copyright"],minZoom:1,maxZoom:18,renderer:"canvas/dom",zoom:1,zoombar:{}},c);var i=new na,j,e=c.zoom||c.zoomLevel,l=0,d=0,k=Q(new Lb(a,c),{XY:na,bounds:b,zoom:f});
j=k.rpp=la/(256<<e);k.bind("refresh",function(){var g=k.viewport();if(i.x!=g.x||i.y!=g.y){k.trigger("boundsChange",b());i.x=g.x;i.y=g.y}});k.bind("scaleChanged",function(g,h){var m=rb(h)/Math.LN2|0;if(m!==0){l=h-Y(2,m);clearTimeout(d);d=setTimeout(function(){f(e+m)},500)}});return k}});if(typeof module!="undefined"&&module.exports)module.exports=X;X.Decarta=function(){function a(t){return m(e.clientName,e.clientPassword,e.sessionID,e.configuration,e.release,t)}function c(t,E){return p(t.maxResponses,
t.version,t.requestID,t.methodName,E)}function b(t,E){e.server||X.log("No server configured for deCarta - we are going to have issues","warn");return v(e.server,t.requestID,escape(E))}function f(t,E,z){La("making request: "+a(c(t,t.getRequestBody())));$a(b(t,a(c(t,t.getRequestBody()))),function(o){console.log(o.response);var w=o.response.XLS.Response;if(w.numberOfResponses>0&&w[t.methodName+"Response"]){o=[];if(t.parseResponse)o=t.parseResponse(w[t.methodName+"Response"]);E&&E.apply(null,o)}else z&&
z("Server returned no responses",o.response)})}function i(t,E){var z=new B({json:t.StreetAddress}),o=[];if(t.Place){if(!t.Place.length)t.Place=[t.Place];for(var w=t.Place.length;w--;)o[o.length]=t.Place[w].content}return{building:z.building,street:z.street,regions:o,countryCode:t.countryCode||"",postalCode:t.PostalCode||"",pos:E}}function j(t){if(!t)return"";t=t.toUpperCase();if(!k){var E=[],z;for(z in g)E.push(z);k=RegExp("(\\s)("+E.join("|")+")(\\s|$)","i")}k.lastIndex=-1;if(E=k.exec(t))t=t.replace(k,
"$1"+g[E[2]]);return t}var e={sessionID:(new Date).getTime(),server:"",clientName:"",clientPassword:"",configuration:"",maxResponses:25,release:"4.4.2sp03",tileFormat:"PNG",fixedGrid:true,useCache:true,tileHosts:[],requestTimeout:3E4,geocoding:{countryCode:"US",language:"EN"}};TL=function(){function t(z,o){if(typeof z=="number"){this.days=z||0;this.seconds=o||0}else if(typeof z!="undefined"){this.days=z.days||0;this.seconds=z.seconds||0}}t.prototype={add:function(){for(var z=new t(this.days,this.seconds),
o=arguments.length;o--;){z.days+=arguments[o].days;z.seconds+=arguments[o].seconds}return z},toString:function(){var z,o,w,s="";if(this.days)s=this.days+" days ";if(this.seconds){w=this.seconds;if(w>=3600){z=~~(w/3600);w-=z*3600}if(w>=60){o=Math.round(w/60);w-=o*60}if(z)s=s+z+(z>1?" hrs ":" hr ")+(o?(o>10?o:"0"+o)+" min ":"");else if(o)s=s+o+" min";else if(w>0)s=s+(w>10?w:"0"+w)+" sec"}return s}};var E=function(){var z=/^P(\d+Y)?(\d+M)?(\d+D)?$/,o=/^(\d+H)?(\d+M)?(\d+S)?$/,w={8601:function(s){s=s.split("T");
var r=null;r=null;var F=0,D=0;z.lastIndex=-1;r=z.exec(s[0]);F+=r[3]?parseInt(r[3].slice(0,-1),10):0;o.lastIndex=-1;r=o.exec(s[1]);D+=r[1]?parseInt(r[1].slice(0,-1),10)*3600:0;D+=r[2]?parseInt(r[2].slice(0,-1),10)*60:0;D+=r[3]?parseInt(r[3].slice(0,-1),10):0;return new t(F,D)}};return function(s,r){var F=w[r];if(!F)throw"No parser found for the duration format: "+r;return F(s)}}();return{Duration:t,parse:E}}();var l=/^(\d+).*$/,d=/(\d+)\s?\-\s?(\d+)/,k=null,g={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",
CT:"COURT",LN:"LANE",HWY:"HIGHWAY",MWY:"MOTORWAY"},h=1,m=Z("<xls:XLS version='1' xls:lang='en' xmlns:xls='http://www.opengis.net/xls' rel='{4}' xmlns:gml='http://www.opengis.net/gml'><xls:RequestHeader clientName='{0}' clientPassword='{1}' sessionID='{2}' configuration='{3}' />{5}</xls:XLS>"),p=Z("<xls:Request maximumResponses='{0}' version='{1}' requestID='{2}' methodName='{3}Request'>{4}</xls:Request>"),v=Z("{0}/JSON?reqID={1}&chunkNo=1&numChunks=1&data={2}&responseFormat=JSON"),B=function(t){t=
X.ex({json:{}},t);var E="",z="";if(t.json.Street)E=t.json.Street.content?t.json.Street.content:t.json.Street;E=E&&E.replace?E.replace(/\/\d+$/,""):"";if(t.json.Building)if(t.json.Building.number)z=t.json.Building.number;return{building:z,street:E,calcMatchPercentage:function(o){var w=0,s=j(o),r=j(E);if(t.json.Building){a:{var F=t.json.Building.number.toString();l.lastIndex=-1;if(l.test(o)){o=o.replace(l,"$1");F=F.split(",");for(var D=0;D<F.length;D++){d.lastIndex=-1;if(d.test(F[D])){var J=d.exec(F[D]);
if(o>=parseInt(J[1],10)&&o<=parseInt(J[2],10)){o=true;break a}}else if(o==F[D]){o=true;break a}}}o=false}if(o)w+=0.2}if(s&&r&&X.wordExists(s,r))w+=0.8;return w},toString:function(){if(E)return(z?z+" ":"")+E;return""}}},G=function(){return{methodName:"",maxResponses:25,version:"1.0",requestID:h++,getRequestBody:function(){return""},parseResponse:function(t){return[t]}}},O=function(){return X.ex(new G,{methodName:"RUOK",parseResponse:function(t){return[{aliasCount:t.maxHostAliases,host:t.hostName}]}})};
X.Registry.register("generator","decarta",function(t,E){function z(s,r){var F=t.zoom?t.zoom():0,D=t.viewport();if(F){var J=2<<F-1,U=J>>1,T=E.tileSize,V=(D.w/T|0)+1,I=(D.h/T|0)+1,L=(D.x/T|0)-U;D=J-(D.y/T|0)-U-I;var R=s.search({x:(U+L)*T,y:(U+D*-1-I)*T,w:V*T,h:I*T});J={};var ea=w.hosts,H;for(H=R.length;H--;)J[R[H].id]=true;for(R=0;R<=V;R++)for(H=0;H<=I;H++){var N=L+R,P=D+H-1,ba=N+"_"+P;if(!J[ba]){N=new X.Tile((U+L+R)*T,(U+D*-1-H)*T,ea[R%ea.length]+"/openls/image-cache/TILE?LLMIN=0.0,0.0&LLMAX="+o[F]+
"&CACHEABLE=true&DS=navteq-world&WIDTH=256&HEIGHT=256&CLIENTNAME="+w.clientName+"&SESSIONID="+w.sessionID+"&FORMAT=PNG&CONFIG="+w.configuration+"&N="+P+"&E="+N,T,T,ba);s.insert(N,N)}}r&&r()}}E=X.ex({tileSize:256},E);var o=["89.787438015348100000,360.00000000000000000","85.084059050110410000,180.00000000000000000","66.653475896509040000,90.00000000000000000","41.170427238429790000,45.000000000000000000","22.076741328793200000,22.500000000000000000","11.251819676168665000,11.250000000000000000","5.653589942659626000,5.625000000000000000",
"2.830287664051185000,2.812500000000000000","1.415581451872543800,1.406250000000000000","0.707845460801532700,0.703125000000000000","0.353929573271679340,0.351562500000000000","0.176965641673330230,0.175781250000000000","0.088482927761462040,0.087890625000000000","0.044241477246363230,0.043945312500000000","0.022120740293895182,0.021972656250000000","0.011060370355776452,0.010986328125000000","0.005530185203987857,0.005493164062500000","0.002765092605263539,0.002746582031250000","0.001382546303032519,0.001373291015625000",
"0.000691272945568983,0.000686645507812500","0.000345636472797214,0.000343322753906250"],w=e.tileConfig;t.addCopy("&copy; deCarta, Inc. Map and Imagery Data &copy; NAVTEQ or Tele Atlas or DigitalGlobe");return{run:function(s,r){if(w)z(s,r);else{var F=e.clientName.replace(/.*?\:/,"");X.Decarta.getTileConfig(F,function(D){w=D;z(s,r)})}},setTileConfig:function(s){w=s}}});X.Registry.register("service","geocoder",function(){var t=X.formatter('<xls:GeocodeRequest><xls:Address countryCode="{0}" language="{1}">{2}</xls:Address></xls:GeocodeRequest>'),
E=X.formatter('<xls:StreetAddress><xls:Building number="{0}" /><xls:Street>{1}</xls:Street></xls:StreetAddress>'),z=function(w,s){s=X.ex({countryCode:e.geocoding.countryCode,language:e.geocoding.language},s);var r=new G;return X.ex({},r,{methodName:"Geocode",getRequestBody:function(){var F=E(w.number,w.street);F+='<xls:Place type="Municipality">'+w.regions.join(" ")+"</xls:Place>";return t(s.countryCode,s.language,F)},parseResponse:function(F){var D=F.GeocodeResponseList;F=[];var J=D?D.numberOfGeocodedAddresses:
0,U=[];if(J>1)U=D.GeocodedAddress;else if(J==1)U=[D.GeocodedAddress];for(D=0;U&&D<U.length;D++){J=U[D];var T=null,V=null;if(J&&J.GeocodeMatchCode&&J.GeocodeMatchCode.matchType!=="NO_MATCH"){if(J&&J.Point)V=new GeoJS.Pos(J.Point.pos);if(J&&J.Address)T=i(J.Address,V)}(J=T)&&F.push(J)}return[F]}})},o=function(w){w=X.ex({position:null,geocodePreference:"StreetAddress"},w);return X.ex(new G,{methodName:"ReverseGeocode",getRequestBody:function(){return"<xls:ReverseGeocodeRequest><xls:Position><gml:Point><gml:pos>"+
w.position.toString()+"</gml:pos></gml:Point></xls:Position><xls:ReverseGeocodePreference>"+w.geocodePreference+"</xls:ReverseGeocodePreference></xls:ReverseGeocodeRequest>"},parseResponse:function(s){var r=null;if(s&&s.Point)r=new GeoJS.Pos(match.Point.pos);if(s&&s.ReverseGeocodedLocation&&s.ReverseGeocodedLocation.Address)return[i(s.ReverseGeocodedLocation.Address,r)];return[]}})};typeof ADDR==="undefined"&&X.log("Sidelab addressing module not found, geocoder will not function","warn");return{forward:function(w,
s){f(new z(w),function(r){s(w,r)})},reverse:function(w,s){var r=new o({position:w});f(r,function(F){s&&s(F)})}}});X.Registry.register("service","routing",function(){var t=function(E,z){z=X.ex({provideRouteHandle:false,distanceUnit:"KM",routeQueryType:"RMAN",preference:"Fastest",routeInstructions:true,routeGeometry:true},z);var o=new G,w=X.formatter('<xls:DetermineRouteRequest provideRouteHandle="{0}" distanceUnit="{1}" routeQueryType="{2}">'),s=X.formatter("<xls:{0}><xls:Position><gml:Point><gml:pos>{1}</gml:pos></gml:Point></xls:Position></xls:{0}>");
return X.ex({},o,{methodName:"DetermineRoute",getRequestBody:function(){if(E.length<2)throw Error("Cannot send RouteRequest, less than 2 waypoints specified");var r=w(z.provideRouteHandle,z.distanceUnit,z.routeQueryType);r+="<xls:RoutePlan>";r+="<xls:RoutePreference>"+z.preference+"</xls:RoutePreference>";r+="<xls:WayPointList>";for(var F=0;F<E.length;F++)r+=s(F===0?"StartPoint":F===E.length-1?"EndPoint":"ViaPoint",E[F].toString());r+="</xls:WayPointList>";r+="</xls:RoutePlan>";if(z.routeInstructions)r+=
'<xls:RouteInstructionsRequest rules="maneuver-rules" providePoint="true" />';if(z.routeGeometry)r+="<xls:RouteGeometryRequest />";r+="</xls:DetermineRouteRequest>";return r},parseResponse:function(r){var F=r.RouteGeometry.LineString.pos,D=r.RouteInstructionsList;r=[];D=D&&D.RouteInstruction?D.RouteInstruction:[];for(var J=0;J<D.length;J++){var U=D[J].distance;r.push({text:D[J].Instruction,latlng:D[J].Point,distance:U.value+(U.uom||"M").toUpperCase(),time:TL.parse(D[J].duration,"8601")})}return[F,
r]}})};return{calculate:function(E,z,o,w){w=X.ex({preference:"Fastest"},w);E=new t(E,w);f(E,z,o)}}});return{applyConfig:function(t){X.ex(e,t)},getTileConfig:function(t,E){f(new O,function(z){var o=e.clientName.replace(/\:.*/,":"+(t||""));hosts=[];if(z.aliasCount)for(var w=0;w<z.aliasCount;w++)hosts[w]="http://"+z.host.replace("^(.*?).(.*)$","\u0001-0"+(w+1)+".\u0002");else hosts=["http://"+z.host];E({hosts:hosts,clientName:o,sessionID:e.sessionID,configuration:e.configuration})})},setTileConfig:function(t){e.tileConfig=
t},compareFns:function(){return{streetDetails:function(t,E){return E.calcMatchPercentage(t)},location:function(t,E){return E.calcMatchPercentage(t)}}}()}}()})();
