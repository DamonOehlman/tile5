(function(hb){function M(){var a=arguments[0]||{},b=Array.prototype.slice.call(arguments,1),c,h;for(h=b.length;h--;)if((c=b[h])!==null)for(var k in c){var e=c[k];if(a!==e)if(e!==undefined)a[k]=e}return a}function aa(a,b){if(typeof console!=="undefined")console[b||"debug"](a)}function ja(a){var b=a.match(Fb),c=[],h=0,k;for(k=b?b.length:0;k--;){var e=b[k].slice(1);c[e]||(c[e]=RegExp("\\{"+e+"\\}","g"))}h=c.length;return function(){var j=a;for(k=0;k<h;k++)j=j.replace(c[k],arguments[k]||"");return j}}
function Ua(a){a=a.replace(/[\-\_\s\.]/g,"").toLowerCase();return Aa[a]||Aa.linear}function ib(a,b,c,h,k){function e(i){i=i?i:(new Date).getTime();if(d+jb<i){var f=i-j,s=c(f,a,g,h),l=j+h<=i;i=!l;if(k){f=k(s,l,f);i=typeof f!="undefined"?f&&i:i}i&&animFrame(e)}}var j=(new Date).getTime(),d=0,g=b-a;animFrame(e);return{}}function kb(a){a=parseFloat(a)*ka;a=ta(a);var b=Ja*a;return ma((1+a)/(1-a)*na((1-b)/(1+b),Ja))/2}function lb(a){return ga/(256<<a)}function mb(a,b){var c=Ja*ta(a);return Ba-2*nb(b*na((1-
c)/(1+c),Ja/2))}function T(a,b){this.mercY=this.mercX=null;if(W(a,Ca))ob.parseXY(a,this);else if(a&&a.toPixels){var c=a.toPixels();this.mercX=c.x;this.mercY=c.y}else{this.x=a||0;this.y=b||0}}function oa(a,b,c,h){this.x=a||0;this.y=b||0;this.w=c||0;this.h=h||0;this.x2=this.x+this.w;this.y2=this.y+this.h}function pb(a,b){var c=new qb(Math.sqrt(256<<a)|0);b&&b.zoomLevel===a&&b.copyInto(c);c.zoomLevel=a;return c}function rb(a){a=a||(new Date).getTime();for(var b=0;b<wa.length;){var c=wa[b],h=ua[c],k=
ua[c].image&&ua[c].image.complete&&ua[c].image.width>0,e=a-h.start;e=k||e>=Gb;if(k){k=h.callbacks;sb[c]=h.image;for(var j=0;j<k.length;j++)k[j](h.image,true)}if(e){wa.splice(b,1);delete ua[c]}else b++}wa.length>0&&animFrame(rb)}function Ka(a,b){var c=a&&b?sb[a]:null;if(c&&c&&c.complete&&c.width>0)b(c);else{if(c=ua[a])c.callbacks.push(b);else{c=new Image;c.id="_ldimg"+ ++Hb;ua[a]={start:(new Date).getTime(),image:c,callbacks:[b]};c.src=a;wa[wa.length]=a}animFrame(rb)}}function Va(a,b,c,h,k,e){this.x=
a;this.y=b;this.w=h||256;this.h=h||256;this.x2=this.x+this.w;this.y2=this.y+this.h;this.url=c;this.id=e||a+"_"+b;this.loaded=false;this.image=null}function tb(a){a=a?a:(new Date).getTime();if(a-ub>jb){for(var b=Da.splice(0),c=b.length;c--;)b[c](a);ub=a}Da.length&&animFrame(tb)}function vb(a){var b=Da.length==0;Da[Da.length]=a;b&&animFrame(tb)}function Ib(a,b,c,h,k){k=M({easing:"sine.out",duration:1E3,progress:null,complete:null,autoInvalidate:true},k);var e=(new Date).getTime(),j=a[b],d=b=="translate",
g=k.autoInvalidate,i=c.length&&h.length&&c.length==h.length?c.length:0,f=Array(i),s=Array(i),l=Ua(k.easing),q=k.duration,u=k.progress,m=function(r){var o=r-e;r=e+q<=r;for(var v=a.layer?a.layer.view:null,A,z=i;z--;){A=l(o,c[z],f[z],q);s[z]=d?A|0:A}j.apply(a,s);g&&v&&v.invalidate();if(u){o=[].concat(r?h:s);o.unshift(r);u.apply(a,o)}if(r){a.animations--;j.apply(a,h);k.complete&&k.complete.apply(a,h)}else vb(m)};if(j&&j.apply&&i>0){q=q?q:DEFAULT_DURATION;for(b=i;b--;)f[b]=h[b]-c[b];a.animations++;vb(m)}}
function La(a,b){b=M({id:"layer_"+Jb++,zindex:0,animated:false,style:null,minXY:null,maxXY:null},b);this.visible=true;ia(M(this,b))}function Ma(){ia(this)}function la(a,b){if(a&&a.split){var c=a.split(wb);if(c.length>1){a=c[0];b=c[1]}}else if(a&&a.lat){b=a.lon;a=a.lat}this.lat=parseFloat(a||0);this.lon=parseFloat(b||0)}function Ea(a,b){if(W(a,Kb)){for(var c=b,h=this.min=new la(xb,yb),k=this.max=new la(Lb,Mb),e=a.length;e--;){var j=a[e];if(j.lat<h.lat)h.lat=j.lat;if(j.lat>k.lat)k.lat=j.lat;if(j.lon<
h.lon)h.lon=j.lon;if(j.lon>k.lon)k.lon=j.lon}if(W(c,pa)){c=calcSize(bounds.min,bounds.max);c=Wa(c.x,c.y)*0.3}this.expand(c)}else{this.min=a;this.max=b}}var Xa={};(function(a){var b=[],c=0,h=false,k=a.register=function(e,j){b.push({section:e,run:j})};a.init=function(e){function j(){if(c<b.length){var g=b[c++];d[g.section]||(d[g.section]={});g.run(d[g.section],j)}else{for(g in d)a[g]=d[g];h=true;e&&e(a)}}var d={};if(h&&e)e(a);else{c=0;j()}};k("canvas",function(e,j){function d(){var s,l=g.getContext("2d");
l.save();try{l.translate(50,50);l.beginPath();l.rect(0,0,20,20);s=l.isPointInPath(10,10)}finally{l.restore()}return s}var g=document.createElement("canvas"),i=typeof FlashCanvas!="undefined",f=typeof G_vmlCanvasManager!="undefnined";g.width=200;g.height=200;e.pipTransformed=i||f?false:d();j()})})(Xa);window.animFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){setTimeout(function(){a((new Date).getTime())},
1E3/60)}}();var Fb=/\{(\d+)(?=\})/g,Aa=function(){var a=1.70158,b=Math.PI/2,c=Math.abs,h=Math.pow,k=Math.sin,e=Math.asin,j=Math.cos;return{linear:function(d,g,i,f){return i*d/f+g},backin:function(d,g,i,f){return i*(d/=f)*d*((a+1)*d-a)+g},backout:function(d,g,i,f){return i*((d=d/f-1)*d*((a+1)*d+a)+1)+g},backinout:function(d,g,i,f){return(d/=f/2)<1?i/2*d*d*(((a*=1.525)+1)*d-a)+g:i/2*((d-=2)*d*(((a*=1.525)+1)*d+a)+2)+g},bouncein:function(d,g,i,f){return i-Aa.bounceout(f-d,0,i,f)+g},bounceout:function(d,
g,i,f){return(d/=f)<1/2.75?i*7.5625*d*d+g:d<2/2.75?i*(7.5625*(d-=1.5/2.75)*d+0.75)+g:d<2.5/2.75?i*(7.5625*(d-=2.25/2.75)*d+0.9375)+g:i*(7.5625*(d-=2.625/2.75)*d+0.984375)+g},bounceinout:function(d,g,i,f){return d<f/2?Aa.bouncein(d*2,0,i,f)/2+g:Aa.bounceout(d*2-f,0,i,f)/2+i/2+g},cubicin:function(d,g,i,f){return i*(d/=f)*d*d+g},cubicout:function(d,g,i,f){return i*((d=d/f-1)*d*d+1)+g},cubicinout:function(d,g,i,f){if((d/=f/2)<1)return i/2*d*d*d+g;return i/2*((d-=2)*d*d+2)+g},elasticin:function(d,g,i,
f,s,l){if(d==0)return g;if((d/=f)==1)return g+i;l||(l=f*0.3);if(!s||s<c(i)){s=i;i=l/4}else i=l/ga*e(i/s);return-(s*h(2,10*(d-=1))*k((d*f-i)*ga/l))+g},elasticout:function(d,g,i,f,s,l){var q;if(d==0)return g;if((d/=f)==1)return g+i;l||(l=f*0.3);if(!s||s<c(i)){s=i;q=l/4}else q=l/ga*e(i/s);return s*h(2,-10*d)*k((d*f-q)*ga/l)+i+g},elasticinout:function(d,g,i,f,s,l){var q;if(d==0)return g;if((d/=f/2)==2)return g+i;l||(l=f*0.3*1.5);if(!s||s<c(i)){s=i;q=l/4}else q=l/ga*e(i/s);if(d<1)return-0.5*s*h(2,10*(d-=
1))*k((d*f-q)*ga/l)+g;return s*h(2,-10*(d-=1))*k((d*f-q)*ga/l)*0.5+i+g},quadin:function(d,g,i,f){return i*(d/=f)*d+g},quadout:function(d,g,i,f){return-i*(d/=f)*(d-2)+g},quadinout:function(d,g,i,f){if((d/=f/2)<1)return i/2*d*d+g;return-i/2*(--d*(d-2)-1)+g},sinein:function(d,g,i,f){return-i*j(d/f*b)+i+g},sineout:function(d,g,i,f){return i*k(d/f*b)+g},sineinout:function(d,g,i,f){return-i/2*(j(Math.PI*d/f)-1)+g}}}();if(typeof animFrame==="undefined")throw Error("animFrame COG required for tweening support");
var ia=function(){function a(c,h){var k=c.hasOwnProperty("obsHandlers")?c.obsHandlers:null;k[h]||(k[h]=[]);return k[h]}var b=0;return function(c){if(!c)return null;if(!(c.hasOwnProperty("obsHandlers")?c.obsHandlers:null))c.obsHandlers={};if(!c.hasOwnProperty("bind")){c.bind=function(h,k){var e="callback"+b++;a(c,h).unshift({fn:k,id:e});return e};c.triggerCustom=function(h,k){var e=a(c,h),j={cancel:false,name:h,source:this},d;for(d in k)j[d]=k[d];if(!e)return null;d=Array.prototype.slice.call(arguments,
2);c.eventInterceptor&&c.eventInterceptor(h,j,d);d.unshift(j);for(var g=e.length;g--&&!j.cancel;)e[g].fn.apply(this,d);return j};c.trigger=function(h){var k=Array.prototype.slice.call(arguments,1);k.splice(0,0,h,null);return c.triggerCustom.apply(this,k)};c.unbind=function(h,k){if(typeof h==="undefined")c.obsHandlers={};else for(var e=a(c,h),j=0;e&&j<e.length;j++)if(e[j].id===k){e.splice(j,1);break}return c}}return c}}(),Nb=function(){function a(b,c,h,k){if(typeof b[k]=="undefined")b[k]=function(e){if(typeof e!=
"undefined"){c[k]=e;h[k]&&h[k](e);return b}else return c[k]}}return function(b,c,h){for(var k in c)a(b,c,h,k)}}(),zb=Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1},W=function(){return function(a,b){b=Ob.call(b);if(b=="finite")return!Pb[Qb](+a);return b=="null"&&a===null||b==typeof a||b=="object"&&a===Object(a)||b=="array"&&Array.isArray&&Array.isArray(a)||Rb.call(a).slice(8,-1).toLowerCase()==b}}(),Sb=function(){function a(k){var e=document.createElement("script"),
j=false;e.src=k;e.async=true;e.onload=e.onreadystatechange=function(){if(!j&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){j=true;e.onload=e.onreadystatechange=null;e&&e.parentNode&&e.parentNode.removeChild(e)}};c||(c=document.getElementsByTagName("head")[0]);c.appendChild(e)}var b=0,c,h=this;return function(k,e,j){k+=k.indexOf("?")>=0?"&":"?";var d="json"+ ++b;h[d]=function(g){e(g);h[d]=null;try{delete h[d]}catch(i){}};a(k+(j?j:"callback")+"="+d);return d}}();INTERACT=
function(){function a(l){return function(q,u){l.addEventListener(q,u,false)}}function b(l){return function(q,u){l.removeEventListener(q,u,false)}}function c(l){return function(q,u){l.attachEvent("on"+q,u)}}function h(l,q){return{x:l?l:0,y:q?q:0,count:1}}function k(l,q){f.push(M({handler:null,checks:{},type:l},q))}function e(l){var q=0,u=0;if(l.offsetParent){do{q+=l.offsetLeft;u+=l.offsetTop;l=l.offsetParent}while(l)}return{left:q,top:u}}function j(l,q){return{source:l,target:q.target?q.target:q.srcElement}}
function d(l,q){for(var u=l.target?l.target:l.srcElement;u&&u!==q;)u=u.parentNode;return u&&u===q}function g(l,q){return{x:l.x-(q?q.left:0),y:l.y-(q?q.top:0)}}function i(l,q){if(l.preventDefault){l.preventDefault();l.stopPropagation()}else if(typeof l.cancelBubble!="undefined")l.cancelBubble=true;q&&l.stopImmediatePropagation&&l.stopImmediatePropagation()}var f=[],s=function(l,q,u){u=M({binder:null,unbinder:null,observable:null},u);for(var m=u.observable,r=[],o,v,A={bind:function(){return m.bind.apply(null,
arguments)},unbind:function(){m.unbind();for(z=0;z<r.length;z++)r[z].unbind();return A}},z=0;z<q.length;z++)r.push(q[z](l,m,u));m.bind("pointerDown",function(){v=o=0});m.bind("pointerMove",function(n,E,w,t){o+=t.x||0;v+=t.y||0});m.bind("pointerUp",function(n,E,w){Math.abs(o)>20||Math.abs(v)>20||m.triggerCustom("tap",n,E,w)});return A};k("pointer",{handler:function(l,q,u){function m(y){if(y.pageX&&y.pageY)return h(y.pageX,y.pageY);else{var L=document.documentElement,P=document.body;return h(y.clientX+
(L&&L.scrollLeft||P&&P.scrollLeft||0)-(L&&L.clientLeft||P&&P.clientLeft||0),y.clientY+(L&&L.scrollTop||P&&P.scrollTop||0)-(L&&L.clientTop||P&&P.clientTop||0))}}function r(y){if(d(y,l))if(t=z(y)){var L=m(y);l.style.cursor="move";i(y,true);J=L.x;K=L.y;C=h(J,K);q.triggerCustom("pointerDown",j("mouse",y),C,g(C,e(l)))}}function o(y){var L=m(y);B=L.x;F=L.y;if(d(y,l))n(y,t?"pointerMove":"pointerHover")}function v(y){if(t&&z(y)){t=false;if(d(y,l)){l.style.cursor="default";n(y,"pointerUp")}}}function A(y){if(d(y,
l)){var L;y=y||window.event;if(y.detail)L=y.axis===2?-y.detail*E:0;else{L=y.wheelDeltaY?y.wheelDeltaY:y.wheelDelta;if(window.opera)L=-L}if(L!==0){var P=h(B,F);q.triggerCustom("zoom",j("mouse",y),P,g(P,e(l)),L/w,"wheel");i(y);y.returnValue=false}}}function z(y){y=y||window.event;return(y.which||y.button)==1}function n(y,L,P,X,Y){P=typeof P!="undefined"?P:B;X=typeof X!="undefined"?X:F;var G=P-J,O=X-K,I=h(P,X);q.triggerCustom(L,j("mouse",y),I,g(I,e(l)),h(G,O));if(typeof Y=="undefined"||Y){J=P;K=X}}u=
M({},u);var E=120,w=E*8,t=false,C,B,F,J,K;u.binder("mousedown",r);u.binder("mousemove",o);u.binder("mouseup",v);u.binder("dblclick",function(y){aa("captured double click");if(d(y,l)){var L=m(y);q.triggerCustom("doubleTap",j("mouse",y),L,g(L,e(l)))}});u.binder("mousewheel",A);u.binder("DOMMouseScroll",A);return{unbind:function(){u.unbinder("mousedown",r);u.unbinder("mousemove",o);u.unbinder("mouseup",v);u.unbinder("mousewheel",A);u.unbinder("DOMMouseScroll",A)}}},checks:{touch:false}});k("pointer",
{handler:function(l,q,u){function m(G){if(G.count<2)return 0;var O=G.x-G.next.x;G=G.y-G.next.y;return~~Math.sqrt(O*O+G*G)}function r(G,O,I){O=O?O:0;I=I?I:0;for(var S={x:G.x-O,y:G.y-I,id:G.id,count:G.count},$=S;G.next;){G=G.next;$=$.next={x:G.x-O,y:G.y-I,id:G.id}}return S}function o(G,O){var I=G[O?O:"touches"],S,$;if(I.length===0)return null;$=S={x:I[0].pageX,y:I[0].pageY,id:I[0].identifier,count:I.length};for(var ba=1,Fa=I.length;ba<Fa;ba++)$=$.next={x:I[ba].pageX,y:I[ba].pageY,id:I[ba].identifier};
return S}function v(G){if(d(G,l)){F=e(l);var O=o(G,"changedTouches"),I=r(O,F.left,F.top);if(!K){J=t;q.triggerCustom("pointerDown",j("touch",G),O,I)}X&&q.triggerCustom("pointerDownMulti",j("touch",G),O,I);K=o(G);if(K.count>1)L=m(K);Y=1;P=r(K)}}function A(G){if(d(G,l)){i(G);y=o(G);if(J==t)J=Math.abs(K.x-y.x)>E||Math.abs(K.y-y.y)>E?w:t;if(J!=t){J=y.count>1?B:C;if(J==B)if(K.count===1){K=r(y);L=m(K)}else{var O=m(y);if(Math.abs(L-O)<n)J=C;else{var I;I=y.x;var S=y.next.x,$=y.y,ba=y.next.y;I={x:(I<S?I:S)+
(Math.abs(I-S)>>1),y:($<ba?$:ba)+(Math.abs($-ba)>>1)};O=O/L;S=O-Y;q.triggerCustom("zoom",j("touch",G),I,g(I,F),S,"pinch");Y=O}}J==C&&q.triggerCustom("pointerMove",j("touch",G),y,r(y,F.left,F.top),h(y.x-P.x,y.y-P.y));X&&q.triggerCustom("pointerMoveMulti",j("touch",G),y,r(y,F.left,F.top))}P=r(y)}}function z(G){if(d(G,l)){var O=o(G,"changedTouches"),I=r(O,F.left,F.top);y=o(G);if(!y){q.triggerCustom("pointerUp",j("touch",G),O,I);K=null}X&&q.triggerCustom("pointerUpMulti",j("touch",G),O,I)}}u=M({detailed:false,
inertia:false},u);var n=20,E=7,w=0,t=1,C=2,B=3,F,J,K,y,L,P,X=u.detailed,Y=1;u.binder("touchstart",v);u.binder("touchmove",A);u.binder("touchend",z);aa("initialized touch handler");return{unbind:function(){u.unbinder("touchstart",v);u.unbinder("touchmove",A);u.unbinder("touchend",z)}}},checks:{touch:true}});return{register:k,watch:function(l,q,u){q=M({bindTarget:null,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},q);capabilities=M({touch:"ontouchstart"in window},u);if(!q.observable){aa("creating observable");
q.observable=ia({});globalOpts=q}q.binder=(q.isIE?c:a)(q.bindTarget||document);q.unbinder=(q.isIE?c:b)(q.bindTarget||document);u=q.types;for(var m=capabilities,r=[],o=f.length;o--;){var v=f[o],A=!u||u.indexOf(v.type)>=0,z=true,n;for(n in v.checks){var E=v.checks[n];aa("checking "+n+" capability. require: "+E+", capability = "+m[n]);z=z&&E===m[n]}if(A&&z)r[r.length]=v.handler}return new s(l,r,q)}}}();var Ya=function(){var a={};return{create:function(b,c){if(a[b][c])return a[b][c].apply(null,Array.prototype.slice.call(arguments,
2))},register:function(b,c,h){a[b]||(a[b]={});a[b][c]&&aa(Tb(b,c),"warn");a[b][c]=h}}}(),Tb=ja("Registration of {0}: {1} will override existing definition"),Za=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],ga=Math.PI*2,Ba=Math.PI/2,ka=Math.PI/180,Na=180/Math.PI,xb=Ba,Lb=-xb,yb=ga,Mb=-yb,Ja=0.08181919084262157,qa=Math.abs,Ab=Math.ceil,xa=Math.round,Oa=Math.min,Wa=Math.max,na=Math.pow,Bb=Math.sqrt,ma=Math.log,ta=Math.sin,Ub=Math.asin,$a=Math.cos,nb=Math.atan,
Vb=Math.atan2,Qb="hasOwnProperty",Pb={NaN:1,Infinity:1,"-Infinity":1},Ob=String.prototype.toLowerCase,Rb=Object.prototype.toString,pa="undefined",Ca="string",ab="number",Kb="array",ra="drawable",ca=Ya.register,sa=Ya.create,Wb=0,Jb=0,wb=/[\,\s]+/,Xb=function(){function a(k){h++;k=k||(new Date).getTime();for(var e=c.length;e--;){var j=c[e];h%j.every===0&&j.cb(k)}animFrame(a)}var b=1E3/60,c=[],h=0;animFrame(a);return{attach:function(k,e){c[c.length]={cb:k,every:e?xa(e/b):1}},detact:function(){}}}(),
ob=function(){var a=/^xy\((.*)\).*$/i;return{parseXY:function(b,c){c=c||new T;if(!a.test(b)){var h=b.split(wb);c.mercX=parseFloat(h[1])*ka;c.mercY=kb(h[0])}return c}}}(),Z=function(){var a={"-webkit-user-select":"none",position:"absolute"},b;b=function(c){for(var h=0;h<c.length;h++){var k=c[h];if(typeof document.body.style[k]!="undefined")return k}}(["-webkit-transform","MozTransform"]);return{supportTransforms:b,create:function(c,h,k){c=document.createElement(c);var e=[];k=k||{};c.className=h||"";
for(var j in k)e[e.length]=j+": "+k[j];c.style.cssText=e.join(";");return c},move:function(c,h,k,e){if(b)c.style[b]="translate("+h+"px, "+k+"px) translateZ(0) "+(e||[]).join(" ");else{c.style.left=h+"px";c.style.top=k+"px"}},styles:function(c){return M({},a,c)}}}();T.prototype={constructor:T,add:function(){for(var a=this.x,b=this.y,c=arguments.length;c--;){a+=arguments[c].x;b+=arguments[c].y}return new T(a,b)},equals:function(a){return this.x===a.x&&this.y===a.y},offset:function(a,b){return new T(this.x+
a,this.y+b)},sync:function(a,b){if(b){this.mercX=this.x*a-Math.PI;this.mercY=Math.PI-this.y*a}else if(this.mercX||this.mercY){this.x=xa((this.mercX+Math.PI)/a);this.y=xa((Math.PI-this.mercY)/a)}return this},pos:function(){for(var a=na(Math.E,-this.mercY),b=Ba-2*nb(a),c=mb(b,a),h=0;h<12&&qa(b-c)>1.0E-7;){b=c;c=mb(b,a);h++}return new la(c*Na,this.mercX%360*Na)},toString:function(){return this.x+", "+this.y}};oa.prototype={constructor:oa,buffer:function(a,b){return new oa(this.x-a,this.y-(b||a),this.w+
a*2,this.h+(b||a)*2)},center:function(){return new T(this.x+(this.w>>1),this.y+(this.h>>1))}};Hits=function(){return{diffHits:function(a,b){var c=[],h={},k;for(k=b.length;k--;)h[b[k].target.id]=true;for(k=a.length;k--;)h[a[k].target.id]||(c[c.length]=a[k]);return c},init:function(a,b,c,h){return{type:a,x:h.x|0,y:h.y|0,elements:[],absXY:b,relXY:c}},initHit:function(a,b,c){return{type:a,target:b,drag:c}},triggerEvent:function(a,b,c,h){b.triggerCustom(a.type+(c?c:"Hit"),{hitType:a.type},h?h:a.elements,
a.absXY,a.relXY,new T(a.x,a.y))}}}();var qb=function(a){function b(e,j){var d=c[e],g;d||(d=c[e]=[]);(g=d[j])||(g=d[j]=[]);return g}a=a||128;var c=[],h={},k=0;return{copyInto:function(e){for(var j in h){var d=h[j];e.insert(d.bounds||d,d,j)}},insert:function(e,j,d){var g=e.x/a|0,i=e.y/a|0,f=(e.x+e.w)/a|0;e=(e.y+e.h)/a|0;d=d||j.id||"obj_"+k++;h[d]=j;for(j=g;j<=f;j++)for(g=i;g<=e;g++)b(j,g).push(d)},remove:function(e,j,d){d=d||j.id;if(h[d]){var g=e.x/a|0;j=e.y/a|0;var i=(e.x+e.w)/a|0;e=(e.y+e.h)/a|0;
delete h[d];for(g=g;g<=i;g++)for(var f=j;f<=e;f++){var s=b(g,f),l=zb.call(s,d);l>=0&&s.splice(l,1)}}},search:function(e){var j=e.y/a|0,d=(e.x+e.w)/a|0,g=(e.y+e.h)/a|0,i=[],f=[];for(e=e.x/a|0;e<=d;e++)for(var s=j;s<=g;s++)i=i.concat(b(e,s));i.sort();for(j=i.length;j--;){d=i[j];if(g=h[d])f[f.length]=g;for(;j>0&&i[j-1]==d;)j--}return f}}},Gb=3E4,sb={},Hb=0;(new Date).getTime();var ua={},wa=[];Va.prototype={constructor:Va,load:function(a){var b=this;Ka(this.url,function(c){b.loaded=true;b.image=c;a&&
a()})}};var Yb=function(){return ia({fastpan:true,applyStyle:function(){},applyTransform:function(a,b,c){return{restore:null,x:b,y:c}},checkSize:function(){},getDimensions:function(){return{width:0,height:0}},getViewport:function(){},hitTest:function(){return false},prepare:function(){},projectXY:null,reset:function(){}})};ca("renderer","canvas",function(a,b,c,h,k){function e(n,E,w){var t,C;q[E]=function(B){for(t=A.length;t--;)if(C=w[A[t]])B[z[t]]=C}}function j(n,E,w){var t=false;if(E)t=f.isPointInPath(m?
E.x-s:E.relXY.x,m?E.y-l:E.relXY.y);return{draw:w||v,viewport:n,hit:t,vpX:s,vpY:l,context:f}}h=M({},h);var d,g,i,f,s=0,l=0,q={},u=null,m=Xa.canvas.pipTransformed,r={},o=function(){},v=function(){this.fill&&f.fill();this.stroke&&f.stroke()},A=["fill","stroke","lineWidth","opacity"],z=["fillStyle","strokeStyle","lineWidth","globalAlpha"];if(b){d=b.offsetWidth;g=b.offsetHeight;i=Z.create("canvas",null,{position:"absolute","z-index":1});i.width=d;i.height=g;a.attachFrame(i,true);f=null}c=M(k,{applyStyle:function(n){var E=
q[n],w=f&&f.canvas?f.canvas.id:"default",t;r[w]||(r[w]=[]);t=r[w].pop()||"basic";if(E){r[w].push(n);E(f);return t}},applyTransform:function(n){if(n.translateX!==0||n.translateY!==0||n.scaling!==1||n.rotation!==0){f.save();u={undo:function(){f.restore();u=null},x:n.xy.x,y:n.xy.y};f.translate(n.xy.x-s+n.translateX,n.xy.y-l+n.translateY);n.rotation!==0&&f.rotate(n.rotation);n.scaling!==1&&f.scale(n.scaling,n.scaling)}return u},drawTiles:function(n,E,w){for(var t,C=s-256,B=l-256,F=n.x2,J=n.y2,K=E.length;K--;){n=
E[K];if(t=n.x>=C&&n.x<=F&&n.y>=B&&n.y<=J)if(!n.loaded&&w)n.load(a.invalidate);else n.image&&f.drawImage(n.image,n.x-s,n.y-l)}},prepare:function(n,E){var w,t=false,C=E.scaled||E;if(f)f.restore();else f=i.getContext("2d");for(w=n.length;w--;)t=t||n[w].clip;s=C.x;l=C.y;if(f){t||f.clearRect(0,0,d,g);f.save()}f.globalCompositeOperation="source-over";return f},prepArc:function(n,E,w){f.beginPath();f.arc(n.xy.x-(u?u.x:s),n.xy.y-(u?u.y:l),n.size>>1,n.startAngle,n.endAngle,false);return j(E,w)},prepImage:function(n,
E,w,t){var C=(t.x||n.xy.x)-(u?u.x:s),B=(t.y||n.xy.y)-(u?u.y:l),F=t.image||n.image;if(F){f.beginPath();f.rect(C,B,t.width||F.width,t.height||F.height);return j(E,w,function(){f.drawImage(F,C,B,t.width||F.width,t.height||F.height)})}},prepMarker:function(n,E,w){var t=n.xy.x-(u?u.x:s),C=n.xy.y-(u?u.y:l),B=n.size,F=undefined;f.beginPath();switch(n.markerStyle.toLowerCase()){case "image":F=o;f.rect(t-(B>>1),C-(B>>1),B,B);if(n.reset&&n.image){n.image=null;n.reset=false}n.image?f.drawImage(n.image,t-(B>>
1),C-(B>>1),B,B):Ka(n.imageUrl,function(J){n.image=J;f.drawImage(n.image,t-(B>>1),C-(B>>1),B,B)});break;default:f.moveTo(t,C);f.lineTo(t-(B>>1),C-B);f.lineTo(t+(B>>1),C-B);f.lineTo(t,C)}return j(E,w,F)},prepPoly:function(n,E,w,t){var C=true;n=t.points||n.points;t=u?u.x:s;var B=u?u.y:l;f.beginPath();for(var F=n.length;F--;){var J=n[F].x-t,K=n[F].y-B;if(C){f.moveTo(J,K);C=false}else f.lineTo(J,K)}return j(E,w)},getContext:function(){return f}});(function(){for(var n in H.styles)e(null,n,H.styles[n]);
Cb.bind("defined",e)})();c.bind("detach",function(){b.removeChild(i)});return c});ca("renderer","dom",function(a,b,c,h,k){function e(f){var s=f.image=new Image;g[f.id]=f;s.src=f.url;s.onload=function(){if(i[f.id])d.appendChild(this);else f.image=null};s.style.cssText="-webkit-user-select: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute;";
return s}function j(f,s,l){var q=[],u;for(u in f){var m=f[u];if(l?m[l]:!s[u]){if(m.image&&m.image.parentNode){d.removeChild(m.image);m.image=null}q[q.length]=u}}for(s=q.length;s--;)delete f[q[s]]}var d=null,g={},i={};d=Z.create("div","",Z.styles({width:b.offsetWidth+"px",height:b.offsetHeight+"px"}));b.childNodes.length>0?b.insertBefore(d,b.childNodes[0]):b.appendChild(d);a.attachFrame(d);a=M(k,{drawTiles:function(f,s,l){for(var q,u=f.x,m=f.y,r=s.length;r--;){f=s[r];if(f.url){(q=f.image||(l?e(f):
null))&&Z.move(q,f.x-u,f.y-m);i[f.id]=f}}}});a.bind("predraw",function(){j(g,i);i={}});a.bind("detach",function(){b.removeChild(d)});a.bind("reset",function(){for(j(g,i={});d.childNodes.length>0;)d.removeChild(d.childNodes[0])});return a});var Cb=function(){function a(h,k){if(W(h,Ca)){c.trigger("defined",h,b[h]=k);return h}else{var e=[],j;for(j in h)e[e.length]=a(j,h[j]);return e}}var b={},c=ia({get:function(h){return b[h]},define:a});a({basic:{fill:"#ffffff"},highlight:{fill:"#ff0000"},waypoints:{lineWidth:4,
stroke:"#003377",fill:"#ffffff"},waypointsHover:{lineWidth:4,stroke:"#ff0000",fill:"#ffffff"}});return c}();ca("view","simple",function(a){function b(p,x,D,N){z(Oa(Wa(U+na(2,N)-1,0.5),2))}function c(p){var x=p|0;p=x+Math.round((p-x)*50)/50;if(p!==U){U=p;p=ma(U)/Math.LN2|0;if(p!==0){U=na(2,p);r(Ga+p,Zb,$b)}ea++}}function h(p,x){var D=renderer&&renderer.projectXY?renderer.projectXY(p,x):null;if(!D){D=Q.getViewport();var N=1/U;D=new T(D?D.x+p*N:p,D?D.y+x*N:x)}return D}function k(p,x,D){n("doubleTap",
x,D,h(D.x,D.y));a.scalable&&z(2,h(D.x,D.y),ac,null,bc)}function e(p,x,D){K=null;X=true;m("down",x,D)}function j(p,x,D){m("hover",x,D)}function d(p,x,D,N){q(x,D,false);if(!K){Y=N.x;G=N.y}}function g(p,x,D){q(x,D,true);X=false}function i(){clearTimeout(Db);Db=setTimeout(function(){renderer.checkSize()},250)}function f(p,x,D){m("tap",x,D);n("tap",x,D,h(D.x,D.y,true))}function s(p){var x=Q,D=B,N=J,R=a;p=(p||a.renderer).split("/");for(var V=new Yb(x,D,N,R),ha=0;ha<p.length;ha++)V=sa("renderer",p[ha],x,
D,N,R,V);renderer=V;P=renderer.fastpan;l()}function l(){fa&&fa.unbind();if(renderer){fa=INTERACT.watch(renderer.interactTarget||J);if(a.scalable){fa.bind("zoom",b);fa.bind("doubleTap",k)}fa.bind("pointerDown",e);fa.bind("pointerMove",d);fa.bind("pointerUp",g);a.captureHover&&fa.bind("pointerHover",j);fa.bind("tap",f)}}function q(p,x,D){if(K){p=h(x.x,x.y);K.drag.call(K.target,K,p.x,p.y,D)&&ea++;if(D)K=null}}function u(p){J=document.getElementById(p);J.appendChild(F=Z.create("div","",Z.styles({overflow:"hidden",
width:J.offsetWidth+"px",height:J.offsetHeight+"px"})));Pa=F.offsetWidth+Ha*2;Qa=F.offsetHeight+Ha*2;bb=Pa/2;cb=Qa/2;db=J.offsetWidth/2;eb=J.offsetHeight/2;F.appendChild(B=Z.create("div","",Z.styles({width:Pa+"px",height:Qa+"px","z-index":2,margin:-Ha+"px 0 0 "+-Ha+"px"})));s()}function m(p,x,D){da=Hits.init(p,x,D,h(D.x,D.y,true));for(p=C;p--;)L=L||(t[p].hitGuess?t[p].hitGuess(da.x,da.y,Q):false);L&&ea++}function r(p,x,D){if(W(p,ab)){p=Wa(a.minZoom,Oa(a.maxZoom,p|0));if(p!==Ga){var N=na(2,p-Ga),R=
bb/N|0,V=cb/N|0;Ga=p;E(((x||I+bb)-R)*N,((D||S+cb)-V)*N);fb=Fa=0;n("zoom",p);U=1;renderer.trigger("reset");A()}return Q}else return Ga}function o(){var p=new oa(I,S,Pa,Qa);p.scaleFactor=U;return p}function v(p,x,D){if(W(x,pa))for(x=0;x<C;x++){if(t[x].id===p)return t[x]}else if(W(p,Ca)){x=sa("layer",x,Q,D);x.added=(new Date).getTime();x.id=p;t[t.length]=x;t.sort(function(N,R){return R.zindex-N.zindex||R.added-N.added});C=t.length;x.trigger("resync");x.trigger("refresh",Q,o());Q.trigger("layerChange",
Q,x);ea++;return x}else return[].concat(t)}function A(){var p=o();if(p){if(ya||za)if(p){var x=Ra?I+(p.w>>1):I,D=Sa?S+(p.h>>1):S,N=p.w,R=p.h;if(ya&&ya>N)if(x+N>ya)I=Ra?I:ya-N;else if(x<0)I=Ra?I:0;if(za&&za>R)if(D+R>za)S=Sa?S:za-R;else if(D<0)S=Sa?S:0}Fa=I;fb=S;n("refresh",Q,p);ea++}}function z(p,x,D,N,R){var V;if(!cc){D=false;V=xa(ma(p)/Math.LN2);p=na(2,V)}D?ib(U,p,D,R,function(ha,Ta){p=ha;if(Ta){V=xa(ma(p)/Math.LN2);p=na(2,V);N&&N()}c(p)}):c(p);return Q}function n(){for(var p=Q.trigger.apply(null,
arguments).cancel,x=t.length;x--;)p=t[x].trigger.apply(null,arguments).cancel||p;return!p}function E(p,x,D){if(W(p,ab)){if(!(D&&panSpeed===0)){I=p|0;S=x|0}}else return new T(I,S)}a=M({container:"",captureHover:true,controls:["zoombar"],drawOnScale:true,padding:0,inertia:true,refreshDistance:256,pannable:false,scalable:false,minZoom:1,maxZoom:1,renderer:"canvas/dom",zoom:1,zoombar:{}},a);var w=[],t=[],C=0,B=null,F=null,J,K=null,y=!W(window.attachEvent,pa),L=false,P=true,X=false,Y=0,G=0,O=a.refreshDistance,
I=0,S=0,$=0,ba=0,Fa=0,fb=0,ya=null,za=null,Ra=false,Sa=false,Ha=a.padding,da=null,Ia=null,Db=0,U=1,Eb=1,fa=null,gb={index:0,draw:false},cc=true,ea=0,Pa,Qa,bb,cb,db,eb,Zb,$b,Ga=a.zoom||a.zoomLevel,ac=Ua("quad.out"),bc=300,Q={id:a.id,padding:Ha,panSpeed:0,attachFrame:function(p,x){x&&B.appendChild(p)},center:function(p,x,D){if(W(p,Ca)){x=ob.parseXY(p).sync(Q.rpp);p=x.x;x=x.y}if(W(p,ab)){E(p-db,x-eb,D);return Q}else{x=E().offset(db,eb);Q.rpp&&x.sync(Q.rpp,true);return x}},detach:function(){renderer&&
renderer.trigger("detach");fa&&fa.unbind();if(F){J.removeChild(F);B=F=null}},layer:v,invalidate:function(){ea++},refresh:A,resetScale:function(){U=1},scale:z,triggerAll:n,removeLayer:function(p){a:{for(var x=C;x--;)if(t[x].id===p){p=x;break a}p=-1}if(p>=0&&p<C){Q.trigger("layerRemove",Q,t[p]);t.splice(p,1);ea++}C=t.length},getRenderer:function(){return renderer},getScaleFactor:function(){return U},setMaxOffset:function(p,x,D,N){ya=p;za=x;Ra=D;Sa=N},getViewport:o,offset:E,pan:function(p,x){Y=p;G=x;
ea++},zoom:r};ia(Q);Q.bind("resize",function(){renderer.checkSize()});Nb(Q,a,{container:u,captureHover:l,scalable:l,pannable:l,renderer:function(p){if(renderer){renderer.trigger("detach");renderer=null}s(p);ea++}});Xa.init(function(){v("markers","draw",{zindex:20});u(a.container);y?window.attachEvent("onresize",i):window.addEventListener("resize",i,false)});Xb.attach(function(p){var x=[],D,N,R;self.panSpeed=panSpeed=qa(Y)+qa(G);D=U!==Eb;if(panSpeed>0||D)ea++;if(panSpeed<2&&(qa(I-Fa)>=O||qa(S-fb)>=
O))A();gb.index++;gb.draw=ea||panSpeed||0;if(renderer&&gb.draw){$+=Y;ba+=G;if(Y||G)Q.trigger("pan");if(U!==1&&Z.supportTransforms)x[x.length]="scale("+U+")";if(D=!P||(a.drawOnScale||U===1)&&panSpeed<5){I=I-$/U|0;S=S-ba/U|0;R=o();renderer.trigger("predraw",R);if(renderer.prepare(t,R,p,da)){N=ba=D=$=ea=0;for(ii=C;ii--;){var V=t[ii];if(V.visible){var ha=V.style?renderer.applyStyle(V.style,true):null;V.draw(renderer,R,Q,p,da);ha&&renderer.applyStyle(ha)}}renderer.trigger("render",R);Q.trigger("drawComplete",
R,p);Eb=U;Z.move(B,D,N,x)}}else Z.move(B,$,ba,x);if(X||!a.inertia)G=Y=0;else if(Y!=0||G!=0){Y*=0.8;G*=0.8;if(qa(Y)<0.5)Y=0;if(qa(G)<0.5)G=0}if(da){p=da?da.elements:[];if(Ia&&Ia.type==="hover"){x=Hits.diffHits(Ia.elements,p);x.length>0&&Hits.triggerEvent(Ia,Q,"Out",x)}if(p.length>0){D=da.x;N=da.y;for(x=p.length;x--;){R=p[x];V=D;ha=N;var Ta=R&&R.drag&&(!R.canDrag||R.canDrag(R,V,ha));if(Ta){K=R;K.startX=V;K.startY=ha}if(Ta)break}Hits.triggerEvent(da,Q)}Ia=p.length>0?M({},da):null;da=null}}});(function(p){w=
[];for(var x=0;x<p.length;x++)w[w.length]=sa("control",p[x],Q,F,J,a[p[x]])})(a.controls);return Q});ca("view","map",function(a){function b(d,g,i){j.zoom(g);c(d,i)}function c(d,g,i,f){d=new T(d);d.sync(lb(j.zoom()));j.center(d.x,d.y,i,f,function(){g&&g(j)})}a=M({zoomLevel:1,minZoom:1,maxZoom:18,pannable:true,scalable:true},a);var h=new T,k=0,e=a.tapExtent;a.adjustScaleFactor=function(d){return Math.pow(2,(d<1?Math.floor:Math.ceil)(Math.log(d)))};var j=M(sa("view","simple",a),{getBoundingBox:function(){var d=
j.getViewport();return d?new Ea((new T(d.x,d.y2)).sync(k,true).pos(),(new T(d.x2,d.y)).sync(k,true).pos()):null},getCenterPosition:function(){var d=j.getViewport();if(d)return(new T(d.x+(d.w>>1),d.y+(d.h>>1))).sync(k,true).pos();return null},gotoBounds:function(d,g){b(d.center(),d.bestZoomLevel(j.getViewport()),g)},gotoPosition:b,panToPosition:c});j.bind("tap",function(d,g,i,f){d=f.sync(k,true).pos();var s=f.offset(-e,e).sync(k,true).pos();f=f.offset(e,-e).sync(k,true).pos();j.trigger("geotap",g,
i,d,new Ea(s,f))});j.bind("refresh",function(d,g,i){if(h.x!=i.x||h.y!=i.y){j.trigger("boundsChange",j.getBoundingBox());h.x=i.x;h.y=i.y}});j.bind("zoom",function(d,g){var i;k=j.rpp=lb(g);i=ga/k|0;j.setMaxOffset(i,i,true,false);j.resetScale();j.triggerAll("resync")});return j});var va=function(a,b,c){c=M({style:null,xy:null,size:20,fill:false,stroke:true,draggable:false,observable:true,properties:{},typeName:"Shape"},c);M(this,c);if(W(this.xy,Ca))this.xy=new T(this.xy);this.id="drawable_"+Wb++;this.bounds=
null;this.view=a;this.layer=b;this.rotation=this.animations=0;this.scaling=1;this.translateY=this.translateX=0;this.observable&&ia(this)};va.prototype={constructor:va,animate:function(a,b,c,h){Ib(this,a,b,c,h)},drag:null,draw:null,getProps:null,resync:function(){if(this.xy){this.xy.sync(this.view.rpp);if(this.size){var a=this.size>>1;this.updateBounds(new oa(this.xy.x-a,this.xy.y-a,this.size,this.size))}}},rotate:function(a){this.rotation=a},scale:function(a){this.scaling=a},translate:function(a,
b){this.translateX=a;this.translateY=b},updateBounds:function(a,b){a&&(!this.bounds||a.x!=this.bounds.x||a.y!=this.bounds.y)&&this.trigger("move",this,a,this.bounds);this.bounds=a;if(b)this.xy=this.bounds.center()}};var jb=1E3/60|0,Da=[],ub=0;ca(ra,"marker",function(a,b,c){c=M({fill:true,stroke:false,markerStyle:"simple",hoverStyle:"highlight",typeName:"Marker"},c);return new va(a,b,c)});ca(ra,"poly",function(a,b,c){c=M({simplify:false,fill:true,points:[],typeName:"Poly"},c);var h=c.points,k=c.simplify;
va.call(this,c);M(this,{getPoints:function(){return[].concat(h)},resync:function(){var e,j,d,g,i,f,s,l;for(e=h.length;e--;)h[e].sync(a.rpp);l=this.points=k?k(h):h;for(e=l.length;e--;){j=l[e].x;d=l[e].y;f=W(f,pa)||j<f?j:f;s=W(s,pa)||d<s?d:s;g=W(g,pa)||j>g?j:g;i=W(i,pa)||d>i?d:i}this.updateBounds(new oa(f,s,g-f,i-s),true)}});this.haveData=h&&h.length>=2});ca(ra,"line",function(a,b,c){c.fill=false;return sa(ra,"poly",a,b,c)});ca(ra,"image",function(a,b,c){function h(){if(g&&g.width>0){if(!this.centerOffset)this.centerOffset=
new T(-g.width>>1,-g.height>>1);this.updateBounds(new oa(this.xy.x+this.centerOffset.x,this.xy.y+this.centerOffset.y,g.width,g.height),false)}}function k(f){if(this.imageUrl=f){var s=this;Ka(this.imageUrl,function(l,q){g=l;if(q){var u=i.layer?i.layer.view:null;u&&u.invalidate()}h.apply(s)})}}c=M({image:null,imageUrl:null,centerOffset:null,typeName:"Image"},c);var e=va.prototype.resync,j=0,d=0,g=c.image,i=M(new va(a,b,c),{changeImage:k,getProps:function(){this.bounds||h(this,g);return{image:g,x:this.xy.x+
j,y:this.xy.y+d}},resync:function(f){e.call(this,f);h.call(this)}});g||k.call(this,this.imageUrl);if(this.centerOffset){j=this.centerOffset.x;d=this.centerOffset.y}});ca(ra,"arc",function(a,b,c){c=M({startAngle:0,endAngle:Math.PI*2,typeName:"Arc"},c);return new va(a,b,c)});La.prototype={constructor:La,clip:null,cycle:function(){},draw:function(){},hitGuess:null};ca("layer","tile",function(a,b){b=M({generator:"osm",imageLoadArgs:{}},b);var c=sa("generator",b.generator,b).run,h=null,k=[],e=M(new La(a,
b),{draw:function(j,d,g){j.drawTiles&&j.drawTiles(d,h.search(d.buffer(128)),g.panSpeed<2)}});e.bind("refresh",function(j,d,g){var i=(new Date).getTime();h&&c(d,g,h,function(){d.invalidate();aa("GEN COMPLETED IN "+((new Date).getTime()-i)+" ms")})});e.bind("resync",function(){var j=a&&a.zoom?a.zoom():0;k[j]||(k[j]=pb(j));h=k[j]});return e});ca("layer","draw",function(a,b){function c(i,f,s,l){var q=this.dragOffset;if(!q)q=this.dragOffset=new T(i.startX-this.xy.x,i.startY-this.xy.y);this.xy.x=f-q.x;
this.xy.y=s-q.y;if(l){delete this.dragOffset;a.invalidate();this.trigger("dragDrop")}return true}function h(i){clearTimeout(d);d=setTimeout(function(){e.sort(function(f,s){if(s.xy&&f.xy){var l=s.xy.y-f.xy.y;return l!=0?l:s.xy.x-f.xy.x}});i&&i.invalidate()},50)}function k(i,f,s,l){l&&j.remove(l,f);j.insert(s,f)}b=M({zindex:10},b);var e=[],j,d=0,g=M(new La(a,b),{itemCount:0,clear:function(){j=new qb;e=[];g.itemCount=0},create:function(i,f,s){i=sa(ra,i,a,g,f);if(s)e.unshift(i);else e[e.length]=i;i.resync();
j&&i.bounds&&j.insert(i.bounds,i);h(a);i.bind("move",k);g.itemCount=e.length;return i},draw:function(i,f,s,l,q){s={};l=j&&f?j.search(f):[];for(var u=l.length;u--;){var m=l[u],r=m.style||g.style,o,v=i.applyTransform(m),A=m.getProps?m.getProps(i):s;if(A=(o=i["prep"+m.typeName])?o.call(i,m,f,q,A):null){if(q&&A.hit){q.elements.push(Hits.initHit(m.type,m,m.draggable?c:null));o=q.type+"Style";r=m[o]||g[o]||r}r=r?i.applyStyle(r,true):null;(o=m.draw||A.draw)&&o.call(m,A);r&&i.applyStyle(r)}v&&v.undo&&v.undo()}},
find:function(){return[].concat(e)},hitGuess:function(i,f){return j&&j.search({x:i-10,y:f-10,w:20,h:20}).length>0}});g.bind("resync",function(){j=pb(a.zoom(),j);for(var i=e.length;i--;)e[i].resync()});return g});Ma.prototype={constructor:Ma};ca("control","zoombar",function(a,b,c,h){function k(w,t){var C=A[w]=Z.create("div","t5-zoombar-button",{position:"absolute",background:e(w),"z-index":51,width:h.width+"px",height:h.buttonHeight+"px","margin-top":(t||0)+"px"});z.appendChild(C)}function e(w,t){return"url("+
h.images+") 0 -"+(s+q*3+(w||0)*i*3+(t||0)*i)+"px"}function j(w){return"url("+h.images+") 0 -"+(s+(w||0)*q)+"px"}function d(w,t){var C;if(w===l){l.style.background=j(t);C="thumb"}else for(var B=0;B<A.length;B++)if(w===A[B]){C="button"+B;A[B].style.background=e(B,t);break}return C}function g(w){if(w!==o){o=w;r=m-o/v*(m-u)|0;Z.move(l,0,r-u);clearTimeout(n);n=setTimeout(function(){a.zoom(o)},500)}}h=M({width:24,height:200,images:"img/zoom.png",align:"right",marginTop:10,spacing:10,thumbHeight:16,buttonHeight:16},
h.zoombar);var i=h.buttonHeight,f,s=h.height,l,q=h.thumbHeight,u=h.spacing+i-(q>>1),m=h.height-i-(q>>1),r=u,o=-1;b=a.minZoom();var v=a.maxZoom()-b+1,A=[],z,n=0,E={button0:function(){a.zoom(a.zoom()+1)},button1:function(){a.zoom(a.zoom()-1)}};z=Z.create("div","t5-zoombar",{position:"absolute",background:"url("+h.images+")","z-index":50,overflow:"hidden",width:h.width+"px",height:h.height+"px",margin:function(){var w=h.spacing,t=ja("{0}px 0 0 {1}px");if(h.align==="right")w=c.offsetWidth-h.width-h.spacing;
return t(h.marginTop,w)}()});c.childNodes[0]?c.insertBefore(z,c.childNodes[0]):c.appendChild(z);z.appendChild(l=Z.create("div","t5-zoombar-thumb",{position:"absolute",background:j(),"z-index":51,width:h.width+"px",height:h.thumbHeight+"px",margin:"10px 0 0 0",top:r-u+"px"}));k(0);k(1,h.height-h.buttonHeight);f=INTERACT.watch(z,{bindTarget:z});f.bind("pointerMove",function(w,t,C){r=Math.min(Math.max(u,C.y-(q>>1)),m);g(v-(r-u)/m*v|0)});f.bind("pointerDown",function(w){d(w.target,2)});f.bind("pointerUp",
function(w){d(w.target,0)});f.bind("tap",function(w){(w=E[d(w.target,2)])&&w()});b=new Ma(a);b.bind("detach",function(){f.unbind();c.removeChild(z)});a.bind("zoom",function(w,t){g(t)});g(a.zoom());return b});la.prototype={constructor:la,distanceTo:function(){if(!targetPos||this.empty()||targetPos.empty())return 0;var a=(targetPos.lat-this.lat)*ka>>1,b=(targetPos.lon-this.lon)*ka>>1;a=ta(a)*ta(a)+$a(this.lat*ka)*$a(targetPos.lat*ka)*ta(b)*ta(b);return 6371*2*Vb(Bb(a),Bb(1-a))},equalTo:function(a){return pos&&
this.lat===a.lat&&this.lon===a.lon},empty:function(){return this.lat===0&&this.lon===0},inArray:function(a){for(var b=a.length;b--;)if(this.equal(a[b]))return true;return false},offset:function(a,b){var c=this.lat*ka,h=this.lon*ka,k=c+a/6371;c=Ub(ta(b/6371)/$a(c));h=h+c;k=(k+Ba)%Math.PI-Ba;h%=ga;return new la(k*Na,h*Na)},toPixels:function(){return new T(parseFloat(this.lon)*ka,kb(this.lat))},toString:function(a){return this.lat+(a||" ")+this.lon}};ca=function(){return{generalize:function(a,b,c){var h=
a.length,k=[],e=null;c||(c=250);c/=1E3;aa("generalizing positions, must include "+b.length+" positions");for(var j=h;j--;)if(j===0)k.unshift(a[j]);else{var d=!e||a[j].inArray(b)?c:e.distanceTo(a[j]);if(a[j]&&d>=c){k.unshift(a[j]);e=a[j]}}aa("generalized "+h+" positions into "+k.length+" positions");return k},parseArray:function(a){var b=a.length,c=Array(b);for(b=b;b--;)c[b]=new la(a[b]);return c},vectorize:function(a,b){function c(){for(var j=0,d=b.chunkSize,g=h;g--;){k[g]=new T(a[g]);j+=1;if(j>d)break}h=
g;if(h<=0)b.callback&&b.callback(k);else animFrame(c)}var h=a.length,k=Array(h);b=M({chunkSize:500,async:true,callback:null},b);if(!b.async){for(var e=h;e--;)k[e]=new T(a[e]);return k}animFrame(c);return null}}}();Ea.prototype={constructor:Ea,bestZoomLevel:function(a){var b=this.center();b=Oa(xa(qa(b.lat)*0.05),Za.length);var c=Za[b],h=this.size();b=Ab(ma(Za[3]*a.h/h.y)/ma(2));a=Ab(ma(c*a.w/h.x)/ma(2));return Oa(isNaN(b)?1E3:b,isNaN(a)?1E3:a)},center:function(){var a=this.size();return new la(this.min.lat+
(a.y>>1),this.min.lon+(a.x>>1))},expand:function(a){this.min.lat-=a;this.max.lat+=a;this.min.lon-=a%360;this.max.lon+=a%360},size:function(a){var b=new T(0,this.max.lat-this.min.lat);b.x=(a||isType(a,pa))&&this.min.lon>this.max.lon?360-this.min.lon+this.max.lon:this.max.lon-this.min.lon;return b},toString:function(){return"min: "+this.min+", max: "+this.max}};var H={ex:M,log:aa,observable:ia,formatter:ja,wordExists:function(a,b){for(var c=a.split(/\s|\,/).length;c--;)if(a.toLowerCase()==b.toLowerCase())return true;
return false},is:W,indexOf:zb,userMessage:function(a,b,c){H.trigger("userMessage",a,b,c)},Registry:Ya,Style:Cb,DOM:Z,Rect:oa,XY:T,Hits:Hits,tweenValue:ib,easing:Ua,Control:Ma,Tile:Va,getImage:Ka,Pos:la,PosFns:ca,BBox:Ea};ia(H);H.RouteTools=function(){function a(g){if(k.test(g))return"-slight";return""}function b(g,i){i.geometry&&H.Geo.PosFns.vectorize(i.geometry,{callback:function(f){g.layer("route","draw").create(ra,"line",{points:f,style:"waypoints",simplify:true})}})}function c(g){for(var i="unknown",
f=h||j,s=0;s<f.length;s++){f[s].regex.lastIndex=-1;var l=f[s].regex.exec(g);if(l){i=f[s].customCheck?f[s].customCheck(g,l):f[s].turnType;break}}return i}var h=undefined,k=/bear/i,e=/right/i,j=function(){var g=[];g.push({regex:/continue/i,turnType:"continue"});g.push({regex:/(take|bear|turn)(.*?)left/i,customCheck:function(i,f){return"turn-left"+a(f[1])}});g.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(i,f){return"turn-right"+a(f[1])}});g.push({regex:/enter\s(roundabout|rotary)/i,
turnType:"roundabout"});g.push({regex:/take.*?ramp/i,turnType:"ramp"});g.push({regex:/take.*?exit/i,turnType:"ramp-exit"});g.push({regex:/make(.*?)u\-turn/i,customCheck:function(i,f){return"uturn"+(e.test(f[1])?"-right":"-left")}});g.push({regex:/proceed/i,turnType:"start"});g.push({regex:/arrive/i,turnType:"arrive"});g.push({regex:/fell\sthrough/i,turnType:"merge"});return g}(),d={calculate:function(g){g=M({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},
g);var i=H.Registry.create("service","routing");i&&i.calculate(g,function(f){if(g.generalize)f.geometry=H.Geo.PosFns.generalize(f.geometry,f.getInstructionPositions());if(g.map){b(g.map,f);g.autoFit&&g.map.gotoBounds(f.boundingBox)}g.success&&g.success(f)})},createMapOverlay:b,parseTurnType:c,Instruction:function(g){var i=g=M({position:null,description:"",distance:0,distanceTotal:0,time:0,timeTotal:0,turnType:null},g),f=g.description;f=f.replace(/(\w)(\/)(\w)/g,"$1 $2 $3");i.description=f;if(!g.turnType)g.turnType=
c(g.description);return g},RouteData:function(g){g=M({geometry:[],instructions:[],boundingBox:null},g);if(!g.boundingBox)g.boundingBox=new H.BBox(g.geometry);return M({getInstructionPositions:function(){for(var i=[],f=0;f<g.instructions.length;f++)g.instructions[f].position&&i.push(g.instructions[f].position);return i}},g)}};ia(d);return d}();COG=typeof COG!=="undefined"?COG:{};COG.extend=function(){for(var a=arguments[0]||{},b,c=1,h=arguments.length;c<h;c++)if((b=arguments[c])!==null)for(var k in b){var e=
b[k];if(a!==e)if(e!==undefined)a[k]=e}return a};(function(){var a=/^P(\d+Y)?(\d+M)?(\d+D)?$/,b=/^(\d+H)?(\d+M)?(\d+S)?$/,c={8601:function(k){k=k.split("T");var e=null;e=null;var j=0,d=0;a.lastIndex=-1;e=a.exec(k[0]);j+=e[3]?parseInt(e[3].slice(0,-1),10):0;b.lastIndex=-1;e=b.exec(k[1]);d+=e[1]?parseInt(e[1].slice(0,-1),10)*3600:0;d+=e[2]?parseInt(e[2].slice(0,-1),10)*60:0;d+=e[3]?parseInt(e[3].slice(0,-1),10):0;return new h(j,d)}},h=COG.Duration=function(k,e){return{days:k?k:0,seconds:e?e:0}};COG.addDuration=
function(){for(var k=new h,e=arguments.length;e--;){k.days+=arguments[e].days;k.seconds+=arguments[e].seconds}if(k.seconds>=86400){k.days+=~~(k.seconds/86400);k.seconds%=86400}return k};COG.formatDuration=function(k){var e,j,d="";if(k.days)d=k.days+" days ";if(k.seconds){k=k.seconds;if(k>=3600){e=~~(k/3600);k-=e*3600}if(k>=60){j=Math.round(k/60);k-=j*60}if(e)d=d+e+(e>1?" hrs ":" hr ")+(j?(j>10?j:"0"+j)+" min ":"");else if(j)d=d+j+" min";else if(k>0)d=d+(k>10?k:"0"+k)+" sec"}return d};COG.parseDuration=
function(k,e){var j=e?c[e]:null;if(j)return j(k);COG.Log.warn("Could not find duration parser for specified format: "+e);return new h}})();H.Decarta=function(){function a(m){return g(e.clientName,e.clientPassword,e.sessionID,e.configuration,e.release,m)}function b(m,r){return i(m.maxResponses,m.version,m.requestID,m.methodName,r)}function c(m,r){e.server||aa("No server configured for deCarta - we are going to have issues","warn");return f(e.server,m.requestID,escape(r))}function h(m,r){Sb(c(m,a(b(m,
m.getRequestBody()))),function(o){var v=o.response.XLS.Response;if(v.numberOfResponses>0&&v[m.methodName+"Response"]){o=null;if(m.parseResponse)o=m.parseResponse(v[m.methodName+"Response"]);r&&r(o)}else aa("no responses from server: "+o.response,"error")})}function k(m,r){var o=new l({json:m.StreetAddress}),v=new s({countryCode:m.countryCode});v.parse(m.Place);return new H.Geo.Address({streetDetails:o,location:v,country:m.countryCode?m.countryCode:"",postalCode:m.PostalCode?m.PostalCode:"",pos:r})}
var e={sessionID:H.ticks(),server:"",clientName:"",clientPassword:"",configuration:"",maxResponses:25,release:"4.4.2sp03",tileFormat:"PNG",fixedGrid:true,useCache:true,tileHosts:[],requestTimeout:3E4,geocoding:{countryCode:"US",language:"EN"}},j={DEFAULT:function(m){for(var r=["landmark","municipalitySubdivision","municipality","countrySubdivision"],o="",v=0;v<r.length;v++)if(m[r[v]])o+=m[r[v]]+" ";return o}},d=1,g=ja("<xls:XLS version='1' xls:lang='en' xmlns:xls='http://www.opengis.net/xls' rel='{4}' xmlns:gml='http://www.opengis.net/gml'><xls:RequestHeader clientName='{0}' clientPassword='{1}' sessionID='{2}' configuration='{3}' />{5}</xls:XLS>"),
i=ja("<xls:Request maximumResponses='{0}' version='{1}' requestID='{2}' methodName='{3}Request'>{4}</xls:Request>"),f=ja("{0}/JSON?reqID={1}&chunkNo=1&numChunks=1&data={2}&responseFormat=JSON"),s=function(m){m=H.ex({landmark:"",municipality:"",municipalitySubdivision:"",countrySubdivision:"",countryCode:""},m);var r=H.ex({calcMatchPercentage:function(o){var v=0;if(m.landmark&&m.landmarkSubType){if(H.wordExists(o,m.landmarkSubType)){v+=0.4;v+=H.wordExists(o,m.landmark)?0.6:0}}else{v+=H.wordExists(o,
m.municipalitySubdivision)?0.8:0;if(v===0&&m.municipality)v+=H.wordExists(o,m.municipality)?0.7:0}if(m.countrySubdivision)v+=H.wordExists(o,m.countrySubdivision)?0.2:0;return v},getCountryCode:function(){if(m.countryCode)return m.countryCode.toUpperCase();return""},parse:function(o){for(var v=0;o&&v<o.length;v++){var A=o[v].type?o[v].type.slice(0,1).toLowerCase()+o[v].type.slice(1):"";if(typeof m[A]!=="undefined"){m[A]=o[v].content;if(o[v].subType)m[A+"SubType"]=o[v].subType}}H.ex(r,m)},toString:function(){var o=
j[r.getCountryCode()];if(!o)o=j.DEFAULT;return o(m)}},m);return r},l=function(m){m=H.ex({json:{}},m);var r="",o="";if(m.json.Street)r=m.json.Street.content?m.json.Street.content:m.json.Street;r=r&&r.replace?r.replace(/\/\d+$/,""):"";if(m.json.Building)if(m.json.Building.number)o=m.json.Building.number;return{building:o,street:r,calcMatchPercentage:function(v){var A=0,z=H.Geo.A.normalize(v),n=H.Geo.A.normalize(r);if(m.json.Building)if(H.Geo.A.buildingMatch(v,m.json.Building.number.toString()))A+=0.2;
if(z&&n&&H.wordExists(z,n))A+=0.8;return A},toString:function(){if(r)return(o?o+" ":"")+r;return""}}},q=function(){return{methodName:"",maxResponses:25,version:"1.0",requestID:d++,getRequestBody:function(){return""},parseResponse:function(m){return m}}},u=function(){return H.ex(new q,{methodName:"RUOK",parseResponse:function(m){return{aliasCount:m.maxHostAliases,host:m.hostName}}})};H.Registry.register("generator","decarta",function(m){function r(A,z,n,E){if(A=A.zoom?A.zoom():0){var w=2<<A-1,t=w>>
1,C=m.tileSize,B=(z.w/C|0)+1,F=(z.h/C|0)+1,J=(z.x/C|0)-t;z=w-(z.y/C|0)-t-F;var K=n.search({x:(t+J)*C,y:(t+z*-1-F)*C,w:B*C,h:F*C});w={};var y;for(y=K.length;y--;)w[K[y].id]=true;for(K=0;K<=B;K++)for(y=0;y<=F;y++){var L=J+K,P=z+y-1,X=L+"_"+P;if(!w[X]){L=new H.Tile((t+J+K)*C,(t+z*-1-y)*C,v[K%v.length]+"/openls/image-cache/TILE?LLMIN=0.0,0.0&LLMAX="+o[A]+"&CACHEABLE=true&DS=navteq-world&WIDTH=256&HEIGHT=256&CLIENTNAME="+e.clientName+"&SESSIONID="+e.sessionID+"&FORMAT=PNG&CONFIG="+e.configuration+"&N="+
P+"&E="+L,C,C,X);n.insert(L,L)}}E&&E()}}m=H.ex({tileSize:256},m);var o=["89.787438015348100000,360.00000000000000000","85.084059050110410000,180.00000000000000000","66.653475896509040000,90.00000000000000000","41.170427238429790000,45.000000000000000000","22.076741328793200000,22.500000000000000000","11.251819676168665000,11.250000000000000000","5.653589942659626000,5.625000000000000000","2.830287664051185000,2.812500000000000000","1.415581451872543800,1.406250000000000000","0.707845460801532700,0.703125000000000000",
"0.353929573271679340,0.351562500000000000","0.176965641673330230,0.175781250000000000","0.088482927761462040,0.087890625000000000","0.044241477246363230,0.043945312500000000","0.022120740293895182,0.021972656250000000","0.011060370355776452,0.010986328125000000","0.005530185203987857,0.005493164062500000","0.002765092605263539,0.002746582031250000","0.001382546303032519,0.001373291015625000","0.000691272945568983,0.000686645507812500","0.000345636472797214,0.000343322753906250"],v=null;H.userMessage("ack",
"decarta","&copy; deCarta, Inc. Map and Imagery Data &copy; NAVTEQ or Tele Atlas or DigitalGlobe");return{run:function(A,z,n,E){v?r(A,z,n,E):h(new u,function(w){v=[];if(w.aliasCount)for(var t=0;t<w.aliasCount;t++)v[t]="http://"+w.host.replace("^(.*?).(.*)$","\u0001-0"+(t+1)+".\u0002");else v=["http://"+w.host];r(A,z,n,E)})}}});H.Registry.register("service","geocoder",function(){var m=function(o){function v(n){var E=[],w=n?n.numberOfGeocodedAddresses:0,t=[];if(w>1)t=n.GeocodedAddress;else if(w==1)t=
[n.GeocodedAddress];try{for(n=0;t&&n<t.length;n++){var C,B=t[n],F=w=null;if(B&&B.GeocodeMatchCode&&B.GeocodeMatchCode.matchType!=="NO_MATCH"){if(B&&B.Point)F=new H.Pos(B.Point.pos);if(B&&B.Address)w=k(B.Address,F)}(C=w)&&E.push(C)}}catch(J){aa(J,"error")}return E}o=H.ex({addresses:[],parserReport:false,parseOnly:false,returnSpatialKeys:false},o);var A=ja('<xls:GeocodeRequest parserReport="{0}" parseOnly="{1}" returnSpatialKeys="{2}">'),z=new q;return H.ex({},z,{methodName:"Geocode",getRequestBody:function(){for(var n=
A(o.parserReport,o.parseOnly,o.returnSpatialKeys),E=0;E<o.addresses.length;E++)n+=o.addresses[E].getXML();return n+"</xls:GeocodeRequest>"},parseResponse:function(n){if(o.addresses.length===1)return[v(n.GeocodeResponseList)];else{for(var E=[],w=0;w<o.addresses.length;w++)E.push(v(n.GeocodeResponseList[w]));return E}}})},r=function(o){o=H.ex({position:null,geocodePreference:"StreetAddress"},o);return H.ex(new q,{methodName:"ReverseGeocode",getRequestBody:function(){return"<xls:ReverseGeocodeRequest><xls:Position><gml:Point><gml:pos>"+
o.position.toString()+"</gml:pos></gml:Point></xls:Position><xls:ReverseGeocodePreference>"+o.geocodePreference+"</xls:ReverseGeocodePreference></xls:ReverseGeocodeRequest>"},parseResponse:function(v){var A=null;if(v&&v.Point)A=new H.Pos(match.Point.pos);if(v&&v.ReverseGeocodedLocation&&v.ReverseGeocodedLocation.Address)return k(v.ReverseGeocodedLocation.Address,A);return null}})};return{forward:function(o){o=H.ex({addresses:[],complete:null},o);var v,A=[];if(o.addresses&&!H.is(o.addresses,"array"))o.addresses=
[o.addresses];for(v=0;v<o.addresses.length;v++)H.is(o.addresses[v],"object")?aa("attempting to geocode a simple object - not implemented","warn"):A.push(new types.Address({freeform:o.addresses[v]}));if(A.length>0){A=new m({addresses:A});h(A,function(z){if(o.complete)for(v=0;v<z.length;v++)o.complete(o.addresses[v],z[v])})}},reverse:function(o){o=H.ex({position:null,complete:null},o);if(!o.position)throw Error("Cannot reverse geocode without a position");var v=new r(o);h(v,function(A){o.complete&&
o.complete(A)})}}});H.Registry.register("service","routing",function(){var m=function(r){r=H.ex({waypoints:[],provideRouteHandle:false,distanceUnit:"KM",routeQueryType:"RMAN",routePreference:"Fastest",routeInstructions:true,routeGeometry:true},r);var o=new q,v=ja('<xls:DetermineRouteRequest provideRouteHandle="{0}" distanceUnit="{1}" routeQueryType="{2}">'),A=ja("<xls:{0}><xls:Position><gml:Point><gml:pos>{1}</gml:pos></gml:Point></xls:Position></xls:{0}>");return H.ex({},o,{methodName:"DetermineRoute",
getRequestBody:function(){if(r.waypoints.length<2)throw Error("Cannot send RouteRequest, less than 2 waypoints specified");var z=v(r.provideRouteHandle,r.distanceUnit,r.routeQueryType);z+="<xls:RoutePlan>";z+="<xls:RoutePreference>"+r.routePreference+"</xls:RoutePreference>";z+="<xls:WayPointList>";for(var n=0;n<r.waypoints.length;n++)z+=A(n===0?"StartPoint":n===r.waypoints.length-1?"EndPoint":"ViaPoint",r.waypoints[n].toString());z+="</xls:WayPointList>";z+="</xls:RoutePlan>";if(r.routeInstructions)z+=
'<xls:RouteInstructionsRequest rules="maneuver-rules" providePoint="true" />';if(r.routeGeometry)z+="<xls:RouteGeometryRequest />";z+="</xls:DetermineRouteRequest>";return z},parseResponse:function(z){var n=H.RouteTools.RouteData,E=H.Geo.PosFns.parseArray(z.RouteGeometry.LineString.pos),w=z.RouteInstructionsList;z=[];w=w&&w.RouteInstruction?w.RouteInstruction:[];for(var t=0,C=new COG.Duration,B=0;B<w.length;B++){var F;F=w[B].distance;var J={M:1,KM:1E3}[F.uom?F.uom.toUpperCase():"M"];F=F.value&&J?
F.value*J:0;J=COG.parseDuration(w[B].duration,"8601");t+=F;C=COG.addDuration(C,J);z.push(new H.RouteTools.Instruction({position:new H.Pos(w[B].Point),description:w[B].Instruction,distance:F,distanceTotal:t,time:J,timeTotal:C}))}return new n({geometry:E,instructions:z})}})};return{calculate:function(r,o){r=H.ex({waypoints:[]},r);if(typeof H.RouteTools!=="undefined"){var v=new m(r);h(v,function(A){o&&o(A)})}else aa("Could not generate route, T5.RouteTools plugin not found","warn")}}});return{applyConfig:function(m){H.ex(e,
m)},compareFns:function(){return{streetDetails:function(m,r){return r.calcMatchPercentage(m)},location:function(m,r){return r.calcMatchPercentage(m)}}}()}}();hb.T5=H;hb.Tile5=function(a,b){b=M({container:a,type:"map",renderer:"canvas",starpos:null,zoom:1,fastpan:false,drawOnScale:true,zoombar:{}},b);return sa("view",b.type,b)}})(window);
