(function(tb){function K(){var a=arguments[0]||{},c=Array.prototype.slice.call(arguments,1),b=c.length,f,h;for(h=0;h<b;h++)if((f=c[h])!==null)for(var i in f){var k=f[i];if(a!==k)if(k!==undefined)a[i]=k}return a}function la(a,c){if(typeof console!=="undefined")console[c||"debug"](a)}function va(a){var c=a.match(Mb),b=[],f=0,h;for(h=c?c.length:0;h--;){var i=c[h].slice(1);b[i]||(b[i]=RegExp("\\{"+i+"\\}","g"))}f=b.length;return function(){var k=a;for(h=0;h<f;h++){var j=arguments[h];if(typeof j=="undefined")j=
"";k=k.replace(b[h],j)}return k}}function ub(a,c){var b=Va*ha(a);return Wa-2*vb(c*Ca((1-b)/(1+b),Va/2))}function U(a,c){if(P(a,qa)){var b=a.split(gb);this.x=parseFloat(b[0]);this.y=parseFloat(b[1])}else if(a&&a.x){this.x=a.x;this.y=a.y}else{this.x=a||0;this.y=c||0}}function Ka(a){this.allowCull=a}function wa(a,c,b,f){this.mercX=b;this.mercY=f;if(P(a,qa))K(this,Nb.parseXY(a));else a&&a.toPixels?K(this,a.toPixels()):U.call(this,a,c)}function xa(a,c,b,f){this.x=a||0;this.y=c||0;this.w=b||0;this.h=f||
0;this.x2=this.x+this.w;this.y2=this.y+this.h}function wb(a,c){var b=new xb(Math.sqrt(256<<a)|0);c&&c.zoomLevel===a&&c.copyInto(b);b.zoomLevel=a;return b}function hb(a,c,b,f,h,i){this.x=a;this.y=c;this.w=f||256;this.h=f||256;this.x2=this.x+this.w;this.y2=this.y+this.h;this.url=b;this.id=i||a+"_"+c;this.loaded=false;this.image=null}function Xa(a,c){c=K({id:"layer_"+Ob++,zindex:0,animated:false,style:null,minXY:null,maxXY:null,visible:true},c);this.visible=c.visible;this.view=a;ya(K(this,c))}function Ya(){ya(this)}
function $(a,c){if(a&&a.split){var b=a.split(gb);if(b.length>1){a=b[0];c=b[1]}}else if(a&&a.lat){c=a.lon;a=a.lat}this.lat=parseFloat(a||0);this.lon=parseFloat(c||0)}function Fa(a,c){if(P(a,yb)){for(var b=c,f=new $(ib,Za),h=new $(Pb,zb),i=a.length;i--;){var k=a[i];if(k.lat<f.lat)f.lat=k.lat;if(k.lat>h.lat)h.lat=k.lat;if(k.lon<f.lon)f.lon=k.lon;if(k.lon>h.lon)h.lon=k.lon}this.min=f;this.max=h;if(P(b,ra)){b=this.size();b=Ga(b.x,b.y)*0.3}this.min=new $(f.lat-b,(f.lon-b)%360);this.max=new $(h.lat+b,(h.lon+
b)%360)}else{this.min=a;this.max=c}}function jb(a){if(!P(a,qa))this.meters=a}var Mb=/\{(\d+)(?=\})/g,Qb=function(){var a=1.70158,c=Math.PI/2,b=Math.abs,f=Math.pow,h=Math.sin,i=Math.asin,k=Math.cos,j={linear:function(e,o,d,n){return d*e/n+o},backin:function(e,o,d,n){return d*(e/=n)*e*((a+1)*e-a)+o},backout:function(e,o,d,n){return d*((e=e/n-1)*e*((a+1)*e+a)+1)+o},backinout:function(e,o,d,n){return(e/=n/2)<1?d/2*e*e*(((a*=1.525)+1)*e-a)+o:d/2*((e-=2)*e*(((a*=1.525)+1)*e+a)+2)+o},bouncein:function(e,
o,d,n){return d-j.bounceout(n-e,0,d,n)+o},bounceout:function(e,o,d,n){return(e/=n)<1/2.75?d*7.5625*e*e+o:e<2/2.75?d*(7.5625*(e-=1.5/2.75)*e+0.75)+o:e<2.5/2.75?d*(7.5625*(e-=2.25/2.75)*e+0.9375)+o:d*(7.5625*(e-=2.625/2.75)*e+0.984375)+o},bounceinout:function(e,o,d,n){return e<n/2?j.bouncein(e*2,0,d,n)/2+o:j.bounceout(e*2-n,0,d,n)/2+d/2+o},cubicin:function(e,o,d,n){return d*(e/=n)*e*e+o},cubicout:function(e,o,d,n){return d*((e=e/n-1)*e*e+1)+o},cubicinout:function(e,o,d,n){if((e/=n/2)<1)return d/2*e*
e*e+o;return d/2*((e-=2)*e*e+2)+o},elasticin:function(e,o,d,n,m,g){if(e==0)return o;if((e/=n)==1)return o+d;g||(g=n*0.3);if(!m||m<b(d)){m=d;d=g/4}else d=g/ca*i(d/m);return-(m*f(2,10*(e-=1))*h((e*n-d)*ca/g))+o},elasticout:function(e,o,d,n,m,g){var l;if(e==0)return o;if((e/=n)==1)return o+d;g||(g=n*0.3);if(!m||m<b(d)){m=d;l=g/4}else l=g/ca*i(d/m);return m*f(2,-10*e)*h((e*n-l)*ca/g)+d+o},elasticinout:function(e,o,d,n,m,g){var l;if(e==0)return o;if((e/=n/2)==2)return o+d;g||(g=n*0.3*1.5);if(!m||m<b(d)){m=
d;l=g/4}else l=g/ca*i(d/m);if(e<1)return-0.5*m*f(2,10*(e-=1))*h((e*n-l)*ca/g)+o;return m*f(2,-10*(e-=1))*h((e*n-l)*ca/g)*0.5+d+o},quadin:function(e,o,d,n){return d*(e/=n)*e+o},quadout:function(e,o,d,n){return-d*(e/=n)*(e-2)+o},quadinout:function(e,o,d,n){if((e/=n/2)<1)return d/2*e*e+o;return-d/2*(--e*(e-2)-1)+o},sinein:function(e,o,d,n){return-d*k(e/n*c)+d+o},sineout:function(e,o,d,n){return d*h(e/n*c)+o},sineinout:function(e,o,d,n){return-d/2*(k(Math.PI*e/n)-1)+o}};return function(e){e=e.replace(/[\-\_\s\.]/g,
"").toLowerCase();return j[e]||j.linear}}(),ya=function(){function a(b,f){var h=b.hasOwnProperty("obsHandlers")?b.obsHandlers:null;h[f]||(h[f]=[]);return h[f]}var c=0;return function(b){if(!b)return null;if(!(b.hasOwnProperty("obsHandlers")?b.obsHandlers:null))b.obsHandlers={};if(!b.hasOwnProperty("bind")){b.bind=function(f,h){var i="callback"+c++;a(b,f).unshift({fn:h,id:i});return i};b.triggerCustom=function(f,h){var i=a(b,f),k={cancel:false,name:f,source:this},j;for(j in h)k[j]=h[j];if(!i)return null;
j=Array.prototype.slice.call(arguments,2);b.eventInterceptor&&b.eventInterceptor(f,k,j);j.unshift(k);for(var e=i.length;e--&&!k.cancel;)i[e].fn.apply(this,j);return k};b.trigger=function(f){var h=Array.prototype.slice.call(arguments,1);h.splice(0,0,f,null);return b.triggerCustom.apply(this,h)};b.unbind=function(f,h){if(typeof f==="undefined")b.obsHandlers={};else for(var i=a(b,f),k=0;i&&k<i.length;k++)if(i[k].id===h){i.splice(k,1);break}return b}}return b}}(),Ab=function(){function a(c,b,f,h){if(typeof c[h]==
"undefined")c[h]=function(i){if(typeof i!="undefined"){b[h]=i;f[h]&&f[h](i);return c}else return b[h]}}return function(c,b,f){b=b||c;for(var h in b)typeof b[h]!="function"&&a(c,b,f,h);return c}}(),kb=Array.prototype.indexOf||function(a){for(var c=0;c<this.length;c++)if(this[c]===a)return c;return-1},P=function(){var a={NaN:1,Infinity:1,"-Infinity":1},c=String.prototype.toLowerCase,b=Object.prototype.toString;return function(f,h){h=c.call(h);if(h=="finite")return!a.hasOwnProperty(+f);return h=="null"&&
f===null||h==typeof f||h=="object"&&f===Object(f)||h=="array"&&Array.isArray&&Array.isArray(f)||b.call(f).slice(8,-1).toLowerCase()==h}}(),Rb=function(){function a(h){var i=document.createElement("script"),k=false;i.src=h;i.async=true;i.onload=i.onreadystatechange=function(){if(!k&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){k=true;i.onload=i.onreadystatechange=null;i&&i.parentNode&&i.parentNode.removeChild(i)}};b||(b=document.getElementsByTagName("head")[0]);b.appendChild(i)}
var c=0,b,f=this;return function(h,i,k){h+=h.indexOf("?")>=0?"&":"?";var j="json"+ ++c;f[j]=function(e){i(e);f[j]=null;try{delete f[j]}catch(o){}};a(h+(k?k:"callback")+"="+j);return j}}();INTERACT=function(){function a(m){return function(g,l){m.addEventListener(g,l,false)}}function c(m){return function(g,l){m.removeEventListener(g,l,false)}}function b(m){return function(g,l){m.attachEvent("on"+g,l)}}function f(m,g){return{x:m?m:0,y:g?g:0,count:1}}function h(m,g){d.push(K({handler:null,checks:{},type:m},
g))}function i(m){var g=0,l=0;if(m.offsetParent){do{g+=m.offsetLeft;l+=m.offsetTop;m=m.offsetParent}while(m)}return{left:g,top:l}}function k(m,g){return{source:m,target:g.target?g.target:g.srcElement}}function j(m,g){for(var l=m.target?m.target:m.srcElement;l&&l!==g;)l=l.parentNode;return l&&l===g}function e(m,g){return{x:m.x-(g?g.left:0),y:m.y-(g?g.top:0)}}function o(m,g){if(m.preventDefault){m.preventDefault();m.stopPropagation()}else if(typeof m.cancelBubble!="undefined")m.cancelBubble=true;g&&
m.stopImmediatePropagation&&m.stopImmediatePropagation()}var d=[],n=function(m,g,l){l=K({binder:null,unbinder:null,observable:null},l);for(var t=l.observable,u=[],x,v,B={bind:function(){return t.bind.apply(null,arguments)},unbind:function(){t.unbind();for(p=0;p<u.length;p++)u[p].unbind();return B}},p=0;p<g.length;p++)u.push(g[p](m,t,l));t.bind("pointerDown",function(){v=x=0});t.bind("pointerMove",function(w,A,r,C){x+=C.x||0;v+=C.y||0});t.bind("pointerUp",function(w,A,r){Math.abs(x)>20||Math.abs(v)>
20||t.triggerCustom("tap",w,A,r)});return B};h("pointer",{handler:function(m,g,l){function t(y){if(y.pageX&&y.pageY)return f(y.pageX,y.pageY);else{var E=document.documentElement,N=document.body;return f(y.clientX+(E&&E.scrollLeft||N&&N.scrollLeft||0)-(E&&E.clientLeft||N&&N.clientLeft||0),y.clientY+(E&&E.scrollTop||N&&N.scrollTop||0)-(E&&E.clientTop||N&&N.clientTop||0))}}function u(y){if(j(y,m))if(C=p(y)){var E=t(y);m.style.cursor="move";o(y,true);O=E.x;R=E.y;D=f(O,R);g.triggerCustom("pointerDown",
k("mouse",y),D,e(D,i(m)))}}function x(y){var E=t(y);G=E.x;F=E.y;if(j(y,m))w(y,C?"pointerMove":"pointerHover")}function v(y){if(C&&p(y)){C=false;if(j(y,m)){m.style.cursor="default";w(y,"pointerUp")}}}function B(y){if(j(y,m)){var E;y=y||window.event;if(y.detail){if(typeof y.axis=="undefined"||y.axis===2)E=-y.detail*A}else{E=y.wheelDeltaY?y.wheelDeltaY:y.wheelDelta;if(window.opera)E=-E}if(E){var N=f(G,F);g.triggerCustom("zoom",k("mouse",y),N,e(N,i(m)),E/r,"wheel");o(y);y.returnValue=false}}}function p(y){y=
y||window.event;return(y.which||y.button)==1}function w(y,E,N,ia,ma){N=typeof N!="undefined"?N:G;ia=typeof ia!="undefined"?ia:F;var H=N-O,Q=ia-R,L=f(N,ia);g.triggerCustom(E,k("mouse",y),L,e(L,i(m)),f(H,Q));if(typeof ma=="undefined"||ma){O=N;R=ia}}l=K({},l);var A=120,r=A*8,C=false,D,G,F,O,R;l.binder("mousedown",u);l.binder("mousemove",x);l.binder("mouseup",v);l.binder("dblclick",function(y){la("captured double click");if(j(y,m)){var E=t(y);g.triggerCustom("doubleTap",k("mouse",y),E,e(E,i(m)))}});l.binder("mousewheel",
B);l.binder("DOMMouseScroll",B);return{unbind:function(){l.unbinder("mousedown",u);l.unbinder("mousemove",x);l.unbinder("mouseup",v);l.unbinder("mousewheel",B);l.unbinder("DOMMouseScroll",B)}}},checks:{touch:false}});h("pointer",{handler:function(m,g,l){function t(H){if(H.count<2)return 0;var Q=H.x-H.next.x;H=H.y-H.next.y;return~~Math.sqrt(Q*Q+H*H)}function u(H,Q,L){Q=Q?Q:0;L=L?L:0;for(var T={x:H.x-Q,y:H.y-L,id:H.id,count:H.count},ea=T;H.next;){H=H.next;ea=ea.next={x:H.x-Q,y:H.y-L,id:H.id}}return T}
function x(H,Q){var L=H[Q?Q:"touches"],T,ea;if(L.length===0)return null;ea=T={x:L[0].pageX,y:L[0].pageY,id:L[0].identifier,count:L.length};for(var S=1,X=L.length;S<X;S++)ea=ea.next={x:L[S].pageX,y:L[S].pageY,id:L[S].identifier};return T}function v(H){if(j(H,m)){F=i(m);var Q=x(H,"changedTouches"),L=u(Q,F.left,F.top);if(!R){O=C;g.triggerCustom("pointerDown",k("touch",H),Q,L)}ia&&g.triggerCustom("pointerDownMulti",k("touch",H),Q,L);R=x(H);if(R.count>1)E=t(R);ma=1;N=u(R)}}function B(H){if(j(H,m)){o(H);
y=x(H);if(O==C)O=Math.abs(R.x-y.x)>A||Math.abs(R.y-y.y)>A?r:C;if(O!=C){O=y.count>1?G:D;if(O==G)if(R.count===1){R=u(y);E=t(R)}else{var Q=t(y);if(Math.abs(E-Q)<w)O=D;else{var L;L=y.x;var T=y.next.x,ea=y.y,S=y.next.y;L={x:(L<T?L:T)+(Math.abs(L-T)>>1),y:(ea<S?ea:S)+(Math.abs(ea-S)>>1)};Q=Q/E;T=Q-ma;g.triggerCustom("zoom",k("touch",H),L,e(L,F),T,"pinch");ma=Q}}O==D&&g.triggerCustom("pointerMove",k("touch",H),y,u(y,F.left,F.top),f(y.x-N.x,y.y-N.y));ia&&g.triggerCustom("pointerMoveMulti",k("touch",H),y,
u(y,F.left,F.top))}N=u(y)}}function p(H){if(j(H,m)){var Q=x(H,"changedTouches"),L=u(Q,F.left,F.top);y=x(H);if(!y){g.triggerCustom("pointerUp",k("touch",H),Q,L);R=null}ia&&g.triggerCustom("pointerUpMulti",k("touch",H),Q,L)}}l=K({detailed:false,inertia:false},l);var w=20,A=7,r=0,C=1,D=2,G=3,F,O,R,y,E,N,ia=l.detailed,ma=1;l.binder("touchstart",v);l.binder("touchmove",B);l.binder("touchend",p);la("initialized touch handler");return{unbind:function(){l.unbinder("touchstart",v);l.unbinder("touchmove",B);
l.unbinder("touchend",p)}}},checks:{touch:true}});return{register:h,watch:function(m,g,l){g=K({bindTarget:null,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},g);capabilities=K({touch:"ontouchstart"in window},l);if(!g.observable){la("creating observable");g.observable=ya({});globalOpts=g}g.binder=(g.isIE?b:a)(g.bindTarget||document);g.unbinder=(g.isIE?b:c)(g.bindTarget||document);l=g.types;for(var t=capabilities,u=[],x=d.length;x--;){var v=d[x],B=!l||l.indexOf(v.type)>=0,p=
true,w;for(w in v.checks){var A=v.checks[w];la("checking "+w+" capability. require: "+A+", capability = "+t[w]);p=p&&A===t[w]}if(B&&p)u[u.length]=v.handler}return new n(m,u,g)}}}();var I=ya({}),$a=function(){var a={};return{create:function(c,b){if(a[c][b])return a[c][b].apply(null,Array.prototype.slice.call(arguments,2));throw Sb(c,b);},get:function(c,b){return a[c]?a[c][b]:null},register:function(c,b,f){a[c]||(a[c]={});a[c][b]&&la(Tb(c,b),"warn");a[c][b]=f}}}(),Tb=va("Registration of {0}: {1} will override existing definition"),
Sb=va("Could not create {0} of type: {1}");va("Could not create drawable of type: {0}");var lb=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],ca=Math.PI*2,Wa=Math.PI/2,aa=Math.PI/180,na=180/Math.PI,ib=90,Pb=-ib,Za=180,zb=-Za,mb=ib*aa,Bb=-mb,Cb=Za*aa,Ub=-Cb,Va=0.08181919084262157,oa=Math.abs,Db=Math.ceil,La=Math.round,Ma=Math.min,Ga=Math.max,Ca=Math.pow,nb=Math.sqrt,Da=Math.log,ha=Math.sin,Eb=Math.asin,za=Math.cos,vb=Math.atan,Vb=Math.atan2,ra="undefined",
qa="string",Wb="object",sa="number",yb="array",fa=$a.register,Aa=$a.create,Xb=$a.get,Yb=0,Ob=0,gb=/[\,\s]+/,Ha=function(){function a(k){h++;k=k||(new Date).getTime();for(var j=f.length;j--;){var e=f[j];h%e.every===0&&e.cb(k)}i&&animFrame(a)}var c=1E3/60,b=["r","webkitR","mozR","oR","msR"],f=[],h=0,i=function(){for(var k=0;k<b.length;k++)window.animFrame=window.animFrame||window[b[k]+"equestAnimationFrame"];return animFrame}();i?animFrame(a):setInterval(a,1E3/60);return{attach:function(k,j){f[f.length]=
{cb:k,every:j?La(j/c):1}},detach:function(k){for(var j=f.length;j--;)if(f[j].cb===k){f.splice(j,1);break}}}}(),Nb=function(){var a=/^xy\((.*)\).*$/i;return{parseXY:function(c){if(!a.test(c)){c=c.split(gb);return ab(c[1],c[0])}}}}(),Z=function(){function a(h){for(var i=0;i<h.length;i++){var k=h[i];if(typeof document.body.style[k]!="undefined")return k}}var c={"-webkit-user-select":"none",position:"absolute"},b,f;b=a(["-webkit-transform","MozTransform"]);css3DTransformProp=a(["WebkitPerspective","MozPerspective"]);
f=a(["-webkit-transform-origin","MozTransformOrigin"]);return{transforms:P(b,qa),create:function(h,i,k){h=document.createElement(h);var j=[];k=k||{};h.className=i||"";for(var e in k)j[j.length]=e+": "+k[e];h.style.cssText=j.join(";");return h},move:function(h,i,k,j,e){if(b){h.style[b]="translate("+i+"px, "+k+"px) "+(j||[]).join(" ");if(e&&f)h.style[f]=e.x+"px "+e.y+"px"}else{h.style.left=i+"px";h.style.top=k+"px"}},styles:function(h){return K({},c,h)}}}(),Fb=function(){function a(){for(var h=f.length,
i=h;i--;)try{f[i](h)}catch(k){la(k.toString(),"error")}}var c=20,b=50,f=[];return{process:function(h,i,k,j){function e(n){n=(o||b)/n;if(d<h.length){var m=h.slice(d,d+n);n=m.length;var g=o?0:(new Date).getTime();i(m,n);if(!o){o=(m=((new Date).getTime()-g)/n)?c/m|0:h.length;la("calculated that we can process "+o+" items per cycle")}d+=n}else{for(n=f.length;n--;)if(f[n]===e){f.splice(n,1);break}f.length===0&&Ha.detach(a);k&&k()}}var o,d=0;if(h.length>(j||0))f.push(e)===1&&Ha.attach(a);else{i(h,h.length);
k&&k()}}}}(),ab=ab||function(a,c){var b=parseFloat(c)*aa;b=ha(b);var f=Va*b;b=Da((1+b)/(1-b)*Ca((1-f)/(1+f),Va))/2;return new wa(0,0,parseFloat(a)*aa,b)},ob=ob||function(a,c){for(var b=Ca(Math.E,-c),f=Wa-2*vb(b),h=ub(f,b),i=0;i<12&&oa(f-h)>1.0E-7;){f=h;h=ub(f,b);i++}return new $(h*na,a%360*na)};U.prototype={constructor:U,add:function(){for(var a=this.x,c=this.y,b=arguments.length;b--;){a+=arguments[b].x;c+=arguments[b].y}return this.copy(a,c)},copy:function(a,c){var b=K({},this);b.x=a||b.x;b.y=c||
b.y;return b},equals:function(a){return this.x===a.x&&this.y===a.y},offset:function(a,c){return this.copy(this.x+a,this.y+c)},relative:function(a){a=a.viewport();return this.copy(this.x-a.x-a.padding.x,this.y-a.y-a.padding.y)},rotate:function(a,c){c=c||new U(0,0);var b=this.x-c.x,f=this.y-c.y;return new U(c.x+za(a)*b+-ha(a)*f,c.y+ha(a)*b+za(a)*f)},scale:function(a,c){c=c||new U(0,0);return new U(c.x+(this.x-c.x)*a,c.y+(this.y-c.y)*a)},sync:function(){return this},toString:function(){return this.x+
", "+this.y}};Ka.prototype=K([],{cull:function(a){if(this.allowCull){var c=a.x,b=a.y,f=a.x+a.w;a=a.y+a.h;for(var h=Infinity,i=0,k,j=this.length;j--;)if(k=this[j].x>=c&&this[j].x<=f&&this[j].y>=b&&this[j].y<=a){h=j<h?j:h;i=j>i?j:i}return this.slice(Ga(h-1,0),Ma(i+1,this.length))}return this},simplify:function(a){a=a||3;for(var c=new Ka(this.allowCull),b=null,f=this.length;f--;){var h=this[f];if(include=!b||f===0||oa(h.x-b.x)+oa(h.y-b.y)>a){c.unshift(h);b=h}}return c}});wa.prototype=K(new U,{constructor:wa,
pos:function(){return ob(this.mercX,this.mercY)},sync:function(a,c){var b;if(!(b=a.rpp)){b=a.zoom();b=ca/(256<<b)}b=b;if(c){this.mercX=this.x*b-Math.PI;this.mercY=Math.PI-this.y*b}else{this.x=La(((this.mercX||0)+Math.PI)/b);this.y=La((Math.PI-(this.mercY||0))/b)}return this}});xa.prototype={constructor:xa,buffer:function(a,c){return new xa(this.x-a,this.y-(c||a),this.w+a*2,this.h+(c||a)*2)},center:function(){return new U(this.x+(this.w>>1),this.y+(this.h>>1))}};Hits=function(){return{diffHits:function(a,
c){var b=[],f={},h;for(h=c.length;h--;)f[c[h].target.id]=true;for(h=a.length;h--;)f[a[h].target.id]||(b[b.length]=a[h]);return b},init:function(a,c,b,f,h){return{type:a,x:h.x,y:h.y,gridX:f.x|0,gridY:f.y|0,elements:[],absXY:c,relXY:b}},initHit:function(a,c,b){return{type:a,target:c,drag:b}},triggerEvent:function(a,c,b,f){c.triggerCustom(a.type+(b?b:"Hit"),{hitType:a.type},f?f:a.elements,a.absXY,a.relXY,new wa(a.gridX,a.gridY))}}}();var xb=function(a){function c(i,k){var j=b[i],e;j||(j=b[i]=[]);(e=
j[k])||(e=j[k]=[]);return e}a=a||128;var b=[],f={},h=0;return{copyInto:function(i){for(var k in f){var j=f[k];i.insert(j.bounds||j,j,k)}},insert:function(i,k,j){var e=i.x/a|0,o=i.y/a|0,d=(i.x+i.w)/a|0;i=(i.y+i.h)/a|0;j=j||k.id||"obj_"+h++;f[j]=k;for(k=e;k<=d;k++)for(e=o;e<=i;e++)c(k,e).push(j)},remove:function(i,k,j){j=j||k.id;if(f[j]){var e=i.x/a|0;k=i.y/a|0;var o=(i.x+i.w)/a|0;i=(i.y+i.h)/a|0;delete f[j];for(e=e;e<=o;e++)for(var d=k;d<=i;d++){var n=c(e,d),m=kb.call(n,j);m>=0&&n.splice(m,1)}}},search:function(i){var k=
i.y/a|0,j=(i.x+i.w)/a|0,e=(i.y+i.h)/a|0,o=[],d=[];for(i=i.x/a|0;i<=j;i++)for(var n=k;n<=e;n++)o=o.concat(c(i,n));o.sort();for(k=o.length;k--;){j=o[k];if(e=f[j])d[d.length]=e;for(;k>0&&o[k-1]==j;)k--}return d}}},bb=function(){var a={},c=0;(new Date).getTime();var b={},f=[];Ha.attach(function(h){h=h||(new Date).getTime();for(var i=0;i<f.length;){var k=f[i],j=b[k],e=b[k].image&&b[k].image.complete&&b[k].image.width>0,o=h-j.start;o=e||o>=3E4;if(e){e=j.callbacks;a[k]=j.image;for(var d=0;d<e.length;d++)e[d](j.image,
true)}if(o){f.splice(i,1);delete b[k]}else i++}},250);return function(h,i){var k=h&&i?a[h]:null;if(k&&k&&k.complete&&k.width>0)i(k);else if(k=b[h])k.callbacks.push(i);else{k=new Image;k.id="_ldimg"+ ++c;b[h]={start:(new Date).getTime(),image:k,callbacks:[i]};k.src=h;f[f.length]=h}}}();hb.prototype={constructor:hb,load:function(a){var c=this;bb(this.url,function(b){c.loaded=true;c.image=b;a&&a()})}};var Zb=function(){return ya({fastpan:true,applyStyle:function(){},applyTransform:function(a,c,b){return{restore:null,
x:c,y:b}},getDimensions:function(){return{width:0,height:0}},getViewport:function(){},hitTest:function(){return false},prepare:function(){},projectXY:null,reset:function(){}})};fa("renderer","canvas",function(a,c,b,f,h){function i(p,w,A){var r,C;g[w]=function(D){for(r=v.length;r--;)if(C=A[v[r]])D[B[r]]=C}}function k(p,w,A){return{draw:A||x,viewport:p,hit:w&&d.isPointInPath(w.x,w.y),vpX:n,vpY:m,context:d}}f=K({},f);var j,e,o,d,n=0,m=0,g={},l=null,t={},u=function(){},x=function(){this.fill&&d.fill();
this.stroke&&d.stroke()},v=["fill","stroke","lineWidth","opacity"],B=["fillStyle","strokeStyle","lineWidth","globalAlpha"];(function(){function p(r,C){this.save();this.setTransform(1,0,0,1,0,0);var D=this.isPointInPath_old(r,C);this.restore();return D}var w=CanvasRenderingContext2D.prototype,A=document.createElement("canvas").getContext("2d");A.translate(50,0);A.moveTo(125,50);A.arc(100,50,25,0,360,false);if(!A.isPointInPath(150,50)){w.isPointInPath_old=w.isPointInPath;w.isPointInPath=p}})();if(c){j=
c.offsetWidth;e=c.offsetHeight;o=Z.create("canvas",null,{position:"absolute","z-index":1});o.width=j;o.height=e;a.attachFrame(o,true);d=null}b=K(h,{applyStyle:function(p){var w=g[p],A=d&&d.canvas?d.canvas.id:"default",r;t[A]||(t[A]=[]);r=t[A].pop()||"reset";if(w){t[A].push(p);w(d);return r}},applyTransform:function(p){if(p.translateX!==0||p.translateY!==0||p.scaling!==1||p.rotation!==0){d.save();l={undo:function(){d.restore();l=null},x:p.xy.x,y:p.xy.y};d.translate(p.xy.x-n+p.translateX,p.xy.y-m+p.translateY);
p.rotation!==0&&d.rotate(p.rotation);p.scaling!==1&&d.scale(p.scaling,p.scaling)}return l},drawTiles:function(p,w,A){for(var r=w.length;r--;){p=w[r];if(!p.loaded&&A)p.load(a.invalidate);else p.image&&d.drawImage(p.image,p.x-n,p.y-m)}},prepare:function(p,w){var A,r=false;if(d)d.restore();else d=o.getContext("2d");for(A=p.length;A--;)r=r||p[A].clip;n=w.x;m=w.y;if(d){r||d.clearRect(0,0,j,e);d.save()}d.globalCompositeOperation="source-over";return d},prepArc:function(p,w,A){d.beginPath();d.arc(p.xy.x-
(l?l.x:n),p.xy.y-(l?l.y:m),p.size>>1,p.startAngle,p.endAngle,false);return k(w,A)},prepImage:function(p,w,A,r){var C=(r.x||p.xy.x)-(l?l.x:n),D=(r.y||p.xy.y)-(l?l.y:m),G=r.image||p.image;if(G){d.beginPath();d.rect(C,D,r.width||G.width,r.height||G.height);return k(w,A,function(){d.drawImage(G,C,D,r.width||G.width,r.height||G.height)})}},prepMarker:function(p,w,A){var r=p.xy.x-(l?l.x:n),C=p.xy.y-(l?l.y:m),D=p.size,G=undefined;d.beginPath();switch(p.markerType.toLowerCase()){case "image":G=u;d.rect(r-
(D>>1),C-(D>>1),D,D);if(p.reset&&p.image){p.image=null;p.reset=false}p.image?d.drawImage(p.image,r-(D>>1),C-(D>>1),D,D):bb(p.imageUrl,function(F){p.image=F;d.drawImage(p.image,r-(D>>1),C-(D>>1),D,D)});break;default:d.moveTo(r,C);d.lineTo(r-(D>>1),C-D);d.lineTo(r+(D>>1),C-D);d.lineTo(r,C)}return k(w,A,G)},prepPoly:function(p,w,A,r){var C=true;p=r.points||p.points().cull(w);r=l?l.x:n;var D=l?l.y:m;d.beginPath();for(var G=p.length;G--;){var F=p[G].x-r,O=p[G].y-D;if(C){d.moveTo(F,O);C=false}else d.lineTo(F,
O)}return k(w,A)},getContext:function(){return d}});(function(){Gb.each(function(p,w){i(null,p,w)});I.bind("styleDefined",i)})();b.bind("detach",function(){c.removeChild(o)});b.bind("resize",function(){});return b});fa("renderer","dom",function(a,c,b,f,h){function i(d){var n=d.image=new Image;e[d.id]=d;n.src=d.url;n.onload=function(){if(o[d.id])j.appendChild(this);else d.image=null};n.style.cssText="-webkit-user-select: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute;";
return n}function k(d,n,m){var g=[],l;for(l in d){var t=d[l];if(m?t[m]:!n[l]){if(t.image&&t.image.parentNode){j.removeChild(t.image);t.image=null}g[g.length]=l}}for(n=g.length;n--;)delete d[g[n]]}var j=null,e={},o={};j=Z.create("div","",Z.styles({width:c.offsetWidth+"px",height:c.offsetHeight+"px"}));c.childNodes.length>0?c.insertBefore(j,c.childNodes[0]):c.appendChild(j);a.attachFrame(j);b=K(h,{drawTiles:function(d,n,m){for(var g,l=d.x,t=d.y,u=n.length;u--;){d=n[u];if(d.url){(g=d.image||(m?i(d):
null))&&Z.move(g,d.x-l,d.y-t);o[d.id]=d}}}});b.bind("predraw",function(){k(e,o);o={}});b.bind("detach",function(){c.removeChild(j)});a.bind("reset",function(){for(k(e,o={});j.childNodes.length>0;)j.removeChild(j.childNodes[0])});return b});var Gb=function(){function a(b,f){if(P(b,qa)){I.trigger("styleDefined",b,c[b]=f);return b}else{var h=[],i;for(i in b)h[h.length]=a(i,b[i]);return h}}var c={};a({reset:{fill:"#ffffff",opacity:1},highlight:{fill:"#ff0000"},waypoints:{lineWidth:4,stroke:"#003377",
fill:"#ffffff"},waypointsHover:{lineWidth:4,stroke:"#ff0000",fill:"#ffffff"}});return{resetStyle:"reset",each:function(b){for(var f in c)b(f,c[f])},get:function(b){return c[b]},define:a}}();fa("view","view",function(a){function c(q,s,z,J){q=C?Ga(V+Ca(2,J)-1,0.125):J>0?2:0.5;p(q,false,true)}function b(q,s){var z=W&&W.projectXY?W.projectXY(q,s):null;if(!z){z=x();var J=1/V;z=new M.XY(z?z.x+q*J:q,z?z.y+s*J:s)}return z.sync(M,true)}function f(q,s,z){w("doubleTap",s,z,b(z.x,z.y));a.scalable&&p(2,{easing:"quad.out",
duration:300},true)}function h(q,s,z){N=null;Q=true;t("down",s,z)}function i(q,s,z){t("hover",s,z)}function k(q,s,z,J){m(s,z,false);if(!N){L=J.x;T=J.y}}function j(q,s,z){m(s,z,true);Q=false}function e(){clearTimeout(Hb);Hb=setTimeout(function(){if(E)if(E.offsetWidth!==Na*2||E.offsetHeight!==Oa*2){var q=u();l(a.container);u(q.x,q.y)}},250)}function o(q,s,z){t("tap",s,z);M.trigger("tap",s,z,b(z.x,z.y,true))}function d(){ja&&ja.unbind();if(W){ja=INTERACT.watch(W.interactTarget||E);if(a.scalable){ja.bind("zoom",
c);ja.bind("doubleTap",f)}ja.bind("pointerDown",h);ja.bind("pointerMove",k);ja.bind("pointerUp",j);a.captureHover&&ja.bind("pointerHover",i);ja.bind("tap",o)}}function n(q){if(W){W.trigger("detach");W=null}var s=M,z=R,J=E,Y=a;q=q.split("/");for(var ba=new Zb(s,z,J,Y),ta=0;ta<q.length;ta++)ba=Aa("renderer",q[ta],s,z,J,Y,ba);W=ba;H=W.fastpan&&Z.transforms;C=Z.transforms&&a.useTransforms;d();M.trigger("reset");B()}function m(q,s,z){if(N){q=b(s.x,s.y);N.drag.call(N.target,N,q.x,q.y,z)&&da++;if(z)N=null}}
function g(q){for(var s=O;s--;)if(F[s].id===q)return s;return O}function l(q){E=document.getElementById(q);E.appendChild(y=Z.create("div","",Z.styles({overflow:"hidden",width:E.offsetWidth+"px",height:E.offsetHeight+"px"})));q=a.padding;if(q===r){q=E.offsetWidth;var s=E.offsetHeight,z=nb(q*q+s*s);ka=new U(z-q>>1,z-s>>1)}else ka=new U(q,q);cb=y.offsetWidth+ka.x*2;db=y.offsetHeight+ka.y*2;pb=cb/2;qb=db/2;Na=E.offsetWidth/2;Oa=E.offsetHeight/2;Pa=new U(pb,qb);y.appendChild(R=Z.create("div","",Z.styles({width:cb+
"px",height:db+"px","z-index":2,margin:-ka.y+"px 0 0 "+-ka.x+"px"})));n(a.renderer);q=a.controls;for(s=0;s<G.length;s++)G[s].trigger("detach");G=[];for(s=0;s<q.length;s++)G[G.length]=Aa("control",q[s],M,y,E,a[q[s]])}function t(q,s,z){var J=(new U(z.x-Na+pb,z.y-Oa+qb)).rotate(-pa*aa,Pa).scale(1/V,Pa);ga=Hits.init(q,s,z,b(z.x,z.y,true),J);for(q=O;q--;)if(F[q].visible)ma=ma||(F[q].hitGuess?F[q].hitGuess(ga.gridX,ga.gridY,M):false);ma&&da++}function u(q,s,z){if(P(q,qa)||P(q,Wb)){s=new M.XY(q);s.sync(M);
q=s.x;s=s.y}if(P(q,sa)){A(q-Na-ka.x,s-Oa-ka.y,z);return M}else return A().offset(Na+ka.x|0,Oa+ka.y|0).sync(M,true)}function x(){var q=new xa(S,X,cb,db);q.scaleFactor=V;q.padding=ka?ka.copy():new U;return q}function v(q,s,z){if(P(q,qa)&&P(s,ra))for(s=0;s<O;s++){if(F[s].id===q)return F[s]}else if(P(q,qa)){s=Aa("layer",s,M,z);s.added=(new Date).getTime();s.id=q;F[g(q)]=s;F.sort(function(J,Y){return Y.zindex-J.zindex||Y.added-J.added});O=F.length;M.trigger("resync");B();M.trigger("layerChange",M,s);da++;
return s}else return[].concat(F)}function B(){var q=x();if(q){if(Ia||Ja)if(q){var s=eb?S+(q.w>>1):S,z=fb?X+(q.h>>1):X,J=q.w,Y=q.h;if(Ia&&Ia>J)if(s+J>Ia)S=eb?S:Ia-J;else if(s<0)S=eb?S:0;if(Ja&&Ja>Y)if(z+Y>Ja)X=fb?X:Ja-Y;else if(z<0)X=fb?X:0}Ib=S;Jb=X;M.trigger("refresh",M,q);da++}}function p(q,s,z){if(P(q,sa)){var J=z?q:V*q;if(!$b){s=null;q=La(Da(J)/Math.LN2);J=Ca(2,q)}if(s)Qa=ua.tween([V],[J],s,function(){V=J;Qa=null;da++});else{V=J;da++}return M}else return V}function w(){for(var q=M.trigger.apply(null,
arguments).cancel,s=F.length;s--;)q=F[s].trigger.apply(null,arguments).cancel||q;return!q}function A(q,s,z){if(P(q,sa)){if(z)Ba=ua.tween([S,X],[q,s],z,function(){Ba=null});else{S=q|0;X=s|0;da++}return M}else return(new M.XY(S,X)).sync(M,true)}a=K({container:"",captureHover:true,controls:[],drawOnScale:true,padding:128,inertia:true,refreshDistance:128,pannable:true,scalable:true,renderer:"canvas",useTransforms:true},a);var r="auto",C=true,D=false,G=[],F=[],O=0,R=null,y=null,E,N=null,ia=!P(window.attachEvent,
ra),ma=false,H,Q=false,L=0,T=0,ea=a.refreshDistance,S=0,X=0,Ra=0,Sa=0,Ib=0,Jb=0,Ia=null,Ja=null,eb=false,fb=false,Ba=null,ka,ga=null,Ta=null,W,Hb=0,Pa=new U,pa=0,Ua=null,V=1,Qa=null,rb=1,ja=null,sb={index:0,draw:false},$b=true,da=0,cb,db,pb,qb,Na,Oa,M={XY:U,id:a.id,panSpeed:0,attachFrame:function(q,s){s&&R.appendChild(q)},center:u,detach:function(){W&&W.trigger("detach");ja&&ja.unbind();if(y){E.removeChild(y);R=y=null}},frozen:function(q){if(P(q,ra))return D;else{D=q;return M}},layer:v,invalidate:function(){da++},
pan:function(q,s,z){A(S+q,X+s,z)},refresh:B,rotate:function(q,s,z){if(P(q,sa)){var J=z?q:pa+q;if(s)Ua=ua.tween([pa],[J],s,function(){pa=J%360;Ua=null;da++});else{pa=J%360;da++}return M}else return pa},scale:p,triggerAll:w,setMaxOffset:function(q,s,z,J){Ia=q;Ja=s;eb=z;fb=J},offset:A,viewport:x};ya(M);M.bind("resize",e);M.bind("layerRemove",function(q,s){var z=kb(F,s.id);if(z>=0&&z<O){F.splice(z,1);da++}O=F.length});Ab(M,a,{container:l,captureHover:d,scalable:d,pannable:d,renderer:n});v("markers","draw",
{zindex:20});l(a.container);ia?window.attachEvent("onresize",e):window.addEventListener("resize",e,false);Ha.attach(function(q){var s=[],z,J,Y;if(!D){self.panSpeed=panSpeed=oa(L)+oa(T);(z=V!==rb)&&M.trigger("scale");if(panSpeed>0||z||Ba||Qa||Ua){da++;if(Ba&&panSpeed>0){Ba(true);Ba=null}}if(panSpeed<2&&(oa(S-Ib)>=ea||oa(X-Jb)>=ea))B();sb.index++;sb.draw=da||panSpeed||0;if(W&&sb.draw){if(Qa)V=Qa()[0];if(Ua)pa=Ua()[0];Ra+=L;Sa+=T;if(L||T)M.trigger("pan");if(C){if(V!==1)s[s.length]="scale("+V+")";if(pa!==
0)s[s.length]="rotate("+pa+"deg)"}if(z=!H||(a.drawOnScale||V===1)&&panSpeed<5){if(Ba){z=Ba();S=z[0]|0;X=z[1]|0}else{J=-pa*aa;z=za(J)*Ra+-ha(J)*Sa;J=ha(J)*Ra+za(J)*Sa;S=S-z/V|0;X=X-J/V|0}Y=x();W.trigger("predraw",Y);if(W.prepare(F,Y,q,ga)){J=Sa=z=Ra=da=0;for(ii=O;ii--;){var ba=F[ii];if(ba.visible){var ta=ba.style?W.applyStyle(ba.style,true):null;ba.draw(W,Y,M,q,ga);ta&&W.applyStyle(ta)}}W.trigger("render",Y);M.trigger("drawComplete",Y,q);Z.move(R,z,J,s,Pa)}}else Z.move(R,Ra,Sa,s,Pa);if(Q||!a.inertia)T=
L=0;else if(L!=0||T!=0){L*=0.8;T*=0.8;if(oa(L)<0.5)L=0;if(oa(T)<0.5)T=0}if(ga){q=true;s=ga?ga.elements:[];if(Ta&&Ta.type==="hover"){diffElements=Hits.diffHits(Ta.elements,s);if(diffElements.length>0)Hits.triggerEvent(Ta,M,"Out",diffElements);else q=false}if(s.length>0){J=ga.gridX;Y=ga.gridY;for(z=s.length;z--;){ba=s[z];ta=J;var Kb=Y,Lb=ba&&ba.drag&&(!ba.canDrag||ba.canDrag(ba,ta,Kb));if(Lb){N=ba;N.startX=ta;N.startY=Kb}if(Lb)break}q&&Hits.triggerEvent(ga,M)}Ta=s.length>0?K({},ga):null;ga=null}if(rb!==
V){M.trigger("scaleChanged",V);rb=V}}}});return M});fa("view","map",function(a){function c(e,o){var d=j.viewport();if(e){d=Ga(e.bestZoomLevel(d),o||0);return b(d).center(e.center())}else return new Fa((new wa(d.x,d.y2)).sync(j,true).pos(),(new wa(d.x2,d.y)).sync(j,true).pos())}function b(e,o,d){if(P(e,sa)){e=Ga(a.minZoom,Ma(a.maxZoom,e|0));if(e!==i){var n=j.viewport(),m=j.offset(),g=n.w/2;n=n.h/2;var l=Ca(2,e-i),t=g/l|0,u=n/l|0;i=e;j.offset(((o||m.x+g)-t)*l,((d||m.y+n)-u)*l);refreshY=refreshX=0;j.trigger("zoom",
e);j.trigger("reset");h=j.rpp=ca/(256<<i);j.setMaxOffset(ca/h|0,ca/h|0,true,false);j.scale(1,false,true);j.trigger("resync");j.refresh()}return j}else return i}a=K({controls:["zoombar"],minZoom:1,maxZoom:18,renderer:"canvas/dom",zoom:1,zoombar:{}},a);var f=new wa,h,i=a.zoom||a.zoomLevel,k=0,j=K(Aa("view","view",a),{XY:wa,bounds:c,zoom:b});j.bind("refresh",function(){var e=j.viewport();if(f.x!=e.x||f.y!=e.y){j.trigger("boundsChange",c());f.x=e.x;f.y=e.y}});j.bind("scaleChanged",function(e,o){var d=
Da(o)/Math.LN2|0;if(d!==0){o=Ca(2,d);clearTimeout(k);k=setTimeout(function(){b(i+d)},500)}});return j});var ua=function(){return{tween:function(a,c,b,f,h){function i(l){var t=l-g;l=g+m<=l;for(var u=k;u--;){j[u]=o(t,a[u],d[u],m);h&&h.invalidate()}if(l||n){Ha.detach(i);for(u=0;u<e.length;u++)e[u]&&e[u](j,t,n)}}b=K({easing:"sine.out",duration:1E3,complete:null},b);var k=a.length,j=[].concat(a),e=[f,b.complete],o=Qb(b.easing),d=[],n=false,m=b.duration,g=(new Date).getTime();for(b=k;b--;)d[b]=c[b]-a[b];
Ha.attach(i);return function(l){n=l;return j}},tweenDrawable:function(a,c,b,f,h){var i=ua.tween([b],[f],h,function(){a[c]=f;for(var j=a.tweens.length;j--;)if(a.tweens[j]===k){a.tweens.splice(j,1);break}},a.view),k=function(){a[c]=i()[0]};return k}}}(),Ea=function(a,c,b){b=K({style:null,xy:null,size:20,fill:false,stroke:true,draggable:false,observable:true,properties:{},typeName:"Shape",zindex:0},b);K(this,b);if(P(this.xy,qa))this.xy=new a.XY(this.xy);this.id="drawable_"+Yb++;this.bounds=null;this.view=
a;this.layer=c;this.tweens=[];this.rotation=this.animations=0;this.scaling=1;this.translateY=this.translateX=0;this.observable&&ya(this)};Ea.prototype={constructor:Ea,applyTweens:function(){for(var a=this.tweens.length;a--;)this.tweens[a]()},drag:null,draw:null,getProps:null,resync:function(){if(this.xy){this.xy.sync(this.view);if(this.size){var a=this.size>>1;this.updateBounds(new xa(this.xy.x-a,this.xy.y-a,this.size,this.size))}}},rotate:function(a,c,b){if(P(a,sa)){a=(b?a:this.rotation*na+a)*aa;
if(c)this.tweens.push(ua.tweenDrawable(this,"rotation",this.rotation,a,c));else{this.rotation=a;this.view.invalidate()}return this}else return this.rotation*na},scale:function(a,c,b){if(P(a,sa)){a=b?a:this.scaling*a;if(c)this.tweens.push(ua.tweenDrawable(this,"scaling",this.scaling,a,c));else{this.scaling=a;this.view.invalidate()}return this}else return this.scaling},translate:function(a,c,b,f){if(P(a,sa)){a=f?a:this.translateX+a;c=f?c:this.translateY+c;if(b){this.tweens.push(ua.tweenDrawable(this,
"translateX",this.translateX,a,b));this.tweens.push(ua.tweenDrawable(this,"translateY",this.translateY,c,b))}else{this.translateX=a;this.translateY=c;this.view.invalidate()}return this}else return new U(this.translateX,this.translateY)},updateBounds:function(a,c){a&&(!this.bounds||a.x!=this.bounds.x||a.y!=this.bounds.y)&&this.trigger("move",this,a,this.bounds);this.bounds=a;if(c)this.xy=this.bounds.center()}};fa("drawable","marker",function(a,c,b){b=K({fill:true,stroke:false,markerType:"simple",hoverStyle:"highlight",
typeName:"Marker"},b);return new Ea(a,c,b)});fa("drawable","poly",function(a,c,b){function f(){var d,n,m,g,l,t,u;e=b.simplify?j.simplify():j;for(d=e.length;d--;){n=e[d].x;m=e[d].y;t=P(t,ra)||n<t?n:t;u=P(u,ra)||m<u?m:u;g=P(g,ra)||n>g?n:g;l=P(l,ra)||m>l?m:l}o.updateBounds(new xa(t,u,g-t,l-u),true);a.invalidate()}function h(d){if(P(d,yb)){j=new Ka(b.allowCull);Fb.process(d,function(n,m){for(var g=0;g<m;g++)j.push(new a.XY(n[g]))},i,k);return o}else return e}function i(){j.length&&Fb.process(j,function(d,
n){for(var m=n;m--;)d[m].sync(a)},f,k)}b=K({allowCull:false,simplify:false,fill:true,points:[],typeName:"Poly"},b);var k=500,j=new Ka(b.allowCull),e,o=K(new Ea(a,c,b),{points:h,resync:i});h(b.points);return o});fa("drawable","line",function(a,c,b){b.fill=false;b.allowCull=true;return Aa("drawable","poly",a,c,b)});fa("drawable","image",function(a,c,b){function f(){if(e&&e.width>0){if(!this.centerOffset)this.centerOffset=new U(-e.width>>1,-e.height>>1);this.updateBounds(new xa(this.xy.x+this.centerOffset.x,
this.xy.y+this.centerOffset.y,e.width,e.height),false)}}function h(d){if(this.imageUrl=d){var n=this;bb(this.imageUrl,function(m,g){e=m;if(g){var l=o.layer?o.layer.view:null;l&&l.invalidate()}f.apply(n)})}}b=K({image:null,imageUrl:null,centerOffset:null,typeName:"Image"},b);var i=Ea.prototype.resync,k=0,j=0,e=b.image,o=K(new Ea(a,c,b),{changeImage:h,getProps:function(){this.bounds||f(this,e);return{image:e,x:this.xy.x+k,y:this.xy.y+j}},resync:function(d){i.call(this,d);f.call(this)}});e||h.call(this,
this.imageUrl);if(this.centerOffset){k=this.centerOffset.x;j=this.centerOffset.y}});fa("drawable","arc",function(a,c,b){b=K({startAngle:0,endAngle:Math.PI*2,typeName:"Arc"},b);return new Ea(a,c,b)});Xa.prototype={constructor:Xa,clip:null,cycle:function(){},draw:function(){},hitGuess:null,remove:function(){this.view.trigger("layerRemove",this)}};fa("layer","tile",function(a,c){c=K({generator:"osm",imageLoadArgs:{}},c);var b=Aa("generator",c.generator,c).run,f=null,h=[],i=K(new Xa(a,c),{draw:function(k,
j,e){k.drawTiles&&k.drawTiles(j,f.search(j.buffer(128)),e.panSpeed<2)}});a.bind("resync",function(){var k=a&&a.zoom?a.zoom():0;h[k]||(h[k]=wb(k));f=h[k]});a.bind("refresh",function(k,j,e){f&&b(j,e,f,function(){j.invalidate()})});return i});fa("layer","draw",function(a,c){function b(j,e,o,d){var n=this.dragOffset;if(!n)n=this.dragOffset=new a.XY(j.startX-this.xy.x,j.startY-this.xy.y);this.xy.x=e-n.x;this.xy.y=o-n.y;if(d){delete this.dragOffset;a.invalidate();this.xy.sync(a,true);this.trigger("dragDrop")}return true}
function f(j,e,o,d){d&&i.remove(d,e);i.insert(o,e)}c=K({zindex:10},c);var h=[],i,k=K(new Xa(a,c),{itemCount:0,clear:function(){i=new xb;h=[];k.trigger("cleared");k.itemCount=0;a.invalidate()},create:function(j,e,o){e=Aa("drawable",j,a,k,e);if(o)h.unshift(e);else h[h.length]=e;e.resync();i&&e.bounds&&i.insert(e.bounds,e);e.bind("move",f);k.itemCount=h.length;k.trigger(j+"Added",e);return e},draw:function(j,e,o,d,n){o={};d=i&&e?i.search(e):[];for(var m=d.length;m--;){var g=d[m],l=g.style||k.style,t,
u,x=g.getProps?g.getProps(j):o;t=j["prep"+g.typeName];g.tweens.length>0&&g.applyTweens();u=j.applyTransform(g);if(x=t?t.call(j,g,e,n,x):null){if(n&&x.hit){n.elements.push(Hits.initHit(g.type,g,g.draggable?b:null));t=n.type+"Style";l=g[t]||k[t]||l}l=l?j.applyStyle(l,true):null;(t=g.draw||x.draw)&&t.call(g,x);l&&j.applyStyle(l)}u&&u.undo&&u.undo()}},find:function(){return[].concat(h)},hitGuess:function(j,e){return i&&i.search({x:j-10,y:e-10,w:20,h:20}).length>0}});a.bind("resync",function(){i=wb(a.zoom(),
i);for(var j=h.length;j--;)h[j].resync()});return k});Ya.prototype={constructor:Ya};fa("control","zoombar",function(a,c,b,f){function h(r,C){var D=B[r]=Z.create("div","t5-zoombar-button",{position:"absolute",background:i(r),"z-index":51,width:f.width+"px",height:f.buttonHeight+"px","margin-top":(C||0)+"px"});p.appendChild(D)}function i(r,C){return"url("+f.images+") 0 -"+(n+g*3+(r||0)*o*3+(C||0)*o)+"px"}function k(r){return"url("+f.images+") 0 -"+(n+(r||0)*g)+"px"}function j(r,C){var D;if(r===m){m.style.background=
k(C);D="thumb"}else for(var G=0;G<B.length;G++)if(r===B[G]){D="button"+G;B[G].style.background=i(G,C);break}return D}function e(r){if(r!==x){x=r;u=t-x/v*(t-l)|0;Z.move(m,0,u-l);clearTimeout(w);w=setTimeout(function(){a.zoom(x)},500)}}f=K({width:24,height:200,images:"img/zoom.png",align:"right",marginTop:10,spacing:10,thumbHeight:16,buttonHeight:16},f);var o=f.buttonHeight,d,n=f.height,m,g=f.thumbHeight,l=f.spacing+o-(g>>1),t=f.height-o-(g>>1),u=l,x=-1;c=a.minZoom();var v=a.maxZoom()-c+1,B=[],p,w=
0,A={button0:function(){a.zoom(a.zoom()+1)},button1:function(){a.zoom(a.zoom()-1)}};p=Z.create("div","t5-zoombar",{position:"absolute",background:"url("+f.images+")","z-index":50,overflow:"hidden",width:f.width+"px",height:f.height+"px",margin:function(){var r=f.spacing,C=va("{0}px 0 0 {1}px");if(f.align==="right")r=b.offsetWidth-f.width-f.spacing;return C(f.marginTop,r)}()});b.childNodes[0]?b.insertBefore(p,b.childNodes[0]):b.appendChild(p);p.appendChild(m=Z.create("div","t5-zoombar-thumb",{position:"absolute",
background:k(),"z-index":51,width:f.width+"px",height:f.thumbHeight+"px",margin:"10px 0 0 0",top:u-l+"px"}));h(0);h(1,f.height-f.buttonHeight);d=INTERACT.watch(p,{bindTarget:p});d.bind("pointerMove",function(r,C,D){u=Math.min(Math.max(l,D.y-(g>>1)),t);e(v-(u-l)/t*v|0)});d.bind("pointerDown",function(r){j(r.target,2)});d.bind("pointerUp",function(r){j(r.target,0)});d.bind("tap",function(r){(r=A[j(r.target,2)])&&r()});c=new Ya(a);c.bind("detach",function(){d.unbind();b.removeChild(p)});a.bind("zoom",
function(r,C){e(C)});e(a.zoom());return c});$.prototype={constructor:$,distanceTo:function(){if(!targetPos||this.empty()||targetPos.empty())return 0;var a=(targetPos.lat-this.lat)*aa>>1,c=(targetPos.lon-this.lon)*aa>>1;a=ha(a)*ha(a)+za(this.lat*aa)*za(targetPos.lat*aa)*ha(c)*ha(c);return 6371*2*Vb(nb(a),nb(1-a))},equalTo:function(a){return pos&&this.lat===a.lat&&this.lon===a.lon},empty:function(){return this.lat===0&&this.lon===0},inArray:function(a){for(var c=a.length;c--;)if(this.equal(a[c]))return true;
return false},offset:function(a,c){var b=this.lat*aa,f=this.lon*aa,h=b+a/6371;b=Eb(ha(c/6371)/za(b));f=f+b;h=(h+Wa)%Math.PI-Wa;f%=ca;return new $(h*na,f*na)},toPixels:function(){return ab(this.lon,this.lat)},toBounds:function(a){var c=a.radians(),b=this.lat*aa,f=this.lon*aa;a=b-c;var h=b+c;if(a>Bb&&h<mb){b=Eb(ha(c)/za(b));c=f-b;if(c<Ub)c+=ca;f=f+b;if(f>Cb)f-=ca}else{a=Ga(a,Bb);h=Ma(h,mb);c=zb;f=Za}return new Fa(new $(a*na,c*na),new $(h*na,f*na))},toString:function(a){return this.lat+(a||" ")+this.lon}};
(function(){fa("fn","generalize",function(a,c,b){var f=a.length,h=[],i=null;b=(b||250)/1E3;for(f=f;f--;)if(f===0)h.unshift(a[f]);else{var k=!i||a[f].inArray(c)?b:i.distanceTo(a[f]);if(a[f]&&k>=b){h.unshift(a[f]);i=a[f]}}return h})})();Fa.prototype={constructor:Fa,bestZoomLevel:function(a){var c=this.center();c=Ma(La(oa(c.lat)*0.05),lb.length);var b=lb[c],f=this.size();c=Db(Da(lb[3]*a.h/f.y)/Da(2));a=Db(Da(b*a.w/f.x)/Da(2));return Ma(isNaN(c)?1E3:c,isNaN(a)?1E3:a)},center:function(){var a=this.size();
return new $(this.min.lat+(a.y>>1),this.min.lon+(a.x>>1))},expand:function(a){return new Fa(new $(this.min.lat-a,(this.min.lon-a)%360),new $(this.max.lat+a,(this.max.lon+a)%360))},size:function(a){var c=new U(0,this.max.lat-this.min.lat);c.x=(a||P(a,ra))&&this.min.lon>this.max.lon?360-this.min.lon+this.max.lon:this.max.lon-this.min.lon;return c},toString:function(){return"min: "+this.min+", max: "+this.max}};jb.prototype={add:function(){for(var a=this.meters,c=arguments.length;c--;)a+=arguments[c].meters;
return new jb(a)},radians:function(a){if(P(a,sa)){this.meters=a*6371E3;return this}else return this.meters/6371E3},toString:function(){if(this.meters>1E3)return(this.meters/10|0)/100+"km";return this.meters+"m"}};K(I,{ex:K,log:la,observable:ya,configurable:Ab,formatter:va,wordExists:function(a,c){for(var b=a.split(/\s|\,/).length;b--;)if(a.toLowerCase()==c.toLowerCase())return true;return false},is:P,indexOf:kb,fn:function(a){return Xb("fn",a)},project:ab,unproject:ob,getImage:bb,userMessage:function(a,
c,b){I.trigger("userMessage",a,c,b)},Registry:$a,Style:Gb,DOM:Z,Rect:xa,XY:U,Line:Ka,Pos:$,BBox:Fa,Distance:jb,Hits:Hits,Control:Ya,Tile:hb,Tweener:ua});I.RouteTools=function(){function a(d){if(i.test(d))return"-slight";return""}function c(d,n){n.geometry&&d.layer("route","draw").create("line",{points:n.geometry,style:"waypoints",simplify:true})}function b(d){for(var n="unknown",m=f||e,g=0;g<m.length;g++){m[g].regex.lastIndex=-1;var l=m[g].regex.exec(d);if(l){n=m[g].customCheck?m[g].customCheck(d,
l):m[g].turnType;break}}return n}var f=undefined,h=I.fn("generalize"),i=/bear/i,k=/right/i,j={unknown:"0:0",start:"1:0","continue":"1:1",arrive:"1:2",left:"2:0","left-slight":"2:1","left-sharp":"2:2",right:"3:0","right-slight":"3:1","right-sharp":"3:2","uturn-left":"4:0","uturn-right":"4:1",merge:"4:2",roundabout:"5:0",ramp:"6:0","ramp-exit":"6:1"},e=function(){var d=[];d.push({regex:/continue/i,turnType:"continue"});d.push({regex:/(take|bear|turn)(.*?)left/i,customCheck:function(n,m){return"left"+
a(m[1])}});d.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(n,m){return"right"+a(m[1])}});d.push({regex:/enter\s(roundabout|rotary)/i,turnType:"roundabout"});d.push({regex:/take.*?ramp/i,turnType:"ramp"});d.push({regex:/take.*?exit/i,turnType:"ramp-exit"});d.push({regex:/make(.*?)u\-turn/i,customCheck:function(n,m){return"uturn"+(k.test(m[1])?"-right":"-left")}});d.push({regex:/proceed/i,turnType:"start"});d.push({regex:/arrive/i,turnType:"arrive"});d.push({regex:/fell\sthrough/i,
turnType:"merge"});return d}(),o={calculate:function(d){d=K({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},d);var n=I.Registry.create("service","routing");n&&n.calculate(d,function(m){if(d.generalize)m.geometry=h(m.geometry,m.getInstructionPositions());if(d.map){c(d.map,m);d.autoFit&&d.map.bounds(m.boundingBox)}d.success&&d.success(m)})},createMapOverlay:c,getSpriteOffset:function(d,n){var m=j[d];if(m=m?m.split(":"):null)return{x:-m[0]*(n||16),y:-m[1]*(n||
16)};return null},parseTurnType:b,Instruction:function(d){var n=d=K({position:null,description:"",distance:0,distanceTotal:0,time:0,timeTotal:0,turnType:null},d),m=d.description;m=m.replace(/(\w)(\/)(\w)/g,"$1 $2 $3");n.description=m;if(!d.turnType)d.turnType=b(d.description);return d},RouteData:function(d){d=K({geometry:[],instructions:[],boundingBox:null},d);if(!d.boundingBox)d.boundingBox=new I.BBox(d.geometry);return K({getInstructionPositions:function(){for(var n=[],m=0;m<d.instructions.length;m++)d.instructions[m].position&&
n.push(d.instructions[m].position);return n}},d)}};I.observable(o);return o}();I.Decarta=function(){function a(g){return j(i.clientName,i.clientPassword,i.sessionID,i.configuration,i.release,g)}function c(g,l){return e(g.maxResponses,g.version,g.requestID,g.methodName,l)}function b(g,l){i.server||la("No server configured for deCarta - we are going to have issues","warn");return o(i.server,g.requestID,escape(l))}function f(g,l){Rb(b(g,a(c(g,g.getRequestBody()))),function(t){var u=t.response.XLS.Response;
if(u.numberOfResponses>0&&u[g.methodName+"Response"]){t=null;if(g.parseResponse)t=g.parseResponse(u[g.methodName+"Response"]);l&&l(t)}else la("no responses from server: "+t.response,"error")})}function h(g,l){var t=new d({json:g.StreetAddress}),u=[];if(g.Place){if(!g.Place.length)g.Place=[g.Place];for(var x=g.Place.length;x--;)u[u.length]=g.Place[x].content}return new ADDR.Address({building:t.building,street:t.street,regions:u,countryCode:g.countryCode||"",postalCode:g.PostalCode||"",pos:l})}var i=
{sessionID:(new Date).getTime(),server:"",clientName:"",clientPassword:"",configuration:"",maxResponses:25,release:"4.4.2sp03",tileFormat:"PNG",fixedGrid:true,useCache:true,tileHosts:[],requestTimeout:3E4,geocoding:{countryCode:"US",language:"EN"}};TL=function(){function g(t,u){this.days=t||0;this.seconds=u||0}g.prototype={add:function(){for(var t=new g(this.days,this.seconds),u=arguments.length;u--;){t.days+=arguments[u].days;t.seconds+=arguments[u].seconds}return t},toString:function(){var t,u,
x,v="";if(this.days)v=this.days+" days ";if(this.seconds){x=this.seconds;if(x>=3600){t=~~(x/3600);x-=t*3600}if(x>=60){u=Math.round(x/60);x-=u*60}if(t)v=v+t+(t>1?" hrs ":" hr ")+(u?(u>10?u:"0"+u)+" min ":"");else if(u)v=v+u+" min";else if(x>0)v=v+(x>10?x:"0"+x)+" sec"}return v}};var l=function(){var t=/^P(\d+Y)?(\d+M)?(\d+D)?$/,u=/^(\d+H)?(\d+M)?(\d+S)?$/,x={8601:function(v){v=v.split("T");var B=null;B=null;var p=0,w=0;t.lastIndex=-1;B=t.exec(v[0]);p+=B[3]?parseInt(B[3].slice(0,-1),10):0;u.lastIndex=
-1;B=u.exec(v[1]);w+=B[1]?parseInt(B[1].slice(0,-1),10)*3600:0;w+=B[2]?parseInt(B[2].slice(0,-1),10)*60:0;w+=B[3]?parseInt(B[3].slice(0,-1),10):0;return new g(p,w)}};return function(v,B){var p=x[B];if(!p)throw"No parser found for the duration format: "+B;return p(v)}}();return{Duration:g,parse:l}}();var k=1,j=va("<xls:XLS version='1' xls:lang='en' xmlns:xls='http://www.opengis.net/xls' rel='{4}' xmlns:gml='http://www.opengis.net/gml'><xls:RequestHeader clientName='{0}' clientPassword='{1}' sessionID='{2}' configuration='{3}' />{5}</xls:XLS>"),
e=va("<xls:Request maximumResponses='{0}' version='{1}' requestID='{2}' methodName='{3}Request'>{4}</xls:Request>"),o=va("{0}/JSON?reqID={1}&chunkNo=1&numChunks=1&data={2}&responseFormat=JSON"),d=function(g){g=I.ex({json:{}},g);var l="",t="";if(g.json.Street)l=g.json.Street.content?g.json.Street.content:g.json.Street;l=l&&l.replace?l.replace(/\/\d+$/,""):"";if(g.json.Building)if(g.json.Building.number)t=g.json.Building.number;return{building:t,street:l,calcMatchPercentage:function(u){var x=0,v=I.Addressing.normalize(u),
B=I.Addressing.normalize(l);if(g.json.Building)if(I.Addressing.buildingMatch(u,g.json.Building.number.toString()))x+=0.2;if(v&&B&&I.wordExists(v,B))x+=0.8;return x},toString:function(){if(l)return(t?t+" ":"")+l;return""}}},n=function(){return{methodName:"",maxResponses:25,version:"1.0",requestID:k++,getRequestBody:function(){return""},parseResponse:function(g){return g}}},m=function(){return I.ex(new n,{methodName:"RUOK",parseResponse:function(g){return{aliasCount:g.maxHostAliases,host:g.hostName}}})};
I.Registry.register("generator","decarta",function(g){function l(x,v,B,p){if(x=x.zoom?x.zoom():0){var w=2<<x-1,A=w>>1,r=g.tileSize,C=(v.w/r|0)+1,D=(v.h/r|0)+1,G=(v.x/r|0)-A;v=w-(v.y/r|0)-A-D;var F=B.search({x:(A+G)*r,y:(A+v*-1-D)*r,w:C*r,h:D*r});w={};var O;for(O=F.length;O--;)w[F[O].id]=true;for(F=0;F<=C;F++)for(O=0;O<=D;O++){var R=G+F,y=v+O-1,E=R+"_"+y;if(!w[E]){R=new I.Tile((A+G+F)*r,(A+v*-1-O)*r,u[F%u.length]+"/openls/image-cache/TILE?LLMIN=0.0,0.0&LLMAX="+t[x]+"&CACHEABLE=true&DS=navteq-world&WIDTH=256&HEIGHT=256&CLIENTNAME="+
i.clientName+"&SESSIONID="+i.sessionID+"&FORMAT=PNG&CONFIG="+i.configuration+"&N="+y+"&E="+R,r,r,E);B.insert(R,R)}}p&&p()}}g=I.ex({tileSize:256},g);var t=["89.787438015348100000,360.00000000000000000","85.084059050110410000,180.00000000000000000","66.653475896509040000,90.00000000000000000","41.170427238429790000,45.000000000000000000","22.076741328793200000,22.500000000000000000","11.251819676168665000,11.250000000000000000","5.653589942659626000,5.625000000000000000","2.830287664051185000,2.812500000000000000",
"1.415581451872543800,1.406250000000000000","0.707845460801532700,0.703125000000000000","0.353929573271679340,0.351562500000000000","0.176965641673330230,0.175781250000000000","0.088482927761462040,0.087890625000000000","0.044241477246363230,0.043945312500000000","0.022120740293895182,0.021972656250000000","0.011060370355776452,0.010986328125000000","0.005530185203987857,0.005493164062500000","0.002765092605263539,0.002746582031250000","0.001382546303032519,0.001373291015625000","0.000691272945568983,0.000686645507812500",
"0.000345636472797214,0.000343322753906250"],u=null;I.userMessage("ack","decarta","&copy; deCarta, Inc. Map and Imagery Data &copy; NAVTEQ or Tele Atlas or DigitalGlobe");return{run:function(x,v,B,p){u?l(x,v,B,p):f(new m,function(w){u=[];if(w.aliasCount)for(var A=0;A<w.aliasCount;A++)u[A]="http://"+w.host.replace("^(.*?).(.*)$","\u0001-0"+(A+1)+".\u0002");else u=["http://"+w.host];l(x,v,B,p)})}}});I.Registry.register("service","geocoder",function(){var g=I.formatter('<xls:GeocodeRequest><xls:Address countryCode="{0}" language="{1}">{2}</xls:Address></xls:GeocodeRequest>'),
l=I.formatter('<xls:StreetAddress><xls:Building number="{0}" /><xls:Street>{1}</xls:Street></xls:StreetAddress>'),t=function(x,v){v=I.ex({countryCode:i.geocoding.countryCode,language:i.geocoding.language},v);var B=ADDR.parse(x),p=new n;return I.ex({},p,{methodName:"Geocode",getRequestBody:function(){var w=l(B.number,B.street);w+='<xls:Place type="Municipality">'+B.regions.join(" ")+"</xls:Place>";return g(v.countryCode,v.language,w)},parseResponse:function(w){var A=w.GeocodeResponseList;w=[];var r=
A?A.numberOfGeocodedAddresses:0,C=[];if(r>1)C=A.GeocodedAddress;else if(r==1)C=[A.GeocodedAddress];for(A=0;C&&A<C.length;A++){r=C[A];var D=null,G=null;if(r&&r.GeocodeMatchCode&&r.GeocodeMatchCode.matchType!=="NO_MATCH"){if(r&&r.Point)G=new I.Pos(r.Point.pos);if(r&&r.Address)D=h(r.Address,G)}(r=D)&&w.push(r)}return w}})},u=function(x){x=I.ex({position:null,geocodePreference:"StreetAddress"},x);return I.ex(new n,{methodName:"ReverseGeocode",getRequestBody:function(){return"<xls:ReverseGeocodeRequest><xls:Position><gml:Point><gml:pos>"+
x.position.toString()+"</gml:pos></gml:Point></xls:Position><xls:ReverseGeocodePreference>"+x.geocodePreference+"</xls:ReverseGeocodePreference></xls:ReverseGeocodeRequest>"},parseResponse:function(v){var B=null;if(v&&v.Point)B=new I.Pos(match.Point.pos);if(v&&v.ReverseGeocodedLocation&&v.ReverseGeocodedLocation.Address)return h(v.ReverseGeocodedLocation.Address,B);return null}})};typeof ADDR==="undefined"&&I.log("Sidelab addressing module not found, geocoder will not function","warn");return{forward:function(x,
v){f(new t(x),function(B){v(x,B)})},reverse:function(x,v){var B=new u({position:x});f(B,function(p){v&&v(p)})}}});I.Registry.register("service","routing",function(){var g=function(l){l=I.ex({waypoints:[],provideRouteHandle:false,distanceUnit:"KM",routeQueryType:"RMAN",routePreference:"Fastest",routeInstructions:true,routeGeometry:true},l);var t=new n,u=I.formatter('<xls:DetermineRouteRequest provideRouteHandle="{0}" distanceUnit="{1}" routeQueryType="{2}">'),x=I.formatter("<xls:{0}><xls:Position><gml:Point><gml:pos>{1}</gml:pos></gml:Point></xls:Position></xls:{0}>");
return I.ex({},t,{methodName:"DetermineRoute",getRequestBody:function(){if(l.waypoints.length<2)throw Error("Cannot send RouteRequest, less than 2 waypoints specified");var v=u(l.provideRouteHandle,l.distanceUnit,l.routeQueryType);v+="<xls:RoutePlan>";v+="<xls:RoutePreference>"+l.routePreference+"</xls:RoutePreference>";v+="<xls:WayPointList>";for(var B=0;B<l.waypoints.length;B++)v+=x(B===0?"StartPoint":B===l.waypoints.length-1?"EndPoint":"ViaPoint",l.waypoints[B].toString());v+="</xls:WayPointList>";
v+="</xls:RoutePlan>";if(l.routeInstructions)v+='<xls:RouteInstructionsRequest rules="maneuver-rules" providePoint="true" />';if(l.routeGeometry)v+="<xls:RouteGeometryRequest />";v+="</xls:DetermineRouteRequest>";return v},parseResponse:function(v){var B=I.RouteTools.RouteData,p=v.RouteGeometry.LineString.pos,w=p.length,A=Array(w);for(w=w;w--;)A[w]=new $(p[w]);p=v.RouteInstructionsList;v=[];p=p&&p.RouteInstruction?p.RouteInstruction:[];w=new I.Distance;for(var r=new TL.Duration,C=0;C<p.length;C++){var D=
I.Distance,G=p[C].distance,F={M:1,KM:1E3}[G.uom?G.uom.toUpperCase():"M"];D=new D(G.value&&F?G.value*F:0);G=TL.parse(p[C].duration,"8601");w=w.add(D);r=r.add(G);v.push(new I.RouteTools.Instruction({position:new I.Pos(p[C].Point),description:p[C].Instruction,distance:D,distanceTotal:w,time:G,timeTotal:r}))}return new B({geometry:A,instructions:v})}})};return{calculate:function(l,t){l=I.ex({waypoints:[]},l);if(typeof I.RouteTools!=="undefined"){var u=new g(l);f(u,function(x){t&&t(x)})}else la("Could not generate route, T5.RouteTools plugin not found",
"warn")}}});return{applyConfig:function(g){I.ex(i,g)},compareFns:function(){return{streetDetails:function(g,l){return l.calcMatchPercentage(g)},location:function(g,l){return l.calcMatchPercentage(g)}}}()}}();tb.T5=I;tb.Tile5=function(a,c){c=K({container:a,type:"map",renderer:"canvas",starpos:null,zoom:1,fastpan:false,drawOnScale:true,zoombar:{}},c);return Aa("view",c.type,c)}})(window);
