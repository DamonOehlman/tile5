(function(){function M(){var a=arguments[0]||{},d=Array.prototype.slice.call(arguments,1),b=d.length,f,i;for(i=0;i<b;i++)if((f=d[i])!==null)for(var j in f){var h=f[j];if(a!==h)if(h!==undefined)a[j]=h}return a}function xa(a,d){if(typeof console!=="undefined")console[d||"log"](a)}function pa(a){var d=a.match(Ab),b=[],f=0,i;for(i=d?d.length:0;i--;){var j=d[i].slice(1);b[j]||(b[j]=RegExp("\\{"+j+"\\}","g"))}f=b.length;return function(){var h=a;for(i=0;i<f;i++){var k=arguments[i];if(typeof k=="undefined")k=
"";h=h.replace(b[i],k)}return h}}function kb(a,d){var b=Pa*ea(a);return lb-2*mb(d*ya((1-b)/(1+b),Pa/2))}function W(a,d){if(S(a,qa)){var b=a.split(nb);this.x=parseFloat(b[0]);this.y=parseFloat(b[1])}else if(a&&a.x){this.x=a.x;this.y=a.y}else{this.x=a||0;this.y=d||0}}function Fa(a){this.allowCull=a}function ra(a,d,b,f){this.mercX=b;this.mercY=f;if(S(a,qa))M(this,Bb.parseXY(a));else a&&a.toBounds?M(this,Qa(a.lon,a.lat)):W.call(this,a,d)}function sa(a,d,b,f){this.x=a||0;this.y=d||0;this.w=b||0;this.h=
f||0;this.x2=this.x+this.w;this.y2=this.y+this.h}function ob(a,d){var b=new pb(Math.sqrt(256<<a)|0);d&&d.zoomLevel===a&&d.copyInto(b);b.zoomLevel=a;return b}function ab(a,d,b,f,i,j){this.x=a;this.y=d;this.w=f||256;this.h=f||256;this.x2=this.x+this.w;this.y2=this.y+this.h;this.url=b;this.id=j||a+"_"+d;this.loaded=false;this.image=null}function Ra(a,d){d=M({id:"layer_"+Cb++,zindex:0,animated:false,style:null,minXY:null,maxXY:null,visible:true},d);this.visible=d.visible;this.view=a;ta(M(this,d))}function Sa(){ta(this)}
var Ab=/\{(\d+)(?=\})/g,Db=function(){var a=1.70158,d=Math.PI/2,b=Math.abs,f=Math.pow,i=Math.sin,j=Math.asin,h=Math.cos,k={linear:function(c,p,m,g){return m*c/g+p},backin:function(c,p,m,g){return m*(c/=g)*c*((a+1)*c-a)+p},backout:function(c,p,m,g){return m*((c=c/g-1)*c*((a+1)*c+a)+1)+p},backinout:function(c,p,m,g){return(c/=g/2)<1?m/2*c*c*(((a*=1.525)+1)*c-a)+p:m/2*((c-=2)*c*(((a*=1.525)+1)*c+a)+2)+p},bouncein:function(c,p,m,g){return m-k.bounceout(g-c,0,m,g)+p},bounceout:function(c,p,m,g){return(c/=
g)<1/2.75?m*7.5625*c*c+p:c<2/2.75?m*(7.5625*(c-=1.5/2.75)*c+0.75)+p:c<2.5/2.75?m*(7.5625*(c-=2.25/2.75)*c+0.9375)+p:m*(7.5625*(c-=2.625/2.75)*c+0.984375)+p},bounceinout:function(c,p,m,g){return c<g/2?k.bouncein(c*2,0,m,g)/2+p:k.bounceout(c*2-g,0,m,g)/2+m/2+p},cubicin:function(c,p,m,g){return m*(c/=g)*c*c+p},cubicout:function(c,p,m,g){return m*((c=c/g-1)*c*c+1)+p},cubicinout:function(c,p,m,g){if((c/=g/2)<1)return m/2*c*c*c+p;return m/2*((c-=2)*c*c+2)+p},elasticin:function(c,p,m,g,q,e){if(c==0)return p;
if((c/=g)==1)return p+m;e||(e=g*0.3);if(!q||q<b(m)){q=m;m=e/4}else m=e/fa*j(m/q);return-(q*f(2,10*(c-=1))*i((c*g-m)*fa/e))+p},elasticout:function(c,p,m,g,q,e){var o;if(c==0)return p;if((c/=g)==1)return p+m;e||(e=g*0.3);if(!q||q<b(m)){q=m;o=e/4}else o=e/fa*j(m/q);return q*f(2,-10*c)*i((c*g-o)*fa/e)+m+p},elasticinout:function(c,p,m,g,q,e){var o;if(c==0)return p;if((c/=g/2)==2)return p+m;e||(e=g*0.3*1.5);if(!q||q<b(m)){q=m;o=e/4}else o=e/fa*j(m/q);if(c<1)return-0.5*q*f(2,10*(c-=1))*i((c*g-o)*fa/e)+p;
return q*f(2,-10*(c-=1))*i((c*g-o)*fa/e)*0.5+m+p},quadin:function(c,p,m,g){return m*(c/=g)*c+p},quadout:function(c,p,m,g){return-m*(c/=g)*(c-2)+p},quadinout:function(c,p,m,g){if((c/=g/2)<1)return m/2*c*c+p;return-m/2*(--c*(c-2)-1)+p},sinein:function(c,p,m,g){return-m*h(c/g*d)+m+p},sineout:function(c,p,m,g){return m*i(c/g*d)+p},sineinout:function(c,p,m,g){return-m/2*(h(Math.PI*c/g)-1)+p}};return function(c){c=c.replace(/[\-\_\s\.]/g,"").toLowerCase();return k[c]||k.linear}}(),ta=function(){function a(b,
f){var i=b.hasOwnProperty("obsHandlers")?b.obsHandlers:null;i[f]||(i[f]=[]);return i[f]}var d=0;return function(b){if(!b)return null;if(!(b.hasOwnProperty("obsHandlers")?b.obsHandlers:null))b.obsHandlers={};if(!b.hasOwnProperty("bind")){b.bind=function(f,i){var j="callback"+d++;a(b,f).unshift({fn:i,id:j});return j};b.triggerCustom=function(f,i){var j=a(b,f),h={cancel:false,name:f,source:this},k;for(k in i)h[k]=i[k];if(!j)return null;k=Array.prototype.slice.call(arguments,2);b.eventInterceptor&&b.eventInterceptor(f,
h,k);k.unshift(h);for(var c=j.length;c--&&!h.cancel;)j[c].fn.apply(this,k);return h};b.trigger=function(f){var i=Array.prototype.slice.call(arguments,1);i.splice(0,0,f,null);return b.triggerCustom.apply(this,i)};b.unbind=function(f,i){if(typeof f==="undefined")b.obsHandlers={};else for(var j=a(b,f),h=0;j&&h<j.length;h++)if(j[h].id===i){j.splice(h,1);break}return b}}return b}}(),qb=function(){function a(d,b,f,i){if(typeof d[i]=="undefined")d[i]=function(j){if(typeof j!="undefined"){b[i]=j;f[i]&&f[i](j);
return d}else return b[i]}}return function(d,b,f){b=b||d;for(var i in b)typeof b[i]!="function"&&a(d,b,f,i);return d}}(),bb=Array.prototype.indexOf||function(a){for(var d=0;d<this.length;d++)if(this[d]===a)return d;return-1},S=function(){var a={NaN:1,Infinity:1,"-Infinity":1},d=String.prototype.toLowerCase,b=Object.prototype.toString;return function(f,i){i=d.call(i);if(i=="finite")return!a.hasOwnProperty(+f);return i=="null"&&f===null||i==typeof f||i=="object"&&f===Object(f)||i=="array"&&Array.isArray&&
Array.isArray(f)||b.call(f).slice(8,-1).toLowerCase()==i}}(),Eb=function(){function a(j){var h=document.createElement("script"),k=false;h.src=j;h.async=true;h.onload=h.onreadystatechange=function(){if(!k&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){k=true;h.onload=h.onreadystatechange=null;h&&h.parentNode&&h.parentNode.removeChild(h)}};i||(i=document.getElementsByTagName("head")[0]);i.appendChild(h)}function d(j,h,k){j+=j.indexOf("?")>=0?"&":"?";var c="json"+ ++f;
window[c]=function(p){h(p);window[c]=null;try{delete window[c]}catch(m){}};a(j+(k?k:"callback")+"="+c);return c}function b(j,h,k){var c=require("request");j=j+(j.indexOf("?")>=0?"&":"?")+(k?k:"callback")+"=cb";c({uri:j},function(p,m,g){p=g.replace(/^.*\(/,"").replace(/\).*$/,"");h(JSON.parse(p))})}var f=0,i;return typeof window!="undefined"?d:b}();INTERACT=function(){function a(q){return function(e,o){q.addEventListener(e,o,false)}}function d(q){return function(e,o){q.removeEventListener(e,o,false)}}
function b(q){return function(e,o){q.attachEvent("on"+e,o)}}function f(q,e){return{x:q?q:0,y:e?e:0,count:1}}function i(q,e){m.push(M({handler:null,checks:{},type:q},e))}function j(q){var e=0,o=0;if(q.offsetParent){do{e+=q.offsetLeft;o+=q.offsetTop;q=q.offsetParent}while(q)}return{left:e,top:o}}function h(q,e){return{source:q,target:e.target?e.target:e.srcElement}}function k(q,e){for(var o=q.target?q.target:q.srcElement;o&&o!==e;)o=o.parentNode;return o&&o===e}function c(q,e){return{x:q.x-(e?e.left:
0),y:q.y-(e?e.top:0)}}function p(q,e){if(q.preventDefault){q.preventDefault();q.stopPropagation()}else if(typeof q.cancelBubble!="undefined")q.cancelBubble=true;e&&q.stopImmediatePropagation&&q.stopImmediatePropagation()}var m=[],g=function(q,e,o){o=M({binder:null,unbinder:null,observable:null},o);for(var s=o.observable,w=[],y,z,n={bind:function(){return s.bind.apply(null,arguments)},unbind:function(){s.unbind();for(u=0;u<w.length;u++)w[u].unbind();return n}},u=0;u<e.length;u++)w.push(e[u](q,s,o));
s.bind("pointerDown",function(){z=y=0});s.bind("pointerMove",function(l,r,t,A){y+=A.x||0;z+=A.y||0});s.bind("pointerUp",function(l,r,t){Math.abs(y)>20||Math.abs(z)>20||s.triggerCustom("tap",l,r,t)});return n};i("pointer",{handler:function(q,e,o){function s(C){if(C.pageX&&C.pageY)return f(C.pageX,C.pageY);else{var I=document.documentElement,L=document.body;return f(C.clientX+(I&&I.scrollLeft||L&&L.scrollLeft||0)-(I&&I.clientLeft||L&&L.clientLeft||0),C.clientY+(I&&I.scrollTop||L&&L.scrollTop||0)-(I&&
I.clientTop||L&&L.clientTop||0))}}function w(C){if(k(C,q))if(A=u(C)){var I=s(C);q.style.cursor="move";p(C,true);F=I.x;O=I.y;D=f(F,O);e.triggerCustom("pointerDown",h("mouse",C),D,c(D,j(q)))}}function y(C){var I=s(C);E=I.x;J=I.y;if(k(C,q))l(C,A?"pointerMove":"pointerHover")}function z(C){if(A&&u(C)){A=false;if(k(C,q)){q.style.cursor="default";l(C,"pointerUp")}}}function n(C){if(k(C,q)){var I;C=C||window.event;if(C.detail){if(typeof C.axis=="undefined"||C.axis===2)I=-C.detail*r}else{I=C.wheelDeltaY?
C.wheelDeltaY:C.wheelDelta;if(window.opera)I=-I}if(I){var L=f(E,J);e.triggerCustom("zoom",h("mouse",C),L,c(L,j(q)),I/t,"wheel");p(C);C.returnValue=false}}}function u(C){C=C||window.event;return(C.which||C.button)==1}function l(C,I,L,U,ia){L=typeof L!="undefined"?L:E;U=typeof U!="undefined"?U:J;var G=L-F,P=U-O,K=f(L,U);e.triggerCustom(I,h("mouse",C),K,c(K,j(q)),f(G,P));if(typeof ia=="undefined"||ia){F=L;O=U}}o=M({},o);var r=120,t=r*8,A=false,D,E,J,F,O;o.binder("mousedown",w);o.binder("mousemove",y);
o.binder("mouseup",z);o.binder("dblclick",function(C){xa("captured double click");if(k(C,q)){var I=s(C);e.triggerCustom("doubleTap",h("mouse",C),I,c(I,j(q)))}});o.binder("mousewheel",n);o.binder("DOMMouseScroll",n);return{unbind:function(){o.unbinder("mousedown",w);o.unbinder("mousemove",y);o.unbinder("mouseup",z);o.unbinder("mousewheel",n);o.unbinder("DOMMouseScroll",n)}}},checks:{touch:false}});i("pointer",{handler:function(q,e,o){function s(G){if(G.count<2)return 0;var P=G.x-G.next.x;G=G.y-G.next.y;
return~~Math.sqrt(P*P+G*G)}function w(G,P,K){P=P?P:0;K=K?K:0;for(var V={x:G.x-P,y:G.y-K,id:G.id,count:G.count},ca=V;G.next;){G=G.next;ca=ca.next={x:G.x-P,y:G.y-K,id:G.id}}return V}function y(G,P){var K=G[P?P:"touches"],V,ca;if(K.length===0)return null;ca=V={x:K[0].pageX,y:K[0].pageY,id:K[0].identifier,count:K.length};for(var T=1,Z=K.length;T<Z;T++)ca=ca.next={x:K[T].pageX,y:K[T].pageY,id:K[T].identifier};return V}function z(G){if(k(G,q)){J=j(q);var P=y(G,"changedTouches"),K=w(P,J.left,J.top);if(!O){F=
A;e.triggerCustom("pointerDown",h("touch",G),P,K)}U&&e.triggerCustom("pointerDownMulti",h("touch",G),P,K);O=y(G);if(O.count>1)I=s(O);ia=1;L=w(O)}}function n(G){if(k(G,q)){p(G);C=y(G);if(F==A)F=Math.abs(O.x-C.x)>r||Math.abs(O.y-C.y)>r?t:A;if(F!=A){F=C.count>1?E:D;if(F==E)if(O.count===1){O=w(C);I=s(O)}else{var P=s(C);if(Math.abs(I-P)<l)F=D;else{var K;K=C.x;var V=C.next.x,ca=C.y,T=C.next.y;K={x:(K<V?K:V)+(Math.abs(K-V)>>1),y:(ca<T?ca:T)+(Math.abs(ca-T)>>1)};P=P/I;V=P-ia;e.triggerCustom("zoom",h("touch",
G),K,c(K,J),V,"pinch");ia=P}}F==D&&e.triggerCustom("pointerMove",h("touch",G),C,w(C,J.left,J.top),f(C.x-L.x,C.y-L.y));U&&e.triggerCustom("pointerMoveMulti",h("touch",G),C,w(C,J.left,J.top))}L=w(C)}}function u(G){if(k(G,q)){var P=y(G,"changedTouches"),K=w(P,J.left,J.top);C=y(G);if(!C){e.triggerCustom("pointerUp",h("touch",G),P,K);O=null}U&&e.triggerCustom("pointerUpMulti",h("touch",G),P,K)}}o=M({detailed:false,inertia:false},o);var l=20,r=7,t=0,A=1,D=2,E=3,J,F,O,C,I,L,U=o.detailed,ia=1;o.binder("touchstart",
z);o.binder("touchmove",n);o.binder("touchend",u);xa("initialized touch handler");return{unbind:function(){o.unbinder("touchstart",z);o.unbinder("touchmove",n);o.unbinder("touchend",u)}}},checks:{touch:true}});return{register:i,watch:function(q,e,o){e=M({bindTarget:null,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},e);capabilities=M({touch:"ontouchstart"in window},o);if(!e.observable){xa("creating observable");e.observable=ta({});globalOpts=e}e.binder=(e.isIE?b:a)(e.bindTarget||
document);e.unbinder=(e.isIE?b:d)(e.bindTarget||document);o=e.types;for(var s=capabilities,w=[],y=m.length;y--;){var z=m[y],n=!o||o.indexOf(z.type)>=0,u=true,l;for(l in z.checks){var r=z.checks[l];xa("checking "+l+" capability. require: "+r+", capability = "+s[l]);u=u&&r===s[l]}if(n&&u)w[w.length]=z.handler}return new g(q,w,e)}}}();(function(){function a(n,u){if(n&&n.split){var l=n.split(y);if(l.length>1){n=l[0];u=l[1]}}else if(n&&n.lat){u=n.lon;n=n.lat}this.lat=parseFloat(n||0);this.lon=parseFloat(u||
0)}function d(n,u){if(n&&n.splice){for(var l=u,r=new a(p,g),t=new a(m,q),A=n.length;A--;){var D=typeof n[A]=="string"?new a(n[A]):n[A];if(D.lat<r.lat)r.lat=D.lat;if(D.lat>t.lat)t.lat=D.lat;if(D.lon<r.lon)r.lon=D.lon;if(D.lon>t.lon)t.lon=D.lon}this.min=r;this.max=t;if(typeof l=="undefined"){l=this.size();l=Math.max(l.x,l.y)*0.3}this.min=new a(r.lat-l,(r.lon-l)%360);this.max=new a(t.lat+l,(t.lon+l)%360)}else{this.min=n;this.max=u}}function b(n){if(typeof n=="string"){var u=(n.replace(/\d|\.|\s/g,"")||
"m").toLowerCase();n=parseFloat(n)*({km:1E3}[u]||1)}this.meters=n||0}var f=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],i=typeof module!="undefined"&&module.exports,j=Math.PI*2,h=Math.PI/2,k=Math.PI/180,c=180/Math.PI,p=90,m=-p,g=180,q=-g,e=p*k,o=-e,s=g*k,w=-s,y=/[\,\s]+/;a.prototype={constructor:a,copy:function(){return new a(this.lat,this.lon)},distanceTo:function(){if(!targetPos||this.empty()||targetPos.empty())return 0;var n=(targetPos.lat-this.lat)*
la/2,u=(targetPos.lon-this.lon)*la/2;n=ea(n)*ea(n)+ua(this.lat*la)*ua(targetPos.lat*la)*ea(u)*ea(u);return 6371*2*Fb(cb(n),cb(1-n))},equalTo:function(n){return pos&&this.lat===n.lat&&this.lon===n.lon},empty:function(){return this.lat===0&&this.lon===0},inArray:function(n){for(var u=n.length;u--;)if(this.equal(n[u]))return true;return false},offset:function(n,u){var l=this.lat*k,r=this.lon*k,t=l+n/6371;l=rb(ea(u/6371)/ua(l));r=r+l;t=(t+h)%Math.PI-h;r%=j;return new a(t*c,r*c)},toBounds:function(n){var u=
n.radians(),l=this.lat*k,r=this.lon*k;n=l-u;var t=l+u;if(n>o&&t<e){l=rb(ea(u)/ua(l));u=r-l;if(u<w)u+=j;r=r+l;if(r>s)r-=j}else{n=Ga(n,o);t=db(t,e);u=q;r=g}return new d(new a(n*c,u*c),new a(t*c,r*c))},toString:function(n){return this.lat+(n||" ")+this.lon}};d.prototype={constructor:d,bestZoomLevel:function(n,u){var l=this.center(),r=f[Math.min(Math.round(Math.abs(l.lat)*0.05),f.length)],t=this.size();l=Math.ceil(Math.log(f[3]*u/t.y)/Math.LN2);r=Math.ceil(Math.log(r*n/t.x)/Math.LN2);return Math.min(isNaN(l)?
1E3:l,isNaN(r)?1E3:r)},center:function(){var n=this.size();return new a(this.min.lat+n.y/2,this.min.lon+n.x/2)},expand:function(n){return new d(new a(this.min.lat-n,(this.min.lon-n)%360),new a(this.max.lat+n,(this.max.lon+n)%360))},size:function(n){var u={x:0,y:this.max.lat-this.min.lat};u.x=typeof n!="undefined"&&n&&this.min.lon>this.max.lon?360-this.min.lon+this.max.lon:this.max.lon-this.min.lon;return u},toString:function(){return"min: "+this.min+", max: "+this.max},union:function(){for(var n=
this.min.copy(),u=this.max.copy(),l=arguments.length;l--;)if(arguments[l]){var r=arguments[l].min,t=arguments[l].max;n.lat=Math.min(n.lat,r.lat);n.lon=Math.min(n.lon,r.lon);u.lat=Math.max(u.lat,t.lat);u.lon=Math.max(u.lon,t.lon)}return new d(n,u)}};b.prototype={add:function(){for(var n=this.meters,u=arguments.length;u--;){var l=typeof arguments[u]=="string"?new b(arguments[u]):arguments[u];n+=l.meters}return new b(n)},radians:function(n){if(typeof n!="undefined"){this.meters=n*6371E3;return this}else return this.meters/
6371E3},toString:function(){if(this.meters>1E3)return(this.meters/10|0)/100+"km";return this.meters+"m"}};var z=this.GeoJS={Pos:a,BBox:d,Distance:b,generalize:function(n,u,l){var r=n.length,t=[],A=null;l=(l||250)/1E3;for(r=r;r--;)if(r===0)t.unshift(n[r]);else{var D=!A||n[r].inArray(u)?l:A.distanceTo(n[r]);if(n[r]&&D>=l){t.unshift(n[r]);A=n[r]}}return t},include:function(n){if(i){n=n.split(",");for(var u=0;u<n.length;u++){var l=require("./plugins/"+n[u].trim()),r;for(r in l)z[r]=l[r]}}return z}};if(i)module.exports=
z})();var Q=this.T5=ta({}),Ta=function(){var a={};return{create:function(d,b){if(a[d][b])return a[d][b].apply(null,Array.prototype.slice.call(arguments,2));throw Gb(d,b);},get:function(d,b){return a[d]?a[d][b]:null},register:function(d,b,f){a[d]||(a[d]={});a[d][b]&&xa(Hb(d,b),"warn");a[d][b]=f}}}(),Hb=pa("Registration of {0}: {1} will override existing definition"),Gb=pa("Could not create {0} of type: {1}");pa("Could not create drawable of type: {0}");var fa=Math.PI*2,lb=Math.PI/2,la=Math.PI/180,
Ua=180/Math.PI,Pa=0.08181919084262157,ma=Math.abs,Va=Math.round,db=Math.min,Ga=Math.max,ya=Math.pow,cb=Math.sqrt,eb=Math.log,ea=Math.sin,rb=Math.asin,ua=Math.cos,mb=Math.atan,Fb=Math.atan2,za="undefined",qa="string",Ib="object",va="number",Jb="array",ja=Ta.register,Ba=Ta.create,Kb=Ta.get,Lb=0,Cb=0,nb=/[\,\s]+/,Ca=function(){function a(h){i++;h=R?window.mozAnimationStartTime||h||(new Date).getTime():(new Date).getTime();for(var k=f.length;k--;){var c=f[k];i%c.every===0&&c.cb(h)}j&&animFrame(a)}var d=
1E3/60,b=["r","webkitR","mozR","oR","msR"],f=[],i=0,j=R&&function(){for(var h=0;h<b.length;h++)window.animFrame=window.animFrame||window[b[h]+"equestAnimationFrame"];return animFrame}();j?animFrame(a):setInterval(a,1E3/60);return{attach:function(h,k){f[f.length]={cb:h,every:k?Va(k/d):1}},detach:function(h){for(var k=f.length;k--;)if(f[k].cb===h){f.splice(k,1);break}}}}(),Bb=function(){var a=/^xy\((.*)\).*$/i;return{parseXY:function(d){if(!a.test(d)){d=d.split(nb);return Qa(d[1],d[0])}}}}(),R=typeof window!=
"undefined"?function(){function a(i){for(var j=0;j<i.length;j++){var h=i[j];if(typeof document.body.style[h]!="undefined")return h}}var d={"-webkit-user-select":"none",position:"absolute"},b,f;b=a(["-webkit-transform","MozTransform"]);css3DTransformProp=a(["WebkitPerspective","MozPerspective"]);f=a(["-webkit-transform-origin","MozTransformOrigin"]);return{transforms:S(b,qa),create:function(i,j,h){i=document.createElement(i);var k=[];h=h||{};i.className=j||"";for(var c in h)k[k.length]=c+": "+h[c];
i.style.cssText=k.join(";");return i},move:function(i,j,h,k,c){if(b){i.style[b]="translate("+j+"px, "+h+"px) "+(k||[]).join(" ");if(c&&f)i.style[f]=c.x+"px "+c.y+"px"}else{i.style.left=j+"px";i.style.top=h+"px"}},styles:function(i){return M({},d,i)}}}():null,sb=function(){function a(){for(var i=f.length,j=i;j--;)try{f[j](i)}catch(h){xa(h.toString(),"error")}}var d=20,b=50,f=[];return{process:function(i,j,h,k){function c(g){g=(p||b)/g;if(m<i.length){var q=i.slice(m,m+g);g=q.length;var e=p?0:(new Date).getTime();
j(q,g);if(!p)p=(q=((new Date).getTime()-e)/g)?d/q|0:i.length;m+=g}else{for(g=f.length;g--;)if(f[g]===c){f.splice(g,1);break}f.length===0&&Ca.detach(a);h&&h()}}var p,m=0;if(R&&i.length>(k||0))f.push(c)===1&&Ca.attach(a);else{j(i,i.length);h&&h()}}}}(),Qa=Qa||function(a,d){var b=parseFloat(d)*la;b=ea(b);var f=Pa*b;b=eb((1+b)/(1-b)*ya((1-f)/(1+f),Pa))/2;return new ra(0,0,parseFloat(a)*la,b)},fb=fb||function(a,d){for(var b=ya(Math.E,-d),f=lb-2*mb(b),i=kb(f,b),j=0;j<12&&ma(f-i)>1.0E-7;){f=i;i=kb(f,b);
j++}return new GeoJS.Pos(i*Ua,a%360*Ua)};W.prototype={constructor:W,add:function(){for(var a=this.x,d=this.y,b=arguments.length;b--;){a+=arguments[b].x;d+=arguments[b].y}return this.copy(a,d)},copy:function(a,d){var b=M({},this);b.x=a||b.x;b.y=d||b.y;return b},equals:function(a){return this.x===a.x&&this.y===a.y},offset:function(a,d){return this.copy(this.x+a,this.y+d)},relative:function(a){a=a.viewport();return this.copy(this.x-a.x-a.padding.x,this.y-a.y-a.padding.y)},rotate:function(a,d){d=d||new W(0,
0);var b=this.x-d.x,f=this.y-d.y;return new W(d.x+ua(a)*b+-ea(a)*f,d.y+ea(a)*b+ua(a)*f)},scale:function(a,d){d=d||new W(0,0);return new W(d.x+(this.x-d.x)*a,d.y+(this.y-d.y)*a)},sync:function(){return this},toString:function(){return this.x+", "+this.y}};Fa.prototype=M([],{cull:function(a){if(this.allowCull){var d=a.x,b=a.y,f=a.x+a.w;a=a.y+a.h;for(var i=Infinity,j=0,h,k=this.length;k--;)if(h=this[k].x>=d&&this[k].x<=f&&this[k].y>=b&&this[k].y<=a){i=k<i?k:i;j=k>j?k:j}return this.slice(Ga(i-1,0),db(j+
1,this.length))}return this},simplify:function(a){a=a||3;for(var d=new Fa(this.allowCull),b=null,f=this.length;f--;){var i=this[f];if(include=!b||f===0||ma(i.x-b.x)+ma(i.y-b.y)>a){d.unshift(i);b=i}}return d}});ra.prototype=M(new W,{constructor:ra,pos:function(){return fb(this.mercX,this.mercY)},sync:function(a,d){var b;if(!(b=a.rpp)){b=a.zoom();b=fa/(256<<b)}b=b;if(d){this.mercX=this.x*b-Math.PI;this.mercY=Math.PI-this.y*b}else{this.x=Va(((this.mercX||0)+Math.PI)/b);this.y=Va((Math.PI-(this.mercY||
0))/b)}return this}});sa.prototype={constructor:sa,buffer:function(a,d){return new sa(this.x-a,this.y-(d||a),this.w+a*2,this.h+(d||a)*2)},center:function(){return new W(this.x+(this.w>>1),this.y+(this.h>>1))}};Hits=function(){return{diffHits:function(a,d){var b=[],f={},i;for(i=d.length;i--;)f[d[i].target.id]=true;for(i=a.length;i--;)f[a[i].target.id]||(b[b.length]=a[i]);return b},init:function(a,d,b,f,i){return{type:a,x:i.x,y:i.y,gridX:f.x|0,gridY:f.y|0,elements:[],absXY:d,relXY:b}},initHit:function(a,
d,b){return{type:a,target:d,drag:b}},triggerEvent:function(a,d,b,f){d.triggerCustom(a.type+(b?b:"Hit"),{hitType:a.type},f?f:a.elements,a.absXY,a.relXY,new ra(a.gridX,a.gridY))}}}();var pb=function(a){function d(j,h){var k=b[j],c;k||(k=b[j]=[]);(c=k[h])||(c=k[h]=[]);return c}a=a||128;var b=[],f={},i=0;return{copyInto:function(j){for(var h in f){var k=f[h];j.insert(k.bounds||k,k,h)}},insert:function(j,h,k){var c=j.x/a|0,p=j.y/a|0,m=(j.x+j.w)/a|0;j=(j.y+j.h)/a|0;k=k||h.id||"obj_"+i++;f[k]=h;for(h=c;h<=
m;h++)for(c=p;c<=j;c++)d(h,c).push(k)},remove:function(j,h,k){k=k||h.id;if(f[k]){var c=j.x/a|0;h=j.y/a|0;var p=(j.x+j.w)/a|0;j=(j.y+j.h)/a|0;delete f[k];for(c=c;c<=p;c++)for(var m=h;m<=j;m++){var g=d(c,m),q=bb.call(g,k);q>=0&&g.splice(q,1)}}},search:function(j){var h=j.y/a|0,k=(j.x+j.w)/a|0,c=(j.y+j.h)/a|0,p=[],m=[];for(j=j.x/a|0;j<=k;j++)for(var g=h;g<=c;g++)p=p.concat(d(j,g));p.sort();for(h=p.length;h--;){k=p[h];if(c=f[k])m[m.length]=c;for(;h>0&&p[h-1]==k;)h--}return m}}},Wa=function(){var a={},
d=0;(new Date).getTime();var b={},f=[];Ca.attach(function(i){i=i||(new Date).getTime();for(var j=0;j<f.length;){var h=f[j],k=b[h],c=b[h].image&&b[h].image.complete&&b[h].image.width>0,p=i-k.start;p=c||p>=3E4;if(c){c=k.callbacks;a[h]=k.image;for(var m=0;m<c.length;m++)c[m](k.image,true)}if(p){f.splice(j,1);delete b[h]}else j++}},250);return function(i,j){var h=i&&j?a[i]:null;if(h&&h&&h.complete&&h.width>0)j(h);else if(h=b[i])h.callbacks.push(j);else{h=new Image;h.id="_ldimg"+ ++d;b[i]={start:(new Date).getTime(),
image:h,callbacks:[j]};h.src=i;f[f.length]=i}}}();ab.prototype={constructor:ab,load:function(a){var d=this;Wa(this.url,function(b){d.loaded=true;d.image=b;a&&a()})}};var Mb=function(){return ta({fastpan:true,applyStyle:function(){},applyTransform:function(a,d,b){return{restore:null,x:d,y:b}},getDimensions:function(){return{width:0,height:0}},getViewport:function(){},hitTest:function(){return false},prepare:function(){},projectXY:null,reset:function(){}})};ja("renderer","canvas",function(a,d,b,f,i){function j(){function l(A,
D){this.save();this.setTransform(1,0,0,1,0,0);var E=this.isPointInPath_old(A,D);this.restore();return E}var r=CanvasRenderingContext2D.prototype,t=document.createElement("canvas").getContext("2d");t.translate(50,0);t.moveTo(125,50);t.arc(100,50,25,0,360,false);if(!t.isPointInPath(150,50)){r.isPointInPath_old=r.isPointInPath;r.isPointInPath=l}}function h(l,r,t){var A,D;o[r]=function(E){for(A=n.length;A--;)if(D=t[n[A]])E[u[A]]=D}}function k(l,r,t){return{draw:t||z,viewport:l,hit:r&&g.isPointInPath(r.x,
r.y),vpX:q,vpY:e,context:g}}f=M({},f);var c,p,m,g,q=0,e=0,o={},s=null,w={},y=function(){},z=function(){this.fill&&g.fill();this.stroke&&g.stroke()},n=["fill","stroke","lineWidth","opacity"],u=["fillStyle","strokeStyle","lineWidth","globalAlpha"];R&&j();if(d){c=d.offsetWidth;p=d.offsetHeight;m=R?R.create("canvas",null,{position:"absolute","z-index":1}):new Canvas;m.width=c;m.height=p;a.attachFrame(m,true);g=null}b=M(i,{applyStyle:function(l){var r=o[l],t=g&&g.canvas?g.canvas.id:"default",A;w[t]||(w[t]=
[]);A=w[t].pop()||"reset";if(r){w[t].push(l);r(g);return A}},applyTransform:function(l){if(l.translateX!==0||l.translateY!==0||l.scaling!==1||l.rotation!==0){g.save();s={undo:function(){g.restore();s=null},x:l.xy.x,y:l.xy.y};g.translate(l.xy.x-q+l.translateX,l.xy.y-e+l.translateY);l.rotation!==0&&g.rotate(l.rotation);l.scaling!==1&&g.scale(l.scaling,l.scaling)}return s},drawTiles:function(l,r,t){for(var A=r.length;A--;){l=r[A];if(!l.loaded&&t)l.load(a.invalidate);else l.image&&g.drawImage(l.image,
l.x-q,l.y-e)}},prepare:function(l,r){var t,A=false;if(g)g.restore();else if(m)g=m.getContext("2d");for(t=l.length;t--;)A=A||l[t].clip;q=r.x;e=r.y;if(g){A||g.clearRect(0,0,c,p);g.save();g.globalCompositeOperation="source-over"}return g},prepArc:function(l,r,t){g.beginPath();g.arc(l.xy.x-(s?s.x:q),l.xy.y-(s?s.y:e),l.size>>1,l.startAngle,l.endAngle,false);return k(r,t)},prepImage:function(l,r,t,A){var D=(A.x||l.xy.x)-(s?s.x:q),E=(A.y||l.xy.y)-(s?s.y:e),J=A.image||l.image;if(J){g.beginPath();g.rect(D,
E,A.width||J.width,A.height||J.height);return k(r,t,function(){g.drawImage(J,D,E,A.width||J.width,A.height||J.height)})}},prepMarker:function(l,r,t){var A=l.xy.x-(s?s.x:q),D=l.xy.y-(s?s.y:e),E=l.size,J=undefined;g.beginPath();switch(l.markerType.toLowerCase()){case "image":J=y;g.rect(A-(E>>1),D-(E>>1),E,E);if(l.reset&&l.image){l.image=null;l.reset=false}l.image?g.drawImage(l.image,A-(E>>1),D-(E>>1),E,E):Wa(l.imageUrl,function(F){l.image=F;g.drawImage(l.image,A-(E>>1),D-(E>>1),E,E)});break;default:g.moveTo(A,
D);g.lineTo(A-(E>>1),D-E);g.lineTo(A+(E>>1),D-E);g.lineTo(A,D)}return k(r,t,J)},prepPoly:function(l,r,t,A){var D=true;l=A.points||l.points().cull(r);A=s?s.x:q;var E=s?s.y:e;g.beginPath();for(var J=l.length;J--;){var F=l[J].x-A,O=l[J].y-E;if(D){g.moveTo(F,O);D=false}else g.lineTo(F,O)}return k(r,t)},getContext:function(){return g}});(function(){tb.each(function(l,r){h(null,l,r)});Q.bind("styleDefined",h)})();b.bind("detach",function(){d.removeChild(m)});b.bind("resize",function(){});return b});ja("renderer",
"dom",function(a,d,b,f,i){function j(m){var g=m.image=new Image;c[m.id]=m;g.src=m.url;g.onload=function(){if(p[m.id])k.appendChild(this);else m.image=null};g.style.cssText="-webkit-user-select: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute;";
return g}function h(m,g,q){var e=[],o;for(o in m){var s=m[o];if(q?s[q]:!g[o]){if(s.image&&s.image.parentNode){k.removeChild(s.image);s.image=null}e[e.length]=o}}for(g=e.length;g--;)delete m[e[g]]}var k=null,c={},p={};k=R.create("div","",R.styles({width:d.offsetWidth+"px",height:d.offsetHeight+"px"}));d.childNodes.length>0?d.insertBefore(k,d.childNodes[0]):d.appendChild(k);a.attachFrame(k);b=M(i,{drawTiles:function(m,g,q){for(var e,o=m.x,s=m.y,w=g.length;w--;){m=g[w];if(m.url){(e=m.image||(q?j(m):
null))&&R.move(e,m.x-o,m.y-s);p[m.id]=m}}}});b.bind("predraw",function(){h(c,p);p={}});b.bind("detach",function(){d.removeChild(k)});a.bind("reset",function(){for(h(c,p={});k.childNodes.length>0;)k.removeChild(k.childNodes[0])});return b});var tb=function(){function a(b,f){if(S(b,qa)){Q.trigger("styleDefined",b,d[b]=f);return b}else{var i=[],j;for(j in b)i[i.length]=a(j,b[j]);return i}}var d={};a({reset:{fill:"#ffffff",opacity:1},highlight:{fill:"#ff0000"},waypoints:{lineWidth:4,stroke:"#003377",
fill:"#ffffff"},waypointsHover:{lineWidth:4,stroke:"#ff0000",fill:"#ffffff"}});return{resetStyle:"reset",each:function(b){for(var f in d)b(f,d[f])},get:function(b){return d[b]},define:a}}(),zb=function(a,d){function b(v,x,B,H){v=D?Ga(X+ya(2,H)-1,0.125):H>0?2:0.5;l(v,false,true)}function f(v,x){var B=Y&&Y.projectXY?Y.projectXY(v,x):null;if(!B){B=z();var H=1/X;B=new N.XY(B?B.x+v*H:v,B?B.y+x*H:x)}return B.sync(N,true)}function i(v,x,B){r("doubleTap",x,B,f(B.x,B.y));d.scalable&&l(2,{easing:"quad.out",
duration:300},true)}function j(v,x,B){U=null;P=true;w("down",x,B)}function h(v,x,B){w("hover",x,B)}function k(v,x,B,H){e(x,B,false);if(!U){K=H.x;V=H.y}}function c(v,x,B){e(x,B,true);P=false}function p(){clearTimeout(ub);ub=setTimeout(function(){if(L)if(L.offsetWidth!==Ha*2||L.offsetHeight!==Ia*2){var v=y();s(a);y(v.x,v.y)}},250)}function m(v,x,B){w("tap",x,B);N.trigger("tap",x,B,f(B.x,B.y,true))}function g(){ga&&ga.unbind();if(R&&Y){ga=INTERACT.watch(Y.interactTarget||L);if(d.scalable){ga.bind("zoom",
b);ga.bind("doubleTap",i)}ga.bind("pointerDown",j);ga.bind("pointerMove",k);ga.bind("pointerUp",c);d.captureHover&&ga.bind("pointerHover",h);ga.bind("tap",m)}}function q(v){if(Y){Y.trigger("detach");Y=null}var x=N,B=C,H=L,$=d;v=v.split("/");for(var aa=new Mb(x,B,H,$),na=0;na<v.length;na++)aa=Ba("renderer",v[na],x,B,H,$,aa);Y=aa;G=R&&Y.fastpan&&R.transforms;D=R&&R.transforms&&d.useTransforms;g();N.trigger("reset");u()}function e(v,x,B){if(U){v=f(x.x,x.y);U.drag.call(U.target,U,v.x,v.y,B)&&ba++;if(B)U=
null}}function o(v){for(var x=O;x--;)if(F[x].id===v)return x;return O}function s(v){if(R){L=document.getElementById(v);L.appendChild(I=R.create("div","",R.styles({overflow:"hidden",width:L.offsetWidth+"px",height:L.offsetHeight+"px"})));v=d.padding;if(v===A){v=L.offsetWidth;var x=L.offsetHeight,B=cb(v*v+x*x);ha=new W(B-v>>1,B-x>>1)}else ha=new W(v,v);Xa=I.offsetWidth+ha.x*2;Ya=I.offsetHeight+ha.y*2;gb=Xa/2;hb=Ya/2;Ha=L.offsetWidth/2;Ia=L.offsetHeight/2;Ja=new W(gb,hb);I.appendChild(C=R.create("div",
"",R.styles({width:Xa+"px",height:Ya+"px","z-index":2,margin:-ha.y+"px 0 0 "+-ha.x+"px"})));q(d.renderer);v=d.controls;for(x=0;x<J.length;x++)J[x].trigger("detach");J=[];for(x=0;x<v.length;x++)J[J.length]=Ba("control",v[x],N,I,L,d[v[x]])}else q("canvas")}function w(v,x,B){var H=(new W(B.x-Ha+gb,B.y-Ia+hb)).rotate(-ka*la,Ja).scale(1/X,Ja);da=Hits.init(v,x,B,f(B.x,B.y,true),H);for(v=O;v--;)if(F[v].visible)ia=ia||(F[v].hitGuess?F[v].hitGuess(da.gridX,da.gridY,N):false);ia&&ba++}function y(v,x,B){if(S(v,
qa)||S(v,Ib)){x=new N.XY(v);x.sync(N);v=x.x;x=x.y}if(S(v,va)){t(v-Ha-ha.x,x-Ia-ha.y,B);return N}else return t().offset(Ha+ha.x|0,Ia+ha.y|0).sync(N,true)}function z(){var v=new sa(T,Z,Xa,Ya);v.scaleFactor=X;v.padding=ha?ha.copy():new W;return v}function n(v,x,B){if(S(v,qa)&&S(x,za))for(x=0;x<O;x++){if(F[x].id===v)return F[x]}else if(S(v,qa)){x=Ba("layer",x,N,B);x.added=(new Date).getTime();x.id=v;F[o(v)]=x;F.sort(function(H,$){return $.zindex-H.zindex||$.added-H.added});O=F.length;N.trigger("resync");
u();N.trigger("layerChange",N,x);ba++;return x}else return[].concat(F)}function u(){var v=z();if(v){if(Da||Ea)if(v){var x=Za?T+(v.w>>1):T,B=$a?Z+(v.h>>1):Z,H=v.w,$=v.h;if(Da&&Da>H)if(x+H>Da)T=Za?T:Da-H;else if(x<0)T=Za?T:0;if(Ea&&Ea>$)if(B+$>Ea)Z=$a?Z:Ea-$;else if(B<0)Z=$a?Z:0}vb=T;wb=Z;N.trigger("refresh",N,v);ba++}}function l(v,x,B){if(S(v,va)){var H=B?v:X*v;if(!Nb){x=null;v=Va(eb(H)/Math.LN2);H=ya(2,v)}if(x)Ka=oa.tween([X],[H],x,function(){X=H;Ka=null;ba++});else{X=H;ba++}return N}else return X}
function r(){for(var v=N.trigger.apply(null,arguments).cancel,x=F.length;x--;)v=F[x].trigger.apply(null,arguments).cancel||v;return!v}function t(v,x,B){if(S(v,va)){if(B)wa=oa.tween([T,Z],[v,x],B,function(){wa=null});else{T=v|0;Z=x|0;ba++}return N}else return(new N.XY(T,Z)).sync(N,true)}d=M({captureHover:true,controls:[],drawOnScale:true,padding:128,inertia:true,refreshDistance:128,pannable:true,scalable:true,renderer:"canvas",useTransforms:true},d);var A="auto",D=true,E=false,J=[],F=[],O=0,C=null,
I=null,L,U=null,ia=false,G,P=false,K=0,V=0,ca=d.refreshDistance,T=0,Z=0,La=0,Ma=0,vb=0,wb=0,Da=null,Ea=null,Za=false,$a=false,wa=null,ha,da=null,Na=null,Y,ub=0,Ja=new W,ka=0,Oa=null,X=1,Ka=null,ib=1,ga=null,jb={index:0,draw:false},Nb=true,ba=0,Xa,Ya,gb,hb,Ha,Ia,N={XY:W,id:d.id,panSpeed:0,attachFrame:function(v,x){x&&C.appendChild(v)},center:y,detach:function(){Y&&Y.trigger("detach");ga&&ga.unbind();if(I){L.removeChild(I);C=I=null}},frozen:function(v){if(S(v,za))return E;else{E=v;return N}},layer:n,
invalidate:function(){ba++},pan:function(v,x,B){t(T+v,Z+x,B)},refresh:u,rotate:function(v,x,B){if(S(v,va)){var H=B?v:ka+v;if(x)Oa=oa.tween([ka],[H],x,function(){ka=H%360;Oa=null;ba++});else{ka=H%360;ba++}return N}else return ka},scale:l,triggerAll:r,setMaxOffset:function(v,x,B,H){Da=v;Ea=x;Za=B;$a=H},offset:t,viewport:z};ta(N);N.bind("resize",p);N.bind("layerRemove",function(v,x){var B=bb(F,x.id);if(B>=0&&B<O){F.splice(B,1);ba++}O=F.length});qb(N,d,{container:s,captureHover:g,scalable:g,pannable:g,
renderer:q});n("markers","draw",{zindex:20});s(a);if(R&&!S(window.attachEvent,za))window.attachEvent("onresize",p);else R&&window.addEventListener("resize",p,false);Ca.attach(function(v){var x=[],B,H,$;if(!E){N.panSpeed=panSpeed=ma(K)+ma(V);(B=X!==ib)&&N.trigger("scale");if(panSpeed>0||B||wa||Ka||Oa){ba++;if(wa&&panSpeed>0){wa(true);wa=null}}if(panSpeed<2&&(ma(T-vb)>=ca||ma(Z-wb)>=ca))u();jb.index++;jb.draw=ba||panSpeed||0;if(Y&&jb.draw){if(Ka)X=Ka()[0];if(Oa)ka=Oa()[0];La+=K;Ma+=V;if(K||V)N.trigger("pan");
if(D){if(X!==1)x[x.length]="scale("+X+")";if(ka!==0)x[x.length]="rotate("+ka+"deg)"}if(B=!G||(d.drawOnScale||X===1)&&panSpeed<5){if(wa){B=wa();T=B[0]|0;Z=B[1]|0}else{H=-ka*la;B=ua(H)*La+-ea(H)*Ma;H=ea(H)*La+ua(H)*Ma;T=T-B/X|0;Z=Z-H/X|0}$=z();Y.trigger("predraw",$);if(Y.prepare(F,$,v,da)){H=Ma=B=La=ba=0;for(ii=O;ii--;){var aa=F[ii];if(aa.visible){var na=aa.style?Y.applyStyle(aa.style,true):null;aa.draw(Y,$,N,v,da);na&&Y.applyStyle(na)}}Y.trigger("render",$);N.trigger("drawComplete",$,v);R.move(C,B,
H,x,Ja)}}else R.move(C,La,Ma,x,Ja);if(P||!d.inertia)V=K=0;else if(K!=0||V!=0){K*=0.8;V*=0.8;if(ma(K)<0.5)K=0;if(ma(V)<0.5)V=0}if(da){v=true;x=da?da.elements:[];if(Na&&Na.type==="hover"){diffElements=Hits.diffHits(Na.elements,x);if(diffElements.length>0)Hits.triggerEvent(Na,N,"Out",diffElements);else v=false}if(x.length>0){H=da.gridX;$=da.gridY;for(B=x.length;B--;){aa=x[B];na=H;var xb=$,yb=aa&&aa.drag&&(!aa.canDrag||aa.canDrag(aa,na,xb));if(yb){U=aa;U.startX=na;U.startY=xb}if(yb)break}v&&Hits.triggerEvent(da,
N)}Na=x.length>0?M({},da):null;da=null}if(ib!==X){N.trigger("scaleChanged",X);ib=X}}}});return N},oa=function(){return{tween:function(a,d,b,f,i){function j(o){var s=o-e;o=e+q<=o;for(var w=h;w--;)k[w]=p(s,a[w],m[w],q);i&&i.invalidate();if(o||g){Ca.detach(j);for(w=0;w<c.length;w++)c[w]&&c[w](k,s,g)}}b=M({easing:"sine.out",duration:1E3,complete:null},b);var h=a.length,k=[].concat(a),c=[f,b.complete],p=Db(b.easing),m=[],g=false,q=b.duration,e=(new Date).getTime();for(b=h;b--;)m[b]=d[b]-a[b];Ca.attach(j);
return function(o){g=o;return k}},tweenDrawable:function(a,d,b,f,i){var j=oa.tween([b],[f],i,function(){a[d]=f;for(var k=a.tweens.length;k--;)if(a.tweens[k]===h){a.tweens.splice(k,1);break}},a.view),h=function(){a[d]=j()[0]};return h}}}(),Aa=function(a,d,b){b=M({style:null,xy:null,size:20,fill:false,stroke:true,draggable:false,observable:true,properties:{},typeName:"Shape",zindex:0},b);M(this,b);if(S(this.xy,qa))this.xy=new a.XY(this.xy);this.id="drawable_"+Lb++;this.bounds=null;this.view=a;this.layer=
d;this.tweens=[];this.rotation=this.animations=0;this.scaling=1;this.translateY=this.translateX=0;this.observable&&ta(this)};Aa.prototype={constructor:Aa,applyTweens:function(){for(var a=this.tweens.length;a--;)this.tweens[a]()},drag:null,draw:null,getProps:null,resync:function(){if(this.xy){this.xy.sync(this.view);if(this.size){var a=this.size>>1;this.updateBounds(new sa(this.xy.x-a,this.xy.y-a,this.size,this.size))}}},rotate:function(a,d,b){if(S(a,va)){a=(b?a:this.rotation*Ua+a)*la;if(d)this.tweens.push(oa.tweenDrawable(this,
"rotation",this.rotation,a,d));else{this.rotation=a;this.view.invalidate()}return this}else return this.rotation*Ua},scale:function(a,d,b){if(S(a,va)){a=b?a:this.scaling*a;if(d)this.tweens.push(oa.tweenDrawable(this,"scaling",this.scaling,a,d));else{this.scaling=a;this.view.invalidate()}return this}else return this.scaling},translate:function(a,d,b,f){if(S(a,va)){a=f?a:this.translateX+a;d=f?d:this.translateY+d;if(b){this.tweens.push(oa.tweenDrawable(this,"translateX",this.translateX,a,b));this.tweens.push(oa.tweenDrawable(this,
"translateY",this.translateY,d,b))}else{this.translateX=a;this.translateY=d;this.view.invalidate()}return this}else return new W(this.translateX,this.translateY)},updateBounds:function(a,d){a&&(!this.bounds||a.x!=this.bounds.x||a.y!=this.bounds.y)&&this.trigger("move",this,a,this.bounds);this.bounds=a;if(d)this.xy=this.bounds.center()}};ja("drawable","marker",function(a,d,b){b=M({fill:true,stroke:false,markerType:"simple",hoverStyle:"highlight",typeName:"Marker"},b);return new Aa(a,d,b)});ja("drawable",
"poly",function(a,d,b){function f(){var m,g,q,e,o,s,w;c=b.simplify?k.simplify():k;for(m=c.length;m--;){g=c[m].x;q=c[m].y;s=S(s,za)||g<s?g:s;w=S(w,za)||q<w?q:w;e=S(e,za)||g>e?g:e;o=S(o,za)||q>o?q:o}p.updateBounds(new sa(s,w,e-s,o-w),true);a.invalidate()}function i(m){if(S(m,Jb)){k=new Fa(b.allowCull);sb.process(m,function(g,q){for(var e=0;e<q;e++)k.push(new a.XY(g[e]))},j,h);return p}else return c}function j(){k.length&&sb.process(k,function(m,g){for(var q=g;q--;)m[q].sync(a)},f,h)}b=M({allowCull:false,
simplify:false,fill:true,points:[],typeName:"Poly"},b);var h=500,k=new Fa(b.allowCull),c,p=M(new Aa(a,d,b),{points:i,resync:j});i(b.points);return p});ja("drawable","line",function(a,d,b){b.fill=false;b.allowCull=true;return Ba("drawable","poly",a,d,b)});ja("drawable","image",function(a,d,b){function f(){if(c&&c.width>0){if(!this.centerOffset)this.centerOffset=new W(-c.width>>1,-c.height>>1);this.updateBounds(new sa(this.xy.x+this.centerOffset.x,this.xy.y+this.centerOffset.y,c.width,c.height),false)}}
function i(m){if(this.imageUrl=m){var g=this;Wa(this.imageUrl,function(q,e){c=q;if(e){var o=p.layer?p.layer.view:null;o&&o.invalidate()}f.apply(g)})}}b=M({image:null,imageUrl:null,centerOffset:null,typeName:"Image"},b);var j=Aa.prototype.resync,h=0,k=0,c=b.image,p=M(new Aa(a,d,b),{changeImage:i,getProps:function(){this.bounds||f(this,c);return{image:c,x:this.xy.x+h,y:this.xy.y+k}},resync:function(m){j.call(this,m);f.call(this)}});c||i.call(this,this.imageUrl);if(this.centerOffset){h=this.centerOffset.x;
k=this.centerOffset.y}});ja("drawable","arc",function(a,d,b){b=M({startAngle:0,endAngle:Math.PI*2,typeName:"Arc"},b);return new Aa(a,d,b)});Ra.prototype={constructor:Ra,clip:null,cycle:function(){},draw:function(){},hitGuess:null,remove:function(){this.view.trigger("layerRemove",this)}};ja("layer","tile",function(a,d){d=M({generator:"osm",imageLoadArgs:{}},d);var b=Ba("generator",d.generator,d).run,f=null,i=[],j=M(new Ra(a,d),{draw:function(h,k,c){h.drawTiles&&h.drawTiles(k,f.search(k.buffer(128)),
c.panSpeed<2)}});a.bind("resync",function(){var h=a&&a.zoom?a.zoom():0;i[h]||(i[h]=ob(h));f=i[h]});a.bind("refresh",function(h,k,c){f&&b(k,c,f,function(){k.invalidate()})});return j});ja("layer","draw",function(a,d){function b(k,c,p,m){var g=this.dragOffset;if(!g)g=this.dragOffset=new a.XY(k.startX-this.xy.x,k.startY-this.xy.y);this.xy.x=c-g.x;this.xy.y=p-g.y;if(m){delete this.dragOffset;a.invalidate();this.xy.sync(a,true);this.trigger("dragDrop")}return true}function f(k,c,p,m){m&&j.remove(m,c);
j.insert(p,c)}d=M({zindex:10},d);var i=[],j,h=M(new Ra(a,d),{itemCount:0,clear:function(){j=new pb;i=[];h.trigger("cleared");h.itemCount=0;a.invalidate()},create:function(k,c,p){c=Ba("drawable",k,a,h,c);if(p)i.unshift(c);else i[i.length]=c;c.resync();j&&c.bounds&&j.insert(c.bounds,c);c.bind("move",f);h.itemCount=i.length;h.trigger(k+"Added",c);return c},draw:function(k,c,p,m,g){p={};m=j&&c?j.search(c):[];for(var q=m.length;q--;){var e=m[q],o=e.style||h.style,s,w,y=e.getProps?e.getProps(k):p;s=k["prep"+
e.typeName];e.tweens.length>0&&e.applyTweens();w=k.applyTransform(e);if(y=s?s.call(k,e,c,g,y):null){if(g&&y.hit){g.elements.push(Hits.initHit(e.type,e,e.draggable?b:null));s=g.type+"Style";o=e[s]||h[s]||o}o=o?k.applyStyle(o,true):null;(s=e.draw||y.draw)&&s.call(e,y);o&&k.applyStyle(o)}w&&w.undo&&w.undo()}},find:function(){return[].concat(i)},hitGuess:function(k,c){return j&&j.search({x:k-10,y:c-10,w:20,h:20}).length>0}});a.bind("resync",function(){j=ob(a.zoom(),j);for(var k=i.length;k--;)i[k].resync()});
return h});Sa.prototype={constructor:Sa};ja("control","zoombar",function(a,d,b,f){function i(t,A){var D=n[t]=R.create("div","t5-zoombar-button",{position:"absolute",background:j(t),"z-index":51,width:f.width+"px",height:f.buttonHeight+"px","margin-top":(A||0)+"px"});u.appendChild(D)}function j(t,A){return"url("+f.images+") 0 -"+(g+e*3+(t||0)*p*3+(A||0)*p)+"px"}function h(t){return"url("+f.images+") 0 -"+(g+(t||0)*e)+"px"}function k(t,A){var D;if(t===q){q.style.background=h(A);D="thumb"}else for(var E=
0;E<n.length;E++)if(t===n[E]){D="button"+E;n[E].style.background=j(E,A);break}return D}function c(t){if(t!==y){y=t;w=s-y/z*(s-o)|0;R.move(q,0,w-o);clearTimeout(l);l=setTimeout(function(){a.zoom(y)},500)}}f=M({width:24,height:200,images:"img/zoom.png",align:"right",marginTop:10,spacing:10,thumbHeight:16,buttonHeight:16},f);var p=f.buttonHeight,m,g=f.height,q,e=f.thumbHeight,o=f.spacing+p-(e>>1),s=f.height-p-(e>>1),w=o,y=-1;d=a.minZoom();var z=a.maxZoom()-d+1,n=[],u,l=0,r={button0:function(){a.zoom(a.zoom()+
1)},button1:function(){a.zoom(a.zoom()-1)}};u=R.create("div","t5-zoombar",{position:"absolute",background:"url("+f.images+")","z-index":50,overflow:"hidden",width:f.width+"px",height:f.height+"px",margin:function(){var t=f.spacing,A=pa("{0}px 0 0 {1}px");if(f.align==="right")t=b.offsetWidth-f.width-f.spacing;return A(f.marginTop,t)}()});b.childNodes[0]?b.insertBefore(u,b.childNodes[0]):b.appendChild(u);u.appendChild(q=R.create("div","t5-zoombar-thumb",{position:"absolute",background:h(),"z-index":51,
width:f.width+"px",height:f.thumbHeight+"px",margin:"10px 0 0 0",top:w-o+"px"}));i(0);i(1,f.height-f.buttonHeight);m=INTERACT.watch(u,{bindTarget:u});m.bind("pointerMove",function(t,A,D){w=Math.min(Math.max(o,D.y-(e>>1)),s);c(z-(w-o)/s*z|0)});m.bind("pointerDown",function(t){k(t.target,2)});m.bind("pointerUp",function(t){k(t.target,0)});m.bind("tap",function(t){(t=r[k(t.target,2)])&&t()});d=new Sa(a);d.bind("detach",function(){m.unbind();b.removeChild(u)});a.bind("zoom",function(t,A){c(A)});c(a.zoom());
return d});M(Q,{ex:M,log:xa,observable:ta,configurable:qb,formatter:pa,wordExists:function(a,d){for(var b=a.split(/\s|\,/).length;b--;)if(a.toLowerCase()==d.toLowerCase())return true;return false},is:S,indexOf:bb,fn:function(a){return Kb("fn",a)},project:Qa,unproject:fb,getImage:Wa,userMessage:function(a,d,b){Q.trigger("userMessage",a,d,b)},Registry:Ta,Style:tb,DOM:R,Rect:sa,XY:W,Line:Fa,Hits:Hits,Control:Sa,Tile:ab,Tweener:oa,View:zb,Map:function(a,d){function b(p,m){var g=c.viewport();if(p){g=Ga(p.bestZoomLevel(g.w,
g.h),m||0);return f(g).center(p.center())}else return new GeoJS.BBox((new ra(g.x,g.y2)).sync(c,true).pos(),(new ra(g.x2,g.y)).sync(c,true).pos())}function f(p,m,g){if(S(p,va)){p=Ga(d.minZoom,db(d.maxZoom,p|0));if(p!==h){var q=c.viewport(),e=c.offset(),o=q.w/2;q=q.h/2;var s=ya(2,p-h),w=o/s|0,y=q/s|0;h=p;c.offset(((m||e.x+o)-w)*s,((g||e.y+q)-y)*s);refreshY=refreshX=0;c.trigger("zoom",p);c.trigger("reset");j=c.rpp=fa/(256<<h);c.setMaxOffset(fa/j|0,fa/j|0,true,false);c.scale(1,false,true);c.trigger("resync");
c.refresh()}return c}else return h}d=M({controls:["zoombar"],minZoom:1,maxZoom:18,renderer:"canvas/dom",zoom:1,zoombar:{}},d);var i=new ra,j,h=d.zoom||d.zoomLevel,k=0,c=M(new zb(a,d),{XY:ra,bounds:b,zoom:f});j=c.rpp=fa/(256<<h);c.bind("refresh",function(){var p=c.viewport();if(i.x!=p.x||i.y!=p.y){c.trigger("boundsChange",b());i.x=p.x;i.y=p.y}});c.bind("scaleChanged",function(p,m){var g=eb(m)/Math.LN2|0;if(g!==0){m=ya(2,g);clearTimeout(k);k=setTimeout(function(){f(h+g)},500)}});return c}});if(typeof module!=
"undefined"&&module.exports)module.exports=Q;Q.Decarta=function(){function a(e){return k(j.clientName,j.clientPassword,j.sessionID,j.configuration,j.release,e)}function d(e,o){return c(e.maxResponses,e.version,e.requestID,e.methodName,o)}function b(e,o){j.server||Q.log("No server configured for deCarta - we are going to have issues","warn");return p(j.server,e.requestID,escape(o))}function f(e,o,s){Eb(b(e,a(d(e,e.getRequestBody()))),function(w){var y=w.response.XLS.Response;if(y.numberOfResponses>
0&&y[e.methodName+"Response"]){w=[];if(e.parseResponse)w=e.parseResponse(y[e.methodName+"Response"]);o&&o.apply(null,w)}else s&&s("Server returned no responses",w.response)})}function i(e,o){var s=new m({json:e.StreetAddress}),w=[];if(e.Place){if(!e.Place.length)e.Place=[e.Place];for(var y=e.Place.length;y--;)w[w.length]=e.Place[y].content}return{building:s.building,street:s.street,regions:w,countryCode:e.countryCode||"",postalCode:e.PostalCode||"",pos:o}}var j={sessionID:(new Date).getTime(),server:"",
clientName:"",clientPassword:"",configuration:"",maxResponses:25,release:"4.4.2sp03",tileFormat:"PNG",fixedGrid:true,useCache:true,tileHosts:[],requestTimeout:3E4,geocoding:{countryCode:"US",language:"EN"}};TL=function(){function e(s,w){this.days=s||0;this.seconds=w||0}e.prototype={add:function(){for(var s=new e(this.days,this.seconds),w=arguments.length;w--;){s.days+=arguments[w].days;s.seconds+=arguments[w].seconds}return s},toString:function(){var s,w,y,z="";if(this.days)z=this.days+" days ";if(this.seconds){y=
this.seconds;if(y>=3600){s=~~(y/3600);y-=s*3600}if(y>=60){w=Math.round(y/60);y-=w*60}if(s)z=z+s+(s>1?" hrs ":" hr ")+(w?(w>10?w:"0"+w)+" min ":"");else if(w)z=z+w+" min";else if(y>0)z=z+(y>10?y:"0"+y)+" sec"}return z}};var o=function(){var s=/^P(\d+Y)?(\d+M)?(\d+D)?$/,w=/^(\d+H)?(\d+M)?(\d+S)?$/,y={8601:function(z){z=z.split("T");var n=null;n=null;var u=0,l=0;s.lastIndex=-1;n=s.exec(z[0]);u+=n[3]?parseInt(n[3].slice(0,-1),10):0;w.lastIndex=-1;n=w.exec(z[1]);l+=n[1]?parseInt(n[1].slice(0,-1),10)*3600:
0;l+=n[2]?parseInt(n[2].slice(0,-1),10)*60:0;l+=n[3]?parseInt(n[3].slice(0,-1),10):0;return new e(u,l)}};return function(z,n){var u=y[n];if(!u)throw"No parser found for the duration format: "+n;return u(z)}}();return{Duration:e,parse:o}}();var h=1,k=pa("<xls:XLS version='1' xls:lang='en' xmlns:xls='http://www.opengis.net/xls' rel='{4}' xmlns:gml='http://www.opengis.net/gml'><xls:RequestHeader clientName='{0}' clientPassword='{1}' sessionID='{2}' configuration='{3}' />{5}</xls:XLS>"),c=pa("<xls:Request maximumResponses='{0}' version='{1}' requestID='{2}' methodName='{3}Request'>{4}</xls:Request>"),
p=pa("{0}/JSON?reqID={1}&chunkNo=1&numChunks=1&data={2}&responseFormat=JSON"),m=function(e){e=Q.ex({json:{}},e);var o="",s="";if(e.json.Street)o=e.json.Street.content?e.json.Street.content:e.json.Street;o=o&&o.replace?o.replace(/\/\d+$/,""):"";if(e.json.Building)if(e.json.Building.number)s=e.json.Building.number;return{building:s,street:o,calcMatchPercentage:function(w){var y=0,z=Q.Addressing.normalize(w),n=Q.Addressing.normalize(o);if(e.json.Building)if(Q.Addressing.buildingMatch(w,e.json.Building.number.toString()))y+=
0.2;if(z&&n&&Q.wordExists(z,n))y+=0.8;return y},toString:function(){if(o)return(s?s+" ":"")+o;return""}}},g=function(){return{methodName:"",maxResponses:25,version:"1.0",requestID:h++,getRequestBody:function(){return""},parseResponse:function(e){return[e]}}},q=function(){return Q.ex(new g,{methodName:"RUOK",parseResponse:function(e){return[{aliasCount:e.maxHostAliases,host:e.hostName}]}})};Q.Registry.register("generator","decarta",function(e){function o(y,z,n,u){if(y=y.zoom?y.zoom():0){var l=2<<y-
1,r=l>>1,t=e.tileSize,A=(z.w/t|0)+1,D=(z.h/t|0)+1,E=(z.x/t|0)-r;z=l-(z.y/t|0)-r-D;var J=n.search({x:(r+E)*t,y:(r+z*-1-D)*t,w:A*t,h:D*t});l={};var F;for(F=J.length;F--;)l[J[F].id]=true;for(J=0;J<=A;J++)for(F=0;F<=D;F++){var O=E+J,C=z+F-1,I=O+"_"+C;if(!l[I]){O=new Q.Tile((r+E+J)*t,(r+z*-1-F)*t,w[J%w.length]+"/openls/image-cache/TILE?LLMIN=0.0,0.0&LLMAX="+s[y]+"&CACHEABLE=true&DS=navteq-world&WIDTH=256&HEIGHT=256&CLIENTNAME="+j.clientName+"&SESSIONID="+j.sessionID+"&FORMAT=PNG&CONFIG="+j.configuration+
"&N="+C+"&E="+O,t,t,I);n.insert(O,O)}}u&&u()}}e=Q.ex({tileSize:256},e);var s=["89.787438015348100000,360.00000000000000000","85.084059050110410000,180.00000000000000000","66.653475896509040000,90.00000000000000000","41.170427238429790000,45.000000000000000000","22.076741328793200000,22.500000000000000000","11.251819676168665000,11.250000000000000000","5.653589942659626000,5.625000000000000000","2.830287664051185000,2.812500000000000000","1.415581451872543800,1.406250000000000000","0.707845460801532700,0.703125000000000000",
"0.353929573271679340,0.351562500000000000","0.176965641673330230,0.175781250000000000","0.088482927761462040,0.087890625000000000","0.044241477246363230,0.043945312500000000","0.022120740293895182,0.021972656250000000","0.011060370355776452,0.010986328125000000","0.005530185203987857,0.005493164062500000","0.002765092605263539,0.002746582031250000","0.001382546303032519,0.001373291015625000","0.000691272945568983,0.000686645507812500","0.000345636472797214,0.000343322753906250"],w=null;Q.userMessage("ack",
"decarta","&copy; deCarta, Inc. Map and Imagery Data &copy; NAVTEQ or Tele Atlas or DigitalGlobe");return{run:function(y,z,n,u){w?o(y,z,n,u):f(new q,function(l){w=[];if(l.aliasCount)for(var r=0;r<l.aliasCount;r++)w[r]="http://"+l.host.replace("^(.*?).(.*)$","\u0001-0"+(r+1)+".\u0002");else w=["http://"+l.host];o(y,z,n,u)})}}});Q.Registry.register("service","geocoder",function(){var e=Q.formatter('<xls:GeocodeRequest><xls:Address countryCode="{0}" language="{1}">{2}</xls:Address></xls:GeocodeRequest>'),
o=Q.formatter('<xls:StreetAddress><xls:Building number="{0}" /><xls:Street>{1}</xls:Street></xls:StreetAddress>'),s=function(y,z){z=Q.ex({countryCode:j.geocoding.countryCode,language:j.geocoding.language},z);var n=new g;return Q.ex({},n,{methodName:"Geocode",getRequestBody:function(){var u=o(y.number,y.street);u+='<xls:Place type="Municipality">'+y.regions.join(" ")+"</xls:Place>";return e(z.countryCode,z.language,u)},parseResponse:function(u){var l=u.GeocodeResponseList;u=[];var r=l?l.numberOfGeocodedAddresses:
0,t=[];if(r>1)t=l.GeocodedAddress;else if(r==1)t=[l.GeocodedAddress];for(l=0;t&&l<t.length;l++){r=t[l];var A=null,D=null;if(r&&r.GeocodeMatchCode&&r.GeocodeMatchCode.matchType!=="NO_MATCH"){if(r&&r.Point)D=new GeoJS.Pos(r.Point.pos);if(r&&r.Address)A=i(r.Address,D)}(r=A)&&u.push(r)}return[u]}})},w=function(y){y=Q.ex({position:null,geocodePreference:"StreetAddress"},y);return Q.ex(new g,{methodName:"ReverseGeocode",getRequestBody:function(){return"<xls:ReverseGeocodeRequest><xls:Position><gml:Point><gml:pos>"+
y.position.toString()+"</gml:pos></gml:Point></xls:Position><xls:ReverseGeocodePreference>"+y.geocodePreference+"</xls:ReverseGeocodePreference></xls:ReverseGeocodeRequest>"},parseResponse:function(z){var n=null;if(z&&z.Point)n=new GeoJS.Pos(match.Point.pos);if(z&&z.ReverseGeocodedLocation&&z.ReverseGeocodedLocation.Address)return[i(z.ReverseGeocodedLocation.Address,n)];return[]}})};typeof ADDR==="undefined"&&Q.log("Sidelab addressing module not found, geocoder will not function","warn");return{forward:function(y,
z){f(new s(y),function(n){z(y,n)})},reverse:function(y,z){var n=new w({position:y});f(n,function(u){z&&z(u)})}}});Q.Registry.register("service","routing",function(){var e=function(o,s){s=Q.ex({provideRouteHandle:false,distanceUnit:"KM",routeQueryType:"RMAN",routePreference:"Fastest",routeInstructions:true,routeGeometry:true},s);var w=new g,y=Q.formatter('<xls:DetermineRouteRequest provideRouteHandle="{0}" distanceUnit="{1}" routeQueryType="{2}">'),z=Q.formatter("<xls:{0}><xls:Position><gml:Point><gml:pos>{1}</gml:pos></gml:Point></xls:Position></xls:{0}>");
return Q.ex({},w,{methodName:"DetermineRoute",getRequestBody:function(){if(o.length<2)throw Error("Cannot send RouteRequest, less than 2 waypoints specified");var n=y(s.provideRouteHandle,s.distanceUnit,s.routeQueryType);n+="<xls:RoutePlan>";n+="<xls:RoutePreference>"+s.routePreference+"</xls:RoutePreference>";n+="<xls:WayPointList>";for(var u=0;u<o.length;u++)n+=z(u===0?"StartPoint":u===o.length-1?"EndPoint":"ViaPoint",o[u].toString());n+="</xls:WayPointList>";n+="</xls:RoutePlan>";if(s.routeInstructions)n+=
'<xls:RouteInstructionsRequest rules="maneuver-rules" providePoint="true" />';if(s.routeGeometry)n+="<xls:RouteGeometryRequest />";n+="</xls:DetermineRouteRequest>";return n},parseResponse:function(n){var u=n.RouteGeometry.LineString.pos,l=n.RouteInstructionsList;n=[];l=l&&l.RouteInstruction?l.RouteInstruction:[];for(var r=0;r<l.length;r++){var t=l[r].distance;n.push({text:l[r].Instruction,latlng:l[r].Point,distance:t.value+(t.uom||"M").toUpperCase(),time:TL.parse(l[r].duration,"8601")})}return[u,
n]}})};return{calculate:function(o,s,w){f(new e(o),s,w)}}});return{applyConfig:function(e){Q.ex(j,e)},compareFns:function(){return{streetDetails:function(e,o){return o.calcMatchPercentage(e)},location:function(e,o){return o.calcMatchPercentage(e)}}}()}}()})();
