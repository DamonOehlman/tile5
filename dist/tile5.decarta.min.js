(function(){function K(p,A,E){if(p&&p.split){var F=p.split(Ka);if(F.length>1){p=F[0];A=F[1]}}else if(p&&p.lat){A=p.lon;p=p.lat}this.lat=parseFloat(p||0);this.lon=parseFloat(A||0);this.radius=E||$a}function sa(p){this.positions=[];for(var A=p.length;A--;)this.positions[A]=typeof p[A]=="string"?new K(p[A]):p[A]}function ja(p,A){if(p&&p.splice){for(var E=A,F=new K(Aa,La),S=new K(Ma,ab),ia=p.length;ia--;){var ea=typeof p[ia]=="string"?new K(p[ia]):p[ia];if(ea.lat<F.lat)F.lat=ea.lat;if(ea.lat>S.lat)S.lat=
ea.lat;if(ea.lon<F.lon)F.lon=ea.lon;if(ea.lon>S.lon)S.lon=ea.lon}this.min=F;this.max=S;if(typeof E=="undefined"){E=this.size();E=Math.max(E.x,E.y)*0.3}this.min=new K(F.lat-E,(F.lon-E)%360);this.max=new K(S.lat+E,(S.lon+E)%360)}else{this.min=p;this.max=A}}function Ea(p){if(typeof p=="string"){var A=(p.replace(/\d|\.|\s/g,"")||"m").toLowerCase();p=parseFloat(p)*({km:1E3}[A]||1)}this.meters=p||0}var ba=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],Ba=typeof module!=
"undefined"&&module.exports,ma=Math.PI*2,ta=Math.PI/2,fa=Math.PI/180,na=180/Math.PI,Aa=90,Ma=-Aa,La=180,ab=-La,pa=Aa*fa,Ta=-pa,Na=La*fa,Z=-Na,$a=6371,U=$a*1E3,Ka=/[\,\s]+/;K.prototype={constructor:K,bearing:function(p){var A=this.lat*fa,E=p.lat*fa;p=(p.lon-this.lon)*fa;return(Math.atan2(Math.sin(p)*Math.cos(E),Math.cos(A)*Math.sin(E)-Math.sin(A)*Math.cos(E)*Math.cos(p))*na+360)%360},copy:function(){return new K(this.lat,this.lon)},distanceTo:function(p){if(!p||this.empty()||p.empty())return 0;var A=
(p.lat-this.lat)*fa/2,E=(p.lon-this.lon)*fa/2;p=Math.sin(A)*Math.sin(A)+Math.cos(this.lat*fa)*Math.cos(p.lat*fa)*Math.sin(E)*Math.sin(E);return this.radius*2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p))},equalTo:function(p){return pos&&this.lat===p.lat&&this.lon===p.lon},empty:function(){return this.lat===0&&this.lon===0},inArray:function(p){if(p)for(var A=p.length;A--;)if(this.equal(p[A]))return true;return false},offset:function(p,A){var E=this.lat*fa,F=E+p/this.radius;E=this.lon*fa+Math.asin(Math.sin(A/
this.radius)/Math.cos(E));F=(F+ta)%Math.PI-ta;E%=ma;return new K(F*na,E*na)},to:function(p,A){if(typeof p=="object")p=this.bearing(p);var E=A/this.radius,F=p*fa,S=this.lat*fa,ia=Math.asin(Math.sin(S)*Math.cos(E)+Math.cos(S)*Math.sin(E)*Math.cos(F));E=this.lon*fa+Math.atan2(Math.sin(F)*Math.sin(E)*Math.cos(S),Math.cos(E)-Math.sin(S)*Math.sin(ia));E=(E+3*Math.PI)%(2*Math.PI)-Math.PI;return new K(ia*na,E*na)},toBounds:function(p){var A=p.radians(),E=this.lat*fa,F=this.lon*fa;p=E-A;var S=E+A;if(p>Ta&&
S<pa){E=Math.asin(Math.sin(A)/Math.cos(E));A=F-E;if(A<Z)A+=ma;F=F+E;if(F>Na)F-=ma}else{p=Math.max(p,Ta);S=Math.min(S,pa);A=ab;F=La}return new ja(new K(p*na,A*na),new K(S*na,F*na))},toString:function(p){return this.lat+(p||" ")+this.lon},valid:function(){return!(isNaN(this.lat)||isNaN(this.lon))}};sa.prototype={constructor:sa,distance:function(){for(var p=0,A=[],E,F=this.positions.length-1;F--;){E=this.positions[F].distanceTo(this.positions[F+1]);p+=A[F]=E}return{total:p,segments:A}},traverse:function(p,
A){var E=0,F=0;if(!A||!A.segments)A=this.distance();if(p>A.total)return this.positions[this.positions.length-1];else if(p<=0)return this.positions[0];else{for(;F<A.segments.length;){E+=A.segments[F];if(E>p){E-=A.segments[F];break}F++}if(F<this.positions.length-1){var S=this.positions[F];F=S.bearing(this.positions[F+1]);return S.to(F,p-E)}else return this.positions[F]}}};ja.prototype={constructor:ja,bestZoomLevel:function(p,A){var E=this.center(),F=ba[Math.min(Math.round(Math.abs(E.lat)*0.05),ba.length)],
S=this.size();E=Math.ceil(Math.log(ba[3]*A/S.y)/Math.LN2);F=Math.ceil(Math.log(F*p/S.x)/Math.LN2);return Math.min(isNaN(E)?1E3:E,isNaN(F)?1E3:F)},center:function(){var p=this.size();return new K(this.min.lat+p.y/2,this.min.lon+p.x/2)},expand:function(p){return new ja(new K(this.min.lat-p,(this.min.lon-p)%360),new K(this.max.lat+p,(this.max.lon+p)%360))},size:function(p){var A={x:0,y:this.max.lat-this.min.lat};A.x=typeof p!="undefined"&&p&&this.min.lon>this.max.lon?360-this.min.lon+this.max.lon:this.max.lon-
this.min.lon;return A},toString:function(){return"min: "+this.min+", max: "+this.max},union:function(){for(var p=this.min.copy(),A=this.max.copy(),E=arguments.length;E--;)if(arguments[E]){var F=arguments[E].min,S=arguments[E].max;p.lat=Math.min(p.lat,F.lat);p.lon=Math.min(p.lon,F.lon);A.lat=Math.max(A.lat,S.lat);A.lon=Math.max(A.lon,S.lon)}return new ja(p,A)}};Ea.prototype={add:function(){for(var p=this.meters,A=arguments.length;A--;){var E=typeof arguments[A]=="string"?new Ea(arguments[A]):arguments[A];
p+=E.meters}return new Ea(p)},radians:function(p){if(typeof p!="undefined"){this.meters=p*U;return this}else return this.meters/U},toString:function(){if(this.meters>1E3)return(this.meters/10|0)/100+"km";return this.meters+"m"}};var Ua=this.GeoJS={Pos:K,Line:sa,BBox:ja,Distance:Ea,generalize:function(p,A,E){var F=p.length,S=[],ia=null;E=(E||250)/1E3;for(F=F;F--;)if(F===0)S.unshift(p[F]);else{var ea=!ia||p[F].inArray(A)?E:ia.distanceTo(p[F]);if(p[F]&&ea>=E){S.unshift(p[F]);ia=p[F]}}return S},include:function(p){if(Ba){p=
p.split(",");for(var A=0;A<p.length;A++){var E=require("./plugins/"+p[A].trim()),F;for(F in E)Ua[F]=E[F]}}return Ua}};if(Ba)module.exports=Ua})();
(function(){function K(){var a=arguments[0]||{},d=Array.prototype.slice.call(arguments,1),b=d.length,e,g;for(g=0;g<b;g++)if((e=d[g])!==null)for(var i in e){var f=e[i];if(a!==f)if(f!==undefined)a[i]=f}return a}function sa(a,d){if(typeof console!=="undefined")console[d||"log"](a)}function ja(a){var d=a.match(La),b=[],e=0,g;for(g=d?d.length:0;g--;){var i=d[g].slice(1);b[i]||(b[i]=RegExp("\\{"+i+"\\}","g"))}e=b.length;return function(){var f=a;for(g=0;g<e;g++){var l=arguments[g];if(typeof l=="undefined")l=
"";f=f.replace(b[g],l)}return f}}function Ea(a,d){var b=ia*Oa(a);return E-2*rb(d*Fa((1-b)/(1+b),ia/2))}function ba(a,d){if(Z(a,Ca)){var b=a.split(sb);this.x=parseFloat(b[0]);this.y=parseFloat(b[1])}else if(a&&a.x){this.x=a.x;this.y=a.y}else{this.x=a||0;this.y=d||0}}function Ba(a){this.allowCull=a}function ma(a,d,b,e){this.mercX=b;this.mercY=e;if(Z(a,Ca))K(this,Fb.parseXY(a));else a&&a.toBounds?K(this,bb(a.lon,a.lat)):ba.call(this,a,d)}function ta(a,d,b,e){this.x=a||0;this.y=d||0;this.w=b||0;this.h=
e||0;this.x2=this.x+this.w;this.y2=this.y+this.h}function fa(a,d){var b=new tb(Math.sqrt(256<<a)|0);d&&d.zoomLevel===a&&d.copyInto(b);b.zoomLevel=a;return b}function na(a,d,b,e,g,i){this.x=a;this.y=d;this.w=e||256;this.h=e||256;this.x2=this.x+this.w;this.y2=this.y+this.h;this.url=b;this.id=i||a+"_"+d;this.loaded=false;this.image=null}function Aa(a,d){d=K({id:"layer_"+Gb++,zindex:0,animated:false,style:null,minXY:null,maxXY:null,visible:true},d);this.visible=d.visible;this.view=a;pa(K(this,d))}function Ma(){pa(this)}
var La=/\{(\d+)(?=\})/g,ab=function(){var a=1.70158,d=Math.PI/2,b=Math.abs,e=Math.pow,g=Math.sin,i=Math.asin,f=Math.cos,l={linear:function(c,j,k,h){return k*c/h+j},backin:function(c,j,k,h){return k*(c/=h)*c*((a+1)*c-a)+j},backout:function(c,j,k,h){return k*((c=c/h-1)*c*((a+1)*c+a)+1)+j},backinout:function(c,j,k,h){return(c/=h/2)<1?k/2*c*c*(((a*=1.525)+1)*c-a)+j:k/2*((c-=2)*c*(((a*=1.525)+1)*c+a)+2)+j},bouncein:function(c,j,k,h){return k-l.bounceout(h-c,0,k,h)+j},bounceout:function(c,j,k,h){return(c/=
h)<1/2.75?k*7.5625*c*c+j:c<2/2.75?k*(7.5625*(c-=1.5/2.75)*c+0.75)+j:c<2.5/2.75?k*(7.5625*(c-=2.25/2.75)*c+0.9375)+j:k*(7.5625*(c-=2.625/2.75)*c+0.984375)+j},bounceinout:function(c,j,k,h){return c<h/2?l.bouncein(c*2,0,k,h)/2+j:l.bounceout(c*2-h,0,k,h)/2+k/2+j},cubicin:function(c,j,k,h){return k*(c/=h)*c*c+j},cubicout:function(c,j,k,h){return k*((c=c/h-1)*c*c+1)+j},cubicinout:function(c,j,k,h){if((c/=h/2)<1)return k/2*c*c*c+j;return k/2*((c-=2)*c*c+2)+j},elasticin:function(c,j,k,h,n,o){if(c==0)return j;
if((c/=h)==1)return j+k;o||(o=h*0.3);if(!n||n<b(k)){n=k;k=o/4}else k=o/A*i(k/n);return-(n*e(2,10*(c-=1))*g((c*h-k)*A/o))+j},elasticout:function(c,j,k,h,n,o){var q;if(c==0)return j;if((c/=h)==1)return j+k;o||(o=h*0.3);if(!n||n<b(k)){n=k;q=o/4}else q=o/A*i(k/n);return n*e(2,-10*c)*g((c*h-q)*A/o)+k+j},elasticinout:function(c,j,k,h,n,o){var q;if(c==0)return j;if((c/=h/2)==2)return j+k;o||(o=h*0.3*1.5);if(!n||n<b(k)){n=k;q=o/4}else q=o/A*i(k/n);if(c<1)return-0.5*n*e(2,10*(c-=1))*g((c*h-q)*A/o)+j;return n*
e(2,-10*(c-=1))*g((c*h-q)*A/o)*0.5+k+j},quadin:function(c,j,k,h){return k*(c/=h)*c+j},quadout:function(c,j,k,h){return-k*(c/=h)*(c-2)+j},quadinout:function(c,j,k,h){if((c/=h/2)<1)return k/2*c*c+j;return-k/2*(--c*(c-2)-1)+j},sinein:function(c,j,k,h){return-k*f(c/h*d)+k+j},sineout:function(c,j,k,h){return k*g(c/h*d)+j},sineinout:function(c,j,k,h){return-k/2*(f(Math.PI*c/h)-1)+j}};return function(c){c=c.replace(/[\-\_\s\.]/g,"").toLowerCase();return l[c]||l.linear}}(),pa=function(){function a(b,e){var g=
b.hasOwnProperty("obsHandlers")?b.obsHandlers:null;g[e]||(g[e]=[]);return g[e]}var d=0;return function(b){if(!b)return null;if(!(b.hasOwnProperty("obsHandlers")?b.obsHandlers:null))b.obsHandlers={};if(!b.hasOwnProperty("bind")){b.bind=function(e,g){var i="callback"+d++;a(b,e).unshift({fn:g,id:i});return i};b.triggerCustom=function(e,g){var i=a(b,e),f={cancel:false,name:e,source:this},l;for(l in g)f[l]=g[l];if(!i)return null;l=Array.prototype.slice.call(arguments,2);b.eventInterceptor&&b.eventInterceptor(e,
f,l);l.unshift(f);for(var c=i.length;c--&&!f.cancel;)i[c].fn.apply(this,l);return f};b.trigger=function(e){var g=Array.prototype.slice.call(arguments,1);g.splice(0,0,e,null);return b.triggerCustom.apply(this,g)};b.unbind=function(e,g){if(typeof e==="undefined")b.obsHandlers={};else for(var i=a(b,e),f=0;i&&f<i.length;f++)if(i[f].id===g){i.splice(f,1);break}return b}}return b}}(),Ta=function(){function a(d,b,e,g){if(typeof d[g]=="undefined")d[g]=function(i){if(typeof i!="undefined"){b[g]=i;e[g]&&e[g](i);
return d}else return b[g]}}return function(d,b,e){b=b||d;for(var g in b)typeof b[g]!="function"&&a(d,b,e,g);return d}}(),Na=Array.prototype.indexOf||function(a){for(var d=0;d<this.length;d++)if(this[d]===a)return d;return-1},Z=function(){var a={NaN:1,Infinity:1,"-Infinity":1},d=String.prototype.toLowerCase,b=Object.prototype.toString;return function(e,g){g=d.call(g);if(g=="finite")return!a.hasOwnProperty(+e);return g=="null"&&e===null||g==typeof e||g=="object"&&e===Object(e)||g=="array"&&Array.isArray&&
Array.isArray(e)||b.call(e).slice(8,-1).toLowerCase()==g}}(),$a=function(){function a(i){var f=document.createElement("script"),l=false;f.src=i;f.async=true;f.onload=f.onreadystatechange=function(){if(!l&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){l=true;f.onload=f.onreadystatechange=null;f&&f.parentNode&&f.parentNode.removeChild(f)}};g||(g=document.getElementsByTagName("head")[0]);g.appendChild(f)}function d(i,f,l){i+=i.indexOf("?")>=0?"&":"?";var c="json"+ ++e;
window[c]=function(j){f(j);window[c]=null;try{delete window[c]}catch(k){}};a(i+(l?l:"callback")+"="+c);return c}function b(i,f,l){var c=require("request");i=i+(i.indexOf("?")>=0?"&":"?")+(l?l:"callback")+"=cb";c({uri:i},function(j,k,h){if(j)f({error:j});else{j=h.replace(/^.*\(/,"").replace(/\).*$/,"");f(JSON.parse(j))}})}var e=0,g;return typeof window!="undefined"?d:b}();INTERACT=function(){function a(n){return function(o,q){n.addEventListener(o,q,false)}}function d(n){return function(o,q){n.removeEventListener(o,
q,false)}}function b(n){return function(o,q){n.attachEvent("on"+o,q)}}function e(n,o){return{x:n?n:0,y:o?o:0,count:1}}function g(n,o){k.push(K({handler:null,checks:{},type:n},o))}function i(n){var o=0,q=0;if(n.offsetParent){do{o+=n.offsetLeft;q+=n.offsetTop;n=n.offsetParent}while(n)}return{left:o,top:q}}function f(n,o){return{source:n,target:o.target?o.target:o.srcElement}}function l(n,o){for(var q=n.target?n.target:n.srcElement;q&&q!==o;)q=q.parentNode;return q&&q===o}function c(n,o){return{x:n.x-
(o?o.left:0),y:n.y-(o?o.top:0)}}function j(n,o){if(n.preventDefault){n.preventDefault();n.stopPropagation()}else if(typeof n.cancelBubble!="undefined")n.cancelBubble=true;o&&n.stopImmediatePropagation&&n.stopImmediatePropagation()}var k=[],h=function(n,o,q){q=K({binder:null,unbinder:null,observable:null},q);for(var B=q.observable,H=[],T,v,I={bind:function(){return B.bind.apply(null,arguments)},unbind:function(){B.unbind();for(x=0;x<H.length;x++)H[x].unbind();return I}},x=0;x<o.length;x++)H.push(o[x](n,
B,q));B.bind("pointerDown",function(){v=T=0});B.bind("pointerMove",function(m,u,s,r){T+=r.x||0;v+=r.y||0});B.bind("pointerUp",function(m,u,s){Math.abs(T)>20||Math.abs(v)>20||B.triggerCustom("tap",m,u,s)});return I};g("pointer",{handler:function(n,o,q){function B(G){if(G.pageX&&G.pageY)return e(G.pageX,G.pageY);else{var L=document.documentElement,W=document.body;return e(G.clientX+(L&&L.scrollLeft||W&&W.scrollLeft||0)-(L&&L.clientLeft||W&&W.clientLeft||0),G.clientY+(L&&L.scrollTop||W&&W.scrollTop||
0)-(L&&L.clientTop||W&&W.clientTop||0))}}function H(G){if(l(G,n))if(D=x(G)){var L=B(G);n.style.cursor="move";j(G,true);V=L.x;P=L.y;z=e(V,P);o.triggerCustom("pointerDown",f("mouse",G),z,c(z,i(n)))}}function T(G){var L=B(G);C=L.x;M=L.y;if(l(G,n))u(G,D?"pointerMove":"pointerHover")}function v(G){if(D&&x(G)){D=false;if(l(G,n)){n.style.cursor="default";u(G,"pointerUp")}}}function I(G){if(l(G,n)){var L;G=G||window.event;if(G.detail){if(typeof G.axis=="undefined"||G.axis===2)L=-G.detail*s}else{L=G.wheelDeltaY?
G.wheelDeltaY:G.wheelDelta;if(window.opera)L=-L}if(L){var W=e(C,M);o.triggerCustom("zoom",f("mouse",G),W,c(W,i(n)),L/r,"wheel");j(G);G.returnValue=false}}}function x(G){G=G||window.event;return(G.which||G.button)==1}function m(){return false}function u(G,L,W,ca,J){W=typeof W!="undefined"?W:C;ca=typeof ca!="undefined"?ca:M;var Q=W-V,N=ca-P,ha=e(W,ca);o.triggerCustom(L,f("mouse",G),ha,c(ha,i(n)),e(Q,N));if(typeof J=="undefined"||J){V=W;P=ca}}q=K({},q);var s=120,r=s*8,D=false,z,C,M,V,P;q.binder("mousedown",
H);q.binder("mousemove",T);q.binder("mouseup",v);q.binder("dblclick",function(G){if(l(G,n)){var L=B(G);o.triggerCustom("doubleTap",f("mouse",G),L,c(L,i(n)))}});q.binder("selectstart",m);q.binder("dragstart",m);q.binder("mousewheel",I);q.binder("DOMMouseScroll",I);return{unbind:function(){q.unbinder("mousedown",H);q.unbinder("mousemove",T);q.unbinder("mouseup",v);q.unbinder("mousewheel",I);q.unbinder("DOMMouseScroll",I)}}},checks:{touch:false}});g("pointer",{handler:function(n,o,q){function B(J){if(J.count<
2)return 0;var Q=J.x-J.next.x;J=J.y-J.next.y;return~~Math.sqrt(Q*Q+J*J)}function H(J,Q,N){Q=Q?Q:0;N=N?N:0;for(var ha={x:J.x-Q,y:J.y-N,id:J.id,count:J.count},Y=ha;J.next;){J=J.next;Y=Y.next={x:J.x-Q,y:J.y-N,id:J.id}}return ha}function T(J,Q){var N=J[Q?Q:"touches"],ha,Y;if(N.length===0)return null;Y=ha={x:N[0].pageX,y:N[0].pageY,id:N[0].identifier,count:N.length};for(var $=1,wa=N.length;$<wa;$++)Y=Y.next={x:N[$].pageX,y:N[$].pageY,id:N[$].identifier};return ha}function v(J){if(l(J,n)){C=i(n);var Q=
T(J,"changedTouches"),N=H(Q,C.left,C.top);if(!V){M=r;o.triggerCustom("pointerDown",f("touch",J),Q,N)}W&&o.triggerCustom("pointerDownMulti",f("touch",J),Q,N);V=T(J);if(V.count>1)G=B(V);ca=1;L=H(V)}}function I(J){if(l(J,n)){j(J);P=T(J);if(M==r)M=Math.abs(V.x-P.x)>u||Math.abs(V.y-P.y)>u?s:r;if(M!=r){M=P.count>1?z:D;if(M==z)if(V.count===1){V=H(P);G=B(V)}else{var Q=B(P);if(Math.abs(G-Q)<m)M=D;else{var N;N=P.x;var ha=P.next.x,Y=P.y,$=P.next.y;N={x:(N<ha?N:ha)+(Math.abs(N-ha)>>1),y:(Y<$?Y:$)+(Math.abs(Y-
$)>>1)};Q=Q/G;ha=Q-ca;o.triggerCustom("zoom",f("touch",J),N,c(N,C),ha,"pinch");ca=Q}}M==D&&o.triggerCustom("pointerMove",f("touch",J),P,H(P,C.left,C.top),e(P.x-L.x,P.y-L.y));W&&o.triggerCustom("pointerMoveMulti",f("touch",J),P,H(P,C.left,C.top))}L=H(P)}}function x(J){if(l(J,n)){var Q=T(J,"changedTouches"),N=H(Q,C.left,C.top);P=T(J);if(!P){o.triggerCustom("pointerUp",f("touch",J),Q,N);V=null}W&&o.triggerCustom("pointerUpMulti",f("touch",J),Q,N)}}q=K({detailed:false,inertia:false},q);var m=20,u=7,s=
0,r=1,D=2,z=3,C,M,V,P,G,L,W=q.detailed,ca=1;q.binder("touchstart",v);q.binder("touchmove",I);q.binder("touchend",x);sa("initialized touch handler");return{unbind:function(){q.unbinder("touchstart",v);q.unbinder("touchmove",I);q.unbinder("touchend",x)}}},checks:{touch:true}});return{register:g,watch:function(n,o,q){o=K({bindTarget:null,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},o);capabilities=K({touch:"ontouchstart"in window},q);if(!o.observable){sa("creating observable");
o.observable=pa({});globalOpts=o}o.binder=(o.isIE?b:a)(o.bindTarget||document);o.unbinder=(o.isIE?b:d)(o.bindTarget||document);q=o.types;for(var B=capabilities,H=[],T=k.length;T--;){var v=k[T],I=!q||q.indexOf(v.type)>=0,x=true,m;for(m in v.checks){var u=v.checks[m];sa("checking "+m+" capability. require: "+u+", capability = "+B[m]);x=x&&u===B[m]}if(I&&x)H[H.length]=v.handler}return new h(n,H,o)}}}();var U=this.T5=pa({}),Ka=function(){var a={};return{create:function(d,b){if(a[d][b])return a[d][b].apply(null,
Array.prototype.slice.call(arguments,2));throw p(d,b);},get:function(d,b){return a[d]?a[d][b]:null},register:function(d,b,e){a[d]||(a[d]={});a[d][b]&&sa(Ua(d,b),"warn");a[d][b]=e}}}(),Ua=ja("Registration of {0}: {1} will override existing definition"),p=ja("Could not create {0} of type: {1}");ja("Could not create drawable of type: {0}");var A=Math.PI*2,E=Math.PI/2,F=Math.PI/180,S=180/Math.PI,ia=0.08181919084262157,ea=Math.abs,cb=Math.round,ub=Math.min,db=Math.max,Fa=Math.pow,Hb=Math.sqrt,lb=Math.log,
Oa=Math.sin,eb=Math.cos,rb=Math.atan,Ga="undefined",Ca="string",Da="number",ua=Ka.register,Pa=Ka.create,Ib=Ka.get,Jb=0,Gb=0,sb=/[\,\s]+/,Qa=function(){function a(f){g++;f=aa?window.mozAnimationStartTime||f||(new Date).getTime():(new Date).getTime();for(var l=e.length;l--;){var c=e[l];g%c.every===0&&c.cb(f)}i&&animFrame(a)}var d=1E3/60,b=["r","webkitR","mozR","oR","msR"],e=[],g=0,i=aa&&function(){for(var f=0;f<b.length;f++)window.animFrame=window.animFrame||window[b[f]+"equestAnimationFrame"];return animFrame}();
i?animFrame(a):setInterval(a,1E3/60);return{attach:function(f,l){e[e.length]={cb:f,every:l?cb(l/d):1}},detach:function(f){for(var l=e.length;l--;)if(e[l].cb===f){e.splice(l,1);break}}}}(),Fb=function(){var a=/^xy\((.*)\).*$/i;return{parseXY:function(d){if(!a.test(d)){d=d.split(sb);return bb(d[1],d[0])}}}}(),aa=typeof window!="undefined"?function(){function a(g){for(var i=0;i<g.length;i++){var f=g[i];if(typeof document.body.style[f]!="undefined")return f}}var d={"-webkit-user-select":"none",position:"absolute"},
b,e;b=a(["-webkit-transform","MozTransform"]);css3DTransformProp=a(["WebkitPerspective","MozPerspective"]);e=a(["-webkit-transform-origin","MozTransformOrigin"]);return{transforms:Z(b,Ca),create:function(g,i,f){g=document.createElement(g);var l=[];f=f||{};g.className=i||"";for(var c in f)l[l.length]=c+": "+f[c];g.style.cssText=l.join(";");return g},move:function(g,i,f,l,c){if(b){g.style[b]="translate("+i+"px, "+f+"px) "+(l||[]).join(" ");if(c&&e)g.style[e]=c.x+"px "+c.y+"px"}else{g.style.left=i+"px";
g.style.top=f+"px"}},styles:function(g){return K({},d,g)}}}():null,vb=function(){function a(){for(var g=e.length,i=g;i--;)try{e[i](g)}catch(f){sa(f.toString(),"error")}}var d=20,b=50,e=[];return{process:function(g,i,f,l){function c(h){h=(j||b)/h;if(k<g.length){var n=g.slice(k,k+h);h=n.length;var o=j?0:(new Date).getTime();i(n,h);if(!j)j=(n=((new Date).getTime()-o)/h)?d/n|0:g.length;k+=h}else{for(h=e.length;h--;)if(e[h]===c){e.splice(h,1);break}e.length===0&&Qa.detach(a);f&&f()}}var j,k=0;if(aa&&g.length>
(l||0))e.push(c)===1&&Qa.attach(a);else{i(g,g.length);f&&f()}}}}(),bb=bb||function(a,d){var b=parseFloat(d)*F;b=Oa(b);var e=ia*b;b=lb((1+b)/(1-b)*Fa((1-e)/(1+e),ia))/2;return new ma(0,0,parseFloat(a)*F,b)},mb=mb||function(a,d){for(var b=Fa(Math.E,-d),e=E-2*rb(b),g=Ea(e,b),i=0;i<12&&ea(e-g)>1.0E-7;){e=g;g=Ea(e,b);i++}return new GeoJS.Pos(g*S,a%360*S)};ba.prototype={constructor:ba,add:function(){for(var a=this.x,d=this.y,b=arguments.length;b--;){a+=arguments[b].x;d+=arguments[b].y}return this.copy(a,
d)},copy:function(a,d){var b=K({},this);b.x=a||b.x;b.y=d||b.y;return b},equals:function(a){return this.x===a.x&&this.y===a.y},offset:function(a,d){return this.copy(this.x+a,this.y+d)},relative:function(a){a=a.viewport();return this.copy(this.x-a.x-a.padding.x,this.y-a.y-a.padding.y)},rotate:function(a,d){d=d||new ba(0,0);var b=this.x-d.x,e=this.y-d.y;return new ba(d.x+eb(a)*b+-Oa(a)*e,d.y+Oa(a)*b+eb(a)*e)},scale:function(a,d){d=d||new ba(0,0);return new ba(d.x+(this.x-d.x)*a,d.y+(this.y-d.y)*a)},
sync:function(){return this},toString:function(){return this.x+", "+this.y}};Ba.prototype=K([],{cull:function(a){if(this.allowCull){var d=a.x,b=a.y,e=a.x+a.w;a=a.y+a.h;for(var g=Infinity,i=0,f,l=this.length;l--;)if(f=this[l].x>=d&&this[l].x<=e&&this[l].y>=b&&this[l].y<=a){g=l<g?l:g;i=l>i?l:i}return this.slice(db(g-1,0),ub(i+1,this.length))}return this},simplify:function(a){a=a||3;for(var d=new Ba(this.allowCull),b=null,e=this.length;e--;){var g=this[e];if(include=!b||e===0||ea(g.x-b.x)+ea(g.y-b.y)>
a){d.unshift(g);b=g}}return d}});ma.prototype=K(new ba,{constructor:ma,pos:function(){return mb(this.mercX,this.mercY)},sync:function(a,d){var b;if(!(b=a.rpp)){b=a.zoom();b=A/(256<<b)}b=b;if(d){this.mercX=this.x*b-Math.PI;this.mercY=Math.PI-this.y*b}else{this.x=cb(((this.mercX||0)+Math.PI)/b);this.y=cb((Math.PI-(this.mercY||0))/b)}return this}});ta.prototype={constructor:ta,buffer:function(a,d){return new ta(this.x-a,this.y-(d||a),this.w+a*2,this.h+(d||a)*2)},center:function(){return new ba(this.x+
(this.w>>1),this.y+(this.h>>1))}};Hits=function(){return{diffHits:function(a,d){var b=[],e={},g;for(g=d.length;g--;)e[d[g].target.id]=true;for(g=a.length;g--;)e[a[g].target.id]||(b[b.length]=a[g]);return b},init:function(a,d,b,e,g){return{type:a,x:g.x,y:g.y,gridX:e.x|0,gridY:e.y|0,elements:[],absXY:d,relXY:b}},initHit:function(a,d,b){return{type:a,target:d,drag:b}},triggerEvent:function(a,d,b,e){d.triggerCustom(a.type+(b?b:"Hit"),{hitType:a.type},e?e:a.elements,a.absXY,a.relXY,new ma(a.gridX,a.gridY))}}}();
var tb=function(a){function d(i,f){var l=b[i],c;l||(l=b[i]=[]);(c=l[f])||(c=l[f]=[]);return c}a=a||128;var b=[],e={},g=0;return{copyInto:function(i){for(var f in e){var l=e[f];i.insert(l.bounds||l,l,f)}},insert:function(i,f,l){var c=i.x/a|0,j=i.y/a|0,k=(i.x+i.w)/a|0;i=(i.y+i.h)/a|0;l=l||f.id||"obj_"+g++;e[l]=f;for(f=c;f<=k;f++)for(c=j;c<=i;c++)d(f,c).push(l)},remove:function(i,f,l){l=l||f.id;if(e[l]){var c=i.x/a|0;f=i.y/a|0;var j=(i.x+i.w)/a|0;i=(i.y+i.h)/a|0;delete e[l];for(c=c;c<=j;c++)for(var k=
f;k<=i;k++){var h=d(c,k),n=Na.call(h,l);n>=0&&h.splice(n,1)}}},search:function(i){var f=i.y/a|0,l=(i.x+i.w)/a|0,c=(i.y+i.h)/a|0,j=[],k=[];for(i=i.x/a|0;i<=l;i++)for(var h=f;h<=c;h++)j=j.concat(d(i,h));j.sort();for(f=j.length;f--;){l=j[f];if(c=e[l])k[k.length]=c;for(;f>0&&j[f-1]==l;)f--}return k}}},fb=function(){var a={},d=0;(new Date).getTime();var b={},e=[];Qa.attach(function(g){g=g||(new Date).getTime();for(var i=0;i<e.length;){var f=e[i],l=b[f],c=b[f].image&&b[f].image.complete&&b[f].image.width>
0,j=g-l.start;j=c||j>=3E4;if(c){c=l.callbacks;a[f]=l.image;for(var k=0;k<c.length;k++)c[k](l.image,true)}if(j){e.splice(i,1);delete b[f]}else i++}},250);return function(g,i){var f=g&&i?a[g]:null;if(f&&f&&f.complete&&f.width>0)i(f);else if(f=b[g])f.callbacks.push(i);else{f=new Image;f.id="_ldimg"+ ++d;b[g]={start:(new Date).getTime(),image:f,callbacks:[i]};f.src=g;e[e.length]=g}}}();na.prototype={constructor:na,load:function(a){var d=this;fb(this.url,function(b){d.loaded=true;d.image=b;a&&a()})}};
var Kb=function(){return pa({fastpan:true,applyStyle:function(){},applyTransform:function(a,d,b){return{restore:null,x:d,y:b}},getDimensions:function(){return{width:0,height:0}},getViewport:function(){},hitTest:function(){return false},prepare:function(){},projectXY:null,reset:function(){}})};ua("renderer","canvas",function(a,d,b,e,g){function i(){function m(r,D){this.save();this.setTransform(1,0,0,1,0,0);var z=this.isPointInPath_old(r,D);this.restore();return z}var u=CanvasRenderingContext2D.prototype,
s=document.createElement("canvas").getContext("2d");s.translate(50,0);s.moveTo(125,50);s.arc(100,50,25,0,360,false);if(!s.isPointInPath(150,50)){u.isPointInPath_old=u.isPointInPath;u.isPointInPath=m}}function f(m,u,s){var r,D;q[u]=function(z){for(r=I.length;r--;)if(D=s[I[r]])z[x[r]]=D}}function l(m,u,s){return{draw:s||v,viewport:m,hit:u&&h.isPointInPath(u.x,u.y),vpX:n,vpY:o,context:h}}e=K({},e);var c,j,k,h,n=0,o=0,q={},B=null,H={},T=function(){},v=function(){this.fill&&h.fill();this.stroke&&h.stroke()},
I=["fill","stroke","lineWidth","opacity"],x=["fillStyle","strokeStyle","lineWidth","globalAlpha"];aa&&i();if(d){c=d.offsetWidth;j=d.offsetHeight;k=aa?aa.create("canvas",null,{position:"absolute","z-index":1}):new Canvas;k.width=c;k.height=j;a.attachFrame(k,true);h=null}b=K(g,{applyStyle:function(m){var u=q[m],s=h&&h.canvas?h.canvas.id:"default",r;H[s]||(H[s]=[]);r=H[s].pop()||"reset";if(u){H[s].push(m);u(h);return r}},applyTransform:function(m){if(m.translateX!==0||m.translateY!==0||m.scaling!==1||
m.rotation!==0){h.save();B={undo:function(){h.restore();B=null},x:m.xy.x,y:m.xy.y};h.translate(m.xy.x-n+m.translateX,m.xy.y-o+m.translateY);m.rotation!==0&&h.rotate(m.rotation);m.scaling!==1&&h.scale(m.scaling,m.scaling)}return B},drawTiles:function(m,u,s){for(var r=u.length;r--;){m=u[r];if(!m.loaded&&s)m.load(a.invalidate);else m.image&&h.drawImage(m.image,m.x-n,m.y-o)}},prepare:function(m,u){var s,r=false;if(h)h.restore();else if(k)h=k.getContext("2d");for(s=m.length;s--;)r=r||m[s].clip;n=u.x;o=
u.y;if(h){r||h.clearRect(0,0,c,j);h.save();h.globalCompositeOperation="source-over"}return h},prepArc:function(m,u,s){h.beginPath();h.arc(m.xy.x-(B?B.x:n),m.xy.y-(B?B.y:o),m.size>>1,m.startAngle,m.endAngle,false);return l(u,s)},prepImage:function(m,u,s,r){var D=(r.x||m.xy.x)-(B?B.x:n),z=(r.y||m.xy.y)-(B?B.y:o),C=r.image||m.image;if(C){h.beginPath();h.rect(D,z,r.width||C.width,r.height||C.height);return l(u,s,function(){h.drawImage(C,D,z,r.width||C.width,r.height||C.height)})}},prepMarker:function(m,
u,s){var r=m.xy.x-(B?B.x:n),D=m.xy.y-(B?B.y:o),z=m.size,C=undefined;h.beginPath();switch(m.markerType.toLowerCase()){case "image":C=T;h.rect(r-(z>>1),D-(z>>1),z,z);if(m.reset&&m.image){m.image=null;m.reset=false}m.image?h.drawImage(m.image,r-(z>>1),D-(z>>1),z,z):fb(m.imageUrl,function(M){m.image=M;h.drawImage(m.image,r-(z>>1),D-(z>>1),z,z)});break;default:h.moveTo(r,D);h.lineTo(r-(z>>1),D-z);h.lineTo(r+(z>>1),D-z);h.lineTo(r,D)}return l(u,s,C)},prepPoly:function(m,u,s,r){var D=true;m=r.points||m.points().cull(u);
r=B?B.x:n;var z=B?B.y:o;h.beginPath();for(var C=m.length;C--;){var M=m[C].x-r,V=m[C].y-z;if(D){h.moveTo(M,V);D=false}else h.lineTo(M,V)}return l(u,s)},getContext:function(){return h}});(function(){wb.each(function(m,u){f(null,m,u)});U.bind("styleDefined",f)})();b.bind("detach",function(){d.removeChild(k)});b.bind("resize",function(){});return b});ua("renderer","dom",function(a,d,b,e,g){function i(k){var h=k.image=new Image;c[k.id]=k;h.src=k.url;h.onload=function(){if(j[k.id])l.appendChild(this);else k.image=
null};h.style.cssText="-webkit-user-select: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute;";return h}function f(k,h,n){var o=[],q;for(q in k){var B=k[q];if(n?B[n]:
!h[q]){if(B.image&&B.image.parentNode){l.removeChild(B.image);B.image=null}o[o.length]=q}}for(h=o.length;h--;)delete k[o[h]]}var l=null,c={},j={};l=aa.create("div","",aa.styles({width:d.offsetWidth+"px",height:d.offsetHeight+"px"}));d.childNodes.length>0?d.insertBefore(l,d.childNodes[0]):d.appendChild(l);a.attachFrame(l);b=K(g,{drawTiles:function(k,h,n){for(var o,q=k.x,B=k.y,H=h.length;H--;){k=h[H];if(k.url){(o=k.image||(n?i(k):null))&&aa.move(o,k.x-q,k.y-B);j[k.id]=k}}}});b.bind("predraw",function(){f(c,
j);j={}});b.bind("detach",function(){d.removeChild(l)});a.bind("reset",function(){for(f(c,j={});l.childNodes.length>0;)l.removeChild(l.childNodes[0])});return b});var wb=function(){function a(b,e){if(Z(b,Ca)){U.trigger("styleDefined",b,d[b]=e);return b}else{var g=[],i;for(i in b)g[g.length]=a(i,b[i]);return g}}var d={};a({reset:{fill:"#ffffff",opacity:1},highlight:{fill:"#ff0000"},waypoints:{lineWidth:4,stroke:"#003377",fill:"#ffffff"},waypointsHover:{lineWidth:4,stroke:"#ff0000",fill:"#ffffff"}});
return{resetStyle:"reset",each:function(b){for(var e in d)b(e,d[e])},get:function(b){return d[b]},define:a}}(),Eb=function(a,d){function b(t,w,y,O,X){if(!Ha)if(X==="wheel"){clearTimeout(xb);xb=setTimeout(function(){m(O>0?2:0.5,r?yb:false,true,r?e(y.x,y.y):null)},200)}else{t=r?db(da+Fa(2,O)-1,0.125):O>0?2:0.5;m(t,false,true,e(y.x,y.y))}}function e(t,w){var y=ga&&ga.projectXY?ga.projectXY(t,w):null;if(!y){y=v();y=new R.XY(y?y.x+(t+y.padding.x)/da:t,y?y.y+(w+y.padding.y)/da:w)}return y.sync(R,true)}
function g(t,w,y){t=e(y.x,y.y);R.trigger("doubleTap",w,y,t);d.scalable&&m(2,yb,true,t)}function i(t,w,y){L=null;J=true;H("down",w,y)}function f(t,w,y){H("hover",w,y)}function l(t,w,y,O){o(w,y,false);if(!L){Q+=O.x;N+=O.y}}function c(t,w,y){o(w,y,true);J=false}function j(){clearTimeout(zb);zb=setTimeout(function(){if(G)if(G.offsetWidth!==Va*2||G.offsetHeight!==Wa*2){var t=T();B(a);T(t.x,t.y)}},250)}function k(t,w,y){H("tap",w,y);R.trigger("tap",w,y,e(y.x,y.y,true))}function h(){qa&&qa.unbind();if(aa&&
ga){qa=INTERACT.watch(ga.interactTarget||G);if(d.scalable){qa.bind("zoom",b);qa.bind("doubleTap",g)}qa.bind("pointerDown",i);qa.bind("pointerMove",l);qa.bind("pointerUp",c);d.captureHover&&qa.bind("pointerHover",f);qa.bind("tap",k)}}function n(t){if(ga){ga.trigger("detach");ga=null}var w=R,y=V,O=G,X=d;t=t.split("/");for(var ka=new Kb(w,y,O,X),xa=0;xa<t.length;xa++)ka=Pa("renderer",t[xa],w,y,O,X,ka);ga=ka;ca=aa&&ga.fastpan&&aa.transforms;r=aa&&aa.transforms&&d.useTransforms;h();R.trigger("reset");
x()}function o(t,w,y){if(L){t=e(w.x,w.y);L.drag.call(L.target,L,t.x,t.y,y)&&la++;if(y)L=null}}function q(t){for(var w=M;w--;)if(C[w].id===t)return w;return M}function B(t){if(aa){G=document.getElementById(t);G.appendChild(P=aa.create("div","",aa.styles({overflow:"hidden",width:G.offsetWidth+"px",height:G.offsetHeight+"px"})));t=d.padding;if(t===s){t=G.offsetWidth;var w=G.offsetHeight,y=Hb(t*t+w*w);ra=new ba(y-t>>1,y-w>>1)}else ra=new ba(t,t);gb=P.offsetWidth+ra.x*2;hb=P.offsetHeight+ra.y*2;nb=gb/
2;ob=hb/2;Va=G.offsetWidth/2;Wa=G.offsetHeight/2;Xa=new ba(nb,ob);P.appendChild(V=aa.create("div","",aa.styles({width:gb+"px",height:hb+"px","z-index":2,margin:-ra.y+"px 0 0 "+-ra.x+"px"})));n(d.renderer);t=d.controls;for(w=0;w<z.length;w++)z[w].trigger("detach");z=[];for(w=0;w<t.length;w++)z[z.length]=Pa("control",t[w],R,P,G,d[t[w]])}else n("canvas")}function H(t,w,y){var O=(new ba(y.x-Va+nb,y.y-Wa+ob)).rotate(-va*F,Xa).scale(1/da,Xa);oa=Hits.init(t,w,y,e(y.x,y.y,true),O);W=false;for(t=M;t--;)if(C[t].visible)W=
W||(C[t].hitGuess?C[t].hitGuess(oa.gridX,oa.gridY,R):false);W&&la++}function T(t,w,y){if(typeof t!="undefined"&&(Z(t,Ca)||Z(t,"object"))){w=new R.XY(t);w.sync(R);t=w.x;w=w.y}if(Z(t,Da)){u(t-Va-ra.x,w-Wa-ra.y,y);return R}else return u().offset(Va+ra.x|0,Wa+ra.y|0).sync(R,true)}function v(){var t=new ta(Y,$,gb,hb);t.scaleFactor=da;t.padding=ra?ra.copy():new ba;return t}function I(t,w,y){if(Z(t,Ca)&&Z(w,Ga))for(w=0;w<M;w++){if(C[w].id===t)return C[w]}else if(Z(t,Ca)){w=Pa("layer",w,R,y);y=q(t);y!==M&&
R.trigger("layerRemove",C[y]);w.added=(new Date).getTime();w.id=t;C[y]=w;C.sort(function(O,X){return X.zindex-O.zindex||X.added-O.added});M=C.length;R.trigger("resync");x();R.trigger("layerChange",R,w);la++;return w}else return[].concat(C)}function x(){var t=v();if(t){if(Ra||Sa)if(t){var w=ib?Y+(t.w>>1):Y,y=jb?$+(t.h>>1):$,O=t.w,X=t.h;if(Ra&&Ra>O)if(w+O>Ra)Y=ib?Y:Ra-O;else if(w<0)Y=ib?Y:0;if(Sa&&Sa>X)if(y+X>Sa)$=jb?$:Sa-X;else if(y<0)$=jb?$:0}Ab=Y;Bb=$;R.trigger("refresh",R,t);la++}}function m(t,
w,y,O){if(Z(t,Da)){var X=y?t:da*t;if(!r){w=undefined;t=cb(lb(X)/Math.LN2);X=Fa(2,t)}if(O){t=R.center();u(Y+O.x-t.x,$+O.y-t.y,w)}if(w){kb=da;Ha=ya.tween([da],[X],w,function(){da=X;kb=Ha=null;la++})}else{da=X;la++}return R}else return da}function u(t,w,y){if(Z(t,Da)){if(y)za=ya.tween([Y,$],[t,w],y,function(){Y=t|0;$=w|0;wa=Ia=0;za=null;la++});else{Y=t|0;$=w|0;la++}return R}else return(new R.XY(Y,$)).sync(R,true)}d=K({captureHover:true,controls:[],drawOnScale:true,padding:128,inertia:true,refreshDistance:128,
pannable:true,scalable:true,renderer:"canvas",useTransforms:true},d);var s="auto",r=true,D=false,z=[],C=[],M=0,V=null,P=null,G,L=null,W=false,ca,J=false,Q=0,N=0,ha=d.refreshDistance,Y=0,$=0,wa=0,Ia=0,Ab=0,Bb=0,Ra=null,Sa=null,ib=false,jb=false,za=null,ra,oa=null,Ya=null,ga,zb=0,Xa=new ba,va=0,Za=null,da=1,kb,Ha=null,pb=1,qa=null,qb={index:0,draw:false},yb={easing:"sine.out",duration:500},la=0,gb,hb,nb,ob,Va,Wa,xb=0,R={XY:ba,id:d.id,panSpeed:0,attachFrame:function(t,w){w&&V.appendChild(t)},center:T,
detach:function(){ga&&ga.trigger("detach");qa&&qa.unbind();if(P){G.removeChild(P);V=P=null}},frozen:function(t){if(Z(t,Ga))return D;else{D=t;return R}},layer:I,invalidate:function(){la++},pan:function(t,w,y){return u(Y+t,$+w,y)},refresh:x,rotate:function(t,w,y){if(Z(t,Da)){var O=y?t:va+t;if(w)Za=ya.tween([va],[O],w,function(){va=O%360;Za=null;la++});else{va=O%360;la++}return R}else return va},scale:m,setMaxOffset:function(t,w,y,O){Ra=t;Sa=w;ib=y;jb=O},offset:u,viewport:v};pa(R);R.bind("resize",j);
R.bind("layerRemove",function(t,w){var y=Na(C,w.id);if(y>=0&&y<M){C.splice(y,1);la++}M=C.length});Ta(R,d,{container:B,captureHover:h,scalable:h,pannable:h,renderer:n});I("markers","draw",{zindex:20});B(a);if(aa&&!Z(window.attachEvent,Ga))window.attachEvent("onresize",j);else aa&&window.addEventListener("resize",j,false);Qa.attach(function(t){var w=[],y,O,X;if(!D){R.panSpeed=panSpeed=ea(Q)+ea(N);(y=da!==pb)&&R.trigger("scale");if(panSpeed>0||y||za||Ha||Za){la++;if(za&&panSpeed>0){za(true);za=null}}if(!J&&
panSpeed<=0&&(ea(Y-Ab)>=ha||ea($-Bb)>=ha))x();qb.index++;qb.draw=la||panSpeed||0;if(ga&&qb.draw){if(Ha)da=Ha()[0];if(Za)va=Za()[0];wa+=Q;Ia+=N;if(Q||N)R.trigger("pan");if(r){if(da!==1)w[w.length]="scale("+da+")";if(va!==0)w[w.length]="rotate("+va+"deg)"}y=W||!ca||!J&&!za&&!Ha&&(d.drawOnScale||da===1)&&panSpeed<=2;if(za){O=za();X=1;if(kb)X=da/kb;wa=(Y-O[0]|0)*X;Ia=($-O[1]|0)*X}if(y){O=-va*F;y=eb(O)*wa+-Oa(O)*Ia;O=Oa(O)*wa+eb(O)*Ia;Y=Y-y/da|0;$=$-O/da|0;X=v();ga.trigger("predraw",X);if(ga.prepare(C,
X,t,oa)){O=Ia=y=wa=la=0;for(ii=M;ii--;){var ka=C[ii];if(ka.visible){var xa=ka.style?ga.applyStyle(ka.style,true):null;ka.draw(ga,X,R,t,oa);xa&&ga.applyStyle(xa)}}ga.trigger("render",X);R.trigger("drawComplete",X,t);aa.move(V,y,O,w,Xa)}}else aa.move(V,wa,Ia,w,Xa);if(J||!d.inertia)N=Q=0;else if(Q!=0||N!=0){Q*=0.8;N*=0.8;if(ea(Q)<0.5)Q=0;if(ea(N)<0.5)N=0}if(oa){t=true;w=oa?oa.elements:[];if(Ya&&Ya.type==="hover"){diffElements=Hits.diffHits(Ya.elements,w);if(diffElements.length>0)Hits.triggerEvent(Ya,
R,"Out",diffElements);else t=false}if(w.length>0){O=oa.gridX;X=oa.gridY;for(y=w.length;J&&y--;){ka=w[y];xa=O;var Cb=X,Db=ka&&ka.drag&&(!ka.canDrag||ka.canDrag(ka,xa,Cb));if(Db){L=ka;L.startX=xa;L.startY=Cb}if(Db)break}t&&Hits.triggerEvent(oa,R)}Ya=w.length>0?K({},oa):null;oa=null}if(pb!==da){R.trigger("scaleChanged",da);pb=da}}}});return R},ya=function(){return{tween:function(a,d,b,e,g){function i(q){var B=q-o;q=o+n<=q;for(var H=f;H--;)l[H]=j(B,a[H],k[H],n);g&&g.invalidate();if(q||h){Qa.detach(i);
for(H=0;H<c.length;H++)c[H]&&c[H](l,B,h)}}b=K({easing:"sine.out",duration:1E3,complete:null},b);var f=a.length,l=[].concat(a),c=[e,b.complete],j=ab(b.easing),k=[],h=false,n=b.duration,o=(new Date).getTime();for(b=f;b--;)k[b]=d[b]-a[b];Qa.attach(i);return function(q){h=q;return l}},tweenDrawable:function(a,d,b,e,g){var i=ya.tween([b],[e],g,function(){a[d]=e;for(var l=a.tweens.length;l--;)if(a.tweens[l]===f){a.tweens.splice(l,1);break}},a.view),f=function(){a[d]=i()[0]};return f}}}(),Ja=function(a,
d,b){b=K({style:null,xy:null,size:20,fill:false,stroke:true,draggable:false,observable:true,properties:{},typeName:"Shape",zindex:0},b);K(this,b);if(Z(this.xy,Ca))this.xy=new a.XY(this.xy);this.id="drawable_"+Jb++;this.bounds=null;this.view=a;this.layer=d;this.tweens=[];this.rotation=this.animations=0;this.scaling=1;this.translateY=this.translateX=0;this.observable&&pa(this)};Ja.prototype={constructor:Ja,applyTweens:function(){for(var a=this.tweens.length;a--;)this.tweens[a]()},drag:null,draw:null,
getProps:null,resync:function(){if(this.xy){this.xy.sync(this.view);if(this.size){var a=this.size>>1;this.updateBounds(new ta(this.xy.x-a,this.xy.y-a,this.size,this.size))}}},rotate:function(a,d,b){if(Z(a,Da)){a=(b?a:this.rotation*S+a)*F;if(d)this.tweens.push(ya.tweenDrawable(this,"rotation",this.rotation,a,d));else{this.rotation=a;this.view.invalidate()}return this}else return this.rotation*S},scale:function(a,d,b){if(Z(a,Da)){a=b?a:this.scaling*a;if(d)this.tweens.push(ya.tweenDrawable(this,"scaling",
this.scaling,a,d));else{this.scaling=a;this.view.invalidate()}return this}else return this.scaling},translate:function(a,d,b,e){if(Z(a,Da)){a=e?a:this.translateX+a;d=e?d:this.translateY+d;if(b){this.tweens.push(ya.tweenDrawable(this,"translateX",this.translateX,a,b));this.tweens.push(ya.tweenDrawable(this,"translateY",this.translateY,d,b))}else{this.translateX=a;this.translateY=d;this.view.invalidate()}return this}else return new ba(this.translateX,this.translateY)},updateBounds:function(a,d){a&&
(!this.bounds||a.x!=this.bounds.x||a.y!=this.bounds.y)&&this.trigger("move",this,a,this.bounds);this.bounds=a;if(d)this.xy=this.bounds.center()}};ua("drawable","marker",function(a,d,b){b=K({fill:true,stroke:false,markerType:"simple",hoverStyle:"highlight",typeName:"Marker"},b);return new Ja(a,d,b)});ua("drawable","poly",function(a,d,b){function e(){var k,h,n,o,q,B,H;c=b.simplify?l.simplify():l;for(k=c.length;k--;){h=c[k].x;n=c[k].y;B=Z(B,Ga)||h<B?h:B;H=Z(H,Ga)||n<H?n:H;o=Z(o,Ga)||h>o?h:o;q=Z(q,Ga)||
n>q?n:q}j.updateBounds(new ta(B,H,o-B,q-H),true);j.trigger("pointsUpdate",j,c);a.invalidate()}function g(k){if(Z(k,"array")){l=new Ba(b.allowCull);vb.process(k,function(h,n){for(var o=0;o<n;o++)l.push(new a.XY(h[o]))},i,f);return j}else return c}function i(){l.length&&vb.process(l,function(k,h){for(var n=h;n--;)k[n].sync(a)},e,f)}b=K({allowCull:false,simplify:false,fill:true,points:[],typeName:"Poly"},b);var f=500,l=new Ba(b.allowCull),c=[],j=K(new Ja(a,d,b),{points:g,resync:i});g(b.points);return j});
ua("drawable","line",function(a,d,b){b.fill=false;b.allowCull=true;return Pa("drawable","poly",a,d,b)});ua("drawable","image",function(a,d,b){function e(){if(c&&c.width>0){if(!this.centerOffset)this.centerOffset=new ba(-c.width>>1,-c.height>>1);this.updateBounds(new ta(this.xy.x+this.centerOffset.x,this.xy.y+this.centerOffset.y,c.width,c.height),false)}}function g(k){if(this.imageUrl=k){var h=this;fb(this.imageUrl,function(n,o){c=n;if(o){var q=j.layer?j.layer.view:null;q&&q.invalidate()}e.apply(h)})}}
b=K({image:null,imageUrl:null,centerOffset:null,typeName:"Image"},b);var i=Ja.prototype.resync,f=0,l=0,c=b.image,j=K(new Ja(a,d,b),{changeImage:g,getProps:function(){this.bounds||e(this,c);return{image:c,x:this.xy.x+f,y:this.xy.y+l}},resync:function(k){i.call(this,k);e.call(this)}});c||g.call(this,this.imageUrl);if(this.centerOffset){f=this.centerOffset.x;l=this.centerOffset.y}});ua("drawable","arc",function(a,d,b){b=K({startAngle:0,endAngle:Math.PI*2,typeName:"Arc"},b);return new Ja(a,d,b)});Aa.prototype=
{constructor:Aa,clip:null,cycle:function(){},draw:function(){},hitGuess:null,remove:function(){this.view.trigger("layerRemove",this)}};ua("layer","tile",function(a,d){d=K({generator:"osm",imageLoadArgs:{}},d);var b=Pa("generator",d.generator,d).run,e=null,g=[],i=K(new Aa(a,d),{draw:function(f,l,c){f.drawTiles&&f.drawTiles(l,e.search(l.buffer(128)),c.panSpeed<2)}});a.bind("resync",function(){var f=a&&a.zoom?a.zoom():0;g[f]||(g[f]=fa(f));e=g[f]});a.bind("refresh",function(f,l,c){e&&b(l,c,e,function(){l.invalidate()})});
return i});ua("layer","draw",function(a,d){function b(c,j,k,h){var n=this.dragOffset;if(!n)n=this.dragOffset=new a.XY(c.startX-this.xy.x,c.startY-this.xy.y);this.xy.x=j-n.x;this.xy.y=k-n.y;if(h){delete this.dragOffset;a.invalidate();this.xy.sync(a,true);this.trigger("dragDrop")}return true}function e(c,j,k,h){if(i){h&&i.remove(h,j);i.insert(k,j)}}d=K({zindex:10},d);var g=[],i,f,l=K(new Aa(a,d),{itemCount:0,clear:function(){i=new tb;g=[];l.trigger("cleared");l.itemCount=0;a.invalidate()},create:function(c,
j,k){j=Pa("drawable",c,a,l,j);if(k)g.unshift(j);else g[g.length]=j;j.resync();i&&j.bounds&&i.insert(j.bounds,j);j.bind("move",e);l.itemCount=g.length;l.trigger(c+"Added",j);return j},draw:function(c,j,k,h,n){k={};h=i&&j?i.search(j):[];for(var o=h.length;o--;){var q=h[o],B=q.style||l.style,H,T,v=q.getProps?q.getProps(c):k;H=c["prep"+q.typeName];q.tweens.length>0&&q.applyTweens();T=c.applyTransform(q);if(v=H?H.call(c,q,j,n,v):null){if(n&&v.hit){n.elements.push(Hits.initHit(q.type,q,q.draggable?b:null));
H=n.type+"Style";B=q[H]||l[H]||B}B=B?c.applyStyle(B,true):null;(H=q.draw||v.draw)&&H.call(q,v);B&&c.applyStyle(B)}T&&T.undo&&T.undo()}},find:function(){return[].concat(g)},hitGuess:function(c,j){return i&&i.search({x:c-10,y:j-10,w:20,h:20}).length>0}});f=a.bind("resync",function(){i=fa(a.zoom(),i);for(var c=g.length;c--;)g[c].resync()});a.bind("layerRemove",function(c,j){if(j===l){i=null;g=[];a.unbind("resync",f)}});return l});Ma.prototype={constructor:Ma};ua("control","zoombar",function(a,d,b,e){function g(s,
r){var D=I[s]=aa.create("div","t5-zoombar-button",{position:"absolute",background:i(s),"z-index":51,width:e.width+"px",height:e.buttonHeight+"px","margin-top":(r||0)+"px"});x.appendChild(D)}function i(s,r){return"url("+e.images+") 0 -"+(h+o*3+(s||0)*j*3+(r||0)*j)+"px"}function f(s){return"url("+e.images+") 0 -"+(h+(s||0)*o)+"px"}function l(s,r){var D;if(s===n){n.style.background=f(r);D="thumb"}else for(var z=0;z<I.length;z++)if(s===I[z]){D="button"+z;I[z].style.background=i(z,r);break}return D}function c(s){if(s!==
T){T=s;H=B-T/v*(B-q)|0;aa.move(n,0,H-q);clearTimeout(m);m=setTimeout(function(){a.zoom(T)},500)}}e=K({width:24,height:200,images:"img/zoom.png",align:"right",marginTop:10,spacing:10,thumbHeight:16,buttonHeight:16},e);var j=e.buttonHeight,k,h=e.height,n,o=e.thumbHeight,q=e.spacing+j-(o>>1),B=e.height-j-(o>>1),H=q,T=-1;d=a.minZoom();var v=a.maxZoom()-d+1,I=[],x,m=0,u={button0:function(){a.zoom(a.zoom()+1)},button1:function(){a.zoom(a.zoom()-1)}};x=aa.create("div","t5-zoombar",{position:"absolute",background:"url("+
e.images+")","z-index":50,overflow:"hidden",width:e.width+"px",height:e.height+"px",margin:function(){var s=e.spacing,r=ja("{0}px 0 0 {1}px");if(e.align==="right")s=b.offsetWidth-e.width-e.spacing;return r(e.marginTop,s)}()});b.childNodes[0]?b.insertBefore(x,b.childNodes[0]):b.appendChild(x);x.appendChild(n=aa.create("div","t5-zoombar-thumb",{position:"absolute",background:f(),"z-index":51,width:e.width+"px",height:e.thumbHeight+"px",margin:"10px 0 0 0",top:H-q+"px"}));g(0);g(1,e.height-e.buttonHeight);
k=INTERACT.watch(x,{bindTarget:x});k.bind("pointerMove",function(s,r,D){H=Math.min(Math.max(q,D.y-(o>>1)),B);c(v-(H-q)/B*v|0)});k.bind("pointerDown",function(s){l(s.target,2)});k.bind("pointerUp",function(s){l(s.target,0)});k.bind("tap",function(s){(s=u[l(s.target,2)])&&s()});d=new Ma(a);d.bind("detach",function(){k.unbind();b.removeChild(x)});a.bind("zoom",function(s,r){c(r)});c(a.zoom());return d});K(U,{ex:K,log:sa,observable:pa,configurable:Ta,formatter:ja,wordExists:function(a,d){for(var b=a.split(/\s|\,/).length;b--;)if(a.toLowerCase()==
d.toLowerCase())return true;return false},is:Z,indexOf:Na,fn:function(a){return Ib("fn",a)},project:bb,unproject:mb,getImage:fb,userMessage:function(a,d,b){U.trigger("userMessage",a,d,b)},Registry:Ka,Style:wb,DOM:aa,Rect:ta,XY:ba,GeoXY:ma,Line:Ba,Hits:Hits,Control:Ma,Tile:na,Tweener:ya,View:Eb,Map:function(a,d){function b(j,k){var h=c.viewport();if(j){h=db(j.bestZoomLevel(h.w,h.h)-1,k||0);return e(h).center(j.center())}else return new GeoJS.BBox((new ma(h.x,h.y2)).sync(c,true).pos(),(new ma(h.x2,
h.y)).sync(c,true).pos())}function e(j,k,h){if(Z(j,Da)){j=db(d.minZoom,ub(d.maxZoom,j|0));if(j!==f){var n=c.viewport(),o=c.offset(),q=n.w/2;n=n.h/2;var B=Fa(2,j-f),H=q/B|0,T=n/B|0;f=j;c.offset(((k||o.x+q)-H)*B,((h||o.y+n)-T)*B);c.trigger("zoom",j);c.trigger("reset");i=c.rpp=A/(256<<f);c.setMaxOffset(A/i|0,A/i|0,true,false);c.scale(1,false,true);c.trigger("resync");c.refresh()}return c}else return f}d=K({controls:["zoombar"],minZoom:1,maxZoom:18,renderer:"canvas/dom",zoom:1,zoombar:{}},d);var g=new ma,
i,f=d.zoom||d.zoomLevel,l=0,c=K(new Eb(a,d),{XY:ma,bounds:b,zoom:e});i=c.rpp=A/(256<<f);c.bind("refresh",function(){var j=c.viewport();if(g.x!=j.x||g.y!=j.y){c.trigger("boundsChange",b());g.x=j.x;g.y=j.y}});c.bind("scaleChanged",function(j,k){var h=lb(k)/Math.LN2|0;if(h!==0){k=Fa(2,h);clearTimeout(l);l=setTimeout(function(){e(f+h)},500)}});return c}});if(typeof module!="undefined"&&module.exports)module.exports=U;U.Decarta=function(){function a(v){return n(f.clientName,f.clientPassword,f.sessionID,
f.configuration,f.release,v)}function d(v,I){return o(v.maxResponses,v.version,v.requestID,v.methodName,I)}function b(v,I){f.server||U.log("No server configured for deCarta - we are going to have issues","warn");return q(f.server,v.requestID,escape(I))}function e(v,I,x){sa("making request: "+a(d(v,v.getRequestBody())));$a(b(v,a(d(v,v.getRequestBody()))),function(m){console.log(m.response);var u=m.response.XLS.Response;if(u.numberOfResponses>0&&u[v.methodName+"Response"]){m=[];if(v.parseResponse)m=
v.parseResponse(u[v.methodName+"Response"]);I&&I.apply(null,m)}else x&&x("Server returned no responses",m.response)})}function g(v,I){var x=new B({json:v.StreetAddress}),m=[];if(v.Place){if(!v.Place.length)v.Place=[v.Place];for(var u=v.Place.length;u--;)m[m.length]=v.Place[u].content}return{building:x.building,street:x.street,regions:m,countryCode:v.countryCode||"",postalCode:v.PostalCode||"",pos:I}}function i(v){if(!v)return"";v=v.toUpperCase();if(!j){var I=[],x;for(x in k)I.push(x);j=RegExp("(\\s)("+
I.join("|")+")(\\s|$)","i")}j.lastIndex=-1;if(I=j.exec(v))v=v.replace(j,"$1"+k[I[2]]);return v}var f={sessionID:(new Date).getTime(),server:"",clientName:"",clientPassword:"",configuration:"",maxResponses:25,release:"4.4.2sp03",tileFormat:"PNG",fixedGrid:true,useCache:true,tileHosts:[],requestTimeout:3E4,geocoding:{countryCode:"US",language:"EN"}};TL=function(){function v(x,m){if(typeof x=="number"){this.days=x||0;this.seconds=m||0}else if(typeof x!="undefined"){this.days=x.days||0;this.seconds=x.seconds||
0}}v.prototype={add:function(){for(var x=new v(this.days,this.seconds),m=arguments.length;m--;){x.days+=arguments[m].days;x.seconds+=arguments[m].seconds}return x},toString:function(){var x,m,u,s="";if(this.days)s=this.days+" days ";if(this.seconds){u=this.seconds;if(u>=3600){x=~~(u/3600);u-=x*3600}if(u>=60){m=Math.round(u/60);u-=m*60}if(x)s=s+x+(x>1?" hrs ":" hr ")+(m?(m>10?m:"0"+m)+" min ":"");else if(m)s=s+m+" min";else if(u>0)s=s+(u>10?u:"0"+u)+" sec"}return s}};var I=function(){var x=/^P(\d+Y)?(\d+M)?(\d+D)?$/,
m=/^(\d+H)?(\d+M)?(\d+S)?$/,u={8601:function(s){s=s.split("T");var r=null;r=null;var D=0,z=0;x.lastIndex=-1;r=x.exec(s[0]);D+=r[3]?parseInt(r[3].slice(0,-1),10):0;m.lastIndex=-1;r=m.exec(s[1]);z+=r[1]?parseInt(r[1].slice(0,-1),10)*3600:0;z+=r[2]?parseInt(r[2].slice(0,-1),10)*60:0;z+=r[3]?parseInt(r[3].slice(0,-1),10):0;return new v(D,z)}};return function(s,r){var D=u[r];if(!D)throw"No parser found for the duration format: "+r;return D(s)}}();return{Duration:v,parse:I}}();var l=/^(\d+).*$/,c=/(\d+)\s?\-\s?(\d+)/,
j=null,k={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",HWY:"HIGHWAY",MWY:"MOTORWAY"},h=1,n=ja("<xls:XLS version='1' xls:lang='en' xmlns:xls='http://www.opengis.net/xls' rel='{4}' xmlns:gml='http://www.opengis.net/gml'><xls:RequestHeader clientName='{0}' clientPassword='{1}' sessionID='{2}' configuration='{3}' />{5}</xls:XLS>"),o=ja("<xls:Request maximumResponses='{0}' version='{1}' requestID='{2}' methodName='{3}Request'>{4}</xls:Request>"),q=ja("{0}/JSON?reqID={1}&chunkNo=1&numChunks=1&data={2}&responseFormat=JSON"),
B=function(v){v=U.ex({json:{}},v);var I="",x="";if(v.json.Street)I=v.json.Street.content?v.json.Street.content:v.json.Street;I=I&&I.replace?I.replace(/\/\d+$/,""):"";if(v.json.Building)if(v.json.Building.number)x=v.json.Building.number;return{building:x,street:I,calcMatchPercentage:function(m){var u=0,s=i(m),r=i(I);if(v.json.Building){a:{var D=v.json.Building.number.toString();l.lastIndex=-1;if(l.test(m)){m=m.replace(l,"$1");D=D.split(",");for(var z=0;z<D.length;z++){c.lastIndex=-1;if(c.test(D[z])){var C=
c.exec(D[z]);if(m>=parseInt(C[1],10)&&m<=parseInt(C[2],10)){m=true;break a}}else if(m==D[z]){m=true;break a}}}m=false}if(m)u+=0.2}if(s&&r&&U.wordExists(s,r))u+=0.8;return u},toString:function(){if(I)return(x?x+" ":"")+I;return""}}},H=function(){return{methodName:"",maxResponses:25,version:"1.0",requestID:h++,getRequestBody:function(){return""},parseResponse:function(v){return[v]}}},T=function(){return U.ex(new H,{methodName:"RUOK",parseResponse:function(v){return[{aliasCount:v.maxHostAliases,host:v.hostName}]}})};
U.Registry.register("generator","decarta",function(v){function I(u,s,r,D){if(u=u.zoom?u.zoom():0){var z=2<<u-1,C=z>>1,M=v.tileSize,V=(s.w/M|0)+1,P=(s.h/M|0)+1,G=(s.x/M|0)-C;s=z-(s.y/M|0)-C-P;var L=r.search({x:(C+G)*M,y:(C+s*-1-P)*M,w:V*M,h:P*M});z={};var W=m.hosts,ca;for(ca=L.length;ca--;)z[L[ca].id]=true;for(L=0;L<=V;L++)for(ca=0;ca<=P;ca++){var J=G+L,Q=s+ca-1,N=J+"_"+Q;if(!z[N]){J=new U.Tile((C+G+L)*M,(C+s*-1-ca)*M,W[L%W.length]+"/openls/image-cache/TILE?LLMIN=0.0,0.0&LLMAX="+x[u]+"&CACHEABLE=true&DS=navteq-world&WIDTH=256&HEIGHT=256&CLIENTNAME="+
m.clientName+"&SESSIONID="+m.sessionID+"&FORMAT=PNG&CONFIG="+m.configuration+"&N="+Q+"&E="+J,M,M,N);r.insert(J,J)}}D&&D()}}v=U.ex({tileSize:256},v);var x=["89.787438015348100000,360.00000000000000000","85.084059050110410000,180.00000000000000000","66.653475896509040000,90.00000000000000000","41.170427238429790000,45.000000000000000000","22.076741328793200000,22.500000000000000000","11.251819676168665000,11.250000000000000000","5.653589942659626000,5.625000000000000000","2.830287664051185000,2.812500000000000000",
"1.415581451872543800,1.406250000000000000","0.707845460801532700,0.703125000000000000","0.353929573271679340,0.351562500000000000","0.176965641673330230,0.175781250000000000","0.088482927761462040,0.087890625000000000","0.044241477246363230,0.043945312500000000","0.022120740293895182,0.021972656250000000","0.011060370355776452,0.010986328125000000","0.005530185203987857,0.005493164062500000","0.002765092605263539,0.002746582031250000","0.001382546303032519,0.001373291015625000","0.000691272945568983,0.000686645507812500",
"0.000345636472797214,0.000343322753906250"],m=f.tileConfig;U.userMessage("ack","decarta","&copy; deCarta, Inc. Map and Imagery Data &copy; NAVTEQ or Tele Atlas or DigitalGlobe");return{run:function(u,s,r,D){if(m)I(u,s,r,D);else{var z=f.clientName.replace(/.*?\:/,"");U.Decarta.getTileConfig(z,function(C){m=C;I(u,s,r,D)})}},setTileConfig:function(u){m=u}}});U.Registry.register("service","geocoder",function(){var v=U.formatter('<xls:GeocodeRequest><xls:Address countryCode="{0}" language="{1}">{2}</xls:Address></xls:GeocodeRequest>'),
I=U.formatter('<xls:StreetAddress><xls:Building number="{0}" /><xls:Street>{1}</xls:Street></xls:StreetAddress>'),x=function(u,s){s=U.ex({countryCode:f.geocoding.countryCode,language:f.geocoding.language},s);var r=new H;return U.ex({},r,{methodName:"Geocode",getRequestBody:function(){var D=I(u.number,u.street);D+='<xls:Place type="Municipality">'+u.regions.join(" ")+"</xls:Place>";return v(s.countryCode,s.language,D)},parseResponse:function(D){var z=D.GeocodeResponseList;D=[];var C=z?z.numberOfGeocodedAddresses:
0,M=[];if(C>1)M=z.GeocodedAddress;else if(C==1)M=[z.GeocodedAddress];for(z=0;M&&z<M.length;z++){C=M[z];var V=null,P=null;if(C&&C.GeocodeMatchCode&&C.GeocodeMatchCode.matchType!=="NO_MATCH"){if(C&&C.Point)P=new GeoJS.Pos(C.Point.pos);if(C&&C.Address)V=g(C.Address,P)}(C=V)&&D.push(C)}return[D]}})},m=function(u){u=U.ex({position:null,geocodePreference:"StreetAddress"},u);return U.ex(new H,{methodName:"ReverseGeocode",getRequestBody:function(){return"<xls:ReverseGeocodeRequest><xls:Position><gml:Point><gml:pos>"+
u.position.toString()+"</gml:pos></gml:Point></xls:Position><xls:ReverseGeocodePreference>"+u.geocodePreference+"</xls:ReverseGeocodePreference></xls:ReverseGeocodeRequest>"},parseResponse:function(s){var r=null;if(s&&s.Point)r=new GeoJS.Pos(match.Point.pos);if(s&&s.ReverseGeocodedLocation&&s.ReverseGeocodedLocation.Address)return[g(s.ReverseGeocodedLocation.Address,r)];return[]}})};typeof ADDR==="undefined"&&U.log("Sidelab addressing module not found, geocoder will not function","warn");return{forward:function(u,
s){e(new x(u),function(r){s(u,r)})},reverse:function(u,s){var r=new m({position:u});e(r,function(D){s&&s(D)})}}});U.Registry.register("service","routing",function(){var v=function(I,x){x=U.ex({provideRouteHandle:false,distanceUnit:"KM",routeQueryType:"RMAN",preference:"Fastest",routeInstructions:true,routeGeometry:true},x);var m=new H,u=U.formatter('<xls:DetermineRouteRequest provideRouteHandle="{0}" distanceUnit="{1}" routeQueryType="{2}">'),s=U.formatter("<xls:{0}><xls:Position><gml:Point><gml:pos>{1}</gml:pos></gml:Point></xls:Position></xls:{0}>");
return U.ex({},m,{methodName:"DetermineRoute",getRequestBody:function(){if(I.length<2)throw Error("Cannot send RouteRequest, less than 2 waypoints specified");var r=u(x.provideRouteHandle,x.distanceUnit,x.routeQueryType);r+="<xls:RoutePlan>";r+="<xls:RoutePreference>"+x.preference+"</xls:RoutePreference>";r+="<xls:WayPointList>";for(var D=0;D<I.length;D++)r+=s(D===0?"StartPoint":D===I.length-1?"EndPoint":"ViaPoint",I[D].toString());r+="</xls:WayPointList>";r+="</xls:RoutePlan>";if(x.routeInstructions)r+=
'<xls:RouteInstructionsRequest rules="maneuver-rules" providePoint="true" />';if(x.routeGeometry)r+="<xls:RouteGeometryRequest />";r+="</xls:DetermineRouteRequest>";return r},parseResponse:function(r){var D=r.RouteGeometry.LineString.pos,z=r.RouteInstructionsList;r=[];z=z&&z.RouteInstruction?z.RouteInstruction:[];for(var C=0;C<z.length;C++){var M=z[C].distance;r.push({text:z[C].Instruction,latlng:z[C].Point,distance:M.value+(M.uom||"M").toUpperCase(),time:TL.parse(z[C].duration,"8601")})}return[D,
r]}})};return{calculate:function(I,x,m,u){u=U.ex({preference:"Fastest"},u);I=new v(I,u);e(I,x,m)}}});return{applyConfig:function(v){U.ex(f,v)},getTileConfig:function(v,I){e(new T,function(x){var m=f.clientName.replace(/\:.*/,":"+(v||""));hosts=[];if(x.aliasCount)for(var u=0;u<x.aliasCount;u++)hosts[u]="http://"+x.host.replace("^(.*?).(.*)$","\u0001-0"+(u+1)+".\u0002");else hosts=["http://"+x.host];I({hosts:hosts,clientName:m,sessionID:f.sessionID,configuration:f.configuration})})},setTileConfig:function(v){f.tileConfig=
v},compareFns:function(){return{streetDetails:function(v,I){return I.calcMatchPercentage(v)},location:function(v,I){return I.calcMatchPercentage(v)}}}()}}()})();
