(function(){function R(o){o=o.split(",");for(var x=[],y=0;y<o.length;y++){var z=o[y].replace(ab,"$1").replace(Ta,"/");x[y]=pa[z]}return x}function La(o,x){for(var y=o.split(","),z=true,K=typeof $LAB!=="undefined"?$LAB:null,ba=0;ba<y.length;ba++){var ca=y[ba].replace(ab,"$1").replace(Ta,"/");if(!pa[ca]){z=false;Aa&&La("./plugins/"+pluginFile)}}if(x)if(Aa||z)x.apply(ma,R(o));else K&&$LAB.wait(function(){x.apply(ma,R(o))});return ma}function Y(o,x,y){if(o&&o.split){var z=o.split(Ua);if(z.length>1){o=
z[0];x=z[1]}}else if(o&&o.lat){x=o.lon;o=o.lat}this.lat=parseFloat(o||0);this.lon=parseFloat(x||0);this.radius=y||bb}function Va(o){this.positions=[];for(var x=o.length;x--;)this.positions[x]=typeof o[x]=="string"?new Y(o[x]):o[x]}function aa(o,x){if(o&&o.splice){for(var y=x,z=new Y(Ma,Wa),K=new Y($,W),ba=o.length;ba--;){var ca=typeof o[ba]=="string"?new Y(o[ba]):o[ba];if(ca){if(ca.lat<z.lat)z.lat=ca.lat;if(ca.lat>K.lat)K.lat=ca.lat;if(ca.lon<z.lon)z.lon=ca.lon;if(ca.lon>K.lon)K.lon=ca.lon}}this.min=
z;this.max=K;if(typeof y=="undefined"){y=this.size();y=Math.max(y.x,y.y)*0.3}this.min=new Y(z.lat-y,(z.lon-y)%360);this.max=new Y(K.lat+y,(K.lon+y)%360)}else if(o&&o.min){this.min=new Y(o.min);this.max=new Y(o.max)}else{this.min=o;this.max=x}}function wa(o){if(typeof o=="string"){var x=(o.replace(/\d|\.|\s/g,"")||"m").toLowerCase();o=parseFloat(o)*({km:1E3}[x]||1)}this.meters=o||0}function na(o,x){if(typeof o=="number"){this.days=o||0;this.seconds=x||0}else if(typeof o!="undefined"){this.days=o.days||
0;this.seconds=o.seconds||0}}var pa={},ab=/^(.*)\s+$/,Ta=/\./g,Ba=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],Aa=typeof module!="undefined"&&module.exports,cb=Math.PI*2,ib=Math.PI/2,da=Math.PI/180,sa=180/Math.PI,Ma=90,$=-Ma,Wa=180,W=-Wa,Ga=Ma*da,jb=-Ga,kb=Wa*da,oa=-kb,bb=6371,Ha=bb*1E3,Ua=/[\,\s]+/;Y.prototype={constructor:Y,bearing:function(o){var x=this.lat*da,y=o.lat*da;o=(o.lon-this.lon)*da;return(Math.atan2(Math.sin(o)*Math.cos(y),Math.cos(x)*Math.sin(y)-
Math.sin(x)*Math.cos(y)*Math.cos(o))*sa+360)%360},copy:function(){return new Y(this.lat,this.lon)},distanceTo:function(o){if(!o||this.empty()||o.empty())return 0;var x=(o.lat-this.lat)*da/2,y=(o.lon-this.lon)*da/2;o=Math.sin(x)*Math.sin(x)+Math.cos(this.lat*da)*Math.cos(o.lat*da)*Math.sin(y)*Math.sin(y);return this.radius*2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))},equalTo:function(o){return pos&&this.lat===o.lat&&this.lon===o.lon},empty:function(){return this.lat===0&&this.lon===0},inArray:function(o){if(o)for(var x=
o.length;x--;)if(this.equal(o[x]))return true;return false},offset:function(o,x){var y=this.lat*da,z=y+o/this.radius;y=this.lon*da+Math.asin(Math.sin(x/this.radius)/Math.cos(y));z=(z+ib)%Math.PI-ib;y%=cb;return new Y(z*sa,y*sa)},to:function(o,x){if(typeof o=="object")o=this.bearing(o);var y=x/this.radius,z=o*da,K=this.lat*da,ba=Math.asin(Math.sin(K)*Math.cos(y)+Math.cos(K)*Math.sin(y)*Math.cos(z));y=this.lon*da+Math.atan2(Math.sin(z)*Math.sin(y)*Math.cos(K),Math.cos(y)-Math.sin(K)*Math.sin(ba));y=
(y+3*Math.PI)%(2*Math.PI)-Math.PI;return new Y(ba*sa,y*sa)},toBounds:function(o){var x=o.radians(),y=this.lat*da,z=this.lon*da;o=y-x;var K=y+x;if(o>jb&&K<Ga){y=Math.asin(Math.sin(x)/Math.cos(y));x=z-y;if(x<oa)x+=cb;z=z+y;if(z>kb)z-=cb}else{o=Math.max(o,jb);K=Math.min(K,Ga);x=W;z=Wa}return new aa(new Y(o*sa,x*sa),new Y(K*sa,z*sa))},toString:function(o){return this.lat+(o||" ")+this.lon},valid:function(){return!(isNaN(this.lat)||isNaN(this.lon))}};Va.prototype={constructor:Va,distance:function(){for(var o=
0,x=[],y,z=this.positions.length-1;z--;){y=this.positions[z].distanceTo(this.positions[z+1]);o+=x[z]=y}return{total:o,segments:x}},traverse:function(o,x){var y=0,z=0;if(!x||!x.segments)x=this.distance();if(o>x.total)return this.positions[this.positions.length-1];else if(o<=0)return this.positions[0];else{for(;z<x.segments.length;){y+=x.segments[z];if(y>o){y-=x.segments[z];break}z++}if(z<this.positions.length-1){var K=this.positions[z];z=K.bearing(this.positions[z+1]);return K.to(z,o-y)}else return this.positions[z]}}};
aa.prototype={constructor:aa,bestZoomLevel:function(o,x){var y=this.center(),z=Ba[Math.min(Math.round(Math.abs(y.lat)*0.05),Ba.length)],K=this.size();y=Math.ceil(Math.log(Ba[3]*x/K.y)/Math.LN2);z=Math.ceil(Math.log(z*o/K.x)/Math.LN2);return Math.min(isNaN(y)?1E3:y,isNaN(z)?1E3:z)},center:function(){var o=this.size();return new Y(this.min.lat+o.y/2,this.min.lon+o.x/2)},expand:function(o){return new aa(new Y(this.min.lat-o,(this.min.lon-o)%360),new Y(this.max.lat+o,(this.max.lon+o)%360))},size:function(o){var x=
{x:0,y:this.max.lat-this.min.lat};x.x=typeof o!="undefined"&&o&&this.min.lon>this.max.lon?360-this.min.lon+this.max.lon:this.max.lon-this.min.lon;return x},toString:function(){return"min: "+this.min+", max: "+this.max},union:function(){for(var o=this.min.copy(),x=this.max.copy(),y=arguments.length;y--;)if(arguments[y]){var z=arguments[y].min,K=arguments[y].max;o.lat=Math.min(o.lat,z.lat);o.lon=Math.min(o.lon,z.lon);x.lat=Math.max(x.lat,K.lat);x.lon=Math.max(x.lon,K.lon)}return new aa(o,x)}};wa.prototype=
{add:function(){for(var o=this.meters,x=arguments.length;x--;){var y=typeof arguments[x]=="string"?new wa(arguments[x]):arguments[x];o+=y.meters}return new wa(o)},radians:function(o){if(typeof o!="undefined"){this.meters=o*Ha;return this}else return this.meters/Ha},toString:function(){if(this.meters>1E3)return(this.meters/10|0)/100+"km";return this.meters+"m"}};na.prototype={add:function(){for(var o=new na(this.days,this.seconds),x=arguments.length;x--;){o.days+=arguments[x].days;o.seconds+=arguments[x].seconds}return o},
toString:function(){var o,x,y,z="";if(this.days)z=this.days+" days ";if(this.seconds){y=this.seconds;if(y>=3600){o=~~(y/3600);y-=o*3600}if(y>=60){x=Math.round(y/60);y-=x*60}if(o)z=z+o+(o>1?" hrs ":" hr ")+(x?(x>10?x:"0"+x)+" min ":"");else if(x)z=z+x+" min";else if(y>0)z=z+(y>10?y:"0"+y)+" sec"}return z}};var Xa=function(){var o=/^P(\d+Y)?(\d+M)?(\d+D)?$/,x=/^(\d+H)?(\d+M)?(\d+S)?$/,y={8601:function(z){z=z.split("T");var K=null;K=null;var ba=0,ca=0;o.lastIndex=-1;K=o.exec(z[0]);ba+=K[3]?parseInt(K[3].slice(0,
-1),10):0;x.lastIndex=-1;K=x.exec(z[1]);ca+=K[1]?parseInt(K[1].slice(0,-1),10)*3600:0;ca+=K[2]?parseInt(K[2].slice(0,-1),10)*60:0;ca+=K[3]?parseInt(K[3].slice(0,-1),10):0;return new na(ba,ca)}};return function(z,K){var ba=y[K];if(!ba)throw"No parser found for the duration format: "+K;return ba(z)}}(),ma=this.GeoJS={Pos:Y,Line:Va,BBox:aa,Distance:wa,generalize:function(o,x,y){var z=o.length,K=[],ba=null;y=(y||250)/1E3;for(z=z;z--;)if(z===0)K.unshift(o[z]);else{var ca=!ba||o[z].inArray(x)?y:ba.distanceTo(o[z]);
if(o[z]&&ca>=y){K.unshift(o[z]);ba=o[z]}}return K},Duration:na,parseDuration:Xa,define:function(o,x){pa[o]=x},require:La};if(Aa)module.exports=ma})();
(function(){function R(){var a=arguments[0]||{},c=Array.prototype.slice.call(arguments,1),b=c.length,f,k;for(k=0;k<b;k++)if((f=c[k])!==null)for(var h in f){var e=f[h];if(a!==e)if(e!==undefined)a[h]=e}return a}function La(a,c){if(typeof console!=="undefined")console[c||"log"](a)}function Y(a){var c=a.match(cb),b=[],f=0,k;for(k=c?c.length:0;k--;){var h=c[k].slice(1);b[h]||(b[h]=RegExp("\\{"+h+"\\}","g"))}f=b.length;return function(){var e=a;for(k=0;k<f;k++){var l=arguments[k];if(typeof l=="undefined")l=
"";e=e.replace(b[k],l)}return e}}function Va(a,c){var b=Xa*ca(a);return bb-2*zb(c*z((1-b)/(1+b),Xa/2))}function aa(a,c){if($(a,Na)){var b=a.split(Ab);this.x=parseFloat(b[0]);this.y=parseFloat(b[1])}else if(a&&a.x){this.x=a.x;this.y=a.y}else{this.x=a||0;this.y=c||0}}function wa(a){this.allowCull=a;this.points=[]}function na(a,c,b,f){this.mercX=b;this.mercY=f;if($(a,Na))R(this,Nb.parseXY(a));else a&&a.toBounds?R(this,lb(a.lon,a.lat)):aa.call(this,a,c)}function pa(a,c,b,f){this.x=a||0;this.y=c||0;this.w=
b||0;this.h=f||0;this.x2=this.x+this.w;this.y2=this.y+this.h}function ab(a,c){var b=new Ob(Math.sqrt(256<<a)|0);c&&c.zoomLevel===a&&c.copyInto(b);b.zoomLevel=a;return b}function Ta(a,c,b,f,k,h){this.x=a;this.y=c;this.w=f||256;this.h=f||256;this.x2=this.x+this.w;this.y2=this.y+this.h;this.url=b;this.id=h||a+"_"+c;this.loaded=false;this.image=null}function Ba(a,c,b,f){f=R({id:"layer_"+Pb++,zindex:0,animated:false,style:null,minXY:null,maxXY:null,visible:true},f);this.visible=f.visible;this.view=a;da(R(this,
f))}function Aa(){da(this)}var cb=/\{(\d+)(?=\})/g,ib=function(){var a=1.70158,c=Math.PI/2,b=Math.abs,f=Math.pow,k=Math.sin,h=Math.asin,e=Math.cos,l={linear:function(d,i,g,j){return g*d/j+i},backin:function(d,i,g,j){return g*(d/=j)*d*((a+1)*d-a)+i},backout:function(d,i,g,j){return g*((d=d/j-1)*d*((a+1)*d+a)+1)+i},backinout:function(d,i,g,j){return(d/=j/2)<1?g/2*d*d*(((a*=1.525)+1)*d-a)+i:g/2*((d-=2)*d*(((a*=1.525)+1)*d+a)+2)+i},bouncein:function(d,i,g,j){return g-l.bounceout(j-d,0,g,j)+i},bounceout:function(d,
i,g,j){return(d/=j)<1/2.75?g*7.5625*d*d+i:d<2/2.75?g*(7.5625*(d-=1.5/2.75)*d+0.75)+i:d<2.5/2.75?g*(7.5625*(d-=2.25/2.75)*d+0.9375)+i:g*(7.5625*(d-=2.625/2.75)*d+0.984375)+i},bounceinout:function(d,i,g,j){return d<j/2?l.bouncein(d*2,0,g,j)/2+i:l.bounceout(d*2-j,0,g,j)/2+g/2+i},cubicin:function(d,i,g,j){return g*(d/=j)*d*d+i},cubicout:function(d,i,g,j){return g*((d=d/j-1)*d*d+1)+i},cubicinout:function(d,i,g,j){if((d/=j/2)<1)return g/2*d*d*d+i;return g/2*((d-=2)*d*d+2)+i},elasticin:function(d,i,g,j,
n,p){if(d==0)return i;if((d/=j)==1)return i+g;p||(p=j*0.3);if(!n||n<b(g)){n=g;g=p/4}else g=p/oa*h(g/n);return-(n*f(2,10*(d-=1))*k((d*j-g)*oa/p))+i},elasticout:function(d,i,g,j,n,p){var v;if(d==0)return i;if((d/=j)==1)return i+g;p||(p=j*0.3);if(!n||n<b(g)){n=g;v=p/4}else v=p/oa*h(g/n);return n*f(2,-10*d)*k((d*j-v)*oa/p)+g+i},elasticinout:function(d,i,g,j,n,p){var v;if(d==0)return i;if((d/=j/2)==2)return i+g;p||(p=j*0.3*1.5);if(!n||n<b(g)){n=g;v=p/4}else v=p/oa*h(g/n);if(d<1)return-0.5*n*f(2,10*(d-=
1))*k((d*j-v)*oa/p)+i;return n*f(2,-10*(d-=1))*k((d*j-v)*oa/p)*0.5+g+i},quadin:function(d,i,g,j){return g*(d/=j)*d+i},quadout:function(d,i,g,j){return-g*(d/=j)*(d-2)+i},quadinout:function(d,i,g,j){if((d/=j/2)<1)return g/2*d*d+i;return-g/2*(--d*(d-2)-1)+i},sinein:function(d,i,g,j){return-g*e(d/j*c)+g+i},sineout:function(d,i,g,j){return g*k(d/j*c)+i},sineinout:function(d,i,g,j){return-g/2*(e(Math.PI*d/j)-1)+i}};return function(d){d=d.replace(/[\-\_\s\.]/g,"").toLowerCase();return l[d]||l.linear}}(),
da=function(){function a(b,f){var k=b.hasOwnProperty("obsHandlers")?b.obsHandlers:null;k[f]||(k[f]=[]);return k[f]}var c=0;return function(b){if(!b)return null;if(!(b.hasOwnProperty("obsHandlers")?b.obsHandlers:null))b.obsHandlers={};if(!b.hasOwnProperty("bind")){b.bind=function(f,k){var h="callback"+c++;a(b,f).unshift({fn:k,id:h});return h};b.triggerCustom=function(f,k){var h=a(b,f),e={cancel:false,name:f,source:this},l;for(l in k)e[l]=k[l];if(!h)return null;h=h.concat(a(b,"*"));l=Array.prototype.slice.call(arguments,
2);b.eventInterceptor&&b.eventInterceptor(f,e,l);l.unshift(e);for(var d=h.length;d--&&!e.cancel;)h[d].fn.apply(this,l);return e};b.trigger=function(f){var k=Array.prototype.slice.call(arguments,1);k.splice(0,0,f,null);return b.triggerCustom.apply(this,k)};b.unbind=function(f,k){if(typeof f==="undefined")b.obsHandlers={};else for(var h=a(b,f),e=0;h&&e<h.length;e++)if(h[e].id===k){h.splice(e,1);break}return b}}return b}}(),sa=function(){function a(c,b,f,k){if(typeof c[k]=="undefined")c[k]=function(h){if(typeof h!=
"undefined"){b[k]=h;f[k]&&f[k](h);return c}else return b[k]}}return function(c,b,f){b=b||c;for(var k in b)typeof b[k]!="function"&&a(c,b,f,k);return c}}(),Ma=Array.indexOf||function(a){for(var c=0;c<this.length;c++)if(this[c]===a)return c;return-1},$=function(){var a={NaN:1,Infinity:1,"-Infinity":1},c=String.prototype.toLowerCase,b=Object.prototype.toString;return function(f,k){k=c.call(k);if(k=="finite")return!a.hasOwnProperty(+f);return k=="null"&&f===null||k==typeof f||k=="object"&&f===Object(f)||
k=="array"&&Array.isArray&&Array.isArray(f)||b.call(f).slice(8,-1).toLowerCase()==k}}(),Wa=function(){function a(h){var e=document.createElement("script"),l=false;e.src=h;e.async=true;e.onload=e.onreadystatechange=function(){if(!l&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){l=true;e.onload=e.onreadystatechange=null;e&&e.parentNode&&e.parentNode.removeChild(e)}};k||(k=document.getElementsByTagName("head")[0]);k.appendChild(e)}function c(h,e,l){h+=h.indexOf("?")>=
0?"&":"?";var d="json"+ ++f;window[d]=function(i){e(i);window[d]=null;try{delete window[d]}catch(g){}};a(h+(l?l:"callback")+"="+d);return d}function b(h,e,l){var d=require("request");h=h+(h.indexOf("?")>=0?"&":"?")+(l?l:"callback")+"=cb";d({uri:h},function(i,g,j){if(i)e({error:i});else{i=j.replace(/^.*\(/,"").replace(/\).*$/,"");e(JSON.parse(i))}})}var f=0,k;return typeof window!="undefined"?c:b}();INTERACT=function(){function a(n){return function(p,v){n.addEventListener(p,v,false)}}function c(n){return function(p,
v){n.removeEventListener(p,v,false)}}function b(n){return function(p,v){n.attachEvent("on"+p,v)}}function f(n,p){return{x:n?n:0,y:p?p:0,count:1}}function k(n,p){g.push(R({handler:null,checks:{},type:n},p))}function h(n){var p=0,v=0;if(n.offsetParent){do{p+=n.offsetLeft;v+=n.offsetTop;n=n.offsetParent}while(n)}return{left:p,top:v}}function e(n,p){return{source:n,target:p.target?p.target:p.srcElement}}function l(n,p){for(var v=n.target?n.target:n.srcElement;v&&v!==p;)v=v.parentNode;return v&&v===p}
function d(n,p){return{x:n.x-(p?p.left:0),y:n.y-(p?p.top:0)}}function i(n,p){if(n.preventDefault){n.preventDefault();n.stopPropagation()}else if(typeof n.cancelBubble!="undefined")n.cancelBubble=true;p&&n.stopImmediatePropagation&&n.stopImmediatePropagation()}var g=[],j=function(n,p,v){v=R({binder:null,unbinder:null,observable:null},v);for(var C=v.observable,G=[],P,u,E={bind:function(){return C.bind.apply(null,arguments)},unbind:function(){C.unbind();for(A=0;A<G.length;A++)G[A].unbind();return E}},
A=0;A<p.length;A++)G.push(p[A](n,C,v));C.bind("pointerDown",function(){u=P=0});C.bind("pointerMove",function(m,s,r,w){P+=w.x||0;u+=w.y||0});C.bind("pointerUp",function(m,s,r){Math.max(Math.abs(P),Math.abs(u))<=20&&C.triggerCustom("tap",m,s,r)});return E};k("pointer",{handler:function(n,p,v){function C(H){if(H.pageX&&H.pageY)return f(H.pageX,H.pageY);else{var S=document.documentElement,N=document.body;return f(H.clientX+(S&&S.scrollLeft||N&&N.scrollLeft||0)-(S&&S.clientLeft||N&&N.clientLeft||0),H.clientY+
(S&&S.scrollTop||N&&N.scrollTop||0)-(S&&S.clientTop||N&&N.clientTop||0))}}function G(H){if(l(H,n))if(B=A(H)){var S=C(H);n.style.cursor="move";i(H,true);O=S.x;V=S.y;F=f(O,V);p.triggerCustom("pointerDown",e("mouse",H),F,d(F,h(n)))}}function P(H){var S=C(H);I=S.x;T=S.y;if(l(H,n))s(H,B?"pointerMove":"pointerHover")}function u(H){if(B&&A(H)){B=false;if(l(H,n)){n.style.cursor="default";s(H,"pointerUp")}}}function E(H){if(l(H,n)){var S;H=H||window.event;if(H.detail){if(typeof H.axis=="undefined"||H.axis===
2)S=-H.detail*r}else{S=H.wheelDeltaY?H.wheelDeltaY:H.wheelDelta;if(window.opera)S=-S}if(S){var N=f(I,T);p.triggerCustom("zoom",e("mouse",H),N,d(N,h(n)),S/w,"wheel");i(H);H.returnValue=false}}}function A(H){H=H||window.event;return(H.which||H.button)==1}function m(H){return!l(H,n)}function s(H,S,N,ea,J){N=typeof N!="undefined"?N:I;ea=typeof ea!="undefined"?ea:T;var Q=N-O,L=ea-V,Z=f(N,ea);p.triggerCustom(S,e("mouse",H),Z,d(Z,h(n)),f(Q,L));if(typeof J=="undefined"||J){O=N;V=ea}}v=R({},v);var r=120,w=
r*8,B=false,F,I,T,O,V;v.binder("mousedown",G);v.binder("mousemove",P);v.binder("mouseup",u);v.binder("dblclick",function(H){if(l(H,n)){var S=C(H);p.triggerCustom("doubleTap",e("mouse",H),S,d(S,h(n)))}});v.binder("selectstart",m);v.binder("dragstart",m);v.binder("mousewheel",E);v.binder("DOMMouseScroll",E);return{unbind:function(){v.unbinder("mousedown",G);v.unbinder("mousemove",P);v.unbinder("mouseup",u);v.unbinder("mousewheel",E);v.unbinder("DOMMouseScroll",E)}}},checks:{touch:false}});k("pointer",
{handler:function(n,p,v){function C(J){if(J.count<2)return 0;var Q=J.x-J.next.x;J=J.y-J.next.y;return~~Math.sqrt(Q*Q+J*J)}function G(J,Q,L){Q=Q?Q:0;L=L?L:0;for(var Z={x:J.x-Q,y:J.y-L,id:J.id,count:J.count},ka=Z;J.next;){J=J.next;ka=ka.next={x:J.x-Q,y:J.y-L,id:J.id}}return Z}function P(J,Q){var L=J[Q?Q:"touches"],Z,ka;if(L.length===0)return null;ka=Z={x:L[0].pageX,y:L[0].pageY,id:L[0].identifier,count:L.length};for(var ta=1,Ia=L.length;ta<Ia;ta++)ka=ka.next={x:L[ta].pageX,y:L[ta].pageY,id:L[ta].identifier};
return Z}function u(J){if(l(J,n)){I=h(n);var Q=P(J,"changedTouches"),L=G(Q,I.left,I.top);if(!O){T=w;p.triggerCustom("pointerDown",e("touch",J),Q,L)}N&&p.triggerCustom("pointerDownMulti",e("touch",J),Q,L);O=P(J);if(O.count>1)H=C(O);ea=1;S=G(O)}}function E(J){if(l(J,n)){i(J);V=P(J);if(T==w)T=Math.abs(O.x-V.x)>s||Math.abs(O.y-V.y)>s?r:w;if(T!=w){T=V.count>1?F:B;if(T==F)if(O.count===1){O=G(V);H=C(O)}else{var Q=C(V);if(Math.abs(H-Q)<m)T=B;else{var L;L=V.x;var Z=V.next.x,ka=V.y,ta=V.next.y;L={x:(L<Z?L:
Z)+(Math.abs(L-Z)>>1),y:(ka<ta?ka:ta)+(Math.abs(ka-ta)>>1)};Q=Q/H;Z=Q-ea;p.triggerCustom("zoom",e("touch",J),L,d(L,I),Z,"pinch");ea=Q}}T==B&&p.triggerCustom("pointerMove",e("touch",J),V,G(V,I.left,I.top),f(V.x-S.x,V.y-S.y));N&&p.triggerCustom("pointerMoveMulti",e("touch",J),V,G(V,I.left,I.top))}S=G(V)}}function A(J){if(l(J,n)){var Q=P(J,"changedTouches"),L=G(Q,I.left,I.top);V=P(J);if(!V){p.triggerCustom("pointerUp",e("touch",J),Q,L);O=null}N&&p.triggerCustom("pointerUpMulti",e("touch",J),Q,L)}}v=
R({detailed:false,inertia:false},v);var m=20,s=7,r=0,w=1,B=2,F=3,I,T,O,V,H,S,N=v.detailed,ea=1;v.binder("touchstart",u);v.binder("touchmove",E);v.binder("touchend",A);return{unbind:function(){v.unbinder("touchstart",u);v.unbinder("touchmove",E);v.unbinder("touchend",A)}}},checks:{touch:true}});return{register:k,watch:function(n,p,v){p=R({bindTarget:null,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},p);capabilities=R({touch:"ontouchstart"in window},v);if(!p.observable){p.observable=
da({});globalOpts=p}p.binder=(p.isIE?b:a)(p.bindTarget||document);p.unbinder=(p.isIE?b:c)(p.bindTarget||document);v=p.types;for(var C=capabilities,G=[],P=g.length;P--;){var u=g[P],E=!v||v.indexOf(u.type)>=0,A=true,m;for(m in u.checks){var s=u.checks[m];A=A&&s===C[m]}if(E&&A)G[G.length]=u.handler}return new j(n,G,p)}}}();var W=this.T5=da({}),Ga=function(){var a={};return{create:function(c,b){if(a[c][b])return a[c][b].apply(null,Array.prototype.slice.call(arguments,2));throw kb(c,b);},get:function(c,
b){return a[c]?a[c][b]:null},register:function(c,b,f){a[c]||(a[c]={});a[c][b]&&La(jb(c,b),"warn");a[c][b]=f}}}(),jb=Y("Registration of {0}: {1} will override existing definition"),kb=Y("Could not create {0} of type: {1}");Y("Could not create drawable of type: {0}");var oa=Math.PI*2,bb=Math.PI/2,Ha=Math.PI/180,Ua=180/Math.PI,Xa=0.08181919084262157,ma=Math.abs,o=Math.round,x=Math.min,y=Math.max,z=Math.pow,K=Math.sqrt,ba=Math.log,ca=Math.sin,mb=Math.cos,zb=Math.atan,Oa="undefined",Na="string",Ja="number",
xa=Ga.register,Ya=Ga.create,Qb=Ga.get,Rb=0,Pb=0,Ab=/[\,\s]+/,Pa=function(){function a(e){k++;e=X?window.mozAnimationStartTime||e||(new Date).getTime():(new Date).getTime();for(var l=f.length;l--;){var d=f[l];k%d.every===0&&d.cb(e)}h&&animFrame(a)}var c=1E3/60,b=["r","webkitR","mozR","oR","msR"],f=[],k=0,h=X&&function(){for(var e=0;e<b.length;e++)window.animFrame=window.animFrame||window[b[e]+"equestAnimationFrame"];return animFrame}();h?animFrame(a):setInterval(a,1E3/60);return{attach:function(e,
l){f[f.length]={cb:e,every:l?o(l/c):1}},detach:function(e){for(var l=f.length;l--;)if(f[l].cb===e){f.splice(l,1);break}}}}(),Nb=function(){var a=/^xy\((.*)\).*$/i;return{parseXY:function(c){if(!a.test(c)){c=c.split(Ab);return lb(c[1],c[0])}}}}(),X=typeof window!="undefined"?function(){function a(h){if(!k)k=document.createElement("t5test").style;for(var e=0;e<h.length;e++){var l=h[e];if(typeof k[l]!="undefined")return l}}var c={"-webkit-user-select":"none",position:"absolute"},b,f,k;b=a(["-webkit-transform",
"MozTransform"]);css3DTransformProp=a(["WebkitPerspective","MozPerspective"]);f=a(["-webkit-transform-origin","MozTransformOrigin"]);return{transforms:$(b,Na),create:function(h,e,l){h=document.createElement(h);var d=[];l=l||{};h.className=e||"";for(var i in l)d[d.length]=i+": "+l[i];h.style.cssText=d.join(";");return h},move:function(h,e,l,d,i){if(b){h.style[b]="translate("+e+"px, "+l+"px) "+(d||[]).join(" ");if(i&&f)h.style[f]=i.x+"px "+i.y+"px"}else{h.style.left=e+"px";h.style.top=l+"px"}},rect:function(h){return new pa(h.offsetLeft,
h.offsetTop,h.offsetWidth,h.offsetHeight)},styles:function(h){return R({},c,h)}}}():null,Bb=function(){function a(){for(var k=f.length,h=k;h--;)try{f[h](k)}catch(e){La(e.toString(),"error")}}var c=20,b=50,f=[];return{process:function(k,h,e,l){function d(j){j=(i||b)/j;if(g<k.length){var n=k.slice(g,g+j);j=n.length;var p=i?0:(new Date).getTime();h(n,j);if(!i)i=(n=((new Date).getTime()-p)/j)?c/n|0:k.length;g+=j}else{for(j=f.length;j--;)if(f[j]===d){f.splice(j,1);break}f.length===0&&Pa.detach(a);e&&e()}}
var i,g=0;if(X&&k.length>(l||0))f.push(d)===1&&Pa.attach(a);else{h(k,k.length);e&&e()}}}}(),lb=lb||function(a,c){var b=parseFloat(c)*Ha;b=ca(b);var f=Xa*b;b=ba((1+b)/(1-b)*z((1-f)/(1+f),Xa))/2;return new na(0,0,parseFloat(a)*Ha,b)},tb=tb||function(a,c){for(var b=z(Math.E,-c),f=bb-2*zb(b),k=Va(f,b),h=0;h<12&&ma(f-k)>1.0E-7;){f=k;k=Va(f,b);h++}return new GeoJS.Pos(k*Ua,a%360*Ua)};aa.prototype={constructor:aa,add:function(){for(var a=this.x,c=this.y,b=arguments.length;b--;){a+=arguments[b].x;c+=arguments[b].y}return this.copy(a,
c)},copy:function(a,c){var b=R({},this);b.x=a||b.x;b.y=c||b.y;return b},equals:function(a){return this.x===a.x&&this.y===a.y},offset:function(a,c){return this.copy(this.x+a,this.y+c)},relative:function(a){a=a.viewport();return this.copy(this.x-a.x-a.padding.x,this.y-a.y-a.padding.y)},rotate:function(a,c){c=c||new aa(0,0);var b=this.x-c.x,f=this.y-c.y;return new aa(c.x+mb(a)*b+-ca(a)*f,c.y+ca(a)*b+mb(a)*f)},scale:function(a,c){c=c||new aa(0,0);return new aa(c.x+(this.x-c.x)*a,c.y+(this.y-c.y)*a)},
sync:function(){return this},toString:function(){return this.x+", "+this.y}};wa.prototype=R([],{cull:function(a){if(this.allowCull){var c=a.x,b=a.y,f=a.x+a.w;a=a.y+a.h;for(var k=Infinity,h=0,e=this.points,l,d=e.length;d--;)if(l=e[d].x>=c&&e[d].x<=f&&e[d].y>=b&&e[d].y<=a){k=d<k?d:k;h=d>h?d:h}return e.slice(y(k-1,0),x(h+1,e.length))}return this.points},simplify:function(a){a=a||3;for(var c=new wa(this.allowCull),b=this.points,f=null,k=b.length;k--;){var h=b[k];if(include=!f||k===0||ma(h.x-f.x)+ma(h.y-
f.y)>a){c.points.unshift(h);f=h}}return c}});na.prototype=R(new aa,{constructor:na,pos:function(){return tb(this.mercX,this.mercY)},sync:function(a,c){var b;if(!(b=a.rpp)){b=a.zoom();b=oa/(256<<b)}b=b;if(c){this.mercX=this.x*b-Math.PI;this.mercY=Math.PI-this.y*b}else{this.x=o(((this.mercX||0)+Math.PI)/b);this.y=o((Math.PI-(this.mercY||0))/b)}return this}});pa.prototype={constructor:pa,buffer:function(a,c){return new pa(this.x-a,this.y-(c||a),this.w+a*2,this.h+(c||a)*2)},center:function(){return new aa(this.x+
(this.w>>1),this.y+(this.h>>1))}};Hits=function(){return{diffHits:function(a,c){var b=[],f={},k;for(k=c.length;k--;)f[c[k].target.id]=true;for(k=a.length;k--;)f[a[k].target.id]||(b[b.length]=a[k]);return b},init:function(a,c,b,f,k){return{type:a,x:k.x,y:k.y,gridX:f.x|0,gridY:f.y|0,elements:[],absXY:c,relXY:b}},initHit:function(a,c,b){return{type:a,target:c,drag:b}},match:function(a,c,b){return c===a.type&&b.x===a.absXY.x&&b.y===a.absXY.y},triggerEvent:function(a,c,b,f){c.triggerCustom(a.type+(b?b:
"Hit"),{hitType:a.type},f?f:a.elements,a.absXY,a.relXY,new na(a.gridX,a.gridY))}}}();var Ob=function(a){function c(h,e){var l=b[h],d;l||(l=b[h]=[]);(d=l[e])||(d=l[e]=[]);return d}a=a||128;var b=[],f={},k=0;return{all:function(){var h=[],e;for(e in f)h[h.length]=f[e];return h},clear:function(){b=[];f={}},copyInto:function(h){for(var e in f){var l=f[e];h.insert(l.bounds||l,l,e)}},insert:function(h,e,l){var d=h.x/a|0,i=h.y/a|0,g=(h.x+h.w)/a|0;h=(h.y+h.h)/a|0;l=l||e.id||"obj_"+k++;f[l]=e;for(e=d;e<=g;e++)for(d=
i;d<=h;d++)c(e,d).push(l)},remove:function(h,e,l){l=l||e.id;if(f[l]){var d=h.x/a|0;e=h.y/a|0;var i=(h.x+h.w)/a|0;h=(h.y+h.h)/a|0;delete f[l];for(d=d;d<=i;d++)for(var g=e;g<=h;g++){var j=c(d,g),n=Ma.call(j,l);n>=0&&j.splice(n,1)}}},search:function(h){var e=h.y/a|0,l=(h.x+h.w)/a|0,d=(h.y+h.h)/a|0,i=[],g=[];for(h=h.x/a|0;h<=l;h++)for(var j=e;j<=d;j++)i=i.concat(c(h,j));i.sort();for(e=i.length;e--;){l=i[e];if(d=f[l])g[g.length]=d;for(;e>0&&i[e-1]==l;)e--}return g}}},nb=function(){var a={},c=0;(new Date).getTime();
var b={},f=[];Pa.attach(function(k){k=k||(new Date).getTime();for(var h=0;h<f.length;){var e=f[h],l=b[e],d=b[e].image&&b[e].image.complete&&b[e].image.width>0,i=k-l.start;i=d||i>=3E4;if(d){d=l.callbacks;a[e]=l.image;for(var g=0;g<d.length;g++)d[g](l.image,true)}if(i){f.splice(h,1);delete b[e]}else h++}},250);return function(k,h){var e=k&&h?a[k]:null;if(e&&e&&e.complete&&e.width>0)h(e);else if(e=b[k])e.callbacks.push(h);else{e=new Image;e.id="_ldimg"+ ++c;b[k]={start:(new Date).getTime(),image:e,callbacks:[h]};
e.src=k;f[f.length]=k}}}();Ta.prototype={constructor:Ta,load:function(a){var c=this;nb(this.url,function(b){c.loaded=true;c.image=b;a&&a()})}};var Sb=function(){return da({fastpan:true,applyStyle:function(){},applyTransform:function(a,c,b){return{restore:null,x:c,y:b}},getDimensions:function(){return{width:0,height:0}},getViewport:function(){},hitTest:function(){return false},projectXY:null,reset:function(){}})};xa("renderer","canvas",function(a,c,b,f,k){function h(){function m(w,B){this.save();this.setTransform(1,
0,0,1,0,0);var F=this.isPointInPath_old(w,B);this.restore();return F}var s=CanvasRenderingContext2D.prototype,r=document.createElement("canvas").getContext("2d");r.translate(50,0);r.moveTo(125,50);r.arc(100,50,25,0,360,false);if(!r.isPointInPath(150,50)){s.isPointInPath_old=s.isPointInPath;s.isPointInPath=m}}function e(m,s,r){var w,B;v[s]=function(F){for(w=E.length;w--;)if(B=r[E[w]])F[A[w]]=B}}function l(m,s,r){return{draw:r||u,viewport:m,hit:s&&j.isPointInPath(s.x,s.y),vpX:n,vpY:p,context:j}}function d(m,
s,r,w,B){if(!g.full){if(m.bounds){m=m;w=m.bounds;s=m.xy;r=w.w*m.scaling*1.2|0;w=w.h*m.scaling*1.2|0;m=s.x-n-(r>>1);s=s.y-p-(w>>1)}r=m+r;w=s+w;g.x=m<g.x?m:g.x;g.y=s<g.y?s:g.y;g.x2=r>g.x2?r:g.x2;g.y2=w>g.y2?w:g.y2;g.w=g.x2-g.x;g.h=g.y2-g.y}g.full=g.full||B}f=R({},f);var i,g=new W.Rect,j,n=0,p=0,v={},C=null,G={},P=function(){},u=function(){this.fill&&j.fill();this.stroke&&j.stroke()},E=["fill","stroke","lineWidth","opacity"],A=["fillStyle","strokeStyle","lineWidth","globalAlpha"];X&&h();if(c){b=c.offsetWidth;
f=c.offsetHeight;i=X?X.create("canvas",null,{position:"absolute","z-index":1}):new Canvas;i.width=b;i.height=f;a.attachFrame(i,true);j=null}k=R(k,{applyStyle:function(m){var s=v[m],r=j&&j.canvas?j.canvas.id:"default",w;G[r]||(G[r]=[]);w=G[r].pop()||"reset";if(s){G[r].push(m);s(j);return w}},applyTransform:function(m){if(m.translateX!==0||m.translateY!==0||m.scaling!==1||m.rotation!==0){j.save();C={undo:function(){j.restore();C=null},x:m.xy.x,y:m.xy.y};j.translate(m.xy.x-n+m.translateX,m.xy.y-p+m.translateY);
m.rotation!==0&&j.rotate(m.rotation);m.scaling!==1&&j.scale(m.scaling,m.scaling)}return C},drawTiles:function(m,s,r){d(0,0,m.w,m.h,true);for(var w=s.length;w--;){m=s[w];if(!m.loaded&&r)m.load(a.invalidate);else m.image&&j.drawImage(m.image,m.x-n,m.y-p)}},prepArc:function(m,s,r){j.beginPath();d(m);j.arc(m.xy.x-(C?C.x:n),m.xy.y-(C?C.y:p),m.size>>1,m.startAngle,m.endAngle,false);return l(s,r)},prepImage:function(m,s,r,w){var B=(w.x||m.xy.x)-(C?C.x:n),F=(w.y||m.xy.y)-(C?C.y:p),I=w.image||m.image;if(I){j.beginPath();
j.rect(B,F,w.width||I.width,w.height||I.height);return l(s,r,function(){j.drawImage(I,B,F,w.width||I.width,w.height||I.height)})}},prepMarker:function(m,s,r){var w=m.xy.x-(C?C.x:n),B=m.xy.y-(C?C.y:p),F=m.size,I=w-(F>>1),T=B-(F>>1),O=undefined;j.beginPath();d(m);switch(m.markerType.toLowerCase()){case "image":O=P;j.rect(I,T,F,F);if(m.reset&&m.image){m.image=null;m.reset=false}m.image?j.drawImage(m.image,I,T,F,F):nb(m.imageUrl,function(V){m.image=V;j.drawImage(m.image,I,T,F,F)});break;default:j.moveTo(w,
B);j.lineTo(w-(F>>1),B-F);j.lineTo(w+(F>>1),B-F);j.lineTo(w,B)}return l(s,r,O)},prepPoly:function(m,s,r,w){var B=true;w=w.points||m.line().cull(s);var F=C?C.x:n,I=C?C.y:p;j.beginPath();d(m);for(m=w.length;m--;){var T=w[m].x-F,O=w[m].y-I;if(B){j.moveTo(T,O);B=false}else j.lineTo(T,O)}return l(s,r)},getCanvas:function(){return i},getContext:function(){return j}});(function(){Cb.each(function(m,s){e(null,m,s)});W.bind("styleDefined",e)})();k.bind("predraw",function(m,s,r){if(j)j.restore();else if(i)j=
i.getContext("2d");n=r.x;p=r.y;if(j){j.clearRect(g.x,g.y,g.w,g.h);g=new W.Rect;j.save();j.globalCompositeOperation="source-over"}});k.bind("detach",function(){i&&i.parentNode&&c.removeChild(i)});k.bind("resize",function(){});return k});xa("renderer","dom",function(a,c,b,f,k){function h(g){var j=g.image=new Image;d[g.id]=g;j.onload=function(){if(i[g.id])l.appendChild(this);else g.image=null};j.src=g.url;j.style.cssText="-webkit-user-select: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute;";
return j}function e(g,j,n){var p=[],v;for(v in g){var C=g[v];if(n?C[n]:!j[v]){if(C.image&&C.image.parentNode){C.image.src="";l.removeChild(C.image);C.image=null}p[p.length]=v}}for(j=p.length;j--;)delete g[p[j]]}var l=null,d={},i={};l=X.create("div","t5-tiles",X.styles({width:c.offsetWidth+"px",height:c.offsetHeight+"px"}));c.childNodes.length>0?c.insertBefore(l,c.childNodes[0]):c.appendChild(l);a.attachFrame(l);b=R(k,{drawTiles:function(g,j,n){for(var p,v=g.x,C=g.y,G=j.length;G--;){g=j[G];if(g.url){(p=
g.image||(n?h(g):null))&&X.move(p,g.x-v,g.y-C);i[g.id]=g}}}});b.bind("predraw",function(){e(d,i);i={}});b.bind("detach",function(){c.removeChild(l)});a.bind("reset",function(){for(e(d,i={});l.childNodes.length>0;)l.removeChild(l.childNodes[0])});return b});var Cb=function(){function a(b,f){if($(b,Na)){W.trigger("styleDefined",b,c[b]=f);return b}else{var k=[],h;for(h in b)k[k.length]=a(h,b[h]);return k}}var c={};a({reset:{fill:"#ffffff",opacity:1},highlight:{fill:"#ff0000"},waypoints:{lineWidth:4,
stroke:"#003377",fill:"#ffffff"},waypointsHover:{lineWidth:4,stroke:"#ff0000",fill:"#ffffff"}});return{resetStyle:"reset",each:function(b){for(var f in c)b(f,c[f])},get:function(b){return c[b]},define:a}}(),Mb=function(a,c){function b(q,t,D,M){Ka&&Ka(true);q=O?y(fa+z(2,M)-1,0.125):M>0?2:0.5;w(q,false,true)}function f(q,t){var D=ha&&ha.projectXY?ha.projectXY(q,t):null;if(!D){D=A();D=new U.XY(D?D.x+(q+D.padding.x)/fa:q,D?D.y+(t+D.padding.y)/fa:t)}return D.sync(U,true)}function k(q,t,D){q=f(D.x,D.y);
clearTimeout(ub);U.trigger("doubleTap",t,D,q);if(c.scalable){t=U.center();B(ia+q.x-t.x,ja+q.y-t.y,O?Db:null);w(2,Db,true)}}function h(q,t,D){Z=null;Ia=true;P("down",t,D)}function e(q,t,D){P("hover",t,D)}function l(q,t,D,M){p(t,D,false);if(!Z){Ca+=M.x;Da+=M.y}}function d(q,t,D){p(t,D,true);Ia=false}function i(){clearTimeout(Eb);Eb=setTimeout(function(){if(L)if(L.offsetWidth!==db*2||L.offsetHeight!==eb*2){var q=E();C(a);E(q.x,q.y)}},250)}function g(q,t,D){P("tap",t,D);ub=setTimeout(function(){U.trigger("tap",
t,D,f(D.x,D.y,true))},20)}function j(){ua&&ua.unbind();if(X&&ha){ua=INTERACT.watch(ha.interactTarget||L);if(c.scalable){ua.bind("zoom",b);ua.bind("doubleTap",k)}ua.bind("pointerDown",h);ua.bind("pointerMove",l);ua.bind("pointerUp",d);c.captureHover&&ua.bind("pointerHover",e);ua.bind("tap",g)}}function n(q){if(ha){ha.trigger("detach");ha=null}var t=U,D=J,M=L,ga=c;q=q.split("/");for(var qa=new Sb(t,D,M,ga),ra=0;ra<q.length;ra++)qa=Ya("renderer",q[ra],t,D,M,ga,qa);ha=qa;ta=X&&ha.fastpan&&X.transforms;
O=X&&X.transforms&&c.useTransforms;j();U.trigger("changeRenderer",ha);U.trigger("reset");s()}function p(q,t,D){if(Z){q=f(t.x,t.y);Z.drag.call(Z.target,Z,q.x,q.y,D)&&la++;if(D)Z=null}}function v(q){for(var t=ea;t--;)if(N[t].id===q)return t;return ea}function C(q){if(X)if(L=document.getElementById(q)){q=X.rect(L);Q&&L.removeChild(Q);L.appendChild(Q=X.create("div","t5-panframe",X.styles({overflow:"hidden",width:q.w+"px",height:q.h+"px"})));var t=c.padding;if(t===T){t=L.offsetWidth;var D=L.offsetHeight,
M=K(t*t+D*D);va=new aa(M-t>>1,M-D>>1)}else va=new aa(t,t);ob=Q.offsetWidth+va.x*2;pb=Q.offsetHeight+va.y*2;vb=ob/2;wb=pb/2;db=q.w/2;eb=q.h/2;fb=new aa(vb,wb);Q.appendChild(J=X.create("div","t5-view",X.styles({width:ob+"px",height:pb+"px","z-index":2,margin:-va.y+"px 0 0 "+-va.x+"px"})));n(c.renderer);q=c.controls;for(t=0;t<H.length;t++)H[t].trigger("detach");H=[];for(t=0;t<q.length;t++)H[H.length]=Ya("control",q[t],U,Q,L,c[q[t]])}else throw Error("Unable to find map container element with id: "+q);
else n("canvas")}function G(q){var t=[],D,M,ga;if(!V){U.panSpeed=panSpeed=ma(Ca)+ma(Da);(D=fa!==xb)&&U.trigger("scale");if(panSpeed>0||D||Ea||Ka||gb){la++;if(Ea&&panSpeed>0){Ea(true);Ea=null}}if(!Ia&&panSpeed<=F&&(ma(ia-Fb)>=Gb||ma(ja-Hb)>=Gb))s();yb.index++;yb.draw=la||panSpeed||Tb||Ub;if(ha&&yb.draw){if(Ka)fa=Ka()[0];if(gb)za=gb()[0];Qa+=Ca;Ra+=Da;if(Ca||Da)U.trigger("pan");if(O){if(fa!==1)t[t.length]="scale("+fa+")";if(za!==0)t[t.length]="rotate("+za+"deg)"}D=ka||!ta||!Ia&&!(Ea&&Ib)&&!(Ka&&Ib)&&
(c.drawOnScale||fa===1)&&panSpeed<=I;if(Ea){M=Ea();ga=1;if(qb)ga=fa/qb;Qa=(ia-M[0]|0)*ga;Ra=(ja-M[1]|0)*ga}if(D){M=-za*Ha;D=mb(M)*Qa+-ca(M)*Ra;M=ca(M)*Qa+mb(M)*Ra;ia=ia-D/fa|0;ja=ja-M/fa|0;ga=A();ha.trigger("predraw",N,ga,q,ya);M=Ra=D=Qa=la=0;for(ii=ea;ii--;){var qa=N[ii];if(qa.visible){var ra=qa.style?ha.applyStyle(qa.style,true):null;qa.draw(ha,ga,U,q,ya[0]);ra&&ha.applyStyle(ra)}}ha.trigger("render",ga);U.trigger("drawComplete",ga,q);X.move(J,D,M,t,fb)}else X.move(J,Qa,Ra,t,fb);if(Ia||!c.inertia)Da=
Ca=0;else if(Ca!=0||Da!=0){Ca*=0.8;Da*=0.8;if(ma(Ca)<0.5)Ca=0;if(ma(Da)<0.5)Da=0}if(ya.length){for(ii=0;ii<ya.length;ii++){q=ya[ii];t=true;D=q?q.elements:[];M=void 0;if(q&&hb&&q.type==="hover"&&hb.type==="hover"){diffElements=Hits.diffHits(hb.elements,D);if(diffElements.length>0)Hits.triggerEvent(hb,U,"Out",diffElements);else t=false}if(D.length>0){ga=q.gridX;qa=q.gridY;for(M=D.length;Ia&&M--;){ra=D[M];var Jb=ga,Kb=qa,Lb=ra&&ra.drag&&(!ra.canDrag||ra.canDrag(ra,Jb,Kb));if(Lb){Z=ra;Z.startX=Jb;Z.startY=
Kb}if(Lb)break}if(t){Hits.triggerEvent(q,U);q.type==="tap"&&clearTimeout(ub)}}hb=D.length>0?R({},q):null}ya=[]}if(xb!==fa){U.trigger("scaleChanged",fa);xb=fa}}}}function P(q,t,D){var M=(new aa(D.x-db+vb,D.y-eb+wb)).rotate(-za*Ha,fb).scale(1/fa,fb);if(ya.length===0||!Hits.match(ya[ya.length-1],q,t)){ya[ya.length]=q=Hits.init(q,t,D,f(D.x,D.y,true),M);ka=false;for(t=ea;t--;)if(N[t].visible)ka=ka||(N[t].hitGuess?N[t].hitGuess(q.gridX,q.gridY,U):false);ka&&la++}}function u(q){S=S?S+" "+q:q;U.trigger("copyright",
S)}function E(q,t,D){if(typeof q!="undefined"&&($(q,Na)||$(q,"object"))){t=new U.XY(q);t.sync(U);q=t.x;t=t.y}if($(q,Ja)){B(q-db-va.x,t-eb-va.y,D);return U}else return B().offset(db+va.x|0,eb+va.y|0).sync(U,true)}function A(){var q=new pa(ia,ja,ob,pb);q.scaleFactor=fa;q.padding=va?va.copy():new aa;return q}function m(q,t,D){var M=typeof q!="undefined";if(M&&$(t,Oa))for(t=0;t<ea;t++){if(N[t].id===q)return N[t]}else if(M){t=Ya("layer",t,U,Q,L,D);D=v(q);D!==ea&&r(N[D]);t.added=(new Date).getTime();t.id=
q;N[D]=t;N.sort(function(ga,qa){return qa.zindex-ga.zindex||qa.added-ga.added});ea=N.length;U.trigger("resync");s();U.trigger("layerChange",U,t);la++;return t}else return[].concat(N)}function s(){var q=A();if(q){if(Za||$a)if(q){var t=rb?ia+(q.w>>1):ia,D=sb?ja+(q.h>>1):ja,M=q.w,ga=q.h;if(Za&&Za>M)if(t+M>Za)ia=rb?ia:Za-M;else if(t<0)ia=rb?ia:0;if($a&&$a>ga)if(D+ga>$a)ja=sb?ja:$a-ga;else if(D<0)ja=sb?ja:0}Fb=ia;Hb=ja;U.trigger("refresh",U,q);la++}}function r(q){if($(q,Na))q=q(q);if(q){U.trigger("beforeRemoveLayer",
q);var t=Ma(N,q.id);if(t>=0&&t<ea){N.splice(t,1);la++}ea=N.length;q.trigger("removed")}}function w(q,t,D){if($(q,Ja)){var M=D?q:fa*q;if(!O){t=undefined;q=o(ba(M)/Math.LN2);M=z(2,q)}if(t){qb=fa;Ka=Fa.tween([fa],[M],t,function(){fa=M;qb=Ka=null;la++})}else{fa=M;la++}return U}else return fa}function B(q,t,D){if($(q,Ja)){if(D)Ea=Fa.tween([ia,ja],[q,t],D,function(){ia=q|0;ja=t|0;Qa=Ra=0;Ea=null;la++});else{ia=q|0;ja=t|0;la++}return U}else return(new U.XY(ia,ja)).sync(U,true)}c=R({captureHover:true,controls:[],
copyright:"",drawOnScale:true,padding:128,inertia:true,refreshDistance:128,noDrawOnTween:true,pannable:true,scalable:true,renderer:"canvas",useTransforms:true},c);var F=0,I=2,T="auto",O=true,V=false,H=[],S="",N=[],ea=0,J=null,Q=null,L,Z=null,ka=false,ta,Ia=false,Ca=0,Da=0,Tb=0,Ub=0,Gb=c.refreshDistance,Ib=c.noDrawOnTween,ia=0,ja=0,Qa=0,Ra=0,Fb=0,Hb=0,Za=null,$a=null,rb=false,sb=false,Ea=null,va,ya=[],hb=null,ha,Eb=0,fb=new aa,za=0,gb=null,fa=1,qb,Ka=null,xb=1,ua=null,yb={index:0,draw:false},Db={easing:"sine.out",
duration:500},la=0,ob,pb,vb,wb,db,eb,ub,U={XY:aa,id:c.id,panSpeed:0,addCopy:u,attachFrame:function(q,t){t&&J.appendChild(q)},center:E,detach:function(){Pa.detach(G);ha&&ha.trigger("detach");ua&&ua.unbind();if(Q){L.removeChild(Q);J=Q=null}},frozen:function(q){if($(q,Oa))return V;else{V=q;return U}},getCopy:function(){return S},getRenderer:function(){return ha},layer:m,invalidate:function(){la++},pan:function(q,t,D){return B(ia+q,ja+t,D)},refresh:s,removeLayer:r,rotate:function(q,t,D){if($(q,Ja)){var M=
D?q:za+q;if(t)gb=Fa.tween([za],[M],t,function(){za=M%360;gb=null;la++});else{za=M%360;la++}return U}else return za},scale:w,setMaxOffset:function(q,t,D,M){Za=q;$a=t;rb=D;sb=M},offset:B,viewport:A};da(U);U.bind("resize",i);sa(U,c,{container:C,captureHover:j,scalable:j,pannable:j,renderer:n});m("markers","draw",{zindex:20});C(a);if(X&&!$(window.attachEvent,Oa))window.attachEvent("onresize",i);else X&&window.addEventListener("resize",i,false);c.copyright&&u(c.copyright);Pa.attach(G);return U},Fa=function(){return{tween:function(a,
c,b,f,k){function h(v){var C=v-p;v=p+n<=v;for(var G=e;G--;)l[G]=i(C,a[G],g[G],n);k&&k.invalidate();if(v||j){Pa.detach(h);for(G=0;G<d.length;G++)d[G]&&d[G](l,C,j)}}b=R({easing:"sine.out",duration:1E3,complete:null},b);var e=a.length,l=[].concat(a),d=[f,b.complete],i=ib(b.easing),g=[],j=false,n=b.duration,p=(new Date).getTime();for(b=e;b--;)g[b]=c[b]-a[b];Pa.attach(h);return function(v){j=v;return l}},tweenDrawable:function(a,c,b,f,k){var h=Fa.tween([b],[f],k,function(){a[c]=f;for(var l=a.tweens.length;l--;)if(a.tweens[l]===
e){a.tweens.splice(l,1);break}},a.view),e=function(){a[c]=h()[0]};return e}}}(),Sa=function(a,c,b){b=R({style:null,xy:null,size:20,fill:false,stroke:true,draggable:false,properties:{},typeName:"Shape",zindex:0},b);R(this,b);if($(this.xy,Na))this.xy=new a.XY(this.xy);this.id="drawable_"+Rb++;this.bounds=null;this.view=a;this.layer=c;this.tweens=[];this.rotation=this.animations=0;this.scaling=1;this.translateY=this.translateX=0;this.visible=true;da(this)};Sa.prototype={constructor:Sa,applyTweens:function(){for(var a=
this.tweens.length;a--;)this.tweens[a]()},drag:null,draw:null,getProps:null,resync:function(){if(this.xy){this.xy.sync(this.view);if(this.size){var a=this.size>>1;this.updateBounds(new pa(this.xy.x-a,this.xy.y-a,this.size,this.size))}}return this},rotate:function(a,c,b){if($(a,Ja)){a=(b?a:this.rotation*Ua+a)*Ha;if(c)this.tweens.push(Fa.tweenDrawable(this,"rotation",this.rotation,a,c));else{this.rotation=a;this.view.invalidate()}return this}else return this.rotation*Ua},scale:function(a,c,b){if($(a,
Ja)){a=b?a:this.scaling*a;if(c)this.tweens.push(Fa.tweenDrawable(this,"scaling",this.scaling,a,c));else{this.scaling=a;this.view.invalidate()}return this}else return this.scaling},translate:function(a,c,b,f){if($(a,Ja)){a=f?a:this.translateX+a;c=f?c:this.translateY+c;if(b){this.tweens.push(Fa.tweenDrawable(this,"translateX",this.translateX,a,b));this.tweens.push(Fa.tweenDrawable(this,"translateY",this.translateY,c,b))}else{this.translateX=a;this.translateY=c;this.view.invalidate()}return this}else return new aa(this.translateX,
this.translateY)},updateBounds:function(a,c){a&&(!this.bounds||a.x!=this.bounds.x||a.y!=this.bounds.y)&&this.trigger("move",this,a,this.bounds);this.bounds=a;if(c)this.xy=this.bounds.center()}};xa("drawable","marker",function(a,c,b){b=R({fill:true,stroke:false,markerType:"simple",hoverStyle:"highlight",typeName:"Marker"},b);return new Sa(a,c,b)});xa("drawable","poly",function(a,c,b){function f(){var g,j,n,p,v,C,G,P;d=b.simplify?l.simplify():l;P=d.points;for(g=P.length;g--;){j=P[g].x;n=P[g].y;C=$(C,
Oa)||j<C?j:C;G=$(G,Oa)||n<G?n:G;p=$(p,Oa)||j>p?j:p;v=$(v,Oa)||n>v?n:v}i.updateBounds(new pa(C,G,p-C,v-G),true);i.trigger("pointsUpdate",i,P);a.invalidate()}function k(g){if($(g,"array")){var j;l=new wa(b.allowCull);j=l.points;Bb.process(g,function(n,p){for(var v=0;v<p;v++)j.push(new a.XY(n[v]))},h,e);return i}else return d}function h(){l.points.length&&Bb.process(l.points,function(g,j){for(var n=j;n--;)g[n].sync(a)},f,e)}b=R({allowCull:false,simplify:true,fill:true,points:[],typeName:"Poly"},b);var e=
500,l=new wa(b.allowCull),d=new wa(b.allowCull),i=R(new Sa(a,c,b),{line:k,resync:h});k(b.points);return i});xa("drawable","line",function(a,c,b){b.fill=false;b.allowCull=true;return Ya("drawable","poly",a,c,b)});xa("drawable","image",function(a,c,b){function f(){if(d&&d.width>0){if(!this.centerOffset)this.centerOffset=new aa(-d.width>>1,-d.height>>1);this.updateBounds(new pa(this.xy.x+this.centerOffset.x,this.xy.y+this.centerOffset.y,d.width,d.height),false)}}function k(g){if(this.imageUrl=g){var j=
this;nb(this.imageUrl,function(n,p){d=n;if(p){var v=i.layer?i.layer.view:null;v&&v.invalidate()}f.apply(j)})}}b=R({image:null,imageUrl:null,centerOffset:null,typeName:"Image"},b);var h=Sa.prototype.resync,e=0,l=0,d=b.image,i=R(new Sa(a,c,b),{changeImage:k,getProps:function(){this.bounds||f(this,d);return{image:d,x:this.xy.x+e,y:this.xy.y+l}},resync:function(g){h.call(this,g);f.call(this)}});d||k.call(this,this.imageUrl);if(this.centerOffset){e=this.centerOffset.x;l=this.centerOffset.y}return i});
xa("drawable","arc",function(a,c,b){b=R({startAngle:0,endAngle:Math.PI*2,typeName:"Arc"},b);return new Sa(a,c,b)});Ba.prototype={constructor:Ba,clip:null,cycle:function(){},draw:function(){},hitGuess:null};xa("layer","tile",function(a,c,b,f){f=R({generator:"osm",imageLoadArgs:{}},f);var k=Ya("generator",f.generator,a,f).run,h=null,e=[];c=R(new Ba(a,c,b,f),{draw:function(l,d,i){l.drawTiles&&l.drawTiles(d,h.search(d.buffer(128)),i.panSpeed<2)}});a.bind("resync",function(){var l=a&&a.zoom?a.zoom():0;
e[l]||(e[l]=ab(l));h=e[l]});a.bind("refresh",function(){h&&k(h,a.invalidate)});a.bind("reset",function(){h.clear()});return c});xa("layer","draw",function(a,c,b,f){function k(i,g,j,n){var p=this.dragOffset;if(!p)p=this.dragOffset=new a.XY(i.startX-this.xy.x,i.startY-this.xy.y);this.xy.x=g-p.x;this.xy.y=j-p.y;if(n){delete this.dragOffset;a.invalidate();this.xy.sync(a,true);this.trigger("dragDrop")}return true}function h(i,g,j,n){if(e){n&&e.remove(n,g);e.insert(j,g)}}f=R({zindex:10},f);var e,l,d=R(new Ba(a,
c,b,f),{clear:function(){if(e){e.clear();d.trigger("cleared");a.invalidate()}},create:function(i,g){var j=Ya("drawable",i,a,d,g);j.resync();e&&j.bounds&&e.insert(j.bounds,j);j.bind("move",h);j.trigger("created");d.trigger(i+"Added",j);return j},draw:function(i,g,j,n,p){j={};n=e&&g?e.search(g):[];for(var v=n.length;v--;){var C=n[v],G=C.style||d.style,P,u,E=C.getProps?C.getProps(i):j;P=i["prep"+C.typeName];C.tweens.length>0&&C.applyTweens();u=i.applyTransform(C);if(E=C.visible&&P?P.call(i,C,g,p,E):
null){if(p&&E.hit){p.elements.push(Hits.initHit(C.type,C,C.draggable?k:null));P=p.type+"Style";G=C[P]||d[P]||G}G=G?i.applyStyle(G,true):null;(P=C.draw||E.draw)&&P.call(C,E);G&&i.applyStyle(G)}u&&u.undo&&u.undo()}},find:function(){return e.all()},hitGuess:function(i,g){return e&&e.search({x:i-5,y:g-5,w:10,h:10}).length>0}});l=a.bind("resync",function(){var i=e?e.all():[];e=ab(a.zoom(),e);for(var g=i.length;g--;)i[g].resync()});d.bind("removed",function(){e=null;a.unbind("resync",l)});return d});Aa.prototype=
{constructor:Aa};xa("control","zoombar",function(a,c,b,f){function k(r,w){var B=E[r]=X.create("div","t5-zoombar-button",{position:"absolute",background:h(r),"z-index":51,width:f.width+"px",height:f.buttonHeight+"px","margin-top":(w||0)+"px"});A.appendChild(B)}function h(r,w){return"url("+f.images+") 0 -"+(j+p*3+(r||0)*i*3+(w||0)*i)+"px"}function e(r){return"url("+f.images+") 0 -"+(j+(r||0)*p)+"px"}function l(r,w){var B;if(r===n){n.style.background=e(w);B="thumb"}else for(var F=0;F<E.length;F++)if(r===
E[F]){B="button"+F;E[F].style.background=h(F,w);break}return B}function d(r){if(r!==P){P=r;G=C-P/u*(C-v)|0;X.move(n,0,G-v);clearTimeout(m);m=setTimeout(function(){a.zoom(P)},500)}}f=R({width:24,height:200,images:"img/zoom.png",align:"right",marginTop:10,spacing:10,thumbHeight:16,buttonHeight:16},f);var i=f.buttonHeight,g,j=f.height,n,p=f.thumbHeight,v=f.spacing+i-(p>>1),C=f.height-i-(p>>1),G=v,P=-1;c=a.minZoom();var u=a.maxZoom()-c+1,E=[],A,m=0,s={button0:function(){a.zoom(a.zoom()+1)},button1:function(){a.zoom(a.zoom()-
1)}};A=X.create("div","t5-zoombar",{position:"absolute",background:"url("+f.images+")","z-index":50,overflow:"hidden",width:f.width+"px",height:f.height+"px",margin:function(){var r=f.spacing,w=Y("{0}px 0 0 {1}px");if(f.align==="right")r=b.offsetWidth-f.width-f.spacing;return w(f.marginTop,r)}()});b.childNodes[0]?b.insertBefore(A,b.childNodes[0]):b.appendChild(A);A.appendChild(n=X.create("div","t5-zoombar-thumb",{position:"absolute",background:e(),"z-index":51,width:f.width+"px",height:f.thumbHeight+
"px",margin:"10px 0 0 0",top:G-v+"px"}));k(0);k(1,f.height-f.buttonHeight);g=INTERACT.watch(A,{bindTarget:A});g.bind("pointerMove",function(r,w,B){G=Math.min(Math.max(v,B.y-(p>>1)),C);d(u-(G-v)/C*u|0)});g.bind("pointerDown",function(r){l(r.target,2)});g.bind("pointerUp",function(r){l(r.target,0)});g.bind("tap",function(r){(r=s[l(r.target,2)])&&r()});c=new Aa(a);c.bind("detach",function(){g.unbind();b.removeChild(A)});a.bind("zoom",function(r,w){d(w)});d(a.zoom());return c});xa("control","copyright",
function(a,c,b,f){function k(){h(a.getCopy())}function h(l){if(e){e.innerHTML=l;l=e.style;var d;a.viewport();d=X.rect(b);var i=f.spacing,g=d.h-e.offsetHeight-f.spacing,j=Y("{0}px 0 0 {1}px");if(f.align==="right")i=d.w-e.offsetWidth-f.spacing;d=j(g,i);l.margin=d}}f=R({align:"right",text:null,spacing:5},f);var e;(function(){var l=X.rect(b),d=f.text||a.getCopy();e=X.create("div","t5-copyright",{position:"absolute",overflow:"hidden","max-width":Math.max(l.w>>1,Math.min(400,l.w-f.spacing*2))+"px","z-index":49});
b.childNodes[0]?b.insertBefore(e,b.childNodes[0]):b.appendChild(e);d&&h(d)})();c=R(new Aa(a),{getText:function(){return e?e.innerHTML:""},setText:h});c.bind("detach",function(){e&&b.removeChild(e)});f.text||a.bind("copyright",k);return c});R(W,{ex:R,log:La,observable:da,configurable:sa,formatter:Y,wordExists:function(a,c){for(var b=a.split(/\s|\,/).length;b--;)if(a.toLowerCase()==c.toLowerCase())return true;return false},is:$,indexOf:Ma,fn:function(a){return Qb("fn",a)},project:lb,unproject:tb,getImage:nb,
Registry:Ga,Style:Cb,DOM:X,Rect:pa,XY:aa,GeoXY:na,Line:wa,Hits:Hits,Control:Aa,Tile:Ta,Tweener:Fa,ViewLayer:Ba,View:Mb,Map:function(a,c){function b(g,j){var n=i.viewport();if(g){n=y(g.bestZoomLevel(n.w,n.h)-1,j||0);return f(n).center(g.center())}else return new GeoJS.BBox((new na(n.x,n.y2)).sync(i,true).pos(),(new na(n.x2,n.y)).sync(i,true).pos())}function f(g,j,n){if($(g,Ja)){g=y(c.minZoom,x(c.maxZoom,g|0));if(g!==e){var p=i.viewport(),v=i.offset(),C=p.w/2;p=p.h/2;var G=z(2,g-e),P=C/G|0,u=p/G|0;
e=g;i.offset(((j||v.x+C)-P)*G,((n||v.y+p)-u)*G);i.trigger("zoom",g);i.trigger("reset");h=i.rpp=oa/(256<<e);i.setMaxOffset(oa/h|0,oa/h|0,true,false);i.scale(1+l,false,true);l=0;i.trigger("resync");i.refresh()}return i}else return e}c=R({controls:["zoombar","copyright"],minZoom:1,maxZoom:18,renderer:"canvas/dom",zoom:1,zoombar:{}},c);var k=new na,h,e=c.zoom||c.zoomLevel,l=0,d=0,i=R(new Mb(a,c),{XY:na,bounds:b,zoom:f});h=i.rpp=oa/(256<<e);i.bind("refresh",function(){var g=i.viewport();if(k.x!=g.x||k.y!=
g.y){i.trigger("boundsChange",b());k.x=g.x;k.y=g.y}});i.bind("scaleChanged",function(g,j){var n=ba(j)/Math.LN2|0;if(n!==0){l=j-z(2,n);clearTimeout(d);d=setTimeout(function(){f(e+n)},500)}});return i}});if(typeof module!="undefined"&&module.exports)module.exports=W;W.Decarta=function(){function a(u){return n(e.clientName,e.clientPassword,e.sessionID,e.configuration,e.release,u)}function c(u,E){return p(u.maxResponses,u.version,u.requestID,u.methodName,E)}function b(u,E){e.server||W.log("No server configured for deCarta - we are going to have issues",
"warn");return v(e.server,u.requestID,escape(E))}function f(u,E,A){La("making request: "+a(c(u,u.getRequestBody())));Wa(b(u,a(c(u,u.getRequestBody()))),function(m){console.log(m.response);var s=m.response.XLS.Response;if(s.numberOfResponses>0&&s[u.methodName+"Response"]){m=[];if(u.parseResponse)m=u.parseResponse(s[u.methodName+"Response"]);E&&E.apply(null,m)}else A&&A("Server returned no responses",m.response)})}function k(u,E){var A=new C({json:u.StreetAddress}),m=[];if(u.Place){if(!u.Place.length)u.Place=
[u.Place];for(var s=u.Place.length;s--;)m[m.length]=u.Place[s].content}return{building:A.building,street:A.street,regions:m,countryCode:u.countryCode||"",postalCode:u.PostalCode||"",pos:E}}function h(u){if(!u)return"";u=u.toUpperCase();if(!i){var E=[],A;for(A in g)E.push(A);i=RegExp("(\\s)("+E.join("|")+")(\\s|$)","i")}i.lastIndex=-1;if(E=i.exec(u))u=u.replace(i,"$1"+g[E[2]]);return u}var e={sessionID:(new Date).getTime(),server:"",clientName:"",clientPassword:"",configuration:"",maxResponses:25,
release:"4.4.2sp03",tileFormat:"PNG",fixedGrid:true,useCache:true,tileHosts:[],requestTimeout:3E4,geocoding:{countryCode:"US",language:"EN"},routing:{rulesFile:"maneuver-rules"}};TL=function(){function u(A,m){if(typeof A=="number"){this.days=A||0;this.seconds=m||0}else if(typeof A!="undefined"){this.days=A.days||0;this.seconds=A.seconds||0}}u.prototype={add:function(){for(var A=new u(this.days,this.seconds),m=arguments.length;m--;){A.days+=arguments[m].days;A.seconds+=arguments[m].seconds}return A},
toString:function(){var A,m,s,r="";if(this.days)r=this.days+" days ";if(this.seconds){s=this.seconds;if(s>=3600){A=~~(s/3600);s-=A*3600}if(s>=60){m=Math.round(s/60);s-=m*60}if(A)r=r+A+(A>1?" hrs ":" hr ")+(m?(m>10?m:"0"+m)+" min ":"");else if(m)r=r+m+" min";else if(s>0)r=r+(s>10?s:"0"+s)+" sec"}return r}};var E=function(){var A=/^P(\d+Y)?(\d+M)?(\d+D)?$/,m=/^(\d+H)?(\d+M)?(\d+S)?$/,s={8601:function(r){r=r.split("T");var w=null;w=null;var B=0,F=0;A.lastIndex=-1;w=A.exec(r[0]);B+=w[3]?parseInt(w[3].slice(0,
-1),10):0;m.lastIndex=-1;w=m.exec(r[1]);F+=w[1]?parseInt(w[1].slice(0,-1),10)*3600:0;F+=w[2]?parseInt(w[2].slice(0,-1),10)*60:0;F+=w[3]?parseInt(w[3].slice(0,-1),10):0;return new u(B,F)}};return function(r,w){var B=s[w];if(!B)throw"No parser found for the duration format: "+w;return B(r)}}();return{Duration:u,parse:E}}();var l=/^(\d+).*$/,d=/(\d+)\s?\-\s?(\d+)/,i=null,g={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",HWY:"HIGHWAY",MWY:"MOTORWAY"},j=1,n=Y("<xls:XLS version='1' xls:lang='en' xmlns:xls='http://www.opengis.net/xls' rel='{4}' xmlns:gml='http://www.opengis.net/gml'><xls:RequestHeader clientName='{0}' clientPassword='{1}' sessionID='{2}' configuration='{3}' />{5}</xls:XLS>"),
p=Y("<xls:Request maximumResponses='{0}' version='{1}' requestID='{2}' methodName='{3}Request'>{4}</xls:Request>"),v=Y("{0}/JSON?reqID={1}&chunkNo=1&numChunks=1&data={2}&responseFormat=JSON"),C=function(u){u=W.ex({json:{}},u);var E="",A="";if(u.json.Street)E=u.json.Street.content?u.json.Street.content:u.json.Street;E=E&&E.replace?E.replace(/\/\d+$/,""):"";if(u.json.Building)if(u.json.Building.number)A=u.json.Building.number;return{building:A,street:E,calcMatchPercentage:function(m){var s=0,r=h(m),
w=h(E);if(u.json.Building){a:{var B=u.json.Building.number.toString();l.lastIndex=-1;if(l.test(m)){m=m.replace(l,"$1");B=B.split(",");for(var F=0;F<B.length;F++){d.lastIndex=-1;if(d.test(B[F])){var I=d.exec(B[F]);if(m>=parseInt(I[1],10)&&m<=parseInt(I[2],10)){m=true;break a}}else if(m==B[F]){m=true;break a}}}m=false}if(m)s+=0.2}if(r&&w&&W.wordExists(r,w))s+=0.8;return s},toString:function(){if(E)return(A?A+" ":"")+E;return""}}},G=function(){return{methodName:"",maxResponses:25,version:"1.0",requestID:j++,
getRequestBody:function(){return""},parseResponse:function(u){return[u]}}},P=function(){return W.ex(new G,{methodName:"RUOK",parseResponse:function(u){return[{aliasCount:u.maxHostAliases,host:u.hostName}]}})};W.Registry.register("generator","decarta",function(u,E){function A(r,w){var B=u.zoom?u.zoom():0,F=u.viewport();if(B){var I=2<<B-1,T=I>>1,O=E.tileSize,V=(F.w/O|0)+1,H=(F.h/O|0)+1,S=(F.x/O|0)-T;F=I-(F.y/O|0)-T-H;var N=r.search({x:(T+S)*O,y:(T+F*-1-H)*O,w:V*O,h:H*O});I={};var ea=s.hosts,J;for(J=
N.length;J--;)I[N[J].id]=true;for(N=0;N<=V;N++)for(J=0;J<=H;J++){var Q=S+N,L=F+J-1,Z=Q+"_"+L;if(!I[Z]){Q=new W.Tile((T+S+N)*O,(T+F*-1-J)*O,ea[N%ea.length]+"/openls/image-cache/TILE?LLMIN=0.0,0.0&LLMAX="+m[B]+"&CACHEABLE=true&DS=navteq-world&WIDTH=256&HEIGHT=256&CLIENTNAME="+s.clientName+"&SESSIONID="+s.sessionID+"&FORMAT=PNG&CONFIG="+s.configuration+"&N="+L+"&E="+Q,O,O,Z);r.insert(Q,Q)}}w&&w()}}E=W.ex({tileSize:256},E);var m=["89.787438015348100000,360.00000000000000000","85.084059050110410000,180.00000000000000000",
"66.653475896509040000,90.00000000000000000","41.170427238429790000,45.000000000000000000","22.076741328793200000,22.500000000000000000","11.251819676168665000,11.250000000000000000","5.653589942659626000,5.625000000000000000","2.830287664051185000,2.812500000000000000","1.415581451872543800,1.406250000000000000","0.707845460801532700,0.703125000000000000","0.353929573271679340,0.351562500000000000","0.176965641673330230,0.175781250000000000","0.088482927761462040,0.087890625000000000","0.044241477246363230,0.043945312500000000",
"0.022120740293895182,0.021972656250000000","0.011060370355776452,0.010986328125000000","0.005530185203987857,0.005493164062500000","0.002765092605263539,0.002746582031250000","0.001382546303032519,0.001373291015625000","0.000691272945568983,0.000686645507812500","0.000345636472797214,0.000343322753906250"],s=e.tileConfig;u.addCopy("&copy; deCarta, Inc. Map and Imagery Data &copy; NAVTEQ or Tele Atlas or DigitalGlobe");return{run:function(r,w){if(s)A(r,w);else{var B=e.clientName.replace(/.*?\:/,"");
W.Decarta.getTileConfig(B,function(F){s=F;A(r,w)})}},setTileConfig:function(r){s=r}}});W.Registry.register("service","geocoder",function(){var u=W.formatter('<xls:GeocodeRequest><xls:Address countryCode="{0}" language="{1}">{2}</xls:Address></xls:GeocodeRequest>'),E=W.formatter('<xls:StreetAddress><xls:Building number="{0}" /><xls:Street>{1}</xls:Street></xls:StreetAddress>'),A=function(s,r){r=W.ex({countryCode:e.geocoding.countryCode,language:e.geocoding.language},r);var w=new G;return W.ex({},w,
{methodName:"Geocode",getRequestBody:function(){var B=E(s.number,s.street);B+='<xls:Place type="Municipality">'+s.regions.join(" ")+"</xls:Place>";return u(r.countryCode,r.language,B)},parseResponse:function(B){var F=B.GeocodeResponseList;B=[];var I=F?F.numberOfGeocodedAddresses:0,T=[];if(I>1)T=F.GeocodedAddress;else if(I==1)T=[F.GeocodedAddress];for(F=0;T&&F<T.length;F++){I=T[F];var O=null,V=null;if(I&&I.GeocodeMatchCode&&I.GeocodeMatchCode.matchType!=="NO_MATCH"){if(I&&I.Point)V=new GeoJS.Pos(I.Point.pos);
if(I&&I.Address)O=k(I.Address,V)}(I=O)&&B.push(I)}return[B]}})},m=function(s){s=W.ex({position:null,geocodePreference:"StreetAddress"},s);return W.ex(new G,{methodName:"ReverseGeocode",getRequestBody:function(){return"<xls:ReverseGeocodeRequest><xls:Position><gml:Point><gml:pos>"+s.position.toString()+"</gml:pos></gml:Point></xls:Position><xls:ReverseGeocodePreference>"+s.geocodePreference+"</xls:ReverseGeocodePreference></xls:ReverseGeocodeRequest>"},parseResponse:function(r){var w=null;if(r&&r.Point)w=
new GeoJS.Pos(match.Point.pos);if(r&&r.ReverseGeocodedLocation&&r.ReverseGeocodedLocation.Address)return[k(r.ReverseGeocodedLocation.Address,w)];return[]}})};typeof ADDR==="undefined"&&W.log("Sidelab addressing module not found, geocoder will not function","warn");return{forward:function(s,r){f(new A(s),function(w){r(s,w)})},reverse:function(s,r){var w=new m({position:s});f(w,function(B){r&&r(B)})}}});W.Registry.register("service","routing",function(){var u=function(E,A){A=W.ex({provideRouteHandle:false,
distanceUnit:"KM",routeQueryType:"RMAN",preference:"Fastest",routeInstructions:true,routeGeometry:true,rulesFile:"maneuver-rules"},A);var m=new G,s=W.formatter('<xls:DetermineRouteRequest provideRouteHandle="{0}" distanceUnit="{1}" routeQueryType="{2}">'),r=W.formatter("<xls:{0}><xls:Position><gml:Point><gml:pos>{1}</gml:pos></gml:Point></xls:Position></xls:{0}>"),w=W.formatter('<xls:RouteInstructionsRequest rules="{0}" providePoint="true" />');return W.ex({},m,{methodName:"DetermineRoute",getRequestBody:function(){if(E.length<
2)throw Error("Cannot send RouteRequest, less than 2 waypoints specified");var B=s(A.provideRouteHandle,A.distanceUnit,A.routeQueryType);B+="<xls:RoutePlan>";B+="<xls:RoutePreference>"+A.preference+"</xls:RoutePreference>";B+="<xls:WayPointList>";for(var F=0;F<E.length;F++)B+=r(F===0?"StartPoint":F===E.length-1?"EndPoint":"ViaPoint",E[F].toString());B+="</xls:WayPointList>";B+="</xls:RoutePlan>";if(A.routeInstructions)B+=w(A.rulesFile);if(A.routeGeometry)B+="<xls:RouteGeometryRequest />";B+="</xls:DetermineRouteRequest>";
return B},parseResponse:function(B){var F=B.RouteGeometry.LineString.pos,I=B.RouteInstructionsList;B=[];I=I&&I.RouteInstruction?I.RouteInstruction:[];for(var T=0;T<I.length;T++){var O=I[T].distance;B.push({text:I[T].Instruction,latlng:I[T].Point,distance:O.value+(O.uom||"M").toUpperCase(),time:TL.parse(I[T].duration,"8601")})}return[F,B]}})};return{calculate:function(E,A,m,s){s=W.ex({preference:"Fastest",rulesFile:"maneuver-rules"},e.routing,s);E=new u(E,s);f(E,A,m)}}});return{applyConfig:function(u){W.ex(e,
u)},getTileConfig:function(u,E){f(new P,function(A){var m=e.clientName.replace(/\:.*/,":"+(u||""));hosts=[];if(A.aliasCount)for(var s=0;s<A.aliasCount;s++)hosts[s]="http://"+A.host.replace("^(.*?).(.*)$","\u0001-0"+(s+1)+".\u0002");else hosts=["http://"+A.host];E({hosts:hosts,clientName:m,sessionID:e.sessionID,configuration:e.configuration})})},setTileConfig:function(u){e.tileConfig=u},compareFns:function(){return{streetDetails:function(u,E){return E.calcMatchPercentage(u)},location:function(u,E){return E.calcMatchPercentage(u)}}}()}}()})();
