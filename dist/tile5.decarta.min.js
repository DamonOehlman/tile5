(function(qb){function N(){var a=arguments[0]||{},c=Array.prototype.slice.call(arguments,1),b,g;for(g=c.length;g--;)if((b=c[g])!==null)for(var i in b){var e=b[i];if(a!==e)if(e!==undefined)a[i]=e}return a}function $(a,c){if(typeof console!=="undefined")console[c||"debug"](a)}function ga(a){var c=a.match(Hb),b=[],g=0,i;for(i=c?c.length:0;i--;){var e=c[i].slice(1);b[e]||(b[e]=RegExp("\\{"+e+"\\}","g"))}g=b.length;return function(){var j=a;for(i=0;i<g;i++)j=j.replace(b[i],arguments[i]||"");return j}}
function Ib(a){a=a.replace(/[\-\_\s\.]/g,"").toLowerCase();return Ja[a]||Ja.linear}function Jb(a,c,b,g,i){function e(h){h=h?h:(new Date).getTime();var k=h-j,f=b(k,a,d,g),r=j+g<=h;h=!r;if(i){k=i(f,r,k);h=typeof k!="undefined"?k&&h:h}h&&animFrame(e)}var j=(new Date).getTime(),d=c-a;animFrame(e);return{}}function rb(a,c){var b=Pa*wa(a);return Ka-2*sb(c*xa((1-b)/(1+b),Pa/2))}function ha(a,c){this.x=a||0;this.y=c||0}function aa(a,c){this.mercY=this.mercX=null;if(T(a,ya))tb.parseXY(a,this);else if(a&&a.toPixels){var b=
a.toPixels();this.mercX=b.x;this.mercY=b.y}else ha.call(this,a,c)}function qa(a,c,b,g){this.x=a||0;this.y=c||0;this.w=b||0;this.h=g||0;this.x2=this.x+this.w;this.y2=this.y+this.h}function ub(a,c){var b=new vb(Math.sqrt(256<<a)|0);c&&c.zoomLevel===a&&c.copyInto(b);b.zoomLevel=a;return b}function wb(a){a=a||(new Date).getTime();for(var c=0;c<Da.length;){var b=Da[c],g=za[b],i=za[b].image&&za[b].image.complete&&za[b].image.width>0,e=a-g.start;e=i||e>=Kb;if(i){i=g.callbacks;xb[b]=g.image;for(var j=0;j<
i.length;j++)i[j](g.image,true)}if(e){Da.splice(c,1);delete za[b]}else c++}Da.length>0&&animFrame(wb)}function Qa(a,c){var b=a&&c?xb[a]:null;if(b&&b&&b.complete&&b.width>0)c(b);else{if(b=za[a])b.callbacks.push(c);else{b=new Image;b.id="_ldimg"+ ++Lb;za[a]={start:(new Date).getTime(),image:b,callbacks:[c]};b.src=a;Da[Da.length]=a}animFrame(wb)}}function bb(a,c,b,g,i,e){this.x=a;this.y=c;this.w=g||256;this.h=g||256;this.x2=this.x+this.w;this.y2=this.y+this.h;this.url=b;this.id=e||a+"_"+c;this.loaded=
false;this.image=null}function Ra(a,c){c=N({id:"layer_"+Mb++,zindex:0,animated:false,style:null,minXY:null,maxXY:null},c);this.visible=true;this.view=a;ia(N(this,c))}function Sa(){ia(this)}function ja(a,c){if(a&&a.split){var b=a.split(yb);if(b.length>1){a=b[0];c=b[1]}}else if(a&&a.lat){c=a.lon;a=a.lat}this.lat=parseFloat(a||0);this.lon=parseFloat(c||0)}function Ta(a,c){if(T(a,Nb)){for(var b=c,g=this.min=new ja(zb,Ab),i=this.max=new ja(Ob,Pb),e=a.length;e--;){var j=a[e];if(j.lat<g.lat)g.lat=j.lat;
if(j.lat>i.lat)i.lat=j.lat;if(j.lon<g.lon)g.lon=j.lon;if(j.lon>i.lon)i.lon=j.lon}if(T(b,ka)){b=calcSize(bounds.min,bounds.max);b=cb(b.x,b.y)*0.3}this.expand(b)}else{this.min=a;this.max=c}}var db={};(function(a){var c=[],b=0,g=false,i=a.register=function(e,j){c.push({section:e,run:j})};a.init=function(e){function j(){if(b<c.length){var h=c[b++];d[h.section]||(d[h.section]={});h.run(d[h.section],j)}else{for(h in d)a[h]=d[h];g=true;e&&e(a)}}var d={};if(g&&e)e(a);else{b=0;j()}};i("canvas",function(e,
j){function d(){var r,l=h.getContext("2d");l.save();try{l.translate(50,50);l.beginPath();l.rect(0,0,20,20);r=l.isPointInPath(10,10)}finally{l.restore()}return r}var h=document.createElement("canvas"),k=typeof FlashCanvas!="undefined",f=typeof G_vmlCanvasManager!="undefnined";h.width=200;h.height=200;e.pipTransformed=k||f?false:d();j()})})(db);window.animFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||
window.msRequestAnimationFrame||function(a){setTimeout(function(){a((new Date).getTime())},1E3/60)}}();var Hb=/\{(\d+)(?=\})/g,Ja=function(){var a=1.70158,c=Math.PI/2,b=Math.abs,g=Math.pow,i=Math.sin,e=Math.asin,j=Math.cos;return{linear:function(d,h,k,f){return k*d/f+h},backin:function(d,h,k,f){return k*(d/=f)*d*((a+1)*d-a)+h},backout:function(d,h,k,f){return k*((d=d/f-1)*d*((a+1)*d+a)+1)+h},backinout:function(d,h,k,f){return(d/=f/2)<1?k/2*d*d*(((a*=1.525)+1)*d-a)+h:k/2*((d-=2)*d*(((a*=1.525)+1)*
d+a)+2)+h},bouncein:function(d,h,k,f){return k-Ja.bounceout(f-d,0,k,f)+h},bounceout:function(d,h,k,f){return(d/=f)<1/2.75?k*7.5625*d*d+h:d<2/2.75?k*(7.5625*(d-=1.5/2.75)*d+0.75)+h:d<2.5/2.75?k*(7.5625*(d-=2.25/2.75)*d+0.9375)+h:k*(7.5625*(d-=2.625/2.75)*d+0.984375)+h},bounceinout:function(d,h,k,f){return d<f/2?Ja.bouncein(d*2,0,k,f)/2+h:Ja.bounceout(d*2-f,0,k,f)/2+k/2+h},cubicin:function(d,h,k,f){return k*(d/=f)*d*d+h},cubicout:function(d,h,k,f){return k*((d=d/f-1)*d*d+1)+h},cubicinout:function(d,
h,k,f){if((d/=f/2)<1)return k/2*d*d*d+h;return k/2*((d-=2)*d*d+2)+h},elasticin:function(d,h,k,f,r,l){if(d==0)return h;if((d/=f)==1)return h+k;l||(l=f*0.3);if(!r||r<b(k)){r=k;k=l/4}else k=l/ba*e(k/r);return-(r*g(2,10*(d-=1))*i((d*f-k)*ba/l))+h},elasticout:function(d,h,k,f,r,l){var q;if(d==0)return h;if((d/=f)==1)return h+k;l||(l=f*0.3);if(!r||r<b(k)){r=k;q=l/4}else q=l/ba*e(k/r);return r*g(2,-10*d)*i((d*f-q)*ba/l)+k+h},elasticinout:function(d,h,k,f,r,l){var q;if(d==0)return h;if((d/=f/2)==2)return h+
k;l||(l=f*0.3*1.5);if(!r||r<b(k)){r=k;q=l/4}else q=l/ba*e(k/r);if(d<1)return-0.5*r*g(2,10*(d-=1))*i((d*f-q)*ba/l)+h;return r*g(2,-10*(d-=1))*i((d*f-q)*ba/l)*0.5+k+h},quadin:function(d,h,k,f){return k*(d/=f)*d+h},quadout:function(d,h,k,f){return-k*(d/=f)*(d-2)+h},quadinout:function(d,h,k,f){if((d/=f/2)<1)return k/2*d*d+h;return-k/2*(--d*(d-2)-1)+h},sinein:function(d,h,k,f){return-k*j(d/f*c)+k+h},sineout:function(d,h,k,f){return k*i(d/f*c)+h},sineinout:function(d,h,k,f){return-k/2*(j(Math.PI*d/f)-1)+
h}}}();if(typeof animFrame==="undefined")throw Error("animFrame COG required for tweening support");var ia=function(){function a(b,g){var i=b.hasOwnProperty("obsHandlers")?b.obsHandlers:null;i[g]||(i[g]=[]);return i[g]}var c=0;return function(b){if(!b)return null;if(!(b.hasOwnProperty("obsHandlers")?b.obsHandlers:null))b.obsHandlers={};if(!b.hasOwnProperty("bind")){b.bind=function(g,i){var e="callback"+c++;a(b,g).unshift({fn:i,id:e});return e};b.triggerCustom=function(g,i){var e=a(b,g),j={cancel:false,
name:g,source:this},d;for(d in i)j[d]=i[d];if(!e)return null;d=Array.prototype.slice.call(arguments,2);b.eventInterceptor&&b.eventInterceptor(g,j,d);d.unshift(j);for(var h=e.length;h--&&!j.cancel;)e[h].fn.apply(this,d);return j};b.trigger=function(g){var i=Array.prototype.slice.call(arguments,1);i.splice(0,0,g,null);return b.triggerCustom.apply(this,i)};b.unbind=function(g,i){if(typeof g==="undefined")b.obsHandlers={};else for(var e=a(b,g),j=0;e&&j<e.length;j++)if(e[j].id===i){e.splice(j,1);break}return b}}return b}}(),
Qb=function(){function a(c,b,g,i){if(typeof c[i]=="undefined")c[i]=function(e){if(typeof e!="undefined"){b[i]=e;g[i]&&g[i](e);return c}else return b[i]}}return function(c,b,g){for(var i in b)a(c,b,g,i)}}(),eb=Array.prototype.indexOf||function(a){for(var c=0;c<this.length;c++)if(this[c]===a)return c;return-1},T=function(){return function(a,c){c=Rb.call(c);if(c=="finite")return!Sb[Tb](+a);return c=="null"&&a===null||c==typeof a||c=="object"&&a===Object(a)||c=="array"&&Array.isArray&&Array.isArray(a)||
Ub.call(a).slice(8,-1).toLowerCase()==c}}(),Vb=function(){function a(i){var e=document.createElement("script"),j=false;e.src=i;e.async=true;e.onload=e.onreadystatechange=function(){if(!j&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){j=true;e.onload=e.onreadystatechange=null;e&&e.parentNode&&e.parentNode.removeChild(e)}};b||(b=document.getElementsByTagName("head")[0]);b.appendChild(e)}var c=0,b,g=this;return function(i,e,j){i+=i.indexOf("?")>=0?"&":"?";var d="json"+
++c;g[d]=function(h){e(h);g[d]=null;try{delete g[d]}catch(k){}};a(i+(j?j:"callback")+"="+d);return d}}();INTERACT=function(){function a(l){return function(q,t){l.addEventListener(q,t,false)}}function c(l){return function(q,t){l.removeEventListener(q,t,false)}}function b(l){return function(q,t){l.attachEvent("on"+q,t)}}function g(l,q){return{x:l?l:0,y:q?q:0,count:1}}function i(l,q){f.push(N({handler:null,checks:{},type:l},q))}function e(l){var q=0,t=0;if(l.offsetParent){do{q+=l.offsetLeft;t+=l.offsetTop;
l=l.offsetParent}while(l)}return{left:q,top:t}}function j(l,q){return{source:l,target:q.target?q.target:q.srcElement}}function d(l,q){for(var t=l.target?l.target:l.srcElement;t&&t!==q;)t=t.parentNode;return t&&t===q}function h(l,q){return{x:l.x-(q?q.left:0),y:l.y-(q?q.top:0)}}function k(l,q){if(l.preventDefault){l.preventDefault();l.stopPropagation()}else if(typeof l.cancelBubble!="undefined")l.cancelBubble=true;q&&l.stopImmediatePropagation&&l.stopImmediatePropagation()}var f=[],r=function(l,q,t){t=
N({binder:null,unbinder:null,observable:null},t);for(var m=t.observable,u=[],p,v,C={bind:function(){return m.bind.apply(null,arguments)},unbind:function(){m.unbind();for(B=0;B<u.length;B++)u[B].unbind();return C}},B=0;B<q.length;B++)u.push(q[B](l,m,t));m.bind("pointerDown",function(){v=p=0});m.bind("pointerMove",function(n,E,w,x){p+=x.x||0;v+=x.y||0});m.bind("pointerUp",function(n,E,w){Math.abs(p)>20||Math.abs(v)>20||m.triggerCustom("tap",n,E,w)});return C};i("pointer",{handler:function(l,q,t){function m(y){if(y.pageX&&
y.pageY)return g(y.pageX,y.pageY);else{var H=document.documentElement,Q=document.body;return g(y.clientX+(H&&H.scrollLeft||Q&&Q.scrollLeft||0)-(H&&H.clientLeft||Q&&Q.clientLeft||0),y.clientY+(H&&H.scrollTop||Q&&Q.scrollTop||0)-(H&&H.clientTop||Q&&Q.clientTop||0))}}function u(y){if(d(y,l))if(x=B(y)){var H=m(y);l.style.cursor="move";k(y,true);L=H.x;K=H.y;D=g(L,K);q.triggerCustom("pointerDown",j("mouse",y),D,h(D,e(l)))}}function p(y){var H=m(y);z=H.x;F=H.y;if(d(y,l))n(y,x?"pointerMove":"pointerHover")}
function v(y){if(x&&B(y)){x=false;if(d(y,l)){l.style.cursor="default";n(y,"pointerUp")}}}function C(y){if(d(y,l)){var H;y=y||window.event;if(y.detail)H=y.axis===2?-y.detail*E:0;else{H=y.wheelDeltaY?y.wheelDeltaY:y.wheelDelta;if(window.opera)H=-H}if(H!==0){var Q=g(z,F);q.triggerCustom("zoom",j("mouse",y),Q,h(Q,e(l)),H/w,"wheel");k(y);y.returnValue=false}}}function B(y){y=y||window.event;return(y.which||y.button)==1}function n(y,H,Q,W,la){Q=typeof Q!="undefined"?Q:z;W=typeof W!="undefined"?W:F;var I=
Q-L,O=W-K,J=g(Q,W);q.triggerCustom(H,j("mouse",y),J,h(J,e(l)),g(I,O));if(typeof la=="undefined"||la){L=Q;K=W}}t=N({},t);var E=120,w=E*8,x=false,D,z,F,L,K;t.binder("mousedown",u);t.binder("mousemove",p);t.binder("mouseup",v);t.binder("dblclick",function(y){$("captured double click");if(d(y,l)){var H=m(y);q.triggerCustom("doubleTap",j("mouse",y),H,h(H,e(l)))}});t.binder("mousewheel",C);t.binder("DOMMouseScroll",C);return{unbind:function(){t.unbinder("mousedown",u);t.unbinder("mousemove",p);t.unbinder("mouseup",
v);t.unbinder("mousewheel",C);t.unbinder("DOMMouseScroll",C)}}},checks:{touch:false}});i("pointer",{handler:function(l,q,t){function m(I){if(I.count<2)return 0;var O=I.x-I.next.x;I=I.y-I.next.y;return~~Math.sqrt(O*O+I*I)}function u(I,O,J){O=O?O:0;J=J?J:0;for(var Y={x:I.x-O,y:I.y-J,id:I.id,count:I.count},R=Y;I.next;){I=I.next;R=R.next={x:I.x-O,y:I.y-J,id:I.id}}return Y}function p(I,O){var J=I[O?O:"touches"],Y,R;if(J.length===0)return null;R=Y={x:J[0].pageX,y:J[0].pageY,id:J[0].identifier,count:J.length};
for(var S=1,Ea=J.length;S<Ea;S++)R=R.next={x:J[S].pageX,y:J[S].pageY,id:J[S].identifier};return Y}function v(I){if(d(I,l)){F=e(l);var O=p(I,"changedTouches"),J=u(O,F.left,F.top);if(!K){L=x;q.triggerCustom("pointerDown",j("touch",I),O,J)}W&&q.triggerCustom("pointerDownMulti",j("touch",I),O,J);K=p(I);if(K.count>1)H=m(K);la=1;Q=u(K)}}function C(I){if(d(I,l)){k(I);y=p(I);if(L==x)L=Math.abs(K.x-y.x)>E||Math.abs(K.y-y.y)>E?w:x;if(L!=x){L=y.count>1?z:D;if(L==z)if(K.count===1){K=u(y);H=m(K)}else{var O=m(y);
if(Math.abs(H-O)<n)L=D;else{var J;J=y.x;var Y=y.next.x,R=y.y,S=y.next.y;J={x:(J<Y?J:Y)+(Math.abs(J-Y)>>1),y:(R<S?R:S)+(Math.abs(R-S)>>1)};O=O/H;Y=O-la;q.triggerCustom("zoom",j("touch",I),J,h(J,F),Y,"pinch");la=O}}L==D&&q.triggerCustom("pointerMove",j("touch",I),y,u(y,F.left,F.top),g(y.x-Q.x,y.y-Q.y));W&&q.triggerCustom("pointerMoveMulti",j("touch",I),y,u(y,F.left,F.top))}Q=u(y)}}function B(I){if(d(I,l)){var O=p(I,"changedTouches"),J=u(O,F.left,F.top);y=p(I);if(!y){q.triggerCustom("pointerUp",j("touch",
I),O,J);K=null}W&&q.triggerCustom("pointerUpMulti",j("touch",I),O,J)}}t=N({detailed:false,inertia:false},t);var n=20,E=7,w=0,x=1,D=2,z=3,F,L,K,y,H,Q,W=t.detailed,la=1;t.binder("touchstart",v);t.binder("touchmove",C);t.binder("touchend",B);$("initialized touch handler");return{unbind:function(){t.unbinder("touchstart",v);t.unbinder("touchmove",C);t.unbinder("touchend",B)}}},checks:{touch:true}});return{register:i,watch:function(l,q,t){q=N({bindTarget:null,observable:null,isIE:typeof window.attachEvent!=
"undefined",types:null},q);capabilities=N({touch:"ontouchstart"in window},t);if(!q.observable){$("creating observable");q.observable=ia({});globalOpts=q}q.binder=(q.isIE?b:a)(q.bindTarget||document);q.unbinder=(q.isIE?b:c)(q.bindTarget||document);t=q.types;for(var m=capabilities,u=[],p=f.length;p--;){var v=f[p],C=!t||t.indexOf(v.type)>=0,B=true,n;for(n in v.checks){var E=v.checks[n];$("checking "+n+" capability. require: "+E+", capability = "+m[n]);B=B&&E===m[n]}if(C&&B)u[u.length]=v.handler}return new r(l,
u,q)}}}();var fb=function(){var a={};return{create:function(c,b){if(a[c][b])return a[c][b].apply(null,Array.prototype.slice.call(arguments,2))},register:function(c,b,g){a[c]||(a[c]={});a[c][b]&&$(Wb(c,b),"warn");a[c][b]=g}}}(),Wb=ga("Registration of {0}: {1} will override existing definition"),gb=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],ba=Math.PI*2,Ka=Math.PI/2,ma=Math.PI/180,Fa=180/Math.PI,zb=Ka,Ob=-zb,Ab=ba,Pb=-Ab,Pa=0.08181919084262157,ra=Math.abs,
Bb=Math.ceil,La=Math.round,Ua=Math.min,cb=Math.max,xa=Math.pow,Cb=Math.sqrt,Aa=Math.log,wa=Math.sin,Xb=Math.asin,hb=Math.cos,sb=Math.atan,Yb=Math.atan2,Tb="hasOwnProperty",Sb={NaN:1,Infinity:1,"-Infinity":1},Rb=String.prototype.toLowerCase,Ub=Object.prototype.toString,ka="undefined",ya="string",sa="number",Nb="array",ta="drawable",ca=fb.register,Ba=fb.create,Zb=0,Mb=0,yb=/[\,\s]+/,$b=function(){function a(i){g++;i=i||(new Date).getTime();for(var e=b.length;e--;){var j=b[e];g%j.every===0&&j.cb(i)}animFrame(a)}
var c=1E3/60,b=[],g=0;animFrame(a);return{attach:function(i,e){b[b.length]={cb:i,every:e?La(e/c):1}},detact:function(){}}}(),tb=function(){var a=/^xy\((.*)\).*$/i;return{parseXY:function(c,b){b=b||new aa;if(!a.test(c)){var g=c.split(yb);g=Va(g[1],g[0]);b.mercX=g.x;b.mercY=g.y}return b}}}(),X=function(){function a(g){for(var i=0;i<g.length;i++){var e=g[i];if(typeof document.body.style[e]!="undefined")return e}}var c={"-webkit-user-select":"none",position:"absolute"},b;b=a(["-webkit-transform","MozTransform"]);
css3DTransformProp=a(["WebkitPerspective","MozPerspective"]);return{transforms:T(b,ya),create:function(g,i,e){g=document.createElement(g);var j=[];e=e||{};g.className=i||"";for(var d in e)j[j.length]=d+": "+e[d];g.style.cssText=j.join(";");return g},move:function(g,i,e,j){if(b)g.style[b]="translate("+i+"px, "+e+"px) "+(j||[]).join(" ");else{g.style.left=i+"px";g.style.top=e+"px"}},styles:function(g){return N({},c,g)}}}(),Va=Va||function(a,c){var b=parseFloat(c)*ma;b=wa(b);var g=Pa*b;b=Aa((1+b)/(1-
b)*xa((1-g)/(1+g),Pa))/2;return new aa(parseFloat(a)*ma,b)},ib=ib||function(a,c){for(var b=xa(Math.E,-c),g=Ka-2*sb(b),i=rb(g,b),e=0;e<12&&ra(g-i)>1.0E-7;){g=i;i=rb(g,b);e++}return new ja(i*Fa,a%360*Fa)};ha.prototype={constructor:ha,add:function(){for(var a=this.x,c=this.y,b=arguments.length;b--;){a+=arguments[b].x;c+=arguments[b].y}return this.copy(a,c)},copy:function(a,c){var b=N({},this);b.x=a||b.x;b.y=c||b.y;return b},equals:function(a){return this.x===a.x&&this.y===a.y},offset:function(a,c){return this.copy(this.x+
a,this.y+c)},sync:function(){return this},toString:function(){return this.x+", "+this.y}};aa.prototype=N(new ha,{constructor:aa,pos:function(){return ib(this.mercX,this.mercY)},sync:function(a,c){var b;if(!(b=a.rpp)){b=a.zoom();b=ba/(256<<b)}b=b;if(c){this.mercX=this.x*b-Math.PI;this.mercY=Math.PI-this.y*b}else if(this.mercX||this.mercY){this.x=La((this.mercX+Math.PI)/b);this.y=La((Math.PI-this.mercY)/b)}return this}});qa.prototype={constructor:qa,buffer:function(a,c){return new qa(this.x-a,this.y-
(c||a),this.w+a*2,this.h+(c||a)*2)},center:function(){return new ha(this.x+(this.w>>1),this.y+(this.h>>1))}};Hits=function(){return{diffHits:function(a,c){var b=[],g={},i;for(i=c.length;i--;)g[c[i].target.id]=true;for(i=a.length;i--;)g[a[i].target.id]||(b[b.length]=a[i]);return b},init:function(a,c,b,g){return{type:a,x:g.x|0,y:g.y|0,elements:[],absXY:c,relXY:b}},initHit:function(a,c,b){return{type:a,target:c,drag:b}},triggerEvent:function(a,c,b,g){c.triggerCustom(a.type+(b?b:"Hit"),{hitType:a.type},
g?g:a.elements,a.absXY,a.relXY,new aa(a.x,a.y))}}}();var vb=function(a){function c(e,j){var d=b[e],h;d||(d=b[e]=[]);(h=d[j])||(h=d[j]=[]);return h}a=a||128;var b=[],g={},i=0;return{copyInto:function(e){for(var j in g){var d=g[j];e.insert(d.bounds||d,d,j)}},insert:function(e,j,d){var h=e.x/a|0,k=e.y/a|0,f=(e.x+e.w)/a|0;e=(e.y+e.h)/a|0;d=d||j.id||"obj_"+i++;g[d]=j;for(j=h;j<=f;j++)for(h=k;h<=e;h++)c(j,h).push(d)},remove:function(e,j,d){d=d||j.id;if(g[d]){var h=e.x/a|0;j=e.y/a|0;var k=(e.x+e.w)/a|0;
e=(e.y+e.h)/a|0;delete g[d];for(h=h;h<=k;h++)for(var f=j;f<=e;f++){var r=c(h,f),l=eb.call(r,d);l>=0&&r.splice(l,1)}}},search:function(e){var j=e.y/a|0,d=(e.x+e.w)/a|0,h=(e.y+e.h)/a|0,k=[],f=[];for(e=e.x/a|0;e<=d;e++)for(var r=j;r<=h;r++)k=k.concat(c(e,r));k.sort();for(j=k.length;j--;){d=k[j];if(h=g[d])f[f.length]=h;for(;j>0&&k[j-1]==d;)j--}return f}}},Kb=3E4,xb={},Lb=0;(new Date).getTime();var za={},Da=[];bb.prototype={constructor:bb,load:function(a){var c=this;Qa(this.url,function(b){c.loaded=true;
c.image=b;a&&a()})}};var ac=function(){return ia({fastpan:true,applyStyle:function(){},applyTransform:function(a,c,b){return{restore:null,x:c,y:b}},checkSize:function(){},getDimensions:function(){return{width:0,height:0}},getViewport:function(){},hitTest:function(){return false},prepare:function(){},projectXY:null,reset:function(){}})};ca("renderer","canvas",function(a,c,b,g,i){function e(n,E,w){var x,D;q[E]=function(z){for(x=C.length;x--;)if(D=w[C[x]])z[B[x]]=D}}function j(n,E,w){var x=false;if(E)x=
f.isPointInPath(m?E.x-r:E.relXY.x,m?E.y-l:E.relXY.y);return{draw:w||v,viewport:n,hit:x,vpX:r,vpY:l,context:f}}g=N({},g);var d,h,k,f,r=0,l=0,q={},t=null,m=db.canvas.pipTransformed,u={},p=function(){},v=function(){this.fill&&f.fill();this.stroke&&f.stroke()},C=["fill","stroke","lineWidth","opacity"],B=["fillStyle","strokeStyle","lineWidth","globalAlpha"];if(c){d=c.offsetWidth;h=c.offsetHeight;k=X.create("canvas",null,{position:"absolute","z-index":1});k.width=d;k.height=h;a.attachFrame(k,true);f=null}b=
N(i,{applyStyle:function(n){var E=q[n],w=f&&f.canvas?f.canvas.id:"default",x;u[w]||(u[w]=[]);x=u[w].pop()||"basic";if(E){u[w].push(n);E(f);return x}},applyTransform:function(n){if(n.translateX!==0||n.translateY!==0||n.scaling!==1||n.rotation!==0){f.save();t={undo:function(){f.restore();t=null},x:n.xy.x,y:n.xy.y};f.translate(n.xy.x-r+n.translateX,n.xy.y-l+n.translateY);n.rotation!==0&&f.rotate(n.rotation);n.scaling!==1&&f.scale(n.scaling,n.scaling)}return t},drawTiles:function(n,E,w){for(var x,D=r-
256,z=l-256,F=n.x2,L=n.y2,K=E.length;K--;){n=E[K];if(x=n.x>=D&&n.x<=F&&n.y>=z&&n.y<=L)if(!n.loaded&&w)n.load(a.invalidate);else n.image&&f.drawImage(n.image,n.x-r,n.y-l)}},prepare:function(n,E){var w,x=false,D=E.scaled||E;if(f)f.restore();else f=k.getContext("2d");for(w=n.length;w--;)x=x||n[w].clip;r=D.x;l=D.y;if(f){x||f.clearRect(0,0,d,h);f.save()}f.globalCompositeOperation="source-over";return f},prepArc:function(n,E,w){f.beginPath();f.arc(n.xy.x-(t?t.x:r),n.xy.y-(t?t.y:l),n.size>>1,n.startAngle,
n.endAngle,false);return j(E,w)},prepImage:function(n,E,w,x){var D=(x.x||n.xy.x)-(t?t.x:r),z=(x.y||n.xy.y)-(t?t.y:l),F=x.image||n.image;if(F){f.beginPath();f.rect(D,z,x.width||F.width,x.height||F.height);return j(E,w,function(){f.drawImage(F,D,z,x.width||F.width,x.height||F.height)})}},prepMarker:function(n,E,w){var x=n.xy.x-(t?t.x:r),D=n.xy.y-(t?t.y:l),z=n.size,F=undefined;f.beginPath();switch(n.markerStyle.toLowerCase()){case "image":F=p;f.rect(x-(z>>1),D-(z>>1),z,z);if(n.reset&&n.image){n.image=
null;n.reset=false}n.image?f.drawImage(n.image,x-(z>>1),D-(z>>1),z,z):Qa(n.imageUrl,function(L){n.image=L;f.drawImage(n.image,x-(z>>1),D-(z>>1),z,z)});break;default:f.moveTo(x,D);f.lineTo(x-(z>>1),D-z);f.lineTo(x+(z>>1),D-z);f.lineTo(x,D)}return j(E,w,F)},prepPoly:function(n,E,w,x){var D=true;n=x.points||n.points;x=t?t.x:r;var z=t?t.y:l;f.beginPath();for(var F=n.length;F--;){var L=n[F].x-x,K=n[F].y-z;if(D){f.moveTo(L,K);D=false}else f.lineTo(L,K)}return j(E,w)},getContext:function(){return f}});(function(){for(var n in G.styles)e(null,
n,G.styles[n]);Db.bind("defined",e)})();b.bind("detach",function(){c.removeChild(k)});return b});ca("renderer","dom",function(a,c,b,g,i){function e(f){var r=f.image=new Image;h[f.id]=f;r.src=f.url;r.onload=function(){if(k[f.id])d.appendChild(this);else f.image=null};r.style.cssText="-webkit-user-select: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute;";
return r}function j(f,r,l){var q=[],t;for(t in f){var m=f[t];if(l?m[l]:!r[t]){if(m.image&&m.image.parentNode){d.removeChild(m.image);m.image=null}q[q.length]=t}}for(r=q.length;r--;)delete f[q[r]]}var d=null,h={},k={};d=X.create("div","",X.styles({width:c.offsetWidth+"px",height:c.offsetHeight+"px"}));c.childNodes.length>0?c.insertBefore(d,c.childNodes[0]):c.appendChild(d);a.attachFrame(d);a=N(i,{drawTiles:function(f,r,l){for(var q,t=f.x,m=f.y,u=r.length;u--;){f=r[u];if(f.url){(q=f.image||(l?e(f):
null))&&X.move(q,f.x-t,f.y-m);k[f.id]=f}}}});a.bind("predraw",function(){j(h,k);k={}});a.bind("detach",function(){c.removeChild(d)});a.bind("reset",function(){for(j(h,k={});d.childNodes.length>0;)d.removeChild(d.childNodes[0])});return a});var Db=function(){function a(g,i){if(T(g,ya)){b.trigger("defined",g,c[g]=i);return g}else{var e=[],j;for(j in g)e[e.length]=a(j,g[j]);return e}}var c={},b=ia({get:function(g){return c[g]},define:a});a({basic:{fill:"#ffffff"},highlight:{fill:"#ff0000"},waypoints:{lineWidth:4,
stroke:"#003377",fill:"#ffffff"},waypointsHover:{lineWidth:4,stroke:"#ff0000",fill:"#ffffff"}});return b}();ca("view","map",function(a){function c(o,s,A,M){E(Ua(cb(V+xa(2,M)-1,0.5),2),false,true)}function b(o,s){var A=renderer&&renderer.projectXY?renderer.projectXY(o,s):null;if(!A){A=P.getViewport();var M=1/V;A=new aa(A?A.x+o*M:o,A?A.y+s*M:s)}return A.sync(P,true)}function g(o,s,A){w("doubleTap",s,A,b(A.x,A.y));a.scalable&&E(2,{easing:"quad.out",duration:300},true)}function i(o,s,A){H=null;I=true;
m("down",s,A)}function e(o,s,A){m("hover",s,A)}function j(o,s,A,M){l(s,A,false);if(!H){O=M.x;J=M.y}}function d(o,s,A){l(s,A,true);I=false}function h(){clearTimeout(Eb);Eb=setTimeout(function(){renderer.checkSize()},250)}function k(o,s,A){m("tap",s,A);P.trigger("tap",s,A,b(A.x,A.y,true))}function f(o){var s=P,A=L,M=y,U=a;o=(o||a.renderer).split("/");for(var da=new ac(s,A,M,U),na=0;na<o.length;na++)da=Ba("renderer",o[na],s,A,M,U,da);renderer=da;la=renderer.fastpan&&X.transforms;r()}function r(){fa&&
fa.unbind();if(renderer){fa=INTERACT.watch(renderer.interactTarget||y);if(a.scalable){fa.bind("zoom",c);fa.bind("doubleTap",g)}fa.bind("pointerDown",i);fa.bind("pointerMove",j);fa.bind("pointerUp",d);a.captureHover&&fa.bind("pointerHover",e);fa.bind("tap",k)}}function l(o,s,A){if(H){o=b(s.x,s.y);H.drag.call(H.target,H,o.x,o.y,A)&&Z++;if(A)H=null}}function q(o){for(var s=F;s--;)if(z[s].id===o)return s;return F}function t(o){y=document.getElementById(o);y.appendChild(K=X.create("div","",X.styles({overflow:"hidden",
width:y.offsetWidth+"px",height:y.offsetHeight+"px"})));Wa=K.offsetWidth+oa*2;Xa=K.offsetHeight+oa*2;jb=Wa/2;kb=Xa/2;lb=y.offsetWidth/2;mb=y.offsetHeight/2;K.appendChild(L=X.create("div","",X.styles({width:Wa+"px",height:Xa+"px","z-index":2,margin:-oa+"px 0 0 "+-oa+"px"})));f()}function m(o,s,A){ea=Hits.init(o,s,A,b(A.x,A.y,true));for(o=F;o--;)W=W||(z[o].hitGuess?z[o].hitGuess(ea.x,ea.y,P):false);W&&Z++}function u(o){var s=C();return o?p(o.bestZoomLevel(s)).center(o.center()):new Ta((new aa(s.x,s.y2)).sync(P,
true).pos(),(new aa(s.x2,s.y)).sync(P,true).pos())}function p(o,s,A){if(T(o,sa)){o=cb(a.minZoom,Ua(a.maxZoom,o|0));if(o!==Ga){var M=xa(2,o-Ga),U=jb/M|0,da=kb/M|0;Ga=o;x(((s||R+jb)-U)*M,((A||S+kb)-da)*M);nb=ob=0;P.trigger("zoom",o);rpp=P.rpp=ba/(256<<Ga);v(ba/rpp|0,ba/rpp|0,true,false);V=1;P.trigger("resync");renderer.trigger("reset");n()}return P}else return Ga}function v(o,s,A,M){Ha=o;Ia=s;Ya=A;Za=M}function C(){var o=new qa(R,S,Wa,Xa);o.scaleFactor=V;return o}function B(o,s,A){if(T(o,ya)&&T(s,ka))for(s=
0;s<F;s++){if(z[s].id===o)return z[s]}else if(T(o,ya)){s=Ba("layer",s,P,A);s.added=(new Date).getTime();s.id=o;z[q(o)]=s;z.sort(function(M,U){return U.zindex-M.zindex||U.added-M.added});F=z.length;P.trigger("resync");n();P.trigger("layerChange",P,s);Z++;return s}else return[].concat(z)}function n(){var o=C();if(o){if(Ha||Ia)if(o){var s=Ya?R+(o.w>>1):R,A=Za?S+(o.h>>1):S,M=o.w,U=o.h;if(Ha&&Ha>M)if(s+M>Ha)R=Ya?R:Ha-M;else if(s<0)R=Ya?R:0;if(Ia&&Ia>U)if(A+U>Ia)S=Za?S:Ia-U;else if(A<0)S=Za?S:0}ob=R;nb=
S;if($a.x!=o.x||$a.y!=o.y){P.trigger("boundsChange",u());$a.x=o.x;$a.y=o.y}P.trigger("refresh",P,o);Z++}}function E(o,s,A){if(T(o,sa)){var M=A?o:V*o;if(!bc){s=null;o=La(Aa(M)/Math.LN2);M=xa(2,o)}if(s)Ma=pa.tween([V],[M],s,function(){V=M;Ma=null;Z++});else{V=M;Z++}return P}else return V}function w(){for(var o=P.trigger.apply(null,arguments).cancel,s=z.length;s--;)o=z[s].trigger.apply(null,arguments).cancel||o;return!o}function x(o,s,A){if(T(o,sa)){if(A)ua=pa.tween([R,S],[o,s],A,function(){ua=null});
else{R=o|0;S=s|0}return P}else return(new aa(R,S)).sync(P,true)}a=N({container:"",captureHover:true,controls:["zoombar"],drawOnScale:true,padding:50,inertia:true,refreshDistance:256,pannable:true,scalable:true,minZoom:1,maxZoom:18,renderer:"canvas/dom",zoom:1,zoombar:{}},a);var D=[],z=[],F=0,L=null,K=null,y,H=null,Q=!T(window.attachEvent,ka),W=false,la=true,I=false,O=0,J=0,Y=a.refreshDistance,R=0,S=0,Ea=0,ab=0,ob=0,nb=0,Ha=null,Ia=null,Ya=false,Za=false,ua=null,oa=a.padding,ea=null,Na=null,Eb=0,va=
0,Oa=null,V=1,Ma=null,Fb=1,$a=new aa,fa=null,pb={index:0,draw:false},bc=true,Z=0,Wa,Xa,jb,kb,lb,mb,Ga=a.zoom||a.zoomLevel,P={XY:aa,id:a.id,padding:oa,panSpeed:0,attachFrame:function(o,s){s&&L.appendChild(o)},bounds:u,center:function(o,s,A){if(T(o,ya)){s=tb.parseXY(o).sync(P);o=s.x;s=s.y}if(T(o,sa)){x(o-lb-oa,s-mb-oa,A);return P}else return x().offset(lb+oa|0,mb+oa|0).sync(P,true)},detach:function(){renderer&&renderer.trigger("detach");fa&&fa.unbind();if(K){y.removeChild(K);L=K=null}},layer:B,invalidate:function(){Z++},
pan:function(o,s,A){x(R+o,S+s,A)},refresh:n,rotate:function(o,s,A){if(T(o,sa)){var M=A?o:va+o;if(s)Oa=pa.tween([va],[M],s,function(){va=M%360;Oa=null;Z++});else{va=M%360;Z++}return P}else return va},scale:E,triggerAll:w,setMaxOffset:v,getViewport:C,offset:x,zoom:p};ia(P);P.bind("resize",function(){renderer.checkSize()});P.bind("layerRemove",function(o,s){var A=eb(z,s.id);if(A>=0&&A<F){z.splice(A,1);Z++}F=z.length});Qb(P,a,{container:t,captureHover:r,scalable:r,pannable:r,renderer:function(o){if(renderer){renderer.trigger("detach");
renderer=null}f(o);Z++}});db.init(function(){B("markers","draw",{zindex:20});t(a.container);Q?window.attachEvent("onresize",h):window.addEventListener("resize",h,false)});$b.attach(function(o){var s=[],A,M,U;self.panSpeed=panSpeed=ra(O)+ra(J);A=V!==Fb;if(panSpeed>0||A||ua||Ma||Oa){Z++;if(ua&&panSpeed>0){ua(true);ua=null}}if(panSpeed<2&&(ra(R-ob)>=Y||ra(S-nb)>=Y))n();pb.index++;pb.draw=Z||panSpeed||0;if(renderer&&pb.draw){if(Ma)V=Ma()[0];if(Oa)va=Oa()[0];Ea+=O;ab+=J;if(O||J)P.trigger("pan");if(X.transforms){if(V!==
1)s[s.length]="scale("+V+")";if(va!==0)s[s.length]="rotate("+va+"deg)"}if(A=!la||(a.drawOnScale||V===1)&&panSpeed<5){if(ua){A=ua();R=A[0]|0;S=A[1]|0}else{R=R-Ea/V|0;S=S-ab/V|0}U=C();renderer.trigger("predraw",U);if(renderer.prepare(z,U,o,ea)){M=ab=A=Ea=Z=0;for(ii=F;ii--;){var da=z[ii];if(da.visible){var na=da.style?renderer.applyStyle(da.style,true):null;da.draw(renderer,U,P,o,ea);na&&renderer.applyStyle(na)}}renderer.trigger("render",U);P.trigger("drawComplete",U,o);Fb=V;X.move(L,A,M,s)}}else X.move(L,
Ea,ab,s);if(I||!a.inertia)J=O=0;else if(O!=0||J!=0){O*=0.8;J*=0.8;if(ra(O)<0.5)O=0;if(ra(J)<0.5)J=0}if(ea){o=ea?ea.elements:[];if(Na&&Na.type==="hover"){s=Hits.diffHits(Na.elements,o);s.length>0&&Hits.triggerEvent(Na,P,"Out",s)}if(o.length>0){A=ea.x;M=ea.y;for(s=o.length;s--;){U=o[s];da=A;na=M;var Gb=U&&U.drag&&(!U.canDrag||U.canDrag(U,da,na));if(Gb){H=U;H.startX=da;H.startY=na}if(Gb)break}Hits.triggerEvent(ea,P)}Na=o.length>0?N({},ea):null;ea=null}o=Aa(V)/Math.LN2|0;if(o!==0){V=xa(2,o);p(Ga+o,void 0,
void 0)}}});(function(o){D=[];for(var s=0;s<o.length;s++)D[D.length]=Ba("control",o[s],P,K,y,a[o[s]])})(a.controls);return P});var pa=function(){return{tween:function(a,c,b,g,i){function e(r){Jb(a[r],c[r],Ib(b.easing),b.duration,function(l,q){d[r]=l;if(q){h++;if(k&&h>=j){var t=g?g():true;if(b.callback&&(T(t,ka)||t))b.callback()}}i&&i.invalidate();return k})}b=N({easing:"sine.out",duration:1E3,callback:g},b);var j=a.length,d=[].concat(a),h=0,k=true,f;for(f=j;f--;)e(f);return function(r){k=!r;return d}},
tweenDrawable:function(a,c,b,g,i){var e=pa.tween([b],[g],i,function(){a[c]=g;for(var d=a.tweens.length;d--;)if(a.tweens[d]===j){a.tweens.splice(d,1);break}},a.view),j=function(){a[c]=e()[0]};return j}}}(),Ca=function(a,c,b){b=N({style:null,xy:null,size:20,fill:false,stroke:true,draggable:false,observable:true,properties:{},typeName:"Shape"},b);N(this,b);if(T(this.xy,ya))this.xy=new a.XY(this.xy);this.id="drawable_"+Zb++;this.bounds=null;this.view=a;this.layer=c;this.tweens=[];this.rotation=this.animations=
0;this.scaling=1;this.translateY=this.translateX=0;this.observable&&ia(this)};Ca.prototype={constructor:Ca,applyTweens:function(){for(var a=this.tweens.length;a--;)this.tweens[a]()},drag:null,draw:null,getProps:null,resync:function(){if(this.xy){this.xy.sync(this.view);if(this.size){var a=this.size>>1;this.updateBounds(new qa(this.xy.x-a,this.xy.y-a,this.size,this.size))}}},rotate:function(a,c,b){if(T(a,sa)){a=(b?a:this.rotation*Fa+a)*ma;if(c)this.tweens.push(pa.tweenDrawable(this,"rotation",this.rotation,
a,c));else{this.rotation=a;this.view.invalidate()}return this}else return this.rotation*Fa},scale:function(a,c,b){if(T(a,sa)){a=b?a:this.scaling*a;if(c)this.tweens.push(pa.tweenDrawable(this,"scaling",this.scaling,a,c));else this.scaling=a;return this}else return this.scaling},translate:function(a,c,b,g){if(T(a,sa)){a=g?a:this.translateX+a;c=g?c:this.translateY+c;if(b){this.tweens.push(pa.tweenDrawable(this,"translateX",this.translateX,a,b));this.tweens.push(pa.tweenDrawable(this,"translateY",this.translateY,
c,b))}else{this.translateX=a;this.translateY=c}return this}else return new ha(this.translateX,this.translateY)},updateBounds:function(a,c){a&&(!this.bounds||a.x!=this.bounds.x||a.y!=this.bounds.y)&&this.trigger("move",this,a,this.bounds);this.bounds=a;if(c)this.xy=this.bounds.center()}};ca(ta,"marker",function(a,c,b){b=N({fill:true,stroke:false,markerStyle:"simple",hoverStyle:"highlight",typeName:"Marker"},b);return new Ca(a,c,b)});ca(ta,"poly",function(a,c,b){b=N({simplify:false,fill:true,points:[],
typeName:"Poly"},b);var g=b.points,i=b.simplify;Ca.call(this,b);N(this,{getPoints:function(){return[].concat(g)},resync:function(){var e,j,d,h,k,f,r,l;for(e=g.length;e--;)g[e].sync(a);l=this.points=i?i(g):g;for(e=l.length;e--;){j=l[e].x;d=l[e].y;f=T(f,ka)||j<f?j:f;r=T(r,ka)||d<r?d:r;h=T(h,ka)||j>h?j:h;k=T(k,ka)||d>k?d:k}this.updateBounds(new qa(f,r,h-f,k-r),true)}});this.haveData=g&&g.length>=2});ca(ta,"line",function(a,c,b){b.fill=false;return Ba(ta,"poly",a,c,b)});ca(ta,"image",function(a,c,b){function g(){if(h&&
h.width>0){if(!this.centerOffset)this.centerOffset=new ha(-h.width>>1,-h.height>>1);this.updateBounds(new qa(this.xy.x+this.centerOffset.x,this.xy.y+this.centerOffset.y,h.width,h.height),false)}}function i(f){if(this.imageUrl=f){var r=this;Qa(this.imageUrl,function(l,q){h=l;if(q){var t=k.layer?k.layer.view:null;t&&t.invalidate()}g.apply(r)})}}b=N({image:null,imageUrl:null,centerOffset:null,typeName:"Image"},b);var e=Ca.prototype.resync,j=0,d=0,h=b.image,k=N(new Ca(a,c,b),{changeImage:i,getProps:function(){this.bounds||
g(this,h);return{image:h,x:this.xy.x+j,y:this.xy.y+d}},resync:function(f){e.call(this,f);g.call(this)}});h||i.call(this,this.imageUrl);if(this.centerOffset){j=this.centerOffset.x;d=this.centerOffset.y}});ca(ta,"arc",function(a,c,b){b=N({startAngle:0,endAngle:Math.PI*2,typeName:"Arc"},b);return new Ca(a,c,b)});Ra.prototype={constructor:Ra,clip:null,cycle:function(){},draw:function(){},hitGuess:null,remove:function(){this.view.trigger("layerRemove",this)}};ca("layer","tile",function(a,c){c=N({generator:"osm",
imageLoadArgs:{}},c);var b=Ba("generator",c.generator,c).run,g=null,i=[],e=N(new Ra(a,c),{draw:function(j,d,h){j.drawTiles&&j.drawTiles(d,g.search(d.buffer(128)),h.panSpeed<2)}});a.bind("resync",function(){var j=a&&a.zoom?a.zoom():0;i[j]||(i[j]=ub(j));g=i[j]});a.bind("refresh",function(j,d,h){(new Date).getTime();g&&b(d,h,g,function(){d.invalidate()})});return e});ca("layer","draw",function(a,c){function b(k,f,r,l){var q=this.dragOffset;if(!q)q=this.dragOffset=new a.XY(k.startX-this.xy.x,k.startY-
this.xy.y);this.xy.x=f-q.x;this.xy.y=r-q.y;if(l){delete this.dragOffset;a.invalidate();this.trigger("dragDrop")}return true}function g(k){clearTimeout(d);d=setTimeout(function(){e.sort(function(f,r){if(r.xy&&f.xy){var l=r.xy.y-f.xy.y;return l!=0?l:r.xy.x-f.xy.x}});k&&k.invalidate()},50)}function i(k,f,r,l){l&&j.remove(l,f);j.insert(r,f)}c=N({zindex:10},c);var e=[],j,d=0,h=N(new Ra(a,c),{itemCount:0,clear:function(){j=new vb;e=[];h.trigger("cleared");h.itemCount=0},create:function(k,f,r){f=Ba(ta,k,
a,h,f);if(r)e.unshift(f);else e[e.length]=f;f.resync();j&&f.bounds&&j.insert(f.bounds,f);g(a);f.bind("move",i);h.itemCount=e.length;h.trigger(k+"Added",f);return f},draw:function(k,f,r,l,q){r={};l=j&&f?j.search(f):[];for(var t=l.length;t--;){var m=l[t],u=m.style||h.style,p,v,C=m.getProps?m.getProps(k):r;p=k["prep"+m.typeName];m.tweens.length>0&&m.applyTweens();v=k.applyTransform(m);if(C=p?p.call(k,m,f,q,C):null){if(q&&C.hit){q.elements.push(Hits.initHit(m.type,m,m.draggable?b:null));p=q.type+"Style";
u=m[p]||h[p]||u}u=u?k.applyStyle(u,true):null;(p=m.draw||C.draw)&&p.call(m,C);u&&k.applyStyle(u)}v&&v.undo&&v.undo()}},find:function(){return[].concat(e)},hitGuess:function(k,f){return j&&j.search({x:k-10,y:f-10,w:20,h:20}).length>0}});a.bind("resync",function(){j=ub(a.zoom(),j);for(var k=e.length;k--;)e[k].resync()});return h});Sa.prototype={constructor:Sa};ca("control","zoombar",function(a,c,b,g){function i(w,x){var D=C[w]=X.create("div","t5-zoombar-button",{position:"absolute",background:e(w),
"z-index":51,width:g.width+"px",height:g.buttonHeight+"px","margin-top":(x||0)+"px"});B.appendChild(D)}function e(w,x){return"url("+g.images+") 0 -"+(r+q*3+(w||0)*k*3+(x||0)*k)+"px"}function j(w){return"url("+g.images+") 0 -"+(r+(w||0)*q)+"px"}function d(w,x){var D;if(w===l){l.style.background=j(x);D="thumb"}else for(var z=0;z<C.length;z++)if(w===C[z]){D="button"+z;C[z].style.background=e(z,x);break}return D}function h(w){if(w!==p){p=w;u=m-p/v*(m-t)|0;X.move(l,0,u-t);clearTimeout(n);n=setTimeout(function(){a.zoom(p)},
500)}}g=N({width:24,height:200,images:"img/zoom.png",align:"right",marginTop:10,spacing:10,thumbHeight:16,buttonHeight:16},g.zoombar);var k=g.buttonHeight,f,r=g.height,l,q=g.thumbHeight,t=g.spacing+k-(q>>1),m=g.height-k-(q>>1),u=t,p=-1;c=a.minZoom();var v=a.maxZoom()-c+1,C=[],B,n=0,E={button0:function(){a.zoom(a.zoom()+1)},button1:function(){a.zoom(a.zoom()-1)}};B=X.create("div","t5-zoombar",{position:"absolute",background:"url("+g.images+")","z-index":50,overflow:"hidden",width:g.width+"px",height:g.height+
"px",margin:function(){var w=g.spacing,x=ga("{0}px 0 0 {1}px");if(g.align==="right")w=b.offsetWidth-g.width-g.spacing;return x(g.marginTop,w)}()});b.childNodes[0]?b.insertBefore(B,b.childNodes[0]):b.appendChild(B);B.appendChild(l=X.create("div","t5-zoombar-thumb",{position:"absolute",background:j(),"z-index":51,width:g.width+"px",height:g.thumbHeight+"px",margin:"10px 0 0 0",top:u-t+"px"}));i(0);i(1,g.height-g.buttonHeight);f=INTERACT.watch(B,{bindTarget:B});f.bind("pointerMove",function(w,x,D){u=
Math.min(Math.max(t,D.y-(q>>1)),m);h(v-(u-t)/m*v|0)});f.bind("pointerDown",function(w){d(w.target,2)});f.bind("pointerUp",function(w){d(w.target,0)});f.bind("tap",function(w){(w=E[d(w.target,2)])&&w()});c=new Sa(a);c.bind("detach",function(){f.unbind();b.removeChild(B)});a.bind("zoom",function(w,x){h(x)});h(a.zoom());return c});ja.prototype={constructor:ja,distanceTo:function(){if(!targetPos||this.empty()||targetPos.empty())return 0;var a=(targetPos.lat-this.lat)*ma>>1,c=(targetPos.lon-this.lon)*
ma>>1;a=wa(a)*wa(a)+hb(this.lat*ma)*hb(targetPos.lat*ma)*wa(c)*wa(c);return 6371*2*Yb(Cb(a),Cb(1-a))},equalTo:function(a){return pos&&this.lat===a.lat&&this.lon===a.lon},empty:function(){return this.lat===0&&this.lon===0},inArray:function(a){for(var c=a.length;c--;)if(this.equal(a[c]))return true;return false},offset:function(a,c){var b=this.lat*ma,g=this.lon*ma,i=b+a/6371;b=Xb(wa(c/6371)/hb(b));g=g+b;i=(i+Ka)%Math.PI-Ka;g%=ba;return new ja(i*Fa,g*Fa)},toPixels:function(){return Va(this.lon,this.lat)},
toString:function(a){return this.lat+(a||" ")+this.lon}};ca=function(){return{generalize:function(a,c,b){var g=a.length,i=[],e=null;b||(b=250);b/=1E3;$("generalizing positions, must include "+c.length+" positions");for(var j=g;j--;)if(j===0)i.unshift(a[j]);else{var d=!e||a[j].inArray(c)?b:e.distanceTo(a[j]);if(a[j]&&d>=b){i.unshift(a[j]);e=a[j]}}$("generalized "+g+" positions into "+i.length+" positions");return i},parseArray:function(a){var c=a.length,b=Array(c);for(c=c;c--;)b[c]=new ja(a[c]);return b},
vectorize:function(a,c){function b(){for(var j=0,d=c.chunkSize,h=g;h--;){i[h]=new aa(a[h]);j+=1;if(j>d)break}g=h;if(g<=0)c.callback&&c.callback(i);else animFrame(b)}var g=a.length,i=Array(g);c=N({chunkSize:500,async:true,callback:null},c);if(!c.async){for(var e=g;e--;)i[e]=new aa(a[e]);return i}animFrame(b);return null}}}();Ta.prototype={constructor:Ta,bestZoomLevel:function(a){var c=this.center();c=Ua(La(ra(c.lat)*0.05),gb.length);var b=gb[c],g=this.size();c=Bb(Aa(gb[3]*a.h/g.y)/Aa(2));a=Bb(Aa(b*
a.w/g.x)/Aa(2));return Ua(isNaN(c)?1E3:c,isNaN(a)?1E3:a)},center:function(){var a=this.size();return new ja(this.min.lat+(a.y>>1),this.min.lon+(a.x>>1))},expand:function(a){this.min.lat-=a;this.max.lat+=a;this.min.lon-=a%360;this.max.lon+=a%360},size:function(a){var c=new ha(0,this.max.lat-this.min.lat);c.x=(a||isType(a,ka))&&this.min.lon>this.max.lon?360-this.min.lon+this.max.lon:this.max.lon-this.min.lon;return c},toString:function(){return"min: "+this.min+", max: "+this.max}};var G={ex:N,log:$,
observable:ia,formatter:ga,wordExists:function(a,c){for(var b=a.split(/\s|\,/).length;b--;)if(a.toLowerCase()==c.toLowerCase())return true;return false},is:T,indexOf:eb,project:Va,unproject:ib,userMessage:function(a,c,b){G.trigger("userMessage",a,c,b)},Registry:fb,Style:Db,DOM:X,Rect:qa,XY:ha,Hits:Hits,Control:Sa,Tile:bb,Tweener:pa,getImage:Qa,Pos:ja,PosFns:ca,BBox:Ta};ia(G);G.RouteTools=function(){function a(h){if(i.test(h))return"-slight";return""}function c(h,k){k.geometry&&G.Geo.PosFns.vectorize(k.geometry,
{callback:function(f){h.layer("route","draw").create(ta,"line",{points:f,style:"waypoints",simplify:true})}})}function b(h){for(var k="unknown",f=g||j,r=0;r<f.length;r++){f[r].regex.lastIndex=-1;var l=f[r].regex.exec(h);if(l){k=f[r].customCheck?f[r].customCheck(h,l):f[r].turnType;break}}return k}var g=undefined,i=/bear/i,e=/right/i,j=function(){var h=[];h.push({regex:/continue/i,turnType:"continue"});h.push({regex:/(take|bear|turn)(.*?)left/i,customCheck:function(k,f){return"turn-left"+a(f[1])}});
h.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(k,f){return"turn-right"+a(f[1])}});h.push({regex:/enter\s(roundabout|rotary)/i,turnType:"roundabout"});h.push({regex:/take.*?ramp/i,turnType:"ramp"});h.push({regex:/take.*?exit/i,turnType:"ramp-exit"});h.push({regex:/make(.*?)u\-turn/i,customCheck:function(k,f){return"uturn"+(e.test(f[1])?"-right":"-left")}});h.push({regex:/proceed/i,turnType:"start"});h.push({regex:/arrive/i,turnType:"arrive"});h.push({regex:/fell\sthrough/i,turnType:"merge"});
return h}(),d={calculate:function(h){h=N({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},h);var k=G.Registry.create("service","routing");k&&k.calculate(h,function(f){if(h.generalize)f.geometry=G.Geo.PosFns.generalize(f.geometry,f.getInstructionPositions());if(h.map){c(h.map,f);h.autoFit&&h.map.gotoBounds(f.boundingBox)}h.success&&h.success(f)})},createMapOverlay:c,parseTurnType:b,Instruction:function(h){var k=h=N({position:null,description:"",distance:0,distanceTotal:0,
time:0,timeTotal:0,turnType:null},h),f=h.description;f=f.replace(/(\w)(\/)(\w)/g,"$1 $2 $3");k.description=f;if(!h.turnType)h.turnType=b(h.description);return h},RouteData:function(h){h=N({geometry:[],instructions:[],boundingBox:null},h);if(!h.boundingBox)h.boundingBox=new G.BBox(h.geometry);return N({getInstructionPositions:function(){for(var k=[],f=0;f<h.instructions.length;f++)h.instructions[f].position&&k.push(h.instructions[f].position);return k}},h)}};G.observable(d);return d}();COG=typeof COG!==
"undefined"?COG:{};COG.extend=function(){for(var a=arguments[0]||{},c,b=1,g=arguments.length;b<g;b++)if((c=arguments[b])!==null)for(var i in c){var e=c[i];if(a!==e)if(e!==undefined)a[i]=e}return a};(function(){var a=/^P(\d+Y)?(\d+M)?(\d+D)?$/,c=/^(\d+H)?(\d+M)?(\d+S)?$/,b={8601:function(i){i=i.split("T");var e=null;e=null;var j=0,d=0;a.lastIndex=-1;e=a.exec(i[0]);j+=e[3]?parseInt(e[3].slice(0,-1),10):0;c.lastIndex=-1;e=c.exec(i[1]);d+=e[1]?parseInt(e[1].slice(0,-1),10)*3600:0;d+=e[2]?parseInt(e[2].slice(0,
-1),10)*60:0;d+=e[3]?parseInt(e[3].slice(0,-1),10):0;return new g(j,d)}},g=COG.Duration=function(i,e){return{days:i?i:0,seconds:e?e:0}};COG.addDuration=function(){for(var i=new g,e=arguments.length;e--;){i.days+=arguments[e].days;i.seconds+=arguments[e].seconds}if(i.seconds>=86400){i.days+=~~(i.seconds/86400);i.seconds%=86400}return i};COG.formatDuration=function(i){var e,j,d="";if(i.days)d=i.days+" days ";if(i.seconds){i=i.seconds;if(i>=3600){e=~~(i/3600);i-=e*3600}if(i>=60){j=Math.round(i/60);i-=
j*60}if(e)d=d+e+(e>1?" hrs ":" hr ")+(j?(j>10?j:"0"+j)+" min ":"");else if(j)d=d+j+" min";else if(i>0)d=d+(i>10?i:"0"+i)+" sec"}return d};COG.parseDuration=function(i,e){var j=e?b[e]:null;if(j)return j(i);COG.Log.warn("Could not find duration parser for specified format: "+e);return new g}})();G.Decarta=function(){function a(m){return h(e.clientName,e.clientPassword,e.sessionID,e.configuration,e.release,m)}function c(m,u){return k(m.maxResponses,m.version,m.requestID,m.methodName,u)}function b(m,
u){e.server||$("No server configured for deCarta - we are going to have issues","warn");return f(e.server,m.requestID,escape(u))}function g(m,u){Vb(b(m,a(c(m,m.getRequestBody()))),function(p){var v=p.response.XLS.Response;if(v.numberOfResponses>0&&v[m.methodName+"Response"]){p=null;if(m.parseResponse)p=m.parseResponse(v[m.methodName+"Response"]);u&&u(p)}else $("no responses from server: "+p.response,"error")})}function i(m,u){var p=new l({json:m.StreetAddress}),v=new r({countryCode:m.countryCode});
v.parse(m.Place);return new G.Geo.Address({streetDetails:p,location:v,country:m.countryCode?m.countryCode:"",postalCode:m.PostalCode?m.PostalCode:"",pos:u})}var e={sessionID:(new Date).getTime(),server:"",clientName:"",clientPassword:"",configuration:"",maxResponses:25,release:"4.4.2sp03",tileFormat:"PNG",fixedGrid:true,useCache:true,tileHosts:[],requestTimeout:3E4,geocoding:{countryCode:"US",language:"EN"}},j={DEFAULT:function(m){for(var u=["landmark","municipalitySubdivision","municipality","countrySubdivision"],
p="",v=0;v<u.length;v++)if(m[u[v]])p+=m[u[v]]+" ";return p}},d=1,h=ga("<xls:XLS version='1' xls:lang='en' xmlns:xls='http://www.opengis.net/xls' rel='{4}' xmlns:gml='http://www.opengis.net/gml'><xls:RequestHeader clientName='{0}' clientPassword='{1}' sessionID='{2}' configuration='{3}' />{5}</xls:XLS>"),k=ga("<xls:Request maximumResponses='{0}' version='{1}' requestID='{2}' methodName='{3}Request'>{4}</xls:Request>"),f=ga("{0}/JSON?reqID={1}&chunkNo=1&numChunks=1&data={2}&responseFormat=JSON"),r=
function(m){m=G.ex({landmark:"",municipality:"",municipalitySubdivision:"",countrySubdivision:"",countryCode:""},m);var u=G.ex({calcMatchPercentage:function(p){var v=0;if(m.landmark&&m.landmarkSubType){if(G.wordExists(p,m.landmarkSubType)){v+=0.4;v+=G.wordExists(p,m.landmark)?0.6:0}}else{v+=G.wordExists(p,m.municipalitySubdivision)?0.8:0;if(v===0&&m.municipality)v+=G.wordExists(p,m.municipality)?0.7:0}if(m.countrySubdivision)v+=G.wordExists(p,m.countrySubdivision)?0.2:0;return v},getCountryCode:function(){if(m.countryCode)return m.countryCode.toUpperCase();
return""},parse:function(p){for(var v=0;p&&v<p.length;v++){var C=p[v].type?p[v].type.slice(0,1).toLowerCase()+p[v].type.slice(1):"";if(typeof m[C]!=="undefined"){m[C]=p[v].content;if(p[v].subType)m[C+"SubType"]=p[v].subType}}G.ex(u,m)},toString:function(){var p=j[u.getCountryCode()];if(!p)p=j.DEFAULT;return p(m)}},m);return u},l=function(m){m=G.ex({json:{}},m);var u="",p="";if(m.json.Street)u=m.json.Street.content?m.json.Street.content:m.json.Street;u=u&&u.replace?u.replace(/\/\d+$/,""):"";if(m.json.Building)if(m.json.Building.number)p=
m.json.Building.number;return{building:p,street:u,calcMatchPercentage:function(v){var C=0,B=G.Geo.A.normalize(v),n=G.Geo.A.normalize(u);if(m.json.Building)if(G.Geo.A.buildingMatch(v,m.json.Building.number.toString()))C+=0.2;if(B&&n&&G.wordExists(B,n))C+=0.8;return C},toString:function(){if(u)return(p?p+" ":"")+u;return""}}},q=function(){return{methodName:"",maxResponses:25,version:"1.0",requestID:d++,getRequestBody:function(){return""},parseResponse:function(m){return m}}},t=function(){return G.ex(new q,
{methodName:"RUOK",parseResponse:function(m){return{aliasCount:m.maxHostAliases,host:m.hostName}}})};G.Registry.register("generator","decarta",function(m){function u(C,B,n,E){if(C=C.zoom?C.zoom():0){var w=2<<C-1,x=w>>1,D=m.tileSize,z=(B.w/D|0)+1,F=(B.h/D|0)+1,L=(B.x/D|0)-x;B=w-(B.y/D|0)-x-F;var K=n.search({x:(x+L)*D,y:(x+B*-1-F)*D,w:z*D,h:F*D});w={};var y;for(y=K.length;y--;)w[K[y].id]=true;for(K=0;K<=z;K++)for(y=0;y<=F;y++){var H=L+K,Q=B+y-1,W=H+"_"+Q;if(!w[W]){H=new G.Tile((x+L+K)*D,(x+B*-1-y)*
D,v[K%v.length]+"/openls/image-cache/TILE?LLMIN=0.0,0.0&LLMAX="+p[C]+"&CACHEABLE=true&DS=navteq-world&WIDTH=256&HEIGHT=256&CLIENTNAME="+e.clientName+"&SESSIONID="+e.sessionID+"&FORMAT=PNG&CONFIG="+e.configuration+"&N="+Q+"&E="+H,D,D,W);n.insert(H,H)}}E&&E()}}m=G.ex({tileSize:256},m);var p=["89.787438015348100000,360.00000000000000000","85.084059050110410000,180.00000000000000000","66.653475896509040000,90.00000000000000000","41.170427238429790000,45.000000000000000000","22.076741328793200000,22.500000000000000000",
"11.251819676168665000,11.250000000000000000","5.653589942659626000,5.625000000000000000","2.830287664051185000,2.812500000000000000","1.415581451872543800,1.406250000000000000","0.707845460801532700,0.703125000000000000","0.353929573271679340,0.351562500000000000","0.176965641673330230,0.175781250000000000","0.088482927761462040,0.087890625000000000","0.044241477246363230,0.043945312500000000","0.022120740293895182,0.021972656250000000","0.011060370355776452,0.010986328125000000","0.005530185203987857,0.005493164062500000",
"0.002765092605263539,0.002746582031250000","0.001382546303032519,0.001373291015625000","0.000691272945568983,0.000686645507812500","0.000345636472797214,0.000343322753906250"],v=null;G.userMessage("ack","decarta","&copy; deCarta, Inc. Map and Imagery Data &copy; NAVTEQ or Tele Atlas or DigitalGlobe");return{run:function(C,B,n,E){v?u(C,B,n,E):g(new t,function(w){v=[];if(w.aliasCount)for(var x=0;x<w.aliasCount;x++)v[x]="http://"+w.host.replace("^(.*?).(.*)$","\u0001-0"+(x+1)+".\u0002");else v=["http://"+
w.host];u(C,B,n,E)})}}});G.Registry.register("service","geocoder",function(){var m=function(p){function v(n){var E=[],w=n?n.numberOfGeocodedAddresses:0,x=[];if(w>1)x=n.GeocodedAddress;else if(w==1)x=[n.GeocodedAddress];try{for(n=0;x&&n<x.length;n++){var D,z=x[n],F=w=null;if(z&&z.GeocodeMatchCode&&z.GeocodeMatchCode.matchType!=="NO_MATCH"){if(z&&z.Point)F=new G.Pos(z.Point.pos);if(z&&z.Address)w=i(z.Address,F)}(D=w)&&E.push(D)}}catch(L){$(L,"error")}return E}p=G.ex({addresses:[],parserReport:false,
parseOnly:false,returnSpatialKeys:false},p);var C=ga('<xls:GeocodeRequest parserReport="{0}" parseOnly="{1}" returnSpatialKeys="{2}">'),B=new q;return G.ex({},B,{methodName:"Geocode",getRequestBody:function(){for(var n=C(p.parserReport,p.parseOnly,p.returnSpatialKeys),E=0;E<p.addresses.length;E++)n+=p.addresses[E].getXML();return n+"</xls:GeocodeRequest>"},parseResponse:function(n){if(p.addresses.length===1)return[v(n.GeocodeResponseList)];else{for(var E=[],w=0;w<p.addresses.length;w++)E.push(v(n.GeocodeResponseList[w]));
return E}}})},u=function(p){p=G.ex({position:null,geocodePreference:"StreetAddress"},p);return G.ex(new q,{methodName:"ReverseGeocode",getRequestBody:function(){return"<xls:ReverseGeocodeRequest><xls:Position><gml:Point><gml:pos>"+p.position.toString()+"</gml:pos></gml:Point></xls:Position><xls:ReverseGeocodePreference>"+p.geocodePreference+"</xls:ReverseGeocodePreference></xls:ReverseGeocodeRequest>"},parseResponse:function(v){var C=null;if(v&&v.Point)C=new G.Pos(match.Point.pos);if(v&&v.ReverseGeocodedLocation&&
v.ReverseGeocodedLocation.Address)return i(v.ReverseGeocodedLocation.Address,C);return null}})};return{forward:function(p){p=G.ex({addresses:[],complete:null},p);var v,C=[];if(p.addresses&&!G.is(p.addresses,"array"))p.addresses=[p.addresses];for(v=0;v<p.addresses.length;v++)G.is(p.addresses[v],"object")?$("attempting to geocode a simple object - not implemented","warn"):C.push(new types.Address({freeform:p.addresses[v]}));if(C.length>0){C=new m({addresses:C});g(C,function(B){if(p.complete)for(v=0;v<
B.length;v++)p.complete(p.addresses[v],B[v])})}},reverse:function(p){p=G.ex({position:null,complete:null},p);if(!p.position)throw Error("Cannot reverse geocode without a position");var v=new u(p);g(v,function(C){p.complete&&p.complete(C)})}}});G.Registry.register("service","routing",function(){var m=function(u){u=G.ex({waypoints:[],provideRouteHandle:false,distanceUnit:"KM",routeQueryType:"RMAN",routePreference:"Fastest",routeInstructions:true,routeGeometry:true},u);var p=new q,v=ga('<xls:DetermineRouteRequest provideRouteHandle="{0}" distanceUnit="{1}" routeQueryType="{2}">'),
C=ga("<xls:{0}><xls:Position><gml:Point><gml:pos>{1}</gml:pos></gml:Point></xls:Position></xls:{0}>");return G.ex({},p,{methodName:"DetermineRoute",getRequestBody:function(){if(u.waypoints.length<2)throw Error("Cannot send RouteRequest, less than 2 waypoints specified");var B=v(u.provideRouteHandle,u.distanceUnit,u.routeQueryType);B+="<xls:RoutePlan>";B+="<xls:RoutePreference>"+u.routePreference+"</xls:RoutePreference>";B+="<xls:WayPointList>";for(var n=0;n<u.waypoints.length;n++)B+=C(n===0?"StartPoint":
n===u.waypoints.length-1?"EndPoint":"ViaPoint",u.waypoints[n].toString());B+="</xls:WayPointList>";B+="</xls:RoutePlan>";if(u.routeInstructions)B+='<xls:RouteInstructionsRequest rules="maneuver-rules" providePoint="true" />';if(u.routeGeometry)B+="<xls:RouteGeometryRequest />";B+="</xls:DetermineRouteRequest>";return B},parseResponse:function(B){var n=G.RouteTools.RouteData,E=G.Geo.PosFns.parseArray(B.RouteGeometry.LineString.pos),w=B.RouteInstructionsList;B=[];w=w&&w.RouteInstruction?w.RouteInstruction:
[];for(var x=0,D=new COG.Duration,z=0;z<w.length;z++){var F;F=w[z].distance;var L={M:1,KM:1E3}[F.uom?F.uom.toUpperCase():"M"];F=F.value&&L?F.value*L:0;L=COG.parseDuration(w[z].duration,"8601");x+=F;D=COG.addDuration(D,L);B.push(new G.RouteTools.Instruction({position:new G.Pos(w[z].Point),description:w[z].Instruction,distance:F,distanceTotal:x,time:L,timeTotal:D}))}return new n({geometry:E,instructions:B})}})};return{calculate:function(u,p){u=G.ex({waypoints:[]},u);if(typeof G.RouteTools!=="undefined"){var v=
new m(u);g(v,function(C){p&&p(C)})}else $("Could not generate route, T5.RouteTools plugin not found","warn")}}});return{applyConfig:function(m){G.ex(e,m)},compareFns:function(){return{streetDetails:function(m,u){return u.calcMatchPercentage(m)},location:function(m,u){return u.calcMatchPercentage(m)}}}()}}();qb.T5=G;qb.Tile5=function(a,c){c=N({container:a,type:"map",renderer:"canvas",starpos:null,zoom:1,fastpan:false,drawOnScale:true,zoombar:{}},c);return Ba("view",c.type,c)}})(window);
