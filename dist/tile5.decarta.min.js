(function(rb){function J(){var a=arguments[0]||{},d=Array.prototype.slice.call(arguments,1),b=d.length,e,f;for(f=0;f<b;f++)if((e=d[f])!==null)for(var h in e){var i=e[h];if(a!==i)if(i!==undefined)a[h]=i}return a}function ha(a,d){if(typeof console!=="undefined")console[d||"debug"](a)}function la(a){var d=a.match(Kb),b=[],e=0,f;for(f=d?d.length:0;f--;){var h=d[f].slice(1);b[h]||(b[h]=RegExp("\\{"+h+"\\}","g"))}e=b.length;return function(){var i=a;for(f=0;f<e;f++){var j=arguments[f];if(typeof j=="undefined")j=
"";i=i.replace(b[f],j)}return i}}function sb(a,d){var b=Ta*ma(a);return Ua-2*tb(d*Aa((1-b)/(1+b),Ta/2))}function U(a,d){if(R(a,pa)){var b=a.split(eb);this.x=parseFloat(b[0]);this.y=parseFloat(b[1])}else if(a&&a.x){this.x=a.x;this.y=a.y}else{this.x=a||0;this.y=d||0}}function Ja(a){this.allowCull=a}function ua(a,d,b,e){this.mercX=b;this.mercY=e;if(R(a,pa))J(this,Lb.parseXY(a));else a&&a.toPixels?J(this,a.toPixels()):U.call(this,a,d)}function va(a,d,b,e){this.x=a||0;this.y=d||0;this.w=b||0;this.h=e||
0;this.x2=this.x+this.w;this.y2=this.y+this.h}function ub(a,d){var b=new vb(Math.sqrt(256<<a)|0);d&&d.zoomLevel===a&&d.copyInto(b);b.zoomLevel=a;return b}function fb(a,d,b,e,f,h){this.x=a;this.y=d;this.w=e||256;this.h=e||256;this.x2=this.x+this.w;this.y2=this.y+this.h;this.url=b;this.id=h||a+"_"+d;this.loaded=false;this.image=null}function Va(a,d){d=J({id:"layer_"+Mb++,zindex:0,animated:false,style:null,minXY:null,maxXY:null,visible:true},d);this.visible=d.visible;this.view=a;wa(J(this,d))}function Wa(){wa(this)}
function ka(a,d){if(a&&a.split){var b=a.split(eb);if(b.length>1){a=b[0];d=b[1]}}else if(a&&a.lat){d=a.lon;a=a.lat}this.lat=parseFloat(a||0);this.lon=parseFloat(d||0)}function Ka(a,d){if(R(a,wb)){for(var b=d,e=new ka(gb,Xa),f=new ka(Nb,xb),h=a.length;h--;){var i=a[h];if(i.lat<e.lat)e.lat=i.lat;if(i.lat>f.lat)f.lat=i.lat;if(i.lon<e.lon)e.lon=i.lon;if(i.lon>f.lon)f.lon=i.lon}this.min=e;this.max=f;if(R(b,xa)){b=this.size();b=Da(b.x,b.y)*0.3}this.expand(b)}else{this.min=a;this.max=d}}function hb(a){if(!R(a,
pa))this.meters=a}var Kb=/\{(\d+)(?=\})/g,Ob=function(){var a=1.70158,d=Math.PI/2,b=Math.abs,e=Math.pow,f=Math.sin,h=Math.asin,i=Math.cos,j={linear:function(g,o,c,l){return c*g/l+o},backin:function(g,o,c,l){return c*(g/=l)*g*((a+1)*g-a)+o},backout:function(g,o,c,l){return c*((g=g/l-1)*g*((a+1)*g+a)+1)+o},backinout:function(g,o,c,l){return(g/=l/2)<1?c/2*g*g*(((a*=1.525)+1)*g-a)+o:c/2*((g-=2)*g*(((a*=1.525)+1)*g+a)+2)+o},bouncein:function(g,o,c,l){return c-j.bounceout(l-g,0,c,l)+o},bounceout:function(g,
o,c,l){return(g/=l)<1/2.75?c*7.5625*g*g+o:g<2/2.75?c*(7.5625*(g-=1.5/2.75)*g+0.75)+o:g<2.5/2.75?c*(7.5625*(g-=2.25/2.75)*g+0.9375)+o:c*(7.5625*(g-=2.625/2.75)*g+0.984375)+o},bounceinout:function(g,o,c,l){return g<l/2?j.bouncein(g*2,0,c,l)/2+o:j.bounceout(g*2-l,0,c,l)/2+c/2+o},cubicin:function(g,o,c,l){return c*(g/=l)*g*g+o},cubicout:function(g,o,c,l){return c*((g=g/l-1)*g*g+1)+o},cubicinout:function(g,o,c,l){if((g/=l/2)<1)return c/2*g*g*g+o;return c/2*((g-=2)*g*g+2)+o},elasticin:function(g,o,c,l,
k,n){if(g==0)return o;if((g/=l)==1)return o+c;n||(n=l*0.3);if(!k||k<b(c)){k=c;c=n/4}else c=n/aa*h(c/k);return-(k*e(2,10*(g-=1))*f((g*l-c)*aa/n))+o},elasticout:function(g,o,c,l,k,n){var p;if(g==0)return o;if((g/=l)==1)return o+c;n||(n=l*0.3);if(!k||k<b(c)){k=c;p=n/4}else p=n/aa*h(c/k);return k*e(2,-10*g)*f((g*l-p)*aa/n)+c+o},elasticinout:function(g,o,c,l,k,n){var p;if(g==0)return o;if((g/=l/2)==2)return o+c;n||(n=l*0.3*1.5);if(!k||k<b(c)){k=c;p=n/4}else p=n/aa*h(c/k);if(g<1)return-0.5*k*e(2,10*(g-=
1))*f((g*l-p)*aa/n)+o;return k*e(2,-10*(g-=1))*f((g*l-p)*aa/n)*0.5+c+o},quadin:function(g,o,c,l){return c*(g/=l)*g+o},quadout:function(g,o,c,l){return-c*(g/=l)*(g-2)+o},quadinout:function(g,o,c,l){if((g/=l/2)<1)return c/2*g*g+o;return-c/2*(--g*(g-2)-1)+o},sinein:function(g,o,c,l){return-c*i(g/l*d)+c+o},sineout:function(g,o,c,l){return c*f(g/l*d)+o},sineinout:function(g,o,c,l){return-c/2*(i(Math.PI*g/l)-1)+o}};return function(g){g=g.replace(/[\-\_\s\.]/g,"").toLowerCase();return j[g]||j.linear}}(),
wa=function(){function a(b,e){var f=b.hasOwnProperty("obsHandlers")?b.obsHandlers:null;f[e]||(f[e]=[]);return f[e]}var d=0;return function(b){if(!b)return null;if(!(b.hasOwnProperty("obsHandlers")?b.obsHandlers:null))b.obsHandlers={};if(!b.hasOwnProperty("bind")){b.bind=function(e,f){var h="callback"+d++;a(b,e).unshift({fn:f,id:h});return h};b.triggerCustom=function(e,f){var h=a(b,e),i={cancel:false,name:e,source:this},j;for(j in f)i[j]=f[j];if(!h)return null;j=Array.prototype.slice.call(arguments,
2);b.eventInterceptor&&b.eventInterceptor(e,i,j);j.unshift(i);for(var g=h.length;g--&&!i.cancel;)h[g].fn.apply(this,j);return i};b.trigger=function(e){var f=Array.prototype.slice.call(arguments,1);f.splice(0,0,e,null);return b.triggerCustom.apply(this,f)};b.unbind=function(e,f){if(typeof e==="undefined")b.obsHandlers={};else for(var h=a(b,e),i=0;h&&i<h.length;i++)if(h[i].id===f){h.splice(i,1);break}return b}}return b}}(),yb=function(){function a(d,b,e,f){if(typeof d[f]=="undefined")d[f]=function(h){if(typeof h!=
"undefined"){b[f]=h;e[f]&&e[f](h);return d}else return b[f]}}return function(d,b,e){b=b||d;for(var f in b)typeof b[f]!="function"&&a(d,b,e,f);return d}}(),ib=Array.prototype.indexOf||function(a){for(var d=0;d<this.length;d++)if(this[d]===a)return d;return-1},R=function(){var a={NaN:1,Infinity:1,"-Infinity":1},d=String.prototype.toLowerCase,b=Object.prototype.toString;return function(e,f){f=d.call(f);if(f=="finite")return!a.hasOwnProperty(+e);return f=="null"&&e===null||f==typeof e||f=="object"&&e===
Object(e)||f=="array"&&Array.isArray&&Array.isArray(e)||b.call(e).slice(8,-1).toLowerCase()==f}}(),Pb=function(){function a(f){var h=document.createElement("script"),i=false;h.src=f;h.async=true;h.onload=h.onreadystatechange=function(){if(!i&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){i=true;h.onload=h.onreadystatechange=null;h&&h.parentNode&&h.parentNode.removeChild(h)}};b||(b=document.getElementsByTagName("head")[0]);b.appendChild(h)}var d=0,b,e=this;return function(f,
h,i){f+=f.indexOf("?")>=0?"&":"?";var j="json"+ ++d;e[j]=function(g){h(g);e[j]=null;try{delete e[j]}catch(o){}};a(f+(i?i:"callback")+"="+j);return j}}();INTERACT=function(){function a(k){return function(n,p){k.addEventListener(n,p,false)}}function d(k){return function(n,p){k.removeEventListener(n,p,false)}}function b(k){return function(n,p){k.attachEvent("on"+n,p)}}function e(k,n){return{x:k?k:0,y:n?n:0,count:1}}function f(k,n){c.push(J({handler:null,checks:{},type:k},n))}function h(k){var n=0,p=
0;if(k.offsetParent){do{n+=k.offsetLeft;p+=k.offsetTop;k=k.offsetParent}while(k)}return{left:n,top:p}}function i(k,n){return{source:k,target:n.target?n.target:n.srcElement}}function j(k,n){for(var p=k.target?k.target:k.srcElement;p&&p!==n;)p=p.parentNode;return p&&p===n}function g(k,n){return{x:k.x-(n?n.left:0),y:k.y-(n?n.top:0)}}function o(k,n){if(k.preventDefault){k.preventDefault();k.stopPropagation()}else if(typeof k.cancelBubble!="undefined")k.cancelBubble=true;n&&k.stopImmediatePropagation&&
k.stopImmediatePropagation()}var c=[],l=function(k,n,p){p=J({binder:null,unbinder:null,observable:null},p);for(var D=p.observable,m=[],v,u,w={bind:function(){return D.bind.apply(null,arguments)},unbind:function(){D.unbind();for(q=0;q<m.length;q++)m[q].unbind();return w}},q=0;q<n.length;q++)m.push(n[q](k,D,p));D.bind("pointerDown",function(){u=v=0});D.bind("pointerMove",function(x,z,s,A){v+=A.x||0;u+=A.y||0});D.bind("pointerUp",function(x,z,s){Math.abs(v)>20||Math.abs(u)>20||D.triggerCustom("tap",
x,z,s)});return w};f("pointer",{handler:function(k,n,p){function D(y){if(y.pageX&&y.pageY)return e(y.pageX,y.pageY);else{var K=document.documentElement,Q=document.body;return e(y.clientX+(K&&K.scrollLeft||Q&&Q.scrollLeft||0)-(K&&K.clientLeft||Q&&Q.clientLeft||0),y.clientY+(K&&K.scrollTop||Q&&Q.scrollTop||0)-(K&&K.clientTop||Q&&Q.clientTop||0))}}function m(y){if(j(y,k))if(A=q(y)){var K=D(y);k.style.cursor="move";o(y,true);L=K.x;I=K.y;B=e(L,I);n.triggerCustom("pointerDown",i("mouse",y),B,g(B,h(k)))}}
function v(y){var K=D(y);E=K.x;H=K.y;if(j(y,k))x(y,A?"pointerMove":"pointerHover")}function u(y){if(A&&q(y)){A=false;if(j(y,k)){k.style.cursor="default";x(y,"pointerUp")}}}function w(y){if(j(y,k)){var K;y=y||window.event;if(y.detail){if(typeof y.axis=="undefined"||y.axis===2)K=-y.detail*z}else{K=y.wheelDeltaY?y.wheelDeltaY:y.wheelDelta;if(window.opera)K=-K}if(K){var Q=e(E,H);n.triggerCustom("zoom",i("mouse",y),Q,g(Q,h(k)),K/s,"wheel");o(y);y.returnValue=false}}}function q(y){y=y||window.event;return(y.which||
y.button)==1}function x(y,K,Q,Z,ea){Q=typeof Q!="undefined"?Q:E;Z=typeof Z!="undefined"?Z:H;var F=Q-L,M=Z-I,O=e(Q,Z);n.triggerCustom(K,i("mouse",y),O,g(O,h(k)),e(F,M));if(typeof ea=="undefined"||ea){L=Q;I=Z}}p=J({},p);var z=120,s=z*8,A=false,B,E,H,L,I;p.binder("mousedown",m);p.binder("mousemove",v);p.binder("mouseup",u);p.binder("dblclick",function(y){ha("captured double click");if(j(y,k)){var K=D(y);n.triggerCustom("doubleTap",i("mouse",y),K,g(K,h(k)))}});p.binder("mousewheel",w);p.binder("DOMMouseScroll",
w);return{unbind:function(){p.unbinder("mousedown",m);p.unbinder("mousemove",v);p.unbinder("mouseup",u);p.unbinder("mousewheel",w);p.unbinder("DOMMouseScroll",w)}}},checks:{touch:false}});f("pointer",{handler:function(k,n,p){function D(F){if(F.count<2)return 0;var M=F.x-F.next.x;F=F.y-F.next.y;return~~Math.sqrt(M*M+F*F)}function m(F,M,O){M=M?M:0;O=O?O:0;for(var S={x:F.x-M,y:F.y-O,id:F.id,count:F.count},T=S;F.next;){F=F.next;T=T.next={x:F.x-M,y:F.y-O,id:F.id}}return S}function v(F,M){var O=F[M?M:"touches"],
S,T;if(O.length===0)return null;T=S={x:O[0].pageX,y:O[0].pageY,id:O[0].identifier,count:O.length};for(var ba=1,Ea=O.length;ba<Ea;ba++)T=T.next={x:O[ba].pageX,y:O[ba].pageY,id:O[ba].identifier};return S}function u(F){if(j(F,k)){H=h(k);var M=v(F,"changedTouches"),O=m(M,H.left,H.top);if(!I){L=A;n.triggerCustom("pointerDown",i("touch",F),M,O)}Z&&n.triggerCustom("pointerDownMulti",i("touch",F),M,O);I=v(F);if(I.count>1)K=D(I);ea=1;Q=m(I)}}function w(F){if(j(F,k)){o(F);y=v(F);if(L==A)L=Math.abs(I.x-y.x)>
z||Math.abs(I.y-y.y)>z?s:A;if(L!=A){L=y.count>1?E:B;if(L==E)if(I.count===1){I=m(y);K=D(I)}else{var M=D(y);if(Math.abs(K-M)<x)L=B;else{var O;O=y.x;var S=y.next.x,T=y.y,ba=y.next.y;O={x:(O<S?O:S)+(Math.abs(O-S)>>1),y:(T<ba?T:ba)+(Math.abs(T-ba)>>1)};M=M/K;S=M-ea;n.triggerCustom("zoom",i("touch",F),O,g(O,H),S,"pinch");ea=M}}L==B&&n.triggerCustom("pointerMove",i("touch",F),y,m(y,H.left,H.top),e(y.x-Q.x,y.y-Q.y));Z&&n.triggerCustom("pointerMoveMulti",i("touch",F),y,m(y,H.left,H.top))}Q=m(y)}}function q(F){if(j(F,
k)){var M=v(F,"changedTouches"),O=m(M,H.left,H.top);y=v(F);if(!y){n.triggerCustom("pointerUp",i("touch",F),M,O);I=null}Z&&n.triggerCustom("pointerUpMulti",i("touch",F),M,O)}}p=J({detailed:false,inertia:false},p);var x=20,z=7,s=0,A=1,B=2,E=3,H,L,I,y,K,Q,Z=p.detailed,ea=1;p.binder("touchstart",u);p.binder("touchmove",w);p.binder("touchend",q);ha("initialized touch handler");return{unbind:function(){p.unbinder("touchstart",u);p.unbinder("touchmove",w);p.unbinder("touchend",q)}}},checks:{touch:true}});
return{register:f,watch:function(k,n,p){n=J({bindTarget:null,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},n);capabilities=J({touch:"ontouchstart"in window},p);if(!n.observable){ha("creating observable");n.observable=wa({});globalOpts=n}n.binder=(n.isIE?b:a)(n.bindTarget||document);n.unbinder=(n.isIE?b:d)(n.bindTarget||document);p=n.types;for(var D=capabilities,m=[],v=c.length;v--;){var u=c[v],w=!p||p.indexOf(u.type)>=0,q=true,x;for(x in u.checks){var z=u.checks[x];ha("checking "+
x+" capability. require: "+z+", capability = "+D[x]);q=q&&z===D[x]}if(w&&q)m[m.length]=u.handler}return new l(k,m,n)}}}();var G=wa({}),Ya=function(){var a={};return{create:function(d,b){if(a[d][b])return a[d][b].apply(null,Array.prototype.slice.call(arguments,2));throw Qb(d,b);},get:function(d,b){return a[d]?a[d][b]:null},register:function(d,b,e){a[d]||(a[d]={});a[d][b]&&ha(Rb(d,b),"warn");a[d][b]=e}}}(),Rb=la("Registration of {0}: {1} will override existing definition"),Qb=la("Could not create {0} of type: {1}");
la("Could not create drawable of type: {0}");var jb=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],aa=Math.PI*2,Ua=Math.PI/2,ca=Math.PI/180,na=180/Math.PI,gb=90,Nb=-gb,Xa=180,xb=-Xa,kb=gb*ca,zb=-kb,Ab=Xa*ca,Sb=-Ab,Ta=0.08181919084262157,oa=Math.abs,Bb=Math.ceil,La=Math.round,Ma=Math.min,Da=Math.max,Aa=Math.pow,lb=Math.sqrt,Ba=Math.log,ma=Math.sin,Cb=Math.asin,Fa=Math.cos,tb=Math.atan,Tb=Math.atan2,xa="undefined",pa="string",Ub="object",qa="number",wb="array",
fa=Ya.register,ya=Ya.create,Vb=Ya.get,Wb=0,Mb=0,eb=/[\,\s]+/,Ga=function(){function a(i){f++;i=i||(new Date).getTime();for(var j=e.length;j--;){var g=e[j];f%g.every===0&&g.cb(i)}h&&animFrame(a)}var d=1E3/60,b=["r","webkitR","mozR","oR","msR"],e=[],f=0,h=function(){for(var i=0;i<b.length;i++)window.animFrame=window.animFrame||window[b[i]+"equestAnimationFrame"];return animFrame}();h?animFrame(a):setInterval(a,1E3/60);return{attach:function(i,j){e[e.length]={cb:i,every:j?La(j/d):1}},detach:function(i){for(var j=
e.length;j--;)if(e[j].cb===i){e.splice(j,1);break}}}}(),Lb=function(){var a=/^xy\((.*)\).*$/i;return{parseXY:function(d){if(!a.test(d)){d=d.split(eb);return Za(d[1],d[0])}}}}(),Y=function(){function a(f){for(var h=0;h<f.length;h++){var i=f[h];if(typeof document.body.style[i]!="undefined")return i}}var d={"-webkit-user-select":"none",position:"absolute"},b,e;b=a(["-webkit-transform","MozTransform"]);css3DTransformProp=a(["WebkitPerspective","MozPerspective"]);e=a(["-webkit-transform-origin","MozTransformOrigin"]);
return{transforms:R(b,pa),create:function(f,h,i){f=document.createElement(f);var j=[];i=i||{};f.className=h||"";for(var g in i)j[j.length]=g+": "+i[g];f.style.cssText=j.join(";");return f},move:function(f,h,i,j,g){if(b){f.style[b]="translate("+h+"px, "+i+"px) "+(j||[]).join(" ");if(g&&e)f.style[e]=g.x+"px "+g.y+"px"}else{f.style.left=h+"px";f.style.top=i+"px"}},styles:function(f){return J({},d,f)}}}(),Db=function(){function a(){for(var f=e.length,h=f;h--;)try{e[h](f)}catch(i){ha(i.toString(),"error")}}
var d=20,b=50,e=[];return{process:function(f,h,i,j){function g(l){l=(o||b)/l;if(c<f.length){var k=f.slice(c,c+l);l=k.length;var n=o?0:(new Date).getTime();h(k,l);if(!o){o=(k=((new Date).getTime()-n)/l)?d/k|0:f.length;ha("calculated that we can process "+o+" items per cycle")}c+=l}else{for(l=e.length;l--;)if(e[l]===g){e.splice(l,1);break}e.length===0&&Ga.detach(a);i&&i()}}var o,c=0;if(f.length>(j||0))e.push(g)===1&&Ga.attach(a);else{h(f,f.length);i&&i()}}}}(),Za=Za||function(a,d){var b=parseFloat(d)*
ca;b=ma(b);var e=Ta*b;b=Ba((1+b)/(1-b)*Aa((1-e)/(1+e),Ta))/2;return new ua(0,0,parseFloat(a)*ca,b)},mb=mb||function(a,d){for(var b=Aa(Math.E,-d),e=Ua-2*tb(b),f=sb(e,b),h=0;h<12&&oa(e-f)>1.0E-7;){e=f;f=sb(e,b);h++}return new ka(f*na,a%360*na)};U.prototype={constructor:U,add:function(){for(var a=this.x,d=this.y,b=arguments.length;b--;){a+=arguments[b].x;d+=arguments[b].y}return this.copy(a,d)},copy:function(a,d){var b=J({},this);b.x=a||b.x;b.y=d||b.y;return b},equals:function(a){return this.x===a.x&&
this.y===a.y},offset:function(a,d){return this.copy(this.x+a,this.y+d)},relative:function(a){a=a.viewport();return this.copy(this.x-a.x-a.padding.x,this.y-a.y-a.padding.y)},rotate:function(a,d){d=d||new U(0,0);var b=this.x-d.x,e=this.y-d.y;return new U(d.x+Fa(a)*b+-ma(a)*e,d.y+ma(a)*b+Fa(a)*e)},scale:function(a,d){d=d||new U(0,0);return new U(d.x+(this.x-d.x)*a,d.y+(this.y-d.y)*a)},sync:function(){return this},toString:function(){return this.x+", "+this.y}};Ja.prototype=J([],{cull:function(a){if(this.allowCull){var d=
a.x,b=a.y,e=a.x+a.w;a=a.y+a.h;for(var f=Infinity,h=0,i,j=this.length;j--;)if(i=this[j].x>=d&&this[j].x<=e&&this[j].y>=b&&this[j].y<=a){f=j<f?j:f;h=j>h?j:h}return this.slice(Da(f-1,0),Ma(h+1,this.length))}return this},simplify:function(a){a=a||3;for(var d=new Ja,b=null,e=this.length;e--;){var f=this[e];if(include=!b||e===0||oa(f.x-b.x)+oa(f.y-b.y)>a){d.unshift(f);b=f}}return d}});ua.prototype=J(new U,{constructor:ua,pos:function(){return mb(this.mercX,this.mercY)},sync:function(a,d){var b;if(!(b=a.rpp)){b=
a.zoom();b=aa/(256<<b)}b=b;if(d){this.mercX=this.x*b-Math.PI;this.mercY=Math.PI-this.y*b}else{this.x=La(((this.mercX||0)+Math.PI)/b);this.y=La((Math.PI-(this.mercY||0))/b)}return this}});va.prototype={constructor:va,buffer:function(a,d){return new va(this.x-a,this.y-(d||a),this.w+a*2,this.h+(d||a)*2)},center:function(){return new U(this.x+(this.w>>1),this.y+(this.h>>1))}};Hits=function(){return{diffHits:function(a,d){var b=[],e={},f;for(f=d.length;f--;)e[d[f].target.id]=true;for(f=a.length;f--;)e[a[f].target.id]||
(b[b.length]=a[f]);return b},init:function(a,d,b,e,f){return{type:a,x:f.x,y:f.y,gridX:e.x|0,gridY:e.y|0,elements:[],absXY:d,relXY:b}},initHit:function(a,d,b){return{type:a,target:d,drag:b}},triggerEvent:function(a,d,b,e){d.triggerCustom(a.type+(b?b:"Hit"),{hitType:a.type},e?e:a.elements,a.absXY,a.relXY,new ua(a.gridX,a.gridY))}}}();var vb=function(a){function d(h,i){var j=b[h],g;j||(j=b[h]=[]);(g=j[i])||(g=j[i]=[]);return g}a=a||128;var b=[],e={},f=0;return{copyInto:function(h){for(var i in e){var j=
e[i];h.insert(j.bounds||j,j,i)}},insert:function(h,i,j){var g=h.x/a|0,o=h.y/a|0,c=(h.x+h.w)/a|0;h=(h.y+h.h)/a|0;j=j||i.id||"obj_"+f++;e[j]=i;for(i=g;i<=c;i++)for(g=o;g<=h;g++)d(i,g).push(j)},remove:function(h,i,j){j=j||i.id;if(e[j]){var g=h.x/a|0;i=h.y/a|0;var o=(h.x+h.w)/a|0;h=(h.y+h.h)/a|0;delete e[j];for(g=g;g<=o;g++)for(var c=i;c<=h;c++){var l=d(g,c),k=ib.call(l,j);k>=0&&l.splice(k,1)}}},search:function(h,i){for(var j=h.y/a|0,g=(h.x+h.w)/a|0,o=(h.y+h.h)/a|0,c=[],l=[],k=h.x/a|0;k<=g;k++)for(var n=
j;n<=o;n++)c=c.concat(d(k,n));c.sort();for(j=c.length;j--;){g=c[j];if(o=e[g])l[l.length]=o;for(;j>0&&c[j-1]==g;)j--}i&&l.sort(function(p,D){return D[i]-p[i]});return l}}},$a=function(){var a={},d=0;(new Date).getTime();var b={},e=[];Ga.attach(function(f){f=f||(new Date).getTime();for(var h=0;h<e.length;){var i=e[h],j=b[i],g=b[i].image&&b[i].image.complete&&b[i].image.width>0,o=f-j.start;o=g||o>=3E4;if(g){g=j.callbacks;a[i]=j.image;for(var c=0;c<g.length;c++)g[c](j.image,true)}if(o){e.splice(h,1);
delete b[i]}else h++}},250);return function(f,h){var i=f&&h?a[f]:null;if(i&&i&&i.complete&&i.width>0)h(i);else if(i=b[f])i.callbacks.push(h);else{i=new Image;i.id="_ldimg"+ ++d;b[f]={start:(new Date).getTime(),image:i,callbacks:[h]};i.src=f;e[e.length]=f}}}();fb.prototype={constructor:fb,load:function(a){var d=this;$a(this.url,function(b){d.loaded=true;d.image=b;a&&a()})}};var Xb=function(){return wa({fastpan:true,applyStyle:function(){},applyTransform:function(a,d,b){return{restore:null,x:d,y:b}},
getDimensions:function(){return{width:0,height:0}},getViewport:function(){},hitTest:function(){return false},prepare:function(){},projectXY:null,reset:function(){}})};fa("renderer","canvas",function(a,d,b,e,f){function h(q,x,z){var s,A;n[x]=function(B){for(s=u.length;s--;)if(A=z[u[s]])B[w[s]]=A}}function i(q,x,z){return{draw:z||v,viewport:q,hit:x&&c.isPointInPath(x.x,x.y),vpX:l,vpY:k,context:c}}e=J({},e);var j,g,o,c,l=0,k=0,n={},p=null,D={},m=function(){},v=function(){this.fill&&c.fill();this.stroke&&
c.stroke()},u=["fill","stroke","lineWidth","opacity"],w=["fillStyle","strokeStyle","lineWidth","globalAlpha"];(function(){function q(s,A){this.save();this.setTransform(1,0,0,1,0,0);var B=this.isPointInPath_old(s,A);this.restore();return B}var x=CanvasRenderingContext2D.prototype,z=document.createElement("canvas").getContext("2d");z.translate(50,0);z.moveTo(125,50);z.arc(100,50,25,0,360,false);if(!z.isPointInPath(150,50)){x.isPointInPath_old=x.isPointInPath;x.isPointInPath=q}})();if(d){j=d.offsetWidth;
g=d.offsetHeight;o=Y.create("canvas",null,{position:"absolute","z-index":1});o.width=j;o.height=g;a.attachFrame(o,true);c=null}b=J(f,{applyStyle:function(q){var x=n[q],z=c&&c.canvas?c.canvas.id:"default",s;D[z]||(D[z]=[]);s=D[z].pop()||"reset";if(x){D[z].push(q);x(c);return s}},applyTransform:function(q){if(q.translateX!==0||q.translateY!==0||q.scaling!==1||q.rotation!==0){c.save();p={undo:function(){c.restore();p=null},x:q.xy.x,y:q.xy.y};c.translate(q.xy.x-l+q.translateX,q.xy.y-k+q.translateY);q.rotation!==
0&&c.rotate(q.rotation);q.scaling!==1&&c.scale(q.scaling,q.scaling)}return p},drawTiles:function(q,x,z){for(var s=x.length;s--;){q=x[s];if(!q.loaded&&z)q.load(a.invalidate);else q.image&&c.drawImage(q.image,q.x-l,q.y-k)}},prepare:function(q,x){var z,s=false;if(c)c.restore();else c=o.getContext("2d");for(z=q.length;z--;)s=s||q[z].clip;l=x.x;k=x.y;if(c){s||c.clearRect(0,0,j,g);c.save()}c.globalCompositeOperation="source-over";return c},prepArc:function(q,x,z){c.beginPath();c.arc(q.xy.x-(p?p.x:l),q.xy.y-
(p?p.y:k),q.size>>1,q.startAngle,q.endAngle,false);return i(x,z)},prepImage:function(q,x,z,s){var A=(s.x||q.xy.x)-(p?p.x:l),B=(s.y||q.xy.y)-(p?p.y:k),E=s.image||q.image;if(E){c.beginPath();c.rect(A,B,s.width||E.width,s.height||E.height);return i(x,z,function(){c.drawImage(E,A,B,s.width||E.width,s.height||E.height)})}},prepMarker:function(q,x,z){var s=q.xy.x-(p?p.x:l),A=q.xy.y-(p?p.y:k),B=q.size,E=undefined;c.beginPath();switch(q.markerType.toLowerCase()){case "image":E=m;c.rect(s-(B>>1),A-(B>>1),
B,B);if(q.reset&&q.image){q.image=null;q.reset=false}q.image?c.drawImage(q.image,s-(B>>1),A-(B>>1),B,B):$a(q.imageUrl,function(H){q.image=H;c.drawImage(q.image,s-(B>>1),A-(B>>1),B,B)});break;default:c.moveTo(s,A);c.lineTo(s-(B>>1),A-B);c.lineTo(s+(B>>1),A-B);c.lineTo(s,A)}return i(x,z,E)},prepPoly:function(q,x,z,s){var A=true;q=s.points||q.points().cull(x);s=p?p.x:l;var B=p?p.y:k;c.beginPath();for(var E=q.length;E--;){var H=q[E].x-s,L=q[E].y-B;if(A){c.moveTo(H,L);A=false}else c.lineTo(H,L)}return i(x,
z)},getContext:function(){return c}});(function(){Eb.each(function(q,x){h(null,q,x)});G.bind("styleDefined",h)})();b.bind("detach",function(){d.removeChild(o)});b.bind("resize",function(){});return b});fa("renderer","dom",function(a,d,b,e,f){function h(c){var l=c.image=new Image;g[c.id]=c;l.src=c.url;l.onload=function(){if(o[c.id])j.appendChild(this);else c.image=null};l.style.cssText="-webkit-user-select: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute;";
return l}function i(c,l,k){var n=[],p;for(p in c){var D=c[p];if(k?D[k]:!l[p]){if(D.image&&D.image.parentNode){j.removeChild(D.image);D.image=null}n[n.length]=p}}for(l=n.length;l--;)delete c[n[l]]}var j=null,g={},o={};j=Y.create("div","",Y.styles({width:d.offsetWidth+"px",height:d.offsetHeight+"px"}));d.childNodes.length>0?d.insertBefore(j,d.childNodes[0]):d.appendChild(j);a.attachFrame(j);b=J(f,{drawTiles:function(c,l,k){for(var n,p=c.x,D=c.y,m=l.length;m--;){c=l[m];if(c.url){(n=c.image||(k?h(c):
null))&&Y.move(n,c.x-p,c.y-D);o[c.id]=c}}}});b.bind("predraw",function(){i(g,o);o={}});b.bind("detach",function(){d.removeChild(j)});a.bind("reset",function(){for(i(g,o={});j.childNodes.length>0;)j.removeChild(j.childNodes[0])});return b});var Eb=function(){function a(b,e){if(R(b,pa)){G.trigger("styleDefined",b,d[b]=e);return b}else{var f=[],h;for(h in b)f[f.length]=a(h,b[h]);return f}}var d={};a({reset:{fill:"#ffffff",opacity:1},highlight:{fill:"#ff0000"},waypoints:{lineWidth:4,stroke:"#003377",
fill:"#ffffff"},waypointsHover:{lineWidth:4,stroke:"#ff0000",fill:"#ffffff"}});return{resetStyle:"reset",each:function(b){for(var e in d)b(e,d[e])},get:function(b){return d[b]},define:a}}();fa("view","view",function(a){function d(r,t,C,N){q(Da(V+Aa(2,N)-1,0.125),false,true)}function b(r,t){var C=W&&W.projectXY?W.projectXY(r,t):null;if(!C){C=v();var N=1/V;C=new P.XY(C?C.x+r*N:r,C?C.y+t*N:t)}return C.sync(P,true)}function e(r,t,C){x("doubleTap",t,C,b(C.x,C.y));a.scalable&&q(2,{easing:"quad.out",duration:300},
true)}function f(r,t,C){y=null;ea=true;D("down",t,C)}function h(r,t,C){D("hover",t,C)}function i(r,t,C,N){k(t,C,false);if(!y){F=N.x;M=N.y}}function j(r,t,C){k(t,C,true);ea=false}function g(){clearTimeout(Fb);Fb=setTimeout(function(){if(I)if(I.offsetWidth!==Na*2||I.offsetHeight!==Oa*2){var r=m();p(a.container);m(r.x,r.y)}},250)}function o(r,t,C){D("tap",t,C);P.trigger("tap",t,C,b(C.x,C.y,true))}function c(){ia&&ia.unbind();if(W){ia=INTERACT.watch(W.interactTarget||I);if(a.scalable){ia.bind("zoom",
d);ia.bind("doubleTap",e)}ia.bind("pointerDown",f);ia.bind("pointerMove",i);ia.bind("pointerUp",j);a.captureHover&&ia.bind("pointerHover",h);ia.bind("tap",o)}}function l(r){if(W){W.trigger("detach");W=null}var t=P,C=H,N=I,X=a;r=r.split("/");for(var $=new Xb(t,C,N,X),ra=0;ra<r.length;ra++)$=ya("renderer",r[ra],t,C,N,X,$);W=$;Z=W.fastpan&&Y.transforms;c();P.trigger("reset");w()}function k(r,t,C){if(y){r=b(t.x,t.y);y.drag.call(y.target,y,r.x,r.y,C)&&da++;if(C)y=null}}function n(r){for(var t=E;t--;)if(B[t].id===
r)return t;return E}function p(r){I=document.getElementById(r);I.appendChild(L=Y.create("div","",Y.styles({overflow:"hidden",width:I.offsetWidth+"px",height:I.offsetHeight+"px"})));r=a.padding;if(r===s){r=I.offsetWidth;var t=I.offsetHeight,C=lb(r*r+t*t);ja=new U(C-r>>1,C-t>>1)}else ja=new U(r,r);ab=L.offsetWidth+ja.x*2;bb=L.offsetHeight+ja.y*2;nb=ab/2;ob=bb/2;Na=I.offsetWidth/2;Oa=I.offsetHeight/2;Pa=new U(nb,ob);L.appendChild(H=Y.create("div","",Y.styles({width:ab+"px",height:bb+"px","z-index":2,
margin:-ja.y+"px 0 0 "+-ja.x+"px"})));l(a.renderer);r=a.controls;for(t=0;t<A.length;t++)A[t].trigger("detach");A=[];for(t=0;t<r.length;t++)A[A.length]=ya("control",r[t],P,L,I,a[r[t]])}function D(r,t,C){var N=(new U(C.x-Na+nb,C.y-Oa+ob)).rotate(-sa*ca,Pa).scale(1/V,Pa);ga=Hits.init(r,t,C,b(C.x,C.y,true),N);for(r=E;r--;)if(B[r].visible)Q=Q||(B[r].hitGuess?B[r].hitGuess(ga.gridX,ga.gridY,P):false);Q&&da++}function m(r,t,C){if(R(r,pa)||R(r,Ub)){t=new P.XY(r);t.sync(P);r=t.x;t=t.y}if(R(r,qa)){z(r-Na-ja.x,
t-Oa-ja.y,C);return P}else return z().offset(Na+ja.x|0,Oa+ja.y|0).sync(P,true)}function v(){var r=new va(S,T,ab,bb);r.scaleFactor=V;r.padding=ja?ja.copy():new U;return r}function u(r,t,C){if(R(r,pa)&&R(t,xa))for(t=0;t<E;t++){if(B[t].id===r)return B[t]}else if(R(r,pa)){t=ya("layer",t,P,C);t.added=(new Date).getTime();t.id=r;B[n(r)]=t;B.sort(function(N,X){return X.zindex-N.zindex||X.added-N.added});E=B.length;P.trigger("resync");w();P.trigger("layerChange",P,t);da++;return t}else return[].concat(B)}
function w(){var r=v();if(r){if(Ha||Ia)if(r){var t=cb?S+(r.w>>1):S,C=db?T+(r.h>>1):T,N=r.w,X=r.h;if(Ha&&Ha>N)if(t+N>Ha)S=cb?S:Ha-N;else if(t<0)S=cb?S:0;if(Ia&&Ia>X)if(C+X>Ia)T=db?T:Ia-X;else if(C<0)T=db?T:0}Gb=S;Hb=T;P.trigger("refresh",P,r);da++}}function q(r,t,C){if(R(r,qa)){var N=C?r:V*r;if(!Yb){t=null;r=La(Ba(N)/Math.LN2);N=Aa(2,r)}if(t)Qa=ta.tween([V],[N],t,function(){V=N;Qa=null;da++});else{V=N;da++}return P}else return V}function x(){for(var r=P.trigger.apply(null,arguments).cancel,t=B.length;t--;)r=
B[t].trigger.apply(null,arguments).cancel||r;return!r}function z(r,t,C){if(R(r,qa)){if(C)za=ta.tween([S,T],[r,t],C,function(){za=null});else{S=r|0;T=t|0;da++}return P}else return(new P.XY(S,T)).sync(P,true)}a=J({container:"",captureHover:true,controls:[],drawOnScale:true,padding:128,inertia:true,refreshDistance:256,pannable:true,scalable:true,renderer:"canvas"},a);var s="auto",A=[],B=[],E=0,H=null,L=null,I,y=null,K=!R(window.attachEvent,xa),Q=false,Z,ea=false,F=0,M=0,O=a.refreshDistance,S=0,T=0,ba=
0,Ea=0,Gb=0,Hb=0,Ha=null,Ia=null,cb=false,db=false,za=null,ja,ga=null,Ra=null,W,Fb=0,Pa=new U,sa=0,Sa=null,V=1,Qa=null,pb=1,ia=null,qb={index:0,draw:false},Yb=true,da=0,ab,bb,nb,ob,Na,Oa,P={XY:U,id:a.id,panSpeed:0,attachFrame:function(r,t){t&&H.appendChild(r)},center:m,detach:function(){W&&W.trigger("detach");ia&&ia.unbind();if(L){I.removeChild(L);H=L=null}},layer:u,invalidate:function(){da++},pan:function(r,t,C){z(S+r,T+t,C)},refresh:w,rotate:function(r,t,C){if(R(r,qa)){var N=C?r:sa+r;if(t)Sa=ta.tween([sa],
[N],t,function(){sa=N%360;Sa=null;da++});else{sa=N%360;da++}return P}else return sa},scale:q,triggerAll:x,setMaxOffset:function(r,t,C,N){Ha=r;Ia=t;cb=C;db=N},offset:z,viewport:v};wa(P);P.bind("resize",g);P.bind("layerRemove",function(r,t){var C=ib(B,t.id);if(C>=0&&C<E){B.splice(C,1);da++}E=B.length});yb(P,a,{container:p,captureHover:c,scalable:c,pannable:c,renderer:l});u("markers","draw",{zindex:20});p(a.container);K?window.attachEvent("onresize",g):window.addEventListener("resize",g,false);Ga.attach(function(r){var t=
[],C,N,X;self.panSpeed=panSpeed=oa(F)+oa(M);C=V!==pb;if(panSpeed>0||C||za||Qa||Sa){da++;if(za&&panSpeed>0){za(true);za=null}}if(panSpeed<2&&(oa(S-Gb)>=O||oa(T-Hb)>=O))w();qb.index++;qb.draw=da||panSpeed||0;if(W&&qb.draw){if(Qa)V=Qa()[0];if(Sa)sa=Sa()[0];ba+=F;Ea+=M;if(F||M)P.trigger("pan");if(Y.transforms){if(V!==1)t[t.length]="scale("+V+")";if(sa!==0)t[t.length]="rotate("+sa+"deg)"}if(C=!Z||(a.drawOnScale||V===1)&&panSpeed<5){if(za){C=za();S=C[0]|0;T=C[1]|0}else{S=S-ba/V|0;T=T-Ea/V|0}X=v();W.trigger("predraw",
X);if(W.prepare(B,X,r,ga)){N=Ea=C=ba=da=0;for(ii=E;ii--;){var $=B[ii];if($.visible){var ra=$.style?W.applyStyle($.style,true):null;$.draw(W,X,P,r,ga);ra&&W.applyStyle(ra)}}W.trigger("render",X);P.trigger("drawComplete",X,r);Y.move(H,C,N,t,Pa)}}else Y.move(H,ba,Ea,t,Pa);if(ea||!a.inertia)M=F=0;else if(F!=0||M!=0){F*=0.8;M*=0.8;if(oa(F)<0.5)F=0;if(oa(M)<0.5)M=0}if(ga){r=true;t=ga?ga.elements:[];if(Ra&&Ra.type==="hover"){diffElements=Hits.diffHits(Ra.elements,t);if(diffElements.length>0)Hits.triggerEvent(Ra,
P,"Out",diffElements);else r=false}if(t.length>0){N=ga.gridX;X=ga.gridY;for(C=t.length;C--;){$=t[C];ra=N;var Ib=X,Jb=$&&$.drag&&(!$.canDrag||$.canDrag($,ra,Ib));if(Jb){y=$;y.startX=ra;y.startY=Ib}if(Jb)break}r&&Hits.triggerEvent(ga,P)}Ra=t.length>0?J({},ga):null;ga=null}if(pb!==V){P.trigger("scaleChanged",V);pb=V}}});return P});fa("view","map",function(a){function d(g,o){var c=j.viewport();if(g){c=Da(g.bestZoomLevel(c),o||0);return b(c).center(g.center())}else return new Ka((new ua(c.x,c.y2)).sync(j,
true).pos(),(new ua(c.x2,c.y)).sync(j,true).pos())}function b(g,o,c){if(R(g,qa)){g=Da(a.minZoom,Ma(a.maxZoom,g|0));if(g!==h){var l=j.viewport(),k=j.offset(),n=l.w/2;l=l.h/2;var p=Aa(2,g-h),D=n/p|0,m=l/p|0;h=g;j.offset(((o||k.x+n)-D)*p,((c||k.y+l)-m)*p);refreshY=refreshX=0;j.trigger("zoom",g);j.trigger("reset");f=j.rpp=aa/(256<<h);j.setMaxOffset(aa/f|0,aa/f|0,true,false);j.scale(1,false,true);j.trigger("resync");j.refresh()}return j}else return h}a=J({controls:["zoombar"],minZoom:1,maxZoom:18,renderer:"canvas/dom",
zoom:1,zoombar:{}},a);var e=new ua,f,h=a.zoom||a.zoomLevel,i=0,j=J(ya("view","view",a),{XY:ua,bounds:d,zoom:b});j.bind("refresh",function(){var g=j.viewport();if(e.x!=g.x||e.y!=g.y){j.trigger("boundsChange",d());e.x=g.x;e.y=g.y}});j.bind("scaleChanged",function(g,o){var c=Ba(o)/Math.LN2|0;if(c!==0){o=Aa(2,c);clearTimeout(i);i=setTimeout(function(){b(h+c)},500)}});return j});var ta=function(){return{tween:function(a,d,b,e,f){function h(p){var D=p-n;p=n+k<=p;for(var m=i;m--;){j[m]=o(D,a[m],c[m],k);
f&&f.invalidate()}if(p||l){Ga.detach(h);for(m=0;m<g.length;m++)g[m]&&g[m](j,D,l)}}b=J({easing:"sine.out",duration:1E3,complete:null},b);var i=a.length,j=[].concat(a),g=[e,b.complete],o=Ob(b.easing),c=[],l=false,k=b.duration,n=(new Date).getTime();for(b=i;b--;)c[b]=d[b]-a[b];Ga.attach(h);return function(p){l=p;return j}},tweenDrawable:function(a,d,b,e,f){var h=ta.tween([b],[e],f,function(){a[d]=e;for(var j=a.tweens.length;j--;)if(a.tweens[j]===i){a.tweens.splice(j,1);break}},a.view),i=function(){a[d]=
h()[0]};return i}}}(),Ca=function(a,d,b){b=J({style:null,xy:null,size:20,fill:false,stroke:true,draggable:false,observable:true,properties:{},typeName:"Shape",zindex:0},b);J(this,b);if(R(this.xy,pa))this.xy=new a.XY(this.xy);this.id="drawable_"+Wb++;this.bounds=null;this.view=a;this.layer=d;this.tweens=[];this.rotation=this.animations=0;this.scaling=1;this.translateY=this.translateX=0;this.observable&&wa(this)};Ca.prototype={constructor:Ca,applyTweens:function(){for(var a=this.tweens.length;a--;)this.tweens[a]()},
drag:null,draw:null,getProps:null,resync:function(){if(this.xy){this.xy.sync(this.view);if(this.size){var a=this.size>>1;this.updateBounds(new va(this.xy.x-a,this.xy.y-a,this.size,this.size))}}},rotate:function(a,d,b){if(R(a,qa)){a=(b?a:this.rotation*na+a)*ca;if(d)this.tweens.push(ta.tweenDrawable(this,"rotation",this.rotation,a,d));else{this.rotation=a;this.view.invalidate()}return this}else return this.rotation*na},scale:function(a,d,b){if(R(a,qa)){a=b?a:this.scaling*a;if(d)this.tweens.push(ta.tweenDrawable(this,
"scaling",this.scaling,a,d));else{this.scaling=a;this.view.invalidate()}return this}else return this.scaling},translate:function(a,d,b,e){if(R(a,qa)){a=e?a:this.translateX+a;d=e?d:this.translateY+d;if(b){this.tweens.push(ta.tweenDrawable(this,"translateX",this.translateX,a,b));this.tweens.push(ta.tweenDrawable(this,"translateY",this.translateY,d,b))}else{this.translateX=a;this.translateY=d;this.view.invalidate()}return this}else return new U(this.translateX,this.translateY)},updateBounds:function(a,
d){a&&(!this.bounds||a.x!=this.bounds.x||a.y!=this.bounds.y)&&this.trigger("move",this,a,this.bounds);this.bounds=a;if(d)this.xy=this.bounds.center()}};fa("drawable","marker",function(a,d,b){b=J({fill:true,stroke:false,markerType:"simple",hoverStyle:"highlight",typeName:"Marker"},b);return new Ca(a,d,b)});fa("drawable","poly",function(a,d,b){function e(){var c,l,k,n,p,D,m;g=b.simplify?j.simplify():j;for(c=g.length;c--;){l=g[c].x;k=g[c].y;D=R(D,xa)||l<D?l:D;m=R(m,xa)||k<m?k:m;n=R(n,xa)||l>n?l:n;p=
R(p,xa)||k>p?k:p}o.updateBounds(new va(D,m,n-D,p-m),true)}function f(c){if(R(c,wb)){j=new Ja(b.allowCull);Db.process(c,function(l,k){for(var n=0;n<k;n++)j.push(new a.XY(l[n]))},h,i);return o}else return g}function h(){j.length&&Db.process(j,function(c,l){for(var k=l;k--;)c[k].sync(a)},e,i)}b=J({allowCull:false,simplify:false,fill:true,points:[],typeName:"Poly"},b);var i=500,j=new Ja(b.allowCull),g,o=J(new Ca(a,d,b),{points:f,resync:h});f(b.points);return o});fa("drawable","line",function(a,d,b){b.fill=
false;b.allowCull=true;return ya("drawable","poly",a,d,b)});fa("drawable","image",function(a,d,b){function e(){if(g&&g.width>0){if(!this.centerOffset)this.centerOffset=new U(-g.width>>1,-g.height>>1);this.updateBounds(new va(this.xy.x+this.centerOffset.x,this.xy.y+this.centerOffset.y,g.width,g.height),false)}}function f(c){if(this.imageUrl=c){var l=this;$a(this.imageUrl,function(k,n){g=k;if(n){var p=o.layer?o.layer.view:null;p&&p.invalidate()}e.apply(l)})}}b=J({image:null,imageUrl:null,centerOffset:null,
typeName:"Image"},b);var h=Ca.prototype.resync,i=0,j=0,g=b.image,o=J(new Ca(a,d,b),{changeImage:f,getProps:function(){this.bounds||e(this,g);return{image:g,x:this.xy.x+i,y:this.xy.y+j}},resync:function(c){h.call(this,c);e.call(this)}});g||f.call(this,this.imageUrl);if(this.centerOffset){i=this.centerOffset.x;j=this.centerOffset.y}});fa("drawable","arc",function(a,d,b){b=J({startAngle:0,endAngle:Math.PI*2,typeName:"Arc"},b);return new Ca(a,d,b)});Va.prototype={constructor:Va,clip:null,cycle:function(){},
draw:function(){},hitGuess:null,remove:function(){this.view.trigger("layerRemove",this)}};fa("layer","tile",function(a,d){d=J({generator:"osm",imageLoadArgs:{}},d);var b=ya("generator",d.generator,d).run,e=null,f=[],h=J(new Va(a,d),{draw:function(i,j,g){i.drawTiles&&i.drawTiles(j,e.search(j.buffer(128)),g.panSpeed<2)}});a.bind("resync",function(){var i=a&&a.zoom?a.zoom():0;f[i]||(f[i]=ub(i));e=f[i]});a.bind("refresh",function(i,j,g){e&&b(j,g,e,function(){j.invalidate()})});return h});fa("layer","draw",
function(a,d){function b(o,c,l,k){var n=this.dragOffset;if(!n)n=this.dragOffset=new a.XY(o.startX-this.xy.x,o.startY-this.xy.y);this.xy.x=c-n.x;this.xy.y=l-n.y;if(k){delete this.dragOffset;a.invalidate();this.xy.sync(a,true);this.trigger("dragDrop")}return true}function e(o){clearTimeout(j);j=setTimeout(function(){h.sort(function(c,l){if(l.xy&&c.xy){var k=l.xy.y-c.xy.y;return k!=0?k:l.xy.x-c.xy.x}});o&&o.invalidate()},50)}function f(o,c,l,k){k&&i.remove(k,c);i.insert(l,c)}d=J({zindex:10},d);var h=
[],i,j=0,g=J(new Va(a,d),{itemCount:0,clear:function(){i=new vb;h=[];g.trigger("cleared");g.itemCount=0;a.invalidate()},create:function(o,c,l){c=ya("drawable",o,a,g,c);if(l)h.unshift(c);else h[h.length]=c;c.resync();i&&c.bounds&&i.insert(c.bounds,c);e(a);c.bind("move",f);g.itemCount=h.length;g.trigger(o+"Added",c);return c},draw:function(o,c,l,k,n){l={};k=i&&c?i.search(c):[];for(var p=k.length;p--;){var D=k[p],m=D.style||g.style,v,u,w=D.getProps?D.getProps(o):l;v=o["prep"+D.typeName];D.tweens.length>
0&&D.applyTweens();u=o.applyTransform(D);if(w=v?v.call(o,D,c,n,w):null){if(n&&w.hit){n.elements.push(Hits.initHit(D.type,D,D.draggable?b:null));v=n.type+"Style";m=D[v]||g[v]||m}m=m?o.applyStyle(m,true):null;(v=D.draw||w.draw)&&v.call(D,w);m&&o.applyStyle(m)}u&&u.undo&&u.undo()}},find:function(){return[].concat(h)},hitGuess:function(o,c){return i&&i.search({x:o-10,y:c-10,w:20,h:20}).length>0}});a.bind("resync",function(){i=ub(a.zoom(),i);for(var o=h.length;o--;)h[o].resync()});return g});Wa.prototype=
{constructor:Wa};fa("control","zoombar",function(a,d,b,e){function f(s,A){var B=w[s]=Y.create("div","t5-zoombar-button",{position:"absolute",background:h(s),"z-index":51,width:e.width+"px",height:e.buttonHeight+"px","margin-top":(A||0)+"px"});q.appendChild(B)}function h(s,A){return"url("+e.images+") 0 -"+(l+n*3+(s||0)*o*3+(A||0)*o)+"px"}function i(s){return"url("+e.images+") 0 -"+(l+(s||0)*n)+"px"}function j(s,A){var B;if(s===k){k.style.background=i(A);B="thumb"}else for(var E=0;E<w.length;E++)if(s===
w[E]){B="button"+E;w[E].style.background=h(E,A);break}return B}function g(s){if(s!==v){v=s;m=D-v/u*(D-p)|0;Y.move(k,0,m-p);clearTimeout(x);x=setTimeout(function(){a.zoom(v)},500)}}e=J({width:24,height:200,images:"img/zoom.png",align:"right",marginTop:10,spacing:10,thumbHeight:16,buttonHeight:16},e);var o=e.buttonHeight,c,l=e.height,k,n=e.thumbHeight,p=e.spacing+o-(n>>1),D=e.height-o-(n>>1),m=p,v=-1;d=a.minZoom();var u=a.maxZoom()-d+1,w=[],q,x=0,z={button0:function(){a.zoom(a.zoom()+1)},button1:function(){a.zoom(a.zoom()-
1)}};q=Y.create("div","t5-zoombar",{position:"absolute",background:"url("+e.images+")","z-index":50,overflow:"hidden",width:e.width+"px",height:e.height+"px",margin:function(){var s=e.spacing,A=la("{0}px 0 0 {1}px");if(e.align==="right")s=b.offsetWidth-e.width-e.spacing;return A(e.marginTop,s)}()});b.childNodes[0]?b.insertBefore(q,b.childNodes[0]):b.appendChild(q);q.appendChild(k=Y.create("div","t5-zoombar-thumb",{position:"absolute",background:i(),"z-index":51,width:e.width+"px",height:e.thumbHeight+
"px",margin:"10px 0 0 0",top:m-p+"px"}));f(0);f(1,e.height-e.buttonHeight);c=INTERACT.watch(q,{bindTarget:q});c.bind("pointerMove",function(s,A,B){m=Math.min(Math.max(p,B.y-(n>>1)),D);g(u-(m-p)/D*u|0)});c.bind("pointerDown",function(s){j(s.target,2)});c.bind("pointerUp",function(s){j(s.target,0)});c.bind("tap",function(s){(s=z[j(s.target,2)])&&s()});d=new Wa(a);d.bind("detach",function(){c.unbind();b.removeChild(q)});a.bind("zoom",function(s,A){g(A)});g(a.zoom());return d});ka.prototype={constructor:ka,
distanceTo:function(){if(!targetPos||this.empty()||targetPos.empty())return 0;var a=(targetPos.lat-this.lat)*ca>>1,d=(targetPos.lon-this.lon)*ca>>1;a=ma(a)*ma(a)+Fa(this.lat*ca)*Fa(targetPos.lat*ca)*ma(d)*ma(d);return 6371*2*Tb(lb(a),lb(1-a))},equalTo:function(a){return pos&&this.lat===a.lat&&this.lon===a.lon},empty:function(){return this.lat===0&&this.lon===0},inArray:function(a){for(var d=a.length;d--;)if(this.equal(a[d]))return true;return false},offset:function(a,d){var b=this.lat*ca,e=this.lon*
ca,f=b+a/6371;b=Cb(ma(d/6371)/Fa(b));e=e+b;f=(f+Ua)%Math.PI-Ua;e%=aa;return new ka(f*na,e*na)},toPixels:function(){return Za(this.lon,this.lat)},toBounds:function(a){var d=a.radians(),b=this.lat*ca,e=this.lon*ca;a=b-d;var f=b+d;if(a>zb&&f<kb){b=Cb(ma(d)/Fa(b));d=e-b;if(d<Sb)d+=aa;e=e+b;if(e>Ab)e-=aa}else{a=Da(a,zb);f=Ma(f,kb);d=xb;e=Xa}return new Ka(new ka(a*na,d*na),new ka(f*na,e*na))},toString:function(a){return this.lat+(a||" ")+this.lon}};(function(){fa("fn","generalize",function(a,d,b){var e=
a.length,f=[],h=null;b=(b||250)/1E3;for(e=e;e--;)if(e===0)f.unshift(a[e]);else{var i=!h||a[e].inArray(d)?b:h.distanceTo(a[e]);if(a[e]&&i>=b){f.unshift(a[e]);h=a[e]}}return f})})();Ka.prototype={constructor:Ka,bestZoomLevel:function(a){var d=this.center();d=Ma(La(oa(d.lat)*0.05),jb.length);var b=jb[d],e=this.size();d=Bb(Ba(jb[3]*a.h/e.y)/Ba(2));a=Bb(Ba(b*a.w/e.x)/Ba(2));return Ma(isNaN(d)?1E3:d,isNaN(a)?1E3:a)},center:function(){var a=this.size();return new ka(this.min.lat+(a.y>>1),this.min.lon+(a.x>>
1))},expand:function(a){this.min.lat-=a;this.max.lat+=a;this.min.lon-=a%360;this.max.lon+=a%360},size:function(a){var d=new U(0,this.max.lat-this.min.lat);d.x=(a||R(a,xa))&&this.min.lon>this.max.lon?360-this.min.lon+this.max.lon:this.max.lon-this.min.lon;return d},toString:function(){return"min: "+this.min+", max: "+this.max}};hb.prototype={constructor:hb,radians:function(a){if(R(a,qa)){this.meters=a*6371E3;return this}else return this.meters/6371E3},toString:function(){if(this.meters>1E3)return(this.meters/
10|0)/100+"km";return this.meters+"m"}};J(G,{ex:J,log:ha,observable:wa,configurable:yb,formatter:la,wordExists:function(a,d){for(var b=a.split(/\s|\,/).length;b--;)if(a.toLowerCase()==d.toLowerCase())return true;return false},is:R,indexOf:ib,fn:function(a){return Vb("fn",a)},project:Za,unproject:mb,getImage:$a,userMessage:function(a,d,b){G.trigger("userMessage",a,d,b)},Registry:Ya,Style:Eb,DOM:Y,Rect:va,XY:U,Line:Ja,Pos:ka,BBox:Ka,Distance:hb,Hits:Hits,Control:Wa,Tile:fb,Tweener:ta});G.RouteTools=
function(){function a(c){if(h.test(c))return"-slight";return""}function d(c,l){l.geometry&&c.layer("route","draw").create("line",{points:l.geometry,style:"waypoints",simplify:true})}function b(c){for(var l="unknown",k=e||g,n=0;n<k.length;n++){k[n].regex.lastIndex=-1;var p=k[n].regex.exec(c);if(p){l=k[n].customCheck?k[n].customCheck(c,p):k[n].turnType;break}}return l}var e=undefined,f=G.fn("generalize"),h=/bear/i,i=/right/i,j={unknown:"0:0",start:"1:0","continue":"1:1",arrive:"1:2",left:"2:0","left-slight":"2:1",
"left-sharp":"2:2",right:"3:0","right-slight":"3:1","right-sharp":"3:2","uturn-left":"4:0","uturn-right":"4:1",merge:"4:2",roundabout:"5:0",ramp:"6:0","ramp-exit":"6:1"},g=function(){var c=[];c.push({regex:/continue/i,turnType:"continue"});c.push({regex:/(take|bear|turn)(.*?)left/i,customCheck:function(l,k){return"left"+a(k[1])}});c.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(l,k){return"right"+a(k[1])}});c.push({regex:/enter\s(roundabout|rotary)/i,turnType:"roundabout"});c.push({regex:/take.*?ramp/i,
turnType:"ramp"});c.push({regex:/take.*?exit/i,turnType:"ramp-exit"});c.push({regex:/make(.*?)u\-turn/i,customCheck:function(l,k){return"uturn"+(i.test(k[1])?"-right":"-left")}});c.push({regex:/proceed/i,turnType:"start"});c.push({regex:/arrive/i,turnType:"arrive"});c.push({regex:/fell\sthrough/i,turnType:"merge"});return c}(),o={calculate:function(c){c=J({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},c);var l=G.Registry.create("service","routing");l&&l.calculate(c,
function(k){if(c.generalize)k.geometry=f(k.geometry,k.getInstructionPositions());if(c.map){d(c.map,k);c.autoFit&&c.map.bounds(k.boundingBox)}c.success&&c.success(k)})},createMapOverlay:d,getSpriteOffset:function(c,l){var k=j[c];if(k=k?k.split(":"):null)return{x:-k[0]*(l||16),y:-k[1]*(l||16)};return null},parseTurnType:b,Instruction:function(c){var l=c=J({position:null,description:"",distance:0,distanceTotal:0,time:0,timeTotal:0,turnType:null},c),k=c.description;k=k.replace(/(\w)(\/)(\w)/g,"$1 $2 $3");
l.description=k;if(!c.turnType)c.turnType=b(c.description);return c},RouteData:function(c){c=J({geometry:[],instructions:[],boundingBox:null},c);if(!c.boundingBox)c.boundingBox=new G.BBox(c.geometry);return J({getInstructionPositions:function(){for(var l=[],k=0;k<c.instructions.length;k++)c.instructions[k].position&&l.push(c.instructions[k].position);return l}},c)}};G.observable(o);return o}();COG=typeof COG!=="undefined"?COG:{};COG.extend=function(){for(var a=arguments[0]||{},d,b=1,e=arguments.length;b<
e;b++)if((d=arguments[b])!==null)for(var f in d){var h=d[f];if(a!==h)if(h!==undefined)a[f]=h}return a};(function(){var a=/^P(\d+Y)?(\d+M)?(\d+D)?$/,d=/^(\d+H)?(\d+M)?(\d+S)?$/,b={8601:function(f){f=f.split("T");var h=null;h=null;var i=0,j=0;a.lastIndex=-1;h=a.exec(f[0]);i+=h[3]?parseInt(h[3].slice(0,-1),10):0;d.lastIndex=-1;h=d.exec(f[1]);j+=h[1]?parseInt(h[1].slice(0,-1),10)*3600:0;j+=h[2]?parseInt(h[2].slice(0,-1),10)*60:0;j+=h[3]?parseInt(h[3].slice(0,-1),10):0;return new e(i,j)}},e=COG.Duration=
function(f,h){return{days:f?f:0,seconds:h?h:0}};COG.addDuration=function(){for(var f=new e,h=arguments.length;h--;){f.days+=arguments[h].days;f.seconds+=arguments[h].seconds}if(f.seconds>=86400){f.days+=~~(f.seconds/86400);f.seconds%=86400}return f};COG.formatDuration=function(f){var h,i,j="";if(f.days)j=f.days+" days ";if(f.seconds){f=f.seconds;if(f>=3600){h=~~(f/3600);f-=h*3600}if(f>=60){i=Math.round(f/60);f-=i*60}if(h)j=j+h+(h>1?" hrs ":" hr ")+(i?(i>10?i:"0"+i)+" min ":"");else if(i)j=j+i+" min";
else if(f>0)j=j+(f>10?f:"0"+f)+" sec"}return j};COG.parseDuration=function(f,h){var i=h?b[h]:null;if(i)return i(f);COG.Log.warn("Could not find duration parser for specified format: "+h);return new e}})();G.Decarta=function(){function a(m){return g(h.clientName,h.clientPassword,h.sessionID,h.configuration,h.release,m)}function d(m,v){return o(m.maxResponses,m.version,m.requestID,m.methodName,v)}function b(m,v){h.server||ha("No server configured for deCarta - we are going to have issues","warn");return c(h.server,
m.requestID,escape(v))}function e(m,v){Pb(b(m,a(d(m,m.getRequestBody()))),function(u){var w=u.response.XLS.Response;if(w.numberOfResponses>0&&w[m.methodName+"Response"]){u=null;if(m.parseResponse)u=m.parseResponse(w[m.methodName+"Response"]);v&&v(u)}else ha("no responses from server: "+u.response,"error")})}function f(m,v){var u=new n({json:m.StreetAddress}),w=new k({countryCode:m.countryCode});w.parse(m.Place);return new G.Addressing.Address({streetDetails:u,location:w,country:m.countryCode?m.countryCode:
"",postalCode:m.PostalCode?m.PostalCode:"",pos:v})}var h={sessionID:(new Date).getTime(),server:"",clientName:"",clientPassword:"",configuration:"",maxResponses:25,release:"4.4.2sp03",tileFormat:"PNG",fixedGrid:true,useCache:true,tileHosts:[],requestTimeout:3E4,geocoding:{countryCode:"US",language:"EN"}},i={DEFAULT:function(m){for(var v=["landmark","municipalitySubdivision","municipality","countrySubdivision"],u="",w=0;w<v.length;w++)if(m[v[w]])u+=m[v[w]]+" ";return u}},j=1,g=la("<xls:XLS version='1' xls:lang='en' xmlns:xls='http://www.opengis.net/xls' rel='{4}' xmlns:gml='http://www.opengis.net/gml'><xls:RequestHeader clientName='{0}' clientPassword='{1}' sessionID='{2}' configuration='{3}' />{5}</xls:XLS>"),
o=la("<xls:Request maximumResponses='{0}' version='{1}' requestID='{2}' methodName='{3}Request'>{4}</xls:Request>"),c=la("{0}/JSON?reqID={1}&chunkNo=1&numChunks=1&data={2}&responseFormat=JSON"),l=function(m){m=G.ex({countryCode:h.geocoding.countryCode,language:h.geocoding.language,freeform:null,streetAddress:{building:null}},m);var v=la('<xls:Address countryCode="{0}" language="{1}">');return{getXML:function(){var u=v(m.countryCode,m.language);if(m.freeform){var w=String(m.freeform).replace(/(\'|\")/,
"\\$1");u+="<xls:freeFormAddress>"+w+"</xls:freeFormAddress>"}return u+"</xls:Address>"}}},k=function(m){m=G.ex({landmark:"",municipality:"",municipalitySubdivision:"",countrySubdivision:"",countryCode:""},m);var v=G.ex({calcMatchPercentage:function(u){var w=0;if(m.landmark&&m.landmarkSubType){if(G.wordExists(u,m.landmarkSubType)){w+=0.4;w+=G.wordExists(u,m.landmark)?0.6:0}}else{w+=G.wordExists(u,m.municipalitySubdivision)?0.8:0;if(w===0&&m.municipality)w+=G.wordExists(u,m.municipality)?0.7:0}if(m.countrySubdivision)w+=
G.wordExists(u,m.countrySubdivision)?0.2:0;return w},getCountryCode:function(){if(m.countryCode)return m.countryCode.toUpperCase();return""},parse:function(u){for(var w=0;u&&w<u.length;w++){var q=u[w].type?u[w].type.slice(0,1).toLowerCase()+u[w].type.slice(1):"";if(typeof m[q]!=="undefined"){m[q]=u[w].content;if(u[w].subType)m[q+"SubType"]=u[w].subType}}G.ex(v,m)},toString:function(){var u=i[v.getCountryCode()];if(!u)u=i.DEFAULT;return u(m)}},m);return v},n=function(m){m=G.ex({json:{}},m);var v="",
u="";if(m.json.Street)v=m.json.Street.content?m.json.Street.content:m.json.Street;v=v&&v.replace?v.replace(/\/\d+$/,""):"";if(m.json.Building)if(m.json.Building.number)u=m.json.Building.number;return{building:u,street:v,calcMatchPercentage:function(w){var q=0,x=G.Addressing.normalize(w),z=G.Addressing.normalize(v);if(m.json.Building)if(G.Addressing.buildingMatch(w,m.json.Building.number.toString()))q+=0.2;if(x&&z&&G.wordExists(x,z))q+=0.8;return q},toString:function(){if(v)return(u?u+" ":"")+v;return""}}},
p=function(){return{methodName:"",maxResponses:25,version:"1.0",requestID:j++,getRequestBody:function(){return""},parseResponse:function(m){return m}}},D=function(){return G.ex(new p,{methodName:"RUOK",parseResponse:function(m){return{aliasCount:m.maxHostAliases,host:m.hostName}}})};G.Registry.register("generator","decarta",function(m){function v(q,x,z,s){if(q=q.zoom?q.zoom():0){var A=2<<q-1,B=A>>1,E=m.tileSize,H=(x.w/E|0)+1,L=(x.h/E|0)+1,I=(x.x/E|0)-B;x=A-(x.y/E|0)-B-L;var y=z.search({x:(B+I)*E,
y:(B+x*-1-L)*E,w:H*E,h:L*E});A={};var K;for(K=y.length;K--;)A[y[K].id]=true;for(y=0;y<=H;y++)for(K=0;K<=L;K++){var Q=I+y,Z=x+K-1,ea=Q+"_"+Z;if(!A[ea]){Q=new G.Tile((B+I+y)*E,(B+x*-1-K)*E,w[y%w.length]+"/openls/image-cache/TILE?LLMIN=0.0,0.0&LLMAX="+u[q]+"&CACHEABLE=true&DS=navteq-world&WIDTH=256&HEIGHT=256&CLIENTNAME="+h.clientName+"&SESSIONID="+h.sessionID+"&FORMAT=PNG&CONFIG="+h.configuration+"&N="+Z+"&E="+Q,E,E,ea);z.insert(Q,Q)}}s&&s()}}m=G.ex({tileSize:256},m);var u=["89.787438015348100000,360.00000000000000000",
"85.084059050110410000,180.00000000000000000","66.653475896509040000,90.00000000000000000","41.170427238429790000,45.000000000000000000","22.076741328793200000,22.500000000000000000","11.251819676168665000,11.250000000000000000","5.653589942659626000,5.625000000000000000","2.830287664051185000,2.812500000000000000","1.415581451872543800,1.406250000000000000","0.707845460801532700,0.703125000000000000","0.353929573271679340,0.351562500000000000","0.176965641673330230,0.175781250000000000","0.088482927761462040,0.087890625000000000",
"0.044241477246363230,0.043945312500000000","0.022120740293895182,0.021972656250000000","0.011060370355776452,0.010986328125000000","0.005530185203987857,0.005493164062500000","0.002765092605263539,0.002746582031250000","0.001382546303032519,0.001373291015625000","0.000691272945568983,0.000686645507812500","0.000345636472797214,0.000343322753906250"],w=null;G.userMessage("ack","decarta","&copy; deCarta, Inc. Map and Imagery Data &copy; NAVTEQ or Tele Atlas or DigitalGlobe");return{run:function(q,
x,z,s){w?v(q,x,z,s):e(new D,function(A){w=[];if(A.aliasCount)for(var B=0;B<A.aliasCount;B++)w[B]="http://"+A.host.replace("^(.*?).(.*)$","\u0001-0"+(B+1)+".\u0002");else w=["http://"+A.host];v(q,x,z,s)})}}});G.Registry.register("service","geocoder",function(){var m=function(u){function w(z){var s=[],A=z?z.numberOfGeocodedAddresses:0,B=[];if(A>1)B=z.GeocodedAddress;else if(A==1)B=[z.GeocodedAddress];try{for(z=0;B&&z<B.length;z++){var E,H=B[z],L=A=null;if(H&&H.GeocodeMatchCode&&H.GeocodeMatchCode.matchType!==
"NO_MATCH"){if(H&&H.Point)L=new G.Pos(H.Point.pos);if(H&&H.Address)A=f(H.Address,L)}(E=A)&&s.push(E)}}catch(I){ha(I,"error")}return s}u=G.ex({addresses:[],parserReport:false,parseOnly:false,returnSpatialKeys:false},u);var q=la('<xls:GeocodeRequest parserReport="{0}" parseOnly="{1}" returnSpatialKeys="{2}">'),x=new p;return G.ex({},x,{methodName:"Geocode",getRequestBody:function(){for(var z=q(u.parserReport,u.parseOnly,u.returnSpatialKeys),s=0;s<u.addresses.length;s++)z+=u.addresses[s].getXML();return z+
"</xls:GeocodeRequest>"},parseResponse:function(z){if(u.addresses.length===1)return[w(z.GeocodeResponseList)];else{for(var s=[],A=0;A<u.addresses.length;A++)s.push(w(z.GeocodeResponseList[A]));return s}}})},v=function(u){u=G.ex({position:null,geocodePreference:"StreetAddress"},u);return G.ex(new p,{methodName:"ReverseGeocode",getRequestBody:function(){return"<xls:ReverseGeocodeRequest><xls:Position><gml:Point><gml:pos>"+u.position.toString()+"</gml:pos></gml:Point></xls:Position><xls:ReverseGeocodePreference>"+
u.geocodePreference+"</xls:ReverseGeocodePreference></xls:ReverseGeocodeRequest>"},parseResponse:function(w){var q=null;if(w&&w.Point)q=new G.Pos(match.Point.pos);if(w&&w.ReverseGeocodedLocation&&w.ReverseGeocodedLocation.Address)return f(w.ReverseGeocodedLocation.Address,q);return null}})};return{forward:function(u,w){var q,x=[];G.is(u,"object")?G.log("attempting to geocode a simple object - not implemented","warn"):x.push(new l({freeform:u}));if(x.length>0){x=new m({addresses:x});e(x,function(z){for(q=
0;w&&q<z.length;q++)w(u,z[q])})}},reverse:function(u,w){var q=new v({position:u});e(q,function(x){w&&w(x)})}}});G.Registry.register("service","routing",function(){var m=function(v){v=G.ex({waypoints:[],provideRouteHandle:false,distanceUnit:"KM",routeQueryType:"RMAN",routePreference:"Fastest",routeInstructions:true,routeGeometry:true},v);var u=new p,w=G.formatter('<xls:DetermineRouteRequest provideRouteHandle="{0}" distanceUnit="{1}" routeQueryType="{2}">'),q=G.formatter("<xls:{0}><xls:Position><gml:Point><gml:pos>{1}</gml:pos></gml:Point></xls:Position></xls:{0}>");
return G.ex({},u,{methodName:"DetermineRoute",getRequestBody:function(){if(v.waypoints.length<2)throw Error("Cannot send RouteRequest, less than 2 waypoints specified");var x=w(v.provideRouteHandle,v.distanceUnit,v.routeQueryType);x+="<xls:RoutePlan>";x+="<xls:RoutePreference>"+v.routePreference+"</xls:RoutePreference>";x+="<xls:WayPointList>";for(var z=0;z<v.waypoints.length;z++)x+=q(z===0?"StartPoint":z===v.waypoints.length-1?"EndPoint":"ViaPoint",v.waypoints[z].toString());x+="</xls:WayPointList>";
x+="</xls:RoutePlan>";if(v.routeInstructions)x+='<xls:RouteInstructionsRequest rules="maneuver-rules" providePoint="true" />';if(v.routeGeometry)x+="<xls:RouteGeometryRequest />";x+="</xls:DetermineRouteRequest>";return x},parseResponse:function(x){var z=G.RouteTools.RouteData,s=x.RouteGeometry.LineString.pos,A=s.length,B=Array(A);for(A=A;A--;)B[A]=new ka(s[A]);s=x.RouteInstructionsList;x=[];s=s&&s.RouteInstruction?s.RouteInstruction:[];A=0;for(var E=new COG.Duration,H=0;H<s.length;H++){var L;L=s[H].distance;
var I={M:1,KM:1E3}[L.uom?L.uom.toUpperCase():"M"];L=L.value&&I?L.value*I:0;I=COG.parseDuration(s[H].duration,"8601");A+=L;E=COG.addDuration(E,I);x.push(new G.RouteTools.Instruction({position:new G.Pos(s[H].Point),description:s[H].Instruction,distance:L,distanceTotal:A,time:I,timeTotal:E}))}return new z({geometry:B,instructions:x})}})};return{calculate:function(v,u){v=G.ex({waypoints:[]},v);if(typeof G.RouteTools!=="undefined"){var w=new m(v);e(w,function(q){u&&u(q)})}else ha("Could not generate route, T5.RouteTools plugin not found",
"warn")}}});return{applyConfig:function(m){G.ex(h,m)},compareFns:function(){return{streetDetails:function(m,v){return v.calcMatchPercentage(m)},location:function(m,v){return v.calcMatchPercentage(m)}}}()}}();rb.T5=G;rb.Tile5=function(a,d){d=J({container:a,type:"map",renderer:"canvas",starpos:null,zoom:1,fastpan:false,drawOnScale:true,zoombar:{}},d);return ya("view",d.type,d)}})(window);
