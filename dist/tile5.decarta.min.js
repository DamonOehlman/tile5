(function(kb){function J(){var a=arguments[0]||{},e=Array.prototype.slice.call(arguments,1),b=e.length,g,j;for(j=0;j<b;j++)if((g=e[j])!==null)for(var k in g){var l=g[k];if(a!==l)if(l!==undefined)a[k]=l}return a}function ya(a,e){if(typeof console!=="undefined")console[e||"log"](a)}function oa(a){var e=a.match(Ab),b=[],g=0,j;for(j=e?e.length:0;j--;){var k=e[j].slice(1);b[k]||(b[k]=RegExp("\\{"+k+"\\}","g"))}g=b.length;return function(){var l=a;for(j=0;j<g;j++){var i=arguments[j];if(typeof i=="undefined")i=
"";l=l.replace(b[j],i)}return l}}function lb(a,e){var b=Ra*ea(a);return mb-2*nb(e*za((1-b)/(1+b),Ra/2))}function V(a,e){if(T(a,pa)){var b=a.split(ab);this.x=parseFloat(b[0]);this.y=parseFloat(b[1])}else if(a&&a.x){this.x=a.x;this.y=a.y}else{this.x=a||0;this.y=e||0}}function Ia(a){this.allowCull=a}function qa(a,e,b,g){this.mercX=b;this.mercY=g;if(T(a,pa))J(this,Bb.parseXY(a));else a&&a.toPixels?J(this,a.toPixels()):V.call(this,a,e)}function ra(a,e,b,g){this.x=a||0;this.y=e||0;this.w=b||0;this.h=g||
0;this.x2=this.x+this.w;this.y2=this.y+this.h}function ob(a,e){var b=new pb(Math.sqrt(256<<a)|0);e&&e.zoomLevel===a&&e.copyInto(b);b.zoomLevel=a;return b}function bb(a,e,b,g,j,k){this.x=a;this.y=e;this.w=g||256;this.h=g||256;this.x2=this.x+this.w;this.y2=this.y+this.h;this.url=b;this.id=k||a+"_"+e;this.loaded=false;this.image=null}function Sa(a,e){e=J({id:"layer_"+Cb++,zindex:0,animated:false,style:null,minXY:null,maxXY:null,visible:true},e);this.visible=e.visible;this.view=a;sa(J(this,e))}function Ta(){sa(this)}
var Ab=/\{(\d+)(?=\})/g,Db=function(){var a=1.70158,e=Math.PI/2,b=Math.abs,g=Math.pow,j=Math.sin,k=Math.asin,l=Math.cos,i={linear:function(c,r,d,h){return d*c/h+r},backin:function(c,r,d,h){return d*(c/=h)*c*((a+1)*c-a)+r},backout:function(c,r,d,h){return d*((c=c/h-1)*c*((a+1)*c+a)+1)+r},backinout:function(c,r,d,h){return(c/=h/2)<1?d/2*c*c*(((a*=1.525)+1)*c-a)+r:d/2*((c-=2)*c*(((a*=1.525)+1)*c+a)+2)+r},bouncein:function(c,r,d,h){return d-i.bounceout(h-c,0,d,h)+r},bounceout:function(c,r,d,h){return(c/=
h)<1/2.75?d*7.5625*c*c+r:c<2/2.75?d*(7.5625*(c-=1.5/2.75)*c+0.75)+r:c<2.5/2.75?d*(7.5625*(c-=2.25/2.75)*c+0.9375)+r:d*(7.5625*(c-=2.625/2.75)*c+0.984375)+r},bounceinout:function(c,r,d,h){return c<h/2?i.bouncein(c*2,0,d,h)/2+r:i.bounceout(c*2-h,0,d,h)/2+d/2+r},cubicin:function(c,r,d,h){return d*(c/=h)*c*c+r},cubicout:function(c,r,d,h){return d*((c=c/h-1)*c*c+1)+r},cubicinout:function(c,r,d,h){if((c/=h/2)<1)return d/2*c*c*c+r;return d/2*((c-=2)*c*c+2)+r},elasticin:function(c,r,d,h,m,f){if(c==0)return r;
if((c/=h)==1)return r+d;f||(f=h*0.3);if(!m||m<b(d)){m=d;d=f/4}else d=f/fa*k(d/m);return-(m*g(2,10*(c-=1))*j((c*h-d)*fa/f))+r},elasticout:function(c,r,d,h,m,f){var n;if(c==0)return r;if((c/=h)==1)return r+d;f||(f=h*0.3);if(!m||m<b(d)){m=d;n=f/4}else n=f/fa*k(d/m);return m*g(2,-10*c)*j((c*h-n)*fa/f)+d+r},elasticinout:function(c,r,d,h,m,f){var n;if(c==0)return r;if((c/=h/2)==2)return r+d;f||(f=h*0.3*1.5);if(!m||m<b(d)){m=d;n=f/4}else n=f/fa*k(d/m);if(c<1)return-0.5*m*g(2,10*(c-=1))*j((c*h-n)*fa/f)+r;
return m*g(2,-10*(c-=1))*j((c*h-n)*fa/f)*0.5+d+r},quadin:function(c,r,d,h){return d*(c/=h)*c+r},quadout:function(c,r,d,h){return-d*(c/=h)*(c-2)+r},quadinout:function(c,r,d,h){if((c/=h/2)<1)return d/2*c*c+r;return-d/2*(--c*(c-2)-1)+r},sinein:function(c,r,d,h){return-d*l(c/h*e)+d+r},sineout:function(c,r,d,h){return d*j(c/h*e)+r},sineinout:function(c,r,d,h){return-d/2*(l(Math.PI*c/h)-1)+r}};return function(c){c=c.replace(/[\-\_\s\.]/g,"").toLowerCase();return i[c]||i.linear}}(),sa=function(){function a(b,
g){var j=b.hasOwnProperty("obsHandlers")?b.obsHandlers:null;j[g]||(j[g]=[]);return j[g]}var e=0;return function(b){if(!b)return null;if(!(b.hasOwnProperty("obsHandlers")?b.obsHandlers:null))b.obsHandlers={};if(!b.hasOwnProperty("bind")){b.bind=function(g,j){var k="callback"+e++;a(b,g).unshift({fn:j,id:k});return k};b.triggerCustom=function(g,j){var k=a(b,g),l={cancel:false,name:g,source:this},i;for(i in j)l[i]=j[i];if(!k)return null;i=Array.prototype.slice.call(arguments,2);b.eventInterceptor&&b.eventInterceptor(g,
l,i);i.unshift(l);for(var c=k.length;c--&&!l.cancel;)k[c].fn.apply(this,i);return l};b.trigger=function(g){var j=Array.prototype.slice.call(arguments,1);j.splice(0,0,g,null);return b.triggerCustom.apply(this,j)};b.unbind=function(g,j){if(typeof g==="undefined")b.obsHandlers={};else for(var k=a(b,g),l=0;k&&l<k.length;l++)if(k[l].id===j){k.splice(l,1);break}return b}}return b}}(),qb=function(){function a(e,b,g,j){if(typeof e[j]=="undefined")e[j]=function(k){if(typeof k!="undefined"){b[j]=k;g[j]&&g[j](k);
return e}else return b[j]}}return function(e,b,g){b=b||e;for(var j in b)typeof b[j]!="function"&&a(e,b,g,j);return e}}(),cb=Array.prototype.indexOf||function(a){for(var e=0;e<this.length;e++)if(this[e]===a)return e;return-1},T=function(){var a={NaN:1,Infinity:1,"-Infinity":1},e=String.prototype.toLowerCase,b=Object.prototype.toString;return function(g,j){j=e.call(j);if(j=="finite")return!a.hasOwnProperty(+g);return j=="null"&&g===null||j==typeof g||j=="object"&&g===Object(g)||j=="array"&&Array.isArray&&
Array.isArray(g)||b.call(g).slice(8,-1).toLowerCase()==j}}(),Eb=function(){function a(k){var l=document.createElement("script"),i=false;l.src=k;l.async=true;l.onload=l.onreadystatechange=function(){if(!i&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){i=true;l.onload=l.onreadystatechange=null;l&&l.parentNode&&l.parentNode.removeChild(l)}};j||(j=document.getElementsByTagName("head")[0]);j.appendChild(l)}function e(k,l,i){k+=k.indexOf("?")>=0?"&":"?";var c="json"+ ++g;
window[c]=function(r){l(r);window[c]=null;try{delete window[c]}catch(d){}};a(k+(i?i:"callback")+"="+c);return c}function b(k,l,i){var c=require("request");k=k+(k.indexOf("?")>=0?"&":"?")+(i?i:"callback")+"=cb";c({uri:k},function(r,d,h){r=h.replace(/^.*\(/,"").replace(/\).*$/,"");l(JSON.parse(r))})}var g=0,j;return typeof window!="undefined"?e:b}();INTERACT=function(){function a(m){return function(f,n){m.addEventListener(f,n,false)}}function e(m){return function(f,n){m.removeEventListener(f,n,false)}}
function b(m){return function(f,n){m.attachEvent("on"+f,n)}}function g(m,f){return{x:m?m:0,y:f?f:0,count:1}}function j(m,f){d.push(J({handler:null,checks:{},type:m},f))}function k(m){var f=0,n=0;if(m.offsetParent){do{f+=m.offsetLeft;n+=m.offsetTop;m=m.offsetParent}while(m)}return{left:f,top:n}}function l(m,f){return{source:m,target:f.target?f.target:f.srcElement}}function i(m,f){for(var n=m.target?m.target:m.srcElement;n&&n!==f;)n=n.parentNode;return n&&n===f}function c(m,f){return{x:m.x-(f?f.left:
0),y:m.y-(f?f.top:0)}}function r(m,f){if(m.preventDefault){m.preventDefault();m.stopPropagation()}else if(typeof m.cancelBubble!="undefined")m.cancelBubble=true;f&&m.stopImmediatePropagation&&m.stopImmediatePropagation()}var d=[],h=function(m,f,n){n=J({binder:null,unbinder:null,observable:null},n);for(var s=n.observable,t=[],o,q,w={bind:function(){return s.bind.apply(null,arguments)},unbind:function(){s.unbind();for(y=0;y<t.length;y++)t[y].unbind();return w}},y=0;y<f.length;y++)t.push(f[y](m,s,n));
s.bind("pointerDown",function(){q=o=0});s.bind("pointerMove",function(p,C,v,z){o+=z.x||0;q+=z.y||0});s.bind("pointerUp",function(p,C,v){Math.abs(o)>20||Math.abs(q)>20||s.triggerCustom("tap",p,C,v)});return w};j("pointer",{handler:function(m,f,n){function s(A){if(A.pageX&&A.pageY)return g(A.pageX,A.pageY);else{var F=document.documentElement,P=document.body;return g(A.clientX+(F&&F.scrollLeft||P&&P.scrollLeft||0)-(F&&F.clientLeft||P&&P.clientLeft||0),A.clientY+(F&&F.scrollTop||P&&P.scrollTop||0)-(F&&
F.clientTop||P&&P.clientTop||0))}}function t(A){if(i(A,m))if(z=y(A)){var F=s(A);m.style.cursor="move";r(A,true);O=F.x;Q=F.y;G=g(O,Q);f.triggerCustom("pointerDown",l("mouse",A),G,c(G,k(m)))}}function o(A){var F=s(A);E=F.x;D=F.y;if(i(A,m))p(A,z?"pointerMove":"pointerHover")}function q(A){if(z&&y(A)){z=false;if(i(A,m)){m.style.cursor="default";p(A,"pointerUp")}}}function w(A){if(i(A,m)){var F;A=A||window.event;if(A.detail){if(typeof A.axis=="undefined"||A.axis===2)F=-A.detail*C}else{F=A.wheelDeltaY?
A.wheelDeltaY:A.wheelDelta;if(window.opera)F=-F}if(F){var P=g(E,D);f.triggerCustom("zoom",l("mouse",A),P,c(P,k(m)),F/v,"wheel");r(A);A.returnValue=false}}}function y(A){A=A||window.event;return(A.which||A.button)==1}function p(A,F,P,$,ka){P=typeof P!="undefined"?P:E;$=typeof $!="undefined"?$:D;var H=P-O,M=$-Q,K=g(P,$);f.triggerCustom(F,l("mouse",A),K,c(K,k(m)),g(H,M));if(typeof ka=="undefined"||ka){O=P;Q=$}}n=J({},n);var C=120,v=C*8,z=false,G,E,D,O,Q;n.binder("mousedown",t);n.binder("mousemove",o);
n.binder("mouseup",q);n.binder("dblclick",function(A){ya("captured double click");if(i(A,m)){var F=s(A);f.triggerCustom("doubleTap",l("mouse",A),F,c(F,k(m)))}});n.binder("mousewheel",w);n.binder("DOMMouseScroll",w);return{unbind:function(){n.unbinder("mousedown",t);n.unbinder("mousemove",o);n.unbinder("mouseup",q);n.unbinder("mousewheel",w);n.unbinder("DOMMouseScroll",w)}}},checks:{touch:false}});j("pointer",{handler:function(m,f,n){function s(H){if(H.count<2)return 0;var M=H.x-H.next.x;H=H.y-H.next.y;
return~~Math.sqrt(M*M+H*H)}function t(H,M,K){M=M?M:0;K=K?K:0;for(var aa={x:H.x-M,y:H.y-K,id:H.id,count:H.count},S=aa;H.next;){H=H.next;S=S.next={x:H.x-M,y:H.y-K,id:H.id}}return aa}function o(H,M){var K=H[M?M:"touches"],aa,S;if(K.length===0)return null;S=aa={x:K[0].pageX,y:K[0].pageY,id:K[0].identifier,count:K.length};for(var U=1,Aa=K.length;U<Aa;U++)S=S.next={x:K[U].pageX,y:K[U].pageY,id:K[U].identifier};return aa}function q(H){if(i(H,m)){D=k(m);var M=o(H,"changedTouches"),K=t(M,D.left,D.top);if(!Q){O=
z;f.triggerCustom("pointerDown",l("touch",H),M,K)}$&&f.triggerCustom("pointerDownMulti",l("touch",H),M,K);Q=o(H);if(Q.count>1)F=s(Q);ka=1;P=t(Q)}}function w(H){if(i(H,m)){r(H);A=o(H);if(O==z)O=Math.abs(Q.x-A.x)>C||Math.abs(Q.y-A.y)>C?v:z;if(O!=z){O=A.count>1?E:G;if(O==E)if(Q.count===1){Q=t(A);F=s(Q)}else{var M=s(A);if(Math.abs(F-M)<p)O=G;else{var K;K=A.x;var aa=A.next.x,S=A.y,U=A.next.y;K={x:(K<aa?K:aa)+(Math.abs(K-aa)>>1),y:(S<U?S:U)+(Math.abs(S-U)>>1)};M=M/F;aa=M-ka;f.triggerCustom("zoom",l("touch",
H),K,c(K,D),aa,"pinch");ka=M}}O==G&&f.triggerCustom("pointerMove",l("touch",H),A,t(A,D.left,D.top),g(A.x-P.x,A.y-P.y));$&&f.triggerCustom("pointerMoveMulti",l("touch",H),A,t(A,D.left,D.top))}P=t(A)}}function y(H){if(i(H,m)){var M=o(H,"changedTouches"),K=t(M,D.left,D.top);A=o(H);if(!A){f.triggerCustom("pointerUp",l("touch",H),M,K);Q=null}$&&f.triggerCustom("pointerUpMulti",l("touch",H),M,K)}}n=J({detailed:false,inertia:false},n);var p=20,C=7,v=0,z=1,G=2,E=3,D,O,Q,A,F,P,$=n.detailed,ka=1;n.binder("touchstart",
q);n.binder("touchmove",w);n.binder("touchend",y);ya("initialized touch handler");return{unbind:function(){n.unbinder("touchstart",q);n.unbinder("touchmove",w);n.unbinder("touchend",y)}}},checks:{touch:true}});return{register:j,watch:function(m,f,n){f=J({bindTarget:null,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},f);capabilities=J({touch:"ontouchstart"in window},n);if(!f.observable){ya("creating observable");f.observable=sa({});globalOpts=f}f.binder=(f.isIE?b:a)(f.bindTarget||
document);f.unbinder=(f.isIE?b:e)(f.bindTarget||document);n=f.types;for(var s=capabilities,t=[],o=d.length;o--;){var q=d[o],w=!n||n.indexOf(q.type)>=0,y=true,p;for(p in q.checks){var C=q.checks[p];ya("checking "+p+" capability. require: "+C+", capability = "+s[p]);y=y&&C===s[p]}if(w&&y)t[t.length]=q.handler}return new h(m,t,f)}}}();(function(){function a(o,q){if(o&&o.split){var w=o.split(ab);if(w.length>1){o=w[0];q=w[1]}}else if(o&&o.lat){q=o.lon;o=o.lat}this.lat=parseFloat(o||0);this.lon=parseFloat(q||
0)}function e(o,q){if(o&&o.splice){for(var w=q,y=new a(c,d),p=new a(r,h),C=o.length;C--;){var v=o[C];if(v.lat<y.lat)y.lat=v.lat;if(v.lat>p.lat)p.lat=v.lat;if(v.lon<y.lon)y.lon=v.lon;if(v.lon>p.lon)p.lon=v.lon}this.min=y;this.max=p;if(typeof w=="undefined"){w=this.size();w=ta(w.x,w.y)*0.3}this.min=new a(y.lat-w,(y.lon-w)%360);this.max=new a(p.lat+w,(p.lon+w)%360)}else{this.min=o;this.max=q}}function b(o){this.meters=o||0}var g=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,
0.488332580888611],j=Math.PI*2,k=Math.PI/2,l=Math.PI/180,i=180/Math.PI,c=90,r=-c,d=180,h=-d,m=c*l,f=-m,n=d*l,s=-n;a.prototype={constructor:a,copy:function(){return new a(this.lat,this.lon)},distanceTo:function(){if(!targetPos||this.empty()||targetPos.empty())return 0;var o=(targetPos.lat-this.lat)*la>>1,q=(targetPos.lon-this.lon)*la>>1;o=ea(o)*ea(o)+ua(this.lat*la)*ua(targetPos.lat*la)*ea(q)*ea(q);return 6371*2*Fb(db(o),db(1-o))},equalTo:function(o){return pos&&this.lat===o.lat&&this.lon===o.lon},
empty:function(){return this.lat===0&&this.lon===0},inArray:function(o){for(var q=o.length;q--;)if(this.equal(o[q]))return true;return false},offset:function(o,q){var w=this.lat*l,y=this.lon*l,p=w+o/6371;w=rb(ea(q/6371)/ua(w));y=y+w;p=(p+k)%Math.PI-k;y%=j;return new a(p*i,y*i)},toBounds:function(o){var q=o.radians(),w=this.lat*l,y=this.lon*l;o=w-q;var p=w+q;if(o>f&&p<m){w=rb(ea(q)/ua(w));q=y-w;if(q<s)q+=j;y=y+w;if(y>n)y-=j}else{o=ta(o,f);p=Ba(p,m);q=h;y=d}return new e(new a(o*i,q*i),new a(p*i,y*i))},
toString:function(o){return this.lat+(o||" ")+this.lon}};e.prototype={constructor:e,bestZoomLevel:function(o){var q=this.center();q=Ba(Ja(ia(q.lat)*0.05),g.length);var w=g[q],y=this.size();q=sb(Ca(g[3]*o.h/y.y)/Ca(2));o=sb(Ca(w*o.w/y.x)/Ca(2));return Ba(isNaN(q)?1E3:q,isNaN(o)?1E3:o)},center:function(){var o=this.size();return new a(this.min.lat+(o.y>>1),this.min.lon+(o.x>>1))},expand:function(o){return new e(new a(this.min.lat-o,(this.min.lon-o)%360),new a(this.max.lat+o,(this.max.lon+o)%360))},
size:function(o){var q=new V(0,this.max.lat-this.min.lat);q.x=typeof o!="undefined"&&o&&this.min.lon>this.max.lon?360-this.min.lon+this.max.lon:this.max.lon-this.min.lon;return q},toString:function(){return"min: "+this.min+", max: "+this.max},union:function(){for(var o=this.min.copy(),q=this.max.copy(),w=arguments.length;w--;)if(arguments[w]){var y=arguments[w].min,p=arguments[w].max;o.lat=Ba(o.lat,y.lat);o.lon=Ba(o.lon,y.lon);q.lat=ta(q.lat,p.lat);q.lon=ta(q.lon,p.lon)}return new e(o,q)}};b.prototype=
{add:function(){for(var o=this.meters,q=arguments.length;q--;)o+=arguments[q].meters;return new b(o)},radians:function(o){if(typeof o!="undefined"){this.meters=o*6371E3;return this}else return this.meters/6371E3},toString:function(){if(this.meters>1E3)return(this.meters/10|0)/100+"km";return this.meters+"m"}};var t=this.GeoJS={Pos:a,BBox:e,Distance:b};if(typeof module!="undefined"&&module.exports)module.exports=t})();var L=sa({}),Ua=function(){var a={};return{create:function(e,b){if(a[e][b])return a[e][b].apply(null,
Array.prototype.slice.call(arguments,2));throw Gb(e,b);},get:function(e,b){return a[e]?a[e][b]:null},register:function(e,b,g){a[e]||(a[e]={});a[e][b]&&ya(Hb(e,b),"warn");a[e][b]=g}}}(),Hb=oa("Registration of {0}: {1} will override existing definition"),Gb=oa("Could not create {0} of type: {1}");oa("Could not create drawable of type: {0}");var fa=Math.PI*2,mb=Math.PI/2,la=Math.PI/180,Va=180/Math.PI,Ra=0.08181919084262157,ia=Math.abs,sb=Math.ceil,Ja=Math.round,Ba=Math.min,ta=Math.max,za=Math.pow,db=
Math.sqrt,Ca=Math.log,ea=Math.sin,rb=Math.asin,ua=Math.cos,nb=Math.atan,Fb=Math.atan2,Da="undefined",pa="string",Ib="object",va="number",Jb="array",ca=Ua.register,wa=Ua.create,Kb=Ua.get,Lb=0,Cb=0,ab=/[\,\s]+/,Fa=function(){function a(l){j++;l=R?window.mozAnimationStartTime||l||(new Date).getTime():(new Date).getTime();for(var i=g.length;i--;){var c=g[i];j%c.every===0&&c.cb(l)}k&&animFrame(a)}var e=1E3/60,b=["r","webkitR","mozR","oR","msR"],g=[],j=0,k=R&&function(){for(var l=0;l<b.length;l++)window.animFrame=
window.animFrame||window[b[l]+"equestAnimationFrame"];return animFrame}();k?animFrame(a):setInterval(a,1E3/60);return{attach:function(l,i){g[g.length]={cb:l,every:i?Ja(i/e):1}},detach:function(l){for(var i=g.length;i--;)if(g[i].cb===l){g.splice(i,1);break}}}}(),Bb=function(){var a=/^xy\((.*)\).*$/i;return{parseXY:function(e){if(!a.test(e)){e=e.split(ab);return eb(e[1],e[0])}}}}(),R=typeof window!="undefined"?function(){function a(j){for(var k=0;k<j.length;k++){var l=j[k];if(typeof document.body.style[l]!=
"undefined")return l}}var e={"-webkit-user-select":"none",position:"absolute"},b,g;b=a(["-webkit-transform","MozTransform"]);css3DTransformProp=a(["WebkitPerspective","MozPerspective"]);g=a(["-webkit-transform-origin","MozTransformOrigin"]);return{transforms:T(b,pa),create:function(j,k,l){j=document.createElement(j);var i=[];l=l||{};j.className=k||"";for(var c in l)i[i.length]=c+": "+l[c];j.style.cssText=i.join(";");return j},move:function(j,k,l,i,c){if(b){j.style[b]="translate("+k+"px, "+l+"px) "+
(i||[]).join(" ");if(c&&g)j.style[g]=c.x+"px "+c.y+"px"}else{j.style.left=k+"px";j.style.top=l+"px"}},styles:function(j){return J({},e,j)}}}():null,tb=function(){function a(){for(var j=g.length,k=j;k--;)try{g[k](j)}catch(l){ya(l.toString(),"error")}}var e=20,b=50,g=[];return{process:function(j,k,l,i){function c(h){h=(r||b)/h;if(d<j.length){var m=j.slice(d,d+h);h=m.length;var f=r?0:(new Date).getTime();k(m,h);if(!r)r=(m=((new Date).getTime()-f)/h)?e/m|0:j.length;d+=h}else{for(h=g.length;h--;)if(g[h]===
c){g.splice(h,1);break}g.length===0&&Fa.detach(a);l&&l()}}var r,d=0;if(R&&j.length>(i||0))g.push(c)===1&&Fa.attach(a);else{k(j,j.length);l&&l()}}}}(),eb=eb||function(a,e){var b=parseFloat(e)*la;b=ea(b);var g=Ra*b;b=Ca((1+b)/(1-b)*za((1-g)/(1+g),Ra))/2;return new qa(0,0,parseFloat(a)*la,b)},fb=fb||function(a,e){for(var b=za(Math.E,-e),g=mb-2*nb(b),j=lb(g,b),k=0;k<12&&ia(g-j)>1.0E-7;){g=j;j=lb(g,b);k++}return new GeoJS.Pos(j*Va,a%360*Va)};V.prototype={constructor:V,add:function(){for(var a=this.x,e=
this.y,b=arguments.length;b--;){a+=arguments[b].x;e+=arguments[b].y}return this.copy(a,e)},copy:function(a,e){var b=J({},this);b.x=a||b.x;b.y=e||b.y;return b},equals:function(a){return this.x===a.x&&this.y===a.y},offset:function(a,e){return this.copy(this.x+a,this.y+e)},relative:function(a){a=a.viewport();return this.copy(this.x-a.x-a.padding.x,this.y-a.y-a.padding.y)},rotate:function(a,e){e=e||new V(0,0);var b=this.x-e.x,g=this.y-e.y;return new V(e.x+ua(a)*b+-ea(a)*g,e.y+ea(a)*b+ua(a)*g)},scale:function(a,
e){e=e||new V(0,0);return new V(e.x+(this.x-e.x)*a,e.y+(this.y-e.y)*a)},sync:function(){return this},toString:function(){return this.x+", "+this.y}};Ia.prototype=J([],{cull:function(a){if(this.allowCull){var e=a.x,b=a.y,g=a.x+a.w;a=a.y+a.h;for(var j=Infinity,k=0,l,i=this.length;i--;)if(l=this[i].x>=e&&this[i].x<=g&&this[i].y>=b&&this[i].y<=a){j=i<j?i:j;k=i>k?i:k}return this.slice(ta(j-1,0),Ba(k+1,this.length))}return this},simplify:function(a){a=a||3;for(var e=new Ia(this.allowCull),b=null,g=this.length;g--;){var j=
this[g];if(include=!b||g===0||ia(j.x-b.x)+ia(j.y-b.y)>a){e.unshift(j);b=j}}return e}});qa.prototype=J(new V,{constructor:qa,pos:function(){return fb(this.mercX,this.mercY)},sync:function(a,e){var b;if(!(b=a.rpp)){b=a.zoom();b=fa/(256<<b)}b=b;if(e){this.mercX=this.x*b-Math.PI;this.mercY=Math.PI-this.y*b}else{this.x=Ja(((this.mercX||0)+Math.PI)/b);this.y=Ja((Math.PI-(this.mercY||0))/b)}return this}});ra.prototype={constructor:ra,buffer:function(a,e){return new ra(this.x-a,this.y-(e||a),this.w+a*2,this.h+
(e||a)*2)},center:function(){return new V(this.x+(this.w>>1),this.y+(this.h>>1))}};Hits=function(){return{diffHits:function(a,e){var b=[],g={},j;for(j=e.length;j--;)g[e[j].target.id]=true;for(j=a.length;j--;)g[a[j].target.id]||(b[b.length]=a[j]);return b},init:function(a,e,b,g,j){return{type:a,x:j.x,y:j.y,gridX:g.x|0,gridY:g.y|0,elements:[],absXY:e,relXY:b}},initHit:function(a,e,b){return{type:a,target:e,drag:b}},triggerEvent:function(a,e,b,g){e.triggerCustom(a.type+(b?b:"Hit"),{hitType:a.type},g?
g:a.elements,a.absXY,a.relXY,new qa(a.gridX,a.gridY))}}}();var pb=function(a){function e(k,l){var i=b[k],c;i||(i=b[k]=[]);(c=i[l])||(c=i[l]=[]);return c}a=a||128;var b=[],g={},j=0;return{copyInto:function(k){for(var l in g){var i=g[l];k.insert(i.bounds||i,i,l)}},insert:function(k,l,i){var c=k.x/a|0,r=k.y/a|0,d=(k.x+k.w)/a|0;k=(k.y+k.h)/a|0;i=i||l.id||"obj_"+j++;g[i]=l;for(l=c;l<=d;l++)for(c=r;c<=k;c++)e(l,c).push(i)},remove:function(k,l,i){i=i||l.id;if(g[i]){var c=k.x/a|0;l=k.y/a|0;var r=(k.x+k.w)/
a|0;k=(k.y+k.h)/a|0;delete g[i];for(c=c;c<=r;c++)for(var d=l;d<=k;d++){var h=e(c,d),m=cb.call(h,i);m>=0&&h.splice(m,1)}}},search:function(k){var l=k.y/a|0,i=(k.x+k.w)/a|0,c=(k.y+k.h)/a|0,r=[],d=[];for(k=k.x/a|0;k<=i;k++)for(var h=l;h<=c;h++)r=r.concat(e(k,h));r.sort();for(l=r.length;l--;){i=r[l];if(c=g[i])d[d.length]=c;for(;l>0&&r[l-1]==i;)l--}return d}}},Wa=function(){var a={},e=0;(new Date).getTime();var b={},g=[];Fa.attach(function(j){j=j||(new Date).getTime();for(var k=0;k<g.length;){var l=g[k],
i=b[l],c=b[l].image&&b[l].image.complete&&b[l].image.width>0,r=j-i.start;r=c||r>=3E4;if(c){c=i.callbacks;a[l]=i.image;for(var d=0;d<c.length;d++)c[d](i.image,true)}if(r){g.splice(k,1);delete b[l]}else k++}},250);return function(j,k){var l=j&&k?a[j]:null;if(l&&l&&l.complete&&l.width>0)k(l);else if(l=b[j])l.callbacks.push(k);else{l=new Image;l.id="_ldimg"+ ++e;b[j]={start:(new Date).getTime(),image:l,callbacks:[k]};l.src=j;g[g.length]=j}}}();bb.prototype={constructor:bb,load:function(a){var e=this;
Wa(this.url,function(b){e.loaded=true;e.image=b;a&&a()})}};var Mb=function(){return sa({fastpan:true,applyStyle:function(){},applyTransform:function(a,e,b){return{restore:null,x:e,y:b}},getDimensions:function(){return{width:0,height:0}},getViewport:function(){},hitTest:function(){return false},prepare:function(){},projectXY:null,reset:function(){}})};ca("renderer","canvas",function(a,e,b,g,j){function k(){function p(z,G){this.save();this.setTransform(1,0,0,1,0,0);var E=this.isPointInPath_old(z,G);
this.restore();return E}var C=CanvasRenderingContext2D.prototype,v=document.createElement("canvas").getContext("2d");v.translate(50,0);v.moveTo(125,50);v.arc(100,50,25,0,360,false);if(!v.isPointInPath(150,50)){C.isPointInPath_old=C.isPointInPath;C.isPointInPath=p}}function l(p,C,v){var z,G;n[C]=function(E){for(z=w.length;z--;)if(G=v[w[z]])E[y[z]]=G}}function i(p,C,v){return{draw:v||q,viewport:p,hit:C&&h.isPointInPath(C.x,C.y),vpX:m,vpY:f,context:h}}g=J({},g);var c,r,d,h,m=0,f=0,n={},s=null,t={},o=
function(){},q=function(){this.fill&&h.fill();this.stroke&&h.stroke()},w=["fill","stroke","lineWidth","opacity"],y=["fillStyle","strokeStyle","lineWidth","globalAlpha"];R&&k();if(e){c=e.offsetWidth;r=e.offsetHeight;d=R?R.create("canvas",null,{position:"absolute","z-index":1}):new Canvas;d.width=c;d.height=r;a.attachFrame(d,true);h=null}b=J(j,{applyStyle:function(p){var C=n[p],v=h&&h.canvas?h.canvas.id:"default",z;t[v]||(t[v]=[]);z=t[v].pop()||"reset";if(C){t[v].push(p);C(h);return z}},applyTransform:function(p){if(p.translateX!==
0||p.translateY!==0||p.scaling!==1||p.rotation!==0){h.save();s={undo:function(){h.restore();s=null},x:p.xy.x,y:p.xy.y};h.translate(p.xy.x-m+p.translateX,p.xy.y-f+p.translateY);p.rotation!==0&&h.rotate(p.rotation);p.scaling!==1&&h.scale(p.scaling,p.scaling)}return s},drawTiles:function(p,C,v){for(var z=C.length;z--;){p=C[z];if(!p.loaded&&v)p.load(a.invalidate);else p.image&&h.drawImage(p.image,p.x-m,p.y-f)}},prepare:function(p,C){var v,z=false;if(h)h.restore();else if(d)h=d.getContext("2d");for(v=
p.length;v--;)z=z||p[v].clip;m=C.x;f=C.y;if(h){z||h.clearRect(0,0,c,r);h.save();h.globalCompositeOperation="source-over"}return h},prepArc:function(p,C,v){h.beginPath();h.arc(p.xy.x-(s?s.x:m),p.xy.y-(s?s.y:f),p.size>>1,p.startAngle,p.endAngle,false);return i(C,v)},prepImage:function(p,C,v,z){var G=(z.x||p.xy.x)-(s?s.x:m),E=(z.y||p.xy.y)-(s?s.y:f),D=z.image||p.image;if(D){h.beginPath();h.rect(G,E,z.width||D.width,z.height||D.height);return i(C,v,function(){h.drawImage(D,G,E,z.width||D.width,z.height||
D.height)})}},prepMarker:function(p,C,v){var z=p.xy.x-(s?s.x:m),G=p.xy.y-(s?s.y:f),E=p.size,D=undefined;h.beginPath();switch(p.markerType.toLowerCase()){case "image":D=o;h.rect(z-(E>>1),G-(E>>1),E,E);if(p.reset&&p.image){p.image=null;p.reset=false}p.image?h.drawImage(p.image,z-(E>>1),G-(E>>1),E,E):Wa(p.imageUrl,function(O){p.image=O;h.drawImage(p.image,z-(E>>1),G-(E>>1),E,E)});break;default:h.moveTo(z,G);h.lineTo(z-(E>>1),G-E);h.lineTo(z+(E>>1),G-E);h.lineTo(z,G)}return i(C,v,D)},prepPoly:function(p,
C,v,z){var G=true;p=z.points||p.points().cull(C);z=s?s.x:m;var E=s?s.y:f;h.beginPath();for(var D=p.length;D--;){var O=p[D].x-z,Q=p[D].y-E;if(G){h.moveTo(O,Q);G=false}else h.lineTo(O,Q)}return i(C,v)},getContext:function(){return h}});(function(){ub.each(function(p,C){l(null,p,C)});L.bind("styleDefined",l)})();b.bind("detach",function(){e.removeChild(d)});b.bind("resize",function(){});return b});ca("renderer","dom",function(a,e,b,g,j){function k(d){var h=d.image=new Image;c[d.id]=d;h.src=d.url;h.onload=
function(){if(r[d.id])i.appendChild(this);else d.image=null};h.style.cssText="-webkit-user-select: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute;";return h}function l(d,
h,m){var f=[],n;for(n in d){var s=d[n];if(m?s[m]:!h[n]){if(s.image&&s.image.parentNode){i.removeChild(s.image);s.image=null}f[f.length]=n}}for(h=f.length;h--;)delete d[f[h]]}var i=null,c={},r={};i=R.create("div","",R.styles({width:e.offsetWidth+"px",height:e.offsetHeight+"px"}));e.childNodes.length>0?e.insertBefore(i,e.childNodes[0]):e.appendChild(i);a.attachFrame(i);b=J(j,{drawTiles:function(d,h,m){for(var f,n=d.x,s=d.y,t=h.length;t--;){d=h[t];if(d.url){(f=d.image||(m?k(d):null))&&R.move(f,d.x-n,
d.y-s);r[d.id]=d}}}});b.bind("predraw",function(){l(c,r);r={}});b.bind("detach",function(){e.removeChild(i)});a.bind("reset",function(){for(l(c,r={});i.childNodes.length>0;)i.removeChild(i.childNodes[0])});return b});var ub=function(){function a(b,g){if(T(b,pa)){L.trigger("styleDefined",b,e[b]=g);return b}else{var j=[],k;for(k in b)j[j.length]=a(k,b[k]);return j}}var e={};a({reset:{fill:"#ffffff",opacity:1},highlight:{fill:"#ff0000"},waypoints:{lineWidth:4,stroke:"#003377",fill:"#ffffff"},waypointsHover:{lineWidth:4,
stroke:"#ff0000",fill:"#ffffff"}});return{resetStyle:"reset",each:function(b){for(var g in e)b(g,e[g])},get:function(b){return e[b]},define:a}}();ca("view","view",function(a){function e(u,x,B,I){u=z?ta(W+za(2,I)-1,0.125):I>0?2:0.5;y(u,false,true)}function b(u,x){var B=X&&X.projectXY?X.projectXY(u,x):null;if(!B){B=o();var I=1/W;B=new N.XY(B?B.x+u*I:u,B?B.y+x*I:x)}return B.sync(N,true)}function g(u,x,B){p("doubleTap",x,B,b(B.x,B.y));a.scalable&&y(2,{easing:"quad.out",duration:300},true)}function j(u,
x,B){P=null;H=true;s("down",x,B)}function k(u,x,B){s("hover",x,B)}function l(u,x,B,I){m(x,B,false);if(!P){M=I.x;K=I.y}}function i(u,x,B){m(x,B,true);H=false}function c(){clearTimeout(vb);vb=setTimeout(function(){if(F)if(F.offsetWidth!==Ka*2||F.offsetHeight!==La*2){var u=t();n(a.container);t(u.x,u.y)}},250)}function r(u,x,B){s("tap",x,B);N.trigger("tap",x,B,b(B.x,B.y,true))}function d(){ga&&ga.unbind();if(R&&X){ga=INTERACT.watch(X.interactTarget||F);if(a.scalable){ga.bind("zoom",e);ga.bind("doubleTap",
g)}ga.bind("pointerDown",j);ga.bind("pointerMove",l);ga.bind("pointerUp",i);a.captureHover&&ga.bind("pointerHover",k);ga.bind("tap",r)}}function h(u){if(X){X.trigger("detach");X=null}var x=N,B=Q,I=F,Y=a;u=u.split("/");for(var Z=new Mb(x,B,I,Y),ma=0;ma<u.length;ma++)Z=wa("renderer",u[ma],x,B,I,Y,Z);X=Z;ka=R&&X.fastpan&&R.transforms;z=R&&R.transforms&&a.useTransforms;d();N.trigger("reset");w()}function m(u,x,B){if(P){u=b(x.x,x.y);P.drag.call(P.target,P,u.x,u.y,B)&&ba++;if(B)P=null}}function f(u){for(var x=
O;x--;)if(D[x].id===u)return x;return O}function n(u){if(R){F=document.getElementById(u);F.appendChild(A=R.create("div","",R.styles({overflow:"hidden",width:F.offsetWidth+"px",height:F.offsetHeight+"px"})));u=a.padding;if(u===v){u=F.offsetWidth;var x=F.offsetHeight,B=db(u*u+x*x);ha=new V(B-u>>1,B-x>>1)}else ha=new V(u,u);Xa=A.offsetWidth+ha.x*2;Ya=A.offsetHeight+ha.y*2;gb=Xa/2;hb=Ya/2;Ka=F.offsetWidth/2;La=F.offsetHeight/2;Ma=new V(gb,hb);A.appendChild(Q=R.create("div","",R.styles({width:Xa+"px",
height:Ya+"px","z-index":2,margin:-ha.y+"px 0 0 "+-ha.x+"px"})));h(a.renderer);u=a.controls;for(x=0;x<E.length;x++)E[x].trigger("detach");E=[];for(x=0;x<u.length;x++)E[E.length]=wa("control",u[x],N,A,F,a[u[x]])}else h("canvas")}function s(u,x,B){var I=(new V(B.x-Ka+gb,B.y-La+hb)).rotate(-ja*la,Ma).scale(1/W,Ma);da=Hits.init(u,x,B,b(B.x,B.y,true),I);for(u=O;u--;)if(D[u].visible)$=$||(D[u].hitGuess?D[u].hitGuess(da.gridX,da.gridY,N):false);$&&ba++}function t(u,x,B){if(T(u,pa)||T(u,Ib)){x=new N.XY(u);
x.sync(N);u=x.x;x=x.y}if(T(u,va)){C(u-Ka-ha.x,x-La-ha.y,B);return N}else return C().offset(Ka+ha.x|0,La+ha.y|0).sync(N,true)}function o(){var u=new ra(S,U,Xa,Ya);u.scaleFactor=W;u.padding=ha?ha.copy():new V;return u}function q(u,x,B){if(T(u,pa)&&T(x,Da))for(x=0;x<O;x++){if(D[x].id===u)return D[x]}else if(T(u,pa)){x=wa("layer",x,N,B);x.added=(new Date).getTime();x.id=u;D[f(u)]=x;D.sort(function(I,Y){return Y.zindex-I.zindex||Y.added-I.added});O=D.length;N.trigger("resync");w();N.trigger("layerChange",
N,x);ba++;return x}else return[].concat(D)}function w(){var u=o();if(u){if(Ga||Ha)if(u){var x=Za?S+(u.w>>1):S,B=$a?U+(u.h>>1):U,I=u.w,Y=u.h;if(Ga&&Ga>I)if(x+I>Ga)S=Za?S:Ga-I;else if(x<0)S=Za?S:0;if(Ha&&Ha>Y)if(B+Y>Ha)U=$a?U:Ha-Y;else if(B<0)U=$a?U:0}wb=S;xb=U;N.trigger("refresh",N,u);ba++}}function y(u,x,B){if(T(u,va)){var I=B?u:W*u;if(!Nb){x=null;u=Ja(Ca(I)/Math.LN2);I=za(2,u)}if(x)Na=na.tween([W],[I],x,function(){W=I;Na=null;ba++});else{W=I;ba++}return N}else return W}function p(){for(var u=N.trigger.apply(null,
arguments).cancel,x=D.length;x--;)u=D[x].trigger.apply(null,arguments).cancel||u;return!u}function C(u,x,B){if(T(u,va)){if(B)xa=na.tween([S,U],[u,x],B,function(){xa=null});else{S=u|0;U=x|0;ba++}return N}else return(new N.XY(S,U)).sync(N,true)}a=J({container:"",captureHover:true,controls:[],drawOnScale:true,padding:128,inertia:true,refreshDistance:128,pannable:true,scalable:true,renderer:"canvas",useTransforms:true},a);var v="auto",z=true,G=false,E=[],D=[],O=0,Q=null,A=null,F,P=null,$=false,ka,H=false,
M=0,K=0,aa=a.refreshDistance,S=0,U=0,Aa=0,Oa=0,wb=0,xb=0,Ga=null,Ha=null,Za=false,$a=false,xa=null,ha,da=null,Pa=null,X,vb=0,Ma=new V,ja=0,Qa=null,W=1,Na=null,ib=1,ga=null,jb={index:0,draw:false},Nb=true,ba=0,Xa,Ya,gb,hb,Ka,La,N={XY:V,id:a.id,panSpeed:0,attachFrame:function(u,x){x&&Q.appendChild(u)},center:t,detach:function(){X&&X.trigger("detach");ga&&ga.unbind();if(A){F.removeChild(A);Q=A=null}},frozen:function(u){if(T(u,Da))return G;else{G=u;return N}},layer:q,invalidate:function(){ba++},pan:function(u,
x,B){C(S+u,U+x,B)},refresh:w,rotate:function(u,x,B){if(T(u,va)){var I=B?u:ja+u;if(x)Qa=na.tween([ja],[I],x,function(){ja=I%360;Qa=null;ba++});else{ja=I%360;ba++}return N}else return ja},scale:y,triggerAll:p,setMaxOffset:function(u,x,B,I){Ga=u;Ha=x;Za=B;$a=I},offset:C,viewport:o};sa(N);N.bind("resize",c);N.bind("layerRemove",function(u,x){var B=cb(D,x.id);if(B>=0&&B<O){D.splice(B,1);ba++}O=D.length});qb(N,a,{container:n,captureHover:d,scalable:d,pannable:d,renderer:h});q("markers","draw",{zindex:20});
n(a.container);if(R&&!T(window.attachEvent,Da))window.attachEvent("onresize",c);else R&&window.addEventListener("resize",c,false);Fa.attach(function(u){var x=[],B,I,Y;if(!G){N.panSpeed=panSpeed=ia(M)+ia(K);(B=W!==ib)&&N.trigger("scale");if(panSpeed>0||B||xa||Na||Qa){ba++;if(xa&&panSpeed>0){xa(true);xa=null}}if(panSpeed<2&&(ia(S-wb)>=aa||ia(U-xb)>=aa))w();jb.index++;jb.draw=ba||panSpeed||0;if(X&&jb.draw){if(Na)W=Na()[0];if(Qa)ja=Qa()[0];Aa+=M;Oa+=K;if(M||K)N.trigger("pan");if(z){if(W!==1)x[x.length]=
"scale("+W+")";if(ja!==0)x[x.length]="rotate("+ja+"deg)"}if(B=!ka||(a.drawOnScale||W===1)&&panSpeed<5){if(xa){B=xa();S=B[0]|0;U=B[1]|0}else{I=-ja*la;B=ua(I)*Aa+-ea(I)*Oa;I=ea(I)*Aa+ua(I)*Oa;S=S-B/W|0;U=U-I/W|0}Y=o();X.trigger("predraw",Y);if(X.prepare(D,Y,u,da)){I=Oa=B=Aa=ba=0;for(ii=O;ii--;){var Z=D[ii];if(Z.visible){var ma=Z.style?X.applyStyle(Z.style,true):null;Z.draw(X,Y,N,u,da);ma&&X.applyStyle(ma)}}X.trigger("render",Y);N.trigger("drawComplete",Y,u);R.move(Q,B,I,x,Ma)}}else R.move(Q,Aa,Oa,x,
Ma);if(H||!a.inertia)K=M=0;else if(M!=0||K!=0){M*=0.8;K*=0.8;if(ia(M)<0.5)M=0;if(ia(K)<0.5)K=0}if(da){u=true;x=da?da.elements:[];if(Pa&&Pa.type==="hover"){diffElements=Hits.diffHits(Pa.elements,x);if(diffElements.length>0)Hits.triggerEvent(Pa,N,"Out",diffElements);else u=false}if(x.length>0){I=da.gridX;Y=da.gridY;for(B=x.length;B--;){Z=x[B];ma=I;var yb=Y,zb=Z&&Z.drag&&(!Z.canDrag||Z.canDrag(Z,ma,yb));if(zb){P=Z;P.startX=ma;P.startY=yb}if(zb)break}u&&Hits.triggerEvent(da,N)}Pa=x.length>0?J({},da):
null;da=null}if(ib!==W){N.trigger("scaleChanged",W);ib=W}}}});return N});ca("view","map",function(a){function e(c,r){var d=i.viewport();if(c){d=ta(c.bestZoomLevel(d),r||0);return b(d).center(c.center())}else return new GeoJS.BBox((new qa(d.x,d.y2)).sync(i,true).pos(),(new qa(d.x2,d.y)).sync(i,true).pos())}function b(c,r,d){if(T(c,va)){c=ta(a.minZoom,Ba(a.maxZoom,c|0));if(c!==k){var h=i.viewport(),m=i.offset(),f=h.w/2;h=h.h/2;var n=za(2,c-k),s=f/n|0,t=h/n|0;k=c;i.offset(((r||m.x+f)-s)*n,((d||m.y+h)-
t)*n);refreshY=refreshX=0;i.trigger("zoom",c);i.trigger("reset");j=i.rpp=fa/(256<<k);i.setMaxOffset(fa/j|0,fa/j|0,true,false);i.scale(1,false,true);i.trigger("resync");i.refresh()}return i}else return k}a=J({controls:["zoombar"],minZoom:1,maxZoom:18,renderer:"canvas/dom",zoom:1,zoombar:{}},a);var g=new qa,j,k=a.zoom||a.zoomLevel,l=0,i=J(wa("view","view",a),{XY:qa,bounds:e,zoom:b});j=i.rpp=fa/(256<<k);i.bind("refresh",function(){var c=i.viewport();if(g.x!=c.x||g.y!=c.y){i.trigger("boundsChange",e());
g.x=c.x;g.y=c.y}});i.bind("scaleChanged",function(c,r){var d=Ca(r)/Math.LN2|0;if(d!==0){r=za(2,d);clearTimeout(l);l=setTimeout(function(){b(k+d)},500)}});return i});var na=function(){return{tween:function(a,e,b,g,j){function k(n){var s=n-f;n=f+m<=n;for(var t=l;t--;)i[t]=r(s,a[t],d[t],m);j&&j.invalidate();if(n||h){Fa.detach(k);for(t=0;t<c.length;t++)c[t]&&c[t](i,s,h)}}b=J({easing:"sine.out",duration:1E3,complete:null},b);var l=a.length,i=[].concat(a),c=[g,b.complete],r=Db(b.easing),d=[],h=false,m=
b.duration,f=(new Date).getTime();for(b=l;b--;)d[b]=e[b]-a[b];Fa.attach(k);return function(n){h=n;return i}},tweenDrawable:function(a,e,b,g,j){var k=na.tween([b],[g],j,function(){a[e]=g;for(var i=a.tweens.length;i--;)if(a.tweens[i]===l){a.tweens.splice(i,1);break}},a.view),l=function(){a[e]=k()[0]};return l}}}(),Ea=function(a,e,b){b=J({style:null,xy:null,size:20,fill:false,stroke:true,draggable:false,observable:true,properties:{},typeName:"Shape",zindex:0},b);J(this,b);if(T(this.xy,pa))this.xy=new a.XY(this.xy);
this.id="drawable_"+Lb++;this.bounds=null;this.view=a;this.layer=e;this.tweens=[];this.rotation=this.animations=0;this.scaling=1;this.translateY=this.translateX=0;this.observable&&sa(this)};Ea.prototype={constructor:Ea,applyTweens:function(){for(var a=this.tweens.length;a--;)this.tweens[a]()},drag:null,draw:null,getProps:null,resync:function(){if(this.xy){this.xy.sync(this.view);if(this.size){var a=this.size>>1;this.updateBounds(new ra(this.xy.x-a,this.xy.y-a,this.size,this.size))}}},rotate:function(a,
e,b){if(T(a,va)){a=(b?a:this.rotation*Va+a)*la;if(e)this.tweens.push(na.tweenDrawable(this,"rotation",this.rotation,a,e));else{this.rotation=a;this.view.invalidate()}return this}else return this.rotation*Va},scale:function(a,e,b){if(T(a,va)){a=b?a:this.scaling*a;if(e)this.tweens.push(na.tweenDrawable(this,"scaling",this.scaling,a,e));else{this.scaling=a;this.view.invalidate()}return this}else return this.scaling},translate:function(a,e,b,g){if(T(a,va)){a=g?a:this.translateX+a;e=g?e:this.translateY+
e;if(b){this.tweens.push(na.tweenDrawable(this,"translateX",this.translateX,a,b));this.tweens.push(na.tweenDrawable(this,"translateY",this.translateY,e,b))}else{this.translateX=a;this.translateY=e;this.view.invalidate()}return this}else return new V(this.translateX,this.translateY)},updateBounds:function(a,e){a&&(!this.bounds||a.x!=this.bounds.x||a.y!=this.bounds.y)&&this.trigger("move",this,a,this.bounds);this.bounds=a;if(e)this.xy=this.bounds.center()}};ca("drawable","marker",function(a,e,b){b=
J({fill:true,stroke:false,markerType:"simple",hoverStyle:"highlight",typeName:"Marker"},b);return new Ea(a,e,b)});ca("drawable","poly",function(a,e,b){function g(){var d,h,m,f,n,s,t;c=b.simplify?i.simplify():i;for(d=c.length;d--;){h=c[d].x;m=c[d].y;s=T(s,Da)||h<s?h:s;t=T(t,Da)||m<t?m:t;f=T(f,Da)||h>f?h:f;n=T(n,Da)||m>n?m:n}r.updateBounds(new ra(s,t,f-s,n-t),true);a.invalidate()}function j(d){if(T(d,Jb)){i=new Ia(b.allowCull);tb.process(d,function(h,m){for(var f=0;f<m;f++)i.push(new a.XY(h[f]))},k,
l);return r}else return c}function k(){i.length&&tb.process(i,function(d,h){for(var m=h;m--;)d[m].sync(a)},g,l)}b=J({allowCull:false,simplify:false,fill:true,points:[],typeName:"Poly"},b);var l=500,i=new Ia(b.allowCull),c,r=J(new Ea(a,e,b),{points:j,resync:k});j(b.points);return r});ca("drawable","line",function(a,e,b){b.fill=false;b.allowCull=true;return wa("drawable","poly",a,e,b)});ca("drawable","image",function(a,e,b){function g(){if(c&&c.width>0){if(!this.centerOffset)this.centerOffset=new V(-c.width>>
1,-c.height>>1);this.updateBounds(new ra(this.xy.x+this.centerOffset.x,this.xy.y+this.centerOffset.y,c.width,c.height),false)}}function j(d){if(this.imageUrl=d){var h=this;Wa(this.imageUrl,function(m,f){c=m;if(f){var n=r.layer?r.layer.view:null;n&&n.invalidate()}g.apply(h)})}}b=J({image:null,imageUrl:null,centerOffset:null,typeName:"Image"},b);var k=Ea.prototype.resync,l=0,i=0,c=b.image,r=J(new Ea(a,e,b),{changeImage:j,getProps:function(){this.bounds||g(this,c);return{image:c,x:this.xy.x+l,y:this.xy.y+
i}},resync:function(d){k.call(this,d);g.call(this)}});c||j.call(this,this.imageUrl);if(this.centerOffset){l=this.centerOffset.x;i=this.centerOffset.y}});ca("drawable","arc",function(a,e,b){b=J({startAngle:0,endAngle:Math.PI*2,typeName:"Arc"},b);return new Ea(a,e,b)});Sa.prototype={constructor:Sa,clip:null,cycle:function(){},draw:function(){},hitGuess:null,remove:function(){this.view.trigger("layerRemove",this)}};ca("layer","tile",function(a,e){e=J({generator:"osm",imageLoadArgs:{}},e);var b=wa("generator",
e.generator,e).run,g=null,j=[],k=J(new Sa(a,e),{draw:function(l,i,c){l.drawTiles&&l.drawTiles(i,g.search(i.buffer(128)),c.panSpeed<2)}});a.bind("resync",function(){var l=a&&a.zoom?a.zoom():0;j[l]||(j[l]=ob(l));g=j[l]});a.bind("refresh",function(l,i,c){g&&b(i,c,g,function(){i.invalidate()})});return k});ca("layer","draw",function(a,e){function b(i,c,r,d){var h=this.dragOffset;if(!h)h=this.dragOffset=new a.XY(i.startX-this.xy.x,i.startY-this.xy.y);this.xy.x=c-h.x;this.xy.y=r-h.y;if(d){delete this.dragOffset;
a.invalidate();this.xy.sync(a,true);this.trigger("dragDrop")}return true}function g(i,c,r,d){d&&k.remove(d,c);k.insert(r,c)}e=J({zindex:10},e);var j=[],k,l=J(new Sa(a,e),{itemCount:0,clear:function(){k=new pb;j=[];l.trigger("cleared");l.itemCount=0;a.invalidate()},create:function(i,c,r){c=wa("drawable",i,a,l,c);if(r)j.unshift(c);else j[j.length]=c;c.resync();k&&c.bounds&&k.insert(c.bounds,c);c.bind("move",g);l.itemCount=j.length;l.trigger(i+"Added",c);return c},draw:function(i,c,r,d,h){r={};d=k&&
c?k.search(c):[];for(var m=d.length;m--;){var f=d[m],n=f.style||l.style,s,t,o=f.getProps?f.getProps(i):r;s=i["prep"+f.typeName];f.tweens.length>0&&f.applyTweens();t=i.applyTransform(f);if(o=s?s.call(i,f,c,h,o):null){if(h&&o.hit){h.elements.push(Hits.initHit(f.type,f,f.draggable?b:null));s=h.type+"Style";n=f[s]||l[s]||n}n=n?i.applyStyle(n,true):null;(s=f.draw||o.draw)&&s.call(f,o);n&&i.applyStyle(n)}t&&t.undo&&t.undo()}},find:function(){return[].concat(j)},hitGuess:function(i,c){return k&&k.search({x:i-
10,y:c-10,w:20,h:20}).length>0}});a.bind("resync",function(){k=ob(a.zoom(),k);for(var i=j.length;i--;)j[i].resync()});return l});Ta.prototype={constructor:Ta};ca("control","zoombar",function(a,e,b,g){function j(v,z){var G=w[v]=R.create("div","t5-zoombar-button",{position:"absolute",background:k(v),"z-index":51,width:g.width+"px",height:g.buttonHeight+"px","margin-top":(z||0)+"px"});y.appendChild(G)}function k(v,z){return"url("+g.images+") 0 -"+(h+f*3+(v||0)*r*3+(z||0)*r)+"px"}function l(v){return"url("+
g.images+") 0 -"+(h+(v||0)*f)+"px"}function i(v,z){var G;if(v===m){m.style.background=l(z);G="thumb"}else for(var E=0;E<w.length;E++)if(v===w[E]){G="button"+E;w[E].style.background=k(E,z);break}return G}function c(v){if(v!==o){o=v;t=s-o/q*(s-n)|0;R.move(m,0,t-n);clearTimeout(p);p=setTimeout(function(){a.zoom(o)},500)}}g=J({width:24,height:200,images:"img/zoom.png",align:"right",marginTop:10,spacing:10,thumbHeight:16,buttonHeight:16},g);var r=g.buttonHeight,d,h=g.height,m,f=g.thumbHeight,n=g.spacing+
r-(f>>1),s=g.height-r-(f>>1),t=n,o=-1;e=a.minZoom();var q=a.maxZoom()-e+1,w=[],y,p=0,C={button0:function(){a.zoom(a.zoom()+1)},button1:function(){a.zoom(a.zoom()-1)}};y=R.create("div","t5-zoombar",{position:"absolute",background:"url("+g.images+")","z-index":50,overflow:"hidden",width:g.width+"px",height:g.height+"px",margin:function(){var v=g.spacing,z=oa("{0}px 0 0 {1}px");if(g.align==="right")v=b.offsetWidth-g.width-g.spacing;return z(g.marginTop,v)}()});b.childNodes[0]?b.insertBefore(y,b.childNodes[0]):
b.appendChild(y);y.appendChild(m=R.create("div","t5-zoombar-thumb",{position:"absolute",background:l(),"z-index":51,width:g.width+"px",height:g.thumbHeight+"px",margin:"10px 0 0 0",top:t-n+"px"}));j(0);j(1,g.height-g.buttonHeight);d=INTERACT.watch(y,{bindTarget:y});d.bind("pointerMove",function(v,z,G){t=Math.min(Math.max(n,G.y-(f>>1)),s);c(q-(t-n)/s*q|0)});d.bind("pointerDown",function(v){i(v.target,2)});d.bind("pointerUp",function(v){i(v.target,0)});d.bind("tap",function(v){(v=C[i(v.target,2)])&&
v()});e=new Ta(a);e.bind("detach",function(){d.unbind();b.removeChild(y)});a.bind("zoom",function(v,z){c(z)});c(a.zoom());return e});(function(){ca("fn","generalize",function(a,e,b){var g=a.length,j=[],k=null;b=(b||250)/1E3;for(g=g;g--;)if(g===0)j.unshift(a[g]);else{var l=!k||a[g].inArray(e)?b:k.distanceTo(a[g]);if(a[g]&&l>=b){j.unshift(a[g]);k=a[g]}}return j})})();J(L,{ex:J,log:ya,observable:sa,configurable:qb,formatter:oa,wordExists:function(a,e){for(var b=a.split(/\s|\,/).length;b--;)if(a.toLowerCase()==
e.toLowerCase())return true;return false},is:T,indexOf:cb,fn:function(a){return Kb("fn",a)},project:eb,unproject:fb,getImage:Wa,userMessage:function(a,e,b){L.trigger("userMessage",a,e,b)},Registry:Ua,Style:ub,DOM:R,Rect:ra,XY:V,Line:Ia,Hits:Hits,Control:Ta,Tile:bb,Tweener:na});L.RouteTools=function(){function a(d){if(k.test(d))return"-slight";return""}function e(d,h){h.geometry&&d.layer("route","draw").create("line",{points:h.geometry,style:"waypoints",simplify:true})}function b(d){for(var h="unknown",
m=g||c,f=0;f<m.length;f++){m[f].regex.lastIndex=-1;var n=m[f].regex.exec(d);if(n){h=m[f].customCheck?m[f].customCheck(d,n):m[f].turnType;break}}return h}var g=undefined,j=L.fn("generalize"),k=/bear/i,l=/right/i,i={unknown:"0:0",start:"1:0","continue":"1:1",arrive:"1:2",left:"2:0","left-slight":"2:1","left-sharp":"2:2",right:"3:0","right-slight":"3:1","right-sharp":"3:2","uturn-left":"4:0","uturn-right":"4:1",merge:"4:2",roundabout:"5:0",ramp:"6:0","ramp-exit":"6:1"},c=function(){var d=[];d.push({regex:/continue/i,
turnType:"continue"});d.push({regex:/(take|bear|turn)(.*?)left/i,customCheck:function(h,m){return"left"+a(m[1])}});d.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(h,m){return"right"+a(m[1])}});d.push({regex:/enter\s(roundabout|rotary)/i,turnType:"roundabout"});d.push({regex:/take.*?ramp/i,turnType:"ramp"});d.push({regex:/take.*?exit/i,turnType:"ramp-exit"});d.push({regex:/make(.*?)u\-turn/i,customCheck:function(h,m){return"uturn"+(l.test(m[1])?"-right":"-left")}});d.push({regex:/proceed/i,
turnType:"start"});d.push({regex:/arrive/i,turnType:"arrive"});d.push({regex:/fell\sthrough/i,turnType:"merge"});return d}(),r={calculate:function(d){d=J({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},d);var h=L.Registry.create("service","routing");h&&h.calculate(d,function(m){if(d.generalize)m.geometry=j(m.geometry,m.getInstructionPositions());if(m.instructions)for(var f=new TL.Duration,n=new GeoJS.Distance,s=0,t=m.instructions.length;s<t;s++){var o=m.instructions[s];
o.timeTotal=f=f.add(o.time);o.distanceTotal=n=n.add(o.distance)}if(d.map){e(d.map,m);d.autoFit&&d.map.bounds(m.boundingBox)}d.success&&d.success(m)},d.error)},createMapOverlay:e,getSpriteOffset:function(d,h){var m=i[d];if(m=m?m.split(":"):null)return{x:-m[0]*(h||16),y:-m[1]*(h||16)};return null},parseTurnType:b,Instruction:function(d){var h=d=J({position:null,description:"",distance:0,distanceTotal:0,time:0,timeTotal:0,turnType:null},d),m=d.description;m=m.replace(/(\w)(\/)(\w)/g,"$1 $2 $3");h.description=
m;if(!d.turnType)d.turnType=b(d.description);return d},RouteData:function(d){d=J({geometry:[],instructions:[],boundingBox:null},d);if(!d.boundingBox)d.boundingBox=new GeoJS.BBox(d.geometry);return J({getInstructionPositions:function(){for(var h=[],m=0;m<d.instructions.length;m++)d.instructions[m].position&&h.push(d.instructions[m].position);return h}},d)}};L.observable(r);return r}();L.Decarta=function(){function a(f){return i(k.clientName,k.clientPassword,k.sessionID,k.configuration,k.release,f)}
function e(f,n){return c(f.maxResponses,f.version,f.requestID,f.methodName,n)}function b(f,n){k.server||L.log("No server configured for deCarta - we are going to have issues","warn");return r(k.server,f.requestID,escape(n))}function g(f,n,s){Eb(b(f,a(e(f,f.getRequestBody()))),function(t){var o=t.response.XLS.Response;if(o.numberOfResponses>0&&o[f.methodName+"Response"]){t=null;if(f.parseResponse)t=f.parseResponse(o[f.methodName+"Response"]);n&&n(t)}else s&&s("Server returned no responses",t.response)})}
function j(f,n){var s=new d({json:f.StreetAddress}),t=[];if(f.Place){if(!f.Place.length)f.Place=[f.Place];for(var o=f.Place.length;o--;)t[t.length]=f.Place[o].content}return new ADDR.Address({building:s.building,street:s.street,regions:t,countryCode:f.countryCode||"",postalCode:f.PostalCode||"",pos:n})}var k={sessionID:(new Date).getTime(),server:"",clientName:"",clientPassword:"",configuration:"",maxResponses:25,release:"4.4.2sp03",tileFormat:"PNG",fixedGrid:true,useCache:true,tileHosts:[],requestTimeout:3E4,
geocoding:{countryCode:"US",language:"EN"}};TL=function(){function f(s,t){this.days=s||0;this.seconds=t||0}f.prototype={add:function(){for(var s=new f(this.days,this.seconds),t=arguments.length;t--;){s.days+=arguments[t].days;s.seconds+=arguments[t].seconds}return s},toString:function(){var s,t,o,q="";if(this.days)q=this.days+" days ";if(this.seconds){o=this.seconds;if(o>=3600){s=~~(o/3600);o-=s*3600}if(o>=60){t=Math.round(o/60);o-=t*60}if(s)q=q+s+(s>1?" hrs ":" hr ")+(t?(t>10?t:"0"+t)+" min ":"");
else if(t)q=q+t+" min";else if(o>0)q=q+(o>10?o:"0"+o)+" sec"}return q}};var n=function(){var s=/^P(\d+Y)?(\d+M)?(\d+D)?$/,t=/^(\d+H)?(\d+M)?(\d+S)?$/,o={8601:function(q){q=q.split("T");var w=null;w=null;var y=0,p=0;s.lastIndex=-1;w=s.exec(q[0]);y+=w[3]?parseInt(w[3].slice(0,-1),10):0;t.lastIndex=-1;w=t.exec(q[1]);p+=w[1]?parseInt(w[1].slice(0,-1),10)*3600:0;p+=w[2]?parseInt(w[2].slice(0,-1),10)*60:0;p+=w[3]?parseInt(w[3].slice(0,-1),10):0;return new f(y,p)}};return function(q,w){var y=o[w];if(!y)throw"No parser found for the duration format: "+
w;return y(q)}}();return{Duration:f,parse:n}}();var l=1,i=oa("<xls:XLS version='1' xls:lang='en' xmlns:xls='http://www.opengis.net/xls' rel='{4}' xmlns:gml='http://www.opengis.net/gml'><xls:RequestHeader clientName='{0}' clientPassword='{1}' sessionID='{2}' configuration='{3}' />{5}</xls:XLS>"),c=oa("<xls:Request maximumResponses='{0}' version='{1}' requestID='{2}' methodName='{3}Request'>{4}</xls:Request>"),r=oa("{0}/JSON?reqID={1}&chunkNo=1&numChunks=1&data={2}&responseFormat=JSON"),d=function(f){f=
L.ex({json:{}},f);var n="",s="";if(f.json.Street)n=f.json.Street.content?f.json.Street.content:f.json.Street;n=n&&n.replace?n.replace(/\/\d+$/,""):"";if(f.json.Building)if(f.json.Building.number)s=f.json.Building.number;return{building:s,street:n,calcMatchPercentage:function(t){var o=0,q=L.Addressing.normalize(t),w=L.Addressing.normalize(n);if(f.json.Building)if(L.Addressing.buildingMatch(t,f.json.Building.number.toString()))o+=0.2;if(q&&w&&L.wordExists(q,w))o+=0.8;return o},toString:function(){if(n)return(s?
s+" ":"")+n;return""}}},h=function(){return{methodName:"",maxResponses:25,version:"1.0",requestID:l++,getRequestBody:function(){return""},parseResponse:function(f){return f}}},m=function(){return L.ex(new h,{methodName:"RUOK",parseResponse:function(f){return{aliasCount:f.maxHostAliases,host:f.hostName}}})};L.Registry.register("generator","decarta",function(f){function n(o,q,w,y){if(o=o.zoom?o.zoom():0){var p=2<<o-1,C=p>>1,v=f.tileSize,z=(q.w/v|0)+1,G=(q.h/v|0)+1,E=(q.x/v|0)-C;q=p-(q.y/v|0)-C-G;var D=
w.search({x:(C+E)*v,y:(C+q*-1-G)*v,w:z*v,h:G*v});p={};var O;for(O=D.length;O--;)p[D[O].id]=true;for(D=0;D<=z;D++)for(O=0;O<=G;O++){var Q=E+D,A=q+O-1,F=Q+"_"+A;if(!p[F]){Q=new L.Tile((C+E+D)*v,(C+q*-1-O)*v,t[D%t.length]+"/openls/image-cache/TILE?LLMIN=0.0,0.0&LLMAX="+s[o]+"&CACHEABLE=true&DS=navteq-world&WIDTH=256&HEIGHT=256&CLIENTNAME="+k.clientName+"&SESSIONID="+k.sessionID+"&FORMAT=PNG&CONFIG="+k.configuration+"&N="+A+"&E="+Q,v,v,F);w.insert(Q,Q)}}y&&y()}}f=L.ex({tileSize:256},f);var s=["89.787438015348100000,360.00000000000000000",
"85.084059050110410000,180.00000000000000000","66.653475896509040000,90.00000000000000000","41.170427238429790000,45.000000000000000000","22.076741328793200000,22.500000000000000000","11.251819676168665000,11.250000000000000000","5.653589942659626000,5.625000000000000000","2.830287664051185000,2.812500000000000000","1.415581451872543800,1.406250000000000000","0.707845460801532700,0.703125000000000000","0.353929573271679340,0.351562500000000000","0.176965641673330230,0.175781250000000000","0.088482927761462040,0.087890625000000000",
"0.044241477246363230,0.043945312500000000","0.022120740293895182,0.021972656250000000","0.011060370355776452,0.010986328125000000","0.005530185203987857,0.005493164062500000","0.002765092605263539,0.002746582031250000","0.001382546303032519,0.001373291015625000","0.000691272945568983,0.000686645507812500","0.000345636472797214,0.000343322753906250"],t=null;L.userMessage("ack","decarta","&copy; deCarta, Inc. Map and Imagery Data &copy; NAVTEQ or Tele Atlas or DigitalGlobe");return{run:function(o,
q,w,y){t?n(o,q,w,y):g(new m,function(p){t=[];if(p.aliasCount)for(var C=0;C<p.aliasCount;C++)t[C]="http://"+p.host.replace("^(.*?).(.*)$","\u0001-0"+(C+1)+".\u0002");else t=["http://"+p.host];n(o,q,w,y)})}}});L.Registry.register("service","geocoder",function(){var f=L.formatter('<xls:GeocodeRequest><xls:Address countryCode="{0}" language="{1}">{2}</xls:Address></xls:GeocodeRequest>'),n=L.formatter('<xls:StreetAddress><xls:Building number="{0}" /><xls:Street>{1}</xls:Street></xls:StreetAddress>'),s=
function(o,q){q=L.ex({countryCode:k.geocoding.countryCode,language:k.geocoding.language},q);var w=ADDR.parse(o),y=new h;return L.ex({},y,{methodName:"Geocode",getRequestBody:function(){var p=n(w.number,w.street);p+='<xls:Place type="Municipality">'+w.regions.join(" ")+"</xls:Place>";return f(q.countryCode,q.language,p)},parseResponse:function(p){var C=p.GeocodeResponseList;p=[];var v=C?C.numberOfGeocodedAddresses:0,z=[];if(v>1)z=C.GeocodedAddress;else if(v==1)z=[C.GeocodedAddress];for(C=0;z&&C<z.length;C++){v=
z[C];var G=null,E=null;if(v&&v.GeocodeMatchCode&&v.GeocodeMatchCode.matchType!=="NO_MATCH"){if(v&&v.Point)E=new GeoJS.Pos(v.Point.pos);if(v&&v.Address)G=j(v.Address,E)}(v=G)&&p.push(v)}return p}})},t=function(o){o=L.ex({position:null,geocodePreference:"StreetAddress"},o);return L.ex(new h,{methodName:"ReverseGeocode",getRequestBody:function(){return"<xls:ReverseGeocodeRequest><xls:Position><gml:Point><gml:pos>"+o.position.toString()+"</gml:pos></gml:Point></xls:Position><xls:ReverseGeocodePreference>"+
o.geocodePreference+"</xls:ReverseGeocodePreference></xls:ReverseGeocodeRequest>"},parseResponse:function(q){var w=null;if(q&&q.Point)w=new GeoJS.Pos(match.Point.pos);if(q&&q.ReverseGeocodedLocation&&q.ReverseGeocodedLocation.Address)return j(q.ReverseGeocodedLocation.Address,w);return null}})};typeof ADDR==="undefined"&&L.log("Sidelab addressing module not found, geocoder will not function","warn");return{forward:function(o,q){g(new s(o),function(w){q(o,w)})},reverse:function(o,q){var w=new t({position:o});
g(w,function(y){q&&q(y)})}}});L.Registry.register("service","routing",function(){var f=function(n){n=L.ex({waypoints:[],provideRouteHandle:false,distanceUnit:"KM",routeQueryType:"RMAN",routePreference:"Fastest",routeInstructions:true,routeGeometry:true},n);var s=new h,t=L.formatter('<xls:DetermineRouteRequest provideRouteHandle="{0}" distanceUnit="{1}" routeQueryType="{2}">'),o=L.formatter("<xls:{0}><xls:Position><gml:Point><gml:pos>{1}</gml:pos></gml:Point></xls:Position></xls:{0}>");return L.ex({},
s,{methodName:"DetermineRoute",getRequestBody:function(){if(n.waypoints.length<2)throw Error("Cannot send RouteRequest, less than 2 waypoints specified");var q=t(n.provideRouteHandle,n.distanceUnit,n.routeQueryType);q+="<xls:RoutePlan>";q+="<xls:RoutePreference>"+n.routePreference+"</xls:RoutePreference>";q+="<xls:WayPointList>";for(var w=0;w<n.waypoints.length;w++)q+=o(w===0?"StartPoint":w===n.waypoints.length-1?"EndPoint":"ViaPoint",n.waypoints[w].toString());q+="</xls:WayPointList>";q+="</xls:RoutePlan>";
if(n.routeInstructions)q+='<xls:RouteInstructionsRequest rules="maneuver-rules" providePoint="true" />';if(n.routeGeometry)q+="<xls:RouteGeometryRequest />";q+="</xls:DetermineRouteRequest>";return q},parseResponse:function(q){var w=L.RouteTools.RouteData,y=q.RouteGeometry.LineString.pos,p=y.length,C=Array(p);for(p=p;p--;)C[p]=new GeoJS.Pos(y[p]);y=q.RouteInstructionsList;q=[];y=y&&y.RouteInstruction?y.RouteInstruction:[];for(p=0;p<y.length;p++){var v=GeoJS.Distance,z=y[p].distance,G={M:1,KM:1E3}[z.uom?
z.uom.toUpperCase():"M"];v=new v(z.value&&G?z.value*G:0);z=TL.parse(y[p].duration,"8601");q.push(new L.RouteTools.Instruction({position:new GeoJS.Pos(y[p].Point),description:y[p].Instruction,distance:v,time:z}))}return new w({geometry:C,instructions:q})}})};return{calculate:function(n,s,t){n=L.ex({waypoints:[]},n);if(typeof L.RouteTools!=="undefined"){n=new f(n);g(n,function(o){s&&s(o)},t)}else L.log("Could not generate route, T5.RouteTools plugin not found","warn")}}});return{applyConfig:function(f){L.ex(k,
f)},compareFns:function(){return{streetDetails:function(f,n){return n.calcMatchPercentage(f)},location:function(f,n){return n.calcMatchPercentage(f)}}}()}}();kb.T5=L;kb.Tile5=function(a,e){e=J({container:a,type:"map",renderer:"canvas",starpos:null,zoom:1,fastpan:false,drawOnScale:true,zoombar:{}},e);return wa("view",e.type,e)}})(typeof window!="undefined"?window:exports);
