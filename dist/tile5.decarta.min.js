(function(db){function J(){var a=arguments[0]||{},b=Array.prototype.slice.call(arguments,1),c,k;for(k=b.length;k--;)if((c=b[k])!==null)for(var j in c){var e=c[j];if(a!==e)if(e!==undefined)a[j]=e}return a}function $(a,b){if(typeof console!=="undefined")console[b||"debug"](a)}function ja(a){var b=a.match(Cb),c=[],k=0,j;for(j=b?b.length:0;j--;){var e=b[j].slice(1);c[e]||(c[e]=RegExp("\\{"+e+"\\}","g"))}k=c.length;return function(){var h=a;for(j=0;j<k;j++)h=h.replace(c[j],arguments[j]||"");return h}}
function Qa(a){a=a.replace(/[\-\_\s\.]/g,"").toLowerCase();return za[a]||za.linear}function eb(a,b,c,k,j){function e(i){i=i?i:(new Date).getTime();if(d+fb<i){var f=i-h,s=c(f,a,g,k),l=h+k<=i;i=!l;if(j){f=j(s,l,f);i=typeof f!="undefined"?f&&i:i}i&&animFrame(e)}}var h=(new Date).getTime(),d=0,g=b-a;animFrame(e);return{}}function gb(a){a=parseFloat(a)*ha;a=ra(a);var b=Ga*a;return ka((1+a)/(1-a)*la((1-b)/(1+b),Ga))/2}function hb(a){return ea/(256<<a)}function ib(a,b){var c=Ga*ra(a);return Aa-2*jb(b*la((1-
c)/(1+c),Ga/2))}function T(a,b){this.mercY=this.mercX=null;if(X(a,Ha))kb.parseXY(a,this);else if(a&&a.toPixels){var c=a.toPixels();this.mercX=c.x;this.mercY=c.y}else{this.x=a||0;this.y=b||0}}function ma(a,b,c,k){this.x=a||0;this.y=b||0;this.w=c||0;this.h=k||0;this.x2=this.x+this.w;this.y2=this.y+this.h}function lb(a,b){var c=new mb(Math.sqrt(256<<a)|0);b&&b.zoomLevel===a&&b.copyInto(c);c.zoomLevel=a;return c}function nb(a){a=a||(new Date).getTime();for(var b=0;b<wa.length;){var c=wa[b],k=sa[c],j=
sa[c].image&&sa[c].image.complete&&sa[c].image.width>0,e=a-k.start;e=j||e>=Db;if(j){j=k.callbacks;ob[c]=k.image;for(var h=0;h<j.length;h++)j[h](k.image,true)}if(e){wa.splice(b,1);delete sa[c]}else b++}wa.length>0&&animFrame(nb)}function Ia(a,b){var c=a&&b?ob[a]:null;if(c&&c&&c.complete&&c.width>0)b(c);else{if(c=sa[a])c.callbacks.push(b);else{c=new Image;c.id="_ldimg"+ ++Eb;sa[a]={start:(new Date).getTime(),image:c,callbacks:[b]};c.src=a;wa[wa.length]=a}animFrame(nb)}}function Ra(a,b,c,k,j,e){this.x=
a;this.y=b;this.w=k||256;this.h=k||256;this.x2=this.x+this.w;this.y2=this.y+this.h;this.url=c;this.id=e||a+"_"+b;this.loaded=false;this.image=null}function pb(a){a=a?a:(new Date).getTime();if(a-qb>fb){for(var b=Ba.splice(0),c=b.length;c--;)b[c](a);qb=a}Ba.length&&animFrame(pb)}function rb(a){var b=Ba.length==0;Ba[Ba.length]=a;b&&animFrame(pb)}function Fb(a,b,c,k,j){j=J({easing:"sine.out",duration:1E3,progress:null,complete:null,autoInvalidate:true},j);var e=(new Date).getTime(),h=a[b],d=b=="translate",
g=j.autoInvalidate,i=c.length&&k.length&&c.length==k.length?c.length:0,f=Array(i),s=Array(i),l=Qa(j.easing),p=j.duration,u=j.progress,m=function(r){var o=r-e;r=e+p<=r;for(var t=a.layer?a.layer.view:null,A,y=i;y--;){A=l(o,c[y],f[y],p);s[y]=d?A|0:A}h.apply(a,s);g&&t&&t.invalidate();if(u){o=[].concat(r?k:s);o.unshift(r);u.apply(a,o)}if(r){a.animations--;h.apply(a,k);j.complete&&j.complete.apply(a,k)}else rb(m)};if(h&&h.apply&&i>0){p=p?p:DEFAULT_DURATION;for(b=i;b--;)f[b]=k[b]-c[b];a.animations++;rb(m)}}
function Ja(a,b){b=J({id:"layer_"+Gb++,zindex:0,animated:false,style:null,minXY:null,maxXY:null},b);this.visible=true;na(J(this,b))}function ia(a,b){if(a&&a.split){var c=a.split(sb);if(c.length>1){a=c[0];b=c[1]}}else if(a&&a.lat){b=a.lon;a=a.lat}this.lat=parseFloat(a||0);this.lon=parseFloat(b||0)}function Ca(a,b){if(X(a,Hb)){for(var c=b,k=this.min=new ia(tb,ub),j=this.max=new ia(Ib,Jb),e=a.length;e--;){var h=a[e];if(h.lat<k.lat)k.lat=h.lat;if(h.lat>j.lat)j.lat=h.lat;if(h.lon<k.lon)k.lon=h.lon;if(h.lon>
j.lon)j.lon=h.lon}if(X(c,oa)){c=calcSize(bounds.min,bounds.max);c=Sa(c.x,c.y)*0.3}this.expand(c)}else{this.min=a;this.max=b}}var Ta={};(function(a){var b=[],c=0,k=false,j=a.register=function(e,h){b.push({section:e,run:h})};a.init=function(e){function h(){if(c<b.length){var g=b[c++];d[g.section]||(d[g.section]={});g.run(d[g.section],h)}else{for(g in d)a[g]=d[g];k=true;e&&e(a)}}var d={};if(k&&e)e(a);else{c=0;h()}};j("canvas",function(e,h){function d(){var s,l=g.getContext("2d");l.save();try{l.translate(50,
50);l.beginPath();l.rect(0,0,20,20);s=l.isPointInPath(10,10)}finally{l.restore()}return s}var g=document.createElement("canvas"),i=typeof FlashCanvas!="undefined",f=typeof G_vmlCanvasManager!="undefnined";g.width=200;g.height=200;e.pipTransformed=i||f?false:d();h()})})(Ta);window.animFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){setTimeout(function(){a((new Date).getTime())},
1E3/60)}}();var Cb=/\{(\d+)(?=\})/g,za=function(){var a=1.70158,b=Math.PI/2,c=Math.abs,k=Math.pow,j=Math.sin,e=Math.asin,h=Math.cos;return{linear:function(d,g,i,f){return i*d/f+g},backin:function(d,g,i,f){return i*(d/=f)*d*((a+1)*d-a)+g},backout:function(d,g,i,f){return i*((d=d/f-1)*d*((a+1)*d+a)+1)+g},backinout:function(d,g,i,f){return(d/=f/2)<1?i/2*d*d*(((a*=1.525)+1)*d-a)+g:i/2*((d-=2)*d*(((a*=1.525)+1)*d+a)+2)+g},bouncein:function(d,g,i,f){return i-za.bounceout(f-d,0,i,f)+g},bounceout:function(d,
g,i,f){return(d/=f)<1/2.75?i*7.5625*d*d+g:d<2/2.75?i*(7.5625*(d-=1.5/2.75)*d+0.75)+g:d<2.5/2.75?i*(7.5625*(d-=2.25/2.75)*d+0.9375)+g:i*(7.5625*(d-=2.625/2.75)*d+0.984375)+g},bounceinout:function(d,g,i,f){return d<f/2?za.bouncein(d*2,0,i,f)/2+g:za.bounceout(d*2-f,0,i,f)/2+i/2+g},cubicin:function(d,g,i,f){return i*(d/=f)*d*d+g},cubicout:function(d,g,i,f){return i*((d=d/f-1)*d*d+1)+g},cubicinout:function(d,g,i,f){if((d/=f/2)<1)return i/2*d*d*d+g;return i/2*((d-=2)*d*d+2)+g},elasticin:function(d,g,i,
f,s,l){if(d==0)return g;if((d/=f)==1)return g+i;l||(l=f*0.3);if(!s||s<c(i)){s=i;i=l/4}else i=l/ea*e(i/s);return-(s*k(2,10*(d-=1))*j((d*f-i)*ea/l))+g},elasticout:function(d,g,i,f,s,l){var p;if(d==0)return g;if((d/=f)==1)return g+i;l||(l=f*0.3);if(!s||s<c(i)){s=i;p=l/4}else p=l/ea*e(i/s);return s*k(2,-10*d)*j((d*f-p)*ea/l)+i+g},elasticinout:function(d,g,i,f,s,l){var p;if(d==0)return g;if((d/=f/2)==2)return g+i;l||(l=f*0.3*1.5);if(!s||s<c(i)){s=i;p=l/4}else p=l/ea*e(i/s);if(d<1)return-0.5*s*k(2,10*(d-=
1))*j((d*f-p)*ea/l)+g;return s*k(2,-10*(d-=1))*j((d*f-p)*ea/l)*0.5+i+g},quadin:function(d,g,i,f){return i*(d/=f)*d+g},quadout:function(d,g,i,f){return-i*(d/=f)*(d-2)+g},quadinout:function(d,g,i,f){if((d/=f/2)<1)return i/2*d*d+g;return-i/2*(--d*(d-2)-1)+g},sinein:function(d,g,i,f){return-i*h(d/f*b)+i+g},sineout:function(d,g,i,f){return i*j(d/f*b)+g},sineinout:function(d,g,i,f){return-i/2*(h(Math.PI*d/f)-1)+g}}}();if(typeof animFrame==="undefined")throw Error("animFrame COG required for tweening support");
var na=function(){function a(c,k){var j=c.hasOwnProperty("obsHandlers")?c.obsHandlers:null;j[k]||(j[k]=[]);return j[k]}var b=0;return function(c){if(!c)return null;if(!(c.hasOwnProperty("obsHandlers")?c.obsHandlers:null))c.obsHandlers={};if(!c.hasOwnProperty("bind")){c.bind=function(k,j){var e="callback"+b++;a(c,k).unshift({fn:j,id:e});return e};c.triggerCustom=function(k,j){var e=a(c,k),h={cancel:false,name:k,source:this},d;for(d in j)h[d]=j[d];if(!e)return null;d=Array.prototype.slice.call(arguments,
2);c.eventInterceptor&&c.eventInterceptor(k,h,d);d.unshift(h);for(var g=e.length;g--&&!h.cancel;)e[g].fn.apply(this,d);return h};c.trigger=function(k){var j=Array.prototype.slice.call(arguments,1);j.splice(0,0,k,null);return c.triggerCustom.apply(this,j)};c.unbind=function(k,j){if(typeof k==="undefined")c.obsHandlers={};else for(var e=a(c,k),h=0;e&&h<e.length;h++)if(e[h].id===j){e.splice(h,1);break}return c}}return c}}(),vb=Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===
a)return b;return-1},X=function(){return function(a,b){b=Kb.call(b);if(b=="finite")return!Lb[Mb](+a);return b=="null"&&a===null||b==typeof a||b=="object"&&a===Object(a)||b=="array"&&Array.isArray&&Array.isArray(a)||Nb.call(a).slice(8,-1).toLowerCase()==b}}(),wb=function(){function a(j){var e=document.createElement("script"),h=false;e.src=j;e.async=true;e.onload=e.onreadystatechange=function(){if(!h&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){h=true;e.onload=e.onreadystatechange=
null;e&&e.parentNode&&e.parentNode.removeChild(e)}};c||(c=document.getElementsByTagName("head")[0]);c.appendChild(e)}var b=0,c,k=this;return function(j,e,h){j+=j.indexOf("?")>=0?"&":"?";var d="json"+ ++b;k[d]=function(g){e(g);k[d]=null;try{delete k[d]}catch(i){}};a(j+(h?h:"callback")+"="+d);return d}}();INTERACT=function(){function a(l){return function(p,u){l.addEventListener(p,u,false)}}function b(l){return function(p,u){l.removeEventListener(p,u,false)}}function c(l){return function(p,u){l.attachEvent("on"+
p,u)}}function k(l,p){return{x:l?l:0,y:p?p:0,count:1}}function j(l,p){f.push(J({handler:null,checks:{},type:l},p))}function e(l){var p=0,u=0;if(l.offsetParent){do{p+=l.offsetLeft;u+=l.offsetTop;l=l.offsetParent}while(l)}return{left:p,top:u}}function h(l,p){return{source:l,target:p.target?p.target:p.srcElement}}function d(l,p){for(var u=l.target?l.target:l.srcElement;u&&u!==p;)u=u.parentNode;return u&&u===p}function g(l,p){return{x:l.x-(p?p.left:0),y:l.y-(p?p.top:0)}}function i(l,p){if(l.preventDefault){l.preventDefault();
l.stopPropagation()}else if(typeof l.cancelBubble!="undefined")l.cancelBubble=true;p&&l.stopImmediatePropagation&&l.stopImmediatePropagation()}var f=[],s=function(l,p,u){u=J({binder:null,unbinder:null,observable:null},u);for(var m=u.observable,r=[],o,t,A={bind:function(){return m.bind.apply(null,arguments)},unbind:function(){m.unbind();for(y=0;y<r.length;y++)r[y].unbind();return A}},y=0;y<p.length;y++)r.push(p[y](l,m,u));m.bind("pointerDown",function(){t=o=0});m.bind("pointerMove",function(n,C,z,
x){o+=x.x||0;t+=x.y||0});m.bind("pointerUp",function(n,C,z){Math.abs(o)>20||Math.abs(t)>20||m.triggerCustom("tap",n,C,z)});return A};j("pointer",{handler:function(l,p,u){function m(v){if(v.pageX&&v.pageY)return k(v.pageX,v.pageY);else{var H=document.documentElement,O=document.body;return k(v.clientX+(H&&H.scrollLeft||O&&O.scrollLeft||0)-(H&&H.clientLeft||O&&O.clientLeft||0),v.clientY+(H&&H.scrollTop||O&&O.scrollTop||0)-(H&&H.clientTop||O&&O.clientTop||0))}}function r(v){if(d(v,l))if(x=y(v)){var H=
m(v);l.style.cursor="move";i(v,true);L=H.x;M=H.y;D=k(L,M);p.triggerCustom("pointerDown",h("mouse",v),D,g(D,e(l)))}}function o(v){var H=m(v);F=H.x;G=H.y;if(d(v,l))n(v,x?"pointerMove":"pointerHover")}function t(v){if(x&&y(v)){x=false;if(d(v,l)){l.style.cursor="default";n(v,"pointerUp")}}}function A(v){if(d(v,l)){var H;v=v||window.event;if(v.detail)H=v.axis===2?-v.detail*C:0;else{H=v.wheelDeltaY?v.wheelDeltaY:v.wheelDelta;if(window.opera)H=-H}if(H!==0){var O=k(F,G);p.triggerCustom("zoom",h("mouse",v),
O,g(O,e(l)),H/z,"wheel");i(v);v.returnValue=false}}}function y(v){v=v||window.event;return(v.which||v.button)==1}function n(v,H,O,Q,U){O=typeof O!="undefined"?O:F;Q=typeof Q!="undefined"?Q:G;var I=O-L,N=Q-M,K=k(O,Q);p.triggerCustom(H,h("mouse",v),K,g(K,e(l)),k(I,N));if(typeof U=="undefined"||U){L=O;M=Q}}u=J({},u);var C=120,z=C*8,x=false,D,F,G,L,M;u.binder("mousedown",r);u.binder("mousemove",o);u.binder("mouseup",t);u.binder("dblclick",function(v){$("captured double click");if(d(v,l)){var H=m(v);p.triggerCustom("doubleTap",
h("mouse",v),H,g(H,e(l)))}});u.binder("mousewheel",A);u.binder("DOMMouseScroll",A);return{unbind:function(){u.unbinder("mousedown",r);u.unbinder("mousemove",o);u.unbinder("mouseup",t);u.unbinder("mousewheel",A);u.unbinder("DOMMouseScroll",A)}}},checks:{touch:false}});j("pointer",{handler:function(l,p,u){function m(I){if(I.count<2)return 0;var N=I.x-I.next.x;I=I.y-I.next.y;return~~Math.sqrt(N*N+I*I)}function r(I,N,K){N=N?N:0;K=K?K:0;for(var Z={x:I.x-N,y:I.y-K,id:I.id,count:I.count},W=Z;I.next;){I=
I.next;W=W.next={x:I.x-N,y:I.y-K,id:I.id}}return Z}function o(I,N){var K=I[N?N:"touches"],Z,W;if(K.length===0)return null;W=Z={x:K[0].pageX,y:K[0].pageY,id:K[0].identifier,count:K.length};for(var Y=1,xa=K.length;Y<xa;Y++)W=W.next={x:K[Y].pageX,y:K[Y].pageY,id:K[Y].identifier};return Z}function t(I){if(d(I,l)){G=e(l);var N=o(I,"changedTouches"),K=r(N,G.left,G.top);if(!M){L=x;p.triggerCustom("pointerDown",h("touch",I),N,K)}Q&&p.triggerCustom("pointerDownMulti",h("touch",I),N,K);M=o(I);if(M.count>1)H=
m(M);U=1;O=r(M)}}function A(I){if(d(I,l)){i(I);v=o(I);if(L==x)L=Math.abs(M.x-v.x)>C||Math.abs(M.y-v.y)>C?z:x;if(L!=x){L=v.count>1?F:D;if(L==F)if(M.count===1){M=r(v);H=m(M)}else{var N=m(v);if(Math.abs(H-N)<n)L=D;else{var K;K=v.x;var Z=v.next.x,W=v.y,Y=v.next.y;K={x:(K<Z?K:Z)+(Math.abs(K-Z)>>1),y:(W<Y?W:Y)+(Math.abs(W-Y)>>1)};N=N/H;Z=N-U;p.triggerCustom("zoom",h("touch",I),K,g(K,G),Z,"pinch");U=N}}L==D&&p.triggerCustom("pointerMove",h("touch",I),v,r(v,G.left,G.top),k(v.x-O.x,v.y-O.y));Q&&p.triggerCustom("pointerMoveMulti",
h("touch",I),v,r(v,G.left,G.top))}O=r(v)}}function y(I){if(d(I,l)){var N=o(I,"changedTouches"),K=r(N,G.left,G.top);v=o(I);if(!v){p.triggerCustom("pointerUp",h("touch",I),N,K);M=null}Q&&p.triggerCustom("pointerUpMulti",h("touch",I),N,K)}}u=J({detailed:false,inertia:false},u);var n=20,C=7,z=0,x=1,D=2,F=3,G,L,M,v,H,O,Q=u.detailed,U=1;u.binder("touchstart",t);u.binder("touchmove",A);u.binder("touchend",y);$("initialized touch handler");return{unbind:function(){u.unbinder("touchstart",t);u.unbinder("touchmove",
A);u.unbinder("touchend",y)}}},checks:{touch:true}});return{register:j,watch:function(l,p,u){p=J({bindTarget:null,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},p);capabilities=J({touch:"ontouchstart"in window},u);if(!p.observable){$("creating observable");p.observable=na({});globalOpts=p}p.binder=(p.isIE?c:a)(p.bindTarget||document);p.unbinder=(p.isIE?c:b)(p.bindTarget||document);u=p.types;for(var m=capabilities,r=[],o=f.length;o--;){var t=f[o],A=!u||u.indexOf(t.type)>=0,
y=true,n;for(n in t.checks){var C=t.checks[n];$("checking "+n+" capability. require: "+C+", capability = "+m[n]);y=y&&C===m[n]}if(A&&y)r[r.length]=t.handler}return new s(l,r,p)}}}();var B={ex:J,log:$,observable:na,formatter:ja,wordExists:function(a,b){for(var c=a.split(/\s|\,/).length;c--;)if(a.toLowerCase()==b.toLowerCase())return true;return false},is:X,indexOf:vb};na(B);var Ua=function(){var a={};return{create:function(b,c){if(a[b][c])return a[b][c].apply(null,Array.prototype.slice.call(arguments,
2))},register:function(b,c,k){a[b]||(a[b]={});a[b][c]&&$(Ob(b,c),"warn");a[b][c]=k}}}(),Ob=ja("Registration of {0}: {1} will override existing definition"),Va=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],ea=Math.PI*2,Aa=Math.PI/2,ha=Math.PI/180,Ka=180/Math.PI,tb=Aa,Ib=-tb,ub=ea,Jb=-ub,Ga=0.08181919084262157,pa=Math.abs,xb=Math.ceil,ya=Math.round,La=Math.min,Sa=Math.max,la=Math.pow,yb=Math.sqrt,ka=Math.log,ra=Math.sin,Pb=Math.asin,Wa=Math.cos,jb=Math.atan,
Qb=Math.atan2,Mb="hasOwnProperty",Lb={NaN:1,Infinity:1,"-Infinity":1},Kb=String.prototype.toLowerCase,Nb=Object.prototype.toString,oa="undefined",Ha="string",Xa="number",Hb="array",qa="drawable",ba=Ua.register,ta=Ua.create,Rb=0,Gb=0,sb=/[\,\s]+/,Sb=B.newCanvas=function(a,b){var c=document.createElement("canvas");c.width=a?a:0;c.height=b?b:0;B.trigger("createCanvas",c);return c},Tb=function(){function a(j){k++;j=j||(new Date).getTime();for(var e=c.length;e--;){var h=c[e];k%h.every===0&&h.cb(j)}animFrame(a)}
var b=1E3/60,c=[],k=0;animFrame(a);return{attach:function(j,e){c[c.length]={cb:j,every:e?ya(e/b):1}},detact:function(){}}}(),kb=function(){var a=/^xy\((.*)\).*$/i;return{parseXY:function(b,c){c=c||new T;if(!a.test(b)){var k=b.split(sb);c.mercX=parseFloat(k[1])*ha;c.mercY=gb(k[0])}return c}}}(),fa=function(){var a={"-webkit-user-select":"none",position:"absolute"},b;b=function(c){for(var k=0;k<c.length;k++){var j=c[k];if(typeof document.body.style[j]!="undefined")return j}}(["-webkit-transform","MozTransform"]);
return{supportTransforms:b,create:function(c,k,j){c=document.createElement(c);var e=[];j=j||{};c.className=k||"";for(var h in j)e[e.length]=h+": "+j[h];c.style.cssText=e.join(";");return c},move:function(c,k,j,e){if(b)c.style[b]="translate("+k+"px, "+j+"px) translateZ(0) "+(e||[]).join(" ");else{c.style.left=k+"px";c.style.top=j+"px"}},styles:function(c){return J({},a,c)}}}();T.prototype={constructor:T,add:function(){for(var a=this.x,b=this.y,c=arguments.length;c--;){a+=arguments[c].x;b+=arguments[c].y}return new T(a,
b)},equals:function(a){return this.x===a.x&&this.y===a.y},offset:function(a,b){return new T(this.x+a,this.y+b)},sync:function(a,b){if(b){this.mercX=this.x*a-Math.PI;this.mercY=Math.PI-this.y*a}else if(this.mercX||this.mercY){this.x=ya((this.mercX+Math.PI)/a);this.y=ya((Math.PI-this.mercY)/a)}return this},pos:function(){for(var a=la(Math.E,-this.mercY),b=Aa-2*jb(a),c=ib(b,a),k=0;k<12&&pa(b-c)>1.0E-7;){b=c;c=ib(b,a);k++}return new ia(c*Ka,this.mercX%360*Ka)},toString:function(){return this.x+", "+this.y}};
ma.prototype={constructor:ma,buffer:function(a,b){return new ma(this.x-a,this.y-(b||a),this.w+a*2,this.h+(b||a)*2)},center:function(){return new T(this.x+(this.w>>1),this.y+(this.h>>1))}};Hits=function(){return{diffHits:function(a,b){var c=[],k={},j;for(j=b.length;j--;)k[b[j].target.id]=true;for(j=a.length;j--;)k[a[j].target.id]||(c[c.length]=a[j]);return c},init:function(a,b,c,k){return{type:a,x:k.x|0,y:k.y|0,elements:[],absXY:b,relXY:c}},initHit:function(a,b,c){return{type:a,target:b,drag:c}},triggerEvent:function(a,
b,c,k){b.triggerCustom(a.type+(c?c:"Hit"),{hitType:a.type},k?k:a.elements,a.absXY,a.relXY,new T(a.x,a.y))}}}();var mb=function(a){function b(e,h){var d=c[e],g;d||(d=c[e]=[]);(g=d[h])||(g=d[h]=[]);return g}a=a||128;var c=[],k={},j=0;return{copyInto:function(e){for(var h in k){var d=k[h];e.insert(d.bounds||d,d,h)}},insert:function(e,h,d){var g=e.x/a|0,i=e.y/a|0,f=(e.x+e.w)/a|0;e=(e.y+e.h)/a|0;d=d||h.id||"obj_"+j++;k[d]=h;for(h=g;h<=f;h++)for(g=i;g<=e;g++)b(h,g).push(d)},remove:function(e,h,d){d=d||
h.id;if(k[d]){var g=e.x/a|0;h=e.y/a|0;var i=(e.x+e.w)/a|0;e=(e.y+e.h)/a|0;delete k[d];for(g=g;g<=i;g++)for(var f=h;f<=e;f++){var s=b(g,f),l=vb.call(s,d);l>=0&&s.splice(l,1)}}},search:function(e){var h=e.y/a|0,d=(e.x+e.w)/a|0,g=(e.y+e.h)/a|0,i=[],f=[];for(e=e.x/a|0;e<=d;e++)for(var s=h;s<=g;s++)i=i.concat(b(e,s));i.sort();for(h=i.length;h--;){d=i[h];if(g=k[d])f[f.length]=g;for(;h>0&&i[h-1]==d;)h--}return f}}},Db=3E4,ob={},Eb=0;(new Date).getTime();var sa={},wa=[];Ra.prototype={constructor:Ra,load:function(a){var b=
this;Ia(this.url,function(c){b.loaded=true;b.image=c;a&&a()})}};var Ub=function(){return na({fastpan:true,applyStyle:function(){},applyTransform:function(a,b,c){return{restore:null,x:b,y:c}},checkSize:function(){},getDimensions:function(){return{width:0,height:0}},getViewport:function(){},hitTest:function(){return false},prepare:function(){},projectXY:null,reset:function(){}})},Vb=B.attachRenderer=function(a,b,c,k,j){a=a.split("/");for(var e=new Ub(b,c,k,j),h=0;h<a.length;h++)e=ta("renderer",a[h],
b,c,k,j,e);return e};ba("renderer","canvas",function(a,b,c,k,j){function e(n,C,z){var x,D;p[C]=function(F){for(x=A.length;x--;)if(D=z[A[x]])F[y[x]]=D}}function h(n,C,z){var x=false;if(C)x=f.isPointInPath(m?C.x-s:C.relXY.x,m?C.y-l:C.relXY.y);return{draw:z||t,viewport:n,hit:x,vpX:s,vpY:l,context:f}}k=J({},k);var d,g,i,f,s=0,l=0,p={},u=null,m=Ta.canvas.pipTransformed,r={},o=function(){},t=function(){this.fill&&f.fill();this.stroke&&f.stroke()},A=["fill","stroke","lineWidth","opacity"],y=["fillStyle",
"strokeStyle","lineWidth","globalAlpha"];if(b){d=b.offsetWidth;g=b.offsetHeight;i=Sb(d,g);i.style.cssText="position: absolute; z-index: 1;";a.attachFrame(i,true);f=null}c=J(j,{applyStyle:function(n){var C=p[n],z=f&&f.canvas?f.canvas.id:"default",x;r[z]||(r[z]=[]);x=r[z].pop()||"basic";if(C){r[z].push(n);C(f);return x}},applyTransform:function(n){if(n.translateX!==0||n.translateY!==0||n.scaling!==1||n.rotation!==0){f.save();u={undo:function(){f.restore();u=null},x:n.xy.x,y:n.xy.y};f.translate(n.xy.x-
s+n.translateX,n.xy.y-l+n.translateY);n.rotation!==0&&f.rotate(n.rotation);n.scaling!==1&&f.scale(n.scaling,n.scaling)}return u},drawTiles:function(n,C,z){for(var x,D=s-256,F=l-256,G=n.x2,L=n.y2,M=C.length;M--;){n=C[M];if(x=n.x>=D&&n.x<=G&&n.y>=F&&n.y<=L)if(!n.loaded&&z)n.load(a.invalidate);else n.image&&f.drawImage(n.image,n.x-s,n.y-l)}},prepare:function(n,C){var z,x=false,D=C.scaled||C;if(f)f.restore();else f=i.getContext("2d");for(z=n.length;z--;)x=x||n[z].clip;s=D.x;l=D.y;if(f){x||f.clearRect(0,
0,d,g);f.save()}f.globalCompositeOperation="source-over";return f},prepArc:function(n,C,z){f.beginPath();f.arc(n.xy.x-(u?u.x:s),n.xy.y-(u?u.y:l),n.size>>1,n.startAngle,n.endAngle,false);return h(C,z)},prepImage:function(n,C,z,x){var D=(x.x||n.xy.x)-(u?u.x:s),F=(x.y||n.xy.y)-(u?u.y:l),G=x.image||n.image;if(G){f.beginPath();f.rect(D,F,x.width||G.width,x.height||G.height);return h(C,z,function(){f.drawImage(G,D,F,x.width||G.width,x.height||G.height)})}},prepMarker:function(n,C,z){var x=n.xy.x-(u?u.x:
s),D=n.xy.y-(u?u.y:l),F=n.size,G=undefined;f.beginPath();switch(n.markerStyle.toLowerCase()){case "image":G=o;f.rect(x-(F>>1),D-(F>>1),F,F);if(n.reset&&n.image){n.image=null;n.reset=false}n.image?f.drawImage(n.image,x-(F>>1),D-(F>>1),F,F):Ia(n.imageUrl,function(L){n.image=L;f.drawImage(n.image,x-(F>>1),D-(F>>1),F,F)});break;default:f.moveTo(x,D);f.lineTo(x-(F>>1),D-F);f.lineTo(x+(F>>1),D-F);f.lineTo(x,D)}return h(C,z,G)},prepPoly:function(n,C,z,x){var D=true;n=x.points||n.points;x=u?u.x:s;var F=u?
u.y:l;f.beginPath();for(var G=n.length;G--;){var L=n[G].x-x,M=n[G].y-F;if(D){f.moveTo(L,M);D=false}else f.lineTo(L,M)}return h(C,z)},getContext:function(){return f}});(function(){for(var n in B.styles)e(null,n,B.styles[n]);B.bind("styleDefined",e)})();c.bind("detach",function(){b.removeChild(i)});return c});ba("renderer","dom",function(a,b,c,k,j){function e(f){var s=f.image=new Image;g[f.id]=f;s.src=f.url;s.onload=function(){if(i[f.id])d.appendChild(this);else f.image=null};s.style.cssText="-webkit-user-select: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute;";
return s}function h(f,s,l){var p=[],u;for(u in f){var m=f[u];if(l?m[l]:!s[u]){if(m.image&&m.image.parentNode){d.removeChild(m.image);m.image=null}p[p.length]=u}}for(s=p.length;s--;)delete f[p[s]]}var d=null,g={},i={};d=fa.create("div","",fa.styles({width:b.offsetWidth+"px",height:b.offsetHeight+"px"}));b.childNodes.length>0?b.insertBefore(d,b.childNodes[0]):b.appendChild(d);a.attachFrame(d);a=J(j,{drawTiles:function(f,s,l){for(var p,u=f.x,m=f.y,r=s.length;r--;){f=s[r];if(f.url){(p=f.image||(l?e(f):
null))&&fa.move(p,f.x-u,f.y-m);i[f.id]=f}}}});a.bind("predraw",function(){h(g,i);i={}});a.bind("detach",function(){b.removeChild(d)});a.bind("reset",function(){for(h(g,i={});d.childNodes.length>0;)d.removeChild(d.childNodes[0])});return a});var Ya=B.styles={},Wb=B.defineStyle=function(a,b){Ya[a]=b;B.trigger("styleDefined",a,Ya[a]);return a},zb=B.defineStyles=function(a){for(var b in a)Wb(b,a[b])};B.getStyle=function(a){return Ya[a]};B.loadStyles=function(a){wb(a,function(b){zb(b)})};zb({basic:{fill:"#ffffff"},
highlight:{fill:"#ff0000"},waypoints:{lineWidth:4,stroke:"#003377",fill:"#ffffff"},waypointsHover:{lineWidth:4,stroke:"#ff0000",fill:"#ffffff"}});ba("view","simple",function(a){function b(q,w,E,P){o(La(Sa(V+la(2,P)-1,0.5),2))}function c(q){var w=q|0;q=w+Math.round((q-w)*50)/50;if(q!==V){V=q;q=ka(V)/Math.LN2|0;if(q!==0){V=la(2,q);p(Da+q,Xb,Yb)}ga++}}function k(q,w){var E=renderer&&renderer.projectXY?renderer.projectXY(q,w):null;if(!E){E=R.getViewport();var P=1/V;E=new T(E?E.x+q*P:q,E?E.y+w*P:w)}return E}
function j(q,w,E){t("doubleTap",w,E,k(E.x,E.y));a.scalable&&o(2,k(E.x,E.y),Zb,null,$b)}function e(q,w,E){D=null;M=true;l("down",w,E)}function h(q,w,E){l("hover",w,E)}function d(q,w,E,P){s(w,E,false);if(!D){v=P.x;H=P.y}}function g(q,w,E){s(w,E,true);M=false}function i(){clearTimeout(Ab);Ab=setTimeout(function(){renderer.checkSize()},250)}function f(q,w,E){l("tap",w,E);t("tap",w,E,k(E.x,E.y,true))}function s(q,w,E){if(D){q=k(w.x,w.y);D.drag.call(D.target,D,q.x,q.y,E)&&ga++;if(E)D=null}}function l(q,
w,E){ca=Hits.init(q,w,E,k(E.x,E.y,true));for(q=n;q--;)G=G||(y[q].hitGuess?y[q].hitGuess(ca.x,ca.y,R):false);G&&ga++}function p(q,w,E){if(X(q,Xa)){q=Sa(a.minZoom,La(a.maxZoom,q|0));if(q!==Da){var P=la(2,q-Da),S=Za/P|0,aa=$a/P|0;Da=q;A(((w||Q+Za)-S)*P,((E||U+$a)-aa)*P);Z=K=0;t("zoom",q);V=1;renderer.trigger("reset");r()}return R}else return Da}function u(){var q=new ma(Q,U,Ma,Na);q.scaleFactor=V;return q}function m(q,w,E){if(X(w,oa))for(w=0;w<n;w++){if(y[w].id===q)return y[w]}else if(X(q,Ha)){w=ta("layer",
w,R,E);w.added=(new Date).getTime();w.id=q;y[y.length]=w;y.sort(function(P,S){return S.zindex-P.zindex||S.added-P.added});n=y.length;w.trigger("resync");w.trigger("refresh",R,u());R.trigger("layerChange",R,w);ga++;return w}else return[].concat(y)}function r(){var q=u();if(q){if(W||Y)if(q){var w=xa?Q+(q.w>>1):Q,E=Oa?U+(q.h>>1):U,P=q.w,S=q.h;if(W&&W>P)if(w+P>W)Q=xa?Q:W-P;else if(w<0)Q=xa?Q:0;if(Y&&Y>S)if(E+S>Y)U=Oa?U:Y-S;else if(E<0)U=Oa?U:0}K=Q;Z=U;t("refresh",R,q);ga++}}function o(q,w,E,P,S){var aa;
if(!ac){E=false;aa=ya(ka(q)/Math.LN2);q=la(2,aa)}E?eb(V,q,E,S,function(ua,Pa){q=ua;if(Pa){aa=ya(ka(q)/Math.LN2);q=la(2,aa);P&&P()}c(q)}):c(q);return R}function t(){for(var q=R.trigger.apply(null,arguments).cancel,w=y.length;w--;)q=y[w].trigger.apply(null,arguments).cancel||q;return!q}function A(q,w,E){if(X(q,Xa)){if(!(E&&panSpeed===0)){Q=q|0;U=w|0}}else return new T(Q,U)}a=J({container:"",captureHover:true,drawOnScale:true,padding:0,inertia:true,refreshDistance:256,pannable:false,scalable:false,minZoom:1,
maxZoom:1,renderer:"canvas/dom",zoom:1},a);var y=[],n=0,C=null,z=null,x,D=null,F=!X(window.attachEvent,oa),G=false,L=true,M=false,v=0,H=0,O=a.refreshDistance,Q=0,U=0,I=0,N=0,K=0,Z=0,W=null,Y=null,xa=false,Oa=false,Ea=a.padding,ca=null,Fa=null,Ab=0,V=1,Bb=1,da=null,ab={index:0,draw:false},ac=true,ga=0,Ma,Na,Za,$a,bb,cb,Xb,Yb,Da=a.zoom||a.zoomLevel,Zb=Qa("quad.out"),$b=300,R={id:a.id,padding:Ea,panSpeed:0,attachFrame:function(q,w){w&&C.appendChild(q)},center:function(q,w,E){if(X(q,Ha)){w=kb.parseXY(q).sync(R.rpp);
q=w.x;w=w.y}if(X(q,Xa)){A(q-bb,w-cb,E);return R}else{w=A().offset(bb,cb);R.rpp&&w.sync(R.rpp,true);return w}},detach:function(){renderer&&renderer.trigger("detach");da&&da.unbind();if(z){x.removeChild(z);C=z=null}},layer:m,invalidate:function(){ga++},refresh:r,resetScale:function(){V=1},scale:o,triggerAll:t,removeLayer:function(q){a:{for(var w=n;w--;)if(y[w].id===q){q=w;break a}q=-1}if(q>=0&&q<n){R.trigger("layerRemove",R,y[q]);y.splice(q,1);ga++}n=y.length},getRenderer:function(){return renderer},
getScaleFactor:function(){return V},setMaxOffset:function(q,w,E,P){W=q;Y=w;xa=E;Oa=P},getViewport:u,offset:A,pan:function(q,w){v=q;H=w;ga++},zoom:p};na(R);R.bind("resize",function(){renderer.checkSize()});Ta.init(function(){m("markers","draw",{zindex:20});x=document.getElementById(a.container);x.appendChild(z=fa.create("div","",fa.styles({overflow:"hidden",width:x.offsetWidth+"px",height:x.offsetHeight+"px"})));Ma=z.offsetWidth+Ea*2;Na=z.offsetHeight+Ea*2;Za=Ma/2;$a=Na/2;bb=x.offsetWidth/2;cb=x.offsetHeight/
2;z.appendChild(C=fa.create("div","",fa.styles({width:Ma+"px",height:Na+"px","z-index":2,margin:-Ea+"px 0 0 "+-Ea+"px"})));renderer=Vb(a.renderer,R,C,x,a);L=renderer.fastpan;da&&da.unbind();if(renderer){da=INTERACT.watch(renderer.interactTarget||x);if(a.scalable){da.bind("zoom",b);da.bind("doubleTap",j)}da.bind("pointerDown",e);da.bind("pointerMove",d);da.bind("pointerUp",g);a.captureHover&&da.bind("pointerHover",h);da.bind("tap",f)}F?window.attachEvent("onresize",i):window.addEventListener("resize",
i,false)});Tb.attach(function(q){var w=[],E,P,S;self.panSpeed=panSpeed=pa(v)+pa(H);E=V!==Bb;if(panSpeed>0||E)ga++;if(panSpeed<2&&(pa(Q-K)>=O||pa(U-Z)>=O))r();ab.index++;ab.draw=ga||panSpeed||0;if(renderer&&ab.draw){I+=v;N+=H;if(v||H)R.trigger("pan");if(V!==1&&fa.supportTransforms)w[w.length]="scale("+V+")";if(E=!L||(a.drawOnScale||V===1)&&panSpeed<5){Q=Q-I/V|0;U=U-N/V|0;S=u();renderer.trigger("predraw",S);if(renderer.prepare(y,S,q,ca)){P=N=E=I=ga=0;for(ii=n;ii--;){var aa=y[ii];if(aa.visible){var ua=
aa.style?renderer.applyStyle(aa.style,true):null;aa.draw(renderer,S,R,q,ca);ua&&renderer.applyStyle(ua)}}renderer.trigger("render",S);R.trigger("drawComplete",S,q);Bb=V;fa.move(C,E,P,w)}}else fa.move(C,I,N,w);if(M||!a.inertia)H=v=0;else if(v!=0||H!=0){v*=0.8;H*=0.8;if(pa(v)<0.5)v=0;if(pa(H)<0.5)H=0}if(ca){q=ca?ca.elements:[];if(Fa&&Fa.type==="hover"){w=Hits.diffHits(Fa.elements,q);w.length>0&&Hits.triggerEvent(Fa,R,"Out",w)}if(q.length>0){E=ca.x;P=ca.y;for(w=q.length;w--;){S=q[w];aa=E;ua=P;var Pa=
S&&S.drag&&(!S.canDrag||S.canDrag(S,aa,ua));if(Pa){D=S;D.startX=aa;D.startY=ua}if(Pa)break}Hits.triggerEvent(ca,R)}Fa=q.length>0?J({},ca):null;ca=null}}});return R});ba("view","map",function(a){function b(d,g,i){h.zoom(g);c(d,i)}function c(d,g,i,f){d=new T(d);d.sync(hb(h.zoom()));h.center(d.x,d.y,i,f,function(){g&&g(h)})}a=J({zoomLevel:1,minZoom:1,maxZoom:18,pannable:true,scalable:true},a);var k=new T,j=0,e=a.tapExtent;a.adjustScaleFactor=function(d){return Math.pow(2,(d<1?Math.floor:Math.ceil)(Math.log(d)))};
var h=J(ta("view","simple",a),{getBoundingBox:function(){var d=h.getViewport();return d?new Ca((new T(d.x,d.y2)).sync(j,true).pos(),(new T(d.x2,d.y)).sync(j,true).pos()):null},getCenterPosition:function(){var d=h.getViewport();if(d)return(new T(d.x+(d.w>>1),d.y+(d.h>>1))).sync(j,true).pos();return null},gotoBounds:function(d,g){b(d.center(),d.bestZoomLevel(h.getViewport()),g)},gotoPosition:b,panToPosition:c});h.bind("tap",function(d,g,i,f){d=f.sync(j,true).pos();var s=f.offset(-e,e).sync(j,true).pos();
f=f.offset(e,-e).sync(j,true).pos();h.trigger("geotap",g,i,d,new Ca(s,f))});h.bind("refresh",function(d,g,i){if(k.x!=i.x||k.y!=i.y){h.trigger("boundsChange",h.getBoundingBox());k.x=i.x;k.y=i.y}});h.bind("zoom",function(d,g){var i;j=h.rpp=hb(g);i=ea/j|0;h.setMaxOffset(i,i,true,false);h.resetScale();h.triggerAll("resync")});return h});var va=function(a,b,c){c=J({style:null,xy:null,size:20,fill:false,stroke:true,draggable:false,observable:true,properties:{},typeName:"Shape"},c);J(this,c);if(X(this.xy,
Ha))this.xy=new T(this.xy);this.id="drawable_"+Rb++;this.bounds=null;this.view=a;this.layer=b;this.rotation=this.animations=0;this.scaling=1;this.translateY=this.translateX=0;this.observable&&na(this)};va.prototype={constructor:va,animate:function(a,b,c,k){Fb(this,a,b,c,k)},drag:null,draw:null,getProps:null,resync:function(){if(this.xy){this.xy.sync(this.view.rpp);if(this.size){var a=this.size>>1;this.updateBounds(new ma(this.xy.x-a,this.xy.y-a,this.size,this.size))}}},rotate:function(a){this.rotation=
a},scale:function(a){this.scaling=a},translate:function(a,b){this.translateX=a;this.translateY=b},updateBounds:function(a,b){a&&(!this.bounds||a.x!=this.bounds.x||a.y!=this.bounds.y)&&this.trigger("move",this,a,this.bounds);this.bounds=a;if(b)this.xy=this.bounds.center()}};var fb=1E3/60|0,Ba=[],qb=0;ba(qa,"marker",function(a,b,c){c=J({fill:true,stroke:false,markerStyle:"simple",hoverStyle:"highlight",typeName:"Marker"},c);return new va(a,b,c)});ba(qa,"poly",function(a,b,c){c=J({simplify:false,fill:true,
points:[],typeName:"Poly"},c);var k=c.points,j=c.simplify;va.call(this,c);J(this,{getPoints:function(){return[].concat(k)},resync:function(){var e,h,d,g,i,f,s,l;for(e=k.length;e--;)k[e].sync(a.rpp);l=this.points=j?j(k):k;for(e=l.length;e--;){h=l[e].x;d=l[e].y;f=X(f,oa)||h<f?h:f;s=X(s,oa)||d<s?d:s;g=X(g,oa)||h>g?h:g;i=X(i,oa)||d>i?d:i}this.updateBounds(new ma(f,s,g-f,i-s),true)}});this.haveData=k&&k.length>=2});ba(qa,"line",function(a,b,c){c.fill=false;return ta(qa,"poly",a,b,c)});ba(qa,"image",function(a,
b,c){function k(){if(g&&g.width>0){if(!this.centerOffset)this.centerOffset=new T(-g.width>>1,-g.height>>1);this.updateBounds(new ma(this.xy.x+this.centerOffset.x,this.xy.y+this.centerOffset.y,g.width,g.height),false)}}function j(f){if(this.imageUrl=f){var s=this;Ia(this.imageUrl,function(l,p){g=l;if(p){var u=i.layer?i.layer.view:null;u&&u.invalidate()}k.apply(s)})}}c=J({image:null,imageUrl:null,centerOffset:null,typeName:"Image"},c);var e=va.prototype.resync,h=0,d=0,g=c.image,i=J(new va(a,b,c),{changeImage:j,
getProps:function(){this.bounds||k(this,g);return{image:g,x:this.xy.x+h,y:this.xy.y+d}},resync:function(f){e.call(this,f);k.call(this)}});g||j.call(this,this.imageUrl);if(this.centerOffset){h=this.centerOffset.x;d=this.centerOffset.y}});ba(qa,"arc",function(a,b,c){c=J({startAngle:0,endAngle:Math.PI*2,typeName:"Arc"},c);return new va(a,b,c)});Ja.prototype={constructor:Ja,clip:null,cycle:function(){},draw:function(){},hitGuess:null};ba("layer","tile",function(a,b){b=J({generator:"osm",imageLoadArgs:{}},
b);var c=ta("generator",b.generator,b).run,k=null,j=[],e=J(new Ja(a,b),{draw:function(h,d,g){h.drawTiles&&h.drawTiles(d,k.search(d.buffer(128)),g.panSpeed<2)}});e.bind("refresh",function(h,d,g){var i=(new Date).getTime();k&&c(d,g,k,function(){d.invalidate();$("GEN COMPLETED IN "+((new Date).getTime()-i)+" ms")})});e.bind("resync",function(){var h=a&&a.zoom?a.zoom():0;j[h]||(j[h]=lb(h));k=j[h]});return e});ba("layer","draw",function(a,b){function c(i,f,s,l){var p=this.dragOffset;if(!p)p=this.dragOffset=
new T(i.startX-this.xy.x,i.startY-this.xy.y);this.xy.x=f-p.x;this.xy.y=s-p.y;if(l){delete this.dragOffset;a.invalidate();this.trigger("dragDrop")}return true}function k(i){clearTimeout(d);d=setTimeout(function(){e.sort(function(f,s){if(s.xy&&f.xy){var l=s.xy.y-f.xy.y;return l!=0?l:s.xy.x-f.xy.x}});i&&i.invalidate()},50)}function j(i,f,s,l){l&&h.remove(l,f);h.insert(s,f)}b=J({zindex:10},b);var e=[],h,d=0,g=J(new Ja(a,b),{itemCount:0,clear:function(){h=new mb;e=[];g.itemCount=0},create:function(i,f,
s){i=ta(qa,i,a,g,f);if(s)e.unshift(i);else e[e.length]=i;i.resync();h&&i.bounds&&h.insert(i.bounds,i);k(a);i.bind("move",j);g.itemCount=e.length;return i},draw:function(i,f,s,l,p){s={};l=h&&f?h.search(f):[];for(var u=l.length;u--;){var m=l[u],r=m.style||g.style,o,t=i.applyTransform(m),A=m.getProps?m.getProps(i):s;if(A=(o=i["prep"+m.typeName])?o.call(i,m,f,p,A):null){if(p&&A.hit){p.elements.push(Hits.initHit(m.type,m,m.draggable?c:null));o=p.type+"Style";r=m[o]||g[o]||r}r=r?i.applyStyle(r,true):null;
(o=m.draw||A.draw)&&o.call(m,A);r&&i.applyStyle(r)}t&&t.undo&&t.undo()}},find:function(){return[].concat(e)},hitGuess:function(i,f){return h&&h.search({x:i-10,y:f-10,w:20,h:20}).length>0}});g.bind("resync",function(){h=lb(a.zoom(),h);for(var i=e.length;i--;)e[i].resync()});return g});ia.prototype={constructor:ia,distanceTo:function(){if(!targetPos||this.empty()||targetPos.empty())return 0;var a=(targetPos.lat-this.lat)*ha>>1,b=(targetPos.lon-this.lon)*ha>>1;a=ra(a)*ra(a)+Wa(this.lat*ha)*Wa(targetPos.lat*
ha)*ra(b)*ra(b);return 6371*2*Qb(yb(a),yb(1-a))},equalTo:function(a){return pos&&this.lat===a.lat&&this.lon===a.lon},empty:function(){return this.lat===0&&this.lon===0},inArray:function(a){for(var b=a.length;b--;)if(this.equal(a[b]))return true;return false},offset:function(a,b){var c=this.lat*ha,k=this.lon*ha,j=c+a/6371;c=Pb(ra(b/6371)/Wa(c));k=k+c;j=(j+Aa)%Math.PI-Aa;k%=ea;return new ia(j*Ka,k*Ka)},toPixels:function(){return new T(parseFloat(this.lon)*ha,gb(this.lat))},toString:function(a){return this.lat+
(a||" ")+this.lon}};ba=function(){return{generalize:function(a,b,c){var k=a.length,j=[],e=null;c||(c=250);c/=1E3;$("generalizing positions, must include "+b.length+" positions");for(var h=k;h--;)if(h===0)j.unshift(a[h]);else{var d=!e||a[h].inArray(b)?c:e.distanceTo(a[h]);if(a[h]&&d>=c){j.unshift(a[h]);e=a[h]}}$("generalized "+k+" positions into "+j.length+" positions");return j},parseArray:function(a){var b=a.length,c=Array(b);for(b=b;b--;)c[b]=new ia(a[b]);return c},vectorize:function(a,b){function c(){for(var h=
0,d=b.chunkSize,g=k;g--;){j[g]=new T(a[g]);h+=1;if(h>d)break}k=g;if(k<=0)b.callback&&b.callback(j);else animFrame(c)}var k=a.length,j=Array(k);b=J({chunkSize:500,async:true,callback:null},b);if(!b.async){for(var e=k;e--;)j[e]=new T(a[e]);return j}animFrame(c);return null}}}();Ca.prototype={constructor:Ca,bestZoomLevel:function(a){var b=this.center();b=La(ya(pa(b.lat)*0.05),Va.length);var c=Va[b],k=this.size();b=xb(ka(Va[3]*a.h/k.y)/ka(2));a=xb(ka(c*a.w/k.x)/ka(2));return La(isNaN(b)?1E3:b,isNaN(a)?
1E3:a)},center:function(){var a=this.size();return new ia(this.min.lat+(a.y>>1),this.min.lon+(a.x>>1))},expand:function(a){this.min.lat-=a;this.max.lat+=a;this.min.lon-=a%360;this.max.lon+=a%360},size:function(a){var b=new T(0,this.max.lat-this.min.lat);b.x=(a||isType(a,oa))&&this.min.lon>this.max.lon?360-this.min.lon+this.max.lon:this.max.lon-this.min.lon;return b},toString:function(){return"min: "+this.min+", max: "+this.max}};J(B,{userMessage:function(a,b,c){B.trigger("userMessage",a,b,c)},Registry:Ua,
DOM:fa,Rect:ma,XY:T,Hits:Hits,tweenValue:eb,easing:Qa,Tile:Ra,getImage:Ia,Pos:ia,PosFns:ba,BBox:Ca});B.RouteTools=function(){function a(g){if(j.test(g))return"-slight";return""}function b(g,i){i.geometry&&B.Geo.PosFns.vectorize(i.geometry,{callback:function(f){g.layer("route","draw").create(qa,"line",{points:f,style:"waypoints",simplify:true})}})}function c(g){for(var i="unknown",f=k||h,s=0;s<f.length;s++){f[s].regex.lastIndex=-1;var l=f[s].regex.exec(g);if(l){i=f[s].customCheck?f[s].customCheck(g,
l):f[s].turnType;break}}return i}var k=undefined,j=/bear/i,e=/right/i,h=function(){var g=[];g.push({regex:/continue/i,turnType:"continue"});g.push({regex:/(take|bear|turn)(.*?)left/i,customCheck:function(i,f){return"turn-left"+a(f[1])}});g.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(i,f){return"turn-right"+a(f[1])}});g.push({regex:/enter\s(roundabout|rotary)/i,turnType:"roundabout"});g.push({regex:/take.*?ramp/i,turnType:"ramp"});g.push({regex:/take.*?exit/i,turnType:"ramp-exit"});
g.push({regex:/make(.*?)u\-turn/i,customCheck:function(i,f){return"uturn"+(e.test(f[1])?"-right":"-left")}});g.push({regex:/proceed/i,turnType:"start"});g.push({regex:/arrive/i,turnType:"arrive"});g.push({regex:/fell\sthrough/i,turnType:"merge"});return g}(),d={calculate:function(g){g=J({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},g);var i=B.Registry.create("service","routing");i&&i.calculate(g,function(f){if(g.generalize)f.geometry=B.Geo.PosFns.generalize(f.geometry,
f.getInstructionPositions());if(g.map){b(g.map,f);g.autoFit&&g.map.gotoBounds(f.boundingBox)}g.success&&g.success(f)})},createMapOverlay:b,parseTurnType:c,Instruction:function(g){var i=g=J({position:null,description:"",distance:0,distanceTotal:0,time:0,timeTotal:0,turnType:null},g),f=g.description;f=f.replace(/(\w)(\/)(\w)/g,"$1 $2 $3");i.description=f;if(!g.turnType)g.turnType=c(g.description);return g},RouteData:function(g){g=J({geometry:[],instructions:[],boundingBox:null},g);if(!g.boundingBox)g.boundingBox=
new B.BBox(g.geometry);return J({getInstructionPositions:function(){for(var i=[],f=0;f<g.instructions.length;f++)g.instructions[f].position&&i.push(g.instructions[f].position);return i}},g)}};na(d);return d}();COG=typeof COG!=="undefined"?COG:{};COG.extend=function(){for(var a=arguments[0]||{},b,c=1,k=arguments.length;c<k;c++)if((b=arguments[c])!==null)for(var j in b){var e=b[j];if(a!==e)if(e!==undefined)a[j]=e}return a};(function(){var a=/^P(\d+Y)?(\d+M)?(\d+D)?$/,b=/^(\d+H)?(\d+M)?(\d+S)?$/,c={8601:function(j){j=
j.split("T");var e=null;e=null;var h=0,d=0;a.lastIndex=-1;e=a.exec(j[0]);h+=e[3]?parseInt(e[3].slice(0,-1),10):0;b.lastIndex=-1;e=b.exec(j[1]);d+=e[1]?parseInt(e[1].slice(0,-1),10)*3600:0;d+=e[2]?parseInt(e[2].slice(0,-1),10)*60:0;d+=e[3]?parseInt(e[3].slice(0,-1),10):0;return new k(h,d)}},k=COG.Duration=function(j,e){return{days:j?j:0,seconds:e?e:0}};COG.addDuration=function(){for(var j=new k,e=arguments.length;e--;){j.days+=arguments[e].days;j.seconds+=arguments[e].seconds}if(j.seconds>=86400){j.days+=
~~(j.seconds/86400);j.seconds%=86400}return j};COG.formatDuration=function(j){var e,h,d="";if(j.days)d=j.days+" days ";if(j.seconds){j=j.seconds;if(j>=3600){e=~~(j/3600);j-=e*3600}if(j>=60){h=Math.round(j/60);j-=h*60}if(e)d=d+e+(e>1?" hrs ":" hr ")+(h?(h>10?h:"0"+h)+" min ":"");else if(h)d=d+h+" min";else if(j>0)d=d+(j>10?j:"0"+j)+" sec"}return d};COG.parseDuration=function(j,e){var h=e?c[e]:null;if(h)return h(j);COG.Log.warn("Could not find duration parser for specified format: "+e);return new k}})();
B.Decarta=function(){function a(m){return g(e.clientName,e.clientPassword,e.sessionID,e.configuration,e.release,m)}function b(m,r){return i(m.maxResponses,m.version,m.requestID,m.methodName,r)}function c(m,r){e.server||$("No server configured for deCarta - we are going to have issues","warn");return f(e.server,m.requestID,escape(r))}function k(m,r){wb(c(m,a(b(m,m.getRequestBody()))),function(o){var t=o.response.XLS.Response;if(t.numberOfResponses>0&&t[m.methodName+"Response"]){o=null;if(m.parseResponse)o=
m.parseResponse(t[m.methodName+"Response"]);r&&r(o)}else $("no responses from server: "+o.response,"error")})}function j(m,r){var o=new l({json:m.StreetAddress}),t=new s({countryCode:m.countryCode});t.parse(m.Place);return new B.Geo.Address({streetDetails:o,location:t,country:m.countryCode?m.countryCode:"",postalCode:m.PostalCode?m.PostalCode:"",pos:r})}var e={sessionID:B.ticks(),server:"",clientName:"",clientPassword:"",configuration:"",maxResponses:25,release:"4.4.2sp03",tileFormat:"PNG",fixedGrid:true,
useCache:true,tileHosts:[],requestTimeout:3E4,geocoding:{countryCode:"US",language:"EN"}},h={DEFAULT:function(m){for(var r=["landmark","municipalitySubdivision","municipality","countrySubdivision"],o="",t=0;t<r.length;t++)if(m[r[t]])o+=m[r[t]]+" ";return o}},d=1,g=ja("<xls:XLS version='1' xls:lang='en' xmlns:xls='http://www.opengis.net/xls' rel='{4}' xmlns:gml='http://www.opengis.net/gml'><xls:RequestHeader clientName='{0}' clientPassword='{1}' sessionID='{2}' configuration='{3}' />{5}</xls:XLS>"),
i=ja("<xls:Request maximumResponses='{0}' version='{1}' requestID='{2}' methodName='{3}Request'>{4}</xls:Request>"),f=ja("{0}/JSON?reqID={1}&chunkNo=1&numChunks=1&data={2}&responseFormat=JSON"),s=function(m){m=B.ex({landmark:"",municipality:"",municipalitySubdivision:"",countrySubdivision:"",countryCode:""},m);var r=B.ex({calcMatchPercentage:function(o){var t=0;if(m.landmark&&m.landmarkSubType){if(B.wordExists(o,m.landmarkSubType)){t+=0.4;t+=B.wordExists(o,m.landmark)?0.6:0}}else{t+=B.wordExists(o,
m.municipalitySubdivision)?0.8:0;if(t===0&&m.municipality)t+=B.wordExists(o,m.municipality)?0.7:0}if(m.countrySubdivision)t+=B.wordExists(o,m.countrySubdivision)?0.2:0;return t},getCountryCode:function(){if(m.countryCode)return m.countryCode.toUpperCase();return""},parse:function(o){for(var t=0;o&&t<o.length;t++){var A=o[t].type?o[t].type.slice(0,1).toLowerCase()+o[t].type.slice(1):"";if(typeof m[A]!=="undefined"){m[A]=o[t].content;if(o[t].subType)m[A+"SubType"]=o[t].subType}}B.ex(r,m)},toString:function(){var o=
h[r.getCountryCode()];if(!o)o=h.DEFAULT;return o(m)}},m);return r},l=function(m){m=B.ex({json:{}},m);var r="",o="";if(m.json.Street)r=m.json.Street.content?m.json.Street.content:m.json.Street;r=r&&r.replace?r.replace(/\/\d+$/,""):"";if(m.json.Building)if(m.json.Building.number)o=m.json.Building.number;return{building:o,street:r,calcMatchPercentage:function(t){var A=0,y=B.Geo.A.normalize(t),n=B.Geo.A.normalize(r);if(m.json.Building)if(B.Geo.A.buildingMatch(t,m.json.Building.number.toString()))A+=0.2;
if(y&&n&&B.wordExists(y,n))A+=0.8;return A},toString:function(){if(r)return(o?o+" ":"")+r;return""}}},p=function(){return{methodName:"",maxResponses:25,version:"1.0",requestID:d++,getRequestBody:function(){return""},parseResponse:function(m){return m}}},u=function(){return B.ex(new p,{methodName:"RUOK",parseResponse:function(m){return{aliasCount:m.maxHostAliases,host:m.hostName}}})};B.Registry.register("generator","decarta",function(m){function r(A,y,n,C){if(A=A.zoom?A.zoom():0){var z=2<<A-1,x=z>>
1,D=m.tileSize,F=(y.w/D|0)+1,G=(y.h/D|0)+1,L=(y.x/D|0)-x;y=z-(y.y/D|0)-x-G;var M=n.search({x:(x+L)*D,y:(x+y*-1-G)*D,w:F*D,h:G*D});z={};var v;for(v=M.length;v--;)z[M[v].id]=true;for(M=0;M<=F;M++)for(v=0;v<=G;v++){var H=L+M,O=y+v-1,Q=H+"_"+O;if(!z[Q]){H=new B.Tile((x+L+M)*D,(x+y*-1-v)*D,t[M%t.length]+"/openls/image-cache/TILE?LLMIN=0.0,0.0&LLMAX="+o[A]+"&CACHEABLE=true&DS=navteq-world&WIDTH=256&HEIGHT=256&CLIENTNAME="+e.clientName+"&SESSIONID="+e.sessionID+"&FORMAT=PNG&CONFIG="+e.configuration+"&N="+
O+"&E="+H,D,D,Q);n.insert(H,H)}}C&&C()}}m=B.ex({tileSize:256},m);var o=["89.787438015348100000,360.00000000000000000","85.084059050110410000,180.00000000000000000","66.653475896509040000,90.00000000000000000","41.170427238429790000,45.000000000000000000","22.076741328793200000,22.500000000000000000","11.251819676168665000,11.250000000000000000","5.653589942659626000,5.625000000000000000","2.830287664051185000,2.812500000000000000","1.415581451872543800,1.406250000000000000","0.707845460801532700,0.703125000000000000",
"0.353929573271679340,0.351562500000000000","0.176965641673330230,0.175781250000000000","0.088482927761462040,0.087890625000000000","0.044241477246363230,0.043945312500000000","0.022120740293895182,0.021972656250000000","0.011060370355776452,0.010986328125000000","0.005530185203987857,0.005493164062500000","0.002765092605263539,0.002746582031250000","0.001382546303032519,0.001373291015625000","0.000691272945568983,0.000686645507812500","0.000345636472797214,0.000343322753906250"],t=null;B.userMessage("ack",
"decarta","&copy; deCarta, Inc. Map and Imagery Data &copy; NAVTEQ or Tele Atlas or DigitalGlobe");return{run:function(A,y,n,C){t?r(A,y,n,C):k(new u,function(z){t=[];if(z.aliasCount)for(var x=0;x<z.aliasCount;x++)t[x]="http://"+z.host.replace("^(.*?).(.*)$","\u0001-0"+(x+1)+".\u0002");else t=["http://"+z.host];r(A,y,n,C)})}}});B.Registry.register("service","geocoder",function(){var m=function(o){function t(n){var C=[],z=n?n.numberOfGeocodedAddresses:0,x=[];if(z>1)x=n.GeocodedAddress;else if(z==1)x=
[n.GeocodedAddress];try{for(n=0;x&&n<x.length;n++){var D,F=x[n],G=z=null;if(F&&F.GeocodeMatchCode&&F.GeocodeMatchCode.matchType!=="NO_MATCH"){if(F&&F.Point)G=new B.Pos(F.Point.pos);if(F&&F.Address)z=j(F.Address,G)}(D=z)&&C.push(D)}}catch(L){$(L,"error")}return C}o=B.ex({addresses:[],parserReport:false,parseOnly:false,returnSpatialKeys:false},o);var A=ja('<xls:GeocodeRequest parserReport="{0}" parseOnly="{1}" returnSpatialKeys="{2}">'),y=new p;return B.ex({},y,{methodName:"Geocode",getRequestBody:function(){for(var n=
A(o.parserReport,o.parseOnly,o.returnSpatialKeys),C=0;C<o.addresses.length;C++)n+=o.addresses[C].getXML();return n+"</xls:GeocodeRequest>"},parseResponse:function(n){if(o.addresses.length===1)return[t(n.GeocodeResponseList)];else{for(var C=[],z=0;z<o.addresses.length;z++)C.push(t(n.GeocodeResponseList[z]));return C}}})},r=function(o){o=B.ex({position:null,geocodePreference:"StreetAddress"},o);return B.ex(new p,{methodName:"ReverseGeocode",getRequestBody:function(){return"<xls:ReverseGeocodeRequest><xls:Position><gml:Point><gml:pos>"+
o.position.toString()+"</gml:pos></gml:Point></xls:Position><xls:ReverseGeocodePreference>"+o.geocodePreference+"</xls:ReverseGeocodePreference></xls:ReverseGeocodeRequest>"},parseResponse:function(t){var A=null;if(t&&t.Point)A=new B.Pos(match.Point.pos);if(t&&t.ReverseGeocodedLocation&&t.ReverseGeocodedLocation.Address)return j(t.ReverseGeocodedLocation.Address,A);return null}})};return{forward:function(o){o=B.ex({addresses:[],complete:null},o);var t,A=[];if(o.addresses&&!B.is(o.addresses,"array"))o.addresses=
[o.addresses];for(t=0;t<o.addresses.length;t++)B.is(o.addresses[t],"object")?$("attempting to geocode a simple object - not implemented","warn"):A.push(new types.Address({freeform:o.addresses[t]}));if(A.length>0){A=new m({addresses:A});k(A,function(y){if(o.complete)for(t=0;t<y.length;t++)o.complete(o.addresses[t],y[t])})}},reverse:function(o){o=B.ex({position:null,complete:null},o);if(!o.position)throw Error("Cannot reverse geocode without a position");var t=new r(o);k(t,function(A){o.complete&&o.complete(A)})}}});
B.Registry.register("service","routing",function(){var m=function(r){r=B.ex({waypoints:[],provideRouteHandle:false,distanceUnit:"KM",routeQueryType:"RMAN",routePreference:"Fastest",routeInstructions:true,routeGeometry:true},r);var o=new p,t=ja('<xls:DetermineRouteRequest provideRouteHandle="{0}" distanceUnit="{1}" routeQueryType="{2}">'),A=ja("<xls:{0}><xls:Position><gml:Point><gml:pos>{1}</gml:pos></gml:Point></xls:Position></xls:{0}>");return B.ex({},o,{methodName:"DetermineRoute",getRequestBody:function(){if(r.waypoints.length<
2)throw Error("Cannot send RouteRequest, less than 2 waypoints specified");var y=t(r.provideRouteHandle,r.distanceUnit,r.routeQueryType);y+="<xls:RoutePlan>";y+="<xls:RoutePreference>"+r.routePreference+"</xls:RoutePreference>";y+="<xls:WayPointList>";for(var n=0;n<r.waypoints.length;n++)y+=A(n===0?"StartPoint":n===r.waypoints.length-1?"EndPoint":"ViaPoint",r.waypoints[n].toString());y+="</xls:WayPointList>";y+="</xls:RoutePlan>";if(r.routeInstructions)y+='<xls:RouteInstructionsRequest rules="maneuver-rules" providePoint="true" />';
if(r.routeGeometry)y+="<xls:RouteGeometryRequest />";y+="</xls:DetermineRouteRequest>";return y},parseResponse:function(y){var n=B.RouteTools.RouteData,C=B.Geo.PosFns.parseArray(y.RouteGeometry.LineString.pos),z=y.RouteInstructionsList;y=[];z=z&&z.RouteInstruction?z.RouteInstruction:[];for(var x=0,D=new COG.Duration,F=0;F<z.length;F++){var G;G=z[F].distance;var L={M:1,KM:1E3}[G.uom?G.uom.toUpperCase():"M"];G=G.value&&L?G.value*L:0;L=COG.parseDuration(z[F].duration,"8601");x+=G;D=COG.addDuration(D,
L);y.push(new B.RouteTools.Instruction({position:new B.Pos(z[F].Point),description:z[F].Instruction,distance:G,distanceTotal:x,time:L,timeTotal:D}))}return new n({geometry:C,instructions:y})}})};return{calculate:function(r,o){r=B.ex({waypoints:[]},r);if(typeof B.RouteTools!=="undefined"){var t=new m(r);k(t,function(A){o&&o(A)})}else $("Could not generate route, T5.RouteTools plugin not found","warn")}}});return{applyConfig:function(m){B.ex(e,m)},compareFns:function(){return{streetDetails:function(m,
r){return r.calcMatchPercentage(m)},location:function(m,r){return r.calcMatchPercentage(m)}}}()}}();db.T5=B;db.Tile5=function(a,b){b=J({container:a,type:"map",renderer:"canvas",starpos:null,zoom:1,fastpan:false,drawOnScale:true,zoombar:{}},b);return ta("view",b.type,b)}})(window);
