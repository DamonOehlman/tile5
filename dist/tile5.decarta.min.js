(function(){function Q(o){o=o.split(",");for(var x=[],y=0;y<o.length;y++){var B=o[y].trim().replace(".","/");x[y]=oa[B]}return x}function Ka(o,x){for(var y=o.split(","),B=true,K=typeof $LAB!=="undefined"?$LAB:null,Y=0;Y<y.length;Y++){var ga=y[Y].trim().replace(".","/");if(!oa[ga]){B=false;La&&Ka("./plugins/"+pluginFile)}}if(x)if(La||B)x.apply(Ba,Q(o));else K&&$LAB.wait(function(){x.apply(Ba,Q(o))});return Ba}function Z(o,x,y){if(o&&o.split){var B=o.split(fb);if(B.length>1){o=B[0];x=B[1]}}else if(o&&
o.lat){x=o.lon;o=o.lat}this.lat=parseFloat(o||0);this.lon=parseFloat(x||0);this.radius=y||gb}function Ta(o){this.positions=[];for(var x=o.length;x--;)this.positions[x]=typeof o[x]=="string"?new Z(o[x]):o[x]}function aa(o,x){if(o&&o.splice){for(var y=x,B=new Z(sa,Ga),K=new Z(hb,$),Y=o.length;Y--;){var ga=typeof o[Y]=="string"?new Z(o[Y]):o[Y];if(ga.lat<B.lat)B.lat=ga.lat;if(ga.lat>K.lat)K.lat=ga.lat;if(ga.lon<B.lon)B.lon=ga.lon;if(ga.lon>K.lon)K.lon=ga.lon}this.min=B;this.max=K;if(typeof y=="undefined"){y=
this.size();y=Math.max(y.x,y.y)*0.3}this.min=new Z(B.lat-y,(B.lon-y)%360);this.max=new Z(K.lat+y,(K.lon+y)%360)}else if(o&&o.min){this.min=new Z(o.min);this.max=new Z(o.max)}else{this.min=o;this.max=x}}function va(o){if(typeof o=="string"){var x=(o.replace(/\d|\.|\s/g,"")||"m").toLowerCase();o=parseFloat(o)*({km:1E3}[x]||1)}this.meters=o||0}function na(o,x){if(typeof o=="number"){this.days=o||0;this.seconds=x||0}else if(typeof o!="undefined"){this.days=o.days||0;this.seconds=o.seconds||0}}var oa=
{},Ua=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],La=typeof module!="undefined"&&module.exports,Ca=Math.PI*2,Ha=Math.PI/2,ha=Math.PI/180,wa=180/Math.PI,sa=90,hb=-sa,Ga=180,$=-Ga,$a=sa*ha,W=-$a,Ma=Ga*ha,qb=-Ma,gb=6371,la=gb*1E3,fb=/[\,\s]+/;Z.prototype={constructor:Z,bearing:function(o){var x=this.lat*ha,y=o.lat*ha;o=(o.lon-this.lon)*ha;return(Math.atan2(Math.sin(o)*Math.cos(y),Math.cos(x)*Math.sin(y)-Math.sin(x)*Math.cos(y)*Math.cos(o))*wa+360)%360},
copy:function(){return new Z(this.lat,this.lon)},distanceTo:function(o){if(!o||this.empty()||o.empty())return 0;var x=(o.lat-this.lat)*ha/2,y=(o.lon-this.lon)*ha/2;o=Math.sin(x)*Math.sin(x)+Math.cos(this.lat*ha)*Math.cos(o.lat*ha)*Math.sin(y)*Math.sin(y);return this.radius*2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))},equalTo:function(o){return pos&&this.lat===o.lat&&this.lon===o.lon},empty:function(){return this.lat===0&&this.lon===0},inArray:function(o){if(o)for(var x=o.length;x--;)if(this.equal(o[x]))return true;
return false},offset:function(o,x){var y=this.lat*ha,B=y+o/this.radius;y=this.lon*ha+Math.asin(Math.sin(x/this.radius)/Math.cos(y));B=(B+Ha)%Math.PI-Ha;y%=Ca;return new Z(B*wa,y*wa)},to:function(o,x){if(typeof o=="object")o=this.bearing(o);var y=x/this.radius,B=o*ha,K=this.lat*ha,Y=Math.asin(Math.sin(K)*Math.cos(y)+Math.cos(K)*Math.sin(y)*Math.cos(B));y=this.lon*ha+Math.atan2(Math.sin(B)*Math.sin(y)*Math.cos(K),Math.cos(y)-Math.sin(K)*Math.sin(Y));y=(y+3*Math.PI)%(2*Math.PI)-Math.PI;return new Z(Y*
wa,y*wa)},toBounds:function(o){var x=o.radians(),y=this.lat*ha,B=this.lon*ha;o=y-x;var K=y+x;if(o>W&&K<$a){y=Math.asin(Math.sin(x)/Math.cos(y));x=B-y;if(x<qb)x+=Ca;B=B+y;if(B>Ma)B-=Ca}else{o=Math.max(o,W);K=Math.min(K,$a);x=$;B=Ga}return new aa(new Z(o*wa,x*wa),new Z(K*wa,B*wa))},toString:function(o){return this.lat+(o||" ")+this.lon},valid:function(){return!(isNaN(this.lat)||isNaN(this.lon))}};Ta.prototype={constructor:Ta,distance:function(){for(var o=0,x=[],y,B=this.positions.length-1;B--;){y=this.positions[B].distanceTo(this.positions[B+
1]);o+=x[B]=y}return{total:o,segments:x}},traverse:function(o,x){var y=0,B=0;if(!x||!x.segments)x=this.distance();if(o>x.total)return this.positions[this.positions.length-1];else if(o<=0)return this.positions[0];else{for(;B<x.segments.length;){y+=x.segments[B];if(y>o){y-=x.segments[B];break}B++}if(B<this.positions.length-1){var K=this.positions[B];B=K.bearing(this.positions[B+1]);return K.to(B,o-y)}else return this.positions[B]}}};aa.prototype={constructor:aa,bestZoomLevel:function(o,x){var y=this.center(),
B=Ua[Math.min(Math.round(Math.abs(y.lat)*0.05),Ua.length)],K=this.size();y=Math.ceil(Math.log(Ua[3]*x/K.y)/Math.LN2);B=Math.ceil(Math.log(B*o/K.x)/Math.LN2);return Math.min(isNaN(y)?1E3:y,isNaN(B)?1E3:B)},center:function(){var o=this.size();return new Z(this.min.lat+o.y/2,this.min.lon+o.x/2)},expand:function(o){return new aa(new Z(this.min.lat-o,(this.min.lon-o)%360),new Z(this.max.lat+o,(this.max.lon+o)%360))},size:function(o){var x={x:0,y:this.max.lat-this.min.lat};x.x=typeof o!="undefined"&&o&&
this.min.lon>this.max.lon?360-this.min.lon+this.max.lon:this.max.lon-this.min.lon;return x},toString:function(){return"min: "+this.min+", max: "+this.max},union:function(){for(var o=this.min.copy(),x=this.max.copy(),y=arguments.length;y--;)if(arguments[y]){var B=arguments[y].min,K=arguments[y].max;o.lat=Math.min(o.lat,B.lat);o.lon=Math.min(o.lon,B.lon);x.lat=Math.max(x.lat,K.lat);x.lon=Math.max(x.lon,K.lon)}return new aa(o,x)}};va.prototype={add:function(){for(var o=this.meters,x=arguments.length;x--;){var y=
typeof arguments[x]=="string"?new va(arguments[x]):arguments[x];o+=y.meters}return new va(o)},radians:function(o){if(typeof o!="undefined"){this.meters=o*la;return this}else return this.meters/la},toString:function(){if(this.meters>1E3)return(this.meters/10|0)/100+"km";return this.meters+"m"}};na.prototype={add:function(){for(var o=new na(this.days,this.seconds),x=arguments.length;x--;){o.days+=arguments[x].days;o.seconds+=arguments[x].seconds}return o},toString:function(){var o,x,y,B="";if(this.days)B=
this.days+" days ";if(this.seconds){y=this.seconds;if(y>=3600){o=~~(y/3600);y-=o*3600}if(y>=60){x=Math.round(y/60);y-=x*60}if(o)B=B+o+(o>1?" hrs ":" hr ")+(x?(x>10?x:"0"+x)+" min ":"");else if(x)B=B+x+" min";else if(y>0)B=B+(y>10?y:"0"+y)+" sec"}return B}};var Na=function(){var o=/^P(\d+Y)?(\d+M)?(\d+D)?$/,x=/^(\d+H)?(\d+M)?(\d+S)?$/,y={8601:function(B){B=B.split("T");var K=null;K=null;var Y=0,ga=0;o.lastIndex=-1;K=o.exec(B[0]);Y+=K[3]?parseInt(K[3].slice(0,-1),10):0;x.lastIndex=-1;K=x.exec(B[1]);
ga+=K[1]?parseInt(K[1].slice(0,-1),10)*3600:0;ga+=K[2]?parseInt(K[2].slice(0,-1),10)*60:0;ga+=K[3]?parseInt(K[3].slice(0,-1),10):0;return new na(Y,ga)}};return function(B,K){var Y=y[K];if(!Y)throw"No parser found for the duration format: "+K;return Y(B)}}(),Ba=this.GeoJS={Pos:Z,Line:Ta,BBox:aa,Distance:va,generalize:function(o,x,y){var B=o.length,K=[],Y=null;y=(y||250)/1E3;for(B=B;B--;)if(B===0)K.unshift(o[B]);else{var ga=!Y||o[B].inArray(x)?y:Y.distanceTo(o[B]);if(o[B]&&ga>=y){K.unshift(o[B]);Y=
o[B]}}return K},Duration:na,parseDuration:Na,define:function(o,x){oa[o]=x},require:Ka};if(La)module.exports=Ba})();
(function(){function Q(){var a=arguments[0]||{},c=Array.prototype.slice.call(arguments,1),b=c.length,f,h;for(h=0;h<b;h++)if((f=c[h])!==null)for(var k in f){var e=f[k];if(a!==e)if(e!==undefined)a[k]=e}return a}function Ka(a,c){if(typeof console!=="undefined")console[c||"log"](a)}function Z(a){var c=a.match(ha),b=[],f=0,h;for(h=c?c.length:0;h--;){var k=c[h].slice(1);b[k]||(b[k]=RegExp("\\{"+k+"\\}","g"))}f=b.length;return function(){var e=a;for(h=0;h<f;h++){var l=arguments[h];if(typeof l=="undefined")l=
"";e=e.replace(b[h],l)}return e}}function Ta(a,c){var b=o*Va(a);return fb-2*yb(c*Y((1-b)/(1+b),o/2))}function aa(a,c){if($(a,Wa)){var b=a.split(zb);this.x=parseFloat(b[0]);this.y=parseFloat(b[1])}else if(a&&a.x){this.x=a.x;this.y=a.y}else{this.x=a||0;this.y=c||0}}function va(a){this.allowCull=a;this.points=[]}function na(a,c,b,f){this.mercX=b;this.mercY=f;if($(a,Wa))Q(this,Mb.parseXY(a));else a&&a.toBounds?Q(this,ib(a.lon,a.lat)):aa.call(this,a,c)}function oa(a,c,b,f){this.x=a||0;this.y=c||0;this.w=
b||0;this.h=f||0;this.x2=this.x+this.w;this.y2=this.y+this.h}function Ua(a,c){var b=new Nb(Math.sqrt(256<<a)|0);c&&c.zoomLevel===a&&c.copyInto(b);b.zoomLevel=a;return b}function La(a,c,b,f,h,k){this.x=a;this.y=c;this.w=f||256;this.h=f||256;this.x2=this.x+this.w;this.y2=this.y+this.h;this.url=b;this.id=k||a+"_"+c;this.loaded=false;this.image=null}function Ca(a,c,b,f){f=Q({id:"layer_"+Ob++,zindex:0,animated:false,style:null,minXY:null,maxXY:null,visible:true},f);this.visible=f.visible;this.view=a;sa(Q(this,
f))}function Ha(){sa(this)}var ha=/\{(\d+)(?=\})/g,wa=function(){var a=1.70158,c=Math.PI/2,b=Math.abs,f=Math.pow,h=Math.sin,k=Math.asin,e=Math.cos,l={linear:function(d,j,g,i){return g*d/i+j},backin:function(d,j,g,i){return g*(d/=i)*d*((a+1)*d-a)+j},backout:function(d,j,g,i){return g*((d=d/i-1)*d*((a+1)*d+a)+1)+j},backinout:function(d,j,g,i){return(d/=i/2)<1?g/2*d*d*(((a*=1.525)+1)*d-a)+j:g/2*((d-=2)*d*(((a*=1.525)+1)*d+a)+2)+j},bouncein:function(d,j,g,i){return g-l.bounceout(i-d,0,g,i)+j},bounceout:function(d,
j,g,i){return(d/=i)<1/2.75?g*7.5625*d*d+j:d<2/2.75?g*(7.5625*(d-=1.5/2.75)*d+0.75)+j:d<2.5/2.75?g*(7.5625*(d-=2.25/2.75)*d+0.9375)+j:g*(7.5625*(d-=2.625/2.75)*d+0.984375)+j},bounceinout:function(d,j,g,i){return d<i/2?l.bouncein(d*2,0,g,i)/2+j:l.bounceout(d*2-i,0,g,i)/2+g/2+j},cubicin:function(d,j,g,i){return g*(d/=i)*d*d+j},cubicout:function(d,j,g,i){return g*((d=d/i-1)*d*d+1)+j},cubicinout:function(d,j,g,i){if((d/=i/2)<1)return g/2*d*d*d+j;return g/2*((d-=2)*d*d+2)+j},elasticin:function(d,j,g,i,
n,p){if(d==0)return j;if((d/=i)==1)return j+g;p||(p=i*0.3);if(!n||n<b(g)){n=g;g=p/4}else g=p/la*k(g/n);return-(n*f(2,10*(d-=1))*h((d*i-g)*la/p))+j},elasticout:function(d,j,g,i,n,p){var w;if(d==0)return j;if((d/=i)==1)return j+g;p||(p=i*0.3);if(!n||n<b(g)){n=g;w=p/4}else w=p/la*k(g/n);return n*f(2,-10*d)*h((d*i-w)*la/p)+g+j},elasticinout:function(d,j,g,i,n,p){var w;if(d==0)return j;if((d/=i/2)==2)return j+g;p||(p=i*0.3*1.5);if(!n||n<b(g)){n=g;w=p/4}else w=p/la*k(g/n);if(d<1)return-0.5*n*f(2,10*(d-=
1))*h((d*i-w)*la/p)+j;return n*f(2,-10*(d-=1))*h((d*i-w)*la/p)*0.5+g+j},quadin:function(d,j,g,i){return g*(d/=i)*d+j},quadout:function(d,j,g,i){return-g*(d/=i)*(d-2)+j},quadinout:function(d,j,g,i){if((d/=i/2)<1)return g/2*d*d+j;return-g/2*(--d*(d-2)-1)+j},sinein:function(d,j,g,i){return-g*e(d/i*c)+g+j},sineout:function(d,j,g,i){return g*h(d/i*c)+j},sineinout:function(d,j,g,i){return-g/2*(e(Math.PI*d/i)-1)+j}};return function(d){d=d.replace(/[\-\_\s\.]/g,"").toLowerCase();return l[d]||l.linear}}(),
sa=function(){function a(b,f){var h=b.hasOwnProperty("obsHandlers")?b.obsHandlers:null;h[f]||(h[f]=[]);return h[f]}var c=0;return function(b){if(!b)return null;if(!(b.hasOwnProperty("obsHandlers")?b.obsHandlers:null))b.obsHandlers={};if(!b.hasOwnProperty("bind")){b.bind=function(f,h){var k="callback"+c++;a(b,f).unshift({fn:h,id:k});return k};b.triggerCustom=function(f,h){var k=a(b,f),e={cancel:false,name:f,source:this},l;for(l in h)e[l]=h[l];if(!k)return null;k=k.concat(a(b,"*"));l=Array.prototype.slice.call(arguments,
2);b.eventInterceptor&&b.eventInterceptor(f,e,l);l.unshift(e);for(var d=k.length;d--&&!e.cancel;)k[d].fn.apply(this,l);return e};b.trigger=function(f){var h=Array.prototype.slice.call(arguments,1);h.splice(0,0,f,null);return b.triggerCustom.apply(this,h)};b.unbind=function(f,h){if(typeof f==="undefined")b.obsHandlers={};else for(var k=a(b,f),e=0;k&&e<k.length;e++)if(k[e].id===h){k.splice(e,1);break}return b}}return b}}(),hb=function(){function a(c,b,f,h){if(typeof c[h]=="undefined")c[h]=function(k){if(typeof k!=
"undefined"){b[h]=k;f[h]&&f[h](k);return c}else return b[h]}}return function(c,b,f){b=b||c;for(var h in b)typeof b[h]!="function"&&a(c,b,f,h);return c}}(),Ga=Array.indexOf||function(a){for(var c=0;c<this.length;c++)if(this[c]===a)return c;return-1},$=function(){var a={NaN:1,Infinity:1,"-Infinity":1},c=String.prototype.toLowerCase,b=Object.prototype.toString;return function(f,h){h=c.call(h);if(h=="finite")return!a.hasOwnProperty(+f);return h=="null"&&f===null||h==typeof f||h=="object"&&f===Object(f)||
h=="array"&&Array.isArray&&Array.isArray(f)||b.call(f).slice(8,-1).toLowerCase()==h}}(),$a=function(){function a(k){var e=document.createElement("script"),l=false;e.src=k;e.async=true;e.onload=e.onreadystatechange=function(){if(!l&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){l=true;e.onload=e.onreadystatechange=null;e&&e.parentNode&&e.parentNode.removeChild(e)}};h||(h=document.getElementsByTagName("head")[0]);h.appendChild(e)}function c(k,e,l){k+=k.indexOf("?")>=
0?"&":"?";var d="json"+ ++f;window[d]=function(j){e(j);window[d]=null;try{delete window[d]}catch(g){}};a(k+(l?l:"callback")+"="+d);return d}function b(k,e,l){var d=require("request");k=k+(k.indexOf("?")>=0?"&":"?")+(l?l:"callback")+"=cb";d({uri:k},function(j,g,i){if(j)e({error:j});else{j=i.replace(/^.*\(/,"").replace(/\).*$/,"");e(JSON.parse(j))}})}var f=0,h;return typeof window!="undefined"?c:b}();INTERACT=function(){function a(n){return function(p,w){n.addEventListener(p,w,false)}}function c(n){return function(p,
w){n.removeEventListener(p,w,false)}}function b(n){return function(p,w){n.attachEvent("on"+p,w)}}function f(n,p){return{x:n?n:0,y:p?p:0,count:1}}function h(n,p){g.push(Q({handler:null,checks:{},type:n},p))}function k(n){var p=0,w=0;if(n.offsetParent){do{p+=n.offsetLeft;w+=n.offsetTop;n=n.offsetParent}while(n)}return{left:p,top:w}}function e(n,p){return{source:n,target:p.target?p.target:p.srcElement}}function l(n,p){for(var w=n.target?n.target:n.srcElement;w&&w!==p;)w=w.parentNode;return w&&w===p}
function d(n,p){return{x:n.x-(p?p.left:0),y:n.y-(p?p.top:0)}}function j(n,p){if(n.preventDefault){n.preventDefault();n.stopPropagation()}else if(typeof n.cancelBubble!="undefined")n.cancelBubble=true;p&&n.stopImmediatePropagation&&n.stopImmediatePropagation()}var g=[],i=function(n,p,w){w=Q({binder:null,unbinder:null,observable:null},w);for(var A=w.observable,G=[],O,u,E={bind:function(){return A.bind.apply(null,arguments)},unbind:function(){A.unbind();for(z=0;z<G.length;z++)G[z].unbind();return E}},
z=0;z<p.length;z++)G.push(p[z](n,A,w));A.bind("pointerDown",function(){u=O=0});A.bind("pointerMove",function(m,t,r,q){O+=q.x||0;u+=q.y||0});A.bind("pointerUp",function(m,t,r){Math.max(Math.abs(O),Math.abs(u))<=20&&A.triggerCustom("tap",m,t,r)});return E};h("pointer",{handler:function(n,p,w){function A(I){if(I.pageX&&I.pageY)return f(I.pageX,I.pageY);else{var L=document.documentElement,S=document.body;return f(I.clientX+(L&&L.scrollLeft||S&&S.scrollLeft||0)-(L&&L.clientLeft||S&&S.clientLeft||0),I.clientY+
(L&&L.scrollTop||S&&S.scrollTop||0)-(L&&L.clientTop||S&&S.clientTop||0))}}function G(I){if(l(I,n))if(F=z(I)){var L=A(I);n.style.cursor="move";j(I,true);R=L.x;V=L.y;D=f(R,V);p.triggerCustom("pointerDown",e("mouse",I),D,d(D,k(n)))}}function O(I){var L=A(I);J=L.x;T=L.y;if(l(I,n))t(I,F?"pointerMove":"pointerHover")}function u(I){if(F&&z(I)){F=false;if(l(I,n)){n.style.cursor="default";t(I,"pointerUp")}}}function E(I){if(l(I,n)){var L;I=I||window.event;if(I.detail){if(typeof I.axis=="undefined"||I.axis===
2)L=-I.detail*r}else{L=I.wheelDeltaY?I.wheelDeltaY:I.wheelDelta;if(window.opera)L=-L}if(L){var S=f(J,T);p.triggerCustom("zoom",e("mouse",I),S,d(S,k(n)),L/q,"wheel");j(I);I.returnValue=false}}}function z(I){I=I||window.event;return(I.which||I.button)==1}function m(I){return!l(I,n)}function t(I,L,S,ea,H){S=typeof S!="undefined"?S:J;ea=typeof ea!="undefined"?ea:T;var N=S-R,P=ea-V,ba=f(S,ea);p.triggerCustom(L,e("mouse",I),ba,d(ba,k(n)),f(N,P));if(typeof H=="undefined"||H){R=S;V=ea}}w=Q({},w);var r=120,
q=r*8,F=false,D,J,T,R,V;w.binder("mousedown",G);w.binder("mousemove",O);w.binder("mouseup",u);w.binder("dblclick",function(I){if(l(I,n)){var L=A(I);p.triggerCustom("doubleTap",e("mouse",I),L,d(L,k(n)))}});w.binder("selectstart",m);w.binder("dragstart",m);w.binder("mousewheel",E);w.binder("DOMMouseScroll",E);return{unbind:function(){w.unbinder("mousedown",G);w.unbinder("mousemove",O);w.unbinder("mouseup",u);w.unbinder("mousewheel",E);w.unbinder("DOMMouseScroll",E)}}},checks:{touch:false}});h("pointer",
{handler:function(n,p,w){function A(H){if(H.count<2)return 0;var N=H.x-H.next.x;H=H.y-H.next.y;return~~Math.sqrt(N*N+H*H)}function G(H,N,P){N=N?N:0;P=P?P:0;for(var ba={x:H.x-N,y:H.y-P,id:H.id,count:H.count},pa=ba;H.next;){H=H.next;pa=pa.next={x:H.x-N,y:H.y-P,id:H.id}}return ba}function O(H,N){var P=H[N?N:"touches"],ba,pa;if(P.length===0)return null;pa=ba={x:P[0].pageX,y:P[0].pageY,id:P[0].identifier,count:P.length};for(var ka=1,xa=P.length;ka<xa;ka++)pa=pa.next={x:P[ka].pageX,y:P[ka].pageY,id:P[ka].identifier};
return ba}function u(H){if(l(H,n)){J=k(n);var N=O(H,"changedTouches"),P=G(N,J.left,J.top);if(!R){T=q;p.triggerCustom("pointerDown",e("touch",H),N,P)}S&&p.triggerCustom("pointerDownMulti",e("touch",H),N,P);R=O(H);if(R.count>1)I=A(R);ea=1;L=G(R)}}function E(H){if(l(H,n)){j(H);V=O(H);if(T==q)T=Math.abs(R.x-V.x)>t||Math.abs(R.y-V.y)>t?r:q;if(T!=q){T=V.count>1?D:F;if(T==D)if(R.count===1){R=G(V);I=A(R)}else{var N=A(V);if(Math.abs(I-N)<m)T=F;else{var P;P=V.x;var ba=V.next.x,pa=V.y,ka=V.next.y;P={x:(P<ba?
P:ba)+(Math.abs(P-ba)>>1),y:(pa<ka?pa:ka)+(Math.abs(pa-ka)>>1)};N=N/I;ba=N-ea;p.triggerCustom("zoom",e("touch",H),P,d(P,J),ba,"pinch");ea=N}}T==F&&p.triggerCustom("pointerMove",e("touch",H),V,G(V,J.left,J.top),f(V.x-L.x,V.y-L.y));S&&p.triggerCustom("pointerMoveMulti",e("touch",H),V,G(V,J.left,J.top))}L=G(V)}}function z(H){if(l(H,n)){var N=O(H,"changedTouches"),P=G(N,J.left,J.top);V=O(H);if(!V){p.triggerCustom("pointerUp",e("touch",H),N,P);R=null}S&&p.triggerCustom("pointerUpMulti",e("touch",H),N,
P)}}w=Q({detailed:false,inertia:false},w);var m=20,t=7,r=0,q=1,F=2,D=3,J,T,R,V,I,L,S=w.detailed,ea=1;w.binder("touchstart",u);w.binder("touchmove",E);w.binder("touchend",z);return{unbind:function(){w.unbinder("touchstart",u);w.unbinder("touchmove",E);w.unbinder("touchend",z)}}},checks:{touch:true}});return{register:h,watch:function(n,p,w){p=Q({bindTarget:null,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},p);capabilities=Q({touch:"ontouchstart"in window},w);if(!p.observable){p.observable=
sa({});globalOpts=p}p.binder=(p.isIE?b:a)(p.bindTarget||document);p.unbinder=(p.isIE?b:c)(p.bindTarget||document);w=p.types;for(var A=capabilities,G=[],O=g.length;O--;){var u=g[O],E=!w||w.indexOf(u.type)>=0,z=true,m;for(m in u.checks){var t=u.checks[m];z=z&&t===A[m]}if(E&&z)G[G.length]=u.handler}return new i(n,G,p)}}}();var W=this.T5=sa({}),Ma=function(){var a={};return{create:function(c,b){if(a[c][b])return a[c][b].apply(null,Array.prototype.slice.call(arguments,2));throw gb(c,b);},get:function(c,
b){return a[c]?a[c][b]:null},register:function(c,b,f){a[c]||(a[c]={});a[c][b]&&Ka(qb(c,b),"warn");a[c][b]=f}}}(),qb=Z("Registration of {0}: {1} will override existing definition"),gb=Z("Could not create {0} of type: {1}");Z("Could not create drawable of type: {0}");var la=Math.PI*2,fb=Math.PI/2,Na=Math.PI/180,Ba=180/Math.PI,o=0.08181919084262157,x=Math.abs,y=Math.round,B=Math.min,K=Math.max,Y=Math.pow,ga=Math.sqrt,rb=Math.log,Va=Math.sin,jb=Math.cos,yb=Math.atan,Oa="undefined",Wa="string",Ia="number",
ya=Ma.register,Xa=Ma.create,Pb=Ma.get,Qb=0,Ob=0,zb=/[\,\s]+/,Pa=function(){function a(e){h++;e=X?window.mozAnimationStartTime||e||(new Date).getTime():(new Date).getTime();for(var l=f.length;l--;){var d=f[l];h%d.every===0&&d.cb(e)}k&&animFrame(a)}var c=1E3/60,b=["r","webkitR","mozR","oR","msR"],f=[],h=0,k=X&&function(){for(var e=0;e<b.length;e++)window.animFrame=window.animFrame||window[b[e]+"equestAnimationFrame"];return animFrame}();k?animFrame(a):setInterval(a,1E3/60);return{attach:function(e,
l){f[f.length]={cb:e,every:l?y(l/c):1}},detach:function(e){for(var l=f.length;l--;)if(f[l].cb===e){f.splice(l,1);break}}}}(),Mb=function(){var a=/^xy\((.*)\).*$/i;return{parseXY:function(c){if(!a.test(c)){c=c.split(zb);return ib(c[1],c[0])}}}}(),X=typeof window!="undefined"?function(){function a(h){for(var k=0;k<h.length;k++){var e=h[k];if(typeof document.body.style[e]!="undefined")return e}}var c={"-webkit-user-select":"none",position:"absolute"},b,f;b=a(["-webkit-transform","MozTransform"]);css3DTransformProp=
a(["WebkitPerspective","MozPerspective"]);f=a(["-webkit-transform-origin","MozTransformOrigin"]);return{transforms:$(b,Wa),create:function(h,k,e){h=document.createElement(h);var l=[];e=e||{};h.className=k||"";for(var d in e)l[l.length]=d+": "+e[d];h.style.cssText=l.join(";");return h},move:function(h,k,e,l,d){if(b){h.style[b]="translate("+k+"px, "+e+"px) "+(l||[]).join(" ");if(d&&f)h.style[f]=d.x+"px "+d.y+"px"}else{h.style.left=k+"px";h.style.top=e+"px"}},rect:function(h){return new oa(h.offsetLeft,
h.offsetTop,h.offsetWidth,h.offsetHeight)},styles:function(h){return Q({},c,h)}}}():null,Ab=function(){function a(){for(var h=f.length,k=h;k--;)try{f[k](h)}catch(e){Ka(e.toString(),"error")}}var c=20,b=50,f=[];return{process:function(h,k,e,l){function d(i){i=(j||b)/i;if(g<h.length){var n=h.slice(g,g+i);i=n.length;var p=j?0:(new Date).getTime();k(n,i);if(!j)j=(n=((new Date).getTime()-p)/i)?c/n|0:h.length;g+=i}else{for(i=f.length;i--;)if(f[i]===d){f.splice(i,1);break}f.length===0&&Pa.detach(a);e&&e()}}
var j,g=0;if(X&&h.length>(l||0))f.push(d)===1&&Pa.attach(a);else{k(h,h.length);e&&e()}}}}(),ib=ib||function(a,c){var b=parseFloat(c)*Na;b=Va(b);var f=o*b;b=rb((1+b)/(1-b)*Y((1-f)/(1+f),o))/2;return new na(0,0,parseFloat(a)*Na,b)},sb=sb||function(a,c){for(var b=Y(Math.E,-c),f=fb-2*yb(b),h=Ta(f,b),k=0;k<12&&x(f-h)>1.0E-7;){f=h;h=Ta(f,b);k++}return new GeoJS.Pos(h*Ba,a%360*Ba)};aa.prototype={constructor:aa,add:function(){for(var a=this.x,c=this.y,b=arguments.length;b--;){a+=arguments[b].x;c+=arguments[b].y}return this.copy(a,
c)},copy:function(a,c){var b=Q({},this);b.x=a||b.x;b.y=c||b.y;return b},equals:function(a){return this.x===a.x&&this.y===a.y},offset:function(a,c){return this.copy(this.x+a,this.y+c)},relative:function(a){a=a.viewport();return this.copy(this.x-a.x-a.padding.x,this.y-a.y-a.padding.y)},rotate:function(a,c){c=c||new aa(0,0);var b=this.x-c.x,f=this.y-c.y;return new aa(c.x+jb(a)*b+-Va(a)*f,c.y+Va(a)*b+jb(a)*f)},scale:function(a,c){c=c||new aa(0,0);return new aa(c.x+(this.x-c.x)*a,c.y+(this.y-c.y)*a)},
sync:function(){return this},toString:function(){return this.x+", "+this.y}};va.prototype=Q([],{cull:function(a){if(this.allowCull){var c=a.x,b=a.y,f=a.x+a.w;a=a.y+a.h;for(var h=Infinity,k=0,e=this.points,l,d=e.length;d--;)if(l=e[d].x>=c&&e[d].x<=f&&e[d].y>=b&&e[d].y<=a){h=d<h?d:h;k=d>k?d:k}return e.slice(K(h-1,0),B(k+1,e.length))}return this.points},simplify:function(a){a=a||3;for(var c=new va(this.allowCull),b=this.points,f=null,h=b.length;h--;){var k=b[h];if(include=!f||h===0||x(k.x-f.x)+x(k.y-
f.y)>a){c.points.unshift(k);f=k}}return c}});na.prototype=Q(new aa,{constructor:na,pos:function(){return sb(this.mercX,this.mercY)},sync:function(a,c){var b;if(!(b=a.rpp)){b=a.zoom();b=la/(256<<b)}b=b;if(c){this.mercX=this.x*b-Math.PI;this.mercY=Math.PI-this.y*b}else{this.x=y(((this.mercX||0)+Math.PI)/b);this.y=y((Math.PI-(this.mercY||0))/b)}return this}});oa.prototype={constructor:oa,buffer:function(a,c){return new oa(this.x-a,this.y-(c||a),this.w+a*2,this.h+(c||a)*2)},center:function(){return new aa(this.x+
(this.w>>1),this.y+(this.h>>1))}};Hits=function(){return{diffHits:function(a,c){var b=[],f={},h;for(h=c.length;h--;)f[c[h].target.id]=true;for(h=a.length;h--;)f[a[h].target.id]||(b[b.length]=a[h]);return b},init:function(a,c,b,f,h){return{type:a,x:h.x,y:h.y,gridX:f.x|0,gridY:f.y|0,elements:[],absXY:c,relXY:b}},initHit:function(a,c,b){return{type:a,target:c,drag:b}},match:function(a,c,b){return c===a.type&&b.x===a.absXY.x&&b.y===a.absXY.y},triggerEvent:function(a,c,b,f){c.triggerCustom(a.type+(b?b:
"Hit"),{hitType:a.type},f?f:a.elements,a.absXY,a.relXY,new na(a.gridX,a.gridY))}}}();var Nb=function(a){function c(k,e){var l=b[k],d;l||(l=b[k]=[]);(d=l[e])||(d=l[e]=[]);return d}a=a||128;var b=[],f={},h=0;return{all:function(){var k=[],e;for(e in f)k[k.length]=f[e];return k},clear:function(){b=[];f={}},copyInto:function(k){for(var e in f){var l=f[e];k.insert(l.bounds||l,l,e)}},insert:function(k,e,l){var d=k.x/a|0,j=k.y/a|0,g=(k.x+k.w)/a|0;k=(k.y+k.h)/a|0;l=l||e.id||"obj_"+h++;f[l]=e;for(e=d;e<=g;e++)for(d=
j;d<=k;d++)c(e,d).push(l)},remove:function(k,e,l){l=l||e.id;if(f[l]){var d=k.x/a|0;e=k.y/a|0;var j=(k.x+k.w)/a|0;k=(k.y+k.h)/a|0;delete f[l];for(d=d;d<=j;d++)for(var g=e;g<=k;g++){var i=c(d,g),n=Ga.call(i,l);n>=0&&i.splice(n,1)}}},search:function(k){var e=k.y/a|0,l=(k.x+k.w)/a|0,d=(k.y+k.h)/a|0,j=[],g=[];for(k=k.x/a|0;k<=l;k++)for(var i=e;i<=d;i++)j=j.concat(c(k,i));j.sort();for(e=j.length;e--;){l=j[e];if(d=f[l])g[g.length]=d;for(;e>0&&j[e-1]==l;)e--}return g}}},kb=function(){var a={},c=0;(new Date).getTime();
var b={},f=[];Pa.attach(function(h){h=h||(new Date).getTime();for(var k=0;k<f.length;){var e=f[k],l=b[e],d=b[e].image&&b[e].image.complete&&b[e].image.width>0,j=h-l.start;j=d||j>=3E4;if(d){d=l.callbacks;a[e]=l.image;for(var g=0;g<d.length;g++)d[g](l.image,true)}if(j){f.splice(k,1);delete b[e]}else k++}},250);return function(h,k){var e=h&&k?a[h]:null;if(e&&e&&e.complete&&e.width>0)k(e);else if(e=b[h])e.callbacks.push(k);else{e=new Image;e.id="_ldimg"+ ++c;b[h]={start:(new Date).getTime(),image:e,callbacks:[k]};
e.src=h;f[f.length]=h}}}();La.prototype={constructor:La,load:function(a){var c=this;kb(this.url,function(b){c.loaded=true;c.image=b;a&&a()})}};var Rb=function(){return sa({fastpan:true,applyStyle:function(){},applyTransform:function(a,c,b){return{restore:null,x:c,y:b}},getDimensions:function(){return{width:0,height:0}},getViewport:function(){},hitTest:function(){return false},projectXY:null,reset:function(){}})};ya("renderer","canvas",function(a,c,b,f,h){function k(){function m(q,F){this.save();this.setTransform(1,
0,0,1,0,0);var D=this.isPointInPath_old(q,F);this.restore();return D}var t=CanvasRenderingContext2D.prototype,r=document.createElement("canvas").getContext("2d");r.translate(50,0);r.moveTo(125,50);r.arc(100,50,25,0,360,false);if(!r.isPointInPath(150,50)){t.isPointInPath_old=t.isPointInPath;t.isPointInPath=m}}function e(m,t,r){var q,F;w[t]=function(D){for(q=E.length;q--;)if(F=r[E[q]])D[z[q]]=F}}function l(m,t,r){return{draw:r||u,viewport:m,hit:t&&i.isPointInPath(t.x,t.y),vpX:n,vpY:p,context:i}}function d(m,
t,r,q,F){if(!g.full){if(m.bounds){m=m;q=m.bounds;t=m.xy;r=q.w*m.scaling*1.2|0;q=q.h*m.scaling*1.2|0;m=t.x-n-(r>>1);t=t.y-p-(q>>1)}r=m+r;q=t+q;g.x=m<g.x?m:g.x;g.y=t<g.y?t:g.y;g.x2=r>g.x2?r:g.x2;g.y2=q>g.y2?q:g.y2;g.w=g.x2-g.x;g.h=g.y2-g.y}g.full=g.full||F}f=Q({},f);var j,g=new W.Rect,i,n=0,p=0,w={},A=null,G={},O=function(){},u=function(){this.fill&&i.fill();this.stroke&&i.stroke()},E=["fill","stroke","lineWidth","opacity"],z=["fillStyle","strokeStyle","lineWidth","globalAlpha"];X&&k();if(c){b=c.offsetWidth;
f=c.offsetHeight;j=X?X.create("canvas",null,{position:"absolute","z-index":1}):new Canvas;j.width=b;j.height=f;a.attachFrame(j,true);i=null}h=Q(h,{applyStyle:function(m){var t=w[m],r=i&&i.canvas?i.canvas.id:"default",q;G[r]||(G[r]=[]);q=G[r].pop()||"reset";if(t){G[r].push(m);t(i);return q}},applyTransform:function(m){if(m.translateX!==0||m.translateY!==0||m.scaling!==1||m.rotation!==0){i.save();A={undo:function(){i.restore();A=null},x:m.xy.x,y:m.xy.y};i.translate(m.xy.x-n+m.translateX,m.xy.y-p+m.translateY);
m.rotation!==0&&i.rotate(m.rotation);m.scaling!==1&&i.scale(m.scaling,m.scaling)}return A},drawTiles:function(m,t,r){d(0,0,m.w,m.h,true);for(var q=t.length;q--;){m=t[q];if(!m.loaded&&r)m.load(a.invalidate);else m.image&&i.drawImage(m.image,m.x-n,m.y-p)}},prepArc:function(m,t,r){i.beginPath();d(m);i.arc(m.xy.x-(A?A.x:n),m.xy.y-(A?A.y:p),m.size>>1,m.startAngle,m.endAngle,false);return l(t,r)},prepImage:function(m,t,r,q){var F=(q.x||m.xy.x)-(A?A.x:n),D=(q.y||m.xy.y)-(A?A.y:p),J=q.image||m.image;if(J){i.beginPath();
i.rect(F,D,q.width||J.width,q.height||J.height);return l(t,r,function(){i.drawImage(J,F,D,q.width||J.width,q.height||J.height)})}},prepMarker:function(m,t,r){var q=m.xy.x-(A?A.x:n),F=m.xy.y-(A?A.y:p),D=m.size,J=q-(D>>1),T=F-(D>>1),R=undefined;i.beginPath();d(m);switch(m.markerType.toLowerCase()){case "image":R=O;i.rect(J,T,D,D);if(m.reset&&m.image){m.image=null;m.reset=false}m.image?i.drawImage(m.image,J,T,D,D):kb(m.imageUrl,function(V){m.image=V;i.drawImage(m.image,J,T,D,D)});break;default:i.moveTo(q,
F);i.lineTo(q-(D>>1),F-D);i.lineTo(q+(D>>1),F-D);i.lineTo(q,F)}return l(t,r,R)},prepPoly:function(m,t,r,q){var F=true;q=q.points||m.line().cull(t);var D=A?A.x:n,J=A?A.y:p;i.beginPath();d(m);for(m=q.length;m--;){var T=q[m].x-D,R=q[m].y-J;if(F){i.moveTo(T,R);F=false}else i.lineTo(T,R)}return l(t,r)},getCanvas:function(){return j},getContext:function(){return i}});(function(){Bb.each(function(m,t){e(null,m,t)});W.bind("styleDefined",e)})();h.bind("predraw",function(m,t,r){if(i)i.restore();else if(j)i=
j.getContext("2d");n=r.x;p=r.y;if(i){i.clearRect(g.x,g.y,g.w,g.h);g=new W.Rect;i.save();i.globalCompositeOperation="source-over"}});h.bind("detach",function(){c.removeChild(j)});h.bind("resize",function(){});return h});ya("renderer","dom",function(a,c,b,f,h){function k(g){var i=g.image=new Image;d[g.id]=g;i.onload=function(){if(j[g.id])l.appendChild(this);else g.image=null};i.src=g.url;i.style.cssText="-webkit-user-select: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute;";
return i}function e(g,i,n){var p=[],w;for(w in g){var A=g[w];if(n?A[n]:!i[w]){if(A.image&&A.image.parentNode){A.image.src="";l.removeChild(A.image);A.image=null}p[p.length]=w}}for(i=p.length;i--;)delete g[p[i]]}var l=null,d={},j={};l=X.create("div","t5-tiles",X.styles({width:c.offsetWidth+"px",height:c.offsetHeight+"px"}));c.childNodes.length>0?c.insertBefore(l,c.childNodes[0]):c.appendChild(l);a.attachFrame(l);b=Q(h,{drawTiles:function(g,i,n){for(var p,w=g.x,A=g.y,G=i.length;G--;){g=i[G];if(g.url){(p=
g.image||(n?k(g):null))&&X.move(p,g.x-w,g.y-A);j[g.id]=g}}}});b.bind("predraw",function(){e(d,j);j={}});b.bind("detach",function(){c.removeChild(l)});a.bind("reset",function(){for(e(d,j={});l.childNodes.length>0;)l.removeChild(l.childNodes[0])});return b});var Bb=function(){function a(b,f){if($(b,Wa)){W.trigger("styleDefined",b,c[b]=f);return b}else{var h=[],k;for(k in b)h[h.length]=a(k,b[k]);return h}}var c={};a({reset:{fill:"#ffffff",opacity:1},highlight:{fill:"#ff0000"},waypoints:{lineWidth:4,
stroke:"#003377",fill:"#ffffff"},waypointsHover:{lineWidth:4,stroke:"#ff0000",fill:"#ffffff"}});return{resetStyle:"reset",each:function(b){for(var f in c)b(f,c[f])},get:function(b){return c[b]},define:a}}(),Lb=function(a,c){function b(s,v,C,M){Ja&&Ja(true);s=T?K(ca+Y(2,M)-1,0.125):M>0?2:0.5;r(s,false,true)}function f(s,v){var C=fa&&fa.projectXY?fa.projectXY(s,v):null;if(!C){C=z();C=new U.XY(C?C.x+(s+C.padding.x)/ca:s,C?C.y+(v+C.padding.y)/ca:v)}return C.sync(U,true)}function h(s,v,C){s=f(C.x,C.y);
clearTimeout(tb);U.trigger("doubleTap",v,C,s);if(c.scalable){v=U.center();q(ia+s.x-v.x,ja+s.y-v.y,T?Cb:null);r(2,Cb,true)}}function k(s,v,C){P=null;ka=true;O("down",v,C)}function e(s,v,C){O("hover",v,C)}function l(s,v,C,M){p(v,C,false);if(!P){xa+=M.x;Da+=M.y}}function d(s,v,C){p(v,C,true);ka=false}function j(){clearTimeout(Db);Db=setTimeout(function(){if(N)if(N.offsetWidth!==ab*2||N.offsetHeight!==bb*2){var s=E();A(a);E(s.x,s.y)}},250)}function g(s,v,C){O("tap",v,C);tb=setTimeout(function(){U.trigger("tap",
v,C,f(C.x,C.y,true))},20)}function i(){ta&&ta.unbind();if(X&&fa){ta=INTERACT.watch(fa.interactTarget||N);if(c.scalable){ta.bind("zoom",b);ta.bind("doubleTap",h)}ta.bind("pointerDown",k);ta.bind("pointerMove",l);ta.bind("pointerUp",d);c.captureHover&&ta.bind("pointerHover",e);ta.bind("tap",g)}}function n(s){if(fa){fa.trigger("detach");fa=null}var v=U,C=ea,M=N,da=c;s=s.split("/");for(var qa=new Rb(v,C,M,da),ra=0;ra<s.length;ra++)qa=Xa("renderer",s[ra],v,C,M,da,qa);fa=qa;pa=X&&fa.fastpan&&X.transforms;
T=X&&X.transforms&&c.useTransforms;i();U.trigger("changeRenderer",fa);U.trigger("reset");t()}function p(s,v,C){if(P){s=f(v.x,v.y);P.drag.call(P.target,P,s.x,s.y,C)&&ma++;if(C)P=null}}function w(s){for(var v=S;v--;)if(L[v].id===s)return v;return S}function A(s){if(X){N=document.getElementById(s);s=X.rect(N);H&&N.removeChild(H);N.appendChild(H=X.create("div","t5-panframe",X.styles({overflow:"hidden",width:s.w+"px",height:s.h+"px"})));var v=c.padding;if(v===J){v=N.offsetWidth;var C=N.offsetHeight,M=
ga(v*v+C*C);ua=new aa(M-v>>1,M-C>>1)}else ua=new aa(v,v);lb=H.offsetWidth+ua.x*2;mb=H.offsetHeight+ua.y*2;ub=lb/2;vb=mb/2;ab=s.w/2;bb=s.h/2;cb=new aa(ub,vb);H.appendChild(ea=X.create("div","t5-view",X.styles({width:lb+"px",height:mb+"px","z-index":2,margin:-ua.y+"px 0 0 "+-ua.x+"px"})));n(c.renderer);s=c.controls;for(v=0;v<V.length;v++)V[v].trigger("detach");V=[];for(v=0;v<s.length;v++)V[V.length]=Xa("control",s[v],U,H,N,c[s[v]])}else n("canvas")}function G(s){var v=[],C,M,da;if(!R){U.panSpeed=panSpeed=
x(xa)+x(Da);(C=ca!==wb)&&U.trigger("scale");if(panSpeed>0||C||Ea||Ja||db){ma++;if(Ea&&panSpeed>0){Ea(true);Ea=null}}if(!ka&&panSpeed<=F&&(x(ia-Eb)>=Fb||x(ja-Gb)>=Fb))t();xb.index++;xb.draw=ma||panSpeed||Sb||Tb;if(fa&&xb.draw){if(Ja)ca=Ja()[0];if(db)Aa=db()[0];Qa+=xa;Ra+=Da;if(xa||Da)U.trigger("pan");if(T){if(ca!==1)v[v.length]="scale("+ca+")";if(Aa!==0)v[v.length]="rotate("+Aa+"deg)"}C=ba||!pa||!ka&&!(Ea&&Hb)&&!(Ja&&Hb)&&(c.drawOnScale||ca===1)&&panSpeed<=D;if(Ea){M=Ea();da=1;if(nb)da=ca/nb;Qa=(ia-
M[0]|0)*da;Ra=(ja-M[1]|0)*da}if(C){M=-Aa*Na;C=jb(M)*Qa+-Va(M)*Ra;M=Va(M)*Qa+jb(M)*Ra;ia=ia-C/ca|0;ja=ja-M/ca|0;da=z();fa.trigger("predraw",L,da,s,za);M=Ra=C=Qa=ma=0;for(ii=S;ii--;){var qa=L[ii];if(qa.visible){var ra=qa.style?fa.applyStyle(qa.style,true):null;qa.draw(fa,da,U,s,za[0]);ra&&fa.applyStyle(ra)}}fa.trigger("render",da);U.trigger("drawComplete",da,s);X.move(ea,C,M,v,cb)}else X.move(ea,Qa,Ra,v,cb);if(ka||!c.inertia)Da=xa=0;else if(xa!=0||Da!=0){xa*=0.8;Da*=0.8;if(x(xa)<0.5)xa=0;if(x(Da)<0.5)Da=
0}if(za.length){for(ii=0;ii<za.length;ii++){s=za[ii];v=true;C=s?s.elements:[];M=void 0;if(s&&eb&&s.type==="hover"&&eb.type==="hover"){diffElements=Hits.diffHits(eb.elements,C);if(diffElements.length>0)Hits.triggerEvent(eb,U,"Out",diffElements);else v=false}if(C.length>0){da=s.gridX;qa=s.gridY;for(M=C.length;ka&&M--;){ra=C[M];var Ib=da,Jb=qa,Kb=ra&&ra.drag&&(!ra.canDrag||ra.canDrag(ra,Ib,Jb));if(Kb){P=ra;P.startX=Ib;P.startY=Jb}if(Kb)break}if(v){Hits.triggerEvent(s,U);s.type==="tap"&&clearTimeout(tb)}}eb=
C.length>0?Q({},s):null}za=[]}if(wb!==ca){U.trigger("scaleChanged",ca);wb=ca}}}}function O(s,v,C){var M=(new aa(C.x-ab+ub,C.y-bb+vb)).rotate(-Aa*Na,cb).scale(1/ca,cb);if(za.length===0||!Hits.match(za[za.length-1],s,v)){za[za.length]=s=Hits.init(s,v,C,f(C.x,C.y,true),M);ba=false;for(v=S;v--;)if(L[v].visible)ba=ba||(L[v].hitGuess?L[v].hitGuess(s.gridX,s.gridY,U):false);ba&&ma++}}function u(s){I=I?I+" "+s:s;U.trigger("copyright",I)}function E(s,v,C){if(typeof s!="undefined"&&($(s,Wa)||$(s,"object"))){v=
new U.XY(s);v.sync(U);s=v.x;v=v.y}if($(s,Ia)){q(s-ab-ua.x,v-bb-ua.y,C);return U}else return q().offset(ab+ua.x|0,bb+ua.y|0).sync(U,true)}function z(){var s=new oa(ia,ja,lb,mb);s.scaleFactor=ca;s.padding=ua?ua.copy():new aa;return s}function m(s,v,C){var M=typeof s!="undefined";if(M&&$(v,Oa))for(v=0;v<S;v++){if(L[v].id===s)return L[v]}else if(M){v=Xa("layer",v,U,H,N,C);C=w(s);C!==S&&U.trigger("layerRemove",L[C]);v.added=(new Date).getTime();v.id=s;L[C]=v;L.sort(function(da,qa){return qa.zindex-da.zindex||
qa.added-da.added});S=L.length;U.trigger("resync");t();U.trigger("layerChange",U,v);ma++;return v}else return[].concat(L)}function t(){var s=z();if(s){if(Ya||Za)if(s){var v=ob?ia+(s.w>>1):ia,C=pb?ja+(s.h>>1):ja,M=s.w,da=s.h;if(Ya&&Ya>M)if(v+M>Ya)ia=ob?ia:Ya-M;else if(v<0)ia=ob?ia:0;if(Za&&Za>da)if(C+da>Za)ja=pb?ja:Za-da;else if(C<0)ja=pb?ja:0}Eb=ia;Gb=ja;U.trigger("refresh",U,s);ma++}}function r(s,v,C){if($(s,Ia)){var M=C?s:ca*s;if(!T){v=undefined;s=y(rb(M)/Math.LN2);M=Y(2,s)}if(v){nb=ca;Ja=Fa.tween([ca],
[M],v,function(){ca=M;nb=Ja=null;ma++})}else{ca=M;ma++}return U}else return ca}function q(s,v,C){if($(s,Ia)){if(C)Ea=Fa.tween([ia,ja],[s,v],C,function(){ia=s|0;ja=v|0;Qa=Ra=0;Ea=null;ma++});else{ia=s|0;ja=v|0;ma++}return U}else return(new U.XY(ia,ja)).sync(U,true)}c=Q({captureHover:true,controls:[],copyright:"",drawOnScale:true,padding:128,inertia:true,refreshDistance:128,noDrawOnTween:true,pannable:true,scalable:true,renderer:"canvas",useTransforms:true},c);var F=0,D=2,J="auto",T=true,R=false,V=
[],I="",L=[],S=0,ea=null,H=null,N,P=null,ba=false,pa,ka=false,xa=0,Da=0,Sb=0,Tb=0,Fb=c.refreshDistance,Hb=c.noDrawOnTween,ia=0,ja=0,Qa=0,Ra=0,Eb=0,Gb=0,Ya=null,Za=null,ob=false,pb=false,Ea=null,ua,za=[],eb=null,fa,Db=0,cb=new aa,Aa=0,db=null,ca=1,nb,Ja=null,wb=1,ta=null,xb={index:0,draw:false},Cb={easing:"sine.out",duration:500},ma=0,lb,mb,ub,vb,ab,bb,tb,U={XY:aa,id:c.id,panSpeed:0,addCopy:u,attachFrame:function(s,v){v&&ea.appendChild(s)},center:E,detach:function(){Pa.detach(G);fa&&fa.trigger("detach");
ta&&ta.unbind();if(H){N.removeChild(H);ea=H=null}},frozen:function(s){if($(s,Oa))return R;else{R=s;return U}},getCopy:function(){return I},getRenderer:function(){return fa},layer:m,invalidate:function(){ma++},pan:function(s,v,C){return q(ia+s,ja+v,C)},refresh:t,rotate:function(s,v,C){if($(s,Ia)){var M=C?s:Aa+s;if(v)db=Fa.tween([Aa],[M],v,function(){Aa=M%360;db=null;ma++});else{Aa=M%360;ma++}return U}else return Aa},scale:r,setMaxOffset:function(s,v,C,M){Ya=s;Za=v;ob=C;pb=M},offset:q,viewport:z};sa(U);
U.bind("resize",j);U.bind("layerRemove",function(s,v){var C=Ga(L,v.id);if(C>=0&&C<S){L.splice(C,1);ma++}S=L.length});hb(U,c,{container:A,captureHover:i,scalable:i,pannable:i,renderer:n});m("markers","draw",{zindex:20});A(a);if(X&&!$(window.attachEvent,Oa))window.attachEvent("onresize",j);else X&&window.addEventListener("resize",j,false);c.copyright&&u(c.copyright);Pa.attach(G);return U},Fa=function(){return{tween:function(a,c,b,f,h){function k(w){var A=w-p;w=p+n<=w;for(var G=e;G--;)l[G]=j(A,a[G],
g[G],n);h&&h.invalidate();if(w||i){Pa.detach(k);for(G=0;G<d.length;G++)d[G]&&d[G](l,A,i)}}b=Q({easing:"sine.out",duration:1E3,complete:null},b);var e=a.length,l=[].concat(a),d=[f,b.complete],j=wa(b.easing),g=[],i=false,n=b.duration,p=(new Date).getTime();for(b=e;b--;)g[b]=c[b]-a[b];Pa.attach(k);return function(w){i=w;return l}},tweenDrawable:function(a,c,b,f,h){var k=Fa.tween([b],[f],h,function(){a[c]=f;for(var l=a.tweens.length;l--;)if(a.tweens[l]===e){a.tweens.splice(l,1);break}},a.view),e=function(){a[c]=
k()[0]};return e}}}(),Sa=function(a,c,b){b=Q({style:null,xy:null,size:20,fill:false,stroke:true,draggable:false,properties:{},typeName:"Shape",zindex:0},b);Q(this,b);if($(this.xy,Wa))this.xy=new a.XY(this.xy);this.id="drawable_"+Qb++;this.bounds=null;this.view=a;this.layer=c;this.tweens=[];this.rotation=this.animations=0;this.scaling=1;this.translateY=this.translateX=0;this.visible=true;sa(this)};Sa.prototype={constructor:Sa,applyTweens:function(){for(var a=this.tweens.length;a--;)this.tweens[a]()},
drag:null,draw:null,getProps:null,resync:function(){if(this.xy){this.xy.sync(this.view);if(this.size){var a=this.size>>1;this.updateBounds(new oa(this.xy.x-a,this.xy.y-a,this.size,this.size))}}return this},rotate:function(a,c,b){if($(a,Ia)){a=(b?a:this.rotation*Ba+a)*Na;if(c)this.tweens.push(Fa.tweenDrawable(this,"rotation",this.rotation,a,c));else{this.rotation=a;this.view.invalidate()}return this}else return this.rotation*Ba},scale:function(a,c,b){if($(a,Ia)){a=b?a:this.scaling*a;if(c)this.tweens.push(Fa.tweenDrawable(this,
"scaling",this.scaling,a,c));else{this.scaling=a;this.view.invalidate()}return this}else return this.scaling},translate:function(a,c,b,f){if($(a,Ia)){a=f?a:this.translateX+a;c=f?c:this.translateY+c;if(b){this.tweens.push(Fa.tweenDrawable(this,"translateX",this.translateX,a,b));this.tweens.push(Fa.tweenDrawable(this,"translateY",this.translateY,c,b))}else{this.translateX=a;this.translateY=c;this.view.invalidate()}return this}else return new aa(this.translateX,this.translateY)},updateBounds:function(a,
c){a&&(!this.bounds||a.x!=this.bounds.x||a.y!=this.bounds.y)&&this.trigger("move",this,a,this.bounds);this.bounds=a;if(c)this.xy=this.bounds.center()}};ya("drawable","marker",function(a,c,b){b=Q({fill:true,stroke:false,markerType:"simple",hoverStyle:"highlight",typeName:"Marker"},b);return new Sa(a,c,b)});ya("drawable","poly",function(a,c,b){function f(){var g,i,n,p,w,A,G,O;d=b.simplify?l.simplify():l;O=d.points;for(g=O.length;g--;){i=O[g].x;n=O[g].y;A=$(A,Oa)||i<A?i:A;G=$(G,Oa)||n<G?n:G;p=$(p,Oa)||
i>p?i:p;w=$(w,Oa)||n>w?n:w}j.updateBounds(new oa(A,G,p-A,w-G),true);j.trigger("pointsUpdate",j,O);a.invalidate()}function h(g){if($(g,"array")){var i;l=new va(b.allowCull);i=l.points;Ab.process(g,function(n,p){for(var w=0;w<p;w++)i.push(new a.XY(n[w]))},k,e);return j}else return d}function k(){l.points.length&&Ab.process(l.points,function(g,i){for(var n=i;n--;)g[n].sync(a)},f,e)}b=Q({allowCull:false,simplify:false,fill:true,points:[],typeName:"Poly"},b);var e=500,l=new va(b.allowCull),d=new va(b.allowCull),
j=Q(new Sa(a,c,b),{line:h,resync:k});h(b.points);return j});ya("drawable","line",function(a,c,b){b.fill=false;b.allowCull=true;return Xa("drawable","poly",a,c,b)});ya("drawable","image",function(a,c,b){function f(){if(d&&d.width>0){if(!this.centerOffset)this.centerOffset=new aa(-d.width>>1,-d.height>>1);this.updateBounds(new oa(this.xy.x+this.centerOffset.x,this.xy.y+this.centerOffset.y,d.width,d.height),false)}}function h(g){if(this.imageUrl=g){var i=this;kb(this.imageUrl,function(n,p){d=n;if(p){var w=
j.layer?j.layer.view:null;w&&w.invalidate()}f.apply(i)})}}b=Q({image:null,imageUrl:null,centerOffset:null,typeName:"Image"},b);var k=Sa.prototype.resync,e=0,l=0,d=b.image,j=Q(new Sa(a,c,b),{changeImage:h,getProps:function(){this.bounds||f(this,d);return{image:d,x:this.xy.x+e,y:this.xy.y+l}},resync:function(g){k.call(this,g);f.call(this)}});d||h.call(this,this.imageUrl);if(this.centerOffset){e=this.centerOffset.x;l=this.centerOffset.y}return j});ya("drawable","arc",function(a,c,b){b=Q({startAngle:0,
endAngle:Math.PI*2,typeName:"Arc"},b);return new Sa(a,c,b)});Ca.prototype={constructor:Ca,clip:null,cycle:function(){},draw:function(){},hitGuess:null,remove:function(){this.view.trigger("layerRemove",this)}};ya("layer","tile",function(a,c,b,f){f=Q({generator:"osm",imageLoadArgs:{}},f);var h=Xa("generator",f.generator,a,f).run,k=null,e=[];c=Q(new Ca(a,c,b,f),{draw:function(l,d,j){l.drawTiles&&l.drawTiles(d,k.search(d.buffer(128)),j.panSpeed<2)}});a.bind("resync",function(){var l=a&&a.zoom?a.zoom():
0;e[l]||(e[l]=Ua(l));k=e[l]});a.bind("refresh",function(){k&&h(k,a.invalidate)});a.bind("reset",function(){k.clear()});return c});ya("layer","draw",function(a,c,b,f){function h(j,g,i,n){var p=this.dragOffset;if(!p)p=this.dragOffset=new a.XY(j.startX-this.xy.x,j.startY-this.xy.y);this.xy.x=g-p.x;this.xy.y=i-p.y;if(n){delete this.dragOffset;a.invalidate();this.xy.sync(a,true);this.trigger("dragDrop")}return true}function k(j,g,i,n){if(e){n&&e.remove(n,g);e.insert(i,g)}}f=Q({zindex:10},f);var e,l,d=
Q(new Ca(a,c,b,f),{clear:function(){if(e){e.clear();d.trigger("cleared");a.invalidate()}},create:function(j,g){var i=Xa("drawable",j,a,d,g);i.resync();e&&i.bounds&&e.insert(i.bounds,i);i.bind("move",k);i.trigger("created");d.trigger(j+"Added",i);return i},draw:function(j,g,i,n,p){i={};n=e&&g?e.search(g):[];for(var w=n.length;w--;){var A=n[w],G=A.style||d.style,O,u,E=A.getProps?A.getProps(j):i;O=j["prep"+A.typeName];A.tweens.length>0&&A.applyTweens();u=j.applyTransform(A);if(E=A.visible&&O?O.call(j,
A,g,p,E):null){if(p&&E.hit){p.elements.push(Hits.initHit(A.type,A,A.draggable?h:null));O=p.type+"Style";G=A[O]||d[O]||G}G=G?j.applyStyle(G,true):null;(O=A.draw||E.draw)&&O.call(A,E);G&&j.applyStyle(G)}u&&u.undo&&u.undo()}},find:function(){return e.all()},hitGuess:function(j,g){return e&&e.search({x:j-5,y:g-5,w:10,h:10}).length>0}});l=a.bind("resync",function(){var j=e?e.all():[];e=Ua(a.zoom(),e);for(var g=j.length;g--;)j[g].resync()});a.bind("layerRemove",function(j,g){if(g===d){e=null;a.unbind("resync",
l)}});return d});Ha.prototype={constructor:Ha};ya("control","zoombar",function(a,c,b,f){function h(r,q){var F=E[r]=X.create("div","t5-zoombar-button",{position:"absolute",background:k(r),"z-index":51,width:f.width+"px",height:f.buttonHeight+"px","margin-top":(q||0)+"px"});z.appendChild(F)}function k(r,q){return"url("+f.images+") 0 -"+(i+p*3+(r||0)*j*3+(q||0)*j)+"px"}function e(r){return"url("+f.images+") 0 -"+(i+(r||0)*p)+"px"}function l(r,q){var F;if(r===n){n.style.background=e(q);F="thumb"}else for(var D=
0;D<E.length;D++)if(r===E[D]){F="button"+D;E[D].style.background=k(D,q);break}return F}function d(r){if(r!==O){O=r;G=A-O/u*(A-w)|0;X.move(n,0,G-w);clearTimeout(m);m=setTimeout(function(){a.zoom(O)},500)}}f=Q({width:24,height:200,images:"img/zoom.png",align:"right",marginTop:10,spacing:10,thumbHeight:16,buttonHeight:16},f);var j=f.buttonHeight,g,i=f.height,n,p=f.thumbHeight,w=f.spacing+j-(p>>1),A=f.height-j-(p>>1),G=w,O=-1;c=a.minZoom();var u=a.maxZoom()-c+1,E=[],z,m=0,t={button0:function(){a.zoom(a.zoom()+
1)},button1:function(){a.zoom(a.zoom()-1)}};z=X.create("div","t5-zoombar",{position:"absolute",background:"url("+f.images+")","z-index":50,overflow:"hidden",width:f.width+"px",height:f.height+"px",margin:function(){var r=f.spacing,q=Z("{0}px 0 0 {1}px");if(f.align==="right")r=b.offsetWidth-f.width-f.spacing;return q(f.marginTop,r)}()});b.childNodes[0]?b.insertBefore(z,b.childNodes[0]):b.appendChild(z);z.appendChild(n=X.create("div","t5-zoombar-thumb",{position:"absolute",background:e(),"z-index":51,
width:f.width+"px",height:f.thumbHeight+"px",margin:"10px 0 0 0",top:G-w+"px"}));h(0);h(1,f.height-f.buttonHeight);g=INTERACT.watch(z,{bindTarget:z});g.bind("pointerMove",function(r,q,F){G=Math.min(Math.max(w,F.y-(p>>1)),A);d(u-(G-w)/A*u|0)});g.bind("pointerDown",function(r){l(r.target,2)});g.bind("pointerUp",function(r){l(r.target,0)});g.bind("tap",function(r){(r=t[l(r.target,2)])&&r()});c=new Ha(a);c.bind("detach",function(){g.unbind();b.removeChild(z)});a.bind("zoom",function(r,q){d(q)});d(a.zoom());
return c});ya("control","copyright",function(a,c,b,f){function h(){k(a.getCopy())}function k(l){if(e){e.innerHTML=l;l=e.style;var d;a.viewport();d=X.rect(b);var j=f.spacing,g=d.h-e.offsetHeight-f.spacing,i=Z("{0}px 0 0 {1}px");if(f.align==="right")j=d.w-e.offsetWidth-f.spacing;d=i(g,j);l.margin=d}}f=Q({align:"right",text:null,spacing:5},f);var e;(function(){var l=X.rect(b),d=f.text||a.getCopy();e=X.create("div","t5-copyright",{position:"absolute",overflow:"hidden","max-width":Math.max(l.w>>1,Math.min(400,
l.w-f.spacing*2))+"px","z-index":49});b.childNodes[0]?b.insertBefore(e,b.childNodes[0]):b.appendChild(e);d&&k(d)})();c=Q(new Ha(a),{getText:function(){return e?e.innerHTML:""},setText:k});c.bind("detach",function(){e&&b.removeChild(e)});f.text||a.bind("copyright",h);return c});Q(W,{ex:Q,log:Ka,observable:sa,configurable:hb,formatter:Z,wordExists:function(a,c){for(var b=a.split(/\s|\,/).length;b--;)if(a.toLowerCase()==c.toLowerCase())return true;return false},is:$,indexOf:Ga,fn:function(a){return Pb("fn",
a)},project:ib,unproject:sb,getImage:kb,Registry:Ma,Style:Bb,DOM:X,Rect:oa,XY:aa,GeoXY:na,Line:va,Hits:Hits,Control:Ha,Tile:La,Tweener:Fa,ViewLayer:Ca,View:Lb,Map:function(a,c){function b(g,i){var n=j.viewport();if(g){n=K(g.bestZoomLevel(n.w,n.h)-1,i||0);return f(n).center(g.center())}else return new GeoJS.BBox((new na(n.x,n.y2)).sync(j,true).pos(),(new na(n.x2,n.y)).sync(j,true).pos())}function f(g,i,n){if($(g,Ia)){g=K(c.minZoom,B(c.maxZoom,g|0));if(g!==e){var p=j.viewport(),w=j.offset(),A=p.w/2;
p=p.h/2;var G=Y(2,g-e),O=A/G|0,u=p/G|0;e=g;j.offset(((i||w.x+A)-O)*G,((n||w.y+p)-u)*G);j.trigger("zoom",g);j.trigger("reset");k=j.rpp=la/(256<<e);j.setMaxOffset(la/k|0,la/k|0,true,false);j.scale(1+l,false,true);l=0;j.trigger("resync");j.refresh()}return j}else return e}c=Q({controls:["zoombar","copyright"],minZoom:1,maxZoom:18,renderer:"canvas/dom",zoom:1,zoombar:{}},c);var h=new na,k,e=c.zoom||c.zoomLevel,l=0,d=0,j=Q(new Lb(a,c),{XY:na,bounds:b,zoom:f});k=j.rpp=la/(256<<e);j.bind("refresh",function(){var g=
j.viewport();if(h.x!=g.x||h.y!=g.y){j.trigger("boundsChange",b());h.x=g.x;h.y=g.y}});j.bind("scaleChanged",function(g,i){var n=rb(i)/Math.LN2|0;if(n!==0){l=i-Y(2,n);clearTimeout(d);d=setTimeout(function(){f(e+n)},500)}});return j}});if(typeof module!="undefined"&&module.exports)module.exports=W;W.Decarta=function(){function a(u){return n(e.clientName,e.clientPassword,e.sessionID,e.configuration,e.release,u)}function c(u,E){return p(u.maxResponses,u.version,u.requestID,u.methodName,E)}function b(u,
E){e.server||W.log("No server configured for deCarta - we are going to have issues","warn");return w(e.server,u.requestID,escape(E))}function f(u,E,z){Ka("making request: "+a(c(u,u.getRequestBody())));$a(b(u,a(c(u,u.getRequestBody()))),function(m){console.log(m.response);var t=m.response.XLS.Response;if(t.numberOfResponses>0&&t[u.methodName+"Response"]){m=[];if(u.parseResponse)m=u.parseResponse(t[u.methodName+"Response"]);E&&E.apply(null,m)}else z&&z("Server returned no responses",m.response)})}function h(u,
E){var z=new A({json:u.StreetAddress}),m=[];if(u.Place){if(!u.Place.length)u.Place=[u.Place];for(var t=u.Place.length;t--;)m[m.length]=u.Place[t].content}return{building:z.building,street:z.street,regions:m,countryCode:u.countryCode||"",postalCode:u.PostalCode||"",pos:E}}function k(u){if(!u)return"";u=u.toUpperCase();if(!j){var E=[],z;for(z in g)E.push(z);j=RegExp("(\\s)("+E.join("|")+")(\\s|$)","i")}j.lastIndex=-1;if(E=j.exec(u))u=u.replace(j,"$1"+g[E[2]]);return u}var e={sessionID:(new Date).getTime(),
server:"",clientName:"",clientPassword:"",configuration:"",maxResponses:25,release:"4.4.2sp03",tileFormat:"PNG",fixedGrid:true,useCache:true,tileHosts:[],requestTimeout:3E4,geocoding:{countryCode:"US",language:"EN"}};TL=function(){function u(z,m){if(typeof z=="number"){this.days=z||0;this.seconds=m||0}else if(typeof z!="undefined"){this.days=z.days||0;this.seconds=z.seconds||0}}u.prototype={add:function(){for(var z=new u(this.days,this.seconds),m=arguments.length;m--;){z.days+=arguments[m].days;z.seconds+=
arguments[m].seconds}return z},toString:function(){var z,m,t,r="";if(this.days)r=this.days+" days ";if(this.seconds){t=this.seconds;if(t>=3600){z=~~(t/3600);t-=z*3600}if(t>=60){m=Math.round(t/60);t-=m*60}if(z)r=r+z+(z>1?" hrs ":" hr ")+(m?(m>10?m:"0"+m)+" min ":"");else if(m)r=r+m+" min";else if(t>0)r=r+(t>10?t:"0"+t)+" sec"}return r}};var E=function(){var z=/^P(\d+Y)?(\d+M)?(\d+D)?$/,m=/^(\d+H)?(\d+M)?(\d+S)?$/,t={8601:function(r){r=r.split("T");var q=null;q=null;var F=0,D=0;z.lastIndex=-1;q=z.exec(r[0]);
F+=q[3]?parseInt(q[3].slice(0,-1),10):0;m.lastIndex=-1;q=m.exec(r[1]);D+=q[1]?parseInt(q[1].slice(0,-1),10)*3600:0;D+=q[2]?parseInt(q[2].slice(0,-1),10)*60:0;D+=q[3]?parseInt(q[3].slice(0,-1),10):0;return new u(F,D)}};return function(r,q){var F=t[q];if(!F)throw"No parser found for the duration format: "+q;return F(r)}}();return{Duration:u,parse:E}}();var l=/^(\d+).*$/,d=/(\d+)\s?\-\s?(\d+)/,j=null,g={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",HWY:"HIGHWAY",MWY:"MOTORWAY"},
i=1,n=Z("<xls:XLS version='1' xls:lang='en' xmlns:xls='http://www.opengis.net/xls' rel='{4}' xmlns:gml='http://www.opengis.net/gml'><xls:RequestHeader clientName='{0}' clientPassword='{1}' sessionID='{2}' configuration='{3}' />{5}</xls:XLS>"),p=Z("<xls:Request maximumResponses='{0}' version='{1}' requestID='{2}' methodName='{3}Request'>{4}</xls:Request>"),w=Z("{0}/JSON?reqID={1}&chunkNo=1&numChunks=1&data={2}&responseFormat=JSON"),A=function(u){u=W.ex({json:{}},u);var E="",z="";if(u.json.Street)E=
u.json.Street.content?u.json.Street.content:u.json.Street;E=E&&E.replace?E.replace(/\/\d+$/,""):"";if(u.json.Building)if(u.json.Building.number)z=u.json.Building.number;return{building:z,street:E,calcMatchPercentage:function(m){var t=0,r=k(m),q=k(E);if(u.json.Building){a:{var F=u.json.Building.number.toString();l.lastIndex=-1;if(l.test(m)){m=m.replace(l,"$1");F=F.split(",");for(var D=0;D<F.length;D++){d.lastIndex=-1;if(d.test(F[D])){var J=d.exec(F[D]);if(m>=parseInt(J[1],10)&&m<=parseInt(J[2],10)){m=
true;break a}}else if(m==F[D]){m=true;break a}}}m=false}if(m)t+=0.2}if(r&&q&&W.wordExists(r,q))t+=0.8;return t},toString:function(){if(E)return(z?z+" ":"")+E;return""}}},G=function(){return{methodName:"",maxResponses:25,version:"1.0",requestID:i++,getRequestBody:function(){return""},parseResponse:function(u){return[u]}}},O=function(){return W.ex(new G,{methodName:"RUOK",parseResponse:function(u){return[{aliasCount:u.maxHostAliases,host:u.hostName}]}})};W.Registry.register("generator","decarta",function(u,
E){function z(r,q){var F=u.zoom?u.zoom():0,D=u.viewport();if(F){var J=2<<F-1,T=J>>1,R=E.tileSize,V=(D.w/R|0)+1,I=(D.h/R|0)+1,L=(D.x/R|0)-T;D=J-(D.y/R|0)-T-I;var S=r.search({x:(T+L)*R,y:(T+D*-1-I)*R,w:V*R,h:I*R});J={};var ea=t.hosts,H;for(H=S.length;H--;)J[S[H].id]=true;for(S=0;S<=V;S++)for(H=0;H<=I;H++){var N=L+S,P=D+H-1,ba=N+"_"+P;if(!J[ba]){N=new W.Tile((T+L+S)*R,(T+D*-1-H)*R,ea[S%ea.length]+"/openls/image-cache/TILE?LLMIN=0.0,0.0&LLMAX="+m[F]+"&CACHEABLE=true&DS=navteq-world&WIDTH=256&HEIGHT=256&CLIENTNAME="+
t.clientName+"&SESSIONID="+t.sessionID+"&FORMAT=PNG&CONFIG="+t.configuration+"&N="+P+"&E="+N,R,R,ba);r.insert(N,N)}}q&&q()}}E=W.ex({tileSize:256},E);var m=["89.787438015348100000,360.00000000000000000","85.084059050110410000,180.00000000000000000","66.653475896509040000,90.00000000000000000","41.170427238429790000,45.000000000000000000","22.076741328793200000,22.500000000000000000","11.251819676168665000,11.250000000000000000","5.653589942659626000,5.625000000000000000","2.830287664051185000,2.812500000000000000",
"1.415581451872543800,1.406250000000000000","0.707845460801532700,0.703125000000000000","0.353929573271679340,0.351562500000000000","0.176965641673330230,0.175781250000000000","0.088482927761462040,0.087890625000000000","0.044241477246363230,0.043945312500000000","0.022120740293895182,0.021972656250000000","0.011060370355776452,0.010986328125000000","0.005530185203987857,0.005493164062500000","0.002765092605263539,0.002746582031250000","0.001382546303032519,0.001373291015625000","0.000691272945568983,0.000686645507812500",
"0.000345636472797214,0.000343322753906250"],t=e.tileConfig;u.addCopy("&copy; deCarta, Inc. Map and Imagery Data &copy; NAVTEQ or Tele Atlas or DigitalGlobe");return{run:function(r,q){if(t)z(r,q);else{var F=e.clientName.replace(/.*?\:/,"");W.Decarta.getTileConfig(F,function(D){t=D;z(r,q)})}},setTileConfig:function(r){t=r}}});W.Registry.register("service","geocoder",function(){var u=W.formatter('<xls:GeocodeRequest><xls:Address countryCode="{0}" language="{1}">{2}</xls:Address></xls:GeocodeRequest>'),
E=W.formatter('<xls:StreetAddress><xls:Building number="{0}" /><xls:Street>{1}</xls:Street></xls:StreetAddress>'),z=function(t,r){r=W.ex({countryCode:e.geocoding.countryCode,language:e.geocoding.language},r);var q=new G;return W.ex({},q,{methodName:"Geocode",getRequestBody:function(){var F=E(t.number,t.street);F+='<xls:Place type="Municipality">'+t.regions.join(" ")+"</xls:Place>";return u(r.countryCode,r.language,F)},parseResponse:function(F){var D=F.GeocodeResponseList;F=[];var J=D?D.numberOfGeocodedAddresses:
0,T=[];if(J>1)T=D.GeocodedAddress;else if(J==1)T=[D.GeocodedAddress];for(D=0;T&&D<T.length;D++){J=T[D];var R=null,V=null;if(J&&J.GeocodeMatchCode&&J.GeocodeMatchCode.matchType!=="NO_MATCH"){if(J&&J.Point)V=new GeoJS.Pos(J.Point.pos);if(J&&J.Address)R=h(J.Address,V)}(J=R)&&F.push(J)}return[F]}})},m=function(t){t=W.ex({position:null,geocodePreference:"StreetAddress"},t);return W.ex(new G,{methodName:"ReverseGeocode",getRequestBody:function(){return"<xls:ReverseGeocodeRequest><xls:Position><gml:Point><gml:pos>"+
t.position.toString()+"</gml:pos></gml:Point></xls:Position><xls:ReverseGeocodePreference>"+t.geocodePreference+"</xls:ReverseGeocodePreference></xls:ReverseGeocodeRequest>"},parseResponse:function(r){var q=null;if(r&&r.Point)q=new GeoJS.Pos(match.Point.pos);if(r&&r.ReverseGeocodedLocation&&r.ReverseGeocodedLocation.Address)return[h(r.ReverseGeocodedLocation.Address,q)];return[]}})};typeof ADDR==="undefined"&&W.log("Sidelab addressing module not found, geocoder will not function","warn");return{forward:function(t,
r){f(new z(t),function(q){r(t,q)})},reverse:function(t,r){var q=new m({position:t});f(q,function(F){r&&r(F)})}}});W.Registry.register("service","routing",function(){var u=function(E,z){z=W.ex({provideRouteHandle:false,distanceUnit:"KM",routeQueryType:"RMAN",preference:"Fastest",routeInstructions:true,routeGeometry:true},z);var m=new G,t=W.formatter('<xls:DetermineRouteRequest provideRouteHandle="{0}" distanceUnit="{1}" routeQueryType="{2}">'),r=W.formatter("<xls:{0}><xls:Position><gml:Point><gml:pos>{1}</gml:pos></gml:Point></xls:Position></xls:{0}>");
return W.ex({},m,{methodName:"DetermineRoute",getRequestBody:function(){if(E.length<2)throw Error("Cannot send RouteRequest, less than 2 waypoints specified");var q=t(z.provideRouteHandle,z.distanceUnit,z.routeQueryType);q+="<xls:RoutePlan>";q+="<xls:RoutePreference>"+z.preference+"</xls:RoutePreference>";q+="<xls:WayPointList>";for(var F=0;F<E.length;F++)q+=r(F===0?"StartPoint":F===E.length-1?"EndPoint":"ViaPoint",E[F].toString());q+="</xls:WayPointList>";q+="</xls:RoutePlan>";if(z.routeInstructions)q+=
'<xls:RouteInstructionsRequest rules="maneuver-rules" providePoint="true" />';if(z.routeGeometry)q+="<xls:RouteGeometryRequest />";q+="</xls:DetermineRouteRequest>";return q},parseResponse:function(q){var F=q.RouteGeometry.LineString.pos,D=q.RouteInstructionsList;q=[];D=D&&D.RouteInstruction?D.RouteInstruction:[];for(var J=0;J<D.length;J++){var T=D[J].distance;q.push({text:D[J].Instruction,latlng:D[J].Point,distance:T.value+(T.uom||"M").toUpperCase(),time:TL.parse(D[J].duration,"8601")})}return[F,
q]}})};return{calculate:function(E,z,m,t){t=W.ex({preference:"Fastest"},t);E=new u(E,t);f(E,z,m)}}});return{applyConfig:function(u){W.ex(e,u)},getTileConfig:function(u,E){f(new O,function(z){var m=e.clientName.replace(/\:.*/,":"+(u||""));hosts=[];if(z.aliasCount)for(var t=0;t<z.aliasCount;t++)hosts[t]="http://"+z.host.replace("^(.*?).(.*)$","\u0001-0"+(t+1)+".\u0002");else hosts=["http://"+z.host];E({hosts:hosts,clientName:m,sessionID:e.sessionID,configuration:e.configuration})})},setTileConfig:function(u){e.tileConfig=
u},compareFns:function(){return{streetDetails:function(u,E){return E.calcMatchPercentage(u)},location:function(u,E){return E.calcMatchPercentage(u)}}}()}}()})();
