(function(){function Q(n){n=n.split(",");for(var x=[],y=0;y<n.length;y++){var A=n[y].trim().replace(".","/");x[y]=oa[A]}return x}function Ja(n,x){for(var y=n.split(","),A=true,K=typeof $LAB!=="undefined"?$LAB:null,Y=0;Y<y.length;Y++){var ha=y[Y].trim().replace(".","/");if(!oa[ha]){A=false;Ka&&Ja("./plugins/"+pluginFile)}}if(x)if(Ka||A)x.apply(za,Q(n));else K&&$LAB.wait(function(){x.apply(za,Q(n))});return za}function Z(n,x,y){if(n&&n.split){var A=n.split(db);if(A.length>1){n=A[0];x=A[1]}}else if(n&&
n.lat){x=n.lon;n=n.lat}this.lat=parseFloat(n||0);this.lon=parseFloat(x||0);this.radius=y||eb}function Ra(n){this.positions=[];for(var x=n.length;x--;)this.positions[x]=typeof n[x]=="string"?new Z(n[x]):n[x]}function ba(n,x){if(n&&n.splice){for(var y=x,A=new Z(qa,Da),K=new Z(fb,$),Y=n.length;Y--;){var ha=typeof n[Y]=="string"?new Z(n[Y]):n[Y];if(ha.lat<A.lat)A.lat=ha.lat;if(ha.lat>K.lat)K.lat=ha.lat;if(ha.lon<A.lon)A.lon=ha.lon;if(ha.lon>K.lon)K.lon=ha.lon}this.min=A;this.max=K;if(typeof y=="undefined"){y=
this.size();y=Math.max(y.x,y.y)*0.3}this.min=new Z(A.lat-y,(A.lon-y)%360);this.max=new Z(K.lat+y,(K.lon+y)%360)}else if(n&&n.min){this.min=new Z(n.min);this.max=new Z(n.max)}else{this.min=n;this.max=x}}function ua(n){if(typeof n=="string"){var x=(n.replace(/\d|\.|\s/g,"")||"m").toLowerCase();n=parseFloat(n)*({km:1E3}[x]||1)}this.meters=n||0}function na(n,x){if(typeof n=="number"){this.days=n||0;this.seconds=x||0}else if(typeof n!="undefined"){this.days=n.days||0;this.seconds=n.seconds||0}}var oa=
{},Sa=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],Ka=typeof module!="undefined"&&module.exports,Aa=Math.PI*2,Ea=Math.PI/2,ia=Math.PI/180,va=180/Math.PI,qa=90,fb=-qa,Da=180,$=-Da,Ya=qa*ia,X=-Ya,La=Da*ia,pb=-La,eb=6371,la=eb*1E3,db=/[\,\s]+/;Z.prototype={constructor:Z,bearing:function(n){var x=this.lat*ia,y=n.lat*ia;n=(n.lon-this.lon)*ia;return(Math.atan2(Math.sin(n)*Math.cos(y),Math.cos(x)*Math.sin(y)-Math.sin(x)*Math.cos(y)*Math.cos(n))*va+360)%360},
copy:function(){return new Z(this.lat,this.lon)},distanceTo:function(n){if(!n||this.empty()||n.empty())return 0;var x=(n.lat-this.lat)*ia/2,y=(n.lon-this.lon)*ia/2;n=Math.sin(x)*Math.sin(x)+Math.cos(this.lat*ia)*Math.cos(n.lat*ia)*Math.sin(y)*Math.sin(y);return this.radius*2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n))},equalTo:function(n){return pos&&this.lat===n.lat&&this.lon===n.lon},empty:function(){return this.lat===0&&this.lon===0},inArray:function(n){if(n)for(var x=n.length;x--;)if(this.equal(n[x]))return true;
return false},offset:function(n,x){var y=this.lat*ia,A=y+n/this.radius;y=this.lon*ia+Math.asin(Math.sin(x/this.radius)/Math.cos(y));A=(A+Ea)%Math.PI-Ea;y%=Aa;return new Z(A*va,y*va)},to:function(n,x){if(typeof n=="object")n=this.bearing(n);var y=x/this.radius,A=n*ia,K=this.lat*ia,Y=Math.asin(Math.sin(K)*Math.cos(y)+Math.cos(K)*Math.sin(y)*Math.cos(A));y=this.lon*ia+Math.atan2(Math.sin(A)*Math.sin(y)*Math.cos(K),Math.cos(y)-Math.sin(K)*Math.sin(Y));y=(y+3*Math.PI)%(2*Math.PI)-Math.PI;return new Z(Y*
va,y*va)},toBounds:function(n){var x=n.radians(),y=this.lat*ia,A=this.lon*ia;n=y-x;var K=y+x;if(n>X&&K<Ya){y=Math.asin(Math.sin(x)/Math.cos(y));x=A-y;if(x<pb)x+=Aa;A=A+y;if(A>La)A-=Aa}else{n=Math.max(n,X);K=Math.min(K,Ya);x=$;A=Da}return new ba(new Z(n*va,x*va),new Z(K*va,A*va))},toString:function(n){return this.lat+(n||" ")+this.lon},valid:function(){return!(isNaN(this.lat)||isNaN(this.lon))}};Ra.prototype={constructor:Ra,distance:function(){for(var n=0,x=[],y,A=this.positions.length-1;A--;){y=this.positions[A].distanceTo(this.positions[A+
1]);n+=x[A]=y}return{total:n,segments:x}},traverse:function(n,x){var y=0,A=0;if(!x||!x.segments)x=this.distance();if(n>x.total)return this.positions[this.positions.length-1];else if(n<=0)return this.positions[0];else{for(;A<x.segments.length;){y+=x.segments[A];if(y>n){y-=x.segments[A];break}A++}if(A<this.positions.length-1){var K=this.positions[A];A=K.bearing(this.positions[A+1]);return K.to(A,n-y)}else return this.positions[A]}}};ba.prototype={constructor:ba,bestZoomLevel:function(n,x){var y=this.center(),
A=Sa[Math.min(Math.round(Math.abs(y.lat)*0.05),Sa.length)],K=this.size();y=Math.ceil(Math.log(Sa[3]*x/K.y)/Math.LN2);A=Math.ceil(Math.log(A*n/K.x)/Math.LN2);return Math.min(isNaN(y)?1E3:y,isNaN(A)?1E3:A)},center:function(){var n=this.size();return new Z(this.min.lat+n.y/2,this.min.lon+n.x/2)},expand:function(n){return new ba(new Z(this.min.lat-n,(this.min.lon-n)%360),new Z(this.max.lat+n,(this.max.lon+n)%360))},size:function(n){var x={x:0,y:this.max.lat-this.min.lat};x.x=typeof n!="undefined"&&n&&
this.min.lon>this.max.lon?360-this.min.lon+this.max.lon:this.max.lon-this.min.lon;return x},toString:function(){return"min: "+this.min+", max: "+this.max},union:function(){for(var n=this.min.copy(),x=this.max.copy(),y=arguments.length;y--;)if(arguments[y]){var A=arguments[y].min,K=arguments[y].max;n.lat=Math.min(n.lat,A.lat);n.lon=Math.min(n.lon,A.lon);x.lat=Math.max(x.lat,K.lat);x.lon=Math.max(x.lon,K.lon)}return new ba(n,x)}};ua.prototype={add:function(){for(var n=this.meters,x=arguments.length;x--;){var y=
typeof arguments[x]=="string"?new ua(arguments[x]):arguments[x];n+=y.meters}return new ua(n)},radians:function(n){if(typeof n!="undefined"){this.meters=n*la;return this}else return this.meters/la},toString:function(){if(this.meters>1E3)return(this.meters/10|0)/100+"km";return this.meters+"m"}};na.prototype={add:function(){for(var n=new na(this.days,this.seconds),x=arguments.length;x--;){n.days+=arguments[x].days;n.seconds+=arguments[x].seconds}return n},toString:function(){var n,x,y,A="";if(this.days)A=
this.days+" days ";if(this.seconds){y=this.seconds;if(y>=3600){n=~~(y/3600);y-=n*3600}if(y>=60){x=Math.round(y/60);y-=x*60}if(n)A=A+n+(n>1?" hrs ":" hr ")+(x?(x>10?x:"0"+x)+" min ":"");else if(x)A=A+x+" min";else if(y>0)A=A+(y>10?y:"0"+y)+" sec"}return A}};var Ma=function(){var n=/^P(\d+Y)?(\d+M)?(\d+D)?$/,x=/^(\d+H)?(\d+M)?(\d+S)?$/,y={8601:function(A){A=A.split("T");var K=null;K=null;var Y=0,ha=0;n.lastIndex=-1;K=n.exec(A[0]);Y+=K[3]?parseInt(K[3].slice(0,-1),10):0;x.lastIndex=-1;K=x.exec(A[1]);
ha+=K[1]?parseInt(K[1].slice(0,-1),10)*3600:0;ha+=K[2]?parseInt(K[2].slice(0,-1),10)*60:0;ha+=K[3]?parseInt(K[3].slice(0,-1),10):0;return new na(Y,ha)}};return function(A,K){var Y=y[K];if(!Y)throw"No parser found for the duration format: "+K;return Y(A)}}(),za=this.GeoJS={Pos:Z,Line:Ra,BBox:ba,Distance:ua,generalize:function(n,x,y){var A=n.length,K=[],Y=null;y=(y||250)/1E3;for(A=A;A--;)if(A===0)K.unshift(n[A]);else{var ha=!Y||n[A].inArray(x)?y:Y.distanceTo(n[A]);if(n[A]&&ha>=y){K.unshift(n[A]);Y=
n[A]}}return K},Duration:na,parseDuration:Ma,define:function(n,x){oa[n]=x},require:Ja};if(Ka)module.exports=za})();
(function(){function Q(){var a=arguments[0]||{},c=Array.prototype.slice.call(arguments,1),b=c.length,f,i;for(i=0;i<b;i++)if((f=c[i])!==null)for(var k in f){var e=f[k];if(a!==e)if(e!==undefined)a[k]=e}return a}function Ja(a,c){if(typeof console!=="undefined")console[c||"log"](a)}function Z(a){var c=a.match(ia),b=[],f=0,i;for(i=c?c.length:0;i--;){var k=c[i].slice(1);b[k]||(b[k]=RegExp("\\{"+k+"\\}","g"))}f=b.length;return function(){var e=a;for(i=0;i<f;i++){var j=arguments[i];if(typeof j=="undefined")j=
"";e=e.replace(b[i],j)}return e}}function Ra(a,c){var b=n*Ta(a);return db-2*wb(c*Y((1-b)/(1+b),n/2))}function ba(a,c){if($(a,Fa)){var b=a.split(xb);this.x=parseFloat(b[0]);this.y=parseFloat(b[1])}else if(a&&a.x){this.x=a.x;this.y=a.y}else{this.x=a||0;this.y=c||0}}function ua(a){this.allowCull=a;this.points=[]}function na(a,c,b,f){this.mercX=b;this.mercY=f;if($(a,Fa))Q(this,Ib.parseXY(a));else a&&a.toBounds?Q(this,gb(a.lon,a.lat)):ba.call(this,a,c)}function oa(a,c,b,f){this.x=a||0;this.y=c||0;this.w=
b||0;this.h=f||0;this.x2=this.x+this.w;this.y2=this.y+this.h}function Sa(a,c){var b=new Jb(Math.sqrt(256<<a)|0);c&&c.zoomLevel===a&&c.copyInto(b);b.zoomLevel=a;return b}function Ka(a,c,b,f,i,k){this.x=a;this.y=c;this.w=f||256;this.h=f||256;this.x2=this.x+this.w;this.y2=this.y+this.h;this.url=b;this.id=k||a+"_"+c;this.loaded=false;this.image=null}function Aa(a,c,b,f){f=Q({id:"layer_"+Kb++,zindex:0,animated:false,style:null,minXY:null,maxXY:null,visible:true},f);this.visible=f.visible;this.view=a;qa(Q(this,
f))}function Ea(){qa(this)}var ia=/\{(\d+)(?=\})/g,va=function(){var a=1.70158,c=Math.PI/2,b=Math.abs,f=Math.pow,i=Math.sin,k=Math.asin,e=Math.cos,j={linear:function(d,l,g,h){return g*d/h+l},backin:function(d,l,g,h){return g*(d/=h)*d*((a+1)*d-a)+l},backout:function(d,l,g,h){return g*((d=d/h-1)*d*((a+1)*d+a)+1)+l},backinout:function(d,l,g,h){return(d/=h/2)<1?g/2*d*d*(((a*=1.525)+1)*d-a)+l:g/2*((d-=2)*d*(((a*=1.525)+1)*d+a)+2)+l},bouncein:function(d,l,g,h){return g-j.bounceout(h-d,0,g,h)+l},bounceout:function(d,
l,g,h){return(d/=h)<1/2.75?g*7.5625*d*d+l:d<2/2.75?g*(7.5625*(d-=1.5/2.75)*d+0.75)+l:d<2.5/2.75?g*(7.5625*(d-=2.25/2.75)*d+0.9375)+l:g*(7.5625*(d-=2.625/2.75)*d+0.984375)+l},bounceinout:function(d,l,g,h){return d<h/2?j.bouncein(d*2,0,g,h)/2+l:j.bounceout(d*2-h,0,g,h)/2+g/2+l},cubicin:function(d,l,g,h){return g*(d/=h)*d*d+l},cubicout:function(d,l,g,h){return g*((d=d/h-1)*d*d+1)+l},cubicinout:function(d,l,g,h){if((d/=h/2)<1)return g/2*d*d*d+l;return g/2*((d-=2)*d*d+2)+l},elasticin:function(d,l,g,h,
m,p){if(d==0)return l;if((d/=h)==1)return l+g;p||(p=h*0.3);if(!m||m<b(g)){m=g;g=p/4}else g=p/la*k(g/m);return-(m*f(2,10*(d-=1))*i((d*h-g)*la/p))+l},elasticout:function(d,l,g,h,m,p){var q;if(d==0)return l;if((d/=h)==1)return l+g;p||(p=h*0.3);if(!m||m<b(g)){m=g;q=p/4}else q=p/la*k(g/m);return m*f(2,-10*d)*i((d*h-q)*la/p)+g+l},elasticinout:function(d,l,g,h,m,p){var q;if(d==0)return l;if((d/=h/2)==2)return l+g;p||(p=h*0.3*1.5);if(!m||m<b(g)){m=g;q=p/4}else q=p/la*k(g/m);if(d<1)return-0.5*m*f(2,10*(d-=
1))*i((d*h-q)*la/p)+l;return m*f(2,-10*(d-=1))*i((d*h-q)*la/p)*0.5+g+l},quadin:function(d,l,g,h){return g*(d/=h)*d+l},quadout:function(d,l,g,h){return-g*(d/=h)*(d-2)+l},quadinout:function(d,l,g,h){if((d/=h/2)<1)return g/2*d*d+l;return-g/2*(--d*(d-2)-1)+l},sinein:function(d,l,g,h){return-g*e(d/h*c)+g+l},sineout:function(d,l,g,h){return g*i(d/h*c)+l},sineinout:function(d,l,g,h){return-g/2*(e(Math.PI*d/h)-1)+l}};return function(d){d=d.replace(/[\-\_\s\.]/g,"").toLowerCase();return j[d]||j.linear}}(),
qa=function(){function a(b,f){var i=b.hasOwnProperty("obsHandlers")?b.obsHandlers:null;i[f]||(i[f]=[]);return i[f]}var c=0;return function(b){if(!b)return null;if(!(b.hasOwnProperty("obsHandlers")?b.obsHandlers:null))b.obsHandlers={};if(!b.hasOwnProperty("bind")){b.bind=function(f,i){var k="callback"+c++;a(b,f).unshift({fn:i,id:k});return k};b.triggerCustom=function(f,i){var k=a(b,f),e={cancel:false,name:f,source:this},j;for(j in i)e[j]=i[j];if(!k)return null;j=Array.prototype.slice.call(arguments,
2);b.eventInterceptor&&b.eventInterceptor(f,e,j);j.unshift(e);for(var d=k.length;d--&&!e.cancel;)k[d].fn.apply(this,j);return e};b.trigger=function(f){var i=Array.prototype.slice.call(arguments,1);i.splice(0,0,f,null);return b.triggerCustom.apply(this,i)};b.unbind=function(f,i){if(typeof f==="undefined")b.obsHandlers={};else for(var k=a(b,f),e=0;k&&e<k.length;e++)if(k[e].id===i){k.splice(e,1);break}return b}}return b}}(),fb=function(){function a(c,b,f,i){if(typeof c[i]=="undefined")c[i]=function(k){if(typeof k!=
"undefined"){b[i]=k;f[i]&&f[i](k);return c}else return b[i]}}return function(c,b,f){b=b||c;for(var i in b)typeof b[i]!="function"&&a(c,b,f,i);return c}}(),Da=Array.indexOf||function(a){for(var c=0;c<this.length;c++)if(this[c]===a)return c;return-1},$=function(){var a={NaN:1,Infinity:1,"-Infinity":1},c=String.prototype.toLowerCase,b=Object.prototype.toString;return function(f,i){i=c.call(i);if(i=="finite")return!a.hasOwnProperty(+f);return i=="null"&&f===null||i==typeof f||i=="object"&&f===Object(f)||
i=="array"&&Array.isArray&&Array.isArray(f)||b.call(f).slice(8,-1).toLowerCase()==i}}(),Ya=function(){function a(k){var e=document.createElement("script"),j=false;e.src=k;e.async=true;e.onload=e.onreadystatechange=function(){if(!j&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){j=true;e.onload=e.onreadystatechange=null;e&&e.parentNode&&e.parentNode.removeChild(e)}};i||(i=document.getElementsByTagName("head")[0]);i.appendChild(e)}function c(k,e,j){k+=k.indexOf("?")>=
0?"&":"?";var d="json"+ ++f;window[d]=function(l){e(l);window[d]=null;try{delete window[d]}catch(g){}};a(k+(j?j:"callback")+"="+d);return d}function b(k,e,j){var d=require("request");k=k+(k.indexOf("?")>=0?"&":"?")+(j?j:"callback")+"=cb";d({uri:k},function(l,g,h){if(l)e({error:l});else{l=h.replace(/^.*\(/,"").replace(/\).*$/,"");e(JSON.parse(l))}})}var f=0,i;return typeof window!="undefined"?c:b}();INTERACT=function(){function a(m){return function(p,q){m.addEventListener(p,q,false)}}function c(m){return function(p,
q){m.removeEventListener(p,q,false)}}function b(m){return function(p,q){m.attachEvent("on"+p,q)}}function f(m,p){return{x:m?m:0,y:p?p:0,count:1}}function i(m,p){g.push(Q({handler:null,checks:{},type:m},p))}function k(m){var p=0,q=0;if(m.offsetParent){do{p+=m.offsetLeft;q+=m.offsetTop;m=m.offsetParent}while(m)}return{left:p,top:q}}function e(m,p){return{source:m,target:p.target?p.target:p.srcElement}}function j(m,p){for(var q=m.target?m.target:m.srcElement;q&&q!==p;)q=q.parentNode;return q&&q===p}
function d(m,p){return{x:m.x-(p?p.left:0),y:m.y-(p?p.top:0)}}function l(m,p){if(m.preventDefault){m.preventDefault();m.stopPropagation()}else if(typeof m.cancelBubble!="undefined")m.cancelBubble=true;p&&m.stopImmediatePropagation&&m.stopImmediatePropagation()}var g=[],h=function(m,p,q){q=Q({binder:null,unbinder:null,observable:null},q);for(var G=q.observable,D=[],P,r,F={bind:function(){return G.bind.apply(null,arguments)},unbind:function(){G.unbind();for(z=0;z<D.length;z++)D[z].unbind();return F}},
z=0;z<p.length;z++)D.push(p[z](m,G,q));G.bind("pointerDown",function(){r=P=0});G.bind("pointerMove",function(o,w,t,u){P+=u.x||0;r+=u.y||0});G.bind("pointerUp",function(o,w,t){Math.max(Math.abs(P),Math.abs(r))<=20&&G.triggerCustom("tap",o,w,t)});return F};i("pointer",{handler:function(m,p,q){function G(I){if(I.pageX&&I.pageY)return f(I.pageX,I.pageY);else{var N=document.documentElement,O=document.body;return f(I.clientX+(N&&N.scrollLeft||O&&O.scrollLeft||0)-(N&&N.clientLeft||O&&O.clientLeft||0),I.clientY+
(N&&N.scrollTop||O&&O.scrollTop||0)-(N&&N.clientTop||O&&O.clientTop||0))}}function D(I){if(j(I,m))if(E=z(I)){var N=G(I);m.style.cursor="move";l(I,true);L=N.x;T=N.y;C=f(L,T);p.triggerCustom("pointerDown",e("mouse",I),C,d(C,k(m)))}}function P(I){var N=G(I);H=N.x;U=N.y;if(j(I,m))w(I,E?"pointerMove":"pointerHover")}function r(I){if(E&&z(I)){E=false;if(j(I,m)){m.style.cursor="default";w(I,"pointerUp")}}}function F(I){if(j(I,m)){var N;I=I||window.event;if(I.detail){if(typeof I.axis=="undefined"||I.axis===
2)N=-I.detail*t}else{N=I.wheelDeltaY?I.wheelDeltaY:I.wheelDelta;if(window.opera)N=-N}if(N){var O=f(H,U);p.triggerCustom("zoom",e("mouse",I),O,d(O,k(m)),N/u,"wheel");l(I);I.returnValue=false}}}function z(I){I=I||window.event;return(I.which||I.button)==1}function o(I){return!j(I,m)}function w(I,N,O,ca,J){O=typeof O!="undefined"?O:H;ca=typeof ca!="undefined"?ca:U;var V=O-L,R=ca-T,aa=f(O,ca);p.triggerCustom(N,e("mouse",I),aa,d(aa,k(m)),f(V,R));if(typeof J=="undefined"||J){L=O;T=ca}}q=Q({},q);var t=120,
u=t*8,E=false,C,H,U,L,T;q.binder("mousedown",D);q.binder("mousemove",P);q.binder("mouseup",r);q.binder("dblclick",function(I){if(j(I,m)){var N=G(I);p.triggerCustom("doubleTap",e("mouse",I),N,d(N,k(m)))}});q.binder("selectstart",o);q.binder("dragstart",o);q.binder("mousewheel",F);q.binder("DOMMouseScroll",F);return{unbind:function(){q.unbinder("mousedown",D);q.unbinder("mousemove",P);q.unbinder("mouseup",r);q.unbinder("mousewheel",F);q.unbinder("DOMMouseScroll",F)}}},checks:{touch:false}});i("pointer",
{handler:function(m,p,q){function G(J){if(J.count<2)return 0;var V=J.x-J.next.x;J=J.y-J.next.y;return~~Math.sqrt(V*V+J*J)}function D(J,V,R){V=V?V:0;R=R?R:0;for(var aa={x:J.x-V,y:J.y-R,id:J.id,count:J.count},fa=aa;J.next;){J=J.next;fa=fa.next={x:J.x-V,y:J.y-R,id:J.id}}return aa}function P(J,V){var R=J[V?V:"touches"],aa,fa;if(R.length===0)return null;fa=aa={x:R[0].pageX,y:R[0].pageY,id:R[0].identifier,count:R.length};for(var ra=1,hb=R.length;ra<hb;ra++)fa=fa.next={x:R[ra].pageX,y:R[ra].pageY,id:R[ra].identifier};
return aa}function r(J){if(j(J,m)){H=k(m);var V=P(J,"changedTouches"),R=D(V,H.left,H.top);if(!L){U=u;p.triggerCustom("pointerDown",e("touch",J),V,R)}O&&p.triggerCustom("pointerDownMulti",e("touch",J),V,R);L=P(J);if(L.count>1)I=G(L);ca=1;N=D(L)}}function F(J){if(j(J,m)){l(J);T=P(J);if(U==u)U=Math.abs(L.x-T.x)>w||Math.abs(L.y-T.y)>w?t:u;if(U!=u){U=T.count>1?C:E;if(U==C)if(L.count===1){L=D(T);I=G(L)}else{var V=G(T);if(Math.abs(I-V)<o)U=E;else{var R;R=T.x;var aa=T.next.x,fa=T.y,ra=T.next.y;R={x:(R<aa?
R:aa)+(Math.abs(R-aa)>>1),y:(fa<ra?fa:ra)+(Math.abs(fa-ra)>>1)};V=V/I;aa=V-ca;p.triggerCustom("zoom",e("touch",J),R,d(R,H),aa,"pinch");ca=V}}U==E&&p.triggerCustom("pointerMove",e("touch",J),T,D(T,H.left,H.top),f(T.x-N.x,T.y-N.y));O&&p.triggerCustom("pointerMoveMulti",e("touch",J),T,D(T,H.left,H.top))}N=D(T)}}function z(J){if(j(J,m)){var V=P(J,"changedTouches"),R=D(V,H.left,H.top);T=P(J);if(!T){p.triggerCustom("pointerUp",e("touch",J),V,R);L=null}O&&p.triggerCustom("pointerUpMulti",e("touch",J),V,
R)}}q=Q({detailed:false,inertia:false},q);var o=20,w=7,t=0,u=1,E=2,C=3,H,U,L,T,I,N,O=q.detailed,ca=1;q.binder("touchstart",r);q.binder("touchmove",F);q.binder("touchend",z);return{unbind:function(){q.unbinder("touchstart",r);q.unbinder("touchmove",F);q.unbinder("touchend",z)}}},checks:{touch:true}});return{register:i,watch:function(m,p,q){p=Q({bindTarget:null,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},p);capabilities=Q({touch:"ontouchstart"in window},q);if(!p.observable){p.observable=
qa({});globalOpts=p}p.binder=(p.isIE?b:a)(p.bindTarget||document);p.unbinder=(p.isIE?b:c)(p.bindTarget||document);q=p.types;for(var G=capabilities,D=[],P=g.length;P--;){var r=g[P],F=!q||q.indexOf(r.type)>=0,z=true,o;for(o in r.checks){var w=r.checks[o];z=z&&w===G[o]}if(F&&z)D[D.length]=r.handler}return new h(m,D,p)}}}();var X=this.T5=qa({}),La=function(){var a={};return{create:function(c,b){if(a[c][b])return a[c][b].apply(null,Array.prototype.slice.call(arguments,2));throw eb(c,b);},get:function(c,
b){return a[c]?a[c][b]:null},register:function(c,b,f){a[c]||(a[c]={});a[c][b]&&Ja(pb(c,b),"warn");a[c][b]=f}}}(),pb=Z("Registration of {0}: {1} will override existing definition"),eb=Z("Could not create {0} of type: {1}");Z("Could not create drawable of type: {0}");var la=Math.PI*2,db=Math.PI/2,Ma=Math.PI/180,za=180/Math.PI,n=0.08181919084262157,x=Math.abs,y=Math.round,A=Math.min,K=Math.max,Y=Math.pow,ha=Math.sqrt,qb=Math.log,Ta=Math.sin,ib=Math.cos,wb=Math.atan,Na="undefined",Fa="string",Ga="number",
wa=La.register,Ua=La.create,Lb=La.get,Mb=0,Kb=0,xb=/[\,\s]+/,Va=function(){function a(e){i++;e=W?window.mozAnimationStartTime||e||(new Date).getTime():(new Date).getTime();for(var j=f.length;j--;){var d=f[j];i%d.every===0&&d.cb(e)}k&&animFrame(a)}var c=1E3/60,b=["r","webkitR","mozR","oR","msR"],f=[],i=0,k=W&&function(){for(var e=0;e<b.length;e++)window.animFrame=window.animFrame||window[b[e]+"equestAnimationFrame"];return animFrame}();k?animFrame(a):setInterval(a,1E3/60);return{attach:function(e,
j){f[f.length]={cb:e,every:j?y(j/c):1}},detach:function(e){for(var j=f.length;j--;)if(f[j].cb===e){f.splice(j,1);break}}}}(),Ib=function(){var a=/^xy\((.*)\).*$/i;return{parseXY:function(c){if(!a.test(c)){c=c.split(xb);return gb(c[1],c[0])}}}}(),W=typeof window!="undefined"?function(){function a(i){for(var k=0;k<i.length;k++){var e=i[k];if(typeof document.body.style[e]!="undefined")return e}}var c={"-webkit-user-select":"none",position:"absolute"},b,f;b=a(["-webkit-transform","MozTransform"]);css3DTransformProp=
a(["WebkitPerspective","MozPerspective"]);f=a(["-webkit-transform-origin","MozTransformOrigin"]);return{transforms:$(b,Fa),create:function(i,k,e){i=document.createElement(i);var j=[];e=e||{};i.className=k||"";for(var d in e)j[j.length]=d+": "+e[d];i.style.cssText=j.join(";");return i},move:function(i,k,e,j,d){if(b){i.style[b]="translate("+k+"px, "+e+"px) "+(j||[]).join(" ");if(d&&f)i.style[f]=d.x+"px "+d.y+"px"}else{i.style.left=k+"px";i.style.top=e+"px"}},rect:function(i){return new oa(i.offsetLeft,
i.offsetTop,i.offsetWidth,i.offsetHeight)},styles:function(i){return Q({},c,i)}}}():null,yb=function(){function a(){for(var i=f.length,k=i;k--;)try{f[k](i)}catch(e){Ja(e.toString(),"error")}}var c=20,b=50,f=[];return{process:function(i,k,e,j){function d(h){h=(l||b)/h;if(g<i.length){var m=i.slice(g,g+h);h=m.length;var p=l?0:(new Date).getTime();k(m,h);if(!l)l=(m=((new Date).getTime()-p)/h)?c/m|0:i.length;g+=h}else{for(h=f.length;h--;)if(f[h]===d){f.splice(h,1);break}f.length===0&&Va.detach(a);e&&e()}}
var l,g=0;if(W&&i.length>(j||0))f.push(d)===1&&Va.attach(a);else{k(i,i.length);e&&e()}}}}(),gb=gb||function(a,c){var b=parseFloat(c)*Ma;b=Ta(b);var f=n*b;b=qb((1+b)/(1-b)*Y((1-f)/(1+f),n))/2;return new na(0,0,parseFloat(a)*Ma,b)},rb=rb||function(a,c){for(var b=Y(Math.E,-c),f=db-2*wb(b),i=Ra(f,b),k=0;k<12&&x(f-i)>1.0E-7;){f=i;i=Ra(f,b);k++}return new GeoJS.Pos(i*za,a%360*za)};ba.prototype={constructor:ba,add:function(){for(var a=this.x,c=this.y,b=arguments.length;b--;){a+=arguments[b].x;c+=arguments[b].y}return this.copy(a,
c)},copy:function(a,c){var b=Q({},this);b.x=a||b.x;b.y=c||b.y;return b},equals:function(a){return this.x===a.x&&this.y===a.y},offset:function(a,c){return this.copy(this.x+a,this.y+c)},relative:function(a){a=a.viewport();return this.copy(this.x-a.x-a.padding.x,this.y-a.y-a.padding.y)},rotate:function(a,c){c=c||new ba(0,0);var b=this.x-c.x,f=this.y-c.y;return new ba(c.x+ib(a)*b+-Ta(a)*f,c.y+Ta(a)*b+ib(a)*f)},scale:function(a,c){c=c||new ba(0,0);return new ba(c.x+(this.x-c.x)*a,c.y+(this.y-c.y)*a)},
sync:function(){return this},toString:function(){return this.x+", "+this.y}};ua.prototype=Q([],{cull:function(a){if(this.allowCull){var c=a.x,b=a.y,f=a.x+a.w;a=a.y+a.h;for(var i=Infinity,k=0,e=this.points,j,d=e.length;d--;)if(j=e[d].x>=c&&e[d].x<=f&&e[d].y>=b&&e[d].y<=a){i=d<i?d:i;k=d>k?d:k}return e.slice(K(i-1,0),A(k+1,e.length))}return this},simplify:function(a){a=a||3;for(var c=new ua(this.allowCull),b=this.points,f=null,i=b.length;i--;){var k=b[i];if(include=!f||i===0||x(k.x-f.x)+x(k.y-f.y)>a){c.points.unshift(k);
f=k}}return c}});na.prototype=Q(new ba,{constructor:na,pos:function(){return rb(this.mercX,this.mercY)},sync:function(a,c){var b;if(!(b=a.rpp)){b=a.zoom();b=la/(256<<b)}b=b;if(c){this.mercX=this.x*b-Math.PI;this.mercY=Math.PI-this.y*b}else{this.x=y(((this.mercX||0)+Math.PI)/b);this.y=y((Math.PI-(this.mercY||0))/b)}return this}});oa.prototype={constructor:oa,buffer:function(a,c){return new oa(this.x-a,this.y-(c||a),this.w+a*2,this.h+(c||a)*2)},center:function(){return new ba(this.x+(this.w>>1),this.y+
(this.h>>1))}};Hits=function(){return{diffHits:function(a,c){var b=[],f={},i;for(i=c.length;i--;)f[c[i].target.id]=true;for(i=a.length;i--;)f[a[i].target.id]||(b[b.length]=a[i]);return b},init:function(a,c,b,f,i){return{type:a,x:i.x,y:i.y,gridX:f.x|0,gridY:f.y|0,elements:[],absXY:c,relXY:b}},initHit:function(a,c,b){return{type:a,target:c,drag:b}},triggerEvent:function(a,c,b,f){c.triggerCustom(a.type+(b?b:"Hit"),{hitType:a.type},f?f:a.elements,a.absXY,a.relXY,new na(a.gridX,a.gridY))}}}();var Jb=function(a){function c(k,
e){var j=b[k],d;j||(j=b[k]=[]);(d=j[e])||(d=j[e]=[]);return d}a=a||128;var b=[],f={},i=0;return{clear:function(){b=[];f={}},copyInto:function(k){for(var e in f){var j=f[e];k.insert(j.bounds||j,j,e)}},insert:function(k,e,j){var d=k.x/a|0,l=k.y/a|0,g=(k.x+k.w)/a|0;k=(k.y+k.h)/a|0;j=j||e.id||"obj_"+i++;f[j]=e;for(e=d;e<=g;e++)for(d=l;d<=k;d++)c(e,d).push(j)},remove:function(k,e,j){j=j||e.id;if(f[j]){var d=k.x/a|0;e=k.y/a|0;var l=(k.x+k.w)/a|0;k=(k.y+k.h)/a|0;delete f[j];for(d=d;d<=l;d++)for(var g=e;g<=
k;g++){var h=c(d,g),m=Da.call(h,j);m>=0&&h.splice(m,1)}}},search:function(k){var e=k.y/a|0,j=(k.x+k.w)/a|0,d=(k.y+k.h)/a|0,l=[],g=[];for(k=k.x/a|0;k<=j;k++)for(var h=e;h<=d;h++)l=l.concat(c(k,h));l.sort();for(e=l.length;e--;){j=l[e];if(d=f[j])g[g.length]=d;for(;e>0&&l[e-1]==j;)e--}return g}}},jb=function(){var a={},c=0;(new Date).getTime();var b={},f=[];Va.attach(function(i){i=i||(new Date).getTime();for(var k=0;k<f.length;){var e=f[k],j=b[e],d=b[e].image&&b[e].image.complete&&b[e].image.width>0,
l=i-j.start;l=d||l>=3E4;if(d){d=j.callbacks;a[e]=j.image;for(var g=0;g<d.length;g++)d[g](j.image,true)}if(l){f.splice(k,1);delete b[e]}else k++}},250);return function(i,k){var e=i&&k?a[i]:null;if(e&&e&&e.complete&&e.width>0)k(e);else if(e=b[i])e.callbacks.push(k);else{e=new Image;e.id="_ldimg"+ ++c;b[i]={start:(new Date).getTime(),image:e,callbacks:[k]};e.src=i;f[f.length]=i}}}();Ka.prototype={constructor:Ka,load:function(a){var c=this;jb(this.url,function(b){c.loaded=true;c.image=b;a&&a()})}};var Nb=
function(){return qa({fastpan:true,applyStyle:function(){},applyTransform:function(a,c,b){return{restore:null,x:c,y:b}},getDimensions:function(){return{width:0,height:0}},getViewport:function(){},hitTest:function(){return false},projectXY:null,reset:function(){}})};wa("renderer","canvas",function(a,c,b,f,i){function k(){function o(u,E){this.save();this.setTransform(1,0,0,1,0,0);var C=this.isPointInPath_old(u,E);this.restore();return C}var w=CanvasRenderingContext2D.prototype,t=document.createElement("canvas").getContext("2d");
t.translate(50,0);t.moveTo(125,50);t.arc(100,50,25,0,360,false);if(!t.isPointInPath(150,50)){w.isPointInPath_old=w.isPointInPath;w.isPointInPath=o}}function e(o,w,t){var u,E;q[w]=function(C){for(u=F.length;u--;)if(E=t[F[u]])C[z[u]]=E}}function j(o,w,t){return{draw:t||r,viewport:o,hit:w&&h.isPointInPath(w.x,w.y),vpX:m,vpY:p,context:h}}f=Q({},f);var d,l,g,h,m=0,p=0,q={},G=null,D={},P=function(){},r=function(){this.fill&&h.fill();this.stroke&&h.stroke()},F=["fill","stroke","lineWidth","opacity"],z=["fillStyle",
"strokeStyle","lineWidth","globalAlpha"];W&&k();if(c){d=c.offsetWidth;l=c.offsetHeight;g=W?W.create("canvas",null,{position:"absolute","z-index":1}):new Canvas;g.width=d;g.height=l;a.attachFrame(g,true);h=null}b=Q(i,{applyStyle:function(o){var w=q[o],t=h&&h.canvas?h.canvas.id:"default",u;D[t]||(D[t]=[]);u=D[t].pop()||"reset";if(w){D[t].push(o);w(h);return u}},applyTransform:function(o){if(o.translateX!==0||o.translateY!==0||o.scaling!==1||o.rotation!==0){h.save();G={undo:function(){h.restore();G=
null},x:o.xy.x,y:o.xy.y};h.translate(o.xy.x-m+o.translateX,o.xy.y-p+o.translateY);o.rotation!==0&&h.rotate(o.rotation);o.scaling!==1&&h.scale(o.scaling,o.scaling)}return G},drawTiles:function(o,w,t){for(var u=w.length;u--;){o=w[u];if(!o.loaded&&t)o.load(a.invalidate);else o.image&&h.drawImage(o.image,o.x-m,o.y-p)}},prepArc:function(o,w,t){h.beginPath();h.arc(o.xy.x-(G?G.x:m),o.xy.y-(G?G.y:p),o.size>>1,o.startAngle,o.endAngle,false);return j(w,t)},prepImage:function(o,w,t,u){var E=(u.x||o.xy.x)-(G?
G.x:m),C=(u.y||o.xy.y)-(G?G.y:p),H=u.image||o.image;if(H){h.beginPath();h.rect(E,C,u.width||H.width,u.height||H.height);return j(w,t,function(){h.drawImage(H,E,C,u.width||H.width,u.height||H.height)})}},prepMarker:function(o,w,t){var u=o.xy.x-(G?G.x:m),E=o.xy.y-(G?G.y:p),C=o.size,H=undefined;h.beginPath();switch(o.markerType.toLowerCase()){case "image":H=P;h.rect(u-(C>>1),E-(C>>1),C,C);if(o.reset&&o.image){o.image=null;o.reset=false}o.image?h.drawImage(o.image,u-(C>>1),E-(C>>1),C,C):jb(o.imageUrl,
function(U){o.image=U;h.drawImage(o.image,u-(C>>1),E-(C>>1),C,C)});break;default:h.moveTo(u,E);h.lineTo(u-(C>>1),E-C);h.lineTo(u+(C>>1),E-C);h.lineTo(u,E)}return j(w,t,H)},prepPoly:function(o,w,t,u){var E=true;o=u.points||o.line().cull(w);u=G?G.x:m;var C=G?G.y:p;h.beginPath();for(var H=o.length;H--;){var U=o[H].x-u,L=o[H].y-C;if(E){h.moveTo(U,L);E=false}else h.lineTo(U,L)}return j(w,t)},getCanvas:function(){return g},getContext:function(){return h}});(function(){zb.each(function(o,w){e(null,o,w)});
X.bind("styleDefined",e)})();b.bind("predraw",function(o,w,t){var u=false;if(h)h.restore();else if(g)h=g.getContext("2d");for(o=w.length;o--;)u=u||w[o].clip;m=t.x;p=t.y;if(h){u||h.clearRect(0,0,d,l);h.save();h.globalCompositeOperation="source-over"}});b.bind("detach",function(){c.removeChild(g)});b.bind("resize",function(){});return b});wa("renderer","dom",function(a,c,b,f,i){function k(g){var h=g.image=new Image;d[g.id]=g;h.onload=function(){if(l[g.id])j.appendChild(this);else g.image=null};h.src=
g.url;h.style.cssText="-webkit-user-select: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute;";return h}function e(g,h,m){var p=[],q;for(q in g){var G=g[q];if(m?G[m]:
!h[q]){if(G.image&&G.image.parentNode){G.image.src="";j.removeChild(G.image);G.image=null}p[p.length]=q}}for(h=p.length;h--;)delete g[p[h]]}var j=null,d={},l={};j=W.create("div","t5-tiles",W.styles({width:c.offsetWidth+"px",height:c.offsetHeight+"px"}));c.childNodes.length>0?c.insertBefore(j,c.childNodes[0]):c.appendChild(j);a.attachFrame(j);b=Q(i,{drawTiles:function(g,h,m){for(var p,q=g.x,G=g.y,D=h.length;D--;){g=h[D];if(g.url){(p=g.image||(m?k(g):null))&&W.move(p,g.x-q,g.y-G);l[g.id]=g}}}});b.bind("predraw",
function(){e(d,l);l={}});b.bind("detach",function(){c.removeChild(j)});a.bind("reset",function(){for(e(d,l={});j.childNodes.length>0;)j.removeChild(j.childNodes[0])});return b});var zb=function(){function a(b,f){if($(b,Fa)){X.trigger("styleDefined",b,c[b]=f);return b}else{var i=[],k;for(k in b)i[i.length]=a(k,b[k]);return i}}var c={};a({reset:{fill:"#ffffff",opacity:1},highlight:{fill:"#ff0000"},waypoints:{lineWidth:4,stroke:"#003377",fill:"#ffffff"},waypointsHover:{lineWidth:4,stroke:"#ff0000",fill:"#ffffff"}});
return{resetStyle:"reset",each:function(b){for(var f in c)b(f,c[f])},get:function(b){return c[b]},define:a}}(),Hb=function(a,c){function b(s,v,B,M){Ha&&Ha(true);s=E?K(da+Y(2,M)-1,0.125):M>0?2:0.5;w(s,false,true)}function f(s,v){var B=ga&&ga.projectXY?ga.projectXY(s,v):null;if(!B){B=F();B=new S.XY(B?B.x+(s+B.padding.x)/da:s,B?B.y+(v+B.padding.y)/da:v)}return B.sync(S,true)}function i(s,v,B){s=f(B.x,B.y);S.trigger("doubleTap",v,B,s);if(c.scalable){v=S.center();t(ja+s.x-v.x,ka+s.y-v.y,E?Ab:null);w(2,
Ab,true)}}function k(s,v,B){ca=null;R=true;D("down",v,B)}function e(s,v,B){D("hover",v,B)}function j(s,v,B,M){p(v,B,false);if(!ca){aa+=M.x;fa+=M.y}}function d(s,v,B){p(v,B,true);R=false}function l(){clearTimeout(Bb);Bb=setTimeout(function(){if(O)if(O.offsetWidth!==Za*2||O.offsetHeight!==$a*2){var s=r();G(a);r(s.x,s.y)}},250)}function g(s,v,B){D("tap",v,B);S.trigger("tap",v,B,f(B.x,B.y,true))}function h(){sa&&sa.unbind();if(W&&ga){sa=INTERACT.watch(ga.interactTarget||O);if(c.scalable){sa.bind("zoom",
b);sa.bind("doubleTap",i)}sa.bind("pointerDown",k);sa.bind("pointerMove",j);sa.bind("pointerUp",d);c.captureHover&&sa.bind("pointerHover",e);sa.bind("tap",g)}}function m(s){if(ga){ga.trigger("detach");ga=null}var v=S,B=I,M=O,ea=c;s=s.split("/");for(var xa=new Nb(v,B,M,ea),pa=0;pa<s.length;pa++)xa=Ua("renderer",s[pa],v,B,M,ea,xa);ga=xa;V=W&&ga.fastpan&&W.transforms;E=W&&W.transforms&&c.useTransforms;h();S.trigger("changeRenderer",ga);S.trigger("reset");o()}function p(s,v,B){if(ca){s=f(v.x,v.y);ca.drag.call(ca.target,
ca,s.x,s.y,B)&&ma++;if(B)ca=null}}function q(s){for(var v=T;v--;)if(L[v].id===s)return v;return T}function G(s){if(W){O=document.getElementById(s);s=W.rect(O);N&&O.removeChild(N);O.appendChild(N=W.create("div","t5-panframe",W.styles({overflow:"hidden",width:s.w+"px",height:s.h+"px"})));var v=c.padding;if(v===u){v=O.offsetWidth;var B=O.offsetHeight,M=ha(v*v+B*B);ta=new ba(M-v>>1,M-B>>1)}else ta=new ba(v,v);kb=N.offsetWidth+ta.x*2;lb=N.offsetHeight+ta.y*2;sb=kb/2;tb=lb/2;Za=s.w/2;$a=s.h/2;ab=new ba(sb,
tb);N.appendChild(I=W.create("div","t5-view",W.styles({width:kb+"px",height:lb+"px","z-index":2,margin:-ta.y+"px 0 0 "+-ta.x+"px"})));m(c.renderer);s=c.controls;for(v=0;v<H.length;v++)H[v].trigger("detach");H=[];for(v=0;v<s.length;v++)H[H.length]=Ua("control",s[v],S,N,O,c[s[v]])}else m("canvas")}function D(s,v,B){var M=(new ba(B.x-Za+sb,B.y-$a+tb)).rotate(-ya*Ma,ab).scale(1/da,ab);Ia[Ia.length]=s=Hits.init(s,v,B,f(B.x,B.y,true),M);J=false;for(v=T;v--;)if(L[v].visible)J=J||(L[v].hitGuess?L[v].hitGuess(s.gridX,
s.gridY,S):false);J&&ma++}function P(s){U=U?U+" "+s:s;S.trigger("copyright",U)}function r(s,v,B){if(typeof s!="undefined"&&($(s,Fa)||$(s,"object"))){v=new S.XY(s);v.sync(S);s=v.x;v=v.y}if($(s,Ga)){t(s-Za-ta.x,v-$a-ta.y,B);return S}else return t().offset(Za+ta.x|0,$a+ta.y|0).sync(S,true)}function F(){var s=new oa(ja,ka,kb,lb);s.scaleFactor=da;s.padding=ta?ta.copy():new ba;return s}function z(s,v,B){if($(s,Fa)&&$(v,Na))for(v=0;v<T;v++){if(L[v].id===s)return L[v]}else if($(s,Fa)){v=Ua("layer",v,S,N,
O,B);B=q(s);B!==T&&S.trigger("layerRemove",L[B]);v.added=(new Date).getTime();v.id=s;L[B]=v;L.sort(function(M,ea){return ea.zindex-M.zindex||ea.added-M.added});T=L.length;S.trigger("resync");o();S.trigger("layerChange",S,v);ma++;return v}else return[].concat(L)}function o(){var s=F();if(s){if(Wa||Xa)if(s){var v=mb?ja+(s.w>>1):ja,B=nb?ka+(s.h>>1):ka,M=s.w,ea=s.h;if(Wa&&Wa>M)if(v+M>Wa)ja=mb?ja:Wa-M;else if(v<0)ja=mb?ja:0;if(Xa&&Xa>ea)if(B+ea>Xa)ka=nb?ka:Xa-ea;else if(B<0)ka=nb?ka:0}Cb=ja;Db=ka;S.trigger("refresh",
S,s);ma++}}function w(s,v,B){if($(s,Ga)){var M=B?s:da*s;if(!E){v=undefined;s=y(qb(M)/Math.LN2);M=Y(2,s)}if(v){ob=da;Ha=Ba.tween([da],[M],v,function(){da=M;ob=Ha=null;ma++})}else{da=M;ma++}return S}else return da}function t(s,v,B){if($(s,Ga)){if(B)Ca=Ba.tween([ja,ka],[s,v],B,function(){ja=s|0;ka=v|0;Oa=Pa=0;Ca=null;ma++});else{ja=s|0;ka=v|0;ma++}return S}else return(new S.XY(ja,ka)).sync(S,true)}c=Q({captureHover:true,controls:[],copyright:"",drawOnScale:true,padding:128,inertia:true,refreshDistance:128,
noDrawOnTween:true,pannable:true,scalable:true,renderer:"canvas",useTransforms:true},c);var u="auto",E=true,C=false,H=[],U="",L=[],T=0,I=null,N=null,O,ca=null,J=false,V,R=false,aa=0,fa=0,ra=c.refreshDistance,hb=c.noDrawOnTween,ja=0,ka=0,Oa=0,Pa=0,Cb=0,Db=0,Wa=null,Xa=null,mb=false,nb=false,Ca=null,ta,Ia=[],bb=null,ga,Bb=0,ab=new ba,ya=0,cb=null,da=1,ob,Ha=null,ub=1,sa=null,vb={index:0,draw:false},Ab={easing:"sine.out",duration:500},ma=0,kb,lb,sb,tb,Za,$a,S={XY:ba,id:c.id,panSpeed:0,addCopy:P,attachFrame:function(s,
v){v&&I.appendChild(s)},center:r,detach:function(){ga&&ga.trigger("detach");sa&&sa.unbind();if(N){O.removeChild(N);I=N=null}},frozen:function(s){if($(s,Na))return C;else{C=s;return S}},getCopy:function(){return U},getRenderer:function(){return ga},layer:z,invalidate:function(){ma++},pan:function(s,v,B){return t(ja+s,ka+v,B)},refresh:o,rotate:function(s,v,B){if($(s,Ga)){var M=B?s:ya+s;if(v)cb=Ba.tween([ya],[M],v,function(){ya=M%360;cb=null;ma++});else{ya=M%360;ma++}return S}else return ya},scale:w,
setMaxOffset:function(s,v,B,M){Wa=s;Xa=v;mb=B;nb=M},offset:t,viewport:F};qa(S);S.bind("resize",l);S.bind("layerRemove",function(s,v){var B=Da(L,v.id);if(B>=0&&B<T){L.splice(B,1);ma++}T=L.length});fb(S,c,{container:G,captureHover:h,scalable:h,pannable:h,renderer:m});z("markers","draw",{zindex:20});G(a);if(W&&!$(window.attachEvent,Na))window.attachEvent("onresize",l);else W&&window.addEventListener("resize",l,false);c.copyright&&P(c.copyright);Va.attach(function(s){var v=[],B,M,ea;if(!C){S.panSpeed=
panSpeed=x(aa)+x(fa);(B=da!==ub)&&S.trigger("scale");if(panSpeed>0||B||Ca||Ha||cb){ma++;if(Ca&&panSpeed>0){Ca(true);Ca=null}}if(!R&&panSpeed<=0&&(x(ja-Cb)>=ra||x(ka-Db)>=ra))o();vb.index++;vb.draw=ma||panSpeed||0;if(ga&&vb.draw){if(Ha)da=Ha()[0];if(cb)ya=cb()[0];Oa+=aa;Pa+=fa;if(aa||fa)S.trigger("pan");if(E){if(da!==1)v[v.length]="scale("+da+")";if(ya!==0)v[v.length]="rotate("+ya+"deg)"}B=J||!V||!R&&!(Ca&&hb)&&!(Ha&&hb)&&(c.drawOnScale||da===1)&&panSpeed<=2;if(Ca){M=Ca();ea=1;if(ob)ea=da/ob;Oa=(ja-
M[0]|0)*ea;Pa=(ka-M[1]|0)*ea}if(B){M=-ya*Ma;B=ib(M)*Oa+-Ta(M)*Pa;M=Ta(M)*Oa+ib(M)*Pa;ja=ja-B/da|0;ka=ka-M/da|0;ea=F();ga.trigger("predraw",L,ea,s,Ia);M=Pa=B=Oa=ma=0;for(ii=T;ii--;){var xa=L[ii];if(xa.visible){var pa=xa.style?ga.applyStyle(xa.style,true):null;xa.draw(ga,ea,S,s,Ia[0]);pa&&ga.applyStyle(pa)}}ga.trigger("render",ea);S.trigger("drawComplete",ea,s);W.move(I,B,M,v,ab)}else W.move(I,Oa,Pa,v,ab);if(R||!c.inertia)fa=aa=0;else if(aa!=0||fa!=0){aa*=0.8;fa*=0.8;if(x(aa)<0.5)aa=0;if(x(fa)<0.5)fa=
0}if(Ia.length){for(ii=0;ii<Ia.length;ii++){s=Ia[ii];v=true;B=s?s.elements:[];M=void 0;if(s&&bb&&s.type==="hover"&&bb.type==="hover"){diffElements=Hits.diffHits(bb.elements,B);if(diffElements.length>0)Hits.triggerEvent(bb,S,"Out",diffElements);else v=false}if(B.length>0){ea=s.gridX;xa=s.gridY;for(M=B.length;R&&M--;){pa=B[M];var Eb=ea,Fb=xa,Gb=pa&&pa.drag&&(!pa.canDrag||pa.canDrag(pa,Eb,Fb));if(Gb){ca=pa;ca.startX=Eb;ca.startY=Fb}if(Gb)break}v&&Hits.triggerEvent(s,S)}bb=B.length>0?Q({},s):null}Ia=
[]}if(ub!==da){S.trigger("scaleChanged",da);ub=da}}}});return S},Ba=function(){return{tween:function(a,c,b,f,i){function k(q){var G=q-p;q=p+m<=q;for(var D=e;D--;)j[D]=l(G,a[D],g[D],m);i&&i.invalidate();if(q||h){Va.detach(k);for(D=0;D<d.length;D++)d[D]&&d[D](j,G,h)}}b=Q({easing:"sine.out",duration:1E3,complete:null},b);var e=a.length,j=[].concat(a),d=[f,b.complete],l=va(b.easing),g=[],h=false,m=b.duration,p=(new Date).getTime();for(b=e;b--;)g[b]=c[b]-a[b];Va.attach(k);return function(q){h=q;return j}},
tweenDrawable:function(a,c,b,f,i){var k=Ba.tween([b],[f],i,function(){a[c]=f;for(var j=a.tweens.length;j--;)if(a.tweens[j]===e){a.tweens.splice(j,1);break}},a.view),e=function(){a[c]=k()[0]};return e}}}(),Qa=function(a,c,b){b=Q({style:null,xy:null,size:20,fill:false,stroke:true,draggable:false,observable:true,properties:{},typeName:"Shape",zindex:0},b);Q(this,b);if($(this.xy,Fa))this.xy=new a.XY(this.xy);this.id="drawable_"+Mb++;this.bounds=null;this.view=a;this.layer=c;this.tweens=[];this.rotation=
this.animations=0;this.scaling=1;this.translateY=this.translateX=0;this.observable&&qa(this)};Qa.prototype={constructor:Qa,applyTweens:function(){for(var a=this.tweens.length;a--;)this.tweens[a]()},drag:null,draw:null,getProps:null,resync:function(){if(this.xy){this.xy.sync(this.view);if(this.size){var a=this.size>>1;this.updateBounds(new oa(this.xy.x-a,this.xy.y-a,this.size,this.size))}}},rotate:function(a,c,b){if($(a,Ga)){a=(b?a:this.rotation*za+a)*Ma;if(c)this.tweens.push(Ba.tweenDrawable(this,
"rotation",this.rotation,a,c));else{this.rotation=a;this.view.invalidate()}return this}else return this.rotation*za},scale:function(a,c,b){if($(a,Ga)){a=b?a:this.scaling*a;if(c)this.tweens.push(Ba.tweenDrawable(this,"scaling",this.scaling,a,c));else{this.scaling=a;this.view.invalidate()}return this}else return this.scaling},translate:function(a,c,b,f){if($(a,Ga)){a=f?a:this.translateX+a;c=f?c:this.translateY+c;if(b){this.tweens.push(Ba.tweenDrawable(this,"translateX",this.translateX,a,b));this.tweens.push(Ba.tweenDrawable(this,
"translateY",this.translateY,c,b))}else{this.translateX=a;this.translateY=c;this.view.invalidate()}return this}else return new ba(this.translateX,this.translateY)},updateBounds:function(a,c){a&&(!this.bounds||a.x!=this.bounds.x||a.y!=this.bounds.y)&&this.trigger("move",this,a,this.bounds);this.bounds=a;if(c)this.xy=this.bounds.center()}};wa("drawable","marker",function(a,c,b){b=Q({fill:true,stroke:false,markerType:"simple",hoverStyle:"highlight",typeName:"Marker"},b);return new Qa(a,c,b)});wa("drawable",
"poly",function(a,c,b){function f(){var g,h,m,p,q,G,D,P;d=b.simplify?j.simplify():j;P=d.points;for(g=P.length;g--;){h=P[g].x;m=P[g].y;G=$(G,Na)||h<G?h:G;D=$(D,Na)||m<D?m:D;p=$(p,Na)||h>p?h:p;q=$(q,Na)||m>q?m:q}l.updateBounds(new oa(G,D,p-G,q-D),true);l.trigger("pointsUpdate",l,P);a.invalidate()}function i(g){if($(g,"array")){var h;j=new ua(b.allowCull);h=j.points;yb.process(g,function(m,p){for(var q=0;q<p;q++)h.push(new a.XY(m[q]))},k,e);return l}else return d}function k(){j.points.length&&yb.process(j.points,
function(g,h){for(var m=h;m--;)g[m].sync(a)},f,e)}b=Q({allowCull:false,simplify:false,fill:true,points:[],typeName:"Poly"},b);var e=500,j=new ua(b.allowCull),d=new ua(b.allowCull),l=Q(new Qa(a,c,b),{line:i,resync:k});i(b.points);return l});wa("drawable","line",function(a,c,b){b.fill=false;b.allowCull=true;return Ua("drawable","poly",a,c,b)});wa("drawable","image",function(a,c,b){function f(){if(d&&d.width>0){if(!this.centerOffset)this.centerOffset=new ba(-d.width>>1,-d.height>>1);this.updateBounds(new oa(this.xy.x+
this.centerOffset.x,this.xy.y+this.centerOffset.y,d.width,d.height),false)}}function i(g){if(this.imageUrl=g){var h=this;jb(this.imageUrl,function(m,p){d=m;if(p){var q=l.layer?l.layer.view:null;q&&q.invalidate()}f.apply(h)})}}b=Q({image:null,imageUrl:null,centerOffset:null,typeName:"Image"},b);var k=Qa.prototype.resync,e=0,j=0,d=b.image,l=Q(new Qa(a,c,b),{changeImage:i,getProps:function(){this.bounds||f(this,d);return{image:d,x:this.xy.x+e,y:this.xy.y+j}},resync:function(g){k.call(this,g);f.call(this)}});
d||i.call(this,this.imageUrl);if(this.centerOffset){e=this.centerOffset.x;j=this.centerOffset.y}});wa("drawable","arc",function(a,c,b){b=Q({startAngle:0,endAngle:Math.PI*2,typeName:"Arc"},b);return new Qa(a,c,b)});Aa.prototype={constructor:Aa,clip:null,cycle:function(){},draw:function(){},hitGuess:null,remove:function(){this.view.trigger("layerRemove",this)}};wa("layer","tile",function(a,c,b,f){f=Q({generator:"osm",imageLoadArgs:{}},f);var i=Ua("generator",f.generator,a,f).run,k=null,e=[];c=Q(new Aa(a,
c,b,f),{draw:function(j,d,l){j.drawTiles&&j.drawTiles(d,k.search(d.buffer(128)),l.panSpeed<2)}});a.bind("resync",function(){var j=a&&a.zoom?a.zoom():0;e[j]||(e[j]=Sa(j));k=e[j]});a.bind("refresh",function(){k&&i(k,a.invalidate)});a.bind("reset",function(){k.clear()});return c});wa("layer","draw",function(a,c,b,f){function i(g,h,m,p){var q=this.dragOffset;if(!q)q=this.dragOffset=new a.XY(g.startX-this.xy.x,g.startY-this.xy.y);this.xy.x=h-q.x;this.xy.y=m-q.y;if(p){delete this.dragOffset;a.invalidate();
this.xy.sync(a,true);this.trigger("dragDrop")}return true}function k(g,h,m,p){if(j){p&&j.remove(p,h);j.insert(m,h)}}f=Q({zindex:10},f);var e=[],j,d,l=Q(new Aa(a,c,b,f),{itemCount:0,clear:function(){if(j){j.clear();e=[];l.trigger("cleared");l.itemCount=0;a.invalidate()}},create:function(g,h,m){h=Ua("drawable",g,a,l,h);if(m)e.unshift(h);else e[e.length]=h;h.resync();j&&h.bounds&&j.insert(h.bounds,h);h.bind("move",k);l.itemCount=e.length;l.trigger(g+"Added",h);return h},draw:function(g,h,m,p,q){m={};
p=j&&h?j.search(h):[];for(var G=p.length;G--;){var D=p[G],P=D.style||l.style,r,F,z=D.getProps?D.getProps(g):m;r=g["prep"+D.typeName];D.tweens.length>0&&D.applyTweens();F=g.applyTransform(D);if(z=r?r.call(g,D,h,q,z):null){if(q&&z.hit){q.elements.push(Hits.initHit(D.type,D,D.draggable?i:null));r=q.type+"Style";P=D[r]||l[r]||P}P=P?g.applyStyle(P,true):null;(r=D.draw||z.draw)&&r.call(D,z);P&&g.applyStyle(P)}F&&F.undo&&F.undo()}},find:function(){return[].concat(e)},hitGuess:function(g,h){return j&&j.search({x:g-
5,y:h-5,w:10,h:10}).length>0}});d=a.bind("resync",function(){j=Sa(a.zoom(),j);for(var g=e.length;g--;)e[g].resync()});a.bind("layerRemove",function(g,h){if(h===l){j=null;e=[];a.unbind("resync",d)}});return l});Ea.prototype={constructor:Ea};wa("control","zoombar",function(a,c,b,f){function i(t,u){var E=F[t]=W.create("div","t5-zoombar-button",{position:"absolute",background:k(t),"z-index":51,width:f.width+"px",height:f.buttonHeight+"px","margin-top":(u||0)+"px"});z.appendChild(E)}function k(t,u){return"url("+
f.images+") 0 -"+(h+p*3+(t||0)*l*3+(u||0)*l)+"px"}function e(t){return"url("+f.images+") 0 -"+(h+(t||0)*p)+"px"}function j(t,u){var E;if(t===m){m.style.background=e(u);E="thumb"}else for(var C=0;C<F.length;C++)if(t===F[C]){E="button"+C;F[C].style.background=k(C,u);break}return E}function d(t){if(t!==P){P=t;D=G-P/r*(G-q)|0;W.move(m,0,D-q);clearTimeout(o);o=setTimeout(function(){a.zoom(P)},500)}}f=Q({width:24,height:200,images:"img/zoom.png",align:"right",marginTop:10,spacing:10,thumbHeight:16,buttonHeight:16},
f);var l=f.buttonHeight,g,h=f.height,m,p=f.thumbHeight,q=f.spacing+l-(p>>1),G=f.height-l-(p>>1),D=q,P=-1;c=a.minZoom();var r=a.maxZoom()-c+1,F=[],z,o=0,w={button0:function(){a.zoom(a.zoom()+1)},button1:function(){a.zoom(a.zoom()-1)}};z=W.create("div","t5-zoombar",{position:"absolute",background:"url("+f.images+")","z-index":50,overflow:"hidden",width:f.width+"px",height:f.height+"px",margin:function(){var t=f.spacing,u=Z("{0}px 0 0 {1}px");if(f.align==="right")t=b.offsetWidth-f.width-f.spacing;return u(f.marginTop,
t)}()});b.childNodes[0]?b.insertBefore(z,b.childNodes[0]):b.appendChild(z);z.appendChild(m=W.create("div","t5-zoombar-thumb",{position:"absolute",background:e(),"z-index":51,width:f.width+"px",height:f.thumbHeight+"px",margin:"10px 0 0 0",top:D-q+"px"}));i(0);i(1,f.height-f.buttonHeight);g=INTERACT.watch(z,{bindTarget:z});g.bind("pointerMove",function(t,u,E){D=Math.min(Math.max(q,E.y-(p>>1)),G);d(r-(D-q)/G*r|0)});g.bind("pointerDown",function(t){j(t.target,2)});g.bind("pointerUp",function(t){j(t.target,
0)});g.bind("tap",function(t){(t=w[j(t.target,2)])&&t()});c=new Ea(a);c.bind("detach",function(){g.unbind();b.removeChild(z)});a.bind("zoom",function(t,u){d(u)});d(a.zoom());return c});wa("control","copyright",function(a,c,b,f){function i(){k(a.getCopy())}function k(j){if(e){e.innerHTML=j;j=e.style;var d;a.viewport();d=W.rect(b);var l=f.spacing,g=d.h-e.offsetHeight-f.spacing,h=Z("{0}px 0 0 {1}px");if(f.align==="right")l=d.w-e.offsetWidth-f.spacing;d=h(g,l);j.margin=d}}f=Q({align:"right",text:null,
spacing:5},f);var e;(function(){var j=W.rect(b),d=f.text||a.getCopy();e=W.create("div","t5-copyright",{position:"absolute",overflow:"hidden","max-width":Math.max(j.w>>1,Math.min(400,j.w-f.spacing*2))+"px","z-index":49});b.childNodes[0]?b.insertBefore(e,b.childNodes[0]):b.appendChild(e);d&&k(d)})();c=Q(new Ea(a),{getText:function(){return e?e.innerHTML:""},setText:k});c.bind("detach",function(){e&&b.removeChild(e)});f.text||a.bind("copyright",i);return c});Q(X,{ex:Q,log:Ja,observable:qa,configurable:fb,
formatter:Z,wordExists:function(a,c){for(var b=a.split(/\s|\,/).length;b--;)if(a.toLowerCase()==c.toLowerCase())return true;return false},is:$,indexOf:Da,fn:function(a){return Lb("fn",a)},project:gb,unproject:rb,getImage:jb,Registry:La,Style:zb,DOM:W,Rect:oa,XY:ba,GeoXY:na,Line:ua,Hits:Hits,Control:Ea,Tile:Ka,Tweener:Ba,ViewLayer:Aa,View:Hb,Map:function(a,c){function b(g,h){var m=l.viewport();if(g){m=K(g.bestZoomLevel(m.w,m.h)-1,h||0);return f(m).center(g.center())}else return new GeoJS.BBox((new na(m.x,
m.y2)).sync(l,true).pos(),(new na(m.x2,m.y)).sync(l,true).pos())}function f(g,h,m){if($(g,Ga)){g=K(c.minZoom,A(c.maxZoom,g|0));if(g!==e){var p=l.viewport(),q=l.offset(),G=p.w/2;p=p.h/2;var D=Y(2,g-e),P=G/D|0,r=p/D|0;e=g;l.offset(((h||q.x+G)-P)*D,((m||q.y+p)-r)*D);l.trigger("zoom",g);l.trigger("reset");k=l.rpp=la/(256<<e);l.setMaxOffset(la/k|0,la/k|0,true,false);l.scale(1+j,false,true);j=0;l.trigger("resync");l.refresh()}return l}else return e}c=Q({controls:["zoombar","copyright"],minZoom:1,maxZoom:18,
renderer:"canvas/dom",zoom:1,zoombar:{}},c);var i=new na,k,e=c.zoom||c.zoomLevel,j=0,d=0,l=Q(new Hb(a,c),{XY:na,bounds:b,zoom:f});k=l.rpp=la/(256<<e);l.bind("refresh",function(){var g=l.viewport();if(i.x!=g.x||i.y!=g.y){l.trigger("boundsChange",b());i.x=g.x;i.y=g.y}});l.bind("scaleChanged",function(g,h){var m=qb(h)/Math.LN2|0;if(m!==0){j=h-Y(2,m);clearTimeout(d);d=setTimeout(function(){f(e+m)},500)}});return l}});if(typeof module!="undefined"&&module.exports)module.exports=X;X.Decarta=function(){function a(r){return m(e.clientName,
e.clientPassword,e.sessionID,e.configuration,e.release,r)}function c(r,F){return p(r.maxResponses,r.version,r.requestID,r.methodName,F)}function b(r,F){e.server||X.log("No server configured for deCarta - we are going to have issues","warn");return q(e.server,r.requestID,escape(F))}function f(r,F,z){Ja("making request: "+a(c(r,r.getRequestBody())));Ya(b(r,a(c(r,r.getRequestBody()))),function(o){console.log(o.response);var w=o.response.XLS.Response;if(w.numberOfResponses>0&&w[r.methodName+"Response"]){o=
[];if(r.parseResponse)o=r.parseResponse(w[r.methodName+"Response"]);F&&F.apply(null,o)}else z&&z("Server returned no responses",o.response)})}function i(r,F){var z=new G({json:r.StreetAddress}),o=[];if(r.Place){if(!r.Place.length)r.Place=[r.Place];for(var w=r.Place.length;w--;)o[o.length]=r.Place[w].content}return{building:z.building,street:z.street,regions:o,countryCode:r.countryCode||"",postalCode:r.PostalCode||"",pos:F}}function k(r){if(!r)return"";r=r.toUpperCase();if(!l){var F=[],z;for(z in g)F.push(z);
l=RegExp("(\\s)("+F.join("|")+")(\\s|$)","i")}l.lastIndex=-1;if(F=l.exec(r))r=r.replace(l,"$1"+g[F[2]]);return r}var e={sessionID:(new Date).getTime(),server:"",clientName:"",clientPassword:"",configuration:"",maxResponses:25,release:"4.4.2sp03",tileFormat:"PNG",fixedGrid:true,useCache:true,tileHosts:[],requestTimeout:3E4,geocoding:{countryCode:"US",language:"EN"}};TL=function(){function r(z,o){if(typeof z=="number"){this.days=z||0;this.seconds=o||0}else if(typeof z!="undefined"){this.days=z.days||
0;this.seconds=z.seconds||0}}r.prototype={add:function(){for(var z=new r(this.days,this.seconds),o=arguments.length;o--;){z.days+=arguments[o].days;z.seconds+=arguments[o].seconds}return z},toString:function(){var z,o,w,t="";if(this.days)t=this.days+" days ";if(this.seconds){w=this.seconds;if(w>=3600){z=~~(w/3600);w-=z*3600}if(w>=60){o=Math.round(w/60);w-=o*60}if(z)t=t+z+(z>1?" hrs ":" hr ")+(o?(o>10?o:"0"+o)+" min ":"");else if(o)t=t+o+" min";else if(w>0)t=t+(w>10?w:"0"+w)+" sec"}return t}};var F=
function(){var z=/^P(\d+Y)?(\d+M)?(\d+D)?$/,o=/^(\d+H)?(\d+M)?(\d+S)?$/,w={8601:function(t){t=t.split("T");var u=null;u=null;var E=0,C=0;z.lastIndex=-1;u=z.exec(t[0]);E+=u[3]?parseInt(u[3].slice(0,-1),10):0;o.lastIndex=-1;u=o.exec(t[1]);C+=u[1]?parseInt(u[1].slice(0,-1),10)*3600:0;C+=u[2]?parseInt(u[2].slice(0,-1),10)*60:0;C+=u[3]?parseInt(u[3].slice(0,-1),10):0;return new r(E,C)}};return function(t,u){var E=w[u];if(!E)throw"No parser found for the duration format: "+u;return E(t)}}();return{Duration:r,
parse:F}}();var j=/^(\d+).*$/,d=/(\d+)\s?\-\s?(\d+)/,l=null,g={RD:"ROAD",ST:"STREET",CR:"CRESCENT",CRES:"CRESCENT",CT:"COURT",LN:"LANE",HWY:"HIGHWAY",MWY:"MOTORWAY"},h=1,m=Z("<xls:XLS version='1' xls:lang='en' xmlns:xls='http://www.opengis.net/xls' rel='{4}' xmlns:gml='http://www.opengis.net/gml'><xls:RequestHeader clientName='{0}' clientPassword='{1}' sessionID='{2}' configuration='{3}' />{5}</xls:XLS>"),p=Z("<xls:Request maximumResponses='{0}' version='{1}' requestID='{2}' methodName='{3}Request'>{4}</xls:Request>"),
q=Z("{0}/JSON?reqID={1}&chunkNo=1&numChunks=1&data={2}&responseFormat=JSON"),G=function(r){r=X.ex({json:{}},r);var F="",z="";if(r.json.Street)F=r.json.Street.content?r.json.Street.content:r.json.Street;F=F&&F.replace?F.replace(/\/\d+$/,""):"";if(r.json.Building)if(r.json.Building.number)z=r.json.Building.number;return{building:z,street:F,calcMatchPercentage:function(o){var w=0,t=k(o),u=k(F);if(r.json.Building){a:{var E=r.json.Building.number.toString();j.lastIndex=-1;if(j.test(o)){o=o.replace(j,"$1");
E=E.split(",");for(var C=0;C<E.length;C++){d.lastIndex=-1;if(d.test(E[C])){var H=d.exec(E[C]);if(o>=parseInt(H[1],10)&&o<=parseInt(H[2],10)){o=true;break a}}else if(o==E[C]){o=true;break a}}}o=false}if(o)w+=0.2}if(t&&u&&X.wordExists(t,u))w+=0.8;return w},toString:function(){if(F)return(z?z+" ":"")+F;return""}}},D=function(){return{methodName:"",maxResponses:25,version:"1.0",requestID:h++,getRequestBody:function(){return""},parseResponse:function(r){return[r]}}},P=function(){return X.ex(new D,{methodName:"RUOK",
parseResponse:function(r){return[{aliasCount:r.maxHostAliases,host:r.hostName}]}})};X.Registry.register("generator","decarta",function(r,F){function z(t,u){var E=r.zoom?r.zoom():0,C=r.viewport();if(E){var H=2<<E-1,U=H>>1,L=F.tileSize,T=(C.w/L|0)+1,I=(C.h/L|0)+1,N=(C.x/L|0)-U;C=H-(C.y/L|0)-U-I;var O=t.search({x:(U+N)*L,y:(U+C*-1-I)*L,w:T*L,h:I*L});H={};var ca=w.hosts,J;for(J=O.length;J--;)H[O[J].id]=true;for(O=0;O<=T;O++)for(J=0;J<=I;J++){var V=N+O,R=C+J-1,aa=V+"_"+R;if(!H[aa]){V=new X.Tile((U+N+O)*
L,(U+C*-1-J)*L,ca[O%ca.length]+"/openls/image-cache/TILE?LLMIN=0.0,0.0&LLMAX="+o[E]+"&CACHEABLE=true&DS=navteq-world&WIDTH=256&HEIGHT=256&CLIENTNAME="+w.clientName+"&SESSIONID="+w.sessionID+"&FORMAT=PNG&CONFIG="+w.configuration+"&N="+R+"&E="+V,L,L,aa);t.insert(V,V)}}u&&u()}}F=X.ex({tileSize:256},F);var o=["89.787438015348100000,360.00000000000000000","85.084059050110410000,180.00000000000000000","66.653475896509040000,90.00000000000000000","41.170427238429790000,45.000000000000000000","22.076741328793200000,22.500000000000000000",
"11.251819676168665000,11.250000000000000000","5.653589942659626000,5.625000000000000000","2.830287664051185000,2.812500000000000000","1.415581451872543800,1.406250000000000000","0.707845460801532700,0.703125000000000000","0.353929573271679340,0.351562500000000000","0.176965641673330230,0.175781250000000000","0.088482927761462040,0.087890625000000000","0.044241477246363230,0.043945312500000000","0.022120740293895182,0.021972656250000000","0.011060370355776452,0.010986328125000000","0.005530185203987857,0.005493164062500000",
"0.002765092605263539,0.002746582031250000","0.001382546303032519,0.001373291015625000","0.000691272945568983,0.000686645507812500","0.000345636472797214,0.000343322753906250"],w=e.tileConfig;r.addCopy("&copy; deCarta, Inc. Map and Imagery Data &copy; NAVTEQ or Tele Atlas or DigitalGlobe");return{run:function(t,u){if(w)z(t,u);else{var E=e.clientName.replace(/.*?\:/,"");X.Decarta.getTileConfig(E,function(C){w=C;z(t,u)})}},setTileConfig:function(t){w=t}}});X.Registry.register("service","geocoder",function(){var r=
X.formatter('<xls:GeocodeRequest><xls:Address countryCode="{0}" language="{1}">{2}</xls:Address></xls:GeocodeRequest>'),F=X.formatter('<xls:StreetAddress><xls:Building number="{0}" /><xls:Street>{1}</xls:Street></xls:StreetAddress>'),z=function(w,t){t=X.ex({countryCode:e.geocoding.countryCode,language:e.geocoding.language},t);var u=new D;return X.ex({},u,{methodName:"Geocode",getRequestBody:function(){var E=F(w.number,w.street);E+='<xls:Place type="Municipality">'+w.regions.join(" ")+"</xls:Place>";
return r(t.countryCode,t.language,E)},parseResponse:function(E){var C=E.GeocodeResponseList;E=[];var H=C?C.numberOfGeocodedAddresses:0,U=[];if(H>1)U=C.GeocodedAddress;else if(H==1)U=[C.GeocodedAddress];for(C=0;U&&C<U.length;C++){H=U[C];var L=null,T=null;if(H&&H.GeocodeMatchCode&&H.GeocodeMatchCode.matchType!=="NO_MATCH"){if(H&&H.Point)T=new GeoJS.Pos(H.Point.pos);if(H&&H.Address)L=i(H.Address,T)}(H=L)&&E.push(H)}return[E]}})},o=function(w){w=X.ex({position:null,geocodePreference:"StreetAddress"},
w);return X.ex(new D,{methodName:"ReverseGeocode",getRequestBody:function(){return"<xls:ReverseGeocodeRequest><xls:Position><gml:Point><gml:pos>"+w.position.toString()+"</gml:pos></gml:Point></xls:Position><xls:ReverseGeocodePreference>"+w.geocodePreference+"</xls:ReverseGeocodePreference></xls:ReverseGeocodeRequest>"},parseResponse:function(t){var u=null;if(t&&t.Point)u=new GeoJS.Pos(match.Point.pos);if(t&&t.ReverseGeocodedLocation&&t.ReverseGeocodedLocation.Address)return[i(t.ReverseGeocodedLocation.Address,
u)];return[]}})};typeof ADDR==="undefined"&&X.log("Sidelab addressing module not found, geocoder will not function","warn");return{forward:function(w,t){f(new z(w),function(u){t(w,u)})},reverse:function(w,t){var u=new o({position:w});f(u,function(E){t&&t(E)})}}});X.Registry.register("service","routing",function(){var r=function(F,z){z=X.ex({provideRouteHandle:false,distanceUnit:"KM",routeQueryType:"RMAN",preference:"Fastest",routeInstructions:true,routeGeometry:true},z);var o=new D,w=X.formatter('<xls:DetermineRouteRequest provideRouteHandle="{0}" distanceUnit="{1}" routeQueryType="{2}">'),
t=X.formatter("<xls:{0}><xls:Position><gml:Point><gml:pos>{1}</gml:pos></gml:Point></xls:Position></xls:{0}>");return X.ex({},o,{methodName:"DetermineRoute",getRequestBody:function(){if(F.length<2)throw Error("Cannot send RouteRequest, less than 2 waypoints specified");var u=w(z.provideRouteHandle,z.distanceUnit,z.routeQueryType);u+="<xls:RoutePlan>";u+="<xls:RoutePreference>"+z.preference+"</xls:RoutePreference>";u+="<xls:WayPointList>";for(var E=0;E<F.length;E++)u+=t(E===0?"StartPoint":E===F.length-
1?"EndPoint":"ViaPoint",F[E].toString());u+="</xls:WayPointList>";u+="</xls:RoutePlan>";if(z.routeInstructions)u+='<xls:RouteInstructionsRequest rules="maneuver-rules" providePoint="true" />';if(z.routeGeometry)u+="<xls:RouteGeometryRequest />";u+="</xls:DetermineRouteRequest>";return u},parseResponse:function(u){var E=u.RouteGeometry.LineString.pos,C=u.RouteInstructionsList;u=[];C=C&&C.RouteInstruction?C.RouteInstruction:[];for(var H=0;H<C.length;H++){var U=C[H].distance;u.push({text:C[H].Instruction,
latlng:C[H].Point,distance:U.value+(U.uom||"M").toUpperCase(),time:TL.parse(C[H].duration,"8601")})}return[E,u]}})};return{calculate:function(F,z,o,w){w=X.ex({preference:"Fastest"},w);F=new r(F,w);f(F,z,o)}}});return{applyConfig:function(r){X.ex(e,r)},getTileConfig:function(r,F){f(new P,function(z){var o=e.clientName.replace(/\:.*/,":"+(r||""));hosts=[];if(z.aliasCount)for(var w=0;w<z.aliasCount;w++)hosts[w]="http://"+z.host.replace("^(.*?).(.*)$","\u0001-0"+(w+1)+".\u0002");else hosts=["http://"+
z.host];F({hosts:hosts,clientName:o,sessionID:e.sessionID,configuration:e.configuration})})},setTileConfig:function(r){e.tileConfig=r},compareFns:function(){return{streetDetails:function(r,F){return F.calcMatchPercentage(r)},location:function(r,F){return F.calcMatchPercentage(r)}}}()}}()})();
