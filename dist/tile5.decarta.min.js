(function(sb){function K(){var a=arguments[0]||{},c=Array.prototype.slice.call(arguments,1),b=c.length,f,h;for(h=0;h<b;h++)if((f=c[h])!==null)for(var j in f){var i=f[j];if(a!==i)if(i!==undefined)a[j]=i}return a}function ka(a,c){if(typeof console!=="undefined")console[c||"debug"](a)}function ua(a){var c=a.match(Lb),b=[],f=0,h;for(h=c?c.length:0;h--;){var j=c[h].slice(1);b[j]||(b[j]=RegExp("\\{"+j+"\\}","g"))}f=b.length;return function(){var i=a;for(h=0;h<f;h++){var k=arguments[h];if(typeof k=="undefined")k=
"";i=i.replace(b[h],k)}return i}}function tb(a,c){var b=Ua*ha(a);return Va-2*ub(c*Ba((1-b)/(1+b),Ua/2))}function V(a,c){if(Q(a,oa)){var b=a.split(fb);this.x=parseFloat(b[0]);this.y=parseFloat(b[1])}else if(a&&a.x){this.x=a.x;this.y=a.y}else{this.x=a||0;this.y=c||0}}function Ka(a){this.allowCull=a}function va(a,c,b,f){this.mercX=b;this.mercY=f;if(Q(a,oa))K(this,Mb.parseXY(a));else a&&a.toPixels?K(this,a.toPixels()):V.call(this,a,c)}function wa(a,c,b,f){this.x=a||0;this.y=c||0;this.w=b||0;this.h=f||
0;this.x2=this.x+this.w;this.y2=this.y+this.h}function vb(a,c){var b=new wb(Math.sqrt(256<<a)|0);c&&c.zoomLevel===a&&c.copyInto(b);b.zoomLevel=a;return b}function gb(a,c,b,f,h,j){this.x=a;this.y=c;this.w=f||256;this.h=f||256;this.x2=this.x+this.w;this.y2=this.y+this.h;this.url=b;this.id=j||a+"_"+c;this.loaded=false;this.image=null}function Wa(a,c){c=K({id:"layer_"+Nb++,zindex:0,animated:false,style:null,minXY:null,maxXY:null,visible:true},c);this.visible=c.visible;this.view=a;xa(K(this,c))}function Xa(){xa(this)}
function Z(a,c){if(a&&a.split){var b=a.split(fb);if(b.length>1){a=b[0];c=b[1]}}else if(a&&a.lat){c=a.lon;a=a.lat}this.lat=parseFloat(a||0);this.lon=parseFloat(c||0)}function Fa(a,c){if(Q(a,xb)){for(var b=c,f=new Z(hb,Ya),h=new Z(Ob,yb),j=a.length;j--;){var i=a[j];if(i.lat<f.lat)f.lat=i.lat;if(i.lat>h.lat)h.lat=i.lat;if(i.lon<f.lon)f.lon=i.lon;if(i.lon>h.lon)h.lon=i.lon}this.min=f;this.max=h;if(Q(b,pa)){b=this.size();b=Ga(b.x,b.y)*0.3}this.min=new Z(f.lat-b,(f.lon-b)%360);this.max=new Z(h.lat+b,(h.lon+
b)%360)}else{this.min=a;this.max=c}}function ib(a){if(!Q(a,oa))this.meters=a}var Lb=/\{(\d+)(?=\})/g,Pb=function(){var a=1.70158,c=Math.PI/2,b=Math.abs,f=Math.pow,h=Math.sin,j=Math.asin,i=Math.cos,k={linear:function(e,o,d,n){return d*e/n+o},backin:function(e,o,d,n){return d*(e/=n)*e*((a+1)*e-a)+o},backout:function(e,o,d,n){return d*((e=e/n-1)*e*((a+1)*e+a)+1)+o},backinout:function(e,o,d,n){return(e/=n/2)<1?d/2*e*e*(((a*=1.525)+1)*e-a)+o:d/2*((e-=2)*e*(((a*=1.525)+1)*e+a)+2)+o},bouncein:function(e,
o,d,n){return d-k.bounceout(n-e,0,d,n)+o},bounceout:function(e,o,d,n){return(e/=n)<1/2.75?d*7.5625*e*e+o:e<2/2.75?d*(7.5625*(e-=1.5/2.75)*e+0.75)+o:e<2.5/2.75?d*(7.5625*(e-=2.25/2.75)*e+0.9375)+o:d*(7.5625*(e-=2.625/2.75)*e+0.984375)+o},bounceinout:function(e,o,d,n){return e<n/2?k.bouncein(e*2,0,d,n)/2+o:k.bounceout(e*2-n,0,d,n)/2+d/2+o},cubicin:function(e,o,d,n){return d*(e/=n)*e*e+o},cubicout:function(e,o,d,n){return d*((e=e/n-1)*e*e+1)+o},cubicinout:function(e,o,d,n){if((e/=n/2)<1)return d/2*e*
e*e+o;return d/2*((e-=2)*e*e+2)+o},elasticin:function(e,o,d,n,m,g){if(e==0)return o;if((e/=n)==1)return o+d;g||(g=n*0.3);if(!m||m<b(d)){m=d;d=g/4}else d=g/ba*j(d/m);return-(m*f(2,10*(e-=1))*h((e*n-d)*ba/g))+o},elasticout:function(e,o,d,n,m,g){var l;if(e==0)return o;if((e/=n)==1)return o+d;g||(g=n*0.3);if(!m||m<b(d)){m=d;l=g/4}else l=g/ba*j(d/m);return m*f(2,-10*e)*h((e*n-l)*ba/g)+d+o},elasticinout:function(e,o,d,n,m,g){var l;if(e==0)return o;if((e/=n/2)==2)return o+d;g||(g=n*0.3*1.5);if(!m||m<b(d)){m=
d;l=g/4}else l=g/ba*j(d/m);if(e<1)return-0.5*m*f(2,10*(e-=1))*h((e*n-l)*ba/g)+o;return m*f(2,-10*(e-=1))*h((e*n-l)*ba/g)*0.5+d+o},quadin:function(e,o,d,n){return d*(e/=n)*e+o},quadout:function(e,o,d,n){return-d*(e/=n)*(e-2)+o},quadinout:function(e,o,d,n){if((e/=n/2)<1)return d/2*e*e+o;return-d/2*(--e*(e-2)-1)+o},sinein:function(e,o,d,n){return-d*i(e/n*c)+d+o},sineout:function(e,o,d,n){return d*h(e/n*c)+o},sineinout:function(e,o,d,n){return-d/2*(i(Math.PI*e/n)-1)+o}};return function(e){e=e.replace(/[\-\_\s\.]/g,
"").toLowerCase();return k[e]||k.linear}}(),xa=function(){function a(b,f){var h=b.hasOwnProperty("obsHandlers")?b.obsHandlers:null;h[f]||(h[f]=[]);return h[f]}var c=0;return function(b){if(!b)return null;if(!(b.hasOwnProperty("obsHandlers")?b.obsHandlers:null))b.obsHandlers={};if(!b.hasOwnProperty("bind")){b.bind=function(f,h){var j="callback"+c++;a(b,f).unshift({fn:h,id:j});return j};b.triggerCustom=function(f,h){var j=a(b,f),i={cancel:false,name:f,source:this},k;for(k in h)i[k]=h[k];if(!j)return null;
k=Array.prototype.slice.call(arguments,2);b.eventInterceptor&&b.eventInterceptor(f,i,k);k.unshift(i);for(var e=j.length;e--&&!i.cancel;)j[e].fn.apply(this,k);return i};b.trigger=function(f){var h=Array.prototype.slice.call(arguments,1);h.splice(0,0,f,null);return b.triggerCustom.apply(this,h)};b.unbind=function(f,h){if(typeof f==="undefined")b.obsHandlers={};else for(var j=a(b,f),i=0;j&&i<j.length;i++)if(j[i].id===h){j.splice(i,1);break}return b}}return b}}(),zb=function(){function a(c,b,f,h){if(typeof c[h]==
"undefined")c[h]=function(j){if(typeof j!="undefined"){b[h]=j;f[h]&&f[h](j);return c}else return b[h]}}return function(c,b,f){b=b||c;for(var h in b)typeof b[h]!="function"&&a(c,b,f,h);return c}}(),jb=Array.prototype.indexOf||function(a){for(var c=0;c<this.length;c++)if(this[c]===a)return c;return-1},Q=function(){var a={NaN:1,Infinity:1,"-Infinity":1},c=String.prototype.toLowerCase,b=Object.prototype.toString;return function(f,h){h=c.call(h);if(h=="finite")return!a.hasOwnProperty(+f);return h=="null"&&
f===null||h==typeof f||h=="object"&&f===Object(f)||h=="array"&&Array.isArray&&Array.isArray(f)||b.call(f).slice(8,-1).toLowerCase()==h}}(),Qb=function(){function a(j){var i=document.createElement("script"),k=false;i.src=j;i.async=true;i.onload=i.onreadystatechange=function(){if(!k&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){k=true;i.onload=i.onreadystatechange=null;i&&i.parentNode&&i.parentNode.removeChild(i)}};h||(h=document.getElementsByTagName("head")[0]);h.appendChild(i)}
function c(j,i,k){j+=j.indexOf("?")>=0?"&":"?";var e="json"+ ++f;window[e]=function(o){i(o);window[e]=null;try{delete window[e]}catch(d){}};a(j+(k?k:"callback")+"="+e);return e}function b(j,i,k){var e=require("request");j=j+(j.indexOf("?")>=0?"&":"?")+(k?k:"callback")+"=cb";e({uri:j},function(o,d,n){o=n.replace(/^.*\(/,"").replace(/\).*$/,"");i(JSON.parse(o))})}var f=0,h;return typeof window!="undefined"?c:b}();INTERACT=function(){function a(m){return function(g,l){m.addEventListener(g,l,false)}}
function c(m){return function(g,l){m.removeEventListener(g,l,false)}}function b(m){return function(g,l){m.attachEvent("on"+g,l)}}function f(m,g){return{x:m?m:0,y:g?g:0,count:1}}function h(m,g){d.push(K({handler:null,checks:{},type:m},g))}function j(m){var g=0,l=0;if(m.offsetParent){do{g+=m.offsetLeft;l+=m.offsetTop;m=m.offsetParent}while(m)}return{left:g,top:l}}function i(m,g){return{source:m,target:g.target?g.target:g.srcElement}}function k(m,g){for(var l=m.target?m.target:m.srcElement;l&&l!==g;)l=
l.parentNode;return l&&l===g}function e(m,g){return{x:m.x-(g?g.left:0),y:m.y-(g?g.top:0)}}function o(m,g){if(m.preventDefault){m.preventDefault();m.stopPropagation()}else if(typeof m.cancelBubble!="undefined")m.cancelBubble=true;g&&m.stopImmediatePropagation&&m.stopImmediatePropagation()}var d=[],n=function(m,g,l){l=K({binder:null,unbinder:null,observable:null},l);for(var t=l.observable,u=[],x,v,B={bind:function(){return t.bind.apply(null,arguments)},unbind:function(){t.unbind();for(p=0;p<u.length;p++)u[p].unbind();
return B}},p=0;p<g.length;p++)u.push(g[p](m,t,l));t.bind("pointerDown",function(){v=x=0});t.bind("pointerMove",function(w,A,r,C){x+=C.x||0;v+=C.y||0});t.bind("pointerUp",function(w,A,r){Math.abs(x)>20||Math.abs(v)>20||t.triggerCustom("tap",w,A,r)});return B};h("pointer",{handler:function(m,g,l){function t(y){if(y.pageX&&y.pageY)return f(y.pageX,y.pageY);else{var E=document.documentElement,O=document.body;return f(y.clientX+(E&&E.scrollLeft||O&&O.scrollLeft||0)-(E&&E.clientLeft||O&&O.clientLeft||0),
y.clientY+(E&&E.scrollTop||O&&O.scrollTop||0)-(E&&E.clientTop||O&&O.clientTop||0))}}function u(y){if(k(y,m))if(C=p(y)){var E=t(y);m.style.cursor="move";o(y,true);P=E.x;R=E.y;D=f(P,R);g.triggerCustom("pointerDown",i("mouse",y),D,e(D,j(m)))}}function x(y){var E=t(y);G=E.x;F=E.y;if(k(y,m))w(y,C?"pointerMove":"pointerHover")}function v(y){if(C&&p(y)){C=false;if(k(y,m)){m.style.cursor="default";w(y,"pointerUp")}}}function B(y){if(k(y,m)){var E;y=y||window.event;if(y.detail){if(typeof y.axis=="undefined"||
y.axis===2)E=-y.detail*A}else{E=y.wheelDeltaY?y.wheelDeltaY:y.wheelDelta;if(window.opera)E=-E}if(E){var O=f(G,F);g.triggerCustom("zoom",i("mouse",y),O,e(O,j(m)),E/r,"wheel");o(y);y.returnValue=false}}}function p(y){y=y||window.event;return(y.which||y.button)==1}function w(y,E,O,ca,qa){O=typeof O!="undefined"?O:G;ca=typeof ca!="undefined"?ca:F;var H=O-P,M=ca-R,L=f(O,ca);g.triggerCustom(E,i("mouse",y),L,e(L,j(m)),f(H,M));if(typeof qa=="undefined"||qa){P=O;R=ca}}l=K({},l);var A=120,r=A*8,C=false,D,G,
F,P,R;l.binder("mousedown",u);l.binder("mousemove",x);l.binder("mouseup",v);l.binder("dblclick",function(y){ka("captured double click");if(k(y,m)){var E=t(y);g.triggerCustom("doubleTap",i("mouse",y),E,e(E,j(m)))}});l.binder("mousewheel",B);l.binder("DOMMouseScroll",B);return{unbind:function(){l.unbinder("mousedown",u);l.unbinder("mousemove",x);l.unbinder("mouseup",v);l.unbinder("mousewheel",B);l.unbinder("DOMMouseScroll",B)}}},checks:{touch:false}});h("pointer",{handler:function(m,g,l){function t(H){if(H.count<
2)return 0;var M=H.x-H.next.x;H=H.y-H.next.y;return~~Math.sqrt(M*M+H*H)}function u(H,M,L){M=M?M:0;L=L?L:0;for(var da={x:H.x-M,y:H.y-L,id:H.id,count:H.count},S=da;H.next;){H=H.next;S=S.next={x:H.x-M,y:H.y-L,id:H.id}}return da}function x(H,M){var L=H[M?M:"touches"],da,S;if(L.length===0)return null;S=da={x:L[0].pageX,y:L[0].pageY,id:L[0].identifier,count:L.length};for(var T=1,Ca=L.length;T<Ca;T++)S=S.next={x:L[T].pageX,y:L[T].pageY,id:L[T].identifier};return da}function v(H){if(k(H,m)){F=j(m);var M=
x(H,"changedTouches"),L=u(M,F.left,F.top);if(!R){P=C;g.triggerCustom("pointerDown",i("touch",H),M,L)}ca&&g.triggerCustom("pointerDownMulti",i("touch",H),M,L);R=x(H);if(R.count>1)E=t(R);qa=1;O=u(R)}}function B(H){if(k(H,m)){o(H);y=x(H);if(P==C)P=Math.abs(R.x-y.x)>A||Math.abs(R.y-y.y)>A?r:C;if(P!=C){P=y.count>1?G:D;if(P==G)if(R.count===1){R=u(y);E=t(R)}else{var M=t(y);if(Math.abs(E-M)<w)P=D;else{var L;L=y.x;var da=y.next.x,S=y.y,T=y.next.y;L={x:(L<da?L:da)+(Math.abs(L-da)>>1),y:(S<T?S:T)+(Math.abs(S-
T)>>1)};M=M/E;da=M-qa;g.triggerCustom("zoom",i("touch",H),L,e(L,F),da,"pinch");qa=M}}P==D&&g.triggerCustom("pointerMove",i("touch",H),y,u(y,F.left,F.top),f(y.x-O.x,y.y-O.y));ca&&g.triggerCustom("pointerMoveMulti",i("touch",H),y,u(y,F.left,F.top))}O=u(y)}}function p(H){if(k(H,m)){var M=x(H,"changedTouches"),L=u(M,F.left,F.top);y=x(H);if(!y){g.triggerCustom("pointerUp",i("touch",H),M,L);R=null}ca&&g.triggerCustom("pointerUpMulti",i("touch",H),M,L)}}l=K({detailed:false,inertia:false},l);var w=20,A=7,
r=0,C=1,D=2,G=3,F,P,R,y,E,O,ca=l.detailed,qa=1;l.binder("touchstart",v);l.binder("touchmove",B);l.binder("touchend",p);ka("initialized touch handler");return{unbind:function(){l.unbinder("touchstart",v);l.unbinder("touchmove",B);l.unbinder("touchend",p)}}},checks:{touch:true}});return{register:h,watch:function(m,g,l){g=K({bindTarget:null,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},g);capabilities=K({touch:"ontouchstart"in window},l);if(!g.observable){ka("creating observable");
g.observable=xa({});globalOpts=g}g.binder=(g.isIE?b:a)(g.bindTarget||document);g.unbinder=(g.isIE?b:c)(g.bindTarget||document);l=g.types;for(var t=capabilities,u=[],x=d.length;x--;){var v=d[x],B=!l||l.indexOf(v.type)>=0,p=true,w;for(w in v.checks){var A=v.checks[w];ka("checking "+w+" capability. require: "+A+", capability = "+t[w]);p=p&&A===t[w]}if(B&&p)u[u.length]=v.handler}return new n(m,u,g)}}}();var I=xa({}),Za=function(){var a={};return{create:function(c,b){if(a[c][b])return a[c][b].apply(null,
Array.prototype.slice.call(arguments,2));throw Rb(c,b);},get:function(c,b){return a[c]?a[c][b]:null},register:function(c,b,f){a[c]||(a[c]={});a[c][b]&&ka(Sb(c,b),"warn");a[c][b]=f}}}(),Sb=ua("Registration of {0}: {1} will override existing definition"),Rb=ua("Could not create {0} of type: {1}");ua("Could not create drawable of type: {0}");var kb=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],ba=Math.PI*2,Va=Math.PI/2,$=Math.PI/180,la=180/Math.PI,hb=90,
Ob=-hb,Ya=180,yb=-Ya,lb=hb*$,Ab=-lb,Bb=Ya*$,Tb=-Bb,Ua=0.08181919084262157,ma=Math.abs,Cb=Math.ceil,La=Math.round,Ma=Math.min,Ga=Math.max,Ba=Math.pow,mb=Math.sqrt,Da=Math.log,ha=Math.sin,Db=Math.asin,ya=Math.cos,ub=Math.atan,Ub=Math.atan2,pa="undefined",oa="string",Vb="object",ra="number",xb="array",fa=Za.register,za=Za.create,Wb=Za.get,Xb=0,Nb=0,fb=/[\,\s]+/,Ha=function(){function a(i){h++;i=i||(new Date).getTime();for(var k=f.length;k--;){var e=f[k];h%e.every===0&&e.cb(i)}j&&animFrame(a)}var c=1E3/
60,b=["r","webkitR","mozR","oR","msR"],f=[],h=0,j=U&&function(){for(var i=0;i<b.length;i++)window.animFrame=window.animFrame||window[b[i]+"equestAnimationFrame"];return animFrame}();j?animFrame(a):setInterval(a,1E3/60);return{attach:function(i,k){f[f.length]={cb:i,every:k?La(k/c):1}},detach:function(i){for(var k=f.length;k--;)if(f[k].cb===i){f.splice(k,1);break}}}}(),Mb=function(){var a=/^xy\((.*)\).*$/i;return{parseXY:function(c){if(!a.test(c)){c=c.split(fb);return $a(c[1],c[0])}}}}(),U=typeof window!=
"undefined"?function(){function a(h){for(var j=0;j<h.length;j++){var i=h[j];if(U&&typeof document.body.style[i]!="undefined")return i}}var c={"-webkit-user-select":"none",position:"absolute"},b,f;b=a(["-webkit-transform","MozTransform"]);css3DTransformProp=a(["WebkitPerspective","MozPerspective"]);f=a(["-webkit-transform-origin","MozTransformOrigin"]);return{transforms:Q(b,oa),create:function(h,j,i){h=document.createElement(h);var k=[];i=i||{};h.className=j||"";for(var e in i)k[k.length]=e+": "+i[e];
h.style.cssText=k.join(";");return h},move:function(h,j,i,k,e){if(b){h.style[b]="translate("+j+"px, "+i+"px) "+(k||[]).join(" ");if(e&&f)h.style[f]=e.x+"px "+e.y+"px"}else{h.style.left=j+"px";h.style.top=i+"px"}},styles:function(h){return K({},c,h)}}}():null,Eb=function(){function a(){for(var h=f.length,j=h;j--;)try{f[j](h)}catch(i){ka(i.toString(),"error")}}var c=20,b=50,f=[];return{process:function(h,j,i,k){function e(n){n=(o||b)/n;if(d<h.length){var m=h.slice(d,d+n);n=m.length;var g=o?0:(new Date).getTime();
j(m,n);if(!o){o=(m=((new Date).getTime()-g)/n)?c/m|0:h.length;ka("calculated that we can process "+o+" items per cycle")}d+=n}else{for(n=f.length;n--;)if(f[n]===e){f.splice(n,1);break}f.length===0&&Ha.detach(a);i&&i()}}var o,d=0;if(h.length>(k||0))f.push(e)===1&&Ha.attach(a);else{j(h,h.length);i&&i()}}}}(),$a=$a||function(a,c){var b=parseFloat(c)*$;b=ha(b);var f=Ua*b;b=Da((1+b)/(1-b)*Ba((1-f)/(1+f),Ua))/2;return new va(0,0,parseFloat(a)*$,b)},nb=nb||function(a,c){for(var b=Ba(Math.E,-c),f=Va-2*ub(b),
h=tb(f,b),j=0;j<12&&ma(f-h)>1.0E-7;){f=h;h=tb(f,b);j++}return new Z(h*la,a%360*la)};V.prototype={constructor:V,add:function(){for(var a=this.x,c=this.y,b=arguments.length;b--;){a+=arguments[b].x;c+=arguments[b].y}return this.copy(a,c)},copy:function(a,c){var b=K({},this);b.x=a||b.x;b.y=c||b.y;return b},equals:function(a){return this.x===a.x&&this.y===a.y},offset:function(a,c){return this.copy(this.x+a,this.y+c)},relative:function(a){a=a.viewport();return this.copy(this.x-a.x-a.padding.x,this.y-a.y-
a.padding.y)},rotate:function(a,c){c=c||new V(0,0);var b=this.x-c.x,f=this.y-c.y;return new V(c.x+ya(a)*b+-ha(a)*f,c.y+ha(a)*b+ya(a)*f)},scale:function(a,c){c=c||new V(0,0);return new V(c.x+(this.x-c.x)*a,c.y+(this.y-c.y)*a)},sync:function(){return this},toString:function(){return this.x+", "+this.y}};Ka.prototype=K([],{cull:function(a){if(this.allowCull){var c=a.x,b=a.y,f=a.x+a.w;a=a.y+a.h;for(var h=Infinity,j=0,i,k=this.length;k--;)if(i=this[k].x>=c&&this[k].x<=f&&this[k].y>=b&&this[k].y<=a){h=
k<h?k:h;j=k>j?k:j}return this.slice(Ga(h-1,0),Ma(j+1,this.length))}return this},simplify:function(a){a=a||3;for(var c=new Ka(this.allowCull),b=null,f=this.length;f--;){var h=this[f];if(include=!b||f===0||ma(h.x-b.x)+ma(h.y-b.y)>a){c.unshift(h);b=h}}return c}});va.prototype=K(new V,{constructor:va,pos:function(){return nb(this.mercX,this.mercY)},sync:function(a,c){var b;if(!(b=a.rpp)){b=a.zoom();b=ba/(256<<b)}b=b;if(c){this.mercX=this.x*b-Math.PI;this.mercY=Math.PI-this.y*b}else{this.x=La(((this.mercX||
0)+Math.PI)/b);this.y=La((Math.PI-(this.mercY||0))/b)}return this}});wa.prototype={constructor:wa,buffer:function(a,c){return new wa(this.x-a,this.y-(c||a),this.w+a*2,this.h+(c||a)*2)},center:function(){return new V(this.x+(this.w>>1),this.y+(this.h>>1))}};Hits=function(){return{diffHits:function(a,c){var b=[],f={},h;for(h=c.length;h--;)f[c[h].target.id]=true;for(h=a.length;h--;)f[a[h].target.id]||(b[b.length]=a[h]);return b},init:function(a,c,b,f,h){return{type:a,x:h.x,y:h.y,gridX:f.x|0,gridY:f.y|
0,elements:[],absXY:c,relXY:b}},initHit:function(a,c,b){return{type:a,target:c,drag:b}},triggerEvent:function(a,c,b,f){c.triggerCustom(a.type+(b?b:"Hit"),{hitType:a.type},f?f:a.elements,a.absXY,a.relXY,new va(a.gridX,a.gridY))}}}();var wb=function(a){function c(j,i){var k=b[j],e;k||(k=b[j]=[]);(e=k[i])||(e=k[i]=[]);return e}a=a||128;var b=[],f={},h=0;return{copyInto:function(j){for(var i in f){var k=f[i];j.insert(k.bounds||k,k,i)}},insert:function(j,i,k){var e=j.x/a|0,o=j.y/a|0,d=(j.x+j.w)/a|0;j=
(j.y+j.h)/a|0;k=k||i.id||"obj_"+h++;f[k]=i;for(i=e;i<=d;i++)for(e=o;e<=j;e++)c(i,e).push(k)},remove:function(j,i,k){k=k||i.id;if(f[k]){var e=j.x/a|0;i=j.y/a|0;var o=(j.x+j.w)/a|0;j=(j.y+j.h)/a|0;delete f[k];for(e=e;e<=o;e++)for(var d=i;d<=j;d++){var n=c(e,d),m=jb.call(n,k);m>=0&&n.splice(m,1)}}},search:function(j){var i=j.y/a|0,k=(j.x+j.w)/a|0,e=(j.y+j.h)/a|0,o=[],d=[];for(j=j.x/a|0;j<=k;j++)for(var n=i;n<=e;n++)o=o.concat(c(j,n));o.sort();for(i=o.length;i--;){k=o[i];if(e=f[k])d[d.length]=e;for(;i>
0&&o[i-1]==k;)i--}return d}}},ab=function(){var a={},c=0;(new Date).getTime();var b={},f=[];Ha.attach(function(h){h=h||(new Date).getTime();for(var j=0;j<f.length;){var i=f[j],k=b[i],e=b[i].image&&b[i].image.complete&&b[i].image.width>0,o=h-k.start;o=e||o>=3E4;if(e){e=k.callbacks;a[i]=k.image;for(var d=0;d<e.length;d++)e[d](k.image,true)}if(o){f.splice(j,1);delete b[i]}else j++}},250);return function(h,j){var i=h&&j?a[h]:null;if(i&&i&&i.complete&&i.width>0)j(i);else if(i=b[h])i.callbacks.push(j);
else{i=new Image;i.id="_ldimg"+ ++c;b[h]={start:(new Date).getTime(),image:i,callbacks:[j]};i.src=h;f[f.length]=h}}}();gb.prototype={constructor:gb,load:function(a){var c=this;ab(this.url,function(b){c.loaded=true;c.image=b;a&&a()})}};var Yb=function(){return xa({fastpan:true,applyStyle:function(){},applyTransform:function(a,c,b){return{restore:null,x:c,y:b}},getDimensions:function(){return{width:0,height:0}},getViewport:function(){},hitTest:function(){return false},prepare:function(){},projectXY:null,
reset:function(){}})};fa("renderer","canvas",function(a,c,b,f,h){function j(p,w,A){var r,C;g[w]=function(D){for(r=v.length;r--;)if(C=A[v[r]])D[B[r]]=C}}function i(p,w,A){return{draw:A||x,viewport:p,hit:w&&d.isPointInPath(w.x,w.y),vpX:n,vpY:m,context:d}}f=K({},f);var k,e,o,d,n=0,m=0,g={},l=null,t={},u=function(){},x=function(){this.fill&&d.fill();this.stroke&&d.stroke()},v=["fill","stroke","lineWidth","opacity"],B=["fillStyle","strokeStyle","lineWidth","globalAlpha"];(function(){function p(r,C){this.save();
this.setTransform(1,0,0,1,0,0);var D=this.isPointInPath_old(r,C);this.restore();return D}var w=CanvasRenderingContext2D.prototype,A=document.createElement("canvas").getContext("2d");A.translate(50,0);A.moveTo(125,50);A.arc(100,50,25,0,360,false);if(!A.isPointInPath(150,50)){w.isPointInPath_old=w.isPointInPath;w.isPointInPath=p}})();if(c){k=c.offsetWidth;e=c.offsetHeight;o=U?U.create("canvas",null,{position:"absolute","z-index":1}):new Canvas;o.width=k;o.height=e;a.attachFrame(o,true);d=null}b=K(h,
{applyStyle:function(p){var w=g[p],A=d&&d.canvas?d.canvas.id:"default",r;t[A]||(t[A]=[]);r=t[A].pop()||"reset";if(w){t[A].push(p);w(d);return r}},applyTransform:function(p){if(p.translateX!==0||p.translateY!==0||p.scaling!==1||p.rotation!==0){d.save();l={undo:function(){d.restore();l=null},x:p.xy.x,y:p.xy.y};d.translate(p.xy.x-n+p.translateX,p.xy.y-m+p.translateY);p.rotation!==0&&d.rotate(p.rotation);p.scaling!==1&&d.scale(p.scaling,p.scaling)}return l},drawTiles:function(p,w,A){for(var r=w.length;r--;){p=
w[r];if(!p.loaded&&A)p.load(a.invalidate);else p.image&&d.drawImage(p.image,p.x-n,p.y-m)}},prepare:function(p,w){var A,r=false;if(d)d.restore();else d=o.getContext("2d");for(A=p.length;A--;)r=r||p[A].clip;n=w.x;m=w.y;if(d){r||d.clearRect(0,0,k,e);d.save()}d.globalCompositeOperation="source-over";return d},prepArc:function(p,w,A){d.beginPath();d.arc(p.xy.x-(l?l.x:n),p.xy.y-(l?l.y:m),p.size>>1,p.startAngle,p.endAngle,false);return i(w,A)},prepImage:function(p,w,A,r){var C=(r.x||p.xy.x)-(l?l.x:n),D=
(r.y||p.xy.y)-(l?l.y:m),G=r.image||p.image;if(G){d.beginPath();d.rect(C,D,r.width||G.width,r.height||G.height);return i(w,A,function(){d.drawImage(G,C,D,r.width||G.width,r.height||G.height)})}},prepMarker:function(p,w,A){var r=p.xy.x-(l?l.x:n),C=p.xy.y-(l?l.y:m),D=p.size,G=undefined;d.beginPath();switch(p.markerType.toLowerCase()){case "image":G=u;d.rect(r-(D>>1),C-(D>>1),D,D);if(p.reset&&p.image){p.image=null;p.reset=false}p.image?d.drawImage(p.image,r-(D>>1),C-(D>>1),D,D):ab(p.imageUrl,function(F){p.image=
F;d.drawImage(p.image,r-(D>>1),C-(D>>1),D,D)});break;default:d.moveTo(r,C);d.lineTo(r-(D>>1),C-D);d.lineTo(r+(D>>1),C-D);d.lineTo(r,C)}return i(w,A,G)},prepPoly:function(p,w,A,r){var C=true;p=r.points||p.points().cull(w);r=l?l.x:n;var D=l?l.y:m;d.beginPath();for(var G=p.length;G--;){var F=p[G].x-r,P=p[G].y-D;if(C){d.moveTo(F,P);C=false}else d.lineTo(F,P)}return i(w,A)},getContext:function(){return d}});(function(){Fb.each(function(p,w){j(null,p,w)});I.bind("styleDefined",j)})();b.bind("detach",function(){c.removeChild(o)});
b.bind("resize",function(){});return b});fa("renderer","dom",function(a,c,b,f,h){function j(d){var n=d.image=new Image;e[d.id]=d;n.src=d.url;n.onload=function(){if(o[d.id])k.appendChild(this);else d.image=null};n.style.cssText="-webkit-user-select: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute;";
return n}function i(d,n,m){var g=[],l;for(l in d){var t=d[l];if(m?t[m]:!n[l]){if(t.image&&t.image.parentNode){k.removeChild(t.image);t.image=null}g[g.length]=l}}for(n=g.length;n--;)delete d[g[n]]}var k=null,e={},o={};k=U.create("div","",U.styles({width:c.offsetWidth+"px",height:c.offsetHeight+"px"}));c.childNodes.length>0?c.insertBefore(k,c.childNodes[0]):c.appendChild(k);a.attachFrame(k);b=K(h,{drawTiles:function(d,n,m){for(var g,l=d.x,t=d.y,u=n.length;u--;){d=n[u];if(d.url){(g=d.image||(m?j(d):
null))&&U.move(g,d.x-l,d.y-t);o[d.id]=d}}}});b.bind("predraw",function(){i(e,o);o={}});b.bind("detach",function(){c.removeChild(k)});a.bind("reset",function(){for(i(e,o={});k.childNodes.length>0;)k.removeChild(k.childNodes[0])});return b});var Fb=function(){function a(b,f){if(Q(b,oa)){I.trigger("styleDefined",b,c[b]=f);return b}else{var h=[],j;for(j in b)h[h.length]=a(j,b[j]);return h}}var c={};a({reset:{fill:"#ffffff",opacity:1},highlight:{fill:"#ff0000"},waypoints:{lineWidth:4,stroke:"#003377",
fill:"#ffffff"},waypointsHover:{lineWidth:4,stroke:"#ff0000",fill:"#ffffff"}});return{resetStyle:"reset",each:function(b){for(var f in c)b(f,c[f])},get:function(b){return c[b]},define:a}}();fa("view","view",function(a){function c(q,s,z,J){q=C?Ga(W+Ba(2,J)-1,0.125):J>0?2:0.5;p(q,false,true)}function b(q,s){var z=X&&X.projectXY?X.projectXY(q,s):null;if(!z){z=x();var J=1/W;z=new N.XY(z?z.x+q*J:q,z?z.y+s*J:s)}return z.sync(N,true)}function f(q,s,z){w("doubleTap",s,z,b(z.x,z.y));a.scalable&&p(2,{easing:"quad.out",
duration:300},true)}function h(q,s,z){O=null;H=true;t("down",s,z)}function j(q,s,z){t("hover",s,z)}function i(q,s,z,J){m(s,z,false);if(!O){M=J.x;L=J.y}}function k(q,s,z){m(s,z,true);H=false}function e(){clearTimeout(Gb);Gb=setTimeout(function(){if(E)if(E.offsetWidth!==Na*2||E.offsetHeight!==Oa*2){var q=u();l(a.container);u(q.x,q.y)}},250)}function o(q,s,z){t("tap",s,z);N.trigger("tap",s,z,b(z.x,z.y,true))}function d(){ia&&ia.unbind();if(U&&X){ia=INTERACT.watch(X.interactTarget||E);if(a.scalable){ia.bind("zoom",
c);ia.bind("doubleTap",f)}ia.bind("pointerDown",h);ia.bind("pointerMove",i);ia.bind("pointerUp",k);a.captureHover&&ia.bind("pointerHover",j);ia.bind("tap",o)}}function n(q){if(X){X.trigger("detach");X=null}var s=N,z=R,J=E,Y=a;q=q.split("/");for(var aa=new Yb(s,z,J,Y),sa=0;sa<q.length;sa++)aa=za("renderer",q[sa],s,z,J,Y,aa);X=aa;qa=U&&X.fastpan&&U.transforms;C=U&&U.transforms&&a.useTransforms;d();N.trigger("reset");B()}function m(q,s,z){if(O){q=b(s.x,s.y);O.drag.call(O.target,O,q.x,q.y,z)&&ea++;if(z)O=
null}}function g(q){for(var s=P;s--;)if(F[s].id===q)return s;return P}function l(q){if(U){E=document.getElementById(q);E.appendChild(y=U.create("div","",U.styles({overflow:"hidden",width:E.offsetWidth+"px",height:E.offsetHeight+"px"})));q=a.padding;if(q===r){q=E.offsetWidth;var s=E.offsetHeight,z=mb(q*q+s*s);ja=new V(z-q>>1,z-s>>1)}else ja=new V(q,q);bb=y.offsetWidth+ja.x*2;cb=y.offsetHeight+ja.y*2;ob=bb/2;pb=cb/2;Na=E.offsetWidth/2;Oa=E.offsetHeight/2;Pa=new V(ob,pb);y.appendChild(R=U.create("div",
"",U.styles({width:bb+"px",height:cb+"px","z-index":2,margin:-ja.y+"px 0 0 "+-ja.x+"px"})));n(a.renderer);q=a.controls;for(s=0;s<G.length;s++)G[s].trigger("detach");G=[];for(s=0;s<q.length;s++)G[G.length]=za("control",q[s],N,y,E,a[q[s]])}else n("canvas")}function t(q,s,z){var J=(new V(z.x-Na+ob,z.y-Oa+pb)).rotate(-na*$,Pa).scale(1/W,Pa);ga=Hits.init(q,s,z,b(z.x,z.y,true),J);for(q=P;q--;)if(F[q].visible)ca=ca||(F[q].hitGuess?F[q].hitGuess(ga.gridX,ga.gridY,N):false);ca&&ea++}function u(q,s,z){if(Q(q,
oa)||Q(q,Vb)){s=new N.XY(q);s.sync(N);q=s.x;s=s.y}if(Q(q,ra)){A(q-Na-ja.x,s-Oa-ja.y,z);return N}else return A().offset(Na+ja.x|0,Oa+ja.y|0).sync(N,true)}function x(){var q=new wa(S,T,bb,cb);q.scaleFactor=W;q.padding=ja?ja.copy():new V;return q}function v(q,s,z){if(Q(q,oa)&&Q(s,pa))for(s=0;s<P;s++){if(F[s].id===q)return F[s]}else if(Q(q,oa)){s=za("layer",s,N,z);s.added=(new Date).getTime();s.id=q;F[g(q)]=s;F.sort(function(J,Y){return Y.zindex-J.zindex||Y.added-J.added});P=F.length;N.trigger("resync");
B();N.trigger("layerChange",N,s);ea++;return s}else return[].concat(F)}function B(){var q=x();if(q){if(Ia||Ja)if(q){var s=db?S+(q.w>>1):S,z=eb?T+(q.h>>1):T,J=q.w,Y=q.h;if(Ia&&Ia>J)if(s+J>Ia)S=db?S:Ia-J;else if(s<0)S=db?S:0;if(Ja&&Ja>Y)if(z+Y>Ja)T=eb?T:Ja-Y;else if(z<0)T=eb?T:0}Hb=S;Ib=T;N.trigger("refresh",N,q);ea++}}function p(q,s,z){if(Q(q,ra)){var J=z?q:W*q;if(!Zb){s=null;q=La(Da(J)/Math.LN2);J=Ba(2,q)}if(s)Qa=ta.tween([W],[J],s,function(){W=J;Qa=null;ea++});else{W=J;ea++}return N}else return W}
function w(){for(var q=N.trigger.apply(null,arguments).cancel,s=F.length;s--;)q=F[s].trigger.apply(null,arguments).cancel||q;return!q}function A(q,s,z){if(Q(q,ra)){if(z)Aa=ta.tween([S,T],[q,s],z,function(){Aa=null});else{S=q|0;T=s|0;ea++}return N}else return(new N.XY(S,T)).sync(N,true)}a=K({container:"",captureHover:true,controls:[],drawOnScale:true,padding:128,inertia:true,refreshDistance:128,pannable:true,scalable:true,renderer:"canvas",useTransforms:true},a);var r="auto",C=true,D=false,G=[],F=
[],P=0,R=null,y=null,E,O=null,ca=false,qa,H=false,M=0,L=0,da=a.refreshDistance,S=0,T=0,Ca=0,Ra=0,Hb=0,Ib=0,Ia=null,Ja=null,db=false,eb=false,Aa=null,ja,ga=null,Sa=null,X,Gb=0,Pa=new V,na=0,Ta=null,W=1,Qa=null,qb=1,ia=null,rb={index:0,draw:false},Zb=true,ea=0,bb,cb,ob,pb,Na,Oa,N={XY:V,id:a.id,panSpeed:0,attachFrame:function(q,s){s&&R.appendChild(q)},center:u,detach:function(){X&&X.trigger("detach");ia&&ia.unbind();if(y){E.removeChild(y);R=y=null}},frozen:function(q){if(Q(q,pa))return D;else{D=q;return N}},
layer:v,invalidate:function(){ea++},pan:function(q,s,z){A(S+q,T+s,z)},refresh:B,rotate:function(q,s,z){if(Q(q,ra)){var J=z?q:na+q;if(s)Ta=ta.tween([na],[J],s,function(){na=J%360;Ta=null;ea++});else{na=J%360;ea++}return N}else return na},scale:p,triggerAll:w,setMaxOffset:function(q,s,z,J){Ia=q;Ja=s;db=z;eb=J},offset:A,viewport:x};xa(N);N.bind("resize",e);N.bind("layerRemove",function(q,s){var z=jb(F,s.id);if(z>=0&&z<P){F.splice(z,1);ea++}P=F.length});zb(N,a,{container:l,captureHover:d,scalable:d,pannable:d,
renderer:n});v("markers","draw",{zindex:20});l(a.container);U&&!Q(window.attachEvent,pa)?window.attachEvent("onresize",e):window.addEventListener("resize",e,false);Ha.attach(function(q){var s=[],z,J,Y;if(!D){self.panSpeed=panSpeed=ma(M)+ma(L);(z=W!==qb)&&N.trigger("scale");if(panSpeed>0||z||Aa||Qa||Ta){ea++;if(Aa&&panSpeed>0){Aa(true);Aa=null}}if(panSpeed<2&&(ma(S-Hb)>=da||ma(T-Ib)>=da))B();rb.index++;rb.draw=ea||panSpeed||0;if(X&&rb.draw){if(Qa)W=Qa()[0];if(Ta)na=Ta()[0];Ca+=M;Ra+=L;if(M||L)N.trigger("pan");
if(C){if(W!==1)s[s.length]="scale("+W+")";if(na!==0)s[s.length]="rotate("+na+"deg)"}if(z=!qa||(a.drawOnScale||W===1)&&panSpeed<5){if(Aa){z=Aa();S=z[0]|0;T=z[1]|0}else{J=-na*$;z=ya(J)*Ca+-ha(J)*Ra;J=ha(J)*Ca+ya(J)*Ra;S=S-z/W|0;T=T-J/W|0}Y=x();X.trigger("predraw",Y);if(X.prepare(F,Y,q,ga)){J=Ra=z=Ca=ea=0;for(ii=P;ii--;){var aa=F[ii];if(aa.visible){var sa=aa.style?X.applyStyle(aa.style,true):null;aa.draw(X,Y,N,q,ga);sa&&X.applyStyle(sa)}}X.trigger("render",Y);N.trigger("drawComplete",Y,q);U.move(R,z,
J,s,Pa)}}else U.move(R,Ca,Ra,s,Pa);if(H||!a.inertia)L=M=0;else if(M!=0||L!=0){M*=0.8;L*=0.8;if(ma(M)<0.5)M=0;if(ma(L)<0.5)L=0}if(ga){q=true;s=ga?ga.elements:[];if(Sa&&Sa.type==="hover"){diffElements=Hits.diffHits(Sa.elements,s);if(diffElements.length>0)Hits.triggerEvent(Sa,N,"Out",diffElements);else q=false}if(s.length>0){J=ga.gridX;Y=ga.gridY;for(z=s.length;z--;){aa=s[z];sa=J;var Jb=Y,Kb=aa&&aa.drag&&(!aa.canDrag||aa.canDrag(aa,sa,Jb));if(Kb){O=aa;O.startX=sa;O.startY=Jb}if(Kb)break}q&&Hits.triggerEvent(ga,
N)}Sa=s.length>0?K({},ga):null;ga=null}if(qb!==W){N.trigger("scaleChanged",W);qb=W}}}});return N});fa("view","map",function(a){function c(e,o){var d=k.viewport();if(e){d=Ga(e.bestZoomLevel(d),o||0);return b(d).center(e.center())}else return new Fa((new va(d.x,d.y2)).sync(k,true).pos(),(new va(d.x2,d.y)).sync(k,true).pos())}function b(e,o,d){if(Q(e,ra)){e=Ga(a.minZoom,Ma(a.maxZoom,e|0));if(e!==j){var n=k.viewport(),m=k.offset(),g=n.w/2;n=n.h/2;var l=Ba(2,e-j),t=g/l|0,u=n/l|0;j=e;k.offset(((o||m.x+
g)-t)*l,((d||m.y+n)-u)*l);refreshY=refreshX=0;k.trigger("zoom",e);k.trigger("reset");h=k.rpp=ba/(256<<j);k.setMaxOffset(ba/h|0,ba/h|0,true,false);k.scale(1,false,true);k.trigger("resync");k.refresh()}return k}else return j}a=K({controls:["zoombar"],minZoom:1,maxZoom:18,renderer:"canvas/dom",zoom:1,zoombar:{}},a);var f=new va,h,j=a.zoom||a.zoomLevel,i=0,k=K(za("view","view",a),{XY:va,bounds:c,zoom:b});k.bind("refresh",function(){var e=k.viewport();if(f.x!=e.x||f.y!=e.y){k.trigger("boundsChange",c());
f.x=e.x;f.y=e.y}});k.bind("scaleChanged",function(e,o){var d=Da(o)/Math.LN2|0;if(d!==0){o=Ba(2,d);clearTimeout(i);i=setTimeout(function(){b(j+d)},500)}});return k});var ta=function(){return{tween:function(a,c,b,f,h){function j(l){var t=l-g;l=g+m<=l;for(var u=i;u--;){k[u]=o(t,a[u],d[u],m);h&&h.invalidate()}if(l||n){Ha.detach(j);for(u=0;u<e.length;u++)e[u]&&e[u](k,t,n)}}b=K({easing:"sine.out",duration:1E3,complete:null},b);var i=a.length,k=[].concat(a),e=[f,b.complete],o=Pb(b.easing),d=[],n=false,m=
b.duration,g=(new Date).getTime();for(b=i;b--;)d[b]=c[b]-a[b];Ha.attach(j);return function(l){n=l;return k}},tweenDrawable:function(a,c,b,f,h){var j=ta.tween([b],[f],h,function(){a[c]=f;for(var k=a.tweens.length;k--;)if(a.tweens[k]===i){a.tweens.splice(k,1);break}},a.view),i=function(){a[c]=j()[0]};return i}}}(),Ea=function(a,c,b){b=K({style:null,xy:null,size:20,fill:false,stroke:true,draggable:false,observable:true,properties:{},typeName:"Shape",zindex:0},b);K(this,b);if(Q(this.xy,oa))this.xy=new a.XY(this.xy);
this.id="drawable_"+Xb++;this.bounds=null;this.view=a;this.layer=c;this.tweens=[];this.rotation=this.animations=0;this.scaling=1;this.translateY=this.translateX=0;this.observable&&xa(this)};Ea.prototype={constructor:Ea,applyTweens:function(){for(var a=this.tweens.length;a--;)this.tweens[a]()},drag:null,draw:null,getProps:null,resync:function(){if(this.xy){this.xy.sync(this.view);if(this.size){var a=this.size>>1;this.updateBounds(new wa(this.xy.x-a,this.xy.y-a,this.size,this.size))}}},rotate:function(a,
c,b){if(Q(a,ra)){a=(b?a:this.rotation*la+a)*$;if(c)this.tweens.push(ta.tweenDrawable(this,"rotation",this.rotation,a,c));else{this.rotation=a;this.view.invalidate()}return this}else return this.rotation*la},scale:function(a,c,b){if(Q(a,ra)){a=b?a:this.scaling*a;if(c)this.tweens.push(ta.tweenDrawable(this,"scaling",this.scaling,a,c));else{this.scaling=a;this.view.invalidate()}return this}else return this.scaling},translate:function(a,c,b,f){if(Q(a,ra)){a=f?a:this.translateX+a;c=f?c:this.translateY+
c;if(b){this.tweens.push(ta.tweenDrawable(this,"translateX",this.translateX,a,b));this.tweens.push(ta.tweenDrawable(this,"translateY",this.translateY,c,b))}else{this.translateX=a;this.translateY=c;this.view.invalidate()}return this}else return new V(this.translateX,this.translateY)},updateBounds:function(a,c){a&&(!this.bounds||a.x!=this.bounds.x||a.y!=this.bounds.y)&&this.trigger("move",this,a,this.bounds);this.bounds=a;if(c)this.xy=this.bounds.center()}};fa("drawable","marker",function(a,c,b){b=
K({fill:true,stroke:false,markerType:"simple",hoverStyle:"highlight",typeName:"Marker"},b);return new Ea(a,c,b)});fa("drawable","poly",function(a,c,b){function f(){var d,n,m,g,l,t,u;e=b.simplify?k.simplify():k;for(d=e.length;d--;){n=e[d].x;m=e[d].y;t=Q(t,pa)||n<t?n:t;u=Q(u,pa)||m<u?m:u;g=Q(g,pa)||n>g?n:g;l=Q(l,pa)||m>l?m:l}o.updateBounds(new wa(t,u,g-t,l-u),true);a.invalidate()}function h(d){if(Q(d,xb)){k=new Ka(b.allowCull);Eb.process(d,function(n,m){for(var g=0;g<m;g++)k.push(new a.XY(n[g]))},j,
i);return o}else return e}function j(){k.length&&Eb.process(k,function(d,n){for(var m=n;m--;)d[m].sync(a)},f,i)}b=K({allowCull:false,simplify:false,fill:true,points:[],typeName:"Poly"},b);var i=500,k=new Ka(b.allowCull),e,o=K(new Ea(a,c,b),{points:h,resync:j});h(b.points);return o});fa("drawable","line",function(a,c,b){b.fill=false;b.allowCull=true;return za("drawable","poly",a,c,b)});fa("drawable","image",function(a,c,b){function f(){if(e&&e.width>0){if(!this.centerOffset)this.centerOffset=new V(-e.width>>
1,-e.height>>1);this.updateBounds(new wa(this.xy.x+this.centerOffset.x,this.xy.y+this.centerOffset.y,e.width,e.height),false)}}function h(d){if(this.imageUrl=d){var n=this;ab(this.imageUrl,function(m,g){e=m;if(g){var l=o.layer?o.layer.view:null;l&&l.invalidate()}f.apply(n)})}}b=K({image:null,imageUrl:null,centerOffset:null,typeName:"Image"},b);var j=Ea.prototype.resync,i=0,k=0,e=b.image,o=K(new Ea(a,c,b),{changeImage:h,getProps:function(){this.bounds||f(this,e);return{image:e,x:this.xy.x+i,y:this.xy.y+
k}},resync:function(d){j.call(this,d);f.call(this)}});e||h.call(this,this.imageUrl);if(this.centerOffset){i=this.centerOffset.x;k=this.centerOffset.y}});fa("drawable","arc",function(a,c,b){b=K({startAngle:0,endAngle:Math.PI*2,typeName:"Arc"},b);return new Ea(a,c,b)});Wa.prototype={constructor:Wa,clip:null,cycle:function(){},draw:function(){},hitGuess:null,remove:function(){this.view.trigger("layerRemove",this)}};fa("layer","tile",function(a,c){c=K({generator:"osm",imageLoadArgs:{}},c);var b=za("generator",
c.generator,c).run,f=null,h=[],j=K(new Wa(a,c),{draw:function(i,k,e){i.drawTiles&&i.drawTiles(k,f.search(k.buffer(128)),e.panSpeed<2)}});a.bind("resync",function(){var i=a&&a.zoom?a.zoom():0;h[i]||(h[i]=vb(i));f=h[i]});a.bind("refresh",function(i,k,e){f&&b(k,e,f,function(){k.invalidate()})});return j});fa("layer","draw",function(a,c){function b(k,e,o,d){var n=this.dragOffset;if(!n)n=this.dragOffset=new a.XY(k.startX-this.xy.x,k.startY-this.xy.y);this.xy.x=e-n.x;this.xy.y=o-n.y;if(d){delete this.dragOffset;
a.invalidate();this.xy.sync(a,true);this.trigger("dragDrop")}return true}function f(k,e,o,d){d&&j.remove(d,e);j.insert(o,e)}c=K({zindex:10},c);var h=[],j,i=K(new Wa(a,c),{itemCount:0,clear:function(){j=new wb;h=[];i.trigger("cleared");i.itemCount=0;a.invalidate()},create:function(k,e,o){e=za("drawable",k,a,i,e);if(o)h.unshift(e);else h[h.length]=e;e.resync();j&&e.bounds&&j.insert(e.bounds,e);e.bind("move",f);i.itemCount=h.length;i.trigger(k+"Added",e);return e},draw:function(k,e,o,d,n){o={};d=j&&
e?j.search(e):[];for(var m=d.length;m--;){var g=d[m],l=g.style||i.style,t,u,x=g.getProps?g.getProps(k):o;t=k["prep"+g.typeName];g.tweens.length>0&&g.applyTweens();u=k.applyTransform(g);if(x=t?t.call(k,g,e,n,x):null){if(n&&x.hit){n.elements.push(Hits.initHit(g.type,g,g.draggable?b:null));t=n.type+"Style";l=g[t]||i[t]||l}l=l?k.applyStyle(l,true):null;(t=g.draw||x.draw)&&t.call(g,x);l&&k.applyStyle(l)}u&&u.undo&&u.undo()}},find:function(){return[].concat(h)},hitGuess:function(k,e){return j&&j.search({x:k-
10,y:e-10,w:20,h:20}).length>0}});a.bind("resync",function(){j=vb(a.zoom(),j);for(var k=h.length;k--;)h[k].resync()});return i});Xa.prototype={constructor:Xa};fa("control","zoombar",function(a,c,b,f){function h(r,C){var D=B[r]=U.create("div","t5-zoombar-button",{position:"absolute",background:j(r),"z-index":51,width:f.width+"px",height:f.buttonHeight+"px","margin-top":(C||0)+"px"});p.appendChild(D)}function j(r,C){return"url("+f.images+") 0 -"+(n+g*3+(r||0)*o*3+(C||0)*o)+"px"}function i(r){return"url("+
f.images+") 0 -"+(n+(r||0)*g)+"px"}function k(r,C){var D;if(r===m){m.style.background=i(C);D="thumb"}else for(var G=0;G<B.length;G++)if(r===B[G]){D="button"+G;B[G].style.background=j(G,C);break}return D}function e(r){if(r!==x){x=r;u=t-x/v*(t-l)|0;U.move(m,0,u-l);clearTimeout(w);w=setTimeout(function(){a.zoom(x)},500)}}f=K({width:24,height:200,images:"img/zoom.png",align:"right",marginTop:10,spacing:10,thumbHeight:16,buttonHeight:16},f);var o=f.buttonHeight,d,n=f.height,m,g=f.thumbHeight,l=f.spacing+
o-(g>>1),t=f.height-o-(g>>1),u=l,x=-1;c=a.minZoom();var v=a.maxZoom()-c+1,B=[],p,w=0,A={button0:function(){a.zoom(a.zoom()+1)},button1:function(){a.zoom(a.zoom()-1)}};p=U.create("div","t5-zoombar",{position:"absolute",background:"url("+f.images+")","z-index":50,overflow:"hidden",width:f.width+"px",height:f.height+"px",margin:function(){var r=f.spacing,C=ua("{0}px 0 0 {1}px");if(f.align==="right")r=b.offsetWidth-f.width-f.spacing;return C(f.marginTop,r)}()});b.childNodes[0]?b.insertBefore(p,b.childNodes[0]):
b.appendChild(p);p.appendChild(m=U.create("div","t5-zoombar-thumb",{position:"absolute",background:i(),"z-index":51,width:f.width+"px",height:f.thumbHeight+"px",margin:"10px 0 0 0",top:u-l+"px"}));h(0);h(1,f.height-f.buttonHeight);d=INTERACT.watch(p,{bindTarget:p});d.bind("pointerMove",function(r,C,D){u=Math.min(Math.max(l,D.y-(g>>1)),t);e(v-(u-l)/t*v|0)});d.bind("pointerDown",function(r){k(r.target,2)});d.bind("pointerUp",function(r){k(r.target,0)});d.bind("tap",function(r){(r=A[k(r.target,2)])&&
r()});c=new Xa(a);c.bind("detach",function(){d.unbind();b.removeChild(p)});a.bind("zoom",function(r,C){e(C)});e(a.zoom());return c});Z.prototype={constructor:Z,distanceTo:function(){if(!targetPos||this.empty()||targetPos.empty())return 0;var a=(targetPos.lat-this.lat)*$>>1,c=(targetPos.lon-this.lon)*$>>1;a=ha(a)*ha(a)+ya(this.lat*$)*ya(targetPos.lat*$)*ha(c)*ha(c);return 6371*2*Ub(mb(a),mb(1-a))},equalTo:function(a){return pos&&this.lat===a.lat&&this.lon===a.lon},empty:function(){return this.lat===
0&&this.lon===0},inArray:function(a){for(var c=a.length;c--;)if(this.equal(a[c]))return true;return false},offset:function(a,c){var b=this.lat*$,f=this.lon*$,h=b+a/6371;b=Db(ha(c/6371)/ya(b));f=f+b;h=(h+Va)%Math.PI-Va;f%=ba;return new Z(h*la,f*la)},toPixels:function(){return $a(this.lon,this.lat)},toBounds:function(a){var c=a.radians(),b=this.lat*$,f=this.lon*$;a=b-c;var h=b+c;if(a>Ab&&h<lb){b=Db(ha(c)/ya(b));c=f-b;if(c<Tb)c+=ba;f=f+b;if(f>Bb)f-=ba}else{a=Ga(a,Ab);h=Ma(h,lb);c=yb;f=Ya}return new Fa(new Z(a*
la,c*la),new Z(h*la,f*la))},toString:function(a){return this.lat+(a||" ")+this.lon}};(function(){fa("fn","generalize",function(a,c,b){var f=a.length,h=[],j=null;b=(b||250)/1E3;for(f=f;f--;)if(f===0)h.unshift(a[f]);else{var i=!j||a[f].inArray(c)?b:j.distanceTo(a[f]);if(a[f]&&i>=b){h.unshift(a[f]);j=a[f]}}return h})})();Fa.prototype={constructor:Fa,bestZoomLevel:function(a){var c=this.center();c=Ma(La(ma(c.lat)*0.05),kb.length);var b=kb[c],f=this.size();c=Cb(Da(kb[3]*a.h/f.y)/Da(2));a=Cb(Da(b*a.w/f.x)/
Da(2));return Ma(isNaN(c)?1E3:c,isNaN(a)?1E3:a)},center:function(){var a=this.size();return new Z(this.min.lat+(a.y>>1),this.min.lon+(a.x>>1))},expand:function(a){return new Fa(new Z(this.min.lat-a,(this.min.lon-a)%360),new Z(this.max.lat+a,(this.max.lon+a)%360))},size:function(a){var c=new V(0,this.max.lat-this.min.lat);c.x=(a||Q(a,pa))&&this.min.lon>this.max.lon?360-this.min.lon+this.max.lon:this.max.lon-this.min.lon;return c},toString:function(){return"min: "+this.min+", max: "+this.max}};ib.prototype=
{add:function(){for(var a=this.meters,c=arguments.length;c--;)a+=arguments[c].meters;return new ib(a)},radians:function(a){if(Q(a,ra)){this.meters=a*6371E3;return this}else return this.meters/6371E3},toString:function(){if(this.meters>1E3)return(this.meters/10|0)/100+"km";return this.meters+"m"}};K(I,{ex:K,log:ka,observable:xa,configurable:zb,formatter:ua,wordExists:function(a,c){for(var b=a.split(/\s|\,/).length;b--;)if(a.toLowerCase()==c.toLowerCase())return true;return false},is:Q,indexOf:jb,fn:function(a){return Wb("fn",
a)},project:$a,unproject:nb,getImage:ab,userMessage:function(a,c,b){I.trigger("userMessage",a,c,b)},Registry:Za,Style:Fb,DOM:U,Rect:wa,XY:V,Line:Ka,Pos:Z,BBox:Fa,Distance:ib,Hits:Hits,Control:Xa,Tile:gb,Tweener:ta});I.RouteTools=function(){function a(d){if(j.test(d))return"-slight";return""}function c(d,n){n.geometry&&d.layer("route","draw").create("line",{points:n.geometry,style:"waypoints",simplify:true})}function b(d){for(var n="unknown",m=f||e,g=0;g<m.length;g++){m[g].regex.lastIndex=-1;var l=
m[g].regex.exec(d);if(l){n=m[g].customCheck?m[g].customCheck(d,l):m[g].turnType;break}}return n}var f=undefined,h=I.fn("generalize"),j=/bear/i,i=/right/i,k={unknown:"0:0",start:"1:0","continue":"1:1",arrive:"1:2",left:"2:0","left-slight":"2:1","left-sharp":"2:2",right:"3:0","right-slight":"3:1","right-sharp":"3:2","uturn-left":"4:0","uturn-right":"4:1",merge:"4:2",roundabout:"5:0",ramp:"6:0","ramp-exit":"6:1"},e=function(){var d=[];d.push({regex:/continue/i,turnType:"continue"});d.push({regex:/(take|bear|turn)(.*?)left/i,
customCheck:function(n,m){return"left"+a(m[1])}});d.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(n,m){return"right"+a(m[1])}});d.push({regex:/enter\s(roundabout|rotary)/i,turnType:"roundabout"});d.push({regex:/take.*?ramp/i,turnType:"ramp"});d.push({regex:/take.*?exit/i,turnType:"ramp-exit"});d.push({regex:/make(.*?)u\-turn/i,customCheck:function(n,m){return"uturn"+(i.test(m[1])?"-right":"-left")}});d.push({regex:/proceed/i,turnType:"start"});d.push({regex:/arrive/i,turnType:"arrive"});
d.push({regex:/fell\sthrough/i,turnType:"merge"});return d}(),o={calculate:function(d){d=K({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},d);var n=I.Registry.create("service","routing");n&&n.calculate(d,function(m){if(d.generalize)m.geometry=h(m.geometry,m.getInstructionPositions());if(d.map){c(d.map,m);d.autoFit&&d.map.bounds(m.boundingBox)}d.success&&d.success(m)})},createMapOverlay:c,getSpriteOffset:function(d,n){var m=k[d];if(m=m?m.split(":"):null)return{x:-m[0]*
(n||16),y:-m[1]*(n||16)};return null},parseTurnType:b,Instruction:function(d){var n=d=K({position:null,description:"",distance:0,distanceTotal:0,time:0,timeTotal:0,turnType:null},d),m=d.description;m=m.replace(/(\w)(\/)(\w)/g,"$1 $2 $3");n.description=m;if(!d.turnType)d.turnType=b(d.description);return d},RouteData:function(d){d=K({geometry:[],instructions:[],boundingBox:null},d);if(!d.boundingBox)d.boundingBox=new I.BBox(d.geometry);return K({getInstructionPositions:function(){for(var n=[],m=0;m<
d.instructions.length;m++)d.instructions[m].position&&n.push(d.instructions[m].position);return n}},d)}};I.observable(o);return o}();I.Decarta=function(){function a(g){return k(j.clientName,j.clientPassword,j.sessionID,j.configuration,j.release,g)}function c(g,l){return e(g.maxResponses,g.version,g.requestID,g.methodName,l)}function b(g,l){j.server||ka("No server configured for deCarta - we are going to have issues","warn");return o(j.server,g.requestID,escape(l))}function f(g,l){Qb(b(g,a(c(g,g.getRequestBody()))),
function(t){var u=t.response.XLS.Response;if(u.numberOfResponses>0&&u[g.methodName+"Response"]){t=null;if(g.parseResponse)t=g.parseResponse(u[g.methodName+"Response"]);l&&l(t)}else ka("no responses from server: "+t.response,"error")})}function h(g,l){var t=new d({json:g.StreetAddress}),u=[];if(g.Place){if(!g.Place.length)g.Place=[g.Place];for(var x=g.Place.length;x--;)u[u.length]=g.Place[x].content}return new ADDR.Address({building:t.building,street:t.street,regions:u,countryCode:g.countryCode||"",
postalCode:g.PostalCode||"",pos:l})}var j={sessionID:(new Date).getTime(),server:"",clientName:"",clientPassword:"",configuration:"",maxResponses:25,release:"4.4.2sp03",tileFormat:"PNG",fixedGrid:true,useCache:true,tileHosts:[],requestTimeout:3E4,geocoding:{countryCode:"US",language:"EN"}};TL=function(){function g(t,u){this.days=t||0;this.seconds=u||0}g.prototype={add:function(){for(var t=new g(this.days,this.seconds),u=arguments.length;u--;){t.days+=arguments[u].days;t.seconds+=arguments[u].seconds}return t},
toString:function(){var t,u,x,v="";if(this.days)v=this.days+" days ";if(this.seconds){x=this.seconds;if(x>=3600){t=~~(x/3600);x-=t*3600}if(x>=60){u=Math.round(x/60);x-=u*60}if(t)v=v+t+(t>1?" hrs ":" hr ")+(u?(u>10?u:"0"+u)+" min ":"");else if(u)v=v+u+" min";else if(x>0)v=v+(x>10?x:"0"+x)+" sec"}return v}};var l=function(){var t=/^P(\d+Y)?(\d+M)?(\d+D)?$/,u=/^(\d+H)?(\d+M)?(\d+S)?$/,x={8601:function(v){v=v.split("T");var B=null;B=null;var p=0,w=0;t.lastIndex=-1;B=t.exec(v[0]);p+=B[3]?parseInt(B[3].slice(0,
-1),10):0;u.lastIndex=-1;B=u.exec(v[1]);w+=B[1]?parseInt(B[1].slice(0,-1),10)*3600:0;w+=B[2]?parseInt(B[2].slice(0,-1),10)*60:0;w+=B[3]?parseInt(B[3].slice(0,-1),10):0;return new g(p,w)}};return function(v,B){var p=x[B];if(!p)throw"No parser found for the duration format: "+B;return p(v)}}();return{Duration:g,parse:l}}();var i=1,k=ua("<xls:XLS version='1' xls:lang='en' xmlns:xls='http://www.opengis.net/xls' rel='{4}' xmlns:gml='http://www.opengis.net/gml'><xls:RequestHeader clientName='{0}' clientPassword='{1}' sessionID='{2}' configuration='{3}' />{5}</xls:XLS>"),
e=ua("<xls:Request maximumResponses='{0}' version='{1}' requestID='{2}' methodName='{3}Request'>{4}</xls:Request>"),o=ua("{0}/JSON?reqID={1}&chunkNo=1&numChunks=1&data={2}&responseFormat=JSON"),d=function(g){g=I.ex({json:{}},g);var l="",t="";if(g.json.Street)l=g.json.Street.content?g.json.Street.content:g.json.Street;l=l&&l.replace?l.replace(/\/\d+$/,""):"";if(g.json.Building)if(g.json.Building.number)t=g.json.Building.number;return{building:t,street:l,calcMatchPercentage:function(u){var x=0,v=I.Addressing.normalize(u),
B=I.Addressing.normalize(l);if(g.json.Building)if(I.Addressing.buildingMatch(u,g.json.Building.number.toString()))x+=0.2;if(v&&B&&I.wordExists(v,B))x+=0.8;return x},toString:function(){if(l)return(t?t+" ":"")+l;return""}}},n=function(){return{methodName:"",maxResponses:25,version:"1.0",requestID:i++,getRequestBody:function(){return""},parseResponse:function(g){return g}}},m=function(){return I.ex(new n,{methodName:"RUOK",parseResponse:function(g){return{aliasCount:g.maxHostAliases,host:g.hostName}}})};
I.Registry.register("generator","decarta",function(g){function l(x,v,B,p){if(x=x.zoom?x.zoom():0){var w=2<<x-1,A=w>>1,r=g.tileSize,C=(v.w/r|0)+1,D=(v.h/r|0)+1,G=(v.x/r|0)-A;v=w-(v.y/r|0)-A-D;var F=B.search({x:(A+G)*r,y:(A+v*-1-D)*r,w:C*r,h:D*r});w={};var P;for(P=F.length;P--;)w[F[P].id]=true;for(F=0;F<=C;F++)for(P=0;P<=D;P++){var R=G+F,y=v+P-1,E=R+"_"+y;if(!w[E]){R=new I.Tile((A+G+F)*r,(A+v*-1-P)*r,u[F%u.length]+"/openls/image-cache/TILE?LLMIN=0.0,0.0&LLMAX="+t[x]+"&CACHEABLE=true&DS=navteq-world&WIDTH=256&HEIGHT=256&CLIENTNAME="+
j.clientName+"&SESSIONID="+j.sessionID+"&FORMAT=PNG&CONFIG="+j.configuration+"&N="+y+"&E="+R,r,r,E);B.insert(R,R)}}p&&p()}}g=I.ex({tileSize:256},g);var t=["89.787438015348100000,360.00000000000000000","85.084059050110410000,180.00000000000000000","66.653475896509040000,90.00000000000000000","41.170427238429790000,45.000000000000000000","22.076741328793200000,22.500000000000000000","11.251819676168665000,11.250000000000000000","5.653589942659626000,5.625000000000000000","2.830287664051185000,2.812500000000000000",
"1.415581451872543800,1.406250000000000000","0.707845460801532700,0.703125000000000000","0.353929573271679340,0.351562500000000000","0.176965641673330230,0.175781250000000000","0.088482927761462040,0.087890625000000000","0.044241477246363230,0.043945312500000000","0.022120740293895182,0.021972656250000000","0.011060370355776452,0.010986328125000000","0.005530185203987857,0.005493164062500000","0.002765092605263539,0.002746582031250000","0.001382546303032519,0.001373291015625000","0.000691272945568983,0.000686645507812500",
"0.000345636472797214,0.000343322753906250"],u=null;I.userMessage("ack","decarta","&copy; deCarta, Inc. Map and Imagery Data &copy; NAVTEQ or Tele Atlas or DigitalGlobe");return{run:function(x,v,B,p){u?l(x,v,B,p):f(new m,function(w){u=[];if(w.aliasCount)for(var A=0;A<w.aliasCount;A++)u[A]="http://"+w.host.replace("^(.*?).(.*)$","\u0001-0"+(A+1)+".\u0002");else u=["http://"+w.host];l(x,v,B,p)})}}});I.Registry.register("service","geocoder",function(){var g=I.formatter('<xls:GeocodeRequest><xls:Address countryCode="{0}" language="{1}">{2}</xls:Address></xls:GeocodeRequest>'),
l=I.formatter('<xls:StreetAddress><xls:Building number="{0}" /><xls:Street>{1}</xls:Street></xls:StreetAddress>'),t=function(x,v){v=I.ex({countryCode:j.geocoding.countryCode,language:j.geocoding.language},v);var B=ADDR.parse(x),p=new n;return I.ex({},p,{methodName:"Geocode",getRequestBody:function(){var w=l(B.number,B.street);w+='<xls:Place type="Municipality">'+B.regions.join(" ")+"</xls:Place>";return g(v.countryCode,v.language,w)},parseResponse:function(w){var A=w.GeocodeResponseList;w=[];var r=
A?A.numberOfGeocodedAddresses:0,C=[];if(r>1)C=A.GeocodedAddress;else if(r==1)C=[A.GeocodedAddress];for(A=0;C&&A<C.length;A++){r=C[A];var D=null,G=null;if(r&&r.GeocodeMatchCode&&r.GeocodeMatchCode.matchType!=="NO_MATCH"){if(r&&r.Point)G=new I.Pos(r.Point.pos);if(r&&r.Address)D=h(r.Address,G)}(r=D)&&w.push(r)}return w}})},u=function(x){x=I.ex({position:null,geocodePreference:"StreetAddress"},x);return I.ex(new n,{methodName:"ReverseGeocode",getRequestBody:function(){return"<xls:ReverseGeocodeRequest><xls:Position><gml:Point><gml:pos>"+
x.position.toString()+"</gml:pos></gml:Point></xls:Position><xls:ReverseGeocodePreference>"+x.geocodePreference+"</xls:ReverseGeocodePreference></xls:ReverseGeocodeRequest>"},parseResponse:function(v){var B=null;if(v&&v.Point)B=new I.Pos(match.Point.pos);if(v&&v.ReverseGeocodedLocation&&v.ReverseGeocodedLocation.Address)return h(v.ReverseGeocodedLocation.Address,B);return null}})};typeof ADDR==="undefined"&&I.log("Sidelab addressing module not found, geocoder will not function","warn");return{forward:function(x,
v){f(new t(x),function(B){v(x,B)})},reverse:function(x,v){var B=new u({position:x});f(B,function(p){v&&v(p)})}}});I.Registry.register("service","routing",function(){var g=function(l){l=I.ex({waypoints:[],provideRouteHandle:false,distanceUnit:"KM",routeQueryType:"RMAN",routePreference:"Fastest",routeInstructions:true,routeGeometry:true},l);var t=new n,u=I.formatter('<xls:DetermineRouteRequest provideRouteHandle="{0}" distanceUnit="{1}" routeQueryType="{2}">'),x=I.formatter("<xls:{0}><xls:Position><gml:Point><gml:pos>{1}</gml:pos></gml:Point></xls:Position></xls:{0}>");
return I.ex({},t,{methodName:"DetermineRoute",getRequestBody:function(){if(l.waypoints.length<2)throw Error("Cannot send RouteRequest, less than 2 waypoints specified");var v=u(l.provideRouteHandle,l.distanceUnit,l.routeQueryType);v+="<xls:RoutePlan>";v+="<xls:RoutePreference>"+l.routePreference+"</xls:RoutePreference>";v+="<xls:WayPointList>";for(var B=0;B<l.waypoints.length;B++)v+=x(B===0?"StartPoint":B===l.waypoints.length-1?"EndPoint":"ViaPoint",l.waypoints[B].toString());v+="</xls:WayPointList>";
v+="</xls:RoutePlan>";if(l.routeInstructions)v+='<xls:RouteInstructionsRequest rules="maneuver-rules" providePoint="true" />';if(l.routeGeometry)v+="<xls:RouteGeometryRequest />";v+="</xls:DetermineRouteRequest>";return v},parseResponse:function(v){var B=I.RouteTools.RouteData,p=v.RouteGeometry.LineString.pos,w=p.length,A=Array(w);for(w=w;w--;)A[w]=new Z(p[w]);p=v.RouteInstructionsList;v=[];p=p&&p.RouteInstruction?p.RouteInstruction:[];w=new I.Distance;for(var r=new TL.Duration,C=0;C<p.length;C++){var D=
I.Distance,G=p[C].distance,F={M:1,KM:1E3}[G.uom?G.uom.toUpperCase():"M"];D=new D(G.value&&F?G.value*F:0);G=TL.parse(p[C].duration,"8601");w=w.add(D);r=r.add(G);v.push(new I.RouteTools.Instruction({position:new I.Pos(p[C].Point),description:p[C].Instruction,distance:D,distanceTotal:w,time:G,timeTotal:r}))}return new B({geometry:A,instructions:v})}})};return{calculate:function(l,t){l=I.ex({waypoints:[]},l);if(typeof I.RouteTools!=="undefined"){var u=new g(l);f(u,function(x){t&&t(x)})}else ka("Could not generate route, T5.RouteTools plugin not found",
"warn")}}});return{applyConfig:function(g){I.ex(j,g)},compareFns:function(){return{streetDetails:function(g,l){return l.calcMatchPercentage(g)},location:function(g,l){return l.calcMatchPercentage(g)}}}()}}();sb.T5=I;sb.Tile5=function(a,c){c=K({container:a,type:"map",renderer:"canvas",starpos:null,zoom:1,fastpan:false,drawOnScale:true,zoombar:{}},c);return za("view",c.type,c)}})(typeof window!="undefined"?window:exports);
