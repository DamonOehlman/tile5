(function(ob){function M(){var a=arguments[0]||{},c=Array.prototype.slice.call(arguments,1),b=c.length,e,h;for(h=0;h<b;h++)if((e=c[h])!==null)for(var f in e){var i=e[f];if(a!==i)if(i!==undefined)a[f]=i}return a}function ca(a,c){if(typeof console!=="undefined")console[c||"debug"](a)}function ka(a){var c=a.match(Fb),b=[],e=0,h;for(h=c?c.length:0;h--;){var f=c[h].slice(1);b[f]||(b[f]=RegExp("\\{"+f+"\\}","g"))}e=b.length;return function(){var i=a;for(h=0;h<e;h++){var k=arguments[h];if(typeof k=="undefined")k=
"";i=i.replace(b[h],k)}return i}}function pb(a,c){var b=La*ra(a);return Ma-2*qb(c*za((1-b)/(1+b),La/2))}function da(a,c){if(Q(a,na)){var b=a.split(Ya);this.x=parseFloat(b[0]);this.y=parseFloat(b[1])}else{this.x=a||0;this.y=c||0}}function sa(a,c,b,e){this.mercX=b;this.mercY=e;if(Q(a,na))M(this,Gb.parseXY(a));else a&&a.toPixels?M(this,a.toPixels()):da.call(this,a,c)}function ta(a,c,b,e){this.x=a||0;this.y=c||0;this.w=b||0;this.h=e||0;this.x2=this.x+this.w;this.y2=this.y+this.h}function rb(a,c){if(!a)return null;
c=c||Hb;for(var b=[],e=null,h=a.length;h--;){var f=a[h];if(include=!e||h===0||la(f.x-e.x)+la(f.y-e.y)>c){b.unshift(f);e=f}}return b}function sb(a,c){var b=new tb(Math.sqrt(256<<a)|0);c&&c.zoomLevel===a&&c.copyInto(b);b.zoomLevel=a;return b}function Za(a,c,b,e,h,f){this.x=a;this.y=c;this.w=e||256;this.h=e||256;this.x2=this.x+this.w;this.y2=this.y+this.h;this.url=b;this.id=f||a+"_"+c;this.loaded=false;this.image=null}function Na(a,c){c=M({id:"layer_"+Ib++,zindex:0,animated:false,style:null,minXY:null,
maxXY:null},c);this.visible=true;this.view=a;ua(M(this,c))}function Oa(){ua(this)}function ia(a,c){if(a&&a.split){var b=a.split(Ya);if(b.length>1){a=b[0];c=b[1]}}else if(a&&a.lat){c=a.lon;a=a.lat}this.lat=parseFloat(a||0);this.lon=parseFloat(c||0)}function Fa(a,c){if(Q(a,ub)){for(var b=c,e=new ia($a,Pa),h=new ia(Jb,vb),f=a.length;f--;){var i=a[f];if(i.lat<e.lat)e.lat=i.lat;if(i.lat>h.lat)h.lat=i.lat;if(i.lon<e.lon)e.lon=i.lon;if(i.lon>h.lon)h.lon=i.lon}this.min=e;this.max=h;if(Q(b,va)){b=this.size();
b=Ga(b.x,b.y)*0.3}this.expand(b)}else{this.min=a;this.max=c}}function ab(a){if(!Q(a,na))this.meters=a}var bb={};(function(a){var c=[],b=0,e=false,h=a.register=function(f,i){c.push({section:f,run:i})};a.init=function(f){function i(){if(b<c.length){var g=c[b++];k[g.section]||(k[g.section]={});g.run(k[g.section],i)}else{for(g in k)a[g]=k[g];e=true;f&&f(a)}}var k={};if(e&&f)f(a);else{b=0;i()}};h("canvas",function(f,i){function k(){var l,m=g.getContext("2d");m.save();try{m.translate(50,50);m.beginPath();
m.rect(0,0,20,20);l=m.isPointInPath(10,10)}finally{m.restore()}return l}var g=document.createElement("canvas"),j=typeof FlashCanvas!="undefined",d=typeof G_vmlCanvasManager!="undefnined";g.width=200;g.height=200;f.pipTransformed=j||d?false:k();i()})})(bb);var Fb=/\{(\d+)(?=\})/g,Kb=function(){var a=1.70158,c=Math.PI/2,b=Math.abs,e=Math.pow,h=Math.sin,f=Math.asin,i=Math.cos,k={linear:function(g,j,d,l){return d*g/l+j},backin:function(g,j,d,l){return d*(g/=l)*g*((a+1)*g-a)+j},backout:function(g,j,d,
l){return d*((g=g/l-1)*g*((a+1)*g+a)+1)+j},backinout:function(g,j,d,l){return(g/=l/2)<1?d/2*g*g*(((a*=1.525)+1)*g-a)+j:d/2*((g-=2)*g*(((a*=1.525)+1)*g+a)+2)+j},bouncein:function(g,j,d,l){return d-k.bounceout(l-g,0,d,l)+j},bounceout:function(g,j,d,l){return(g/=l)<1/2.75?d*7.5625*g*g+j:g<2/2.75?d*(7.5625*(g-=1.5/2.75)*g+0.75)+j:g<2.5/2.75?d*(7.5625*(g-=2.25/2.75)*g+0.9375)+j:d*(7.5625*(g-=2.625/2.75)*g+0.984375)+j},bounceinout:function(g,j,d,l){return g<l/2?k.bouncein(g*2,0,d,l)/2+j:k.bounceout(g*2-
l,0,d,l)/2+d/2+j},cubicin:function(g,j,d,l){return d*(g/=l)*g*g+j},cubicout:function(g,j,d,l){return d*((g=g/l-1)*g*g+1)+j},cubicinout:function(g,j,d,l){if((g/=l/2)<1)return d/2*g*g*g+j;return d/2*((g-=2)*g*g+2)+j},elasticin:function(g,j,d,l,m,p){if(g==0)return j;if((g/=l)==1)return j+d;p||(p=l*0.3);if(!m||m<b(d)){m=d;d=p/4}else d=p/$*f(d/m);return-(m*e(2,10*(g-=1))*h((g*l-d)*$/p))+j},elasticout:function(g,j,d,l,m,p){var q;if(g==0)return j;if((g/=l)==1)return j+d;p||(p=l*0.3);if(!m||m<b(d)){m=d;q=
p/4}else q=p/$*f(d/m);return m*e(2,-10*g)*h((g*l-q)*$/p)+d+j},elasticinout:function(g,j,d,l,m,p){var q;if(g==0)return j;if((g/=l/2)==2)return j+d;p||(p=l*0.3*1.5);if(!m||m<b(d)){m=d;q=p/4}else q=p/$*f(d/m);if(g<1)return-0.5*m*e(2,10*(g-=1))*h((g*l-q)*$/p)+j;return m*e(2,-10*(g-=1))*h((g*l-q)*$/p)*0.5+d+j},quadin:function(g,j,d,l){return d*(g/=l)*g+j},quadout:function(g,j,d,l){return-d*(g/=l)*(g-2)+j},quadinout:function(g,j,d,l){if((g/=l/2)<1)return d/2*g*g+j;return-d/2*(--g*(g-2)-1)+j},sinein:function(g,
j,d,l){return-d*i(g/l*c)+d+j},sineout:function(g,j,d,l){return d*h(g/l*c)+j},sineinout:function(g,j,d,l){return-d/2*(i(Math.PI*g/l)-1)+j}};return function(g){g=g.replace(/[\-\_\s\.]/g,"").toLowerCase();return k[g]||k.linear}}(),ua=function(){function a(b,e){var h=b.hasOwnProperty("obsHandlers")?b.obsHandlers:null;h[e]||(h[e]=[]);return h[e]}var c=0;return function(b){if(!b)return null;if(!(b.hasOwnProperty("obsHandlers")?b.obsHandlers:null))b.obsHandlers={};if(!b.hasOwnProperty("bind")){b.bind=function(e,
h){var f="callback"+c++;a(b,e).unshift({fn:h,id:f});return f};b.triggerCustom=function(e,h){var f=a(b,e),i={cancel:false,name:e,source:this},k;for(k in h)i[k]=h[k];if(!f)return null;k=Array.prototype.slice.call(arguments,2);b.eventInterceptor&&b.eventInterceptor(e,i,k);k.unshift(i);for(var g=f.length;g--&&!i.cancel;)f[g].fn.apply(this,k);return i};b.trigger=function(e){var h=Array.prototype.slice.call(arguments,1);h.splice(0,0,e,null);return b.triggerCustom.apply(this,h)};b.unbind=function(e,h){if(typeof e===
"undefined")b.obsHandlers={};else for(var f=a(b,e),i=0;f&&i<f.length;i++)if(f[i].id===h){f.splice(i,1);break}return b}}return b}}(),cb=function(){function a(c,b,e,h){if(typeof c[h]=="undefined")c[h]=function(f){if(typeof f!="undefined"){b[h]=f;e[h]&&e[h](f);return c}else return b[h]}}return function(c,b,e){b=b||c;for(var h in b)typeof b[h]!="function"&&a(c,b,e,h);return c}}(),db=Array.prototype.indexOf||function(a){for(var c=0;c<this.length;c++)if(this[c]===a)return c;return-1},Q=function(){var a=
{NaN:1,Infinity:1,"-Infinity":1},c=String.prototype.toLowerCase,b=Object.prototype.toString;return function(e,h){h=c.call(h);if(h=="finite")return!a.hasOwnProperty(+e);return h=="null"&&e===null||h==typeof e||h=="object"&&e===Object(e)||h=="array"&&Array.isArray&&Array.isArray(e)||b.call(e).slice(8,-1).toLowerCase()==h}}(),Lb=function(){function a(h){var f=document.createElement("script"),i=false;f.src=h;f.async=true;f.onload=f.onreadystatechange=function(){if(!i&&(!this.readyState||this.readyState===
"loaded"||this.readyState==="complete")){i=true;f.onload=f.onreadystatechange=null;f&&f.parentNode&&f.parentNode.removeChild(f)}};b||(b=document.getElementsByTagName("head")[0]);b.appendChild(f)}var c=0,b,e=this;return function(h,f,i){h+=h.indexOf("?")>=0?"&":"?";var k="json"+ ++c;e[k]=function(g){f(g);e[k]=null;try{delete e[k]}catch(j){}};a(h+(i?i:"callback")+"="+k);return k}}();INTERACT=function(){function a(m){return function(p,q){m.addEventListener(p,q,false)}}function c(m){return function(p,
q){m.removeEventListener(p,q,false)}}function b(m){return function(p,q){m.attachEvent("on"+p,q)}}function e(m,p){return{x:m?m:0,y:p?p:0,count:1}}function h(m,p){d.push(M({handler:null,checks:{},type:m},p))}function f(m){var p=0,q=0;if(m.offsetParent){do{p+=m.offsetLeft;q+=m.offsetTop;m=m.offsetParent}while(m)}return{left:p,top:q}}function i(m,p){return{source:m,target:p.target?p.target:p.srcElement}}function k(m,p){for(var q=m.target?m.target:m.srcElement;q&&q!==p;)q=q.parentNode;return q&&q===p}
function g(m,p){return{x:m.x-(p?p.left:0),y:m.y-(p?p.top:0)}}function j(m,p){if(m.preventDefault){m.preventDefault();m.stopPropagation()}else if(typeof m.cancelBubble!="undefined")m.cancelBubble=true;p&&m.stopImmediatePropagation&&m.stopImmediatePropagation()}var d=[],l=function(m,p,q){q=M({binder:null,unbinder:null,observable:null},q);for(var B=q.observable,n=[],w,u,v={bind:function(){return B.bind.apply(null,arguments)},unbind:function(){B.unbind();for(D=0;D<n.length;D++)n[D].unbind();return v}},
D=0;D<p.length;D++)n.push(p[D](m,B,q));B.bind("pointerDown",function(){u=w=0});B.bind("pointerMove",function(o,y,x,r){w+=r.x||0;u+=r.y||0});B.bind("pointerUp",function(o,y,x){Math.abs(w)>20||Math.abs(u)>20||B.triggerCustom("tap",o,y,x)});return v};h("pointer",{handler:function(m,p,q){function B(z){if(z.pageX&&z.pageY)return e(z.pageX,z.pageY);else{var K=document.documentElement,P=document.body;return e(z.clientX+(K&&K.scrollLeft||P&&P.scrollLeft||0)-(K&&K.clientLeft||P&&P.clientLeft||0),z.clientY+
(K&&K.scrollTop||P&&P.scrollTop||0)-(K&&K.clientTop||P&&P.clientTop||0))}}function n(z){if(k(z,m))if(r=D(z)){var K=B(z);m.style.cursor="move";j(z,true);J=K.x;L=K.y;C=e(J,L);p.triggerCustom("pointerDown",i("mouse",z),C,g(C,f(m)))}}function w(z){var K=B(z);E=K.x;F=K.y;if(k(z,m))o(z,r?"pointerMove":"pointerHover")}function u(z){if(r&&D(z)){r=false;if(k(z,m)){m.style.cursor="default";o(z,"pointerUp")}}}function v(z){if(k(z,m)){var K;z=z||window.event;if(z.detail)K=z.axis===2?-z.detail*y:0;else{K=z.wheelDeltaY?
z.wheelDeltaY:z.wheelDelta;if(window.opera)K=-K}if(K!==0){var P=e(E,F);p.triggerCustom("zoom",i("mouse",z),P,g(P,f(m)),K/x,"wheel");j(z);z.returnValue=false}}}function D(z){z=z||window.event;return(z.which||z.button)==1}function o(z,K,P,W,U){P=typeof P!="undefined"?P:E;W=typeof W!="undefined"?W:F;var G=P-J,R=W-L,I=e(P,W);p.triggerCustom(K,i("mouse",z),I,g(I,f(m)),e(G,R));if(typeof U=="undefined"||U){J=P;L=W}}q=M({},q);var y=120,x=y*8,r=false,C,E,F,J,L;q.binder("mousedown",n);q.binder("mousemove",
w);q.binder("mouseup",u);q.binder("dblclick",function(z){ca("captured double click");if(k(z,m)){var K=B(z);p.triggerCustom("doubleTap",i("mouse",z),K,g(K,f(m)))}});q.binder("mousewheel",v);q.binder("DOMMouseScroll",v);return{unbind:function(){q.unbinder("mousedown",n);q.unbinder("mousemove",w);q.unbinder("mouseup",u);q.unbinder("mousewheel",v);q.unbinder("DOMMouseScroll",v)}}},checks:{touch:false}});h("pointer",{handler:function(m,p,q){function B(G){if(G.count<2)return 0;var R=G.x-G.next.x;G=G.y-
G.next.y;return~~Math.sqrt(R*R+G*G)}function n(G,R,I){R=R?R:0;I=I?I:0;for(var S={x:G.x-R,y:G.y-I,id:G.id,count:G.count},Y=S;G.next;){G=G.next;Y=Y.next={x:G.x-R,y:G.y-I,id:G.id}}return S}function w(G,R){var I=G[R?R:"touches"],S,Y;if(I.length===0)return null;Y=S={x:I[0].pageX,y:I[0].pageY,id:I[0].identifier,count:I.length};for(var aa=1,Qa=I.length;aa<Qa;aa++)Y=Y.next={x:I[aa].pageX,y:I[aa].pageY,id:I[aa].identifier};return S}function u(G){if(k(G,m)){F=f(m);var R=w(G,"changedTouches"),I=n(R,F.left,F.top);
if(!L){J=r;p.triggerCustom("pointerDown",i("touch",G),R,I)}W&&p.triggerCustom("pointerDownMulti",i("touch",G),R,I);L=w(G);if(L.count>1)K=B(L);U=1;P=n(L)}}function v(G){if(k(G,m)){j(G);z=w(G);if(J==r)J=Math.abs(L.x-z.x)>y||Math.abs(L.y-z.y)>y?x:r;if(J!=r){J=z.count>1?E:C;if(J==E)if(L.count===1){L=n(z);K=B(L)}else{var R=B(z);if(Math.abs(K-R)<o)J=C;else{var I;I=z.x;var S=z.next.x,Y=z.y,aa=z.next.y;I={x:(I<S?I:S)+(Math.abs(I-S)>>1),y:(Y<aa?Y:aa)+(Math.abs(Y-aa)>>1)};R=R/K;S=R-U;p.triggerCustom("zoom",
i("touch",G),I,g(I,F),S,"pinch");U=R}}J==C&&p.triggerCustom("pointerMove",i("touch",G),z,n(z,F.left,F.top),e(z.x-P.x,z.y-P.y));W&&p.triggerCustom("pointerMoveMulti",i("touch",G),z,n(z,F.left,F.top))}P=n(z)}}function D(G){if(k(G,m)){var R=w(G,"changedTouches"),I=n(R,F.left,F.top);z=w(G);if(!z){p.triggerCustom("pointerUp",i("touch",G),R,I);L=null}W&&p.triggerCustom("pointerUpMulti",i("touch",G),R,I)}}q=M({detailed:false,inertia:false},q);var o=20,y=7,x=0,r=1,C=2,E=3,F,J,L,z,K,P,W=q.detailed,U=1;q.binder("touchstart",
u);q.binder("touchmove",v);q.binder("touchend",D);ca("initialized touch handler");return{unbind:function(){q.unbinder("touchstart",u);q.unbinder("touchmove",v);q.unbinder("touchend",D)}}},checks:{touch:true}});return{register:h,watch:function(m,p,q){p=M({bindTarget:null,observable:null,isIE:typeof window.attachEvent!="undefined",types:null},p);capabilities=M({touch:"ontouchstart"in window},q);if(!p.observable){ca("creating observable");p.observable=ua({});globalOpts=p}p.binder=(p.isIE?b:a)(p.bindTarget||
document);p.unbinder=(p.isIE?b:c)(p.bindTarget||document);q=p.types;for(var B=capabilities,n=[],w=d.length;w--;){var u=d[w],v=!q||q.indexOf(u.type)>=0,D=true,o;for(o in u.checks){var y=u.checks[o];ca("checking "+o+" capability. require: "+y+", capability = "+B[o]);D=D&&y===B[o]}if(v&&D)n[n.length]=u.handler}return new l(m,n,p)}}}();var H=ua({}),Ra=function(){var a={};return{create:function(c,b){if(a[c][b])return a[c][b].apply(null,Array.prototype.slice.call(arguments,2));throw Mb(c,b);},get:function(c,
b){return a[c]?a[c][b]:null},register:function(c,b,e){a[c]||(a[c]={});a[c][b]&&ca(Nb(c,b),"warn");a[c][b]=e}}}(),Nb=ka("Registration of {0}: {1} will override existing definition"),Mb=ka("Could not create {0} of type: {1}");ka("Could not create drawable of type: {0}");var eb=[1.406245461070741,1.321415085624082,1.077179995861952,0.703119412486786,0.488332580888611],$=Math.PI*2,Ma=Math.PI/2,Hb=3,ea=Math.PI/180,ma=180/Math.PI,$a=90,Jb=-$a,Pa=180,vb=-Pa,fb=$a*ea,wb=-fb,xb=Pa*ea,Ob=-xb,La=0.08181919084262157,
la=Math.abs,yb=Math.ceil,Ha=Math.round,Sa=Math.min,Ga=Math.max,za=Math.pow,gb=Math.sqrt,Aa=Math.log,ra=Math.sin,zb=Math.asin,Ta=Math.cos,qb=Math.atan,Pb=Math.atan2,va="undefined",na="string",oa="number",ub="array",ba=Ra.register,wa=Ra.create,Qb=Ra.get,Rb=0,Ib=0,Ya=/[\,\s]+/,Ca=function(){function a(i){h++;i=i||(new Date).getTime();for(var k=e.length;k--;){var g=e[k];h%g.every===0&&g.cb(i)}f&&animFrame(a)}var c=1E3/60,b=["r","webkitR","mozR","oR","msR"],e=[],h=0,f=function(){for(var i=0;i<b.length;i++)window.animFrame=
window.animFrame||window[b[i]+"equestAnimationFrame"];window.animFrame&&ca("Using request animation frame");return animFrame}();f?animFrame(a):setInterval(a,1E3/60);return{attach:function(i,k){e[e.length]={cb:i,every:k?Ha(k/c):1}},detach:function(i){for(var k=e.length;k--;)if(e[k].cb===i){e.splice(k,1);break}}}}(),Gb=function(){var a=/^xy\((.*)\).*$/i;return{parseXY:function(c){if(!a.test(c)){c=c.split(Ya);return Ua(c[1],c[0])}}}}(),X=function(){function a(e){for(var h=0;h<e.length;h++){var f=e[h];
if(typeof document.body.style[f]!="undefined")return f}}var c={"-webkit-user-select":"none",position:"absolute"},b;b=a(["-webkit-transform","MozTransform"]);css3DTransformProp=a(["WebkitPerspective","MozPerspective"]);return{transforms:Q(b,na),create:function(e,h,f){e=document.createElement(e);var i=[];f=f||{};e.className=h||"";for(var k in f)i[i.length]=k+": "+f[k];e.style.cssText=i.join(";");return e},move:function(e,h,f,i){if(b)e.style[b]="translate("+h+"px, "+f+"px) "+(i||[]).join(" ");else{e.style.left=
h+"px";e.style.top=f+"px"}},styles:function(e){return M({},c,e)}}}(),Ab=function(){function a(){for(var h=e.length,f=h;f--;)try{e[f](h)}catch(i){ca(i.toString(),"error")}}var c=20,b=50,e=[];return{process:function(h,f,i){function k(d){d=(g||b)/d;if(j<h.length){var l=h.slice(j,j+d);d=l.length;var m=g?0:(new Date).getTime();f(l,d);if(!g){g=(l=((new Date).getTime()-m)/d)?c/l|0:h.length;ca("calculated that we can process "+g+" items per cycle")}j+=d}else{for(d=e.length;d--;)if(e[d]===k){e.splice(d,1);
break}e.length===0&&Ca.detach(a);i&&i()}}var g,j=0;e.push(k)===1&&Ca.attach(a)}}}(),Ua=Ua||function(a,c){var b=parseFloat(c)*ea;b=ra(b);var e=La*b;b=Aa((1+b)/(1-b)*za((1-e)/(1+e),La))/2;return new sa(0,0,parseFloat(a)*ea,b)},hb=hb||function(a,c){for(var b=za(Math.E,-c),e=Ma-2*qb(b),h=pb(e,b),f=0;f<12&&la(e-h)>1.0E-7;){e=h;h=pb(e,b);f++}return new ia(h*ma,a%360*ma)};da.prototype={constructor:da,add:function(){for(var a=this.x,c=this.y,b=arguments.length;b--;){a+=arguments[b].x;c+=arguments[b].y}return this.copy(a,
c)},copy:function(a,c){var b=M({},this);b.x=a||b.x;b.y=c||b.y;return b},equals:function(a){return this.x===a.x&&this.y===a.y},offset:function(a,c){return this.copy(this.x+a,this.y+c)},relative:function(a){a=a.viewport();return this.copy(this.x-a.x-a.padding.x,this.y-a.y-a.padding.y)},sync:function(){return this},toString:function(){return this.x+", "+this.y}};sa.prototype=M(new da,{constructor:sa,pos:function(){return hb(this.mercX,this.mercY)},sync:function(a,c){var b;if(!(b=a.rpp)){b=a.zoom();b=
$/(256<<b)}b=b;if(c){this.mercX=this.x*b-Math.PI;this.mercY=Math.PI-this.y*b}else{this.x=Ha(((this.mercX||0)+Math.PI)/b);this.y=Ha((Math.PI-(this.mercY||0))/b)}return this}});ta.prototype={constructor:ta,buffer:function(a,c){return new ta(this.x-a,this.y-(c||a),this.w+a*2,this.h+(c||a)*2)},center:function(){return new da(this.x+(this.w>>1),this.y+(this.h>>1))}};ba("fn","simplify",rb);Hits=function(){return{diffHits:function(a,c){var b=[],e={},h;for(h=c.length;h--;)e[c[h].target.id]=true;for(h=a.length;h--;)e[a[h].target.id]||
(b[b.length]=a[h]);return b},init:function(a,c,b,e){return{type:a,x:e.x|0,y:e.y|0,elements:[],absXY:c,relXY:b}},initHit:function(a,c,b){return{type:a,target:c,drag:b}},triggerEvent:function(a,c,b,e){c.triggerCustom(a.type+(b?b:"Hit"),{hitType:a.type},e?e:a.elements,a.absXY,a.relXY,new sa(a.x,a.y))}}}();var tb=function(a){function c(f,i){var k=b[f],g;k||(k=b[f]=[]);(g=k[i])||(g=k[i]=[]);return g}a=a||128;var b=[],e={},h=0;return{copyInto:function(f){for(var i in e){var k=e[i];f.insert(k.bounds||k,
k,i)}},insert:function(f,i,k){var g=f.x/a|0,j=f.y/a|0,d=(f.x+f.w)/a|0;f=(f.y+f.h)/a|0;k=k||i.id||"obj_"+h++;e[k]=i;for(i=g;i<=d;i++)for(g=j;g<=f;g++)c(i,g).push(k)},remove:function(f,i,k){k=k||i.id;if(e[k]){var g=f.x/a|0;i=f.y/a|0;var j=(f.x+f.w)/a|0;f=(f.y+f.h)/a|0;delete e[k];for(g=g;g<=j;g++)for(var d=i;d<=f;d++){var l=c(g,d),m=db.call(l,k);m>=0&&l.splice(m,1)}}},search:function(f){var i=f.y/a|0,k=(f.x+f.w)/a|0,g=(f.y+f.h)/a|0,j=[],d=[];for(f=f.x/a|0;f<=k;f++)for(var l=i;l<=g;l++)j=j.concat(c(f,
l));j.sort();for(i=j.length;i--;){k=j[i];if(g=e[k])d[d.length]=g;for(;i>0&&j[i-1]==k;)i--}return d}}},Va=function(){var a={},c=0;(new Date).getTime();var b={},e=[];Ca.attach(function(h){h=h||(new Date).getTime();for(var f=0;f<e.length;){var i=e[f],k=b[i],g=b[i].image&&b[i].image.complete&&b[i].image.width>0,j=h-k.start;j=g||j>=3E4;if(g){g=k.callbacks;a[i]=k.image;for(var d=0;d<g.length;d++)g[d](k.image,true)}if(j){e.splice(f,1);delete b[i]}else f++}},250);return function(h,f){var i=h&&f?a[h]:null;
if(i&&i&&i.complete&&i.width>0)f(i);else if(i=b[h])i.callbacks.push(f);else{i=new Image;i.id="_ldimg"+ ++c;b[h]={start:(new Date).getTime(),image:i,callbacks:[f]};i.src=h;e[e.length]=h}}}();Za.prototype={constructor:Za,load:function(a){var c=this;Va(this.url,function(b){c.loaded=true;c.image=b;a&&a()})}};var Sb=function(){return ua({fastpan:true,applyStyle:function(){},applyTransform:function(a,c,b){return{restore:null,x:c,y:b}},checkSize:function(){},getDimensions:function(){return{width:0,height:0}},
getViewport:function(){},hitTest:function(){return false},prepare:function(){},projectXY:null,reset:function(){}})};ba("renderer","canvas",function(a,c,b,e,h){function f(o,y,x){var r,C;p[y]=function(E){for(r=v.length;r--;)if(C=x[v[r]])E[D[r]]=C}}function i(o,y,x){var r=false;if(y)r=d.isPointInPath(B?y.x-l:y.relXY.x,B?y.y-m:y.relXY.y);return{draw:x||u,viewport:o,hit:r,vpX:l,vpY:m,context:d}}e=M({},e);var k,g,j,d,l=0,m=0,p={},q=null,B=bb.canvas.pipTransformed,n={},w=function(){},u=function(){this.fill&&
d.fill();this.stroke&&d.stroke()},v=["fill","stroke","lineWidth","opacity"],D=["fillStyle","strokeStyle","lineWidth","globalAlpha"];if(c){k=c.offsetWidth;g=c.offsetHeight;j=X.create("canvas",null,{position:"absolute","z-index":1});j.width=k;j.height=g;a.attachFrame(j,true);d=null}b=M(h,{applyStyle:function(o){var y=p[o],x=d&&d.canvas?d.canvas.id:"default",r;n[x]||(n[x]=[]);r=n[x].pop()||"reset";if(y){n[x].push(o);y(d);return r}},applyTransform:function(o){if(o.translateX!==0||o.translateY!==0||o.scaling!==
1||o.rotation!==0){d.save();q={undo:function(){d.restore();q=null},x:o.xy.x,y:o.xy.y};d.translate(o.xy.x-l+o.translateX,o.xy.y-m+o.translateY);o.rotation!==0&&d.rotate(o.rotation);o.scaling!==1&&d.scale(o.scaling,o.scaling)}return q},drawTiles:function(o,y,x){for(var r=y.length;r--;){o=y[r];if(!o.loaded&&x)o.load(a.invalidate);else o.image&&d.drawImage(o.image,o.x-l,o.y-m)}},prepare:function(o,y){var x,r=false,C=y.scaled||y;if(d)d.restore();else d=j.getContext("2d");for(x=o.length;x--;)r=r||o[x].clip;
l=C.x;m=C.y;if(d){r||d.clearRect(0,0,k,g);d.save()}d.globalCompositeOperation="source-over";return d},prepArc:function(o,y,x){d.beginPath();d.arc(o.xy.x-(q?q.x:l),o.xy.y-(q?q.y:m),o.size>>1,o.startAngle,o.endAngle,false);return i(y,x)},prepImage:function(o,y,x,r){var C=(r.x||o.xy.x)-(q?q.x:l),E=(r.y||o.xy.y)-(q?q.y:m),F=r.image||o.image;if(F){d.beginPath();d.rect(C,E,r.width||F.width,r.height||F.height);return i(y,x,function(){d.drawImage(F,C,E,r.width||F.width,r.height||F.height)})}},prepMarker:function(o,
y,x){var r=o.xy.x-(q?q.x:l),C=o.xy.y-(q?q.y:m),E=o.size,F=undefined;d.beginPath();switch(o.markerType.toLowerCase()){case "image":F=w;d.rect(r-(E>>1),C-(E>>1),E,E);if(o.reset&&o.image){o.image=null;o.reset=false}o.image?d.drawImage(o.image,r-(E>>1),C-(E>>1),E,E):Va(o.imageUrl,function(J){o.image=J;d.drawImage(o.image,r-(E>>1),C-(E>>1),E,E)});break;default:d.moveTo(r,C);d.lineTo(r-(E>>1),C-E);d.lineTo(r+(E>>1),C-E);d.lineTo(r,C)}return i(y,x,F)},prepPoly:function(o,y,x,r){var C=true;o=r.points||o.points;
r=q?q.x:l;var E=q?q.y:m;d.beginPath();for(var F=o.length;F--;){var J=o[F].x-r,L=o[F].y-E;if(C){d.moveTo(J,L);C=false}else d.lineTo(J,L)}return i(y,x)},getContext:function(){return d}});(function(){Bb.each(function(o,y){f(null,o,y)});H.bind("styleDefined",f)})();b.bind("detach",function(){c.removeChild(j)});return b});ba("renderer","dom",function(a,c,b,e,h){function f(d){var l=d.image=new Image;g[d.id]=d;l.src=d.url;l.onload=function(){if(j[d.id])k.appendChild(this);else d.image=null};l.style.cssText=
"-webkit-user-select: none; -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; position: absolute;";return l}function i(d,l,m){var p=[],q;for(q in d){var B=d[q];if(m?B[m]:!l[q]){if(B.image&&
B.image.parentNode){k.removeChild(B.image);B.image=null}p[p.length]=q}}for(l=p.length;l--;)delete d[p[l]]}var k=null,g={},j={};k=X.create("div","",X.styles({width:c.offsetWidth+"px",height:c.offsetHeight+"px"}));c.childNodes.length>0?c.insertBefore(k,c.childNodes[0]):c.appendChild(k);a.attachFrame(k);b=M(h,{drawTiles:function(d,l,m){for(var p,q=d.x,B=d.y,n=l.length;n--;){d=l[n];if(d.url){(p=d.image||(m?f(d):null))&&X.move(p,d.x-q,d.y-B);j[d.id]=d}}}});b.bind("predraw",function(){i(g,j);j={}});b.bind("detach",
function(){c.removeChild(k)});a.bind("zoom",function(){for(i(g,j={});k.childNodes.length>0;)k.removeChild(k.childNodes[0])});return b});var Bb=function(){function a(b,e){if(Q(b,na)){H.trigger("styleDefined",b,c[b]=e);return b}else{var h=[],f;for(f in b)h[h.length]=a(f,b[f]);return h}}var c={};a({reset:{fill:"#ffffff",opacity:1},highlight:{fill:"#ff0000"},waypoints:{lineWidth:4,stroke:"#003377",fill:"#ffffff"},waypointsHover:{lineWidth:4,stroke:"#ff0000",fill:"#ffffff"}});return{resetStyle:"reset",
each:function(b){for(var e in c)b(e,c[e])},get:function(b){return c[b]},define:a}}();ba("view","view",function(a){function c(s,t,A,N){v(Ga(V+za(2,N)-1,0.125),false,true)}function b(s,t){var A=renderer&&renderer.projectXY?renderer.projectXY(s,t):null;if(!A){A=n();var N=1/V;A=new O.XY(A?A.x+s*N:s,A?A.y+t*N:t)}return A.sync(O,true)}function e(s,t,A){D("doubleTap",t,A,b(A.x,A.y));a.scalable&&v(2,{easing:"quad.out",duration:300},true)}function h(s,t,A){L=null;W=true;B("down",t,A)}function f(s,t,A){B("hover",
t,A)}function i(s,t,A,N){m(t,A,false);if(!L){U=N.x;G=N.y}}function k(s,t,A){m(t,A,true);W=false}function g(){clearTimeout(Cb);Cb=setTimeout(function(){renderer.checkSize()},250)}function j(s,t,A){B("tap",t,A);O.trigger("tap",t,A,b(A.x,A.y,true))}function d(s){var t=O,A=E,N=J,T=a;s=(s||a.renderer).split("/");for(var ja=new Sb(t,A,N,T),pa=0;pa<s.length;pa++)ja=wa("renderer",s[pa],t,A,N,T,ja);renderer=ja;P=a.fastpan&&renderer.fastpan&&X.transforms;l()}function l(){ga&&ga.unbind();if(renderer){ga=INTERACT.watch(renderer.interactTarget||
J);if(a.scalable){ga.bind("zoom",c);ga.bind("doubleTap",e)}ga.bind("pointerDown",h);ga.bind("pointerMove",i);ga.bind("pointerUp",k);a.captureHover&&ga.bind("pointerHover",f);ga.bind("tap",j)}}function m(s,t,A){if(L){s=b(t.x,t.y);L.drag.call(L.target,L,s.x,s.y,A)&&Z++;if(A)L=null}}function p(s){for(var t=C;t--;)if(r[t].id===s)return t;return C}function q(s){J=document.getElementById(s);J.appendChild(F=X.create("div","",X.styles({overflow:"hidden",width:J.offsetWidth+"px",height:J.offsetHeight+"px"})));
s=a.padding;if(s===y){s=J.offsetWidth;var t=J.offsetHeight,A=gb(s*s+t*t);ha=new da(A-s>>1,A-t>>1)}else ha=new da(s,s);ib=F.offsetWidth+ha.x*2;jb=F.offsetHeight+ha.y*2;kb=J.offsetWidth/2;lb=J.offsetHeight/2;F.appendChild(E=X.create("div","",X.styles({width:ib+"px",height:jb+"px","z-index":2,margin:-ha.y+"px 0 0 "+-ha.x+"px"})));d()}function B(s,t,A){fa=Hits.init(s,t,A,b(A.x,A.y,true));for(s=C;s--;)if(r[s].visible)K=K||(r[s].hitGuess?r[s].hitGuess(fa.x,fa.y,O):false);K&&Z++}function n(){var s=new ta(I,
S,ib,jb);s.scaleFactor=V;s.padding=ha?ha.copy():new da;return s}function w(s,t,A){if(Q(s,na)&&Q(t,va))for(t=0;t<C;t++){if(r[t].id===s)return r[t]}else if(Q(s,na)){t=wa("layer",t,O,A);t.added=(new Date).getTime();t.id=s;r[p(s)]=t;r.sort(function(N,T){return T.zindex-N.zindex||T.added-N.added});C=r.length;O.trigger("resync");u();O.trigger("layerChange",O,t);Z++;return t}else return[].concat(r)}function u(){var s=n();if(s){if(Da||Ea)if(s){var t=Wa?I+(s.w>>1):I,A=Xa?S+(s.h>>1):S,N=s.w,T=s.h;if(Da&&Da>
N)if(t+N>Da)I=Wa?I:Da-N;else if(t<0)I=Wa?I:0;if(Ea&&Ea>T)if(A+T>Ea)S=Xa?S:Ea-T;else if(A<0)S=Xa?S:0}Qa=I;Db=S;O.trigger("refresh",O,s);Z++}}function v(s,t,A){if(Q(s,oa)){var N=A?s:V*s;if(!Tb){t=null;s=Ha(Aa(N)/Math.LN2);N=za(2,s)}if(t)Ia=qa.tween([V],[N],t,function(){V=N;Ia=null;Z++});else{V=N;Z++}return O}else return V}function D(){for(var s=O.trigger.apply(null,arguments).cancel,t=r.length;t--;)s=r[t].trigger.apply(null,arguments).cancel||s;return!s}function o(s,t,A){if(Q(s,oa)){if(A)xa=qa.tween([I,
S],[s,t],A,function(){xa=null});else{I=s|0;S=t|0;Z++}return O}else return(new O.XY(I,S)).sync(O,true)}a=M({container:"",captureHover:true,controls:[],drawOnScale:true,fastpan:true,padding:128,inertia:true,refreshDistance:256,pannable:true,scalable:true,renderer:"canvas"},a);var y="auto",x=[],r=[],C=0,E=null,F=null,J,L=null,z=!Q(window.attachEvent,va),K=false,P,W=false,U=0,G=0,R=a.refreshDistance,I=0,S=0,Y=0,aa=0,Qa=0,Db=0,Da=null,Ea=null,Wa=false,Xa=false,xa=null,ha,fa=null,Ja=null,Cb=0,ya=0,Ka=null,
V=1,Ia=null,mb=1,ga=null,nb={index:0,draw:false},Tb=true,Z=0,ib,jb,kb,lb,O={XY:da,id:a.id,panSpeed:0,attachFrame:function(s,t){t&&E.appendChild(s)},center:function(s,t,A){if(Q(s,na)||Q(s,"object")){t=new O.XY(s);t.sync(O);s=t.x;t=t.y}if(Q(s,oa)){o(s-kb-ha.x,t-lb-ha.y,A);return O}else return o().offset(kb+ha.x|0,lb+ha.y|0).sync(O,true)},detach:function(){renderer&&renderer.trigger("detach");ga&&ga.unbind();if(F){J.removeChild(F);E=F=null}},layer:w,invalidate:function(){Z++},pan:function(s,t,A){o(I+
s,S+t,A)},refresh:u,rotate:function(s,t,A){if(Q(s,oa)){var N=A?s:ya+s;if(t)Ka=qa.tween([ya],[N],t,function(){ya=N%360;Ka=null;Z++});else{ya=N%360;Z++}return O}else return ya},scale:v,triggerAll:D,setMaxOffset:function(s,t,A,N){Da=s;Ea=t;Wa=A;Xa=N},offset:o,viewport:n};ua(O);O.bind("resize",function(){renderer.checkSize()});O.bind("layerRemove",function(s,t){var A=db(r,t.id);if(A>=0&&A<C){r.splice(A,1);Z++}C=r.length});cb(O,a,{container:q,captureHover:l,scalable:l,pannable:l,renderer:function(s){if(renderer){renderer.trigger("detach");
renderer=null}d(s);Z++}});bb.init(function(){w("markers","draw",{zindex:20});q(a.container);z?window.attachEvent("onresize",g):window.addEventListener("resize",g,false)});Ca.attach(function(s){var t=[],A,N,T;self.panSpeed=panSpeed=la(U)+la(G);A=V!==mb;if(panSpeed>0||A||xa||Ia||Ka){Z++;if(xa&&panSpeed>0){xa(true);xa=null}}if(panSpeed<2&&(la(I-Qa)>=R||la(S-Db)>=R))u();nb.index++;nb.draw=Z||panSpeed||0;if(renderer&&nb.draw){if(Ia)V=Ia()[0];if(Ka)ya=Ka()[0];Y+=U;aa+=G;if(U||G)O.trigger("pan");if(X.transforms){if(V!==
1)t[t.length]="scale("+V+")";if(ya!==0)t[t.length]="rotate("+ya+"deg)"}if(A=!P||(a.drawOnScale||V===1)&&panSpeed<5){if(xa){A=xa();I=A[0]|0;S=A[1]|0}else{I=I-Y/V|0;S=S-aa/V|0}T=n();renderer.trigger("predraw",T);if(renderer.prepare(r,T,s,fa)){N=aa=A=Y=Z=0;for(ii=C;ii--;){var ja=r[ii];if(ja.visible){var pa=ja.style?renderer.applyStyle(ja.style,true):null;ja.draw(renderer,T,O,s,fa);pa&&renderer.applyStyle(pa)}}renderer.trigger("render",T);O.trigger("drawComplete",T,s);X.move(E,A,N,t)}}else X.move(E,Y,
aa,t);if(W||!a.inertia)G=U=0;else if(U!=0||G!=0){U*=0.8;G*=0.8;if(la(U)<0.5)U=0;if(la(G)<0.5)G=0}if(fa){s=fa?fa.elements:[];if(Ja&&Ja.type==="hover"){t=Hits.diffHits(Ja.elements,s);t.length>0&&Hits.triggerEvent(Ja,O,"Out",t)}if(s.length>0){A=fa.x;N=fa.y;for(t=s.length;t--;){T=s[t];ja=A;pa=N;var Eb=T&&T.drag&&(!T.canDrag||T.canDrag(T,ja,pa));if(Eb){L=T;L.startX=ja;L.startY=pa}if(Eb)break}Hits.triggerEvent(fa,O)}Ja=s.length>0?M({},fa):null;fa=null}if(mb!==V){O.trigger("scaleChanged",V);mb=V}}});(function(s){x=
[];for(var t=0;t<s.length;t++)x[x.length]=wa("control",s[t],O,F,J,a[s[t]])})(a.controls);return O});ba("view","map",function(a){function c(g,j){var d=k.viewport();if(g){d=Ga(g.bestZoomLevel(d),j||0);return b(d).center(g.center())}else return new Fa((new sa(d.x,d.y2)).sync(k,true).pos(),(new sa(d.x2,d.y)).sync(k,true).pos())}function b(g,j,d){if(Q(g,oa)){g=Ga(a.minZoom,Sa(a.maxZoom,g|0));if(g!==f){var l=k.viewport(),m=k.offset(),p=l.w/2;l=l.h/2;var q=za(2,g-f),B=p/q|0,n=l/q|0;f=g;k.offset(((j||m.x+
p)-B)*q,((d||m.y+l)-n)*q);refreshY=refreshX=0;k.trigger("zoom",g);h=k.rpp=$/(256<<f);k.setMaxOffset($/h|0,$/h|0,true,false);k.scale(1,false,true);k.trigger("resync");k.refresh()}return k}else return f}a=M({controls:["zoombar"],minZoom:1,maxZoom:18,renderer:"canvas/dom",zoom:1,zoombar:{}},a);var e=new sa,h,f=a.zoom||a.zoomLevel,i=0,k=M(wa("view","view",a),{XY:sa,bounds:c,zoom:b});k.bind("refresh",function(){var g=k.viewport();if(e.x!=g.x||e.y!=g.y){k.trigger("boundsChange",c());e.x=g.x;e.y=g.y}});
k.bind("scaleChanged",function(g,j){var d=Aa(j)/Math.LN2|0;if(d!==0){j=za(2,d);clearTimeout(i);i=setTimeout(function(){b(f+d)},500)}});return k});var qa=function(){return{tween:function(a,c,b,e,h){function f(q){var B=q-p;q=p+m<=q;for(var n=i;n--;){k[n]=j(B,a[n],d[n],m);h&&h.invalidate()}if(q||l){Ca.detach(f);for(n=0;n<g.length;n++)g[n]&&g[n](k,B,l)}}b=M({easing:"sine.out",duration:1E3,complete:null},b);var i=a.length,k=[].concat(a),g=[e,b.complete],j=Kb(b.easing),d=[],l=false,m=b.duration,p=(new Date).getTime();
for(b=i;b--;)d[b]=c[b]-a[b];Ca.attach(f);return function(q){l=q;return k}},tweenDrawable:function(a,c,b,e,h){var f=qa.tween([b],[e],h,function(){a[c]=e;for(var k=a.tweens.length;k--;)if(a.tweens[k]===i){a.tweens.splice(k,1);break}},a.view),i=function(){a[c]=f()[0]};return i}}}(),Ba=function(a,c,b){b=M({style:null,xy:null,size:20,fill:false,stroke:true,draggable:false,observable:true,properties:{},typeName:"Shape"},b);M(this,b);if(Q(this.xy,na))this.xy=new a.XY(this.xy);this.id="drawable_"+Rb++;this.bounds=
null;this.view=a;this.layer=c;this.tweens=[];this.rotation=this.animations=0;this.scaling=1;this.translateY=this.translateX=0;this.observable&&ua(this)};Ba.prototype={constructor:Ba,applyTweens:function(){for(var a=this.tweens.length;a--;)this.tweens[a]()},drag:null,draw:null,getProps:null,resync:function(){if(this.xy){this.xy.sync(this.view);if(this.size){var a=this.size>>1;this.updateBounds(new ta(this.xy.x-a,this.xy.y-a,this.size,this.size))}}},rotate:function(a,c,b){if(Q(a,oa)){a=(b?a:this.rotation*
ma+a)*ea;if(c)this.tweens.push(qa.tweenDrawable(this,"rotation",this.rotation,a,c));else{this.rotation=a;this.view.invalidate()}return this}else return this.rotation*ma},scale:function(a,c,b){if(Q(a,oa)){a=b?a:this.scaling*a;if(c)this.tweens.push(qa.tweenDrawable(this,"scaling",this.scaling,a,c));else{this.scaling=a;this.view.invalidate()}return this}else return this.scaling},translate:function(a,c,b,e){if(Q(a,oa)){a=e?a:this.translateX+a;c=e?c:this.translateY+c;if(b){this.tweens.push(qa.tweenDrawable(this,
"translateX",this.translateX,a,b));this.tweens.push(qa.tweenDrawable(this,"translateY",this.translateY,c,b))}else{this.translateX=a;this.translateY=c;this.view.invalidate()}return this}else return new da(this.translateX,this.translateY)},updateBounds:function(a,c){a&&(!this.bounds||a.x!=this.bounds.x||a.y!=this.bounds.y)&&this.trigger("move",this,a,this.bounds);this.bounds=a;if(c)this.xy=this.bounds.center()}};ba("drawable","marker",function(a,c,b){b=M({fill:true,stroke:false,markerType:"simple",
hoverStyle:"highlight",typeName:"Marker"},b);return new Ba(a,c,b)});ba("drawable","poly",function(a,c,b){function e(){var g,j,d,l,m,p,q,B;B=k.points=b.simplify?rb(i):i;for(g=B.length;g--;){j=B[g].x;d=B[g].y;p=Q(p,va)||j<p?j:p;q=Q(q,va)||d<q?d:q;l=Q(l,va)||j>l?j:l;m=Q(m,va)||d>m?d:m}k.updateBounds(new ta(p,q,l-p,m-q),true)}function h(g){if(Q(g,ub)){i=[];Ab.process(g,function(j,d){for(var l=0;l<d;l++)i[i.length]=new a.XY(j[l])},f)}}function f(){i.length&&Ab.process(i,function(g,j){for(var d=j;d--;)g[d].sync(a)},
e)}b=M({simplify:false,fill:true,points:[],typeName:"Poly"},b);var i=[],k=M(new Ba(a,c,b),{points:[],getPoints:function(){return[].concat(i)},resync:f});cb(k,b,{points:h});h(b.points);return k});ba("drawable","line",function(a,c,b){b.fill=false;return wa("drawable","poly",a,c,b)});ba("drawable","image",function(a,c,b){function e(){if(g&&g.width>0){if(!this.centerOffset)this.centerOffset=new da(-g.width>>1,-g.height>>1);this.updateBounds(new ta(this.xy.x+this.centerOffset.x,this.xy.y+this.centerOffset.y,
g.width,g.height),false)}}function h(d){if(this.imageUrl=d){var l=this;Va(this.imageUrl,function(m,p){g=m;if(p){var q=j.layer?j.layer.view:null;q&&q.invalidate()}e.apply(l)})}}b=M({image:null,imageUrl:null,centerOffset:null,typeName:"Image"},b);var f=Ba.prototype.resync,i=0,k=0,g=b.image,j=M(new Ba(a,c,b),{changeImage:h,getProps:function(){this.bounds||e(this,g);return{image:g,x:this.xy.x+i,y:this.xy.y+k}},resync:function(d){f.call(this,d);e.call(this)}});g||h.call(this,this.imageUrl);if(this.centerOffset){i=
this.centerOffset.x;k=this.centerOffset.y}});ba("drawable","arc",function(a,c,b){b=M({startAngle:0,endAngle:Math.PI*2,typeName:"Arc"},b);return new Ba(a,c,b)});Na.prototype={constructor:Na,clip:null,cycle:function(){},draw:function(){},hitGuess:null,remove:function(){this.view.trigger("layerRemove",this)}};ba("layer","tile",function(a,c){c=M({generator:"osm",imageLoadArgs:{}},c);var b=wa("generator",c.generator,c).run,e=null,h=[],f=M(new Na(a,c),{draw:function(i,k,g){i.drawTiles&&i.drawTiles(k,e.search(k.buffer(128)),
g.panSpeed<2)}});a.bind("resync",function(){var i=a&&a.zoom?a.zoom():0;h[i]||(h[i]=sb(i));e=h[i]});a.bind("refresh",function(i,k,g){e&&b(k,g,e,function(){k.invalidate()})});return f});ba("layer","draw",function(a,c){function b(j,d,l,m){var p=this.dragOffset;if(!p)p=this.dragOffset=new a.XY(j.startX-this.xy.x,j.startY-this.xy.y);this.xy.x=d-p.x;this.xy.y=l-p.y;if(m){delete this.dragOffset;a.invalidate();this.xy.sync(a,true);this.trigger("dragDrop")}return true}function e(j){clearTimeout(k);k=setTimeout(function(){f.sort(function(d,
l){if(l.xy&&d.xy){var m=l.xy.y-d.xy.y;return m!=0?m:l.xy.x-d.xy.x}});j&&j.invalidate()},50)}function h(j,d,l,m){m&&i.remove(m,d);i.insert(l,d)}c=M({zindex:10},c);var f=[],i,k=0,g=M(new Na(a,c),{itemCount:0,clear:function(){i=new tb;f=[];g.trigger("cleared");g.itemCount=0;a.invalidate()},create:function(j,d,l){d=wa("drawable",j,a,g,d);if(l)f.unshift(d);else f[f.length]=d;d.resync();i&&d.bounds&&i.insert(d.bounds,d);e(a);d.bind("move",h);g.itemCount=f.length;g.trigger(j+"Added",d);return d},draw:function(j,
d,l,m,p){l={};m=i&&d?i.search(d):[];for(var q=m.length;q--;){var B=m[q],n=B.style||g.style,w,u,v=B.getProps?B.getProps(j):l;w=j["prep"+B.typeName];B.tweens.length>0&&B.applyTweens();u=j.applyTransform(B);if(v=w?w.call(j,B,d,p,v):null){if(p&&v.hit){p.elements.push(Hits.initHit(B.type,B,B.draggable?b:null));w=p.type+"Style";n=B[w]||g[w]||n}n=n?j.applyStyle(n,true):null;(w=B.draw||v.draw)&&w.call(B,v);n&&j.applyStyle(n)}u&&u.undo&&u.undo()}},find:function(){return[].concat(f)},hitGuess:function(j,d){return i&&
i.search({x:j-10,y:d-10,w:20,h:20}).length>0}});a.bind("resync",function(){i=sb(a.zoom(),i);for(var j=f.length;j--;)f[j].resync()});return g});Oa.prototype={constructor:Oa};ba("control","zoombar",function(a,c,b,e){function h(x,r){var C=v[x]=X.create("div","t5-zoombar-button",{position:"absolute",background:f(x),"z-index":51,width:e.width+"px",height:e.buttonHeight+"px","margin-top":(r||0)+"px"});D.appendChild(C)}function f(x,r){return"url("+e.images+") 0 -"+(l+p*3+(x||0)*j*3+(r||0)*j)+"px"}function i(x){return"url("+
e.images+") 0 -"+(l+(x||0)*p)+"px"}function k(x,r){var C;if(x===m){m.style.background=i(r);C="thumb"}else for(var E=0;E<v.length;E++)if(x===v[E]){C="button"+E;v[E].style.background=f(E,r);break}return C}function g(x){if(x!==w){w=x;n=B-w/u*(B-q)|0;X.move(m,0,n-q);clearTimeout(o);o=setTimeout(function(){a.zoom(w)},500)}}e=M({width:24,height:200,images:"img/zoom.png",align:"right",marginTop:10,spacing:10,thumbHeight:16,buttonHeight:16},e);var j=e.buttonHeight,d,l=e.height,m,p=e.thumbHeight,q=e.spacing+
j-(p>>1),B=e.height-j-(p>>1),n=q,w=-1;c=a.minZoom();var u=a.maxZoom()-c+1,v=[],D,o=0,y={button0:function(){a.zoom(a.zoom()+1)},button1:function(){a.zoom(a.zoom()-1)}};D=X.create("div","t5-zoombar",{position:"absolute",background:"url("+e.images+")","z-index":50,overflow:"hidden",width:e.width+"px",height:e.height+"px",margin:function(){var x=e.spacing,r=ka("{0}px 0 0 {1}px");if(e.align==="right")x=b.offsetWidth-e.width-e.spacing;return r(e.marginTop,x)}()});b.childNodes[0]?b.insertBefore(D,b.childNodes[0]):
b.appendChild(D);D.appendChild(m=X.create("div","t5-zoombar-thumb",{position:"absolute",background:i(),"z-index":51,width:e.width+"px",height:e.thumbHeight+"px",margin:"10px 0 0 0",top:n-q+"px"}));h(0);h(1,e.height-e.buttonHeight);d=INTERACT.watch(D,{bindTarget:D});d.bind("pointerMove",function(x,r,C){n=Math.min(Math.max(q,C.y-(p>>1)),B);g(u-(n-q)/B*u|0)});d.bind("pointerDown",function(x){k(x.target,2)});d.bind("pointerUp",function(x){k(x.target,0)});d.bind("tap",function(x){(x=y[k(x.target,2)])&&
x()});c=new Oa(a);c.bind("detach",function(){d.unbind();b.removeChild(D)});a.bind("zoom",function(x,r){g(r)});g(a.zoom());return c});ia.prototype={constructor:ia,distanceTo:function(){if(!targetPos||this.empty()||targetPos.empty())return 0;var a=(targetPos.lat-this.lat)*ea>>1,c=(targetPos.lon-this.lon)*ea>>1;a=ra(a)*ra(a)+Ta(this.lat*ea)*Ta(targetPos.lat*ea)*ra(c)*ra(c);return 6371*2*Pb(gb(a),gb(1-a))},equalTo:function(a){return pos&&this.lat===a.lat&&this.lon===a.lon},empty:function(){return this.lat===
0&&this.lon===0},inArray:function(a){for(var c=a.length;c--;)if(this.equal(a[c]))return true;return false},offset:function(a,c){var b=this.lat*ea,e=this.lon*ea,h=b+a/6371;b=zb(ra(c/6371)/Ta(b));e=e+b;h=(h+Ma)%Math.PI-Ma;e%=$;return new ia(h*ma,e*ma)},toPixels:function(){return Ua(this.lon,this.lat)},toBounds:function(a){var c=a.radians(),b=this.lat*ea,e=this.lon*ea;a=b-c;var h=b+c;if(a>wb&&h<fb){b=zb(ra(c)/Ta(b));c=e-b;if(c<Ob)c+=$;e=e+b;if(e>xb)e-=$}else{a=Ga(a,wb);h=Sa(h,fb);c=vb;e=Pa}return new Fa(new ia(a*
ma,c*ma),new ia(h*ma,e*ma))},toString:function(a){return this.lat+(a||" ")+this.lon}};(function(){ba("fn","generalize",function(a,c,b){var e=a.length,h=[],f=null;b=(b||250)/1E3;for(e=e;e--;)if(e===0)h.unshift(a[e]);else{var i=!f||a[e].inArray(c)?b:f.distanceTo(a[e]);if(a[e]&&i>=b){h.unshift(a[e]);f=a[e]}}return h})})();Fa.prototype={constructor:Fa,bestZoomLevel:function(a){var c=this.center();c=Sa(Ha(la(c.lat)*0.05),eb.length);var b=eb[c],e=this.size();c=yb(Aa(eb[3]*a.h/e.y)/Aa(2));a=yb(Aa(b*a.w/
e.x)/Aa(2));return Sa(isNaN(c)?1E3:c,isNaN(a)?1E3:a)},center:function(){var a=this.size();return new ia(this.min.lat+(a.y>>1),this.min.lon+(a.x>>1))},expand:function(a){this.min.lat-=a;this.max.lat+=a;this.min.lon-=a%360;this.max.lon+=a%360},size:function(a){var c=new da(0,this.max.lat-this.min.lat);c.x=(a||Q(a,va))&&this.min.lon>this.max.lon?360-this.min.lon+this.max.lon:this.max.lon-this.min.lon;return c},toString:function(){return"min: "+this.min+", max: "+this.max}};ab.prototype={constructor:ab,
radians:function(a){if(Q(a,oa)){this.meters=a*6371E3;return this}else return this.meters/6371E3},toString:function(){if(this.meters>1E3)return(this.meters/10|0)/100+"km";return this.meters+"m"}};M(H,{ex:M,log:ca,observable:ua,configurable:cb,formatter:ka,wordExists:function(a,c){for(var b=a.split(/\s|\,/).length;b--;)if(a.toLowerCase()==c.toLowerCase())return true;return false},is:Q,indexOf:db,fn:function(a){return Qb("fn",a)},project:Ua,unproject:hb,getImage:Va,userMessage:function(a,c,b){H.trigger("userMessage",
a,c,b)},Registry:Ra,Style:Bb,DOM:X,Rect:ta,XY:da,Pos:ia,BBox:Fa,Distance:ab,Hits:Hits,Control:Oa,Tile:Za,Tweener:qa});H.RouteTools=function(){function a(j){if(f.test(j))return"-slight";return""}function c(j,d){d.geometry&&j.layer("route","draw").create("line",{points:d.geometry,style:"waypoints",simplify:true})}function b(j){for(var d="unknown",l=e||k,m=0;m<l.length;m++){l[m].regex.lastIndex=-1;var p=l[m].regex.exec(j);if(p){d=l[m].customCheck?l[m].customCheck(j,p):l[m].turnType;break}}return d}var e=
undefined,h=H.fn("generalize"),f=/bear/i,i=/right/i,k=function(){var j=[];j.push({regex:/continue/i,turnType:"continue"});j.push({regex:/(take|bear|turn)(.*?)left/i,customCheck:function(d,l){return"turn-left"+a(l[1])}});j.push({regex:/(take|bear|turn)(.*?)right/i,customCheck:function(d,l){return"turn-right"+a(l[1])}});j.push({regex:/enter\s(roundabout|rotary)/i,turnType:"roundabout"});j.push({regex:/take.*?ramp/i,turnType:"ramp"});j.push({regex:/take.*?exit/i,turnType:"ramp-exit"});j.push({regex:/make(.*?)u\-turn/i,
customCheck:function(d,l){return"uturn"+(i.test(l[1])?"-right":"-left")}});j.push({regex:/proceed/i,turnType:"start"});j.push({regex:/arrive/i,turnType:"arrive"});j.push({regex:/fell\sthrough/i,turnType:"merge"});return j}(),g={calculate:function(j){j=M({engineId:"",waypoints:[],map:null,error:null,autoFit:true,success:null,generalize:false},j);var d=H.Registry.create("service","routing");d&&d.calculate(j,function(l){if(j.generalize)l.geometry=h(l.geometry,l.getInstructionPositions());if(j.map){c(j.map,
l);j.autoFit&&j.map.bounds(l.boundingBox)}j.success&&j.success(l)})},createMapOverlay:c,parseTurnType:b,Instruction:function(j){var d=j=M({position:null,description:"",distance:0,distanceTotal:0,time:0,timeTotal:0,turnType:null},j),l=j.description;l=l.replace(/(\w)(\/)(\w)/g,"$1 $2 $3");d.description=l;if(!j.turnType)j.turnType=b(j.description);return j},RouteData:function(j){j=M({geometry:[],instructions:[],boundingBox:null},j);if(!j.boundingBox)j.boundingBox=new H.BBox(j.geometry);return M({getInstructionPositions:function(){for(var d=
[],l=0;l<j.instructions.length;l++)j.instructions[l].position&&d.push(j.instructions[l].position);return d}},j)}};H.observable(g);return g}();COG=typeof COG!=="undefined"?COG:{};COG.extend=function(){for(var a=arguments[0]||{},c,b=1,e=arguments.length;b<e;b++)if((c=arguments[b])!==null)for(var h in c){var f=c[h];if(a!==f)if(f!==undefined)a[h]=f}return a};(function(){var a=/^P(\d+Y)?(\d+M)?(\d+D)?$/,c=/^(\d+H)?(\d+M)?(\d+S)?$/,b={8601:function(h){h=h.split("T");var f=null;f=null;var i=0,k=0;a.lastIndex=
-1;f=a.exec(h[0]);i+=f[3]?parseInt(f[3].slice(0,-1),10):0;c.lastIndex=-1;f=c.exec(h[1]);k+=f[1]?parseInt(f[1].slice(0,-1),10)*3600:0;k+=f[2]?parseInt(f[2].slice(0,-1),10)*60:0;k+=f[3]?parseInt(f[3].slice(0,-1),10):0;return new e(i,k)}},e=COG.Duration=function(h,f){return{days:h?h:0,seconds:f?f:0}};COG.addDuration=function(){for(var h=new e,f=arguments.length;f--;){h.days+=arguments[f].days;h.seconds+=arguments[f].seconds}if(h.seconds>=86400){h.days+=~~(h.seconds/86400);h.seconds%=86400}return h};
COG.formatDuration=function(h){var f,i,k="";if(h.days)k=h.days+" days ";if(h.seconds){h=h.seconds;if(h>=3600){f=~~(h/3600);h-=f*3600}if(h>=60){i=Math.round(h/60);h-=i*60}if(f)k=k+f+(f>1?" hrs ":" hr ")+(i?(i>10?i:"0"+i)+" min ":"");else if(i)k=k+i+" min";else if(h>0)k=k+(h>10?h:"0"+h)+" sec"}return k};COG.parseDuration=function(h,f){var i=f?b[f]:null;if(i)return i(h);COG.Log.warn("Could not find duration parser for specified format: "+f);return new e}})();H.Decarta=function(){function a(n){return g(f.clientName,
f.clientPassword,f.sessionID,f.configuration,f.release,n)}function c(n,w){return j(n.maxResponses,n.version,n.requestID,n.methodName,w)}function b(n,w){f.server||ca("No server configured for deCarta - we are going to have issues","warn");return d(f.server,n.requestID,escape(w))}function e(n,w){Lb(b(n,a(c(n,n.getRequestBody()))),function(u){var v=u.response.XLS.Response;if(v.numberOfResponses>0&&v[n.methodName+"Response"]){u=null;if(n.parseResponse)u=n.parseResponse(v[n.methodName+"Response"]);w&&
w(u)}else ca("no responses from server: "+u.response,"error")})}function h(n,w){var u=new p({json:n.StreetAddress}),v=new m({countryCode:n.countryCode});v.parse(n.Place);return new H.Addressing.Address({streetDetails:u,location:v,country:n.countryCode?n.countryCode:"",postalCode:n.PostalCode?n.PostalCode:"",pos:w})}var f={sessionID:(new Date).getTime(),server:"",clientName:"",clientPassword:"",configuration:"",maxResponses:25,release:"4.4.2sp03",tileFormat:"PNG",fixedGrid:true,useCache:true,tileHosts:[],
requestTimeout:3E4,geocoding:{countryCode:"US",language:"EN"}},i={DEFAULT:function(n){for(var w=["landmark","municipalitySubdivision","municipality","countrySubdivision"],u="",v=0;v<w.length;v++)if(n[w[v]])u+=n[w[v]]+" ";return u}},k=1,g=ka("<xls:XLS version='1' xls:lang='en' xmlns:xls='http://www.opengis.net/xls' rel='{4}' xmlns:gml='http://www.opengis.net/gml'><xls:RequestHeader clientName='{0}' clientPassword='{1}' sessionID='{2}' configuration='{3}' />{5}</xls:XLS>"),j=ka("<xls:Request maximumResponses='{0}' version='{1}' requestID='{2}' methodName='{3}Request'>{4}</xls:Request>"),
d=ka("{0}/JSON?reqID={1}&chunkNo=1&numChunks=1&data={2}&responseFormat=JSON"),l=function(n){n=H.ex({countryCode:f.geocoding.countryCode,language:f.geocoding.language,freeform:null,streetAddress:{building:null}},n);var w=ka('<xls:Address countryCode="{0}" language="{1}">');return{getXML:function(){var u=w(n.countryCode,n.language);if(n.freeform){var v=String(n.freeform).replace(/(\'|\")/,"\\$1");u+="<xls:freeFormAddress>"+v+"</xls:freeFormAddress>"}return u+"</xls:Address>"}}},m=function(n){n=H.ex({landmark:"",
municipality:"",municipalitySubdivision:"",countrySubdivision:"",countryCode:""},n);var w=H.ex({calcMatchPercentage:function(u){var v=0;if(n.landmark&&n.landmarkSubType){if(H.wordExists(u,n.landmarkSubType)){v+=0.4;v+=H.wordExists(u,n.landmark)?0.6:0}}else{v+=H.wordExists(u,n.municipalitySubdivision)?0.8:0;if(v===0&&n.municipality)v+=H.wordExists(u,n.municipality)?0.7:0}if(n.countrySubdivision)v+=H.wordExists(u,n.countrySubdivision)?0.2:0;return v},getCountryCode:function(){if(n.countryCode)return n.countryCode.toUpperCase();
return""},parse:function(u){for(var v=0;u&&v<u.length;v++){var D=u[v].type?u[v].type.slice(0,1).toLowerCase()+u[v].type.slice(1):"";if(typeof n[D]!=="undefined"){n[D]=u[v].content;if(u[v].subType)n[D+"SubType"]=u[v].subType}}H.ex(w,n)},toString:function(){var u=i[w.getCountryCode()];if(!u)u=i.DEFAULT;return u(n)}},n);return w},p=function(n){n=H.ex({json:{}},n);var w="",u="";if(n.json.Street)w=n.json.Street.content?n.json.Street.content:n.json.Street;w=w&&w.replace?w.replace(/\/\d+$/,""):"";if(n.json.Building)if(n.json.Building.number)u=
n.json.Building.number;return{building:u,street:w,calcMatchPercentage:function(v){var D=0,o=H.Addressing.normalize(v),y=H.Addressing.normalize(w);if(n.json.Building)if(H.Addressing.buildingMatch(v,n.json.Building.number.toString()))D+=0.2;if(o&&y&&H.wordExists(o,y))D+=0.8;return D},toString:function(){if(w)return(u?u+" ":"")+w;return""}}},q=function(){return{methodName:"",maxResponses:25,version:"1.0",requestID:k++,getRequestBody:function(){return""},parseResponse:function(n){return n}}},B=function(){return H.ex(new q,
{methodName:"RUOK",parseResponse:function(n){return{aliasCount:n.maxHostAliases,host:n.hostName}}})};H.Registry.register("generator","decarta",function(n){function w(D,o,y,x){if(D=D.zoom?D.zoom():0){var r=2<<D-1,C=r>>1,E=n.tileSize,F=(o.w/E|0)+1,J=(o.h/E|0)+1,L=(o.x/E|0)-C;o=r-(o.y/E|0)-C-J;var z=y.search({x:(C+L)*E,y:(C+o*-1-J)*E,w:F*E,h:J*E});r={};var K;for(K=z.length;K--;)r[z[K].id]=true;for(z=0;z<=F;z++)for(K=0;K<=J;K++){var P=L+z,W=o+K-1,U=P+"_"+W;if(!r[U]){P=new H.Tile((C+L+z)*E,(C+o*-1-K)*
E,v[z%v.length]+"/openls/image-cache/TILE?LLMIN=0.0,0.0&LLMAX="+u[D]+"&CACHEABLE=true&DS=navteq-world&WIDTH=256&HEIGHT=256&CLIENTNAME="+f.clientName+"&SESSIONID="+f.sessionID+"&FORMAT=PNG&CONFIG="+f.configuration+"&N="+W+"&E="+P,E,E,U);y.insert(P,P)}}x&&x()}}n=H.ex({tileSize:256},n);var u=["89.787438015348100000,360.00000000000000000","85.084059050110410000,180.00000000000000000","66.653475896509040000,90.00000000000000000","41.170427238429790000,45.000000000000000000","22.076741328793200000,22.500000000000000000",
"11.251819676168665000,11.250000000000000000","5.653589942659626000,5.625000000000000000","2.830287664051185000,2.812500000000000000","1.415581451872543800,1.406250000000000000","0.707845460801532700,0.703125000000000000","0.353929573271679340,0.351562500000000000","0.176965641673330230,0.175781250000000000","0.088482927761462040,0.087890625000000000","0.044241477246363230,0.043945312500000000","0.022120740293895182,0.021972656250000000","0.011060370355776452,0.010986328125000000","0.005530185203987857,0.005493164062500000",
"0.002765092605263539,0.002746582031250000","0.001382546303032519,0.001373291015625000","0.000691272945568983,0.000686645507812500","0.000345636472797214,0.000343322753906250"],v=null;H.userMessage("ack","decarta","&copy; deCarta, Inc. Map and Imagery Data &copy; NAVTEQ or Tele Atlas or DigitalGlobe");return{run:function(D,o,y,x){v?w(D,o,y,x):e(new B,function(r){v=[];if(r.aliasCount)for(var C=0;C<r.aliasCount;C++)v[C]="http://"+r.host.replace("^(.*?).(.*)$","\u0001-0"+(C+1)+".\u0002");else v=["http://"+
r.host];w(D,o,y,x)})}}});H.Registry.register("service","geocoder",function(){var n=function(u){function v(y){var x=[],r=y?y.numberOfGeocodedAddresses:0,C=[];if(r>1)C=y.GeocodedAddress;else if(r==1)C=[y.GeocodedAddress];try{for(y=0;C&&y<C.length;y++){var E,F=C[y],J=r=null;if(F&&F.GeocodeMatchCode&&F.GeocodeMatchCode.matchType!=="NO_MATCH"){if(F&&F.Point)J=new H.Pos(F.Point.pos);if(F&&F.Address)r=h(F.Address,J)}(E=r)&&x.push(E)}}catch(L){ca(L,"error")}return x}u=H.ex({addresses:[],parserReport:false,
parseOnly:false,returnSpatialKeys:false},u);var D=ka('<xls:GeocodeRequest parserReport="{0}" parseOnly="{1}" returnSpatialKeys="{2}">'),o=new q;return H.ex({},o,{methodName:"Geocode",getRequestBody:function(){for(var y=D(u.parserReport,u.parseOnly,u.returnSpatialKeys),x=0;x<u.addresses.length;x++)y+=u.addresses[x].getXML();return y+"</xls:GeocodeRequest>"},parseResponse:function(y){if(u.addresses.length===1)return[v(y.GeocodeResponseList)];else{for(var x=[],r=0;r<u.addresses.length;r++)x.push(v(y.GeocodeResponseList[r]));
return x}}})},w=function(u){u=H.ex({position:null,geocodePreference:"StreetAddress"},u);return H.ex(new q,{methodName:"ReverseGeocode",getRequestBody:function(){return"<xls:ReverseGeocodeRequest><xls:Position><gml:Point><gml:pos>"+u.position.toString()+"</gml:pos></gml:Point></xls:Position><xls:ReverseGeocodePreference>"+u.geocodePreference+"</xls:ReverseGeocodePreference></xls:ReverseGeocodeRequest>"},parseResponse:function(v){var D=null;if(v&&v.Point)D=new H.Pos(match.Point.pos);if(v&&v.ReverseGeocodedLocation&&
v.ReverseGeocodedLocation.Address)return h(v.ReverseGeocodedLocation.Address,D);return null}})};return{forward:function(u,v){var D,o=[];H.is(u,"object")?H.log("attempting to geocode a simple object - not implemented","warn"):o.push(new l({freeform:u}));if(o.length>0){o=new n({addresses:o});e(o,function(y){for(D=0;v&&D<y.length;D++)v(u,y[D])})}},reverse:function(u,v){var D=new w({position:u});e(D,function(o){v&&v(o)})}}});H.Registry.register("service","routing",function(){var n=function(w){w=H.ex({waypoints:[],
provideRouteHandle:false,distanceUnit:"KM",routeQueryType:"RMAN",routePreference:"Fastest",routeInstructions:true,routeGeometry:true},w);var u=new q,v=H.formatter('<xls:DetermineRouteRequest provideRouteHandle="{0}" distanceUnit="{1}" routeQueryType="{2}">'),D=H.formatter("<xls:{0}><xls:Position><gml:Point><gml:pos>{1}</gml:pos></gml:Point></xls:Position></xls:{0}>");return H.ex({},u,{methodName:"DetermineRoute",getRequestBody:function(){if(w.waypoints.length<2)throw Error("Cannot send RouteRequest, less than 2 waypoints specified");
var o=v(w.provideRouteHandle,w.distanceUnit,w.routeQueryType);o+="<xls:RoutePlan>";o+="<xls:RoutePreference>"+w.routePreference+"</xls:RoutePreference>";o+="<xls:WayPointList>";for(var y=0;y<w.waypoints.length;y++)o+=D(y===0?"StartPoint":y===w.waypoints.length-1?"EndPoint":"ViaPoint",w.waypoints[y].toString());o+="</xls:WayPointList>";o+="</xls:RoutePlan>";if(w.routeInstructions)o+='<xls:RouteInstructionsRequest rules="maneuver-rules" providePoint="true" />';if(w.routeGeometry)o+="<xls:RouteGeometryRequest />";
o+="</xls:DetermineRouteRequest>";return o},parseResponse:function(o){var y=H.RouteTools.RouteData,x=o.RouteGeometry.LineString.pos,r=x.length,C=Array(r);for(r=r;r--;)C[r]=new ia(x[r]);x=o.RouteInstructionsList;o=[];x=x&&x.RouteInstruction?x.RouteInstruction:[];r=0;for(var E=new COG.Duration,F=0;F<x.length;F++){var J;J=x[F].distance;var L={M:1,KM:1E3}[J.uom?J.uom.toUpperCase():"M"];J=J.value&&L?J.value*L:0;L=COG.parseDuration(x[F].duration,"8601");r+=J;E=COG.addDuration(E,L);o.push(new H.RouteTools.Instruction({position:new H.Pos(x[F].Point),
description:x[F].Instruction,distance:J,distanceTotal:r,time:L,timeTotal:E}))}return new y({geometry:C,instructions:o})}})};return{calculate:function(w,u){w=H.ex({waypoints:[]},w);if(typeof H.RouteTools!=="undefined"){var v=new n(w);e(v,function(D){u&&u(D)})}else ca("Could not generate route, T5.RouteTools plugin not found","warn")}}});return{applyConfig:function(n){H.ex(f,n)},compareFns:function(){return{streetDetails:function(n,w){return w.calcMatchPercentage(n)},location:function(n,w){return w.calcMatchPercentage(n)}}}()}}();
ob.T5=H;ob.Tile5=function(a,c){c=M({container:a,type:"map",renderer:"canvas",starpos:null,zoom:1,fastpan:false,drawOnScale:true,zoombar:{}},c);return wa("view",c.type,c)}})(window);
